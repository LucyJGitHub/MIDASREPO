     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Book transfers input')                        *
/*OVRF*: OVRDBF FILE(TRADSX) TOFILE(TRADS) SHARE(*NO)               : *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Securities Trading Module                            *
     F*                                                               *
     F*  SE0090 - BOOK TRANSFERS INPUT                                *
     F*                                                               *
     F*  Function: This program allows the insertion of a transaction *
     F*   (I/C)    to Buy and Sell between the bank's Books.          *
     F*                                                               *
     F*  Called By: SEC02 - Input Cycle Processing                    *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD058285           Date 22Jun21               *
      *  Prev Amend No. MD046998A          Date 15Apr21               *
      *                 248698             Date 01Jun20               *
      *                 MD057247           Date 01Feb21               *
      *                 MD050604           Date 21Feb20               *
      *                 MD046248           Date 27Oct17               *
      *                 226449             Date 24Jun15               *
      *                 MD034776           Date 08Jul15               *
      *                 AR1067108          Date 11Dec12               *
      *                 AR1001183A         Date 20Nov12               *
      *                 CSW210             Date 04May10               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 234300             Date 29Sep06               *
      *                 BUG12410           Date 07Nov06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSE075             Date 17Nov05               *
      *                 CSE065             Date 08Nov04               *
      *                 CSE071             Date 19Jul05               *
      *                 229857             Date 07Oct04               *
      *                 226570             Date 27Jun04               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3122            Date 17Jul04               *
      *                 BUG2582            Date 13Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 TDA035             Date 02Apr04               *
      *                 CGL029             Date 01Sep03               *
      *                 CAS006             Date 21Jan03               *
      *                 211407             Date 07Jan03               *
      *                 194370             Date 12Jul01               *
      *                 207543             Date 17JUL02               *
      *                 180056             Date 18Oct00               *
      *                 CSE037             Date 29Apr02               *
      *                 CSE035             Date 22Apr02               *
      *                 206316             Date 19Jul02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 17Jun01               *
      *                 CSE031             Date 06Dec01               *
      *                 180707             Date 25Jul00               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.04 -----------------------------------------------*
      *                 186769             Date 22Nov00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 140272             Date 20Apr00               *
      *                 088864             Date 20Apr00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CSE006             Date 17May99               *
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CSE010             Date 21Jun99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CAC005             Date 23Nov98               *
      *                 130862             Date 18Oct98               *
      *                 151945             DATE 06Jan99               *
      *                 CAP003             Date 30Jul98               *
      *                 CEU017             Date 04Mar98               *
      *                 CSE007             Date 19Jan98               *
     F*                 CEU005             DATE 06JAN98               *
     F*                 CSE005             DATE 04FEB97               *
      *                 109540             Date 15Sep96               *
     F*                 CAC002             Date 15Sep96               *
     F*                 104058             Date 01Nov96               *
     F*                 S01408             Date 23Aug96               *
     F*                 084704             Date 12Aug96               *
     F*                 083039             Date 12Aug96               *
     F*                 059110             Date 12Aug96               *
     F*                 088047             Date 26JUN96               *
     F*                 CSW003             DATE 12FEB96               *
     F*                 100228             DATE 29MAY96               *
     F*                 067535             DATE 02MAY96               *
     F*                 S01408             DATE 01MAY96               *
     F*                 066046             DATE 26APR96               *
     F*                 063075             DATE 26APR96               *
     F*                 099886             DATE 17APR96               *
     F*                 100017             DATE 17APR96               *
     F*                 099649             DATE 17APR96               *
     F*                 S01408             DATE 03APR96               *
     F*                 S01408             DATE 04FEB96               *
     F*                 CPM004             DATE 08FEB96               *
     F*                 S01408             DATE 23FEB96               *
     F*                 S01408             DATE 10JAN96               *
     F*                 088903             DATE 28JUN95               *
     F*                 092961             DATE 04OCT95               *
     F*                 091254             DATE 20OCT95               *
     F*                 088307             DATE 15JUN95               *
     F*                 086491             DATE 15JUN95               *
     F*                 081892             DATE 15MAR95               *
     F*                 S01408             DATE 17JAN95               *
     F*                 S01511             DATE 23AUG94               *
     F*                 S01510             DATE 23AUG94               *
     F*                 S01509             DATE 23AUG94               *
     F*                 074978             DATE 23AUG94               *
     F*                 064575             DATE 15AUG94               *
     F*                 065301             DATE 05MAY94               *
     F*                 046303             DATE 16JAN94               *
     F*                 055420             DATE 23NOV93               *
     F*                 054259             DATE 23NOV93               *
     F*                 052254             DATE 23NOV93               *
     F*                 S01446             DATE 04NOV93               *
     F*                 S01401             DATE 16JUN93               *
     F*                 E39495             DATE 17FEB93               *
     F*                 E27915             DATE 17FEB93               *
     F*                 E47922             DATE  1FEB93               *
     F*                 E47501             DATE  1FEB93               *
     F*                 S01397             DATE 16SEP92               *
     F*                 E43208             DATE 01SEP92               *
     F*                 E38323             DATE 31JUL92               *
     F*                 E36063             DATE 18FEB92               *
     F*                 E34912             DATE 03FEB92               *
     F*                 E35251             DATE 03FEB92               *
     F*                 E34935             DATE 03FEB92               *
     F*                 E27934             DATE 22OCT91               *
     F*                 E27092             DATE 04SEP91               *
     F*                 E24398             DATE 12FEB91               *
     F*                 S01117             DATE 30NOV90               *
     F*                 S01195             DATE 30NOV90               *
     F*                 S01220             DATE 07AUG90               *
     F*                 S01269             DATE 18JUL90               *
     F*                 S01271             DATE 18JUN90               *
     F*                 E23204             DATE 08AUG90               *
     F*                 E21668             DATE 01MAY90               *
     F*                 E21718             DATE 26APR90               *
     F*                 E21713             DATE 25APR90               *
     F*                 E21616             DATE 03APR90               *
     F*                 E21503             DATE 23MAR90               *
     F*                 E21115             DATE 13FEB90               *
     F*                 E20670             DATE 19DEC89               *
     F*                 S01232             DATE 15DEC89               *
     F*                 E20232             DATE 15DEC89               *
     F*                 E20496             DATE 05DEC89               *
     F*                 E20522             DATE 05DEC89               *
     F*                 E20380             DATE 04DEC89               *
     F*                 E20386             DATE 24NOV89               *
     F*                 E20021             DATE 23NOV89               *
     F*                 E20371             DATE 22NOV89               *
     F*                 E20125             DATE 20NOV89               *
     F*                 E20085             DATE 08NOV89               *
     F*                 S01199             DATE 01AUG89               *
     F*                 E16772             DATE 19/06/89              *
     F*                 E18200             DATE 09/05/89              *
     F*                 E16083             DATE 23/02/89              *
     F*                 E16328             DATE 23/02/89              *
     F*                 E16143             DATE 23/02/89              *
     F*                 E16469             DATE 23/02/89              *
     F*                 S01179             DATE 19/12/88              *
     F*                 S01176             DATE 11/11/88              *
     F*                 S01169             DATE 11/11/88              *
     F*                 E14962             DATE 16/09/88              *
     F*                 E14574             DATE 09/09/88              *
     F*                 E14299             DATE 20/07/88              *
     F*                 S01158             DATE 05/05/88              *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  MD058285 - Change base rate code to alphanumeric (Recompile) *
      *  MD046998A - Recompiled due to changes in /COPY ZDYYRZ3       *
      *            - Applied fix for MD057480                         *
      *  248698 - Rounding discrepancies on some SE reports. Applied  *
      *           fix 228682.                                         *
      *  228682 - Recompiled due to ZCNSDZ1 changes. Applied 176594.  *
      *  MD057247 - Multiple calls of UTCHOBJEX for several COB com-  *
      *             ponents - Securities module.                      *
      *           - Moved the call of AOSARDR0 from /copy ZLCDZ1.     *
      *  MD050604 - Average price of position changed incorrectly.    *
      *           - Recompiled due to changes in copy source ZCNSDZ1. *
      *  MD046248 - Finastra Rebranding                               *
      *  226449 - Recompiled over changes made in /COPY ZDYYRZ3.      *
      *         - Applied for MD034387.                               *
      *  MD034776 - Reverse AR1001183A to allow negative interest     *
      *             rate. (Recompile)                                 *
      *  AR1067108 - PMC1140 Component failed during Clean COB        *
      *              Applied fix AR1001183A                           *
      *  AR1001183A - Coupon rate was still used in computation of    *
      *              interest instead of using the details in FRN tab *
      *              (Reopen) (Recompile)                             *
      *  CSW210 - SWIFT 2010 Changes (Recompile)                      *
      *  234300 - Recompiled over changed in PF/HSTTRD.               *
      *  BUG12410 - Change program to use the actual timestamp        *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSE075 - US Enhanced Treasury Upgrade to MidasPlus           *
      *           (Recompile)                                         *
      *  CSE065 - Const. Yield Amort. on Mortgage backed assets       *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  229857 - Recompiled due to change in ZYLDZ2.                 *
      *  226570 - Recompiled due to change in ZYLDZ2.                 *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3122 - Recompiled due to changes in SDSECSPD.             *
     F*  BUG2582- Book Transfers do not generate MT500's but a record *
     F*           should be written to the extenion file TRADSDx2     *
     F*           to prevent various authorisation and audit programs *
     F*           from falling over with DB error.                    *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  TDA035 - RTS Signon changes for MidasPlus. (Recompile)       *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CAS006 - Hedge Accounting Phase B                            *
      *  211407 - Recompile after change on copy sources ZYLDZ2,      *
      *           ZACCRZ1 and ZYCEZ1 for NX/NNX processing.           *
      *           The change was to call subroutine ZLCD1 instead     *
      *           of ZLCD in retrieving the PERIOD for NNX processing *
      *           and ZNCD1 is called instead of ZNCD in retrieving   *
      *           the WBENCD for NNX processing. Also rewrite tests   *
      *           for identifying if position is NX,NNX or CUM.       *
      *  194370 - Recompile after change on copy sources ZYLDZ2,      *
      *           For securities with divisor basis = '5' and first   *
      *           coupon date > valuation date (rundate + 1), set     *
      *           event control date to first coupon date before      *
      *           processing SR/ZDYYR. This is to ensure that the     *
      *           correct hypothetical last and next coupon dates are *
      *           used in deriving the price/yield rate.              *
      *  207543 - CEU018 not working on a price basis.                *
      *           Recompiled due to changed ZYLDZ2.                   *
      *  180056 - Recompiled over changed in ZDYYRZ3.                 *
      *  CSE037 - Countervalue rounding.                              *
      *  CSE035 - NX/NNX Coupon Payment Processing.                   *
      *           Recompile over changed ZACCRZ1/ZYLDZ2
      *  206316 - Recompiled over changed ZLCDZ1.                     *
      *  CPK015 - Conversion of ZYIELD from PLI to RPG.               *
      *           - Recompile over changed ZYLDZ2.                    *
      *           - Default timestamp data.                           *
     F*  CSE031 - Coupon Fixing for Floating Rate Notes.              *
     F*           (recompilation due to change to ZNCD/ZLCD/ZACCR)    *
     F*  180707 - No Position Settlements generated. Recompile over   *
     F*           changes in /COPY ZNCDZ3.                            *
     F*  186769 - Withholding Tax fields not being initialised caused *
     F*           decimal data error in trade input API.              *
     F*           (CSE023 - Treaty witholding Tax)                    *
     F*  140272 - Recompile over changed ZYLDZ2
     F*  088864 - Recompile over amended /COPY ZPCINTZ1               *
     F*  CSE006 - Validation added to ensure Buy-Sell Book cannot     *
     F*           be used for Book transfer.(Repos Enhancements)      *
      *  CSE010 - SE Transactions Enhancements                        *
      *  CAC005 - Profit Centre Accounting - SE Enhancement           *
     F*  130862 - Recompiled over ZLCDZ1 & ZDAYSZ2 changes.           *
     F*  151945 - Recompiled Over changed ZDYYRZ3 .                   *
      *  CAP003 - Conversion of Midas inputs to modular API structure *
      *           Phase 2.  Program recompiled over changed files.    *
     F*  CEU017 - Securities Redenomination Euro Changes              *
     F*  CSE007 - Corporate Actions                                   *
     F*  CEU005 - EMU SE Settlement Ccy Conversion - Recompile        *
     F*  CSE005 - Effect of holidays on FRN Coupon Dates              *
     F*           (recompilation due to change to ZNCD/ZLCD/ZACCR).   *
     F*  109540 - Profit Centres are still protected even if not      *
     F*           found in book position profit centre file.          *
     F*  CAC002 - Profit Centre Accounting Development - Phase 2      *
     F*  104058 - Defaulting of PTFR incorrect                        *
     F*  S01408 - Addition of core hook SE0090CP26                    *
     F*         - Addition of core hook SE0090CP25                    *
     F*  084704 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
     F*  083039 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
     F*  059110 - Recompiled over changed ZYLDZ2 sub.                 *
     F*  088047 - RECOMPILE over change SR/ZYLDZ2.                    *
     F*  CSW003 - MT5xx Message Generation - Phase 2                  *
     F*  100228 - RECOMPILE OVER CHANGED ZDYYRZ3, ZLCDZ1 & ZNCDZ3.    *
     F*  067535 - WHEN FIRST ENTERING AN EXISTING TRADE REFERENCE,    *
     F*           PORTFOLIO REFERENCE FROM THAT TRADE IS WRITTEN      *
     F*           IN FILE FOR NEW TRADES                              *
     F*  S01408 - Addition of core hook SE0090CP24                    *
     F*           Addition of core hook SE0090CP23                    *
     F*           Addition of core hook SE0090CP22                    *
     F*           Addition of core hook SE0090IIP2                    *
     F*  066046 - CURRENT FACTOR INCORRECT ON SUBSEQUENT TARDES FOR
     F*           MORTGAGE BACKED SECURITIES
     F*  063075 - Input of two book transfers resulting in holdings
     F*           of securities in two books which have not previously
     F*           had holdings causes DB error on second read of
     F*           SEPCA
     F*  099886 - Rounding problem for partly paid securities.        *
     F*           Recompile over amended standard subroutine ZACCZ.   *
     F*  100017 - Position settlement unable to pick up day adj. on   *
     F*           SECTYD. Change subroutine to use DADJN to stop      *
     F*           interest day adjustment being used for amortisation.*
     F*           Recompile over amended subroutine ZDAYS.            *
     F*  099649 - If day adjustment on the trade is the same as on   **
     F*           the security, do not treat as an interest          **
     F*           discrepancy. Initialise new field ZDADJ, and amend **
     F*           standard subroutine ZPCINTZ1 to use this flag.      *
     F*  S01408 - Addition of core hook SE0090CP17                    *
     F*           Addition of core hook SE0090CP18                    *
     F*           Addition of core hook SE0090CP19                    *
     F*           Addition of core hook SE0090CP20                    *
     F*           Addition of core hook SE0090CP21                    *
     F*  S01408 - Addition of core hook SE0090CCP9                    *
     F*           Addition of core hook SE0090CP10                    *
     F*           Addition of core hook SE0090CP11                    *
     F*           Addition of core hook SE0090CP12                    *
     F*           Addition of core hook SE0090CP13                    *
     F*           Addition of core hook SE0090CP14                    *
     F*           Addition of core hook SE0090CP15                    *
     F*           Addition of core hook SE0090CP16                    *
     F*  CPM004 - Bank Portfolios                                     *
     F*  S01408 - Addition of core hook SE0090CCP8                    *
     F*  S01408 - Addition of core hook SE0090CCP3                    *
     F*           Addition of core hook SE0090CCP4                    *
     F*           Addition of core hook SE0090CCP5                    *
     F*           Addition of core hook SE0090CCP6                    *
     F*           Addition of core hook SE0090CCP7                    *
     F*           Addition of core hook SE0090IIP1                    *
     F*           Addition of core hook SE0090FFP1                    *
     F*  088903 - Schuldschein securities must be flatly traded       *
     F*  092961 - Recompile over ZDAYSZ2 which was amended by 086491  *
     F*           (Wrong number of days calculated for day basis 1    *
     F*           when start or end day is last day of February)      *
     F*  091254 - RECOMPILE OVER CHANGED ZLCDZ1 & ZNCDZ3              *
     F*  088307 - Do not allow insertion over deleted trades          *
     F*  086491 - Wrong nbr of days calculated for day basis 1        *
     F*           when start or end day is last day of February       *
     F*           Recompiled for ZSRSRC/ZDAYSZ2 changes.              *
     F*  081892 - Book Transfers do not generate MT500's but a record *
     F*           should be written to the extenion file TRADSDx1     *
     F*           to prevent various authorisation and audit programs *
     F*           frpm falling over with DB error - Settlement Message*
     F*           Request and Conf Message Request must be 'N'        *
     F*  S01408 - Addition of core hook SE0090CCPG                    *
     F*           Addition of core hook SE0090CCP1                    *
     F*           Addition of core hook SE0090CCP2                    *
     F*  S01511 - Market Migration                                    *
     F*  S01510 - Dividend payments based on ex-date                  *
     F*  S01509 - Value Currency to be Currency of Issuer Payments    *
     F*  074978 - If a record exists on TRADSD with RECI '*' check    *
     F*           in the historic file.                               *
     F*  064575 - Recompiled over amended ZYLDZ2 subroutine.          *
     F*  065301 - Recompiled over changed copy source ZACCR subr.     *
     F*           with ZAMT increased to 15,0.                        *
     F*  046303 - /COPY source subr. ZFWDT amended to prevent array   *
     F*           error if no holiday record found - fixed by S01434. *
     F*           Program recompiled.                                 *
     F*  055420 - Recompile over changed SR/ZCOTRZ1                   *
     F*  054259 - SANP AND SANS SHOULD NOT BE MULTIPLIED BY THE       *
     F*           CURRENT FACTOR FOR PROT = 8.                        *
     F*  052254 - CURRENT FACTOR amended from 9,8 to 10,9             *
     F*  S01446 - CUSTOMER COMMISSIONS (COURTAGE) ENHANCEMENT.        *
     F*           Recompiled due to changes in PF/SECGTD.             *
     F*  S01401 - MT5xx SWIFT Messages Feature:                       *
     F*           - Recompiled due to changes to files.               *
     F*  E39495 - New /COPY subroutine ZCALCD added (called frpm      *
     F*           SR. ZYLD)                                           *
     F*         - /COPY subroutine ZACCZZ1 added (called from         *
     F*           SR. ZYLD and ZCALCD)                                *
     F*         - Recompiled over changed ZYLDZ2                      *
     F*  E27915 - If trade price differs by more than 10% warning     *
     F*           W01 not displayed. Price was checked against value  *
     F*           date book position record not the current market    *
     F*           price                                               *
     F*  E47922 - Recompile over changed SR/ZYLDZ2                    *
     F*  E47501 - Profit Centre problems                              *
     F*           - should allow Profit Centre to be blank            *
     F*           - error indicators for Profit Centres not being     *
     F*             reset                                             *
     F*  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
     F*           - Added processing for Discount/Premium since First *
     F*             Position Date for Amortisation by Security Report *
     F*           - Recompiled for New Zealand Bond Formula.          *
     F*  E43208 - Field AIBD changed to ISMA. ('Association of        *
     F*           International Bond Dealers' changed their name to   *
     F*           'International Securities Market Association').     *
     F*  E38323 - Recompiled due to a change in copy source ZFWDT subr*
     F*  E36063 - I/C AP numerator on BKPOS is incorrectly updated    *
     F*           for sale half of book transfer                      *
     F*  E34912 - Base ccy rate is written to TRADSD incorrectly for  *
     F*           the purchase half of the book transfer (o.k.for sale*
     F*  E35251 - PF/SEPCA not updated correctly                      *
     F*  E34935 - Originating branch not updated on TRADSD and value  *
     F*           date not displayed on 2nd screen(display file chg). *
     F*  E27934 - Recompiled over the changed version of ZACCRZ1      *
     F*  E27092 - Recompiled over changed SR/ZLCD                     *
     F*  E24398 - Program should end on encountering a database error *
     F*           on BKPHD and BKPOS audit files.                     *
     F*  S01117 - Multibranching                                      *
     F*           Access object programs used to replace table files  *
     F*           SPF access code validation added.                   *
     F*           Screen function                                     *
     F*           Profit Centre                                       *
     F*           Originating branch                                  *
     F*  S01195 - Holiday Processing                                  *
     F*  S01220 - STRATEGIC RISK MANAGEMENT                           *
     F*           Recompiled over changed PF/SECTYD, PF/SEDEVD        *
     F*  S01269 - TRADE AUTHORISATION                                 *
     F*  S01271 - Pay/Receive in input cycle - set PRPC field to N    *
     F*           whenever a TRADSD record is amended or added.       *
     F*  E23204 - Recompiled over changed SR/ZPCINTZ1                 *
     F*  E21668 - Recompiled over changed SR/YLDZ2.                   *
     F*  E21718 - Recompiled over changed SR/ZPCINT.                  *
     F*  E21713 - Purchase interest is always zero.                   *
     F*  E21616 - Recompiled over changed SR/ZLCD.                    *
     F*  E21503 - Counterparties should be other branch if transfer   *
     F*           is between two branches.                            *
     F*  E21115 - Prevent Reallowance on Yield based trades.          *
     F*  E20670 - Store charges/commissions in file TRADSD as entered *
     F*           on screen both for TP and TS parts of book transfer.*
     F*  S01232 - Australian Yields Modification.                     *
     F*  E20232 - High order truncation of Countervalue on large      *
     F*           Trades. New standard subroutines ZCOTR & ZCNSD.     *
     F*           These replace ZCTRV.                                *
     F*  E20496 - Recompiled over new version of ZCTRV for X Purchase *
     F*           Interest.                                           *
     F*  E20522 - Coupon Rate field should only be displayed and it   *
     F*           should contain the value for the current Value Date.*
     F*  E20380 - Recompiled over new version of ZYLD for Divisor     *
     F*           Basis 5.                                            *
     F*  E20386 - Validation for Value Date, Accrued Indicator etc    *
     F*           is incorrect, allowing invalid data to be written   *
     F*           to the Trades File.                                 *
     F*         - Prevent Entry to the 2nd Screen if no details have  *
     F*           been entered after CMD 12 was pressed.              *
     F*         - Depot field is highlighted as an error if the       *
     F*           Customer Commission Rebate is invalid.              *
     F*         - Depot field allows any SE Customer to be entered,   *
     F*           it should not allow those with a Classification of  *
     F*           'S' or 'D'.                                         *
     F*  E20021 - Negative interest amount is changed to positive.    *
     F*           Program used ZALIGN instead of ZASIGN.              *
     F*  E20371 - Incorrect Validation for Selling and Buying Books   *
     F*           when they are left Blank.                           *
     F*  E20125 - Fixes from Cargill with no other Number:            *
     F*           - Value Date Default calculating incorrect date:    *
     F*             The Processing was ignoring the Actual/Working    *
     F*             Days indicator and just adding the number of days *
     F*             to the Run Date to get the Value Date. Added the  *
     F*             Standard SR/ZDATE3 to calculate fwd working days  *
     F*           - WNOML is updated incorrectly when changing the    *
     F*             number of days adjusted for a completed trade.    *
     F*           - ECD shld be updated in D2VALD even if not changed *
     F*  E20085 - Interest and Coupon Calculations Rewrite:           *
     F*           - Functional Incompatibility when overriding the    *
     F*             Interest Amount. Program amended so that even if  *
     F*             any Interest Details are changed, the Interest    *
     F*             Amount may be overridden. But, the Days Adjustment*
     F*             And Actual/Difference Indicator flds must both be *
     F*             blank. Error Message 217 changed to reflect this. *
     F*           - SR/WTRADS: The Interest Amount was being lost due *
     F*             to this subroutine using 'ZALIGN' to convert the  *
     F*             screen field (Interest Amount) from char to packed*
     F*             decimal (for TRADSD).  Since this is a signed fld *
     F*             'ZASIGN' should be used instead.                  *
     F*           - Program was using ECD based on the Next Working   *
     F*             Day. It should be using Value Date throughout.    *
     F*             Program has been changed to move Value Date to ECD*
     F*             and remove redundant subroutine ZEVCD.            *
     F*           - Obsolete Subroutines: CNCD, CPCINT and CPCADJ and *
     F*             other redundant code has been removed.            *
     F*           - New subroutines added or rewritten: ZLCD, ZNCD,   *
     F*             ZPCINT and ZRATE.                                 *
     F*           - File definitions added/amended for this purpose.  *
     F*           - LF/SECEO member SEDEVD changed to omit RECI = 'C' *
     F*  S01199 - Help System.                                        *
     F*  E16772 - Recompiled for the Dividend Payment Amount field    *
     F*           changes.                                            *
     F*  E18200 - INCOMPLETE INDICATOR SHOULD NOT BE MANDATORY ENTRY. *
     F*           IF BLANK IT SHOULD DEFAULT TO SECURITY INC. IND.    *
     F*  E16083 - UPDATE POSITION DATES CORRECTLY.                    *
     F*  E16328 - DO NOT UPDATE BKPHDD IF RECORD ALREADY EXISTS, IF   *
     F*           RECORD DOES NOT EXIST CONTINUE TO WRITE ONE.        *
     F*  E16143 - IF BRANCH INTERNAL CUSTOMER FOR BUYING OR SELLING   *
     F*           BRANCH IS NOT ON CLINTSE, AN ERROR MESSAGE SHOULD   *
     F*           BE DISPLAYED INSTEAD OF A DB ERROR.                 *
     F*  E16469 - DUPLICATE UDEPPD RECORDS ARE CREATED FOR BOOK       *
     F*           TRANSFERS.                                          *
     F*  S01179 - AS400 CONFIGURATION                                 *
     F*  S01176 - SECURITIES TRADING 3.1 (AUSTRALIA)                  *
     F*  S01169 - SECURITIES TRADING 3.1 (BAER INCORPORATION)         *
     F*  E14962 - LATEST POSITION DATE ON BKPHDD UPDATED INCORRECTLY  *
     F*  E14574 - BOOK TRANSFER INPUT SHOULD UPDATE A DEPOT.          *
     F*  E14299 - PURCHASE SIDE OF BOOK TRANSFER SHOULD HAVE THE      *
     F*           SIGN REVERSED ON COMMISSION AND CHARGES.            *
     F*  S01158 - SE POST INCORPORATION DEVELOPMENT ERROR FIX         *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
      *
     FSE0090DFCF  E                    WORKSTN
     F***SECHG***IF**E***        K        DISK                            S01169
     FSECGT   IF  E           K        DISK                               S01169
     FSECTY   IF  E           K        DISK
     F***TABSE***IF  E           K        DISK                            S01117
     F*********** TABLETAF                          KIGNORE               S01117
     F*********** TABTE10F                          KIGNORE               S01117
     F*********** TABTE20F                          KIGNORE               S01117
     F*********** TABTG20F                          KIGNORE               S01117
     F*********** TABLETHF                          KIGNORE               S01117
     F*********** TABLETKF                          KIGNORE               S01117
     F*********** TABLETLF                          KIGNORE               S01117
     F*********** TABLETNF                          KIGNORE               S01117
     F*********** TABLETPF                          KIGNORE               S01117
     F*********** TABLETXF                          KIGNORE               S01117
     F*********** TABLET2F                          KIGNORE               S01117
     F*********** TABLET3F                          KIGNORE               S01117
     FSEMKC   IF  E           K        DISK
     FINVTP   IF  E           K        DISK
     F***BOOKD***IF  E           K        DISK                            S01117
     FSECED   IF  E           K        DISK
     FBULKR   IF  E           K        DISK                               S01176
     FSECEO   IF  E           K        DISK
     F*********** SEDEVDF                           KRENAMESEDEVDF2       E20085
     F            SEDEVDF                           KRENAMESEDEVDO        E20085
     F*********** SNDEVDF                           KIGNORE               E39495
     F            SNDEVDF                           KRENAMESNDEVDO        E39495
     F***TRADSX**IF**E           K        DISK                            074978
     FTRADHS  IF  E           K        DISK                               074978
     F            TRADSDF                           KRENAMETRADSDFX
     FFDDIV   IF  E           K        DISK                               S01510
     F            SEDEVDF                           KRENAMESEDEVD2        S01510
     FTRADS   UF  E           K        DISK                      A
     F                                              KCOMIT
     F                                              KINFDS INFDS
     F                                              KINFSR INFSR
     FTRADSA  UF  E                    DISK
     F                                              KCOMIT
     F***SNAME***IF  E           K        DISK                      E14574S01117
     F*********** CLINTCBF                          KRENAMESNAMEF   E14574S01117
     FUDEPP   UF  E           K        DISK                      A        E14574
     F                                              KCOMIT                E14574
     FUDEPPA  UF  E                    DISK                               E14574
     F                                              KCOMIT                E14574
     F/COPY WNCPYSRC,SE0090F001
     F***CLINTX**IF  E           K        DISK                            S01117
     F*********** CLINTSEF                          KRENAMECLINTSEX       S01117
     F*********** CLINTCAF                          KIGNORE               S01117
     F*********** CLINTCBF                          KIGNORE               S01117
     F*********** CLINTCCF                          KIGNORE               S01117
     F*********** CLINTC1F                          KIGNORE               S01117
     F***CLINT***UF  E           K        DISK                            S01117
     F*********** CLINTCAF                          KIGNORE               S01117
     F*********** CLINTCBF                          KIGNORE               S01117
     F*********** CLINTCCF                          KIGNORE               S01117
     F*********** CLINTC1F                          KIGNORE               S01117
     F***********                                   KCOMIT                S01117
     FBKPOS   UF  E           K        DISK                      A
     F                                              KCOMIT
     FBKPOSA  UF  E                    DISK
     F                                              KCOMIT
     FBKPHDA  UF  E                    DISK
     F                                              KCOMIT
     FBKPHD   UF  E           K        DISK                      A
     F                                              KCOMIT
     FPRICM   IF  E           K        DISK                               E27915
     FMUSER   IF  E           K        DISK                               S01269
     FTRAUTD  O   E                    DISK         KCOMIT                S01269
     FSEPCBD  IF  E           K        DISK         KCOMIT       A        S01117
     F***SEPCA***UF**E**         K        DISK         KCOMIT      S01117 063075
     FSEPCA   UF  E                    DISK         KCOMIT                063075
     FTRADSDX1O   E           K        DISK         KCOMIT            UC  081892
     FTRADSDX2O   E           K        DISK         KCOMIT            UC  BUG2582
     FPMPORTPDIF  E           K        DISK                           UC  CPM004
     FPMHSEXPDIF  E           K        DISK                           UC  CPM004
      *                                                                   S01408
     F/COPY WNCPYSRC,SE0090FFP1                                           S01408
      *                                                                   S01408
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*   01  - F/3  End of job                                       *
      *   02  - Screen 3 display                                      *                       CAS006
     F*   05  - F/12 - Initial screen                                 *
     F*   06  - HELP requested                                        *
     F*   07  - Rec not found, PMHSEXPD                               *   CPM004
     F*   08  - Rec not found, PMPORTPD                               *   CPM004
     F*   09  - Bank Portfolios is supported                          *   CPM004
     F*   10  - Screen 2 display                                      *
     F****11**-*Processing*type*=*1,3,5,6*or*8*&*Trade*basis*=*P*or*Y**   S01176
     F*   11  - Processing type = 1,3,5,6,8 or 9 & Trade basis=P or Y *   S01176
     F*   12  - Trade Basis = Y                                       *
     F*   14  - Processing type = 4 or 7                              *
     F*   15  - Processing type = 8                                   *
     F*                                                               *
     F****19**-*Latest coupon event found for purchase interest       *   E20125
     F****20**-*Purchase interest calculation routine                 *   E20125
     F*                                                               *   S01117
     F*   16  - Error - Selling Profit Centre                         *   S01117
     F*   17  - Error - Originating Branch                            *   S01117
     F*   18  - Error - Buying Profit Centre                          *   S01117
     F*   19  - Originating Branch used                               *   S01117
     F*   20  - Multibranching set on                                 *   S01117
     F*                                                               *
     F*   21  - Chain failure on LF/MUSER                             *   S01269
     F*   22  - Change ind on F0 screen                               *
     F*                                                               *
     F*   23  - Protect Selling Profit Centre                         *   S01117
     F*   24  - Protect Buying Profit Centre                          *   S01117
     F*                                                               *   S01117
     F*   25  - NOMINAL CURRENCY DECIMAL PLACES IS 0                  *
     F*   26  - NOMINAL CURRENCY DECIMAL PLACES IS 1                  *
     F*   27  - NOMINAL CURRENCY DECIMAL PLACES IS 2                  *
     F*   28  - NOMINAL CURRENCY DECIMAL PLACES IS 3                  *
     F*                                                               *
     F*   29  - Profit Centres used                                   *   S01117
     F*                                                               *   S01117
     F*   30  - Screen 1 process control                              *
     F*   31  - Screen 2 process control                              *
     F*                                                               *
     F*   33  - Error - Depot                                         *   E20386
     F*   34  - Error - Charge Code 6                                 *   S01176
     F*                                                               *   S01117
     F****35**-*Field*tested*is*numeric********************************   S01117
     F*                                                               *   S01117
     F*   36  - Error - Charge Amount 6                               *   S01176
     F*   37  - Error - Charge code 7                                 *   S01176
     F*                                                               *
     F*   38  - Display error array 1                                 *
     F*   39  - Display error array 2                                 *
     F*                                                               *
     F*   40  - Protect input fields                                  *
     F*   41  - Chain to LF/BULKR (no record found)                   *   S01176
     F*   42  - Auto-Charges present indicator                        *   S01176
     F*   43  - Error - Charge Amount 7                               *   S01176
     F*   44  - Chain fail/End of file                                *
     F*   45  - Chain fail(audit control)                             *
     F*                                                               *
     F*   46  - Error - Tax Amount                                    *   S01176
     F*   47  - Error - Broker Commission Rebate                      *   S01176
     F****48**-*Error*-*Depot************************************** E14574E20386
     F*   48  - Error - Customer Commission Rebate                    *   S01176
     F*   49  - Error - Tax Rebate                                    *   S01176
     F*   50  - Error - Security shortname                            *
     F*   51  - Error - Selling book                                  *
     F*   52  - Error - Buying Book                                   *
     F*   53  - Error - Selling reference                             *
     F*   54  - Error - Buying reference                              *
     F*   55  - Error - Selling branch                                *
     F*   56  - Error - Buying branch                                 *
     F*   57  - Error - Incomplete indicator                          *
     F*   58  - Error - Nominal                                       *
     F*   59  - Error - Price/Discount/Yield                          *
     F*   60  - Error - Value date                                    *
     F*   61  - Error - Market centre                                 *
      *       - Error - Credit Risk Spread (Screen 3)                 *                       CAS006
     F*   62  - Error - Reallowance                                   *
      *       - Error - Liquidity Premium (Screen 3)                  *                       CAS006
     F*   63  - Error - Price                                         *
      *       - Error - Interest Amount using N-T-R (Screen 3)        *                       CAS006
     F*   64  - Error - Ex-dividend                                   *
      *       - Error - Net Treasury Price (Screen 3)                 *                       CAS006
     F*   65  - Error - Capacity                                      *
     F*   66  - Lokup indicator on ER1 , ER2                          *   S01176
     F*   67  - Error - Trade date                                    *
     F*   68  - Error - Trade sub-type                                *
     F*   69  - Error - Market indicator                              *
     F****70**-*Error*-*AIBD/IPPA**************************************   E43208
     F*   70  - Error - ISMA/IPMA                                     *   E43208
     F*   71  - Error - Accrued indicator                             *
     F*   72  - Error - Days adjustment                               *
     F*   73  - Error - Act/Diff indicator                            *
     F*   74  - Error - Interest amount                               *
     F****75**-*Error*-*Coupon*rate************************************   E20522
     F*   76  - Error - Broker commission code                        *
     F*   77  - Error - Broker commission amount                      *
     F*   78  - Error - Customer commission code                      *
     F*   79  - Error - Customer commission amount                    *
     F*   80  - Error - Charges code 1                                *
     F*   81  - Error - Charges amount 1                              *
     F*   82  - Error - Charges code 2                                *
     F*   83  - Error - Charges amount 2                              *
     F*   84  - Error - Charges code 3                                *
     F*   85  - Error - Charges amount 3                              *
     F****86**-*Error*-*Other*charges*code*****************************   S01176
     F*   86  - Error - Charges Code 5                                *   S01176
     F****87**-*Error*-*Other*charges*amount***************************   S01176
     F*   87  - Error - Charges amount 5                              *   S01176
     F****88**-*Error*-*Local*tax*code*********************************   S01176
     F*   88  - Error - Charge code 6                                 *   S01176
     F****89**-*Error*-*Local*tax*amount*******************************   S01176
     F*   89  - Error - Charge amount 6                               *   S01176
     F*                                                               *
     F* 90-99 - Used in Standard Subroutines                          *
     F*                                                               *
     F*   U7  - Database Error                                        *
     F*   U8  - Program Error                                         *
      *   LR  - Last Record Indicator                                 *   CSE010
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*  *PSSR  - DUMP program on error                               *   S01117
     F*  BAINIT - Initialisation routine                              *
     F*  BBMAIN - Main-line processing                                *
     F*  CBKPOS - Calculate the latest Book positions                 *
     F*                                                               *   S01117
     F***CNCD***-*Determine*next*coupon*date*for*puchase*interest*calc*   E20085
     F***CPCADJ*-*Calculate*the*interest*adjustment*on*a*Trade        *   E20085
     F***CPCINT*-*Calculate*the*purchased*interest*on*a*Trade         *   E20085
     F*                                                               *   S01117
     F*  CHKSEL - Check for "?" selection (screen 1)                  *   S01117
     F*  CHKSL2 - Check for "?" selection (screen 2)                  *   S01117
     F*  D1PROC - Process screen format 1                             *
     F*  D1VALD - Validate screen format 1                            *
     F*  D2INIT - Initialise screen format 2                          *
     F*  D2PROC - Process screen format 2                             *
     F*  D2VALD - Validate screen format 2                            *
      *  D3INIT - Initialise screen format 3                          *                       CAS006
      *  D3PROC - Process screen format 3                             *                       CAS006
      *  D3VALD - Validate screen format 3                            *                       CAS006
      *  VALSNM - Validate signed numeric using ZALIGN                *                       CAS006
     F*  DBUPDT - Update database files                               *
     F*  ERRORS - Add error codes to error arrays                     *
     F*  FAPOSD - Set up file access key for BKPOSD                   *
     F*  INFSR  - File exception/error handling subroutine            *
     F*  SRPTFR - Determine FX rate and Mult/Div Ind for Port Ref     *   CPM004
     F*  SUBW70  Write to Trade Authorisation file PF/Trautd          *   S01269
     F*  SUB801  Convert countervalue in nom curr to base curr        *   S01269
     F*  WBKPSN - Update Book positions                               *
     F*  WBKPHD - Update Book header details                          *
     F*  WBKPOS - Update Book Trade/Value date positions              *
     F*                                                               *   S01117
     F***WCLINT*-*Update*Client*details********************************   S01117
     F*                                                               *   S01117
     F*  WTRADS - Update Trade details                                *
     F*                                                               *
     F***XDATE3*-*Calculate*any*number*of*working*days*back*in*a*******   S01195
     F*                                          **currency************   S01195
     F*                                                               *   S01195
     F*  ZACCR  - Calculate interest accrued between two dates        *
     F*  ZALIGN - Validate and right-align numeric fields             *
     F*  ZASIGN - Validate and right-align signed numeric fields      *
     F*                                                               *   S01117
     F*  ZBKDT  - Calculate nth working day back from given date for  *   S01117
     F*           currency and (optional) location.                   *   S01117
     F*  ZCHKH  - Determine if given date and (optional) location is  *   S01117
     F*           a holiday.                                          *   S01117
     F*                                                               *   S01117
     F*  ZCONV  - Convert an amount from one currency to another      *   S01269
     F*  ZCTRV  - Calculate countervalue of Trade                     *
     F*  ZDATE1 - Validate dates submitted and convert to a number    *
     F*                                            of days            *
     F*  ZDATE2 - Convert a day number to date format                 *
     F*                                                               *   S01195
     F***ZDATE3*-*Calculate*a*number*of*working*days*fwd*in*a*ccy***E20125S01195
     F***ZDATE5*-*Determine*if*a*day*number*date*is*a*holiday*in*******   S01195
     F*          *******given*currency*and,*if*day*is*a*holiday********   S01195
     F*          ****and*if*required,*determine*next*working*day*******   S01195
     F*                                                               *   S01195
     F*  ZDAYS  - Calculate no. of days between two dates for         *
     F*                                      interest calculations    *
     F*  ZDYYR  - Calculate no. of days in interest year              *
     F***ZEVCD**-*Determine*event*control*date                        *   E20085
     F*                                                               *   S01117
     F*  ZFWDT  - Calculate nth working day forward from given date   *   S01117
     F*           for currency and (optional) location.               *   S01117
     F*                                                               *   S01117
     F***ZICD2**-*Access*ICD*record*2*for*securities*trading***********   S01117
     F***ZICDSE*-*Access*ICD*record*3*for*securities*trading***********   S01117
     F*                                                               *   S01117
     F*  ZLCD   - Determine last coupon date                          *   E20085
     F*  ZNCD   - Determine next coupon date                          *
     F*  ZPCINT - Calculate the Purchased Interest on a Trade (this   *   E20085
     F*           includes any Interest Adjustments).                 *   E20085
     F*  ZPRCI  - Output price as percentage price                    *
     F*  ZRATE  - Calculate effective rate                            *
     F*  ZSEDIT - Insert a decimal point and sign into a numeric field*
     F*           and to blank out leading zeros (optionally inserting*
     F*                                                      commas)  *
     F***ZSYSTM*-*Chain*to*the*installation*control*data*record********   S01117
     F*  ZTNLU1 - Determine next available transaction number         *
     F*                                                               *
     F*****************************************************************
      /EJECT
     E                    CPY@    1   1 80
     E/COPY ZSRSRC,ZPOWERZ1                                               S01269
     E/COPY ZSRSRC,ZPOWER8Z1
     E********************INF     1   1 76               WORKSTN MESSAGE  S01511
     E                    INF     1   2 76               WORKSTN MESSAGE  S01511
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY ZSRSRC,ZDAYSZ1
     E/COPY ZSRSRC,ZDATE6Z1
     E/COPY ZSRSRC,ZALIGNZ1
     E/COPY ZSRSRC,ZSEDITZ1
     E/COPY ZSRSRC,ZASIGNZ1
     E/COPY ZSRSRC,ZNCDZ1
     E                    ER1        19  4               ERROR MSGS.
     E                    ER2        19  4               ERROR MSGS.
     E                    ERR        40  4               ERR MSGS FOR HELP
     E**********          SCFM2X    325  1               2ND SCREENS01176 052254
     E                    SCFM2X    326  1               2ND SCREEN CMTTXT052254
     E/COPY ZSRSRC,ZHOLE                                                  S01195
     E                    STAMP   1   1 26                                                    CPK015
      ** Array containing dummy timestamp                                                     CPK015
      /EJECT
     I*
     ISECTYDF
     I*  Rename nominal currency
     I              NMCY                            NMCYA
     I/COPY WNCPYSRC,SE0090I001
     I*                                                                   067535
     I*  Rename portfolio reference                                       067535
     IBULKTDF                                                             067535
     I              PTFR                            XPTFR                 067535
     ITRADSDFX                                                            067535
     I              PTFR                            XPTFR                 067535
     IHSTTRDF                                                             067535
     I              PTFR                            XPTFR                 067535
     I*
     ISCRFM1      DS
     I*
     I*  D.S. to blank screen 1 input fields
     I                                        8  17 SSESN
     I                                       18  19 SSBOK
     I                                       20  21 SBBOK
     I                                       22  27 SSREF
     I                                       28  33 SBREF
     I                                       34  36 SSBRC
     I                                       37  39 SBBRC
     I                                       40  49 SDEPT                 E14574
     I                                       50  50 SINCS                 E14574
     I                                       51  62 SNOML                 E14574
     I                                       63  78 STPDY                 E14574
     I                                       79  84 STDVD                 E14574
     I                                       85  87 SORBR                 S01117
     I                                       88  91 SSPFR                 CPM004
     I                                       92  95 SBPFR                 CPM004
     I***********                            40  40 SINCS                 E14574
     I***********                            41  52 SNOML                 E14574
     I***********                            53  68 STPDY                 E14574
     I***********                            69  74 STDVD                 E14574
     I*
     I*  D.S. to blank screen 2 input fields
     I*
     ISCRFM2      DS
     I                                        1   2 STMKC
     I                                        3  12 SRALL
     I                                       13  29 SPRIC
     I                                       30  30 SEXDV
     I**********                             31  41 STCFC                 052254
     I**********                             42  42 STCAP                 052254
     I**********                             43  45 STDID                 052254
     I**********                             46  51 STDDT                 052254
     I**********                             52  53 STSUB                 052254
     I**********                             54  54 STDMI                 052254
     I**********                             55  55 SAIIP                 052254
     I**********                             56  90 STDNR                 052254
     I**********                             91  91 SACIN                 052254
     I**********                             92  96 SDADJ                 052254
     I**********                             97  97 SADIN                 052254
     I**********                             98 112 SITRA                 052254
     I**********                            113 125 SCPNR                 052254
     I**********                            126 127 STBCC                 052254
     I**********                            128 141 STBCA                 052254
     I**********                            142 143 STCCC                 052254
     I**********                            144 157 STCCA                 052254
     I**********                            158 159 STCC1                 052254
     I**********                            160 173 STCA1                 052254
     I**********                            174 175 STCC2                 052254
     I**********                            176 189 STCA2                 052254
     I**********                            190 191 STCC3                 052254
     I**********                            192 205 STCA3                 052254
     I************                          206 207 STOCC          S01176 052254
     I**********                            206 207 STCC4          S01176 052254
     I************                          208 221 STOCA          S01176 052254
     I**********                            208 221 STCA4          S01176 052254
     I************                          222 223 STLTC          S01176 052254
     I**********                            222 223 STCC5          S01176 052254
     I************                          224 237 STLTA          S01176 052254
     I**********                            224 237 STCA5          S01176 052254
     I**********                            238 239 STCC6          S01176 052254
     I**********                            240 253 STCA6          S01176 052254
     I**********                            254 255 STCC7          S01176 052254
     I**********                            256 269 STCA7          S01176 052254
     I**********                            270 283 STAXA          S01176 052254
     I**********                            284 297 SBCMR          S01176 052254
     I**********                            298 311 SCCMR          S01176 052254
     I**********                            312 325 STXRB          S01176 052254
     I**********                            326 329 SSPCCD         S01117 052254
     I**********                            330 333 SBPCCD         S01117 052254
     I                                       31  42 STCFC                 052254
     I                                       43  43 STCAP                 052254
     I                                       44  46 STDID                 052254
     I                                       47  52 STDDT                 052254
     I                                       53  54 STSUB                 052254
     I                                       55  55 STDMI                 052254
     I                                       56  56 SAIIP                 052254
     I                                       57  91 STDNR                 052254
     I                                       92  92 SACIN                 052254
     I                                       93  97 SDADJ                 052254
     I                                       98  98 SADIN                 052254
     I                                       99 113 SITRA                 052254
     I                                      114 126 SCPNR                 052254
     I                                      127 128 STBCC                 052254
     I                                      129 142 STBCA                 052254
     I                                      143 144 STCCC                 052254
     I                                      145 158 STCCA                 052254
     I                                      159 160 STCC1                 052254
     I                                      161 174 STCA1                 052254
     I                                      175 176 STCC2                 052254
     I                                      177 190 STCA2                 052254
     I                                      191 192 STCC3                 052254
     I                                      193 206 STCA3                 052254
     I                                      207 208 STCC4                 052254
     I                                      209 222 STCA4                 052254
     I                                      223 224 STCC5                 052254
     I                                      225 238 STCA5                 052254
     I                                      239 240 STCC6                 052254
     I                                      241 254 STCA6                 052254
     I                                      255 256 STCC7                 052254
     I                                      257 270 STCA7                 052254
     I                                      271 284 STAXA                 052254
     I                                      285 298 SBCMR                 052254
     I                                      299 312 SCCMR                 052254
     I                                      313 326 STXRB                 052254
     I                                      327 330 SSPCCD                052254
     I                                      331 334 SBPCCD                052254
      *                                                                                       CAS006
      *  D.S. to back up screen 2 input fields                                                CAS006
      *                                                                                       CAS006
     ISCR2BK      DS                                                                          CAS006
     I                                        1 256 WFLD1                                     CAS006
     I                                      257 334 WFLD2                                     CAS006
      *                                                                                       CAS006
      *  D.S. to blank screen 3 input fields                                                  CAS006
      *                                                                                       CAS006
     ISCRFM3      DS                                                                          CAS006
     I                                        1  17 SCRSK                                     CAS006
     I                                       18  34 SLQPR                                     CAS006
     I                                       35  49 SITRN                                     CAS006
     I                                       50  62 SNTCR                                     CAS006
     I                                       63  79 SPRICN                                    CAS006
      *                                                                                       CAS006
      *  D.S. to back up screen 3 input fields                                                CAS006
      *                                                                                       CAS006
     ISCR3BK      DS                                                                          CAS006
     I                                        1  17 WSCRSK                                    CAS006
     I                                       18  34 WSLQPR                                    CAS006
     I                                       35  49 WSITRN                                    CAS006
     I                                       50  62 WSNTCR                                    CAS006
     I                                       63  79 WSPRCN                                    CAS006
      *
     I****Data*structure*for*array*used*in*ZDATE5*                        S01195
     I*********** DS                                                      S01195
     I***********                             1  75 HCCY                  S01195
     I***********                             1  75 XCCY                  S01195
     I*
     I*  Local data area
     I***LDA*****   UDS                            256                    S01117
     I***********                           134 177 DBLOT                 S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 177 DBASE                 S01117
      *                                                                   S01117
     ILDA         DS                            256                       S01117
      *                                                                   S01117
      ** *LOCK IN LDA immediately before and OUT LDA immediately          S01117
      ** after each database error handling.                              S01117
      *                                                                   S01117
     I                                      134 183 DBLOT                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
      *                                                                   S01117
      ** Setup error message constant field                               S01117
      *                                                                   S01117
     I              'You must set up a Se-C         MSG1                  S01117
     I              'curities Customer fo-                                S01117
     I              'r the single branch.'                                S01117
     I*
     I*  Date structure used in ZSEDIT routine
     I/COPY ZSRSRC,ZSEDITZ2
     I*
     I*  Data structure to update last transaction no.
     I/COPY ZSRSRC,ZTNLU1Z1
     I/COPY ZSRSRC,ZNCDZ2
     I/COPY ZSRSRC,ZYLDZ1
     I*
     IPSDS       SDS
     I*                                                                   S01408
     I/COPY WNCPYSRC,SE0090IIP2                                           S01408
     I*                                                                   S01408
     I                                      244 246 WSID
     I                                      254 263 USRID
     I*
     I*  Data structure to provide text on COMIT entry in journal
     ICMTTXT      DS
     I                                        1   50NATN
     I                                        6   7 MDID
     I                                        8  15 DBPGMX
     I                                       16  18 WSIDX
     I                                       19  240MTIME
     I                                       25  25 ACTCD
     I                                       26  35 USRIDX
     I                                       51 124 SCFM1X
     I************                          125 361 SCFM2X                S01176
     I************                          125 449 SCFM2X         S01176 052254
     I                                      125 450 SCFM2X                052254
     IINFDS       DS
     I                                     *STATUS  STATUS
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
      *                                                                   S01195
      ** Data structure for holiday processing.                           S01195
      *                                                                   S01195
     I/COPY ZSRSRC,ZHOLI                                                  S01195
      *
     IRUNDT       DS                                                      S01117
      *                                                                   S01117
      ** RUNDAT data area                                                 S01117
      *                                                                   S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
      *                                                                   S01117
     IZMUSER      DS                             17                       S01117
      *                                                                   S01117
      ** Menu user data area                                              S01117
      *                                                                   S01117
     I                                       11  13 DFTBRC                S01117
     I                                       17  17 BANKAU                S01117
     I/COPY WNCPYSRC,SE0090I002
      *                                                                   S01117
     ISDBANK    E DSSDBANKPD                                              S01117
      *                                                                   S01117
      ** Bank Details                                                     S01117
      *                                                                   S01117
     ISDBOOK    E DSSDBOOKPD                                              S01117
      *                                                                   S01117
      ** Book Details                                                     S01117
      *                                                                   S01117
     ISDBRCH    E DSSDBRCHPD                                              S01117
      *                                                                   S01117
      ** Branch Details                                                   S01117
      *                                                                   S01117
     ISDCOMP    E DSSDCOMPPD                                              S01117
      *                                                                   S01117
      ** Company Details                                                  S01117
      *                                                                   S01117
     ISDCURR    E DSSDCURRPD                                              S01117
      *                                                                   S01117
      ** Currency Details                                                 S01117
      *                                                                   S01117
     ISDCUST    E DSSDCUSTPD                                              S01117
     I              QQDFAC                          DFACQQ                                    CGL029
      *                                                                   S01117
      ** Customer Details                                                 S01117
      *                                                                   S01117
     ISDDLST    E DSSDDLSTPD                                              S01117
      *                                                                   S01117
      ** Deal Sub-type Details                                            S01117
      *                                                                   S01117
     ISDGELR    E DSSDGELRPD                                              S01117
      *                                                                   S01117
      ** General Ledger Details                                           S01117
      *                                                                   CPM004
     ISDMMOD    E DSSDMMODPD                                              CPM004
      *                                                                   CPM004
      ** Midas Modules                                                    CPM004
      *                                                                   CPM004
     ISDPLCS    E DSSDPLCSPD                                              CPM004
      *                                                                   CPM004
      ** Portfolio Customers                                              CPM004
      *                                                                   CPM004
     ISDPORT    E DSSDPORTPD                                              CPM004
      *                                                                   CPM004
      ** Portfolio Management                                             CPM004
      *                                                                   S01117
     ISDPRFC    E DSSDPRFCPD                                              S01117
      *                                                                   S01117
      ** Profit Centres                                                   S01117
      *                                                                   S01117
     ISDSECS    E DSSDSECSPD                                              S01117
     I              QQACCD                          ACCDQQ                                    CGL029
      *                                                                   S01117
      ** Securities Customers                                             S01117
      *                                                                   S01117
     ISDSTRD    E DSSDSTRDPD                                              S01117
      *                                                                   S01117
      ** Securities Trading Data                                          S01117
      *                                                                   S01117
     ISCSARD    E DSSCSARDPD                                              S01509
     I*                                                                   S01509
     I** SAR file                                                         S01509
     I*                                                                   S01509
     IDSFDY     E DSDSFDY                                                 S01117
      *                                                                   S01117
      ** Short data structure for access programs (200 long)              S01117
      *                                                                   S01117
     IDSSDY     E DSDSSDY                                                 S01117
      *                                                                   S01117
      ** Long data structure for access programs (800 long)               S01117
      *                                                                   S01117
      *                                                                   S01408
     I/COPY WNCPYSRC,SE0090IIP1                                           S01408
      *                                                                   S01408
     C/EJECT
      *===============================================================*
      *  P R O G R A M   S T A R T                                    *
      *===============================================================*
     C*
     C                     MOVEACPY@      CPY2@  80
     C*
     C*
     C*  Initialisation routine
     C*
     C                     EXSR BAINIT
     C*
     C*  Mainline processing
     C*
     C                     EXSR BBMAIN
     C*
      *===============================================================*
      *  P R O G R A M   E N D                                        *
      *                                                               *
     C                     SETON                     LR
     C                     RETRN
      *                                                               *
      *===============================================================*
      /EJECT
      *****************************************************************
      *                                                               *
      *  BAINIT - Program Initialisation                              *
      *                                                               *
      *****************************************************************
      *
     C           BAINIT    BEGSR                           *** BAINIT ***
     C**********                                                          S01117
     C**Define*key list for file CLINT                                    S01117
     C**********                                                          S01117
     C********** KLCLNT    KLIST                                          S01117
     C**********           KFLD           CNUM                            S01117
     C**********           KFLD           RCDT                            S01117
     C*
     C* Define key list for file BKPHD
     C*
     C           KLBKPH    KLIST
     C                     KFLD           BHSC
     C***********          KFLD           BHBR                            S01117
     C                     KFLD           BHBA                            S01117
     C                     KFLD           BHBK
     C                     KFLD           BHMK
     C                     KFLD           BHTV
     C*
     C* Define key list for file BKPOS
     C*
     C           KLBKPS    KLIST
     C                     KFLD           BPSC
     C***********          KFLD           BPBR                            S01117
     C                     KFLD           BPBA                            S01117
     C                     KFLD           BPBK
     C                     KFLD           BPMK
     C                     KFLD           BPTV
     C                     KFLD           BPPD
     C**Define*key*list*for*file*SECHG*********************************   S01169
     C* Define key list for file SECGT                                    S01169
     C*
     C***********KLSECH    KLIST                                          S01169
     C           KLSECG    KLIST                                          S01169
     C                     KFLD           CCY
     C                     KFLD           CCOM
     C*
     C* Define key list for file SECED non-diary events
     C*
     C           KLSNDE    KLIST
     C                     KFLD           SNSN
     C                     KFLD           SNDT
     C                     KFLD           SNET
     C*
     C* Define key list for file SECED diary events
     C*
     C           KLSEDE    KLIST
     C                     KFLD           SDSN
     C                     KFLD           SDED
     C                     KFLD           SDET
     C*
     C           KLEVD     KLIST
     C                     KFLD           SDSN
     C                     KFLD           SDET
     C                     KFLD           SDED
     C*
     C* Define key list for file INVTP
     C*
     C           KLINVT    KLIST
     C                     KFLD           CCYI
     C                     KFLD           INVT
      *                                                                   E14574
      ***  Define key lists for file UDEPP                                E14574
      *                                                                   E14574
     C           SDPKEY    KLIST                                          E14574
     C                     KFLD           WSBRC                           E14574
     C                     KFLD           SSESN                           E14574
     C**********           KFLD           WDEPT   60                                   E14574 CSD027
     C                     KFLD           WDEPT   6                                           CSD027
     C***********          KFLD           SSBOK                    E14574 CAC005
     C                     KFLD           KSBOK   2                       CAC005
     C                     KFLD           STDMI                           E14574
      *                                                                   E14574
     C           BDPKEY    KLIST                                          E14574
     C                     KFLD           WBBRC                           E14574
     C                     KFLD           SSESN                           E14574
     C                     KFLD           WDEPT                           E14574
     C***********          KFLD           SBBOK                    E14574 CAC005
     C                     KFLD           KBBOK   2                       CAC005
     C                     KFLD           STDMI                           E14574
      *                                                                   S01117
      ** Define key list for SEPCBD                                       S01117
      *                                                                   S01117
     C           SPCKEY    KLIST                                          S01117
     C                     KFLD           SSBOK                           S01117
     C                     KFLD           SSBRC                           S01117
     C                     KFLD           SSESN                           S01117
     C                     KFLD           STDMI                           S01117
      *                                                                   S01117
     C           BPCKEY    KLIST                                          S01117
     C                     KFLD           SBBOK                           S01117
     C                     KFLD           SBBRC                           S01117
     C                     KFLD           SSESN                           S01117
     C                     KFLD           STDMI                           S01117
     C*                                                                   E27915
     C** KLIST for Prices file                                            E27915
     C*                                                                   E27915
     C           KPRICM    KLIST                                          E27915
     C                     KFLD           PSSN                            E27915
     C                     KFLD           PVDT                            E27915
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0090CCP9                                           S01408
     C*                                                                   S01408
     C** KLIST for Portfolio Definition Details File                      CPM004
     C*                                                                   CPM004
     C           KPORTD    KLIST                                          CPM004
     C**********           KFLD           KCNUM   60                                   CPM004 CSD027
     C                     KFLD           KCNUM   6                                           CSD027
     C                     KFLD           KPTFR   4                       CPM004
     C*                                                                   CPM004
     C           KHSEXC    KLIST                                          CPM004
     C                     KFLD           KHCCY   3                       CPM004
     C                     KFLD           TDDT                            CPM004
      *
      ****  Prepare LDA / COMIT text
      *
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE *BLANKS   DBLOT
     C                     MOVEL'SE0090'  DBPGM
     C                     MOVE 'I'       ACTCD
     C                     MOVE DBPGM     DBPGMX
     C                     MOVE WSID      WSIDX
     C                     MOVE USRID     USRIDX
     C                     OUT  LDA                                       S01117
     C*
     C* Define fields
     C*
     C           *LIKE     DEFN TDRF      WSREF
     C           *LIKE     DEFN TDRF      WBREF
     C           *LIKE     DEFN STDVD     SAVVD
     C           *LIKE     DEFN STMKC     SAVMC
     C           *LIKE     DEFN STDDT     SAVTD
     C           *LIKE     DEFN STSUB     SAVTS
     C           *LIKE     DEFN STDMI     SAVMI
     C           *LIKE     DEFN SAIIP     SAVAI
     C           *LIKE     DEFN SEXDV     SAVEX
     C           *LIKE     DEFN SPRIC     SAVPR
     C           *LIKE     DEFN STPDY     SAVPD
     C           *LIKE     DEFN SACIN     SAVAC
     C           *LIKE     DEFN SDADJ     SAVDA
     C           *LIKE     DEFN SADIN     SAVAD
     C           *LIKE     DEFN SITRA     SAVIT
     C************LIKE     DEFN SCPNR     SAVCR                           E20522
     C************LIKE     DEFN SACIN     SAVC2
     C************LIKE     DEFN SDADJ     SAVD2
     C************LIKE     DEFN SADIN     SAVA2
     C************LIKE     DEFN SCPNR     SAVR2
     C           *LIKE     DEFN STDDT     SAVT2
     C           *LIKE     DEFN STDVD     SAVV2
     C************LIKE     DEFN RPMD      RCAL                            S01117
     C           *LIKE     DEFN BVREDE    RCAL                            S01117
     C           *LIKE     DEFN TNLU      SAVST
     C           *LIKE     DEFN TNLU      SAVBT
     C           *LIKE     DEFN WSDNM     SNWORK
     C           *LIKE     DEFN ITRA      ORGIT
     C           *LIKE     DEFN TDCR      WTDCR                                               CAS006
     C           *LIKE     DEFN ITRN      WITRN                                               CAS006
     C           *LIKE     DEFN ZTINA     WTINA                                               CAS006
     C           *LIKE     DEFN ZTINA     WTINN                                               CAS006
     C           *LIKE     DEFN ZITRA     WITRA                                               CAS006
     C           *LIKE     DEFN APPB      APWRK1
     C           *LIKE     DEFN APPB      APWRK2
     C************LIKE     DEFN BICN      BBICN                           S01117
     C************LIKE     DEFN BICN      SBICN                           S01117
     C           *LIKE     DEFN A8BICN    BBICN                           S01117
     C           *LIKE     DEFN A8BICN    SBICN                           S01117
     C************LIKE     DEFN ZSDATE    WPDAT                           E20085
     C************LIKE     DEFN ZEDATE    WADAT                           E20085
     C************LIKE     DEFN DSTB      WSBRC                           S01117
     C************LIKE     DEFN DSTB      WBBRC                           S01117
     C           *LIKE     DEFN DFTBRC    WSBRC                           S01117
     C           *LIKE     DEFN DFTBRC    WBBRC                           S01117
     C           *LIKE     DEFN WNOML     WCONS
     C           *LIKE     DEFN WNOML     WRALL
     C           *LIKE     DEFN WNOML     WCHRG
     C           *LIKE     DEFN WNOML     WCOMM
     C************LIKE     DEFN RUND      WBKVP                           S01117
     C           *LIKE     DEFN RUND      WBVP                            S01117
     C************LIKE     DEFN ITRA      WPINT                           E20085
     C           *LIKE     DEFN PRIC      WPRIC
     C************LIKE     DEFN CDP       NOMDP                           S01117
     C           *LIKE     DEFN A6NBDP    NOMDP                           S01117
     C************LIKE     DEFN C1DI      SC1DI                           S01117
     C************LIKE     DEFN C1DI      BC1DI                           S01117
     C           *LIKE     DEFN BFCLAS    SCLAS                           S01117
     C           *LIKE     DEFN BFCLAS    BCLAS                           S01117
     C           *LIKE     DEFN NORE      BKNOR
     C           *LIKE     DEFN NORE      BSNOR
     C           *LIKE     DEFN C1        WEC
     C           *LIKE     DEFN TBCR      WBSR                            E34912
     C************LIKE     DEFN CNUM      WCNUM                     E14574S01117
     C***********                                                         S01117
     C**Get*Installation*Control*Data*record*1*                           S01117
     C***********                                                         S01117
     C***********          EXSR ZSYSTM                                    S01117
     C***********                                                         S01117
     C**If*error*in ZSYSTM, abort program                                 S01117
     C***********                                                         S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          MOVE '01'      DBASE            ***************S01117
     C***********          MOVEL'TABLE'   DBFILE           * DB ERROR 01 *S01117
     C***********          MOVELZTABKY    DBKEY            ***************S01117
     C***********          SETON                     U7U801               S01117
     C***********          ELSE                                           S01117
     C***********                                                         S01117
     C**Get*Installation*Control*Data*record*2*                           S01117
     C***********                                                         S01117
     C***********          EXSR ZICD2                                     S01117
     C***********                                                         S01117
     C**If*error*in*ZICD2,*abort*program*                                 S01117
     C***********                                                         S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          MOVE '02'      DBASE            ***************S01117
     C***********          MOVEL'TABLE'   DBFILE           * DB ERROR 02 *S01117
     C***********          MOVELZTABKY    DBKEY            ***************S01117
     C***********          SETON                     U7U801               S01117
     C***********          ELSE                                           S01117
     C***********                                                         S01117
     C**Get*Installation*Control*Data*record*3*                           S01117
     C***********                                                         S01117
     C***********          EXSR ZICDSE                                    S01117
     C***********                                                         S01117
     C**If*error*in*ZICDSE,*abort*program*                                S01117
     C***********                                                         S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          MOVE '03'      DBASE            ***************S01117
     C***********          MOVEL'TABLE'   DBFILE           * DB ERROR 03 *S01117
     C***********          MOVELZTABKY    DBKEY            ***************S01117
     C***********          SETON                     U7U801               S01117
     C***********          END                                            S01117
     C***********          END                                            S01117
     C***********          END                                            S01117
      *                                                                   S01117
      ** Read in RUNDAT data area                                         S01117
      *                                                                   S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C                     IN   RUNDT                                     S01117
      *                                                                   S01117
      ** Check system date format, DDMMYY or MMDDYY.                      S01117
      *                                                                   S01117
     C           DATF      COMP 'M'                      98               S01117
      *                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     SETON                         20               S01117
     C                     END                                            S01117
      *                                                                   S01117
      ** Read in ZMUSER data area                                         S01117
      *                                                                   S01117
     C           *NAMVAR   DEFN           ZMUSER                          S01117
     C                     IN   ZMUSER                                    S01117
      *                                                                   S01117
      ** Access bank details                                              S01117
      *                                                                   S01117
     C                     CALL 'AOBANKR0'                                S01117
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C           SDBANK    PARM SDBANK    DSFDY                           S01117
      *                                                                   S01117
      ** Access Securities Trading details                                S01117
      *                                                                   S01117
     C                     CALL 'AOSTRDR0'                                S01117
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C           SDSTRD    PARM SDSTRD    DSSDY                           S01117
      *                                                                   S01117
      ** If Auto-charges is present set-on  *IN42                         S01176
      *                                                                   S01176
     C***********AUMO      IFEQ 'Y'                                 S01176S01117
     C           BVACOP    IFEQ 'Y'                                       S01117
     C                     SETON                     42                   S01176
     C                     END                                            S01176
      *                                                                   S01117
      ** Access General Ledger details                                    S01117
      *                                                                   S01117
     C**********           CALL 'AOGELRR0'                                             S01117 CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C********** SDGELR    PARM SDGELR    DSFDY                                        S01117 CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
      *                                                                   S01117
      ** If Originating Branch used set-on *IN19                          S01117
      *                                                                   S01117
     C           BKOBRU    IFEQ 'Y'                                       S01117
     C                     MOVE '1'       *IN,19                          S01117
     C                     END                                            S01117
      *                                                                   S01117
      ** If Profit Centres used set-on *IN29                              S01117
      *                                                                   S01117
     C           BKPRCU    IFEQ 'Y'                                       S01117
     C                     MOVE '1'       *IN,29                          S01117
     C                     END                                            S01117
      *                                                                   S01117
      ** If single branch environment and single branch is not a          S01117
      ** securities customer with classification of 'I' then error.       S01117
      *                                                                   S01117
     C           MBIN      IFEQ 'N'                                       S01117
      *                                                                   S01117
      ** Access branch codes file SDBRCHPD via access object program      S01117
      ** for branch internal customer number                              S01117
      *                                                                   S01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*DBERR'  @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM DFTBRC    @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *                                                                   S01117
      ** Access securities clients details                                S01117
      *                                                                   S01117
     C                     CALL 'AOSECSR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM A8BICN    @AENB   6                       S01117
     C           SDSECS    PARM SDSECS    DSSDY                           S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C           BFCLAS    ORNE 'I'                                       S01117
     C                     MOVE '1'       @TEST   1                       S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C/COPY WNCPYSRC,SE0090C008
      *                                                                   CSE010
      ** Check if CSE010 (Transaction Enhancements) is active             CSE010
      *                                                                   CSE010
     C                     CALL 'AOSARDR0'                                CSE010
     C                     PARM '       ' @RTCD                           CSE010
     C                     PARM '*VERIFY' @OPTN                           CSE010
     C                     PARM 'CSE010'  @SARD   6                       CSE010
      *                                                                   CSE010
     C           @RTCD     IFEQ *BLANK                                    CSE010
     C                     MOVE 'Y'       CSE010  1                       CSE010
     C                     ELSE                                           CSE010
     C                     MOVE 'N'       CSE010                          CSE010
      *                                                                   CSE010
      ** Database Error (return code other than *NRF)                     CSE010
      *                                                                   CSE010
     C           @RTCD     IFNE '*NRF   '                                 CSE010
     C           *LOCK     IN   LDA                                       CSE010
     C                     MOVEL'SCSARDPD'DBFILE           ***************CSE010
     C                     MOVEL'CSE010'  DBKEY            * DB ERROR 22 *CSE010
     C                     Z-ADD22        DBASE            ***************CSE010
     C                     OUT  LDA                                       CSE010
     C                     MOVE *ON       *INU7                           CSE010
     C                     MOVE *ON       *INU8                           CSE010
     C                     MOVE *ON       *INLR                           CSE010
     C                     EXSR *PSSR                                     CSE010
     C                     ENDIF                                          CSE010
     C                     ENDIF                                          CSE010
     C*                                                                   S01509
     C** Check if S01509 (Value Ccy to be ccy of Issuer of Payments)      S01509
     C** is active                                                        S01509
     C*                                                                   S01509
     C                     CALL 'AOSARDR0'                                S01509
     C                     PARM *BLANKS   @RTCD                           S01509
     C                     PARM '*VERIFY' @OPTN                           S01509
     C                     PARM 'S01509'  @SARD   6                       S01509
     C*                                                                   S01509
     C           @RTCD     IFEQ *BLANK                                    S01509
     C                     MOVE 'Y'       S01509  1                       S01509
     C                     ELSE                                           S01509
     C                     MOVE 'N'       S01509                          S01509
     C*                                                                   S01509
     C** database error (return code other than *NRF)                     S01509
     C*                                                                   S01509
     C           @RTCD     IFNE '*NRF   '                                 S01509
     C           *LOCK     IN   LDA                                       S01509
     C                     MOVEL'SCSARDPD'DBFILE           ***************S01509
     C                     MOVEL'*VERIFY' DBKEY            * DB ERROR 16 *S01509
     C                     Z-ADD16        DBASE            ***************S01509
     C                     OUT  LDA                                       S01509
     C                     SETON                     U7U801               S01509
     C                     EXSR *PSSR                                     S01509
     C                     END                                            S01509
     C                     END                                            S01509
     C*                                                                   S01510
     C** Check if S01510 (Dividend Payments) is active)                   S01510
     C*                                                                   S01510
     C                     CALL 'AOSARDR0'                                S01510
     C                     PARM *BLANKS   @RTCD                           S01510
     C                     PARM '*VERIFY' @OPTN                           S01510
     C                     PARM 'S01510'  @SARD                           S01510
     C*                                                                   S01510
     C           @RTCD     IFEQ *BLANK                                    S01510
     C                     MOVE 'Y'       S01510  1                       S01510
     C                     ELSE                                           S01510
     C                     MOVE 'N'       S01510                          S01510
     C*                                                                   S01510
     C** else, database error (return code other than *NRF)               S01510
     C*                                                                   S01510
     C           @RTCD     IFNE '*NRF   '                                 S01510
     C           *LOCK     IN   LDA                                       S01510
     C                     MOVEL'SCSARDPD'DBFILE           ***************S01510
     C                     MOVEL'*VERIFY' DBKEY            * DB ERROR 17 *S01510
     C                     Z-ADD17        DBASE            ***************S01510
     C                     OUT  LDA                                       S01510
     C                     SETON                     U7U801               S01510
     C                     EXSR *PSSR                                     S01510
     C                     END                                            S01510
     C                     END                                            S01510
     C*                                                                   S01511
     C** Check if S01511 (Market Migration) is active)                    S01511
     C*                                                                   S01511
     C                     CALL 'AOSARDR0'                                S01511
     C                     PARM *BLANKS   @RTCD                           S01511
     C                     PARM '*VERIFY' @OPTN                           S01511
     C                     PARM 'S01511'  @SARD                           S01511
     C*                                                                   S01511
     C           @RTCD     IFEQ *BLANK                                    S01511
     C                     MOVE 'Y'       S01511  1                       S01511
     C                     ELSE                                           S01511
     C                     MOVE 'N'       S01511                          S01511
     C*                                                                   S01511
     C** database error (return code other than *NRF)                     S01511
     C*                                                                   S01511
     C           @RTCD     IFNE '*NRF   '                                 S01511
     C           *LOCK     IN   LDA                                       S01511
     C                     MOVEL'SCSARDPD'DBFILE           ***************S01511
     C                     MOVEL'*VERIFY' DBKEY            * DB ERROR 18 *S01511
     C                     Z-ADD18        DBASE            ***************S01511
     C                     OUT  LDA                                       S01511
     C                     SETON                     U7U801               S01511
     C                     EXSR *PSSR                                     S01511
     C                     END                                            S01511
     C                     END                                            S01511
      *                                                                   CSW003
      **  Access Switchable features file for MT5xx processing - S01401   CSW003
      *                                                                   CSW003
     C                     CALL 'AOSARDR0'                                CSW003
     C                     PARM '       ' @RTCD                           CSW003
     C                     PARM '*VERIFY' @OPTN                           CSW003
     C                     PARM 'S01401'  @SARD   6                       CSW003
     C*                                                                   CSW003
     C           @RTCD     IFEQ *BLANK                                    CSW003
     C                     MOVE 'Y'       S01401  1                       CSW003
     C                     OPEN TRADSDX1                                  CSW003
     C                     OPEN TRADSDX2                                  BUG2582
     C                     END                                            CSW003
     C*                                                                   CSW003
     C** Check if CSW003 is on                                            CSW003
     C*                                                                   CSW003
     C                     CALL 'AOSARDR0'                                CSW003
     C                     PARM *BLANKS   @RTCD                           CSW003
     C                     PARM '*VERIFY' @OPTN                           CSW003
     C                     PARM 'CSW003'  @SARD                           CSW003
     C*                                                                   CSW003
     C           @RTCD     IFEQ *BLANK                                    CSW003
     C                     MOVE 'Y'       CSW003  1                       CSW003
     C                     END                                            CSW003
     C*                                                                   CPM004
     C**  Access Midas Modules file                                       CPM004
     C                     CALL 'AOMMODR0'                                CPM004
     C                     PARM '*DBERR ' @RTCD   7                       CPM004
     C                     PARM '*FIRST ' @OPTN   7                       CPM004
     C           SDMMOD    PARM SDMMOD    DSFDY                           CPM004
     C*
     C**   Set ON  *IN06 if Analytical Accounting is on.                  CAC002
     C*                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE *ON       *IN06                           CAC002
     C                     ELSE                                           CAC002
     C                     MOVE *OFF      *IN06                           CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   CPM004
     C           BGPFMG    IFEQ 'Y'                                       CPM004
     C*                                                                   CPM004
     C                     OPEN PMPORTPD                                  CPM004
     C                     OPEN PMHSEXPD                                  CPM004
     C*                                                                   CPM004
     C                     CALL 'AOPORTR0'                                CPM004
     C                     PARM '*DBERR ' @RTCD   7                       CPM004
     C                     PARM '*FIRST ' @OPTN   7                       CPM004
     C           SDPORT    PARM SDPORT    DSFDY                           CPM004
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C                     MOVE *ON       *IN09                           CPM004
     C                     ENDIF                                          CPM004
     C*                                                                   CPM004
     C                     ENDIF                                          CPM004
     C*
     C***Get*Event*Control*Date****************************************   E20085
     C***********                                                         E20085
     C***********          EXSR ZEVCD                                     E20085
      *                                                                                       CSE035
      ** Access SAR details file to see if CSE035 is installed                                CSE035
      *                                                                                       CSE035
     C                     CALL 'AOSARDR0'                                                    CSE035
     C                     PARM *BLANKS   @RTCD                                               CSE035
     C                     PARM '*VERIFY' @OPTN                                               CSE035
     C                     PARM 'CSE035'  @SARD                                               CSE035
      *                                                                                       CSE035
     C           @RTCD     IFEQ *BLANK                                                        CSE035
     C                     MOVE 'Y'       CSE035  1                                           CSE035
     C                     ELSE                                                               CSE035
     C                     MOVE 'N'       CSE035                                              CSE035
      *                                                                                       CSE035
      ** database error (return code other than *NRF)                                         CSE035
      *                                                                                       CSE035
     C           @RTCD     IFNE '*NRF   '                                                     CSE035
     C           *LOCK     IN   LDA                                                           CSE035
     C                     MOVEL'SCSARDPD'DBFILE           ***************                    CSE035
     C                     MOVEL'*VERIFY' DBKEY            * DB ERROR 23 *                    CSE035
     C                     Z-ADD23        DBASE            ***************                    CSE035
     C                     OUT  LDA                                                           CSE035
     C                     SETON                     U7U801                                   CSE035
     C                     EXSR *PSSR                                                         CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       207543
      ** Access SAR details file to see if CEU018 is installed                                207543
      *                                                                                       207543
     C                     CALL 'AOSARDR0'                                                    207543
     C                     PARM *BLANKS   @RTCD                                               207543
     C                     PARM '*VERIFY' @OPTN                                               207543
     C                     PARM 'CEU018'  @SARD                                               207543
      *                                                                                       207543
     C           @RTCD     IFEQ *BLANK                                                        207543
     C                     MOVE 'Y'       CEU018  1                                           207543
     C                     ELSE                                                               207543
     C                     MOVE 'N'       CEU018                                              207543
     C                     ENDIF                                                              207543
      *                                                                                       CSE035
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0090CCPG                                           S01408
     C*                                                                   S01408
      ***  Access switchable Sar CSE007                                   CSE007
      *                                                                   CSE007
     C                     MOVE 'N'       CSE007  1                       CSE007
     C                     CALL 'AOSARDR0'                                CSE007
     C                     PARM '       ' @RTCD                           CSE007
     C                     PARM '*VERIFY' @OPTN                           CSE007
     C                     PARM 'CSE007'  @SARD                           CSE007
      *                                                                   CSE007
     C           @RTCD     IFEQ *BLANK                                    CSE007
     C                     MOVE 'Y'       CSE007                          CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
      ***  Access switchable Sar CEU017                                   CEU017
      *                                                                   CEU017
     C                     MOVE 'N'       CEU017  1                       CEU017
     C                     CALL 'AOSARDR0'                                CEU017
     C                     PARM '       ' @RTCD                           CEU017
     C                     PARM '*VERIFY' @OPTN                           CEU017
     C                     PARM 'CEU017'  @SARD                           CEU017
      *                                                                   CEU017
     C           @RTCD     IFEQ *BLANK                                    CEU017
     C                     MOVE 'Y'       CEU017                          CEU017
     C                     ENDIF                                          CEU017
      *                                                                   CAC005
      ** Check if CAC005 is installed                                     CAC005
      *                                                                   CAC005
     C                     CALL 'AOSARDR0'                                CAC005
     C                     PARM *BLANKS   PRTCD   7                       CAC005
     C                     PARM '*VERIFY' POPTN   7                       CAC005
     C                     PARM 'CAC005'  PSARD   6                       CAC005
      *                                                                   CAC005
     C           PRTCD     IFEQ *BLANK                                    CAC005
     C                     MOVE 'Y'       CAC005  1                       CAC005
     C                     ELSE                                           CAC005
     C                     MOVE 'N'       CAC005                          CAC005
     C                     ENDIF                                          CAC005
      *                                                                                       CSE037
      ** Determine if CAS006 is installed.                                                    CAS006
      *                                                                                       CAS006
     C                     CALL 'AOSARDR0'                                                    CAS006
     C                     PARM *BLANKS   PRTCD                                               CAS006
     C                     PARM '*VERIFY' POPTN                                               CAS006
     C                     PARM 'CAS006'  PSARD                                               CAS006
      *                                                                                       CAS006
     C           PRTCD     IFEQ *BLANK                                                        CAS006
     C                     MOVE 'Y'       CAS006  1                                           CAS006
     C                     ELSE                                                               CAS006
     C                     MOVE 'N'       CAS006                                              CAS006
      *                                                                                       CAS006
      ** Process database error.                                                              CAS006
      *                                                                                       CAS006
     C           PRTCD     IFNE '*NRF   '                                                     CAS006
     C           *LOCK     IN   LDA                                                           CAS006
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS006
     C                     MOVEL'CAS006 ' DBKEY                                               CAS006
     C                     Z-ADD23        DBASE                                               CAS006
     C                     OUT  LDA                                                           CAS006
     C                     MOVE *ON       *INU7                                               CAS006
     C                     MOVE *ON       *INU8                                               CAS006
     C                     MOVE *ON       *IN01                                               CAS006
     C                     EXSR *PSSR                                                         CAS006
     C                     ENDIF                                                              CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
      ** Access SAR details file to see if CSE037 is installed                                CSE037
      *                                                                                       CSE037
     C                     CALL 'AOSARDR0'                                                    CSE037
     C                     PARM *BLANKS   @RTCD                                               CSE037
     C                     PARM '*VERIFY' @OPTN                                               CSE037
     C                     PARM 'CSE037'  @SARD                                               CSE037
      *                                                                                       CSE037
     C           @RTCD     IFEQ *BLANK                                                        CSE037
     C                     MOVE 'Y'       CSE037  1                                           CSE037
     C                     ELSE                                                               CSE037
     C                     MOVE 'N'       CSE037                                              CSE037
     C                     ENDIF                                                              CSE037
      *                                                                                     MD057247
      ** Access Switchable Features file to determine if CSE031 is                          MD057247
      ** installed in the system.                                                           MD057247
      *                                                                                     MD057247
     C                     CALL 'AOSARDR0'                                                  MD057247
     C                     PARM           URTNCD  7                                         MD057247
     C                     PARM '*VERIFY' UOPTN   7                                         MD057247
     C                     PARM 'CSE031'  UUKEY   6                                         MD057247
     C                     PARM           UDSFDY 76                                         MD057247
      *                                                                                     MD057247
     C                     MOVE 'N'       CSE031  1                                         MD057247
     C           URTNCD    IFEQ *BLANKS                                                     MD057247
     C                     MOVE 'Y'       CSE031                                            MD057247
     C                     ENDIF                                                            MD057247
      *                                                                                     MD057247
      ** Access Switchable Features file to determine if CSE071 is                          MD057247
      ** installed in the system.                                                           MD057247
      *                                                                                     MD057247
     C                     CALL 'AOSARDR0'                                                  MD057247
     C                     PARM           URTNCD                                            MD057247
     C                     PARM '*VERIFY' UOPTN                                             MD057247
     C                     PARM 'CSE071'  UUKEY                                             MD057247
     C                     PARM           UDSFDY                                            MD057247
      *                                                                                     MD057247
     C                     MOVE 'N'       CSE071  1                                         MD057247
     C           URTNCD    IFEQ *BLANKS                                                     MD057247
     C                     MOVE 'Y'       CSE071                                            MD057247
     C                     ENDIF                                                            MD057247
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  BBMAIN - Main Processing                                     *
      *                                                               *
      *****************************************************************
      *
     C           BBMAIN    BEGSR                           *** BBMAIN ***
     C*
     C*  Perform main processing until F3 taken..
     C*
      *                                                                                       CAS006
      ** If CAS006 is on, initialise screen 2 flag.                                           CAS006
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     MOVE *OFF      WSCRN2  1                                           CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C           *IN01     DOWEQ'0'
     C****************************************************************                        CAS006
     C*****Initialise*screen*format*1*********************************                        CAS006
     C****************************************************************                        CAS006
     C**********           MOVE *BLANKS   SCRFM1                                              CAS006
     C*
     C*  .. Reset indicators
     C*
     C                     MOVE *BLANKS   SAVPD
     C                     MOVE *BLANKS   ER1
     C                     MOVE *BLANKS   ER2
     C                     MOVE *BLANKS   ER2MSG
     C                     Z-ADD0         C1      20
     C                     Z-ADD0         C2      20
     C                     Z-ADD0         WEC
     C***********          MOVE '0'       *IN48                    E14574 E20386
     C                     MOVE '0'       *IN33                           E20386
     C                     MOVEA'00000000'*IN,50
     C                     MOVEA'000'     *IN,58
     C                     MOVEA'000000'  *IN,10
     C                     SETOF                     40
     C                     MOVEA'000'     *IN,16                          S01117
     C           @TEST     IFEQ '1'                                       S01117
     C                     MOVEAMSG1      ER1                             S01117
     C                     MOVEA'101'     *IN,38                          S01117
     C                     END                                            S01117
     C*
     C*    Process screen format 1
     C*
      *                                                                                       CAS006
      ** If CAS006 is on, skip processing of 1st detail screen                                CAS006
      ** if user is returning to 2nd screen from 3rd screen.                                  CAS006
      *                                                                                       CAS006
     C           CAS006    IFNE 'Y'                                                           CAS006
     C           WSCRN2    OREQ *OFF                                                          CAS006
      *                                                                                       CAS006
      ** Initialise screen format 1 and back up DS                                            CAS006
      *                                                                                       CAS006
     C                     MOVE *BLANKS   SCRFM1                                              CAS006
     C                     MOVE *BLANKS   SCR2BK                                              CAS006
     C                     MOVE *BLANKS   SCR3BK                                              CAS006
      *                                                                                       CAS006
     C                     EXSR D1PROC
     C                     ENDIF                                                              CAS006
     C*
     C*    Initialise screen format 2 if not F12
     C*
     C           *IN01     IFNE '1'
     C           *IN05     ANDNE'1'
     C           CAS006    OREQ 'Y'                                                           CAS006
     C           WSCRN2    ANDEQ*ON                                                           CAS006
     C           *IN01     ANDNE*ON                                                           CAS006
     C           *IN05     ANDEQ*ON                                                           CAS006
     C                     EXSR D2INIT
     C*
     C*    Process screen format 2 if not F12
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0090CP22                                           S01408
     C*                                                                   S01408
     C                     EXSR D2PROC
     C*
      ** If CAS006 is on, turn off flag for 2nd screen so an F12 by                           CAS006
      ** the user would return to the 1st screen.                                             CAS006
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     MOVE *OFF      WSCRN2  1                                           CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0090CP23                                           S01408
     C*                                                                   S01408
      *                                                                                       CAS006
      ** If CAS006 is on, process 3rd detail screen.                                          CAS006
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C           *IN01     ANDNE*ON                                                           CAS006
     C           *IN05     ANDNE*ON                                                           CAS006
     C                     EXSR D3INIT                                                        CAS006
     C                     EXSR D3PROC                                                        CAS006
     C                     ENDIF                                                              CAS006
     C*
     C*    Update data base files if not F12
     C*
     C           *IN01     IFNE '1'
     C           *IN05     ANDNE'1'
     C*
     C                     EXSR DBUPDT
     C*
     C                     END
     C                     END
     C*                                                                   CSW003
     C                     CLOSETRADSDX1                                  CSW003
     C                     CLOSETRADSDX2                                  BUG2582
     C*                                                                   CPM004
     C           BGPFMG    IFEQ 'Y'                                       CPM004
     C                     CLOSEPMPORTPD                                  CPM004
     C                     CLOSEPMHSEXPD                                  CPM004
     C                     ENDIF                                          CPM004
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  CBKPOS - Subroutine to calculate the latest Book Positions.  *
      *                                                               *
      *****************************************************************
      *
     C           CBKPOS    BEGSR                           *** CBKPOS ***
     C*
     C* Initialise and fetch correct work field for result
     C*
     C                     Z-ADD*ZEROS    WCONS
     C                     Z-ADD*ZEROS    WCONS0 150
     C                     Z-ADD*ZEROS    WCONS1 151
     C                     Z-ADD*ZEROS    WCONS2 152
     C                     Z-ADD*ZEROS    WCONS3 153
     C                     MOVEA'0000'    *IN,25
     C           25        ADD  NOMDP     J       20
     C                     MOVEA'1'       *IN,J
     C*
     C*  Calculate consideration/reallowance/charges/commission
     C*
     C   25      PRIC      MULT NOML      WCONS0    H
     C   26      PRIC      MULT NOML      WCONS1    H
     C   27      PRIC      MULT NOML      WCONS2    H
     C   28      PRIC      MULT NOML      WCONS3    H
      *
     C           SPBS      IFEQ 'P'
     C   25                DIV  100       WCONS0
     C   26                DIV  100       WCONS1
     C   27                DIV  100       WCONS2
     C   28                DIV  100       WCONS3
     C                     END
      *
     C***********PROT      IFEQ '8'                                       054259
     C***25******          MULT TCFC      WCONS0    H                     054259
     C***26******          MULT TCFC      WCONS1    H                     054259
     C***27******          MULT TCFC      WCONS2    H                     054259
     C***28******          MULT TCFC      WCONS3    H                     054259
     C***********          END                                            054259
      *
     C   25                MOVE WCONS0    WCONS
     C   26                MOVE WCONS1    WCONS
     C   27                MOVE WCONS2    WCONS
     C   28                MOVE WCONS3    WCONS
     C*
     C*  Allow for decimal places
     C*
     C           5         SUB  NMDP      DC
     C           WCONS     MULT POWER8,DC WCONS
     C*
     C                     Z-ADD*ZEROS    WRALL
     C                     Z-ADD*ZEROS    WRALL0 150
     C                     Z-ADD*ZEROS    WRALL1 151
     C                     Z-ADD*ZEROS    WRALL2 152
     C                     Z-ADD*ZEROS    WRALL3 153
      *
     C***********RBAP      IFEQ 'Y'                                       S01117
     C           BVRBAP    IFEQ 'Y'                                       S01117
     C   25      WDRALL    MULT NOML      WRALL0    H
     C   26      WDRALL    MULT NOML      WRALL1    H
     C   27      WDRALL    MULT NOML      WRALL2    H
     C   28      WDRALL    MULT NOML      WRALL3    H
     C*
     C           SPBS      IFEQ 'P'
     C   25                DIV  100       WRALL0
     C   26                DIV  100       WRALL1
     C   27                DIV  100       WRALL2
     C   28                DIV  100       WRALL3
     C                     END
      *
     C   25                MOVE WRALL0    WRALL
     C   26                MOVE WRALL1    WRALL
     C   27                MOVE WRALL2    WRALL
     C   28                MOVE WRALL3    WRALL
     C*
     C*  Allow for decimal places
     C*
     C           5         SUB  NMDP      DC
     C           WCONS     MULT POWER8,DC WCONS
     C                     END
     C*
     C                     Z-ADD*ZEROS    WCHRG
     C***********CBAP      IFEQ 'Y'                                       S01117
     C           BVCBAP    IFEQ 'Y'                                       S01117
     C           TCA1      ADD  TCA2      WCHRG
     C                     ADD  TCA3      WCHRG
     C***********          ADD  TOCA      WCHRG                           S01176
     C                     ADD  TCA4      WCHRG                           S01176
     C***********          ADD  TLTA      WCHRG                           S01176
     C                     ADD  TCA5      WCHRG                           S01176
     C                     END
     C*
     C                     Z-ADD*ZEROS    WCOMM
     C***********COBP      IFEQ 'Y'                                       S01117
     C           BVCMBP    IFEQ 'Y'                                       S01117
     C           TBCA      ADD  TCCA      WCOMM
     C                     END
     C*
     C*   Buying Book
     C*
     C           TDTP      IFEQ 'TP'
     C*
     C                     ADD  NOML      SNPI
     C                     ADD  WCONS     SANP
     C                     ADD  WRALL     SANP
     C*
     C***********BC1DI     IFEQ 'M'                                       S01117
     C           BCLAS     IFEQ 'M'                                       S01117
     C                     SUB  WCHRG     SANP
     C                     SUB  WCOMM     SANP
     C                     ELSE
     C                     ADD  WCHRG     SANP
     C                     ADD  WCOMM     SANP
     C                     END
     C*
     C                     ELSE
     C*   Selling Book
     C*
     C                     SUB  NOML      SNSI
     C***********          ADD  WCONS     SANS                            E36063
     C***********          ADD  WRALL     SANS                            E36063
     C                     SUB  WCONS     SANS                            E36063
     C                     SUB  WRALL     SANS                            E36063
      *
     C***********SC1DI     IFEQ 'M'                                       S01117
     C           SCLAS     IFEQ 'M'                                       S01117
     C                     ADD  WCHRG     SANS
     C                     ADD  WCOMM     SANS
     C                     ELSE
     C                     SUB  WCHRG     SANS
     C                     SUB  WCOMM     SANS
     C                     END
     C*
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
     C********************************************************************E20085
     C*    SUBROUTINE- CNCD                                              *E20085
     C*    DETERMINE NEXT COUPON DATE FOR PURCHASE INTEREST CALCS.       *E20085
     C*                                                                  *E20085
     C********************************************************************E20085
     C*                                                                  *E20085
     C*  This subroutine is now redundant and has been replaced with     *E20085
     C*  the standard subroutine 'ZNCD'.                                 *E20085
     C*                                                                  *E20085
     C********************************************************************E20085
     C/SPACE 3
     C********************************************************************E20085
     C*                                                                  *E20085
     C*  CPCADJ Sub routine to calculate the interest accrued            *E20085
     C*         adjustment on a Transfer                                 *E20085
     C*                                                                  *E20085
     C********************************************************************E20085
     C*                                                                  *E20085
     C*  This subroutine is now redundant and has been replaced with     *E20085
     C*  the standard subroutine 'ZPCINT'.                               *E20085
     C*                                                                  *E20085
     C********************************************************************E20085
      /SPACE 3                                                            E20085
     C********************************************************************E20085
     C*                                                                  *E20085
     C*  CPCINT Sub routine to calculate the purchased interest          *E20085
     C*         on a Transfer                                            *E20085
     C*                                                                  *E20085
     C********************************************************************E20085
     C*                                                                  *E20085
     C*  This subroutine is now redundant and has been replaced with     *E20085
     C*  the standard subroutine 'ZPCINT'.                               *E20085
     C*                                                                  *E20085
     C********************************************************************E20085
      /EJECT
      *****************************************************************
      *                                                               *
      *  D1PROC - Subroutine to process Screen Format 1.              *
      *                                                               *
      *****************************************************************
      *
     C           D1PROC    BEGSR                           *** D1PROC ***
     C*
     C                     SETOF                     30
     C                     MOVE 'Y'       FIRST   1
     C*
     C           *IN30     DOUEQ'1'
     C*
     C*  Display screen
     C*
     C           WSFLG     IFNE 'Y'
     C                     MOVEAER1       ER1MSG
     C                     MOVEAER2       ER2MSG
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0090CCP4                                           S01408
     C*                                                                   S01408
     C                     EXFMTSE0090F0
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0090CCP3                                           S01408
     C*                                                                   S01408
     C           @TEST     IFEQ '1'                                       S01117
     C                     MOVE '1'       *IN01                           S01117
     C                     END                                            S01117
      *                                                                   S01117
      ** If screen redisplay is due to ? prompt then set on screen        S01117
      ** change indicator.                                                S01117
      *                                                                   S01117
     C           @SEL      IFEQ 1                                         S01117
     C                     MOVE '1'       *IN,22                          S01117
     C                     END                                            S01117
      *                                                                   S01117
      ** Check for '?'s this time around                                  S01117
      *                                                                   S01117
     C                     EXSR CHKSEL                                    S01117
     C*
     C*  If F3 then exit program
     C*
     C           *IN01     IFEQ '1'
     C                     SETON                     30
     C*
     C**********           ELSE                                           S01199
     C***If*HELP*then*call*help*routine*program************************   S01199
     C**********                                                          S01199
     C********** *IN06     IFEQ '1'                                       S01199
     C**********           MOVEAER1       ERR,1                           S01199
     C**********           MOVEAER2       ERR,20                          S01199
     C**********           CALL 'MHELP'                                   S01199
     C**********           PARM           DBPGM                           S01199
     C**********           PARM           ERR                             S01199
     C*
     C*  Clear screen & redisplay if F12 pressed
     C*
     C                     ELSE
      *
      **  IF BEEN THROUGH AT LEAST ONCE, ALL ERRORS ARE WARNING ERRORS,
      **  AND NO SCREEN CHANGES, DO THE UPDATE, NO NEED TO VALIDATE.
      *
     C           *IN05     IFEQ '0'
     C           C1        ADD  C2        WWCC    40
      *
     C           FIRST     IFEQ 'N'
     C           WEC       ANDEQWWCC
     C           *IN22     ANDEQ'0'
     C           @SEL      ANDEQ0                                         S01117
     C                     SETON                     30
     C                     MOVE *BLANKS   ER1
     C                     MOVE *BLANKS   ER1MSG
     C                     MOVE *BLANKS   ER2
     C                     MOVE *BLANKS   ER2MSG
     C                     Z-ADD0         C1      20
     C                     Z-ADD0         C2      20
     C                     Z-ADD0         WEC
     C***********          MOVE '0'       *IN48                    E14574 E20386
     C                     MOVE '0'       *IN33                           E20386
     C                     MOVEA'00000000'*IN,50
     C                     MOVEA'000'     *IN,58
     C                     MOVEA'000'     *IN,16                          S01117
     C                     SETOF                     3839
     C                     GOTO UPD
     C                     END
      *
     C                     END
     C*
     C*  .. Reset indicators
     C*
     C                     MOVE *BLANKS   ER1
     C                     MOVE *BLANKS   ER1MSG
     C                     MOVE *BLANKS   ER2
     C                     MOVE *BLANKS   ER2MSG
     C                     Z-ADD0         C1      20
     C                     Z-ADD0         C2      20
     C                     Z-ADD0         WEC
     C***********          MOVE '0'       *IN48                    E14574 E20386
     C                     MOVE '0'       *IN33                           E20386
     C                     MOVEA'00000000'*IN,50
     C                     MOVEA'000'     *IN,58
     C                     SETOF                     3839
     C                     MOVEA'000'     *IN,16                          S01117
      *
     C           *IN05     IFEQ '1'
     C                     MOVE *BLANKS   SCRFM1
     C                     MOVE 'Y'       FIRST                           E20386
     C*
     C*  Validate data if F12 not pressed
     C*  ... and all "?"s have been processed.                            S01117
     C*
     C                     ELSE
      *
     C                     MOVE 'N'       FIRST                           S01117
     C           @SEL      IFEQ 0                                         S01117
     C                     EXSR D1VALD
     C***********          MOVE 'N'       FIRST                           S01117
     C*
     C*  If no errors, process next screen
     C*
     C           C1        IFEQ 0
     C                     SETON                     30
     C                     ELSE
     C                     SETON                     38
     C                     END
      *
     C           C2        IFGT 0
     C                     SETON                     39
     C                     END
      *                                                                   S01117
      ** End of IF @SEL=0                                                 S01117
      *                                                                   S01117
     C                     END                                            S01117
     C*
     C           UPD       TAG
     C*
     C**********           END                                            S01199
      ***  End of If/Else *IN05 = '01'
     C                     END
      ***  End of If/Else *IN01 = '01'
     C                     END
      ***  End of Do Until *IN30 = '01'
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  D1VALD - Subroutine to Validate Screen 1 entry details.      *
      *                                                               *
      *****************************************************************
      *
     C           D1VALD    BEGSR                           *** D1VALD ***
     C*
     C* Security Shortname
     C*
     C*    .. must reference an active record on SECTY
     C*
     C           SSESN     CHAINSECTYDF              44
     C           *IN44     IFEQ '1'
     C           *IN44     OREQ '0'
     C           RECI      ANDNE'D'
     C                     MOVE ' 100'    WERR    4
     C                     EXSR ERRORS
     C                     SETON                     50
     C*                                                                   S01511
     C** No actions are permitted on a security being Market Migrated     S01511
     C** if S01511 is active                                              S01511
     C*                                                                   S01511
     C                     ELSE                                           S01511
     C/COPY WNCPYSRC,SE0090C020
     C           S01511    IFEQ 'Y'                                       S01511
     C           SMAI      IFEQ 'Y'                                       S01511
     C                     MOVE ' 125'    WERR                            S01511
     C                     EXSR ERRORS                                    S01511
     C                     SETON                     50                   S01511
     C                     GOTO D1END                                     S01511
     C                     ELSE                                           S01511
     C                     MOVE MKTI      SMKTI   1                       S01511
     C                     END                                            S01511
     C                     END                                            S01511
     C                     END
     C*
     C* Selling Book
     C*
     C*****..*if*entered,*must*reference*an*active*record*on*BOOKDD*******S01117
     C*    .. if entered, must reference an active record on SDBOOKPD     S01117
     C*
     C           SSBOK     IFNE *BLANKS
     C***********SSBOK     CHAINBOOKDDF              44                   S01117
     C************IN44     IFEQ '1'                                       S01117
     C************IN44     OREQ '0'                                       S01117
     C***********RECI      ANDEQ'*'                                       S01117
      *                                                                   S01117
      ** Access book details file SDBOOKPD via access object program      S01117
      *                                                                   S01117
     C                     CALL 'AOBOOKR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SSBOK     @BKCD   2                       S01117
     C           SDBOOK    PARM SDBOOK    DSFDY                           S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE ' 101'    WERR
     C                     EXSR ERRORS
     C                     SETON                     51
     C                     END
      *                                                                   E20371
      ***  If Buy-sell field is 'Y' do not allow user entry to next srn   CSE006
      ***  Validate Buy-Sell field                                        CSE006
      *                                                                   CSE006
     C           BDBYSL    IFEQ 'Y'                                       CSE006
     C                     MOVE ' 129'    WERR                            CSE006
     C                     EXSR ERRORS                                    CSE006
     C                     SETON                     51                   CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     ELSE                                           E20371
     C                     MOVE ' 101'    WERR                            E20371
     C                     EXSR ERRORS                                    E20371
     C                     SETON                     51                   E20371
     C                     END
     C*                                                                   CPM004
     C**  Bank Portfolios  supported, output associated portfolio         CPM004
     C**  reference for selling book if present, else, error.             CPM004
     C           *IN09     IFEQ *ON                                       CPM004
     C           *IN51     ANDEQ*OFF                                      CPM004
     C*                                                                   CPM004
     C           BDASPR    IFNE *BLANKS                                   CPM004
     C                     MOVELBDASPR    SSPFR                           CPM004
     C*                                                                   CPM004
     C           SSPFR     IFEQ '9997'                                    CPM004
     C                     MOVELFCR997    SSPFR                           CPM004
     C                     ENDIF                                          CPM004
     C*                                                                   CPM004
     C                     ELSE                                           CPM004
     C                     MOVE ' 414'    WERR                            CPM004
     C                     EXSR ERRORS                                    CPM004
     C                     MOVE *ON       *IN51                           CPM004
     C                     ENDIF                                          CPM004
     C*                                                                   CPM004
     C                     ENDIF                                          CPM004
     C*
     C* Buying Book
     C*
     C*****..*if*entered,*must*reference*an*active*record*on*BOOKDD*******S01117
     C*    .. if entered, must reference an active record on SDBOOKPD     S01117
     C*
     C           SBBOK     IFNE *BLANKS
     C***********SBBOK     CHAINBOOKDDF              44                   S01117
     C************IN44     IFEQ '1'                                       S01117
     C************IN44     OREQ '0'                                       S01117
     C***********RECI      ANDEQ'*'                                       S01117
      *                                                                   S01117
      ** Access book details file SDBOOKPD via access object program      S01117
      *                                                                   S01117
     C                     CALL 'AOBOOKR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SBBOK     @BKCD   2                       S01117
     C           SDBOOK    PARM SDBOOK    DSFDY                           S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE ' 102'    WERR
     C                     EXSR ERRORS
     C                     SETON                     52
     C                     END
      *                                                                   E20371
      ***  If Buy-sell field is 'Y' do not allow user entry to next srn   CSE006
      ***  Validate Buy-Sell field                                        CSE006
      *                                                                   CSE006
     C           BDBYSL    IFEQ 'Y'                                       CSE006
     C                     MOVE ' 129'    WERR                            CSE006
     C                     EXSR ERRORS                                    CSE006
     C                     SETON                     52                   CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     ELSE                                           E20371
     C                     MOVE ' 102'    WERR                            E20371
     C                     EXSR ERRORS                                    E20371
     C                     SETON                     52                   E20371
     C                     END
     C*                                                                   CPM004
     C**  Bank Portfolios  supported, output associated portfolio         CPM004
     C**  reference for buying book if present, else, error.              CPM004
     C           *IN09     IFEQ *ON                                       CPM004
     C           *IN52     ANDEQ*OFF                                      CPM004
     C*                                                                   CPM004
     C           BDASPR    IFNE *BLANKS                                   CPM004
     C                     MOVELBDASPR    SBPFR                           CPM004
     C*                                                                   CPM004
     C           SBPFR     IFEQ '9997'                                    CPM004
     C                     MOVELFCR997    SBPFR                           CPM004
     C                     ENDIF                                          CPM004
     C*                                                                   CPM004
     C                     ELSE                                           CPM004
     C                     MOVE ' 415'    WERR                            CPM004
     C                     EXSR ERRORS                                    CPM004
     C                     MOVE *ON       *IN52                           CPM004
     C                     ENDIF                                          CPM004
     C*                                                                   CPM004
     C                     ENDIF                                          CPM004
     C*
     C/COPY WNCPYSRC,SE0090CP10                                           S01408
     C*                                                                   S01408
     C* Sale Reference
     C*
     C*   .. must be in the range 1 - 999999
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSSREF     ZFIELD
     C                     Z-ADD*ZEROS    ZADEC
     C                     Z-ADD6         ZADIG
     C*
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C           SSREF     OREQ *BLANKS
     C                     MOVE ' 103'    WERR
     C                     EXSR ERRORS
     C                     SETON                     53
     C                     END
     C                     MOVE ZFIELD    WSREF
     C*
     C*    .. must not reference an active record on TRADS
     C*    .. and do not allow insert over deleted trades                 088307
     C*
     C           WSREF     CHAINTRADSDFX             44
     C           *IN44     IFEQ '0'
      *
     C           RECI      IFEQ 'A'
     C           RECI      OREQ 'C'
     C           RECI      OREQ 'D'
     C           RECI      OREQ 'S'
     C           RECI      OREQ 'L'                                       S01269
     C           RECI      OREQ 'P'                                       S01269
     C           RECI      OREQ 'R'                                       S01269
     C           RECI      OREQ '*'                                       088307
     C                     MOVE ' 104'    WERR
     C                     EXSR ERRORS
     C                     SETON                     53
     C                     END
     C                     Z-ADDTNLU      SAVST
      *
     C                     ELSE
     C***********BIMO      IFEQ 'Y'                                 S01176S01117
     C           BVBIOP    IFEQ 'Y'                                       S01117
     C           WSREF     CHAINBULKR                41                   S01176
      *
     C           *IN41     IFEQ '0'                                       S01176
     C*                                                                   S01176
     C           RECI      IFEQ 'D'                                       S01176
     C           RECI      OREQ ' '                                       S01176
     C                     Z-ADD1         Q       20                      S01176
     C           ' 104'    LOKUPER1,Q                    66               S01176
     C  N66                Z-ADD1         Q                               S01176
     C  N66      ' 104'    LOKUPER2,Q                    66               S01176
      *
     C           *IN66     IFEQ '0'                                       S01176
     C                     MOVE ' 104'    WERR                            S01176
     C                     EXSR ERRORS                                    S01176
     C                     SETON                     53                   S01176
     C                     Z-ADDTNLU      SAVST                           S01176
     C                     END                                            S01176
      *
     C                     ELSE                                           S01176
     C                     MOVE *ZEROS    SAVST                           S01176
     C                     END                                            S01176
      *
     C                     END                                            S01176
     C                     ELSE                                           S01176
     C                     Z-ADD*ZEROS    SAVST                           S01176
     C                     END                                            S01176
      *
     C************         Z-ADD*ZEROS    SAVST                           S01176
     C                     END
     C*                                                                   074978
     C**   .. must not reference an active record in HSTTRD               074978
     C*                                                                   074978
     C           *IN44     IFEQ '1'                                       074978
     C************IN44     OREQ '0'                                074978 088307
     C***********RECI      ANDEQ'*'                                074978 088307
     C           WSREF     CHAINHSTTRDF              44                   074978
     C           *IN44     IFEQ '0'                                       074978
     C                     MOVE ' 104'    WERR                            074978
     C                     EXSR ERRORS                                    074978
     C                     SETON                     53                   074978
     C                     END                                            074978
     C                     END                                            074978
     C*
     C* Buy Reference
     C/COPY WNCPYSRC,SE0090C030
     C*
     C*   .. must be in the range 1 - 999999
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSBREF     ZFIELD
     C                     Z-ADD*ZEROS    ZADEC
     C                     Z-ADD6         ZADIG
     C*
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C           SBREF     OREQ *BLANKS
     C                     MOVE ' 105'    WERR
     C                     EXSR ERRORS
     C                     SETON                     54
     C                     END
     C                     MOVE ZFIELD    WBREF
     C*
     C*    .. must not reference an active record on TRADS
     C*
     C           WBREF     CHAINTRADSDFX             44
     C           *IN44     IFEQ '0'
      *
     C           RECI      IFEQ 'A'
     C           RECI      OREQ 'C'
     C           RECI      OREQ 'D'
     C           RECI      OREQ 'S'
     C           RECI      OREQ 'L'                                       S01269
     C           RECI      OREQ 'P'                                       S01269
     C           RECI      OREQ 'R'                                       S01269
     C                     MOVE ' 106'    WERR
     C                     EXSR ERRORS
     C                     SETON                     54
     C                     END
      *
     C                     Z-ADDTNLU      SAVBT
     C                     ELSE
      *
     C***********BIMO      IFEQ 'Y'                                 S01176S01117
     C           BVBIOP    IFEQ 'Y'                                       S01117
     C           WBREF     CHAINBULKR                41                   S01176
     C           *IN41     IFEQ '0'                                       S01176
     C*                                                                   S01176
     C           RECI      IFEQ 'D'                                       S01176
     C           RECI      OREQ ' '                                       S01176
     C                     Z-ADD1         Q                               S01176
     C           ' 106'    LOKUPER1,Q                    66               S01176
     C  N66                Z-ADD1         Q                               S01176
     C  N66      ' 106'    LOKUPER2,Q                    66               S01176
      *
     C           *IN66     IFEQ '0'                                       S01176
     C                     MOVE ' 106'    WERR                            S01176
     C                     EXSR ERRORS                                    S01176
     C                     SETON                     54                   S01176
     C                     Z-ADDTNLU      SAVST                           S01176
     C                     END                                            S01176
      *
     C                     ELSE                                           S01176
     C                     MOVE *ZEROS    SAVST                           S01176
     C                     END                                            S01176
      *
     C                     END                                            S01176
     C                     ELSE                                           S01176
     C                     Z-ADD*ZEROS    SAVST                           S01176
     C                     END                                            S01176
      *
     C***********          Z-ADD*ZEROS    SAVBT                           S01176
     C                     END
     C*                                                                   074978
     C**   .. must not reference an active record in HSTTRD               074978
     C*                                                                   074978
     C           *IN44     IFEQ '1'                                       074978
     C           *IN44     OREQ '0'                                       074978
     C           RECI      ANDEQ'*'                                       074978
     C           WBREF     CHAINHSTTRDF              44                   074978
     C           *IN44     IFEQ '0'                                       074978
     C                     MOVE ' 106'    WERR                            074978
     C                     EXSR ERRORS                                    074978
     C                     SETON                     54                   074978
     C                     END                                            074978
     C                     END                                            074978
     C*
     C*    .. must not be equal to Sale Reference
     C*
     C           SBREF     IFEQ SSREF
     C                     MOVE ' 120'    WERR
     C                     EXSR ERRORS
     C                     SETON                     54
     C                     END
     C/COPY WNCPYSRC,SE0090C021
     C*
     C* Selling Branch Code
     C*
     C           SSBRC     IFNE *BLANKS
      * .. if entered, must reference an active record on branch file     S01117
      *                                                                   S01117
     C*****..*if*entered,*must*reference*an*active*record*on*TABLETR*     S01117
     C***********                                                         S01117
     C***********          MOVE *BLANKS   KEY12  12                       S01117
     C***********          MOVE SSBRC     KEY12                           S01117
     C***********          MOVEL'10'      KEY12                           S01117
     C***********KEY12     CHAINTABLETRF             44                   S01117
     C************IN44     IFEQ '1'                                       S01117
     C************IN44     OREQ '0'                                       S01117
     C***********RECI      ANDEQ'*'                                       S01117
      *                                                                   S01117
      ** Access branch codes file SDBRCHPD via access object program      S01117
      *                                                                   S01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SSBRC     @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVE A8LCCD    @SLCCD  3                       S01117
     C                     ELSE                                           S01117
     C                     MOVE ' 107'    WERR
     C                     EXSR ERRORS
     C                     SETON                     55
     C                     END
     C*                                                                   E16143
     C***********          MOVE BICN      CNUM                      E16143S01117
     C***********          MOVE '1'       RCDT                      E16143S01117
     C***********KLCLNT    CHAINCLINTSEX             44             E16143S01117
     C************IN44     IFEQ '1'                                 E16143S01117
     C***********RECI      ORNE 'D'                                 E16143S01117
      *                                                                   S01117
      ** Access securities clients details                                S01117
      *                                                                   S01117
     C                     CALL 'AOSECSR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM A8BICN    @AENB   6                       S01117
     C           SDSECS    PARM SDSECS    DSSDY                           S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE ' 122'    WERR                            E16143
     C                     EXSR ERRORS                                    E16143
     C                     SETON                     55                   E16143
     C                     END                                            E16143
     C*                                                                   E16143
     C***********          Z-ADDBICN      SBICN                           S01117
     C                     MOVE A8BICN    SBICN                           S01117
     C                     END
     C*
     C* Buying Branch Code
     C*
     C*****..*if*entered,*must*reference*an*active*record*on*TABLETR*     S01117
     C***********                                                         S01117
      *                                                                   S01117
      ** .. if entered, must reference a record on branch file            S01117
      *                                                                   S01117
     C           SBBRC     IFNE *BLANKS
      *                                                                   S01117
     C***********          MOVE *BLANKS   KEY12  12                       S01117
     C***********          MOVE SBBRC     KEY12                           S01117
     C***********          MOVEL'10'      KEY12                           S01117
     C***********KEY12     CHAINTABLETRF             44                   S01117
     C************IN44     IFEQ '1'                                       S01117
     C************IN44     OREQ '0'                                       S01117
     C***********RECI      ANDEQ'*'                                       S01117
      *                                                                   S01117
      ** Access branch codes file SDBRCHPD via access object program      S01117
      *                                                                   S01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SBBRC     @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVE A8LCCD    @BLCCD  3                       S01117
     C                     ELSE                                           S01117
     C                     MOVE ' 108'    WERR
     C                     EXSR ERRORS
     C                     SETON                     56
     C                     END
     C*                                                                   E16143
     C***********          MOVE BICN      CNUM                      E16143S01117
     C***********          MOVE '1'       RCDT                      E16143S01117
     C***********KLCLNT    CHAINCLINTSEX             44             E16143S01117
     C************IN44     IFEQ '1'                                 E16143S01117
     C***********RECI      ORNE 'D'                                 E16143S01117
      *                                                                   S01117
      ** Access securities clients details                                S01117
      *                                                                   S01117
     C                     CALL 'AOSECSR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM A8BICN    @AENB   6                       S01117
     C           SDSECS    PARM SDSECS    DSSDY                           S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE ' 123'    WERR                            E16143
     C                     EXSR ERRORS                                    E16143
     C                     SETON                     56                   E16143
     C                     END                                            E16143
     C*                                                                   E16143
     C***********          Z-ADDBICN      BBICN                           S01117
     C                     MOVE A8BICN    BBICN                           S01117
     C                     END
     C*
     C*    .. if Selling Branch = Buying Branch, Selling Book
     C*           must not = Buying Book
     C*
     C***********          Z-ADD*ZEROS    WSBRC                           S01117
     C***********          Z-ADD*ZEROS    WBBRC                           S01117
     C***********          TESTN          SSBRC      35                   S01117
     C************IN35     IFEQ '1'                                       S01117
     C                     MOVELSSBRC     WSBRC
     C***********          END                                            S01117
     C***********          TESTN          SBBRC      35                   S01117
     C************IN35     IFEQ '1'                                       S01117
     C                     MOVELSBBRC     WBBRC
     C***********          END                                            S01117
      *
     C           SSBRC     IFEQ SBBRC
     C           SSBRC     OREQ *BLANKS
     C***********WBBRC     ANDEQDSTB                                      S01117
     C           WBBRC     ANDEQDFTBRC                                    S01117
     C           SBBRC     OREQ *BLANKS
     C***********WSBRC     ANDEQDSTB                                      S01117
     C           WSBRC     ANDEQDFTBRC                                    S01117
     C*
     C           SSBOK     IFEQ SBBOK
     C           SSBOK     OREQ *BLANKS
     C***********SBBOK     ANDEQDMKB                                      S01117
     C           SBBOK     ANDEQBVDMBC                                    S01117
     C           SBBOK     OREQ *BLANKS
     C***********SSBOK     ANDEQDMKB                                      S01117
     C           SSBOK     ANDEQBVDMBC                                    S01117
     C           CAC005    IFEQ 'N'                                       CAC005
     C                     MOVE ' 109'    WERR
     C                     EXSR ERRORS
     C                     SETON                     5152
     C                     ENDIF                                          CAC005
     C                     END
      *
     C                     END
      *
      ** Originating Branch                                               S01117
      ** .. if entered, must reference a record on the branch file        S01117
      *                                                                   S01117
     C           SORBR     IFNE *BLANKS                                   S01117
      *                                                                   S01117
      ** Access branch codes file SDBRCHPD via access object program      S01117
      *                                                                   S01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SORBR     @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE ' 124'    WERR                            S01117
     C                     EXSR ERRORS                                    S01117
     C                     SETON                     17                   S01117
     C                     END                                            S01117
     C                     END                                            S01117
      *                                                                   S01117
      ** Security Profile Facility Validation for branches                S01117
      *                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
      *                                                                   S01117
      ** Originating Branch                                               S01117
      ** If validation required.                                          S01117
      *                                                                   S01117
     C           BKOBUV    IFEQ 'Y'                                       S01117
     C           SORBR     IFEQ *BLANKS                                   S01117
     C                     MOVE DFTBRC    @ZBR                            S01117
     C                     ELSE                                           S01117
     C                     MOVE SORBR     @ZBR                            S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     CALL 'ZVOBU'                                   S01117
     C                     PARM @ZBR      @ZBR    3                       S01117
     C                     PARM           @ERR    10                      S01117
      *                                                                   S01117
     C           @ERR      IFEQ 1                                         S01117
     C                     MOVE ' 405'    WERR                            S01117
     C                     EXSR ERRORS                                    S01117
     C                     MOVE '1'       *IN,17                          S01117
     C                     END                                            S01117
     C           @ERR      IFEQ 2                                         S01117
     C                     MOVE ' 406'    WERR                            S01117
     C                     EXSR ERRORS                                    S01117
     C                     MOVE '1'       *IN,17                          S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     END                                            S01117
      *                                                                   S01117
      ** Selling Branch (SPF)                                             S01117
      *                                                                   S01117
     C           SSBRC     IFEQ *BLANKS                                   S01117
     C                     MOVE DFTBRC    @ZBR                            S01117
     C                     ELSE                                           S01117
     C                     MOVE SSBRC     @ZBR                            S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     CALL 'ZVACTBU'                                 S01117
     C                     PARM 'I'       @ZACTN  1                       S01117
     C                     PARM @ZBR      @ZBR    3                       S01117
     C                     PARM           @ERR    10                      S01117
      *                                                                   S01117
     C           @ERR      IFNE 0                                         S01117
     C                     MOVE ' 403'    WERR                            S01117
     C                     EXSR ERRORS                                    S01117
     C                     MOVE '1'       *IN,55                          S01117
     C                     END                                            S01117
      *                                                                   S01117
      ** Buying Branch (SPF)                                              S01117
      *                                                                   S01117
     C           SBBRC     IFEQ *BLANKS                                   S01117
     C                     MOVE DFTBRC    @ZBR                            S01117
     C                     ELSE                                           S01117
     C                     MOVE SBBRC     @ZBR                            S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     CALL 'ZVACTBU'                                 S01117
     C                     PARM 'I'       @ZACTN  1                       S01117
     C                     PARM @ZBR      @ZBR    3                       S01117
     C                     PARM           @ERR    10                      S01117
      *                                                                   S01117
     C           @ERR      IFNE 0                                         S01117
     C                     MOVE ' 413'    WERR                            S01117
     C                     EXSR ERRORS                                    S01117
     C                     MOVE '1'       *IN,56                          S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     END                                            S01117
     C*                                                                   CPM004
     C** Bank Portfolio is supported, Booking Branch Internal             CPM004
     C** Customer Number must be a portfolio customer.                    CPM004
     C*                                                                   CPM004
     C           *IN09     IFEQ *ON                                       CPM004
     C*  Sell                                                             CPM004
     C*                                                                   CPM004
     C                     MOVELSBICN     @PLCS                           CPM004
     C           *IN55     IFEQ *OFF                                      CPM004
     C                     CALL 'AOPLCSR0'                                CPM004
     C                     PARM *BLANKS   @RTCD   7                       CPM004
     C                     PARM '*KEY   ' @OPTN   7                       CPM004
     C                     PARM           @PLCS  10                       CPM004
     C           SDPLCS    PARM SDPLCS    DSFDY                           CPM004
     C*                                                                   CPM004
     C           @RTCD     IFNE *BLANKS                                   CPM004
     C                     MOVEL' 416'    WERR                            CPM004
     C                     EXSR ERRORS                                    CPM004
     C                     MOVE *ON       *IN55                           CPM004
     C                     ELSE                                           CPM004
     C                     MOVELQBCSBY    WSPTCY  3                       CPM004
     C                     ENDIF                                          CPM004
     C                     ENDIF                                          CPM004
     C*                                                                   CPM004
     C** Buy                                                              CPM004
     C*                                                                   CPM004
     C                     MOVELBBICN     @PLCS                           CPM004
     C           *IN56     IFEQ *OFF                                      CPM004
     C                     CALL 'AOPLCSR0'                                CPM004
     C                     PARM *BLANKS   @RTCD   7                       CPM004
     C                     PARM '*KEY   ' @OPTN   7                       CPM004
     C                     PARM           @PLCS  10                       CPM004
     C           SDPLCS    PARM SDPLCS    DSFDY                           CPM004
     C*                                                                   CPM004
     C           @RTCD     IFNE *BLANKS                                   CPM004
     C                     MOVEL' 417'    WERR                            CPM004
     C                     EXSR ERRORS                                    CPM004
     C                     MOVE *ON       *IN56                           CPM004
     C                     ELSE                                           CPM004
     C                     MOVELQBCSBY    WBPTCY  3                       CPM004
     C                     ENDIF                                          CPM004
     C                     ENDIF                                          CPM004
     C*                                                                   CPM004
     C** Branch Internal Customer number and book associated portfolio    CPM004
     C** reference must represent a live portfolio in Portfolio           CPM004
     C** Definitions file PF/PMPORTPD)                                    CPM004
     C*                                                                   CPM004
     C*  Sell                                                             CPM004
     C           *IN51     IFEQ *OFF                                      CPM004
     C           *IN55     ANDEQ*OFF                                      CPM004
     C                     MOVELSBICN     KCNUM                           CPM004
     C                     MOVELSSPFR     KPTFR                           CPM004
     C*                                                                   CPM004
     C           SSPFR     IFNE FCR997                                    CPM004
     C*                                                                   CPM004
     C           KPORTD    CHAINPMPORTPD             08                   CPM004
     C*                                                                   CPM004
     C                     SELEC                                          CPM004
     C           *IN08     WHEQ *ON                                       CPM004
     C           *IN08     OREQ *OFF                                      CPM004
     C           PNRECI    ANDNE'D'                                       CPM004
     C                     MOVE ' 418'    WERR                            CPM004
     C                     EXSR ERRORS                                    CPM004
     C                     MOVE *ON       *IN51                           CPM004
     C                     MOVE *ON       *IN55                           CPM004
     C*                                                                   CPM004
     C** Portfolio must not be flagged for closure                        CPM004
     C           *IN08     WHEQ *OFF                                      CPM004
     C           PNDPCL    ANDGT0                                         CPM004
     C                     MOVE ' 419'    WERR                            CPM004
     C                     EXSR ERRORS                                    CPM004
     C                     MOVE *ON       *IN51                           CPM004
     C                     MOVE *ON       *IN55                           CPM004
     C*                                                                   CPM004
     C** Store Portfolio currency for later exchange rate calculation     CPM004
     C                     OTHER                                          CPM004
     C                     MOVELPNPTCY    WSPTCY  3                       CPM004
     C                     ENDSL                                          CPM004
     C*                                                                   CPM004
     C                     ENDIF                                          CPM004
     C*                                                                   CPM004
     C                     ENDIF                                          CPM004
     C*                                                                   CPM004
     C*  Buy                                                              CPM004
     C           *IN52     IFEQ *OFF                                      CPM004
     C           *IN56     ANDEQ*OFF                                      CPM004
     C                     MOVELBBICN     KCNUM                           CPM004
     C                     MOVELSBPFR     KPTFR                           CPM004
     C*                                                                   CPM004
     C           SBPFR     IFNE FCR997                                    CPM004
     C*                                                                   CPM004
     C           KPORTD    CHAINPMPORTPD             08                   CPM004
     C*                                                                   CPM004
     C                     SELEC                                          CPM004
     C           *IN08     WHEQ *ON                                       CPM004
     C           *IN08     OREQ *OFF                                      CPM004
     C           PNRECI    ANDNE'D'                                       CPM004
     C                     MOVE ' 420'    WERR                            CPM004
     C                     EXSR ERRORS                                    CPM004
     C                     MOVE *ON       *IN52                           CPM004
     C                     MOVE *ON       *IN56                           CPM004
     C*                                                                   CPM004
     C** Portfolio must not be flagged for closure                        CPM004
     C           *IN08     WHEQ *OFF                                      CPM004
     C           PNDPCL    ANDGT0                                         CPM004
     C                     MOVE ' 421'    WERR                            CPM004
     C                     EXSR ERRORS                                    CPM004
     C                     MOVE *ON       *IN52                           CPM004
     C                     MOVE *ON       *IN56                           CPM004
     C*                                                                   CPM004
     C** Store Portfolio currency for later exchange rate calculation     CPM004
     C                     OTHER                                          CPM004
     C                     MOVELPNPTCY    WBPTCY  3                       CPM004
     C                     ENDSL                                          CPM004
     C*                                                                   CPM004
     C                     ENDIF                                          CPM004
     C*                                                                   CPM004
     C                     ENDIF                                          CPM004
     C*                                                                   CPM004
     C                     ENDIF                                          CPM004
     C*                                                                   CPM004
      *                                                                   E14574
      ***  Selling Depot                                                  E14574
      ***                                                                 E14574
      ***  ..  Mandatory and must be valid Customer Shortname or Number   E14574
      *                                                                   E14574
     C           SDEPT     IFEQ *BLANKS                                   E14574
     C           SDEPT     OREQ *ZEROS                                    E14574
     C                     MOVE ' 121'    WERR                            E14574
     C                     EXSR ERRORS                                    E14574
     C***********          SETON                     48            E14574 E20386
     C                     SETON                     33                   E20386
     C                     ELSE                                           E14574
      *                                                                   S01117
     C***********          MOVELSDEPT     WDEP    6                 E14574S01117
     C***********          TESTN          WDEP       35             E14574S01117
     C************IN35     IFEQ '1'                                 E14574S01117
     C***********          MOVELSDEPT     WCNUM                     E14574S01117
     C***********WCNUM     CHAINCLINTSEX             44             E14574S01117
     C***********          ELSE                                     E14574S01117
     C***********SDEPT     CHAINSNAMEF               44             E14574S01117
     C************IN44     IFEQ '0'                                 E14574S01117
     C***********          MOVE CNUM      WCNUM                     E14574S01117
     C***********WCNUM     CHAINCLINTSEX             44             E14574S01117
     C************IN44     IFEQ '0'                                 E14574S01117
      *                                                                   S01117
      ** Access Customer Details file                                     S01117
      *                                                                   S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SDEPT     @KEY1  10                       S01117
     C                     PARM           @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
      *
     C           @RTCD     IFEQ *BLANKS                                   S01117
      *                                                                   S01117
      ** Access Securities Clients Details file                           S01117
      *                                                                   S01117
     C                     CALL 'AOSECSR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM BBCUST    @AENB   6                       S01117
     C           SDSECS    PARM SDSECS    DSSDY                           S01117
      *
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVE *BLANKS   SDEPT                           E14574
     C***********          MOVELCNUM      SDEPT                     E14574S01117
     C                     MOVELBFCUST    SDEPT                           S01117
     C                     END                                            E14574
      *
     C                     END                                            E14574
     C***********          END                                      E14574S01117
      *                                                                   E14574
      *  Customers with Classification = 'S' or 'D' not valid for Depot   E20386
      *                                                                   E20386
     C************IN44     IFEQ '1'                                 E14574S01117
     C***********C1DI      OREQ 'S'                                 E20386S01117
     C***********C1DI      OREQ 'D'                                 E20386S01117
     C           @RTCD     IFNE *BLANK                                    S01117
     C           BFCLAS    OREQ 'S'                                       S01117
     C           BFCLAS    OREQ 'D'                                       S01117
     C                     MOVE ' 121'    WERR                            E14574
     C                     EXSR ERRORS                                    E14574
     C***********          SETON                     48            E14574 E20386
     C                     SETON                     33                   E20386
     C                     END                                            E14574
      *                                                                   E14574
     C                     END                                            E14574
     C*                                                                   E14574
     C*
     C* Incomplete Indicator
     C*
     C*********must*be*'I'*or*'C'**************************************   E18200
     C*    .. must be 'I', 'C' or ' ' (default)                           E18200
     C*
     C           SINCS     IFNE 'I'
     C           SINCS     ANDNE'C'
     C           *IN50     IFEQ '0'                                       E18200
     C           SINCS     ANDEQ' '                                       E18200
     C                     MOVE INCS      SINCS                           E18200
     C                     ELSE                                           E18200
     C                     MOVE ' 110'    WERR
     C                     EXSR ERRORS
     C                     SETON                     57
     C                     END                                            E18200
     C                     END
     C*
     C*    .. if 'C' entered, Incomplete Indicator on SECTY must
     C*                                             not be 'I'
     C           SINCS     IFEQ 'C'
     C           INCS      ANDEQ'I'
     C                     MOVE ' 111'    WERR
     C                     EXSR ERRORS
     C                     SETON                     57                  *
     C                     END
     C*
     C* Nominal
     C*
     C*    .. must be entered
     C*
     C           SNOML     IFEQ *BLANKS
     C                     MOVE ' 112'    WERR
     C                     EXSR ERRORS
     C                     SETON                     58
     C                     END
     C*
     C*    .. if entered, must be a valid non-zero amount
     C*
     C           SNOML     IFNE *BLANKS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSNOML     ZFIELD
     C                     Z-ADDNMDP      ZADEC
     C           11        SUB  NMDP      ZADIG
     C*
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    NOML
     C           *IN99     IFEQ '1'
     C           NOML      OREQ *ZEROS
     C                     MOVE ' 113'    WERR
     C                     EXSR ERRORS
     C                     SETON                     58
     C                     ELSE                                           S01232
     C                     Z-ADDNOML      WRKNM  110                      S01232
     C                     END
     C                     END
     C/COPY WNCPYSRC,SE0090C022
     C*
     C*   If Security  valid ..
     C*
     C           *IN50     IFEQ '0'
     C*
     C*     If Nominal is valid get nominal currency decimal places
     C*
     C           *IN58     IFEQ '0'
     C***********          MOVEL*BLANKS   KEY12                           S01117
     C***********          MOVEL'20'      KEY12                           S01117
     C***********          MOVE '1'       WFLD4   4                       S01117
     C***********          MOVELNMCYA     WFLD4                           S01117
     C***********          MOVE WFLD4     KEY12                           S01117
     C***********KEY12     CHAINTABTG10F             44                   S01117
     C************IN44     IFEQ '1'                                       S01117
     C************IN44     OREQ '0'                                       S01117
     C***********RECI      ANDEQ'*'                                       S01117
     C***********          MOVE '04'      DBASE             ************  S01117
     C***********          MOVEL'TABLE'   DBFILE            * DATABASE *  S01117
     C***********          MOVELKEY12     DBKEY             * ERROR 04 *  S01117
     C***********          SETON                     U7U801 ************  S01117
     C***********          GOTO D1END                                     S01117
     C***********          END                                            S01117
     C***********          Z-ADDCDP       NOMDP                           S01117
     C***********          Z-ADDCDP       NCDP                      S01232S01117
      *                                                                   S01117
      ** Access currency file SDCURRPD                                    S01117
      *                                                                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR'  @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM NMCYA     @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
      *                                                                   S01117
     C                     Z-ADDA6NBDP    NOMDP                           S01117
     C                     Z-ADDA6NBDP    NCDP                            S01117
     C*
     C*    .. re-format Nominal to nominal currency decimal places
     C*
     C           NOMDP     SUB  NMDP      DEC
     C                     ADD  5         DEC
     C           NOML      MULT POWER8,DECWNOML  150
     C*
     C*    .. must be a multiple of Stock Denomination  (if not
     C*                                    zero on SECTY)
     C*
     C           SDNM      IFNE *ZEROS
     C*
     C*    .. re-format Stock Denomination to currency decimal places
     C           NOMDP     IFLT 4
     C           NOMDP     ADD  5         DEC     10
     C           SDNM      MULT POWER8,DECWSDNM  110
     C                     ELSE
     C           SDNM      MULT 10000     WSDNM
     C                     END
     C*
     C           WSDNM     IFNE *ZEROS
     C           WNOML     DIV  WSDNM     SNWORK
     C                     END
     C                     MULT WSDNM     SNWORK
      *
     C           SNWORK    IFNE WNOML
     C/COPY WNCPYSRC,SE0090C002
     C           CSE007    IFEQ 'N'                                       CSE007
     C           CEU017    ANDEQ'N'                                       CEU017
     C                     MOVE ' 114'    WERR
     C/COPY WNCPYSRC,SE0090C003
     C                     ELSE                                           CSE007
     C                     MOVE ' W18'    WERR                            CSE007
     C                     ADD  1         WEC                             CSE007
     C                     ENDIF                                          CSE007
     C                     EXSR ERRORS
     C                     SETON                     58
     C                     END
      *
     C                     END
     C                     END
     C*
     C* Value Date
     C*
     C*    .. if entered, must be a valid date
     C*
     C           STDVD     IFNE *BLANKS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSTDVD     ZFIELD
     C                     Z-ADD*ZEROS    ZADEC
     C                     Z-ADD6         ZADIG
     C                     EXSR ZALIGN
      *
     C           *IN99     IFEQ '0'
     C                     MOVE ZFIELD    ZDATE
     C                     EXSR ZDATE1
     C                     END
      *
     C           *IN99     IFEQ '1'
     C                     MOVE ' 117'    WERR
     C                     EXSR ERRORS
     C                     SETON                     60
     C                     ELSE
     C                     Z-ADDZDAYNO    TDVD
     C*                                                                   E20085
     C***  Update Event Control Date with Value Date                      E20085
     C*                                                                   E20085
     C                     Z-ADDTDVD      ECD     50                      E20085
     C*
     C*    .. if entered must not be after maturity date or before
     C*                                    issue date of the security
     C           MATY      IFNE *ZEROS
     C           TDVD      ANDGTMATY
     C           TDVD      ORLT ISSD
     C                     MOVE ' 118'    WERR
     C                     EXSR ERRORS
     C                     SETON                     60
     C                     END
     C*
     C*    .. if entered and less than run date, must fall within back
     C*                                     value period on TABTB36
     C***********RUND      SUB  BKVP      WBKVP                           S01117
     C           RUND      SUB  BVBVP     WBVP                            S01117
     C           TDVD      IFLT RUND
     C***********TDVD      ANDLTWBKVP                                     S01117
     C           TDVD      ANDLTWBVP                                      S01117
     C                     MOVE ' 119'    WERR
     C                     EXSR ERRORS
     C                     SETON                     60
     C                     ELSE
     C*
     C*    .. if entered and security is partly paid, must be later
     C*                                  than the most recent call date
     C           PPDI      IFEQ 'Y'
     C           TDVD      ANDLESLCA
     C                     MOVE ' 119'    WERR
     C                     EXSR ERRORS
     C                     SETON                     60
     C                     END
     C                     END
     C*
     C*    .. must not be a holiday in value currency
     C*    .. If S01509 is active, must not be a holiday in nominal ccy   S01509
     C*
     C***********STDVD     IFNE SAVVD
     C                     MOVE STDVD     SAVVD
     C*
     C                     Z-ADDTDVD      ZDAYNO
     C           S01509    IFEQ 'Y'                                       S01509
     C                     MOVE NMCYA     ZCCY                            S01509
     C                     ELSE                                           S01509
     C                     MOVE VLCY      ZCCY
     C                     END                                            S01509
     C                     MOVE *BLANK    ZLOC                            S01195
     C***********          EXSR ZDATE5                                    S01195
     C                     EXSR ZCHKH                                     S01195
     C************IN99     IFEQ '1'                                       S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C                     MOVE ' W02'    WERR
     C                     ADD  1         WEC
     C                     EXSR ERRORS
     C                     SETON                     60
     C***********          ELSE                                           S01509
     C***********                                                         S01509
     C*****..*must*not*be*a*holiday*in*payment*currency****************   S01509
     C***********                                                         S01509
     C***********          Z-ADDTDVD      ZDAYNO                          S01509
     C***********          MOVE SPYC      ZCCY                            S01509
     C***********          MOVE *BLANK    ZLOC                     S01195 S01509
     C***********          EXSR ZDATE5                                    S01195
     C***********          EXSR ZCHKH                              S01195 S01509
      ***********                                                         S01509
     C************IN99     IFEQ '1'                                       S01195
     C***********ZIND      IFEQ 'H'                                S01195 S01509
     C***********          MOVE ' W02'    WERR                            S01509
     C***********          ADD  1         WEC                             S01509
     C***********          EXSR ERRORS                                    S01509
     C***********          SETON                     60                   S01509
     C***********          END                                            S01509
      ***********                                                         S01509
     C                     END
     C***********          END
     C                     END
     C                     END
     C*
     C*    .. load default value if not entered
     C*
     C           STDVD     IFEQ *BLANKS
     C                     MOVELVDFT      WVDFT   20
     C                     MOVE VDFT      WVDFW   1
      *                                                                   E20125
      ***  If the Default number of days is 'Working Days', then call     E20125
      *****ZDATE3*to*calculate*the*Default*Value*Date,*else*dft*is**E20125S01195
      ***  ZFWDT to calculate the Default Value Date, else default is     S01195
      ***  actual days, so add the number of days to the Run Date.        E20125
      *                                                                   E20125
     C           WVDFW     IFEQ 'W'                                       E20125
     C                     Z-ADDRUND      ZDAYNO                          E20125
     C                     Z-ADDWVDFT     ZNRDYS                          E20125
     C                     MOVE NMCYA     ZCCY                            E20125
     C                     MOVE *BLANK    ZLOC                            S01195
     C***********          EXSR ZDATE3                              E20125S01195
     C                     EXSR ZFWDT                                     S01195
     C***********          Z-ADDZDYOUT    TDVD                      E20125S01195
     C                     Z-ADDZDYNBR    TDVD                            S01195
     C                     ELSE                                           E20125
     C           RUND      ADD  WVDFT     TDVD
     C                     END                                            E20125
      *                                                                   E20125
     C           *IN99     DOUEQ'0'
     C                     SETOF                     99
     C*
     C*    .. must not be after maturity date or before
     C*                                    issue date of the security
     C           TDVD      IFLT ISSD
     C                     Z-ADDISSD      TDVD
     C                     ELSE
      *
     C           MATY      IFGT *ZEROS
     C           TDVD      ANDGTMATY
     C                     Z-ADDMATY      TDVD
     C                     ELSE
     C*
     C*    .. if security is partly paid, must be later
     C*                                  than the most recent call date
     C           PPDI      IFEQ 'Y'
     C           TDVD      ANDLESLCA
     C                     ADD  1         TDVD
     C                     SETON                     99
     C                     END
     C*
     C*    .. must not be a holiday in value currency
     C*    .. If S01509 is active, must not be holiday in nominal ccy     S01509
     C*
     C*          *IN99     IFNE '1'
     C                     Z-ADDTDVD      ZDAYNO
     C           S01509    IFEQ 'Y'                                       S01509
     C                     MOVE NMCYA     ZCCY                            S01509
     C                     ELSE                                           S01509
     C                     MOVE VLCY      ZCCY
     C                     END                                            S01509
     C                     MOVE *BLANK    ZLOC                            S01195
     C***********          EXSR ZDATE5                                    S01195
     C                     EXSR ZCHKH                                     S01195
      *
     C************IN99     IFEQ '1'                                       S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C                     ADD  1         TDVD
     C***********          ELSE                                           S01509
     C***********                                                         S01509
     C*****..*must*not*be*a*holiday*in*payment*currency****************   S01509
     C***********                                                         S01509
     C***********          Z-ADDTDVD      ZDAYNO                          S01509
     C***********          MOVE SPYC      ZCCY                            S01509
     C***********          MOVE *BLANK    ZLOC                     S01195 S01509
     C***********          EXSR ZDATE5                                    S01195
     C***********          EXSR ZCHKH                              S01195 S01509
      ***********                                                         S01509
     C************IN99     IFEQ '1'                                       S01195
     C***********ZIND      IFEQ 'H'                                S01195 S01509
     C***********          ADD  1         TDVD                            S01509
     C***********          END                                            S01509
      ***********                                                         S01509
     C                     END
     C                     END
     C                     END
     C                     END
     C*                                                                   E20085
     C*    Update Event Control Date with Value Date                      E20085
     C*                                                                   E20085
     C                     Z-ADDTDVD      ECD                             E20085
     C                     END
     C*
     C* Price/Discount/Yield
     C*
     C*    .. mandatory if Incomplete Indicator is 'C'
     C*
     C           SINCS     IFEQ 'C'
     C           STPDY     ANDEQ*BLANKS
     C                     MOVE ' 115'    WERR
     C                     EXSR ERRORS
     C                     SETON                     59
     C                     END
     C*
     C*    .. if entered, must be a valid amount
     C*
     C           STPDY     IFNE *BLANKS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSTPDY     ZFIELD
     C                     Z-ADD8         ZADEC
     C                     Z-ADD7         ZADIG
     C*
     C                     EXSR ZALIGN
     C*
     C           *IN99     IFEQ '1'
     C                     MOVE ' 116'    WERR
     C                     EXSR ERRORS
     C                     SETON                     59
     C                     ELSE
     C                     MOVE ZFIELD    TPDY
     C*
     C********************************************************************S01232
     C*   REMOVED DURING S01232 - NO LONGER NEEDED AS 10% LIMIT           S01232
     C*   VALIDATON IS CARRIED OUT ON SCREEN 2                            S01232
     C********************************************************************S01232
     C*****..*must*be*within 10% of value date average price/             S01232
     C***********                                    Market Price         S01232
     C***********STPDY     IFNE SAVPD                                     S01232
     C***********          MOVE STPDY     SAVPD                           S01232
     C* *********                                                         S01232
     C***********          EXSR FAPOSD                                    S01232
     C* *********                                                         S01232
     C***********          EXSR ZNCD                                      S01232
     C***********          Z-ADDTPDY      ZPRCIN                          S01232
     C***********          Z-ADDBPPD      ZFDATE                          S01232
     C***********          EXSR ZPRCI                                     S01232
     C* *********                                                         S01232
     C***********KLBKPS    CHAINBKPOSDF              44                   S01232
     C********** *IN44     IFEQ '1'                                       S01232
     C********** *IN44     ORNE '1'                                       S01232
     C***********APPB      ANDEQ*ZEROS                                    S01232
     C***********          Z-ADDMKPR      APPB                            S01232
     C***********          END                                            S01232
     C* *********                                                         S01232
     C***********APPB      DIV  10        APWRK1                          S01232
     C***********APPB      ADD  APWRK1    APWRK2                          S01232
     C***********ZPRCOT    IFGT APWRK2                                    S01232
     C***********          MOVE ' W01'    WERR                            S01232
     C***********          ADD  1         WEC                             S01232
     C***********          EXSR ERRORS                                    S01232
     C***********          SETON                     59                   S01232
     C***********          ELSE                                           S01232
     C* *********                                                         S01232
     C***********APPB      SUB  APWRK1    APWRK2                          S01232
     C***********ZPRCOT    IFLT APWRK2                                    S01232
     C***********          MOVE ' W01'    WERR                            S01232
     C***********          ADD  1         WEC                             S01232
     C***********          EXSR ERRORS                                    S01232
     C***********          SETON                     59                   S01232
     C***********          END                                            S01232
     C* *********          END                                            S01232
     C******************************************************************* S01232
     C*   END OF CODE REMOVED DURING S01232                               S01232
     C********************************************************************S01232
     C*
     C           STPDY     IFNE SAVPD                                     E27915
     C                     MOVE STPDY     SAVPD                           E27915
     C*                                                                   E27915
     C                     EXSR ZNCD                                      E27915
     C                     Z-ADDTPDY      ZPRCIN                          E27915
     C***********          Z-ADDBPPD      ZFDATE                    E27915E39495
     C                     Z-ADDTDVD      ZFDATE                          E39495
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0090CP11                                           S01408
     C*                                                                   S01408
     C                     Z-ADDNOML      ZNOML                           E39495
     C                     MOVE 'C'       SCUMEX                          E39495
     C                     EXSR ZPRCI                                     E27915
     C*                                                                   E27915
     C/COPY WNCPYSRC,SE0090CP12                                           S01408
     C*                                                                   S01408
     C                     MOVELSSESN     PSSN                            E27915
     C                     Z-ADDRUND      PVDT                            E27915
     C           KPRICM    CHAINPRICM                44                   E27915
     C*                                                                   E27915
     C           *IN44     IFEQ '1'                                       E27915
     C           RECI      ORNE 'D'                                       E27915
     C                     Z-ADDMKPR      PPRC                            E27915
     C                     END                                            E27915
     C*                                                                   E27915
     C           PPRC      DIV  10        APWRK1                          E27915
     C           PPRC      ADD  APWRK1    APWRK2                          E27915
     C           ZPRCOT    IFGT APWRK2                                    E27915
     C                     MOVE ' W01'    WERR                            E27915
     C                     ADD  1         WEC                             E27915
     C                     EXSR ERRORS                                    E27915
     C                     SETON                     59                   E27915
     C                     ELSE                                           E27915
     C*                                                                   E27915
     C           PPRC      SUB  APWRK1    APWRK2                          E27915
     C           ZPRCOT    IFLT APWRK2                                    E27915
     C                     MOVE ' W01'    WERR                            E27915
     C                     ADD  1         WEC                             E27915
     C                     EXSR ERRORS                                    E27915
     C                     SETON                     59                   E27915
     C                     END                                            E27915
     C                     END                                            E27915
     C                     END                                            E27915
     C*                                                                   E27915
     C                     END
     C                     END
     C                     END
     C*
     C           D1END     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  D2INIT - Subroutine to Initialise Screen Format 2.           *
      *                                                               *
      *****************************************************************
      *
     C           D2INIT    BEGSR                           *** D2INIT ***
     C*
     C*    .. Reset indicators
     C*
     C                     MOVE *BLANKS   ER1
     C                     MOVE *BLANKS   ER1MSG
     C                     MOVE *BLANKS   ER2
     C                     MOVE *BLANKS   ER2MSG
     C                     Z-ADD0         C1      20
     C                     Z-ADD0         C2      20
     C                     Z-ADD0         WEC
     C                     SETOF                     343637               S01176
     C                     SETOF                       43                 S01176
     C                     MOVEA'0000'    *IN,46                          S01176
     C                     MOVEA'00000000'*IN,60
     C                     MOVEA'00000000'*IN,68
     C                     MOVEA'00000000'*IN,76
     C                     MOVEA'0000000' *IN,84
     C                     MOVEA'00000'   *IN,11
     C                     SETOF                     1618                 E47501
     C                     SETON                     10
     C*
     C* Protect fields
     C*
     C                     SETON                     40
     C*
     C* Clear input fields
     C*
     C                     MOVE *BLANKS   SCRFM2
     C*
     C* Load output field:-
     C*
     C*  Security name
     C                     MOVELSRPN      SSRPN
     C*
     C* Load default fields :-
     C*
     C*  Branch code (Selling)
      *
     C           SSBRC     IFEQ *BLANKS
     C                     MOVELDFTBRC    SSBRC                           S01117
      *                                                                   S01117
     C***********          MOVELDSTB      SSBRC                           S01117
     C***********          MOVE *BLANKS   KEY12  12                       S01117
     C***********          MOVE SSBRC     KEY12                           S01117
     C***********          MOVEL'10'      KEY12                           S01117
     C***********KEY12     CHAINTABLETRF             44                   S01117
     C************IN44     IFEQ '1'                                       S01117
     C************IN44     OREQ '0'                                       S01117
     C***********RECI      ANDEQ'*'                                       S01117
     C***********          MOVE '05'      DBASE            ***************S01117
     C***********          MOVEL'TABLE'   DBFILE           * DB ERROR 05 *S01117
     C***********          MOVELKEY12     DBKEY            ***************S01117
     C***********          SETON                     U7U801               S01117
     C***********          GOTO D2END                                     S01117
     C***********          END                                            S01117
     C***********          Z-ADDBICN      SBICN                           S01117
      *                                                                   S01117
      ** Access branch codes file SDBRCHPD via access object program      S01117
      *                                                                   S01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*DBERR'  @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SSBRC     @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *                                                                   S01117
     C                     MOVE A8BICN    SBICN                           S01117
      *                                                                   S01117
     C                     END
      *
      ** Branch code (Buying)
      *
     C           SBBRC     IFEQ *BLANKS
     C                     MOVELDFTBRC    SBBRC                           S01117
     C***********          MOVELDSTB      SBBRC                           S01117
     C***********          MOVE *BLANKS   KEY12  12                       S01117
     C***********          MOVE SBBRC     KEY12                           S01117
     C***********          MOVEL'10'      KEY12                           S01117
     C***********KEY12     CHAINTABLETRF             44                   S01117
     C************IN44     IFEQ '1'                                       S01117
     C************IN44     OREQ '0'                                       S01117
     C***********RECI      ANDEQ'*'                                       S01117
     C***********          MOVE '06'      DBASE            ***************S01117
     C***********          MOVEL'TABLE'   DBFILE           * DB ERROR 06 *S01117
     C***********          MOVELKEY12     DBKEY            ***************S01117
     C***********          SETON                     U7U801               S01117
     C***********          GOTO D2END                                     S01117
     C***********          END                                            S01117
     C***********          Z-ADDBICN      BBICN                           S01117
      *                                                                   S01117
      ** Access branch codes file SDBRCHPD via access object program      S01117
      *                                                                   S01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*DBERR'  @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SBBRC     @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *                                                                   S01117
     C                     MOVE A8BICN    BBICN                           S01117
     C                     END                                            S01117
      *                                                                   S01117
      ** Originating Branch                                               S01117
      *                                                                   S01117
     C           SORBR     IFEQ *BLANKS                                   S01117
     C                     MOVELDFTBRC    SORBR                           S01117
      *                                                                   S01117
      ** Access branch codes file SDBRCHPD via access object program      S01117
      *                                                                   S01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*DBERR'  @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SORBR     @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *                                                                   S01117
     C                     END
      *                                                                   S01117
     C*  Value date
     C                     Z-ADDTDVD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     STDVD
     C*
     C*  Market centre
     C                     MOVELNMCYA     CCYI
     C                     MOVELSITP      INVT
     C           KLINVT    CHAININVTPDF              44
     C           *IN44     IFEQ '0'
     C           RECI      ANDNE'*'
     C                     MOVELDMKT      STMKC
     C                     ELSE
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVE '07'      DBASE                           S01117
     C                     Z-ADD7         DBASE            ***************S01117
     C                     MOVEL'INVTP'   DBFILE           * DB ERROR 07 *
     C                     MOVELNMCYA     DBKEY            ***************
     C                     MOVE SITP      DBKEY
     C                     SETON                     U7U801
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     END
     C*
     C*  Trade date
     C           RUND      IFLE TDVD
     C                     Z-ADDRUND      ZDAYNO
     C                     ELSE
     C                     Z-ADDTDVD      ZDAYNO
     C                     END
      *
     C                     EXSR ZDATE2
     C                     MOVELZDATE     STDDT
     C                     Z-ADDZDAYNO    TDDT
     C*
     C*  Trade sub-type
     C***********          MOVELDTRS      STSUB                           S01117
     C                     MOVELBVDTDS    STSUB                           S01117
     C*
     C*  Market indicator
     C                     MOVELMKTI      STDMI
     C*
     C***AIBD/IPPA*****************************************************   E43208
     C*  ISMA/IPMA                                                        E43208
     C                     MOVEL'N'       SAIIP
      *                                                                   S01117
      ** Profit Centres, if used                                          S01117
      *                                                                   S01117
     C           BKPRCU    IFEQ 'Y'                                       S01117
     C                     MOVE 'N'       @SPREC  1                       S01117
     C                     MOVE 'N'       @BPREC  1                       S01117
     C                     MOVE '0'       *IN23                           109540
     C                     MOVE '0'       *IN24                           109540
      *                                                                   S01117
      ** Selling Profit Centre                                            S01117
      *                                                                   S01117
      ** .. if Reconcile Trade/Book position profit centre = 'Y'          S01117
      *                                                                   S01117
     C           BVTBRC    IFEQ 'Y'                                       S01117
     C           CAC005    ANDEQ'N'                                       CAC005
      *                                                                   S01117
      ** Access Book Position Profit Centre File                          S01117
      *                                                                   S01117
     C           SPCKEY    CHAINSEPCBD               44                   S01117
      *                                                                   S01117
      ** If record found, move value to selling profit centre & protect   S01117
      *                                                                   S01117
     C           *IN44     IFEQ '0'                                       S01117
     C                     MOVE 'Y'       @SPREC                          S01117
     C                     MOVE PCBK      SSPCCD                          S01117
     C                     MOVE '1'       *IN23                           S01117
     C                     ELSE                                           S01117
      *                                                                   S01117
      ** .. if Profit Centre Default Matrix Used = 'Y'                    S01117
      *                                                                   S01117
     C           BKPCDU    IFEQ 'Y'                                       S01117
      *                                                                   S01117
      ** Access Profit Centre Default Matrix file                         S01117
      *                                                                   S01117
     C                     CALL 'AOPRFMR0'                                S01117
     C                     PARM *BLANK    @RTCD2  1                       S01117
     C                     PARM SSBOK     @BOOK   2                       S01117
     C                     PARM 'TS   '   @TRTP   5                       S01117
     C                     PARM BVDTDS    @SUTP   2                       S01117
     C                     PARM SSBRC     @BRAN   3                       S01117
     C                     PARM *BLANK    @DEPT   3                       S01117
     C                     PARM USRID     @USER  10                       S01117
     C                     PARM *BLANK    @ACOF   2                       S01117
     C                     PARM *BLANK    @CNUM   6                       S01117
     C                     PARM           @SPCCD  4                       S01117
     C                     MOVE @SPCCD    SSPCCD                          S01117
      *                                                                   S01117
      ** End of If Profit Centre Dft Matrix Used = 'Y' ( & BVTBRC='Y')    S01117
      *                                                                   S01117
     C                     END                                            S01117
      *                                                                   S01117
      ** End of If/Else *IN44 ='1'                                        S01117
      *                                                                   S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     ELSE                                           S01117
      *                                                                   S01117
      ** .. if Profit Centre Default Matrix Used = 'Y' ( & BVTBRC='N')    S01117
      *                                                                   S01117
     C           BKPCDU    IFEQ 'Y'                                       S01117
      *                                                                   S01117
      ** Access Profit Centre Default Matrix file                         S01117
      *                                                                   S01117
     C                     CALL 'AOPRFMR0'                                S01117
     C                     PARM *BLANK    @RTCD2  1                       S01117
     C                     PARM SSBOK     @BOOK   2                       S01117
     C                     PARM 'TS   '   @TRTP   5                       S01117
     C                     PARM BVDTDS    @SUTP   2                       S01117
     C                     PARM SSBRC     @BRAN   3                       S01117
     C                     PARM *BLANK    @DEPT   3                       S01117
     C                     PARM USRID     @USER  10                       S01117
     C                     PARM *BLANK    @ACOF   2                       S01117
     C                     PARM *BLANK    @CNUM   6                       S01117
     C                     PARM           @SPCCD  4                       S01117
     C                     MOVE @SPCCD    SSPCCD                          S01117
      *                                                                   S01117
      ** End of If Profit Centre Dft Matrix Used = 'Y' ( & BVTBRC='N')    S01117
      *                                                                   S01117
     C                     END                                            S01117
      *                                                                   S01117
      ** End of If/Else reconcile trade/book position profit centre.      S01117
      *                                                                   S01117
     C                     END                                            S01117
      *                                                                   S01117
      ** Buying Profit Centre                                             S01117
      *                                                                   S01117
      ** .. if Reconcile Trade/Book position profit centre = 'Y'          S01117
      *                                                                   S01117
     C           BVTBRC    IFEQ 'Y'                                       S01117
     C           CAC005    ANDEQ'N'                                       CAC005
      *                                                                   S01117
      ** Access Book Position Profit Centre File                          S01117
      *                                                                   S01117
     C           BPCKEY    CHAINSEPCBD               44                   S01117
      *                                                                   S01117
      ** If record found, move value to selling profit centre & protect   S01117
      *                                                                   S01117
     C           *IN44     IFEQ '0'                                       S01117
     C                     MOVE 'Y'       @BPREC                          S01117
     C                     MOVE PCBK      SBPCCD                          S01117
     C                     MOVE '1'       *IN24                           S01117
     C                     ELSE                                           S01117
      *                                                                   S01117
      ** .. if Profit Centre Default Matrix Used = 'Y'                    S01117
      *                                                                   S01117
     C           BKPCDU    IFEQ 'Y'                                       S01117
      *                                                                   S01117
      ** Access Profit Centre Default Matrix file                         S01117
      *                                                                   S01117
     C                     CALL 'AOPRFMR0'                                S01117
     C                     PARM *BLANK    @RTCD2  1                       S01117
     C                     PARM SBBOK     @BOOK   2                       S01117
     C                     PARM 'TP   '   @TRTP   5                       S01117
     C                     PARM BVDTDS    @SUTP   2                       S01117
     C                     PARM SBBRC     @BRAN   3                       S01117
     C                     PARM *BLANK    @DEPT   3                       S01117
     C                     PARM USRID     @USER  10                       S01117
     C                     PARM *BLANK    @ACOF   2                       S01117
     C                     PARM *BLANK    @CNUM   6                       S01117
     C                     PARM           @BPCCD  4                       S01117
     C                     MOVE @BPCCD    SBPCCD                          S01117
      *                                                                   S01117
      ** End of If Profit Centre Dft Matrix Used = 'Y' ( & BVTBRC='Y')    S01117
      *                                                                   S01117
     C                     END                                            S01117
      *                                                                   S01117
      ** End of If/Else *IN44 ='1'                                        S01117
      *                                                                   S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     ELSE                                           S01117
      *                                                                   S01117
      ** .. if Profit Centre Default Matrix Used = 'Y' ( & BVTBRC='N')    S01117
      *                                                                   S01117
     C           BKPCDU    IFEQ 'Y'                                       S01117
      *                                                                   S01117
      ** Access Profit Centre Default Matrix file                         S01117
      *                                                                   S01117
     C                     CALL 'AOPRFMR0'                                S01117
     C                     PARM *BLANK    @RTCD2  1                       S01117
     C                     PARM SBBOK     @BOOK   2                       S01117
     C                     PARM 'TP   '   @TRTP   5                       S01117
     C                     PARM BVDTDS    @SUTP   2                       S01117
     C                     PARM SBBRC     @BRAN   3                       S01117
     C                     PARM *BLANK    @DEPT   3                       S01117
     C                     PARM USRID     @USER  10                       S01117
     C                     PARM *BLANK    @ACOF   2                       S01117
     C                     PARM *BLANK    @CNUM   6                       S01117
     C                     PARM           @BPCCD  4                       S01117
     C                     MOVE @BPCCD    SBPCCD                          S01117
      *                                                                   S01117
      ** End of If Profit Centre Dft Matrix Used = 'Y' ( & BVTBRC='N')    S01117
      *                                                                   S01117
     C                     END                                            S01117
      *                                                                   S01117
      ** End of If/Else reconcile trade/book position profit centre.      S01117
      *                                                                   S01117
     C                     END                                            S01117
      *                                                                   S01117
      ** End of If profit centres used.                                   S01117
      *                                                                   S01117
     C                     END                                            S01117
     C*
     C******************************************************************* S01232
     C*  S01232 - MOVED FROM HERE TO BELOW                                S01232
     C******************************************************************* S01232
     C***********                                                         S01232
     C***Price***                                                         S01232
     C***********                                                         S01232
     C***********STBS      IFEQ 'D'                                       S01232
     C***********STBS      OREQ 'Y'                                       S01232
     C***********TPDY      IFNE *ZEROS                                    S01232
     C***********          EXSR ZNCD                                      S01232
     C***********          Z-ADDTPDY      ZPRCIN                          S01232
     C***********          Z-ADDTDVD      ZFDATE                          S01232
     C***********          EXSR ZPRCI                                     S01232
     C***********          Z-ADDZPRCOT    WPRIC                           S01232
     C***********                                                         S01232
     C***********          MOVE *BLANKS   ZFLD15                          S01232
     C***********          MOVE ZPRCOT    ZFLD15                          S01232
     C***********          Z-ADD8         ZDECS                           S01232
     C***********          MOVE *BLANK    ZECODE                          S01232
     C***********          EXSR ZSEDIT                                    S01232
     C***********          MOVE ZOUT21    SPRIC                           S01232
     C***********          END                                            S01232
     C***********          SETON                     12                   S01232
     C***********          END                                            S01232
     C***********                                                         S01232
     C******************************************************************* S01232
     C*  S01232 - END OF SECTION MOVED FROM HERE                          S01232
     C******************************************************************* S01232
     C*
     C*  Ex dividend
     C           PROT      IFEQ '4'
     C           PROT      OREQ '7'
     C                     SETON                     14
     C                     MOVE 'C'       SEXDV
     C*                                                                   S01510
     C** Field NDVD on PF/SECTYD is not maintained.  Next Dividend        S01510
     C** Date must be calculated here using new subroutine ZNDD.          S01510
     C** Even if NDVD is non-zero, must call ZNDD to obtain ex-date when  S01510
     C** S01510 is active                                                 S01510
     C*                                                                   S01510
     C           NDVD      IFEQ *ZEROS                                    S01510
     C           S01510    OREQ 'Y'                                       S01510
     C                     EXSR ZNDD                                      S01510
     C                     Z-ADDNDD       NDVD                            S01510
     C                     END                                            S01510
      *
     C           NDVD      IFEQ *ZEROS
     C                     MOVE 'C'       SEXDV
     C                     ELSE
     C*                                                                   S01510
     C                     SELEC                                          S01510
     C*                                                                   S01510
     C** If S01510 is active, retrieve from diary record                  S01510
     C*                                                                   S01510
     C           S01510    WHEQ 'Y'                                       S01510
     C                     Z-ADD0         ZDYNBR                          S01510
     C*                                                                   S01510
     C** If diary event found, use ex-date from it.                       S01510
     C*                                                                   S01510
     C           *IN99     IFEQ '0'                                       S01510
     C           SDSN      ANDEQSESN                                      S01510
     C                     Z-ADDSDXD      ZDYNBR                          S01510
     C                     ELSE                                           S01510
     C*                                                                   S01510
     C** Otherwise, calculate ex-date using default days from security.   S01510
     C*                                                                   S01510
     C                     MOVELEDFT      ZNRDYS                          S01510
     C           ZNRDYS    IFNE *ZEROS                                    S01510
     C                     MOVE EDFT      WEDFT   1                       S01510
     C           WEDFT     IFEQ 'W'                                       S01510
     C*    .. if working days                                             S01510
     C                     Z-ADDNDVD      ZDAYNO                          S01510
     C                     MOVE VLCY      ZCCY                            S01510
     C                     MOVE *BLANKS   ZLOC                            S01510
     C                     EXSR ZBKDT                                     S01510
     C                     ELSE                                           S01510
     C*    .. if actual days                                              S01510
     C           NDVD      SUB  ZNRDYS    ZDYNBR                          S01510
     C                     END                                            S01510
     C                     END                                            S01510
     C                     END                                            S01510
     C           TDDT      IFLT NDVD                                      S01510
     C           TDDT      ANDGEZDYNBR                                    S01510
     C           ZDYNBR    ANDNE0                                         S01510
     C                     MOVE 'X'       SEXDV                           S01510
     C                     END                                            S01510
     C*                                                                   S01510
     C** S01510 is not active, execute existing process                   S01510
     C*                                                                   S01510
     C           S01510    WHEQ 'N'                                       S01510
     C                     MOVELEDFT      ZNRDYS
      *
     C           ZNRDYS    IFNE *ZEROS
     C                     MOVE EDFT      WEDFT   1
      *
     C           WEDFT     IFEQ 'W'
     C*    .. if working days
     C                     Z-ADDNDVD      ZDAYNO
     C                     MOVE NMCYA     ZCCY
     C                     MOVE *BLANK    ZLOC                            S01195
     C***********          EXSR XDATE3                                    S01195
     C                     EXSR ZBKDT                                     S01195
     C                     ELSE
     C*    .. if actual days
     C           NDVD      SUB  ZNRDYS    ZDYNBR
     C                     END
     C*
     C***********TDVD      IFLT NDVD                                      S01510
     C***********TDVD      ANDGEZDYNBR                                    S01510
     C           TDDT      IFLT NDVD                                      S01510
     C           TDDT      ANDGEZDYNBR                                    S01510
     C                     MOVE 'X'       SEXDV
     C                     END
      *
     C                     END
     C                     ENDSL                                          S01510
     C                     END
     C                     END
     C*
     C*  Current factor
     C           PROT      IFEQ '8'
     C*
     C*********************MOVE TDSS      SDSN                            066046
     C                     MOVE SSESN     SDSN                            066046
     C                     MOVE 'MP'      SDET
     C*********************Z-ADDTDVD      SDED                            066046
     C/COPY WNCPYSRC,SE0090C027
     C                     Z-ADDTDDT      SDED                            066046
     C/COPY WNCPYSRC,SE0090C028
     C*
     C***********KLEVD     SETGTSEDEVDF2                                  S01158
     C***********          READPSEDEVDF2                 44               S01158
     C***********KLEVD     SETLLSEDEVDF2                           S01158 E20085
     C***********          READ SEDEVDF2                 44        S01158 E20085
     C           KLEVD     SETLLSEDEVDO                                   E20085
     C                     READ SEDEVDO                  44               E20085
     C           *IN44     IFEQ '0'
     C/COPY WNCPYSRC,SE0090C023
     C           SDSN      ANDEQTDSS
     C/COPY WNCPYSRC,SE0090C024
     C           SDET      ANDEQ'MP'
     C***********SDED      ANDLETDVD                                      E20085
     C                     Z-ADDSDCP      CFCT
     C                     END
     C*
     C           CFCT      IFNE *ZEROS
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE CFCT      ZFLD15
     C**********           Z-ADD8         ZDECS                           052254
     C                     Z-ADD9         ZDECS                           052254
     C                     MOVE *BLANK    ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    STCFC
     C                     END
      *
     C                     SETON                     15
     C                     END
     C*
     C           PROT      IFEQ '1'
     C           PROT      OREQ '3'
     C           PROT      OREQ '5'
     C           PROT      OREQ '6'
     C           PROT      OREQ '8'
     C           PROT      OREQ '9'                                       S01176
     C           STBS      IFEQ 'Y'
     C           STBS      OREQ 'P'
     C                     SETON                     11
     C*
     C*  Accrued Indicator
     C*    .. get next coupon date
      *                                                                                       CSE035
      ** ADJUST NUMBER OF DECIMAL PLACES FOR PRICE                                            CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
     C                     Z-ADDECD       SECD    50                                          CSE035
     C                     Z-ADDNCDD5     SNCDD5  50                                          CSE035
     C                     Z-ADDLCDD5     SLCDD5  50                                          CSE035
     C                     Z-ADDTDVD      ECD                                                 CSE035
      *                                                                                       CSE035
      ** CALL ZLCD + ZNCD TO DETERMINE NEXT AND LAST COUPON DATES                             CSE035
      *                                                                                       CSE035
     C                     Z-ADDNCD       @NCD    50                                          CSE035
     C                     EXSR ZNCD                                                          CSE035
     C                     Z-ADDNCD       NCDD5   50                                          CSE035
     C                     Z-ADD@NCD      NCD                                                 CSE035
     C                     Z-ADDZZLCD     @LCD    50                                          CSE035
     C           NCDD5     SUB  1         ZECD                                                CSE035
     C                     EXSR ZLCD                                                          CSE035
     C                     Z-ADDZZLCD     LCDD5   50                                          CSE035
     C                     Z-ADD@LCD      ZZLCD                                               CSE035
     C*                                                                                       CSE035
      *                                                                                       CSE035
      ** If TDVD is less than the FCPN, get the Last Coupon from the                          CSE035
      ** coupon array.                                                                        CSE035
      *                                                                                       CSE035
     C           TDVD      IFLT FCPN                                                          CSE035
     C                     EXSR ZLCD1                                                         CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     Z-ADDSECD      ECD                                                 CSE035
     C           TDVD      IFLT FCPN                                                          CSE035
     C           PROT      ANDEQ'1'                                                           CSE035
     C           ITLD      IFGE ZZLCD1                                                        CSE035
     C           NCDD5     IFNE FCPN                                                          CSE035
     C                     MOVE 'D'       SACIN                                               CSE035
     C                     ELSE                                                               CSE035
      *                                                                                       CSE035
      ** If Initial date coincides with the regular coupon date, it                           CSE035
      ** should be CUM.                                                                       CSE035
      *                                                                                       CSE035
     C           ITLD      IFEQ ZZLCD1                                                        CSE035
     C           NCDD5     ANDEQFCPN                                                          CSE035
     C                     MOVE 'C'       SACIN                                               CSE035
     C                     ELSE                                                               CSE035
      *                                                                                       CSE035
      ** If not, it should be 'NX'.                                                           CSE035
      *                                                                                       CSE035
     C                     MOVE 'N'       SACIN                                               CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
     C                     ELSE                                                               CSE035
     C                     MOVE 'D'       SACIN                                               CSE035
     C                     ENDIF                                                              CSE035
     C                     ELSE                                                               CSE035
     C*    .. get next coupon date                                                            CSE035
     C                     EXSR ZNCD                                                          CSE035
     C                     MOVE 'C'       SACIN                                               CSE035
     C           TDVD      IFEQ NCD                                                           CSE035
     C                     MOVE 'F'       SACIN                                               CSE035
     C                     ELSE                                                               CSE035
     C                     MOVELEDFT      ZNRDYS                                              CSE035
     C           ZNRDYS    IFNE *ZEROS                                                        CSE035
     C                     MOVE EDFT      WEDFT   1                                           CSE035
     C           WEDFT     IFEQ 'W'                                                           CSE035
     C*    .. if working days                                                                 CSE035
     C                     Z-ADDNCD       ZDAYNO                                              CSE035
     C                     MOVE NMCYA     ZCCY                                                CSE035
     C                     MOVE *BLANK    ZLOC                                                CSE035
     C                     EXSR ZBKDT                                                         CSE035
     C                     ELSE                                                               CSE035
     C*    .. if actual days                                                                  CSE035
     C           NCD       SUB  ZNRDYS    ZDYNBR                                              CSE035
     C                     ENDIF                                                              CSE035
     C           TDVD      IFLT NCD                                                           CSE035
     C           TDVD      ANDGEZDYNBR                                                        CSE035
     C           NCD       ANDNEMATY                                                          CSE035
     C                     MOVE 'X'       SACIN                                               CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
     C                     Z-ADDSNCDD5    NCDD5                                               CSE035
     C                     Z-ADDSLCDD5    LCDD5                                               CSE035
      *                                                                                       CSE035
     C                     ELSE                                                               CSE035
      *                                                                                       CSE035
     C/COPY WNCPYSRC,SE0090C010
     C                     EXSR ZNCD
     C                     MOVE 'C'       SACIN
      *
     C/COPY WNCPYSRC,SE0090C004
     C           TDVD      IFEQ NCD
     C/COPY WNCPYSRC,SE0090C005
     C                     MOVE 'F'       SACIN
     C                     ELSE
     C                     MOVELEDFT      ZNRDYS
     C           ZNRDYS    IFNE *ZEROS
     C                     MOVE EDFT      WEDFT   1
     C           WEDFT     IFEQ 'W'
     C*    .. if working days
     C                     Z-ADDNCD       ZDAYNO
     C                     MOVE NMCYA     ZCCY
     C                     MOVE *BLANK    ZLOC                            S01195
     C***********          EXSR XDATE3                                    S01195
     C                     EXSR ZBKDT                                     S01195
     C                     ELSE
     C*    .. if actual days
     C           NCD       SUB  ZNRDYS    ZDYNBR
     C                     END
      *
     C           TDVD      IFLT NCD
     C           TDVD      ANDGEZDYNBR
     C                     MOVE 'X'       SACIN
     C                     END
      *
     C                     END
     C                     END
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C/COPY WNCPYSRC,SE0090C011
     C*                                                                   088903
     C** Set up accrued indicator for schuldschein.                       088903
     C** (Schuldschein securities must be flatly traded)                  088903
     C*                                                                   088903
     C           PROT      IFEQ '6'                                       088903
     C                     MOVE 'F'       SACIN                           088903
     C                     END                                            088903
     C*
     C*  Days adjustment
     C           IADJ      IFNE *ZEROS
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE IADJ      ZFLD15
     C                     Z-ADD0         ZDECS
     C                     MOVE *BLANK    ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SDADJ
     C                     Z-ADDIADJ      DADJ
     C                     ELSE
     C                     Z-ADD*ZEROS    DADJ
     C                     END
     C*
     C*  Actual Difference indicator
     C           IADJ      IFNE *ZEROS
     C                     MOVE 'D'       SADIN
     C                     ELSE
     C                     MOVE *BLANK    SADIN
     C                     END
     C*
     C***Interest*amount***********************************************   E21713
     C***********          EXSR CPCINT                                    E20085
     C***********                                                         E21713
     C***********          Z-ADDNOMDP     CDP                      E20085 E21713
     C***********          MOVE SACIN     ZACIN                    E20125 E21713
     C***********          Z-ADDDADJ      ZDADJ                    E20125 E21713
     C***********          MOVE SADIN     ZADIN                    E20125 E21713
     C***********          EXSR ZPCINT                             E20085 E21713
     C***********                                                         E21713
     C***********          MOVE *BLANKS   ZFLD15                          E21713
     C***********          MOVE WPINT     ZFLD15                          E20085
     C***********          MOVE ZITRA     ZFLD15                   E20085 E21713
     C***********          Z-ADDNOMDP     ZDECS                           E21713
     C***********          MOVE *BLANK    ZECODE                          E21713
     C***********          EXSR ZSEDIT                                    E21713
     C***********          MOVE ZOUT21    SITRA                           E21713
     C***********          MOVE WPINT     ORGIT                           E20085
     C***********          MOVE ZITRA     ORGIT                    E20085 E21713
     C*
     C*  Coupon rate
     C                     MOVE *BLANKS   ZFLD15                          E20522
     C                     MOVE SESN      SDSN                            E20522
     C                     MOVE 'IR'      SDET                            E20522
     C                     Z-ADDTDVD      SDED                            E20522
     C           KLEVD     SETLLSEDEVDO                                   E20522
     C                     READ SEDEVDO                  44               E20522
     C           *IN44     IFEQ '0'                                       E20522
     C           SDSN      ANDEQSESN                                      E20522
     C           SDET      ANDEQ'IR'                                      E20522
     C                     Z-ADDSDNC      TDCR                            E20522
     C                     MOVE SDNC      ZFLD15                          E20522
     C                     ELSE                                           E20522
     C                     Z-ADDCPNR      TDCR                            E20522
     C                     MOVE CPNR      ZFLD15                          E20522
     C                     END                                            E20522
     C*                                                                   E20522
     C                     Z-ADD7         ZDECS                           E20522
     C                     MOVE *BLANK    ZECODE                          E20522
     C                     EXSR ZSEDIT                                    E20522
     C                     MOVE ZOUT21    SCPNR                           E20522
     C***********CPNR      IFNE *ZEROS                                    E20522
     C***********          MOVE *BLANKS   ZFLD15                          E20522
     C***********          MOVE CPNR      ZFLD15                          E20522
     C***********          Z-ADD7         ZDECS                           E20522
     C***********          MOVE *BLANK    ZECODE                          E20522
     C***********          EXSR ZSEDIT                                    E20522
     C***********          MOVE ZOUT21    SCPNR                           E20522
     C***********          END                                            E20522
     C*                                                                   E21713
     C*  Interest amount                                                  E21713
     C*                                                                   E21713
     C***********          Z-ADDNOMDP     CDP                       E21713S01117
     C                     Z-ADDNOMDP     ZCDP                            S01117
     C                     MOVE SACIN     ZACIN                           E21713
     C                     Z-ADDDADJ      ZDADJ                           E21713
     C                     MOVE SADIN     ZADIN                           E21713
     C/COPY WNCPYSRC,SE0090CP17                                           S01408
     C                     EXSR ZPCINT                                    E21713
     C/COPY WNCPYSRC,SE0090CP18                                           S01408
     C*                                                                   E21713
     C                     MOVE *BLANKS   ZFLD15                          E21713
     C           PROT      IFEQ '6'                                       088903
     C                     MOVE *ZEROS    ZFLD15                          088903
     C                     ELSE                                           088903
     C                     MOVE ZITRA     ZFLD15                          E21713
     C                     ENDIF                                          088903
     C                     Z-ADDNOMDP     ZDECS                           E21713
     C                     MOVE *BLANK    ZECODE                          E21713
     C                     EXSR ZSEDIT                                    E21713
     C                     MOVE ZOUT21    SITRA                           E21713
     C                     MOVE ZITRA     ORGIT                           E21713
     C*
     C                     END
     C                     END
      *
     C           *IN11     IFEQ '0'
     C***********          Z-ADD*ZEROS    WPINT                           E20085
     C                     Z-ADD*ZEROS    ORGIT
     C                     END
     C*
     C******************************************************************* S01232
     C*  S01232 - MOVED HERE FROM ABOVE AND AUSTRALIAN PROCESSING ADDED   S01232
     C******************************************************************* S01232
     C*                                                                   S01232
     C*  Price                                                            S01232
     C*                                                                   S01232
     C           STBS      IFEQ 'D'                                       S01232
     C           STBS      OREQ 'Y'                                       S01232
     C           TPDY      IFNE *ZEROS                                    S01232
     C                     EXSR ZNCD                                      S01232
     C                     Z-ADDTPDY      ZPRCIN                          S01232
     C                     Z-ADDTDVD      ZFDATE                          S01232
     C*                                                                   S01232
     C*     SET UP PARAMETERS FOR AUSTRALIAN YIELDS                       S01232
     C*            cum/ex parameter                                       S01232
     C*                                                                   S01232
     C/COPY WNCPYSRC,SE0090C012
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
     C                     MOVE SACIN     SCUMEX                                              CSE035
     C                     ELSE                                                               CSE035
      *                                                                                       CSE035
     C           SACIN     IFEQ 'X'                                       S01232
     C                     MOVE 'X'       SCUMEX                          S01232
     C                     ELSE                                           S01232
     C                     MOVE 'C'       SCUMEX                          S01232
     C                     END                                            S01232
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C/COPY WNCPYSRC,SE0090C013
     C*                                                                   S01232
     C*            calculate PI as a fraction of nominal                  S01232
     C*                                                                   S01232
     C           ZITRA     DIV  WRKNM     WRKPI                           S01232
     C*                                                                   S01232
     C/COPY WNCPYSRC,SE0090CP13                                           S01408
     C*                                                                   S01408
     C                     Z-ADDNOML      ZNOML                           E39495
     C                     EXSR ZPRCI                                     S01232
      *                                                                                       CSE037
      ** apply Countervalue rounding if applicable                                            CSE037
      *                                                                                       CSE037
     C           CSE037    IFEQ 'Y'                                                           CSE037
      *                                                                                       CSE037
     C                     Z-ADDCFCT      W#CFCT                                              CSE037
      *                                                                                       CSE037
      *  +--                                                     --+                          CSE037
      *  |        Countervalue Rounding                            |                          CSE037
      *  | ==============================                          |                          CSE037
      *  |        Countervalue Rounding   works by calculating a   |                          CSE037
      *  | temporary Countervalue and getting an adjusting factor  |                          CSE037
      *  | to the value of the Rounded   amount.                   |                          CSE037
      *  | This Adjusting factor is then applied to the Price      |                          CSE037
      *  | so that when the actual Countervalue is calculated the  |                          CSE037
      *  | Rounded   portion has been added to the Consideration   |                          CSE037
      *  | via the Price.                                          |                          CSE037
      *  +--                                                     --+                          CSE037
      *                                                                                       CSE037
      *                                                                                       CSE037
      ** Define Inputs                                                                        CSE037
      *                                                                                       CSE037
     C                     Z-ADDW#CFCT    W#CFCT 109                                          CSE037
      *                                                                                       CSE037
      ** Only preform Rounding on Discount or Yield Basis                                     CSE037
      *                                                                                       CSE037
     C           STBS      IFEQ 'D'                                                           CSE037
     C           STBS      OREQ 'Y'                                                           CSE037
      *                                                                                       CSE037
     C           CSE037    IFEQ 'Y'                              =Y                           CSE037
      *                                                                                       CSE037
      ** Calculate Consideration                                                              CSE037
      *                                                                                       CSE037
     C           ZNOML     MULT ZPRCOT    W#CNTR 205                                          CSE037
     C                     DIV  100       W#CNTR    H                                         CSE037
      *                                                                                       CSE037
      ** Adjust for IAB and CF                                                                CSE037
      *                                                                                       CSE037
      ** Add in Interest                                                                      CSE037
      *                                                                                       CSE037
     C           PROT      IFNE '6'                                                           CSE037
     C                     ADD  ZITRA     W#CNTR                                              CSE037
     C                     ENDIF                                                              CSE037
      *                                                                                       CSE037
      ** Convert Countervalue to an expression of price                                       CSE037
      *                                                                                       CSE037
     C           W#CNTR    MULT 100       W#205  205                                          CSE037
     C           W#205     DIV  ZNOML     W#PRC  158                                          CSE037
      *                                                                                       CSE037
      ** Adjust Countervalue price using Standard Routine                                     CSE037
      *                                                                                       CSE037
     C                     MOVE SSESN     ZSESN  10                                           CSE037
     C                     Z-ADDW#PRC     ZINPF  158                                          CSE037
     C                     Z-ADD*ZEROS    ZOUTF  158                                          CSE037
      *                                                                                       CSE037
     C                     CALL 'SEADJPRI'                                                    CSE037
     C                     PARM *BLANKS   @RTCD                                               CSE037
     C                     PARM ZSESN     @SEKEY 10                                           CSE037
     C           ZINPF     PARM ZINPF     @INAMT 158                                          CSE037
     C           ZOUTF     PARM ZOUTF     @OUAMT 158                                          CSE037
      *                                                                                       CSE037
      ** Convert Rounded price to a Countervalue                                              CSE037
      *                                                                                       CSE037
     C           ZOUTF     MULT ZNOML     W#CNT1 205                                          CSE037
     C                     DIV  100       W#CNT1                                              CSE037
      *                                                                                       CSE037
      ** Calculate Rounded portion Adjusting factor (of Price)                                CSE037
      *                                                                                       CSE037
     C           W#CNTR    SUB  W#CNT1    W#DIFF 205                                          CSE037
     C                     MULT 100       W#DIFF                                              CSE037
     C           W#DIFF    DIV  ZNOML     W#ADJT 158H                                         CSE037
      *                                                                                       CSE037
      ** Adjust for IAB and CF                                                                CSE037
      *                                                                                       CSE037
      ** Apply adjusting factor to Price                                                      CSE037
      *                                                                                       CSE037
     C                     SUB  W#ADJT    ZPRCOT                                              CSE037
      *                                                                                       CSE037
     C                     ENDIF                                 =Y                           CSE037
      *                                                                                       CSE037
     C                     ENDIF                           DSCNT/YIELD                        CSE037
      *                                                                                       CSE037
      *  > End of        Rounding <                                                           CSE037
      *  --------------------------                                                           CSE037
      *                                                                                       CSE037
      *                                                                                       CSE037
     C                     ENDIF                                                              CSE037
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0090CP14                                           S01408
     C*                                                                   S01408
      *                                                                                       CSE035
      ** ADJUST NUMBER OF DECIMAL PLACES FOR PRICE                                            CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
      ** ADJUST PRICE : PRICE + PUR INT BEFORE ROUNDING                                       CSE035
      *                                                                                       CSE035
     C           NCD       IFGE MATY                                                          CSE035
     C           SYBS      ANDEQ'AU'                                                          CSE035
     C                     Z-ADDZPRCOT    ZPRCOT                                              CSE035
     C                     ELSE                                                               CSE035
     C           SYBS      IFNE 'AU'                                                          CSE035
     C           SYBS      ANDNE'DA'                                                          CSE035
     C           STBS      ANDEQ'Y'                                                           CSE035
     C           ZPRCOT    ADD  ZWAMT     ZPRCOT                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
     C           NCD       IFGE MATY                                                          CSE035
     C           SYBS      ANDEQ'AU'                                                          CSE035
     C                     ELSE                                                               CSE035
      *                                                                                       CSE035
     C           SYBS      IFNE 'AU'                                                          CSE035
     C           SYBS      ANDNE'DA'                                                          CSE035
     C           STBS      ANDEQ'Y'                                                           CSE035
     C           ZPRCOT    SUB  PURINT    ZPRCOT                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     Z-ADDZPRCOT    WPRIC                           S01232
     C*                                                                   S01232
     C                     MOVE *BLANKS   ZFLD15                          S01232
     C                     MOVE ZPRCOT    ZFLD15                          S01232
     C                     Z-ADD8         ZDECS                           S01232
     C                     MOVE *BLANK    ZECODE                          S01232
     C                     EXSR ZSEDIT                                    S01232
     C                     MOVE ZOUT21    SPRIC                           S01232
     C                     END                                            S01232
      *
     C                     SETON                     12                   S01232
     C                     END                                            S01232
     C*                                                                   S01232
     C******************************************************************* S01232
     C*  S01232 - END CODE MOVED HERE FROM ABOVE                          S01232
     C******************************************************************* S01232
      *                                                                                       CAS006
      ** If CAS006 is on and 2nd screen is called after display                               CAS006
      ** of 3rd screen (F12 pressed from screen 3), reload                                    CAS006
      ** previous screen field values.                                                        CAS006
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C           WSCRN2    ANDEQ*ON                                                           CAS006
     C                     MOVE SCR2BK    SCRFM2                                              CAS006
     C                     ENDIF                                                              CAS006
     C*
     C*  Save fields
     C*
     C                     MOVE STDVD     SAVVD
     C                     MOVE STMKC     SAVMC
     C                     MOVE STDDT     SAVTD
     C                     MOVE STSUB     SAVTS
     C                     MOVE STDMI     SAVMI
     C                     MOVE SPRIC     SAVPR
     C                     MOVE SAIIP     SAVAI
     C                     MOVE SEXDV     SAVEX
     C                     MOVE SACIN     SAVAC
     C                     MOVE SDADJ     SAVDA
     C                     MOVE SADIN     SAVAD
     C                     MOVE SITRA     SAVIT
     C***********          MOVE SCPNR     SAVCR                           E20522
     C                     MOVE STDDT     SAVT2
     C                     MOVE STDVD     SAVV2
     C*
     C           D2END     ENDSR                           *** D2END  ***
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  D2PROC - Subroutine to process Screen Format 2.              *
      *                                                               *
      *****************************************************************
      *
     C           D2PROC    BEGSR                           *** D2PROC ***
     C*
     C                     SETOF                     31
     C*
     C                     MOVE 'Y'       FIRST   1
     C*
     C           *IN31     DOUEQ'1'
     C*
     C*  Display screen
     C*
     C                     MOVEAER1       ER1MSG
     C                     MOVEAER2       ER2MSG
     C                     EXFMTSE0090F0
      *                                                                   S01117
      ** If screen redisplay is due to ? prompt then set on screen        S01117
      ** change indicator.                                                S01117
      *                                                                   S01117
     C           @SEL      IFEQ 1                                         S01117
     C                     MOVE '1'       *IN,22                          S01117
     C                     END                                            S01117
      *                                                                   S01117
      ** Check for '?'s                                                   S01117
      *                                                                   S01117
     C                     EXSR CHKSL2                                    S01117
     C*
     C*  If F3 then exit program
     C*
     C           *IN01     IFEQ '1'
     C                     SETON                     31
     C*
     C                     ELSE
     C***If*HELP*then*call*help*routine*program************************   S01199
     C***********                                                         S01199
     C********** *IN06     IFEQ '1'                                       S01199
     C**********           MOVEAER1       ERR,1                           S01199
     C**********           MOVEAER2       ERR,20                          S01199
     C**********           CALL 'MHELP'                                   S01199
     C**********           PARM           DBPGM                           S01199
     C**********           PARM           ERR                             S01199
     C**********           ELSE                                           S01199
      *
      **  IF BEEN THROUGH AT LEAST ONCE, ALL ERRORS ARE WARNING ERRORS,
      **  AND NO SCREEN CHANGES, DO THE UPDATE, NO NEED TO VALIDATE.
      *
     C           *IN05     IFEQ '0'
     C           C1        ADD  C2        WWCC    40
      *
     C           FIRST     IFEQ 'N'
     C           WEC       ANDEQWWCC
     C           *IN22     ANDEQ'0'
     C           @SEL      ANDEQ0                                         S01117
      *
     C***********RPMD      IFEQ 'Y'                                       S01117
     C           BVREDE    IFEQ 'Y'                                       S01117
     C           RCAL      ANDNE'Y'
     C***********RPMD      ORNE 'Y'                                       S01117
     C           BVREDE    ORNE 'Y'                                       S01117
     C                     SETON                     31
     C                     MOVE *BLANKS   ER1
     C                     MOVE *BLANKS   ER1MSG
     C                     MOVE *BLANKS   ER2
     C                     MOVE *BLANKS   ER2MSG
     C                     Z-ADD0         C1      20
     C                     Z-ADD0         C2      20
     C                     Z-ADD0         WEC
     C                     MOVE 'N'       RCAL
     C                     SETOF                     343637               S01176
     C                     SETOF                       43                 S01176
     C                     MOVEA'0000'    *IN,46                          S01176
     C                     MOVEA'00000000'*IN,60
     C                     MOVEA'00000000'*IN,68
     C                     MOVEA'00000000'*IN,76
     C                     MOVEA'0000000' *IN,84
     C                     SETOF                     3839
     C                     SETOF                     1618                 E47501
     C***********          END                                            S01158
     C                     GOTO UPD1
     C                     END                                            S01158
      *
     C                     END
     C                     END
     C*
     C*    .. Reset indicators
     C*
     C                     MOVE *BLANKS   ER1
     C                     MOVE *BLANKS   ER1MSG
     C                     MOVE *BLANKS   ER2
     C                     MOVE *BLANKS   ER2MSG
     C                     Z-ADD0         C1      20
     C                     Z-ADD0         C2      20
     C                     Z-ADD0         WEC
     C                     MOVE 'N'       RCAL
     C                     SETOF                     343637               S01176
     C                     SETOF                       43                 S01176
     C                     MOVEA'0000'    *IN,46                          S01176
     C                     MOVEA'00000000'*IN,60
     C                     MOVEA'00000000'*IN,68
     C                     MOVEA'00000000'*IN,76
     C                     MOVEA'0000000' *IN,84
     C                     SETOF                     3839
     C                     SETOF                     1618                 E47501
     C*
     C*  If F12 then return to screen 1
     C*
     C           *IN05     IFEQ '1'
     C                     SETON                     31
     C*
     C*    else validate data
     C*  ... if all "?"s have been processed.                             S01117
     C*
     C                     ELSE
     C*
     C                     MOVE 'N'       FIRST                           S01117
     C           @SEL      IFEQ 0                                         S01117
     C                     EXSR D2VALD
      *
     C***********          MOVE 'N'       FIRST                           S01117
     C*
     C*  If no errors, check if redisplay required
     C*
     C           C1        IFEQ 0
      *
     C***********RPMD      IFEQ 'Y'                                       S01117
     C           BVREDE    IFEQ 'Y'                                       S01117
     C           RCAL      ANDNE'Y'
     C***********RPMD      ORNE 'Y'                                       S01117
     C           BVREDE    ORNE 'Y'                                       S01117
     C                     SETON                     31
     C                     END
      *
     C                     ELSE
     C                     SETON                     38
     C                     END
      *
     C           C2        IFGT 0
     C                     SETON                     39
     C                     END
     C*
     C           UPD1      TAG
      *                                                                   S01117
      ** End of IF @SEL=1                                                 S01117
      *                                                                   S01117
     C                     END                                            S01117
     C*
     C**********           END                                            S01199
     C                     END
     C                     END
     C                     END
     C*
      ** If CAS006 is on, switch off screen 2 indicator after                                 CAS006
      ** processing and back up screen 2 field values.                                        CAS006
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     MOVE *OFF      *IN10                                               CAS006
     C                     MOVE SCRFM2    SCR2BK                                              CAS006
     C                     ENDIF                                                              CAS006
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  D2VALD - Subroutine to Validate Screen 2 data entry.         *
      *                                                               *
      *****************************************************************
      *
     C           D2VALD    BEGSR                           *** D2VALD ***
      *                                                                   S01117
      ** Profit Centres, if used                                          S01117
      *                                                                   S01117
     C           BKPRCU    IFEQ 'Y'                                       S01117
      *                                                                   S01117
      ** Selling Profit Centre, if not protected                          S01117
      *                                                                   S01117
     C           *IN23     IFEQ '0'                                       S01117
      *                                                                   E47501
      ** If Profit Centre not blank                                       E47501
      *                                                                   E47501
     C           SSPCCD    IFNE *BLANKS                                   E47501
      *                                                                   S01117
      ** Access Profit Centres file                                       S01117
      *                                                                   S01117
     C                     CALL 'AOPRFCR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SSPCCD    @PCCD   4                       S01117
     C           SDPRFC    PARM SDPRFC    DSFDY                           S01117
     C           @RTCD     IFNE *BLANK                                    S01117
     C                     MOVE ' 243'    WERR                            S01117
     C                     EXSR ERRORS                                    S01117
     C                     MOVE '1'       *IN16                           S01117
     C                     END                                            S01117
      *                                                                   CAC002
      ** Else if Sale Profit Centre is equal to blanks                    CAC002
      *                                                                   CAC002
     C                     ELSE                                           CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE ' 245'    WERR                            CAC002
     C                     EXSR ERRORS                                    CAC002
     C                     MOVE '1'       *IN16                           CAC002
     C                     ENDIF                                          CAC002
      *                                                                   E47501
     C                     END                                            E47501
      *                                                                   S01117
     C                     END                                            S01117
      *                                                                   S01117
      ** Buying Profit Centre, if not protected                           S01117
      *                                                                   S01117
     C           *IN24     IFEQ '0'                                       S01117
      *                                                                   E47501
      ** If Profit Centre not blank                                       E47501
      *                                                                   E47501
     C           SBPCCD    IFNE *BLANKS                                   E47501
      *                                                                   S01117
      *                                                                   S01117
      ** Access Profit Centres file                                       S01117
      *                                                                   S01117
     C                     CALL 'AOPRFCR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SBPCCD    @PCCD   4                       S01117
     C           SDPRFC    PARM SDPRFC    DSFDY                           S01117
     C           @RTCD     IFNE *BLANK                                    S01117
     C                     MOVE ' 244'    WERR                            S01117
     C                     EXSR ERRORS                                    S01117
     C                     MOVE '1'       *IN18                           S01117
     C                     END                                            S01117
      *                                                                   CAC002
      ** Else if Purchase Profit Centre is equal to blanks.               CAC002
      *                                                                   CAC002
     C                     ELSE                                           CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE ' 246'    WERR                            CAC002
     C                     EXSR ERRORS                                    CAC002
     C                     MOVE '1'       *IN18                           CAC002
     C                     ENDIF                                          CAC002
      *                                                                   E47501
     C                     END                                            E47501
      *                                                                   S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     END                                            S01117
      *                                                                   CAC005
      ** If CAC005 is installed and selling and buying profit centres     CAC005
      ** are both valid                                                   CAC005
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C           *IN16     ANDEQ*OFF                                      CAC005
     C           *IN18     ANDEQ*OFF                                      CAC005
      *                                                                   CAC005
      ** Check if selling book-selling profit centre combination is       CAC005
      ** valid                                                            CAC005
      *                                                                   CAC005
     C                     CALL 'AOBKPCR0'                                CAC005
     C                     PARM *BLANKS   PRTCD                           CAC005
     C                     PARM '*PSEUDO' POPTN                           CAC005
     C                     PARM SSBOK     PBOOK   2                       CAC005
     C                     PARM SSPCCD    PPRFC   4                       CAC005
     C                     PARM           PPSBK   2                       CAC005
      *                                                                   CAC005
     C           PRTCD     IFNE *BLANKS                                   CAC005
     C                     MOVE ' 620'    WERR                            CAC005
     C                     EXSR ERRORS                                    CAC005
     C                     MOVE *ON       *IN16                           CAC005
     C                     ELSE                                           CAC005
     C                     MOVELPPSBK     WSPSBK  2                       CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
      ** Check if buying book-buying profit centre combination is         CAC005
      ** valid                                                            CAC005
      *                                                                   CAC005
     C                     CALL 'AOBKPCR0'                                CAC005
     C                     PARM *BLANKS   PRTCD                           CAC005
     C                     PARM '*PSEUDO' POPTN                           CAC005
     C                     PARM SBBOK     PBOOK   2                       CAC005
     C                     PARM SBPCCD    PPRFC   4                       CAC005
     C                     PARM           PPSBK   2                       CAC005
      *                                                                   CAC005
     C           PRTCD     IFNE *BLANKS                                   CAC005
     C                     MOVE ' 621'    WERR                            CAC005
     C                     EXSR ERRORS                                    CAC005
     C                     MOVE *ON       *IN18                           CAC005
     C                     ELSE                                           CAC005
     C                     MOVELPPSBK     WBPSBK  2                       CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
      ** If both selling and buying profit centres are still valid,       CAC005
      ** Check if selling branch=buying branch and workfield-sell-        CAC005
      ** pseudo book=workfield-buy-pseudo book                            CAC005
      *                                                                   CAC005
     C           *IN16     IFEQ *OFF                                      CAC005
     C           *IN18     ANDEQ*OFF                                      CAC005
      *                                                                   CAC005
     C           SSBRC     IFEQ SBBRC                                     CAC005
     C           WSPSBK    ANDEQWBPSBK                                    CAC005
     C                     MOVE ' 109'    WERR                            CAC005
     C                     EXSR ERRORS                                    CAC005
     C                     MOVE *ON       *IN16                           CAC005
     C                     MOVE *ON       *IN18                           CAC005
     C                     ENDIF                                          CAC005
     C                     ENDIF                                          CAC005
     C                     ENDIF                                          CAC005
     C*
     C* Value Date
     C*
     C*    .. if amended, must be a valid date
     C*
     C           STDVD     IFNE SAVVD
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSTDVD     ZFIELD
     C                     Z-ADD*ZEROS    ZADEC
     C                     Z-ADD6         ZADIG
     C                     EXSR ZALIGN
      *
     C           *IN99     IFEQ '0'
     C                     MOVE ZFIELD    ZDATE
     C                     EXSR ZDATE1
     C                     END
      *
     C           *IN99     IFEQ '1'
     C                     MOVE ' 117'    WERR
     C                     EXSR ERRORS
     C                     SETON                     60
     C                     ELSE
     C                     Z-ADDZDAYNO    TDVD
     C*                                                                   E20085
     C*    Update Event Control Date with Value Date                      E20085
     C*                                                                   E20085
     C                     Z-ADDTDVD      ECD                             E20085
     C*
     C*    .. if amended must not be after maturity date of before
     C*                                    issue date of the security
     C           MATY      IFNE *ZEROS
     C           TDVD      ANDGTMATY
     C           TDVD      ORLT ISSD
     C                     MOVE ' 118'    WERR
     C                     EXSR ERRORS
     C                     SETON                     60
     C                     END
     C*
     C*    .. if amended and less than run date, must fall within back
     C*                                     value period on TABTB36
     C***********RUND      SUB  BKVP      WBKVP                           S01117
     C           RUND      SUB  BVBVP     WBVP                            S01117
     C           TDVD      IFLT RUND
     C***********TDVD      ANDLTWBKVP                                     S01117
     C           TDVD      ANDLTWBVP                                      S01117
     C                     MOVE ' 119'    WERR
     C                     EXSR ERRORS
     C                     SETON                     60
     C                     ELSE
     C*
     C*    .. if amended and security is partly paid, must be later
     C*                                  than the most recent call date
     C           PPDI      IFEQ 'Y'
     C           TDVD      ANDLESLCA
     C                     MOVE ' 119'    WERR
     C                     EXSR ERRORS
     C                     SETON                     60
     C                     END
      *
     C                     END
     C*
     C*    .. if amended must not be a holiday in value currency
     C*    .. If S01509 is active, must not be a holiday in nominal ccy   S01509
     C*
     C***********STDVD     IFNE SAVV2
     C                     MOVE STDVD     SAVV2
     C                     Z-ADDTDVD      ZDAYNO
     C           S01509    IFEQ 'Y'                                       S01509
     C                     MOVE NMCYA     ZCCY                            S01509
     C                     ELSE                                           S01509
     C                     MOVE VLCY      ZCCY
     C                     END                                            S01509
     C                     MOVE *BLANK    ZLOC                            S01195
     C***********          EXSR ZDATE5                                    S01195
     C                     EXSR ZCHKH                                     S01195
      *
     C************IN99     IFEQ '1'                                       S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C                     MOVE ' W02'    WERR
     C                     ADD  1         WEC
     C                     EXSR ERRORS
     C                     SETON                     60
     C***********          ELSE                                           S01509
     C***********                                                         S01509
     C*****..*if*amended*must*not*be*a*holiday*in*payment*currency*****   S01509
     C***********                                                         S01509
     C***********          Z-ADDTDVD      ZDAYNO                          S01509
     C***********          MOVE SPYC      ZCCY                            S01509
     C***********          MOVE *BLANK    ZLOC                     S01195 S01509
     C***********          EXSR ZDATE5                                    S01195
     C***********          EXSR ZCHKH                              S01195 S01509
      ***********                                                         S01509
     C************IN99     IFEQ '1'                                       S01195
     C***********ZIND      IFEQ 'H'                                S01195 S01509
     C***********          MOVE ' W02'    WERR                            S01509
     C***********          ADD  1         WEC                             S01509
     C***********          EXSR ERRORS                                    S01509
     C***********          SETON                     60                   S01509
     C***********          END                                            S01509
      ***********                                                         S01509
     C                     END
     C***********          END
     C                     END
     C                     END
     C*
     C* Reallowance
     C*
     C*    .. if entered, must be a valid amount
     C*
     C           SRALL     IFNE *BLANKS
     C           STBS      IFEQ 'Y'                                       E21115
     C                     MOVE ' 242'    WERR                            E21115
     C                     EXSR ERRORS                                    E21115
     C                     SETON                     62                   E21115
     C                     END                                            E21115
      *
     C                     MOVE *BLANKS   ZFLD17
     C                     MOVELSRALL     ZFLD17
     C                     Z-ADD4         ZSDIG
     C                     Z-ADD5         ZSDEC
     C                     EXSR ZASIGN
      *
     C           *IN99     IFEQ '1'
     C                     MOVE ' 201'    WERR
     C                     EXSR ERRORS
     C                     SETON                     62
     C                     END
      *
     C                     END
     C*
     C* Market centre
     C*
     C*    .. if amended, must be a valid code
     C*
     C           STMKC     IFNE SAVMC
     C           STMKC     ANDNE*BLANKS
     C           STMKC     CHAINSEMKCDF              44
      *
     C           *IN44     IFEQ '1'
     C           *IN44     OREQ '0'
     C           RECI      ANDEQ'*'
     C                     MOVE ' 202'    WERR
     C                     EXSR ERRORS
     C                     SETON                     61
     C                     END
      *
     C                     END
     C*
     C* Capacity
     C*
     C*    .. if entered, must be in the range 1 - 6
     C*
     C           STCAP     IFNE *BLANKS
     C           STCAP     IFLT '1'
     C           STCAP     ORGT '6'
     C                     MOVE ' 203'    WERR
     C                     EXSR ERRORS
     C                     SETON                     65
     C                     END
     C                     END
     C*                                                                   S01232
     C********************************************************************S01232
     C*  S01232 - CODE MOVED FURTHER DOWN                                 S01232
     C********************************************************************S01232
     C***********                                                         S01232
     C**Price****                                                         S01232
     C***********                                                         S01232
     C*****..*if*amended, must be a valid amount                          S01232
     C***********                                                         S01232
     C********** *IN12     IFEQ '1'                                       S01232
     C***********SPRIC     ANDNESAVPR                                     S01232
     C***********          MOVE SPRIC     SAVPR                           S01232
     C***********          MOVE *BLANKS   ZFLD17                          S01232
     C***********          MOVELSPRIC     ZFLD17                          S01232
     C***********          Z-ADD7         ZSDIG                           S01232
     C***********          Z-ADD8         ZSDEC                           S01232
     C***********          EXSR ZASIGN                                    S01232
     C********** *IN99     IFEQ '1'                                       S01232
     C***********          MOVE ' 204'    WERR                            S01232
     C***********          EXSR ERRORS                                    S01232
     C***********          SETON                     63                   S01232
     C***********          ELSE                                           S01232
     C***********          MOVE SPRIC     SAVPR                           S01232
     C***********          MOVE ZOUT15    PRIC                            S01232
     C***********ZFSIGN    IFEQ '-'                                       S01232
     C***********          Z-SUBPRIC      PRIC                            S01232
     C***********          END                                            S01232
     C* *********                                                         S01232
     C*****..*must be within 10% of calculated price                      S01232
     C***********                                                         S01232
     C***********          EXSR ZNCD                                      S01232
     C***********          MOVE PRIC      ZPRCIN                          S01232
     C***********          Z-ADDTDVD      ZFDATE                          S01232
     C***********          EXSR ZPRCI                                     S01232
     C***********          Z-ADDZPRCOT    PRIC                            S01232
     C***********WPRIC     DIV  10        APWRK1                          S01232
     C***********WPRIC     ADD  APWRK1    APWRK2                          S01232
     C***********ZPRCOT    IFGT APWRK2                                    S01232
     C***********          MOVE ' W03'    WERR                            S01232
     C***********          ADD  1         WEC                             S01232
     C***********          EXSR ERRORS                                    S01232
     C***********          SETON                     63                   S01232
     C***********          ELSE                                           S01232
     C***********                                                         S01232
     C***********WPRIC     SUB  APWRK1    APWRK2                          S01232
     C***********ZPRCOT    IFLT APWRK2                                    S01232
     C***********          MOVE ' W03'    WERR                            S01232
     C***********          ADD  1         WEC                             S01232
     C***********          EXSR ERRORS                                    S01232
     C***********          SETON                     63                   S01232
     C***********          END                                            S01232
     C***********          END                                            S01232
     C***********          END                                            S01232
     C***********          END                                            S01232
     C***********                                                         S01232
     C********************************************************************S01232
     C*  S01232 - END OF CODE MOVED FURTHER DOWN                          S01232
     C********************************************************************S01232
     C*
     C* Ex dividend
     C*
     C*    .. if amended, must be 'C' or 'X'
     C*
     C           *IN14     IFEQ '1'
     C           SEXDV     ANDNESAVEX
     C           SEXDV     ANDNE'C'
     C           SEXDV     ANDNE'X'
     C                     MOVE ' 205'    WERR
     C                     EXSR ERRORS
     C                     SETON                     64
     C                     END
     C*
     C* Trade date
     C*
     C*    .. if amended, must be a valid date
     C*
     C           STDDT     IFNE SAVTD
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSTDDT     ZFIELD
     C                     Z-ADD*ZEROS    ZADEC
     C                     Z-ADD6         ZADIG
     C                     EXSR ZALIGN
      *
     C           *IN99     IFNE '1'
     C                     MOVE ZFIELD    ZDATE
     C                     EXSR ZDATE1
     C                     END
      *
     C           *IN99     IFEQ '1'
     C                     MOVE ' 209'    WERR
     C                     EXSR ERRORS
     C                     SETON                     67
     C                     ELSE
     C                     Z-ADDZDAYNO    TDDT
     C*
     C*    .. if amended, must not be greater than run date
     C*
     C           TDDT      IFGT RUND
     C                     MOVE ' 206'    WERR
     C                     EXSR ERRORS
     C                     SETON                     67
     C                     END
     C*
     C*    .. if amended, must not be greater than value date
     C*
     C           TDDT      IFGT TDVD
     C                     MOVE ' 207'    WERR
     C                     EXSR ERRORS
     C                     SETON                     67
     C                     END
     C*
     C*    .. if amended, must not be earlier than back value period
     C*
     C***********RUND      SUB  BKVP      WBKVP                           S01117
     C***********TDDT      IFLT WBKVP                                     S01117
     C           RUND      SUB  BVBVP     WBVP                            S01117
     C           TDDT      IFLT WBVP                                      S01117
     C                     MOVE ' 208'    WERR
     C                     EXSR ERRORS
     C                     SETON                     67
     C                     END
      *
     C           *IN67     IFEQ '0'
     C                     MOVE STDDT     SAVTD
     C                     END
     C*
     C*    .. if amended, must not be a holiday in local currency
     C*
     C***********STDDT     IFNE SAVT2
     C                     MOVE STDDT     SAVT2
     C                     Z-ADDTDDT      ZDAYNO
     C***********          MOVE LOCY      ZCCY                            S01117
     C***********          EXSR ZDATE5                                    S01195
     C************IN99     IFEQ '1'                                       S01195
     C                     MOVE BJLCCY    ZCCY                            S01117
      *                                                                   S01195
      ** (check selling location)                                         S01195
      *                                                                   S01195
     C                     MOVE @SLCCD    ZLOC                            S01195
     C                     EXSR ZCHKH                                     S01195
     C           ZIND      IFEQ ' '                                       S01195
      *                                                                   S01195
      ** (if no error, check buying location)                             S01195
      *                                                                   S01195
     C                     MOVE @BLCCD    ZLOC                            S01195
     C                     EXSR ZCHKH                                     S01195
     C                     END                                            S01195
      *
     C           ZIND      IFEQ 'H'                                       S01195
     C                     MOVE ' W04'    WERR
     C                     ADD  1         WEC
     C                     EXSR ERRORS
     C                     SETON                     67
     C                     END
      *
     C***********          END
     C                     END
     C*
     C                     ELSE
     C*
     C*    ..  if Value Date changed check whether Trade Date
     C*                                 to be changed
     C*
     C           STDVD     IFNE SAVVD
     C           RUND      IFLE TDVD
     C                     Z-ADDRUND      ZDAYNO
     C                     ELSE
     C                     Z-ADDTDVD      ZDAYNO
     C                     END
      *
     C                     EXSR ZDATE2
     C                     MOVELZDATE     STDDT
     C                     Z-ADDZDAYNO    TDDT
     C                     END
     C*
     C                     END
     C*
     C* Trade sub-type
     C*
     C*****..*if*amended,*must*be*a*valid*code*on*TABLET5*                S01117
      ** .. if amended, must be a valid code on deal sub-types file.      S01117
     C*
     C           STSUB     IFNE SAVTS
     C***********          MOVE *BLANKS   KEY12                           S01117
     C***********          MOVEL'42'      KEY12                           S01117
     C***********          MOVE STSUB     KEY12                           S01117
     C***********KEY12     CHAINTABLET5F             44                   S01117
     C************IN44     IFEQ '1'                                       S01117
     C************IN44     OREQ '0'                                       S01117
     C***********RECI      ANDEQ'*'                                       S01117
      *                                                                   S01117
      ** Access Deal Sub-Types file                                       S01117
      *                                                                   S01117
     C                     CALL 'AODLSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM STSUB     @DSNB   3                       S01117
     C           SDDLST    PARM SDDLST    DSFDY                           S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE ' 210'    WERR
     C                     EXSR ERRORS
     C                     SETON                     68
     C                     END
     C                     END
     C*
     C* Market indicator
     C*
     C*    .. if amended, may be changed from 'G' to 'P' or 'S'
     C*
     C           STDMI     IFNE SAVMI
     C           SAVMI     IFEQ 'G'
     C           STDMI     ANDNE'P'
     C           STDMI     ANDNE'S'
     C                     MOVE ' 211'    WERR
     C                     EXSR ERRORS
     C                     SETON                     69
     C                     END
     C*
     C*    .. if amended, may be changed from 'P' to 'S'
     C*
     C           SAVMI     IFEQ 'P'
     C           STDMI     ANDNE'S'
     C           SAVMI     OREQ 'S'
     C                     MOVE ' 211'    WERR
     C                     EXSR ERRORS
     C                     SETON                     69
     C                     END
     C                     END
     C*
     C**AIBD/IPPA******************************************************   E43208
     C* ISMA/IPMA                                                         E43208
     C*
     C*    .. if amended, must be 'Y' or 'N'
     C*
     C           SAIIP     IFNE SAVAI
     C           SAIIP     ANDNE'Y'
     C           SAIIP     ANDNE'N'
     C                     MOVE ' 212'    WERR
     C                     EXSR ERRORS
     C                     SETON                     70
     C                     END
     C*
     C           *IN11     IFEQ '1'
     C/COPY WNCPYSRC,SE0090C029
     C*
     C* Accrued indicator
     C*
     C*    .. if amended, must be 'C' 'F' or 'X'
     C*
     C           SACIN     IFNE SAVAC
     C/COPY WNCPYSRC,SE0090C014
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
     C           SACIN     IFNE 'C'                                                           CSE035
     C           SACIN     ANDNE'F'                                                           CSE035
     C           SACIN     ANDNE'X'                                                           CSE035
     C           SACIN     ANDNE'N'                                                           CSE035
     C           SACIN     ANDNE'D'                                                           CSE035
     C                     MOVE ' 213'    WERR                                                CSE035
     C                     EXSR ERRORS                                                        CSE035
     C                     SETON                     71                                       CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ELSE                                                               CSE035
      *                                                                                       CSE035
     C           SACIN     IFNE 'C'
     C           SACIN     ANDNE'F'
     C           SACIN     ANDNE'X'
     C                     MOVE ' 213'    WERR
     C                     EXSR ERRORS
     C                     SETON                     71
     C                     END
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C/COPY WNCPYSRC,SE0090C015
     C           SACIN     IFEQ 'C'                                       088903
     C           SACIN     OREQ 'X'                                       088903
     C           PROT      IFEQ '6'                                       088903
     C                     MOVE ' 130'    WERR                            088903
     C                     EXSR ERRORS                                    088903
     C                     SETON                     71                   088903
     C                     ENDIF                                          088903
     C                     ENDIF                                          088903
     C*                                                                   088903
     C                     ELSE
     C*
     C*    .. if not amended and value date changed, re-calculate
     C*
     C           STDVD     IFNE SAVVD
     C           PROT      ANDNE'6'                                       088903
     C*    .. get next coupon date
     C/COPY WNCPYSRC,SE0090C016
      *                                                                                       CSE035
      ** ADJUST NUMBER OF DECIMAL PLACES FOR PRICE                                            CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
     C                     Z-ADDECD       SECD    50                                          CSE035
     C                     Z-ADDNCDD5     SNCDD5  50                                          CSE035
     C                     Z-ADDLCDD5     SLCDD5  50                                          CSE035
     C                     Z-ADDTDVD      ECD                                                 CSE035
     C*                                                                                       CSE035
     C* CALL ZLCD + ZNCD TO DETERMINE NEXT AND LAST COUPON DATES                              CSE035
     C                     Z-ADDNCD       @NCD    50                                          CSE035
     C                     EXSR ZNCD                                                          CSE035
     C                     Z-ADDNCD       NCDD5   50                                          CSE035
     C                     Z-ADD@NCD      NCD                                                 CSE035
     C                     Z-ADDZZLCD     @LCD    50                                          CSE035
     C           NCDD5     SUB  1         ZECD                                                CSE035
     C                     EXSR ZLCD                                                          CSE035
     C                     Z-ADDZZLCD     LCDD5   50                                          CSE035
     C                     Z-ADD@LCD      ZZLCD                                               CSE035
     C*                                                                                       CSE035
      *                                                                                       CSE035
      ** If TDVD is less than the FCPN, get the Last Coupon from the                          CSE035
      ** coupon array.                                                                        CSE035
      *                                                                                       CSE035
     C           TDVD      IFLT FCPN                                                          CSE035
     C                     EXSR ZLCD1                                                         CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     Z-ADDSECD      ECD                                                 CSE035
     C           TDVD      IFLT FCPN                                                          CSE035
     C           PROT      ANDEQ'1'                                                           CSE035
     C           ITLD      IFGE ZZLCD1                                                        CSE035
     C           NCDD5     IFNE FCPN                                                          CSE035
     C                     MOVE 'D'       SACIN                                               CSE035
     C                     ELSE                                                               CSE035
      *                                                                                       CSE035
      ** If Initial date coincides with the regular coupon date, it                           CSE035
      ** should be CUM.                                                                       CSE035
      *                                                                                       CSE035
     C           ITLD      IFEQ ZZLCD1                                                        CSE035
     C           NCDD5     ANDEQFCPN                                                          CSE035
     C                     MOVE 'C'       SACIN                                               CSE035
     C                     ELSE                                                               CSE035
      *                                                                                       CSE035
      ** If not, it should be 'NX'.                                                           CSE035
      *                                                                                       CSE035
     C                     MOVE 'N'       SACIN                                               CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
     C                     ELSE                                                               CSE035
     C                     MOVE 'D'       SACIN                                               CSE035
     C                     ENDIF                                                              CSE035
     C                     ELSE                                                               CSE035
     C*    .. get next coupon date                                                            CSE035
     C                     EXSR ZNCD                                                          CSE035
     C                     MOVE 'C'       SACIN                                               CSE035
     C           TDVD      IFEQ NCD                                                           CSE035
     C                     MOVE 'F'       SACIN                                               CSE035
     C                     ELSE                                                               CSE035
     C                     MOVELEDFT      ZNRDYS                                              CSE035
     C           ZNRDYS    IFNE *ZEROS                                                        CSE035
     C                     MOVE EDFT      WEDFT   1                                           CSE035
     C           WEDFT     IFEQ 'W'                                                           CSE035
     C*    .. if working days                                                                 CSE035
     C                     Z-ADDNCD       ZDAYNO                                              CSE035
     C                     MOVE NMCYA     ZCCY                                                CSE035
     C                     MOVE *BLANK    ZLOC                                                CSE035
     C                     EXSR ZBKDT                                                         CSE035
     C                     ELSE                                                               CSE035
     C*    .. if actual days                                                                  CSE035
     C           NCD       SUB  ZNRDYS    ZDYNBR                                              CSE035
     C                     ENDIF                                                              CSE035
     C           TDVD      IFLT NCD                                                           CSE035
     C           TDVD      ANDGEZDYNBR                                                        CSE035
     C           NCD       ANDNEMATY                                                          CSE035
     C                     MOVE 'X'       SACIN                                               CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     Z-ADDSNCDD5    NCDD5                                               CSE035
     C                     Z-ADDSLCDD5    LCDD5                                               CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ELSE                                                               CSE035
      *                                                                                       CSE035
     C                     EXSR ZNCD
     C                     MOVE 'C'       SACIN
      *
     C/COPY WNCPYSRC,SE0090C006
     C           TDVD      IFEQ NCD
     C/COPY WNCPYSRC,SE0090C007
     C                     MOVE 'F'       SACIN
     C                     ELSE
     C                     MOVELEDFT      ZNRDYS
      *
     C           ZNRDYS    IFNE *ZEROS
     C                     MOVE EDFT      WEDFT   1
      *
     C           WEDFT     IFEQ 'W'
     C*    .. if working days
     C                     Z-ADDNCD       ZDAYNO
     C                     MOVE NMCYA     ZCCY
     C                     MOVE *BLANK    ZLOC                            S01195
     C***********          EXSR XDATE3                                    S01195
     C                     EXSR ZBKDT                                     S01195
     C                     ELSE
      *
     C*    .. if actual days
     C           NCD       SUB  ZNRDYS    ZDYNBR
     C                     END
      *
     C           TDVD      IFLT NCD
     C           TDVD      ANDGEZDYNBR
     C                     MOVE 'X'       SACIN
     C                     END
      *
     C                     END
     C                     END
     C                     END
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C/COPY WNCPYSRC,SE0090C017
     C                     END
     C*
     C* Days adjustment
     C*
     C*    .. if amended & not zero, must be a valid amount
     C*
     C           SDADJ     IFNE SAVDA
     C           SDADJ     IFNE *BLANKS
     C                     MOVE *BLANKS   ZFLD17
     C                     MOVELSDADJ     ZFLD17
     C                     Z-ADD3         ZSDIG
     C                     Z-ADD0         ZSDEC
     C                     EXSR ZASIGN
      *
     C           *IN99     IFEQ '1'
     C                     MOVE ' 214'    WERR
     C                     EXSR ERRORS
     C                     SETON                     72
     C                     ELSE
     C                     MOVE ZOUT15    DADJ
      *
     C           ZFSIGN    IFEQ '-'
     C                     Z-SUBDADJ      DADJ
     C                     END
      *
     C                     END
     C*
     C                     ELSE
     C                     Z-ADD*ZEROS    DADJ
     C                     END
      *
     C                     END
     C*
     C* Actual difference indicator
     C*
     C*    .. if days adjustment ne 0, must be 'A' or 'D'
     C*
     C           DADJ      IFNE *ZEROS
     C***********SADIN     ANDNE'A'                                       E20125
     C           SADIN     IFNE 'A'                                       E20125
     C           SADIN     ANDNE'D'
     C                     MOVE ' 215'    WERR
     C                     EXSR ERRORS
     C                     SETON                     73
     C                     END                                            E20125
     C*                                                                   E20125
     C*    .. But, if DADJ IS zero, A/D Ind must be blank.                E20125
     C*                                                                   E20125
     C                     ELSE                                           E20125
     C           SADIN     IFNE *BLANKS                                   E20125
     C                     MOVE ' 215'    WERR                            E20125
     C                     EXSR ERRORS                                    E20125
     C                     SETON                     73                   E20125
     C                     END                                            E20125
     C                     END
     C*
     C* Coupon rate
     C*
     C*****If*blanked*out,*should*return*to*default*value.******** E20125 E20522
     C*    Set Coupon Rate to the rate for Value Date.                    E20522
     C*                                                                   E20125
     C***********SCPNR     IFEQ *BLANKS                            E20125 E20522
     C                     MOVE *BLANKS   ZFLD15                          E20125
     C                     MOVE SESN      SDSN                            E20125
     C                     MOVE 'IR'      SDET                            E20125
     C                     Z-ADDTDVD      SDED                            E20125
     C           KLEVD     SETLLSEDEVDO                                   E20125
     C                     READ SEDEVDO                  44               E20125
     C           *IN44     IFEQ '0'                                       E20125
     C           SDSN      ANDEQSESN                                      E20125
     C           SDET      ANDEQ'IR'                                      E20125
     C                     Z-ADDSDNC      TDCR                            E20125
     C                     MOVE SDNC      ZFLD15                          E20125
     C                     ELSE                                           E20125
     C                     Z-ADDCPNR      TDCR                            E20125
     C                     MOVE CPNR      ZFLD15                          E20125
     C                     END                                            E20125
     C*                                                                   E20125
     C                     Z-ADD7         ZDECS                           E20125
     C                     MOVE *BLANK    ZECODE                          E20125
     C                     EXSR ZSEDIT                                    E20125
     C                     MOVE ZOUT21    SCPNR                           E20125
     C                     MOVE 'N'       ZCPOVR                          E20125
     C*                                                                   E20125
     C***********          ELSE                                    E20125 E20522
     C***********                                                  E20125 E20252
     C*****..*if*amended,*must*be*a*valid*amount***********************   E20522
     C***********                                                         E20252
     C***********SCPNR     IFNE SAVCR                                     E20522
     C***********          MOVE *BLANKS   ZFIELD                          E20522
     C***********          MOVELSCPNR     ZFIELD                          E20522
     C***********          Z-ADD4         ZADIG                           E20522
     C***********          Z-ADD7         ZADEC                           E20522
     C***********          EXSR ZALIGN                                    E20522
     C********** *IN99     IFEQ '1'                                       E20522
     C***********          MOVE ' 219'    WERR                            E20522
     C***********          EXSR ERRORS                                    E20522
     C***********          SETON                     75                   E20522
     C***********          END                                            E20522
     C***********          MOVE ZFIELD    CPNR                            E20522
     C***********          END                                            E20522
     C*
     C***********          END                                     E20125 E20522
     C*                                                                   E20125
     C***  Interest Amount                                                E20125
     C*                                                                   E20125
     C***  If the Interest Amount is entered manually, the 'Days          E20125
     C***  Adjustment' and 'A/D Indicator' fields must be blank.          E20125
     C*                                                                   E20125
     C           SITRA     IFNE SAVIT                                     E20125
     C           SITRA     ANDNE*BLANKS                                   E20125
     C*                                                                   E20125
     C           SDADJ     IFNE *BLANKS                                   E20125
     C           SADIN     ORNE *BLANKS                                   E20125
     C                     MOVE ' 217'    WERR                            E20125
     C                     EXSR ERRORS                                    E20125
     C                     SETON                     747377               E20125
     C                     END                                            E20125
     C*                                                                   E20125
     C                     END                                            E20125
     C*                                                                   E20125
     C*    .. if any interest calculation details have been amended,
     C*       and there are no errors, re-calculate interest & set
     C*       indicator for redisplay.
     C*
     C           SDADJ     IFNE SAVDA
     C           SADIN     ORNE SAVAD
     C           SACIN     ORNE SAVAC
     C***********SCPNR     ORNE SAVCR                                     E20522
     C           STDVD     ORNE SAVVD
     C           SITRA     OREQ *BLANKS                                   E20125
     C***                                                                 E20125
     C********if*any*interest*details*changed**Interest*amount*cannot**   E20125
     C***************************************be*entered*manually*******   E20125
     C***********SITRA     IFNE SAVIT                                     E20125
     C***********SITRA     ANDNE*BLANKS                                   E20125
     C***********          MOVE SAVIT     SITRA                           E20125
     C***********          MOVE ' 217'    WERR                            E20125
     C***********          EXSR ERRORS                                    E20125
     C***********          SETON                     74                   E20125
     C***********          END                                            E20125
      *
     C           *IN58     IFNE '1'
     C           *IN60     ANDNE'1'                                       E20125
     C           *IN71     ANDNE'1'
     C           *IN72     ANDNE'1'
     C           *IN73     ANDNE'1'
     C           *IN74     ANDNE'1'
     C********** *IN75     ANDNE'1'                                       E20522
     C*
     C***********          EXSR CPCINT                                    E20085
     C***********          Z-ADDNOMDP     CDP                       E20085S01117
     C                     Z-ADDNOMDP     ZCDP                            S01117
     C                     MOVE SACIN     ZACIN                           E20125
     C                     Z-ADDDADJ      ZDADJ                           E20125
     C                     MOVE SADIN     ZADIN                           E20125
     C/COPY WNCPYSRC,SE0090CP19                                           S01408
     C                     EXSR ZPCINT                                    E20085
     C/COPY WNCPYSRC,SE0090CP20                                           S01408
     C                     MOVE 'Y'       RCAL
     C***********          MOVE WPINT     ORGIT                           E20085
     C                     MOVE ZITRA     ORGIT                           E20085
     C*
     C                     MOVE *BLANKS   ZFLD15
     C***********          MOVE WPINT     ZFLD15                          E20085
     C           PROT      IFEQ '6'                                       088903
     C                     MOVE *ZEROS    ZFLD15                          088903
     C                     ELSE                                           088903
     C                     MOVE ZITRA     ZFLD15                          E20085
     C                     ENDIF                                          088903
     C                     Z-ADDNOMDP     ZDECS
     C                     MOVE *BLANK    ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SAVEIT 21                       E20125
     C***********          END                                            E20386
     C***********          END                                            E20386
      *                                                                   E20125
     C***  Update the Screen Interest field if it has not previously      E20125
     C***  been changed or it has been blanked out. THEN save the new     E20125
     C***  Calculated (Alpha) Amount.                                     E20125
     C*                                                                   E20125
     C           SITRA     IFEQ SAVIT                                     E20125
     C           SITRA     OREQ *BLANKS                                   E20125
     C                     MOVE ZOUT21    SITRA
     C                     END                                            E20125
     C*
     C***********          MOVE SITRA     SAVIT                           E20125
     C                     MOVE SAVEIT    SAVIT                           E20125
     C                     MOVE SDADJ     SAVDA
     C                     MOVE SADIN     SAVAD
     C                     MOVE SACIN     SAVAC
     C***********          MOVE SCPNR     SAVCR                           E20522
     C                     MOVE STDVD     SAVVD
     C                     END                                            E20386
     C                     END                                            E20386
      *                                                                   E20386
     C**Interest*amount************************************************   E20125
     C***********                                                         E20125
     C*****..*if*amended,*must*be*a*valid*amount***********************   E20125
     C***********                                                         E20125
     C***********SDADJ     IFEQ SAVDA                                     E20125
     C***********SADIN     ANDEQSAVAD                                     E20125
     C***********SACIN     ANDEQSAVAC                                     E20125
     C***********SCPNR     ANDEQSAVCR                                     E20125
     C***********STDVD     ANDEQSAVVD                                     E20125
     C***********SITRA     ANDNESAVIT                                     E20125
     C***********SITRA     ANDNE*BLANKS                                   E20125
     C*                                                                   E20125
     C*    If the Screen Interest Amount does not equal the Calculated    E20125
     C*    Interest Amount, then it has been entered manually and must    E20125
     C*    be validated.                                                  E20125
     C*                                                                   E20125
     C           SITRA     IFNE SAVIT                                     E20125
     C                     MOVE *BLANKS   ZFLD17
     C                     MOVELSITRA     ZFLD17
     C           13        SUB  NOMDP     ZSDIG
     C                     Z-ADDNOMDP     ZSDEC
     C                     EXSR ZASIGN
      *
     C           *IN99     IFEQ '1'
     C                     MOVE ' 216'    WERR
     C                     EXSR ERRORS
     C                     SETON                     74
     C                     ELSE                                           088903
     C                     MOVE ZOUT15    ZITRA                           088903
     C           ZFSIGN    IFEQ '-'                                       088903
     C                     Z-SUBZITRA     ZITRA                           088903
     C                     END                                            088903
     C                     MOVE 'Y'       RCAL                            088903
     C                     MOVE *BLANKS   ZFLD15                          088903
     C           PROT      IFEQ '6'                                       088903
     C                     MOVE *ZEROS    ZFLD15                          088903
     C                     ELSE                                           088903
     C                     MOVE ZITRA     ZFLD15                          088903
     C                     END                                            088903
     C                     Z-ADDNOMDP     ZDECS                           088903
     C                     MOVE *BLANK    ZECODE                          088903
     C                     EXSR ZSEDIT                                    088903
     C                     MOVE ZOUT21    SITRA                           088903
     C                     MOVE SITRA     SAVIT                           088903
     C                     END
      *
     C                     END
     C*
     C                     END
     C*                                                                   S01232
     C********************************************************************S01232
     C*      S01232 - CODE MOVED DOWN FROM ABOVE BECAUSE AUSTRALIAN       S01232
     C*      YIELD CALCULATION NEEDS TO KNOW PURCHASED INTEREST.  ALSO    S01232
     C*      NEW LINES ADDED FOR AUSTRALIAN YIELDS.                       S01232
     C********************************************************************S01232
     C*                                                                   S01232
     C* Price                                                             S01232
     C*                                                                   S01232
     C*    .. if amended, must be a valid amount                          S01232
     C*                                                                   S01232
     C           *IN12     IFEQ '1'                                       S01232
     C***********SPRIC     ANDNESAVPR                                     S01232
     C                     MOVE *BLANKS   ZFLD17                          S01232
     C                     MOVELSPRIC     ZFLD17                          S01232
     C                     Z-ADD7         ZSDIG                           S01232
     C                     Z-ADD8         ZSDEC                           S01232
     C                     EXSR ZASIGN                                    S01232
      *
     C           *IN99     IFEQ '1'                                       S01232
     C                     MOVE ' 204'    WERR                            S01232
     C                     EXSR ERRORS                                    S01232
     C                     SETON                     63                   S01232
     C                     ELSE                                           S01232
     C                     MOVE SPRIC     SAVPR                           S01232
     C                     MOVE ZOUT15    PRIC                            S01232
     C           ZFSIGN    IFEQ '-'                                       S01232
     C                     Z-SUBPRIC      PRIC                            S01232
     C                     END                                            S01232
     C*                                                                   S01232
     C*    .. must be within 10% of calculated price                      S01232
     C*                                                                   S01232
     C                     EXSR ZNCD                                      S01232
     C                     MOVE PRIC      ZPRCIN                          S01232
     C                     Z-ADDTDVD      ZFDATE                          S01232
     C*                                                                   S01232
     C*     SET UP PARAMETERS FOR AUSTRALIAN YIELDS                       S01232
     C*            cum/ex parameter                                       S01232
     C*                                                                   S01232
     C/COPY WNCPYSRC,SE0090C018
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
     C                     MOVE SACIN     SCUMEX                                              CSE035
     C                     ELSE                                                               CSE035
      *                                                                                       CSE035
     C           SACIN     IFEQ 'X'                                       S01232
     C                     MOVE 'X'       SCUMEX                          S01232
     C                     ELSE                                           S01232
     C                     MOVE 'C'       SCUMEX                          S01232
     C                     END                                            S01232
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C/COPY WNCPYSRC,SE0090C019
     C*                                                                   S01232
     C*            calculate PI as a fraction of nominal                  S01232
     C*                                                                   S01232
     C           ZITRA     DIV  WRKNM     WRKPI                           S01232
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0090CP15                                           S01408
     C*                                                                   S01408
     C                     Z-ADDNOML      ZNOML                           E39495
     C                     EXSR ZPRCI                                     S01232
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0090CP16                                           S01408
      *                                                                                       CSE035
      ** ADJUST NUMBER OF DECIMAL PLACES FOR PRICE                                            CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
      ** ADJUST PRICE : PRICE + PUR INT BEFORE ROUNDING                                       CSE035
      *                                                                                       CSE035
     C           NCD       IFGE MATY                                                          CSE035
     C           SYBS      ANDEQ'AU'                                                          CSE035
     C                     Z-ADDZPRCOT    ZPRCOT                                              CSE035
     C                     ELSE                                                               CSE035
     C           SYBS      IFNE 'AU'                                                          CSE035
     C           SYBS      ANDNE'DA'                                                          CSE035
     C           STBS      ANDEQ'Y'                                                           CSE035
     C           ZPRCOT    ADD  ZWAMT     ZPRCOT                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
     C           NCD       IFGE MATY                                                          CSE035
     C           SYBS      ANDEQ'AU'                                                          CSE035
     C                     ELSE                                                               CSE035
      *                                                                                       CSE035
     C           SYBS      IFNE 'AU'                                                          CSE035
     C           SYBS      ANDNE'DA'                                                          CSE035
     C           STBS      ANDEQ'Y'                                                           CSE035
     C           ZPRCOT    SUB  PURINT    ZPRCOT                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
     C*                                                                   S01408
     C                     Z-ADDZPRCOT    PRIC                            S01232
     C           WPRIC     DIV  10        APWRK1                          S01232
     C           WPRIC     ADD  APWRK1    APWRK2                          S01232
      *
     C           ZPRCOT    IFGT APWRK2                                    S01232
     C                     MOVE ' W03'    WERR                            S01232
     C                     ADD  1         WEC                             S01232
     C                     EXSR ERRORS                                    S01232
     C                     SETON                     63                   S01232
     C                     ELSE                                           S01232
     C*                                                                   S01232
     C           WPRIC     SUB  APWRK1    APWRK2                          S01232
     C           ZPRCOT    IFLT APWRK2                                    S01232
     C                     MOVE ' W03'    WERR                            S01232
     C                     ADD  1         WEC                             S01232
     C                     EXSR ERRORS                                    S01232
     C                     SETON                     63                   S01232
     C                     END                                            S01232
      *
     C                     END                                            S01232
     C                     END                                            S01232
     C                     END                                            S01232
     C*                                                                   S01232
     C********************************************************************S01232
     C*      S01232 - END OF CODE MOVED DOWN                              S01232
     C********************************************************************S01232
     C*
     C* Broker commission code
     C*
     C*****..*if*entered,*must*be*a*valid*code*on*SECHG****************   S01169
     C*    .. if entered, must be a valid code on SECGT                   S01169
     C*
     C           STBCC     IFNE *BLANKS
     C                     MOVELNMCYA     CCY
     C                     MOVELSTBCC     CCOM
     C***********KLSECH    CHAINSECHGDF              44                   S01169
     C           KLSECG    CHAINSECGTDF              44                   S01169
     C           *IN44     IFEQ '1'
     C           *IN44     OREQ '0'
     C           RECI      ANDEQ'*'
     C                     MOVE ' 220'    WERR
     C                     EXSR ERRORS
     C                     SETON                     76
     C                     END
     C                     END
     C*
     C* Broker commission amount
     C*
     C*    .. mandatory if Broker Commission Code entered
     C*
     C           STBCA     IFNE *BLANKS
     C           STBCC     ANDEQ*BLANKS
     C                     MOVE ' 221'    WERR
     C                     EXSR ERRORS
     C                     SETON                     77
     C                     END
     C*
     C*    .. prohibited if Broker Commission Code not entered
     C*
     C           STBCA     IFEQ *BLANKS
     C           STBCC     ANDNE*BLANKS
     C                     MOVE ' 221'    WERR
     C                     EXSR ERRORS
     C                     SETON                     77
     C                     END
     C*
     C*    .. if entered, must be a valid amount
     C*
     C           STBCA     IFNE *BLANKS
     C                     MOVE *BLANKS   ZFLD17
     C                     MOVELSTBCA     ZFLD17
     C           13        SUB  NOMDP     ZSDIG
     C                     Z-ADDNOMDP     ZSDEC
     C                     EXSR ZASIGN
      *
     C           *IN99     IFEQ '1'
     C                     MOVE ' 222'    WERR
     C                     EXSR ERRORS
     C                     SETON                     77
     C                     END
     C                     END
     C*
     C* Customer commission code
     C*
     C*    .. prohibited if client is not safe custody or discretionary
     C*
     C           STCCC     IFNE *BLANKS
     C***********          MOVE BBICN     CNUM                            S01176
     C***********          MOVE '1'       RCDT                            S01176
     C***********KLCLNT    CHAINCLINTSEX             44                   S01176
     C***********C1DI      IFNE 'S'                                       S01176
     C***********C1DI      ANDNE'D'                                       S01176
     C***********          MOVE ' 223'    WERR                            S01176
     C***********          EXSR ERRORS                                    S01176
     C***********          SETON                     78                   S01176
     C***********          END                                            S01176
     C***********                                                         S01176
     C*****..*must*be*a*valid*code*on*SECHG****************************   S01169
     C*    .. must be a valid code on SECGT                               S01169
     C*
     C                     MOVELNMCYA     CCY
     C                     MOVELSTCCC     CCOM
     C***********KLSECH    CHAINSECHGDF              44                   S01169
     C           KLSECG    CHAINSECGTDF              44                   S01169
     C           *IN44     IFEQ '1'
     C           *IN44     OREQ '0'
     C           RECI      ANDEQ'*'
     C                     MOVE ' 224'    WERR
     C                     EXSR ERRORS
     C                     SETON                     78
     C                     END
     C                     END
     C*
     C* Customer commission amount
     C*
     C*    .. mandatory if Customer Commission Code entered
     C*
     C           STCCA     IFNE *BLANKS
     C           STCCC     ANDEQ*BLANKS
     C                     MOVE ' 225'    WERR
     C                     EXSR ERRORS
     C                     SETON                     79
     C                     END
     C*
     C*    .. prohibited if Customer Commission Code not entered
     C*
     C           STCCA     IFEQ *BLANKS
     C           STCCC     ANDNE*BLANKS
     C                     MOVE ' 225'    WERR
     C                     EXSR ERRORS
     C                     SETON                     79
     C                     END
     C*
     C*    .. if entered, must be a valid amount
     C*
     C           STCCA     IFNE *BLANKS
     C                     MOVE *BLANKS   ZFLD17
     C                     MOVELSTCCA     ZFLD17
     C           13        SUB  NOMDP     ZSDIG
     C                     Z-ADDNOMDP     ZSDEC
     C                     EXSR ZASIGN
     C           *IN99     IFEQ '1'
     C                     MOVE ' 226'    WERR
     C                     EXSR ERRORS
     C                     SETON                     79
     C                     END
     C                     END
     C*
     C* Charge code 1
     C*
     C*****..*must*be*a*valid*code*on*SECHG****************************   S01169
     C*    .. must be a valid code on SECGT                               S01169
     C*
     C           STCC1     IFNE *BLANKS
     C                     MOVELNMCYA     CCY
     C                     MOVELSTCC1     CCOM
     C***********KLSECH    CHAINSECHGDF              44                   S01169
     C           KLSECG    CHAINSECGTDF              44                   S01169
     C           *IN44     IFEQ '1'
     C           *IN44     OREQ '0'
     C           RECI      ANDEQ'*'
     C                     MOVE ' 227'    WERR
     C                     EXSR ERRORS
     C                     SETON                     80
     C                     END
     C                     END
     C*
     C* Charge amount 1
     C*
     C*    .. mandatory if Charge Code 1 entered
     C*
     C           STCA1     IFNE *BLANKS
     C           STCC1     ANDEQ*BLANKS
     C                     MOVE ' 228'    WERR
     C                     EXSR ERRORS
     C                     SETON                     81
     C                     END
     C*
     C*    .. prohibited if Charge Code 1 not entered
     C*
     C           STCA1     IFEQ *BLANKS
     C           STCC1     ANDNE*BLANKS
     C                     MOVE ' 228'    WERR
     C                     EXSR ERRORS
     C                     SETON                     81
     C                     END
     C*
     C*    .. if entered, must be a valid amount
     C*
     C           STCA1     IFNE *BLANKS
     C                     MOVE *BLANKS   ZFLD17
     C                     MOVELSTCA1     ZFLD17
     C           13        SUB  NOMDP     ZSDIG
     C                     Z-ADDNOMDP     ZSDEC
     C                     EXSR ZASIGN
      *
     C           *IN99     IFEQ '1'
     C                     MOVE ' 229'    WERR
     C                     EXSR ERRORS
     C                     SETON                     81
     C                     END
     C                     END
     C*
     C* Charge code 2
     C*
     C*****..*must*be*a*valid*code*on*SECHG****************************   S01169
     C*    .. must be a valid code on SECGT                               S01169
     C*
     C           STCC2     IFNE *BLANKS
     C                     MOVELNMCYA     CCY
     C                     MOVELSTCC2     CCOM
     C***********KLSECH    CHAINSECHGDF              44                   S01169
     C           KLSECG    CHAINSECGTDF              44                   S01169
     C           *IN44     IFEQ '1'
     C           *IN44     OREQ '0'
     C           RECI      ANDEQ'*'
     C                     MOVE ' 230'    WERR
     C                     EXSR ERRORS
     C                     SETON                     82
     C                     END
     C                     END
     C*
     C* Charge amount 2
     C*
     C*    .. mandatory if Charge Code 2 entered
     C*
     C           STCA2     IFNE *BLANKS
     C           STCC2     ANDEQ*BLANKS
     C                     MOVE ' 231'    WERR
     C                     EXSR ERRORS
     C                     SETON                     83
     C                     END
     C*
     C*    .. prohibited if Charge Code 2 not entered
     C*
     C           STCA2     IFEQ *BLANKS
     C           STCC2     ANDNE*BLANKS
     C                     MOVE ' 231'    WERR
     C                     EXSR ERRORS
     C                     SETON                     83
     C                     END
     C*
     C*    .. if entered, must be a valid amount
     C*
     C           STCA2     IFNE *BLANKS
     C                     MOVE *BLANKS   ZFLD17
     C                     MOVELSTCA2     ZFLD17
     C           13        SUB  NOMDP     ZSDIG
     C                     Z-ADDNOMDP     ZSDEC
     C                     EXSR ZASIGN
      *
     C           *IN99     IFEQ '1'
     C                     MOVE ' 232'    WERR
     C                     EXSR ERRORS
     C                     SETON                     83
     C                     END
     C                     END
     C*
     C* Charge code 3
     C*
     C*****..*must*be*a*valid*code*on*SECHG****************************   S01169
     C*    .. must be a valid code on SECGT                               S01169
     C*
     C           STCC3     IFNE *BLANKS
     C                     MOVELNMCYA     CCY
     C                     MOVELSTCC3     CCOM
     C***********KLSECH    CHAINSECHGDF              44                   S01169
     C           KLSECG    CHAINSECGTDF              44                   S01169
     C           *IN44     IFEQ '1'
     C           *IN44     OREQ '0'
     C           RECI      ANDEQ'*'
     C                     MOVE ' 233'    WERR
     C                     EXSR ERRORS
     C                     SETON                     84
     C                     END
     C                     END
     C*
     C* Charge amount 3
     C*
     C*    .. mandatory if Charge Code 3 entered
     C*
     C           STCA3     IFNE *BLANKS
     C           STCC3     ANDEQ*BLANKS
     C                     MOVE ' 234'    WERR
     C                     EXSR ERRORS
     C                     SETON                     85
     C                     END
     C*
     C*    .. prohibited if Charge Code 3 not entered
     C*
     C           STCA3     IFEQ *BLANKS
     C           STCC3     ANDNE*BLANKS
     C                     MOVE ' 234'    WERR
     C                     EXSR ERRORS
     C                     SETON                     85
     C                     END
     C*
     C*    .. if entered, must be a valid amount
     C*
     C           STCA3     IFNE *BLANKS
     C                     MOVE *BLANKS   ZFLD17
     C                     MOVELSTCA3     ZFLD17
     C           13        SUB  NOMDP     ZSDIG
     C                     Z-ADDNOMDP     ZSDEC
     C                     EXSR ZASIGN
      *
     C           *IN99     IFEQ '1'
     C                     MOVE ' 235'    WERR
     C                     EXSR ERRORS
     C                     SETON                     85
     C                     END
     C                     END
     C**Charge*code*other**********************************************   S01176
     C* Charge code 4                                                     S01176
     C*
     C*****..*must*be*a*valid*code*on*SECHG****************************   S01169
     C*    .. must be a valid code on SECGT                               S01169
     C*
     C***********STOCC     IFNE *BLANKS                                   S01176
     C           STCC4     IFNE *BLANKS                                   S01176
     C                     MOVELNMCYA     CCY
     C***********          MOVELSTOCC     CCOM                            S01176
     C                     MOVELSTCC4     CCOM                            S01176
     C***********KLSECH    CHAINSECHGDF              44                   S01169
     C           KLSECG    CHAINSECGTDF              44                   S01169
     C           *IN44     IFEQ '1'
     C           *IN44     OREQ '0'
     C           RECI      ANDEQ'*'
     C                     MOVE ' 236'    WERR
     C                     EXSR ERRORS
     C                     SETON                     86
     C                     END
     C                     END
     C*
     C**Charge*Amount*other********************************************   S01176
     C* Charge amount 4                                                   S01176
     C*
     C*****..*mandatory*if*Charge*Code*Other*entered*******************   S01176
     C*    .. mandatory if Charge Code 4 entered                          S01176
     C*
     C***********STOCC     IFNE *BLANKS                                   S01176
     C           STCC4     IFNE *BLANKS                                   S01176
     C***********STOCA     ANDEQ*BLANKS                                   S01176
     C           STCA4     ANDEQ*BLANKS                                   S01176
     C                     MOVE ' 237'    WERR
     C                     EXSR ERRORS
     C                     SETON                     87
     C                     END
     C*
     C*****..*prohibited*if*Charge*Code*Other*not*entered**************   S01176
     C*    .. prohibited if Charge Code 4 not entered                     S01176
     C*
     C***********STOCC     IFEQ *BLANKS                                   S01176
     C           STCC4     IFEQ *BLANKS                                   S01176
     C***********STOCA     ANDNE*BLANKS                                   S01176
     C           STCA4     ANDNE*BLANKS                                   S01176
     C                     MOVE ' 237'    WERR
     C                     EXSR ERRORS
     C                     SETON                     87
     C                     END
     C*
     C*    .. if entered, must be a valid amount
     C*
     C***********STOCA     IFNE *BLANKS                                   S01176
     C           STCA4     IFNE *BLANKS                                   S01176
     C                     MOVE *BLANKS   ZFLD17
     C***********          MOVELSTOCA     ZFLD17                          S01176
     C                     MOVELSTCA4     ZFLD17                          S01176
     C           13        SUB  NOMDP     ZSDIG
     C                     Z-ADDNOMDP     ZSDEC
     C                     EXSR ZASIGN
      *
     C           *IN99     IFEQ '1'
     C                     MOVE ' 238'    WERR
     C                     EXSR ERRORS
     C                     SETON                     87
     C                     END
     C                     END
     C*
     C**Local*tax*code*************************************************   S01176
     C* Charge code 5                                                     S01176
     C*
     C*****..*must*be*a*valid*code*on*SECHG****************************   S01169
     C*    .. must be a valid code on SECGT                               S01169
     C*
     C***********STLTC     IFNE *BLANKS                                   S01176
     C           STCC5     IFNE *BLANKS                                   S01176
     C                     MOVELNMCYA     CCY
     C***********          MOVELSTLTC     CCOM                            S01176
     C                     MOVELSTCC5     CCOM                            S01176
     C***********KLSECH    CHAINSECHGDF              44                   S01169
     C           KLSECG    CHAINSECGTDF              44                   S01169
     C           *IN44     IFEQ '1'
     C           *IN44     OREQ '0'
     C           RECI      ANDEQ'*'
     C                     MOVE ' 239'    WERR
     C                     EXSR ERRORS
     C                     SETON                     88
     C                     END
     C                     END
     C*
     C**Local*tax*amount***********************************************   S01176
     C* Charge amount 5                                                   S01176
     C*
     C******.*mandatory*if*Local*Tax*Code*entered**********************   S01176
     C*    .. mandatory if Charge Code 5  entered                         S01176
     C*
     C***********STLTC     IFNE *BLANKS                                   S01176
     C           STCC5     IFNE *BLANKS                                   S01176
     C***********STLTA     ANDEQ*BLANKS                                   S01176
     C           STCA5     ANDEQ*BLANKS                                   S01176
     C                     MOVE ' 240'    WERR
     C                     EXSR ERRORS
     C                     SETON                     89
     C                     END
     C*
     C*****..*prohibited*if*Local*Tax*Code*not*entered*****************   S01176
     C*    .. prohibited if Charge Code 5 entered                         S01176
     C*
     C***********STLTC     IFEQ *BLANKS                                   S01176
     C           STCC5     IFEQ *BLANKS                                   S01176
     C***********STLTA     ANDNE*BLANKS                                   S01176
     C           STCA5     ANDNE*BLANKS                                   S01176
     C                     MOVE ' 240'    WERR
     C                     EXSR ERRORS
     C                     SETON                     89
     C                     END
     C*
     C*    .. if entered, must be a valid amount
     C*
     C***********STLTA     IFNE *BLANKS                                   S01176
     C           STCA5     IFNE *BLANKS                                   S01176
     C                     MOVE *BLANKS   ZFLD17
     C***********          MOVELSTLTA     ZFLD17                          S01176
     C                     MOVELSTCA5     ZFLD17                          S01176
     C           13        SUB  NOMDP     ZSDIG
     C                     Z-ADDNOMDP     ZSDEC
     C                     EXSR ZASIGN
     C           *IN99     IFEQ '1'
     C                     MOVE ' 241'    WERR
     C                     EXSR ERRORS
     C                     SETON                     89
     C                     END
     C                     END
     C*
     C*
      ** The following validation is only carried out if the A            S01176
      ** Auto-Charges is present.                                         S01176
      *                                                                   S01176
     C***********AUMO      IFEQ 'Y'                                 S01176S01117
     C           BVACOP    IFEQ 'Y'                                       S01117
      *                                                                   S01176
      * Charge code 6                                                     S01176
     C*    .. must be a valid code on SECGT                               S01176
     C*                                                                   S01176
     C           STCC6     IFNE *BLANKS                                   S01176
     C                     MOVELNMCYA     CCY                             S01176
     C                     MOVELSTCC6     CCOM                            S01176
     C           KLSECG    CHAINSECGTDF              44                   S01176
     C           *IN44     IFEQ '1'                                       S01176
     C           *IN44     OREQ '0'                                       S01176
     C           RECI      ANDEQ'*'                                       S01176
     C                     MOVE ' 301'    WERR                            S01176
     C                     EXSR ERRORS                                    S01176
     C                     SETON                     34                   S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C* Charge amount 6                                                   S01176
     C*                                                                   S01176
     C*    .. mandatory if Charge Code 6 entered                          S01176
     C*                                                                   S01176
     C           STCA6     IFNE *BLANKS                                   S01176
     C           STCC6     ANDEQ*BLANKS                                   S01176
     C                     MOVE ' 302'    WERR                            S01176
     C                     EXSR ERRORS                                    S01176
     C                     SETON                     36                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C*    .. prohibited if Charge Code 6 not entered                     S01176
     C*                                                                   S01176
     C           STCA6     IFEQ *BLANKS                                   S01176
     C           STCC6     ANDNE*BLANKS                                   S01176
     C                     MOVE ' 302'    WERR                            S01176
     C                     EXSR ERRORS                                    S01176
     C                     SETON                     36                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C*    .. if entered, must be a valid amount                          S01176
     C*                                                                   S01176
     C           STCA6     IFNE *BLANKS                                   S01176
     C                     MOVE *BLANKS   ZFLD17                          S01176
     C                     MOVELSTCA6     ZFLD17                          S01176
     C           13        SUB  NOMDP     ZSDIG                           S01176
     C                     Z-ADDNOMDP     ZSDEC                           S01176
     C                     EXSR ZASIGN                                    S01176
     C           *IN99     IFEQ '1'                                       S01176
     C                     MOVE ' 303'    WERR                            S01176
     C                     EXSR ERRORS                                    S01176
     C                     SETON                     36                   S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
      * Charge code 7                                                     S01176
     C*    .. must be a valid code on SECGT                               S01176
     C*                                                                   S01176
     C           STCC7     IFNE *BLANKS                                   S01176
     C                     MOVELNMCYA     CCY                             S01176
     C                     MOVELSTCC7     CCOM                            S01176
     C           KLSECG    CHAINSECGTDF              44                   S01176
     C           *IN44     IFEQ '1'                                       S01176
     C           *IN44     OREQ '0'                                       S01176
     C           RECI      ANDEQ'*'                                       S01176
     C                     MOVE ' 304'    WERR                            S01176
     C                     EXSR ERRORS                                    S01176
     C                     SETON                     37                   S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C* Charge amount 7                                                   S01176
     C*                                                                   S01176
     C*    .. mandatory if Charge Code 7 entered                          S01176
     C*                                                                   S01176
     C           STCA7     IFNE *BLANKS                                   S01176
     C           STCC7     ANDEQ*BLANKS                                   S01176
     C                     MOVE ' 305'    WERR                            S01176
     C                     EXSR ERRORS                                    S01176
     C                     SETON                     43                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C*    .. prohibited if Charge Code 7 not entered                     S01176
     C*                                                                   S01176
     C           STCA7     IFEQ *BLANKS                                   S01176
     C           STCC7     ANDNE*BLANKS                                   S01176
     C                     MOVE ' 305'    WERR                            S01176
     C                     EXSR ERRORS                                    S01176
     C                     SETON                     43                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C*    .. if entered, must be a valid amount                          S01176
     C*                                                                   S01176
     C           STCA7     IFNE *BLANKS                                   S01176
     C                     MOVE *BLANKS   ZFLD17                          S01176
     C                     MOVELSTCA7     ZFLD17                          S01176
     C           13        SUB  NOMDP     ZSDIG                           S01176
     C                     Z-ADDNOMDP     ZSDEC                           S01176
     C                     EXSR ZASIGN                                    S01176
     C           *IN99     IFEQ '1'                                       S01176
     C                     MOVE ' 306'    WERR                            S01176
     C                     EXSR ERRORS                                    S01176
     C                     SETON                     43                   S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
      * Tax Amount                                                        S01176
      *                                                                   S01176
     C           STAXA     IFNE *BLANKS                                   S01176
     C                     MOVE *BLANKS   ZFLD17                          S01176
     C                     MOVELSTAXA     ZFLD17                          S01176
     C           13        SUB  NOMDP     ZSDIG                           S01176
     C                     Z-ADDNOMDP     ZSDEC                           S01176
     C                     EXSR ZASIGN                                    S01176
     C           *IN99     IFEQ '1'                                       S01176
     C                     MOVE ' 308'    WERR                            S01176
     C                     EXSR ERRORS                                    S01176
     C                     SETON                     46                   S01176
     C                     END                                            S01176
      *                                                                   S01176
     C                     END                                            S01176
      *                                                                   S01176
      * Broker Commission  Rebate                                         S01176
      *                                                                   S01176
     C*    .. prohibited if Broker Commission Code not entered            S01176
     C*                                                                   S01176
     C           SBCMR     IFNE *BLANKS                                   S01176
     C           STBCC     ANDEQ*BLANKS                                   S01176
     C                     MOVE ' 309'    WERR                            S01176
     C                     EXSR ERRORS                                    S01176
     C                     SETON                     47                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C           STBCC     IFNE *BLANKS                                   S01176
     C           SBCMR     ANDNE*BLANKS                                   S01176
     C                     MOVE *BLANKS   ZFLD17                          S01176
     C                     MOVELSBCMR     ZFLD17                          S01176
     C           13        SUB  NOMDP     ZSDIG                           S01176
     C                     Z-ADDNOMDP     ZSDEC                           S01176
     C                     EXSR ZASIGN                                    S01176
     C           *IN99     IFEQ '1'                                       S01176
     C                     MOVE ' 310'    WERR                            S01176
     C                     EXSR ERRORS                                    S01176
     C                     SETON                     47                   S01176
     C                     END                                            S01176
     C                     END                                            S01176
      *                                                                   S01176
      * Customer Commission Rebate                                        S01176
      *                                                                   S01176
     C           SCCMR     IFNE *BLANKS                                   S01176
     C           STCCC     ANDEQ*BLANKS                                   S01176
     C                     MOVE ' 311'    WERR                            S01176
     C                     EXSR ERRORS                                    S01176
     C                     SETON                     48                   S01176
     C                     END                                            S01176
      *                                                                   S01176
     C           STCCC     IFNE *BLANKS                                   S01176
     C           SCCMR     ANDNE*BLANKS                                   S01176
     C                     MOVE *BLANKS   ZFLD17                          S01176
     C                     MOVELSCCMR     ZFLD17                          S01176
     C           13        SUB  NOMDP     ZSDIG                           S01176
     C                     Z-ADDNOMDP     ZSDEC                           S01176
     C                     EXSR ZASIGN                                    S01176
      *
     C           *IN99     IFEQ '1'                                       S01176
     C                     MOVE ' 312'    WERR                            S01176
     C                     EXSR ERRORS                                    S01176
     C                     SETON                     48                   S01176
     C                     END                                            S01176
      *                                                                   S01176
     C                     END                                            S01176
      *                                                                   S01176
      * Tax Rebate                                                        S01176
      *                                                                   S01176
     C           STXRB     IFNE *BLANKS                                   S01176
     C                     MOVE *BLANKS   ZFLD17                          S01176
     C                     MOVELSTXRB     ZFLD17                          S01176
     C           13        SUB  NOMDP     ZSDIG                           S01176
     C                     Z-ADDNOMDP     ZSDEC                           S01176
     C                     EXSR ZASIGN                                    S01176
     C           *IN99     IFEQ '1'                                       S01176
     C                     MOVE ' 314'    WERR                            S01176
     C                     EXSR ERRORS                                    S01176
     C                     SETON                     49                   S01176
     C                     END                                            S01176
     C                     END                                            S01176
      *                                                                   S01176
      * End of Auto-Charges condition.                                    S01176
      *                                                                   S01176
     C                     END                                            S01176
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT                                                                                  CAS006
      *****************************************************************                       CAS006
      *                                                               *                       CAS006
      *  D3INIT - Subroutine to Initialise Screen Format 3.           *                       CAS006
      *                                                               *                       CAS006
      *****************************************************************                       CAS006
     C           D3INIT    BEGSR                                                              CAS006
      *                                                                                       CAS006
      ** Initialise processing and indicator for 3rd screen.                                  CAS006
      *                                                                                       CAS006
     C                     MOVE *ON       *IN02                                               CAS006
     C                     MOVE *ON       WLOOP   1                                           CAS006
     C                     MOVE *BLANKS   SCRFM3                                              CAS006
     C                     Z-ADD*ZERO     CRSK                                                CAS006
     C                     Z-ADD*ZERO     LQPR                                                CAS006
     C                     Z-ADD*ZERO     ITRN                                                CAS006
      *                                                                                       CAS006
      ** Security name                                                                        CAS006
      *                                                                                       CAS006
     C                     MOVELSRPN      SSRPN                                               CAS006
      *                                                                                       CAS006
      ** If interest bearing securities, process Net Treasury                                 CAS006
      ** Coupon Rate.                                                                         CAS006
      *                                                                                       CAS006
     C           *IN11     IFEQ *ON                                                           CAS006
     C                     MOVE *BLANKS   ZFLD15                                              CAS006
     C                     MOVE SESN      SDSN                                                CAS006
     C                     MOVE 'IR'      SDET                                                CAS006
     C                     Z-ADDTDVD      SDED                                                CAS006
     C           KLEVD     SETLLSEDEVDO                                                       CAS006
     C                     READ SEDEVDO                  44                                   CAS006
      *                                                                                       CAS006
     C           *IN44     IFEQ '0'                                                           CAS006
     C           SDSN      ANDEQSESN                                                          CAS006
     C           SDET      ANDEQ'IR'                                                          CAS006
     C                     MOVE SDNN      ZFLD15                                              CAS006
     C                     Z-ADDSDNN      WNTCR  117                                          CAS006
     C                     ELSE                                                               CAS006
     C                     MOVE CPNN      ZFLD15                                              CAS006
     C                     Z-ADDCPNN      WNTCR                                               CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     Z-ADD7         ZDECS                                               CAS006
     C                     MOVE *BLANK    ZECODE                                              CAS006
     C                     EXSR ZSEDIT                                                        CAS006
     C                     MOVE ZOUT21    SNTCR                                               CAS006
      *                                                                                       CAS006
      ** Save original TDCR first and use WNTCR. Also save ZTINA                              CAS006
      ** and ZITRA.                                                                           CAS006
      *                                                                                       CAS006
     C                     Z-ADDZTINA     WTINA                                               CAS006
     C                     Z-ADDZITRA     WITRA                                               CAS006
     C                     Z-ADDTDCR      WTDCR                                               CAS006
     C                     Z-ADDWNTCR     TDCR                                                CAS006
      *                                                                                       CAS006
      ** Process Interest Amount Using N-T-R (ITRN)                                           CAS006
      *                                                                                       CAS006
     C                     Z-ADDNOMDP     ZCDP                                                CAS006
     C                     MOVE SACIN     ZACIN                                               CAS006
     C                     Z-ADDDADJ      ZDADJ                                               CAS006
     C                     MOVE SADIN     ZADIN                                               CAS006
     C                     EXSR ZPCINT                                                        CAS006
      *                                                                                       CAS006
     C                     MOVE *BLANKS   ZFLD15                                              CAS006
     C           PROT      IFEQ '6'                                                           CAS006
     C                     MOVE *ZEROS    ZFLD15                                              CAS006
     C                     ELSE                                                               CAS006
     C                     MOVE ZITRA     ZFLD15                                              CAS006
     C                     ENDIF                                                              CAS006
     C                     Z-ADDNOMDP     ZDECS                                               CAS006
     C                     MOVE *BLANK    ZECODE                                              CAS006
     C                     EXSR ZSEDIT                                                        CAS006
     C                     MOVE ZOUT21    SITRN                                               CAS006
     C                     MOVE ZITRA     WITRN                                               CAS006
     C                     Z-ADDZTINA     WTINN                                               CAS006
      *                                                                                       CAS006
      ** Process Net Treasury Price                                                           CAS006
      *                                                                                       CAS006
     C                     Z-ADDTPDY      WNTP                                                CAS006
      *                                                                                       CAS006
      ** If price basis is 'yield' or 'discount, convert                                      CAS006
      ** amount to price percentage.                                                          CAS006
      *                                                                                       CAS006
     C           STBS      IFEQ 'D'                                                           CAS006
     C           STBS      OREQ 'Y'                                                           CAS006
     C*          WNTP      IFNE *ZEROS                                                        CAS006
     C                     EXSR ZNCD                                                          CAS006
     C                     Z-ADDWNTP      ZPRCIN                                              CAS006
     C                     Z-ADDTDVD      ZFDATE                                              CAS006
      *                                                                                       CAS006
      ** Set up parameters for Australian yields                                              CAS006
      *                                                                                       CAS006
     C           SACIN     IFEQ 'X'                                                           CAS006
     C                     MOVE 'X'       SCUMEX                                              CAS006
     C                     ELSE                                                               CAS006
     C                     MOVE 'C'       SCUMEX                                              CAS006
     C                     END                                                                CAS006
      *                                                                                       CAS006
      ** calculate PI as a fraction of nominal                                                CAS006
      *                                                                                       CAS006
     C           WITRN     DIV  WRKNM     WRKPI                                               CAS006
      *                                                                                       CAS006
     C                     Z-ADDNOML      ZNOML                                               CAS006
     C                     EXSR ZPRCI                                                         CAS006
      *                                                                                       CAS006
     C                     MOVE *BLANKS   ZFLD15                                              CAS006
     C                     MOVE ZPRCOT    ZFLD15                                              CAS006
     C                     ELSE                                                               CAS006
     C                     MOVE *BLANKS   ZFLD15                                              CAS006
     C                     MOVE WNTP      ZFLD15                                              CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     Z-ADD8         ZDECS                                               CAS006
     C                     MOVE *BLANK    ZECODE                                              CAS006
     C                     EXSR ZSEDIT                                                        CAS006
     C                     MOVE ZOUT21    SPRICN                                              CAS006
      *                                                                                       CAS006
      ** Restore TDCR, ZTINA, and ZITRA to original value.                                    CAS006
      *                                                                                       CAS006
     C                     Z-ADDWTDCR     TDCR                                                CAS006
     C                     Z-ADDWTINA     ZTINA                                               CAS006
     C                     Z-ADDWITRA     ZITRA                                               CAS006
      *                                                                                       CAS006
     C                     ELSE                                                               CAS006
     C                     Z-ADD*ZERO     WITRN                                               CAS006
     C                     Z-ADD*ZERO     WTINN                                               CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
      ** If returning to 3rd screen after going to 2nd screen,                                CAS006
      ** restore previously saved screen field values.                                        CAS006
      *                                                                                       CAS006
     C           SCR3BK    IFNE *BLANKS                                                       CAS006
     C                     MOVE SCR3BK    SCRFM3                                              CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
      ** Save fields                                                                          CAS006
      *                                                                                       CAS006
     C                     MOVE SITRN     WSITRN                                              CAS006
      *                                                                                       CAS006
     C                     ENDSR                                                              CAS006
      *****************************************************************                       CAS006
      /EJECT                                                                                  CAS006
      *****************************************************************                       CAS006
      *                                                               *                       CAS006
      *  D3PROC - Subroutine to process Screen Format 3.              *                       CAS006
      *                                                               *                       CAS006
      *****************************************************************                       CAS006
     C           D3PROC    BEGSR                                                              CAS006
      *                                                                                       CAS006
     C           WLOOP     DOUEQ*OFF                                                          CAS006
      *                                                                                       CAS006
      ** Display screen                                                                       CAS006
      *                                                                                       CAS006
     C                     MOVEAER1       ER1MSG                                              CAS006
     C                     MOVEAER2       ER2MSG                                              CAS006
     C                     EXFMTSE0090F0                                                      CAS006
      *                                                                                       CAS006
      ** Reset error messages and indicators                                                  CAS006
      *                                                                                       CAS006
     C                     MOVE *BLANKS   ER1                                                 CAS006
     C                     MOVE *BLANKS   ER1MSG                                              CAS006
     C                     MOVE *BLANKS   ER2                                                 CAS006
     C                     MOVE *BLANKS   ER2MSG                                              CAS006
     C                     Z-ADD0         C1      20                                          CAS006
     C                     Z-ADD0         C2      20                                          CAS006
     C                     MOVE *OFF      *IN61                                               CAS006
     C                     MOVE *OFF      *IN62                                               CAS006
     C                     MOVE *OFF      *IN63                                               CAS006
     C                     MOVE *OFF      *IN64                                               CAS006
     C                     MOVE *OFF      *IN38                                               CAS006
     C                     MOVE *OFF      *IN39                                               CAS006
      *                                                                                       CAS006
     C                     SELEC                                                              CAS006
      *                                                                                       CAS006
      ** If F3 then exit program                                                              CAS006
      *                                                                                       CAS006
     C           *IN01     WHEQ '1'                                                           CAS006
     C                     MOVE *OFF      WLOOP                                               CAS006
      *                                                                                       CAS006
      ** If F12 then display previous screen 2                                                CAS006
      *                                                                                       CAS006
     C           *IN05     WHEQ '1'                                                           CAS006
     C                     MOVE *ON       WSCRN2                                              CAS006
     C                     MOVE *OFF      WLOOP                                               CAS006
      *                                                                                       CAS006
      ** If neither, validate user input                                                      CAS006
      *                                                                                       CAS006
     C                     OTHER                                                              CAS006
      *                                                                                       CAS006
     C                     EXSR D3VALD                                                        CAS006
      *                                                                                       CAS006
      ** If no errors and Net Treasury Rate has already been displayed,                       CAS006
      ** exit loop to proceed to database update.                                             CAS006
      *                                                                                       CAS006
     C           C1        IFEQ 0                                                             CAS006
     C           SCRSK     ANDEQWSCRSK                                                        CAS006
     C           SLQPR     ANDEQWSLQPR                                                        CAS006
     C           SPRICN    ANDEQWSPRCN                                                        CAS006
     C                     MOVE *OFF      WLOOP                                               CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
      ** If errors exists, display error codes.                                               CAS006
      *                                                                                       CAS006
     C           C1        IFGT 0                                                             CAS006
     C                     MOVE *ON       *IN38                                               CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C           C2        IFGT 0                                                             CAS006
     C                     MOVE *ON       *IN39                                               CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     ENDSL                                                              CAS006
      *                                                                                       CAS006
      ** Back up screen 3 field values.                                                       CAS006
      *                                                                                       CAS006
     C                     MOVE SCRFM3    SCR3BK                                              CAS006
      *                                                                                       CAS006
     C                     ENDDO                                                              CAS006
      *                                                                                       CAS006
      ** Switch off screen 3 indicator after processing.                                      CAS006
      *                                                                                       CAS006
     C                     MOVE *OFF      *IN02                                               CAS006
     C                     ENDSR                                                              CAS006
      *****************************************************************                       CAS006
      /EJECT                                                                                  CAS006
      *****************************************************************                       CAS006
      *                                                               *                       CAS006
      *  D3VALD - Subroutine to Validate Screen 3 data entry.         *                       CAS006
      *                                                               *                       CAS006
      *****************************************************************                       CAS006
     C           D3VALD    BEGSR                                                              CAS006
      *                                                                                       CAS006
      ** Validate Credit Risk Spread                                                          CAS006
      *                                                                                       CAS006
     C           SCRSK     IFNE *BLANK                                                        CAS006
     C                     MOVE *BLANKS   WVLFLD                                              CAS006
     C                     MOVELSCRSK     WVLFLD                                              CAS006
     C                     EXSR VALSNM                                                        CAS006
      *                                                                                       CAS006
     C           WINVLD    IFEQ *ON                                                           CAS006
     C                     MOVE ' 247'    WERR                                                CAS006
     C                     EXSR ERRORS                                                        CAS006
     C                     MOVE *ON       *IN61                                               CAS006
     C                     ELSE                                                               CAS006
     C                     MOVE WVLFLD    CRSK                                                CAS006
     C           WNEGTV    IFEQ *ON                                                           CAS006
     C                     Z-SUBCRSK      CRSK                                                CAS006
     C                     ENDIF                                                              CAS006
     C                     ENDIF                                                              CAS006
     C                     ELSE                                                               CAS006
     C                     Z-ADD*ZERO     CRSK                                                CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
      ** Validate Liquidity Premuim                                                           CAS006
      *                                                                                       CAS006
     C           SLQPR     IFNE *BLANK                                                        CAS006
     C                     MOVE *BLANKS   WVLFLD                                              CAS006
     C                     MOVELSLQPR     WVLFLD                                              CAS006
     C                     EXSR VALSNM                                                        CAS006
      *                                                                                       CAS006
     C           WINVLD    IFEQ *ON                                                           CAS006
     C                     MOVE ' 247'    WERR                                                CAS006
     C                     EXSR ERRORS                                                        CAS006
     C                     MOVE *ON       *IN62                                               CAS006
     C                     ELSE                                                               CAS006
     C                     MOVE WVLFLD    LQPR                                                CAS006
     C           WNEGTV    IFEQ *ON                                                           CAS006
     C                     Z-SUBLQPR      LQPR                                                CAS006
     C                     ENDIF                                                              CAS006
     C                     ENDIF                                                              CAS006
     C                     ELSE                                                               CAS006
     C                     Z-ADD*ZERO     LQPR                                                CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
      ** If interest bearing securities..                                                     CAS006
      *                                                                                       CAS006
     C           *IN11     IFEQ *ON                                                           CAS006
      *                                                                                       CAS006
      ** Validate Net Treasury Price                                                          CAS006
      *                                                                                       CAS006
     C           *IN61     IFEQ *OFF                                                          CAS006
     C           *IN62     ANDEQ*OFF                                                          CAS006
      *                                                                                       CAS006
     C           TPDY      ADD  CRSK      WNTP   168                                          CAS006
     C                     ADD  LQPR      WNTP                                                CAS006
      *                                                                                       CAS006
      ** Sum of Trade price, Credit risk spread, and Liquidity                                CAS006
      ** premium should be greater than zero if Trade Basis is                                CAS006
      ** price; else non-negative if discount or yield.                                       CAS006
      *                                                                                       CAS006
     C           WNTP      IFLE 0                                                             CAS006
     C           STBS      ANDEQ'P'                                                           CAS006
     C           WNTP      ORLT 0                                                             CAS006
     C           STBS      ANDNE'P'                                                           CAS006
     C                     MOVE ' 248'    WERR                                                CAS006
     C                     EXSR ERRORS                                                        CAS006
     C                     MOVE *ON       *IN61                                               CAS006
     C                     MOVE *ON       *IN62                                               CAS006
     C                     MOVE *ON       *IN64                                               CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
      ** else, if price basis is 'yield' or 'discount, convert                                CAS006
      ** amount to price percentage.                                                          CAS006
      *                                                                                       CAS006
     C           STBS      IFEQ 'D'                                                           CAS006
     C           *IN64     ANDEQ*OFF                                                          CAS006
     C           STBS      OREQ 'Y'                                                           CAS006
     C           *IN64     ANDEQ*OFF                                                          CAS006
      *                                                                                       CAS006
     C                     EXSR ZNCD                                                          CAS006
     C                     Z-ADDWNTP      ZPRCIN                                              CAS006
     C                     Z-ADDTDVD      ZFDATE                                              CAS006
      *                                                                                       CAS006
      ** Set up parameters for Australian yields                                              CAS006
      *                                                                                       CAS006
     C           SACIN     IFEQ 'X'                                                           CAS006
     C                     MOVE 'X'       SCUMEX                                              CAS006
     C                     ELSE                                                               CAS006
     C                     MOVE 'C'       SCUMEX                                              CAS006
     C                     END                                                                CAS006
      *                                                                                       CAS006
      ** Calculate PI as a fraction of nominal                                                CAS006
      *                                                                                       CAS006
     C           WITRN     DIV  WRKNM     WRKPI                                               CAS006
      *                                                                                       CAS006
     C                     Z-ADDNOML      ZNOML                                               CAS006
     C                     EXSR ZPRCI                                                         CAS006
      *                                                                                       CAS006
     C                     MOVE *BLANKS   ZFLD15                                              CAS006
     C                     MOVE ZPRCOT    ZFLD15                                              CAS006
     C                     ELSE                                                               CAS006
     C                     MOVE *BLANKS   ZFLD15                                              CAS006
     C                     MOVE WNTP      ZFLD15                                              CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     Z-ADD8         ZDECS                                               CAS006
     C                     MOVE *BLANK    ZECODE                                              CAS006
     C                     EXSR ZSEDIT                                                        CAS006
     C                     MOVE ZOUT21    SPRICN                                              CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
      ** Validate Interest Amount Using Net Treasury Rate                                     CAS006
      *                                                                                       CAS006
     C           SITRN     IFNE *BLANK                                                        CAS006
     C                     MOVE *BLANKS   ZFLD17                                              CAS006
     C                     MOVELSITRN     ZFLD17                                              CAS006
     C           13        SUB  NOMDP     ZSDIG                                               CAS006
     C                     Z-ADDNOMDP     ZSDEC                                               CAS006
     C                     EXSR ZASIGN                                                        CAS006
      *                                                                                       CAS006
     C           *IN99     IFEQ '1'                                                           CAS006
     C                     MOVE ' 216'    WERR                                                CAS006
     C                     EXSR ERRORS                                                        CAS006
     C                     MOVE *ON       *IN63                                               CAS006
     C                     ELSE                                                               CAS006
     C                     MOVE ZOUT15    ITRN                                                CAS006
     C           ZFSIGN    IFEQ '-'                                                           CAS006
     C                     Z-SUBITRN      ITRN                                                CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     MOVE *BLANKS   ZFLD15                                              CAS006
     C                     MOVE ITRN      ZFLD15                                              CAS006
     C                     Z-ADDNOMDP     ZDECS                                               CAS006
     C                     MOVE *BLANK    ZECODE                                              CAS006
     C                     EXSR ZSEDIT                                                        CAS006
     C                     MOVE ZOUT21    SITRN                                               CAS006
     C                     MOVE SITRN     WSITRN                                              CAS006
     C                     ENDIF                                                              CAS006
     C                     ENDIF                                                              CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     ENDSR                                                              CAS006
      *****************************************************************                       CAS006
      /EJECT                                                                                  CAS006
      *****************************************************************                       CAS006
      *                                                               *                       CAS006
      *  VALSNM - Validate signed numeric using ZALIGN                *                       CAS006
      *                                                               *                       CAS006
      *****************************************************************                       CAS006
     C           VALSNM    BEGSR                                                              CAS006
      *                                                                                       CAS006
      ** Initialise work variables and array                                                  CAS006
      *                                                                                       CAS006
     C                     MOVE *OFF      WNEGTV  1                                           CAS006
     C                     MOVE *OFF      WINVLD  1                                           CAS006
     C                     MOVEAWVLFLD    ZS3                                                 CAS006
     C                     Z-ADD*ZERO     ZX                                                  CAS006
      *                                                                                       CAS006
      ** Check for negative sign, then check if blanks follow.                                CAS006
      ** If not, flag for error.                                                              CAS006
      *                                                                                       CAS006
     C                     DO   17        ZX                                                  CAS006
     C           WNEGTV    IFEQ *ON                                                           CAS006
     C           ZS3,ZX    ANDNE*BLANK                                                        CAS006
     C                     MOVE *ON       WINVLD                                              CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C           WNEGTV    IFEQ *OFF                                                          CAS006
     C           ZS3,ZX    ANDEQ'-'                                                           CAS006
     C                     MOVE *ON       WNEGTV                                              CAS006
     C                     Z-ADDZX        WPOS    20                                          CAS006
     C                     ENDIF                                                              CAS006
     C                     ENDDO                                                              CAS006
      *                                                                                       CAS006
      ** If no error, validate using ZALIGN. If value is negative,                            CAS006
      ** subtract one from index to exclude negative sign.                                    CAS006
      *                                                                                       CAS006
     C           WINVLD    IFEQ *OFF                                                          CAS006
     C                     MOVE *BLANKS   ZFIELD                                              CAS006
      *                                                                                       CAS006
     C           WNEGTV    IFEQ *ON                                                           CAS006
     C                     SUB  1         WPOS                                                CAS006
     C           WPOS      SUBSTWVLFLD    ZFIELD                                              CAS006
     C                     ELSE                                                               CAS006
     C                     MOVELWVLFLD    ZFIELD                                              CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     Z-ADD7         ZADIG                                               CAS006
     C                     Z-ADD8         ZADEC                                               CAS006
     C                     EXSR ZALIGN                                                        CAS006
      *                                                                                       CAS006
     C           *IN99     IFEQ '1'                                                           CAS006
     C                     MOVE *ON       WINVLD                                              CAS006
     C                     ELSE                                                               CAS006
     C                     MOVE *BLANKS   WVLFLD 17                                           CAS006
     C                     MOVE ZFIELD    WVLFLD                                              CAS006
     C                     ENDIF                                                              CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     ENDSR                                                              CAS006
      *****************************************************************                       CAS006
      /EJECT
      *****************************************************************
      *                                                               *
      *  DBUPDT - Subroutine to Update Database Files.                *
      *                                                               *
      *****************************************************************
      *
     C           DBUPDT    BEGSR                           *** DBUPDT ***
     C*
     C*  Get next transaction number
     C*
     C                     EXSR ZTNLU1
     C*                                                                   S01511
     C** Transaction cannot be updated if S01511 is active, and market    S01511
     C** migration is taking place for the security or market has         S01511
     C** changed                                                          S01511
     C*                                                                   S01511
     C           S01511    IFEQ 'Y'                                       S01511
     C           SSESN     CHAINSECTYDF              44                   S01511
     C           *IN44     IFEQ '0'                                       S01511
     C           MKTI      IFNE SMKTI                                     S01511
     C           SMAI      OREQ 'Y'                                       S01511
     C                     SETON                     38                   S01511
     C                     MOVE 'Y'       WSFLG                           S01511
     C                     MOVEAINF,2     ER1MSG                          S01511
     C                     Z-ADD01021     STATUS                          S01511
     C                     EXSR INFSR                                     S01511
     C                     GOTO DBEND                                     S01511
     C                     END                                            S01511
     C*                                                                   S01511
     C** Security not found                                               S01511
     C*                                                                   S01511
     C                     ELSE                                           S01511
     C           *LOCK     IN   LDA                                       S01511
     C                     MOVEL'SECTYD'  DBFILE           ***************S01511
     C                     Z-ADD19        DBASE            * DB ERROR 19 *S01511
     C                     MOVELSSESN     DBKEY            ***************S01511
     C                     OUT  LDA                                       S01511
     C                     SETON                     U7U801               S01511
     C                     EXSR *PSSR                                     S01511
     C                     GOTO DBEND                                     S01511
     C                     END                                            S01511
     C                     END                                            S01511
     C*
     C* Chain to LF/muser on USRID                                        S01269
     C           USRID     CHAINMUSERDDF             21                   S01269
     C*                                                                   S01269
     C*  Access Client details for Selling Branch
     C*
     C***********          MOVE SBICN     CNUM                            S01117
     C***********          MOVE '1'       RCDT                            S01117
     C***********KLCLNT    CHAINCLINTSEF             44                   S01117
     C                     CALL 'AOSECSR0'                                S01117
     C                     PARM '*DBERR'  @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SBICN     @AENB   6                       S01117
     C           SDSECS    PARM SDSECS    DSSDY                           S01117
      *                                                                   S01117
     C                     MOVE BFCLAS    SCLAS                           S01117
     C*
     C****...**Update*Client*details*if*found*                            S01117
     C************IN44     IFEQ '0'                                       S01117
     C***********RECI      ANDNE'*'                                       S01117
     C***********          EXSR WCLINT                                    S01117
     C***********          MOVE C1DI      SC1DI                           S01117
     C***********                                                         S01117
     C****...**Else*data*base*error*                                      S01117
     C***********          ELSE                                           S01117
     C***********          MOVE '08'      DBASE             ************  S01117
     C***********          MOVEL'CLINT'   DBFILE            * DATABASE *  S01117
     C***********          MOVELSBICN     DBKEY             * ERROR 08 *  S01117
     C***********          SETON                     U7U801 ************  S01117
     C***********          GOTO DBEND                                     S01117
     C***********          END                                            S01117
     C*
     C                     MOVE 'N'       WSFLG   1
     C*
     C*  Access Trade details for Selling Reference
     C*
     C           WSREF     CHAINTRADSDF              44
     C*
     C*  If record exists ...
     C*
     C           *IN44     IFEQ '0'
     C*
     C*   ... check last update
     C*
     C           TNLU      ANDNESAVST
     C                     SETON                     38
     C                     MOVE 'Y'       WSFLG
     C***********          MOVEAINF       ER1MSG                          S01511
     C                     MOVEAINF,1     ER1MSG                          S01511
     C                     Z-ADD01021     STATUS
     C                     EXSR INFSR
     C                     GOTO DBEND
     C                     END
     C/COPY WNCPYSRC,SE0090C031
     C*
     C*  Update Trade details
     C*
     C                     MOVE 'TS'      TDTP
     C*                                                                   CAC002
     C                     Z-ADD0         FXMP                            CAC002
     C                     Z-ADD0         FXMR                            CAC002
     C                     Z-ADD0         MAMT                            CAC002
     C*                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE SSPCCD    BPRC                            CAC002
     C                     MOVE SSPCCD    TPRC                            CAC002
     C                     ELSE                                           CAC002
     C                     MOVE SSPCCD    PRFC                            S01117
     C                     ENDIF                                          CAC002
     C*                                                                   CPM004
     C           *IN09     IFEQ *ON                                       CPM004
     C                     MOVELSSPFR     WPTFR   4                       CPM004
     C                     MOVELWSPTCY    WPTCY   3                       CPM004
     C                     ENDIF                                          CPM004
     C*                                                                   CPM004
     C                     EXSR WTRADS
     C*
     C* Write to PF/TRAUTD (Trade Authorisation file)                     S01269
     C***********AUTT      IFNE '00'                                S01269S01117
     C           BVAUTH    IFNE '00'                                      S01117
     C                     EXSR SUBW70                                    S01269
     C                     END                                            S01269
     C*                                                                   S01269
     C*  Access Client details for Buying Branch
     C*
     C***********          MOVE BBICN     CNUM                            S01117
     C***********          MOVE '1'       RCDT                            S01117
     C***********KLCLNT    CHAINCLINTSEF             44                   S01117
     C                     MOVE BBICN     BFCUST                          S01117
     C                     CALL 'AOSECSR0'                                S01117
     C                     PARM '*DBERR'  @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM BFCUST    @AENB   6                       S01117
     C           SDSECS    PARM SDSECS    DSSDY                           S01117
      *                                                                   S01117
     C                     MOVE BFCLAS    BCLAS                           S01117
     C*
     C****...**Update*Client*details*if*found*                            S01117
     C************IN44     IFEQ '0'                                       S01117
     C***********RECI      ANDNE'*'                                       S01117
     C***********          EXSR WCLINT                                    S01117
     C***********          MOVE C1DI      BC1DI                           S01117
     C***********                                                         S01117
     C****...**Else*data*base*error*                                      S01117
     C***********          ELSE                                           S01117
     C***********          MOVE '09'      DBASE            ***************S01117
     C***********          MOVEL'CLINT'   DBFILE           * DB ERROR 09 *S01117
     C***********          MOVELBBICN     DBKEY            ***************S01117
     C***********          SETON                     U7U801               S01117
     C***********          GOTO DBEND                                     S01117
     C***********          END                                            S01117
     C*
     C*  Access Trade details for Buying Reference
     C*
     C           WBREF     CHAINTRADSDF              44
     C*
     C*  If record exists ...
     C*
     C           *IN44     IFEQ '0'
     C*
     C*   ... check last update
     C*
     C           TNLU      ANDNESAVBT
     C                     SETON                     38
     C                     MOVE 'Y'       WSFLG
     C***********          MOVEAINF       ER1MSG                          S01511
     C                     MOVEAINF,1     ER1MSG                          S01511
     C                     Z-ADD01021     STATUS
     C                     EXSR INFSR
     C                     GOTO DBEND
     C                     END
     C/COPY WNCPYSRC,SE0090C032
     C*
     C*  Update Trade details
     C*
     C                     MOVE 'TP'      TDTP
     C*                                                                   CAC002
     C                     Z-ADD0         FXMP                            CAC002
     C                     Z-ADD0         FXMR                            CAC002
     C                     Z-ADD0         MAMT                            CAC002
     C*                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE SBPCCD    BPRC                            CAC002
     C                     MOVE SBPCCD    TPRC                            CAC002
     C                     ELSE                                           CAC002
     C                     MOVE SBPCCD    PRFC                            S01117
     C                     ENDIF                                          CAC002
     C*                                                                   CPM004
     C           *IN09     IFEQ *ON                                       CPM004
     C                     MOVELSBPFR     WPTFR                           CPM004
     C                     MOVELWBPTCY    WPTCY                           CPM004
     C                     ENDIF                                          CPM004
     C*                                                                   CPM004
     C                     EXSR WTRADS
      *                                                                   S01117
      ** Profit Centre file check/update                                  S01117
      *                                                                   S01117
     C           BKPRCU    IFEQ 'Y'                                       S01117
     C           CAC005    ANDEQ'N'                                       CAC005
     C                     Z-ADD0         @AUDNO  10                      S01117
      *                                                                   S01117
      ** Selling Profit Centre                                            S01117
      *                                                                   S01117
      ** Access Book Position Profit Centre File                          S01117
      *                                                                   S01117
     C           SPCKEY    CHAINSEPCBD               44                   S01117
      *                                                                   S01117
      ** If a record exists (with a different profit centre) when         S01117
      ** previously such a record did not exist then it must have been    S01117
      ** added by another workstation - stop with a database error.       S01117
      *                                                                   S01117
     C           *IN44     IFEQ '0'                                       S01117
     C           @SPREC    IFEQ 'N'                                       S01117
     C           BVTBRC    ANDEQ'Y'                                       S01117
     C           SSPCCD    ANDNEPCBK                                      S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     Z-ADD14        DBASE            ***************S01117
     C                     MOVEL'SEPCBD'  DBFILE           * DB ERROR 14 *S01117
     C                     MOVELSSPCCD    DBKEY            ***************S01117
     C                     SETON                     U7U801               S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     END                                            S01117
     C                     ELSE                                           S01117
      *                                                                   S01117
      ** If no record exists on file then add new record to file          S01117
      *                                                                   S01117
     C                     ADD  1         @AUDNO                          S01117
     C                     MOVE 'D'       RECI                            S01117
     C                     MOVE SSBOK     BOKC                            S01117
     C                     MOVE SSBRC     BRCA                            S01117
     C                     MOVE SSESN     SESN                            S01117
     C                     MOVE STDMI     MKTI                            S01117
     C                     MOVE SSPCCD    PCBK                            S01117
     C                     MOVE RUND      LCD                             S01117
     C                     MOVE 'I'       CHTP                            S01117
     C                     MOVE NATN      TNLU                            S01117
     C                     WRITESEPCBDF                                   S01117
     C                     END                                            S01117
      *                                                                   S01117
      ** Buying Profit Centre                                             S01117
      *                                                                   S01117
      ** Access Book Position Profit Centre File                          S01117
      *                                                                   S01117
     C           BPCKEY    CHAINSEPCBD               44                   S01117
      *                                                                   S01117
      ** If a record exists (with a different profit centre) when         S01117
      ** previously such a record did not exist then it must have been    S01117
      ** added by another workstation - stop with a database error.       S01117
      *                                                                   S01117
     C           *IN44     IFEQ '0'                                       S01117
     C           @BPREC    IFEQ 'N'                                       S01117
     C           BVTBRC    ANDEQ'Y'                                       S01117
     C           SBPCCD    ANDNEPCBK                                      S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     Z-ADD14        DBASE            ***************S01117
     C                     MOVEL'SEPCBD'  DBFILE           * DB ERROR 14 *S01117
     C                     MOVELSBPCCD    DBKEY            ***************S01117
     C                     SETON                     U7U801               S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     END                                            S01117
     C                     ELSE                                           S01117
      *                                                                   S01117
      ** If no record exists on file then add new record to file          S01117
      *                                                                   S01117
     C                     ADD  1         @AUDNO                          S01117
     C                     MOVE 'D'       RECI                            S01117
     C                     MOVE SBBOK     BOKC                            S01117
     C                     MOVE SBBRC     BRCA                            S01117
     C                     MOVE SSESN     SESN                            S01117
     C                     MOVE STDMI     MKTI                            S01117
     C                     MOVE SBPCCD    PCBK                            S01117
     C                     Z-ADDRUND      LCD                             S01117
     C                     MOVE 'I'       CHTP                            S01117
     C                     Z-ADDNATN      TNLU                            S01117
     C                     WRITESEPCBDF                                   S01117
     C                     END                                            S01117
      *                                                                   S01117
      ** Update Audit file                                                S01117
      *                                                                   S01117
     C           @AUDNO    IFGT 0                                         S01117
      *                                                                   063075
      * Reset pointer to first record in case file has been read          063075
      * previously                                                        063075
     C           1         SETLLSEPCA                                     063075
     C                     READ SEPCA                    45               S01117
     C           *IN45     IFEQ '0'                                       S01117
     C***********          Z-ADD@AUDNO    SINS                     S01117 E35251
     C***********          Z-ADD@AUDNO    NORE                     S01117 E35251
     C                     ADD  @AUDNO    SINS                            E35251
     C                     ADD  @AUDNO    NORE                            E35251
     C                     UPDATSEPCAF                                    S01117
     C                     ELSE                                           S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     Z-ADD15        DBASE            ***************S01117
     C                     MOVEL'SEPCA'   DBFILE           * DB ERROR 15 *S01117
     C                     MOVEL'AUDIT'   DBKEY            ***************S01117
     C                     SETON                     U7U801               S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     END                                            S01117
      *                                                                   S01117
     C*
     C*   Update book positions if Transfer is complete
     C*
     C           SINCS     IFEQ 'C'
     C*
     C                     EXSR WBKPSN
     C                     EXSR WDPPSN                                    E14574
     C*
     C*    Update BKPHD audit position
     C*
     C           1         CHAINBKPHDAF              45
     C           *IN45     IFNE '1'
     C                     ADD  BKNOR     NORE
     C                     UPDATBKPHDAF
     C                     Z-ADD*ZEROS    BKNOR
     C                     ELSE
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVE '10'      DBASE                           S01117
     C                     Z-ADD10        DBASE            ***************S01117
     C                     MOVEL'BKPHD'   DBFILE           * DB ERROR 10 *
     C                     MOVEL'AUDIT'   DBKEY            ***************
     C***********          SETON                     U7U8                 E24398
     C                     SETON                     U7U801               E24398
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     END
     C*
     C*    Update BKPOSA audit position
     C*
     C           1         CHAINBKPOSAF              45
     C           *IN45     IFNE '1'
     C                     ADD  BSNOR     NORE
     C                     UPDATBKPOSAF
     C                     Z-ADD*ZEROS    BSNOR
     C                     ELSE
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVE '11'      DBASE                           S01117
     C                     Z-ADD11        DBASE            ***************S01117
     C                     MOVEL'BKPOS'   DBFILE           * DB ERROR 11 *
     C                     MOVEL'AUDIT'   DBKEY            ***************
     C***********          SETON                     U7U8                 E24398
     C                     SETON                     U7U801               E24398
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     END
     C*
     C                     END
     C*
     C* Write to PF/TRAUTD (Trade Authorisation file)                     S01269
     C***********AUTT      IFNE '00'                                S01269S01117
     C           BVAUTH    IFNE '00'                                      S01117
     C                     EXSR SUBW70                                    S01269
     C                     END                                            S01269
     C*                                                                   S01269
     C*  COMIT
     C                     MOVE SCRFM1    SCFM1X
     C                     MOVE SCRFM2    SCFM2X
     C                     TIME           MTIME
     C*
     C           CMTTXT    COMIT
     C*
     C           DBEND     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  ERRORS - Subroutine to Add Error Codes to the Error Arrays.  *
      *                                                               *
      *****************************************************************
      *
     C           ERRORS    BEGSR                           *** ERRORS ***
     C*
     C           C1        IFLT 19
     C*
     C*  If array 1 not full add error code
     C*
     C                     ADD  1         C1
     C                     MOVEAWERR      ER1,C1
     C*
     C*  If array 1 full check array 2
     C*
     C                     ELSE
     C           C2        IFLT 19
     C*
     C*  If array 2 not full add error code
     C*
     C                     ADD  1         C2
     C                     MOVEAWERR      ER2,C2
     C*
     C                     END
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  FAPOSD - Subroutine to Set up File Access Key for BKPOSD.    *
      *                                                               *
      *****************************************************************
      *
     C           FAPOSD    BEGSR                           *** FAPOSD ***
     C*
     C                     MOVELSSESN     BPSC
     C*
     C***********          TESTN          SSBRC      35                   S01117
     C************IN35     IFEQ '1'                                       S01117
     C***********          MOVELSSBRC     BPBR                            S01117
     C***********          ELSE                                           S01117
     C***********          MOVELDSTB      BPBR                            S01117
     C***********          END                                            S01117
      *                                                                   S01117
     C           SSBRC     IFEQ *BLANK                                    S01117
     C                     MOVELDFTBRC    BPBA                            S01117
     C                     ELSE                                           S01117
     C                     MOVELSSBRC     BPBA                            S01117
     C                     END
     C*
     C           SSBOK     IFNE *BLANKS
     C                     MOVELSSBOK     BPBK
     C                     ELSE
     C***********          MOVELDMKB      BPBK                            S01117
     C                     MOVELBVDMBC    BPBK                            S01117
     C                     END
     C*
     C                     MOVELMKTI      BPMK
     C*
     C***********          MOVELTVVL      BPTV                            S01117
     C                     MOVELBVTVDV    BPTV                            S01117
     C                     Z-ADDTDVD      BPPD
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  INFSR  - File Exception/Error handling Subroutine.           *
      *                                                               *
      *****************************************************************
      *
     C           INFSR     BEGSR                           *** INFSR  ***
     C**
     C**   CHECK ERROR TYPE
     C**
     C           STATUS    IFEQ 01021
     C**
     C**   CHAIN TO FILE TO GET CURRENT DETAILS
     C**
     C           *IN44     IFEQ '0'
     C**
     C**   RECORD ALREADY EXISTS
     C**
     C                     MOVEL'*DETC'   EXTTAG  6
     C**
     C                     ELSE
     C                     MOVE '*CANCL'  EXTTAG
     C                     END
     C**
     C                     ELSE
     C                     MOVE '*CANCL'  EXTTAG
     C                     END
     C*
     C                     ROLBK
     C**
     C                     ENDSREXTTAG
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  WBKPHD - Subroutine to Write Book Position Headers.          *
      *                                                               *
      *****************************************************************
      *
     C           WBKPHD    BEGSR                           *** WBKPHD ***
      *
     C                     MOVE 'D'       RECI
     C***********          Z-ADDRUND      FPSD                            E16083
     C***********          Z-ADDRUND      LPSD                            E14962
      *
     C           BHTV      IFEQ 'T'                                       E16083
     C                     Z-ADDTDDT      FPSD                            E16083
     C                     Z-ADDTDDT      LPSD                            E16083
     C                     ELSE                                           E16083
     C                     Z-ADDTDVD      FPSD                            E16083
     C                     Z-ADDTDVD      LPSD                            E16083
     C                     END                                            E16083
      *
     C                     Z-ADD*ZEROS    LPCD
     C                     Z-ADD*ZEROS    LAVP
     C                     Z-ADD*ZEROS    LATD
     C                     Z-ADD*ZEROS    ARPC
     C                     Z-ADDTDVD      ICLD
     C                     Z-ADD*ZEROS    IACR
     C                     Z-ADD*ZEROS    IACP
     C                     Z-ADD*ZEROS    INDO
     C                     Z-ADD*ZEROS    UPPT
     C                     Z-ADD*ZEROS    DPAP
     C                     Z-ADD*ZEROS    DPFP                            S01397
     C                     Z-ADD*ZEROS    BUDU
     C                     MOVE SITP      INVT
     C                     MOVE NMCYA     NCRY
     C                     Z-ADD*ZEROS    LPRC
     C                     Z-ADD*ZEROS    BHDP
     C                     Z-ADD*ZEROS    BHCP
     C                     Z-ADD*ZEROS    BHPP
     C***********          Z-ADDFNATN     TNLU                            E16083
     C                     Z-ADDNATN      TNLU                            E16083
      *                                                                                       CAS006
      ** Zeroise LAVN, DPAN, BUDN, INDN, FSEFUP and FSECUP.                                   CAS006
      *                                                                                       CAS006
     C                     Z-ADD0         LAVN                                                CAS006
     C                     Z-ADD0         DPAN                                                CAS006
     C                     Z-ADD0         BUDN                                                CAS006
     C                     Z-ADD0         INDN                                                CAS006
     C                     Z-ADD0         FSEFUP                                              CAS006
     C                     Z-ADD0         FSECUP                                              CAS006
      *                                                                                       CAS006
     C/COPY WNCPYSRC,SE0090C025
     C*
     C                     Z-ADD0         NAVP                                                CSE065
     C                     Z-ADD0         BKVAMT                                              CSE065
     C                     Z-ADD0         EQTAMT                                              CSE065
      *                                                                                       CSE065
     C                     WRITEBKPHDDF
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  WBKPOS - Subroutine to Write Book Trade/Value Date Positions.*
      *                                                               *
      *****************************************************************
      *
     C           WBKPOS    BEGSR                           *** WBKPOS ***
     C*
     C                     MOVE 'D'       RECI
     C                     MOVELTDSS      BPSC
     C                     MOVELTDMI      BPMK
     C***********          Z-ADDRUND      BPPD                            E16083
      *
     C           BPTV      IFEQ 'T'                                       E16083
     C                     Z-ADDTDDT      BPPD                            E16083
     C                     ELSE                                           E16083
     C                     Z-ADDTDVD      BPPD                            E16083
     C                     END                                            E16083
      *
     C                     Z-ADD*ZEROS    ECNP
     C                     Z-ADD*ZEROS    APPB
     C                     Z-ADD*ZEROS    RPTP
     C                     Z-ADD*ZEROS    PILP
     C                     Z-ADD*ZEROS    ANMP
     C                     Z-ADD*ZEROS    AAPR
     C                     MOVE *BLANK    ADJI
     C***********          Z-ADDFNATN     TNLU                            E16083
     C                     Z-ADDNATN      TNLU                            E16083
     C*
      ** Zeroise APPN APNN and PILN.                                                          CAS006
      *                                                                                       CAS006
     C                     Z-ADD0         APPN                                                CAS006
     C                     Z-ADD0         APNN                                                CAS006
     C                     Z-ADD0         PILN                                                CAS006
      *                                                                                       CAS006
     C                     Z-ADD0         BKCOST                                              CSE065
      *                                                                                       CSE065
     C                     WRITEBKPOSDF
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  WBKPSN - Subroutine to Update Book Positions.                *
      *                                                               *
      *****************************************************************
      *
     C           WBKPSN    BEGSR                           *** WBKPSN ***
     C*
     C*  For Selling Book ...
     C*
     C*    Access BKPHDD trade date position
     C*
     C                     MOVELTDSS      BHSC
     C***********          MOVELSSBRC     BHBR                            S01117
     C                     MOVELSSBRC     BHBA                            S01117
     C                     MOVELSSBOK     BHBK
     C                     MOVELTDMI      BHMK
     C                     MOVEL'T'       BHTV
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVELWSPSBK    BHBK                            CAC005
     C                     ENDIF                                          CAC005
     C           KLBKPH    CHAINBKPHDDF              44
     C*
     C*    Write BKPHDD trade date position if not found
     C*
     C           *IN44     IFEQ '1'
     C                     Z-ADDTDDT      LPSD                            E14962
     C                     EXSR WBKPHD
     C                     ADD  1         BKNOR
     C***********          ELSE                                           E16328
     C***********          Z-ADDRUND      LPSD                            E14962
     C***********          Z-ADDTDDT      LPSD                      E14962E16328
     C***********          UPDATBKPHDDF                                   E16328
     C                     END
     C*                                                                   E16083
     C* REMEMBER DATE                                                     E16083
     C*                                                                   E16083
     C                     Z-ADDLPSD      SBTLPS  50                      E16083
     C*
     C*    If value date LE run date :-
     C*     Access BKPHDD value date position
     C*
     C           TDVD      IFLE RUND
     C*
     C                     MOVELTDSS      BHSC
     C***********          MOVELSSBRC     BHBR                            S01117
     C                     MOVELSSBRC     BHBA                            S01117
     C                     MOVELSSBOK     BHBK
     C                     MOVELTDMI      BHMK
     C                     MOVEL'V'       BHTV
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVELWSPSBK    BHBK                            CAC005
     C                     ENDIF                                          CAC005
     C           KLBKPH    CHAINBKPHDDF              44
     C*
     C*    Write BKPHD value date position if not found
     C*
     C           *IN44     IFEQ '1'
     C                     Z-ADDTDVD      LPSD                            E14962
     C                     EXSR WBKPHD
     C                     ADD  1         BKNOR
     C***********          ELSE                                           E16328
     C***********          Z-ADDRUND      LPSD                            E14962
     C***********          Z-ADDTDVD      LPSD                      E14962E16328
     C***********          UPDATBKPHDDF                                   E16328
     C                     END
     C                     END
     C*                                                                   E16083
     C* REMEMBER DATE                                                     E16083
     C*                                                                   E16083
     C                     Z-ADDLPSD      SBVLPS  50                      E16083
     C*
     C*  For Buying Book ...
     C*
     C*    Access BKPHDD trade date position
     C*
     C                     MOVELTDSS      BHSC
     C***********          MOVELSBBRC     BHBR                            S01117
     C                     MOVELSBBRC     BHBA                            S01117
     C                     MOVELSBBOK     BHBK
     C                     MOVELTDMI      BHMK
     C                     MOVEL'T'       BHTV
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVELWBPSBK    BHBK                            CAC005
     C                     ENDIF                                          CAC005
     C           KLBKPH    CHAINBKPHDDF              44
     C*
     C*    Write BKPHDD trade date position if not found
     C*
     C           *IN44     IFEQ '1'
     C                     Z-ADDTDDT      LPSD                            E14962
     C                     EXSR WBKPHD
     C                     ADD  1         BKNOR
     C***********          ELSE                                           E16328
     C***********          Z-ADDRUND      LPSD                            E14962
     C***********          Z-ADDTDDT      LPSD                     E14962 E16328
     C***********          UPDATBKPHDDF                                   E16328
     C                     END
     C*                                                                   E16083
     C* REMEMBER DATE                                                     E16083
     C*                                                                   E16083
     C                     Z-ADDLPSD      BBTLPS  50                      E16083
     C*
     C*    If value date LE run date :-
     C*     Access BKPHDD value date position
     C*
     C           TDVD      IFLE RUND
     C*
     C                     MOVELTDSS      BHSC
     C***********          MOVELSBBRC     BHBR                            S01117
     C                     MOVELSBBRC     BHBA                            S01117
     C                     MOVELSBBOK     BHBK
     C                     MOVELTDMI      BHMK
     C                     MOVEL'V'       BHTV
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVELWBPSBK    BHBK                            CAC005
     C                     ENDIF                                          CAC005
     C           KLBKPH    CHAINBKPHDDF              44
     C*
     C*    Write BKPHD value date position if not found
     C*
     C           *IN44     IFEQ '1'
     C                     Z-ADDTDVD      LPSD                            E14962
     C                     EXSR WBKPHD
     C                     ADD  1         BKNOR
     C***********          ELSE                                           E16328
     C***********          Z-ADDRUND      LPSD                            E14962
     C***********          Z-ADDTDVD      LPSD                     E14962 E16328
     C***********          UPDATBKPHDDF                                   E16328
     C                     END
     C                     END
     C*                                                                   E16083
     C* REMEMBER DATE                                                     E16083
     C*                                                                   E16083
     C                     Z-ADDLPSD      BBVLPS  50                      E16083
     C*
     C*  For Selling Book ...
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0090CCP7                                           S01408
     C*                                                                   S01408
     C                     MOVE 'TS'      TDTP
     C*
     C*    Access BKPOS trade date position
     C*
     C                     MOVELTDSS      BPSC
     C***********          MOVELSSBRC     BPBR                            S01117
     C                     MOVELSSBRC     BPBA                            S01117
     C                     MOVELSSBOK     BPBK
     C                     MOVELTDMI      BPMK
     C                     MOVEL'T'       BPTV
     C***********          Z-ADDRUND      BPPD                            E16083
     C                     Z-ADDSBTLPS    BPPD                            E16083
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVELWSPSBK    BPBK                            CAC005
     C                     ENDIF                                          CAC005
     C           KLBKPS    CHAINBKPOSDF              44
     C*
     C*    Update BKPOS trade date positions :-
     C*
     C           *IN44     IFEQ '1'
     C                     ADD  1         BSNOR
      *
     C*********Record*to*be*added*find*previous*nominal*position*******   E16083
     C***********                                                         E16083
     C***********          Z-ADD99999     BPPD                            E16083
     C***********KLBKPS    SETGTBKPOSDF                                   E16083
     C***********          READPBKPOSDF                  44               E16083
     C************IN44     IFEQ '1'                                       E16083
     C***********TDSS      ORNE BPSC                                      E16083
     C***********WSBRC     ORNE BPBR                                      E16083
     C***********SSBOK     ORNE BPBK                                      E16083
     C***********TDMI      ORNE BPMK                                      E16083
     C***********BPTV      ORNE 'T'                                       E16083
     C                     Z-ADD*ZEROS    NPSN
     C                     Z-ADD*ZEROS    APNC
     C***********          END                                            E16083
     C***********          MOVELSSBRC     BPBR                            S01117
     C                     MOVELSSBRC     BPBA                            S01117
     C                     MOVELSSBOK     BPBK
     C                     MOVEL'T'       BPTV
     C                     Z-ADD*ZEROS    SNPI
     C                     Z-ADD*ZEROS    SANP
     C                     Z-ADD*ZEROS    SNSI
     C                     Z-ADD*ZEROS    SANS
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVELWSPSBK    BPBK                            CAC005
     C                     ENDIF                                          CAC005
     C*
     C*    Calculate trade date positions
     C*
     C                     EXSR CBKPOS
     C                     EXSR WBKPOS
     C*
     C                     ELSE
     C*
     C*    Calculate trade date positions
     C*
     C                     EXSR CBKPOS
     C*
     C***********          Z-ADDFNATN     TNLU                            E16083
     C                     Z-ADDNATN      TNLU                            E16083
      *                                                                                       CAS006
      ** Zeroise APPN APNN and PILN.                                                          CAS006
      *                                                                                       CAS006
     C                     Z-ADD0         APPN                                                CAS006
     C                     Z-ADD0         APNN                                                CAS006
     C                     Z-ADD0         PILN                                                CAS006
      *                                                                                       CAS006
     C                     UPDATBKPOSDF
     C*
     C                     END
     C*
     C*    If value date LE run date :-
     C*     Access BKPOS value date position
     C*
     C           TDVD      IFLE RUND
     C*
     C                     MOVELTDSS      BPSC
     C***********          MOVELSSBRC     BPBR                            S01117
     C                     MOVELSSBRC     BPBA                            S01117
     C                     MOVELSSBOK     BPBK
     C                     MOVELTDMI      BPMK
     C                     MOVEL'V'       BPTV
     C***********          Z-ADDRUND      BPPD                            E16083
     C                     Z-ADDSBVLPS    BPPD                            E16083
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVELWSPSBK    BPBK                            CAC005
     C                     ENDIF                                          CAC005
     C           KLBKPS    CHAINBKPOSDF              44
     C*
     C*    Update BKPOS value date positions :-
     C*
     C           *IN44     IFEQ '1'
     C                     ADD  1         BSNOR
      *
     C**********Record*to*be*added*find*previous*nominal*position******   E16083
     C***********                                                         E16083
     C***********          Z-ADD99999     BPPD                            E16083
     C***********KLBKPS    SETGTBKPOSDF                                   E16083
     C***********          READPBKPOSDF                  44               E16083
     C************IN44     IFEQ '1'                                       E16083
     C***********TDSS      ORNE BPSC                                      E16083
     C***********WSBRC     ORNE BPBR                                      E16083
     C***********SSBOK     ORNE BPBK                                      E16083
     C***********TDMI      ORNE BPMK                                      E16083
     C***********BPTV      ORNE 'V'                                       E16083
     C                     Z-ADD*ZEROS    NPSN
     C                     Z-ADD*ZEROS    APNC
     C***********          END                                            E16083
     C*
     C***********          MOVELSSBRC     BPBR                            S01117
     C                     MOVELSSBRC     BPBA                            S01117
     C                     MOVELSSBOK     BPBK
     C                     MOVEL'V'       BPTV
     C                     Z-ADD*ZEROS    SNPI
     C                     Z-ADD*ZEROS    SANP
     C                     Z-ADD*ZEROS    SNSI
     C                     Z-ADD*ZEROS    SANS
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVELWSPSBK    BPBK                            CAC005
     C                     ENDIF                                          CAC005
     C*
     C*    Calculate BKPOS value date positions
     C*
     C                     EXSR CBKPOS
     C                     EXSR WBKPOS
     C*
     C                     ELSE
     C*
     C*    Calculate BKPOS value date positions
     C*
     C                     EXSR CBKPOS
     C*
     C***********          Z-ADDFNATN     TNLU                            E16083
     C                     Z-ADDNATN      TNLU                            E16083
      *                                                                                       CAS006
      ** Zeroise APPN APNN and PILN.                                                          CAS006
      *                                                                                       CAS006
     C                     Z-ADD0         APPN                                                CAS006
     C                     Z-ADD0         APNN                                                CAS006
     C                     Z-ADD0         PILN                                                CAS006
      *                                                                                       CAS006
     C                     UPDATBKPOSDF
     C*
     C                     END
     C                     END
     C*
     C*  For Buying Book ...
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0090CCP5                                           S01408
     C*                                                                   S01408
     C                     MOVE 'TP'      TDTP
     C*
     C*    Access BKPOS trade date position
     C*
     C                     MOVELTDSS      BPSC
     C***********          MOVELSBBRC     BPBR                            S01117
     C                     MOVELSBBRC     BPBA                            S01117
     C                     MOVELSBBOK     BPBK
     C                     MOVELTDMI      BPMK
     C                     MOVEL'T'       BPTV
     C***********          Z-ADDRUND      BPPD                            E16083
     C                     Z-ADDBBTLPS    BPPD                            E16083
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVELWBPSBK    BPBK                            CAC005
     C                     ENDIF                                          CAC005
     C           KLBKPS    CHAINBKPOSDF              44
     C*
     C*    Update BKPOS trade date positions :-
     C*
     C           *IN44     IFEQ '1'
     C                     ADD  1         BSNOR
      *
     C***********cord to be added find previous nominal position          E16083
     C***********                                                         E16083
     C***********          Z-ADD99999     BPPD                            E16083
     C***********KLBKPS    SETGTBKPOSDF                                   E16083
     C***********          READPBKPOSDF                  44               E16083
     C************IN44     IFEQ '1'                                       E16083
     C***********TDSS      ORNE BPSC                                      E16083
     C***********WBBRC     ORNE BPBR                                      E16083
     C***********SBBOK     ORNE BPBK                                      E16083
     C***********TDMI      ORNE BPMK                                      E16083
     C***********BPTV      ORNE 'T'                                       E16083
     C                     Z-ADD*ZEROS    NPSN
     C                     Z-ADD*ZEROS    APNC
     C***********          END                                            E16083
     C***********          MOVELSBBRC     BPBR                            S01117
     C                     MOVELSBBRC     BPBA                            S01117
     C                     MOVELSBBOK     BPBK
     C                     MOVEL'T'       BPTV
     C                     Z-ADD*ZEROS    SNSI
     C                     Z-ADD*ZEROS    SANS
     C                     Z-ADD*ZEROS    SNPI
     C                     Z-ADD*ZEROS    SANP
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVELWBPSBK    BPBK                            CAC005
     C                     ENDIF                                          CAC005
     C*
     C*    Calculate trade date positions
     C*
     C                     EXSR CBKPOS
     C                     EXSR WBKPOS
     C*
     C                     ELSE
     C*
     C*    Calculate trade date positions
     C*
     C                     EXSR CBKPOS
     C*
     C***********          Z-ADDFNATN     TNLU                            E16083
     C                     Z-ADDNATN      TNLU                            E16083
      *                                                                                       CAS006
      ** Zeroise APPN APNN and PILN.                                                          CAS006
      *                                                                                       CAS006
     C                     Z-ADD0         APPN                                                CAS006
     C                     Z-ADD0         APNN                                                CAS006
     C                     Z-ADD0         PILN                                                CAS006
      *                                                                                       CAS006
     C                     UPDATBKPOSDF
     C*
     C                     END
     C*
     C*    If value date LE run date :-
     C*     Access BKPOS value date position
     C*
     C           TDVD      IFLE RUND
     C*
     C                     MOVELTDSS      BPSC
     C***********          MOVELSBBRC     BPBR                            S01117
     C                     MOVELSBBRC     BPBA                            S01117
     C                     MOVELSBBOK     BPBK
     C                     MOVELTDMI      BPMK
     C                     MOVEL'V'       BPTV
     C***********          Z-ADDRUND      BPPD                            E16083
     C                     Z-ADDBBVLPS    BPPD                            E16083
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVELWBPSBK    BPBK                            CAC005
     C                     ENDIF                                          CAC005
     C           KLBKPS    CHAINBKPOSDF              44
     C*
     C*    Update BKPOS value date positions :-
     C*
     C           *IN44     IFEQ '1'
     C                     ADD  1         BSNOR
      *
     C**********Record*to*be*added*find*previous*nominal*position******   E16083
     C***********                                                         E16083
     C***********          Z-ADD99999     BPPD                            E16083
     C***********KLBKPS    SETGTBKPOSDF                                   E16083
     C***********          READPBKPOSDF                  44               E16083
     C************IN44     IFEQ '1'                                       E16083
     C***********TDSS      ORNE BPSC                                      E16083
     C***********WBBRC     ORNE BPBR                                      E16083
     C***********SBBOK     ORNE BPBK                                      E16083
     C***********TDMI      ORNE BPMK                                      E16083
     C***********BPTV      ORNE 'V'                                       E16083
     C                     Z-ADD*ZEROS    NPSN
     C                     Z-ADD*ZEROS    APNC
     C***********          END                                            E16083
     C*
     C***********          MOVELSBBRC     BPBR                            S01117
     C                     MOVELSBBRC     BPBA                            S01117
     C                     MOVELSBBOK     BPBK
     C                     MOVEL'V'       BPTV
     C                     Z-ADD*ZEROS    SNSI
     C                     Z-ADD*ZEROS    SANS
     C                     Z-ADD*ZEROS    SNPI
     C                     Z-ADD*ZEROS    SANP
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVELWBPSBK    BPBK                            CAC005
     C                     ENDIF                                          CAC005
     C*
     C*    Calculate BKPOS value date positions
     C*
     C                     EXSR CBKPOS
     C                     EXSR WBKPOS
     C*
     C                     ELSE
     C*
     C*    Calculate BKPOS value date positions
     C*
     C                     EXSR CBKPOS
     C*
     C***********          Z-ADDFNATN     TNLU                            E16083
     C                     Z-ADDNATN      TNLU                            E16083
      *                                                                                       CAS006
      ** Zeroise APPN APNN and PILN.                                                          CAS006
      *                                                                                       CAS006
     C                     Z-ADD0         APPN                                                CAS006
     C                     Z-ADD0         APNN                                                CAS006
     C                     Z-ADD0         PILN                                                CAS006
      *                                                                                       CAS006
     C                     UPDATBKPOSDF
     C*
     C                     END
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      ***********                                                         S01117
      ***/EJECT**                                                         S01117
      *****************************************************************   S01117
      ***********                                                     *   S01117
      ***WCLINT*-*Subroutine*to*Update*Client*Details.*****************   S01117
      ***********                                                     *   S01117
      *****************************************************************   S01117
      ***********                                                         S01117
     C***********WCLINT    BEGSR                           *** WCLINT *** S01117
     C***********                                                         S01117
     C***********          ADD  1         C1CN                            S01117
     C***********          Z-ADDFNATN     TNLU                            E16083
     C***********          Z-ADDNATN      TNLU                      E16083S01117
     C***********                                                         S01117
     C***********          UPDATCLINTSEF                                  S01117
     C***********                                                         S01117
     C***********          ENDSR                                          S01117
      ***********                                                         S01117
      *****************************************************************   S01117
      /EJECT                                                              E14574
      *****************************************************************   E14574
      *                                                               *   E14574
      *  WDPPSN - Subroutine to Update User Depot Positions.          *   E14574
      *                                                               *   E14574
      *****************************************************************   E14574
      *                                                                   E14574
     C           WDPPSN    BEGSR                           *** WDPPSN *** E14574
      *                                                                   E14574
      ***  Selling Depot Update                                           E14574
      *                                                                   E14574
     C                     MOVE SSBRC     WSBRC                           E14574
     C***********          MOVE SDEPT     WDEPT                     E14574E16469
     C                     MOVELSDEPT     WDEPT                           E16469
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVELWSPSBK    KSBOK                           CAC005
     C                     ELSE                                           CAC005
     C                     MOVELSSBOK     KSBOK                           CAC005
     C                     ENDIF                                          CAC005
     C           SDPKEY    CHAINUDEPPDF              44                   E14574
     C           *IN44     IFEQ '1'                                       E14574
     C                     Z-ADD0         UDTP                            E14574
     C                     Z-ADD0         UDTS                            E14574
     C                     Z-ADD0         UDPV                            E14574
     C                     Z-ADD0         UDSV                            E14574
     C                     Z-ADD0         UNSI                            E16083
     C                     END                                            E14574
      *                                                                   E14574
     C           UDTS      SUB  NOML      UDTS                            E14574
     C*                                                                   E14574
     C           TDVD      IFLE RUND                                      E14574
     C           UDSV      SUB  NOML      UDSV                            E14574
     C                     SUB  NOML      UNSI                            E16083
     C                     END                                            E14574
      *                                                                   E14574
     C           *IN44     IFEQ '1'                                       E14574
     C***********          MOVE SSBRC     UDBR                      E14574S01117
     C                     MOVE SSBRC     UDBA                            S01117
     C                     MOVELSDEPT     UDPT                            E14574
     C                     MOVE SSBOK     UDBK                            E14574
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVELWSPSBK    UDBK                            CAC005
     C                     ENDIF                                          CAC005
     C                     EXSR WUDEPP                                    E14574
     C                     ELSE                                           E14574
     C***********          Z-ADDFNATN     TNLU                      E14574E16083
     C                     Z-ADDNATN      TNLU                            E16083
     C                     UPDATUDEPPDF                                   E14574
     C                     END                                            E14574
      *                                                                   E14574
      ***  Buying Depot Update                                            E14574
      *                                                                   E14574
     C                     MOVE SBBRC     WBBRC                           E14574
     C***********          MOVE SDEPT     WDEPT                     E14574E16469
     C                     MOVELSDEPT     WDEPT                           E16469
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVELWBPSBK    KBBOK                           CAC005
     C                     ELSE                                           CAC005
     C                     MOVELSBBOK     KBBOK                           CAC005
     C                     ENDIF                                          CAC005
     C           BDPKEY    CHAINUDEPPDF              44                   E14574
     C           *IN44     IFEQ '1'                                       E14574
     C                     Z-ADD0         UDTP                            E14574
     C                     Z-ADD0         UDTS                            E14574
     C                     Z-ADD0         UDPV                            E14574
     C                     Z-ADD0         UDSV                            E14574
     C                     Z-ADD0         UNSI                            E16083
     C                     END                                            E14574
      *                                                                   E14574
     C                     ADD  NOML      UDTP                            E14574
      *                                                                   E14574
     C           TDVD      IFLE RUND                                      E14574
     C                     ADD  NOML      UDPV                            E14574
     C                     ADD  NOML      UNSI                            E16083
     C                     END                                            E14574
      *                                                                   E14574
     C           *IN44     IFEQ '1'                                       E14574
     C***********          MOVE SBBRC     UDBR                      E14574S01117
     C                     MOVE SBBRC     UDBA                            S01117
     C                     MOVELSDEPT     UDPT                            E14574
     C                     MOVE SBBOK     UDBK                            E14574
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVELWBPSBK    UDBK                            CAC005
     C                     ENDIF                                          CAC005
     C                     EXSR WUDEPP                                    E14574
     C                     ELSE                                           E14574
     C***********          Z-ADDFNATN     TNLU                      E14574E16083
     C                     Z-ADDNATN      TNLU                            E16083
     C                     UPDATUDEPPDF                                   E14574
     C                     END                                            E14574
      *                                                                   E14574
     C                     ENDSR                                          E14574
      *                                                                   E14574
      *****************************************************************   E14574
      /EJECT
      *****************************************************************
      *                                                               *
      *  WTRADS - Subroutine to Update Trade Details.                 *
      *                                                               *
      *****************************************************************
      *
     C           WTRADS    BEGSR                           *** WTRADS ***
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0090CCP6                                           S01408
     C*                                                                   S01408
     C*
     C*********************MOVE 'D'       RECI                            S01269
     C                     MOVELSINCS     TINC
     C                     MOVELSSESN     TDSS
     C*    .. Nominal
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSNOML     ZFIELD
     C           11        SUB  NMDP      ZADIG
     C                     Z-ADDNMDP      ZADEC
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    NOML
     C                     MOVE NMCYA     TNMC
     C                     MOVE NMCYA     SETC
     C                     Z-ADDNMDP      TNMD
      *
     C*  .. Price/Discount/Yield
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSTPDY     ZFIELD
     C                     Z-ADD7         ZADIG
     C                     Z-ADD8         ZADEC
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    TPDY
      *
     C*    .. Value Date
     C                     MOVELSTDVD     ZDATE
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    TDVD
      *
     C*    .. Trade Date
     C                     MOVELSTDDT     ZDATE
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    TDDT
     C                     MOVELSTSUB     TSUB
     C                     MOVELSTDMI     TDMI
     C                     MOVELSTDNR     TDNR
     C                     MOVELSTDID     TDID
     C                     MOVELSAIIP     AIIP
     C                     MOVELSTMKC     TMKC
     C                     MOVELSTCAP     TCAP
     C*    .. Current Factor
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSTCFC     ZFIELD
     C                     Z-ADD1         ZADIG
     C**********           Z-ADD8         ZADEC                           052254
     C                     Z-ADD9         ZADEC                           052254
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    TCFC
     C*
     C                     MOVELSACIN     ACIN
      *
     C*    .. Days Adjustment
     C                     MOVE *BLANKS   ZFLD17
     C                     MOVELSDADJ     ZFLD17
     C                     Z-ADD3         ZSDIG
     C                     Z-ADD0         ZSDEC
     C                     EXSR ZASIGN
     C                     MOVE ZOUT15    DADJ
     C           ZFSIGN    IFEQ '-'
     C                     Z-SUBDADJ      DADJ
     C                     END
      *
     C*    .. Days Adjustment Indicator
     C                     MOVELSADIN     ADIN
      *
     C*    .. Interest
     C***********          MOVE *BLANKS   ZFIELD                          E20085
     C***********          MOVELSITRA     ZFIELD                          E20085
     C***********13        SUB  NOMDP     ZADIG                           E20085
     C***********          Z-ADDNOMDP     ZADEC                           E20085
     C***********          EXSR ZALIGN                                    E20085
     C***********          MOVE ZFIELD    ITRA                            E20085
     C                     MOVE *BLANKS   ZFLD17                          E20085
     C                     MOVELSITRA     ZFLD17                          E20085
     C           13        SUB  NOMDP     ZSDIG                           E20085
     C                     Z-ADDNOMDP     ZSDEC                           E20085
     C                     EXSR ZASIGN                                    E20085
     C                     MOVE ZOUT15    ITRA                            E20085
     C           ZFSIGN    IFEQ '-'                                       E20021
     C                     Z-SUBITRA      ITRA                            E20021
     C                     END                                            E20021
      *                                                                   E20021
     C*    .. Interest Adjustment
     C*       .. if days adjustment used
     C           DADJ      IFNE *ZEROS
     C***********          Z-ADDWPADJ     TINA                            E20085
     C                     Z-ADDZTINA     TINA                            E20085
     C                     ELSE
     C*       .. if changed from interest calculated (no adjustment)
     C*
     C           ITRA      SUB  ORGIT     TINA
     C                     END
     C*    .. Coupon Rate
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSCPNR     ZFIELD
     C                     Z-ADD4         ZADIG
     C                     Z-ADD7         ZADEC
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    TDCR
     C*    .. Price
     C           STBS      IFEQ 'Y'
     C           STBS      OREQ 'D'
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSPRIC     ZFIELD
     C                     Z-ADD7         ZADIG
     C                     Z-ADD8         ZADEC
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    PRIC
     C                     ELSE
     C                     Z-ADDTPDY      PRIC
     C                     END
     C*
     C                     MOVELSEXDV     EXDV
     C*    .. Reallowance
     C                     MOVE *BLANKS   ZFLD17
     C                     MOVELSRALL     ZFLD17
     C                     Z-ADD4         ZSDIG
     C                     Z-ADD5         ZSDEC
     C                     EXSR ZASIGN
     C                     MOVE ZOUT15    RALL
     C           ZFSIGN    IFEQ '-'
     C                     Z-SUBRALL      RALL
     C                     END
     C                     Z-ADDRALL      WDRALL
     C*
     C*    . if Discount
     C*
     C           STBS      IFEQ 'D'
     C           RALL      ANDNE0
     C                     Z-ADDTDVD      ZSDATE
     C                     Z-ADDMATY      ZEDATE
     C                     EXSR ZDAYS
     C                     Z-ADDZDDAYS    #DDAYS  50
     C                     EXSR ZDYYR
      *
     C           ZINTDD    IFNE 0
     C           RALL      MULT #DDAYS    WPRICE
     C           WPRICE    DIV  ZINTDD    WCRALL    H
     C*
     C           WCRALL    IFGE 0
     C           1         SUB  WCRALL    WDRALL 158
     C                     ELSE
     C                     Z-SUBWCRALL    WCRALL 158
     C           1         SUB  WCRALL    WDRALL
     C                     Z-SUBWDRALL    WDRALL
     C                     END
     C*
     C                     ELSE
     C                     Z-ADD*ZEROS    WDRALL
     C                     END
     C                     END
     C*
     C                     Z-ADD1         TDER
     C***********          Z-ADDSPOT      TBCR                            S01117
     C                     Z-ADDA6SPRT    TBCR                            S01117
     C*
     C                     MOVE 'M'       TMDI
     C                     Z-ADD*ZERO     SMTH
     C                     MOVE *BLANKS   PYFM
     C***********          MOVE *BLANKS   PYFB                            S01117
     C                     MOVE *BLANKS   PYFA                            S01117
     C                     MOVE *BLANKS   PAYT
     C***********          MOVE *BLANKS   PYTB                            S01117
     C                     MOVE *BLANKS   PYTA                            S01117
     C                     MOVE *BLANKS   TDFA
     C                     MOVE *BLANKS   ASNM
     C                     MOVE *BLANK    CLTY
     C***********          MOVE *BLANKS   DELT                            E14574
     C                     MOVELSDEPT     DELT                            E14574
     C                     MOVE *BLANKS   DTFA
     C***********          MOVE *BLANK    CLRH                            S01175
     C***********          MOVE *BLANKS   DELF                            E14574
     C                     MOVELSDEPT     DELF                            E14574
     C                     MOVE *BLANKS   TDSI
     C                     MOVE *BLANK    PRYC
     C**********           MOVE *BLANK    PCOD                            BUG2582
     C                     MOVE '0'       PCOD                            BUG2582
     C                     MOVELSTBCC     TBCC
     C                     MOVELSTCCC     TCCC
     C                     MOVELSTCC1     TCC1
     C                     MOVELSTCC2     TCC2
     C                     MOVELSTCC3     TCC3
     C***********          MOVELSTOCC     TOCC                            S01176
     C                     MOVELSTCC4     TCC4                            S01176
     C**********           MOVELSTLTC     TLTC                            S01176
     C                     MOVELSTCC5     TCC5                            S01176
     C*
     C*    .. if complete
     C           SINCS     IFEQ 'C'
     C                     Z-ADDRUND      TDMC
     C                     ELSE
     C                     Z-ADD*ZEROS    TDMC
     C                     END
     C                     Z-ADD*ZEROS    TDFS
     C                     Z-ADDRUND      TOED
     C*
     C***********          Z-ADDFNATN     TNLU                            E16083
     C                     Z-ADDNATN      TNLU                            E16083
     C                     BITOF'01234567'TACI
     C                     BITOF'01234567'TMSI
     C                     MOVE 'Y'       TCFR
     C                     Z-ADDNOML      TOSN
     C                     Z-ADD*ZEROS    TNSN
     C                     Z-ADD*ZEROS    TNSP
     C                     Z-ADD*ZEROS    TOSV
     C                     Z-ADD*ZEROS    TVSN
     C                     Z-ADD*ZEROS    TVSP
     C                     Z-ADD*ZEROS    TDSN
     C                     Z-ADD*ZEROS    TDSP
     C                     Z-ADD*ZEROS    TSSQ
      *
     C*    .. Broker Commission
     C                     MOVE *BLANKS   ZFLD17
     C                     MOVELSTBCA     ZFLD17
     C           13        SUB  NOMDP     ZSDIG
     C                     Z-ADDNOMDP     ZSDEC
     C                     EXSR ZASIGN
     C                     MOVE ZOUT15    TBCA
     C***********ZFSIGN    IFEQ '-'                                       S01176
     C***********TDTP      ANDEQ'TS'                                E14299S01176
     C***********ZFSIGN    ORNE '-'                                 E14299S01176
     C***********TDTP      ANDEQ'TP'                                E14299S01176
     C***********          Z-SUBTBCA      TBCA                            S01176
     C***********          END                                            S01176
      ***********                                                         S01176
      ****Change*sign*of*amount*field*if**it's*a*BUY*entry******** S01176 E20670
      ***********                                                  S01176 E20670
     C***********TDTP      IFEQ 'TP'                               S01176 E20670
      ***********                                                  S01176 E20670
     C***********ZFSIGN    IFEQ '-'                                S01176 E20670
     C***********          Z-ADDTBCA      TBCA                     S01176 E20670
     C***********          ELSE                                    S01176 E20670
     C***********          Z-SUBTBCA      TBCA                     S01176 E20670
     C***********          END                                     S01176 E20670
      ***********                                                  S01176 E20670
     C***********          ELSE                                    S01176 E20670
      ***********                                                  S01176 E20670
     C***********TDTP      IFEQ 'TS'                               S01176 E20670
      ***********                                                  S01176 E20670
     C***********ZFSIGN    IFEQ '-'                                S01176 E20670
     C***********          Z-SUBTBCA      TBCA                     S01176 E20670
     C***********          END                                     S01176 E20670
      ***********                                                  S01176 E20670
     C***********          END                                     S01176 E20670
     C***********          END                                     S01176 E20670
      *                                                                   S01176
     C*    .. Customer Commission
     C                     MOVE *BLANKS   ZFLD17
     C                     MOVELSTCCA     ZFLD17
     C           13        SUB  NOMDP     ZSDIG
     C                     Z-ADDNOMDP     ZSDEC
     C                     EXSR ZASIGN
     C                     MOVE ZOUT15    TCCA
     C***********ZFSIGN    IFEQ '-'                                       S01176
     C***********TDTP      ANDEQ'TS'                                E14299S01176
     C***********ZFSIGN    ORNE '-'                                 E14299S01176
     C***********TDTP      ANDEQ'TP'                                E14299S01176
     C***********          Z-SUBTCCA      TCCA                            S01176
     C***********          END                                            S01176
      ***********                                                         S01176
      ****Change*sign*of*amount*field*if**it's*a*BUY*entry******** S01176 E20670
      ***********                                                  S01176 E20670
     C***********TDTP      IFEQ 'TP'                               S01176 E20670
      ***********                                                  S01176 E20670
     C***********ZFSIGN    IFEQ '-'                                S01176 E20670
     C***********          Z-ADDTCCA      TCCA                     S01176 E20670
     C***********          ELSE                                    S01176 E20670
     C***********         Z-SUBTCCA      TCCA                      S01176 E20670
     C***********          END                                     S01176 E20670
      *                                                            S01176 E20670
     C***********          ELSE                                    S01176 E20670
      ***********                                                  S01176 E20670
     C***********TDTP      IFEQ 'TS'                               S01176 E20670
      ***********                                                  S01176 E20670
     C***********ZFSIGN    IFEQ '-'                                S01176 E20670
     C***********          Z-SUBTCCA      TCCA                     S01176 E20670
     C***********          END                                     S01176 E20670
      ***********                                                  S01176 E20670
     C***********          END                                     S01176 E20670
     C***********          END                                     S01176 E20670
      *                                                                   S01176
     C*    .. Other Charges 1
     C                     MOVE *BLANKS   ZFLD17
     C                     MOVELSTCA1     ZFLD17
     C           13        SUB  NOMDP     ZSDIG
     C                     Z-ADDNOMDP     ZSDEC
     C                     EXSR ZASIGN
     C                     MOVE ZOUT15    TCA1
     C***********ZFSIGN    IFEQ '-'                                       S01176
     C***********TDTP      ANDEQ'TS'                                E14299S01176
     C***********ZFSIGN    ORNE '-'                                 E14299S01176
     C***********TDTP      ANDEQ'TP'                                E14299S01176
     C***********          Z-SUBTCA1      TCA1                            S01176
     C***********          END                                            S01176
      ***********                                                         S01176
      ****Change*sign*of*amount*field*if**it's*a*BUY*entry******** S01176 E20670
      ***********                                                  S01176 E20670
     C***********TDTP      IFEQ 'TP'                               S01176 E20670
      ***********                                                  S01176 E20670
     C***********ZFSIGN    IFEQ '-'                                S01176 E20670
     C***********          Z-ADDTCA1      TCA1                     S01176 E20670
     C***********          ELSE                                    S01176 E20670
     C***********          Z-SUBTCA1      TCA1                     S01176 E20670
     C***********          END                                     S01176 E20670
      ***********                                                  S01176 E20670
     C***********          ELSE                                    S01176 E20670
      ***********                                                  S01176 E20670
     C***********TDTP      IFEQ 'TS'                               S01176 E20670
      ***********                                                  S01176 E20670
     C***********ZFSIGN    IFEQ '-'                                S01176 E20670
     C***********          Z-SUBTCA1      TCA1                     S01176 E20670
     C***********          END                                     S01176 E20670
      ***********                                                  S01176 E20670
     C***********          END                                     S01176 E20670
     C***********          END                                     S01176 E20670
      *                                                                   S01176
     C*    ..  Other Charges 2
     C                     MOVE *BLANKS   ZFLD17
     C                     MOVELSTCA2     ZFLD17
     C           13        SUB  NOMDP     ZSDIG
     C                     Z-ADDNOMDP     ZSDEC
     C                     EXSR ZASIGN
     C                     MOVE ZOUT15    TCA2
     C***********ZFSIGN    IFEQ '-'                                       S01176
     C***********TDTP      ANDEQ'TS'                                E14299S01176
     C***********ZFSIGN    ORNE '-'                                 E14299S01176
     C***********TDTP      ANDEQ'TP'                                E14299S01176
     C***********          Z-SUBTCA2      TCA2                            S01176
     C***********          END                                            S01176
      ***********                                                         S01176
      ****Change*sign*of*amount*field*if**it's*a*BUY*entry******** S01176 E20670
      ***********                                                  S01176 E20670
     C***********TDTP      IFEQ 'TP'                               S01176 E20670
      ***********                                                  S01176 E20670
     C***********ZFSIGN    IFEQ '-'                                S01176 E20670
     C***********          Z-ADDTCA2      TCA2                     S01176 E20670
     C***********          ELSE                                    S01176 E20670
     C***********          Z-SUBTCA2      TCA2                     S01176 E20670
     C***********          END                                     S01176 E20670
      ***********                                                  S01176 E20670
     C***********          ELSE                                    S01176 E20670
      ***********                                                  S01176 E20670
     C***********TDTP      IFEQ 'TS'                               S01176 E20670
      ***********                                                  S01176 E20670
     C***********ZFSIGN    IFEQ '-'                                S01176 E20670
     C***********          Z-SUBTCA2      TCA2                     S01176 E20670
     C***********          END                                     S01176 E20670
      ***********                                                  S01176 E20670
     C***********          END                                     S01176 E20670
     C***********          END                                     S01176 E20670
      *                                                                   S01176
     C**  ..  Other Charges 3
     C                     MOVE *BLANKS   ZFLD17
     C                     MOVELSTCA3     ZFLD17
     C           13        SUB  NOMDP     ZSDIG
     C                     Z-ADDNOMDP     ZSDEC
     C                     EXSR ZASIGN
     C                     MOVE ZOUT15    TCA3
     C***********ZFSIGN    IFEQ '-'                                       S01176
     C***********TDTP      ANDEQ'TS'                                E14299S01176
     C***********ZFSIGN    ORNE '-'                                 E14299S01176
     C***********TDTP      ANDEQ'TP'                                E14299S01176
     C***********          Z-SUBTCA3      TCA3                            S01176
     C***********          END                                            S01176
      ***********                                                         S01176
      ****Change*sign*of*amount*field*if**it's*a*BUY*entry******** S01176 E20670
      ***********                                                  S01176 E20670
     C***********TDTP      IFEQ 'TP'                               S01176 E20670
      ***********                                                  S01176 E20670
     C***********ZFSIGN    IFEQ '-'                                S01176 E20670
     C***********          Z-ADDTCA3      TCA3                     S01176 E20670
     C***********          ELSE                                    S01176 E20670
     C***********          Z-SUBTCA3      TCA3                     S01176 E20670
     C***********          END                                     S01176 E20670
      ***********                                                  S01176 E20670
     C***********          ELSE                                    S01176 E20670
      ***********                                                  S01176 E20670
     C***********TDTP      IFEQ 'TS'                               S01176 E20670
      ***********                                                  S01176 E20670
     C***********ZFSIGN    IFEQ '-'                                S01176 E20670
     C***********          Z-SUBTCA3      TCA3                     S01176 E20670
     C***********          END                                     S01176 E20670
      ***********                                                  S01176 E20670
     C***********          END                                     S01176 E20670
     C***********          END                                     S01176 E20670
      *                                                                   S01176
     C*****..*Other Charges********************************************   S01176
     C*    .. Charge Amount 4                                             S01176
     C                     MOVE *BLANKS   ZFLD17
     C***********          MOVELSTOCA     ZFLD17                          S01176
     C                     MOVELSTCA4     ZFLD17                          S01176
     C           13        SUB  NOMDP     ZSDIG
     C                     Z-ADDNOMDP     ZSDEC
     C                     EXSR ZASIGN
     C***********          MOVE ZOUT15    TOCA                            S01176
     C                     MOVE ZOUT15    TCA4                            S01176
     C***********ZFSIGN    IFEQ '-'                                       S01176
     C***********          Z-SUBTOCA      TOCA                            S01176
     C***********          Z-SUBTCA4      TCA4                            S01176
     C***********          END                                            S01176
      ***********                                                         S01176
      ****Change*sign*of*amount*field*if**it's*a*BUY*entry******** S01176 E20670
      ***********                                                  S01176 E20670
     C***********TDTP      IFEQ 'TP'                               S01176 E20670
      ***********                                                  S01176 E20670
     C***********ZFSIGN    IFEQ '-'                                S01176 E20670
     C***********          Z-ADDTCA4      TCA4                     S01176 E20670
     C***********          ELSE                                    S01176 E20670
     C***********          Z-SUBTCA4      TCA4                     S01176 E20670
     C***********          END                                     S01176 E20670
      ***********                                                  S01176 E20670
     C***********          ELSE                                    S01176 E20670
      ***********                                                  S01176 E20670
     C***********TDTP      IFEQ 'TS'                               S01176 E20670
      ***********                                                  S01176 E20670
     C***********ZFSIGN    IFEQ '-'                                S01176 E20670
     C***********          Z-SUBTCA4      TCA4                     S01176 E20670
     C***********          END                                     S01176 E20670
      ***********                                                  S01176 E20670
     C***********          END                                     S01176 E20670
     C***********          END                                     S01176 E20670
      *                                                                   S01176
     C*****..*Local Tax***********************************************    S01176
     C*    .. Charges 5                                                   S01176
     C                     MOVE *BLANKS   ZFLD17
     C***********          MOVELSTLTA     ZFLD17                          S01176
     C                     MOVELSTCA5     ZFLD17                          S01176
     C           13        SUB  NOMDP     ZSDIG
     C                     Z-ADDNOMDP     ZSDEC
     C                     EXSR ZASIGN
     C***********          MOVE ZOUT15    TLTA                            S01176
     C                     MOVE ZOUT15    TCA5                            S01176
     C***********ZFSIGN    IFEQ '-'                                       S01176
     C***********          Z-SUBTLTA      TLTA                            S01176
     C***********          Z-SUBTCA5      TCA5                            S01176
     C***********          END                                            S01176
      ***********                                                         S01176
      ****Change*sign*of*amount*field*if**it's*a*BUY*entry******** S01176 E20670
      ***********                                                  S01176 E20670
     C***********TDTP      IFEQ 'TP'                               S01176 E20670
      ***********                                                  S01176 E20670
     C***********ZFSIGN    IFEQ '-'                                S01176 E20670
     C***********          Z-ADDTCA5      TCA5                     S01176 E20670
     C***********          ELSE                                    S01176 E20670
     C***********          Z-SUBTCA5      TCA5                     S01176 E20670
     C***********          END                                     S01176 E20670
      ***********                                                  S01176 E20670
     C***********          ELSE                                    S01176 E20670
      ***********                                                  S01176 E20670
     C***********TDTP      IFEQ 'TS'                               S01176 E20670
      ***********                                                  S01176 E20670
     C***********ZFSIGN    IFEQ '-'                                S01176 E20670
     C***********          Z-SUBTCA5      TCA5                     S01176 E20670
     C***********          END                                     S01176 E20670
      ***********                                                  S01176 E20670
     C***********          END                                     S01176 E20670
     C***********          END                                     S01176 E20670
      *                                                                   S01176
      **   Updates of Charge Codes Amounts and Rebates are only
      **   carried out if Auto-charges is present.
      *     ELSE
      *    Move zero or blanks into the appropriate fields.
      *
     C***********AUMO      IFEQ 'Y'                                       S01117
     C           BVACOP    IFEQ 'Y'                                       S01117
      *
     C                     MOVELSTCC6     TCC6                            S01176
     C                     MOVELSTCC7     TCC7                            S01176
     C*    .. Charges 6                                                   S01176
     C                     MOVE *BLANKS   ZFLD17                          S01176
     C                     MOVELSTCA6     ZFLD17                          S01176
     C           13        SUB  NOMDP     ZSDIG                           S01176
     C                     Z-ADDNOMDP     ZSDEC                           S01176
     C                     EXSR ZASIGN                                    S01176
     C                     MOVE ZOUT15    TCA6                            S01176
      ***********                                                         S01176
      ****Change*sign*of*amount*field*if**it's*a*BUY*entry******** S01176 E20670
      ***********                                                  S01176 E20670
     C***********TDTP      IFEQ 'TP'                               S01176 E20670
      ***********                                                  S01176 E20670
     C***********ZFSIGN    IFEQ '-'                                S01176 E20670
     C***********          Z-ADDTCA6      TCA6                     S01176 E20670
     C***********          ELSE                                    S01176 E20670
     C***********          Z-SUBTCA6      TCA6                     S01176 E20670
     C***********          END                                     S01176 E20670
      ***********                                                  S01176 E20670
     C***********          ELSE                                    S01176 E20670
      ***********                                                  S01176 E20670
     C***********TDTP      IFEQ 'TS'                               S01176 E20670
      ***********                                                  S01176 E20670
     C***********ZFSIGN    IFEQ '-'                                S01176 E20670
     C***********          Z-SUBTCA6      TCA6                     S01176 E20670
     C***********          END                                     S01176 E20670
      ***********                                                  S01176 E20670
     C***********          END                                     S01176 E20670
     C***********          END                                     S01176 E20670
      *                                                                   S01176
     C*    .. Charges 7                                                   S01176
     C                     MOVE *BLANKS   ZFLD17                          S01176
     C                     MOVELSTCA7     ZFLD17                          S01176
     C           13        SUB  NOMDP     ZSDIG                           S01176
     C                     Z-ADDNOMDP     ZSDEC                           S01176
     C                     EXSR ZASIGN                                    S01176
     C                     MOVE ZOUT15    TCA7                            S01176
      ***********                                                         S01176
      ****Change*sign*of*amount*field*if**it's*a*BUY*entry******** S01176 E20670
      ***********                                                  S01176 E20670
     C***********TDTP      IFEQ 'TP'                               S01176 E20670
      ***********                                                  S01176 E20670
     C***********ZFSIGN    IFEQ '-'                                S01176 E20670
     C***********          Z-ADDTCA7      TCA7                     S01176 E20670
     C***********          ELSE                                    S01176 E20670
     C***********          Z-SUBTCA7      TCA7                     S01176 E20670
     C***********          END                                     S01176 E20670
      ***********                                                  S01176 E20670
     C***********          ELSE                                    S01176 E20670
      ***********                                                  S01176 E20670
     C***********TDTP      IFEQ 'TS'                               S01176 E20670
      ***********                                                  S01176 E20670
     C***********ZFSIGN    IFEQ '-'                                S01176 E20670
     C***********          Z-SUBTCA7      TCA7                     S01176 E20670
     C***********          END                                     S01176 E20670
      ***********                                                  S01176 E20670
     C***********          END                                     S01176 E20670
     C***********          END                                     S01176 E20670
      *                                                                   S01176
     C*    .. Tax Amount                                                  S01176
     C                     MOVE *BLANKS   ZFLD17                          S01176
     C                     MOVELSTAXA     ZFLD17                          S01176
     C           13        SUB  NOMDP     ZSDIG                           S01176
     C                     Z-ADDNOMDP     ZSDEC                           S01176
     C                     EXSR ZASIGN                                    S01176
     C                     MOVE ZOUT15    TAXA                            S01176
      ***********                                                         S01176
      ****Change*sign*of*amount*field*if**it's*a*BUY*entry******** S01176 E20670
      ***********                                                  S01176 E20670
     C***********TDTP      IFEQ 'TP'                               S01176 E20670
      ***********                                                  S01176 E20670
     C***********ZFSIGN    IFEQ '-'                                S01176 E20670
     C***********          Z-ADDTAXA      TAXA                     S01176 E20670
     C***********          ELSE                                    S01176 E20670
     C***********          Z-SUBTAXA      TAXA                     S01176 E20670
     C***********          END                                     S01176 E20670
      ***********                                                  S01176 E20670
     C***********          ELSE                                    S01176 E20670
      ***********                                                  S01176 E20670
     C***********TDTP      IFEQ 'TS'                               S01176 E20670
      ***********                                                  S01176 E20670
     C***********ZFSIGN    IFEQ '-'                                S01176 E20670
     C***********          Z-SUBTAXA      TAXA                     S01176 E20670
     C***********          END                                     S01176 E20670
      ***********                                                  S01176 E20670
     C***********          END                                     S01176 E20670
     C***********          END                                     S01176 E20670
      *                                                                   S01176
     C*    .. Broker Commission Rebate                                    S01176
      *                                                                   S01176
     C                     MOVE *BLANKS   ZFLD17                          S01176
     C                     MOVELSBCMR     ZFLD17                          S01176
     C           13        SUB  NOMDP     ZSDIG                           S01176
     C                     Z-ADDNOMDP     ZSDEC                           S01176
     C                     EXSR ZASIGN                                    S01176
     C                     MOVE ZOUT15    BCMR                            S01176
      *                                                                   S01176
      ****Change*sign*of*amount*field*if**it's*a*BUY*entry******** S01176 E20670
      ***********                                                  S01176 E20670
     C***********TDTP      IFEQ 'TP'                               S01176 E20670
      ***********                                                  S01176 E20670
     C***********ZFSIGN    IFEQ '-'                                S01176 E20670
     C***********          Z-ADDBCMR      BCMR                     S01176 E20670
     C***********          ELSE                                    S01176 E20670
     C***********          Z-SUBBCMR      BCMR                     S01176 E20670
     C***********          END                                     S01176 E20670
      ***********                                                  S01176 E20670
     C***********          ELSE                                    S01176 E20670
      ***********                                                  S01176 E20670
     C***********TDTP      IFEQ 'TS'                               S01176 E20670
      ***********                                                  S01176 E20670
     C***********ZFSIGN    IFEQ '-'                                S01176 E20670
     C***********          Z-SUBBCMR      BCMR                     S01176 E20670
     C***********          END                                     S01176 E20670
      ***********                                                  S01176 E20670
     C***********          END                                     S01176 E20670
     C***********          END                                     S01176 E20670
      *                                                                   S01176
     C*    .. Customer Commission Rebate                                  S01176
      *                                                                   S01176
     C                     MOVE *BLANKS   ZFLD17                          S01176
     C                     MOVELSCCMR     ZFLD17                          S01176
     C           13        SUB  NOMDP     ZSDIG                           S01176
     C                     Z-ADDNOMDP     ZSDEC                           S01176
     C                     EXSR ZASIGN                                    S01176
     C                     MOVE ZOUT15    CCMR                            S01176
      *                                                                   S01176
      ****Change*sign*of*amount*field*if**it's*a*BUY*entry******** S01176 E20670
      ***********                                                  S01176 E20670
     C***********TDTP      IFEQ 'TP'                               S01176 E20670
      ***********                                                  S01176 E20670
     C***********ZFSIGN    IFEQ '-'                                S01176 E20670
     C***********          Z-ADDCCMR      CCMR                     S01176 E20670
     C***********          ELSE                                    S01176 E20670
     C***********          Z-SUBCCMR      CCMR                     S01176 E20670
     C***********          END                                     S01176 E20670
      ***********                                                  S01176 E20670
     C***********          ELSE                                    S01176 E20670
      ***********                                                  S01176 E20670
     C***********TDTP      IFEQ 'TS'                               S01176 E20670
      ***********                                                  S01176 E20670
     C***********ZFSIGN    IFEQ '-'                                S01176 E20670
     C***********          Z-SUBCCMR      CCMR                     S01176 E20670
     C***********          END                                     S01176 E20670
      ***********                                                  S01176 E20670
     C***********          END                                     S01176 E20670
     C***********          END                                     S01176 E20670
      *                                                                   S01176
     C*    .. Tax Commission Rebate                                       S01176
      *                                                                   S01176
     C                     MOVE *BLANKS   ZFLD17                          S01176
     C                     MOVELSTXRB     ZFLD17                          S01176
     C           13        SUB  NOMDP     ZSDIG                           S01176
     C                     Z-ADDNOMDP     ZSDEC                           S01176
     C                     EXSR ZASIGN                                    S01176
     C                     MOVE ZOUT15    TXRB                            S01176
      *                                                                   S01176
      ****Change*sign*of*amount*field*if**it's*a*BUY*entry******** S01176 E20670
      ***********                                                  S01176 E20670
     C***********TDTP      IFEQ 'TP'                               S01176 E20670
      ***********                                                  S01176 E20670
     C***********ZFSIGN    IFEQ '-'                                S01176 E20670
     C***********          Z-ADDTXRB      TXRB                     S01176 E20670
     C***********          ELSE                                    S01176 E20670
     C***********          Z-SUBTXRB      TXRB                     S01176 E20670
     C***********          END                                     S01176 E20670
      ***********                                                  S01176 E20670
     C***********          ELSE                                    S01176 E20670
      ***********                                                  S01176 E20670
     C***********TDTP      IFEQ 'TS'                               S01176 E20670
      ***********                                                  S01176 E20670
     C***********ZFSIGN    IFEQ '-'                                S01176 E20670
     C***********          Z-SUBTXRB      TXRB                     S01176 E20670
     C***********          END                                     S01176 E20670
      ***********                                                  S01176 E20670
     C***********          END                                     S01176 E20670
     C***********          END                                     S01176 E20670
      *                                                                   S01176
     C                     ELSE                                           S01176
      *                                                                   S01176
     C                     MOVEL*BLANK    TCC6                            S01176
     C                     MOVEL*ZEROS    TCA6                            S01176
     C                     MOVEL*BLANK    TCC7                            S01176
     C                     MOVEL*ZEROS    TCA7                            S01176
     C                     MOVEL*ZEROS    TAXA                            S01176
     C                     MOVEL*ZEROS    BCMR                            S01176
     C                     MOVEL*ZEROS    CCMR                            S01176
     C                     MOVEL*ZEROS    TXRB                            S01176
      *                                                                   S01176
      **   End of Auto-charge updates                                     S01176
      *                                                                   S01176
     C                     END                                            S01176
      *                                                                                       CAS006
      ** If CAS006 is on, update ITRN, TINN and PRICN.                                        CAS006
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
      *                                                                                       CAS006
      *  ITRA Using Net-Treasury-Rate (ITRN)                                                  CAS006
      *                                                                                       CAS006
     C                     MOVE *BLANKS   ZFLD17                                              CAS006
     C                     MOVELSITRN     ZFLD17                                              CAS006
     C           13        SUB  NOMDP     ZSDIG                                               CAS006
     C                     Z-ADDNOMDP     ZSDEC                                               CAS006
     C                     EXSR ZASIGN                                                        CAS006
     C                     MOVE ZOUT15    ITRN                                                CAS006
     C           ZFSIGN    IFEQ '-'                                                           CAS006
     C                     Z-SUBITRN      ITRN                                                CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
      *  TINA Using Net-Treasury-Rate (TINN):                                                 CAS006
      ** TINN if days adjustment used. Else, changed                                          CAS006
      ** from interest calculated.                                                            CAS006
      *                                                                                       CAS006
     C           DADJ      IFNE *ZEROS                                                        CAS006
     C                     Z-ADDWTINN     TINN                                                CAS006
     C                     ELSE                                                               CAS006
     C           ITRN      SUB  WITRN     TINN                                                CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
      ** Net Treasury Price (PRICN)                                                           CAS006
      *                                                                                       CAS006
     C                     MOVE *BLANKS   ZFIELD                                              CAS006
     C                     MOVELSPRICN    ZFIELD                                              CAS006
     C                     Z-ADD7         ZADIG                                               CAS006
     C                     Z-ADD8         ZADEC                                               CAS006
     C                     EXSR ZALIGN                                                        CAS006
     C                     MOVE ZFIELD    PRICN                                               CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C*    .. Countervalue
     C                     MOVE NMCY      NMCYX   3
     C                     MOVE NMCYA     NMCY
     C                     Z-ADDWDRALL    ZWRALL
     C***********          EXSR ZCTRV                                     E20232
      *                                                                   S01117
      ** Access currency file SDCURRPD for number of decimal places for   S01117
      ** currency.                                                        S01117
      *                                                                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR'  @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM NMCY      @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C                     Z-ADDNOMDP     ZCDP                            S01117
      *
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0090CCP1                                           S01408
     C*                                                                   S01408
     C                     EXSR ZCOTR                                     E20232
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0090CCP2                                           S01408
     C*                                                                   S01408
     C                     Z-ADDZCTRVL    TCTR
     C                     MOVE NMCYX     NMCY
     C*    .. Consideration
     C                     Z-ADDZCONS     TCSR
     C*
     C*   Selling Reference
     C*
     C           TDTP      IFEQ 'TS'
     C                     MOVE WSREF     TDRF
     C***********          Z-ADDSBICN     TCNR                            E21503
     C***********          Z-ADDBBICN     TCNR                      E21503S01117
     C                     MOVE BBICN     TCNR                            S01117
     C***********          MOVELSSBRC     TDBR                            S01117
     C                     MOVELSSBRC     TDBA                            S01117
     C                     MOVELSSBOK     TDBK
     C                     MOVELWBREF     LKRF
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVELWSPSBK    TDBK                            CAC005
     C                     ENDIF                                          CAC005
     C*
     C                     END
     C*
     C*   Buying Reference
     C*
     C           TDTP      IFEQ 'TP'
     C                     MOVE WBREF     TDRF
     C***********          Z-ADDBBICN     TCNR                            E21503
     C***********          Z-ADDSBICN     TCNR                      E21503S01117
     C                     MOVE SBICN     TCNR                            S01117
     C***********          MOVELSBBRC     TDBR                            S01117
     C                     MOVELSBBRC     TDBA                            S01117
     C                     MOVELSBBOK     TDBK
     C                     MOVELWSREF     LKRF
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVELWBPSBK    TDBK                            CAC005
     C                     ENDIF                                          CAC005
     C*
     C                     END
     C*
     C                     Z-ADDRUND      LCD
     C                     MOVE 'I'       CHTP
      *                                                                   S01176
      **   The following fields are set to Zero or Blank.                 S01176
      *                                                                   S01176
     C                     MOVE *BLANK    BLKR                            S01176
     C                     MOVE *BLANK    RTRF                            S01176
     C                     MOVE *BLANK    ATRD                            S01176
     C                     MOVE *BLANK    BCON                            S01176
     C                     Z-ADD*ZEROS    TIME                            S01176
      *                                                                   S01176
      **   Set Auto-Settle indicator to 'N'                               S01176
      *                                                                   S01176
     C                     MOVE 'N'       AUTS                            S01176
      *                                                                   S01271
      **   Set Pay/Receive indicator to 'N'                               S01271
      *                                                                   S01271
     C                     MOVE 'N'       PRPC                            S01271
      *                                                                   S01271
      **   Originating branch                                             E34935
      *                                                                   E34935
     C           SORBR     IFNE *BLANKS                                   E34935
     C                     MOVE SORBR     ORBR                            E34935
     C                     ELSE                                           E34935
     C                     MOVE DFTBRC    ORBR                            E34935
     C                     END                                            E34935
      *                                                                   E34935
     C/COPY WNCPYSRC,SE0090C033
     C** If Trade Authorisation = '00' or user's entering threshold is    S01269
     C** greater than the countervalue on the trade then RECI = D.        S01269
     C** Else RECI = L                                                    S01269
     C*                                                                   S01269
     C** Convert countervalue to base currency                            S01269
     C                     EXSR SUB801                                    S01269
     C*                                                                   S01269
     C***********AUTT      IFEQ '00'                                S01269S01117
     C           BVAUTH    IFEQ '00'                                      S01117
     C           ENTL      ORGE CTCTR                                     S01269
     C                     MOVEL'D'       RECI                            S01269
     C                     ELSE                                           S01269
     C                     MOVEL'L'       RECI                            S01269
     C                     END                                            S01269
     C*                                                                   CPM004
     C** If Bank Portfolio is supported, update portfolio reference       CPM004
     C** and corresponding Exchange Rate and Mult/Div Indicator.          CPM004
     C*                                                                   CPM004
     C           *IN09     IFEQ *ON                                       CPM004
     C                     EXSR SRPTFR                                    CPM004
     C                     MOVELWPTFR     PTFR                            CPM004
     C                     Z-ADDWSPXR     SPXR                            CPM004
     C                     MOVELWSPMD     SPMD                            CPM004
     C                     ENDIF                                          CPM004
     C*                                                                   186769
     C** Initialise Treaty Withholding Tax Fields                         186769
     C*                                                                   186769
     C                     Z-ADD0         WHTX                            186769
     C                     MOVE *BLANK    BWDI                            186769
     C*
     C/COPY WNCPYSRC,SE0090C026
     C           *IN44     IFEQ '1'
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0090CP25                                           S01408
     C*                                                                   S01408
     C                     MOVEASTAMP,1   TMST             Default Timestamp                  CPK015
      ** Do not use default timestamp, call program to generate                             BUG12410
     C                     CALL 'ZAGENTS'                                                   BUG12410
     C                     PARM           NEWTIM 26                                         BUG12410
     C                     MOVELNEWTIM    TMST                                              BUG12410
     C*                                                                                     BUG12410
     C                     WRITETRADSDF
     C/COPY WNCPYSRC,SE0090C001
     C                     EXSR MT500                                     081892
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0090CP26                                           S01408
     C*                                                                   S01408
     C                     ELSE
     C                     UPDATTRADSDF
     C                     END
     C*
     C*  Update Trade audit details
     C*
     C           1         CHAINTRADSAF              45
     C                     ADD  1         SINS
     C                     ADD  1         NORE
     C           *IN45     IFEQ '0'
     C                     UPDATTRADSAF
     C                     ELSE
     C                     MOVE '12'      DBASE             ************
     C                     MOVEL'TRADS'   DBFILE            * DATABASE *
     C                     MOVEL'AUDIT'   DBKEY             * ERROR 12 *
     C***********          SETON                     U7U8   ************  E24398
     C                     SETON                     U7U801               E24398
     C                     END
     C/COPY WNCPYSRC,SE0090C034
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT                                                              E14574
      *****************************************************************   E14574
      *                                                               *   E14574
      *  WUDEPP - Subroutine to Write User Depot Positions.           *   E14574
      *                                                               *   E14574
      *****************************************************************   E14574
      *                                                                   E14574
     C           WUDEPP    BEGSR                           *** WUDEPP *** E14574
      *                                                                   E14574
     C                     MOVE 'D'       RECI                            E14574
     C                     MOVE SSESN     UDSN                            E14574
     C                     MOVE STDMI     UDMK                            E14574
     C***********          Z-ADDRUND      UDDT                      E14574E16083
      *
     C           TDVD      IFLE RUND                                      E16083
     C                     Z-ADDTDVD      UDDT                            E16083
     C                     ELSE                                           E16083
     C                     Z-ADDTDDT      UDDT                            E16083
     C                     END                                            E16083
      *
     C                     Z-ADD0         UECN                            E14574
     C                     Z-ADD0         UDNT                            E14574
     C                     Z-ADD0         UDNV                            E14574
     C                     Z-ADD0         UDNS                            E14574
     C                     Z-ADD0         UNRT                            E14574
     C                     Z-ADD0         UNRV                            E14574
     C                     Z-ADD0         USNT                            E14574
     C                     Z-ADD0         USNR                            E14574
     C                     Z-ADD0         USNV                            E14574
     C                     Z-ADD0         USRV                            E14574
     C***********          Z-ADD0         UNSI                      E14574E16083
      *                                                                   E14574
     C***********          Z-ADDFNATN     TNLU                      E14574E16083
     C                     Z-ADDNATN      TNLU                            E16083
     C                     WRITEUDEPPDF                                   E14574
      *                                                                   E14574
      ***  Update User Depot Audit Position                               E14574
      *                                                                   E14574
     C           1         CHAINUDEPPAF              45                   E14574
     C           *IN45     IFEQ '0'                                       E14574
     C                     ADD  1         NORE                            E14574
     C                     UPDATUDEPPAF                                   E14574
     C                     ELSE                                           E14574
     C                     MOVE '13'      DBASE            ************   E14574
     C                     MOVEL'UDEPP'   DBFILE           * DATABASE *   E14574
     C                     MOVEL'AUDIT'   DBKEY            * ERROR 13 *   E14574
     C***********          SETON                     U7U8  *********E14574E24398
     C                     SETON                     U7U801               E24398
     C                     END                                            E14574
      *                                                                   E14574
     C                     ENDSR                                          E14574
      *                                                                   E14574
      *****************************************************************   E14574
      /EJECT                                                              S01269
      *****************************************************************   S01269
     C*                                                               *   S01269
     C*          SUBW70 - Write to Trade Authorisation file PF/TRAUTD *   S01269
     C*                                                               *   S01269
     C*          CALLED BY DBUPDT                                     *   S01269
     C*                                                               *   S01269
     C*****************************************************************   S01269
     C           SUBW70    BEGSR                                          S01269
     C                     MOVE 'D'       RECI                            S01269
     C                     MOVE TDRF      TRDRF                           S01269
     C                     MOVE 'IN'      TATYP                           S01269
     C                     MOVE *BLANKS   TDRI                            S01269
     C                     MOVE USRID     TAUSR                           S01269
     C                     MOVE RUND      TADT                            S01269
     C                     TIME           TATM1   60                      S01269
     C                     MOVE TATM1     TATM                            S01269
     C                     WRITETRAUTDF                                   S01269
     C                     ENDSR                                          S01269
     C******************************************************************* S01269
      /SPACE 3                                                            S01269
     C******************************************************************* S01269
     C*          SUB801 - CONVERT COUNTERVALUE (NOM CURR) TO BASE CURR  * S01269
     C*                                                                 * S01269
     C*          CALLED BY DBUPDT                                       * S01269
     C*          INPUT FIELD : Countervalue (TCTR)                      * S01269
     C*          OUTPUT FIELD : Converted countervalue (CTCTR)          * S01269
     C*                                                                 * S01269
     C******************************************************************* S01269
      *                                                                   S01269
     C           SUB801    BEGSR                                          S01269
      *                                                                   S01269
      ** Convert Countervalue(in nominal curr) to base currency           S01269
      *                                                                   S01269
     C                     MOVE TCTR      ZAMTCI                          S01269
     C                     MOVE TBCR      ZEXCH                           S01269
      *                                                                   S01269
      *    Save Base rate for nominal ccy so that it is not               E34912
      *      overwritten by the base rate for base ccy.                   E34912
     C                     Z-ADDTBCR      WBSR                            E34912
      *                                                                   E34912
      ***Format*Key*for*chaining*on*to*PF/TABTG10*on*Nominal*CurrencS01269S01117
     C***********          MOVEL'20      'TKEY   12                 S01269S01117
     C***********          MOVELTNMC      ZWK4    4                 S01269S01117
     C***********          MOVE 1         ZWK4                      S01269S01117
     C***********          MOVE ZWK4      TKEY                      S01269S01117
     C***********                                                   S01269S01117
     C***********TKEY      CHAINTABTG10F             84             S01269S01117
      *                                                                   S01117
      ** Access currency file SDCURRPD for mult/div indicator.            S01117
      *                                                                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR'  @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM TNMC      @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C*                                                                   S01269
     C***********MDIN      IFEQ 1                                         S01117
     C***********          MOVE 'D'       ZMD                             S01117
     C***********          ELSE                                           S01117
     C***********          MOVE 'M'       ZMD                             S01117
     C***********          END                                            S01117
     C                     MOVE A6MDIN    ZMD                             S01117
      *                                                                   S01117
      ** Access currency file SDCURRPD for decimal places of ccy          S01117
      ** being converted from.                                            S01117
      *                                                                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR'  @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM NMCYA     @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C                     MOVE A6NBDP    ZCDPI                           S01117
      *                                                                   S01117
      ** Access currency file SDCURRPD for decimal places of ccy          S01117
      ** being converted to.                                              S01117
      *                                                                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR'  @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM BJCYCD    @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C                     MOVE A6NBDP    ZCDPO                           S01117
      *                                                                   S01117
     C                     MOVE NMCYA     ZCCYI                           S01269
     C***********          MOVE BCCY      ZCCYO                     S01269S01117
     C                     MOVE BJCYCD    ZCCYO                           S01117
     C                     EXSR ZCONV                                     S01269
     C                     MOVE ZAMTCO    CTCTR  150                      S01269
     C*                                                                   S01269
     C*    Move saved base rate to base rate                              E34912
     C                     Z-ADDWBSR      A6SPRT                          E34912
     C*                                                                   E34912
     C                     ENDSR                                          S01269
     C*                                                                   S01269
     C********************************************************************S01269
      /EJECT                                                              CPM004
      *****************************************************************   CPM004
      *                                                               *   CPM004
      * SRPTFR - Subrotuine to determine exchange rate and            *   CPM004
      *          multiply/divide indicator for selling/buying         *   CPM004
      *          portfolio reference (done only when Bank Portfolio   *   CPM004
      *          is supported).                                       *   CPM004
      *                                                               *   CPM004
      * Called by: WTRADS - Update Trading details                    *   CPM004
      *                                                               *   CPM004
      * Calls: None                                                   *   CPM004
      *                                                               *   CPM004
      *****************************************************************   CPM004
      *                                                                   CPM004
     C           SRPTFR    BEGSR                           ** SRPTFR   ** CPM004
     C*                                                                   CPM004
     C** Portfolio Reference                                              CPM004
     C*                                                                   CPM004
     C           WPTFR     IFEQ FCR997                                    CPM004
     C           FCPORS    ANDNE'B'                                       104058
     C           FCPORS    OREQ 'B'                                       104058
     C           WPTFR     ANDNE*BLANKS                                   104058
     C           WPTFR     ANDEQFCR997                                    104058
     C                     MOVEL'9997'    WWPTFR  4                       CPM004
     C                     ELSE                                           CPM004
     C                     MOVELWPTFR     WWPTFR                          CPM004
     C                     ENDIF                                          CPM004
     C*                                                                   CPM004
     C** If settlement currency and Portfolio Currency are the same       CPM004
     C** set cross rate to 1 and Multiply/Divide Indicator to 'M'         CPM004
     C** and skip straight to amount validation.                          CPM004
     C*                                                                   CPM004
     C           SETC      IFEQ WPTCY                                     CPM004
     C                     MOVEL'M'       ZCRSMD                          CPM004
     C                     Z-ADD1         ZCRSRT                          CPM004
     C*                                                                   CPM004
     C                     ELSE                                           CPM004
     C*                                                                   CPM004
     C**  Obtain FX Rate for Trade date between settlement currency       CPM004
     C**  and base currency for accounting  except if trade date          CPM004
     C**  is equal to run date.                                           CPM004
     C           TDDT      IFNE RUND                                      CPM004
     C                     MOVE SETC      KHCCY                           CPM004
     C           KHSEXC    SETGTPMHSEXPD                                  CPM004
     C                     READPPMHSEXPD                 07               CPM004
     C           *IN07     IFEQ *ON                                       CPM004
     C           SETC      ORNE Q8CCY                                     CPM004
     C           KHSEXC    SETLLPMHSEXPD                                  CPM004
     C                     READ PMHSEXPD                 07               CPM004
     C                     END                                            CPM004
     C                     ELSE                                           CPM004
     C                     MOVE *ON       *IN07                           CPM004
     C                     END                                            CPM004
     C*                                                                   CPM004
     C           *IN07     IFEQ '1'                                       CPM004
     C           SETC      ORNE Q8CCY                                     CPM004
     C                     CALL 'AOCURRR0'                                CPM004
     C                     PARM '*DBERR ' @RTCD   7                       CPM004
     C                     PARM '*KEY   ' @OPTN   7                       CPM004
     C                     PARM SETC      @AJCD   3                       CPM004
     C           SDCURR    PARM SDCURR    DSSDY                           CPM004
     C           @RTCD     IFNE *BLANKS                                   CPM004
     C           RECI      ORNE 'D'                                       CPM004
     C           *LOCK     IN   LDA                                       CPM004
     C                     MOVE *ON       *IN01                           CPM004
     C                     MOVE *ON       *IN07                           CPM004
     C                     MOVE *ON       *INU8                           CPM004
     C                     Z-ADD20        DBASE             ************  CPM004
     C                     MOVE 'SDCURRPD'DBFILE            * DATABASE *  CPM004
     C                     MOVELSETC      DBKEY             * ERROR 20 *  CPM004
     C                     OUT  LDA                         ************  CPM004
     C                     EXSR *PSSR                                     CPM004
     C                     END                                            CPM004
     C                     Z-ADDA6SPRT    Q8SPOT                          CPM004
     C                     MOVE A6MDIN    Q8MDV1                          CPM004
     C                     Z-ADDA6NBDP    Q8CDP                           CPM004
     C                     END                                            CPM004
     C*                                                                   CPM004
     C**  Set up SR/ZCCYCN with 'FROM' details for settlement Currency    CPM004
     C                     Z-ADDQ8SPOT    ZRATEF                          CPM004
     C                     MOVE Q8MDV1    ZMDINF                          CPM004
     C                     Z-ADDQ8CDP     ZCDPF                           CPM004
     C                     MOVE SETC      ZCCYF                           CPM004
     C*                                                                   CPM004
     C**  Obtain FX Rate for Trade Date between Portfolio currency        CPM004
     C**  and base currency for accounting except if trade date           CPM004
     C**  is equal to run date.                                           CPM004
     C*                                                                   CPM004
     C           TDDT      IFNE RUND                                      CPM004
     C                     MOVE WPTCY     KHCCY                           CPM004
     C           KHSEXC    SETGTPMHSEXPD                                  CPM004
     C                     READPPMHSEXPD                 07               CPM004
     C*                                                                   CPM004
     C           *IN07     IFEQ '1'                                       CPM004
     C           WPTCY     ORNE Q8CCY                                     CPM004
     C           KHSEXC    SETLLPMHSEXPD                                  CPM004
     C                     READ PMHSEXPD                 07               CPM004
     C                     END                                            CPM004
     C                     ELSE                                           CPM004
     C                     MOVE *ON       *IN07                           CPM004
     C                     END                                            CPM004
     C*                                                                   CPM004
     C           *IN07     IFEQ '1'                                       CPM004
     C           WPTCY     ORNE Q8CCY                                     CPM004
     C*                                                                   CPM004
     C                     CALL 'AOCURRR0'                                CPM004
     C                     PARM '*DBERR ' @RTCD   7                       CPM004
     C                     PARM '*KEY   ' @OPTN   7                       CPM004
     C                     PARM WPTCY     @AJCD   3                       CPM004
     C           SDCURR    PARM SDCURR    DSSDY                           CPM004
     C*                                                                   CPM004
     C           @RTCD     IFNE *BLANKS                                   CPM004
     C           RECI      ORNE 'D'                                       CPM004
     C           *LOCK     IN   LDA                                       CPM004
     C                     MOVE *ON       *IN01                           CPM004
     C                     MOVE *ON       *IN07                           CPM004
     C                     MOVE *ON       *INU8                           CPM004
     C                     Z-ADD21        DBASE             ************  CPM004
     C                     MOVE 'SDCURRPD'DBFILE            * DATABASE *  CPM004
     C                     MOVELWPTCY     DBKEY             * ERROR 21 *  CPM004
     C                     OUT  LDA                         ************  CPM004
     C                     EXSR *PSSR                                     CPM004
     C                     END                                            CPM004
     C                     Z-ADDA6SPRT    Q8SPOT                          CPM004
     C                     MOVE A6MDIN    Q8MDV1                          CPM004
     C                     Z-ADDA6NBDP    Q8CDP                           CPM004
     C                     END                                            CPM004
     C*                                                                   CPM004
     C**  Set up SR/ZCCYCN with 'TO' details or portfolio currency        CPM004
     C                     Z-ADDQ8SPOT    ZRATET                          CPM004
     C                     MOVE Q8MDV1    ZMDINT                          CPM004
     C                     Z-ADDQ8CDP     ZCDPT                           CPM004
     C                     MOVE WPTCY     ZCCYT                           CPM004
     C*                                                                   CPM004
     C**  Calculte cross rate between settlement currency and             CPM004
     C**  portfolio currency using Standard Subroutine SR/ZCCYCN          CPM004
     C                     Z-ADD0         ZAMTF                           CPM004
     C                     EXSR ZCCYCN                                    CPM004
     C*                                                                   CPM004
     C                     ENDIF                                          CPM004
     C*                                                                   CPM004
     C**  Cross rate                                                      CPM004
     C*                                                                   CPM004
     C                     Z-ADDZCRSRT    WSPXR  138                      CPM004
     C*                                                                   CPM004
     C** Multiply/Divide Indicator                                        CPM004
     C*                                                                   CPM004
     C                     MOVELZCRSMD    WSPMD   1                       CPM004
     C*                                                                   CPM004
     C                     ENDSR                                          CPM004
     C*                                                                   CPM004
      *****************************************************************   CPM004
      /EJECT                                                              S01117
      *****************************************************************   S01117
      *                                                               *   S01117
      * *PSSR  - Database error subroutine.                           *   S01117
      *          This subroutine DUMPs the program just once.         *   S01117
      *                                                               *   S01117
      * Called by:                                                    *   S01117
      *                                                               *   S01117
      * Calls: None                                                   *   S01117
      *                                                               *   S01117
      *****************************************************************   S01117
      *                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR SR ** S01117
      *                                                                   S01117
     C           @RUN      IFEQ *BLANK                                    S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     ENDSR                                          S01117
      *                                                                   S01117
      ********************************************************************S01117
      /EJECT                                                              S01117
      *****************************************************************   S01117
      *                                                               *   S01117
      * CHKSEL - Subroutine to check for question marks.              *   S01117
      *                                               (First screen)  *   S01117
      * Called by: D1PROC                                             *   S01117
      *                                                               *   S01117
      * Calls: None                                                   *   S01117
      *                                                               *   S01117
      *****************************************************************   S01117
      *                                                                   S01117
     C           CHKSEL    BEGSR                                          S01117
      *                                                                   S01117
     C                     Z-ADD0         @SEL    10                      S01117
     C/COPY WNCPYSRC,SE0090C009
      *                                                                   CSE010
      ** Check Security Shortname and call Securities Selection           CSE010
      *                                                                   CSE010
     C           CSE010    IFEQ 'Y'                                       CSE010
     C                     MOVELSSESN     @QMK    1                       CSE010
     C           @QMK      IFEQ '?'                                       CSE010
     C                     Z-ADD1         @SEL                            CSE010
     C                     MOVELSSESN     @SESN                           CSE010
     C                     CALL 'SE0043'                                  CSE010
     C                     PARM           @ACDE   1                       CSE010
     C                     PARM           @SESN  10                       CSE010
     C           @SESN     IFNE *BLANKS                                   CSE010
     C                     MOVE @SESN     SSESN                           CSE010
     C                     ELSE                                           CSE010
     C                     MOVE *BLANKS   SSESN                           CSE010
     C                     ENDIF                                          CSE010
     C                     ENDIF                                          CSE010
     C                     ENDIF                                          CSE010
      *                                                                   S01117
     C                     MOVELSSBOK     @QMK    1                       S01117
     C           @QMK      IFEQ '?'                                       S01117
     C                     Z-ADD1         @SEL                            S01117
      *                                                                   S01117
      ** Access book details file SDBOOKPD via access object program      S01117
      *                                                                   S01117
     C                     CALL 'AOBOOKR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM '? '      @BKCD   2                       S01117
     C           SDBOOK    PARM SDBOOK    DSFDY                           S01117
     C           @RTCD     IFEQ '*NOSEL'                                  S01117
     C                     MOVE *BLANK    SSBOK                           S01117
     C                     ELSE                                           S01117
     C                     MOVE BDBKCD    SSBOK                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     MOVELSBBOK     @QMK    1                       S01117
     C           @QMK      IFEQ '?'                                       S01117
     C                     Z-ADD1         @SEL                            S01117
      *                                                                   S01117
      ** Access book details file SDBOOKPD via access object program      S01117
      *                                                                   S01117
     C                     CALL 'AOBOOKR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM '? '      @BKCD   2                       S01117
     C           SDBOOK    PARM SDBOOK    DSFDY                           S01117
     C           @RTCD     IFEQ '*NOSEL'                                  S01117
     C                     MOVE *BLANK    SBBOK                           S01117
     C                     ELSE                                           S01117
     C                     MOVE BDBKCD    SBBOK                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     MOVELSSBRC     @QMK    1                       S01117
     C           @QMK      IFEQ '?'                                       S01117
     C                     Z-ADD1         @SEL                            S01117
      *                                                                   S01117
      ** Access branch details file SDBRCHPD via access object program    S01117
      *                                                                   S01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM '?  '     @BRCD   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           @RTCD     IFEQ '*NOSEL'                                  S01117
     C                     MOVE *BLANK    SSBRC                           S01117
     C                     ELSE                                           S01117
     C                     MOVE A8BRCD    SSBRC                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     MOVELSBBRC     @QMK    1                       S01117
     C           @QMK      IFEQ '?'                                       S01117
     C                     Z-ADD1         @SEL                            S01117
      *                                                                   S01117
      ** Access branch details file SDBRCHPD via access object program    S01117
      *                                                                   S01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM '?  '     @BRCD   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           @RTCD     IFEQ '*NOSEL'                                  S01117
     C                     MOVE *BLANK    SBBRC                           S01117
     C                     ELSE                                           S01117
     C                     MOVE A8BRCD    SBBRC                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     MOVELSDEPT     @QMK    1                       S01117
     C           @QMK      IFEQ '?'                                       S01117
     C                     Z-ADD1         @SEL                            S01117
      *                                                                   S01117
      ** Access Securities Clients Details file                           S01117
      *                                                                   S01117
     C                     CALL 'AOSECSR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM '?     '  @AENB   6                       S01117
     C           SDSECS    PARM SDSECS    DSSDY                           S01117
     C           @RTCD     IFEQ '*NOSEL'                                  S01117
     C                     MOVE *BLANK    SDEPT                           S01117
     C                     ELSE                                           S01117
     C                     MOVE *BLANK    SDEPT                           S01117
     C                     MOVELBFCUST    SDEPT                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     MOVELSORBR     @QMK    1                       S01117
     C           @QMK      IFEQ '?'                                       S01117
     C                     Z-ADD1         @SEL                            S01117
      *                                                                   S01117
      ** Access branch details file SDBRCHPD via access object program    S01117
      *                                                                   S01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM '?  '     @BRCD   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           @RTCD     IFEQ '*NOSEL'                                  S01117
     C                     MOVE *BLANK    SORBR                           S01117
     C                     ELSE                                           S01117
     C                     MOVE A8BRCD    SORBR                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
      *                                                                   S01117
     C           @SEL      IFEQ 1                                         S01117
     C                     MOVE '1'       *IN22                           S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     ENDSR                                          S01117
      ********************************************************************S01117
      /EJECT                                                              S01117
      *****************************************************************   S01117
      *                                                               *   S01117
      * CHKSL2 - Subroutine to check for question marks.              *   S01117
      *                                              (Second screen)  *   S01117
      * Called by: D2PROC                                             *   S01117
      *                                                               *   S01117
      * Calls: None                                                   *   S01117
      *                                                               *   S01117
      *****************************************************************   S01117
      *                                                                   S01117
     C           CHKSL2    BEGSR                                          S01117
      *                                                                   S01117
     C                     Z-ADD0         @SEL                            S01117
      *                                                                   S01117
     C                     MOVELSSPCCD    @QMK    1                       S01117
     C           @QMK      IFEQ '?'                                       S01117
     C                     Z-ADD1         @SEL                            S01117
      *                                                                   S01117
      ** Access Profit Centres file                                       S01117
      *                                                                   S01117
     C                     CALL 'AOPRFCR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM '?   '    @PCCD   4                       S01117
     C           SDPRFC    PARM SDPRFC    DSFDY                           S01117
     C           @RTCD     IFEQ '*NOSEL'                                  S01117
     C                     MOVE *BLANK    SSPCCD                          S01117
     C                     ELSE                                           S01117
     C                     MOVE DSPCCD    SSPCCD                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     MOVELSBPCCD    @QMK    1                       S01117
     C           @QMK      IFEQ '?'                                       S01117
     C                     Z-ADD1         @SEL                            S01117
      *                                                                   S01117
      ** Access Profit Centres file                                       S01117
      *                                                                   S01117
     C                     CALL 'AOPRFCR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM '?  '     @PCCD   4                       S01117
     C           SDPRFC    PARM SDPRFC    DSFDY                           S01117
     C           @RTCD     IFEQ '*NOSEL'                                  S01117
     C                     MOVE *BLANK    SBPCCD                          S01117
     C                     ELSE                                           S01117
     C                     MOVE DSPCCD    SBPCCD                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     MOVELSTSUB     @QMK    1                       S01117
     C           @QMK      IFEQ '?'                                       S01117
     C                     Z-ADD1         @SEL                            S01117
      *                                                                   S01117
      ** Access Deal Sub-Types file                                       S01117
      *                                                                   S01117
     C                     CALL 'AODLSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM '?  '     @DSNB   3                       S01117
     C           SDDLST    PARM SDDLST    DSFDY                           S01117
     C           @RTCD     IFEQ '*NOSEL'                                  S01117
     C                     MOVE *BLANK    STSUB                           S01117
     C                     ELSE                                           S01117
     C                     MOVE ASDSTC    STSUB                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     ENDSR                                          S01117
      ********************************************************************081892
      /EJECT                                                              081892
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0090CP24                                           S01408
     C*                                                                   S01408
      *****************************************************************   081892
      *                                                               *   081892
      * MT500  - Subroutine to record to MT500 extension file if      *   081892
      *          S01401 on                                            *   081892
      * Called by: D2PROC                                             *   081892
      *                                                               *   081892
      * Calls: None                                                   *   081892
      *                                                               *   081892
      *****************************************************************   081892
      *                                                                   081892
     C           MT500     BEGSR                                          081892
      *                                                                   081892
      ****Access*Switchable*features*file*for*MT5xx*processing*-*S01401892CSW003
      ***********                                                  081892 CSW003
     C***********          CALL 'AOSARDR0'                         081892 CSW003
     C***********          PARM '       ' @RTCD                    081892 CSW003
     C***********          PARM '*VERIFY' @OPTN                    081892 CSW003
     C***********          PARM 'S01401'  @SARD   6                081892 CSW003
      ***********                                                  081892 CSW003
     C***********@RTCD     IFEQ *BLANK                             081892 CSW003
     C***********          MOVE 'Y'       S01401  1                081892 CSW003
     C***********          OPEN TRADSDX1                           081892 CSW003
     C           S01401    IFEQ 'Y'                                081892 CSW003
     C                     MOVE TDRF      T1TDRF                          081892
     C                     MOVE TDRF      T2TDRF                          BUG2582
     C                     MOVE 'N'       T1GMES                          081892
     C                     MOVE 'N'       T1GMEC                          081892
     C           CSW003    IFEQ 'Y'                                081892 CSW003
     C                     MOVE 'A'       T1WHEN                   081892 CSW003
     C                     MOVE 'A'       T2WHEN                          BUG2582
     C                     END                                     081892 CSW003
     C***********          MOVEASTAMP,1   T1TMST           Default Timestamp         CPK015 BUG12410
     C***********          MOVEASTAMP,1   T2TMST                          BUG2582           BUG12410
     C                     MOVELNEWTIM    T1TMST                                            BUG12410
     C                     MOVELNEWTIM    T2TMST                                            BUG12410
     C                     WRITETRADSDD1                                  081892
     C                     WRITETRADSDD2                                  BUG2582
     C***********          CLOSETRADSDX1                           081892 CSW003
     C                     END                                            081892
      *                                                                   081892
     C                     ENDSR                                          081892
      *                                                                   081892
      ********************************************************************S01117
      *                                                                   S01195
      ***/EJECT                                                           S01195
     C***/COPY ZSRSRC,XDATE3Z1                                            S01195
      *                                                                   S01195
      /EJECT                                                              S01195
     C/COPY ZSRSRC,ZACCH                                                  S01195
      /EJECT
     C/COPY ZSRSRC,ZACCRZ1
      /EJECT                                                              E39495
     C/COPY ZSRSRC,ZACCZZ1                                                E39495
      /EJECT
     C/COPY ZSRSRC,ZALIGNZ2
      /EJECT
     C/COPY ZSRSRC,ZASIGNZ2
      /EJECT
     C/COPY ZSRSRC,ZBKDT                                                  S01195
      /EJECT                                                              E39495
     C/COPY ZSRSRC,ZCALCD                                                 E39495
      /EJECT                                                              S01195
     C/COPY ZSRSRC,ZCCYCN                                                 CPM004
      /EJECT                                                              CPM004
     C/COPY ZSRSRC,ZCHKH                                                  S01195
      *                                                                   S01195
     C***/COPY*ZSRSRC,ZCTRVZ1***                                          E20232
      *                                                                   S01195
     C/COPY ZSRSRC,ZCNSDZ1                                                E20232
      /EJECT                                                              E20232
     C/COPY ZSRSRC,ZCONVZ1                                                S01269
      /EJECT                                                              S01269
     C/COPY ZSRSRC,ZCOTRZ1                                                E20232
      /EJECT
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0090CCP8                                           S01408
     C*                                                                   S01408
     C/COPY ZSRSRC,ZDATE1Z2
      /EJECT
     C/COPY ZSRSRC,ZDATE2Z4
      *                                                                   S01195
      ***/EJECT*****************                                    E20125S01195
     C***/COPY*ZSRSRC,ZDATE3Z5**                                    E20125S01195
      *                                                                   S01195
      /EJECT
     C***/COPY*ZSRSRC,ZDATE6Z2**                                          S01195
      /EJECT
     C/COPY ZSRSRC,ZDAYSZ2
      /EJECT
     C/COPY ZSRSRC,ZDYYRZ3
      *
      ***/EJECT*****************                                          E20085
     C***/COPY*ZSRSRC,ZEVCDZ1***                                          E20085
      ***/EJECT*****************                                          S01117
     C***/COPY ZSRSRC,ZICD2Z1***                                          S01117
      ***/EJECT*****************                                          S01117
     C***/COPY ZSRSRC,ZICDSEZ1**                                          S01117
      *                                                                   S01117
      /EJECT                                                              E20085
     C/COPY ZSRSRC,ZFWDT                                                  S01195
      /EJECT                                                              S01195
     C/COPY ZSRSRC,ZLCDZ1                                                            E20085 MD057247
      /EJECT
     C/COPY ZSRSRC,ZLCD1Z1                                                                    CSE035
      /EJECT                                                                                  CSE035
     C/COPY ZSRSRC,ZNCDZ3
      /EJECT                                                              S01510
     C/COPY ZSRSRC,ZNDDZ1                                                 S01510
      /EJECT                                                              E20085
     C/COPY ZSRSRC,ZPCINTZ1                                               E20085
      /EJECT
     C/COPY ZSRSRC,ZPRCIZ1
      /EJECT
     C/COPY ZSRSRC,ZRATEZ1
      /EJECT
     C/COPY ZSRSRC,ZSEDITZ3
      ***/EJECT****************                                           S01117
     C***/COPY*ZSRSRC*ZSYSTMZ1*                                           S01117
      /EJECT
     C/COPY ZSRSRC,ZTNLU1Z2
      /EJECT
     C/COPY ZSRSRC,ZYLDIZ1
      /EJECT
     C/COPY ZSRSRC,ZYLDZ2
      /EJECT
     C/COPY WNCPYSRC,SE0090CP21                                           S01408
      ***
**  CPY@
(c) Finastra International Limited 2001
** ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
00000001
00000010
00000100
00001000
00010000
00100000
01000000
10000000
**   INF  - WORKSTATION MESSAGE FOR UPDATE ERROR
RECORD UPDATED BY ANOTHER WORKSTATION
FILE NOT UPDATED - ERROR IN MARKET UPDATE
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
0006001521029820444305904073650882610287117481320914670161311759219053
2051421975234362489726358278192928030741322023366335124365853804639507
40968424294389045351
** STAMP - Dummy timestamp                                                                    CPK015
0001-01-01-00.00.00.000000                                                                    CPK015
