     H        1
      *****************************************************************
/*OVR *  OVRDBF FILE(GZSDBANK) TOFILE(GZSDBANKL2)                     *                       CSD031
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Account Keys File Maintenance')               *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Securities Trading Module
     F*                                                               *
     F*  SE0110 - ACCOUNT KEYS FILE MAINTENANCE                       *
     F*                                                               *
     F*  Function: This program accepts single item input, validates  *
     F*   (I/C)    it and updates the Table of Account Keys used for  *
     F*            Securities Trading. Or, it can be used in Enquiry  *
     F*            mode to display the specific Table record.         *
     F*                                                               *
     F*  Called By: SEC02 - Input Cycle Processing                    *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. DUG501             Date 23Nov17               *
      *  Prev Amend No. MD039572           Date 14Jan20               *
      *                 MD046248           Date 27Oct17               *
      *                 MD043337           Date 25Jul17               *
      *                 CER059             Date 19Jul10               *
      *                 CER030             Date 09Jul08               *
      *                 CSC043             Date 18Jun10               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 BUG13070           Date 23Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 BUG12646           Date 14Nov06               *
      *                 BUG12271           Date 22Oct06               *
      *                 BUG11781           Date 26Jul06               *
      *                 BUG11761           Date 26Jul06               *
      *                 BUG11708           Date 17Jul06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CAAA03             Date 29Apr04               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CSD005             Date 01Mar99               *
      *                 CTI002             Date 23Sep/98              *
     F*                 093975             DATE 25OCT95               *
     F*                 052254             DATE 07JAN94               *
     F*                 S01117             DATE 30OCT90               *
     F*                 E23957             DATE 24OCT90               *
     F*                 E21672             DATE 12APR90               *
     F*                 E19765             DATE 09OCT89               *
     F*                 S01199             DATE 01AUG89               *
     F*                 E13651             DATE 08/09/88              *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  DUG501 - ACCOUNTS SPLIT FOR REALISED P&L AND ACCOUNT SEQ     *
      *           BY BOOK                                             *
      *           Amend hook SE0110C007                               *
      *           Add hook DUG501_001, DUG501_002                     *
      *  MD039572 - Failed component during COB - COMPONENT DLC0606C  *
      *  MD046248 - Finastra Rebranding                               *
      *  MD043337 - Failed Component SEC0601 00017 during COB         *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER030 - Multicash German Feature (Recompile)                *
      *  CSC043 - MidasPlus IASP Enablement                           *
      *  BUG13070 - Initialise screen fields                          *
      *  BUG12646 - Cater for SEACKA file control length increase     *
      *  BUG12271 - Record not updated when accepting amendment       *
      *  BUG11781 - Record in zonal was not deleted                   *
      *  BUG11761 - White fields in the screen (Recompile)            *
      *  BUG11708-Additional text box indicated in the input screen   *
      *           (Recompile)                                         *
      *  CSD031 - Enhanced Centralised Static Data                    *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CAAA03 - Webfacing Changes (recompile).                      *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CSD005 - Standing Data Account Narrative.  Add new field     *
      *           to SDACODPD.  Recompilation of programs.            *
      *  CTI002 - Recompiled : File SDACODPD changed                  *
     F*  093975 - Suppress limitation 01 to 50 or 0* for the narrative*
     F*           code as it is in the A/C keys generator             *
     F*           + correct validation of Narrative                   *
     F*  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
     F*           to 10,9                                             *
     F*  S01117 - MULTIBRANCHING                                      *   S01117
     F*  E23957 - Changed to process amended field names from SEACKD. *
     F*  E21672 - Number of Live Records on File is incorrect.        *
     F*  E19765 - Change Display File Array to cater for the removal  *   E19765
     F*           of *IN16 previously used for Help.                  *   E19765
     F*  S01199 -  Help System.                                    *   S01199
     F*  E13651 - Number of Live Records on File is incorrectly       *   E13651
     F*           calculated and causes File Controls Out of Balance. *   E13651
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F*
     F*SE0110DFCF  F     253            WORKSTN      KPASS  *NOIND        E19765
     F/COPY WNCPYSRC,SE0110F001
     F***SE0110DFCF  F     252            WORKSTN      KPASS  *NOIND                   E19765 CGL029
     F***SE0110DFCF  F     288            WORKSTN      KPASS  *NOIND                   CGL029 CSD031
     FSE0110DFCF  F     301            WORKSTN      KPASS  *NOIND                             CSD031
     FSE0110D2CF  E                    WORKSTN                        UC                      CSD031
     F                                        @@RRN KSFILE SE0110S1                           CSD031
     F                                              KINFSR *PSSR                              CSD031
     F/COPY WNCPYSRC,SE0110F002
     FSEACKA  UF  E                    DISK
     F                                              KCOMIT
     FSEACKD  UF  E           K        DISK                      A
     F                                              KCOMIT
     F                                              KINFDS INFDS
     F                                              KINFSR INFSR
     FSDASAKL0UF  E           K        DISK                           UC                      CSD031
     F                                              KCOMIT                                    CSD031
     F            SEACKDF                           KRENAMESDASAKDF                           CSD031
     FGPZONEL0IF  E           K        DISK                                                   CSD031
     FGZSDBANKIF  E           K        DISK                           UC                      CSD031
     F*TABSDU*IF**E*********  K        DISK                               S01117
     F*********** TABLETAF                          KIGNORE               S01117
     F*********** TABLET1F                          KIGNORE               S01117
     F*********** TABTB10F                          KIGNORE               S01117
     F*********** TABTB11F                          KIGNORE               S01117
     F*********** TABTB20F                          KIGNORE               S01117
     F*********** TABTB30F                          KIGNORE               S01117
     F*********** TABTB35F                          KIGNORE               S01117
     F*********** TABTE20F                          KIGNORE               S01117
     F*********** TABTG10F                          KIGNORE               S01117
     F*********** TABTG20F                          KIGNORE               S01117
     F*********** TABLETHF                          KIGNORE               S01117
     F*********** TABLETIF                          KIGNORE               S01117
     F*********** TABLETJF                          KIGNORE               S01117
     F*********** TABLETKF                          KIGNORE               S01117
     F*********** TABLETLF                          KIGNORE               S01117
     F*********** TABLETNF                          KIGNORE               S01117
     F*********** TABLETOF                          KIGNORE               S01117
     F*********** TABLETRF                          KIGNORE               S01117
     F*********** TABLETSF                          KIGNORE               S01117
     F*********** TABLETTF                          KIGNORE               S01117
     F*********** TABLETVF                          KIGNORE               S01117
     F*********** TABLETWF                          KIGNORE               S01117
     F*********** TABLET2F                          KIGNORE               S01117
     F*********** TABLET3F                          KIGNORE               S01117
     F*********** TABLET4F                          KIGNORE               S01117
     F*********** TABLET6F                          KIGNORE               S01117
     F*********** TABLETXF                          KIGNORE               S01117
     F*********** TABLET7F                          KIGNORE               S01117
     F*********** TABT601F                          KIGNORE               S01117
     F*********** TABT602F                          KIGNORE               S01117
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*   01  - WRKSTN - INITIAL   SCREEN, CODE SF.                   *
     F*   02  -        - INSERTION SCREEN, CODE SI.                   *
     F*   03  -        - AMENDMENT SCREEN, CODE SA.                   *
     F*   04  -        - DELETION  SCREEN, CODE SD.                   *
     F*   05  -        - ENQUIRY   SCREEN, CODE SE.                   *
     F*   06  - CENTRAL LEVEL                                         *                       CSD031
     F*   07  - FIRST TIME PASS THROUGH RPG CALC CYCLE                *
     F*   08  - ACCEPT TO ZONE FIELD ERROR                            *                       CSD031
     F*   09  - EFFECTIVE DATE FIELD ERROR                            *                       CSD031
     F*   10  - RECORD IS A CENTRAL DATA                              *                       CSD031
     F*   11  - NO RECORD TO DISPLAY IN SUBFILE                       *                       CSD031
     F*   12  - SFLDSP                                                *                       CSD031
     F*   13  - ERROR - ACTION CODE 'I' IN ZONE LEVEL                 *                       CSD031
     F*   16  - ERROR DURING READ FROM THE WORK STATION /             *
     F****************HELP INDICATOR***********************************   E19765
     F*                                                               *
     F*   20  - WRKSTN-ACCOUNT KEY IN ERROR.                          *
     F*   21  - A/C KEY BLANK - CONTROL INDICATOR                     *
     F*   22  - SEACKD - ACCOUNT CODE 1 PRESENT.                      *
     F*   23  -        - ACCOUNT CODE 2 PRESENT.                      *
     F*   24  -        - ACCOUNT CODE 3 PRESENT.                      *
     F*   25  -        - ACCOUNT CODE 4 PRESENT.                      *
     F*   26  -        - ACCOUNT CODE 5 PRESENT.                      *
     F*   27  -        - ACCOUNT CODE 6 PRESENT.                      *
     F*   28  -        - NARRATIVE CODE 1 BLANK                       *
     F*   29  -        - NARRATIVE CODE 2 BLANK                       *
     F*   30  -        - NARRATIVE CODE 3 BLANK                       *
     F*   31  -        - NARRATIVE CODE 4 BLANK                       *
     F*   32  -        - NARRATIVE CODE 5 BLANK                       *
     F*   33  -        - NARRATIVE CODE 6 BLANK                       *
     F*   34  -        - POSTING REFERENCE 1 PRESENT.                 *
     F*   35  -        - POSTING REFERENCE 2 PRESENT.                 *
     F*   36  -        - POSTING REFERENCE 3 PRESENT.                 *
     F*   37  -        - POSTING REFERENCE 4 PRESENT.                 *
     F*   38  -        - POSTING REFERENCE 5 PRESENT.                 *
     F*   39  -        - POSTING REFERENCE 6 PRESENT.                 *
     F*                                                               *
     F*   40  - PREVENT OUTPUT TO WORKSTN, OVERRIDEN BY 41.           *
     F*   41  - OUTPUT INITIAL SCREEN, ID.SF, TO WORKSTN.             *
     F*   42  - PASS INITIAL FIELDS FROM INPUT TO OUTPUT WORKSTN.     *
     F*   43  - PASS OTHER FIELDS FROM INPUT TO OUTPUT WORKSTN.       *
     F*   44  - PASS FIELDS FROM SEACK RECORD TO WORKSTN.             *
     F*   46  - NARRATIVE CODE 1 ERROR                                *
     F*   47  - NARRATIVE CODE 2 ERROR                                *
     F*   48  - NARRATIVE CODE 3 ERROR                                *
     F*   49  - NARRATIVE CODE 4 ERROR                                *
     F*   50  - NARRATIVE CODE 5 ERROR                                *
     F*   51  - NARRATIVE CODE 6 ERROR                                *
     F*   52  - ACTION CODE IS 'I' - INSERTION.                       *
     F*   53  - ACTION CODE IS 'A' - AMENDMENT.                       *
     F*   54  - ACTION CODE IS 'D' - DELETION.                        *
     F*   55  - ACTION CODE IS 'E' - ENQUIRY.                         *
     F*   56  - ACTION CODE NOT I, A, D OR E, ERROR.                  *
     F*   57  - SYSTEM SETUP FLAG ON - NO DELETES ALLOWED             *
     F*   58  - ROLLUP                                                *                       CSD031
     F*   59  - SFLDSPCTL                                             *                       CSD031
     F*   60  - ACCOUNT KEY CONTAINS INVALID CHARACTER.               *
     F*   61  - AT LEAST ONE ACCOUNT CODE IN ERROR.                   *
     F*   62  - AT LEAST ONE NARRATIVE CODE IN ERROR.                 *
     F*   63  - AT LEAST ONE POSTING REFERENCE IN ERROR.              *
     F*   64  - POSTING REFERENCE IS 2                                *
     F*   65  - ACCOUNT CODE 1 ERROR                                  *
     F*   66  - NARRATIVE CODE IS NOT IN RANGE 01-50                  *
     F*   67  - ACCOUNT IS TITLE ONLY                                 *
     F*   68  - LETTERS OF CREDIT CREDIT ACCOUNT KEY.                 *
     F*                                                               *
     F*  EXCEPTION OUTPUT/UPDATE INDICATORS ARE-                      *
     F*   69  - CHAIN TO SEACK FAILED.                                *
     F*   70  - ACCOUNT CODE 2 ERROR                                  *
     F*   74  - ACCOUNT CODE 3 ERROR                                  *
     F*   75  - ACCOUNT CODE 4 ERROR                                  *
     F*                                                               *
     F*   76  - CHAIN TO TABLE FILE FAILED IF ON.                     *
     F*   77  - ACCOUNT CODE 5 ERROR                                  *
     F*   78  - ACCOUNT CODE 6 ERROR                                  *
     F*                                                               *
     F*   79  - RECORD UPDATED BY ANOTHER WORKSTATION.                *
     F*                                                               *
     F*   80  - IF ACTION AND LOCAL INSTITUTION CODES VALID PROTECT   *
     F*         BOTH FIELDS ON SCREEN AND OUTPUT NEW SCREEN ID.       *
     F*   81  - NON-DISPLAY OUTPUT LABELS OTHER THAN ACTION & SEACK.  *
     F*   82  - PROTECT OUTPUT FIELDS OTHER THAN ACTION & A/C KEY.    *
     F*   83  - ERROR CODE LINE IS NON-DISPLAY IF ON.                 *
     F*   84  - ERROR MESSAGE LINE IS NON DISPLAY IF ON.              *
     F*                                                               *
     F*   86  - WORK INDICATOR FOR NARRATIVE CODE VALIDATION          *
     F*   87  - WORK INDICATOR FOR NARRATIVE CODE VALIDATION          *
     F*   88  - WORK INDICATOR.                                       *
     F*   89  - WORK INDICATOR.                                       *
     F*                                                               *
     F*   90  - POSTING REFERENCE 1 ERROR                             *
     F*   91  - POSTING REFERENCE 2 ERROR                             *
     F*   92  - POSTING REFERENCE 3 ERROR                             *
     F*   93  - POSTING REFERENCE 4 ERROR                             *
     F*   94  - POSTING REFERENCE 5 ERROR                             *
     F*   95  - POSTING REFERENCE 6 ERROR                             *
     F*                                                               *
0104 F****98**-*ZSYSTM,*DATE*FORMAT*MMDDYY*IF*ON.****************     *   S01117
0104 F*   98  - DATE FORMAT MMDDYY IF ON.                             *   S01117
0105 F****99**-*ZSYSTM,*INSTALLATION*CONTROL*DATA*RECORD*NOT*FOUND.****   S01117
     F*                                                               *
     F*   KJ  - F/10 DELETE RECORD REQUEST, VALID IF DELETE SCREEN.   *
     F*   KL  - F/12 INITIAL SCREEN REQUEST.                          *
     F*   KC  - F/3  END OF PROGRAM REQUEST.                          *
     F*                                                               *
     F* U7 U8 - DATABASE ERROR, REQUIRED RECORDS NOT FOUND.           *
     F*         N.B. U7 & U8 END THE PROGRAM AND CONDITION            *
     F*         FOLLOWING CL EXECUTION.                               *
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*  ACKCHN - CHAIN TO ACCOUNT KEYS FILE                          *
     F*  TABCHN - CHAIN TO TABLE FILE                                 *
     F*  EXCPTN - EXCEPTION TIME OUTPUT + RESET INDICATORS            *
     F*  DSERR  - SET INDICATORS ON DATABASE ERROR                    *
     F*  TIME   - OBTAIN TIME                                         *
     F*                                                               *
     F*  INFSR - FILE EXCEPTION SUBROUTINE                            *
     F*  *PSSR - ERROR HANDLING                                       *   S01117
     F*                                                               *
     F***ZSYSTM*-*CHAIN*TO*ICD*RECORD*1********************************   S01117
     F*  ZTNLU1 - UPDATE TRANSACTION DATA AREA                        *
     F*                                                               *
     F*****************************************************************
      /EJECT
     E                    CPY@    1   1 80
     E* ERROR MESSAGES
0119 E***********         ERRMSG  1   6 47               ERROR MESSAGES   S01117
     E/COPY WNCPYSRC,SE0110E001
0119 E                    ERRMSG  1   7 47               ERROR MESSAGES   S01117
     E                    C31MSG  1   2 65               CSD031 MESSAGES                      CSD031
     E/COPY WNCPYSRC,SE0110E002
     E* ERROR CODE OUTPUT
     E                    ERCD       18  4
     E* PERMITTED CHARACTERS (A-Z, 0-9 & BLANK)
     E                    CHAR   37  37  1
     E* ARRAY FOR A/C KEY
     E                    ACKY       20  1
     E* ACCOUNT CODES
     E**********          SACD        6  4                                                    CGL029
     E                    SACD        6 10                                                    CGL029
     E* NARRATIVE CODES
     E                    SNCD        6  2
     E* POSTING REFERENCES
     E                    SPRF        6  1
     E** Override database file                                                               CSD031
     E**********          OVRC    1   1 80                                                    CSD031
     E                    OVRC    1   3 80                                                    CSD031
     E/COPY WNCPYSRC,SE0110E003
      /EJECT
     I*****WORKSTATION FILE.                                              E19765
     I************                                                        E19765
     I*E0110DFNS**01   2 CS   3 CF                                        E19765
     I*******OR***02   2 CS   3 CI                                        E19765
     I*******OR***03   2 CS   3 CA                                        E19765
     I*******OR***04   2 CS   3 CD                                        E19765
     I*******OR***05   2 CS   3 CE                                        E19765
     I************                            1   1 *IN16                 E19765
      ************                                                        E19765
     I************                            2   3 STID                  E19765
     I************                            4   4 ACTCD                 E19765
     I************                            5  24 SAKEY           20    E19765
     I************                            5  24 ACKY                  E19765
     I************                                                        E19765
     I************                            5   6 SAKYF2                E19765
     I************                                                        E19765
     I************                           25  28 SACD,1                E19765
     I************                           29  30 SNCD,1                E19765
     I************                           31  31 SPRF,1                E19765
     I************                           32  35 SACD,2                E19765
     I************                           36  37 SNCD,2                E19765
     I************                           38  38 SPRF,2                E19765
     I************                           39  42 SACD,3                E19765
     I************                           43  44 SNCD,3                E19765
     I************                           45  45 SPRF,3                E19765
     I************                           46  49 SACD,4                E19765
     I************                           50  51 SNCD,4                E19765
     I************                           52  52 SPRF,4                E19765
     I************                           53  56 SACD,5                E19765
     I************                           57  58 SNCD,5                E19765
     I************                           59  59 SPRF,5                E19765
     I************                           60  63 SACD,6                E19765
     I************                           64  65 SNCD,6                E19765
     I************                           66  66 SPRF,6                E19765
     I************                            2  66 LOTSCN                E19765
     I************                            5  66 SCFLDS                E19765
     I*
     I**  WORKSTATION FILE.
     I*
     ISE0110DFNS  01   1 CS   2 CF                                        E19765
     I       OR   02   1 CS   2 CI                                        E19765
     I       OR   03   1 CS   2 CA                                        E19765
     I       OR   04   1 CS   2 CD                                        E19765
     I       OR   05   1 CS   2 CE                                        E19765
     I                                        1   2 STID                  E19765
     I                                        3   3 ACTCD                 E19765
     I                                        4  23 SAKEY           20    E19765
     I                                        4  23 ACKY                  E19765
     I*                                                                   E19765
     I                                        4   5 SAKYF2                E19765
     I*                                                                   E19765
     I**********                             24  27 SACD,1                             E19765 CGL029
     I**********                             28  29 SNCD,1                             E19765 CGL029
     I**********                             30  30 SPRF,1                             E19765 CGL029
     I**********                             31  34 SACD,2                             E19765 CGL029
     I**********                             35  36 SNCD,2                             E19765 CGL029
     I**********                             37  37 SPRF,2                             E19765 CGL029
     I**********                             38  41 SACD,3                             E19765 CGL029
     I**********                             42  43 SNCD,3                             E19765 CGL029
     I**********                             44  44 SPRF,3                             E19765 CGL029
     I**********                             45  48 SACD,4                             E19765 CGL029
     I**********                             49  50 SNCD,4                             E19765 CGL029
     I**********                             51  51 SPRF,4                             E19765 CGL029
     I**********                             52  55 SACD,5                             E19765 CGL029
     I**********                             56  57 SNCD,5                             E19765 CGL029
     I**********                             58  58 SPRF,5                             E19765 CGL029
     I**********                             59  62 SACD,6                             E19765 CGL029
     I**********                             63  64 SNCD,6                             E19765 CGL029
     I**********                             65  65 SPRF,6                             E19765 CGL029
     I                                       24  33 SACD,1                                    CGL029
     I                                       34  35 SNCD,1                                    CGL029
     I                                       36  36 SPRF,1                                    CGL029
     I                                       37  46 SACD,2                                    CGL029
     I                                       47  48 SNCD,2                                    CGL029
     I                                       49  49 SPRF,2                                    CGL029
     I                                       50  59 SACD,3                                    CGL029
     I                                       60  61 SNCD,3                                    CGL029
     I                                       62  62 SPRF,3                                    CGL029
     I                                       63  72 SACD,4                                    CGL029
     I                                       73  74 SNCD,4                                    CGL029
     I                                       75  75 SPRF,4                                    CGL029
     I                                       76  85 SACD,5                                    CGL029
     I                                       86  87 SNCD,5                                    CGL029
     I                                       88  88 SPRF,5                                    CGL029
     I                                       89  98 SACD,6                                    CGL029
     I                                       99 100 SNCD,6                                    CGL029
     I                                      101 101 SPRF,6                                    CGL029
     I                                      102 102 SAZON                                     CSD031
     I                                      103 108 SEDTE                                     CSD031
     I/COPY WNCPYSRC,SE0110I001
     I**********                              1  65 LOTSCN                             E19765 CGL029
     I**********                              4  65 SCFLDS                             E19765 CGL029
     I                                        1 101 LOTSCN                                    CGL029
     I                                        4 101 SCFLDS                                    CGL029
     I                                       24 101 SCFLD                                   BUG13070
     I/COPY WNCPYSRC,SE0110I002
     I**   CATCHALL.
     I        NS  15
     I*
     I**   DATA STRUCTURE FOR LAST UPDATE DATA.
     I*
     I            DS
     I                                        1   50LCD
     I                                        6   6 CHTP
     I                                        7  110TNLU
     I                                        1  11 LSTC
     I                                       12  160LCDS
     I                                       17  17 CHTPS
     I                                       18  220TNLUS
     I                                       12  22 LSTCS
     I*
     I**  DATA STRUCTURE FOR VALIDATING NARRATIVE CODE
     I*
     I            DS
     I                                        1   2 SNCDC
     I                                        1   1 NCDCH1
     I                                        2   2 NCDCH2
     IPSDS       SDS
     I                                      244 246 WSID
     I                                      245 246 WSID2
     I                                      254 263 USRID
     I*
     I**  DATA STRUCTURE  TO UPDATE LAST TRANSACTION NUMBER DTAARA
     I*
     I*DA********UDS                            256                       S01117
     I***********                           134 177 DBLOT                 S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 177 DBASE                 S01117
     ILDA         DS                            256                       S01117
     I** *LOCK IN LDA immediately before and OUT LDA immediately          S01117
     I** after each database error handling.                              S01117
     I                                      134 183 DBLOT                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
      *                                                                   S01117
     ISDACOD    E DSSDACODPD                                              S01117
      *                                                                   S01117
      ** External data structure for Account Code details                 S01117
      *                                                                   S01117
     ISDNARR    E DSSDNARRPD                                              S01117
      *                                                                   S01117
      ** External data structure for Narrative Code details               S01117
      *                                                                   S01117
     IDSFDY     E DSDSFDY                                                 S01117
      *                                                                   S01117
      ** First DS for access programs, short data structure               S01117
      *                                                                   S01117
     IDSSDY     E DSDSSDY                                                                     CGL029
      ** Second DS for access programs, long data structure                                   CGL029
      *                                                                                       CSD031
     ISDBANK    E DSSDBANKPD                                                                  CSD031
      ** Bank details file                                                                    CSD031
      *                                                                                       CSD031
     ISCSARD    E DSSCSARDPD                                                                  CSD031
     I              LCD                             LCD3                                      CSD031
     I              ZONE                            ZONE3                                     CSD031
      ** Switchable features                                                                  CSD031
      *                                                                                       CSD031
     IGPACOD    E DSGPACODPD                                                                  CSD031
      ** Global Account Codes                                                                 CSD031
      *                                                                                       CSD031
     I@1DBRC    E DSSEACKD                                                                    CSD031
     I              LCD                             LCD2                                      CSD031
     I              CHTP                            CHTP2                                     CSD031
     I              TNLU                            TNLU2                                     CSD031
      *                                                                                       CSD031
     IPDQMSG      DS                           4040                                           CSD031
      *                                                                                       CSD031
     I*
     I/COPY ZSRSRC,ZTNLU1Z1
     IINFDS       DS
     I                                     *STATUS  STATUS
     I*
     I**  DATA STRUCTURE TO PROVIDE TEXT ON COMIT ENTRY IN JOURNAL
     ICMTTXT      DS
     I                                        1   50NATN
     I                                        6   7 MDID
     I                                        8  15 PGMN
     I                                       16  18 WSIDX
     I                                       19  240MTIME
     I                                       25  25 ACTCD
     I                                       26  35 USRIDX
     I/COPY WNCPYSRC,SE0110I003
     I**********                             51 115 LOTSCN                                    CGL029
     I                                       51 151 LOTSCN                                    CGL029
     I/COPY WNCPYSRC,SE0110I004
     I*
     I**  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I**                                                                  S01117
     IRUNDT       DS                                                      S01117
     I** DATA AREA RUNDAT                                                 S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
     IWDTQ        DS                                                                          CSD031
     I                                        1  10 WPFNAM                                    CSD031
     I                                       11  40 WKEYS                                     CSD031
     I                                       41 296 WDATA                                     CSD031
     I**                                                                  S01117
     IZMUSER      DS                             17                       S01117
      ** DATA AREA OF MENU USER                                           S01117
     I                                       11  13 USRBCH                S01117
      *                                                                                       CSD031
     I              'GBSDUSRMSG'          C         WMSGQ                                     CSD031
     I              'Y2USRMSG  '          C         WMSGQ2                                    CSD031
     I              '1234567890'          C         DIGITS                                    CSD031
     I**********    'XLIB/SDCSNDDTQ'      C         PGMB                               CSD031 CSC043
     I              'XPLIB/SDCSNDDTQ'     C         PGMB                                      CSC043
     C/EJECT
      *================================================================
      *  P R O G R A M     S T A R T                                  *
      *================================================================
     C/COPY WNCPYSRC,SE0110C015
     C*
     C**  FROM ERROR HANDLING SUBROUTINE RETURN TO EXIT POINT
     C*
     C           STATUS    IFEQ 01021
     C                     Z-ADD0         STATUS  50
     C                     GOTO INFTAG
     C                     END
     C*
     C****READ*WORKSTATION*FILE*/*HELP*FACILITY************************   S01199
     C**  READ WORKSTATION FILE                                           S01199
     C*
     C           *IN07     IFEQ '1'
     C           *IN16     DOUEQ'0'
     C                     READ SE0110DF                 16
     C********** *IN16     IFEQ '1'                                       S01199
     C**********           MOVEAERCD      HERCD 160                       S01199
     C**********           MOVEL'SE0110'  HBPGM   8                       S01199
     C**********           CALL 'MHELP'                                   S01199
     C**********           PARM           HBPGM                           S01199
     C**********           PARM           HERCD                           S01199
     C**********           END                                            S01199
     C                     END
     C                     GOTO ENDFC
     C                     END
     C*
     C**  FIRST CYCLE PROCESSING ONLY
     C*
     C  N07                SETON                     07
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL*BLANK    DBLOT
     C                     MOVEL'SE0110'  DBPGM
     C                     OUT  LDA                                       S01117
     C*
0340 C*****GET*INSTALLATION*CONTROL*DATA*RECORD*AND*RELEASE.**************S01117
     C***********          EXSR ZSYSTM                                    S01117
     C************IN,99    IFEQ '1'                                       S01117
     C***********          MOVEL'1'       *INU8                           S01117
     C***********          MOVEL'1'       *INU7                           S01117
     C***********          MOVEL'01'      DBASE            **DB ERROR 01**S01117
     C***********          MOVEL'TABLE'   DBFILE                          S01117
     C***********          MOVELZTABKY    DBKEY                           S01117
0343 C***********          GOTO ENDD                       DATABASE ERROR.S01117
     C***********          END                                            S01117
     C*                                                                   S01117
     C** IN THE DATAAREA RUNDAT                                           S01117
     C*                                                                   S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C                     IN   RUNDT                                     S01117
     C**                                                                  S01117
     C**   CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.                    S01117
     C**                                                                  S01117
     C           DATF      COMP 'M'                      98               S01117
     C**                                                                  S01117
     C** IN THE DATAAREA ZMUSER                                           S01117
     C**                                                                  S01117
     C           *NAMVAR   DEFN           ZMUSER                          S01117
     C                     IN   ZMUSER                                    S01117
      *                                                                                       CSD031
      ** CHECK IF CSD036 IS ON                                                                CSD031
      *                                                                                       CSD031
     C                     CALL 'AOSARDR0'                                                    CSD031
     C                     PARM *BLANKS   PRTCD   7                                           CSD031
     C                     PARM '*VERIFY' POPTN   7                                           CSD031
     C                     PARM 'CSD036'  PSARD   6                                           CSD031
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD031
      *                                                                                       CSD031
     C           PRTCD     IFNE *BLANKS                                                       CSD031
     C           PRTCD     ANDNE'*NRF'                                                        CSD031
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD031
     C                     MOVEL'CSD036'  DBKEY                                               CSD031
     C                     MOVEL1         DBASE                                               CSD031
     C                     EXSR *PSSR                                                         CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C           PRTCD     IFEQ *BLANKS                                                       CSD031
     C                     MOVE 'Y'       CSD036  1                                           CSD031
     C                     MOVE *ON       *IN45                                               CSD031
     C                     OPEN SDASAKL0                                                      CSD031
     C                     OPEN SE0110D2                                                      CSD031
     C                     ELSE                                                               CSD031
     C                     MOVE 'N'       CSD036                                              CSD031
     C                     MOVE *OFF      *IN45                                               CSD031
     C                     ENDIF                                                              CSD031
     C/COPY WNCPYSRC,DUG501_001                                                               DUG501
      *                                                                                       CSD031
      ** RETRIEVE BANK DETAILS                                                                CSD031
      *                                                                                       CSD031
     C           *INU5     IFEQ *ON                                                           CSD031
      *                                                                                       CSD031
     C                     Z-ADD80        PLEN   155                                          CSD031
     C                     MOVE OVRC,1    PCMD   80                                           CSD031
      *                                                                                       CSD031
     C                     CALL 'QCMDEXC'                                                     CSD031
     C                     PARM           PCMD                                                CSD031
     C                     PARM           PLEN                                                CSD031
      *                                                                                       CSD031
     C                     OPEN GZSDBANK                                                      CSD031
     C                     READ GZSDBANK                 90                                   CSD031
     C           *IN90     IFEQ *ON                                                           CSD031
     C                     MOVEL'GZSDBANK'DBFILE                                              CSD031
     C                     Z-ADD2         DBASE                                               CSD031
     C                     EXSR *PSSR                                                         CSD031
     C                     ENDIF                                                              CSD031
     C                     CLOSEGZSDBANK                                                      CSD031
      *                                                                                       CSD031
     C                     ELSE                                                               CSD031
      *                                                                                       CSD031
     C                     CALL 'AOBANKR0'                                                    CSD031
     C                     PARM '*MSG   ' PRTCD   7                                           CSD031
     C                     PARM '*FIRST ' POPTN   7                                           CSD031
     C           SDBANK    PARM SDBANK    DSFDY                                               CSD031
      *                                                                                       CSD031
     C           PRTCD     IFNE *BLANK                                                        CSD031
     C                     MOVEL'SDBANKPD'DBFILE                                              CSD031
     C                     Z-ADD3         DBASE                                               CSD031
     C                     EXSR *PSSR                                                         CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C                     MOVE *INU5     *IN06                                               CSD031
     C**                                                                  S01117
     C*
     C**  CHECK IF SYSTEM SETUP FLAG IS ON
     C*
     C***********SFLG      COMP 1                        57               S01117
     C           SSF       COMP 'Y'                      57               S01117
     C*
     C**  SETUP BLANK AND ZERO FIELDS.
     C*
     C                     MOVE ' '       BLANKS150
     C                     Z-ADD0         ZERO05  50
     C*
     C**  SET UP CONSTANT FOR ACCOUNT CODES KEY.
     C*
     C***********          MOVE '1'       ACODKY  5                       S01117
     C*
     C/COPY WNCPYSRC,SE0110C001
     C           ENDFC     TAG                             ** ENDFC TAG **
     C*                                                                   S01117
     C**  Query selection on input fields                                 S01117
     C*                                                                   S01117
     C           RDSPLY    IFEQ 'Y'                                       S01117
     C                     GOTO INSAMD                                    S01117
     C                     END                                            S01117
     C*
     C**  RESET INDICATORS.
     C*
     C                     SETOF                     404142
     C                     SETOF                     434455
     C                     SETOF                     566061
     C                     SETOF                     626379
     C                     SETOF                     808182
     C                     SETOF                     21
     C                     SETOF                     657074
     C                     SETOF                     757778
     C                     SETOF                     464748
     C                     SETOF                     495051
     C                     SETOF                     909192
     C                     SETOF                     939495
     C                     SETOF                     080913                                   CSD031
     C                     SETOF                     7311                                     CSD031
     C                     SETOF                     97                                     BUG13070
     C/COPY WNCPYSRC,SE0110C002
     C*
     C                     SETON                     8384
     C*
     C**  CLEAR ERROR OUTPUT AREA AND WORKFIELD.
     C*
     C                     MOVE BLANKS    ERCD
     C                     MOVE *BLANKS   ERMSG                                               CSD031
     C                     Z-ADD0         S       20
     C*
     C**  RESET LAST UPDATE DATA FIELDS FOR NEW TRANSACTION.
     C*
     C   01                Z-ADD0         LCDS
     C   01                MOVE ' '       CHTPS
     C   01                Z-ADD0         TNLUS
     C*
     C**  HANDLE INPUT AND TAKE APPROPRIATE ACTION.
     C*
     C**  COMMAND KEY TESTS, SET WRKSTN CONTROL INDS. AS REQUIRED.
     C*
     C           CSD036    IFEQ 'Y'                                                           CSD031
     C           *INKK     ANDEQ*ON                                                           CSD031
     C           *INU5     ANDEQ*OFF                                                          CSD031
     C                     EXSR SRBLSF                                                        CSD031
     C                     SETOF                     20                                       CSD031
     C   KK                GOTO SFOUT                                                         CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C   KC                SETON                     40
     C   KC                GOTO ENDD                       END OF JOB
     C*
     C   KL                GOTO SFOUT                      SCREEN SF REQ.
     C*
     C   KJ 04             GOTO UDLOG                      DELETE RECORD
     C*
     C**  INVALID KEY OR INVALID COMMAND KEY FOR SCREEN TYPE TESTS.
     C*
     C   04
     COR KJN04             SETON                     4243
     C   42                SETOF                     8420
     C   42N01             SETON                     80
     C   42 01             SETON                     81
     C   42N02N03          SETON                     82
     C***42*****           MOVE ERRMSG,4  ERMSG  47                                           CSD031
     C   42                MOVELERRMSG,4  ERMSG  76                                           CSD031
     C***42*04**           MOVE ERRMSG,5  ERMSG                                               CSD031
     C   42 04             MOVELERRMSG,5  ERMSG                                               CSD031
     C   42                GOTO SCNOUT
     C*
     C**  ACTION SCREEN TYPE.
     C*
     C   01                GOTO INITAL
     C   02
     COR 03                GOTO INSAMD
     C*
     C**  FIRST CYCLE BLANK SCREEN, 'SE' SCREEN OR F/12 INPUT,
     C**  OUTPUT INITIAL SCREEN, ID SF.
     C*
     C           SFOUT     TAG                             ** SFOUT TAG **
     C                     SETON                     404181
     C                     SETON                     82
     C   KL                SETOF                     20
     C                     GOTO SCNOUT
     C*
     C**  HANDLE INITIAL SCREEN, TYPE SF.
     C*
     C           INITAL    TAG                             ** INITAL TAG *
     C*
     C**  VALIDATE ACTION CODE.
     C*
     C           ACTCD     COMP 'I'                      52INSERT
     C           ACTCD     COMP 'A'                      53AMEND
     C           ACTCD     COMP 'D'                      54DELETE
     C  N52N53N54ACTCD     COMP 'E'                  565655ENQUIRY
      *                                                                                       CSD031
     C           CSD036    IFEQ 'Y'                                                           CSD031
     C           *INU5     ANDEQ*OFF                                                          CSD031
     C           ACTCD     ANDEQ'I'                                                           CSD031
     C                     SETON                     56                                       CSD031
     C                     ENDIF                                                              CSD031
     C*
     C**  SET ERROR CODE, MESSAGE AND WRKSTN CONTROL INDICATORS
     C*
     C  N56N57
     CORN56 57N54          GOTO AKEYV
     C                     Z-ADD1         S
     C                     MOVE '001'     ERCD,S
     C   54                MOVE '002'     ERCD,S
     C   54                SETON                     56
     C**********           MOVE ERRMSG,1  ERMSG                                               CSD031
     C                     MOVELERRMSG,1  ERMSG                                               CSD031
     C                     SETON                     428182
     C                     SETOF                     8384
     C                     GOTO SCNOUT
     C*
     C**  ENSURE ACCOUNT KEY FOR INSERT CONTAINS NO INVALID CHARACTERS .
     C*
     C           AKEYV     TAG                             ** AKEYV TAG **
      *                                                                                       CSD031
      ** Change the job switch of *INU1 temporarily to process the correct                    CSD031
      ** files for authorization.                                                             CSD031
      *                                                                                       CSD031
     C           CSD036    IFEQ 'Y'                                                           CSD031
     C           *INU5     IFEQ *ON                                                           CSD031
     C                     MOVE OVRC,2    PCMD                                                CSD031
     C                     ELSE                                                               CSD031
     C                     MOVE OVRC,3    PCMD                                                CSD031
     C                     ENDIF                                                              CSD031
     C                     Z-ADD20        PLEN                                                CSD031
     C                     CALL 'QCMDEXC'                                                     CSD031
     C                     PARM           PCMD                                                CSD031
     C                     PARM           PLEN                                                CSD031
     C                     ENDIF                                                              CSD031
     C*                                                                   S01117
     C**   IF SINGLE BRANCH ENVIRONMENT                                   S01117
     C*                                                                   S01117
     C           MBIN      IFNE 'Y'                                       S01117
     C                     CALL 'ZVACTU'                                  S01117
     C                     PARM ACTCD     @ZACTN  1                       S01117
     C                     PARM           @ERR    10                      S01117
     C**                                                                  S01117
     C           @ERR      IFNE *ZERO                                     S01117
     C                     SETON                     56                   S01117
     C**********           MOVE ERRMSG,7  ERMSG                                        S01117 CSD031
     C                     MOVELERRMSG,7  ERMSG                                               CSD031
     C                     SETON                     428182               S01117
     C                     SETOF                     8384                 S01117
     C                     GOTO SCNOUT                                    S01117
     C                     END                                            S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C**   IF MULTIBRANCHING ENVIRONMENT                                  S01117
     C*                                                                   S01117
     C                     CALL 'ZVACTBU'                                 S01117
     C                     PARM ACTCD     @ZACTN  1                       S01117
     C                     PARM USRBCH    @ZBR    3                       S01117
     C                     PARM           @ERR    10                      S01117
     C**                                                                  S01117
     C           @ERR      IFNE *ZERO                                     S01117
     C                     SETON                     56                   S01117
     C**********           MOVE ERRMSG,7  ERMSG                                        S01117 CSD031
     C                     MOVELERRMSG,7  ERMSG                           S01117              CSD031
     C                     SETON                     428182               S01117
     C                     SETOF                     8384                 S01117
     C                     GOTO SCNOUT                                    S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C**                                                                  S01117
      *                                                                                       CSD031
      ** Bring back the old job switch                                                        CSD031
      *                                                                                       CSD031
     C           CSD036    IFEQ 'Y'                                                           CSD031
     C           *INU5     IFEQ *ON                                                           CSD031
     C                     Z-ADD20        PLEN                                                CSD031
     C                     MOVE OVRC,3    PCMD                                                CSD031
     C                     CALL 'QCMDEXC'                                                     CSD031
     C                     PARM           PCMD                                                CSD031
     C                     PARM           PLEN                                                CSD031
     C                     ENDIF                                                              CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C   20                SETON                     21
     C   20                GOTO AKEYER
     C*
     C                     Z-ADD0         C       20
     C           CHEK      TAG                             ** CHEK TAG **
     C           C         ADD  1         C
     C           ACKY,C    LOKUPCHAR                     89
     C  N89                SETON                     2060
     C   20                SETON                     21
     C   20                GOTO AKEYER
     C           C         COMP 20                     89
     C   89                GOTO CHEK
     C*
     C**  DETERMINE IF INSERT ALREADY ON FILE
     C**  OR AMEND/DELETE/ENQUIRY NOT ON FILE.
     C*
     C           AKEYV2    TAG                             ** AKEYV2 TAG *
     C                     EXSR ACKCHN
     C/COPY WNCPYSRC,SE0110C003
     C                     MOVEA*BLANKS   SACD
     C                     MOVEA*BLANKS   SNCD
     C                     MOVEA*BLANKS   SPRF
     C                     MOVE *BLANKS   SEDTE                                               CSD031
     C                     MOVE *BLANKS   SAZON                                               CSD031
     C*
     C**  OUTPUT IF RECORD FOUND
     C*
     C           *IN69     IFEQ '0'
     C                     EXCPT
     C*
     C**  SAVE LAST UPDATE DATA, USING DATA STRUCTURE.
     C*
     C                     MOVE LSTC      LSTCS
     C*
     C           RECI      IFEQ '*'
     C                     SETON                     69
     C                     ELSE
     C                     MOVE ACD1      SACD,1
     C*********************MOVE NCD1      SNCD,1                          E23957
     C                     MOVE NCDA1     SNCD,1                          E23957
     C                     MOVE PRF1      SPRF,1
     C                     MOVE ACD2      SACD,2
     C*********************MOVE NCD2      SNCD,2                          E23957
     C                     MOVE NCDA2     SNCD,2                          E23957
     C                     MOVE PRF2      SPRF,2
     C                     MOVE ACD3      SACD,3
     C*********************MOVE NCD3      SNCD,3                          E23957
     C                     MOVE NCDA3     SNCD,3                          E23957
     C                     MOVE PRF3      SPRF,3
     C                     MOVE ACD4      SACD,4
     C*********************MOVE NCD4      SNCD,4                          E23957
     C                     MOVE NCDA4     SNCD,4                          E23957
     C                     MOVE PRF4      SPRF,4
     C                     MOVE ACD5      SACD,5
     C*********************MOVE NCD5      SNCD,5                          E23957
     C                     MOVE NCDA5     SNCD,5                          E23957
     C                     MOVE PRF5      SPRF,5
     C                     MOVE ACD6      SACD,6
     C*********************MOVE NCD6      SNCD,6                          E23957
     C                     MOVE NCDA6     SNCD,6                          E23957
     C                     MOVE PRF6      SPRF,6
      *                                                                                       CSD031
     C           CSD036    IFEQ 'Y'                                                           CSD031
     C           *INU5     IFEQ *ON                                                           CSD031
     C                     MOVE AACC      SAZON                                               CSD031
     C                     ELSE                                                               CSD031
     C                     MOVE *ON       *IN10                                               CSD031
     C                     MOVE GPDT      SAZON                                               CSD031
     C                     ENDIF                                                              CSD031
     C           EACC      IFNE 0                                                             CSD031
     C                     Z-ADDEACC      ZDAYNO                                              CSD031
     C                     EXSR SRDAT2                                                        CSD031
     C                     MOVE ZDATE     SEDTE                                               CSD031
     C                     ENDIF                                                              CSD031
     C                     ENDIF                                                              CSD031
     C/COPY WNCPYSRC,SE0110C004
     C           ACD1      COMP *ZERO                2222
     C           ACD2      COMP *ZERO                2323
     C           ACD3      COMP *ZERO                2424
     C           ACD4      COMP *ZERO                2525
     C           ACD5      COMP *ZERO                2626
     C           ACD6      COMP *ZERO                2727
     C***********NCD1      COMP *ZERO                    28               E23957
     C***********NCD2      COMP *ZERO                    29               E23957
     C***********NCD3      COMP *ZERO                    30               E23957
     C***********NCD4      COMP *ZERO                    31               E23957
     C***********NCD5      COMP *ZERO                    32               E23957
     C***********NCD6      COMP *ZERO                    33               E23957
     C           NCDA1     COMP *ZERO                    28               E23957
     C           NCDA2     COMP *ZERO                    29               E23957
     C           NCDA3     COMP *ZERO                    30               E23957
     C           NCDA4     COMP *ZERO                    31               E23957
     C           NCDA5     COMP *ZERO                    32               E23957
     C           NCDA6     COMP *ZERO                    33               E23957
     C           PRF1      COMP *ZERO                3434
     C           PRF2      COMP *ZERO                3535
     C           PRF3      COMP *ZERO                3636
     C           PRF4      COMP *ZERO                3737
     C           PRF5      COMP *ZERO                3838
     C           PRF6      COMP *ZERO                3939
     C                     END
     C                     END
     C*
     C**  CHECK VALID ACTION CODE. IE 'I' AND RECORD DOES NOT EXIST OR
     C**  'A' 'D' OR 'E' AND RECORD ALREADY EXISTS
     C*
     C   52N69
     COR 53 69
     COR 54 69
     COR 55 69             SETON                     20
     C           CSD036    IFEQ 'Y'                                                           CSD031
     C           *INU5     ANDEQ*OFF                                                          CSD031
     C           *IN20     ANDEQ*OFF                                                          CSD031
     C                     EXSR CHKACD                                                        CSD031
     C                     ENDIF                                                              CSD031
     C  N20                GOTO SFOK
     C*
     C**  SET ERROR CODE, MESSAGE AND WRKSTN CONTROL INDICATORS.
     C*
     C           AKEYER    TAG                             ** AKEYER TAG *
     C                     Z-ADD1         S
     C                     MOVE '004'     ERCD,S
     C**********           MOVE ERRMSG,2  ERMSG                                               CSD031
     C                     MOVELERRMSG,2  ERMSG                                               CSD031
     C   52                MOVE '003'     ERCD,S
     C***52*****           MOVE ERRMSG,3  ERMSG                                               CSD031
     C   52                MOVELERRMSG,3  ERMSG                                               CSD031
     C   21                MOVE '005'     ERCD,S
     C***21*****           MOVE ERRMSG,5  ERMSG                                               CSD031
     C   21                MOVELERRMSG,5  ERMSG                                               CSD031
     C   73                MOVEL'CSD0002' MSGDNB                                              CSD031
     C   73                MOVELWMSGQ     MSGNM                                               CSD031
     C   73                EXSR SRRTTX                                                        CSD031
     C   73                MOVELMSGTXT    ERMSG                                               CSD031
     C                     SETON                     428182
     C                     SETOF                     83
     C                     SETOF                     84
     C                     GOTO SCNOUT
     C*
     C**  VALID ACTION CODE AND ACCOUNT KEY FOUND.
     C*
     C           SFOK      TAG                             ** SFOK TAG **
     C*
     C**  SET WRKSTN CONTROL INDICATORS.
     C*
     C                     SETON                     4280
     C  N52                SETON                     44
     C  N52N53             SETON                     82
     C                     GOTO SCNOUT
     C*
     C**  HANDLE INSERTIONS AND AMENDMENTS.
     C*
     C           INSAMD    TAG                             ** INSAMD TAG *
     C*                                                                   S01117
     C**  Test query selection on input fields                            S01117
     C*                                                                   S01117
     C                     EXSR D1QRY                                     S01117
     C           RDSPLY    IFEQ 'Y'                                       S01117
     C                     MOVE '1'       *IN42                           S01117
     C                     MOVE '1'       *IN44                           S01117
     C           SPRF,1    IFNE ' '                                       S01117
     C                     MOVE '1'       *IN34                           S01117
     C                     END                                            S01117
     C           SPRF,2    IFNE ' '                                       S01117
     C                     MOVE '1'       *IN35                           S01117
     C                     END                                            S01117
     C           SPRF,3    IFNE ' '                                       S01117
     C                     MOVE '1'       *IN36                           S01117
     C                     END                                            S01117
     C           SPRF,4    IFNE ' '                                       S01117
     C                     MOVE '1'       *IN37                           S01117
     C                     END                                            S01117
     C           SPRF,5    IFNE ' '                                       S01117
     C                     MOVE '1'       *IN38                           S01117
     C                     END                                            S01117
     C           SPRF,6    IFNE ' '                                       S01117
     C                     MOVE '1'       *IN39                           S01117
     C                     END                                            S01117
     C                     GOTO SCNOUT                                    S01117
     C                     ELSE                                           S01117
     C                     MOVE '0'       *IN42                           S01117
     C                     END                                            S01117
     C*
     C**  LOOP TO VALIDATE INPUT DATA.
     C*
     C                     Z-ADD0         C
     C*
     C           CHECK     TAG                             ** CHECK TAG **
     C           C         ADD  1         C
     C           C         MULT 3         ER      20
     C*
     C**  VALIDATE ACCOUNT CODES - OPTIONAL.
     C*
     C********** SACD,C    COMP '    '                   89                                   CGL029
     C           SACD,C    COMP *BLANK                   89                                   CGL029
     C*
     C**  IS POSTING REFERENCE 2.
     C*
     C           SPRF,C    COMP '2'                      64
     C   89                GOTO NARR
     C*
     C**  MUST NOT BE ENTERED IF POSTING REFERENCE EQUALS 2.
     C*
     C   64                GOTO ACER
     C***********          MOVELSACD,C    ACODKY                          S01117
     C***********          MOVEL'30'      TABKEY                          S01117
     C***********          MOVE ACODKY    TABKEY 12                       S01117
     C***********          EXSR TABCHN                                    S01117
     C**********           MOVELSACD,C    ACODKY  4                                    S01117 CGL029
     C                     MOVELSACD,C    ACODKY 10                                           CGL029
     C           CSD036    IFEQ 'Y'                                                           CSD031
     C           *INU5     ANDEQ*ON                                                           CSD031
     C                     CALL 'AOGACDR0'                                                    CSD031
     C                     PARM *BLANKS   @RTCD                                               CSD031
     C                     PARM '*KEY   ' @OPTN                                               CSD031
     C                     PARM ACODKY    @ACCD                                               CSD031
     C           GPACOD    PARM GPACOD    DSSDY                                               CSD031
     C                     ELSE                                                               CSD031
     C                     CALL 'AOACODR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C**********           PARM ACODKY    @ACCD   4                                    S01117 CGL029
     C                     PARM ACODKY    @ACCD  10                                           CGL029
     C********** SDACOD    PARM SDACOD    DSFDY                                        S01117 CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
     C                     ENDIF                                                              CSD031
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE '1'       *IN76                           S01117
     C                     ELSE                                           S01117
     C                     MOVE '0'       *IN76                           S01117
     C                     END                                            S01117
     C   76                GOTO ACER                                      S01117
     C*
     C**  ACCOUNT MUST NOT BE TITLE-ONLY
     C*
     C***********TITO      COMP 'Y'                  6767                 S01117
     C           CSD036    IFEQ 'Y'                                                           CSD031
     C           ACTOIN    COMP 'Y'                  6767                                     CSD031
     C                     ELSE                                                               CSD031
     C           A5TOIN    COMP 'Y'                  6767                 S01117
     C                     ENDIF                                                              CSD031
     C   67                GOTO NARR
     C*
     C           ACER      TAG                             ** ACER TAG ***
     C  N76 67             GOTO NARR                                      S01117
     C*
     C                     SETON                     61    ERROR
     C           C         IFEQ 1
     C                     SETON                     65
     C                     END
     C           C         IFEQ 2
     C                     SETON                     70
     C                     END
     C           C         IFEQ 3
     C                     SETON                     74
     C                     END
     C           C         IFEQ 4
     C                     SETON                     75
     C                     END
     C           C         IFEQ 5
     C                     SETON                     77
     C                     END
     C           C         IFEQ 6
     C                     SETON                     78
     C                     END
     C           ER        ADD  3         ERR     30
     C           S         ADD  1         S
     C                     MOVE ERR       ERCD,S
     C*
     C**  VALIDATE NARRATIVE CODE - MUST BE ON TABLE FILE IF
     C**  RELATED ACCOUNT CODE ENTERED.
     C**  IF POSTING REFERENCE 2, MUST BE ENTERED.
     C**  ELSE IF ACCOUNT CODE BLANK, MUST BE BLANK.
     C*
     C           NARR      TAG                             ** NARR TAG ***
     C           SNCD,C    COMP '  '                     88
     C   89N88N64
     COR 89 88 64          GOTO NARERR
     C   89 88             GOTO POST
     C*
     C**  MUST BE IN RANGE 01-50 OR ALPHABETIC-NUMERIC
     C**  COMBINATION 0A,A0 ETC
     C*
     C                     MOVE SNCD,C    SNCDC
     C                     SETOF                     668687
     C***********NCDCH1    COMP '0'                  86  86               093975
     C***********NCDCH2    COMP '0'                  87  87               093975
     C*
     C**N86N87***          SETON                     66                   093975
     C***86*87***SNCDC     COMP '00'                   66                 093975
     C***86*87N66SNCDC     COMP '50'                 66                   093975
     C           NCDCH1    IFEQ ' '                                                         MD039572
     C           NCDCH2    OREQ ' '                                                         MD039572
     C                     SETON                     66                                     MD039572
     C                     ENDIF                                                            MD039572
     C   66                GOTO NARERR
     C***********          MOVE BLANKS    TABKEY                          S01117
     C***********          MOVEL'90'      TABKEY                          S01117
     C***********          MOVE SNCD,C    TABKEY                          S01117
     C**N88******          EXSR TABCHN                                    S01117
     C                     MOVE SNCD,C    NAVT    2                       S01117
     C                     CALL 'AONARRR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C***********          PARM '*FIRST ' @OPTN   7                 S01117093975
     C                     PARM '*KEY   ' @OPTN   7                       093975
     C                     PARM NAVT      @NVCD   2                       S01117
     C           SDNARR    PARM SDNARR    DSFDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE '1'       *IN76                           S01117
     C                     ELSE                                           S01117
     C                     MOVE '0'       *IN76                           S01117
     C                     END                                            S01117
     C  N76N88             GOTO POST
     C*
     C           NARERR    TAG                             ** NARERR TAG *
     C           C         IFEQ 1
     C                     SETON                     46
     C                     END
     C           C         IFEQ 2
     C                     SETON                     47
     C                     END
     C           C         IFEQ 3
     C                     SETON                     48
     C                     END
     C           C         IFEQ 4
     C                     SETON                     49
     C                     END
     C           C         IFEQ 5
     C                     SETON                     50
     C                     END
     C           C         IFEQ 6
     C                     SETON                     51
     C                     END
     C                     SETON                     62    ERROR
     C           ER        ADD  4         ERR
     C           S         ADD  1         S
     C                     MOVE ERR       ERCD,S
     C*
     C**  VALIDATE POSTING REF - MUST BE 1, 2, 3, 4 OR 5 IF RELATED
     C**  ACCOUNT CODE ENTERED, MUST BE BLANK OR 2 IF A/C CODE BLANK.
     C*
     C           POST      TAG                             ** POST TAG ***
     C*
     C           SPRF,C    COMP ' '                      88
     C/COPY WNCPYSRC,SE0110C005
     C   89 64                                             POST.REF.2
     COR 89 88             GOTO PASS                       POST.REF.BLANK
     C/COPY WNCPYSRC,SE0110C006
     C*
     C**  MUST BE BLANK OR 2 IF A/C CODE BLANK.
     C*
     C   89N88             GOTO SPRERR
     C           SPRF,C    COMP '1'                    89
     C/COPY WNCPYSRC,DUG501_002                                                               DUG501
     C  N89      SPRF,C    COMP '5'                  89
     C*
     C/COPY WNCPYSRC,SE0110C007
     C  N89                GOTO PASS
     C/COPY WNCPYSRC,SE0110C008
     C*
     C           SPRERR    TAG                             ** SPRERR TAG *
     C*
     C           C         IFEQ 1
     C                     SETON                     90
     C                     END
     C           C         IFEQ 2
     C                     SETON                     91
     C                     END
     C           C         IFEQ 3
     C                     SETON                     92
     C                     END
     C           C         IFEQ 4
     C                     SETON                     93
     C                     END
     C           C         IFEQ 5
     C                     SETON                     94
     C                     END
     C           C         IFEQ 6
     C                     SETON                     95
     C                     END
     C                     SETON                     63    ERROR
     C           ER        ADD  5         ERR
     C           S         ADD  1         S
     C                     MOVE ERR       ERCD,S
     C*
     C/COPY WNCPYSRC,SE0110C009
     C           PASS      TAG                             ** PASS TAG ***
     C*
     C           C         COMP 6                      89
     C   89                GOTO CHECK
      *                                                                                       CSD031
      **  Called from central level                                                           CSD031
      *                                                                                       CSD031
     C           *INU5     IFEQ *ON                                                           CSD031
      *                                                                                       CSD031
      **  Accept to Zone must be 'Y' or 'N'                                                   CSD031
      *                                                                                       CSD031
     C           SAZON     IFEQ *BLANKS                                                       CSD031
     C                     MOVEL'N'       SAZON                                               CSD031
     C                     ELSE                                                               CSD031
     C           SAZON     IFNE 'Y'                                                           CSD031
     C           SAZON     ANDNE'N'                                                           CSD031
     C                     ADD  1         S                                                   CSD031
     C                     MOVE '024'     ERCD,S                                              CSD031
     C                     SETON                     0861                                     CSD031
     C                     ENDIF                                                              CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
      ** Validate effective date                                                              CSD031
      *                                                                                       CSD031
     C                     EXSR SRVLED                                                        CSD031
     C                     ENDIF                                                              CSD031
     C*
     C**  IF DATA VALID, GO TO UPDATE & LOG.
     C*
     C/COPY WNCPYSRC,SE0110C010
     C  N61N62N63          GOTO UDLOG
     C/COPY WNCPYSRC,SE0110C011
     C*
     C**  DATA INVALID - SET WRKSTN CONTROL INDICATORS.
     C*
     C                     SETON                     424380
     C                     SETOF                     83
     C                     GOTO SCNOUT
     C*
     C**  CALCULATIONS TO UPDATE TABLE FILE.
     C*
     C           UDLOG     TAG                             ** UDLOG TAG **
      *                                                                                       CSD031
      ** If called from central level                                                         CSD031
      ** Cannot delete if Accept to Zone = "Y"                                                CSD031
      *                                                                                       CSD031
     C           *INU5     IFEQ *ON                                                           CSD031
     C           SEDTE     IFEQ *BLANKS                                                       CSD031
     C                     Z-ADD0         WEACC   50                                          CSD031
     C                     ELSE                                                               CSD031
     C                     MOVE SEDTE     ZDATE                                               CSD031
     C                     EXSR SRDATE                                                        CSD031
     C                     Z-ADDZDAYNO    WEACC                                               CSD031
     C                     ENDIF                                                              CSD031
     C           *INKJ     IFEQ *ON                                                           CSD031
      *                                                                                       CSD031
      ** Cannot delete if Accept to Zone = 'Y                                                 CSD031
      *                                                                                       CSD031
     C           SAZON     IFEQ 'Y'                                                           CSD031
     C                     ADD  1         S                                                   CSD031
     C                     MOVE '027'     ERCD,S                                              CSD031
     C                     MOVELC31MSG,2  ERMSG                                               CSD031
     C                     SETON                     084282                                   CSD031
     C                     SETON                     80                                       CSD031
     C                     SETOF                     84                                       CSD031
     C                     GOTO SCNOUT                                                        CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C                     ENDIF                                                              CSD031
     C                     ENDIF                                                              CSD031
     C*
     C**  IF A DATABASE ERROR IS FOUND INDICATORS
     C**  ARE SET TO - REFLECT THE ERROR CONDITION, RELEASE
     C**  FILES, RELEASE THE SCREEN AND TO END THE PROGRAM.
     C*
     C**  CHECK STATUS OF RECORD UNCHANGED.
     C*
     C                     EXSR ACKCHN
     C*
     C   69                Z-ADD0         LCD
     C   69                MOVE ' '       CHTP
     C   69                Z-ADD0         TNLU
     C*
     C           LSTC      COMP LSTCS                7979
     C           INFTAG    TAG                             ** INFTAG TAG**
     C*
     C**  IF RECORD CHANGED, RELEASE FILES, SET ERROR MESSAGE,
     C**  SET SCREEN CONTROL INDICATORS AND BYPASS.
     C*
     C   79N69             EXCPT
     C***79*****           MOVE ERRMSG,6  ERMSG                                               CSD031
     C   79                MOVELERRMSG,6  ERMSG                                               CSD031
     C   79                SETON                     428082
     C   79N69             SETON                     44
     C   79                SETOF                     84
     C   79 03 69          SETOF                     82
     C*
     C**  SAVE LAST UPDATE DATA IF FURTHER ACTION ALLOWED
     C*
     C   79 69N02          MOVE LSTC      LSTCS
     C*
     C   79                GOTO SCNOUT
     C*
     C**  OBTAIN LAST TRANSACTION NUMBER  AND SET UP STANDARD OUTPUT
     C**  INFORMATION
     C*
     C                     EXSR ZTNLU1
     C                     MOVE 'SE'      MDID    2
     C                     MOVEL'SEACK '  PGMN    8
     C                     MOVE WSID      WSIDX   3
     C                     MOVE USRID     USRIDX 10
     C*
     C**  UPDATE/ADD ACCOUNT KEY RECORD.
     C*
     C                     EXSR TIME
     C*
     C**  MOVE SCREEN FIELDS TO FILE FIELDS
     C*
     C                     MOVE SAKEY     ACKE
     C                     MOVE SACD,1    ACD1
     C*********************MOVE SNCD,1    NCD1                            E23957
     C                     MOVE SNCD,1    NCDA1                           E23957
     C                     MOVE SPRF,1    PRF1
     C                     MOVE SACD,2    ACD2
     C*********************MOVE SNCD,2    NCD2                            E23957
     C                     MOVE SNCD,2    NCDA2                           E23957
     C                     MOVE SPRF,2    PRF2
     C                     MOVE SACD,3    ACD3
     C*********************MOVE SNCD,3    NCD3                            E23957
     C                     MOVE SNCD,3    NCDA3                           E23957
     C                     MOVE SPRF,3    PRF3
     C                     MOVE SACD,4    ACD4
     C*********************MOVE SNCD,4    NCD4                            E23957
     C                     MOVE SNCD,4    NCDA4                           E23957
     C                     MOVE SPRF,4    PRF4
     C                     MOVE SACD,5    ACD5
     C*********************MOVE SNCD,5    NCD5                            E23957
     C                     MOVE SNCD,5    NCDA5                           E23957
     C                     MOVE SPRF,5    PRF5
     C                     MOVE SACD,6    ACD6
     C*********************MOVE SNCD,6    NCD6                            E23957
     C                     MOVE SNCD,6    NCDA6                           E23957
     C                     MOVE SPRF,6    PRF6
      *                                                                                       CSD031
     C           CSD036    IFEQ 'Y'                                                           CSD031
     C           *INU5     ANDEQ*ON                                                           CSD031
     C   52                MOVE 'Y'       GPDT                                                CSD031
     C                     MOVE SAZON     AACC                                                CSD031
     C                     Z-ADDWEACC     EACC                                                CSD031
     C                     ENDIF                                                              CSD031
     C/COPY WNCPYSRC,SE0110C012
     C*
     C**  SET UP LAST CHANGE DATE, TYPE AND RECORD ID
     C*
     C           *IN04     IFEQ '1'
     C                     MOVE '*'       RECI
     C                     MOVE 'D'       CHTP
     C                     ELSE
     C           *IN03     IFEQ '1'
     C                     MOVE 'A'       CHTP
     C                     ELSE
     C                     MOVE 'I'       CHTP
     C                     END
     C                     MOVE 'D'       RECI
     C                     END
     C                     Z-ADDRUND      LCD
     C                     MOVELNATN      TNLU
     C   69                WRITESEACKDF
     C  N69                UPDATSEACKDF
      *                                                                                       CSD031
      **  Called from central level                                                           CSD031
      *                                                                                       CSD031
     C           *INU5     IFEQ *ON                                                           CSD031
     C                     EXSR SRSDTQ                                                        CSD031
     C                     GOTO ENDUPD                                                        CSD031
     C                     ENDIF                                                              CSD031
     C/COPY WNCPYSRC,SE0110C013
     C*
     C**  GET ACCOUNT KEYS HEADER RECORD READY FOR UPDATE.
     C*
     C           1         CHAINSEACKA               69
     C*
     C**  IF HEADER NOT FOUND, DATABASE ERROR.
     C*
     C           *IN69     IFEQ '1'
     C                     MOVEL'1'       *INU8
     C                     MOVEL'1'       *INU7            ***************
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVEL'02'      DBASE            **DB ERROR 01**S01117
     C                     Z-ADD2         DBASE            **DB ERROR 02**S01117
     C                     MOVEL'SEACK'   DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY
     C                     OUT  LDA                                       S01117
     C                     EXSR DSERR
     C                     EXSR *PSSR                                     S01117
     C                     GOTO ENDD
     C                     END
     C*
     C**  INCREMENT NO. & TYPE OF UPDATES.
     C*
     C***02***** SINS      ADD  1         SINS                                              BUG12646
     C***03***** SAMD      ADD  1         SAMD                                              BUG12646
     C***04***** SDEL      ADD  1         SDEL                                              BUG12646
     C   02      SINS10    ADD  1         SINS10                                            BUG12646
     C   03      SAMD10    ADD  1         SAMD10                                            BUG12646
     C   04      SDEL10    ADD  1         SDEL10                                            BUG12646
     C*                                                                   E13651
     C**  INCREMENT NO. OF LIVE RECORDS ON FILE                           E13651
     C*                                                                   E13651
     C***02******SLRB      ADD  SINS      NORE                      E13651E21672
     C***04******NORE      SUB  SDEL      NORE                      E13651E21672
     C********** SLRB      ADD  SINS      NORE                                       E21672 BUG12646
     C********** NORE      SUB  SDEL      NORE                                       E21672 BUG12646
     C********** SLRB10    ADD  SINS10    NORE                                     BUG12646 MD043337
     C           SLRB10    ADD  SINS10    NORE10                                            MD043337
     C********** NORE10    SUB  SDEL10    NORE                                     BUG12646 MD043337
     C           NORE10    SUB  SDEL10    NORE10                                            MD043337
     C*
     C**  UPDATE A/C KEY HEADER RECORD
     C*
     C                     EXSR TIME
     C                     UPDATSEACKAF
      *                                                                                       CSD031
     C           ENDUPD    TAG                                                                CSD031
     C*
     C**  END COMMITMENT CONTROL
     C*
     C           CMTTXT    COMIT
     C*
     C**  OUTPUT INITIAL SCREEN
     C*
     C                     SETON                     404181
     C                     SETON                     82
     C*
     C**  OBTAIN TIME FOR SCREEN DISPLAY.
     C*
     C           SCNOUT    TAG                             ** SCNOUT TAG *
     C                     EXSR TIME
     C*
     C           ENDD      TAG                             ** ENDD TAG **
      *
      *================================================================
      *  P R O G R A M   E N D                                        *
      *                                                               *
     C   KC
     COR U8                SETON                     LR
     C/COPY WNCPYSRC,SE0110C014
      *                                                               *
      *================================================================
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  ACKCHN  - SR TO RANDOM ACCESS ACCOUNT KEYS FILE.             *
     C*  CALLED BY: MAIN                                              *
     C*                                                               *
     C*****************************************************************
     C*
     C           ACKCHN    BEGSR                           *** ACKCHN ***
     C*
     C**  RANDOM ACCESS ACCOUNT KEYS FILE BY KEY.
     C*
     C           SAKEY     CHAINSEACKD               69
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C***********                                                     *   S01117
     C***TABCHN*SR.*TO*RANDOM*ACCESS*TABLE*FILE.******                *   S01117
     C***CALLED*BY:*MAIN******                                        *   S01117
     C***********                                                     *   S01117
     C*****************************************************************   S01117
     C***********                                                         S01117
     C***********TABCHN    BEGSR                           *** TABCHN *** S01117
     C***********                                                         S01117
     C****RANDOM*ACCESS*TABLE*FILE*BY*KEY.******                          S01117
     C***********                                                         S01117
     C****RESET*INDICATORS******                                          S01117
     C***********                                                         S01117
     C***********TABKEY    CHAINTABSDU               76                   S01117
     C************IN76     IFEQ '0'                                       S01117
     C***********RECI      ANDEQ'*'                                       S01117
     C***********          SETON                     76                   S01117
     C***********          END                                            S01117
     C***********                                                         S01117
     C***********          ENDSR                                          S01117
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  EXCPTN  - SR TO PERFORM EXCEPTION TIME OUTPUT                *
     C*            AND RESET EXCPTION CONTROL INDICATORS.             *
     C*  CALLED BY: DSERR                                             *
     C*                                                               *
     C*****************************************************************
     C*
     C           EXCPTN    BEGSR                           *** EXCPTN ***
     C*
     C**  EXCEPTION OUTPUT.
     C*
     C                     EXCPT
     C*
     C**  RESET INDICATORS.
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  DSERR -  SR TO SET INDICATORS TO RELEASE FILES AND WORKSTN   *
     C*  CALLED BY: MAIN                                              *
     C*                                                               *
     C*****************************************************************
     C*
     C           DSERR     BEGSR                           *** DSERR ***
     C*
     C                     SETON                     40
     C                     EXSR EXCPTN
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  TIME SR. TO OBTAIN TIME.                                     *
     C*  CALLED BY: MAIN                                              *
     C*                                                               *
     C*****************************************************************
     C*
     C           TIME      BEGSR                           *** TIME ***
     C*
     C                     TIME           MTIME   60
     C                     TIME           WTIME                                               CSD031
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  INFSR  - FILE EXCEPTION / ERROR HANDLING SUBROUTINE          *
     C*                                                               *
     C*****************************************************************
     C*
     C           INFSR     BEGSR                           *** INFSR ***
     C*
     C**  CHECK ERROR TYPE
     C*
     C           STATUS    IFEQ 01021
     C*
     C**  CHAIN FILE TO GET CURRENT DETAILS
     C*
     C           SAKEY     CHAINSEACKD               69
     C*
     C           *IN69     IFEQ '0'
     C*
     C**  ROLLBACK UPDATES ALREADY DONE
     C*
     C                     ROLBK
     C*
     C**  SET ON 'RECORD UPDATED BY ANOTHER WORKSTATION' INDICATOR
     C*
     C                     SETON                     79
     C*
     C**  RESET OTHER INDICATORS
     C*
     C                     MOVE '*DETC '  EXTTAG  6
     C*
     C                     ELSE
     C*
     C                     MOVE '*CANCL'  EXTTAG
     C                     END
     C*
     C                     ELSE
     C*
     C                     MOVE '*CANCL'  EXTTAG
     C                     END
     C*
     C                     ENDSREXTTAG
     C*
     C*****************************************************************   S01117
      /EJECT                                                              S01117
     C*****************************************************************   S01117
     C*                                                               *   S01117
     C*  D1QRY  - SUBROUTINE TO TEST QUERY SELECTION ON FIELDS        *   S01117
     C*                                                               *   S01117
     C*****************************************************************   S01117
     C*                                                                   S01117
     C           D1QRY     BEGSR                            ** D1QRY **   S01117
     C*                                                                   S01117
     C                     MOVE 'N'       RDSPLY  1                       S01117
     C*                                                                   S01117
     C**  Test query selection on Account code 1 field                    S01117
     C*                                                                   S01117
     C                     MOVELSACD,1    QMARK   1                       S01117
     C           QMARK     IFEQ '?'                                       S01117
     C                     MOVE 'Y'       RDSPLY                          S01117
     C           CSD036    IFEQ 'Y'                                                           CSD031
     C           *INU5     ANDEQ*ON                                                           CSD031
     C                     CALL 'AOGACDR0'                                                    CSD031
     C                     PARM *BLANKS   @RTCD                                               CSD031
     C                     PARM '*KEY   ' @OPTN                                               CSD031
     C                     PARM SACD,1    @ACCD                                               CSD031
     C           GPACOD    PARM GPACOD    DSSDY                                               CSD031
     C                     ELSE                                                               CSD031
     C                     CALL 'AOACODR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SACD,1    @ACCD                           S01117
     C********** SDACOD    PARM SDACOD    DSFDY                                        S01117 CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
     C                     ENDIF                                                              CSD031
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEL*BLANKS   SACD,1                          S01117
     C                     MOVE '0'       *IN22                           S01117
     C                     MOVE *BLANKS   SCFLD                                            BUG13070
     C                     MOVE *ON       *IN97                                            BUG13070
     C                     ELSE                                           S01117
     C                     MOVEL*BLANKS   SACD,1                          S01117
     C           CSD036    IFEQ 'Y'                                                           CSD031
     C           *INU5     ANDEQ*ON                                                           CSD031
     C                     MOVELACGACD    ACD1                                                CSD031
     C                     ELSE                                                               CSD031
     C                     MOVELA5ACCD    ACD1                            S01117
     C                     ENDIF                                                              CSD031
     C                     MOVE '1'       *IN22                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**  Test query selection on Narrative code 1 field                  S01117
     C*                                                                   S01117
     C                     MOVELSNCD,1    QMARK   1                       S01117
     C           QMARK     IFEQ '?'                                       S01117
     C                     MOVE 'Y'       RDSPLY  1                       S01117
     C                     CALL 'AONARRR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SNCD,1    @NVCD                           S01117
     C           SDNARR    PARM SDNARR    DSFDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEL*BLANKS   SNCD,1                          S01117
     C                     MOVE '1'       *IN28                           S01117
     C                     ELSE                                           S01117
     C                     MOVEL*BLANKS   SNCD,1                          S01117
     C                     MOVELALNVCD    NCDA1                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**  Test query selection on Account code 2 field                    S01117
     C*                                                                   S01117
     C                     MOVELSACD,2    QMARK                           S01117
     C           QMARK     IFEQ '?'                                       S01117
     C                     MOVE 'Y'       RDSPLY                          S01117
     C           CSD036    IFEQ 'Y'                                                           CSD031
     C           *INU5     ANDEQ*ON                                                           CSD031
     C                     CALL 'AOGACDR0'                                                    CSD031
     C                     PARM *BLANKS   @RTCD                                               CSD031
     C                     PARM '*KEY   ' @OPTN                                               CSD031
     C                     PARM SACD,2    @ACCD                                               CSD031
     C           GPACOD    PARM GPACOD    DSSDY                                               CSD031
     C                     ELSE                                                               CSD031
     C                     CALL 'AOACODR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SACD,2    @ACCD                           S01117
     C********** SDACOD    PARM SDACOD    DSFDY                                        S01117 CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
     C                     ENDIF                                                              CSD031
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEL*BLANKS   SACD,2                          S01117
     C                     MOVE '0'       *IN23                           S01117
     C                     MOVE *BLANKS   SCFLD                                            BUG13070
     C                     MOVE *ON       *IN97                                            BUG13070
     C                     ELSE                                           S01117
     C                     MOVEL*BLANKS   SACD,2                          S01117
     C           CSD036    IFEQ 'Y'                                                           CSD031
     C           *INU5     ANDEQ*ON                                                           CSD031
     C                     MOVELACGACD    ACD2                                                CSD031
     C                     ELSE                                                               CSD031
     C                     MOVELA5ACCD    ACD2                            S01117
     C                     ENDIF                                                              CSD031
     C                     MOVE '1'       *IN23                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**  Test query selection on Narrative code 2 field                  S01117
     C*                                                                   S01117
     C                     MOVELSNCD,2    QMARK   1                       S01117
     C           QMARK     IFEQ '?'                                       S01117
     C                     MOVE 'Y'       RDSPLY  1                       S01117
     C                     CALL 'AONARRR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SNCD,2    @NVCD                           S01117
     C           SDNARR    PARM SDNARR    DSFDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEL*BLANKS   SNCD,2                          S01117
     C                     MOVE '1'       *IN29                           S01117
     C                     ELSE                                           S01117
     C                     MOVEL*BLANKS   SNCD,2                          S01117
     C                     MOVELALNVCD    NCDA2                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*                                                                   S01117
     C**  Test query selection on Account code 3 field                    S01117
     C*                                                                   S01117
     C                     MOVELSACD,3    QMARK                           S01117
     C           QMARK     IFEQ '?'                                       S01117
     C                     MOVE 'Y'       RDSPLY                          S01117
     C           CSD036    IFEQ 'Y'                                                           CSD031
     C           *INU5     ANDEQ*ON                                                           CSD031
     C                     CALL 'AOGACDR0'                                                    CSD031
     C                     PARM *BLANKS   @RTCD                                               CSD031
     C                     PARM '*KEY   ' @OPTN                                               CSD031
     C                     PARM SACD,3    @ACCD                                               CSD031
     C           GPACOD    PARM GPACOD    DSSDY                                               CSD031
     C                     ELSE                                                               CSD031
     C                     CALL 'AOACODR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SACD,3    @ACCD                           S01117
     C********** SDACOD    PARM SDACOD    DSFDY                                        S01117 CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
     C                     ENDIF                                                              CSD031
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEL*BLANKS   SACD,3                          S01117
     C                     MOVE '0'       *IN24                           S01117
     C                     MOVE *BLANKS   SCFLD                                            BUG13070
     C                     MOVE *ON       *IN97                                            BUG13070
     C                     ELSE                                           S01117
     C                     MOVEL*BLANKS   SACD,3                          S01117
     C           CSD036    IFEQ 'Y'                                                           CSD031
     C           *INU5     ANDEQ*ON                                                           CSD031
     C                     MOVELACGACD    ACD3                                                CSD031
     C                     ELSE                                                               CSD031
     C                     MOVELA5ACCD    ACD3                            S01117
     C                     ENDIF                                                              CSD031
     C                     MOVE '1'       *IN24                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**  Test query selection on Narrative code 3 field                  S01117
     C*                                                                   S01117
     C                     MOVELSNCD,3    QMARK   1                       S01117
     C           QMARK     IFEQ '?'                                       S01117
     C                     MOVE 'Y'       RDSPLY  1                       S01117
     C                     CALL 'AONARRR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SNCD,3    @NVCD                           S01117
     C           SDNARR    PARM SDNARR    DSFDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEL*BLANKS   SNCD,3                          S01117
     C                     MOVE '1'       *IN30                           S01117
     C                     ELSE                                           S01117
     C                     MOVEL*BLANKS   SNCD,3                          S01117
     C                     MOVELALNVCD    NCDA3                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*                                                                   S01117
     C**  Test query selection on Account code 4 field                    S01117
     C*                                                                   S01117
     C                     MOVELSACD,4    QMARK   1                       S01117
     C           QMARK     IFEQ '?'                                       S01117
     C                     MOVE 'Y'       RDSPLY                          S01117
     C           CSD036    IFEQ 'Y'                                                           CSD031
     C           *INU5     ANDEQ*ON                                                           CSD031
     C                     CALL 'AOGACDR0'                                                    CSD031
     C                     PARM *BLANKS   @RTCD                                               CSD031
     C                     PARM '*KEY   ' @OPTN                                               CSD031
     C                     PARM SACD,4    @ACCD                                               CSD031
     C           GPACOD    PARM GPACOD    DSSDY                                               CSD031
     C                     ELSE                                                               CSD031
     C                     CALL 'AOACODR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SACD,4    @ACCD                           S01117
     C********** SDACOD    PARM SDACOD    DSFDY                                        S01117 CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
     C                     ENDIF                                                              CSD031
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEL*BLANKS   SACD,4                          S01117
     C                     MOVE '0'       *IN25                           S01117
     C                     MOVE *BLANKS   SCFLD                                            BUG13070
     C                     MOVE *ON       *IN97                                            BUG13070
     C                     ELSE                                           S01117
     C                     MOVEL*BLANKS   SACD,4                          S01117
     C           CSD036    IFEQ 'Y'                                                           CSD031
     C           *INU5     ANDEQ*ON                                                           CSD031
     C                     MOVELACGACD    ACD4                                                CSD031
     C                     ELSE                                                               CSD031
     C                     MOVELA5ACCD    ACD4                            S01117
     C                     ENDIF                                                              CSD031
     C                     MOVE '1'       *IN25                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**  Test query selection on Narrative code 4 field                  S01117
     C*                                                                   S01117
     C                     MOVELSNCD,4    QMARK   1                       S01117
     C           QMARK     IFEQ '?'                                       S01117
     C                     MOVE 'Y'       RDSPLY  1                       S01117
     C                     CALL 'AONARRR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SNCD,4    @NVCD                           S01117
     C           SDNARR    PARM SDNARR    DSFDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEL*BLANKS   SNCD,4                          S01117
     C                     MOVE '1'       *IN31                           S01117
     C                     ELSE                                           S01117
     C                     MOVEL*BLANKS   SNCD,4                          S01117
     C                     MOVELALNVCD    NCDA4                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**  Test query selection on Account code 5 field                    S01117
     C*                                                                   S01117
     C                     MOVELSACD,5    QMARK                           S01117
     C           QMARK     IFEQ '?'                                       S01117
     C                     MOVE 'Y'       RDSPLY                          S01117
     C           CSD036    IFEQ 'Y'                                                           CSD031
     C           *INU5     ANDEQ*ON                                                           CSD031
     C                     CALL 'AOGACDR0'                                                    CSD031
     C                     PARM *BLANKS   @RTCD                                               CSD031
     C                     PARM '*KEY   ' @OPTN                                               CSD031
     C                     PARM SACD,5    @ACCD                                               CSD031
     C           GPACOD    PARM GPACOD    DSSDY                                               CSD031
     C                     ELSE                                                               CSD031
     C                     CALL 'AOACODR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SACD,5    @ACCD                           S01117
     C********** SDACOD    PARM SDACOD    DSFDY                                        S01117 CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
     C                     ENDIF                                                              CSD031
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEL*BLANKS   SACD,5                          S01117
     C                     MOVE '0'       *IN26                           S01117
     C                     MOVE *BLANKS   SCFLD                                            BUG13070
     C                     MOVE *ON       *IN97                                            BUG13070
     C                     ELSE                                           S01117
     C                     MOVEL*BLANKS   SACD,5                          S01117
     C           CSD036    IFEQ 'Y'                                                           CSD031
     C           *INU5     ANDEQ*ON                                                           CSD031
     C                     MOVELACGACD    ACD5                                                CSD031
     C                     ELSE                                                               CSD031
     C                     MOVELA5ACCD    ACD5                            S01117
     C                     ENDIF                                                              CSD031
     C                     MOVE '1'       *IN26                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**  Test query selection on Narrative code 5 field                  S01117
     C*                                                                   S01117
     C                     MOVELSNCD,5    QMARK   1                       S01117
     C           QMARK     IFEQ '?'                                       S01117
     C                     MOVE 'Y'       RDSPLY  1                       S01117
     C                     CALL 'AONARRR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SNCD,5    @NVCD                           S01117
     C           SDNARR    PARM SDNARR    DSFDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEL*BLANKS   SNCD,5                          S01117
     C                     MOVE '1'       *IN32                           S01117
     C                     ELSE                                           S01117
     C                     MOVEL*BLANKS   SNCD,5                          S01117
     C                     MOVELALNVCD    NCDA5                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*                                                                   S01117
     C**  Test query selection on Account code 6 field                    S01117
     C*                                                                   S01117
     C                     MOVELSACD,6    QMARK                           S01117
     C           QMARK     IFEQ '?'                                       S01117
     C                     MOVE 'Y'       RDSPLY                          S01117
     C           CSD036    IFEQ 'Y'                                                           CSD031
     C           *INU5     ANDEQ*ON                                                           CSD031
     C                     CALL 'AOGACDR0'                                                    CSD031
     C                     PARM *BLANKS   @RTCD                                               CSD031
     C                     PARM '*KEY   ' @OPTN                                               CSD031
     C                     PARM SACD,6    @ACCD                                               CSD031
     C           GPACOD    PARM GPACOD    DSSDY                                               CSD031
     C                     ELSE                                                               CSD031
     C                     CALL 'AOACODR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SACD,6    @ACCD                           S01117
     C********** SDACOD    PARM SDACOD    DSFDY                                        S01117 CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
     C                     ENDIF                                                              CSD031
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEL*BLANKS   SACD,6                          S01117
     C                     MOVE '0'       *IN27                           S01117
     C                     MOVE *BLANKS   SCFLD                                            BUG13070
     C                     MOVE *ON       *IN97                                            BUG13070
     C                     ELSE                                           S01117
     C                     MOVEL*BLANKS   SACD,6                          S01117
     C           CSD036    IFEQ 'Y'                                                           CSD031
     C           *INU5     ANDEQ*ON                                                           CSD031
     C                     MOVELACGACD    ACD6                                                CSD031
     C                     ELSE                                                               CSD031
     C                     MOVELA5ACCD    ACD6                            S01117
     C                     ENDIF                                                              CSD031
     C                     MOVE '1'       *IN27                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**  Test query selection on Narrative code 6 field                  S01117
     C*                                                                   S01117
     C                     MOVELSNCD,6    QMARK   1                       S01117
     C           QMARK     IFEQ '?'                                       S01117
     C                     MOVE 'Y'       RDSPLY  1                       S01117
     C                     CALL 'AONARRR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SNCD,6    @NVCD                           S01117
     C           SDNARR    PARM SDNARR    DSFDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEL*BLANKS   SNCD,6                          S01117
     C                     MOVE '1'       *IN33                           S01117
     C                     ELSE                                           S01117
     C                     MOVEL*BLANKS   SNCD,6                          S01117
     C                     MOVELALNVCD    NCDA6                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C*****************************************************************
      /EJECT
     C*****************************************************************                       CSD031
     C*                                                               *                       CSD031
     C*  CHKACD  - SR TO PERFORM ADDITIONAL TESTING FOR               *                       CSD031
     C*            ACTION CODE.                                       *                       CSD031
     C*  CALLED BY: MAIN                                              *                       CSD031
     C*                                                               *                       CSD031
     C*****************************************************************                       CSD031
     C*                                                                                       CSD031
     C           CHKACD    BEGSR                                                              CSD031
     C                     SETOF                     73                                       CSD031
     C           ACTCD     IFEQ 'A'                                                           CSD031
     C           ACTCD     OREQ 'D'                                                           CSD031
     C           SAKEY     CHAINSDASAKL0             73                                       CSD031
     C           *IN73     IFEQ *OFF                                                          CSD031
     C                     SETON                     2073                                     CSD031
     C                     ENDIF                                                              CSD031
     C                     ENDIF                                                              CSD031
     C                     ENDSR                                                              CSD031
     C*                                                                                       CSD031
     C*****************************************************************                       CSD031
      /EJECT                                                                                  CSD031
     C*****************************************************************                       CSD031
     C*                                                               *                       CSD031
     C*  SRSDTQ  - SR TO SETUP DETAILS AND SEND MESSAGE TO DATA QUEUE *                       CSD031
     C*                                                               *                       CSD031
     C*  CALLED BY: MAIN                                              *                       CSD031
     C*                                                               *                       CSD031
     C*****************************************************************                       CSD031
     C*                                                                                       CSD031
     C           SRSDTQ    BEGSR                                                              CSD031
     C                     MOVELLCD       LCD2                                                CSD031
     C                     MOVELCHTP      CHTP2                                               CSD031
     C                     MOVELTNLU      TNLU2                                               CSD031
      *                                                                                       CSD031
      ** Set up parameters                                                                    CSD031
      *                                                                                       CSD031
     C                     MOVEL'GPSAKYPD'WPFNAM                                              CSD031
     C                     MOVELSAKEY     WKEYS                                               CSD031
     C                     MOVEL@1DBRC    WDATA                                               CSD031
     C                     MOVELWDTQ      PDQMSG                                              CSD031
     C           'SD'      CAT  'ACCPDTQ' PDQNAM                                              CSD031
      *                                                                                       CSD031
     C           *LOVAL    SETLLGPZONEL0                                                      CSD031
     C                     READ GPZONEL0                 90                                   CSD031
     C           *IN90     DOWEQ*OFF                                                          CSD031
     C           ZOMSYS    CAT  'DPLIB'   PDQLIB                                              CSD031
     C********** ZOMSYS    CAT  PGMB      PGMNAM 16                                    CSD031 CSC043
     C           ZOMSYS    CAT  PGMB      PGMNAM 17                                           CSC043
     C                     CALL PGMNAM                                                        CSD031
     C                     PARM           PDQNAM 10                                           CSD031
     C                     PARM           PDQLIB 10                                           CSD031
     C                     PARM           PDQMSG                                              CSD031
     C                     READ GPZONEL0                 90                                   CSD031
     C                     ENDDO                                                              CSD031
      *                                                                                       CSD031
     C                     ENDSR                                                              CSD031
      *                                                                                       CSD031
     C*****************************************************************                       CSD031
      /EJECT                                                                                  CSD031
     C*****************************************************************                       CSD031
     C*                                                               *                       CSD031
     C*  SRDATE - SR TO VALIDATE DATE                                 *                       CSD031
     C*                                                               *                       CSD031
     C*  CALLED BY: MAIN                                              *                       CSD031
     C*                                                               *                       CSD031
     C*****************************************************************                       CSD031
     C*                                                                                       CSD031
     C           SRDATE    BEGSR                                                              CSD031
     C                     CALL 'ZDATE1'                                                      CSD031
     C                     PARM *BLANKS   ZERR    7                                           CSD031
     C                     PARM           ZDATE   60                                          CSD031
     C                     PARM           BJDFIN                                              CSD031
     C                     PARM           ZDAYNO  50                                          CSD031
     C*                                                                                       CSD031
     C                     ENDSR                                                              CSD031
     C*                                                                                       CSD031
     C*                                                                                       CSD031
     C*****************************************************************                       CSD031
      /EJECT                                                                                  CSD031
     C*****************************************************************                       CSD031
     C*                                                               *                       CSD031
     C*  SRDAT2 - SR TO CONVERT DATE FOR DAY NUMBER TO SCREEN FORMAT  *                       CSD031
     C*                                                               *                       CSD031
     C*  CALLED BY: MAIN                                              *                       CSD031
     C*                                                               *                       CSD031
     C*****************************************************************                       CSD031
     C*                                                                                       CSD031
     C           SRDAT2    BEGSR                                                              CSD031
     C                     CALL 'ZDATE2'                                                      CSD031
     C                     PARM           ZDAYNO                                              CSD031
     C                     PARM           BJDFIN                                              CSD031
     C                     PARM           ZDATE                                               CSD031
     C                     PARM           ZADATE  7                                           CSD031
     C*                                                                                       CSD031
     C                     ENDSR                                                              CSD031
     C*                                                                                       CSD031
      *****************************************************************                       CSD031
      /EJECT                                                                                  CSD031
     C*****************************************************************                       CSD031
     C*                                                               *                       CSD031
     C*  SRBLSF - SR TO INITIALIZE AND BUILD SUBFILE                  *                       CSD031
     C*                                                               *                       CSD031
     C*  CALLED BY: MAIN                                              *                       CSD031
     C*                                                               *                       CSD031
     C*****************************************************************                       CSD031
      *                                                                                       CSD031
     C           SRBLSF    BEGSR                                                              CSD031
      *                                                                                       CSD031
     C                     MOVEL'N'       WEXIT   1                                           CSD031
     C                     MOVEL'N'       WERR    1                                           CSD031
     C                     MOVEL'N'       WF12    1                                           CSD031
     C                     MOVEL'Y'       WFIRST  1                                           CSD031
     C                     MOVE *BLANKS   WPREVF 20                                           CSD031
     C                     MOVE *BLANKS   SREVF                                               CSD031
     C                     MOVE *OFF      *IN58                                               CSD031
     C                     MOVE *OFF      *IN14                                               CSD031
      *                                                                                       CSD031
      ** Loop until F11 or F3 is pressed                                                      CSD031
      *                                                                                       CSD031
     C           WEXIT     DOUEQ'Y'                                                           CSD031
      *                                                                                       CSD031
      ** Clear subfile if not roll up and not error                                           CSD031
      *                                                                                       CSD031
     C           *IN58     IFEQ *OFF                                                          CSD031
     C           WERR      ANDEQ'N'                                                           CSD031
     C           WF12      ANDEQ'N'                                                           CSD031
     C                     EXSR SRCLSF                                                        CSD031
     C           SREVF     SETLLSDASAKL0                                                      CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
      ** Load subfile if not error                                                            CSD031
      *                                                                                       CSD031
     C           WERR      IFEQ 'N'                                                           CSD031
     C           WF12      ANDEQ'N'                                                           CSD031
     C                     EXSR SRLDSF                                                        CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
      ** If no details to display,set off display indicator                                   CSD031
      *                                                                                       CSD031
     C           WNOREC    IFEQ 'Y'                                                           CSD031
     C                     SETOF                     12                                       CSD031
     C                     ELSE                                                               CSD031
     C                     SETON                     12                                       CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
      ** Display screen                                                                       CSD031
      *                                                                                       CSD031
     C                     MOVE SREVF     WPREVF                                              CSD031
     C                     MOVE *OFF      *IN71                                               CSD031
     C                     EXSR SRDSSF                                                        CSD031
      *                                                                                       CSD031
      ** Process response                                                                     CSD031
      ** - F3,F11                                                                             CSD031
      *                                                                                       CSD031
     C                     SELEC                                                              CSD031
     C           *INKC     WHEQ *ON                                                           CSD031
     C           *INKK     OREQ *ON                                                           CSD031
     C                     MOVE 'Y'       WEXIT                                               CSD031
      *                                                                                       CSD031
      ** - F12, redisplay initial screen                                                      CSD031
      *                                                                                       CSD031
     C           *INKL     WHEQ *ON                                                           CSD031
     C                     SETOF                     14                                       CSD031
     C                     MOVE 'N'       WERR                                                CSD031
      *                                                                                       CSD031
      ** - Roll up/Selection for reviewer changed - rebuild page                              CSD031
      *                                                                                       CSD031
     C           *IN58     WHEQ *ON                                                           CSD031
     C           SREVF     ORNE WPREVF                                                        CSD031
      *                                                                                       CSD031
      ** Enter is pressed,validate action                                                     CSD031
      *                                                                                       CSD031
     C                     OTHER                                                              CSD031
     C           WNOREC    IFNE 'Y'                                                           CSD031
     C                     EXSR SRVLOP                                                        CSD031
      *                                                                                       CSD031
      ** If no error, process subfile                                                         CSD031
      *                                                                                       CSD031
     C           WERR      IFEQ 'N'                                                           CSD031
     C                     EXSR SRSFPR                                                        CSD031
     C           *INKC     IFEQ *ON                                                           CSD031
     C                     LEAVE                                                              CSD031
     C                     ENDIF                                                              CSD031
     C                     ENDIF                                                              CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C                     ENDSL                                                              CSD031
     C                     ENDDO                                                              CSD031
      *                                                                                       CSD031
     C                     ENDSR                                                              CSD031
      *****************************************************************                       CSD031
      /EJECT                                                                                  CSD031
     C*****************************************************************                       CSD031
     C*                                                               *                       CSD031
     C*  SRCLSF - SR TO CLEAR SUBFILE                                 *                       CSD031
     C*                                                               *                       CSD031
     C*  CALLED BY: SRBLSF                                            *                       CSD031
     C*                                                               *                       CSD031
     C*****************************************************************                       CSD031
     C*                                                                                       CSD031
     C           SRCLSF    BEGSR                                                              CSD031
     C                     SETOF                     5912                                     CSD031
     C                     WRITESE0110C1                                                      CSD031
     C                     SETON                     5912                                     CSD031
     C                     Z-ADD*ZERO     @@RRN                                               CSD031
     C                     ENDSR                                                              CSD031
     C*                                                                                       CSD031
      *****************************************************************                       CSD031
      /EJECT                                                                                  CSD031
     C*****************************************************************                       CSD031
     C*                                                               *                       CSD031
     C*  SRLDSF - SR TO LOAD SUBFILE                                  *                       CSD031
     C*                                                               *                       CSD031
     C*  CALLED BY: SRBLSF                                            *                       CSD031
     C*                                                               *                       CSD031
     C*****************************************************************                       CSD031
      *                                                                                       CSD031
     C           SRLDSF    BEGSR                                                              CSD031
      *                                                                                       CSD031
     C                     MOVE 'Y'       WNOREC  1                                           CSD031
     C                     Z-ADD0         WCOUNT  20                                          CSD031
     C                     MOVE *BLANKS   SOPT                                                CSD031
     C                     READ SDASAKL0                 72                                   CSD031
     C           *IN72     DOWEQ*OFF                                                          CSD031
     C           WCOUNT    ANDLT16                                                            CSD031
     C                     MOVE 'N'       WNOREC                                              CSD031
      *                                                                                       CSD031
      ** Account code                                                                         CSD031
      *                                                                                       CSD031
     C                     MOVE ACKE      SAKEY                                               CSD031
      *                                                                                       CSD031
      ** Effective date                                                                       CSD031
      *                                                                                       CSD031
     C           EACC      IFEQ 0                                                             CSD031
     C                     MOVE *BLANKS   SEFFDT                                              CSD031
     C                     ELSE                                                               CSD031
     C                     Z-ADDEACC      ZDAYNO                                              CSD031
     C                     EXSR SRDAT2                                                        CSD031
     C                     MOVE ZADATE    SEFFDT                                              CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
      ** Data action                                                                          CSD031
      *                                                                                       CSD031
     C                     SELEC                                                              CSD031
     C           CHTP      WHEQ 'A'                                                           CSD031
     C                     MOVE 'AMEND '  SACTN                                               CSD031
     C           CHTP      WHEQ 'I'                                                           CSD031
     C           CHTP      OREQ ' '                                                           CSD031
     C                     MOVE 'INSERT'  SACTN                                               CSD031
     C           CHTP      WHEQ 'D'                                                           CSD031
     C                     MOVE 'DELETE'  SACTN                                               CSD031
     C                     OTHER                                                              CSD031
     C                     MOVE *BLANKS   SACTN                                               CSD031
     C                     ENDSL                                                              CSD031
      *                                                                                       CSD031
     C                     ADD  1         WCOUNT                                              CSD031
     C                     ADD  1         @@RRN                                               CSD031
     C                     WRITESE0110S1                                                      CSD031
     C                     READ SDASAKL0                 72                                   CSD031
     C                     ENDDO                                                              CSD031
      *                                                                                       CSD031
      ** No details to display                                                                CSD031
      *                                                                                       CSD031
     C           WFIRST    IFEQ 'Y'                                                           CSD031
     C                     MOVE 'N'       WFIRST                                              CSD031
     C           WNOREC    IFEQ 'Y'                                                           CSD031
     C                     SETON                     11                                       CSD031
     C                     ENDIF                                                              CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C                     ENDSR                                                              CSD031
      *                                                                                       CSD031
     C*****************************************************************                       CSD031
      /EJECT                                                                                  CSD031
     C*****************************************************************                       CSD031
     C*                                                               *                       CSD031
     C*  SRDSSF - SR TO DISPLAY ACCOUNT KEYS ACCEPTANCE MAINTANCE     *                       CSD031
     C*           SUBFILE SCREEN                                      *                       CSD031
     C*                                                               *                       CSD031
     C*  CALLED BY: SRBLSF                                            *                       CSD031
     C*                                                               *                       CSD031
     C*****************************************************************                       CSD031
      *                                                                                       CSD031
     C           SRDSSF    BEGSR                                                              CSD031
      *                                                                                       CSD031
      ** Update screen time and write screen                                                  CSD031
      *                                                                                       CSD031
     C                     EXSR TIME                                                          CSD031
     C                     WRITESE0110F2                                                      CSD031
     C                     EXFMTSE0110C1                                                      CSD031
      *                                                                                       CSD031
     C                     ENDSR                                                              CSD031
      *                                                                                       CSD031
     C*****************************************************************                       CSD031
      /EJECT                                                                                  CSD031
     C*****************************************************************                       CSD031
     C*                                                               *                       CSD031
     C*  SRVLOP - SR TO VALIDATE INPUTTED ACTION                      *                       CSD031
     C*                                                               *                       CSD031
     C*  CALLED BY: SRBLSF                                            *                       CSD031
     C*                                                               *                       CSD031
     C*****************************************************************                       CSD031
     C*                                                                                       CSD031
     C           SRVLOP    BEGSR                                                              CSD031
      *                                                                                       CSD031
     C                     MOVE 'N'       WERR                                                CSD031
     C                     SETON                     71                                       CSD031
     C                     READCSE0110S1                 85                                   CSD031
     C           *IN85     DOWEQ*OFF                                                          CSD031
     C                     SETOF                     14                                       CSD031
      *                                                                                       CSD031
     C           SOPT      IFNE 'X'                                                           CSD031
     C           SOPT      ANDNE'D'                                                           CSD031
     C           SOPT      ANDNE'E'                                                           CSD031
     C           SOPT      ANDNE*BLANKS                                                       CSD031
     C                     SETON                     14                                       CSD031
     C                     MOVE 'Y'       WERR                                                CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C                     UPDATSE0110S1                                                      CSD031
     C                     READCSE0110S1                 85                                   CSD031
     C                     ENDDO                                                              CSD031
      *                                                                                       CSD031
     C                     ENDSR                                                              CSD031
      *                                                                                       CSD031
     C*****************************************************************                       CSD031
      /EJECT                                                                                  CSD031
     C*****************************************************************                       CSD031
     C*                                                               *                       CSD031
     C*  SRSFPR - SR TO PROCESS SUBFILE RECORD                        *                       CSD031
     C*                                                               *                       CSD031
     C*  CALLED BY: SRBLSF                                            *                       CSD031
     C*                                                               *                       CSD031
     C*****************************************************************                       CSD031
     C*                                                                                       CSD031
     C           SRSFPR    BEGSR                                                              CSD031
      *                                                                                       CSD031
     C                     MOVE 'N'       WF12                                                CSD031
     C                     SETON                     71                                       CSD031
     C                     READCSE0110S1                 85                                   CSD031
     C           *IN85     DOWEQ*OFF                                                          CSD031
      *                                                                                       CSD031
     C                     SELEC                                                              CSD031
     C           *INKL     WHEQ *ON                                                           CSD031
     C                     MOVE 'Y'       WF12                                                CSD031
     C                     LEAVE                                                              CSD031
     C           SOPT      WHEQ 'X'                                                           CSD031
     C                     EXSR SRACCP                                                        CSD031
     C           SOPT      WHEQ 'D'                                                           CSD031
     C                     EXSR SRDELT                                                        CSD031
     C           SOPT      WHEQ 'E'                                                           CSD031
     C                     EXSR SRENQR                                                        CSD031
     C                     ENDSL                                                              CSD031
      *                                                                                       CSD031
     C                     MOVE *BLANKS   SOPT                                                CSD031
     C                     UPDATSE0110S1                                                      CSD031
     C                     READCSE0110S1                 85                                   CSD031
     C                     ENDDO                                                              CSD031
      *                                                                                       CSD031
     C                     ENDSR                                                              CSD031
      *                                                                                       CSD031
     C*****************************************************************                       CSD031
      /EJECT                                                                                  CSD031
     C*****************************************************************                       CSD031
     C*                                                               *                       CSD031
     C*  SRACCP - SR TO ACCEPT CENTRAL DATA                           *                       CSD031
     C*                                                               *                       CSD031
     C*  CALLED BY: SRSFPR                                            *                       CSD031
     C*                                                               *                       CSD031
     C*****************************************************************                       CSD031
      *                                                                                       CSD031
     C           SRACCP    BEGSR                                                              CSD031
      *                                                                                       CSD031
     C           SACTN     IFEQ 'INSERT'                                                      CSD031
     C                     EXSR SRUPDF                                                        CSD031
     C                     ELSE                                                               CSD031
      *                                                                                       CSD031
     C           SACTN     IFEQ 'AMEND'                                                       CSD031
     C                     EXSR ACKCHN                                                        CSD031
     C********** *IN69     IFEQ *ON                                                  CSD031 BUG12271
     C           *IN69     IFEQ *OFF                                                        BUG12271
     C                     EXSR SRUPDF                                                        CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                     BUG11781
     C                     ELSE                                                             BUG11781
     C           SACTN     IFEQ 'DELETE'                                                    BUG11781
     C                     EXSR ACKCHN                                                      BUG11781
     C           *IN69     IFEQ *OFF                                                        BUG11781
     C                     EXSR SRUPDF                                                      BUG11781
     C                     ENDIF                                                            BUG11781
     C                     ENDIF                                                            BUG11781
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C           SAKEY     CHAINSDASAKL0             85                                       CSD031
     C                     DELETSDASAKDF                                                      CSD031
     C                     ENDSR                                                              CSD031
      *                                                                                       CSD031
     C*****************************************************************                       CSD031
      /EJECT                                                                                  CSD031
     C*****************************************************************                       CSD031
     C*                                                               *                       CSD031
     C*  SRDELT - SR TO DELETE CENTRAL DATA                           *                       CSD031
     C*                                                               *                       CSD031
     C*  CALLED BY: SRSFPR                                            *                       CSD031
     C*                                                               *                       CSD031
     C*****************************************************************                       CSD031
      *                                                                                       CSD031
     C           SRDELT    BEGSR                                                              CSD031
     C           SAKEY     CHAINSDASAKL0             85                                       CSD031
     C           *IN85     IFEQ *OFF                                                          CSD031
     C                     DELETSDASAKL0                                                      CSD031
     C                     ENDIF                                                              CSD031
     C                     ENDSR                                                              CSD031
      *                                                                                       CSD031
     C*****************************************************************                       CSD031
     C*                                                               *                       CSD031
     C*  SRENQR - SR TO DISPLAY ENQUIRY SCREEN                        *                       CSD031
     C*                                                               *                       CSD031
     C*  CALLED BY: SRSFPR                                            *                       CSD031
     C*                                                               *                       CSD031
     C*****************************************************************                       CSD031
      *                                                                                       CSD031
     C           SRENQR    BEGSR                                                              CSD031
     C                     EXSR SRSCFL                                                        CSD031
     C                     EXSR TIME                                                          CSD031
     C                     EXFMTSE0110D1                                                      CSD031
      *                                                                                       CSD031
     C                     ENDSR                                                              CSD031
      *                                                                                       CSD031
     C*****************************************************************                       CSD031
      /EJECT                                                                                  CSD031
     C*****************************************************************                       CSD031
     C*                                                               *                       CSD031
     C*  SRSCFL - SR TO MOVE DATABASE FIELDS TO SCREEN FIELDS         *                       CSD031
     C*                                                               *                       CSD031
     C*  CALLED BY: SRACCP                                            *                       CSD031
     C*                                                               *                       CSD031
     C*****************************************************************                       CSD031
      *                                                                                       CSD031
     C           SRSCFL    BEGSR                                                              CSD031
     C           SAKEY     CHAINSDASAKL0             85                                       CSD031
     C                     MOVE CHTP      ACTCD                                               CSD031
      *                                                                                       CSD031
     C           ACD1      IFEQ 0                                                             CSD031
     C                     MOVE *BLANKS   SACD1                                               CSD031
     C                     ELSE                                                               CSD031
     C                     MOVE ACD1      SACD1                                               CSD031
     C                     ENDIF                                                              CSD031
     C                     MOVE NCDA1     SNCD1                                               CSD031
     C           PRF1      IFEQ 0                                                             CSD031
     C                     MOVE *BLANKS   SPRF1                                               CSD031
     C                     ELSE                                                               CSD031
     C                     MOVE PRF1      SPRF1                                               CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C           ACD2      IFEQ 0                                                             CSD031
     C                     MOVE *BLANKS   SACD2                                               CSD031
     C                     ELSE                                                               CSD031
     C                     MOVE ACD2      SACD2                                               CSD031
     C                     ENDIF                                                              CSD031
     C                     MOVE NCDA2     SNCD2                                               CSD031
     C           PRF2      IFEQ 0                                                             CSD031
     C                     MOVE *BLANKS   SPRF2                                               CSD031
     C                     ELSE                                                               CSD031
     C                     MOVE PRF2      SPRF2                                               CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C           ACD3      IFEQ 0                                                             CSD031
     C                     MOVE *BLANKS   SACD3                                               CSD031
     C                     ELSE                                                               CSD031
     C                     MOVE ACD3      SACD3                                               CSD031
     C                     ENDIF                                                              CSD031
     C                     MOVE NCDA3     SNCD3                                               CSD031
     C           PRF3      IFEQ 0                                                             CSD031
     C                     MOVE *BLANKS   SPRF3                                               CSD031
     C                     ELSE                                                               CSD031
     C                     MOVE PRF3      SPRF3                                               CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C           ACD4      IFEQ 0                                                             CSD031
     C                     MOVE *BLANKS   SACD4                                               CSD031
     C                     ELSE                                                               CSD031
     C                     MOVE ACD4      SACD4                                               CSD031
     C                     ENDIF                                                              CSD031
     C                     MOVE NCDA4     SNCD4                                               CSD031
     C           PRF4      IFEQ 0                                                             CSD031
     C                     MOVE *BLANKS   SPRF4                                               CSD031
     C                     ELSE                                                               CSD031
     C                     MOVE PRF4      SPRF4                                               CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C           ACD5      IFEQ 0                                                             CSD031
     C                     MOVE *BLANKS   SACD5                                               CSD031
     C                     ELSE                                                               CSD031
     C                     MOVE ACD5      SACD5                                               CSD031
     C                     ENDIF                                                              CSD031
     C                     MOVE NCDA5     SNCD5                                               CSD031
     C           PRF5      IFEQ 0                                                             CSD031
     C                     MOVE *BLANKS   SPRF5                                               CSD031
     C                     ELSE                                                               CSD031
     C                     MOVE PRF5      SPRF5                                               CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C           PRF6      IFEQ 0                                                             CSD031
     C                     MOVE *BLANKS   SPRF6                                               CSD031
     C                     ELSE                                                               CSD031
     C                     MOVE ACD6      SACD6                                               CSD031
     C                     ENDIF                                                              CSD031
     C                     MOVE NCDA6     SNCD6                                               CSD031
     C           PRF6      IFEQ 0                                                             CSD031
     C                     MOVE *BLANKS   SPRF6                                               CSD031
     C                     ELSE                                                               CSD031
     C                     MOVE PRF6      SPRF6                                               CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C                     MOVE AACC      WAZON   1                                           CSD031
     C           EACC      IFEQ 0                                                             CSD031
     C                     MOVE *BLANKS   SEDTE                                               CSD031
     C                     ELSE                                                               CSD031
     C                     Z-ADDEACC      ZDAYNO                                              CSD031
     C                     EXSR SRDAT2                                                        CSD031
     C                     MOVE ZDATE     SEDTE                                               CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C                     MOVE GPDT      SCDTA                                               CSD031
      *                                                                                       CSD031
     C                     ENDSR                                                              CSD031
      *                                                                                       CSD031
     C*****************************************************************                       CSD031
      /EJECT                                                                                  CSD031
     C*****************************************************************                       CSD031
     C*                                                               *                       CSD031
     C*  SRDBFL  - SR TO MOVE SCREEN FIELDS TO DATABASE FIELDS        *                       CSD031
     C*            (ACCEPT MODE)                                      *                       CSD031
     C*                                                               *                       CSD031
     C*  CALLED BY: SRUPDF                                            *                       CSD031
     C*                                                               *                       CSD031
     C*****************************************************************                       CSD031
      *                                                                                       CSD031
     C           SRDBFL    BEGSR                                                              CSD031
     C                     MOVELSAKEY     ACKE                                                CSD031
     C                     MOVE ACTCD     CHTP                                                CSD031
     C                     MOVE SACD1     ACD1                                                CSD031
     C                     MOVE SNCD1     NCDA1                                               CSD031
     C                     MOVE SPRF1     PRF1                                                CSD031
     C                     MOVE SACD2     ACD2                                                CSD031
     C                     MOVE SNCD2     NCDA2                                               CSD031
     C                     MOVE SPRF2     PRF2                                                CSD031
     C                     MOVE SACD3     ACD3                                                CSD031
     C                     MOVE SNCD3     NCDA3                                               CSD031
     C                     MOVE SPRF3     PRF3                                                CSD031
     C                     MOVE SACD4     ACD4                                                CSD031
     C                     MOVE SNCD4     NCDA4                                               CSD031
     C                     MOVE SPRF4     PRF4                                                CSD031
     C                     MOVE SACD5     ACD5                                                CSD031
     C                     MOVE SNCD5     NCDA5                                               CSD031
     C                     MOVE SPRF5     PRF5                                                CSD031
     C                     MOVE SACD6     ACD6                                                CSD031
     C                     MOVE SNCD6     NCDA6                                               CSD031
     C                     MOVE SPRF6     PRF6                                                CSD031
     C                     MOVE WAZON     AACC                                                CSD031
     C                     Z-ADDBJRDNB    EACC                                                CSD031
     C                     ENDSR                                                              CSD031
      *                                                                                       CSD031
     C*****************************************************************                       CSD031
      /EJECT                                                                                  CSD031
     C*****************************************************************                       CSD031
     C*                                                               *                       CSD031
     C*  SRUPDF - SR TO UPDATE FILE                                   *                       CSD031
     C*                                                               *                       CSD031
     C*  CALLED BY: SRACCP                                            *                       CSD031
     C*                                                               *                       CSD031
     C*****************************************************************                       CSD031
      *                                                                                       CSD031
     C           SRUPDF    BEGSR                                                              CSD031
      *                                                                                       CSD031
     C                     MOVE 'Y'       WUPOK   1                                           CSD031
      *                                                                                       CSD031
      ** Move acceptance fields to screen fields                                              CSD031
      *                                                                                       CSD031
     C                     EXSR SRSCFL                                                        CSD031
      *                                                                                       CSD031
      ** Retrieve zone record                                                                 CSD031
      *                                                                                       CSD031
     C           SAKEY     CHAINSEACKD               85                                       CSD031
      *                                                                                       CSD031
      ** Move screen fields to database fields(Zone)                                          CSD031
      *                                                                                       CSD031
     C                     EXSR SRDBFL                                                        CSD031
      *                                                                                       CSD031
      **  Obtain last transaction number and set up standard output                           CSD031
      **  information                                                                         CSD031
      *                                                                                       CSD031
     C                     EXSR ZTNLU1                                                        CSD031
     C                     MOVE 'SE'      MDID    2                                           CSD031
     C                     MOVEL'SEACK '  PGMN    8                                           CSD031
     C                     MOVE WSID      WSIDX   3                                           CSD031
     C                     MOVE USRID     USRIDX 10                                           CSD031
      *                                                                                       CSD031
      ** Set up last change date, type and record id                                          CSD031
      *                                                                                       CSD031
     C           CHTP      IFEQ 'D'                                                           CSD031
     C                     MOVE '*'       RECI                                                CSD031
     C                     ELSE                                                               CSD031
     C                     MOVE 'D'       RECI                                                CSD031
     C                     ENDIF                                                              CSD031
     C                     Z-ADDRUND      LCD                                                 CSD031
     C                     MOVELNATN      TNLU                                                CSD031
      *                                                                                       CSD031
      ** Update/Add record                                                                    CSD031
      *                                                                                       CSD031
     C           *IN85     IFEQ *OFF                                                          CSD031
     C           CHTP      IFNE 'D'                                                           CSD031
     C                     MOVEL'A'       CHTP                                                CSD031
     C                     ENDIF                                                              CSD031
     C                     UPDATSEACKDF                                                       CSD031
     C                     ELSE                                                               CSD031
     C                     MOVEL'I'       CHTP                                                CSD031
     C                     WRITESEACKDF                                                       CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
      ** Get account keys header record ready for update.                                     CSD031
      *                                                                                       CSD031
     C           1         CHAINSEACKA               69                                       CSD031
      *                                                                                       CSD031
      ** If header not found, database error                                                  CSD031
      *                                                                                       CSD031
     C           *IN69     IFEQ '1'                                                           CSD031
     C                     MOVEL'1'       *INU8                                               CSD031
     C                     MOVEL'1'       *INU7                                               CSD031
     C           *LOCK     IN   LDA                                                           CSD031
     C                     Z-ADD2         DBASE                                               CSD031
     C                     MOVEL'SEACK'   DBFILE                                              CSD031
     C                     MOVEL'AUDIT'   DBKEY                                               CSD031
     C                     OUT  LDA                                                           CSD031
     C                     EXSR DSERR                                                         CSD031
     C                     EXSR *PSSR                                                         CSD031
     C                     GOTO ENDUP1                                                        CSD031
     C                     END                                                                CSD031
      *                                                                                       CSD031
      ** Increment no. & type of updates.                                                     CSD031
      *                                                                                       CSD031
     C                     SELEC                                                              CSD031
     C           CHTP      WHEQ 'I'                                                           CSD031
     C********** SINS      ADD  1         SINS                                       CSD031 BUG12646
     C           SINS10    ADD  1         SINS10                                            BUG12646
     C           CHTP      WHEQ 'A'                                                           CSD031
     C********** SAMD      ADD  1         SAMD                                       CSD031 BUG12646
     C           SAMD10    ADD  1         SAMD10                                            BUG12646
     C           CHTP      WHEQ 'D'                                                           CSD031
     C********** SDEL      ADD  1         SDEL                                       CSD031 BUG12646
     C           SDEL10    ADD  1         SDEL10                                            BUG12646
     C                     ENDSL                                                              CSD031
      *                                                                                       CSD031
      ** Increment no. of live records on file                                                CSD031
      *                                                                                       CSD031
     C********** SLRB      ADD  SINS      NORE                                       CSD031 BUG12646
     C********** NORE      SUB  SDEL      NORE                                       CSD031 BUG12646
     C********** SLRB10    ADD  SINS10    NORE                                     BUG12646 MD043337
     C           SLRB10    ADD  SINS10    NORE10                                            MD043337
     C****       NORE10    SUB  SDEL10    NORE                                     BUG12646 MD043337
     C           NORE10    SUB  SDEL10    NORE10                                            MD043337
      *                                                                                       CSD031
      ** Update A/C Key header record                                                         CSD031
      *                                                                                       CSD031
     C                     EXSR TIME                                                          CSD031
     C                     UPDATSEACKAF                                                       CSD031
      *                                                                                       CSD031
     C           ENDUP1    TAG                                                                CSD031
      *                                                                                       CSD031
      ** End Commitment control                                                               CSD031
      *                                                                                       CSD031
     C           CMTTXT    COMIT                                                              CSD031
      *                                                                                       CSD031
     C                     ENDSR                                                              CSD031
      *                                                                                       CSD031
     C*****************************************************************                       CSD031
      /EJECT                                                                                  CSD031
     C*****************************************************************                       CSD031
     C*                                                               *                       CSD031
     C*  SRRTTX - SR TO RETRIEVE TEXT FOR ERROR MESSAGES              *                       CSD031
     C*                                                               *                       CSD031
     C*  CALLED BY: MAIN                                              *                       CSD031
     C*                                                               *                       CSD031
     C*****************************************************************                       CSD031
      *                                                                                       CSD031
     C           SRRTTX    BEGSR                                                              CSD031
     C                     CALL 'SDRTVTXT'                                                    CSD031
     C                     PARM           MSGDNB  7                                           CSD031
     C                     PARM           MSGNM  10                                           CSD031
     C                     PARM *BLANKS   MSGTXT 80                                           CSD031
     C                     ENDSR                                                              CSD031
      *                                                                                       CSD031
      *****************************************************************                       CSD031
      *                                                                                       CSD031
     C*****************************************************************                       CSD031
      /EJECT                                                                                  CSD031
     C*****************************************************************                       CSD031
     C*                                                               *                       CSD031
     C*  SRVLED - SR TO VALIDATE EFFECTIVE DATE                       *                       CSD031
     C*                                                               *                       CSD031
     C*  CALLED BY: MAIN                                              *                       CSD031
     C*                                                               *                       CSD031
     C*****************************************************************                       CSD031
      *                                                                                       CSD031
     C           SRVLED    BEGSR                                                              CSD031
      *                                                                                       CSD031
     C                     MOVELWMSGQ     MSGNM                                               CSD031
     C                     SETOF                     09                                       CSD031
      *                                                                                       CSD031
     C           SEDTE     IFNE *BLANK                                                        CSD031
      *                                                                                       CSD031
      ** May only be entered if accept to zone is 'N'                                         CSD031
      *                                                                                       CSD031
     C           SAZON     IFEQ 'Y'                                                           CSD031
     C                     ADD  1         S                                                   CSD031
     C                     MOVEL'025'     ERCD,S                                              CSD031
     C                     SETON                     0961                                     CSD031
     C                     ELSE                                                               CSD031
      *                                                                                       CSD031
      ** Must be valid                                                                        CSD031
      *                                                                                       CSD031
     C                     MOVE SEDTE     ZDATE                                               CSD031
     C                     EXSR SRDATE                                                        CSD031
     C                     Z-ADDZDAYNO    EACC                                                CSD031
     C           DIGITS    CHECKSEDTE     WPOS    10                                          CSD031
     C           WPOS      IFGT 0                                                             CSD031
     C           ZERR      ORNE *BLANKS                                                       CSD031
     C                     ADD  1         S                                                   CSD031
     C                     MOVEL'027'     ERCD,S                                              CSD031
     C                     SETON                     0961                                     CSD031
     C                     ENDIF                                                              CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C                     ENDSR                                                              CSD031
      *****************************************************************   S01117
      /EJECT                                                              S01117
      *****************************************************************   S01117
      *                                                               *   S01117
      *  *PSSR  - Error control subroutine                            *   S01117
      *                                                               *   S01117
      *****************************************************************   S01117
      *                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR **    S01117
     C**                                                                  S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     ENDSR                                          S01117
      *                                                                   S01117
      *****************************************************************   S01117
      /EJECT
0816 C*COPY*ZSRSRC,ZSYSTMZ1***********************************************S01117
      /EJECT
     C/COPY ZSRSRC,ZTNLU1Z2
     O/EJECT
     O**  OUTPUT TO WORK-STATION.
     O*
     O/COPY WNCPYSRC,SE0110O001
     OSE0110DFD        01N40
     O       OR        02N40
     O       OR        03N40
     O       OR        04N40
     O       OR        05N40
     O       OR        41
     O                                   K8 'SE0110F1'
     O**********               *IN56      1                                                   CSD031
     O**********               *IN80      2                                                   CSD031
     O**********               *IN20      3                                                   CSD031
     O**********               *IN81      4                                                   CSD031
     O**********               *IN65      5                                                   CSD031
     O**********               *IN82      6                                                   CSD031
     O**********               *IN46      7                                                   CSD031
     O**********               *IN90      8                                                   CSD031
     O**********               *IN70      9                                                   CSD031
     O**********               *IN47     10                                                   CSD031
     O**********               *IN91     11                                                   CSD031
     O**********               *IN74     12                                                   CSD031
     O**********               *IN48     13                                                   CSD031
     O**********               *IN92     14                                                   CSD031
     O**********               *IN75     15                                                   CSD031
     O**********               *IN49     16                                                   CSD031
     O**********               *IN93     17                                                   CSD031
     O**********               *IN77     18                                                   CSD031
     O**********               *IN50     19                                                   CSD031
     O**********               *IN94     20                                                   CSD031
     O**********               *IN78     21                                                   CSD031
     O**********               *IN51     22                                                   CSD031
     O**********               *IN95     23                                                   CSD031
     O**********               *IN83     24                                                   CSD031
     O**********               *IN84     25                                                   CSD031
     O**********               STID      27                                                   CSD031
     O**********       01 52 80          27 'SI'                                              CSD031
     O**********       01 53 80          27 'SA'                                              CSD031
     O**********       01 54 80          27 'SD'                                              CSD031
     O**********       01 55 80          27 'SE'                                              CSD031
     O**********       41                27 'SF'                                              CSD031
     O**********               MTIME     35 '  .  .  '                                        CSD031
     O**********               WSID      38                                                   CSD031
     O**********       42      ACTCD     39                                                   CSD031
     O**********       42      SAKEY     59                                                   CSD031
     O**********       43      SCFLDS   101                                                   CGL029
     O**********       44 22   ACD1      63                                                   CGL029
     O*****************44N28   NCD1      65                               E23957
     O**********       44N28   NCDA1     65                                            E23957 CGL029
     O**********       44 34   PRF1      66                                                   CGL029
     O**********       44 23   ACD2      70                                                   CGL029
     O*****************44N29   NCD2      72                               E23957
     O**********       44N29   NCDA2     72                                            E23957 CGL029
     O**********       44 35   PRF2      73                                                   CGL029
     O**********       44 24   ACD3      77                                                   CGL029
     O*****************44N30   NCD3      79                               E23957
     O**********       44N30   NCDA3     79                                            E23957 CGL029
     O**********       44 36   PRF3      80                                                   CGL029
     O**********       44 25   ACD4      84                                                   CGL029
     O*****************44N31   NCD4      86                               E23957
     O**********       44N31   NCDA4     86                                            E23957 CGL029
     O**********       44 37   PRF4      87                                                   CGL029
     O**********       44 26   ACD5      91                                                   CGL029
     O*****************44N32   NCD5      93                               E23957
     O**********       44N32   NCDA5     93                                            E23957 CGL029
     O**********       44 38   PRF5      94                                                   CGL029
     O**********       44 27   ACD6      98                                                   CGL029
     O*****************44N33   NCD6     100                               E23957
     O**********       44N33   NCDA6    100                                            E23957 CGL029
     O**********       44 39   PRF6     101                                                   CGL029
     O**********               ERCD     173                                                   CGL029
     O**********               ERMSG    225                                                   CGL029
     O**********       43      SCFLDS   137                                            CGL029 CSD031
     O**********       44 22   ACD1      69                                            CGL029 CSD031
     O**********       44N28   NCDA1     71                                            CGL029 CSD031
     O**********       44 34   PRF1      72                                            CGL029 CSD031
     O**********       44 23   ACD2      82                                            CGL029 CSD031
     O**********       44N29   NCDA2     84                                            CGL029 CSD031
     O**********       44 35   PRF2      85                                            CGL029 CSD031
     O**********       44 24   ACD3      95                                            CGL029 CSD031
     O**********       44N30   NCDA3     97                                            CGL029 CSD031
     O**********       44 36   PRF3      98                                            CGL029 CSD031
     O**********       44 25   ACD4     108                                            CGL029 CSD031
     O**********       44N31   NCDA4    110                                            CGL029 CSD031
     O**********       44 37   PRF4     111                                            CGL029 CSD031
     O**********       44 26   ACD5     121                                            CGL029 CSD031
     O**********       44N32   NCDA5    123                                            CGL029 CSD031
     O**********       44 38   PRF5     124                                            CGL029 CSD031
     O**********       44 27   ACD6     134                                            CGL029 CSD031
     O**********       44N33   NCDA6    136                                            CGL029 CSD031
     O**********       44 39   PRF6     137                                            CGL029 CSD031
     O**********               ERCD     209                                            CGL029 CSD031
     O**********               ERMSG    261                                            CGL029 CSD031
     O                         *IN06      1                                                   CSD031
     O                         *IN45      2                                                   CSD031
     O                         *IN56      3                                                   CSD031
     O                         *IN80      4                                                   CSD031
     O                         *IN20      5                                                   CSD031
     O                         *IN81      6                                                   CSD031
     O                         *IN65      7                                                   CSD031
     O                         *IN82      8                                                   CSD031
     O                         *IN46      9                                                   CSD031
     O                         *IN90     10                                                   CSD031
     O                         *IN70     11                                                   CSD031
     O                         *IN47     12                                                   CSD031
     O                         *IN91     13                                                   CSD031
     O                         *IN74     14                                                   CSD031
     O                         *IN48     15                                                   CSD031
     O                         *IN92     16                                                   CSD031
     O                         *IN75     17                                                   CSD031
     O                         *IN49     18                                                   CSD031
     O                         *IN93     19                                                   CSD031
     O                         *IN77     20                                                   CSD031
     O                         *IN50     21                                                   CSD031
     O                         *IN94     22                                                   CSD031
     O                         *IN78     23                                                   CSD031
     O                         *IN51     24                                                   CSD031
     O                         *IN95     25                                                   CSD031
     O                         *IN10     26                                                   CSD031
     O                         *IN08     27                                                   CSD031
     O                         *IN09     28                                                   CSD031
     O                         *IN83     29                                                   CSD031
     O                         *IN84     30                                                   CSD031
     O                         STID      32                                                   CSD031
     O                 01 52 80          32 'SI'                                              CSD031
     O                 01 53 80          32 'SA'                                              CSD031
     O                 01 54 80          32 'SD'                                              CSD031
     O                 01 55 80          32 'SE'                                              CSD031
     O                 41                32 'SF'                                              CSD031
     O                         MTIME     40 '  .  .  '                                        CSD031
     O                         WSID      43                                                   CSD031
     O                 42      ACTCD     44                                                   CSD031
     O                 42      SAKEY     64                                                   CSD031
     O                 43      SCFLDS   142                                                   CSD031
     O                 44 22   ACD1      74                                                   CSD031
     O                 44N28   NCDA1     76                                                   CSD031
     O                 44 34   PRF1      77                                                   CSD031
     O                 44 23   ACD2      87                                                   CSD031
     O                 44N29   NCDA2     89                                                   CSD031
     O                 44 35   PRF2      90                                                   CSD031
     O                 44 24   ACD3     100                                                   CSD031
     O                 44N30   NCDA3    102                                                   CSD031
     O                 44 36   PRF3     103                                                   CSD031
     O                 44 25   ACD4     113                                                   CSD031
     O                 44N31   NCDA4    115                                                   CSD031
     O                 44 37   PRF4     116                                                   CSD031
     O                 44 26   ACD5     126                                                   CSD031
     O                 44N32   NCDA5    128                                                   CSD031
     O                 44 38   PRF5     129                                                   CSD031
     O                 44 27   ACD6     139                                                   CSD031
     O                 44N33   NCDA6    141                                                   CSD031
     O                 44 39   PRF6     142                                                   CSD031
     O                 97      SCFLD    142                                                 BUG13070
     O                         SAZON    143                                                   CSD031
     O                         SEDTE    149                                                   CSD031
     O                         ERCD     225                                                   CSD031
     O                         ERMSG    301                                                   CSD031
     O/COPY WNCPYSRC,SE0110O002
     O**   NB. ERCD & ERMSG ARE DISPLAYED AS 76 CHARACTERS ON SCREEN.
     O**
     O**   SEACK FILE - RELEASE.
     OSEACKDF E
      /EJECT
      ***
**  CPY@
(c) Finastra International Limited 2001
**   ERRMSG - ERROR MESSAGES
INVALID ACTION CODE                              1
NOT FOUND                                        2
ALREADY ON FILE                                  3
INVALID COMMAND KEY                              4
INVALID KEY                                      5
RECORD HAS BEEN UPDATED BY ANOTHER WORK-STATION  6
ACTION CODE NOT VALID FOR USER                   7                        S01117
     X/COPY WNCPYSRC,SEH00119
**   C31MSG - CSD031 ERROR MESSAGES                                                           CSD031
Effective date must be greater than or equal to next working day    1                         CSD031
Record cannot be deleted if Accept to Zone is 'Y'                   2                         CSD031
**   CHAR - PERMITTED CHARACTERS IN ACCOUNT KEY
ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789
** OVRC                                                                                       CSD031
OVRDBF FILE(GZSDBANK) TOFILE(GZSDBANKL2)                                                      CSD031
CHGJOB SWS(1XXXXXXX)                                                                          CSD031
CHGJOB SWS(0XXXXXXX)                                                                          CSD031
