     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Charges/Commissions Codes Maint.')            *
/*XBI1*: OVRDBF FILE(SECGTX2) TOFILE(SECGT) SHARE(*NO)              : *   S01446
/*XBI2*: OVRDBF FILE(SECGTX) TOFILE(SECGT) SHARE(*NO)               : *
      *****************************************************************
      *                                                               *
      *  Midas - Securities Trading Module
      *                                                               *
      *  SE0121 - CHARGES/COMMISSIONS MAINTENANCE                     *
      *                                                               *
      *  Function: This program allows the maintenance and validation *
      *   (I/C)    of Charges and Commission Codes.                   *
      *                                                               *
      *  Called By: SEC02 - Input Cycle Processing                    *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      *  Prev Amend No. AR985771           Date 07Jun12               *
      *                 CSW212             Date 03May12               *
      *                 CSW210             Date 04May10               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG1075            Date 17Mar06               *
      *                 BUG2213            Date 07May04               *
      *                 CAAA02             Date 05Feb04               *
      * Midas Release 4.01 -------------------------------------------*
      *                 198918             Date 16Oct01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 192352             Date 06Jun01               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CSW098             Date 01APR98               *
      *                 CAC002             Date 15Sep96               *
      *                 104633             Date 08Jul96               *
      *                 085102             DATE 12APR95               *
      *                 066488             DATE 02FEB94               *
      *                 052254             DATE 07JAN94               *
      *                 S01446             DATE 06OCT93               *
      *                 S01401             DATE 16JUN93               *
      *                 E38668             DATE 22APR92               *
      *                 E36926             DATE 16APR92               *
      *                 S01117             DATE 30OCT90               *
      *                 S01269             DATE 01AUG90               *
      *                 E20816             DATE 15JAN90               *
      *                 S01199             DATE 13SEP89               *
      *                 E17698             DATE 07/04/89              *
      *                 S01179             DATE 21/10/88              *
      *                 S01176             DATE 07/07/88              *
      *                 S01169             DATE 05/07/88              *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  MD046248 - Finastra Rebranding                               *
      *  AR985771 - Error in Profit Centre field                      *
      *  CSW212 - SWIFT 2012 Changes                                  *
      *  CSW210 - SWIFT 2010 Changes                                  *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  BUG10756 - Charges and Commission code does not appear on    *
      *             Review.                                           *
      *  BUG2213- Midasplus webfacing  changes. Recompile due to      *
      *           changes in SE0121DF.                                *
      *  CAAA02 - Midasplus webfacing changes                         *
      *  198918 - Charge and commission code must be numeric          *
      *  192352 - Recompiled due to changes in SE0121DF.              *
      *  CSW098 - SWIFT 98 Changes. New field: SWIFT ID.              *
      *  CAC002 - Profit Centre Accounting Development - Phase 2      *
      *           If Analytical Accounting is installed, existing     *
      *           'Group Charge Indicator' will be made redundant and *
      *           new optional 'Profit Centre' and 'Book/Transaction  *
      *           indicator' fields will be added.                    *
      *  104633 - GUI Amendments to DSPF with non-standard footers    *
      *  085102 - Recompile due to change of display file.            *
      *  066488 - Ensure previous record examined does not prevent    *
      *           actions on next one - in particular inserts.        *
      *  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
      *           to 10,9                                             *
      *  S01446 - Customer Commissions (Courtage) Enhancement         *
      *           Add validation of group charge indicator, and code  *
      *  S01401 - Produce SWIFT Messages MT5xxs, if option available. *
      *  E38668 - Literal for Enquiry Command keys had been corrupted *
      *  E36926 - Recompiled over changed display file                *
      *  S01117 - MULTIBRANCHING                                      *
      *  S01269 - Trade authorisation: recompiled over changed file   *
      *           TABSE                                               *
      *  E20816 - The validation on the Charges and Commissions Code  *   E20816
      *           allows anything to be entered instead of a number   *   E20816
      *           between 00 and 99.                                  *   E20816
      *  S01199 - HELP SYSTEM.                                        *   S01199
      *  E17698 - No Command or Function Keys work, because SR/ASCHGS *   E17698
      *           called in wrong places. Enquiry Screen text should  *   E17698
      *           read 7F3', not 'F31'.                               *   E17698
      *  S01179  -  ****** AS400 CONVERSION ******                    *   S01179
      *  The keyword RTGAID is no longer supported on the AS400       *   S01179
      *  and command keys and indicators have been used to replace    *   S01179
      *  this in the display file. To disrupt the structure of the    *   S01179
      *  program as little as possible a new subroutine - ASCHGS -    *   S01179
      *  has been coded. This moves the values which would have       *   S01179
      *  been passed to the program (via RTGAID) into the AID         *   S01179
      *  field depending on which function key has been pressed.      *   S01179
      *  S01176 - SECURITIES TRADING 3.1 (AUSTRALIA)                  *   S01176
      *  S01169 - SECURITIES TRADING 3.1 (BAER INCORPORATION)         *   S01169
      *           This change is a complete rewrite of the old SE0120 *
      *           and as a result the dates have been reset to zero   *
      *           and all references to S01169 removed.               *
      *                                                               *
      *****************************************************************
      *
     FSECGT   UF  E           K        DISK         KCOMIT       A
     F                                              KINFDS INFDS
     F                                              KINFSR INFSR
     FSECGTA  UF  E                    DISK         KCOMIT
     F*TABSE**IF  E           K        DISK                               S01117
     F**ICD*1**** TABTB10F                          KIGNORE               S01117
     F*********** TABTB10F                          KIGNORE               S01117
     F*********** TABTB11F                          KIGNORE               S01117
     F*********** TABTB40F                          KIGNORE               S01117
     F*********** TABTE10F                          KIGNORE               S01117
     F**CCY*1**** TABTG10F                          KIGNORE               S01117
     F*********** TABTG10F                          KIGNORE               S01117
     F*********** TABLETHF                          KIGNORE               S01117
     F*********** TABLETLF                          KIGNORE               S01117
     F*********** TABLETRF                          KIGNORE               S01117
     F*********** TABLET2F                          KIGNORE               S01117
     F*********** TABLETAF                          KIGNORE               S01117
     F*********** TABTE20F                          KIGNORE               S01117
     F*********** TABTG20F                          KIGNORE               S01117
     F*********** TABLETKF                          KIGNORE               S01117
     F*********** TABLETNF                          KIGNORE               S01117
     F*********** TABLETPF                          KIGNORE               S01117
     F*********** TABLETXF                          KIGNORE               S01117
     F*********** TABLET3F                          KIGNORE               S01117
     F*********** TABLET5F                          KIGNORE               S01117
     FSE0121DFCF  E                    WORKSTN      KINFDS SCRDS
     F                                        RRN   KSFILE SE0121S0
     FSECGTX  IF  E           K        DISK
     F            SECGTDF                           KRENAMESECGTDFX
     FSECGTX2 IF  E           K        DISK                               S01446
     F            SECGTDF                           KRENAMESECGTDFZ       S01446
      *** SE Charge Type                                                  S01446
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*   01  - S/SE0121C0  SFLDSP                                    *
     F*   02  - S/SE0121C0  SFLDSPCTL                                 *
     F*   03  - S/SE0121C0  SFLEND                                    *
     F*   04  - S/SE0121C0  ROLLDOWN not allowed                      *
     F*   05  - S/SE0121F1  Protect/Non-Display on location           *
     F*   06  - S/SE0121F0  Protect fields                            *
     F*   09  - Used to control display attributes of Grp Chg Flds    *   S01446
     F*         (ON - S01446 not present, OFF - S01446 present        *   S01446
     F*                                                               *
     F*   10  - Start  Screen                                         *
     F*   11  - Review Screen                                         *
     F*   12  - Update Screen                                         *
     F*                                                               *
     F*   13  - Analytical accounting available                       *   CAC002
     F*   14  - Portfolio customer licensed                           *   CAC002
     F*                                                               *   CAC002
     F*   15  - Used on Write/Update to condition call of INFSR       *
     F*   16  - Used to control display attributes of field SSWID     *   CSW098
     F*   17  - Invalid SSWID.Controls Reverse Image + Position Cursor*   CSW098
     F*                                                               *
     F*   21  - S/SE0121F1  ERROR-ACTN                                *
     F*   22  - S/SE0121F1  ERROR-CCY                                 *
     F*   23  - S/SE0121F1  ERROR-CCOM                                *
     F*                                                               *
     F*   24  - Error in profit centre field                          *   CAC002
     F*   25  - ROLLUP                                                *   S01179
     F*   26  - ROLLDOWN                                              *   S01179
     F*   27  - Error in book/transaction indicator                   *   CAC002
     F****27**-*HELP********************************************** S01179 S01199
     F*   28  - Used to control display attributes of field SOWOT     *   S01401
     F*         (ON - S01401 present, OFF - S01401 not present        *   S01401
     F*                                                               *   S01179
     F*   30  - S/SE0121F0  POSITION CURSOR                           *
     F*   31  - S/SE0121F0  ERROR-CHNR                                *
     F*                                                               *
     F*   30  - S/SE0121F0  POSITION CURSOR ON CHARGE BASIS           *
     F*   31  - S/SE0121F0  CHARGE BASIS INVALID                      *
     F*   32  - S/SE0121F0  VAT APPLICABLE INVALID                    *
     F*   33  - S/SE0121F0  THRESHOLD INVALID                         *
     F*   34  - S/SE0121F0  POSITION CURSOR ON NARRATIVE              *
     F*   35  - S/SE0121F0  NARRATIVE INVALID                         *
     F*   36  - S/SE0121F0  LEVIED ON IND. INVALID                    *
     F*   37  - S/SE0121F0  UPPER RANGE LIMIT (1) INVALID             *
     F*   38  - S/SE0121F0  UPPER RANGE LIMIT (2) INVALID             *
     F*   39  - S/SE0121F0  UPPER RANGE LIMIT (3) INVALID             *
     F*   40  - S/SE0121F0  UPPER RANGE LIMIT (4) INVALID             *
     F*   41  - S/SE0121F0  UPPER RANGE LIMIT (5) INVALID             *
     F*   42  - S/SE0121F0  UPPER RANGE LIMIT (6) INVALID             *
     F*   43  - S/SE0121F0  UPPER RANGE LIMIT (7) INVALID             *
     F*   44  - S/SE0121F0  UPPER RANGE LIMIT (8) INVALID             *
     F*   45  - S/SE0121F0  UPPER RANGE LIMIT (9) INVALID             *
     F****46**-*S/SE0121F0**PERCENTAGE*(1)*INVALID*********************   S01176
     F****47**-*S/SE0121F0**PERCENTAGE*(2)*INVALID*********************   S01176
     F****48**-*S/SE0121F0**PERCENTAGE*(3)*INVALID*********************   S01176
     F****49**-*S/SE0121F0**PERCENTAGE*(4)*INVALID*********************   S01176
     F****50**-*S/SE0121F0**PERCENTAGE*(5)*INVALID*********************   S01176
     F****51**-*S/SE0121F0**PERCENTAGE*(6)*INVALID*********************   S01176
     F****52**-*S/SE0121F0**PERCENTAGE*(7)*INVALID*********************   S01176
     F****53**-*S/SE0121F0**PERCENTAGE*(8)*INVALID*********************   S01176
     F****54**-*S/SE0121F0**PERCENTAGE*(9)*INVALID*********************   S01176
     F****55**-*S/SE0121F0**PERCENTAGE*(10)*INVALID********************   S01176
     F****56**-*S/SE0121F0**FLAT CHARG*(1)*INVALID*********************   S01176
     F****57**-*S/SE0121F0**FLAT CHARG*(2)*INVALID*********************   S01176
     F****58**-*S/SE0121F0**FLAT CHARG*(3)*INVALID*********************   S01176
     F****59**-*S/SE0121F0**FLAT CHARG*(4)*INVALID*********************   S01176
     F****60**-*S/SE0121F0**FLAT CHARG*(5)*INVALID*********************   S01176
     F****61**-*S/SE0121F0**FLAT CHARG*(6)*INVALID*********************   S01176
     F****62**-*S/SE0121F0**FLAT CHARG*(7)*INVALID*********************   S01176
     F****63**-*S/SE0121F0**FLAT CHARG*(8)*INVALID*********************   S01176
     F****64**-*S/SE0121F0**FLAT CHARG*(9)*INVALID*********************   S01176
     F****65**-*S/SE0121F0**FLAT*CHARGE(10)*INVALID********************   S01176
     F****66**-*S/SE0121F0**MIN*CHARGE*INVALID*************************   S01176
     F****67**-*S/SE0121F0**MAX*CHARGE*INVALID*************************   S01176
     F*   46  - S/SE0121F0  UPPER RANGE LIMIT (10) INVALID            *   S01176
     F*   47  - S/SE0121F0  UPPER RANGE LIMIT (11) INVALID            *   S01176
     F*   48  - S/SE0121F0  UPPER RANGE LIMIT (12) INVALID            *   S01176
     F*   49  - S/SE0121F0  UPPER RANGE LIMIT (13) INVALID            *   S01176
     F*   50  - S/SE0121F0  UPPER RANGE LIMIT (14) INVALID            *   S01176
     F*   51  - S/SE0121F0  PERCENTAGE (1) INVALID                    *   S01176
     F*   52  - S/SE0121F0  PERCENTAGE (2) INVALID                    *   S01176
     F*   53  - S/SE0121F0  PERCENTAGE (3) INVALID                    *   S01176
     F*   54  - S/SE0121F0  PERCENTAGE (4) INVALID                    *   S01176
     F*   55  - S/SE0121F0  PERCENTAGE (5) INVALID                    *   S01176
     F*   56  - S/SE0121F0  PERCENTAGE (6) INVALID                    *   S01176
     F*   57  - S/SE0121F0  PERCENTAGE (7) INVALID                    *   S01176
     F*   58  - S/SE0121F0  PERCENTAGE (8) INVALID                    *   S01176
     F*   59  - S/SE0121F0  PERCENTAGE (9) INVALID                    *   S01176
     F*   60  - S/SE0121F0  PERCENTAGE (10) INVALID                   *   S01176
     F*   61  - S/SE0121F0  PERCENTAGE (11) INVALID                   *   S01176
     F*   62  - S/SE0121F0  PERCENTAGE (12) INVALID                   *   S01176
     F*   63  - S/SE0121F0  PERCENTAGE (13) INVALID                   *   S01176
     F*   64  - S/SE0121F0  PERCENTAGE (14) INVALID                   *   S01176
     F*   65  - S/SE0121F0  PERCENTAGE (15) INVALID                   *   S01176
     F*   66  - S/SE0121F0  FLAT CHARGE(1) INVALID                    *   S01176
     F*   67  - S/SE0121F0  FLAT CHARGE(2) INVALID                    *   S01176
     F*   68  - S/SE0121F0  FLAT CHARGE(3) INVALID                    *   S01176
     F*   69  - S/SE0121F0  FLAT CHARGE(4) INVALID                    *   S01176
     F*   70  - S/SE0121F0  FLAT CHARGE(5) INVALID                    *   S01176
     F*   71  - S/SE0121F0  FLAT CHARGE(6) INVALID                    *   S01176
     F*   72  - S/SE0121F0  FLAT CHARGE(7) INVALID                    *   S01176
     F*   73  - S/SE0121F0  FLAT CHARGE(8) INVALID                    *   S01176
     F*   74  - S/SE0121F0  FLAT CHARGE(9) INVALID                    *   S01176
     F*   75  - S/SE0121F0  FLAT CHARGE(10) INVALID                   *   S01176
     F*   76  - S/SE0121F0  FLAT CHARGE(11) INVALID                   *   S01176
     F*   77  - S/SE0121F0  FLAT CHARGE(12) INVALID                   *   S01176
     F*   78  - S/SE0121F0  FLAT CHARGE(13) INVALID                   *   S01176
     F*   79  - S/SE0121F0  FLAT CHARGE(14) INVALID                   *   S01176
     F*   80  - S/SE0121F0  FLAT CHARGE(15) INVALID                   *   S01176
     F*   81  - S/SE0121F0  MIN CHARGE INVALID                        *   S01176
     F*   82  - S/SE0121F0  MAX CHARGE INVALID                        *   S01176
     F*                                                               *   S01176
     F****70**-*ADD*RECORD*********************************************   S01176
     F****77**-*REPEAT*ERROR*CODE*INHIBITOR****************************   S01176
     F****75**-*AUTOCHARGES*NOT*PRESENT********************************   S01176
     F*   83  - ADD RECORD                                            *   S01176
     F*   84  - REPEAT ERROR CODE INHIBITOR                           *   S01176
     F*   85  - AUTOCHARGES NOT PRESENT                               *   S01176
     F*   86  - S/SE0121F0  REBATE APPLICABLE INVALID                 *   S01176
     F*   87  - CHECK THAT CCOM IS NUMERIC                            *   E20816
     F*                                                               *   S01176
     F*   88  - GROUP CHARGE INDICATOR ERROR                          *   S01446
     F*   89  - GROUP CHARGE CODE ERROR                               *   S01446
     F*                                                               *
     F*   98  - DATF = MMDDYY                                         *
     F*   99  - WORK                                                  *
     F*                                                               *
     F*   U7  - Database Error                                        *
     F*   U8  - Program Error                                         *
     F*                                                               *
     F*   'AID' Values used                                           *
     F*                                                               *
     F*   01  - CA3                                                   *
     F*   04  - CA10                                                  *
     F*   05  - CA12                                                  *
     F*   RA  - ENTER Pressed                                         *
     F*   UP  - ROLLUP                                                *
     F*   DN  - ROLLDOWN                                              *
     F****HP**-*HELP*PRESSED*******************************************   S01199
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*   INIT     - INITIALISATION OF STANDARD FIELDS ACCESS OF      *
     F*              STANDING DATA                                    *
     F*   START    - OUTPUT AND PROCESS KEY FIELDS SCREEN             *
     F*   REVIEW   - PROCESS SUBFILE SELECTION SCREEN                 *
     F*   UPDATE   - PROCESS DETAIL SCREEN AND UPDATE FILE            *
     F*   VALIDK   - VALIDATE KEY FIELDS                              *
     F*   VALIDD   - VALIDATE DETAIL SCREEN                           *
     F*   INITRC   - INITIALISE ALL FILE FIELDS TO ZERO/BLANK         *
     F*   TRSFS    - FORMAT RECORD FIELDS FOR SCREEN                  *
     F*   UPDFLS   - UPDATE FILE RECORDS                              *
     F*   UPDOWS   - PROCESS UPDATE BY ANOTHER WORKSTATION            *
     F*   INFSR    - FILE ERROR HANDLING S/R                          *
     F*   INTAB    - SET-UP SCREEN TABLES WITH EDITED VALUES          *
     F*   FLDCHK   - SUBROUTINE TO VALIDATE REPEATED FIELDS           *
     F*   UPLCHK   - CHECK UPPER RANGE LIMIT                          *
     F*   PERCHK   - VALIDATE PERCENTAGES FIELDS                      *
     F*   FLCCHK   - VALIDATE FLAT RATE CHARGES                       *
     F*   NUMCHK   - CHECK VALUES ARE NUMERIC OR HAVE CORRECT         *
     F*              NUMBER OF DECIMAL PLACES                         *
     F*   SCNERR   - FILE ERROR HANDLING S/R  FOR REPEATED FLDS       *
     F*                                                               *
     F*   *PSSR    - HANDLES ABNORMAL ERROR CONDITIONS                *   S01117
     F*                                                               *
     F*   ZALIGN   - VALIDATE AMOUNT FIELDS                           *
     F*   ZEDIT    - FORMAT AMOUNT FIELDS FOR DISPLAY                 *
     F*   ZTNLU1   - ACCESS DATAAREA FOR NEXT TRANSACTION NO.         *
     F*                                                               *
     F*****************************************************************
      /EJECT
     E                    CPY@    1   1 80
     E                    DET       272  1
     E** ARRAY FOR COMMIT TEXT
     E                    D         272  1
     E** ARRAY FOR COMMIT TEXT
     E                    ERR        19  4
     E** ARRAY FOR ERROR MESSAGES
     E                    INF     1  12 76
     E** ARRAY FOR INFORMATION MESSAGES
     E/COPY ZSRSRC,ZSEDITZ1
     E/COPY ZSRSRC,ZALIGNZ1
     E** SR.ARRAY FOR BOTH ZALIGN AND ZEDIT
     E                    NCA         9 13 0
     E** ARRAY FOR NUMERIC COMM AMT
     E                    ACA         9 14
     E** ARRAY FOR ALPHA COMM AMT
     E                    PK          5  1
     E** ARRAY FOR PCBCDA CHECK
     E*         FIELDS USED BY ZASIGN
     E/COPY ZSRSRC,ZASIGNZ1
     E*        SCREEN DATA ARRAYS
     E*              UPPER RANGE LIMIT ARRAY DERIVED FROM SCREEN
     E***********         UPL         9 17                                S01176
     E                    UPL        14 17                                S01176
     E*              PERCENTAGE ARRAY  DERIVED FROM SCREEN
     E***********         PER        10  8                                S01176
     E/COPY WNCPYSRC,SE0121E001
     E                    PER        15  8                                S01176
     E/COPY WNCPYSRC,SE0121E002
     E*              FLAT CHARGE ARRAY DERIVED FROM SCREEN
     E***********         FLC        10 17                                S01176
     E                    FLC        15 17                                S01176
     E*              UPPER RANGE LIMIT ARRAY USED TO INPUT INTO FILE
     E***********         FUL         9 15 0                              S01176
     E                    FUL        14 15 0                              S01176
     E*              PERCENTAGE ARRAY  USED TO INPUT INTO FILE
     E***********         FPR        10  7 0                              S01176
     E                    FPR        15  7 0                              S01176
     E*              FLAT CHARGE ARRAY USED TO INPUT INTO FILE
     E***********         FFC        10 15 0                              S01176
     E                    FFC        15 15 0                              S01176
     E                    CCN       200  3               CURRENCY NAME ARR
     E                    CCD       200  1 0             CURRENCY POINT AR
     E*              ALPHA TO NUMERIC LOSING DEC PTS WORK FIELDS
     E                    INA        17  1
     E                    OTA        15  1                             ARR
      /EJECT
     ISECGTDFZ                                                            S01446
     I              RECI                            RECIX2                S01446
     I              CCY                             CCYX2                 S01446
     I              CCOM                            CCOMX2                S01446
     I              CHGB                            CHGBX2                S01446
     I              THRI                            THRIX2                S01446
     I              CHNR                            CHNRX2                S01446
     I              TXAP                            TXAPX2                S01446
     I              REBA                            REBAX2                S01446
     I              STU1                            STU1X2                S01446
     I              STU2                            STU2X2                S01446
     I              STU3                            STU3X2                S01446
     I              STU4                            STU4X2                S01446
     I              STU5                            STU5X2                S01446
     I              STU6                            STU6X2                S01446
     I              STU7                            STU7X2                S01446
     I              STU8                            STU8X2                S01446
     I              STU9                            STU9X2                S01446
     I              ST10                            ST10X2                S01446
     I              ST11                            ST11X2                S01446
     I              ST12                            ST12X2                S01446
     I              ST13                            ST13X2                S01446
     I              ST14                            ST14X2                S01446
     I              PL01                            PL01X2                S01446
     I              PL02                            PL02X2                S01446
     I              PL03                            PL03X2                S01446
     I              PL04                            PL04X2                S01446
     I              PL05                            PL05X2                S01446
     I              PL06                            PL06X2                S01446
     I              PL07                            PL07X2                S01446
     I              PL08                            PL08X2                S01446
     I              PL09                            PL09X2                S01446
     I              PL10                            PL10X2                S01446
     I              PL11                            PL11X2                S01446
     I              PL12                            PL12X2                S01446
     I              PL13                            PL13X2                S01446
     I              PL14                            PL14X2                S01446
     I              PL15                            PL15X2                S01446
     I              FC01                            FC01X2                S01446
     I              FC02                            FC02X2                S01446
     I              FC03                            FC03X2                S01446
     I              FC04                            FC04X2                S01446
     I              FC05                            FC05X2                S01446
     I              FC06                            FC06X2                S01446
     I              FC07                            FC07X2                S01446
     I              FC08                            FC08X2                S01446
     I              FC09                            FC09X2                S01446
     I              FC10                            FC10X2                S01446
     I              FC11                            FC11X2                S01446
     I              FC12                            FC12X2                S01446
     I              FC13                            FC13X2                S01446
     I              FC14                            FC14X2                S01446
     I              FC15                            FC15X2                S01446
     I              LPSI                            LPSIX2                S01446
     I              MNCH                            MNCHX2                S01446
     I              MXCH                            MXCHX2                S01446
     I              LCD                             LCDX2                 S01446
     I              CHTP                            CHTPX2                S01446
     I              TNLU                            TNLUX2                S01446
     I              OWOT                            OWOTX2                S01446
     I              GCCI                            GCCIX2                S01446
     I              GCCO                            GCCOX2                S01446
     I              PRFC                            PRFCX2                CAC002
     I              BOTR                            BOTRX2                CAC002
     I              SWID                            SWIDX2                CSW098
      *                                                                   S01446
     ICPYR@#      DS
     I**  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION           S01176
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*
     ISCRCTL      DS
     I*
     I**  KEY FIELDS (TAKEN FROM 'KEY' PORTION OF SCREEN)
     I*
     I                                        1   1 REVW
     I                                        2   2 ACTN
     I                                        3 007 INPK
     I                                        3 005 CCY
     I                                      006 007 SCGCM
     I                                      008 012 PK
     I                                      008 012 PAGK
     I**********                            008 010 PCCY                                    BUG10756
     I**********                            011 012 PCGCMA                                  BUG10756
     I*
     I**  DATA STRUCTURE FOR NUMERIC FIELDS TO NUMERIC ARRAY MOVES
     I*
     I            DS
     I***********                             1 135 FULA                  S01176
     I***********                             1 135 FUL                   S01176
     I                                        1 210 FULA                  S01176
     I                                        1 210 FUL                   S01176
     I*
     I**  DATA STRUCTURE FOR NUMERIC FIELDS TO NUMERIC ARRAY MOVES
     I*
     I            DS
     I***********                             1  70 FPRA                  S01176
     I***********                             1  70 FPR                   S01176
     I                                        1 105 FPRA                  S01176
     I                                        1 105 FPR                   S01176
     I*
     I**  DATA STRUCTURE FOR NUMERIC FIELDS TO NUMERIC ARRAY MOVES
     I*
     I            DS
     I***********                             1 150 FFCA                  S01176
     I***********                             1 150 FFC                   S01176
     I                                        1 225 FFCA                  S01176
     I                                        1 225 FFC                   S01176
     I*
     I**  SECOND PART OF SCREEN
     I*
     ISCRN2D      DS                             34
     I                                        1  17 SMNCH
     I                                       18  34 SMXCH
     I*
     I**  INPUT LAYOUT CHARGE RANGE UPPER LIMIT FOR SCREEN
     I*RLTAB******DS                            153                       S01176
     IURLTAB      DS                            238                       S01176
     I                                        1  17 URL1
     I                                       18  34 URL2
     I                                       35  51 URL3
     I                                       52  68 URL4
     I                                       69  85 URL5
     I                                       86 102 URL6
     I                                      103 119 URL7
     I                                      120 136 URL8
     I                                      137 153 URL9
     I                                      154 170 URL10                 S01176
     I                                      171 187 URL11                 S01176
     I                                      188 204 URL12                 S01176
     I                                      205 221 URL13                 S01176
     I                                      222 238 URL14                 S01176
     I*
     I**  INPUT LAYOUT FOR  PERCENTAGE LEVELS FOR SCREEN
     I*ERTAB******DS                             80                       S01176
     I/COPY WNCPYSRC,SE0121I001
     IPERTAB      DS                            120                       S01176
     I                                        1   8 PER1
     I                                        9  16 PER2
     I                                       17  24 PER3
     I                                       25  32 PER4
     I                                       33  40 PER5
     I                                       41  48 PER6
     I                                       49  56 PER7
     I                                       57  64 PER8
     I                                       65  72 PER9
     I                                       73  80 PER10
     I                                       81  88 PER11                 S01176
     I                                       89  96 PER12                 S01176
     I                                       97 104 PER13                 S01176
     I                                      105 112 PER14                 S01176
     I                                      113 120 PER15                 S01176
     I/COPY WNCPYSRC,SE0121I002
     I*
     I**  INPUT LAYOUT FOR FLAT CHARGES FOR SCREEN
     I*CHTAB******DS                            170                       S01176
     IFCHTAB      DS                            255                       S01176
     I                                        1  17 FCH1
     I                                       18  34 FCH2
     I                                       35  51 FCH3
     I                                       52  68 FCH4
     I                                       69  85 FCH5
     I                                       86 102 FCH6
     I                                      103 119 FCH7
     I                                      120 136 FCH8
     I                                      137 153 FCH9
     I                                      154 170 FCH10
     I                                      171 187 FCH11                 S01176
     I                                      188 204 FCH12                 S01176
     I                                      205 221 FCH13                 S01176
     I                                      222 238 FCH14                 S01176
     I                                      239 255 FCH15                 S01176
     I*ETREC****E*DSSECGTD
     I*
     I**   OUTPUT LAYOUT CHARGE RANGE UPPER LIMIT
     I*TUTAB******DS                            135                       S01176
     ISTUTAB      DS                            210                       S01176
     I                                        1  150STU1
     I                                       16  300STU2
     I                                       31  450STU3
     I                                       46  600STU4
     I                                       61  750STU5
     I                                       76  900STU6
     I                                       91 1050STU7
     I                                      106 1200STU8
     I                                      121 1350STU9
     I                                      136 1500ST10                  S01176
     I                                      151 1650ST11                  S01176
     I                                      166 1800ST12                  S01176
     I                                      181 1950ST13                  S01176
     I                                      196 2100ST14                  S01176
     I*
     I**  OUTPUT LAYOUT FOR  PERCENTAGE LEVELS
     I*LCTAB******DS                             70                       S01176
     IPLCTAB      DS                            105                       S01176
     I                                        1   74PL01
     I                                        8  144PL02
     I                                       15  214PL03
     I                                       22  284PL04
     I                                       29  354PL05
     I                                       36  424PL06
     I                                       43  494PL07
     I                                       50  564PL08
     I                                       57  634PL09
     I                                       64  704PL10
     I                                       71  774PL11                  S01176
     I                                       78  844PL12                  S01176
     I                                       85  914PL13                  S01176
     I                                       92  984PL14                  S01176
     I                                       99 1054PL15                  S01176
     I*
     I**  OUTPUT LAYOUT FOR FLAT CHARGES
     I*CLTAB******DS                            150                       S01176
     IFCLTAB      DS                            225                       S01176
     I                                        1  150FC01
     I                                       16  300FC02
     I                                       31  450FC03
     I                                       46  600FC04
     I                                       61  750FC05
     I                                       76  900FC06
     I                                       91 1050FC07
     I                                      106 1200FC08
     I                                      121 1350FC09
     I                                      136 1500FC10
     I                                      151 1650FC11                  S01176
     I                                      166 1800FC12                  S01176
     I                                      181 1950FC13                  S01176
     I                                      196 2100FC14                  S01176
     I                                      211 2250FC15                  S01176
     I*
     ISCRMSG      DS                          1 152
     I*
     I**  DATA STRUCTURE FOR ERROR MESSAGES TO SCREEN
     I*
     I                                        1  76 ERR
     I                                        1  76 ERRMSG
     I                                       77 152 INFMSG
     I*
     ISCRDS       DS
     I*
     I**  DISPLAY FORMAT STATUS DATA STRUCTURE
     I*
     I                                      287 288 AID
     IINFDS       DS
     I*
     I**  DATA STRUCTURE FOR RPG 01021 ERROR HANDLING
     I*
     I                                     *STATUS  STATUS
     I*
     I*DA********UDS                            256                       S01117
     ILDA         DS                            256                       S01117
     I*
     I**  LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I** *LOCK IN LDA immediately before and OUT LDA immediately          S01117
     I** after each database error handling.                              S01117
     I*
     I***********                           134 177 DBLOT                 S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 1770DBASE                 S01117
     I                                      134 183 DBLOT                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     I*
     I/COPY ZSRSRC,ZSEDITZ2
     I*
     I/COPY ZSRSRC,ZTNLU1Z1
     I*
     ICMTTXT      DS
     I*
     I**  DATA STRUCTURE FOR SETUP OF COMMIT TEXT
     I*
     I                                        1   50NATN
     I                                        6   7 MDID
     I                                        8  15 PGMN
     I                                       16  18 WSIDX
     I                                       19  240MTIME
     I                                       25  25 ACTNX
     I                                       26  35 USIDX
     I                                       51 322 DET
     I                                       51 322 D
     I*
     IPSDS       SDS
     I*
     I**  PROGRAM STATUS DATA STRUCTURE FOR WS/USER ID'S
     I*
     I                                      244 246 WSID
     I                                      254 263 USID
     I**                                                                  S01117
     IRUNDT       DS                                                      S01117
     I** DATA AREA RUNDAT                                                 S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
     I**                                                                  S01117
     IZMUSER      DS                             17                       S01117
      ** DATA AREA OF MENU USER                                           S01117
     I                                       11  13 USRBCH                S01117
     I**                                                                  S01117
     ISESTAT    E DSSESTAT                                                CAC002
      ** Data structure for data area SESTAT                              CAC002
      *                                                                   CAC002
     ISDCURR    E DSSDCURRPD                                              S01117
     I** CURRENCY DETAILS                                                 S01117
     I**                                                                  S01117
     ISDSTRD    E DSSDSTRDPD                                              S01117
     I** SECURITIES TRADING ICD                                           S01117
     I**                                                                  S01117
     ISDMMOD    E DSSDMMODPD                                              CAC002
      ** MIDAS Modules                                                    CAC002
      *                                                                   CAC002
     ISDPRFC    E DSSDPRFCPD                                              CAC002
      ** Profit Centres                                                   CAC002
      *                                                                   CAC002
     IDSFDY     E DSDSFDY                                                 CAC002
      ** First DS for access programs, short data structure               CAC002
      *                                                                   CAC002
     IDSSDY     E DSDSSDY                                                 S01117
     I*  SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE               S01117
     I*
      *================================================================
      *  P R O G R A M   S T A R T                                    *
      *================================================================
     C*
     C**  DEFINE KEY LIST FOR CHAINING TO SECGT FILE
     C*
     C           SECGTK    KLIST
     C                     KFLD           CCY
     C                     KFLD           CCOM
     C*
     C**  PERFORM SETUP OF STANDARD FIELDS AND ACCESS STANDING DATA
     C*
     C                     EXSR INIT
      *
      ***  Do Until CF/3 or error
      *
     C           AID       DOUEQ'01'
     C           *INU7     OREQ '1'
     C*
     C**  DETERMINE WHICH SCREEN REQUIRED
     C*
     C           *IN10     CASEQ'1'       START
     C           *IN11     CASEQ'1'       REVIEW
     C           *IN12     CASEQ'1'       UPDATE
     C                     END
     C*
     C***********   Call S/R to move values into AID               S01179 E17698
     C***********                                                  S01179 E17698
     C***********          EXSR ASCHGS                             S01179 E17698
     C                     END
     C*
      *================================================================
      *  P R O G R A M   E N D                                        *
      *                                                               *
     C                     SETON                         LR
      *                                                               *
      *================================================================
      /EJECT
     C*****************************************************************
     C*
     C*  INIT S/R - TO INITIALISE STATIC FIELDS AND ACCESS STANDING DATA
     C*  CALLED ONCE  FROM MAIN LINE PROCESSING
     C*
     C*****************************************************************
     C*
     C           INIT      BEGSR                           ** INIT  BSR **
     C*
     C**  PREPARE LDA
     C*
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL*BLANK    DBLOT                           S01117
     C                     MOVEL'SE0121'  DBPGM
     C                     OUT  LDA                                       S01117
     C*
     C**  PREPARE COMIT TEXT
     C*
     C                     MOVEL'SE'      MDID
     C                     MOVEL'SE0121'  PGMN
     C                     MOVELWSID      WSIDX
     C                     MOVELUSID      USIDX
     C*
     C****HELP*PROGRAM*PARAMETER***************************************   S01199
     C***********                                                         S01199
     C***********          MOVEL'SE0121'  HBPGM   8                       S01199
     C                     MOVEL*BLANK    WBLNK   1
     C*
     C**  FOR HIGH INTENSITY SCREEN ATTRIBUTE
     C*
     C                     BITOF'01234567'HI      1
     C                     BITON'267'     HI
     C                     MOVELHI        INF,8
     C                     MOVELHI        INF,9
     C                     MOVELHI        INF,10
     C                     MOVELHI        INF,11
     C                     MOVELHI        INF,12
     C*
     C***GET*INSTALLATION*CONTROL*DATA*RECORD*1***************************S01117
     C***********                                                         S01117
     C***********          READ TABTB10F                 99               S01117
     C**N99******RECI      COMP 'D'                  9999  ON, IS DELETED S01117
     C************IN99     IFEQ '0'                                       S01117
     C*                                                                   S01117
     C** IN THE DATAAREA RUNDAT & ZMUSER                                  S01117
     C*                                                                   S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C           *NAMVAR   DEFN           ZMUSER                          S01117
     C                     IN   RUNDT                                     S01117
     C                     IN   ZMUSER                                    S01117
     C*                                                                   S01117
     C*
     C***IF*FOUND*CHECK*SYSTEM*DATE*FORMAT,*DDMMYY*OR*MMDDYY.*************S01117
     C** CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.                      S01117
     C*
     C           DATF      COMP 'M'                      98MMDDYY, 98 ON
     C***********          ELSE                                           S01117
     C***********                                                         S01117
     C***OTHERWISE DB ERROR                                               S01117
     C***********                                                         S01117
     C***********          SETON                     U7U8  ***************S01117
     C***********          MOVEL'01'      DBASE            **DB ERROR 01**S01117
     C***********          MOVEL'TABSE'   DBFILE           ***************S01117
     C***********          MOVEL'01'      ZTABKY 12                       S01117
     C***********          MOVE '10'      ZTABKY                          S01117
     C***********          MOVELZTABKY    DBKEY                           S01117
     C***********          END                                            S01117
     C*
     C****GET*INSTALLATION*CONTROL*DATA*RECORD*36**********************   S01117
     C*
     C************IN99     IFEQ '0'                                       S01117
     C************         READ TABTB36F                 99               S01117
     C*
     C****DB*ERROR*IF*DELETED******************************************   S01117
     C*
     C**N99******RECI      COMP 'D'                  9999                 S01117
     C************IN99     IFEQ '1'                                       S01117
     C*
     C***********          SETON                     U7U8  ***************S01117
     C***********          MOVEL'03'      DBASE            **DB ERROR 03**S01117
     C***********          MOVEL'TABSE'   DBFILE           ***************S01117
     C***********          MOVEL'01'      ZTABKY 12                       S01117
     C***********          MOVE '36'      ZTABKY                          S01117
     C***********          MOVELZTABKY    DBKEY                           S01117
     C***********          END                                            S01117
     C***********          END                                            S01117
      *                                                                   CAC002
      **  Access MIDAS Modules                                            CAC002
      *                                                                   CAC002
     C                     CALL 'AOMMODR0'                                CAC002
     C                     PARM '*DBERR'  @RTCD                           CAC002
     C                     PARM '*FIRST'  @OPTN                           CAC002
     C           SDMMOD    PARM SDMMOD    DSFDY                           CAC002
      *                                                                   CAC002
      **  Set up analytical accounting indicator                          CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE '1'       *IN13                           CAC002
     C                     ENDIF                                          CAC002
     C*
     C* Get Securities Trading Data by access object                      S01117
     C*                                                                   S01117
     C                     CALL 'AOSTRDR0'                                S01117
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C           SDSTRD    PARM SDSTRD    DSSDY                           S01117
     C*                                                                   S01117
     C***IF*AUTO-CHARGES*INDICATOR*#*Y*SETON*INDICATOR*75*(PROTECT ETC)   S01176
     C** IF AUTO-CHARGES INDICATOR # Y SETON INDICATOR 85 (PROTECT ETC)   S01176
     C*
     C***********AUMO      IFNE 'Y'                                       S01117
     C           BVACOP    IFNE 'Y'                                       S01117
     C***********          MOVEA'1'       *IN,75                          S01176
     C                     MOVEA'1'       *IN,85                          S01176
     C                     END
      *                                                                   CAC002
      **  Check if portfolio customers are licensed                       CAC002
      *                                                                   CAC002
     C           *NAMVAR   DEFN           SESTAT                          CAC002
     C                     IN   SESTAT                                    CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C           PFPL      ANDEQ'Y'                                       CAC002
     C                     MOVE '1'       *IN14                           CAC002
     C                     ENDIF                                          CAC002
     C*
     C**  PROCEED TO START SCREEN UNLESS DATABASE ERRPR
     C*
     C           *INU7     IFNE '1'
     C                     MOVEA'1'       *IN,10
     C                     END
      *                                                                   S01401
      **  Access SAR details file to see if MT5xx SAR is installed.       S01401
      *                                                                   S01401
     C                     CALL 'AOSARDR0'                                S01401
     C                     PARM '       ' @RTCD                           S01401
     C                     PARM '*VERIFY' @OPTN                           S01401
     C                     PARM 'S01401'  WSARD   6                       S01401
      *                                                                   S01401
     C           @RTCD     IFEQ *BLANK                                    S01401
     C                     MOVE 'Y'       S01401  1                       S01401
     C                     SETON                     28                   S01401
     C                     END                                            S01401
      *                                                                   S01401
      *** Protect group charge fields                                     S01446
      *                                                                   S01446
     C                     SETON                     09                   S01446
      *                                                                   S01446
      *** Check S01446 has been installed                                 S01446
      *                                                                   S01446
     C                     CALL 'AOSARDR0'                                S01446
     C                     PARM *BLANKS   @RTCD                           S01446
     C                     PARM '*VERIFY' @OPTN                           S01446
     C                     PARM 'S01446'  WSARD                           S01446
      *                                                                   S01446
     C           @RTCD     IFEQ *BLANK                     *B1            S01446
     C                     MOVE 'Y'       S01446  1                       S01446
      *                                                                   S01446
      *** Unprotect group charge fields if both autocharge and S01446     S01446
      *** flag are ON                                                     S01446
     C           BVACOP    IFEQ 'Y'                        *B2            S01446
     C                     SETOF                     09                   S01446
     C                     END                             *E2            S01446
      *                                                                   S01446
     C                     ELSE                            *X1            S01446
     C                     MOVE 'N'       S01446                          S01446
     C                     END                             *E1            S01446
      *                                                                   S01446
      *** If autocharge and S01446 flag ON, and charges currency from     S01446
      *** SE ICD file is not blank, then use number of decimal places     S01446
      *** if SE ICD currency when formatting all amounts.                 S01446
      *                                                                   S01446
     C           S01446    IFEQ 'Y'                        *B1            S01446
     C           BVACOP    ANDEQ'Y'                                       S01446
     C           BVCHRC    IFNE *BLANKS                    *B2            S01446
     C                     CALL 'AOCURRR0'                                S01446
     C                     PARM *BLANKS   @RTCD                           S01446
     C                     PARM '*KEY'    @OPTN                           S01446
     C                     PARM BVCHRC    @CCY    3                       S01446
     C           SDCURR    PARM SDCURR    DSSDY                           S01446
      *                                                                   S01446
     C           @RTCD     IFNE *BLANK                     *B3            S01446
     C           *LOCK     IN   LDA                        ***************S01446
     C                     Z-ADD4         DBASE            **DB ERROR 004*S01446
     C                     MOVEL'SDCURRPD'DBFILE           ***************S01446
     C                     MOVELBVCHRC    DBKEY                           S01446
     C                     OUT  LDA                                       S01446
     C                     EXSR *PSSR                                     S01446
     C                     ELSE                            *X3            S01446
     C                     Z-ADDA6NBDP    UBNDP   10                      S01446
     C                     END                             *E3            S01446
      *                                                                   S01446
     C                     END                             *E2            S01446
     C                     END                             *E1            S01446
      *                                                                   S01446
      ** Check if SWIFT Changes 2010 (CSW210) is installed                                    CSW210
      *                                                                                       CSW210
     C                     CALL 'SWIF2010'                                                    CSW210
     C                     PARM *BLANKS   PRTCD   7                                           CSW210
      *                                                                                       CSW210
     C           PRTCD     IFEQ 'CSW2010'                                                     CSW210
     C                     MOVE 'Y'       CSW210  1                                           CSW210
     C                     ELSE                                                               CSW210
     C                     MOVE 'N'       CSW210                                              CSW210
     C                     ENDIF                                                              CSW210
      *                                                                   CSW098
      ** Check to see if switchable feature CSW098 is on or if date is    CSW098
      ** greater than 16 October 1998.                                    CSW098
     C                     CALL 'SWIFT98'              18                 CSW098
     C                     PARM           SWRTN   7                       CSW098
      *                                                                   CSW098
     C           *IN18     IFEQ *ON                        ***************CSW098
     C           *LOCK     IN   LDA                        **DB ERROR 005*CSW098
     C                     MOVEL'SE0121'  DBPGM            ***************CSW098
     C                     MOVEL'05'      DBASE                           CSW098
     C                     MOVEL'ERR CALL'DBFILE                          CSW098
     C                     MOVEL'SWIFT98' DBKEY                           CSW098
     C                     OUT  LDA                                       CSW098
     C                     EXSR *PSSR                                     CSW098
     C                     ENDIF                                          CSW098
      *                                                                   CSW098
     C           SWRTN     IFEQ 'CSW098 '                                 CSW098
     C           S01401    ANDEQ'Y'                                       CSW098
     C                     MOVE *ON       *IN16                           CSW098
     C                     ENDIF                                          CSW098
     C/COPY WNCPYSRC,SE0121C001
      *                                                                                       CSW212
      ** Check if SWIFT Changes 2012 (CSW212) is installed                                    CSW212
      *                                                                                       CSW212
     C                     CALL 'SWIF2012'                                                    CSW212
     C                     PARM *BLANKS   @RTCD                                               CSW212
      *                                                                                       CSW212
     C           @RTCD     IFEQ 'CSW2012'                                                     CSW212
     C                     MOVE 'Y'       CSW212  1                                           CSW212
     C                     ELSE                                                               CSW212
     C                     MOVE 'N'       CSW212                                              CSW212
     C                     ENDIF                                                              CSW212
      *                                                                   CSW098
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*
     C*  START  - S/R TO OUTPUT AND PROCESS KEY FIELDS SCREEN
     C*  CALLED FROM: MAIN PROCESSING
     C*  CALLS: VALIDK TO VALIDATE KEY FIELDS IF ENTERED
     C*
     C*****************************************************************
     C*
     C           START     BEGSR                           ** START BSR **
     C*
     C**  INITIALISE SCREEN DATA
     C*
     C                     MOVEA'0'       *IN,10
     C                     MOVEA'000'     *IN,21
     C                     MOVEL*BLANK    SCRCTL
     C                     MOVELINF,1     INFMSG
     C*
     C**  CLEAR WHOLE SCREEN
     C*
     C                     WRITESE0121F3
     C*
     C** D O    U N T I L   C H A N G E  O F  S C R E E N  -  S T A R T
     C*
     C           *IN10     DOUEQ'1'
     C           *IN11     OREQ '1'
     C           *IN12     OREQ '1'
      *                                                                                     BUG10756
     C                     MOVEL*BLANK    PCCY                                              BUG10756
     C                     MOVEL*BLANK    PCGCMA                                            BUG10756
      *
      ***  Start Screen Output
      *
     C*********************WRITESE0121F1                                  CAAA02
     C                     WRITESE0121F2
     C                     WRITESE0121F1                                  CAAA02
     C                     READ SE0121F1                 99
     C                     MOVELERRMSG    HERCD 160
     C                     MOVELWBLNK     HERCD
     C                     MOVEL*BLANK    SCRMSG
     C*
     C** F 3 , H E L P , O R  E N T E R   P R E S S E D  -  S T A R T
     C*
     C**  F3 - TERMINATE
     C*
     C**  Call S/R to move values into AID                                S01179
     C*                                                                   S01179
     C                     EXSR ASCHGS                                    S01179
     C*                                                                   S01179
     C           AID       IFEQ '01'
     C                     MOVEA'1'       *IN,10
     C*
     C***HELP*-*CALL*HELP*PROGRAM**************************************
     C***********                                                         S01199
     C***********          ELSE                                           S01199
     C***********AID       IFEQ 'HP'                                      S01199
     C***********          MOVELHERCD     ERRMSG                          S01199
     C***********ERR,1     IFNE *BLANK                                    S01199
     C***********          MOVELHI        ERRMSG                          S01199
     C***********          END                                            S01199
     C***********          CALL 'MHELP'                                   S01199
     C***********          PARM           HBPGM                           S01199
     C***********          PARM           HERCD                           S01199
     C*
     C**  ENTER TAKEN VALIDATE KEY INPUT
     C*
     C                     ELSE
     C*
     C** Check if selection is requested                                  S01117
     C*                                                                   S01117
     C                     MOVE 'N'       @SEL    1                       S01117
     C*                                                                   S01117
     C                     MOVELCCY       @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM *BLANK    @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM CCY       @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVE A6CYCD    CCY                             S01117
     C                     ELSE                                           S01117
     C                     MOVE *BLANKS   CCY                             S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*   Validate if selection was not requested for the currency.       s01117
     C           @SEL      IFEQ 'N'                                       S01117
     C*                                                                   S01117
     C                     EXSR VALIDK
      *
      ***  Determine Screen change
      *
     C**  IF NO ERRORS, DETERMINE NEXT SCREEN
     C*
     C           SCRMSG    IFEQ *BLANK
     C*
     C**  - IF KEY FIELD IS BLANK, NEXT SCREEN IS REVIEW SCREEN
     C*
     C           CCY       IFEQ *BLANK
     C                     MOVEA'1'       *IN,11
     C*
     C**  - OTHERWISE, DISPLAY REQUESTED DETAIL SCREEN AS PER KEY INPUT
     C*
     C                     ELSE
     C                     MOVEA'1'       *IN,12
     C                     END
     C*
     C                     END
     C*
     C***********          END                                            S01199
     C*
     C** F 3 , H E L P , O R  E N T E R   P R E S S E D  -  E N D
     C                     END
     C*
     C                     END                                            S01117
     C** D O    U N T I L   C H A N G E  O F  S C R E E N  -  E N D
     C                     END
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*
     C*  REVIEW  - S/R TO PROCESS SUBFILE SELECTION SCREEN
     C*  CALLED FROM: MAIN PROCESSING
     C*  CALLS: VALIDK TO VALIDATE KEY FIELDS IF SUBFILE RECORD SELECTED
     C*
     C*****************************************************************
     C*
     C           REVIEW    BEGSR                           ** REVIEW BSR**
     C*
     C                     MOVEA'0'       *IN,11
     C*
     C**  SET PROCESSING FLAG TO FORCE SUBFILE REBUILD
     C*
     C                     MOVEL'RA'      AID
     C*
     C** D O    U N T I L   C H A N G E  O F  S C R E E N  -  S T A R T
     C*
     C           *IN10     DOUEQ'1'
     C           *IN11     OREQ '1'
     C           *IN12     OREQ '1'
     C*
     C** I F  R O L L   U P / D O W N   O R   E N T E R   P R E S S E D
     C*
     C** R E B U I L D   S U B F I L E                     -  S T A R T
     C*
     C                     MOVELINF,2     INFMSG
     C***********                                                   S01179E17698
     C***Call*S/R*to move values into AID                           S01179E17698
     C***********                                                   S01179E17698
     C***********          EXSR ASCHGS                              S01179E17698
     C***********                                                   S01179E17698
     C           AID       IFEQ 'DN'
     C           AID       OREQ 'UP'
     C           AID       OREQ 'RA'
     C*
     C**  WRITE CONTROL RECORD
     C*
     C**********           MOVEA'000'     *IN,1                                             BUG10756
     C**********           Z-ADD*ZERO     RRN                                               BUG10756
     C**********           WRITESE0121C0                                                    BUG10756
     C**********           MOVEA'1'       *IN,4                                             BUG10756
     C*
     C**  SET FILE POINTER - PAGE BACK
     C*
     C********** AID       IFEQ 'DN'                                                        BUG10756
     C**********           MOVEL*BLANK    CCY                                               BUG10756
     C**********           MOVEL*BLANK    CCOM                                              BUG10756
     C**********           MOVEL'     '   PPAGK 005                                         BUG10756
     C********** SECGTK    SETLLSECGTX                                                      BUG10756
     C*
     C**  OTHERWISE        - PAGE FORWARD
     C*
     C**********           ELSE                                                             BUG10756
     C*
     C**********           MOVELPCCY      CCY                                               BUG10756
     C**********           MOVELPCGCMA    CCOM                                              BUG10756
     C**********           MOVELPAGK      PPAGK                                             BUG10756
     C********** SECGTK    SETLLSECGTX                                                      BUG10756
     C**********           END                                                              BUG10756
     C*
     C**  READ IN DETAILS-FILL UP SUBFILE
     C*
     C**********           MOVEL*BLANK    CCNM                                              BUG10756
     C*
     C********** RRN       DOUEQ18                                                          BUG10756
     C********** CCY       ORNE CCYIN                                                       BUG10756
     C********** *IN,03    OREQ '1'                                                         BUG10756
     C*
     C**  READ DETAILS UNTIL SUBFILE PAGE IS FULL
     C**  OR CCY CHANGES FROM THAT OF 1ST READ
     C*
     C**********           READ SECGTX                   03                                 BUG10756
     C********** *IN,03    IFEQ '0'                                                         BUG10756
     C**********           MOVELCCOM      SCGCM                                             BUG10756
     C*
     C**  IF RECORD IS DELETED, FLAG IT AS SO ON SCREEN
     C*
     C********** RECI      IFEQ '*'                                                         BUG10756
     C**********           MOVEL'D'       STAT    1                                         BUG10756
     C**********           ELSE                                                             BUG10756
     C**********           MOVEL*BLANK    STAT                                              BUG10756
     C**********           END                                                              BUG10756
     C*
     C**********           ADD  1         RRN     40     04                                 BUG10756
     C*
     C** IF FIRST TIME OUTPUT TO SUBFILE, STORE RECORD CCY
     C*
     C********** RRN       IFEQ 1                                                           BUG10756
     C**********           MOVELCCY       CCYIN   3                                         BUG10756
     C*
     C** GET CURRENCY NAME TO DISPLAY ON REVIEW SCREEN
     C*
     C***********          MOVEL*BLANK    ZTABKY                          S01117
     C***********          MOVEL'20'      ZTABKY                          S01117
     C***********          MOVELCCY       WRK4A                           S01117
     C***********          MOVE '1'       WRK4A                           S01117
     C***********          MOVE WRK4A     ZTABKY                          S01117
     C***********                                                         S01117
     C***********ZTABKY    CHAINTABSE                99                   S01117
     C**********           CALL 'AOCURRR0'                                S01117            BUG10756
     C**********           PARM '*DBERR'  @RTCD   7                       S01117            BUG10756
     C**********           PARM '*KEY   ' @OPTN   7                       S01117            BUG10756
     C**********           PARM CCY       @AJCD   3                       S01117            BUG10756
     C********** SDCURR    PARM SDCURR    DSSDY                           S01117            BUG10756
     C*
     C**********           END                                                              BUG10756
     C*
     C** OUTPUT TO SUBFILE AS LONG AS CCY OF RECORD JUST READ IS SAME
     C** AS THAT FROM THE 1ST RECORD OUTPUT TO THE SUBFILE ON THIS PAGE
     C*
     C********** CCY       IFEQ CCYIN                                                       BUG10756
     C**********           WRITESE0121S0                                                    BUG10756
     C**********           END                                                              BUG10756
     C*
     C** RECORD NOW WRITTEN TO SUBFILE
     C*
     C**********           END                                                              BUG10756
     C*
     C** PAGE NOW FULL (OR EOF)
     C*
     C**********           END                                                              BUG10756
     C*
     C** READ ONE MORE RECORD FOR NEXT SCREEN
     C*
     C********** *IN,03    IFEQ '0'                                                         BUG10756
     C********** CCY       ANDEQCCYIN                                                       BUG10756
     C**********           READ SECGTX                   03                                 BUG10756
     C**********           MOVELCCOM      SCGCM                                             BUG10756
     C**********           END                                                              BUG10756
     C*
     C** IF NOT EOF SET NEXT 'REVIEW FROM' KEY ELSE SET IT TO BLANK
     C*
     C********** *IN,03    IFEQ '0'                                                         BUG10756
     C**********           MOVELINPK      PAGK                                              BUG10756
     C**********           ELSE                                                             BUG10756
     C**********           MOVEL'     '   PAGK                                              BUG10756
     C**********           END                                                              BUG10756
     C*
     C                     MOVEL*BLANK    CCYIN                                             BUG10756
     C                     MOVEA'1'       *IN,4                                             BUG10756
      *                                                                                     BUG10756
      ** Set File Pointer - Page Back                                                       BUG10756
      *                                                                                     BUG10756
     C           AID       IFEQ 'DN'                                                        BUG10756
     C                     MOVELXCCY      CCY                                               BUG10756
     C                     MOVEL*BLANK    CCOM                                              BUG10756
     C                     MOVEL*BLANK    PCCY                                              BUG10756
     C                     MOVEL*BLANK    PCGCMA                                            BUG10756
     C           SECGTK    SETGTSECGTX                                                      BUG10756
     C                     READPSECGTX                   03                                 BUG10756
     C                     MOVEL*BLANK    CCOM                                              BUG10756
     C           SECGTK    SETLLSECGTX                                                      BUG10756
     C           *IN03     IFEQ *ON                                                         BUG10756
     C                     MOVELINF,9     INFMSG                                            BUG10756
     C                     MOVE *OFF      *IN04                                             BUG10756
     C                     ENDIF                                                            BUG10756
      *                                                                                     BUG10756
      ** Otherwise        - Page Forward                                                    BUG10756
      *                                                                                     BUG10756
     C                     ELSE                                                             BUG10756
     C           AID       IFEQ 'UP'                                                        BUG10756
     C                     MOVEL*BLANK    PCCY                                              BUG10756
     C                     MOVEL*BLANK    PCGCMA                                            BUG10756
     C           SECGTK    SETLLSECGTX                                                      BUG10756
     C           *IN03     IFEQ *ON                                                         BUG10756
     C                     MOVELINF,8     INFMSG                                            BUG10756
     C                     ENDIF                                                            BUG10756
      *                                                                                     BUG10756
      ** Otherwise        - Enter                                                           BUG10756
      *                                                                                     BUG10756
     C                     ELSE                                                             BUG10756
     C                     MOVELPCCY      CCY                                               BUG10756
     C                     MOVELPCGCMA    CCOM                                              BUG10756
     C           SECGTK    SETLLSECGTX                                                      BUG10756
     C                     ENDIF                                                            BUG10756
     C                     ENDIF                                                            BUG10756
      *                                                                                     BUG10756
      ** Write Control Record                                                               BUG10756
      *                                                                                     BUG10756
     C                     MOVEA'000'     *IN,1                                             BUG10756
     C                     Z-ADD*ZERO     RRN                                               BUG10756
     C                     WRITESE0121C0                                                    BUG10756
      *                                                                                     BUG10756
      ** Read in Details-Fill Up Subfile                                                    BUG10756
      *                                                                                     BUG10756
     C                     MOVEL*BLANK    CCNM                                              BUG10756
      *                                                                                     BUG10756
     C           RRN       DOUEQ18                                                          BUG10756
     C           CCY       ORNE CCYIN                                                       BUG10756
     C           *IN,03    OREQ *ON                                                         BUG10756
      *                                                                                     BUG10756
      ** Read Details Until Subfile Page is Full                                            BUG10756
      ** Or CCY Changes from that of 1st Read                                               BUG10756
      *                                                                                     BUG10756
     C                     READ SECGTX                   03                                 BUG10756
     C           *IN,03    IFEQ *OFF                                                        BUG10756
     C           PCCY      IFEQ *BLANK                                                      BUG10756
     C                     MOVELCCY       TCCY    3                                         BUG10756
     C                     ELSE                                                             BUG10756
     C                     MOVELPCCY      TCCY                                              BUG10756
     C                     ENDIF                                                            BUG10756
     C                     MOVELCCOM      SCGCM                                             BUG10756
      *                                                                                     BUG10756
      ** If record is deleted, flag it as so on screen                                      BUG10756
      *                                                                                     BUG10756
     C           RECI      IFEQ '*'                                                         BUG10756
     C                     MOVEL'D'       STAT    1                                         BUG10756
     C                     ELSE                                                             BUG10756
     C                     MOVEL*BLANK    STAT                                              BUG10756
     C                     ENDIF                                                            BUG10756
      *                                                                                     BUG10756
     C                     ADD  1         RRN     40                                        BUG10756
      *                                                                                     BUG10756
      ** If first time output to subfile, store record ccy                                  BUG10756
      *                                                                                     BUG10756
     C           RRN       IFEQ 1                                                           BUG10756
     C           CCY       ANDEQTCCY                                                        BUG10756
     C                     MOVELCCY       XCCY    3                                         BUG10756
     C                     MOVELCCY       CCYIN   3                                         BUG10756
      *                                                                                     BUG10756
      ** Get Currency Name to display on Review Screen                                      BUG10756
      *                                                                                     BUG10756
     C                     CALL 'AOCURRR0'                                                  BUG10756
     C                     PARM '*DBERR'  @RTCD   7                                         BUG10756
     C                     PARM '*KEY   ' @OPTN   7                                         BUG10756
     C                     PARM CCY       @AJCD   3                                         BUG10756
     C           SDCURR    PARM SDCURR    DSSDY                                             BUG10756
      *                                                                                     BUG10756
     C                     ENDIF                                                            BUG10756
      *                                                                                     BUG10756
      ** Output to subfile as long as CCY of record just read is same                       BUG10756
      ** as that from the 1st record output to the subfile on this page                     BUG10756
      *                                                                                     BUG10756
     C           CCY       IFEQ CCYIN                                                       BUG10756
     C                     WRITESE0121S0                                                    BUG10756
     C                     MOVE *OFF      *IN04                                             BUG10756
     C                     ENDIF                                                            BUG10756
      *                                                                                     BUG10756
      ** Record now written to subfile                                                      BUG10756
      *                                                                                     BUG10756
     C                     ENDIF                                                            BUG10756
      *                                                                                     BUG10756
      ** Page now full (or EOF)                                                             BUG10756
      *                                                                                     BUG10756
     C                     ENDDO                                                            BUG10756
      *                                                                                     BUG10756
     C** FOR SUBFILE CONTROL
     C*
     C           *IN,4     IFEQ '1'
     C**********           MOVEA'010'     *IN,1                                             BUG10756
     C                     MOVEA'110'     *IN,1                                             BUG10756
     C                     MOVELINF,3     INFMSG
     C                     ELSE
     C                     MOVEA'11'      *IN,1
     C                     END
     C                     END
     C*
     C** R E B U I L D   S U B F I L E     -     E N D
      *
      ***  Review Screen Output
      *
     C*********************WRITESE0121C0                                  CAAA02
     C                     WRITESE0121F2
     C                     WRITESE0121C0                                  CAAA02
     C                     READ SE0121C0                 99
     C                     MOVELERRMSG    HERCD
     C                     MOVELWBLNK     HERCD
     C                     MOVEL*BLANK    SCRMSG
     C                     MOVEL*BLANK    REVW
     C*
     C** F 3 , F 12 , H E L P , R E C O R D  S E L E C T-  S T A R T
     C*
     C** Call S/R to move values into AID                                 E17698
     C*                                                                   E17698
     C                     EXSR ASCHGS                                    E17698
     C*                                                                   E17698
     C** F3 - TERMINATE
     C*
     C           AID       IFEQ '01'
     C                     MOVEA'1'       *IN,11
     C*
     C** F12 - INITIAL SCREEN
     C*
     C                     ELSE
     C           AID       IFEQ '05'
     C                     MOVEA'1'       *IN,10
     C*
     C***HELP*-*CALL*HELP*PROGRAM**************************************
     C***********                                                         S01199
     C***********          ELSE                                           S01199
     C***********AID       IFEQ 'HP'                                      S01199
     C***********          MOVELHERCD     ERRMSG                          S01199
     C***********ERR,1     IFNE *BLANK                                    S01199
     C***********          MOVELHI        ERRMSG                          S01199
     C***********          END                                            S01199
     C***********          CALL 'MHELP'                                   S01199
     C***********          PARM           HBPGM                           S01199
     C***********          PARM           HERCD                           S01199
     C*
     C** ENTER PRESSED, PROCESS RECORD SELECTION
     C*
     C                     ELSE
     C                     MOVEA'1'       *IN,99
     C           *IN,04    IFEQ '0'
     C                     READCSE0121S0                 99
     C                     END
      *
      ***  Record Select Validation
      *
     C           *IN99     IFEQ '0'
     C                     MOVELCCOM      SCGCM
     C                     EXSR VALIDK
     C*
     C**  NO ERRORS, UPDATE SCREEN CAN BE PROCESSED NEXT
     C*
     C           SCRMSG    IFEQ *BLANK
     C                     MOVEA'1'       *IN,12
     C                     MOVEL'Y'       REVW
     C                     END
     C                     END
     C*
     C                     END
     C***********          END                                            S01199
     C*
     C** F 3 , F 12 , H E L P , R E C O R D  S E L E C T - E N D
     C                     END
     C*
     C** D O    U N T I L   C H A N G E  O F  S C R E E N   - S T A R T
     C                     END
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*
     C*  UPDATE  - S/R TO PROCESS DETAIL SCREEN AND UPDATE FILE
     C*  CALLED FROM: MAIN PROCESSING
     C*  CALLS: VALIDD, UPDFLS, INITRC, TRSFS.
     C*
     C*****************************************************************
     C*
     C           UPDATE    BEGSR                           ** UPDATE BSR**
     C*
     C** SET SCREEN INDICATORS - PROTECT KEY, SET OFF ERROR INDS,
     C*
     C                     MOVEA'1'       *IN,5
     C                     MOVEA'0'       *IN,12
     C                     MOVEA'00000000'*IN,30
     C                     MOVEA'00000000'*IN,38
     C                     MOVEA'00000000'*IN,46
     C                     MOVEA'00000000'*IN,54
     C                     MOVEA'00000000'*IN,62
     C                     MOVEA'00000000'*IN,70                          S01176
     C                     MOVEA'00000'   *IN,78                          S01176
     C                     MOVEA'0'       *IN,86                          S01176
     C                     MOVEA'00'      *IN,88                          S01446
     C                     SETOF                     2427                 CAC002
     C                     MOVE *OFF      *IN17                           CSW098
     C*
     C** POSITION CURSOR  (ON NARRATIVE OR CHARGE BASIS)
     C*
     C***********AUMO      IFEQ 'Y'                                       S01117
     C           BVACOP    IFEQ 'Y'                                       S01117
     C                     MOVEA'1'       *IN,30
     C                     ELSE
     C                     MOVEA'1'       *IN,34
     C                     END
     C*
     C*
     C** ACCESS FILE RECORD FOR OLD TNLU TO CHECK AT UPDATE TIME
     C** IF NO RECORD PRESENTLY ON FILE, ZEROISE STORED TNLU
     C*
     C                     Z-ADD*ZERO     STNLU   50
     C           SECGTK    CHAINSECGTX               99
     C           *IN,99    IFEQ '0'
     C                     Z-ADDTNLU      STNLU
     C                     END
     C*
     C** IF INSERT (NEW OR OVER DELETED RECORD)
     C** INITIALIZE ALL FIELDS ON THE RECORD (IE ZEROIZE/BLANK OUT)
     C*
     C           ACTN      IFEQ 'I'
     C                     EXSR INITRC
     C                     END
     C*
     C** IF DELETED RECORD-ENQUIRY ONLY (RECI IS SET TO BLANK FOR INSERTS)
     C*
     C           RECI      IFEQ '*'
     C                     MOVEL'E'       ACTN
     C                     MOVEL'DELETED' DELT    7
     C                     ELSE
     C                     MOVEL*BLANK    DELT
     C                     END
     C*
     C** GET CURRENCY NAME TO DISPLAY ON SCREEN (AND FOR DEC PLACES)
     C*
     C***********          MOVEL*BLANK    ZTABKY                          S01117
     C***********          MOVEL'20'      ZTABKY                          S01117
     C***********          MOVELCCY       WRK4A   4                       S01117
     C***********          MOVE '1'       WRK4A                           S01117
     C***********          MOVE WRK4A     ZTABKY                          S01117
     C***********                                                         S01117
     C***********ZTABKY    CHAINTABSE                99                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM CCY       @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C*
     C** FOR ROLLUP/ROLLDOWN UPDATE CURRENT CHARGE/COMMISSION CODE
     C*
     C                     MOVELCCOM      SCGCM
     C*
     C** TRANSLATE RECORD DETAILS FROM FILE LAYOUT TO SCREEN LAYOUT
     C*
     C                     EXSR TRSFS
     C*
     C** SET UP DEFAULTS (DONE ON BLANK FIELDS)
     C*
     C** IF DELETE/ENQUIRY PROTECT FIELD INPUT ON S/SE0121F0
     C*
     C           ACTN      IFEQ 'D'
     C           ACTN      OREQ 'E'
     C                     MOVEA'1'       *IN,6
     C                     ELSE                                           066488
     C                     MOVEA'0'       *IN,6                           066488
     C                     END
      *                                                                   CAC002
      **  Default group charge code                                       CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C           ACTN      ANDEQ'I'                                       CAC002
     C                     MOVELSCGCM     SGCCO                           CAC002
     C                     ENDIF                                          CAC002
     C*
     C** D O    U N T I L   C H A N G E  O F  S C R E E N  -  S T A R T
     C*
     C           *IN10     DOUEQ'1'
     C           *IN11     OREQ '1'
     C           *IN12     OREQ '1'
      *
      ***  Load up Info Messages
      *
     C           INFMSG    IFEQ *BLANK
     C           ACTN      IFEQ 'I'
     C                     MOVELINF,4     INFMSG
     C                     END
     C           ACTN      IFEQ 'A'
     C                     MOVELINF,5     INFMSG
     C                     END
     C           ACTN      IFEQ 'E'
     C                     MOVELINF,6     INFMSG
     C                     END
     C           ACTN      IFEQ 'D'
     C                     MOVELINF,7     INFMSG
     C                     END
     C                     END
      *
      ***  Detail Screen Output
      *
     C                     WRITESE0121F1
     C/COPY WNCPYSRC,SE0121C002
     C*********************WRITESE0121F0                   CAAA02
     C/COPY WNCPYSRC,SE0121C003
     C                     WRITESE0121F2
     C/COPY WNCPYSRC,SE0121C004
     C                     WRITESE0121F0                   CAAA02
     C                     READ SE0121F0                 99
     C/COPY WNCPYSRC,SE0121C005
     C                     MOVELERRMSG    HERCD
     C                     MOVELWBLNK     HERCD
     C                     MOVEL*BLANK    SCRMSG
     C*
     C** Call S/R to move values into AID                                 E17698
     C*                                                                   E17698
     C                     EXSR ASCHGS                                    E17698
     C*                                                                   E17698
     C** F 3 , F 12 , H E L P , R O L L U P / D O W N   -  S T A R T
     C*
     C** F3 - TERMINATE
     C*
     C           AID       IFEQ '01'
     C                     MOVEA'1'       *IN,12
     C*
     C** F12 - INITIAL SCREEN
     C*
     C                     ELSE
     C           AID       IFEQ '05'
     C                     MOVEA'1'       *IN,10
     C*
     C***HELP*-*CALL*HELP*PROGRAM**************************************   S01199
     C***********                                                         S01199
     C***********          ELSE                                           S01199
     C***********AID       IFEQ 'HP'                                      S01199
     C***********          MOVELHERCD     ERRMSG                          S01199
     C***********ERR,1     IFNE *BLANK                                    S01199
     C***********          MOVELHI        ERRMSG                          S01199
     C***********          END                                            S01199
     C***********          CALL 'MHELP'                                   S01199
     C***********          PARM           HBPGM                           S01199
     C***********          PARM           HERCD                           S01199
     C*
     C** PAGE FORWARD TAKEN, READ NEXT RECORD
     C*
     C                     ELSE
     C           AID       IFEQ 'UP'
     C           ACTN      ANDNE'I'
     C                     READ SECGTX                   12
     C*
     C** CHANGE MESSAGE IF END OF FILE REACHED - NO ROLL FWD
     C*
     C           *IN,12    IFEQ '1'
     C                     MOVELINF,8     INFMSG
     C                     ELSE
     C                     MOVEA'1'       *IN,12
     C                     END
     C*
     C** PAGE BACK TAKEN, READ PREVIOUS RECORD
     C*
     C                     ELSE
     C           AID       IFEQ 'DN'
     C           ACTN      ANDNE'I'
     C                     READPSECGTX                   12
     C*
     C** CHANGE MESSAGE IF BEGINNING OF FILE REACHED - NO ROLL BACK
     C*
     C           *IN,12    IFEQ '1'
     C                     MOVELINF,9     INFMSG
     C                     ELSE
     C                     MOVEA'1'       *IN,12
     C                     END
     C*
     C***NOT*F3,*F12,*HELP,*ROLLUP,*ROLLDOWN***************************   S01199
     C** NOT F3, F12, ROLLUP, ROLLDOWN                                    S01199
     C*
     C                     ELSE
      *
      ***  Validate Detail Screen Output
      *
     C                     EXSR VALIDD
     C*
     C** N O    D E T A I L   S C R E E N    E R R O R S   -  S T A R T
     C*
     C           SCRMSG    IFEQ *BLANK
     C           AID       ANDEQ'RA'
     C*
     C** FOR REC.ADVANCE DETERMINE WHAT SCREEN TO RETURN TO
     C*
     C           REVW      IFEQ 'Y'
     C**********           MOVELPPAGK     PAGK                                              BUG10756
     C                     MOVEA'1'       *IN,11
     C                     ELSE
     C                     MOVEA'1'       *IN,10
     C                     END
     C*
     C**  U  P  D  A  T  E      F  I  L  E  S
     C*
     C           ACTN      IFEQ 'I'
     C           ACTN      OREQ 'A'
     C           ACTN      OREQ 'D'
     C                     EXSR UPDFLS
     C                     END
     C*
     C** N O    D E T A I L   S C R E E N    E R R O R S   -  E N D
     C*
     C                     END
     C*
     C** F 3 , F 12 , H E L P , R O L L U P / D O W N   -  E N D
     C*
     C                     END
     C                     END
     C                     END
     C***********          END                                            S01199
     C                     END
     C*
     C** D O    U N T I L   C H A N G E  O F  S C R E E N  -  E N D
     C*
     C                     END
     C*
     C** RESET PROTECT/NON-DISPLAY INDS
     C*
     C                     MOVEA'00'      *IN,5
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT                                                              S01179
     C*****************************************************************   S01179
     C*            ****** AS400 CONVERSION ******                         S01179
     C*                                                                   S01179
     C*  ASCHGS  - S/R TO MOVE THE APPROPRIATE VALUES INTO FIELD AID,     S01179
     C*            DEPENDING ON WHICH FUNCTION KEY HAS BEEN PRESSED.      S01179
     C*  CALLED FROM: UPDATE                                              S01179
     C*                                                                   S01179
     C*****************************************************************   S01179
     C*                                                                   S01179
     C           ASCHGS    BEGSR                                          S01179
     C*                                                                   S01179
     C**  If ENTER pressed, the VLDCMDKEY indicator will be off           S01179
     C*                                                                   S01179
     C           *IN20     IFEQ '0'                                       S01179
     C                     MOVE 'RA'      AID                             S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C**  If F3                                                           S01179
     C*                                                                   S01179
     C           *INKC     IFEQ '1'                                       S01179
     C                     MOVE '01'      AID                             S01179
     C                     MOVE '0'       *INKC                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C**  If F10                                                          S01179
     C*                                                                   S01179
     C           *INKJ     IFEQ '1'                                       S01179
     C                     MOVE '04'      AID                             S01179
     C                     MOVE '0'       *INKJ                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C**  If F12                                                          S01179
     C*                                                                   S01179
     C           *INKL     IFEQ '1'                                       S01179
     C                     MOVE '05'      AID                             S01179
     C                     MOVE '0'       *INKL                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C**  If ROLLUP pressed                                               S01179
     C*                                                                   S01179
     C************IN07     IFEQ '1'                               S01179  E17698
     C           *IN25     IFEQ '1'                               S01179  E17698
     C                     MOVE 'UP'      AID                             S01179
     C***********          MOVE '0'       *IN07                   S01179  E17698
     C                     MOVE '0'       *IN25                   S01179  E17698
     C                     END                                            S01179
     C*                                                                   S01179
     C**  If ROLLDOWN pressed                                             S01179
     C*                                                                   S01179
     C************IN08     IFEQ '1'                               S01179  E17698
     C           *IN26     IFEQ '1'                               S01179  E17698
     C                     MOVE 'DN'      AID                             S01179
     C***********          MOVE '0'       *IN08                   S01179  E17698
     C                     MOVE '0'       *IN26                   S01179  E17698
     C                     END                                            S01179
     C*                                                                   S01179
     C**If*HELP*key*pressed************************************** S01179  S01199
     C************                                                S01179  S01199
     C************IN09     IFEQ '1'                               S01179  E17698
     C************IN27     IFEQ '1'                       S01179  E17698  S01199
     C************         MOVE 'HP'      AID                     S01179  S01199
     C************         MOVE '0'       *IN09                   S01179  E17698
     C************         MOVE '0'       *IN27           S01179  E17698  S01199
     C************         END                                    S01179  S01199
     C*                                                                   S01179
     C                     ENDSR                                          S01179
     C*                                                                   S01179
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*
     C*  VALIDK  - S/R TO VALIDATE KEY FIELDS
     C*  CALLED FROM: S/R START, REVIEW
     C*  CALLS: NO OTHER S/R'S
     C*
     C*****************************************************************
     C*
     C           VALIDK    BEGSR                           ** VALIDK BSR**
     C*
     C** RESET ERROR INDICATORS
     C** SET ERROR ARRAY COUNTER TO ZERO
     C*
     C                     MOVEA'000'     *IN,21
     C                     Z-ADD*ZERO     EC      40
     C*
     C** A C T I O N    C O D E    I N P U T - MUST BE BLANK,I,A,E,D
     C*
     C           ACTN      IFNE *BLANK
     C           ACTN      ANDNE'I'
     C           ACTN      ANDNE'A'
     C           ACTN      ANDNE'E'
     C           ACTN      ANDNE'D'
     C                     ADD  1         EC         21
     C                     MOVEL' 100'    ERR,EC
     C                     END
     C*
     C********************************************************************S01117
     C***A*C*T*I*O*N****C*O*D*E****I*N*P*U*T*-*CANT*BE*D*IF*SFLG*IS*ON****S01117
     C*  A C T I O N    C O D E    I N P U T - CANT BE D IF SSF IS ON     S01117
     C*
     C           ACTN      IFEQ 'D'
     C***********SFLG      ANDEQ1                                         S01117
     C           SSF       ANDEQ'Y'                                       S01117
     C                     ADD  1         EC         21
     C                     MOVEL' 101'    ERR,EC
     C                     END
     C*
     C**  CHECK KEY FIELDS
     C*
     C           *IN,21    IFNE '1'
     C*
     C           ACTN      IFNE *BLANK
     C********************************************************************S01117
     C***CHECK*CURRENCY*CODE*EXISTS*ON*TABSE******************************S01117
     C** CHECK CURRENCY CODE EXISTS ON SDCURRPD                           S01117
     C***********                                                         S01117
     C***********          MOVEL*BLANK    ZTABKY                          S01117
     C***********          MOVEL'20'      ZTABKY                          S01117
     C***********          MOVELCCY       WRK4A   4                       S01117
     C***********          MOVE '1'       WRK4A                           S01117
     C***********          MOVE WRK4A     ZTABKY                          S01117
     C***********                                                         S01117
     C***********ZTABKY    CHAINTABSE                99                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM CCY       @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C**N99******RECI      COMP '*'                      99               S01117
     C************IN99     IFEQ '1'                                       S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     ADD  1         EC         22
     C                     MOVEL' 106'    ERR,EC
     C                     END
     C*
     C**  VALIDATE CHARGE/COMMISSION CODE IS NON-BLANK & NON-ZERO
     C*
      * TESTN operation problem : change the condition                                        198918
      *                                                                                       198918
     C**********           TESTN          SCGCM      87                                E20816 198918
     C**********                                                                       E20816 198918
     C           SCGCM     IFNE *BLANKS                                                       198918
     C                     MOVE *BLANKS   ZFIELD                                              198918
     C                     MOVELSCGCM     ZFIELD                                              198918
     C                     Z-ADD0         ZADEC                                               198918
     C                     Z-ADD2         ZADIG                                               198918
     C                     EXSR ZALIGN                                                        198918
     C                     END                                                                198918
     C*                                                                                       198918
     C           SCGCM     IFEQ *ZEROS
     C           SCGCM     OREQ *BLANKS
     C           *IN99     OREQ '1'                                                           198918
     C********** *IN87     ORNE '1'                                                    E20816 198918
     C                     ADD  1         EC         23
     C                     MOVEL' 107'    ERR,EC
     C                     ELSE
     C                     MOVELSCGCM     CCOM
     C                     END
     C*
     C                     ELSE
     C*
     C**  ACTION CODE BLANK BUT KEY INPUT
     C*
     C           CCY       IFNE *BLANK
     C           SCGCM     ORNE *BLANK
     C*
     C                     ADD  1         EC         21
     C                     MOVEL' 102'    ERR,EC
     C*
     C                     END
     C                     END
     C*
     C                     END
     C*
     C** N O   E R R O R  O N  K E Y  F I E L D S
     C*
     C           *IN,22    IFNE '1'
     C           *IN,23    ANDNE'1'
     C*
     C** A C T I O N    C O D E    I
     C*
     C           ACTN      IFEQ 'I'
     C           SECGTK    CHAINSECGTX               99
     C  N99      RECI      COMP '*'                      99
     C           *IN99     IFEQ '0'
     C           CCY       OREQ *BLANK
     C                     MOVEA'11'      *IN,22
     C                     ADD  1         EC
     C                     MOVEL' 103'    ERR,EC
     C                     END
     C*
     C** A C T I O N    C O D E    A , D
     C*
     C                     ELSE
     C           ACTN      IFEQ 'A'
     C           ACTN      OREQ 'D'
     C           SECGTK    CHAINSECGTX               99
     C*
     C** ERROR MESSAGE IF RECORD IS DELETED OR NOT FOUND
     C*
     C  N99      RECI      COMP '*'                      99
     C           *IN99     IFEQ '1'
     C                     MOVEA'11'      *IN,22
     C                     ADD  1         EC
     C                     MOVEL' 104'    ERR,EC
     C                     END
     C*
     C** A C T I O N    C O D E    E
     C*
     C                     ELSE
     C           ACTN      IFEQ 'E'
     C           SECGTK    CHAINSECGTX               99
     C*
     C** ERROR MESSAGE IF RECORD NOT FOUND
     C*
     C           *IN99     IFEQ '1'
     C                     MOVEA'11'      *IN,22
     C                     ADD  1         EC
     C                     MOVEL' 105'    ERR,EC
     C                     END
     C*
     C                     END
     C                     END
     C                     END
     C*
     C                     END
     C*
     C** HIGHLIGHT ERROR CODES IF DISPLAYED ON SCREEN
     C*
     C           EC        IFNE *ZERO
     C                     MOVELHI        ERRMSG
     C                     MOVEL*BLANK    AID
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C**   VALIDATE SPF-ACTION FOR THIS USER                              S01117
     C*                                                                   S01117
     C           ACTN      IFEQ 'I'                                       S01117
     C           ACTN      OREQ 'A'                                       S01117
     C           ACTN      OREQ 'E'                                       S01117
     C           ACTN      OREQ 'D'                                       S01117
     C*                                                                   S01117
     C**   IF SINGLE BRANCH ENVIRONMENT                                   S01117
     C*                                                                   S01117
     C           MBIN      IFNE 'Y'                                       S01117
     C                     CALL 'ZVACTU'                                  S01117
     C                     PARM ACTN      @ZACTN  1                       S01117
     C                     PARM           @ERR    10                      S01117
     C**                                                                  S01117
     C           @ERR      IFNE *ZERO                                     S01117
     C                     ADD  1         EC         21                   S01117
     C                     MOVE ' 302'    ERR,EC                          S01117
     C                     MOVELHI        ERRMSG                          S01117
     C                     MOVEL*BLANK    AID                             S01117
     C                     END                                            S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C**   IF MULTIBRANCHING ENVIRONMENT                                  S01117
     C*                                                                   S01117
     C                     CALL 'ZVACTBU'                                 S01117
     C                     PARM ACTN      @ZACTN  1                       S01117
     C                     PARM USRBCH    @ZBR    3                       S01117
     C                     PARM           @ERR    10                      S01117
     C**                                                                  S01117
     C           @ERR      IFEQ 1                                         S01117
     C                     ADD  1         EC         21                   S01117
     C                     MOVE ' 303'    ERR,EC                          S01117
     C                     MOVELHI        ERRMSG                          S01117
     C                     MOVEL*BLANK    AID                             S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           @ERR      IFEQ 2                                         S01117
     C                     ADD  1         EC         21                   S01117
     C                     MOVE ' 304'    ERR,EC                          S01117
     C                     MOVELHI        ERRMSG                          S01117
     C                     MOVEL*BLANK    AID                             S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END
      *
     C                     ENDSR
      *
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*
     C*  VALIDD  - S/R TO VALIDATE DETAIL SCREEN
     C*  CALLED FROM: UPDATE S/R
     C*  CALLS: ZEDIT, ZALIGN
     C*
     C*****************************************************************
     C*
     C           VALIDD    BEGSR                           ** VALIDD BSR**
     C*
     C** RESET SCREEN ERROR INDICATORS
     C*
     C                     SETOF                     29                   S01401
     C                     MOVEA'00000000'*IN,30
     C                     MOVEA'00000000'*IN,38
     C                     MOVEA'00000000'*IN,46
     C                     MOVEA'00000000'*IN,54
     C                     MOVEA'00000000'*IN,62
     C                     MOVEA'00000000'*IN,70                          S01176
     C                     MOVEA'00000'   *IN,78                          S01176
     C                     MOVEA'0'       *IN,86                          S01176
     C                     MOVEA'00'      *IN,88                          S01446
     C                     SETOF                     2427                 CAC002
     C                     MOVE *OFF      *IN17                           CSW098
     C*
     C** SET ERROR COUNT TO ZERO
     C*
     C                     Z-ADD*ZERO     EC
     C*
     C** ENTER KEY PRESSED
     C*
     C           AID       IFEQ 'RA'
     C*
     C** ACTION = I OR A
     C*
     C           ACTN      IFEQ 'I'
     C           ACTN      OREQ 'A'
     C*
     C** DO DEFAULTS
     C*
     C** VALIDATION OF FIELDS FOR INSERT/AMEND
     C*
     C** NARRATIVE MUST BE INPUT
     C*
     C                     MOVELSCHNR     CHNR
     C*
     C           CHNR      IFEQ *BLANK
     C                     MOVEA'1'       *IN,34
     C                     ADD  1         EC         35
     C                     MOVEL' 206'    ERR,EC
     C                     END
      *                                                                   S01401
      **  Validation of new field only if MT5xx Feature present.          S01401
      *                                                                   S01401
     C           S01401    IFEQ 'Y'                                       S01401
     C           SWRTN     ANDNE'CSW098'                                  CSW098
      *                                                                   S01401
     C           SOWOT     IFNE 'O'                                       S01401
     C           SOWOT     ANDNE'T'                                       S01401
      *                                                                   S01401
     C                     ADD  1         EC         29                   S01401
     C                     MOVEL' 230'    ERR,EC                          S01401
     C                     ELSE                                           S01401
     C                     MOVE SOWOT     OWOT                            S01401
     C                     END                                            S01401
      *                                                                   S01401
     C                     END                                            S01401
     C*
     C** IF AUTO-CHARGES INDICATOR = 'Y'(DO) ADDITIONAL VALIDATION
     C*
     C***********AUMO      IFEQ 'Y'                                       S01117
     C           BVACOP    IFEQ 'Y'                                       S01117
     C*
     C**  VALIDATE CHARGE BASIS INDICATOR
     C*
     C           SCHGB     IFEQ *BLANKS
     C                     MOVEA'1'       *IN,30
     C                     ADD  1         EC         31
     C                     MOVEL' 201'    ERR,EC
     C                     ELSE
     C           SCHGB     IFNE 'F'
     C           SCHGB     ANDNE'C'
     C           SCHGB     ANDNE'P'
     C           SCHGB     ANDNE'N'                                       S01176
     C/COPY WNCPYSRC,SE0121C006
      *                                                                   S01446
      *** 'I' is a valid charge basis if S01446 installed                 S01446
      *                                                                   S01446
     C           S01446    IFEQ 'Y'                        *B3            S01446
     C           SCHGB     ANDNE'I'                                       S01446
     C           S01446    OREQ 'N'                                       S01446
     C                     MOVEA'1'       *IN,30
     C                     ADD  1         EC         31
      *                                                                   S01446
     C                     MOVEL' 202'    ERR,EC
     C                     END                             *E3            S01446
     C/COPY WNCPYSRC,SE0121C007
     C                     END
     C                     END
     C*
     C                     MOVELSCHGB     CHGB
     C*
     C*****VALIDATE*VAT*INDICATOR*************************************    S01176
     C**  VALIDATE TAX INDICATOR                                          S01176
     C*
     C           SVATI     IFNE *BLANKS
     C           SVATI     IFNE 'N'
     C           SVATI     ANDNE'Y'
     C                     ADD  1         EC         32
     C                     MOVEL' 228'    ERR,EC
     C                     END
     C                     END
     C*
     C***********          MOVE SVATI     VATI                            S01176
     C                     MOVE SVATI     TXAP                            S01176
     C*                                                                   S01176
     C**  DEFAULT THRESHOLD INDICATOR                                     S01176
     C*                                                                   S01176
     C           STHRI     IFEQ *BLANK                                    S01176
     C           SCHGB     IFEQ 'F'                                       S01176
     C           SCHGB     OREQ 'P'                                       S01176
     C                     MOVEL'Y'       STHRI                           S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*
     C**  VALIDATE THRESHOLD INDICATOR
     C*
     C           SCHGB     IFEQ 'C'
     C           SCHGB     OREQ 'N'                                       S01176
     C           SCHGB     OREQ 'I'                                       S01446
     C           STHRI     IFEQ *BLANKS
     C                     ADD  1         EC         33
     C                     MOVEL' 203'    ERR,EC
     C                     END
     C                     END
      *                                                                   S01446
     C           SCHGB     IFEQ 'C'
     C           SCHGB     OREQ 'N'                                       S01176
     C           SCHGB     OREQ 'I'                                       S01446
     C           STHRI     IFNE 'Y'                                       S01176
     C           STHRI     ANDNE'N'                                       S01176
     C           *IN33     ANDNE'1'                                       S01176
     C                     ADD  1         EC         33
     C                     MOVEL' 204'    ERR,EC
     C                     END
     C                     END                                            S01176
      *                                                                   S01446
     C           SCHGB     IFEQ 'F'
     C           SCHGB     OREQ 'P'
     C           STHRI     IFNE 'Y'
     C                     ADD  1         EC         33
     C                     MOVEL' 205'    ERR,EC
     C                     END
     C                     END
     C/COPY WNCPYSRC,SE0121C008
     C*
     C                     MOVELSTHRI     THRI
     C*
     C**  VALIDATE REBATE APPLICABLE INDICATOR                            S01176
     C*                                                                   S01176
     C           SREBA     IFNE *BLANKS                                   S01176
     C           SREBA     IFNE 'N'                                       S01176
     C           SREBA     ANDNE'Y'                                       S01176
     C                     ADD  1         EC         86                   S01176
     C                     MOVEL' 229'    ERR,EC                          S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     MOVE SREBA     REBA                            S01176
     C*                                                                   S01176
     C**  VALIDATE LEVIED ON INDICATOR
     C*
     C           SLPSI     IFNE *BLANKS
     C           SLPSI     IFNE 'P'
     C           SLPSI     ANDNE'S'
     C                     Z-ADD1         Q
     C***********' 226'    LOKUPERR,Q                    77               S01176
     C**N77******          ADD  1         EC         36                   S01176
     C**N77******          MOVEL' 226'    ERR,EC                          S01176
     C           ' 226'    LOKUPERR,Q                    84               S01176
     C  N84                ADD  1         EC         36                   S01176
     C  N84                MOVEL' 226'    ERR,EC                          S01176
     C                     END
     C                     END
     C*
     C                     MOVE SLPSI     LPSI
     C*
      *                                                                   S01446
      ***  Validate Group fields only if S01446 is switched on            S01446
      *                                                                   S01446
      ***  Invalid Group Charge Indicator                                 S01446
      *                                                                   S01446
     C           S01446    IFEQ 'Y'                        *B2            S01446
      *                                                                   S01446
     C           SGCCI     IFNE 'Y'                        *B3            S01446
     C           SGCCI     ANDNE'N'                                       S01446
     C           BGN0ST    ANDEQ'N'                                       CAC002
     C                     ADD  1         EC         88                   S01446
     C                     MOVEL' 230'    ERR,EC                          S01446
     C                     ELSE                            *X3            S01446
      *                                                                   S01446
      ***  Group Charge Indicator = Y                                     S01446
      *                                                                   S01446
     C           SGCCI     IFEQ 'Y'                        *B4            S01446
     C           BGN0ST    ANDEQ'N'                                       CAC002
     C           SGCCO     OREQ *BLANKS                                   CAC002
     C           BGN0ST    ANDEQ'Y'                                       CAC002
     C           SGCCO     IFEQ *BLANKS                    *B5            S01446
     C                     MOVE CCOM      SGCCO                           S01446
     C                     ELSE                            *X5            S01446
      *                                                                   S01446
     C           SGCCO     IFNE CCOM                       *B6            S01446
     C                     ADD  1         EC         89                   S01446
     C                     MOVEL' 231'    ERR,EC                          S01446
     C                     END                             *E6            S01446
     C                     END                             *E5            S01446
     C                     ELSE                            *X4            S01446
      *                                                                   S01446
      ***  Group Charge Indicator = N                                     S01446
      *                                                                   CAC002
      **  Perform validation of Group Charge Code if anal acctg is not    CAC002
      **  installed, or is installed but field not = charge comm code     CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'N'                                       CAC002
     C           SGCCO     ORNE CCOM                                      CAC002
      *                                                                   S01446
      **  Define Key List for chaining to SECGT file                      S01446
      *                                                                   S01446
     C           GRPKEY    KLIST                                          S01446
     C                     KFLD           CCYX2                           S01446
     C                     KFLD           CCOMX2                          S01446
      *                                                                   S01446
     C                     MOVE CCY       CCYX2                           S01446
     C                     MOVE SGCCO     CCOMX2                          S01446
      *                                                                   S01446
     C           GRPKEY    CHAINSECGTX2              99                   S01446
     C           *IN99     IFEQ '0'                        *B5            S01446
     C           RECIX2    ANDEQ'*'                                       S01446
     C           *IN99     OREQ '1'                                       S01446
     C                     ADD  1         EC         89                   S01446
     C                     MOVEL' 232'    ERR,EC                          S01446
     C                     ELSE                            *X5            S01446
      *                                                                   S01446
     C           GCCIX2    IFNE 'Y'                        *B6            S01446
     C                     ADD  1         EC         89                   S01176
     C                     MOVEL' 233'    ERR,EC                          S01446
     C                     END                             *E6            S01446
     C                     END                             *E5            S01446
     C                     ENDIF                                          CAC002
     C                     END                             *E4            S01446
     C                     END                             *E3            S01446
      *                                                                   S01446
      *** Move screen group charge fields over to file                    S01446
      *                                                                   S01446
     C           *IN88     IFEQ '0'                        *B3            S01446
     C           *IN89     ANDEQ'0'                                       S01446
     C                     MOVE SGCCI     GCCI                            S01446
     C                     MOVE SGCCO     GCCO                            S01446
     C                     END                             *E3            S01446
      *                                                                   CAC002
      **  Assign proper group charge code indicator if analytical         CAC002
      **  accounting is installed                                         CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C           CCOM      IFEQ SGCCO                                     CAC002
     C                     MOVE 'Y'       GCCI                            CAC002
     C                     ELSE                                           CAC002
     C                     MOVE 'N'       GCCI                            CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
     C                     END                             *E2            S01446
      *                                                                   S01446
     C****EXECUTE*FIELD*CHECK 11 TIMES VALIDATING THE RANGE UPPER LIMIT   S01176
     C**  EXECUTE FIELD CHECK 16 TIMES VALIDATING THE RANGE UPPER LIMIT   S01176
     C**    PERCENTAGE LEVEL AND FLAT CHARGE LEVEL
     C**         Z - IS THE SUB OF FIELDS CURRENTLY BEING VALIDATED
     C**         U - IS THE SUB OF Z + 1
     C**         V - IS THE SUB OF Z - 1
     C**        BS - IS THE SUB OF THE 1ST SET OF FIELD TO BE BLANK
     C*
     C                     Z-ADD2         U       20
     C                     Z-ADD0         V       20
     C                     Z-ADD1         Z       20
     C                     Z-ADD0         BS      20
     C*
     C**  MOVE INPUT SCREEN DETS TO ARRAYS
     C*
     C                     MOVEAURLTAB    UPL
     C                     MOVEAPERTAB    PER
     C                     MOVEAFCHTAB    FLC
     C***********Z         DOWLT11                                        S01176
     C           Z         DOWLT16                                        S01176
     C                     EXSR FLDCHK
     C                     ADD  1         U
     C                     ADD  1         V
     C                     ADD  1         Z
     C                     END
     C*
     C**  MOVE ARRAYS TO OUTPUT SCREEN DETS
     C*
     C                     MOVEAUPL       URLTAB
     C                     MOVEAPER       PERTAB
     C                     MOVEAFLC       FCHTAB
     C*
     C**  UPDATE FILE FIELDS                                              S01176
     C*                                                                   S01176
     C                     MOVELFULA      STUTAB                          S01176
     C                     MOVELFPRA      PLCTAB                          S01176
     C                     MOVELFFCA      FCLTAB                          S01176
     C*                                                                   S01176
     C**  VALIDATE MINIMUM CHARGE
     C*
     C                     MOVE *ZERO     HMNCH
     C           SMNCH     IFEQ *BLANKS
     C***********          ADD  1         EC         66                   S01176
     C                     ADD  1         EC         81                   S01176
     C                     MOVEL' 220'    ERR,EC
     C                     END
     C*
     C           SMNCH     IFNE *BLANKS
     C                     MOVELSMNCH     ALPH17
     C***********          Z-ADDCDP       ZSDEC                           S01117
     C                     Z-ADDA6NBDP    ZSDEC                           S01117
     C                     EXSR CHKNDP                                    S01446
     C           15        SUB  ZSDEC     ZSDIG
     C                     EXSR NUMCHK
     C*
     C**  CHECK FOR NUMERIC ERROR AND NOT NEGATIVE
     C*
     C           *IN99     IFEQ '1'
     C***********          ADD  1         EC         66                   S01176
     C                     ADD  1         EC         81                   S01176
     C                     MOVEL' 221'    ERR,EC
     C                     ELSE
     C                     MOVELALPH17    SMNCH
     C                     MOVE ZFLD15    HMNCH  150
     C*          HMNCH     IFLT 0
     C           ZFSIGN    IFEQ '-'
     C                     MOVE ZFSIGN    SMNCH
     C***********          ADD  1         EC         66                   S01176
     C                     ADD  1         EC         81                   S01176
     C                     MOVEL' 222'    ERR,EC
     C                     END
     C                     END
     C                     END
     C*
     C                     Z-ADDHMNCH     MNCH
     C*
     C**  VALIDATE MAXIMUM CHARGE
     C*
     C                     MOVE *ZERO     HMXCH
     C           SMXCH     IFNE *BLANKS
     C                     MOVELSMXCH     ALPH17
     C***********          Z-ADDCDP       ZSDEC                           S01117
     C                     Z-ADDA6NBDP    ZSDEC                           S01117
     C                     EXSR CHKNDP                                    S01446
     C           15        SUB  ZSDEC     ZSDIG
     C                     EXSR NUMCHK
     C*
     C**  CHECK FOR NUMERIC ERROR AND NOT NEGATIVE
     C*
     C           *IN99     IFEQ '1'
     C***********          ADD  1         EC         67                   S01176
     C                     ADD  1         EC         82                   S01176
     C                     MOVEL' 224'    ERR,EC
     C                     ELSE
     C                     MOVELALPH17    SMXCH
     C                     MOVE ZFLD15    HMXCH  150
     C*          HMXCH     IFLT 0
     C           ZFSIGN    IFEQ '-'
     C                     MOVE ZFSIGN    SMXCH
     C***********          ADD  1         EC         67                   S01176
     C                     ADD  1         EC         82                   S01176
     C                     MOVEL' 225'    ERR,EC
     C                     END
     C                     END
     C                     END
     C*
     C                     Z-ADDHMXCH     MXCH
     C*
     C**  CHECK THAT MIN CHARGE IS NOT > MAX CHARGE,IF MAX CHG NOT 0
     C*
     C           HMXCH     IFNE 0
     C           HMNCH     ANDGTHMXCH
     C***********          ADD  1         EC         66                   S01176
     C                     ADD  1         EC         81                   S01176
     C                     MOVEL' 223'    ERR,EC
     C                     END
     C*
     C***********          ELSE                                           S01176
     C                     END                                            S01176
      *                                                                   CAC002
      **  Validate profit centre and book/transaction indicator           CAC002
      **  if anal. acctg. is installed                                    CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
      *                                                                   CAC002
     C                     SELEC                                          CAC002
      *                                                                   CAC002
      **  Both profit centre and book/trans ind entered not allowed       CAC002
      *                                                                   CAC002
     C           SPRFC     WHNE *BLANKS                                   CAC002
     C           SBOTR     ANDNE*BLANKS                                   CAC002
     C                     SETON                     27                   CAC002
     C                     ADD  1         EC         24                   CAC002
     C                     MOVEL' 241'    ERR,EC                          CAC002
      *                                                                   CAC002
      **  Both profit center and book/trans ind not entered is not        CAC002
      **  allowed as well                                                 CAC002
      *                                                                   CAC002
     C           SPRFC     WHEQ *BLANKS                                   CAC002
     C           SBOTR     ANDEQ*BLANKS                                   CAC002
     C                     ADD  1         EC         24                   CAC002
     C                     MOVEL' 244'    ERR,EC                          CAC002
      *                                                                   CAC002
      **  If profit centre entered and no entry on book/trans ind,        CAC002
      **  ensure that profit centre exists                                CAC002
      *                                                                   CAC002
     C           SPRFC     WHNE *BLANKS                                   CAC002
     C           SBOTR     ANDEQ*BLANKS                                   CAC002
     C                     CALL 'AOPRFCR0'                                CAC002
     C                     PARM *BLANKS   @RTCD                           CAC002
     C                     PARM '*KEY'    @OPTN                           CAC002
     C                     PARM SPRFC     WPRFC   4                       CAC002
     C           SDPRFC    PARM SDPRFC    DSFDY                           CAC002
      *                                                                   CAC002
     C           @RTCD     IFNE *BLANKS                                   CAC002
     C                     ADD  1         EC         24                   CAC002
     C                     MOVEL' 242'    ERR,EC                          CAC002
     C                     ELSE                                                             AR985771
     C                     MOVELDSPCCD    SPRFC                                             AR985771
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
      **  If portfolio customers are licensed and book/trans ind          CAC002
      **  entered and profit centre not entered, ensure that book/trans   CAC002
      **  ind is either 'T' or 'B'                                        CAC002
      *                                                                   CAC002
     C           PFPL      WHEQ 'Y'                                       CAC002
     C           SBOTR     ANDNE*BLANKS                                   CAC002
     C           SPRFC     ANDEQ*BLANKS                                   CAC002
      *                                                                   CAC002
     C           SBOTR     IFNE 'T'                                       CAC002
     C           SBOTR     ANDNE'B'                                       CAC002
     C                     ADD  1         EC         27                   CAC002
     C                     MOVEL' 243'    ERR,EC                          CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C                     ENDSL                                          CAC002
      *                                                                   CAC002
      **  Update profit centre and book/transaction indicator fields.     CAC002
      *                                                                   CAC002
     C           *IN24     IFEQ *OFF                                      CAC002
     C           *IN27     ANDEQ*OFF                                      CAC002
     C                     MOVE SPRFC     PRFC                            CAC002
     C                     MOVE SBOTR     BOTR                            CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C                     END                                            S01176
     C*
     C** IF ACTION=D WITH ENTER PRESSED THEN ERROR                         -
     C*
     C           ACTN      IFEQ 'D'
     C                     MOVELINF,10    INFMSG
     C                     END
     C************         END                                            S01176
     C*
     C************         END                                            S01176
     C*
     C                     ELSE
     C*
     C** IF COMMAND 4 TAKEN
     C*
     C           AID       IFEQ '04'
     C*
     C** COMMAND 4 TAKEN CORRECTLY WHEN ACTION IS D-FORCE 'RECORD ADVANCE'
     C*
     C           ACTN      IFEQ 'D'
     C                     MOVEL'RA'      AID
     C*
     C** COMMAND 4 TAKEN INCORRECTLY WHEN ACTION IS NOT D-HENCE ERROR
     C*
     C                     ELSE
     C                     MOVELINF,11    INFMSG
     C                     END
     C                     END
     C*
     C                     END
      *                                                                   CSW098
      ** Validate SWIFT ID                                                CSW098
     C           S01401    IFEQ 'Y'                                       CSW098
     C           SWRTN     ANDEQ'CSW098'                                  CSW098
      *                                                                   CSW098
     C           SSWID     IFEQ 'EXEC'                                    CSW098
     C           SSWID     OREQ 'CHAR'                                    CSW098
     C           SSWID     OREQ 'LOCO'                                    CSW098
     C           SSWID     OREQ 'COUN'                                    CSW098
     C           SSWID     OREQ 'LEVY'                                    CSW098
     C           SSWID     OREQ 'LOCL'                                    CSW098
     C           SSWID     OREQ 'POST'                                    CSW098
     C           CSW212    ANDEQ'N'                                                           CSW212
     C           SSWID     OREQ 'REGF'                                    CSW098
     C           SSWID     OREQ 'SHIP'                                    CSW098
     C           SSWID     OREQ 'STAM'                                    CSW098
     C           SSWID     OREQ 'STEX'                                    CSW098
     C           SSWID     OREQ 'TRAN'                                    CSW098
     C           SSWID     OREQ 'TRAX'                                    CSW098
     C           SSWID     OREQ 'VATA'                                    CSW098
     C           SSWID     OREQ 'WITH'                                    CSW098
     C           SSWID     OREQ 'LADT'                                                        CSW210
     C           CSW210    ANDEQ'Y'                                                           CSW210
     C                     MOVE SSWID     SWID                            CSW098
     C                     ELSE                                           CSW098
     C                     ADD  1         EC         17                   CSW098
     C                     MOVEL' 230'    ERR,EC                          CSW098
     C                     ENDIF                                          CSW098
      *                                                                   CSW098
     C                     ENDIF                                          CSW098
     C*
     C** ERROR ON SCREEN SO HIGHLIGHT ERROR CODES
     C*
     C           EC        IFNE *ZERO
     C                     MOVELHI        ERRMSG
     C                     END
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*
     C*  INITRC  - S/R TO INITIALISE ALL FILE FIELDS TO ZERO/BLANK
     C*  CALLED FROM UPDATE: UPDFLS
     C*  CALLS: NONE
     C*
     C*****************************************************************
     C*
     C           INITRC    BEGSR                           ** INITRC BSR**
     C*
     C** INITIALIZE ALL DATA ON RECORD DEFINED DATA STRUCTURES
     C*
     C                     MOVEL*BLANK    RECI                            066488
     C                     MOVEL*BLANK    CHGB
     C***********          MOVEL*BLANK    VATI                            S01176
     C                     MOVEL*BLANK    TXAP                            S01176
     C                     MOVEL*BLANK    THRI
     C                     MOVEL*BLANK    CHNR
     C                     MOVEL*BLANK    LPSI
     C                     MOVEL*BLANK    REBA                            S01176
     C                     MOVEL*ZEROS    STUTAB
     C                     MOVEL*ZEROS    PLCTAB
     C                     MOVEL*ZEROS    FCLTAB
     C                     MOVEL*ZEROS    MNCH
     C                     MOVEL*ZEROS    MXCH
     C                     Z-ADD*ZERO     LCD
     C                     Z-ADD*ZERO     TNLU
     C                     MOVE *BLANKS   GCCI                            S01446
     C                     MOVE *BLANKS   GCCO                            S01446
     C                     MOVE *BLANKS   PRFC                            CAC002
     C                     MOVE *BLANKS   BOTR                            CAC002
     C                     CLEAROWOT                                      S01401
      *
     C                     ENDSR
      *
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*
     C*  TRSFS  - S/R TO FORMAT RECORD FIELDS FOR SCREEN
     C*  CALLED FROM: UPDATE
     C*  CALLS: ZEDT
     C*
     C*****************************************************************
     C*
     C           TRSFS     BEGSR                           ** TRSFS BSR **
     C*
     C** TRANSLATE RECORD DETAILS FROM FILE LAYOUT TO SCREEN LAYOUT
     C*
     C** TRANSLATE CHNR
     C*
     C                     MOVELCHNR      SCHNR
     C*
     C***********AUMO      IFEQ 'Y'                                       S01117
     C           BVACOP    IFEQ 'Y'                                       S01117
     C*
     C                     MOVELCHGB      SCHGB
     C**********           MOVELVATI      SVATI                           S01176
     C                     MOVELTXAP      SVATI                           S01176
     C                     MOVELTHRI      STHRI
     C                     MOVELLPSI      SLPSI
     C                     MOVELREBA      SREBA                           S01176
      *                                                                   S01446
      *** Move over database group charge ind/code (if applic)            S01446
      *                                                                   S01446
     C           S01446    IFEQ 'Y'                        *B1            S01446
     C                     MOVELGCCI      SGCCI                           S01446
     C                     MOVELGCCO      SGCCO                           S01446
     C                     ELSE                            *X1            S01446
     C                     MOVE '1'       *IN09                           S01446
     C                     END                             *E1            S01446
      *                                                                   S01446
     C                     Z-ADD1         Z
     C                     MOVELSTUTAB    FULA
     C                     MOVELPLCTAB    FPRA
     C                     MOVELFCLTAB    FFCA
     C*
     C**  GET HIGHEST UPPER LIMIT                                         S01176
     C*
     C                     Z-ADD1         XU      20                      S01176
     C           *ZERO     LOKUPFUL,XU                   99               S01176
     C  N99                Z-ADD15        XU                              S01176
     C*
     C***********Z         DOWLT11                                        S01176
     C           Z         DOWLT16                                        S01176
     C*
     C**  Set up screen tables
     C*
     C                     EXSR INTAB
     C                     ADD  1         Z
     C                     END
     C*
     C                     MOVEAUPL       URLTAB
     C                     MOVEAPER       PERTAB
     C                     MOVEAFLC       FCHTAB
     C*
     C           MNCH      IFNE 0
     C           ACTN      ORNE 'I'                                       S01176
     C                     MOVE MNCH      ZFLD15
     C***********          Z-ADDCDP       ZDECS                           S01117
     C                     Z-ADDA6NBDP    ZDECS                           S01117
     C                     EXSR CHKNDP                                    S01446
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SMNCH
     C                     ELSE
     C                     MOVEL*BLANKS   SMNCH
     C                     END
     C*
     C           MXCH      IFNE 0
     C                     MOVE MXCH      ZFLD15
     C***********          Z-ADDCDP       ZDECS                           S01117
     C                     Z-ADDA6NBDP    ZDECS                           S01117
     C                     EXSR CHKNDP                                    S01446
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SMXCH
     C                     ELSE
     C                     MOVEL*BLANKS   SMXCH
     C                     END
     C*
     C                     END
      *                                                                   CAC002
      **  Move profit centre and book/transaction indicator if            CAC002
      **  analytical accounting is installed                              CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE PRFC      SPRFC                           CAC002
     C                     MOVE BOTR      SBOTR                           CAC002
     C                     ENDIF                                          CAC002
     C*
     C           S01401    IFEQ 'Y'                                       S01401
     C           SWRTN     ANDNE'CSW098'                                  CSW098
     C                     MOVE OWOT      SOWOT                           S01401
     C                     END                                            S01401
      *                                                                   S01401
     C           S01401    IFEQ 'Y'                                       CSW098
     C           SWRTN     ANDEQ'CSW098'                                  CSW098
     C                     MOVE SWID      SSWID                           CSW098
     C                     END                                            CSW098
      *                                                                   CSW098
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*
     C*  UPDFLS  - S/R TO UPDATE FILE RECORDS
     C*  CALLED FROM: UPDATE
     C*  CALLS: INITRC, ZTNLU1, INFSR
     C*
     C*****************************************************************
     C*
     C           UPDFLS    BEGSR                           ** UPDFLS BSR**
     C*
     C**  U P D A T E   F I L E S
     C*
     C**  INITIALIZE ALL FIELDS ON THE RECORD (IE ZEROIZE/BLANK OUT)
     C*
     C                     EXSR INITRC
     C*
     C**  RETRIEVE NEXT TRANSACTION NUMBER
     C*
     C                     EXSR ZTNLU1
     C*
     C**  INITIALISE ERROR BAND
     C*
     C                     MOVEL*BLANK    INFMSG
     C*
     C**               I  N  S  E  R  T  S                 -  S T A R T
     C*
     C           ACTN      IFEQ 'I'
     C***********SECGTK    CHAINSECGTDF              70                   S01176
     C           SECGTK    CHAINSECGTDF              83                   S01176
     C           TNLU      IFNE STNLU
     C                     EXSR UPDOWS
     C*
     C** IF NO PROCESSING OCCURRED EXIT TO SUPPRESS AUDIT UPDATE
     C*
     C                     GOTO XTUPDF
     C*
     C                     ELSE
     C*
     C** TRANSLATE RECORD DETAILS FROM SCREEN LAYOUT TO FILE LAYOUT
     C*
     C                     EXSR VALIDD
     C                     MOVEL'D'       RECI
     C                     Z-ADDRUND      LCD
     C                     MOVEL'I'       CHTP
     C                     MOVELNATN      TNLU
     C                     END
     C***70******          WRITESECGTDF                15                 S01176
     C   83                WRITESECGTDF                15                 S01176
     C*
     C**  TEST FOR UPDATE BY ANOTHER W/S, OR A TERMINAL ERROR
     C*
     C           *IN15     IFEQ '1'
     C           STATUS    ANDEQ01021
     C           SECGTK    CHAINSECGTX               15
     C           *IN15     IFEQ '0'
     C                     EXSR UPDOWS
     C                     GOTO XTUPDF
     C                     END
     C                     END
     C           *IN15     IFEQ '1'
     C                     EXSR INFSR
     C                     END
     C*
     C**N70******          UPDATSECGTDF                                   S01176
     C  N83                UPDATSECGTDF                                   S01176
     C                     ELSE
     C*
     C**               I  N  S  E  R  T  S                 -  E N D
     C*
     C**               A  M  E  N  D  S                    -  S T A R T
     C*
     C           ACTN      IFEQ 'A'
     C***********SECGTK    CHAINSECGTDF              70                   S01176
     C           SECGTK    CHAINSECGTDF              83                   S01176
     C           TNLU      IFNE STNLU
     C                     EXSR UPDOWS
     C*
     C** IF NO PROCESSING OCCURRED EXIT TO SUPPRESS AUDIT UPDATE
     C*
     C                     GOTO XTUPDF
     C*
     C                     ELSE
     C*
     C** TRANSLATE RECORD DETAILS FROM SCREEN LAYOUT TO FILE LAYOUT
     C*
     C                     EXSR VALIDD
     C                     Z-ADDRUND      LCD
     C                     MOVEL'A'       CHTP
     C                     MOVELNATN      TNLU
     C                     END
     C**N70******          UPDATSECGTDF                                   S01176
     C  N83                UPDATSECGTDF                                   S01176
     C                     ELSE
     C*
     C**               A  M  E  N  D  S                    -  E N D
     C*
     C**               D  E  L  E  T  E  S                 -  S T A R T
     C*
     C           ACTN      IFEQ 'D'
     C***********SECGTK    CHAINSECGTDF              70                   S01176
     C           SECGTK    CHAINSECGTDF              83                   S01176
     C           TNLU      IFNE STNLU
     C                     EXSR UPDOWS
     C*
     C**  IF NO PROCESSING OCCURRED EXIT TO SUPPRESS AUDIT UPDATE
     C*
     C                     GOTO XTUPDF
     C*
     C                     ELSE
     C                     MOVEL'*'       RECI
     C                     Z-ADDRUND      LCD
     C                     MOVEL'D'       CHTP
     C                     MOVELNATN      TNLU
     C                     END
     C**N70******          UPDATSECGTDF                                   S01176
     C  N83                UPDATSECGTDF                                   S01176
     C                     END
     C*
     C**               D  E  L  E  T  E  S                 -  E N D
     C*
     C                     END
     C                     END
     C*
     C** GET AUDIT RECORD
     C*
     C           1         CHAINSECGTAF              99
     C*
     C** UPDATE AUDIT RECORD IF FOUND
     C*
     C           *IN99     IFEQ '0'
     C*
     C** FOR INSERT, UPDATE LIVE RECORDS INSERTED TODAY, AND NO. OF
     C** LIVE RECORDS
     C*
     C           ACTN      IFEQ 'I'
     C                     ADD  1         NINS
     C                     ADD  1         NORE
     C                     END
     C*
     C** FOR AMENDS, UPDATE NO. OF RECORDS AMENDED TODAY
     C*
     C           ACTN      IFEQ 'A'
     C                     ADD  1         NAMD
     C                     END
     C*
     C** FOR DELETIONS, UPDATE NO. DELETIONS TODAY, AND NO. OF LIVE RECS
     C*
     C           ACTN      IFEQ 'D'
     C                     ADD  1         NDEL
     C                     SUB  1         NORE
     C                     END
     C*
     C** FORMAT COMIT TEXT
     C*
     C                     TIME           MTIME
     C                     MOVELACTN      ACTNX
     C                     MOVEASCRCTL    DET,01
     C*
     C** UPDATE AUDIT RECORD
     C*
     C                     UPDATSECGTAF
     C*
     C** C  O  M  I  T
     C*
     C           CMTTXT    COMIT
     C*
     C** AUDIT RECORD NOT FOUND: DATABASE ERROR
     C*
     C                     ELSE
     C*
     C                     SETON                     U7U8  ***************
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVEL'02'      DBASE            **DB ERROR 02**S01117
     C                     Z-ADD2         DBASE            **DB ERROR 02**S01117
     C                     MOVEL'SECGT'   DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     END
     C*
     C           XTUPDF    ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*
     C*  UPDOWS  - S/R TO PROCESS UPDATE BY ANOTHER WORKSTATION
     C*  CALLED FROM: UPDFLS
     C*  CALLS: NONE
     C*
     C*****************************************************************
     C*
     C           UPDOWS    BEGSR                           ** UPDOWS BSR**
     C*
     C                     ROLBK
     C*
     C**  SET UP NEXT SCREEN TO BE DISPLAYED
     C**  IF RECORD IS LIVE, ALLOW AMEND PROCESSING
     C*
     C           RECI      IFEQ 'D'
     C                     MOVEL'A'       ACTN
     C                     ELSE
     C*
     C**  IF RECORD HAS BEEN DELETED, ALLOW ENQUIRY
     C*
     C                     MOVEL'E'       ACTN
     C                     END
     C*
     C**  SET SCREEN PROCESSOR TO UPDATE AND MOVE UPDATE MESSAGE TO ERROR
     C*
     C                     MOVEA'001'     *IN,10
     C                     MOVELINF,12    INFMSG
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*
     C*  INFSR  - FILE EXEPTION/ERROR HANDLING SUBROUTINE
     C*
     C*****************************************************************
     C*
     C           INFSR     BEGSR                           *** INFSR ***
     C*
     C**  ROLL BACK CHANGES AND CANCEL PROGRAM
     C*
     C                     ROLBK
     C                     MOVE '*CANCL'  EXTTAG  6
     C**
     C                     ENDSREXTTAG
     C****************************************************************
      /EJECT
     C****************************************************************
     C*
     C*  INTAB  - SR TO SET UP THE SCREEN TABLES WITH THE EDITED VALUES
     C*           OF THE UPPER RANGE LIMIT, PERCENTAGE AND FLAT CHARGES
     C*           USING THE ROUTINE ZSEDIT.
     C*
     C*  INPUT FIELDS:
     C*                  Z       2/0
     C*                  CCD,X   200/1/0
     C*                  FUL,Z   9/15/0
     C*                  FPR,Z   10/7/0
     C*                  FFC,Z   10/15/0
     C*
     C*  ARRAYS:
     C*                  CCD     200/1/0
     C*                  FUL     9/15/0
     C*                  FPR     10/7/0
     C*                  FFC     10/15/0
     C*                  UPL     9/17/
     C*                  PER     10/8/
     C*                  FLC     10/17/
     C*
     C*  OUTPUT FIELDS:
     C*                  UPL,Z   9/17/
     C*                  PER,Z   10/8/
     C*                  FLC,Z   10/17/
     C*
     C*  CALLED BY:       TRSFS
     C*  CALLS:           ZSEDIT
     C*
     C****************************************************************
     C*
     C           INTAB     BEGSR                           *** INTAB ***
     C*
     C**  DETERMINE NUMBER OF DECIMAL PLACES FOR EDIT
     C*
     C           CHGB      IFEQ 'P'                                       S01176
     C                     Z-ADD8         ZDECS                           S01176
     C                     ELSE                                           S01176
     C           CHGB      IFEQ 'N'                                       S01176
     C                     Z-ADD4         ZDECS                           S01176
     C                     ELSE                                           S01176
     C***********          Z-ADDCDP       ZDECS                           S01117
     C                     Z-ADDA6NBDP    ZDECS                           S01117
     C                     EXSR CHKNDP                                    S01446
     C                     END                                            S01176
     C                     END                                            S01176
     C*
     C**  UPPER RANGE LIMIT NOT REACHED
     C*
     C***********Z         IFNE 10                                        S01176
     C           Z         IFNE 15                                        S01176
     C           FUL,Z     IFNE 0
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE FUL,Z     ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    UPL,Z
     C                     ELSE
     C                     MOVEL*BLANKS   UPL,Z
     C                     END
     C                     END
     C*
     C                     Z-ADD4         ZDECS
     C*
     C**  PROCESS FOR PERCENTAGE CHARGE BASIS
     C*
     C           FPR,Z     IFNE 0
     C           Z         ORLE XU                                        S01176
     C           CHGB      ANDNE'F'                                       S01176
     C           ACTN      ANDNE'I'                                       S01176
     C/COPY WNCPYSRC,SE0121C009
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE FPR,Z     ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    ALPH9   9
     C                     MOVELALPH9     PER,Z
     C                     ELSE
     C                     MOVEL*BLANKS   PER,Z
     C/COPY WNCPYSRC,SE0121C010
     C                     END
     C*
     C***********          Z-ADDCDP       ZDECS                           S01117
     C                     Z-ADDA6NBDP    ZDECS                           S01117
     C                     EXSR CHKNDP                                    S01446
     C*
     C** PROCESS FOR FLAT CHARGE BASIS
     C*
     C           FFC,Z     IFNE 0
     C           Z         ORLE XU                                        S01176
     C           ACTN      ANDNE'I'                                       S01176
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE FFC,Z     ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    FLC,Z
     C                     ELSE
     C                     MOVEL*BLANKS   FLC,Z
     C                     END
     C*
     C                     ENDSR
     C*
     C****************************************************************
      /EJECT
     C****************************************************************
     C*
     C*  FLDCHK  - SR TO VALIDATE REPEATED FIELDS
     C*
     C*   EXPLANATION OF SUBS
     C*      Q  - IS THE INDEX FOR THE ERROR ARRAY ER1 AND ER2            S01176
     C*      Z  - IS THE SUB OF FIELDS CURRENTLY BEING VALIDATED
     C*      U  - IS THE SUB OF Z + 1
     C*      V  - IS THE SUB OF Z - 1
     C*      BS - IS THE SUB OF THE 1ST SET OF FIELD TO BE BLANK
     C*
     C*  INDICATORS USED:
     C*                  *IN99 - GENERAL ERROR CONDITION
     C*
     C*  INPUT FIELDS:
     C*                  Q       2/0                                      S01176
     C*                  Z       2/0
     C*                  U       2/0
     C*                  V       2/0
     C*                  BS      2/0
     C*                  UPL     9/17/
     C*                  PER     10/8/
     C*                  FLC     10/17/
     C*                  SCHGB
     C*
     C*  ARRAYS:
     C*                  UPL     9/17/
     C*                  PER     10/8/
     C*                  FLC     10/17/
     C*
     C*  OUTPUT FIELDS:
     C*
     C*  CALLED BY:  VALIDD
     C*  CALLS:      UPLCHK
     C*              SCNERR
     C*              PERCHK
     C*              FLCCHK
     C*
     C****************************************************************
     C*
     C           FLDCHK    BEGSR                           *** FLDCHK ***
     C*
     C*     SET UP BS SUB IF UPPER RANGE LIMIT = BLANKS FOR 1ST TIME
     C***********Z         IFLT 10                                        S01176
     C           Z         IFLT 15                                        S01176
     C           BS        IFEQ 0
     C           UPL,Z     ANDEQ*BLANKS
     C                     Z-ADDZ         BS
     C                     END
     C                     END
     C*
     C***IF*ALL*9*LIMITS*ENTERED*THE*10TH*POSN*SHOULD*HAVE*%*OR*FLAT***   S01176
     C**  IF ALL 14 LIMITS ENTERED THE 15TH POSN SHOULD HAVE % OR FLAT    S01176
     C**  VALUE ENTERED. TO CHECK THIS LATER THE FIELD BS IS SET TO 15    S01176
     C*
     C***********Z         IFEQ 9                                         S01176
     C           Z         IFEQ 14                                        S01176
     C           BS        ANDEQ0
     C***********          Z-ADD10        BS                              S01176
     C                     Z-ADD15        BS                              S01176
     C                     END
     C*
     C**  VALIDATE ENTRY FOR NUMERIC, CURRENCY AND RANGE TESTS
     C*
     C***********Z         IFLT 10                                        S01176
     C           Z         IFLT 15                                        S01176
     C                     EXSR UPLCHK
     C                     END
     C**  CHECKS THAT IF THE CURRENT UPL IS BLANK THAT THE NEXT
     C**  ONE IS BLANK AS WELL
     C***********Z         IFLT 9                                         S01176
     C           Z         IFLT 14                                        S01176
     C           UPL,Z     ANDEQ*BLANKS
     C           UPL,U     ANDNE*BLANKS
     C                     Z-ADD36        Y
     C                     Z-ADD1         Q                               S01176
     C           ' 209'    LOKUPERR,Q                    84
     C  N84                ADD  1         EC
     C  N84                MOVEL' 209'    ERR,EC
     C                     ADD  Z         Y       20
     C                     EXSR SCNERR
     C                     END
     C*
     C           Z         IFGT 1
     C***********Z         ANDLT10                                        S01176
     C           Z         ANDLT15                                        S01176
     C           UPL,Z     ANDNE*BLANKS
     C           *IN99     ANDNE'1'
     C           UPL,Z     ANDLEUPL,V
     C                     Z-ADD1         Q                               S01176
     C                     Z-ADD36        Y
     C           ' 210'    LOKUPERR,Q                    84               S01176
     C***********          ADD  1         EC                              S01176
     C***********          MOVEL' 210'    ERR,EC                          S01176
     C  N84                ADD  1         EC                              S01176
     C  N84                MOVEL' 210'    ERR,EC                          S01176
     C                     ADD  Z         Y
     C                     EXSR SCNERR
     C                     END
     C*
     C**  PERCENTAGE CHECK
     C*
     C***********Z         IFLT 10                                        S01176
     C           Z         IFLT 15                                        S01176
     C           UPL,Z     IFNE *BLANKS
     C           PER,Z     ANDEQ*BLANKS
     C           SCHGB     ANDNE'F'
     C***********          Z-ADD45        Y                               S01176
     C                     Z-ADD50        Y                               S01176
     C                     Z-ADD1         Q       20
     C***********' 211'    LOKUPERR,Q                    77
     C**N77******          ADD  1         EC
     C**N77******          MOVEL' 211'    ERR,EC
     C           ' 211'    LOKUPERR,Q                    84
     C  N84                ADD  1         EC
     C  N84                MOVEL' 211'    ERR,EC
     C                     ADD  Z         Y
     C                     EXSR SCNERR
     C                     END
     C                     END
     C******PERCENTAGE*CHECK*FOR*POSITION*10*ONLY**********************   S01176
     C**  PERCENTAGE CHECK FOR POSITION 15 ONLY                           S01176
     C*
     C***********Z         IFEQ 10                                        S01176
     C           Z         IFEQ 15                                        S01176
     C***********UPL,9     IFNE *BLANKS                                   S01176
     C           UPL,14    IFNE *BLANKS                                   S01176
     C           PER,Z     ANDEQ*BLANKS
     C           SCHGB     ANDNE'F'
     C***********          Z-ADD45        Y                               S01176
     C                     Z-ADD50        Y                               S01176
     C                     Z-ADD1         Q
     C***********' 211'    LOKUPERR,Q                    77               S01176
     C**N77******          ADD  1         EC                              S01176
     C**N77******          MOVEL' 211'    ERR,EC                          S01176
     C           ' 211'    LOKUPERR,Q                    84               S01176
     C  N84                ADD  1         EC                              S01176
     C  N84                MOVEL' 211'    ERR,EC                          S01176
     C                     ADD  Z         Y
     C                     EXSR SCNERR
     C                     END
     C                     END
     C*
     C**  VALIDATE ENTRY FOR NUMERIC, CURRENCY AND RANGE TESTS
     C*
     C                     EXSR PERCHK
     C*
     C***********Z         IFLT 10                                        S01176
     C           Z         IFLT 15                                        S01176
     C           PER,Z     IFNE *BLANKS
     C           UPL,Z     ANDEQ*BLANKS
     C           BS        ANDNEZ
     C***********          Z-ADD45        Y                               S01176
     C                     Z-ADD50        Y                               S01176
     C                     Z-ADD1         Q
     C***********' 214'    LOKUPERR,Q                    77               S01176
     C**N77******          ADD  1         EC                              S01176
     C**N77******          MOVEL' 214'    ERR,EC                          S01176
     C           ' 214'    LOKUPERR,Q                    84               S01176
     C  N84                ADD  1         EC                              S01176
     C  N84                MOVEL' 214'    ERR,EC                          S01176
     C                     ADD  Z         Y
     C                     EXSR SCNERR
     C                     END
     C                     END
     C*                                                                   S01176
     C**  CHECK LAST %                                                    S01176
     C*                                                                   S01176
     C           Z         IFEQ 15                                        S01176
     C           CHGB      ANDNE'F'                                       S01176
     C           PER,15    ANDNE*BLANK                                    S01176
     C           UPL,14    ANDEQ*BLANK                                    S01176
     C                     Z-ADD50        Y                               S01176
     C                     Z-ADD1         Q                               S01176
     C           ' 214'    LOKUPERR,Q                    84               S01176
     C  N84                ADD  1         EC                              S01176
     C  N84                MOVEL' 214'    ERR,EC                          S01176
     C                     ADD  Z         Y                               S01176
     C                     EXSR SCNERR                                    S01176
     C                     END                                            S01176
     C*
     C**  IF F= FLAT, THEN % S/B 0
     C*
     C***********Z         IFLT 11                                        S01176
     C           Z         IFLT 16                                        S01176
     C           PER,Z     IFNE *BLANKS
     C           SCHGB     ANDEQ'F'
     C/COPY WNCPYSRC,SE0121C011
     C***********          Z-ADD45        Y                               S01176
     C                     Z-ADD50        Y                               S01176
     C                     Z-ADD1         Q
     C***********' 215'    LOKUPERR,Q                    77               S01176
     C**N77******          ADD  1         EC                              S01176
     C**N77******          MOVEL' 215'    ERR,EC                          S01176
     C           ' 215'    LOKUPERR,Q                    84               S01176
     C  N84                ADD  1         EC                              S01176
     C  N84                MOVEL' 215'    ERR,EC                          S01176
     C                     ADD  Z         Y
     C                     EXSR SCNERR
     C                     END
     C                     END
     C*
     C**  FLAT CHARGE
     C**  VALIDATE ENTRY FOR NUMERIC, CURRENCY AND RANGE TESTS
     C*
     C                     EXSR FLCCHK
     C*
     C***********Z         IFLT 10                                        S01176
     C           Z         IFLT 15                                        S01176
     C           FLC,Z     IFNE *BLANKS
     C           UPL,Z     ANDEQ*BLANKS
     C           BS        ANDNEZ
     C***********          Z-ADD55        Y                               S01176
     C                     Z-ADD65        Y                               S01176
     C                     Z-ADD1         Q
     C***********' 217'    LOKUPERR,Q                    77               S01176
     C**N77******          ADD  1         EC                              S01176
     C**N77******          MOVEL' 217'    ERR,EC                          S01176
     C           ' 217'    LOKUPERR,Q                    84               S01176
     C  N84                ADD  1         EC                              S01176
     C  N84                MOVEL' 217'    ERR,EC                          S01176
     C                     ADD  Z         Y
     C                     EXSR SCNERR
     C                     END
     C                     END
     C*                                                                   S01176
     C**  CHECK LAST FLAT CHARGE                                          S01176
     C*                                                                   S01176
     C           Z         IFEQ 15                                        S01176
     C           FLC,15    ANDNE*BLANK                                    S01176
     C           UPL,14    ANDEQ*BLANK                                    S01176
     C                     Z-ADD65        Y                               S01176
     C                     Z-ADD1         Q                               S01176
     C           ' 217'    LOKUPERR,Q                    84               S01176
     C  N84                ADD  1         EC                              S01176
     C  N84                MOVEL' 217'    ERR,EC                          S01176
     C                     ADD  Z         Y                               S01176
     C                     EXSR SCNERR                                    S01176
     C                     END                                            S01176
     C*
     C**  FOR THE FIRST BLANK UPPER LIMIT A % OR FLAT VALUE IS REQUIRED
     C*
     C           BS        IFEQ Z
     C***********BS        OREQ 10                                        S01176
     C           BS        OREQ 15                                        S01176
     C           Z         ANDEQ15                                        S01176
     C*
     C**  FIRST BLANK UPPER LIMIT
     C*
     C           SCHGB     IFEQ 'F'
     C*
     C**  FLAT RATE IS REQUIRED IF TYPE IS F= FLAT
     C*
     C           FLC,Z     IFEQ *BLANKS
     C***********          Z-ADD55        Y                               S01176
     C                     Z-ADD65        Y                               S01176
     C                     Z-ADD1         Q
     C***********' 226'    LOKUPERR,Q                    77               S01176
     C**N77******          ADD  1         EC                              S01176
     C**N77******          MOVEL' 226'    ERR,EC                          S01176
     C           ' 216'    LOKUPERR,Q                    84               S01176
     C  N84                ADD  1         EC                              S01176
     C  N84                MOVEL' 216'    ERR,EC                          S01176
     C                     ADD  Z         Y
     C                     EXSR SCNERR
     C                     END
     C                     ELSE
     C*
     C**  IF NOT F=FLAT, PERCENTAGE RATE IS REQUIRED
     C*
     C/COPY WNCPYSRC,SE0121C012
     C           PER,Z     IFEQ *BLANKS
     C***********          Z-ADD45        Y                               S01176
     C                     Z-ADD50        Y                               S01176
     C                     ADD  1         EC
     C                     MOVEL' 227'    ERR,EC
     C                     ADD  Z         Y
     C                     EXSR SCNERR
     C                     END
     C/COPY WNCPYSRC,SE0121C013
     C                     END
     C                     END
     C*
     C                     ENDSR
     C*
     C****************************************************************
      /EJECT
     C****************************************************************
     C*
     C*  UPLCHK  - CHECKS TO SEE IF UPPER RANGE LIMIT(SUB) IS NUMERIC
     C*            AND VALID FOR CURRENCY
     C*
     C*  INPUT FIELDS:
     C*                  UPL,Z   9/17/
     C*                  Z       2/0
     C*                  FUL,Z   9/15/0
     C*                  CCD,X   200/1/0
     C*
     C*  ARRAYS:
     C*                  UPL     9/17/
     C*                  CCD     200/1/0
     C*                  FLC     10/17/
     C*
     C*  OUTPUT FIELDS:
     C*                  FUL,Z   9/15/0
     C*                  UPL,Z   9/17/
     C*
     C*  CALLED BY:      FLDCHK
     C*  CALLS:          NUMCHK
     C*                  SCNERR
     C*
     C****************************************************************
     C*
     C           UPLCHK    BEGSR                           *** UPLCHK ***
     C*
     C           UPL,Z     IFNE *BLANKS
     C                     MOVELUPL,Z     ALPH17 17
     C*
     C**  DETERMINE CHARGE BASIS
     C*
     C           CHGB      IFEQ 'P'                                       S01176
     C                     Z-ADD8         ZSDEC                           S01176
     C                     ELSE                                           S01176
     C           CHGB      IFEQ 'N'                                       S01176
     C                     Z-ADD4         ZSDEC                           S01176
     C                     ELSE                                           S01176
     C***********          Z-ADDCDP       ZSDEC                           S01117
     C                     Z-ADDA6NBDP    ZSDEC                           S01117
     C                     EXSR CHKNDP                                    S01446
     C                     END                                            S01176
     C                     END                                            S01176
     C           15        SUB  ZSDEC     ZSDIG
     C*
     C**CHECK VALUES ARE NUMERIC OR HAVE CORRECT NO. OF DECIMAL PLACES
     C*
     C                     EXSR NUMCHK
     C*
     C**  ERROR IF ENTRY NOT FOUND TO BE NUMERIC OR NEGATIVE
     C*
     C           *IN99     IFEQ '1'
     C                     Z-ADD36        Y
     C                     Z-ADD1         Q
     C***********' 207'    LOKUPERR,Q                    77               S01176
     C**N77******          ADD  1         EC                              S01176
     C**N77******          MOVEL' 207'    ERR,EC                          S01176
     C           ' 207'    LOKUPERR,Q                    84               S01176
     C  N84                ADD  1         EC                              S01176
     C  N84                MOVEL' 207'    ERR,EC                          S01176
     C                     ADD  Z         Y
     C                     EXSR SCNERR
     C                     ELSE
     C                     MOVE ALPH17    UPL,Z
     C                     MOVE ZFLD15    FUL,Z
     C*
     C**  CHECK DISPLACEMENT OF CHARS
     C*
     C           FUL,Z     IFEQ 0
     C           ZFSIGN    OREQ '-'
     C                     MOVE ZFSIGN    UPL,Z
     C                     Z-ADD36        Y
     C                     Z-ADD1         Q
     C***********' 208'    LOKUPERR,Q                    77               S01176
     C**N77******          ADD  1         EC                              S01176
     C**N77******          MOVEL' 208'    ERR,EC                          S01176
     C           ' 208'    LOKUPERR,Q                    84               S01176
     C  N84                ADD  1         EC                              S01176
     C  N84                MOVEL' 208'    ERR,EC                          S01176
     C                     ADD  Z         Y
     C                     EXSR SCNERR
     C                     END
     C                     END
     C                     END
     C           UPL,Z     IFEQ *BLANKS
     C                     Z-ADD0         FUL,Z
     C                     END
     C*
     C                     ENDSR
     C*
     C****************************************************************
      /EJECT
     C****************************************************************
     C*
     C*  PERCHK  - CHECKS TO SEE IF PERCENTAGE(SUB) IS NUMERIC
     C*            AND VALID FOR CURRENCY
     C*
     C*  INPUT FIELDS:
     C*                  PER,Z   10/8/
     C*
     C*  ARRAYS:         PER     10/8/
     C*                  FPR     10/7/0
     C*
     C*  OUTPUT FIELDS:
     C*                  PER,Z   10/8/
     C*                  FPR,Z   10/7/0
     C*
     C*  CALLED BY:      FLDCHK
     C*
     C*  CALLS:          ZALIGN
     C*                  ZSEDIT
     C*                  SCNERR
     C*
     C****************************************************************
     C*
     C           PERCHK    BEGSR                           *** PERCHK ***
     C*
     C           PER,Z     IFNE *BLANKS
     C                     Z-ADD4         ZSDEC
     C                     Z-ADD3         ZSDIG
     C                     MOVE *BLANKS   ZFLD17
     C                     MOVELPER,Z     ZFLD17
     C                     EXSR ZASIGN
     C                     MOVE *BLANKS   ALPH8   8
     C                     MOVE ZOUT15    ZFLD15
     C*
     C                     Z-ADD4         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    ALPH9
     C                     MOVELALPH9     ALPH8
     C*
     C**  CHECK FOR NUMERIC ERROR
     C*
     C           *IN99     IFEQ '1'
     C***********          Z-ADD45        Y                               S01176
     C                     Z-ADD50        Y                               S01176
     C                     Z-ADD1         Q
     C***********' 212'    LOKUPERR,Q                    77               S01176
     C**N77******          ADD  1         EC                              S01176
     C**N77******          MOVEL' 212'    ERR,EC                          S01176
     C           ' 212'    LOKUPERR,Q                    84               S01176
     C  N84                ADD  1         EC                              S01176
     C  N84                MOVEL' 212'    ERR,EC                          S01176
     C                     ADD  Z         Y
     C                     EXSR SCNERR
     C                     ELSE
     C           ZFSIGN    IFEQ '-'
     C/COPY WNCPYSRC,SE0121C014
     C***********          Z-ADD45        Y                               S01176
     C                     Z-ADD50        Y                               S01176
     C                     Z-ADD1         Q
     C***********' 213'    LOKUPERR,Q                    77               S01176
     C**N77******          ADD  1         EC                              S01176
     C**N77******          MOVEL' 213'    ERR,EC                          S01176
     C           ' 213'    LOKUPERR,Q                    84               S01176
     C  N84                ADD  1         EC                              S01176
     C  N84                MOVEL' 213'    ERR,EC                          S01176
     C                     ADD  Z         Y
     C                     EXSR SCNERR
     C                     ELSE
     C                     MOVE ALPH8     PER,Z
     C                     MOVE ZFLD15    FPR,Z
     C                     END
     C                     END
     C                     END
     C           PER,Z     IFEQ *BLANKS
     C                     Z-ADD0         FPR,Z
     C                     END
     C/COPY WNCPYSRC,SE0121C015
     C*
     C                     ENDSR
     C*
     C****************************************************************
      /EJECT
     C****************************************************************
     C*
     C*  FLCCHK  - CHECKS TO SEE IF FLAT CHARGE(SUB) IS NUMERIC
     C*            AND VALID FOR CURRENCY
     C*
     C*  INPUT FIELDS:
     C*                  FLC,Z   10/17/
     C*
     C*  ARRAYS:
     C*                  FLC     10/17/
     C*                  FFC     10/15/0
     C*                  CCD     200/1/0
     C*
     C*  OUTPUT FIELDS:
     C*                  FLC,Z   10/17/
     C*                  FFC,Z   10/15/0
     C*
     C*  CALLED BY:      FLDCHK
     C*  CALLS:          NUMCHK
     C*                  SCNERR
     C*
     C****************************************************************
     C*
     C           FLCCHK    BEGSR                           *** FLCCHK ***
     C*
     C           FLC,Z     IFNE *BLANKS
     C                     MOVELFLC,Z     ALPH17
     C***********          Z-ADDCDP       ZSDEC                           S01117
     C                     Z-ADDA6NBDP    ZSDEC                           S01117
     C                     EXSR CHKNDP                                    S01446
     C           15        SUB  ZSDEC     ZSDIG
     C                     EXSR NUMCHK
     C*
     C**  CHECK FOR NUMERIC ERROR AND NOT NEGATIVE
     C*
     C           *IN99     IFEQ '1'
     C***********          Z-ADD55        Y                               S01176
     C                     Z-ADD65        Y                               S01176
     C                     Z-ADD1         Q
     C***********' 218'    LOKUPERR,Q                    77               S01176
     C**N77******          ADD  1         EC                              S01176
     C**N77******          MOVEL' 218'    ERR,EC                          S01176
     C           ' 218'    LOKUPERR,Q                    84               S01176
     C  N84                ADD  1         EC                              S01176
     C  N84                MOVEL' 218'    ERR,EC                          S01176
     C                     ADD  Z         Y
     C                     EXSR SCNERR
     C                     ELSE
     C                     MOVE ALPH17    FLC,Z
     C                     MOVE ZFLD15    FFC,Z
     C*          FFC,Z     IFLT 0
     C           ZFSIGN    IFEQ '-'
     C                     MOVE '-'       FLC,Z
     C***********          Z-ADD55        Y                               S01176
     C                     Z-ADD65        Y                               S01176
     C                     Z-ADD1         Q
     C***********' 219'    LOKUPERR,Q                    77               S01176
     C**N77******          ADD  1         EC                              S01176
     C**N77******          MOVEL' 219'    ERR,EC                          S01176
     C           ' 219'    LOKUPERR,Q                    84               S01176
     C  N84                ADD  1         EC                              S01176
     C  N84                MOVEL' 219'    ERR,EC                          S01176
     C                     ADD  Z         Y
     C                     EXSR SCNERR
     C                     END
     C                     END
     C                     END
     C           FLC,Z     IFEQ *BLANKS
     C                     Z-ADD0         FFC,Z
     C                     END
     C*
     C                     ENDSR
     C*
     C****************************************************************
      /EJECT
     C****************************************************************
     C*
     C*  NUMCHK  - SR TO CHECK NUMBER IS NUMERIC OR CORRECT FOR
     C*            DECIMAL PLACES
     C*
     C*  INPUT FIELDS:
     C*                  ALPHA17 17/
     C*
     C*  ARRAYS:
     C*                  CCD     200/1/0
     C*
     C*  OUTPUT FIELDS:
     C*                  ALPHA17 17/
     C*
     C*  CALLED BY:      MNVALD
     C*                  UPLCHK
     C*                  FLCCHK
     C*
     C*  CALLS:          ZASIGN
     C*                  ZSEDIT
     C*
     C****************************************************************
     C*
     C           NUMCHK    BEGSR                           *** NUMCHK ***
     C*
     C                     MOVE *BLANKS   ZFLD17
     C                     MOVELALPH17    ZFLD17
     C                     EXSR ZASIGN
     C                     MOVE *BLANKS   ALPH17
     C                     MOVE ZOUT15    ZFLD15
     C***********          Z-ADDCDP       ZDECS                           S01176
     C                     Z-ADDZSDEC     ZDECS                           S01176
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    ALPH17
     C*
     C                     ENDSR
     C*
     C****************************************************************
      /EJECT
     C****************************************************************
     C*
     C*  SCNERR  - ENABLES ERROR INDICATORS FOR UPPER RANGE LIMITS/
     C*            PERCENTAGES AND FLAT-RATES
     C*
     C*  CALLED BY:      FLDCHK
     C*                  UPLCHK
     C*                  PERCHK
     C*                  FLCCHK
     C*
     C****************************************************************
     C*
     C           SCNERR    BEGSR                           *** SCNERR ***
     C*
     C**  SETS ON SCREEN FLAG TO HIGHLIGHT FIELDS IN ERROR
     C*
     C           Y         IFNE 0
     C                     MOVEA'1'       *IN,Y
     C                     END
     C*
     C                     ENDSR
     C*
     C/EJECT
     C********************************************************************S01117
      **                                                                  S01117
      ** *PSSR --- SUBROUTINE TO HANDLE ABNORMAL ERROR CONDITIONS         S01117
      ** CALLED FROM: AFTER ABNORMAL OPERATION OCCURS                     S01117
      ** CALLS: NOTHING                                                   S01117
      **                                                                  S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR **    S01117
     C*                                                                   S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C*                                                                   S01446
     C                     CALL 'DBERRCTL'                                S01446
     C*                                                                   S01446
     C                     ENDSR                           ** *PSSR **    S01117
     C*                                                                   S01117
      ****************************************************************
      /EJECT                                                              S01446
     C****************************************************************    S01446
     C*                                                                   S01446
     C*  CHKNDP  - CHECKS NUMBER OF DECIMAL PLACES - IF S01446 HAS        S01446
     C*            BEEN INSTALLED  FLAT-RATES                             S01446
     C*                                                                   S01446
     C*  CALLED BY:      NONE                                             S01446
     C*                                                                   S01446
     C****************************************************************    S01446
     C*                                                                   S01446
     C           CHKNDP    BEGSR                                       ** S01446
      *                                                                   S01446
      * If S01446 installed, change ndp to ndp of charges ccy (from       S01446
      * ICD) for both ZSEDIT and ZASIGN                                   S01446
      *                                                                   S01446
     C           S01446    IFEQ 'Y'                        *B1            S01446
     C           BVACOP    ANDEQ'Y'                                       S01446
     C           BVCHRC    ANDNE*BLANKS                                   S01446
     C                     Z-ADDUBNDP     ZSDEC                           S01446
     C                     Z-ADDUBNDP     ZDECS                           S01446
     C                     END                             *E1            S01446
      *                                                                   S01446
     C                     ENDSR                                          S01446
      ****************************************************************    S01446
      *                                                                   S01446
     C/EJECT                                                              S01117
     C/COPY ZSRSRC,ZALIGNZ2
      /EJECT
     C/COPY ZSRSRC,ZASIGNZ2
      /EJECT
     C/COPY ZSRSRC,ZEDITZ2
      /EJECT
     C/COPY ZSRSRC,ZSEDITZ3
      /EJECT
     C/COPY ZSRSRC,ZTNLU1Z2
      /EJECT
     C*** E38668 changed this line to not have the Error Number           E38668
     C***ENQUIRY Enter:F3:F12:Rollup:Rolldown:Help                        E17686
      ***
      * /104633/ CHANGE
      *INF,7  DELETION F3:F10 to delete this record:F12:Rollup:Rolldown:Help
      *INF,10 F10 is required
      *INF,11 F10 is not required
**  CPY@
(c) Finastra International Limited 2001
** INF
 Enter:Action Code I,A,D,E and selection:Review from point:F3:Help
 Enter:Review from point:Action Code A,D,E:F3:F12:Rollup:Rolldown:     Help
 No Records Found: Enter Review from point; F3; F12; Help
 INSERTION Enter:F3:F12:Help
 AMENDMENT Enter:F3:F12:Rollup:Rolldown:Help
 ENQUIRY Enter:F3:F12:Rollup:Rolldown:Help
 DELETION F3:F10=Delete record:F12:Rollup:Rolldown:Help
 Rollup is not possible
 Rolldown is not possible
 F10=Confirm
 
 Record has been updated by another workstation
