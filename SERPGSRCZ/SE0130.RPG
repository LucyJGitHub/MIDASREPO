000100200529     H        1
000200200529      *****************************************************************
000300200529/*STD *  RPGBASE                                                      *
000400200529/*EXI *  TEXT('Midas SE Security diary events maintenance')
000500200529/*OVRF*: OVRDBF FILE(SEDEVX) TOFILE(SEDEV) SHARE(*NO)               : *
000600200529     F*****************************************************************
000700200529     F*                                                               *
000800200529     F*  Midas - Securities Trading Module                            *
000900200529     F*                                                               *
001000200529     F*  SE0130  - SECURITY DIARY EVENT MAINTENANCE                   *
001100200529     F*                                                               *
001200200529     F*  Function: This program allows the maintenance and validation *
001300200529     F*   (I/C)    of Security Diary Events.                          *
001400200529     F*                                                               *
001500200529     F*  Called By: SEC02 - Input Cycle Processing                    *
001600200529     F*                                                               *
001700200529      *  (c) Finastra International Limited 2001                      *
001800200529      *                                                               *
001900200604      *  Last Amend No. 260191A            Date 22May20               *
002000200529      *  Prev Amend No. MD046248           Date 27Oct17               *
002100200529      *                 260331             Date 31Mar16               *
002200200529      * Bank Fusion Midas 1.4 Base -----------------------------------*
002300200529      * Midas Plus 1.4 Base 04 ---------------------------------------*
002400200529      * Midas Plus 1.4 Base ------------------------------------------*
002500200529      * Midas Plus 1.3 ----------- Base ------------------------------*
002600200529      *                 CSD031             Date 10Apr06               *
002700200529      *                 CSD027             Date 09Dec05               *
002800200529      *                 CSE071             Date 19Jul05               *
002900200529      *                 CAS006             Date 21Jan03               *
003000200529      *                 208241             Date 21Aug02               *
003100200529      * Midas Release 4.01 -------------------------------------------*
003200200529      *                 CSE031             Date 09Nov01               *
003300200529      *                 196599             Date 24Aug01               *
003400200529      *                 182505             Date 13Sep00               *
003500200529      *                 179359             Date 15Jan02               *
003600200529      * Midas Release 4 --------------- Base -------------------------*
003700200529      *                 CSE016             Date 10Jan01               *
003800200529      * Midas DBA 3.05 -----------------------------------------------*
003900200529      *                 CAP140             Date 17Oct00               *
004000200529      * Midas DBA 3.01 -----------------------------------------------*
004100200529      *                 CSE010             Date 21Jun99               *
004200200529      * Midas DBA 3.00 ---------------- Base -------------------------*
004300200529      *                 066635             Date 29Oct97               *
004400200529      *                 S01408             Date 22Nov96               *
004500200529     F*                 057220             DATE 19JUL96               *
004600200529     F*                 S01408             DATE 27JUN96               *
004700200529     F*                 073727             DATE 03MAY96               *
004800200529     F*                 S01408             DATE 29APR96               *
004900200529     F*                 084187             DATE 03MAR95               *
005000200529     F*                 S01509             DATE 10AUG94               *
005100200529     F*                 S01510             DATE 10AUG94               *
005200200529     F*                 052254             DATE 07JAN94               *
005300200529     F*                 054836             DATE 11AUG93               *
005400200529     F*                 S01401             DATE 16JUN93               *
005500200529     F*                 S01397             DATE 10SEP92               *
005600200529     F*                 E21824             DATE 22AUG91               *
005700200529     F*                 E23897             DATE 22AUG91               *
005800200529     F*                 E24879             DATE 22AUG91               *
005900200529     F*                 E25343             DATE 22AUG91               *
006000200529     F*                 S01220             DATE 07DEC90               *
006100200529     F*                 S01195             DATE 03DEC90               *
006200200529     F*                 S01117             DATE 29NOV90               *
006300200529     F*                 S01269             DATE 01AUG90               *
006400200529     F*                 E23591             DATE 14SEP90               *
006500200529     F*                 E23286             DATE 15AUG90               *
006600200529     F*                 E23259             DATE 09AUG90               *
006700200529     F*                 E22960             DATE 02AUG90               *
006800200529     F*                 E20651             DATE 10JAN90               *
006900200529     F*                 E20016             DATE 12DEC89               *
007000200529     F*                 E15930             DATE 09NOV89               *
007100200529     F*                 E20153             DATE 09NOV89               *
007200200529     F*                 E20085             DATE 09NOV89               *
007300200529     F*                 E19447             DATE 11OCT89               *
007400200529     F*                 E19763             DATE 10OCT89               *
007500200529     F*                 E19752             DATE 06OCT89               *
007600200529     F*                 E16772             DATE 07/08/89              *
007700200529     F*                 S01199             DATE 02/08/89              *
007800200529     F*                 E17436             DATE 17/05/89              *
007900200529     F*                 E15236             DATE 27/09/88              *
008000200529     F*                 E14856             DATE 23/08/88              *
008100200529     F*                 E14552             DATE 23/08/88              *
008200200529     F*                 E14498             DATE 23/08/88              *
008300200529     F*                 S01158             DATE 06/05/88              *
008400200529     F*                                                               *
008500200529     F*---------------------------------------------------------------*
008600200529     F*                                                               *
008700200529      *  260191A- System should not allow deletion of LIVE/MATURED    *
008800200529      *           security diary event if ALL generated position      *
008900200529      *           settlements are still unsettled/live records.       *
009000200529      *           Hence, system will not generate reversal position   *
009100200529      *           settlements.                                        *
009200200529      *  MD046248 - Finastra Rebranding                               *
009300200529      *  260331 - Incorrect posting created due to a deleted diary    *
009400200529      *           event. Applied fix 255857.                          *
009500200529      *         - Applied for MD-37742.                               *
009600200529      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
009700200529      *  CSD027 - Conversion Of Customer Number to Alpha              *
009800200529      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
009900200529      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
010000200529      *  208241 - Recompiled over changed /CPY ZSDESCZ3.              *
010100200529      *  CSE031 - Coupon Fixing for Floating Rate Notes               *
010200200529      *  196599 - Old rate is being used if event date does not match *
010300200529      *           with the security rate change date array.           *
010400200529      *         - Reverse revision to 182505. Event date entered must *
010500200529      *           matched with the security rate change date array.   *
010600200529      *           If it falls on holiday, default it in accordance    *
010700200529      *           with the business day convention.                   *
010800200529      *  182505 - DISPLAY THE ADJUSTED EVENT DATE IN ACCORDANCE WITH  *
010900200529      *           THE BUSINESS DAY CONVENTION ON INPUT AS THE EVENT   *
011000200529      *           AND ONLY ALLOW THIS DATE TO BE INSERTED.            *
011100200529      *         - Interest rate change that falls on holiday was not  *
011200200529      *           adjusted in accordance with CSE005 (Business Day    *
011300200529      *           Convention). Fix patterned after 116466.            *
011400200529      *  179359 - Not possible to insert dividend position settle-    *
011500200529      *           ments and dividend diary events for securities      *
011600200529      *           with processing type '7'.                           *
011700200529      *  CSE016 - Extended Security Descriptions                      *
011800200529      *  CAP140 - Conversion of SE Security Diary Events input into   *
011900200529      *           modular structure to use as APIs.                   *
012000200529      *  CSE010 - SE Transactions Enhancements                        *
012100200529     F*  066635 - When checking Event date for interest rate change,  *
012200200529     F*           if Rate change frequency has not been entered,      *
012300200529     F*           program should only check if the event date is      *
012400200529     F*           a rate change date in the array for the event year. *
012500200529     F*           It shouldn't start looking from issue date to       *
012600200529     F*           maturity date.                                      *
012700200529     F*  S01408 - Addition of core hook SE0130CP11                    *
012800200529     F*  057220 - Do not allow deletion of a security diary event if  *
012900200529     F*           there is a live position settlement for the event.  *
013000200529     F*  S01408 - Core hook SE0130CP10 added.                         *
013100200529     F*           Core hook SE0130CCP9 added.                         *
013200200529     F*           Core hook SE0130CCP8 added.                         *
013300200529     F*           Core hook SE0130CCP7 added.                         *
013400200529     F*           Core hook SE0130FFP1 added.                         *
013500200529     F*  073727 - DO NOT ALLOW INSERT OVER A MATURED SECURITY         *
013600200529     F*  S01408 - Addition of core hooks: SE0130IIP1
013700200529     F*                                   SE0130IIP2
013800200529     F*                                   SE0130CCP1
013900200529     F*                                   SE0130CCP2
014000200529     F*                                   SE0130CCP3
014100200529     F*                                   SE0130CCP4
014200200529     F*                                   SE0130CCP5
014300200529     F*                                   SE0130CCP6
014400200529     F*  084187 - Error 107 appears incorrectly when maturity date is *
014500200529     F*           this year.                                          *
014600200529     F*  S01509 - Value Currency to be currency of Issuer of Payments *
014700200529     F*  S01510 - Dividend Payments Based on Ex-Date                  *
014800200529     F*  052254 - CURRENT FACTOR amended from 9,8 to 10,9             *
014900200529     F*  054836 - You should not be able to backvalue the event date  *
015000200529     F*           more than the backvalue period, as specified on ICD.*
015100200529     F*  S01401 - MT5xx SWIFT Messages Feature:                       *
015200200529     F*          - Recompiled due to changes to files.                *
015300200529     F*  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
015400200529     F*          - Recompiled due to changes to files.                *
015500200529     F*  E21824 - Interest rate cannot be entered if for a date in    *
015600200529     F*           the the next century (rate change freq. not used)   *
015700200529     F*  E23897 - Diary Events must not be for date after maturity    *
015800200529     F*  E24879 - When comparing Event Date against each year         *
015900200529     F*           between Issue Date and Maturity Date the workfield  *
016000200529     F*           IDWORK should not be incremented by 366 (leap year  *
016100200529     F*           value) when that year is not a leap year. This can  *
016200200529     F*           cause error 107 to be issued incorrectly.           *
016300200529     F*  E25343 - Last fixed rate should be shown instead of next     *
016400200529     F*           rate on actions other than insert (done already)    *
016500200529     F*  S01220 - Amended for Strategic Risk Management Release 2     *
016600200529     F*           allowing the user to specify whether the            *
016700200529     F*           Redemption Call is to be included in the Risk       *
016800200529     F*           Analysis Cashflow.                                  *
016900200529     F*  S01195 - HOLIDAY AMENDMENT                                   *
017000200529     F*  S01117 - Multi-branching                                     *
017100200529     F*  S01269 - Trade authoristion: recompile over changed file     *
017200200529     F*           TABSE.                                              *
017300200529     F*  E23591 - FILE TRADSE ALSO TO INCLUDE RECI='A' RECORDS.(TRADES*   E23591
017400200529     F*           CHANGED OR AMENDED TODAY).                          *   E23591
017500200529     F*           HENCE RECOMPILED OVER TRADSE.                       *   E23591
017600200529     F*  E23286 - Further enhancement of error codes.                 *   E23286
017700200529     F*  E23259 - Amendment of Actioned Events must be prohibited     *   E23259
017800200529     F*           as SE2100 can only cope with deletions              *   E23259
017900200529     F*         - Allow Deletion and Enquiry of Actioned Items        *   E23259
018000200529     F*         - Part Payments should update future Diary items      *   E23259
018100200529     F*           and not Redemption Puts/Calls                       *   E23259
018200200529     F*         - REMOVED E20016 as Don't need 'C' recs               *   E23259
018300200529     F*  E22960 - Security shortname error codes improved.            *   E22960
018400200529     F*  E20651 - DB Error Numbers used in more than one place.       *   E20651
018500200529     F*           New Error Numbers as follows:                       *   E20651
018600200529     F*           DB ERROR 03 -> 04.                                  *   E20651
018700200529     F*           DB ERROR 03 -> 05.                                  *   E20651
018800200529     F*  E20016 - Use LF/SECED instead of SEDEV as SEDEV now ignores  *   E20016
018900200529     F*           records with RECI='C'                               *   E20016
019000200529     F*  E15930 - Partly Paids were not being processed correctly:    *   E15930
019100200529     F*          - Do not allow PP Events to be entered if Security   *   E15930
019200200529     F*            is Incomplete.                    B) IF NO PP      *   E15930
019300200529     F*          - If no PP Header record for the Security on the     *   E15930
019400200529     F*            Diary, then:                                       *   E15930
019500200529     F*            1) Use CPDP + CALAMT must not be > SFPP            *   E15930
019600200529     F*            2) Update SDTA = SDPP + CPDP AND                   *   E15930
019700200529     F*                      SDTP = SDPC + CPDP                       *   E15930
019800200529     F*  E20153 - Date checking for 'IR' changes on W/F Frequencies   *   E20153
019900200529     F*           is too strict. Part of it should be warning only.   *   E20153
020000200529     F*  E20085 - Interest and Coupon Calculations Rewrite:           *   E20085
020100200529     F*  E19447 - System allowed an Interest Rate Change of a rate    *   E19447
020200200529     F*           that falls below the minimum coupon from s/secty.   *   E19447
020300200529     F*  E19763 - Amending a PP Diary entry that was already in the   *   E19763
020400200529     F*           system, resulted in error code 206 when it was      *   E19763
020500200529     F*           just the narrative that was amended.                *   E19763
020600200529     F*  E19752 - Does not allow Rate change if Event Date equals     *   E19752
020700200529     F*           Run Date.                                           *   E19752
020800200529     F*  E16772 - The Dividend Payment Amount field SDDV has been     *   E16772
020900200529     F*           replaced by the field SDVA, to increase its size    *   E16772
021000200529     F*           from 9,4 to 13,8.                                   *   E16772
021100200529     F*  S01199 - HELP SYSTEM.                                        *   S01199
021200200529     F*  E17436 - DIARY TYPE RC AND RP - WHEN CALL OR PUT             *   E17436
021300200529     F*           PERCENTAGE =100, DISPLAYED AS 0. NO NARRATIVE       *   E17436
021400200529     F*           DISPLAYED FOR TYPE RC,RP OR XR.                     *   E17436
021500200529     F*  E15236 - Diary type MP - entry of current factor AND repay   *   E15236
021600200529     F*           amount should not be allowed.                       *   E15236
021700200529     F*  E14856 - Diary type MP should allow input of current factor  *   E14856
021800200529     F*           equal to current factor on security.                *   E14856
021900200529     F*  E14552 - If maturity date of security is in or after the     *   E14552
022000200529     F*           year 2000, event date validation fails as it is     *   E14552
022100200529     F*           using the last two characters of the alpha format   *   E14552
022200200529     F*           date field to perform a 'DOWLE' comparison.         *   E14552
022300200529     F*  E14498 - Wrong treatment of date format M causing initial    *   E14498
022400200529     F*           screen to reject valid event date.                  *   E14498
022500200529     F*  S01158 - POST INCORPORATION DEVELOPMENT FIX                  *
022600200529     F*                                                               *
022700200529     F*****************************************************************
022800200529      *
022900200529     FSE0130DFCF  E                    WORKSTN
023000200529     FINVTP   IF  E           K        DISK
023100200529     FSEDEVX  IF  E           K        DISK
023200200529     F            SEDEVDF                           KRENAMESEDEVDFX
023300200529     FSECEO   IF  E           K        DISK                               E20085
023400200529     F            SNDEVDF                           KIGNORE               E20085
023500200529     F            SEDEVDF                           KRENAMESEDEVDO        E20085
023600200529     FSECTY   IF  E           K        DISK
023700200529     F*                                                                   S01408
023800200529     F/COPY WNCPYSRC,SE0130FFP1                                           S01408
023900200529     F*                                                                   S01408
024000200529     FTRADSE  IF  E           K        DISK
024100200529     F*ABSE***IF**E           K        DISK                               S01117
024200200529     F************TABLETAF                          KIGNORE               S01117
024300200529     F************TABTE10F                          KIGNORE               S01117
024400200529     F************TABTE20F                          KIGNORE               S01117
024500200529     F************TABTG20F                          KIGNORE               S01117
024600200529     F************TABLETHF                          KIGNORE               S01117
024700200529     F************TABLETKF                          KIGNORE               S01117
024800200529     F************TABLETLF                          KIGNORE               S01117
024900200529     F************TABLETNF                          KIGNORE               S01117
025000200529     F************TABLETPF                          KIGNORE               S01117
025100200529     F************TABLETRF                          KIGNORE               S01117
025200200529     F************TABLETXF                          KIGNORE               S01117
025300200529     F************TABLET2F                          KIGNORE               S01117
025400200529     F************TABLET3F                          KIGNORE               S01117
025500200529     F************TABLET5F                          KIGNORE               S01117
025600200529     F************TABTB40F                          KIGNORE               S01117
025700200529     FSEDEV   UF  E           K        DISK         KCOMIT       A        E23259
025800200529     F*****SEDEV   UF  E           K        DISK         KCOMIT       A   E20016
025900200529     F*****SECED   UF  E           K        DISK         KCOMIT     E20016E23259
026000200529     F**********  SNDEVDF                           KIGNORE         E20016E23259
026100200529     F                                              KINFDS INFDS
026200200529     F                                              KINFSR INFSR
026300200529     FSEDEVA  UF  E                    DISK         KCOMIT
026400200529     FPOSET3  IF  E           K        DISK                               057220
026500200529     FMMODF   IF  E                    DISK                               S01220
026600200529     F/COPY WNCPYSRC,SE0130F001
026700200529      /EJECT
026800200529     F*****************************************************************
026900200529     F*                                                               *
027000200529     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
027100200529     F*                                                               *
027200200529     F*   01  - F/3 pressed - End job                                 *
027300200529     F*   03  - Protect input capable fields in Delete/Enquiry modes  *
027400200529     F*   04  - F/10 - Delete record                                  *
027500200529     F*   05  - F/12 - Display Initial screen                         *
027600200529     F*   06  - HELP key pressed                                      *
027700200529     F*   08  - 'ROLLDOWN' key                                        *
027800200529     F*   09  - Display Error code list                               *
027900200529     F*   10  - Display 1st Narrrative field                          *
028000200529     F*   11  - Display Amount per Unit field                         *
028100200529     F*   12  - Display Call amount field for Partly paid             *
028200200529     F*   13  - Display Call percentage text and 2nd Narrative and    *
028300200529     F*         Redemption price fields                               *
028400200529     F*   14  - Display Call amount for Redemption Call and Call      *
028500200529     F*         percentage field                                      *
028600200529     F*   15  - Display Put amount and Put percentage fields for      *
028700200529     F*         Redemption Puts                                       *
028800200529     F*   16  - Display Security, Currency, Exchange rate and Price   *
028900200529     F*         fields for Conversions                                *
029000200529     F*   17  - Display 4th Narrative field                           *
029100200529     F*   18  - Display Payment date field                            *
029200200529     F*   19  - Display Current Factor and Repayment amount fields    *
029300200529     F*   20  - Display Next coupon rate field                        *
029400200529     F*   21  - Display Payment currency, Cut coupon exchange rate    *
029500200529     F*         and Multiply/Divide indicator fields                  *
029600200529     F*   22  - Display 3rd Narrative field                           *
029700200529     F*   23  - Risk Management Module is on                          *   S01220
029800200529     F*   24  - Transaction Type is a Redemption Call                 *   S01220
029900200529     F*   25  - S01509 is on                                          *   S01509
030000200529     F*   26  - Transaction Type is a 'DV' and S01510 is on           *   S01510
030100200529     F*   31  - Work indicator used in UPDFLS subroutine              *
030200200529     F*   32  - Work indicator 2 used in UPDFLS subroutine            *
030300200529     F*   33  - General work indicator                                *
030400200529     F*   34  - Seton if Event date matches a Rate Change date        *
030500200529     F*         for Interest Rate change                              *
030600200529     F*   40  - Error on Action code                                  *
030700200529     F*   41  - Error on Security shortname field                     *
030800200529     F*   42  - Error on Event date field                             *
030900200529     F*   43  - Error on Event type field                             *
031000200529     F*   44  - Seton if 'Delete' mode                                *
031100200529     F*   45  - Seton if 'Enquiry' mode                               *
031200200529     F*   49  - Error on Ex-Date                                      *   S01510
031300200529     F*   50  - Error on Amount per unit field                        *
031400200529     F*   51  - Error on any Narrative field                          *
031500200529     F*   52  - Error on Payment date field                           *
031600200529     F*   53  - Error on Call/Put amount field                        *
031700200529     F*   54  - Error on Call/Put percentage field                    *
031800200529     F*   55  - Error on Current factor field                         *
031900200529     F*   56  - Error on Repayment amount field                       *
032000200529     F*   57  - Error on Redemption currency                          *   S01509
032100200529     F*   58  - Error on Next Coupon rate field                       *
032200200529     F*   59  - Error on Payment currency field                       *
032300200529     F*   60  - Error on Cut coupon exchange rate field               *
032400200529     F*   61  - Error on Multiply/Divide indicator field              *
032500200529     F*   62  - Error on Conversion Security field                    *
032600200529     F*   63  - Error on Conversion currency field                    *
032700200529     F*   64  - Error on Conversion Price field                       *
032800200529     F*   65  - Error on Exchange Rate field                          *   S01509
032900200529     F*   66  - Error on Conversion exchange rate field               *
033000200529     F*   67  - Error on Redemption price field                       *
033100200529     F*   68  - HELP TAG CONDITIONING FOR EVENT TYPE BI               *   S01199
033200200529     F*   69  - HELP TAG CONDITIONING FOR EVENT TYPE RI               *   S01199
033300200529     F*   70  - HELP TAG CONDITIONING FOR EVENT TYPE CR               *   S01199
033400200529     F*   71  - HELP TAG CONDITIONING FOR EVENT TYPE OC               *   S01199
033500200529     F*   72  - HELP TAG CONDITIONING FOR EVENT TYPE RC               *   S01199
033600200529     F*   73  - HELP TAG CONDITIONING FOR EVENT TYPE RP               *   S01199
033700200529     F*   74  - HELP TAG CONDITIONING FOR EVENT TYPE PP               *   S01199
033800200529     F*   80  - CHANGE INDICATOR                                      *
033900200529     F*   88  - MBIN = Y                                              *   S01117
034000200529     F*   89  - Event found on SECEO.                                 *   E20085
034100200529     F*                                                               *
034200200529     F* 90-99 -  Used in standard sub-routines                        *
034300200529     F*                                                               *
034400200529     F*   U7  - Database error                                        *
034500200529     F*   U8  - Database / Control error                              *
034600200529      *   LR  - Last Record Indicator                                 *   CSE010
034700200529     F*                                                               *
034800200529     F*****************************************************************
034900200529      /EJECT
035000200529     F*****************************************************************
035100200529     F*                                                               *
035200200529     F*  S U B R O U T I N E   I N D E X                              *
035300200529     F*                                                               *
035400200529     F*  INITL  - Process initial screen                              *
035500200529     F*  INFSR  - File exception/error handling                       *
035600200529     F*  INZDS  - Initialise/Clear multi-occurrence data structure    *
035700200529     F*  SECOND - Process second screen                               *
035800200529     F*  TRSEDE - Translate screen fields to file format              *
035900200529     F*  UPDFLS - Update files                                        *
036000200529     F*  VLDITL - Validate entries on initial screen                  *
036100200529     F*  VLDSEC - Validate entries on second screen                   *
036200200529     F*                                                               *
036300200529     F*  ZALIGN - Validate and right-align numeric fields             *
036400200529     F*  ZDATE1 - DATE - DAYNO conversion                             *
036500200529     F*  ZDATE2 - DAYNO - DATE conversion                             *
036600200529     F***ZDATE5*-*Determine*if*holiday*in*given*currency***************   S01195
036700200529     F*  ZBKDT  - Calculate the nth working day back from a given     *   S01510
036800200529     F*           start date for a currency and (optional) location   *   S01510
036900200529     F*  ZCHKH  - Determine if holiday in given Currency              *   S01195
037000200529     F*  ZEDIT  - Insert a decimal point into a numeric field and blan*
037100200529     F*           out leading zeros                                   *
037200200529     F***ZICD2**-*Access*ICD*record*2**********************************   S01117
037300200529     F***ZICDSE*-*Access*ICD*record*for*Securities*Trading*************   S01117
037400200529     F*  ZSEDIT - Insert a decimal point and sign into a numeric field*
037500200529     F*           and blank out leading zeros                         *
037600200529     F***ZSYSTM*-*GET*INSTALLATION*CONTROL*RECORD*(TABTB10)************   S01117
037700200529     F*  ZTNLU1 - Fetch next available transaction number             *
037800200529     F*                                                               *
037900200529     F*****************************************************************
038000200529      /EJECT
038100200529     E                    CPY@    1   1 80
038200200529     E                    ERR        19  4
038300200529     E********************INF     1   1 76                                057220
038400200529     E                    INF     1   2 76                                057220
038500200529     E/COPY ZSRSRC,ZDATE2Z1
038600200529     E*COPY*ZSRSRC,ZDATE6Z1                                               S01195
038700200529     E/COPY ZSRSRC,ZHOLE                                                  S01195
038800200529     E** SR.ARRAY FOR BOTH ZACCH AND ZCHKH                                S01195
038900200529     E*                                                                   S01195
039000200529     E/COPY ZSRSRC,ZALIGNZ1
039100200529     E                    CD         12  4 0
039200200529     E                    CR         12  1
039300200529     E                    DAT        12  6 0
039400200529     E                    TABMTH 12  12  2 0 TABDAY  2 0
039500200529     E/COPY WNCPYSRC,SE0130E001
039600200529     E/COPY ZSRSRC,ZSDESCZ1                                               CSE016
039700200529      /EJECT
039800200529     ISEDEVDO                                                             E20085
039900200529      ***  Rename of fields for Security Diary (by Reverse Date).         E20085
040000200529     I              RECI                            SORECI                E20085
040100200529     I              SDSN                            SOSDSN                E20085
040200200529     I              SDED                            SOSDED                E20085
040300200529     I              SDET                            SOSDET                E20085
040400200529     I              SDNV                            SOSDNV                E20085
040500200529     I              SDVA                            SOSDVA                E20085
040600200529     I              SDCP                            SOSDCP                E20085
040700200529     I              SRPT                            SOSRPT                E20085
040800200529     I              SDTR                            SOSDTR                E20085
040900200529     I              SRMI                            SOSRMI                E20085
041000200529     I              SDPD                            SOSDPD                E20085
041100200529     I              SDNC                            SOSDNC                E20085
041200200529     I              SDPP                            SOSDPP                E20085
041300200529     I              SDPC                            SOSDPC                E20085
041400200529     I              SDTA                            SOSDTA                E20085
041500200529     I              SDTP                            SOSDTP                E20085
041600200529     I              SDRP                            SOSDRP                E20085
041700200529     I              SDCV                            SOSDCV                E20085
041800200529     I              SDCX                            SOSDCX                E20085
041900200529     I              SDCE                            SOSDCE                E20085
042000200529     I              SDMD                            SOSDMD                E20085
042100200529     I              NMCY                            SONMCY                E20085
042200200529     I              SDAD                            SOSDAD                E20085
042300200529     I              SDDT                            SOSDDT                E20085
042400200529     I              RCIC                            SORCIC                S01220
042500200529      *                                                                   CAP140
042600200529      ** Rename API fields to avoid copying other file's API              CAP140
042700200529      ** fields.                                                          CAP140
042800200529     ISEDEVDF                                                             CAP140
042900200529     I              FRNT                            WFRNT                 CAP140
043000200529     I              REPA                            WREPA                 CAP140
043100200529      *                                                                   CAP140
043200200529     I/COPY WNCPYSRC,SE0130I003
043300200529     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
043400200529     ICPYR@#      DS
043500200529     I                                        1  80 CPY@
043600200529     I                                        1  20 CPY@##
043700200529     IDS01      E DSSEDEVX                    2
043800200529     I*
043900200529     I* DATA STRUCTURE FOR RPG 01021 ERROR HANDLING
044000200529     I*
044100200529     IINFDS       DS
044200200529     I                                     *STATUS  STATUS
044300200529     I*LDA*******UDS                            256                       S01117
044400200529     I***********                           134 177 DBLOT                 S01117
044500200529     I***********                           134 138 DBFILE                S01117
044600200529     I***********                           139 167 DBKEY                 S01117
044700200529     I***********                           168 175 DBPGM                 S01117
044800200529     I***********                           176 177 DBASE                 S01117
044900200529     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS                       S01117
045000200529     ILDA         DS                            256                       S01117
045100200529     I                                      134 183 DBLOT                 S01117
045200200529     I                                      134 141 DBFILE                S01117
045300200529     I                                      142 170 DBKEY                 S01117
045400200529     I                                      171 180 DBPGM                 S01117
045500200529     I                                      181 1830DBASE                 S01117
045600200529     I/COPY ZSRSRC,ZTNLU1Z1
045700200529     I*                                                                   S01195
045800200529     I/COPY ZSRSRC,ZHOLI                                                  S01195
045900200529      **  EXTERNAL DS FOR HOLIDAY DETAILS                                 S01195
046000200529     I*                                                                   S01195
046100200529     I/COPY ZSRSRC,ZHOLDS                                                 S01195
046200200529      **  EXTERNAL DS FOR HOLIDAY DETAILS AND ACCESS OBJECTS              S01195
046300200529     ICMTTXT      DS
046400200529     I                                        1   50NATN
046500200529     I                                        6   7 MDID
046600200529     I                                        8  15 PGMN
046700200529     I                                       16  18 WSIDX
046800200529     I                                       19  240MTIME
046900200529     I                                       25  25 ACTNX
047000200529     I                                       26  35 USIDX
047100200529     I                                       51 306 DET
047200200529     I           SDS
047300200529     I*                                                                   S01408
047400200529     I/COPY WNCPYSRC,SE0130IIP1                                           S01408
047500200529     I*                                                                   S01408
047600200529     I                                      244 246 WSID
047700200529     I                                      254 263 USID
047800200529     I            DS
047900200529     I                                        1  76 ERR
048000200529     I                                        1  76 ERRMSG
048100200529     I            DS
048200200529     I                                        1  75 HCCY
048300200529     I                                        1  75 XCCY
048400200529     I            DS
048500200529     I                                        1  480CD
048600200529     I                                        1   40CD01
048700200529     I                                        5   80CD02
048800200529     I                                        9  120CD03
048900200529     I                                       13  160CD04
049000200529     I                                       17  200CD05
049100200529     I                                       21  240CD06
049200200529     I                                       25  280CD07
049300200529     I                                       29  320CD08
049400200529     I                                       33  360CD09
049500200529     I                                       37  400CD10
049600200529     I                                       41  440CD11
049700200529     I                                       45  480CD12
049800200529     I/COPY WNCPYSRC,SE0130I001
049900200529     I            DS
050000200529     I/COPY WNCPYSRC,SE0130I002
050100200529     I                                        1  12 CR
050200200529     I                                        1   1 CR01
050300200529     I                                        2   2 CR02
050400200529     I                                        3   3 CR03
050500200529     I                                        4   4 CR04
050600200529     I                                        5   5 CR05
050700200529     I                                        6   6 CR06
050800200529     I                                        7   7 CR07
050900200529     I                                        8   8 CR08
051000200529     I                                        9   9 CR09
051100200529     I                                       10  10 CR10
051200200529     I                                       11  11 CR11
051300200529     I                                       12  12 CR12
051400200529     I*
051500200529     IRUNDT       DS                                                      S01117
051600200529     I*                                                                   S01117
051700200529     I** DATA AREA RUNDAT                                                 S01117
051800200529     I*                                                                   S01117
051900200529     I                                        1   7 RUNA                  S01117
052000200529     I                                    P   8  100RUND                  S01117
052100200529     I                                       11  11 SSF                   S01117
052200200529     I                                       12  12 DATF                  S01117
052300200529     I                                       13  13 MBIN                  S01117
052400200529     I*                                                                   S01117
052500200529     IZMUSER      DS                             17                       S01117
052600200529     I*                                                                   S01117
052700200529     I** DATA AREA OF MENU USER                                           S01117
052800200529     I*                                                                   S01117
052900200529     I                                       11  13 USRBCH                S01117
053000200529     I*                                                                   S01117
053100200529     ISDCURR    E DSSDCURRPD                                              S01117
053200200529     I*                                                                   S01117
053300200529     I** Currency Details                                                 S01117
053400200529     I*                                                                   S01117
053500200529     ISDSTRD    E DSSDSTRDPD                                              S01117
053600200529     I*                                                                   S01117
053700200529     I** SECURITIES TRADING DATA                                          S01117
053800200529     I*                                                                   S01117
053900200529     IDSFDY     E DSDSFDY                                                 S01117
054000200529     I*                                                                   S01117
054100200529     I** FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE               S01117
054200200529     I*                                                                   S01408
054300200529     I/COPY WNCPYSRC,SE0130IIP2                                           S01408
054400200529     I*                                                                   S01408
054500200529     I/COPY ZSRSRC,ZSDESCZ2                                               CSE016
054600200529     I*                                                                   S01117
054700200529     C/EJECT
054800200529      *================================================================
054900200529      *  P R O G R A M   S T A R T                                    *
055000200529      *================================================================
055100200529     C*
055200200529     C           *IN09     IFEQ '0'
055300200529     C*
055400200529     C** Assemble key to access Diary Event record
055500200529     C*
055600200529     C           DEVKA     KLIST
055700200529     C                     KFLD           SSDSN
055800200529     C                     KFLD           EVTDNO
055900200529     C                     KFLD           SSDET
056000200529      *                                                                   E20085
056100200529      ***  Key for SECEO in 'Security/Event Type/Reverse Date' order.     E20085
056200200529      *                                                                   E20085
056300200529     C           KSEDO     KLIST                                          E20085
056400200529     C                     KFLD           SSDSN                           E20085
056500200529     C                     KFLD           SSDET                           E20085
056600200529     C                     KFLD           EVTDNO                          E20085
056700200529     C*
056800200529     C* Key to access Investment Type record
056900200529     C*
057000200529     C           ITPKA     KLIST
057100200529     C                     KFLD           NMCY
057200200529     C                     KFLD           SITP
057300200529     C*
057400200529     C**Key*to*access*Table*records***************************************S01117
057500200529     C*
057600200529     C***********TABKA     KLIST                                          S01117
057700200529     C***********          KFLD           KEY12A 12                       S01117
057800200529     C/COPY WNCPYSRC,SE0130C001
057900200529     C*
058000200529     C* Prepare LDA
058100200529     C*
058200200529     C           *NAMVAR   DEFN           LDA                             S01117
058300200529     C           *LOCK     IN   LDA                                       S01117
058400200529     C                     MOVE *BLANKS   DBLOT
058500200529     C                     MOVE 'SE0130  'DBPGM
058600200529     C                     OUT  LDA                                       S01117
058700200529     C*
058800200529     C* Prepare COMIT text
058900200529     C*
059000200529     C                     MOVEL'SE'      MDID
059100200529     C                     MOVEL'SE0130'  PGMN
059200200529     C                     MOVELWSID      WSIDX
059300200529     C                     MOVELUSID      USIDX
059400200529     C*                                                                   S01220
059500200529     C** Access MMODF to determine if Strategic Risk Man. Ind is on       S01220
059600200529     C*                                                                   S01220
059700200529     C                     READ MMODF                    33               S01220
059800200529     C*                                                                   S01220
059900200529     C           RMFL      IFEQ 'Y'                                       S01220
060000200529     C                     SETON                     23                   S01220
060100200529     C                     END                                            S01220
060200200529     C*                                                                   S01220
060300200529     C*
060400200529     C**Get*Installation*Control*Data*record*1****************************S01117
060500200529     C***********                                                         S01117
060600200529     C***********          EXSR ZSYSTM                                    S01117
060700200529     C***********                                                         S01117
060800200529     C**If*error*in*ZSYSTM,*abend*program*********************************S01117
060900200529     C***********                                                         S01117
061000200529     C************IN99     IFEQ '1'                                       S01117
061100200529     C***********          MOVE '01'      DBASE                           S01117
061200200529     C***********          MOVEL'TABLE'   DBFILE                          S01117
061300200529     C***********          MOVELZTABKY    DBKEY                           S01117
061400200529     C***********          SETON                     U7U801               S01117
061500200529     C***********          END                                            S01117
061600200529     C***********                                                         S01117
061700200529     C**Get*Installation*Control*Data*record*2*                           S01117
061800200529     C***********                                                         S01117
061900200529     C***********          EXSR ZICD2                                     S01117
062000200529     C***********                                                         S01117
062100200529     C**If*error*in*ZICD2,*abend*program*                                 S01117
062200200529     C***********                                                         S01117
062300200529     C************IN99     IFEQ '1'                                       S01117
062400200529     C***********          MOVE '02'      DBASE                           S01117
062500200529     C***********          MOVEL'TABLE'   DBFILE                          S01117
062600200529     C***********          MOVELZTABKY    DBKEY                           S01117
062700200529     C***********          SETON                     U7U801               S01117
062800200529     C***********          END                                            S01117
062900200529     C*                                                                   S01117
063000200529     C** IN THE DATAAREA RUNDAT                                           S01117
063100200529     C*                                                                   S01117
063200200529     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
063300200529     C                     IN   RUNDT                                     S01117
063400200529     C*                                                                   S01117
063500200529     C**   CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.                    S01117
063600200529     C*                                                                   S01117
063700200529     C           DATF      COMP 'M'                      98               S01117
063800200529     C*                                                                   S01117
063900200529     C           MBIN      IFEQ 'Y'                                       S01117
064000200529     C                     SETON                         88               S01117
064100200529     C                     END                                            S01117
064200200529     C*                                                                   S01117
064300200529     C** IN THE DATAAREA ZMUSER                                           S01117
064400200529     C*                                                                   S01117
064500200529     C           *NAMVAR   DEFN           ZMUSER                          S01117
064600200529     C                     IN   ZMUSER                                    S01117
064700200529     C*                                                                   S01117
064800200529     C*
064900200529     C**Get*Installation*Control*Data record*for*Securities*Trading*******S01117
065000200529     C* Get Securities Trading Data by access object                      S01117
065100200529     C*
065200200529     C***********          EXSR ZICDSE                                    S01117
065300200529     C                     CALL 'AOSTRDR0'                                S01117
065400200529     C                     PARM '*DBERR ' @RTCD   7                       S01117
065500200529     C                     PARM '*FIRST ' @OPTN   7                       S01117
065600200529     C           SDSTRD    PARM SDSTRD    DSSDY                           S01117
065700200529     C*                                                                   S01408
065800200529     C/COPY WNCPYSRC,SE0130CCP1                                           S01408
065900200529     C*                                                                   S01408
066000200529     C*
066100200529     C**If*error*in*ZICDSE,*abend*program******************************   S01117
066200200529     C*
066300200529     C************IN99     IFEQ '1'                                       S01117
066400200529     C***********          MOVE '03'      DBASE                           E20651
066500200529     C***********          MOVE '04'      DBASE                    E20651 S01117
066600200529     C***********          MOVEL'TABLE'   DBFILE                          S01117
066700200529     C***********          MOVELZTABKY    DBKEY                           S01117
066800200529     C***********          SETON                     U7U801               S01117
066900200529     C***********          END                                            S01117
067000200529     C*
067100200529     C**  Access SAR details file to see if S01509 is installed           S01509
067200200529      *                                                                   S01509
067300200529     C                     CALL 'AOSARDR0'                                S01509
067400200529     C                     PARM '       ' @RTCD                           S01509
067500200529     C                     PARM '*VERIFY' @OPTN                           S01509
067600200529     C                     PARM 'S01509'  @SARD   6                       S01509
067700200529      *                                                                   S01509
067800200529     C           @RTCD     IFEQ *BLANK                                    S01509
067900200529     C                     MOVE 'Y'       S01509  1                       S01509
068000200529     C                     MOVE '1'       *IN25                           S01509
068100200529     C                     ELSE                                           S01509
068200200529     C                     MOVE 'N'       S01509                          S01509
068300200529     C                     END                                            S01509
068400200529     C/COPY WNCPYSRC,SE0130C019
068500200529      *                                                                   CSE010
068600200529      ** Check if CSE010 (Transaction Enhancements) is active             CSE010
068700200529      *                                                                   CSE010
068800200529     C                     CALL 'AOSARDR0'                                CSE010
068900200529     C                     PARM '       ' @RTCD                           CSE010
069000200529     C                     PARM '*VERIFY' @OPTN                           CSE010
069100200529     C                     PARM 'CSE010'  @SARD   6                       CSE010
069200200529      *                                                                   CSE010
069300200529     C           @RTCD     IFEQ *BLANK                                    CSE010
069400200529     C                     MOVE 'Y'       CSE010  1                       CSE010
069500200529     C                     ELSE                                           CSE010
069600200529     C                     MOVE 'N'       CSE010                          CSE010
069700200529      *                                                                   CSE010
069800200529      ** Database Error (return code other than *NRF)                     CSE010
069900200529      *                                                                   CSE010
070000200529     C           @RTCD     IFNE '*NRF   '                                 CSE010
070100200529     C           *LOCK     IN   LDA                                       CSE010
070200200529     C                     MOVEL'SCSARDPD'DBFILE           ***************CSE010
070300200529     C                     MOVEL'CSE010'  DBKEY            * DB ERROR 06 *CSE010
070400200529     C                     Z-ADD6         DBASE            ***************CSE010
070500200529     C                     OUT  LDA                                       CSE010
070600200529     C                     MOVE *ON       *INU7                           CSE010
070700200529     C                     MOVE *ON       *INU8                           CSE010
070800200529     C                     MOVE *ON       *INLR                           CSE010
070900200529     C                     EXSR *PSSR                                     CSE010
071000200529     C                     ENDIF                                          CSE010
071100200529     C                     ENDIF                                          CSE010
071200200529      *                                                                   S01510
071300200529     C**  Access SAR details file to see if S01510 is installed           S01510
071400200529      *                                                                   S01510
071500200529     C                     CALL 'AOSARDR0'                                S01510
071600200529     C                     PARM '       ' @RTCD                           S01510
071700200529     C                     PARM '*VERIFY' @OPTN                           S01510
071800200529     C                     PARM 'S01510'  @SARD                           S01510
071900200529      *                                                                   S01510
072000200529     C           @RTCD     IFEQ *BLANK                                    S01510
072100200529     C                     MOVE 'Y'       S01510  1                       S01510
072200200529     C                     ELSE                                           S01510
072300200529     C                     MOVE 'N'       S01510                          S01510
072400200529     C                     END                                            S01510
072500200529      *                                                                   S01510
072600200529      **  Access SAR details file to see if CSE031 is installed           CSE031
072700200529      *                                                                   CSE031
072800200529     C                     CALL 'AOSARDR0'                                CSE031
072900200529     C                     PARM '       ' @RTCD                           CSE031
073000200529     C                     PARM '*VERIFY' @OPTN                           CSE031
073100200529     C                     PARM 'CSE031'  @SARD                           CSE031
073200200529      *                                                                   CSE031
073300200529     C           @RTCD     IFEQ *BLANK                                    CSE031
073400200529     C                     MOVE 'Y'       CSE031  1                       CSE031
073500200529     C                     ELSE                                           CSE031
073600200529     C                     MOVE 'N'       CSE031                          CSE031
073700200529     C                     ENDIF                                          CSE031
073800200529      *                                                                                       260331
073900200529      **  Access SAR details file to see if S01512 is installed                               260331
074000200529      *                                                                                       260331
074100200529     C                     CALL 'AOSARDR0'                                                    260331
074200200529     C                     PARM '       ' @RTCD                                               260331
074300200529     C                     PARM '*VERIFY' @OPTN                                               260331
074400200529     C                     PARM 'S01512'  @SARD                                               260331
074500200529      *                                                                                       260331
074600200529     C           @RTCD     IFEQ *BLANK                                                        260331
074700200529     C                     MOVE 'Y'       S01512  1                                           260331
074800200529     C                     ELSE                                                               260331
074900200529     C                     MOVE 'N'       S01512                                              260331
075000200529     C                     ENDIF                                                              260331
075100200529     C*                                                                   S01408
075200200529     C/COPY WNCPYSRC,SE0130CCP7                                           S01408
075300200529     C*                                                                   S01408
075400200529     C* Define work fields
075500200529     C*
075600200529     C           *LIKE     DEFN EC        WEC
075700200529     C           *LIKE     DEFN ZDAYNO    HDAYNO
075800200529     C           *LIKE     DEFN ZDAYNO    PDAYNO
075900200529     C           *LIKE     DEFN ZDAYNO    EVTDNO
076000200529     C           *LIKE     DEFN ZDAYNO    #CPD                            182505
076100200529     C           *LIKE     DEFN SSDED     SSDED1                          182505
076200200529     C           *LIKE     DEFN SDPP      CALAMT
076300200529     C           *LIKE     DEFN SDTA      TOTAM
076400200529     C           *LIKE     DEFN SDPC      CALPC
076500200529     C           *LIKE     DEFN SRPT      OLSRPT
076600200529     C           *LIKE     DEFN SRPT      NWSRPT
076700200529     C           *LIKE     DEFN SDTR      SVSDTR
076800200529     C           *LIKE     DEFN SDTA      SVSDTA
076900200529     C           *LIKE     DEFN SDTP      SVSDTP
077000200529     C           *LIKE     DEFN SRMI      SVSRMI
077100200529     C           *LIKE     DEFN SDPP      OLSDPP
077200200529     C           *LIKE     DEFN SDPP      NWSDPP
077300200529     C           *LIKE     DEFN SDPC      OLSDPC
077400200529     C           *LIKE     DEFN SDPC      NWSDPC
077500200529     C           *LIKE     DEFN ISSA      AMTOS
077600200529     C           *LIKE     DEFN SDTR      TOTR
077700200529     C           *LIKE     DEFN SDTR      RES1
077800200529     C           *LIKE     DEFN SRPT      SCSRPT
077900200529     C           *LIKE     DEFN ZDAY      EDAY
078000200529     C           *LIKE     DEFN ZDAY      EOMDAY
078100200529     C           *LIKE     DEFN ZMTH      EMTH
078200200529     C           *LIKE     DEFN ZYEAR     EYEAR
078300200529     C           *LIKE     DEFN SDPP      OLDSPP                          E19763
078400200529     C           *LIKE     DEFN SDPC      OLDSPC                          E19763
078500200529     C           *LIKE     DEFN SDTA      ORIDTA                          E15930
078600200529     C           *LIKE     DEFN SDTP      ORIDTP                          E15930
078700200529     C           *LIKE     DEFN RUND      WBKVP                           054836
078800200529     C           *LIKE     DEFN SDCP      WK18                            052254
078900200529     C*
079000200529     C                     END
079100200529     C*
079200200529     C* Display and process screens until F3 pressed
079300200529     C*
079400200529     C           *IN01     DOWEQ'0'
079500200529     C           *INU8     ANDEQ'0'
079600200529     C*
079700200529     C* Clear/Initialise multi-occurrence data structures
079800200529     C*
079900200529     C           2         OCUR DS01
080000200529     C                     EXSR INZDS
080100200529     C*
080200200529     C           1         OCUR DS01
080300200529     C                     EXSR INZDS
080400200529     C*
080500200529     C* Initialise day no fields
080600200529     C*
080700200529     C                     Z-ADD*ZEROS    HDAYNO
080800200529     C                     Z-ADD*ZEROS    PDAYNO
080900200529     C                     Z-ADD*ZEROS    EVTDNO
081000200529     C*
081100200529     C* F12- Initial screen (blank) requested
081200200529     C*
081300200529     C           *IN05     IFEQ '1'
081400200529     C*
081500200529     C* Setof error indicators and clear error codes
081600200529     C*
081700200529     C                     SETOF                     09
081800200529     C                     MOVE *BLANKS   ERRMSG
081900200529     C                     Z-ADD*ZEROS    EC
082000200529     C                     END
082100200529     C*
082200200529     C                     Z-ADD*ZEROS    STNLU   50
082300200529     C  N09                SETOF                     0305
082400200529     C*
082500200529     C* Display initial screen
082600200529     C*
082700200529     C  N09                EXSR INITL
082800200529     C   09                WRITESE0130F1
082900200529     C*
083000200529     C* Display second screen (Not if F3 or F12 pressed)
083100200529     C*
083200200529     C           *IN01     IFEQ '0'
083300200529     C           *IN05     ANDEQ'0'
083400200529     C*                                                                   S01408
083500200529     C/COPY WNCPYSRC,SE0130CCP2                                           S01408
083600200529     C*                                                                   S01408
083700200529     C                     EXSR SECOND
083800200529     C                     END
083900200529     C*                                                                   S01408
084000200529     C/COPY WNCPYSRC,SE0130CCP3                                           S01408
084100200529     C*                                                                   S01408
084200200529     C*
084300200529     C* Update files (Not if F3 or F12 pressed)
084400200529     C*
084500200529     C           *IN01     IFEQ '0'
084600200529     C           *IN05     ANDEQ'0'
084700200529     C           ACTC      ANDNE'E'
084800200529     C                     EXSR UPDFLS
084900200529     C                     END
085000200529     C*
085100200529     C                     END
085200200529      *
085300200529      *================================================================
085400200529      *  P R O G R A M   E N D                                        *
085500200529      *                                                               *
085600200529     C                     SETON                     LR
085700200529     C                     RETRN
085800200529      *                                                               *
085900200529      *================================================================
086000200529      /EJECT
086100200529      *****************************************************************
086200200529      *                                                               *
086300200529      *  INITL  - Subroutine to process Initial Screen.               *
086400200529      *                                                               *
086500200529      *****************************************************************
086600200529      *
086700200529     C           INITL     BEGSR                           *** INITL  ***
086800200529     C*
086900200529     C                     MOVE 'Y'       FIRST   1
087000200529     C*
087100200529     C* Display initial screen (blank)
087200200529     C*
087300200529     C           *IN09     IFEQ '0'
087400200529     C           *IN08     ANDEQ'0'
087500200529     C                     MOVEA'000000'  *IN,40
087600200529     C                     MOVE ' '       ACTC
087700200529     C                     MOVE *BLANKS   SSDSN
087800200529     C                     MOVE *BLANKS   SSDED
087900200529     C                     MOVE *BLANKS   SSDED1                          182505
088000200529     C                     MOVE '  '      SSDET
088100200529     C                     MOVE *BLANKS   SRNME                           CSE016
088200200529     C                     END
088300200529     C*
088400200529     C* Display initial screen
088500200529     C*
088600200529     C           ZITAG1    TAG                             *** ZITAG1 ***
088700200529     C                     EXFMTSE0130F1
088800200529     C*
088900200529     C* F3 or F12 - Return to main processing
089000200529     C*
089100200529     C   01
089200200529     COR 05                GOTO ZINEND
089300200529     C*
089400200529     C**HELP*key*pressed*-*call*standard*HELP*program******************   S01199
089500200529     C***********                                                         S01199
089600200529     C********** *IN06     IFEQ '1'                                       S01199
089700200529     C**********           CALL 'MHELP'                                   S01199
089800200529     C**********           PARM           DBPGM                           S01199
089900200529     C**********           PARM           ERRMSG                          S01199
090000200529     C**********                                                          S01199
090100200529     C**********           GOTO ZITAG1                                    S01199
090200200529     C**********           END                                            S01199
090300200529     C*
090400200529     C*
090500200529     C**  If not first time through, or no screen changes, any errors
090600200529     C**  will be WARNING ERRORS -therefore no need to validate.
090700200529     C*
090800200529     C           FIRST     IFEQ 'N'
090900200529     C           WEC       ANDEQEC
091000200529     C           *IN80     ANDEQ'0'
091100200529     C                     Z-ADD0         EC
091200200529     C                     SETOF                     0942
091300200529     C                     GOTO UPD1
091400200529     C                     END
091500200529      *
091600200529     C* Validate Initial entries
091700200529     C*
091800200529     C                     EXSR VLDITL
091900200529      *
092000200529     C                     MOVE 'N'       FIRST
092100200529     C*
092200200529     C* If errors, re-display screen
092300200529     C*
092400200529     C           EC        CABGT*ZEROS    ZITAG1     09
092500200529     C*
092600200529     C           UPD1      TAG                             ***  UPD1  ***
092700200529     C*
092800200529     C* Protect fields if Delete or Enquiry mode
092900200529     C*
093000200529     C           ACTC      IFEQ 'D'
093100200529     C           ACTC      OREQ 'E'
093200200529     C                     SETON                     03
093300200529     C                     END
093400200529     C*
093500200529     C* Allow F10 to confirm Deletion in delete mode
093600200529     C*
093700200529     C           ACTC      IFEQ 'D'
093800200529     C                     SETON                     44
093900200529     C                     END
094000200529     C*
094100200529     C* Allow ROLLDOWN key in Enquiry mode
094200200529     C*
094300200529     C           ACTC      IFEQ 'E'
094400200529     C                     SETON                     45
094500200529     C                     END
094600200529     C*
094700200529     C           ZINEND    ENDSR                           *** ZINEND ***
094800200529      *
094900200529      *****************************************************************
095000200529      /EJECT
095100200529      *****************************************************************
095200200529      *                                                               *
095300200529      *  INFSR  - FILE EXCEPTION/ERROR HANDLING SUBROUTINE            *
095400200529      *                                                               *
095500200529      *****************************************************************
095600200529      *
095700200529     C           INFSR     BEGSR                           *** INFSR  ***
095800200529     C*
095900200529     C**   CHECK ERROR TYPE
096000200529     C*
096100200529     C           STATUS    IFEQ 01021
096200200529     C*
096300200529     C**   CHAIN TO FILE TO GET CURRENT DETAILS
096400200529     C*
096500200529     C           DEVKA     CHAINSEDEVDF              99
096600200529     C*
096700200529     C           *IN99     IFEQ '0'
096800200529     C*
096900200529     C**   ROLL BACK UPDATES ALREADY DONE
097000200529     C*
097100200529     C                     ROLBK
097200200529     C*
097300200529     C**   RECORD ALREADY EXISTS
097400200529     C*
097500200529     C           RECI      IFEQ 'D'
097600200529     C                     MOVEL'A'       ACTC
097700200529     C                     ELSE
097800200529     C                     MOVEL'E'       ACTC
097900200529     C                     SETON                     4503
098000200529     C                     END
098100200529     C**
098200200529     C                     MOVEL'*DETC'   EXTTAG  6
098300200529     C**
098400200529     C                     ELSE
098500200529     C**
098600200529     C                     MOVE '*CANCL'  EXTTAG
098700200529     C                     END
098800200529     C**
098900200529     C                     ELSE
099000200529     C**
099100200529     C                     MOVE '*CANCL'  EXTTAG
099200200529     C                     END
099300200529     C**
099400200529     C                     ENDSREXTTAG
099500200529      *
099600200529      *****************************************************************
099700200529      /EJECT
099800200529      *****************************************************************
099900200529      *                                                               *
100000200529      *  INZDS  - Subroutine to initialise numeric fields in mult-    *
100100200529      *           occurrence Data Structure.                          *
100200200529      *                                                               *
100300200529      *****************************************************************
100400200529      *
100500200529     C           INZDS     BEGSR                           *** INZDS  ***
100600200529     C*
100700200529     C                     MOVE *BLANK    RECI
100800200529     C                     MOVE *BLANKS   SDSN
100900200529     C                     Z-ADD*ZEROS    SDED
101000200529     C                     MOVE *BLANK    SDET
101100200529     C                     MOVE *BLANKS   SDNV
101200200529     C*********************Z-ADD*ZEROS    SDDV                            E16772
101300200529     C                     Z-ADD*ZEROS    SDVA                            E16772
101400200529     C                     Z-ADD*ZEROS    SDCP
101500200529     C                     Z-ADD*ZEROS    SRPT
101600200529     C                     Z-ADD*ZEROS    SDTR
101700200529     C                     MOVE *BLANK    SRMI
101800200529     C                     Z-ADD*ZEROS    SDPD
101900200529     C                     Z-ADD*ZEROS    SDNC
102000200529     C                     Z-ADD*ZEROS    SDPP
102100200529     C                     Z-ADD*ZEROS    SDPC
102200200529     C                     Z-ADD*ZEROS    SDTA
102300200529     C                     Z-ADD*ZEROS    SDTP
102400200529     C                     Z-ADD*ZEROS    SDRP
102500200529     C                     MOVE *BLANKS   SDCV
102600200529     C                     MOVE *BLANKS   SDCX
102700200529     C                     Z-ADD*ZEROS    SDCE
102800200529     C                     MOVE *BLANK    SDMD
102900200529     C                     Z-ADD*ZEROS    SDAD
103000200529     C                     Z-ADD*ZEROS    SDDT
103100200529     C                     Z-ADD*ZEROS    LCD
103200200529     C                     MOVE *BLANK    CHTP
103300200529     C                     Z-ADD*ZEROS    TNLU
103400200529     C*
103500200529     C                     ENDSR
103600200529      *
103700200529      *****************************************************************
103800200529      /EJECT
103900200529      *****************************************************************
104000200529      *                                                               *
104100200529      *  SECOND - Subroutine to process the Second Screen.            *
104200200529      *                                                               *
104300200529      *****************************************************************
104400200529      *
104500200529     C           SECOND    BEGSR                           *** SECOND ***
104600200529     C*
104700200529     C           *IN09     IFEQ '0'
104800200529     C*
104900200529     C* Setof error indicators
105000200529     C*
105100200529     C                     MOVEA'00000000'*IN,50
105200200529     C                     MOVEA'00000000'*IN,58
105300200529     C                     MOVEA'00'      *IN,66
105400200529     C*
105500200529     C* Setup display fields
105600200529     C*
105700200529     C                     MOVEA'00000000'*IN,10
105800200529     C                     MOVEA'00000'   *IN,18
105900200529     C                     SETOF                     24                   S01220
106000200529     C                     MOVE '0'       *IN26                           S01510
106100200529     C/COPY WNCPYSRC,SE0130C002
106200200529     C*
106300200529     C***  HELP PROCESSING TO CONDITION HELP DOCUMENT                     S01199
106400200529     C*                                                                   S01199
106500200529     C           SSDET     COMP 'BI'                     68               S01199
106600200529     C           SSDET     COMP 'RI'                     69               S01199
106700200529     C           SSDET     COMP 'CR'                     70               S01199
106800200529     C           SSDET     COMP 'OC'                     71               S01199
106900200529     C           SSDET     COMP 'RC'                     72               S01199
107000200529     C           SSDET     COMP 'RP'                     73               S01199
107100200529     C           SSDET     COMP 'PP'                     74               S01199
107200200529     C*                                                                   S01199
107300200529     C* Dividends Declared
107400200529     C*
107500200529     C           SSDET     IFEQ 'DV'
107600200529     C/COPY WNCPYSRC,SE0130C031
107700200529     C           ACTC      IFEQ 'I'
107800200529     C                     MOVE *BLANKS   SSDDV
107900200529     C                     MOVE *BLANKS   NAR1
108000200529     C                     MOVE *BLANKS   SSDPD
108100200529     C*
108200200529     C           S01510    IFEQ 'Y'                                       S01510
108300200529      *                                                                   S01510
108400200529     C                     MOVE '1'       *IN26                           S01510
108500200529      * Calculate default Ex-date                                         S01510
108600200529     C                     MOVELEDFT      ZNRDYS                          S01510
108700200529     C           ZNRDYS    IFNE *ZEROS                                    S01510
108800200529     C                     MOVE EDFT      WEDFT   1                       S01510
108900200529     C           WEDFT     IFEQ 'W'                                       S01510
109000200529     C                     Z-ADDEVTDNO    ZDAYNO                          S01510
109100200529     C                     MOVE VLCY      ZCCY                            S01510
109200200529     C                     MOVE *BLANKS   ZLOC                            S01510
109300200529     C                     EXSR ZBKDT                                     S01510
109400200529     C                     Z-ADDZDYNBR    ZDAYNO                          S01510
109500200529     C                     ELSE                                           S01510
109600200529     C           EVTDNO    SUB  ZNRDYS    ZDAYNO                          S01510
109700200529     C                     END                                            S01510
109800200529     C                     EXSR ZDATE2                                    S01510
109900200529     C                     MOVE ZDATE     SSDXD                           S01510
110000200529     C                     ELSE                                           S01510
110100200529     C                     MOVE SSDED     SSDXD                           S01510
110200200529     C                     END                                            S01510
110300200529      *                                                                   S01510
110400200529     C                     END                                            S01510
110500200529     C                     ELSE
110600200529     C*
110700200529     C***********SDDV      IFNE *ZEROS                                    E16772
110800200529     C           SDVA      IFNE *ZEROS                                    E16772
110900200529     C                     MOVE *BLANKS   ZFIELD
111000200529     C***********          MOVE SDDV      ZFIELD                          E16772
111100200529     C***********          Z-ADD4         ZADEC                           E16772
111200200529     C                     MOVE SDVA      ZFIELD                          E16772
111300200529     C                     Z-ADD8         ZADEC                           E16772
111400200529     C                     EXSR ZEDIT
111500200529     C                     MOVE ZFIELD    SSDDV
111600200529     C                     ELSE
111700200529     C                     MOVE *BLANKS   SSDDV
111800200529     C                     END
111900200529     C*
112000200529     C           SDPD      IFNE *ZEROS
112100200529     C                     Z-ADDSDPD      ZDAYNO
112200200529     C                     EXSR ZDATE2
112300200529     C                     MOVE ZDATE     SSDPD
112400200529     C                     ELSE
112500200529     C                     MOVE *BLANKS   SSDPD
112600200529     C                     END
112700200529     C*                                                                   S01510
112800200529     C           S01510    IFEQ 'Y'                                       S01510
112900200529     C                     MOVE '1'       *IN26                           S01510
113000200529     C           SDXD      IFNE *ZEROS                                    S01510
113100200529     C                     Z-ADDSDXD      ZDAYNO                          S01510
113200200529     C                     EXSR ZDATE2                                    S01510
113300200529     C                     MOVE ZDATE     SSDXD                           S01510
113400200529     C                     ELSE                                           S01510
113500200529     C                     MOVE *BLANKS   SSDXD                           S01510
113600200529     C                     END                                            S01510
113700200529     C                     END                                            S01510
113800200529     C*
113900200529     C                     MOVE SDNV      NAR1
114000200529     C                     END
114100200529     C*
114200200529     C                     SETON                     101118
114300200529     C                     END
114400200529     C*
114500200529     C* Partly Paids
114600200529     C*
114700200529     C           SSDET     IFEQ 'PP'
114800200529     C*
114900200529     C* Determine if Share to decide output
115000200529     C*
115100200529     C           ITPKA     CHAININVTPDF              33
115200200529     C           PROT      IFEQ '4'
115300200529     C                     SETON                     12
115400200529     C                     ELSE
115500200529     C                     SETON                     1314
115600200529     C                     END
115700200529     C*
115800200529     C           ACTC      IFEQ 'I'
115900200529     C   12                MOVE *BLANKS   CAMT
116000200529     C   13 14             MOVE *BLANKS   CPRI
116100200529     C                     MOVE *BLANKS   NAR1
116200200529     C                     ELSE
116300200529     C*
116400200529     C           *IN12     IFEQ '1'
116500200529     C           SDPP      IFNE *ZEROS
116600200529     C                     MOVE *BLANKS   ZFIELD
116700200529     C                     MOVE SDPP      ZFIELD
116800200529     C*
116900200529     C* Use nominal decimal places
117000200529     C*
117100200529     C***********          MOVE *BLANKS   KEY12A                          S01117
117200200529     C***********          MOVELNMCY      WORK4                           S01117
117300200529     C***********          MOVE '1'       WORK4                           S01117
117400200529     C***********          MOVEL'20'      KEY12A                          S01117
117500200529     C***********          MOVE WORK4     KEY12A                          S01117
117600200529     C***********TABKA     CHAINTABTG10F             33                   S01117
117700200529     C                     MOVE NMCY      @AJCD   3                       S01117
117800200529     C                     CALL 'AOCURRR0'                                S01117
117900200529     C                     PARM '*DBERR ' @RTCD   7                       S01117
118000200529     C                     PARM '*KEY   ' @OPTN   7                       S01117
118100200529     C                     PARM           @AJCD   3                       S01117
118200200529     C           SDCURR    PARM SDCURR    DSSDY                           S01117
118300200529     C***********          Z-ADDCDP       ZADEC                           S01117
118400200529     C                     Z-ADDA6NBDP    ZADEC                           S01117
118500200529     C                     EXSR ZEDIT
118600200529     C                     MOVE ZFIELD    CAMT
118700200529     C                     ELSE
118800200529     C                     MOVE *BLANKS   CAMT
118900200529     C                     END
119000200529     C                     END
119100200529     C*
119200200529     C           *IN13     IFEQ '1'
119300200529     C           *IN14     ANDEQ'1'
119400200529     C           SDPC      IFNE *ZEROS
119500200529     C                     MOVE *BLANKS   ZFIELD
119600200529     C                     MOVE SDPC      ZFIELD
119700200529     C                     Z-ADD3         ZADEC
119800200529     C                     EXSR ZEDIT
119900200529     C           SDPC      IFEQ 100                                       E17436
120000200529     C                     MOVE ZFIELD    WCPRI   7                       E17436
120100200529     C                     MOVELWCPRI     CPRI                            E17436
120200200529     C                     ELSE                                           E17436
120300200529     C                     MOVE ZFIELD    CPRI
120400200529     C                     END                                            E17436
120500200529     C                     ELSE
120600200529     C                     MOVE *BLANKS   CPRI
120700200529     C                     END
120800200529     C                     END
120900200529     C*
121000200529     C                     MOVE SDNV      NAR1
121100200529     C                     END
121200200529     C*
121300200529     C                     SETON                     10
121400200529     C                     END
121500200529     C*
121600200529     C* Mortgage Payments
121700200529     C*
121800200529     C           SSDET     IFEQ 'MP'
121900200529     C           ACTC      IFEQ 'I'
122000200529     C                     MOVE *BLANKS   SSDCP
122100200529     C                     MOVE *BLANKS   SSRPT
122200200529     C                     MOVE *BLANKS   SSDPD
122300200529     C*                                                                   S01408
122400200529     C/COPY WNCPYSRC,SE0130CCP8                                           S01408
122500200529     C*                                                                   S01408
122600200529     C                     MOVE *BLANKS   NAR2
122700200529     C                     ELSE
122800200529     C*
122900200529     C           SDCP      IFNE *ZEROS
123000200529     C                     MOVE *BLANKS   ZFIELD
123100200529     C                     MOVE SDCP      ZFIELD
123200200529     C**********           Z-ADD8         ZADEC                           052254
123300200529     C                     Z-ADD9         ZADEC                           052254
123400200529     C                     EXSR ZEDIT
123500200529     C                     MOVE ZFIELD    SSDCP
123600200529     C                     ELSE
123700200529     C                     MOVE *BLANKS   SSDCP
123800200529     C                     END
123900200529     C*
124000200529     C           SRPT      IFNE *ZEROS
124100200529     C                     MOVE *BLANKS   ZFIELD
124200200529     C                     MOVE SRPT      ZFIELD
124300200529     C                     Z-ADD0         ZADEC
124400200529     C/COPY WNCPYSRC,SE0130C035
124500200529     C                     EXSR ZEDIT
124600200529     C                     MOVE ZFIELD    SSRPT
124700200529     C                     ELSE
124800200529     C                     MOVE *BLANKS   SSRPT
124900200529     C                     END
125000200529     C*
125100200529     C           SDPD      IFNE *ZEROS
125200200529     C                     Z-ADDSDPD      ZDAYNO
125300200529     C                     EXSR ZDATE2
125400200529     C                     MOVE ZDATE     SSDPD
125500200529     C                     ELSE
125600200529     C                     MOVE *BLANKS   SSDPD
125700200529     C                     END
125800200529     C*
125900200529     C                     MOVE SDNV      NAR2
126000200529     C                     END
126100200529     C*
126200200529     C                     SETON                     131819
126300200529     C                     END
126400200529     C*
126500200529     C* Interest Rate changes
126600200529     C*
126700200529     C           SSDET     IFEQ 'IR'
126800200529     C*
126900200529     C* Fetch Cum Coupon rate
127000200529     C*
127100200529     C                     MOVE *BLANKS   ZFIELD                          E20085
127200200529      *                                                                   E20085
127300200529      ***  First check the Diary for prior Prior Rate Change.             E20085
127400200529      *                                                                   E20085
127500200529     C           KSEDO     SETLLSEDEVDO                                   E20085
127600200529     C                     READ SEDEVDO                  89               E20085
127700200529     C           ACTC      IFNE 'I'                                       E25343
127800200529     C                     READ SEDEVDO                  89               E25343
127900200529     C                     END                                            E25343
128000200529     C           *IN89     IFEQ '0'                                       E20085
128100200529     C           SOSDSN    ANDEQSSDSN                                     E20085
128200200529     C           SOSDET    ANDEQ'IR'                                      E20085
128300200529     C                     MOVE SOSDNC    ZFIELD                          E20085
128400200529     C/COPY WNCPYSRC,SE0130C038
128500200529     C*                                                                   E20085
128600200529     C***  If no Prior Diary Event, default to Rate from SECTYD.          E20085
128700200529     C*                                                                   E20085
128800200529     C                     ELSE                                           E20085
128900200529     C***********CPNR      IFNE *ZEROS                                    E20085
129000200529     C***********          MOVE *BLANKS   ZFIELD                          E20085
129100200529     C                     MOVE CPNR      ZFIELD
129200200529     C                     END                                            E20085
129300200529      *                                                                   E20085
129400200529     C           ZFIELD    IFNE *ZEROS                                    E20085
129500200529     C                     Z-ADD7         ZADEC
129600200529     C                     EXSR ZEDIT
129700200529     C                     MOVE ZFIELD    CUMCR
129800200529     C                     ELSE
129900200529     C                     MOVE *BLANKS   CUMCR
130000200529     C                     END
130100200529     C*
130200200529     C           ACTC      IFEQ 'I'
130300200529     C                     MOVE *BLANKS   SSDNC
130400200529     C                     MOVE *BLANKS   NAR1
130500200529     C/COPY WNCPYSRC,SE0130C039
130600200529     C                     ELSE
130700200529     C*
130800200529     C           SDNC      IFNE *ZEROS
130900200529     C                     MOVE *BLANKS   ZFIELD
131000200529     C                     MOVE SDNC      ZFIELD
131100200529     C                     Z-ADD7         ZADEC
131200200529     C                     EXSR ZEDIT
131300200529     C                     MOVE ZFIELD    SSDNC
131400200529     C                     ELSE
131500200529     C                     MOVE *BLANKS   SSDNC
131600200529     C                     END
131700200529     C*
131800200529     C                     MOVE SDNV      NAR1
131900200529     C/COPY WNCPYSRC,SE0130C040
132000200529     C                     END
132100200529     C*
132200200529     C                     SETON                     1020
132300200529     C                     END
132400200529     C*
132500200529     C* Exchange Rates
132600200529     C*
132700200529     C           SSDET     IFEQ 'XR'
132800200529     C*
132900200529     C* Fetch Current Exchange rate
133000200529     C*
133100200529     C           SEXR      IFNE *ZEROS
133200200529     C                     MOVE *BLANKS   ZFIELD
133300200529     C                     MOVE SEXR      ZFIELD
133400200529     C                     Z-ADD8         ZADEC
133500200529     C                     EXSR ZEDIT
133600200529     C                     MOVE ZFIELD    SSEXR
133700200529     C                     ELSE
133800200529     C                     MOVE *BLANKS   SSEXR
133900200529     C                     END
134000200529     C*
134100200529     C           S01509    IFEQ 'N'                                       S01509
134200200529     C*                                                                   S01509
134300200529     C           ACTC      IFEQ 'I'
134400200529     C                     MOVE *BLANKS   PAYC
134500200529     C*
134600200529     C* Fetch previous payment currency if security is multi-currency
134700200529     C*
134800200529     C           MLTI      IFEQ 'Y'
134900200529     C           DEVKA     SETLLSEDEVDFX
135000200529     C           2         OCUR DS01
135100200529     C           READ1     TAG
135200200529     C                     READPSEDEVDFX                 33
135300200529     C           *IN33     IFEQ '1'
135400200529     C           SSDSN     ORNE SDSN
135500200529     C                     GOTO ENDRD1
135600200529     C                     END
135700200529     C*
135800200529     C* If previous 'XR' record found, use Payment currency
135900200529     C*
136000200529     C           SDET      IFEQ 'XR'
136100200529     C                     MOVE SDCX      PAYC
136200200529     C                     ELSE
136300200529     C                     GOTO READ1
136400200529     C                     END
136500200529     C*
136600200529     C           ENDRD1    TAG
136700200529     C*
136800200529     C* If not found, default to nominal currency
136900200529     C*
137000200529     C           1         OCUR DS01
137100200529     C           PAYC      IFEQ '   '
137200200529     C                     MOVE NMCY      PAYC
137300200529     C                     END
137400200529     C                     END
137500200529     C*
137600200529     C                     MOVE *BLANKS   CUTR
137700200529     C                     MOVE ' '       SSDMD
137800200529     C***********          MOVE *BLANKS   NAR2                            E17436
137900200529     C                     MOVE *BLANKS   NAR3                            E17436
138000200529     C                     ELSE
138100200529     C*
138200200529     C                     MOVE SDCX      PAYC
138300200529     C*
138400200529     C           SDCE      IFNE *ZEROS
138500200529     C                     MOVE *BLANKS   ZFIELD
138600200529     C                     MOVE SDCE      ZFIELD
138700200529     C                     Z-ADD8         ZADEC
138800200529     C                     EXSR ZEDIT
138900200529     C                     MOVE ZFIELD    CUTR
139000200529     C                     ELSE
139100200529     C                     MOVE *BLANKS   CUTR
139200200529     C                     END
139300200529     C*
139400200529     C                     MOVE SDMD      SSDMD
139500200529     C***********          MOVE SDNV      NAR2                            E17436
139600200529     C                     MOVE SDNV      NAR3                            E17436
139700200529     C                     END
139800200529     C*
139900200529     C                     ELSE                                           S01509
140000200529     C                     MOVE VLCY      PAYC                            S01509
140100200529     C*                                                                   S01509
140200200529     C           SDCE      IFNE *ZEROS                                    S01509
140300200529     C                     MOVE *BLANKS   ZFIELD                          S01509
140400200529     C                     MOVE SDCE      ZFIELD                          S01509
140500200529     C                     Z-ADD8         ZADEC                           S01509
140600200529     C                     EXSR ZEDIT                                     S01509
140700200529     C                     MOVE ZFIELD    CUTR                            S01509
140800200529     C                     ELSE                                           S01509
140900200529     C                     MOVE *BLANKS   CUTR                            S01509
141000200529     C                     END                                            S01509
141100200529     C*                                                                   S01509
141200200529     C                     MOVE SDMD      RCDMD                           S01509
141300200529     C                     MOVE SDNV      NAR3                            S01509
141400200529     C                     END                                            S01509
141500200529     C*                                                                   S01509
141600200529     C                     SETON                     2122
141700200529     C                     END
141800200529     C*
141900200529     C* Redemption Calls
142000200529     C*
142100200529     C           SSDET     IFEQ 'RC'
142200200529     C           ACTC      IFEQ 'I'
142300200529     C                     MOVE *BLANKS   CLAT
142400200529     C                     MOVE *BLANKS   CPRI
142500200529     C                     MOVE *BLANKS   RAMT
142600200529     C                     MOVE *BLANKS   NAR2
142700200529     C           S01509    IFEQ 'Y'                                       S01509
142800200529     C                     MOVELNMCY      RCCCY                           S01509
142900200529     C                     MOVE *ZEROS    @ZFLD   98                      S01509
143000200529     C                     ADD  1         @ZFLD                           S01509
143100200529     C                     MOVE *BLANKS   ZFIELD                          S01509
143200200529     C                     MOVE @ZFLD     ZFIELD                          S01509
143300200529     C                     Z-ADD8         ZADEC                           S01509
143400200529     C                     EXSR ZEDIT                                     S01509
143500200529     C                     MOVE ZFIELD    XRATE                           S01509
143600200529     C                     MOVE *BLANKS   RCDMD                           S01509
143700200529     C                     END                                            S01509
143800200529     C*                                                                   S01220
143900200529     C           *IN23     IFEQ '1'                                       S01220
144000200529     C                     MOVE 'Y'       SRCIC                           S01220
144100200529     C                     END                                            S01220
144200200529     C*                                                                   S01220
144300200529     C                     ELSE
144400200529     C*
144500200529     C           SDPP      IFNE *ZEROS
144600200529     C                     MOVE *BLANKS   ZFIELD
144700200529     C                     MOVE SDPP      ZFIELD
144800200529     C                     Z-ADD0         ZADEC
144900200529     C                     EXSR ZEDIT
145000200529     C                     MOVE ZFIELD    CLAT
145100200529     C                     ELSE
145200200529     C                     MOVE *BLANKS   CLAT
145300200529     C                     END
145400200529     C*
145500200529     C           SDPC      IFNE *ZEROS
145600200529     C                     MOVE *BLANKS   ZFIELD
145700200529     C                     MOVE SDPC      ZFIELD
145800200529     C                     Z-ADD3         ZADEC
145900200529     C                     EXSR ZEDIT
146000200529     C           SDPC      IFEQ 100                                       E17436
146100200529     C                     MOVE ZFIELD    WCPRI                           E17436
146200200529     C                     MOVELWCPRI     CPRI                            E17436
146300200529     C                     ELSE                                           E17436
146400200529     C                     MOVE ZFIELD    CPRI
146500200529     C                     END                                            E17436
146600200529     C                     ELSE
146700200529     C                     MOVE *BLANKS   CPRI
146800200529     C                     END
146900200529     C*
147000200529     C           SDRP      IFNE *ZEROS
147100200529     C                     MOVE *BLANKS   ZFIELD
147200200529     C                     MOVE SDRP      ZFIELD
147300200529     C                     Z-ADD8         ZADEC
147400200529     C                     EXSR ZEDIT
147500200529     C                     MOVE ZFIELD    RAMT
147600200529     C                     ELSE
147700200529     C                     MOVE *BLANKS   RAMT
147800200529     C                     END
147900200529     C*
148000200529     C***********          MOVE NAR2      SDNV                            E17436
148100200529     C                     MOVE SDNV      NAR2                            E17436
148200200529     C*                                                                   S01509
148300200529     C           S01509    IFEQ 'Y'                                       S01509
148400200529     C                     MOVE *BLANKS   RCCCY                           S01509
148500200529     C                     MOVE *BLANKS   XRATE                           S01509
148600200529     C                     MOVE *BLANK    RCDMD                           S01509
148700200529     C           SDCX      IFNE *BLANKS                                   S01509
148800200529     C                     MOVE SDCX      RCCCY                           S01509
148900200529     C                     END                                            S01509
149000200529     C           SDCE      IFNE *ZEROS                                    S01509
149100200529     C                     MOVE *BLANKS   ZFIELD                          S01509
149200200529     C                     MOVE SDCE      ZFIELD                          S01509
149300200529     C                     Z-ADD8         ZADEC                           S01509
149400200529     C                     EXSR ZEDIT                                     S01509
149500200529     C                     MOVE ZFIELD    XRATE                           S01509
149600200529     C                     END                                            S01509
149700200529     C           SDMD      IFNE *BLANKS                                   S01509
149800200529     C                     MOVE SDMD      RCDMD                           S01509
149900200529     C                     END                                            S01509
150000200529     C                     END                                            S01509
150100200529     C*                                                                   S01220
150200200529     C           *IN23     IFEQ '1'                                       S01220
150300200529     C                     MOVE RCIC      SRCIC                           S01220
150400200529     C                     END                                            S01220
150500200529     C*                                                                   S01220
150600200529     C                     END
150700200529     C*
150800200529     C                     SETON                     1314
150900200529     C                     SETON                     24                   S01220
151000200529     C                     END
151100200529     C*
151200200529     C* Redemption Puts
151300200529     C*
151400200529     C           SSDET     IFEQ 'RP'
151500200529     C           ACTC      IFEQ 'I'
151600200529     C                     MOVE *BLANKS   CLAT
151700200529     C                     MOVE *BLANKS   CPRI
151800200529     C                     MOVE *BLANKS   RAMT
151900200529     C                     MOVE *BLANKS   NAR2
152000200529     C                     ELSE
152100200529     C*
152200200529     C           SDPP      IFNE *ZEROS
152300200529     C                     MOVE *BLANKS   ZFIELD
152400200529     C                     MOVE SDPP      ZFIELD
152500200529     C                     Z-ADD0         ZADEC
152600200529     C                     EXSR ZEDIT
152700200529     C                     MOVE ZFIELD    CLAT
152800200529     C                     ELSE
152900200529     C                     MOVE *BLANKS   CLAT
153000200529     C                     END
153100200529     C*
153200200529     C           SDPC      IFNE *ZEROS
153300200529     C                     MOVE *BLANKS   ZFIELD
153400200529     C                     MOVE SDPC      ZFIELD
153500200529     C                     Z-ADD3         ZADEC
153600200529     C                     EXSR ZEDIT
153700200529     C           SDPC      IFEQ 100                                       E17436
153800200529     C                     MOVE ZFIELD    WCPRI                           E17436
153900200529     C                     MOVELWCPRI     CPRI                            E17436
154000200529     C                     ELSE                                           E17436
154100200529     C                     MOVE ZFIELD    CPRI
154200200529     C                     END                                            E17436
154300200529     C                     ELSE
154400200529     C                     MOVE *BLANKS   CPRI
154500200529     C                     END
154600200529     C*
154700200529     C           SDRP      IFNE *ZEROS
154800200529     C                     MOVE *BLANKS   ZFIELD
154900200529     C                     MOVE SDRP      ZFIELD
155000200529     C                     Z-ADD8         ZADEC
155100200529     C                     EXSR ZEDIT
155200200529     C                     MOVE ZFIELD    RAMT
155300200529     C                     ELSE
155400200529     C                     MOVE *BLANKS   RAMT
155500200529     C                     END
155600200529     C*
155700200529     C***********          MOVE NAR2      SDNV                            E17436
155800200529     C                     MOVE SDNV      NAR2                            E17436
155900200529     C                     END
156000200529     C*
156100200529     C                     SETON                     1315
156200200529     C                     END
156300200529     C*
156400200529     C* Conversions
156500200529     C*
156600200529     C           SSDET     IFEQ 'CV'
156700200529     C           ACTC      IFEQ 'I'
156800200529     C                     MOVE *BLANKS   SSDCV
156900200529     C                     MOVE NMCY      CONC
157000200529     C                     MOVE *BLANKS   CONR
157100200529     C                     MOVE *BLANKS   CONP
157200200529     C                     MOVE *BLANKS   NAR3
157300200529     C                     ELSE
157400200529     C*
157500200529     C                     MOVE SDCV      SSDCV
157600200529     C           SDCX      IFNE *BLANKS
157700200529     C                     MOVE SDCX      CONC
157800200529     C                     ELSE
157900200529     C                     MOVE NMCY      CONC
158000200529     C                     END
158100200529     C*
158200200529     C           SDCE      IFNE *ZEROS
158300200529     C                     MOVE *BLANKS   ZFIELD
158400200529     C                     MOVE SDCE      ZFIELD
158500200529     C                     Z-ADD8         ZADEC
158600200529     C                     EXSR ZEDIT
158700200529     C                     MOVE ZFIELD    CONR
158800200529     C                     ELSE
158900200529     C                     MOVE *BLANKS   CONR
159000200529     C                     END
159100200529     C*
159200200529     C           SDRP      IFNE *ZEROS
159300200529     C                     MOVE *BLANKS   ZFIELD
159400200529     C                     MOVE SDRP      ZFIELD
159500200529     C                     Z-ADD8         ZADEC
159600200529     C                     EXSR ZEDIT
159700200529     C                     MOVE ZFIELD    CONP
159800200529     C                     ELSE
159900200529     C                     MOVE *BLANKS   CONP
160000200529     C                     END
160100200529     C*
160200200529     C                     MOVE SDNV      NAR3
160300200529     C                     END
160400200529     C*
160500200529     C                     SETON                     1622
160600200529     C                     END
160700200529     C/COPY WNCPYSRC,SE0130C025
160800200529     C*
160900200529     C* Bonus Issues
161000200529     C*
161100200529     C           SSDET     IFEQ 'BI'
161200200529     C*
161300200529     C* Rights Issues
161400200529     C*
161500200529     C           SSDET     OREQ 'RI'
161600200529     C*
161700200529     C* Capital Reorganisation
161800200529     C*
161900200529     C           SSDET     OREQ 'CR'
162000200529     C*
162100200529     C* Other changes
162200200529     C*
162300200529     C           SSDET     OREQ 'OC'
162400200529     C           ACTC      IFEQ 'I'
162500200529     C                     MOVE *BLANKS   NAR4
162600200529     C                     ELSE
162700200529     C                     MOVE SDNV      NAR4
162800200529     C                     END
162900200529     C                     SETON                     17
163000200529     C                     END
163100200529     C/COPY WNCPYSRC,SE0130C003
163200200529     C*
163300200529     C                     END
163400200529     C*
163500200529     C                     MOVE 'Y'       FIRSTA  1
163600200529     C*
163700200529     C* Display second screen
163800200529     C*
163900200529     C           SSDED1    IFNE *BLANKS                                                       196599
164000200529     C                     MOVE SSDED1    SSDED                                               196599
164100200529     C                     ENDIF                                                              196599
164200200529     C                     WRITESE0130F1
164300200529     C           ZSTAG1    TAG                             *** ZSTAG1 ***
164400200529     C/COPY WNCPYSRC,SE0130C034
164500200529      *                                                                   CSE016
164600200529      ** Format security report description                               CSE016
164700200529      *                                                                   CSE016
164800200529     C                     MOVE *BLANKS   SRNME                           CSE016
164900200529      *                                                                   CSE016
165000200529     C           SRPN      IFNE *BLANKS                                   CSE016
165100200529      *                                                                   CSE016
165200200529     C                     MOVE BVRIDF    ZRSFD                           CSE016
165300200529     C                     MOVELSRPN      ZSRPN                           CSE016
165400200529     C                     EXSR ZSDESC                                    CSE016
165500200529     C                     MOVELZRNME     SRNME                           CSE016
165600200529      *                                                                   CSE016
165700200529     C                     WRITESE0130F1                                  CSE016
165800200529      *                                                                   CSE016
165900200529     C                     ENDIF                                          CSE016
166000200529      *                                                                   CSE016
166100200529     C                     EXFMTSE0130F2
166200200529     C*
166300200529     C* F3 - End job
166400200529     C* or F12- Display initial screen requested
166500200529     C*
166600200529     C   01
166700200529     COR 05                GOTO ZSEND
166800200529     C*
166900200529     C**HELP*key*pressed*-*call*standard*HELP*program******************   S01199
167000200529     C***********                                                         S01199
167100200529     C********** *IN06     IFEQ '1'                                       S01199
167200200529     C**********           CALL 'MHELP'                                   S01199
167300200529     C**********           PARM           DBPGM                           S01199
167400200529     C**********           PARM           ERRMSG                          S01199
167500200529     C**********                                                          S01199
167600200529     C**********           GOTO ZSTAG1                                    S01199
167700200529     C**********           END                                            S01199
167800200529     C*
167900200529     C* ROLLDOWN key pressed
168000200529     C*
168100200529     C           *IN08     IFEQ '1'
168200200529     C                     Z-ADD*ZEROS    EC
168300200529     C                     SETOF                     09
168400200529     C                     EXSR INITL
168500200529     C                     GOTO ZSTAG1
168600200529     C                     END
168700200529     C*
168800200529     C**  If been through at least once and no Screen Changes, all
168900200529     C**  errors are Warning Errors. Do not perform the Update, no
169000200529     C**  need to validate
169100200529     C*
169200200529     C           FIRSTA    IFEQ 'N'
169300200529     C           WEC       ANDEQEC
169400200529     C           *IN80     ANDEQ'0'
169500200529     C                     Z-ADD0         EC
169600200529     C                     SETOF                     0952
169700200529     C                     GOTO UPD2
169800200529     C                     END
169900200529     C*
170000200529     C** Check if selection is requested                                  S01117
170100200529     C*                                                                   S01117
170200200529     C                     MOVE 'N'       @SEL    1                       S01117
170300200529     C*                                                                   S01117
170400200529     C*   Selection requested on payment currency                         S01117
170500200529     C*                                                                   S01117
170600200529     C                     MOVELPAYC      @STP    1                       S01117
170700200529     C           @STP      IFEQ '?'                                       S01117
170800200529     C                     MOVE 'Y'       @SEL                            S01117
170900200529     C                     CALL 'AOCURRR0'                                S01117
171000200529     C                     PARM *BLANK    @RTCD   7                       S01117
171100200529     C                     PARM '*KEY   ' @OPTN   7                       S01117
171200200529     C                     PARM PAYC      @AJCD   3                       S01117
171300200529     C           SDCURR    PARM SDCURR    DSSDY                           S01117
171400200529     C*                                                                   S01117
171500200529     C           @RTCD     IFEQ *BLANKS                                   S01117
171600200529     C                     MOVE A6CYCD    PAYC                            S01117
171700200529     C                     ELSE                                           S01117
171800200529     C                     MOVE *BLANKS   PAYC                            S01117
171900200529     C                     END                                            S01117
172000200529     C                     END                                            S01117
172100200529     C*                                                                   S01117
172200200529     C*   Selection requested on payment currency                         S01117
172300200529     C*                                                                   S01117
172400200529     C                     MOVELCONC      @STP    1                       S01117
172500200529     C           @STP      IFEQ '?'                                       S01117
172600200529     C                     MOVE 'Y'       @SEL                            S01117
172700200529     C                     CALL 'AOCURRR0'                                S01117
172800200529     C                     PARM *BLANK    @RTCD   7                       S01117
172900200529     C                     PARM '*KEY   ' @OPTN   7                       S01117
173000200529     C                     PARM CONC      @AJCD   3                       S01117
173100200529     C           SDCURR    PARM SDCURR    DSSDY                           S01117
173200200529     C*                                                                   S01117
173300200529     C           @RTCD     IFEQ *BLANKS                                   S01117
173400200529     C                     MOVE A6CYCD    CONC                            S01117
173500200529     C                     ELSE                                           S01117
173600200529     C                     MOVE *BLANKS   CONC                            S01117
173700200529     C                     END                                            S01117
173800200529     C                     END                                            S01117
173900200529     C*                                                                   S01117
174000200529     C*     If selection is requested redisplay the second screen         S01117
174100200529     C*                                                                   S01117
174200200529     C           @SEL      IFEQ 'Y'                                       S01117
174300200529     C                     GOTO ZSTAG1                                    S01117
174400200529     C                     END                                            S01117
174500200529     C* Validate entries
174600200529     C*
174700200529     C           ACTC      IFEQ 'I'
174800200529     C           ACTC      OREQ 'A'
174900200529     C                     EXSR VLDSEC
175000200529     C*
175100200529     C* If any errors, re-display screen
175200200529     C*
175300200529     C                     MOVE 'N'       FIRSTA
175400200529     C*
175500200529     C*
175600200529     C           EC        CABGT*ZEROS    ZSTAG1     09
175700200529     C*
175800200529     C           UPD2      TAG                             ***  UPD2  ***
175900200529     C                     END
176000200529     C*
176100200529     C* If F10 not pressed in delete mode, re-display screen
176200200529     C*
176300200529     C           ACTC      IFEQ 'D'
176400200529     C           *IN04     ANDEQ'0'
176500200529     C                     GOTO ZSTAG1
176600200529     C                     END
176700200529     C*
176800200529     C           ZSEND     ENDSR                           *** ZSEND ***
176900200529      *
177000200529      *****************************************************************
177100200529      /EJECT
177200200529      *****************************************************************
177300200529      *                                                               *
177400200529      *  TRSEDE - Subroutine to translate SEDEVD fields from Screen   *
177500200529      *           Format to File Format.                              *
177600200529      *                                                               *
177700200529      *****************************************************************
177800200529      *
177900200529     C           TRSEDE    BEGSR                           *** TRSEDE ***
178000200529     C*
178100200529     C                     MOVE SSDSN     SDSN
178200200529     C*
178300200529     C**  Event date - store as day number
178400200529     C*
178500200529     C           SSDED     IFNE '999999'                                  S01158
178600200529     C                     MOVE SSDED     ZDATE
178700200529     C                     EXSR ZDATE1
178800200529     C                     Z-ADDZDAYNO    SDED
178900200529     C                     ELSE                                           S01158
179000200529     C                     Z-ADD99999     SDED                            S01158
179100200529     C                     END                                            S01158
179200200529     C*
179300200529     C                     MOVE SSDET     SDET
179400200529     C*
179500200529     C*                                                                   S01220
179600200529     C**  Set Include Redemption Call in Risk Analysis Indicator to 'N'   S01220
179700200529     C**  on file if Risk Management is switched on                       S01220
179800200529     C**  (it will be overwritten by the screen value if the event type   S01220
179900200529     C**  is 'RC' later in this subroutine)                               S01220
180000200529     C*                                                                   S01220
180100200529     C           *IN23     IFEQ '1'                                       S01220
180200200529     C                     MOVE 'N'       RCIC                            S01220
180300200529     C                     END                                            S01220
180400200529     C*
180500200529     C**  Dividends
180600200529     C*
180700200529     C           SDET      IFEQ 'DV'
180800200529     C*
180900200529     C**  Output Amount per unit as valid number
181000200529     C*
181100200529     C                     MOVE *BLANKS   ZFIELD
181200200529     C                     MOVE SSDDV     ZFIELD
181300200529     C***********          Z-ADD9         ZADIG                           E16772
181400200529     C***********          Z-ADD4         ZADEC                           E16772
181500200529     C                     Z-ADD5         ZADIG                           E16772
181600200529     C                     Z-ADD8         ZADEC                           E16772
181700200529     C                     EXSR ZALIGN
181800200529     C***********          MOVE ZFIELD    SDDV                            E16772
181900200529     C                     MOVE ZFIELD    SDVA                            E16772
182000200529     C*
182100200529     C**  Convert Payment date to number
182200200529     C*
182300200529     C                     MOVE SSDPD     ZDATE
182400200529     C                     EXSR ZDATE1
182500200529     C                     Z-ADDZDAYNO    SDPD
182600200529      *                                                                   S01510
182700200529     C                     MOVE SSDXD     ZDATE                           S01510
182800200529     C                     EXSR ZDATE1                                    S01510
182900200529     C                     Z-ADDZDAYNO    SDXD                            S01510
183000200529     C*
183100200529     C**  Narrative
183200200529     C*
183300200529     C                     MOVE NAR1      SDNV
183400200529     C/COPY WNCPYSRC,SE0130C032
183500200529     C                     END
183600200529     C*
183700200529     C* Partly paids
183800200529     C*
183900200529     C           SDET      IFEQ 'PP'
184000200529     C*
184100200529     C* If Security is a Share, output Call amount
184200200529     C*
184300200529     C           PROT      IFEQ '4'
184400200529     C                     MOVE *BLANKS   ZFIELD
184500200529     C                     MOVE CAMT      ZFIELD
184600200529     C*
184700200529     C* Use nominal decimal places
184800200529     C*
184900200529     C***********          MOVE *BLANKS   KEY12A                          S01117
185000200529     C***********          MOVELNMCY      WORK4                           S01117
185100200529     C***********          MOVE '1'       WORK4                           S01117
185200200529     C***********          MOVEL'20'      KEY12A                          S01117
185300200529     C***********          MOVE WORK4     KEY12A                          S01117
185400200529     C***********TABKA     CHAINTABTG10F             33                   S01117
185500200529     C                     MOVE NMCY      @AJCD                           S01117
185600200529     C                     CALL 'AOCURRR0'                                S01117
185700200529     C                     PARM '*DBERR ' @RTCD   7                       S01117
185800200529     C                     PARM '*KEY   ' @OPTN   7                       S01117
185900200529     C                     PARM           @AJCD   3                       S01117
186000200529     C           SDCURR    PARM SDCURR    DSSDY                           S01117
186100200529     C***********          Z-ADDCDP       ZADEC                           S01117
186200200529     C***********15        SUB  CDP       ZADIG                           S01117
186300200529     C                     Z-ADDA6NBDP    ZADEC                           S01117
186400200529     C           15        SUB  A6NBDP    ZADIG                           S01117
186500200529     C                     EXSR ZALIGN
186600200529     C                     MOVE ZFIELD    SDPP
186700200529     C*
186800200529     C* Else output Call percentage
186900200529     C*
187000200529     C                     ELSE
187100200529     C                     MOVE *BLANKS   ZFIELD
187200200529     C                     MOVE CPRI      ZFIELD
187300200529     C                     Z-ADD3         ZADIG
187400200529     C                     Z-ADD3         ZADEC
187500200529     C                     EXSR ZALIGN
187600200529     C                     MOVE ZFIELD    SDPC
187700200529     C                     END
187800200529     C*
187900200529     C           ACTC      IFEQ 'A'
188000200529     C                     Z-ADDSDPP      NWSDPP
188100200529     C                     Z-ADDSDPC      NWSDPC
188200200529     C                     END
188300200529     C*
188400200529     C* Add Call amount/percentage to 'To date' figure
188500200529     C*
188600200529     C* Fetch previous total
188700200529     C*
188800200529     C           DEVKA     SETLLSEDEVDFX
188900200529     C                     Z-ADD*ZEROS    SVSDTA
189000200529     C                     Z-ADD*ZEROS    OLSDPP
189100200529     C                     Z-ADD*ZEROS    OLSDPC
189200200529     C                     Z-ADD*ZEROS    SVSDTP
189300200529     C           2         OCUR DS01
189400200529      *
189500200529     C           AGAINZ    TAG                             *** AGAINZ ***
189600200529      *
189700200529     C                     READPSEDEVDFX                 33
189800200529     C  N33      SDSN      COMP SSDSN                3333
189900200529      *
190000200529     C* IF 33 ON ==> NO PP RECORDS ON DIARY                               E15930
190100200529     C   33                Z-ADDORIDTA    SVSDTA                          E15930
190200200529     C   33                Z-ADDORIDTP    SVSDTP                          E15930
190300200529     C   33                GOTO OUTZ
190400200529     C*
190500200529     C* Check record is not a cancelled record
190600200529     C*
190700200529     C           RECI      CABEQ'C'       AGAINZ         32
190800200529     C*
190900200529     C* Check Event type is same
191000200529     C*
191100200529     C           SDET      CABNE'PP'      AGAINZ
191200200529     C*
191300200529     C* Save previous total values
191400200529     C*
191500200529     C                     Z-ADDSDTA      SVSDTA
191600200529     C                     Z-ADDSDPP      OLSDPP
191700200529     C                     Z-ADDSDPC      OLSDPC
191800200529     C                     Z-ADDSDTP      SVSDTP
191900200529     C*
192000200529     C           OUTZ      TAG                             ***  OUTZ  ***
192100200529     C           1         OCUR DS01
192200200529     C*
192300200529     C* Add above amounts to totals
192400200529     C*
192500200529     C           SVSDTA    ADD  SDPP      SDTA
192600200529     C           SVSDTP    ADD  SDPC      SDTP
192700200529     C*
192800200529     C* Narrative
192900200529     C*
193000200529     C                     MOVE NAR1      SDNV
193100200529     C                     END
193200200529     C*
193300200529     C* Mortgage Payments
193400200529     C*
193500200529     C           SDET      IFEQ 'MP'
193600200529     C*
193700200529     C* Current Factor - If input, convert to valid number, else
193800200529     C*                  calculate as follows:-
193900200529     C*
194000200529     C**   (Issue amount - (Repayments to date + Repayment amount))
194100200529     C**   divided by issue amount
194200200529     C*
194300200529     C           SSDCP     IFNE *BLANKS
194400200529     C                     MOVE *BLANKS   ZFIELD
194500200529     C                     MOVE SSDCP     ZFIELD
194600200529     C                     Z-ADD1         ZADIG
194700200529     C**********           Z-ADD8         ZADEC                           052254
194800200529     C                     Z-ADD9         ZADEC                           052254
194900200529     C                     EXSR ZALIGN
195000200529     C                     MOVE ZFIELD    SDCP
195100200529     C*
195200200529     C                     ELSE
195300200529     C*
195400200529     C* Fetch total previously repaid
195500200529     C*
195600200529     C           DEVKA     SETGTSEDEVDFX
195700200529     C                     Z-ADD*ZEROS    SVSDTR
195800200529     C           2         OCUR DS01
195900200529      *
196000200529     C           AGAIN4    TAG                             *** AGAIN4 ***
196100200529      *
196200200529     C                     READPSEDEVDFX                 33
196300200529     C  N33      SDSN      COMP SSDSN                3333
196400200529     C   33                GOTO OUT5
196500200529     C*
196600200529     C* Check record is a not cancelled record
196700200529     C*
196800200529     C           RECI      CABEQ'C'       AGAIN4
196900200529     C*
197000200529     C* Check Event type is same
197100200529     C*
197200200529     C           SDET      CABNE'MP'      AGAIN4
197300200529     C*
197400200529     C* Save previous total repaid
197500200529     C*
197600200529     C                     Z-ADDSDTR      SVSDTR
197700200529     C*
197800200529     C           OUT5      TAG                             ***  OUT5  ***
197900200529      *
198000200529     C           1         OCUR DS01
198100200529     C*
198200200529     C* Convert Repayment amount to number
198300200529     C*
198400200529     C                     MOVE *BLANKS   ZFIELD
198500200529     C                     MOVE SSRPT     ZFIELD
198600200529     C                     Z-ADD15        ZADIG
198700200529     C                     Z-ADD*ZERO     ZADEC
198800200529     C/COPY WNCPYSRC,SE0130C036
198900200529     C                     EXSR ZALIGN
199000200529     C                     MOVE ZFIELD    SRPT
199100200529     C*
199200200529     C* Add amount to total
199300200529     C*
199400200529     C           SDTR      ADD  SRPT      TOTR
199500200529     C*
199600200529     C* Subtract from Issue amount
199700200529     C*
199800200529     C           ISSA      SUB  TOTR      RES1
199900200529     C*
200000200529     C* Divide result by Issue amount
200100200529     C*
200200200529     C           ISSA      IFEQ *ZEROS
200300200529     C                     Z-ADD1         ISSA
200400200529     C                     END
200500200529     C*
200600200529     C           RES1      DIV  ISSA      SDCP
200700200529     C*
200800200529     C                     END
200900200529     C*
201000200529     C* Convert Repayment amount to number, and save it to update the
201100200529     C* running total
201200200529     C*
201300200529     C                     MOVE *BLANKS   ZFIELD
201400200529     C                     MOVE SSRPT     ZFIELD
201500200529     C                     Z-ADD15        ZADIG
201600200529     C                     Z-ADD*ZERO     ZADEC
201700200529     C/COPY WNCPYSRC,SE0130C037
201800200529     C                     EXSR ZALIGN
201900200529     C                     MOVE ZFIELD    SRPT
202000200529     C*
202100200529     C           ACTC      IFEQ 'A'
202200200529     C                     Z-ADDSRPT      NWSRPT
202300200529     C                     END
202400200529     C*
202500200529     C* Add Repayment amount to 'To date' figure
202600200529     C*
202700200529     C* Fetch total previously repaid
202800200529     C*
202900200529     C           DEVKA     SETLLSEDEVDFX
203000200529     C                     Z-ADD*ZEROS    SVSDTR
203100200529     C                     Z-ADD*ZEROS    OLSRPT
203200200529     C                     MOVE ' '       SVSRMI
203300200529     C           2         OCUR DS01
203400200529      *
203500200529     C           AGAIN5    TAG                             *** AGAIN5 ***
203600200529      *
203700200529     C                     READPSEDEVDFX                 33
203800200529     C  N33      SDSN      COMP SSDSN                3333
203900200529     C   33                GOTO OUT6
204000200529     C*
204100200529     C* Check record is not a cancelled record
204200200529     C*
204300200529     C           RECI      CABEQ'C'       AGAIN5
204400200529     C*
204500200529     C* Check Event type is same
204600200529     C*
204700200529     C           SDET      CABNE'MP'      AGAIN5
204800200529     C*
204900200529     C* Save previous fields
205000200529     C*
205100200529     C                     Z-ADDSDTR      SVSDTR
205200200529     C                     Z-ADDSRPT      OLSRPT
205300200529     C                     MOVE SRMI      SVSRMI
205400200529     C*
205500200529     C           OUT6      TAG                             ***  OUT6  ***
205600200529      *
205700200529     C           1         OCUR DS01
205800200529     C*
205900200529     C* Add amount to total
206000200529     C*
206100200529     C           SVSDTR    ADD  SRPT      SDTR
206200200529     C*
206300200529     C* Set Repayment Method indicator to 'Y' if previously so, or if
206400200529     C* Repayment amount entered
206500200529     C*
206600200529     C           SVSRMI    IFEQ 'Y'
206700200529     C           SRPT      ORGT *ZEROS
206800200529     C                     MOVE 'Y'       SRMI
206900200529     C                     END
207000200529     C*
207100200529     C* Convert Payment date to number
207200200529     C*
207300200529     C                     MOVE SSDPD     ZDATE
207400200529     C                     EXSR ZDATE1
207500200529     C                     Z-ADDZDAYNO    SDPD
207600200529     C*
207700200529     C* Narrative
207800200529     C*
207900200529     C                     MOVE NAR2      SDNV
208000200529     C                     END
208100200529     C*
208200200529     C* Interest Rate change
208300200529     C*
208400200529     C           SDET      IFEQ 'IR'
208500200529     C*
208600200529     C* Convert Next Coupon Rate to Number
208700200529     C*
208800200529     C                     MOVE *BLANKS   ZFIELD
208900200529     C                     MOVE SSDNC     ZFIELD
209000200529     C                     Z-ADD4         ZADIG
209100200529     C                     Z-ADD7         ZADEC
209200200529     C                     EXSR ZALIGN
209300200529     C                     MOVE ZFIELD    SDNC
209400200529     C*
209500200529     C* Narrative
209600200529     C*
209700200529     C                     MOVE NAR1      SDNV
209800200529     C/COPY WNCPYSRC,SE0130C041
209900200529     C                     END
210000200529     C*
210100200529     C* Exchange Rate
210200200529     C*
210300200529     C           SDET      IFEQ 'XR'
210400200529     C*
210500200529     C* Payment currency
210600200529     C*
210700200529     C                     MOVE PAYC      SDCX
210800200529     C*
210900200529     C* Convert Cut Coupon exchange rate to number
211000200529     C*
211100200529     C                     MOVE *BLANKS   ZFIELD
211200200529     C                     MOVE CUTR      ZFIELD
211300200529     C                     Z-ADD5         ZADIG
211400200529     C                     Z-ADD8         ZADEC
211500200529     C                     EXSR ZALIGN
211600200529     C                     MOVE ZFIELD    SDCE
211700200529     C*
211800200529     C* Multiply/Divide indicator
211900200529     C*
212000200529     C                     MOVE SSDMD     SDMD
212100200529     C*
212200200529     C* Narrative
212300200529     C*
212400200529     C                     MOVE NAR3      SDNV
212500200529     C                     END
212600200529     C*
212700200529     C* Redemption Calls/Puts
212800200529     C*
212900200529     C           SDET      IFEQ 'RC'
213000200529     C           SDET      OREQ 'RP'
213100200529     C*
213200200529     C* Convert Call amount or percentage to number, and save it to update
213300200529     C* the running total
213400200529     C*
213500200529     C* Call amount
213600200529     C*
213700200529     C           CLAT      IFNE *BLANKS
213800200529     C                     MOVE *BLANKS   ZFIELD
213900200529     C                     MOVE CLAT      ZFIELD
214000200529     C                     Z-ADD11        ZADIG
214100200529     C                     Z-ADD*ZERO     ZADEC
214200200529     C                     EXSR ZALIGN
214300200529     C                     MOVE ZFIELD    SDPP
214400200529     C                     Z-ADD*ZEROS    SDPC
214500200529     C                     ELSE
214600200529     C*
214700200529     C* Call percentage
214800200529     C*
214900200529     C                     MOVE *BLANKS   ZFIELD
215000200529     C                     MOVE CPRI      ZFIELD
215100200529     C                     Z-ADD3         ZADIG
215200200529     C                     Z-ADD3         ZADEC
215300200529     C                     EXSR ZALIGN
215400200529     C                     MOVE ZFIELD    SDPC
215500200529     C                     Z-ADD*ZEROS    SDPP
215600200529     C                     END
215700200529     C*
215800200529     C** RC to be included in Cash Flow Analysis?                         S01220
215900200529     C*                                                                   S01220
216000200529     C           *IN23     IFEQ '1'                                       S01220
216100200529     C                     MOVE SRCIC     RCIC                            S01220
216200200529     C                     END                                            S01220
216300200529     C*                                                                   S01220
216400200529     C           ACTC      IFEQ 'A'
216500200529     C                     Z-ADDSDPP      NWSDPP
216600200529     C                     Z-ADDSDPC      NWSDPC
216700200529     C                     END
216800200529     C*
216900200529     C* Add Call amount/percentage to 'To date' figure
217000200529     C*
217100200529     C* Fetch previous total
217200200529     C*
217300200529     C           DEVKA     SETLLSEDEVDFX
217400200529     C                     Z-ADD*ZEROS    SVSDTA
217500200529     C                     Z-ADD*ZEROS    OLSDPP
217600200529     C                     Z-ADD*ZEROS    OLSDPC
217700200529     C                     Z-ADD*ZEROS    SVSDTP
217800200529     C           2         OCUR DS01
217900200529      *
218000200529     C           AGAIN6    TAG                             *** AGAIN6 ***
218100200529      *
218200200529     C                     READPSEDEVDFX                 33
218300200529     C  N33      SDSN      COMP SSDSN                3333
218400200529     C   33                GOTO OUT7
218500200529     C*
218600200529     C* Check record is not a cancelled record
218700200529     C*
218800200529     C           RECI      CABEQ'C'       AGAIN6         32
218900200529     C*
219000200529     C* Check Event type is same
219100200529     C*
219200200529     C           SDET      COMP 'RC'                     32
219300200529     C  N32      SDET      COMP 'RP'                     32
219400200529     C  N32                GOTO AGAIN6
219500200529     C*
219600200529     C* Save previous total values
219700200529     C*
219800200529     C                     Z-ADDSDTA      SVSDTA
219900200529     C                     Z-ADDSDPP      OLSDPP
220000200529     C                     Z-ADDSDPC      OLSDPC
220100200529     C                     Z-ADDSDTP      SVSDTP
220200200529     C*
220300200529     C           OUT7      TAG                             ***  OUT7  ***
220400200529     C           1         OCUR DS01
220500200529     C*
220600200529     C* Add above amounts to totals
220700200529     C*
220800200529     C           SVSDTA    ADD  SDPP      SDTA
220900200529     C           SVSDTP    ADD  SDPC      SDTP
221000200529     C*
221100200529     C* Convert Redemption Price to number
221200200529     C*
221300200529     C                     MOVE *BLANKS   ZFIELD
221400200529     C                     MOVE RAMT      ZFIELD
221500200529     C                     Z-ADD7         ZADIG
221600200529     C                     Z-ADD8         ZADEC
221700200529     C                     EXSR ZALIGN
221800200529     C                     MOVE ZFIELD    SDRP
221900200529     C*
222000200529     C           SDET      IFEQ 'RC'                                      S01509
222100200529     C           S01509    ANDEQ'Y'                                       S01509
222200200529     C*                                                                   S01509
222300200529     C* Save Redemption Currency                                          S01509
222400200529     C                     MOVE RCCCY     SDCX                            S01509
222500200529     C*                                                                   S01509
222600200529     C* Convert Exchange Rate to number                                   S01509
222700200529     C                     MOVE *BLANKS   ZFIELD                          S01509
222800200529     C                     MOVE XRATE     ZFIELD                          S01509
222900200529     C                     Z-ADD5         ZADIG                           S01509
223000200529     C                     Z-ADD8         ZADEC                           S01509
223100200529     C                     EXSR ZALIGN                                    S01509
223200200529     C                     MOVE ZFIELD    SDCE                            S01509
223300200529     C*                                                                   S01509
223400200529     C* Multiply/Divide indicator                                         S01509
223500200529     C                     MOVE RCDMD     SDMD                            S01509
223600200529     C*                                                                   S01509
223700200529     C                     END                                            S01509
223800200529     C*
223900200529     C* Narrative
224000200529     C*
224100200529     C                     MOVE NAR2      SDNV
224200200529     C                     END
224300200529     C*
224400200529     C* Conversions
224500200529     C*
224600200529     C           SDET      IFEQ 'CV'
224700200529     C*
224800200529     C* Conversion Security
224900200529     C*
225000200529     C                     MOVE SSDCV     SDCV
225100200529     C*
225200200529     C* Conversion Currency
225300200529     C*
225400200529     C                     MOVE CONC      SDCX
225500200529     C*
225600200529     C* Convert Conversion exchange rate to number
225700200529     C*
225800200529     C                     MOVE *BLANKS   ZFIELD
225900200529     C                     MOVE CONR      ZFIELD
226000200529     C                     Z-ADD5         ZADIG
226100200529     C                     Z-ADD8         ZADEC
226200200529     C                     EXSR ZALIGN
226300200529     C                     MOVE ZFIELD    SDCE
226400200529     C*
226500200529     C* Convert Conversion price to number
226600200529     C*
226700200529     C                     MOVE *BLANKS   ZFIELD
226800200529     C                     MOVE CONP      ZFIELD
226900200529     C                     Z-ADD7         ZADIG
227000200529     C                     Z-ADD8         ZADEC
227100200529     C                     EXSR ZALIGN
227200200529     C                     MOVE ZFIELD    SDRP
227300200529     C*
227400200529     C* Narrative
227500200529     C*
227600200529     C                     MOVE NAR3      SDNV
227700200529     C                     END
227800200529     C/COPY WNCPYSRC,SE0130C004
227900200529     C*
228000200529     C* Bonus Issues, Rights Issues, Capital Reorganisation or Other
228100200529     C* Changes
228200200529     C*
228300200529     C           SDET      IFEQ 'BI'
228400200529     C           SDET      OREQ 'RI'
228500200529     C           SDET      OREQ 'CR'
228600200529     C           SDET      OREQ 'OC'
228700200529     C/COPY WNCPYSRC,SE0130C005
228800200529     C                     MOVE NAR4      SDNV
228900200529     C                     END
229000200529     C*
229100200529     C/COPY WNCPYSRC,SE0130C014
229200200529     C                     Z-ADD*ZEROS    SDAD
229300200529     C                     Z-ADD*ZEROS    SDDT
229400200529     C/COPY WNCPYSRC,SE0130C015
229500200529     C                     Z-ADDRUND      LCD
229600200529     C                     MOVE ACTC      CHTP
229700200529     C*
229800200529     C                     ENDSR
229900200529      *
230000200529      *****************************************************************
230100200529      /EJECT
230200200529      *****************************************************************
230300200529      *                                                               *
230400200529      *  UPDFLS - Subroutine to Update the Files.                     *
230500200529      *                                                               *
230600200529      *****************************************************************
230700200529      *
230800200529     C           UPDFLS    BEGSR                           *** UPDFLS ***
230900200529     C*
231000200529     C* Fetch last used transaction number
231100200529     C*
231200200529     C                     EXSR ZTNLU1
231300200529      *                                                                   CSE031
231400200529      ** If Amending a Security of Event type 'IR' which has been         CSE031
231500200529      ** actioned then Delete current event and Insert a new one.         CSE031
231600200529      *                                                                   CSE031
231700200529     C           CSE031    IFEQ 'Y'                                       CSE031
231800200529     C           ACTC      ANDEQ'A'                                       CSE031
231900200529     C           SSDET     ANDEQ'IR'                                      CSE031
232000200529     C           EVTDNO    ANDLTRUND                                      CSE031
232100200529     C           SDAD      ANDNE*ZEROS                                    CSE031
232200200529      *                                                                   CSE031
232300200529     C           DEVKA     CHAINSEDEVDF              31                   CSE031
232400200529      *                                                                   CSE031
232500200529      ** Delete this Diary Event                                          CSE031
232600200529     C                     MOVE 'C'       RECI                            CSE031
232700200529     C                     Z-ADDRUND      LCD                             CSE031
232800200529     C                     MOVE 'D'       CHTP                            CSE031
232900200529     C                     MOVELNATN      TNLU                            CSE031
233000200529      *                                                                   CSE031
233100200529     C                     EXCPTDLTREC                                    CSE031
233200200529      *                                                                   CSE031
233300200529      ** Fetch last used transaction number                               CSE031
233400200529     C                     EXSR ZTNLU1                                    CSE031
233500200529      *                                                                   CSE031
233600200529      ** Insert a New Diary Event                                         CSE031
233700200529     C                     EXSR TRSEDE                                    CSE031
233800200529     C                     MOVE 'D'       RECI                            CSE031
233900200529     C                     Z-ADDRUND      LCD                             CSE031
234000200529     C                     MOVE 'I'       CHTP                            CSE031
234100200529     C                     MOVELNATN      TNLU                            CSE031
234200200529      *                                                                   CSE031
234300200529     C                     WRITESEDEVDF                                   CSE031
234400200529      *                                                                   CSE031
234500200529      ** Update Audit record                                              CSE031
234600200529     C           1         CHAINSEDEVAF              U8                   CSE031
234700200529      *                                                                   CSE031
234800200529     C                     ADD  1         NOIN                            CSE031
234900200529     C                     ADD  1         NORE                            CSE031
235000200529     C                     ADD  1         NODE                            CSE031
235100200529      *                                                                   CSE031
235200200529     C                     Z-ADDRUND      LCD                             CSE031
235300200529     C                     MOVE 'A'       CHTP                            CSE031
235400200529     C                     MOVELNATN      TNLU                            CSE031
235500200529      *                                                                   CSE031
235600200529     C                     UPDATSEDEVAF                                   CSE031
235700200529      *                                                                   CSE031
235800200529     C                     GOTO CMTTAG                                    CSE031
235900200529     C                     ENDIF                                          CSE031
236000200529     C*
236100200529     C* Inputs
236200200529     C*
236300200529     C           ACTC      IFEQ 'I'
236400200529     C           DEVKA     CHAINSEDEVDF              31
236500200529     C           *IN31     IFEQ '0'
236600200529     C***********RECI      ANDEQ'D'                                       E23259
236700200529     C                     SETON                     09
236800200529     C                     MOVEAINF,1     ERRMSG
236900200529     C                     Z-ADD01021     STATUS
237000200529     C                     EXSR INFSR
237100200529     C*
237200200529     C                     ELSE
237300200529     C*
237400200529     C* Translate records from screen layout to file layout
237500200529     C*
237600200529     C********** SSDED1    IFNE *BLANKS                                                182505 196599
237700200529     C**********           MOVE SSDED1    SSDED                                        182505 196599
237800200529     C**********           ENDIF                                                       182505 196599
237900200529     C                     EXSR TRSEDE
238000200529     C                     MOVE 'D'       RECI
238100200529     C                     Z-ADDRUND      LCD
238200200529     C                     MOVE 'I'       CHTP
238300200529     C                     MOVELNATN      TNLU
238400200529     C                     END
238500200529     C   31                WRITESEDEVDF
238600200529     C  N31                UPDATSEDEVDF
238700200529     C                     ELSE
238800200529     C*
238900200529     C* Amendments
239000200529     C*
239100200529     C           ACTC      IFEQ 'A'
239200200529     C           DEVKA     CHAINSEDEVDF              31
239300200529     C           TNLU      IFNE STNLU
239400200529     C                     SETON                     09
239500200529     C                     MOVEAINF,1     ERRMSG
239600200529     C                     Z-ADD01021     STATUS
239700200529     C                     EXSR INFSR
239800200529     C*
239900200529     C                     ELSE
240000200529     C*
240100200529     C* Translate records from screen layout to file layout
240200200529     C*
240300200529     C                     EXSR TRSEDE
240400200529     C                     Z-ADDRUND      LCD
240500200529     C                     MOVE 'A'       CHTP
240600200529     C                     MOVELNATN      TNLU
240700200529     C                     END
240800200529     C  N31                UPDATSEDEVDF
240900200529     C                     ELSE
241000200529     C*
241100200529     C* Deletions
241200200529     C*
241300200529     C           ACTC      IFEQ 'D'
241400200529      *                                                                                      260191A
241500200529      ** Use temporary variable to determine if all position settlements                     260191A
241600200529      ** are settled or not.                                                                 260191A
241700200529      *                                                                                      260191A
241800200529     C                     MOVE 'N'       NOTALL  1                                          260191A
241900200529     C                     MOVE 'N'       LIVREC  1                                          260191A
242000200529      *                                                                   057220
242100200529      * If there are any live position settlements for this security      057220
242200200529      * event, output message to screen, and prevent deletion.            057220
242300200529     C           SDSN      SETLLPOSETDF                                   057220
242400200529     C           SDSN      READEPOSETDF                  31               057220
242500200529     C           *IN31     DOWEQ'0'                                       057220
242600200529      *                                                                                       260331
242700200529     C           SDET      IFEQ 'MP'                                                          260331
242800200529     C           SDET      OREQ 'DV'                                                          260331
242900200529     C           S01512    ANDNE'Y'                                                           260331
243000200529     C                     Z-ADDSDPD      WWPDUD  50                                          260331
243100200529     C                     ELSE                                                               260331
243200200529     C                     Z-ADDSDED      WWPDUD                                              260331
243300200529     C                     ENDIF                                                              260331
243400200529      *                                                                                       260331
243500200529     C********** SDED      IFEQ PDUD                                                   057220 260331
243600200529     C           WWPDUD    IFEQ PDUD                                                          260331
243700200529     C           SDET      ANDEQPEVT                                      057220
243800200529     C********** RECI      ANDEQ'D'                                                   057220 260191A
243900200529     C********** WRECI     ANDEQ'D'                                                   260191 260191A
244000200529     C           RECI      IFEQ 'M'                                                          260191A
244100200529     C                     MOVE 'Y'       NOTALL                                             260191A
244200200529     C                     ELSE                                                              260191A
244300200529     C           RECI      IFEQ 'D'                                                          260191A
244400200529     C                     MOVE 'Y'       LIVREC                                             260191A
244500200529     C                     ENDIF                                                             260191A
244600200529     C                     ENDIF                                                             260191A
244700200529     C                     ENDIF                                                             260191A
244800200529     C  N31      SDSN      READEPOSETDF                  31                                  260191A
244900200529     C                     ENDDO                                                             260191A
245000200529      *                                                                                      260191A
245100200529     C           NOTALL    IFEQ 'N'                                                          260191A
245200200529     C           LIVREC    ANDEQ'Y'                                                          260191A
245300200529     C                     SETON                     0931                 057220
245400200529     C                     SETOF                     4403                 057220
245500200529     C                     MOVEAINF,2     ERRMSG                          057220
245600200529     C                     Z-ADD01021     STATUS                          057220
245700200529     C                     EXSR INFSR                                     057220
245800200529     C                     END                                            057220
245900200529     C**N31***** SDSN      READEPOSETDF                  31                           057220 260191A
246000200529     C**********           END                                                        057220 260191A
246100200529     C*                                                                   057220
246200200529     C           DEVKA     CHAINSEDEVDF              31
246300200529     C           TNLU      IFNE STNLU
246400200529     C                     SETON                     09
246500200529     C                     SETOF                     4403
246600200529     C                     MOVEAINF,1     ERRMSG
246700200529     C                     Z-ADD01021     STATUS
246800200529     C                     EXSR INFSR
246900200529     C*
247000200529     C                     ELSE
247100200529     C*
247200200529     C* Amend last update details
247300200529     C*
247400200529     C           RECI      IFEQ 'D'                                                           260331
247500200529      *                                                                                       260331
247600200529     C           SDET      IFEQ 'MP'                                                          260331
247700200529     C           SDET      OREQ 'DV'                                                          260331
247800200529     C           SDET      OREQ 'PP'                                                          260331
247900200529     C                     Z-ADD0         SDDT                                                260331
248000200529     C                     ENDIF                                                              260331
248100200529      *                                                                                       260331
248200200529     C                     ELSE                                                              260191A
248300200529     C           RECI      IFEQ 'M'                                                          260191A
248400200529     C           NOTALL    ANDEQ'N'                                                          260191A
248500200529     C                     Z-ADD0         SDDT                                               260191A
248600200529     C                     ENDIF                                                             260191A
248700200529      *                                                                                      260191A
248800200529     C                     ENDIF                                                              260331
248900200529     C                     MOVE 'C'       RECI
249000200529     C                     Z-ADDRUND      LCD
249100200529     C                     MOVE 'D'       CHTP
249200200529     C                     MOVELNATN      TNLU
249300200529     C                     END
249400200529     C  N31                EXCPTDLTREC
249500200529     C                     END
249600200529     C                     END
249700200529     C                     END
249800200529     C*
249900200529     C* Update any running total fields on succeeding records
250000200529     C*
250100200529     C           DEVKA     SETGTSEDEVDF
250200200529     C                     SETOF                     32
250300200529     C           *IN32     DOWEQ'0'
250400200529     C           SSDSN     READESEDEVDF                  32
250500200529     C           *IN32     IFEQ '0'
250600200529     C           RECI      ANDNE'C'
250700200529     C           SSDET     ANDEQSDET
250800200529     C*
250900200529     C* Input mode - add to total
251000200529     C*
251100200529     C           ACTC      IFEQ 'I'
251200200529     C           SDET      IFEQ 'MP'
251300200529     C                     ADD  NWSRPT    SDTR
251400200529     C                     ELSE
251500200529     C***********SDET      IFEQ 'RC'                                      E23259
251600200529     C***********SDET      OREQ 'RP'                                      E23259
251700200529     C           SDET      IFEQ 'PP'                                      E23259
251800200529     C                     ADD  NWSDPP    SDTA
251900200529     C                     ADD  NWSDPC    SDTP
252000200529     C                     END
252100200529     C                     END
252200200529     C                     ELSE
252300200529     C*
252400200529     C* Amend mode - adjust total
252500200529     C*
252600200529     C           ACTC      IFEQ 'A'
252700200529     C           SDET      IFEQ 'MP'
252800200529     C                     SUB  OLSRPT    SDTR
252900200529     C                     ADD  NWSRPT    SDTR
253000200529     C                     ELSE
253100200529     C***********SDET      IFEQ 'RC'                                      E23259
253200200529     C***********SDET      OREQ 'RP'                                      E23259
253300200529     C           SDET      IFEQ 'PP'                                      E23259
253400200529     C                     SUB  OLSDPP    SDTA
253500200529     C                     ADD  NWSDPP    SDTA
253600200529     C                     SUB  OLSDPC    SDTP
253700200529     C                     ADD  NWSDPC    SDTP
253800200529     C                     END
253900200529     C                     END
254000200529     C                     ELSE
254100200529     C*
254200200529     C* Delete mode - subtract from total
254300200529     C*
254400200529     C           ACTC      IFEQ 'D'
254500200529     C           SDET      IFEQ 'MP'
254600200529     C                     SUB  OLSRPT    SDTR
254700200529     C                     ELSE
254800200529     C***********SDET      IFEQ 'RC'                                      E23259
254900200529     C***********SDET      OREQ 'RP'                                      E23259
255000200529     C           SDET      IFEQ 'PP'                                      E23259
255100200529     C                     SUB  OLSDPP    SDTA
255200200529     C                     SUB  OLSDPC    SDTP
255300200529     C                     END
255400200529     C                     END
255500200529     C                     END
255600200529     C                     END
255700200529     C                     END
255800200529     C*
255900200529     C* Update record
256000200529     C*
256100200529     C                     EXCPTUPDTOT
256200200529     C*
256300200529     C                     END
256400200529     C                     END
256500200529     C*
256600200529     C* Fetch Audit record
256700200529     C*
256800200529     C           1         CHAINSEDEVAF              U8
256900200529     C*
257000200529     C* Update if found
257100200529     C*
257200200529     C           *INU8     IFEQ '0'
257300200529     C*
257400200529     C           ACTC      IFEQ 'I'
257500200529     C                     ADD  1         NOIN
257600200529     C   31                ADD  1         NORE
257700200529     C                     ELSE
257800200529     C           ACTC      IFEQ 'A'
257900200529     C                     ADD  1         NOAM
258000200529     C                     ELSE
258100200529     C           ACTC      IFEQ 'D'
258200200529     C                     ADD  1         NODE
258300200529     C                     END
258400200529     C                     END
258500200529     C                     END
258600200529     C*
258700200529     C                     Z-ADDRUND      LCD
258800200529     C                     MOVE 'A'       CHTP
258900200529     C                     MOVELNATN      TNLU
259000200529     C*
259100200529     C                     UPDATSEDEVAF
259200200529     C/COPY WNCPYSRC,SE0130C026
259300200529     C*
259400200529     C* COMIT
259500200529     C*
259600200529     C           CMTTAG    TAG                                            CSE031
259700200529      *                                                                   CSE031
259800200529     C           CMTTXT    COMIT
259900200529     C*
260000200529     C                     ELSE
260100200529     C                     SETON                     U7
260200200529     C           *LOCK     IN   LDA                                       S01117
260300200529     C***********          MOVEL'03'      DBASE            ***************E20651
260400200529     C***********          MOVEL'05'      DBASE            * DB ER E20651 S01117
260500200529     C                     Z-ADD05        DBASE            * DB ERROR 05 *S01117
260600200529     C                     MOVEL'SEDEVA'  DBFILE           ***************
260700200529     C                     MOVEL'AUDIT'   DBKEY
260800200529     C                     OUT  LDA                                       S01117
260900200529     C                     EXSR *PSSR                                     S01117
261000200529     C                     END
261100200529     C*
261200200529     C                     ENDSR
261300200529      *
261400200529      *****************************************************************
261500200529      /EJECT
261600200529      *****************************************************************
261700200529      *                                                               *
261800200529      *  VLDITL - Subroutine to validate Entries made on the Initial  *
261900200529      *           Screen.                                             *
262000200529      *                                                               *
262100200529      *****************************************************************
262200200529      *
262300200529     C           VLDITL    BEGSR                           *** VLDITL ***
262400200529     C*
262500200529     C* Clear error indicators and fields
262600200529     C*
262700200529     C                     Z-ADD*ZEROS    EC      20
262800200529     C                     Z-ADD*ZEROS    WEC
262900200529     C                     MOVE *BLANKS   ERRMSG
263000200529     C                     SETOF                     09
263100200529     C                     MOVEA'0000'    *IN,40
263200200529     C                     MOVE '0'       *IN49                           S01510
263300200529     C/COPY WNCPYSRC,SE0130C020
263400200529      *                                                                   CSE010
263500200529      ** Check Security Shortname and call Securities Selection           CSE010
263600200529      *                                                                   CSE010
263700200529     C           CSE010    IFEQ 'Y'                                       CSE010
263800200529     C                     MOVELSSDSN     @QMK    1                       CSE010
263900200529     C           @QMK      IFEQ '?'                                       CSE010
264000200529     C                     MOVELSSDSN     @SESN                           CSE010
264100200529     C                     CALL 'SE0043'                                  CSE010
264200200529     C                     PARM           @ACDE   1                       CSE010
264300200529     C                     PARM           @SESN  10                       CSE010
264400200529     C           @SESN     IFNE *BLANKS                                   CSE010
264500200529     C                     MOVE @SESN     SSDSN                           CSE010
264600200529     C                     ELSE                                           CSE010
264700200529     C                     MOVE *BLANKS   SSDSN                           CSE010
264800200529     C                     ENDIF                                          CSE010
264900200529     C                     ENDIF                                          CSE010
265000200529     C                     ENDIF                                          CSE010
265100200529     C*
265200200529     C* Convert date into day number for key
265300200529     C*
265400200529     C           SSDED     IFNE '999999'                                  S01158
265500200529     C                     MOVE SSDED     ZDATE
265600200529     C                     EXSR ZDATE1
265700200529     C                     Z-ADDZDAYNO    EVTDNO
265800200529     C                     ELSE                                           S01158
265900200529     C                     Z-ADD99999     EVTDNO                          S01158
266000200529     C                     END                                            S01158
266100200529     C*
266200200529     C* Action code edit
266300200529     C*
266400200529     C           ACTC      IFNE 'I'
266500200529     C           ACTC      ANDNE'A'
266600200529     C           ACTC      ANDNE'D'
266700200529     C           ACTC      ANDNE'E'
266800200529     C                     ADD  1         EC
266900200529     C                     MOVEA' 100'    ERR,EC
267000200529     C                     SETON                     40
267100200529     C                     ELSE                                           S01117
267200200529     C*                                                                   S01117
267300200529     C**   IF SINGLE BRANCH ENVIRONMENT                                   S01117
267400200529     C*                                                                   S01117
267500200529     C           MBIN      IFEQ 'N'                                       S01117
267600200529     C                     CALL 'ZVACTU'                                  S01117
267700200529     C                     PARM ACTC      @ZACTN  1                       S01117
267800200529     C                     PARM           @ERR    10                      S01117
267900200529     C**                                                                  S01117
268000200529     C           @ERR      IFNE *ZERO                                     S01117
268100200529     C                     ADD  1         EC                              S01117
268200200529     C                     MOVEA' 302'    ERR,EC                          S01117
268300200529     C                     SETON                     40                   S01117
268400200529     C                     END                                            S01117
268500200529     C                     ELSE                                           S01117
268600200529     C*                                                                   S01117
268700200529     C**   IF MULTIBRANCHING ENVIRONMENT                                  S01117
268800200529     C*                                                                   S01117
268900200529     C                     CALL 'ZVACTBU'                                 S01117
269000200529     C                     PARM ACTC      @ZACTN  1                       S01117
269100200529     C                     PARM USRBCH    @ZBR    3                       S01117
269200200529     C                     PARM           @ERR    10                      S01117
269300200529     C**                                                                  S01117
269400200529     C           @ERR      IFEQ 1                                         S01117
269500200529     C                     ADD  1         EC                              S01117
269600200529     C                     MOVEA' 303'    ERR,EC                          S01117
269700200529     C                     SETON                     40                   S01117
269800200529     C                     END                                            S01117
269900200529     C           @ERR      IFEQ 2                                         S01117
270000200529     C                     ADD  1         EC                              S01117
270100200529     C                     MOVEA' 304'    ERR,EC                          S01117
270200200529     C                     SETON                     40                   S01117
270300200529     C                     END                                            S01117
270400200529     C                     END                                            S01117
270500200529     C**                                                                  S01117
270600200529     C                     END
270700200529     C*
270800200529     C* Security short name
270900200529     C*
271000200529     C           ACTC      IFEQ 'I'
271100200529     C           SSDSN     IFEQ *BLANKS
271200200529     C                     ADD  1         EC
271300200529     C                     MOVEA' 101'    ERR,EC
271400200529     C                     SETON                     41
271500200529     C*
271600200529     C                     ELSE
271700200529     C*
271800200529     C* Input mode - record must exist as an active or matured
271900200529     C* Security record
272000200529     C*
272100200529     C           SSDSN     CHAINSECTYDF              33
272200200529     C*                                                                   S01408
272300200529     C/COPY WNCPYSRC,SE0130CCP9                                           S01408
272400200529     C*                                                                   S01408
272500200529     C           *IN33     IFEQ '1'
272600200529     C                     ADD  1         EC
272700200529     C***********          MOVEA' 101'    ERR,EC                          E22960
272800200529     C                     MOVEA' 102'    ERR,EC                          E22960
272900200529     C                     SETON                     41
273000200529     C                     ELSE
273100200529     C           RECI      IFNE 'D'
273200200529     C***********RECI      ANDNE'M'                                       073727
273300200529     C                     ADD  1         EC
273400200529     C***********          MOVEA' 101'    ERR,EC                          E22960
273500200529     C                     MOVEA' 102'    ERR,EC                          E22960
273600200529     C                     SETON                     41
273700200529     C                     END
273800200529     C                     END
273900200529     C*
274000200529     C* or be a reserved word
274100200529     C*
274200200529     C           SSDSN     IFEQ 'ALL'
274300200529     C                     ADD  1         EC
274400200529     C***********          MOVEA' 101'    ERR,EC                          E22960
274500200529     C                     MOVEA' 102'    ERR,EC                          E22960
274600200529     C                     SETON                     41
274700200529     C                     END
274800200529     C*
274900200529     C* An active Diary Event with a duplicate key must not already exist
275000200529     C*
275100200529     C/COPY WNCPYSRC,SE0130C006
275200200529     C           DEVKA     CHAINSEDEVDFX             33
275300200529     C           *IN33     IFEQ '0'
275400200529     C***********RECI      ANDEQ'D'                                       E23259
275500200529     C           RECI      ANDNE'C'                                       E23259
275600200529     C                     ADD  1         EC
275700200529     C***********          MOVEA' 101'    ERR,EC                          E22960
275800200529     C***********          MOVEA' 102'    ERR,EC                    E22960E23286
275900200529     C                     MOVEA' 103'    ERR,EC                          E22960
276000200529     C                     SETON                     41
276100200529     C                     END
276200200529     C/COPY WNCPYSRC,SE0130C007
276300200529     C*
276400200529     C                     END
276500200529     C*
276600200529     C* Else Fetch Security detail record
276700200529     C*
276800200529     C                     ELSE
276900200529     C           SSDSN     CHAINSECTYDF              33
277000200529     C*                                                                   S01408
277100200529     C/COPY WNCPYSRC,SE0130CP10                                           S01408
277200200529     C*                                                                   S01408
277300200529     C*
277400200529     C                     END
277500200529     C/COPY WNCPYSRC,SE0130C016
277600200529     C*
277700200529     C* Amend mode
277800200529     C*
277900200529     C           ACTC      IFEQ 'A'
278000200529     C           SSDSN     IFEQ *BLANKS
278100200529     C                     ADD  1         EC
278200200529     C***********          MOVEA' 102'    ERR,EC                          E22960
278300200529     C                     MOVEA' 101'    ERR,EC                          E22960
278400200529     C                     SETON                     41
278500200529     C                     ELSE
278600200529     C*
278700200529     C* Record must exist
278800200529     C*
278900200529     C           DEVKA     CHAINSEDEVDFX             33
279000200529     C           *IN33     IFEQ '1'
279100200529     C                     ADD  1         EC
279200200529     C***********          MOVEA' 102'    ERR,EC                          E23286
279300200529     C                     MOVEA' 104'    ERR,EC                          E23286
279400200529     C                     SETON                     41
279500200529     C                     ELSE
279600200529     C*
279700200529     C**and*be*an*active*event*****************************************   E20085
279800200529     C***********                                                         E20085
279900200529     C***********RECI      IFNE 'D'                                       E20085
280000200529     C***********          ADD  1         EC                              E20085
280100200529     C***********          MOVEA' 102'    ERR,EC                          E20085
280200200529     C***********          SETON                     41                   E20085
280300200529     C***********          END                                            E20085
280400200529     C*                                                                   E23259
280500200529     C*** and be an active event - reinstated                             E23259
280600200529     C*                                                                   E23259
280700200529     C           RECI      IFNE 'D'                                       E23259
280800200529     C                     ADD  1         EC                              E23259
280900200529     C*********************MOVEA' 102'    ERR,EC                    E23259E23286
281000200529     C                     MOVEA' 104'    ERR,EC                          E23286
281100200529     C                     SETON                     41                   E23259
281200200529     C                     END                                            E23259
281300200529     C                     END
281400200529     C                     END
281500200529     C                     END
281600200529     C*
281700200529     C* Delete mode
281800200529     C*
281900200529     C           ACTC      IFEQ 'D'
282000200529     C           SSDSN     IFEQ *BLANKS
282100200529     C                     ADD  1         EC
282200200529     C***********          MOVEA' 103'    ERR,EC                          E22960
282300200529     C                     MOVEA' 101'    ERR,EC                          E22960
282400200529     C                     SETON                     41
282500200529     C                     ELSE
282600200529     C*
282700200529     C* Record must exist
282800200529     C*
282900200529     C           DEVKA     CHAINSEDEVDFX             33
283000200529     C           *IN33     IFEQ '1'
283100200529     C                     ADD  1         EC
283200200529     C***********          MOVEA' 103'    ERR,EC                          E22960
283300200529     C***********          MOVEA' 102'    ERR,EC                    E22960E23286
283400200529     C                     MOVEA' 104'    ERR,EC                          E23286
283500200529     C                     SETON                     41
283600200529     C                     ELSE
283700200529     C*
283800200529     C* and be an active event
283900200529     C*
284000200529     C           RECI      IFNE 'D'
284100200529     C           RECI      ANDNE'M'                                       E23259
284200200529     C                     ADD  1         EC
284300200529     C***********          MOVEA' 103'    ERR,EC                          E22960
284400200529     C***********          MOVEA' 102'    ERR,EC                    E22960E23286
284500200529     C                     MOVEA' 104'    ERR,EC                          E23286
284600200529     C                     SETON                     41
284700200529     C/COPY WNCPYSRC,SE0130C008
284800200529     C                     END
284900200529      *                                                                                       260331
285000200529      ** Save RECI value                                                                      260331
285100200529      *                                                                                       260331
285200200529     C                     MOVE RECI      WRECI   1                                           260331
285300200529     C                     END
285400200529     C                     END
285500200529     C                     END
285600200529     C*
285700200529     C* Enquiry mode
285800200529     C*
285900200529     C           ACTC      IFEQ 'E'
286000200529     C           SSDSN     IFEQ *BLANKS
286100200529     C                     ADD  1         EC
286200200529     C***********          MOVEA' 104'    ERR,EC                          E22960
286300200529     C                     MOVEA' 101'    ERR,EC                          E22960
286400200529     C                     SETON                     41
286500200529     C                     ELSE
286600200529     C*
286700200529     C* Record must exist
286800200529     C*
286900200529     C           DEVKA     CHAINSEDEVDFX             33
287000200529     C           *IN33     IFEQ '1'
287100200529     C                     ADD  1         EC
287200200529     C*********************MOVEA' 104'    ERR,EC                          E22960
287300200529     C*********************MOVEA' 102'    ERR,EC                    E22960E23286
287400200529     C                     MOVEA' 104'    ERR,EC                          E23286
287500200529     C                     SETON                     41
287600200529     C                     ELSE
287700200529     C***********                                                         E23259
287800200529     C**and*be*an active event                                            E23259
287900200529     C***********                                                         E23259
288000200529     C***********RECI      IFNE 'D'                                       E23259
288100200529     C***********          ADD  1         EC                              E23259
288200200529     C*********************MOVEA' 103'    ERR,EC                          E22960
288300200529     C***********          MOVEA' 102'    ERR,EC                   E22960 E23259
288400200529     C***********          SETON                     41                   E23259
288500200529     C***********          END                                            E23259
288600200529     C                     END
288700200529     C                     END
288800200529     C                     END
288900200529     C*
289000200529     C* Save for comparison last update number from file
289100200529     C*
289200200529     C                     Z-ADDTNLU      STNLU
289300200529     C*
289400200529     C* Event date
289500200529     C*
289600200529     C           SSDED     IFEQ *BLANKS
289700200529     C                     ADD  1         EC
289800200529     C                     MOVEA' 105'    ERR,EC
289900200529     C                     SETON                     42
290000200529     C                     ELSE
290100200529     C***********SSDED     IFNE '999999'                                  S01158
290200200529     C           SSDED     IFEQ '999999'                                  S01158
290300200529     C                     Z-ADD99999     EVTDNO                          S01158
290400200529     C                     ELSE                                           S01158
290500200529     C*
290600200529     C* Check date valid
290700200529     C*
290800200529     C                     MOVE SSDED     DATEN   60
290900200529     C                     MOVE DATEN     DATEA   6
291000200529     C           SSDED     IFNE DATEA
291100200529     C                     ADD  1         EC
291200200529     C                     MOVEA' 105'    ERR,EC
291300200529     C                     SETON                     42
291400200529     C                     ELSE
291500200529     C                     MOVE SSDED     ZDATE
291600200529     C                     EXSR ZDATE1
291700200529     C           *IN99     IFEQ '1'
291800200529     C                     ADD  1         EC
291900200529     C                     MOVEA' 105'    ERR,EC
292000200529     C                     SETON                     42
292100200529     C                     ELSE
292200200529     C*
292300200529     C* Save for later comparison
292400200529     C*
292500200529     C                     Z-ADDZDAYNO    EVTDNO
292600200529     C*                                                                   054836
292700200529     C**   If Date is Backvalued, check that it does not go past the      054836
292800200529     C**   Backvalue Period specified on SE ICD.                          054836
292900200529     C*                                                                   054836
293000200529     C           RUND      SUB  BVBVP     WBKVP                           054836
293100200529     C           EVTDNO    IFLT WBKVP                                     054836
293200200529     C                     ADD  1         EC                              054836
293300200529     C                     MOVEA' 108'    ERR,EC                          054836
293400200529     C                     SETON                     42                   054836
293500200529     C                     ENDIF                                          054836
293600200529      *                                                                   E23897
293700200529      ** Check that date is not after date of maturity.                   E23897
293800200529      *                                                                   E23897
293900200529     C           ZDAYNO    IFGT MATY                                      E23897
294000200529     C           MATY      ANDNE0                                         E23897
294100200529     C                     ADD  1         EC                              E23897
294200200529     C                     MOVEA' 122'    ERR,EC                          E23897
294300200529     C                     MOVE '1'       *IN42                           E23897
294400200529     C                     ELSE                                           E23897
294500200529     C*
294600200529     C* Check not holiday in value currency (nominal if blank)
294700200529     C*    WARNING ERROR ONLY - check only if changed and only in Input
294800200529     C*    mode
294900200529     C*
295000200529     C           ACTC      IFEQ 'I'
295100200529     C***********ZDAYNO    ANDNEHDAYNO
295200200529     C           VLCY      IFNE '   '
295300200529     C                     MOVE VLCY      ZCCY
295400200529     C                     ELSE
295500200529     C                     MOVE NMCY      ZCCY
295600200529     C                     END
295700200529     C***********          EXSR ZDATE5                                    S01195
295800200529     C                     MOVE *BLANKS   ZLOC                            S01195
295900200529     C                     EXSR ZCHKH                                     S01195
296000200529     C                     MOVE 'N'       HOLI    1                       182505
296100200529     C************IN99     IFEQ '1'                                       S01195
296200200529     C           ZIND      IFEQ 'H'                                       S01195
296300200529     C                     ADD  1         EC
296400200529     C******               ADD  1         WEC                             182505
296500200529     C******               MOVEA' W10'    ERR,EC                          182505
296600200529     C**********           MOVEA' 107'    ERR,EC                                       182505 196599
296700200529     C                     ADD  1         WEC                                                 196599
296800200529     C                     MOVEA' W10'    ERR,EC                                              196599
296900200529     C                     MOVE 'Y'       HOLI                                                196599
297000200529     C                     SETON                     42
297100200529     C                     END
297200200529     C                     Z-ADDZDAYNO    HDAYNO
297300200529     C                     END
297400200529     C*
297500200529     C*************************************************************       E23259
297600200529     C***IF*EVENT*BACKVALUED*THE*EVENT*WOULD*BE*ACTIONED*BY*SE2100*E20085 E23259
297700200529     C*** Amendments to Actioned Events cannot be processed by SE2100     E23259
297800200529     C*** SE2100 only allows Inserts and Deletes to be Backvalued         E23259
297900200529     C**If*'Amend'*mode,*check*event*not*already*actioned**************   E20085
298000200529     C**********                                                          E20085
298100200529     C********** ACTC      IFEQ 'A'                                       E20085
298200200529     C********** ZDAYNO    ANDLTRUND                                      E20085
298300200529     C********** SDAD      ANDNE*ZEROS                                    E20085
298400200529     C**********           ADD  1         EC                              E20085
298500200529     C**********           MOVEA' 106'    ERR,EC                          E20085
298600200529     C**********           SETON                     42                   E20085
298700200529     C**********           END                                            E20085
298800200529      *                                                                   CSE031
298900200529      ** Allow Amendment of an Event type 'IR' which has been actioned    CSE031
299000200529      *                                                                   CSE031
299100200529     C           CSE031    IFEQ 'Y'                                       CSE031
299200200529     C           SSDET     ANDNE'IR'                                      CSE031
299300200529     C           CSE031    ORNE 'Y'                                       CSE031
299400200529      *                                                                   CSE031
299500200529     C**If 'Amend' mode, check event not already actioned                 E23259
299600200529     C*                                                                   E23259
299700200529     C           ACTC      IFEQ 'A'                                       E23259
299800200529     C           ZDAYNO    ANDLTRUND                                      E23259
299900200529     C           SDAD      ANDNE*ZEROS                                    E23259
300000200529     C                     ADD  1         EC                              E23259
300100200529     C                     MOVEA' 106'    ERR,EC                          E23259
300200200529     C                     SETON                     42                   E23259
300300200529     C                     END                                            E23259
300400200529      *                                                                   CSE031
300500200529     C                     ENDIF                                          CSE031
300600200529     C*
300700200529     C* If type 'IR', check event date matches a rate change date on
300800200529     C* security detail record - not if a Rate change frequency has been
300900200529     C* entered
301000200529     C*
301100200529     C           SSDET     IFEQ 'IR'
301200200529     C           ACTC      ANDEQ'I'                                       182505
301300200529     C           RCFQ      IFEQ ' '
301400200529     C                     Z-ADD*ZEROS    DAT
301500200529     C                     Z-ADD1         X       20
301600200529     C                     DO   12        X
301700200529     C           CD,X      IFNE *ZEROS
301800200529     C           *IN98     IFEQ '1'
301900200529     C                     MOVE CD,X      DAT,X
302000200529     C                     ELSE
302100200529     C                     MOVELCD,X      WK2N    20
302200200529     C                     MOVE WK2N      WK4N    40
302300200529     C                     MOVE CD,X      WK2N
302400200529     C                     MOVELWK2N      WK4N
302500200529     C                     MOVE WK4N      DAT,X
302600200529     C                     END
302700200529     C                     END
302800200529     C                     END
302900200529     C*
303000200529     C**Fetch*Issue*date*year******************************************   066635
303100200529     C**If*this*is*zero*use*initial*date*year**********************E14498 066635
303200200529     C**Also,*for*the*purposes*of*comparing*event*date*against*eachE14552 066635
303300200529     C**between*issue/initial*date*and*maturity,*put*the*relevant*dE14552 066635
303400200529     C**into*a*'work'*day*number*field.****************************E14552 066635
303500200529     C*****************************************************************   066635
303600200529     C***********          Z-ADDISSD      ZDAYNO                          066635
303700200529     C***********         *Z-ADDISSD      IDWORK  50               E14552 066635
303800200529     C*                                                                   066635
303900200529     C*** Find the year for the Event                                     066635
304000200529     C*                                                                   066635
304100200529     C                     Z-ADDEVTDNO    ZDAYNO                          066635
304200200529     C                     EXSR ZDATE2
304300200529     C                     MOVE ZDATE     IYR     20
304400200529     C*                                                                   066635
304500200529     C***********IYR       IFEQ 0                                  E14498 066635
304600200529     C***********          Z-ADDITLD      ZDAYNO                   E14498 066635
304700200529     C***********          Z-ADDITLD      IDWORK                   E14552 066635
304800200529     C***********          EXSR ZDATE2                             E14498 066635
304900200529     C***********          MOVE ZDATE     IYR                      E14498 066635
305000200529     C***********          END                                     E14498 066635
305100200529     C*
305200200529     C* Fetch Maturity date year
305300200529     C*
305400200529     C                     Z-ADDMATY      ZDAYNO
305500200529     C                     EXSR ZDATE2
305600200529     C                     MOVE ZDATE     MYR     20
305700200529     C*
305800200529     C* Assemble Event date into compatible format
305900200529     C* (And take date format M into consideration)                       E14498
306000200529     C*
306100200529     C                     MOVE SSDED     WK2N
306200200529     C                     MOVELWK2N      EVTDAT  60
306300200529     C           *IN98     IFEQ '1'                                       E14498
306400200529     C                     MOVELSSDED     WK4N                            E14498
306500200529     C                     ELSE                                           E14498
306600200529     C                     MOVE SSDED     WK4N
306700200529     C                     MOVELSSDED     WK2N
306800200529     C                     MOVE WK2N      WK4N
306900200529     C                     END                                            E14498
307000200529     C                     MOVE WK4N      EVTDAT
307100200529     C*****************************************************************   066635
307200200529     C**Compare*Event*date*against*each*year*between*Issue*date*and****   066635
307300200529     C**Maturity*date**************************************************   066635
307400200529     C*****************************************************************   066635
307500200529     C***********IDWORK    DOWLEMATY                               E14552 066635
307600200529     C*                                                                   066635
307700200529     C*** Only Compare Event date against the change date within the      066635
307800200529     C*** the event year.                                                 066635
307900200529     C*                                                                   066635
308000200529     C           MYR       IFLT 72                                        084187
308100200529     C           MYR       ADD  100       MYRC    30                      084187
308200200529     C                     ELSE                                           084187
308300200529     C                     Z-ADDMYR       MYRC                            084187
308400200529     C                     END                                            084187
308500200529     C           IYR       IFLT 72                                        084187
308600200529     C           IYR       ADD  100       IYRC    30                      084187
308700200529     C                     ELSE                                           084187
308800200529     C                     Z-ADDIYR       IYRC                            084187
308900200529     C                     END                                            084187
309000200529     C***********IYR       DOWLEMYR                                       E14552
309100200529     C***********IDWORK    DOWLEMATY                                E14552084187
309200200529     C           IYRC      DOWLEMYRC                                      084187
309300200529     C                     Z-ADD1         X
309400200529     C                     SETOF                     34
309500200529     C                     DO   12        X
309600200529     C           DAT,X     IFNE *ZEROS
309700200529     C                     MOVELIYR       DAT,X
309800200529     C*          EVTDAT    CABEQDAT,X     OUT1           34
309900200529     C           EVTDAT    IFEQ DAT,X
310000200529     C           CR,X      IFEQ 'R'
310100200529     C           CR,X      OREQ 'C'
310200200529     C/COPY WNCPYSRC,SE0130C042
310300200529     C           RCFQ      IFEQ ' '
310400200529     C                     SETON                     34
310500200529     C                     END
310600200529     C                     END
310700200529     C                     GOTO OUT1
310800200529     C                     END
310900200529     C*
311000200529     C                     END
311100200529     C                     END
311200200529     C           IYR       IFEQ 99                                        E21824
311300200529     C                     Z-ADD0         IYR                             E21824
311400200529     C                     ADD  1         IYRC                            084187
311500200529     C                     ELSE                                           E21824
311600200529     C                     ADD  1         IYR
311700200529     C                     ADD  1         IYRC                            084187
311800200529     C                     END                                            E21824
311900200529     C***********          ADD  366       IDWORK                    E14552E24879
312000200529     C*************************************************************E24879 066635
312100200529     C***If*IYR*contains*a*leap*year*add*366*to*IDWORK*else*add*365E24879 066635
312200200529     C*************************************************************E24879 066635
312300200529     C***********          Z-ADD0         @WRK1   70               E24879 066635
312400200529     C***********          Z-ADD0         @WRK2   75               E24879 066635
312500200529     C***********IYR       DIV  4         @WRK1                    E24879 066635
312600200529     C***********          MVR            @WRK2                    E24879 066635
312700200529     C***********@WRK2     IFGT 0                                  E24879 066635
312800200529     C***********          ADD  365       IDWORK                   E24879 066635
312900200529     C***********          ELSE                                    E24879 066635
313000200529     C***********          ADD  366       IDWORK                   E24879 066635
313100200529     C***********          END                                     E24879 066635
313200200529     C***********IYR       CABEQ*ZEROS    OUT1                            E21824
313300200529     C***********          END                                            066635
313400200529     C                     END
313500200529     C*
313600200529     C           OUT1      TAG                             *** OUT1 TAG **
313700200529     C           *IN34     IFEQ '0'
313800200529     C********** BCNV      ANDEQ' '                                                    182505 196599
313900200529     C                     ADD  1         EC
314000200529     C                     MOVEA' 107'    ERR,EC
314100200529     C                     SETON                     42
314200200529      *                                                                   182505
314300200529     C                     ELSE                                           182505
314400200529     C           SSDET     IFEQ 'IR'                                                          196599
314500200529     C           HOLI      ANDEQ'Y'                                                           196599
314600200529     C           SSDED     ANDNE'999999'                                                      196599
314700200529     C                     MOVE HDAYNO    #CPD                            182505
314800200529     C           BCNV      IFNE ' '                                       182505
314900200529     C           BCNV      ANDNE'N'                                       CSE031
315000200529     C           BCNV      IFEQ 'C'                                       182505
315100200529     C                     MOVE 'N'       NCI     1                       182505
315200200529     C                     ELSE                                           182505
315300200529     C                     MOVE 'L'       NCI     1                       182505
315400200529     C                     ENDIF                                          182505
315500200529     C                     CALL 'SE0045'                                  182505
315600200529     C                     PARM           SITP                            182505
315700200529     C                     PARM           #CPD                            182505
315800200529     C                     PARM           ITLD                            182505
315900200529     C                     PARM           FCPN                            182505
316000200529     C                     PARM           CD                              182505
316100200529     C                     PARM           CR                              182505
316200200529     C                     PARM           NMCY                            182505
316300200529     C                     PARM           #CPD                            182505
316400200529     C                     PARM           NCI                             182505
316500200529     C                     PARM           BCNV                            182505
316600200529     C                     PARM           MATY                            182505
316700200529     C                     PARM           LCPN                            CSE031
316800200529     C                     ENDIF                                          182505
316900200529     C                     MOVE #CPD      EVTDNO                                              196599
317000200529     C                     MOVE #CPD      ZDAYNO                                              196599
317100200529     C                     EXSR ZDATE2                                                        196599
317200200529     C                     MOVE ZDATE     SSDED1                                              196599
317300200529     C********** #CPD      IFNE EVTDNO                                                 182505 196599
317400200529     C**********           ADD  1         EC                                           182505 196599
317500200529     C**********           MOVEA' 107'    ERR,EC                                       182505 196599
317600200529     C**********           SETON                     42                                182505 196599
317700200529     C**********           ELSE                                                        182505 196599
317800200529     C**********           MOVE #CPD      ZDAYNO                                       182505 196599
317900200529     C**********           EXSR ZDATE2                                                 182505 196599
318000200529     C**********           MOVE ZDATE     SSDED1                                       182505 196599
318100200529     C**********           ENDIF                                                       182505 196599
318200200529      *                                                                   182505
318300200529      ** Check for duplicate key.                                         182505
318400200529      *                                                                   182505
318500200529     C           DEVKA     CHAINSEDEVDFX             33                   182505
318600200529     C           *IN33     IFEQ '0'                                       182505
318700200529     C           RECI      ANDNE'C'                                       182505
318800200529     C                     ADD  1         EC                              182505
318900200529     C                     MOVEA' 103'    ERR,EC                          182505
319000200529     C                     MOVE '1'       *IN41                           182505
319100200529     C                     ENDIF                                          182505
319200200529     C                     ENDIF                                                              196599
319300200529      *                                                                   182505
319400200529     C                     END
319500200529     C*
319600200529     C                     END
319700200529     C                     END
319800200529     C                     END
319900200529     C                     END
320000200529     C                     END
320100200529     C                     END
320200200529     C                     END                                            E23897
320300200529     C*
320400200529     C* If Event type 'IR', validate Input and Amend modes
320500200529     C*
320600200529     C           SSDET     IFEQ 'IR'
320700200529     C           ACTC      IFEQ 'I'
320800200529     C           ACTC      OREQ 'A'
320900200529     C           EVTDNO    IFLT RUND
321000200529     C*
321100200529     C* Check no Trades input on this security
321200200529      ***  that have Value Date Greater Than or Equal To the Event Date   E20085
321300200529     C*
321400200529     C***********SSDSN     CHAINTRADSDF              33                   E20085
321500200529     C************IN33     IFEQ '0'                                       E20085
321600200529     C           SSDSN     SETLLTRADSDF                                   E20085
321700200529     C           SSDSN     READETRADSDF                  33               E20085
321800200529      *                                                                   E20085
321900200529     C           *IN33     DOWEQ'0'                                       E20085
322000200529     C           *IN42     ANDEQ'0'                                       E20085
322100200529      *                                                                   E20085
322200200529     C           TDVD      IFGE EVTDNO                                    E20085
322300200529     C                     ADD  1         EC
322400200529     C*                                                                   E20085
322500200529     C** Backvaluation of IR beyond live trade is now a warning error.    E20085
322600200529     C                     ADD  1         WEC                             E20085
322700200529     C***********          MOVEA' 108'    ERR,EC                          E20085
322800200529     C                     MOVEA' W13'    ERR,EC                          E20085
322900200529     C                     SETON                     42
323000200529     C                     ELSE                                           E20085
323100200529     C           SSDSN     READETRADSDF                  33               E20085
323200200529     C                     END
323300200529      *                                                                   E20085
323400200529     C                     END                                            E20085
323500200529     C*
323600200529     C* Check this event not before last 'IR' event
323700200529     C*
323800200529     C           SSDSN     SETGTSEDEVDFX
323900200529     C           2         OCUR DS01
324000200529      *
324100200529     C           AGAINA    TAG                             *** AGAINA ***
324200200529      *
324300200529     C                     READPSEDEVDFX                 33
324400200529     C*
324500200529     C* Check record is not a cancelled record
324600200529     C*
324700200529     C  N33      RECI      CABEQ'C'       AGAINA
324800200529     C*
324900200529     C* Check same Security
325000200529     C*
325100200529     C  N33      SDSN      COMP SSDSN                3333
325200200529     C   33                GOTO OUTA
325300200529     C*
325400200529     C* Check same Event type
325500200529     C*
325600200529     C           SDET      CABNE'IR'      AGAINA
325700200529     C*
325800200529     C           EVTDNO    IFLT SDED
325900200529     C                     ADD  1         EC
326000200529     C*                                                                   E20085
326100200529     C** Backvaluation of IR event beyond live IR is now a warning error. E20085
326200200529     C                     ADD  1         WEC                             E20085
326300200529     C***********          MOVEA' 109'    ERR,EC                          E20085
326400200529     C                     MOVEA' W14'    ERR,EC                          E20085
326500200529     C                     SETON                     42
326600200529     C                     END
326700200529     C*
326800200529     C           OUTA      TAG                             ** OUTA TAG **
326900200529     C           1         OCUR DS01
327000200529     C                     END
327100200529     C                     END
327200200529     C*
327300200529     C* If Rate change frequency is 'W', Check if date not equal to or a
327400200529     C* multiple of 7 days after Next change date  (or multiple of 7
327500200529     C* days before NCD if date < run date)
327600200529     C*
327700200529     C           RCFQ      IFEQ 'W'
327800200529     C           EVTDNO    ANDNENCHD                                      E20153
327900200529      *                                                                   E20153
328000200529     C***********EVTDNO    IFGE RUND                                      E19752
328100200529     C           EVTDNO    IFGT RUND                                      E19752
328200200529     C********** EVTDNO    IFNE NCHD                                      E20153
328300200529     C********** EVTDNO    SUB  NCHD      WORK5N  50   33                 E20153
328400200529     C********** *IN33     IFEQ '0'                                       E20153
328500200529      *                                                                   E20153
328600200529     C           EVTDNO    IFLT NCHD                                      E20153
328700200529     C                     ADD  1         WEC                             E20153
328800200529     C                     ADD  1         EC         42                   E20153
328900200529     C                     MOVEA' W15'    ERR,EC                          E20153
329000200529     C                     END                                            E20153
329100200529      *                                                                   E20153
329200200529     C           EVTDNO    SUB  NCHD      WORK5N  50                      E20153
329300200529     C           WORK5N    DIV  7         WORK5N
329400200529     C                     MVR            WORK1N  10 33
329500200529     C***********          END                                            E20153
329600200529     C*
329700200529     C           *IN33     IFEQ '1'
329800200529     C                     ADD  1         EC         42
329900200529     C                     MOVEA' 245'    ERR,EC
330000200529     C                     END                                            E20153
330100200529     C***********          END
330200200529     C*
330300200529     C                     ELSE
330400200529     C********** EVTDNO    IFNE NCHD                                      E20153
330500200529     C********** EVTDNO    SUB  NCHD      WORK5N  50 33                   E20153
330600200529     C********** *IN33     IFEQ '0'                                       E20153
330700200529      *                                                                   E20153
330800200529     C           EVTDNO    IFGT NCHD                                      E20153
330900200529     C                     ADD  1         WEC                             E20153
331000200529     C                     ADD  1         EC         42                   E20153
331100200529     C                     MOVEA' W15'    ERR,EC                          E20153
331200200529     C                     END                                            E20153
331300200529      *                                                                   E20153
331400200529     C           EVTDNO    SUB  NCHD      WORK5N  50                      E20153
331500200529     C           WORK5N    DIV  7         WORK5N
331600200529     C                     MVR            WORK1N  10 33
331700200529     C***********          END                                            E20153
331800200529     C*
331900200529     C           *IN33     IFEQ '1'
332000200529     C                     ADD  1         EC         42
332100200529     C                     MOVEA' 245'    ERR,EC
332200200529     C                     END
332300200529     C***********          END                                            E20153
332400200529     C                     END
332500200529     C                     END
332600200529     C*
332700200529     C* If Rate change frequency is 'F', Check if date not equal to or a
332800200529     C* multiple of 14 days after Next change date
332900200529     C*
333000200529     C           RCFQ      IFEQ 'F'
333100200529     C           EVTDNO    ANDNENCHD                                      E20153
333200200529      *                                                                   E20153
333300200529     C***********EVTDNO    IFGE RUND                                      E19752
333400200529     C           EVTDNO    IFGT RUND                                      E19752
333500200529     C********** EVTDNO    IFNE NCHD                                      E20153
333600200529     C********** EVTDNO    SUB  NCHD      WORK5N  50   33                 E20153
333700200529     C********** *IN33     IFEQ '0'                                       E20153
333800200529      *                                                                   E20153
333900200529     C           EVTDNO    IFLT NCHD                                      E20153
334000200529     C                     ADD  1         WEC                             E20153
334100200529     C                     ADD  1         EC         42                   E20153
334200200529     C                     MOVEA' W16'    ERR,EC                          E20153
334300200529     C                     END                                            E20153
334400200529      *                                                                   E20153
334500200529     C           EVTDNO    SUB  NCHD      WORK5N  50                      E20153
334600200529     C           WORK5N    DIV  14        WORK5N
334700200529     C                     MVR            WORK2N  20 33
334800200529     C***********          END                                            E20153
334900200529     C*
335000200529     C           *IN33     IFEQ '1'
335100200529     C                     ADD  1         EC         42
335200200529     C                     MOVEA' 246'    ERR,EC
335300200529     C                     END
335400200529     C***********          END                                            E20153
335500200529     C*
335600200529     C                     ELSE
335700200529     C********** EVTDNO    IFNE NCHD                                      E20153
335800200529     C********** EVTDNO    SUB  NCHD      WORK5N  50 33                   E20153
335900200529     C********** *IN33     IFEQ '0'                                       E20153
336000200529      *                                                                   E20153
336100200529     C           EVTDNO    IFGT NCHD                                      E20153
336200200529     C                     ADD  1         WEC                             E20153
336300200529     C                     ADD  1         EC         42                   E20153
336400200529     C                     MOVEA' W16'    ERR,EC                          E20153
336500200529     C                     END                                            E20153
336600200529      *                                                                   E20153
336700200529     C           EVTDNO    SUB  NCHD      WORK5N  50                      E20153
336800200529     C           WORK5N    DIV  14        WORK5N
336900200529     C                     MVR            WORK2N  20 33
337000200529     C**********           END                                            E20153
337100200529     C*
337200200529     C           *IN33     IFEQ '1'
337300200529     C                     ADD  1         EC         42
337400200529     C                     MOVEA' 246'    ERR,EC
337500200529     C                     END
337600200529     C**********           END                                            E20153
337700200529     C                     END
337800200529     C                     END
337900200529     C*
338000200529     C* If Rate change frequency is 'M', Check if date is not the same day
338100200529     C* of the month as as the Next change date
338200200529     C*
338300200529     C           RCFQ      IFEQ 'M'
338400200529     C           EVTDNO    ANDNENCHD
338500200529     C                     Z-ADDEVTDNO    ZDAYNO
338600200529     C                     EXSR ZDATE2
338700200529     C                     Z-ADDZDAY      EDAY
338800200529     C                     Z-ADDZMTH      EMTH
338900200529     C                     Z-ADDZYEAR     EYEAR
339000200529     C*
339100200529     C                     Z-ADDNCHD      ZDAYNO
339200200529     C                     EXSR ZDATE2
339300200529     C*
339400200529      * The Event Day is only allowed to differ from the Next Change      S01158
339500200529      *  Day for one of two reasons:-                                     S01158
339600200529      *  1 - The day prior to the Event Day is a holiday or               S01158
339700200529      *  2 - The two days are the last days of their respective months.   S01158
339800200529      *                                                                   S01158
339900200529     C           EDAY      IFNE ZDAY
340000200529      *                                                                   S01158
340100200529      * Check if day prior to the Event Day is a holiday.                 S01158
340200200529     C           EVTDNO    SUB  1         ZDAYNO                          S01158
340300200529     C           VLCY      IFEQ *BLANKS                                   S01158
340400200529     C                     MOVE NMCY      ZCCY                            S01158
340500200529     C                     ELSE                                           S01158
340600200529     C                     MOVE VLCY      ZCCY                            S01158
340700200529     C                     END                                            S01158
340800200529     C***********          MOVE *BLANK    ZOPT                     S01158 S01195
340900200529     C***********          EXSR ZDATE5                                    S01195
341000200529     C                     MOVE *BLANKS   ZLOC                            S01195
341100200529     C                     EXSR ZCHKH                                     S01195
341200200529      *                                                                   S01158
341300200529      * If it wasn't a holiday, check to see if the two days are at the   S01158
341400200529      *  ends of their months.                                            S01158
341500200529     C************IN99     IFEQ '0'                                       S01195
341600200529     C           ZIND      IFNE 'H'                                       S01195
341700200529     C           ZMTH      LOKUPTABMTH    TABDAY         33
341800200529     C           ZDAY      IFNE TABDAY
341900200529     C                     ADD  1         EC         42
342000200529     C                     MOVEA' 247'    ERR,EC
342100200529     C                     ELSE
342200200529     C           EMTH      LOKUPTABMTH    TABDAY         33
342300200529     C                     Z-ADDTABDAY    EOMDAY
342400200529     C           EMTH      IFEQ 2
342500200529     C           EYEAR     DIV  4         WORK2N
342600200529     C                     MVR            WORK1N         33
342700200529     C   33                ADD  1         EOMDAY
342800200529     C                     END
342900200529     C           EDAY      IFNE EOMDAY
343000200529     C                     ADD  1         EC         42
343100200529     C                     MOVEA' 247'    ERR,EC
343200200529     C                     END
343300200529     C                     END
343400200529     C                     END
343500200529     C                     END
343600200529     C*
343700200529     C                     END
343800200529     C                     END                                            S01158
343900200529     C*
344000200529     C* If Event type 'PP', validate Input and Amend modes
344100200529     C*
344200200529     C           SSDET     IFEQ 'PP'
344300200529     C           ACTC      IFEQ 'I'
344400200529     C           ACTC      OREQ 'A'
344500200529     C           EVTDNO    IFLT RUND
344600200529     C*
344700200529     C* Check no Trades input on this security
344800200529      ***  that have Value Date Greater Than or Equal To the Event Date   E20085
344900200529     C*
345000200529     C********** SSDSN     CHAINTRADSDF              33                   E20085
345100200529     C********** *IN33     IFEQ '0'                                       E20085
345200200529     C           SSDSN     SETLLTRADSDF                                   E20085
345300200529     C           SSDSN     READETRADSDF                  33               E20085
345400200529      *                                                                   E20085
345500200529     C           *IN33     DOWEQ'0'                                       E20085
345600200529     C           *IN42     ANDEQ'0'                                       E20085
345700200529      *                                                                   E20085
345800200529     C           TDVD      IFGE EVTDNO                                    E20085
345900200529     C                     ADD  1         EC
346000200529     C                     MOVEA' 110'    ERR,EC
346100200529     C                     SETON                     42
346200200529     C                     ELSE                                           E20085
346300200529     C           SSDSN     READETRADSDF                  33               E20085
346400200529     C                     END
346500200529      *                                                                   E20085
346600200529     C                     END                                            E20085
346700200529     C*
346800200529     C* Check this event not before last 'PP' event
346900200529     C*
347000200529     C           SSDSN     SETGTSEDEVDFX
347100200529     C           2         OCUR DS01
347200200529      *
347300200529     C           AGAINB    TAG                             *** AGAINB ***
347400200529      *
347500200529     C                     READPSEDEVDFX                 33
347600200529     C*
347700200529     C* Check record is not a cancelled record
347800200529     C*
347900200529     C  N33      RECI      CABEQ'C'       AGAINB
348000200529     C*
348100200529     C* Check same Security
348200200529     C*
348300200529     C  N33      SDSN      COMP SSDSN                3333
348400200529     C   33                GOTO OUTB
348500200529     C*
348600200529     C* Check same Event type
348700200529     C*
348800200529     C           SDET      CABNE'PP'      AGAINB
348900200529     C*
349000200529     C           EVTDNO    IFLT SDED
349100200529     C                     ADD  1         EC
349200200529     C                     MOVEA' 111'    ERR,EC
349300200529     C                     SETON                     42
349400200529     C                     END
349500200529     C*
349600200529     C           OUTB      TAG                             ***  OUTB  ***
349700200529     C           1         OCUR DS01
349800200529     C*
349900200529     C                     END
350000200529     C                     END
350100200529     C                     END
350200200529     C*
350300200529     C* Event date can not be before run date for following codes
350400200529     C*
350500200529     C           SSDET     IFEQ 'RC'
350600200529     C           SSDET     OREQ 'RP'
350700200529     C           SSDET     OREQ 'CV'
350800200529     C           SSDET     OREQ 'BI'
350900200529     C           SSDET     OREQ 'RI'
351000200529     C           SSDET     OREQ 'CR'
351100200529     C           SSDET     OREQ 'OC'
351200200529     C/COPY WNCPYSRC,SE0130C017
351300200529     C           ACTC      IFEQ 'I'
351400200529     C           ACTC      OREQ 'A'
351500200529     C***********ZDAYNO    IFLT RUND                                      S01158
351600200529     C           EVTDNO    IFLT RUND                                      S01158
351700200529     C                     ADD  1         EC
351800200529     C                     MOVEA' 112'    ERR,EC
351900200529     C                     SETON                     42
352000200529     C                     END
352100200529     C                     END
352200200529     C                     END
352300200529     C/COPY WNCPYSRC,SE0130C009
352400200529     C*
352500200529     C* Event type - Check for allowable entries
352600200529     C*
352700200529     C           SSDET     IFEQ '  '
352800200529     C           SSDET     ORNE 'DV'
352900200529     C           SSDET     ANDNE'PP'
353000200529     C           SSDET     ANDNE'MP'
353100200529     C           SSDET     ANDNE'IR'
353200200529     C           SSDET     ANDNE'XR'
353300200529     C           SSDET     ANDNE'RC'
353400200529     C           SSDET     ANDNE'RP'
353500200529     C           SSDET     ANDNE'CV'
353600200529     C           SSDET     ANDNE'BI'
353700200529     C           SSDET     ANDNE'RI'
353800200529     C           SSDET     ANDNE'CR'
353900200529     C           SSDET     ANDNE'OC'
354000200529     C/COPY WNCPYSRC,SE0130C010
354100200529     C                     ADD  1         EC
354200200529     C                     MOVEA' 121'    ERR,EC
354300200529     C                     SETON                     43
354400200529     C                     ELSE
354500200529     C/COPY WNCPYSRC,SE0130C011
354600200529     C*
354700200529     C* If entry 'DV', check Investment type is a share (PROT '4')
354800200529     C*
354900200529     C           SSDET     IFEQ 'DV'
355000200529     C           ITPKA     CHAININVTPDF              33
355100200529     C           PROT      IFNE '4'
355200200529     C           PROT      ANDNE'7'                                       179359
355300200529     C*                                                                   S01408
355400200529     C/COPY WNCPYSRC,SE0130CP11                                           S01408
355500200529     C*                                                                   S01408
355600200529     C                     ADD  1         EC
355700200529     C                     MOVEA' 113'    ERR,EC
355800200529     C                     SETON                     43
355900200529     C                     END
356000200529     C                     END
356100200529     C/COPY WNCPYSRC,SE0130C027
356200200529     C*
356300200529     C* Entry 'PP' but Security is not partly-paid
356400200529     C*
356500200529     C           SSDET     IFEQ 'PP'
356600200529     C           PPDI      ANDNE'Y'
356700200529     C                     ADD  1         EC
356800200529     C                     MOVEA' 114'    ERR,EC
356900200529     C                     SETON                     43
357000200529     C                     END
357100200529     C* Entry 'PP' but Security is not COMPLETE                           E15930
357200200529     C*                                                                   E15930
357300200529     C           SSDET     IFEQ 'PP'                                      E15930
357400200529     C           INCS      ANDNE'C'                                       E15930
357500200529     C                     ADD  1         EC                              E15930
357600200529     C                     MOVEA' 131'    ERR,EC                          E15930
357700200529     C                     SETON                     43                   E15930
357800200529     C                     END                                            E15930
357900200529     C*
358000200529     C* If entry 'MP', check Investment type is Mortgage backed (PROT '8')
358100200529     C*
358200200529     C           SSDET     IFEQ 'MP'
358300200529     C           ITPKA     CHAININVTPDF              33
358400200529     C           PROT      IFNE '8'
358500200529     C                     ADD  1         EC
358600200529     C                     MOVEA' 115'    ERR,EC
358700200529     C                     SETON                     43
358800200529     C                     END
358900200529     C                     END
359000200529     C/COPY WNCPYSRC,SE0130C028
359100200529     C*
359200200529     C* If entry 'IR', check Investment type is either a Floating Rate
359300200529     C* Note (PROT '3'), a Yen Bond (PROT '5') or a Mortgage Backed
359400200529     C* Security (PROT '8')
359500200529     C*
359600200529     C           SSDET     IFEQ 'IR'
359700200529     C           ITPKA     CHAININVTPDF              33
359800200529     C           PROT      IFNE '3'
359900200529     C           PROT      ANDNE'5'
360000200529     C           PROT      ANDNE'8'
360100200529     C/COPY WNCPYSRC,SE0130C043
360200200529     C                     ADD  1         EC
360300200529     C                     MOVEA' 116'    ERR,EC
360400200529     C                     SETON                     43
360500200529     C                     END
360600200529     C                     END
360700200529     C*
360800200529     C* If entry 'XR', check for Multi-currency or Value currency
360900200529     C*
361000200529     C           SSDET     IFEQ 'XR'
361100200529     C           MLTI      ANDNE'Y'
361200200529     C           S01509    ANDEQ'N'                                       S01509
361300200529     C           VLCY      IFEQ '   '
361400200529     C           VLCY      OREQ NMCY
361500200529     C                     ADD  1         EC
361600200529     C                     MOVEA' 117'    ERR,EC
361700200529     C                     SETON                     43
361800200529     C                     END
361900200529     C                     END
362000200529     C*
362100200529     C* If entry 'RC', check for Early Repayment indicator
362200200529     C*
362300200529     C           SSDET     IFEQ 'RC'
362400200529     C           ERPY      ANDNE'Y'
362500200529     C           EVTDNO    ANDNEMATY
362600200529     C                     ADD  1         EC
362700200529     C                     MOVEA' 118'    ERR,EC
362800200529     C                     SETON                     43
362900200529     C                     END
363000200529     C*
363100200529     C* If entry 'RP', check for Early Repayment indicator
363200200529     C*
363300200529     C           SSDET     IFEQ 'RP'
363400200529     C           ERPY      ANDNE'Y'
363500200529     C           EVTDNO    ANDNEMATY
363600200529     C                     ADD  1         EC
363700200529     C                     MOVEA' 119'    ERR,EC
363800200529     C                     SETON                     43
363900200529     C                     END
364000200529     C*
364100200529     C* If entry 'CV', check for Convertible indicator
364200200529     C*
364300200529     C           SSDET     IFEQ 'CV'
364400200529     C           ITPKA     CHAININVTPDF              33
364500200529     C           CNVI      IFNE 'Y'
364600200529     C                     ADD  1         EC
364700200529     C                     MOVEA' 120'    ERR,EC
364800200529     C                     SETON                     43
364900200529     C                     END
365000200529     C                     END
365100200529     C/COPY WNCPYSRC,SE0130C012
365200200529     C*
365300200529     C                     END
365400200529     C*
365500200529     C                     ENDSR
365600200529     C*
365700200529      *****************************************************************
365800200529      /EJECT
365900200529      *****************************************************************
366000200529      *                                                               *
366100200529      *  VLDSEC - Subroutine to validate entries made on the Second   *
366200200529      *           Screen.                                             *
366300200529      *                                                               *
366400200529      *****************************************************************
366500200529      *
366600200529     C           VLDSEC    BEGSR                           *** VLDSEC ***
366700200529     C*
366800200529     C* Setof error indicators
366900200529     C*
367000200529     C                     Z-ADD*ZEROS    EC
367100200529     C                     Z-ADD*ZEROS    WEC
367200200529     C                     MOVE *BLANKS   ERRMSG
367300200529     C                     MOVEA'00000000'*IN,50
367400200529     C                     MOVEA'00000000'*IN,58
367500200529     C                     MOVEA'00'      *IN,66
367600200529     C                     MOVE '0'       *IN49                           S01510
367700200529     C                     MOVE '0'       *IN57                           S01509
367800200529     C                     MOVE '0'       *IN65                           S01509
367900200529     C/COPY WNCPYSRC,SE0130C018
368000200529     C* ZEROISE WORK FIELDS                                               E15930
368100200529     C                     Z-ADD*ZEROS    ORIDTA                          E15930
368200200529     C                     Z-ADD*ZEROS    ORIDTP                          E15930
368300200529     C*
368400200529     C* Dividends Declared
368500200529     C*
368600200529     C           SSDET     IFEQ 'DV'
368700200529     C*
368800200529     C* Amount per unit
368900200529     C*
369000200529     C           SSDDV     IFEQ *BLANKS
369100200529     C                     ADD  1         EC
369200200529     C                     MOVEA' 200'    ERR,EC
369300200529     C                     SETON                     50
369400200529     C                     ELSE
369500200529     C*
369600200529     C* Check valid number
369700200529     C*
369800200529     C                     MOVE *BLANKS   ZFIELD
369900200529     C                     MOVE SSDDV     ZFIELD
370000200529     C***********          Z-ADD9         ZADIG                           E16772
370100200529     C***********          Z-ADD4         ZADEC                           E16772
370200200529     C                     Z-ADD5         ZADIG                           E16772
370300200529     C                     Z-ADD8         ZADEC                           E16772
370400200529     C                     EXSR ZALIGN
370500200529     C           *IN99     IFEQ '1'
370600200529     C                     ADD  1         EC
370700200529     C                     MOVEA' 201'    ERR,EC
370800200529     C                     SETON                     50
370900200529     C                     END
371000200529     C                     END
371100200529     C*
371200200529     C* Narrative
371300200529     C*
371400200529     C           NAR1      IFEQ *BLANKS
371500200529     C                     ADD  1         EC
371600200529     C                     MOVEA' 202'    ERR,EC
371700200529     C                     SETON                     51
371800200529     C                     END
371900200529     C*
372000200529     C* Payment date
372100200529     C*
372200200529     C                     MOVE SSDPD     DATEN
372300200529     C                     MOVE DATEN     DATEA
372400200529     C           SSDPD     IFNE DATEA
372500200529     C                     ADD  1         EC
372600200529     C                     MOVEA' 203'    ERR,EC
372700200529     C                     SETON                     52
372800200529     C                     ELSE
372900200529     C                     MOVE SSDPD     ZDATE
373000200529     C                     EXSR ZDATE1
373100200529     C           *IN99     IFEQ '1'
373200200529     C                     ADD  1         EC
373300200529     C                     MOVEA' 203'    ERR,EC
373400200529     C                     SETON                     52
373500200529     C                     ELSE
373600200529     C*
373700200529     C* Check not after Event date
373800200529     C*
373900200529     C           ZDAYNO    IFLT EVTDNO
374000200529     C                     ADD  1         EC
374100200529     C                     MOVEA' 204'    ERR,EC
374200200529     C                     SETON                     52
374300200529     C                     END
374400200529     C*
374500200529     C* Check not holiday in value currency (nominal if blank)
374600200529     C*    WARNING ERROR ONLY - check only if changed
374700200529     C*
374800200529     C           VLCY      IFNE '   '
374900200529     C                     MOVE VLCY      ZCCY
375000200529     C                     ELSE
375100200529     C                     MOVE NMCY      ZCCY
375200200529     C                     END
375300200529      *
375400200529     C***********          EXSR ZDATE5                                    S01195
375500200529     C                     MOVE *BLANKS   ZLOC                            S01195
375600200529     C                     EXSR ZCHKH                                     S01195
375700200529     C************IN99     IFEQ '1'                                       S01195
375800200529     C           ZIND      IFEQ 'H'                                       S01195
375900200529     C                     ADD  1         EC
376000200529     C                     ADD  1         WEC
376100200529     C                     MOVEA' W11'    ERR,EC
376200200529     C                     SETON                     52
376300200529     C                     END
376400200529      *
376500200529     C                     Z-ADDZDAYNO    PDAYNO
376600200529     C                     END
376700200529     C                     END
376800200529      *                                                                   S01510
376900200529     C           S01510    IFEQ 'Y'                                       S01510
377000200529      * Ex-Date - validate if not blank and not past event date           S01510
377100200529     C           SSDXD     IFEQ *BLANKS                                   S01510
377200200529     C                     ADD  1         EC                              S01510
377300200529     C                     MOVEA' 254'    ERR,EC                          S01510
377400200529     C                     MOVE '1'       *IN49                           S01510
377500200529     C                     ELSE                                           S01510
377600200529     C                     MOVE SSDXD     DATEN                           S01510
377700200529     C                     MOVE DATEN     DATEA                           S01510
377800200529     C           SSDXD     IFNE DATEA                                     S01510
377900200529     C                     ADD  1         EC                              S01510
378000200529     C                     MOVEA' 255'    ERR,EC                          S01510
378100200529     C                     MOVE '1'       *IN49                           S01510
378200200529     C                     ELSE                                           S01510
378300200529     C                     MOVE SSDXD     ZDATE                           S01510
378400200529     C                     EXSR ZDATE1                                    S01510
378500200529     C           *IN99     IFEQ '1'                                       S01510
378600200529     C                     ADD  1         EC                              S01510
378700200529     C                     MOVEA' 255'    ERR,EC                          S01510
378800200529     C                     MOVE '1'       *IN49                           S01510
378900200529     C                     ELSE                                           S01510
379000200529     C           ZDAYNO    IFGT EVTDNO                                    S01510
379100200529     C                     ADD  1         EC                              S01510
379200200529     C                     MOVEA' 256'    ERR,EC                          S01510
379300200529     C                     MOVE '1'       *IN49                           S01510
379400200529     C                     END                                            S01510
379500200529     C                     END                                            S01510
379600200529     C                     END                                            S01510
379700200529     C                     END                                            S01510
379800200529     C                     END                                            S01510
379900200529     C*
380000200529     C/COPY WNCPYSRC,SE0130C033
380100200529     C                     END
380200200529     C*
380300200529     C* Partly Paids
380400200529     C*
380500200529     C           SSDET     IFEQ 'PP'
380600200529     C*
380700200529     C* Call Amount - required if entry is a share
380800200529     C*
380900200529     C           *IN12     IFEQ '1'
381000200529     C           CAMT      ANDEQ*BLANKS
381100200529     C                     ADD  1         EC
381200200529     C                     MOVEA' 205'    ERR,EC
381300200529     C                     SETON                     53
381400200529     C                     END
381500200529     C*
381600200529     C* Check for valid number
381700200529     C*
381800200529     C                     MOVE *BLANKS   ZFIELD
381900200529     C                     MOVE CAMT      ZFIELD
382000200529     C*
382100200529     C* Use number of decimal places from Nominal currency
382200200529     C*
382300200529     C***********          MOVE *BLANKS   KEY12A                          S01117
382400200529     C***********          MOVELNMCY      WORK4                           S01117
382500200529     C***********          MOVE '1'       WORK4                           S01117
382600200529     C***********          MOVEL'20'      KEY12A                          S01117
382700200529     C***********          MOVE WORK4     KEY12A                          S01117
382800200529     C***********TABKA     CHAINTABTG10F             33                   S01117
382900200529     C                     MOVE NMCY      @AJCD   3                       S01117
383000200529     C                     CALL 'AOCURRR0'                                S01117
383100200529     C                     PARM '*DBERR ' @RTCD   7                       S01117
383200200529     C                     PARM '*KEY   ' @OPTN   7                       S01117
383300200529     C                     PARM           @AJCD   3                       S01117
383400200529     C           SDCURR    PARM SDCURR    DSSDY                           S01117
383500200529     C***********15        SUB  CDP       ZADIG                           S01117
383600200529     C***********          Z-ADDCDP       ZADEC                           S01117
383700200529     C           15        SUB  A6NBDP    ZADIG                           S01117
383800200529     C                     Z-ADDA6NBDP    ZADEC                           S01117
383900200529     C                     EXSR ZALIGN
384000200529     C           *IN99     IFEQ '1'
384100200529     C                     ADD  1         EC
384200200529     C                     MOVEA' 207'    ERR,EC
384300200529     C                     SETON                     53
384400200529     C                     ELSE
384500200529     C                     MOVE ZFIELD    CALAMT
384600200529     C**
384700200529     C* IF IT IS AN AMENDMENT, CHAIN TO THE RECORD TO GET THE ORIGINAL    E19763
384800200529     C* AMOUNT THAT WAS KEYED IN EARLIER.                                 E19763
384900200529     C           ACTC      IFEQ 'A'                                       E19763
385000200529     C           DEVKA     CHAINSEDEVDFX             33                   E19763
385100200529     C                     Z-ADDSDPP      OLDSPP                          E19763
385200200529     C                     END                                            E19763
385300200529     C*
385400200529     C* Fetch total Paid for this security
385500200529     C*
385600200529     C           SSDSN     SETGTSEDEVDFX
385700200529     C           2         OCUR DS01
385800200529     C                     Z-ADD*ZEROS    SDTA
385900200529      *
386000200529     C           AGAIN1    TAG                             *** AGAIN1 ***
386100200529      *
386200200529     C                     READPSEDEVDFX                 33
386300200529     C*
386400200529     C* Check record is not a cancelled record
386500200529     C*
386600200529     C  N33      RECI      CABEQ'C'       AGAIN1
386700200529     C*
386800200529     C* Check same Security
386900200529     C*
387000200529     C  N33      SDSN      COMP SSDSN                3333
387100200529      *
387200200529     C* IF 33 ON ==> THERE IS NO PP RECORDS ON DIARY FOR THE SECURITY     E15930
387300200529     C   33                MOVE CPDP      SDTA                            E15930
387400200529     C   33                MOVE CPDP      ORIDTA                          E15930
387500200529     C   33                GOTO OUT2
387600200529     C*
387700200529     C* Check same Event type
387800200529     C*
387900200529     C           SDET      CABNE'PP'      AGAIN1
388000200529     C*
388100200529     C* Check total will not exceed Fully Paid Price
388200200529     C*
388300200529     C           OUT2      TAG                             ***  OUT2  ***
388400200529     C*
388500200529     C           SDTA      ADD  CALAMT    TOTAM
388600200529     C*                                                                   E19763
388700200529     C* IF AMENDMENT, SUBTRACT THE ORIGINAL AMT THAT WAS ENTERED          E19763
388800200529     C*                                                                   E19763
388900200529     C           ACTC      IFEQ 'A'                                       E19763
389000200529     C           TOTAM     SUB  OLDSPP    TOTAM                           E19763
389100200529     C                     END                                            E19763
389200200529     C*                                                                   E19763
389300200529     C           TOTAM     IFGT SFPP
389400200529     C                     ADD  1         EC
389500200529     C                     MOVEA' 206'    ERR,EC
389600200529     C                     SETON                     53
389700200529     C                     END
389800200529     C*
389900200529     C           1         OCUR DS01
390000200529     C                     END
390100200529     C*
390200200529     C* Call Percentage - required if entry is a share
390300200529     C*
390400200529     C           *IN13     IFEQ '1'
390500200529     C           *IN14     ANDEQ'1'
390600200529     C           CPRI      ANDEQ*BLANKS
390700200529     C                     ADD  1         EC
390800200529     C                     MOVEA' 208'    ERR,EC
390900200529     C                     SETON                     54
391000200529     C                     END
391100200529     C*
391200200529     C* Check for valid number
391300200529     C*
391400200529     C                     MOVE *BLANKS   ZFIELD
391500200529     C                     MOVE CPRI      ZFIELD
391600200529     C                     Z-ADD3         ZADIG
391700200529     C                     Z-ADD3         ZADEC
391800200529     C                     EXSR ZALIGN
391900200529     C           *IN99     IFEQ '1'
392000200529     C                     ADD  1         EC
392100200529     C                     MOVEA' 210'    ERR,EC
392200200529     C                     SETON                     54
392300200529     C                     ELSE
392400200529     C                     MOVE ZFIELD    CALPC
392500200529     C**
392600200529     C* IF IT IS AN AMENDMENT, CHAIN TO THE RECORD TO GET THE ORIGINAL    E19763
392700200529     C* AMOUNT THAT WAS KEYED IN EARLIER.                                 E19763
392800200529     C           ACTC      IFEQ 'A'                                       E19763
392900200529     C           DEVKA     CHAINSEDEVDFX             33                   E19763
393000200529     C                     Z-ADDSDPC      OLDSPC                          E19763
393100200529     C                     END                                            E19763
393200200529     C*
393300200529     C* Fetch total Percentage for this security
393400200529     C*
393500200529     C           SSDSN     SETGTSEDEVDFX
393600200529     C           2         OCUR DS01
393700200529      *
393800200529     C           AGAIN2    TAG                             *** AGAIN2 ***
393900200529      *
394000200529     C                     READPSEDEVDFX                 33
394100200529     C*
394200200529     C* Check record is not a cancelled record
394300200529     C*
394400200529     C  N33      RECI      CABEQ'C'       AGAIN2
394500200529     C*
394600200529     C* Check same Security
394700200529     C*
394800200529     C  N33      SDSN      COMP SSDSN                3333
394900200529      *
395000200529     C* IF 33 ON ==> THERE IS NO PP RECORDS ON DIARY FOR THE SECURITY     E15930
395100200529     C   33                MOVE CPDP      SDTP                            E15930
395200200529     C   33                MOVE CPDP      ORIDTP                          E15930
395300200529     C   33                GOTO OUT3
395400200529     C*
395500200529     C* Check same Event type
395600200529     C*
395700200529     C           SDET      CABNE'PP'      AGAIN2
395800200529     C*
395900200529     C* Check total will not exceed 100%
396000200529     C*
396100200529     C           OUT3      TAG                             ***  OUT3  *** E15930
396200200529     C           SDTP      ADD  CALPC     TOTPC   63
396300200529     C*
396400200529     C* IF AMENDMENT, SUBTRACT THE ORIGINAL AMT THAT WAS ENTERED
396500200529     C*
396600200529     C           ACTC      IFEQ 'A'                                       E19763
396700200529     C           TOTPC     SUB  OLDSPC    TOTPC                           E19763
396800200529     C                     END                                            E19763
396900200529     C*                                                                   E19763
397000200529     C*                                                                   S01408
397100200529     C/COPY WNCPYSRC,SE0130CCP5                                           S01408
397200200529     C*                                                                   S01408
397300200529     C           TOTPC     IFGT 100
397400200529     C*                                                                   S01408
397500200529     C/COPY WNCPYSRC,SE0130CCP6                                           S01408
397600200529     C*                                                                   S01408
397700200529     C                     ADD  1         EC
397800200529     C                     MOVEA' 209'    ERR,EC
397900200529     C                     SETON                     54
398000200529     C                     END
398100200529     C*
398200200529     C***********OUT3      TAG                             ***  OUT3  *** E15930
398300200529     C           1         OCUR DS01
398400200529     C                     END
398500200529     C*
398600200529     C* Narrative
398700200529     C*
398800200529     C           NAR1      IFEQ *BLANKS
398900200529     C                     ADD  1         EC
399000200529     C                     MOVEA' 211'    ERR,EC
399100200529     C                     SETON                     51
399200200529     C                     END
399300200529     C*
399400200529     C                     END
399500200529     C*
399600200529     C* Mortgage Payments
399700200529     C*
399800200529     C           SSDET     IFEQ 'MP'
399900200529     C/COPY WNCPYSRC,SE0130C029
400000200529     C*
400100200529     C* Current factor - must not be blank if Repayment amount also
400200200529     C* blank
400300200529     C*
400400200529     C           SSDCP     IFEQ *BLANKS
400500200529     C           SSRPT     IFEQ *BLANKS
400600200529     C                     ADD  1         EC
400700200529     C                     MOVEA' 212'    ERR,EC
400800200529     C                     SETON                     55
400900200529     C                     END
401000200529     C*                                                                   E15236
401100200529     C* Current factor entered, error if Repayment amount also entered    E15236
401200200529     C*                                                                   E15236
401300200529     C                     ELSE
401400200529     C           SSRPT     IFNE *BLANKS                                   E15236
401500200529     C                     ADD  1         EC                              E15236
401600200529     C                     MOVEA' 212'    ERR,EC                          E15236
401700200529     C                     SETON                     55                   E15236
401800200529     C                     END                                            E15236
401900200529     C*
402000200529     C* Check valid number
402100200529     C*
402200200529     C                     MOVE *BLANKS   ZFIELD
402300200529     C                     MOVE SSDCP     ZFIELD
402400200529     C                     Z-ADD1         ZADIG
402500200529     C**********           Z-ADD8         ZADEC                           052254
402600200529     C                     Z-ADD9         ZADEC                           055254
402700200529     C                     EXSR ZALIGN
402800200529     C           *IN99     IFEQ '1'
402900200529     C                     ADD  1         EC
403000200529     C                     MOVEA' 213'    ERR,EC
403100200529     C                     SETON                     55
403200200529     C                     ELSE
403300200529     C*
403400200529     C* Check value not greater than 1
403500200529     C*
403600200529     C**********           MOVE ZFIELD    WK18    98                      052254
403700200529     C                     MOVE ZFIELD    WK18                            052254
403800200529     C/COPY WNCPYSRC,SE0130C021
403900200529     C           WK18      IFGT 1
404000200529     C                     ADD  1         EC
404100200529     C                     MOVEA' 213'    ERR,EC
404200200529     C                     SETON                     55
404300200529     C                     END
404400200529     C/COPY WNCPYSRC,SE0130C022
404500200529     C                     END
404600200529     C/COPY WNCPYSRC,SE0130C023
404700200529     C*
404800200529     C**  Check not greater than secty current factor
404900200529     C*
405000200529     C           SSDCP     IFNE *BLANKS
405100200529     C***********WK18      ANDGECFCT                                      E14856
405200200529     C           WK18      ANDGTCFCT                                      E14856
405300200529     C           SSDET     ANDEQ'MP'
405400200529     C                     ADD  1         EC
405500200529     C                     MOVEA' 249'    ERR,EC
405600200529     C                     SETON                     55
405700200529     C                     END
405800200529     C/COPY WNCPYSRC,SE0130C024
405900200529     C*
406000200529     C* The previous 'MP' record cannot have a Repayment method indicator
406100200529     C* of 'Y'
406200200529     C*
406300200529     C           DEVKA     SETLLSEDEVDFX
406400200529     C*
406500200529     C           2         OCUR DS01
406600200529     C           AGAIN7    TAG                             *** AGAIN7 ***
406700200529     C                     READPSEDEVDFX                 33
406800200529     C*
406900200529     C* Check record is not a cancelled record
407000200529     C*
407100200529     C  N33      RECI      CABEQ'C'       AGAIN7
407200200529     C*
407300200529     C* Check same Security
407400200529     C*
407500200529     C  N33      SDSN      COMP SSDSN                3333
407600200529     C   33                GOTO OUT8
407700200529     C*
407800200529     C* Check same Event type
407900200529     C*
408000200529     C           SDET      CABNE'MP'      AGAIN7
408100200529     C*
408200200529     C           SRMI      IFEQ 'Y'
408300200529     C                     ADD  1         EC
408400200529     C                     MOVEA' 248'    ERR,EC
408500200529     C                     SETON                     56
408600200529     C                     END
408700200529     C*
408800200529     C           OUT8      TAG                             ***  OUT8  ***
408900200529      *
409000200529     C           1         OCUR DS01
409100200529     C*
409200200529     C* The next 'MP' record cannot have a Repayment method indicator
409300200529     C* of 'Y'
409400200529     C*
409500200529     C           DEVKA     SETLLSEDEVDFX
409600200529     C*
409700200529     C           2         OCUR DS01
409800200529      *
409900200529     C           AGAIN9    TAG                             *** AGAIN9 ***
410000200529      *
410100200529     C                     READ SEDEVDFX                 33
410200200529     C*
410300200529     C* Check record is not a cancelled record
410400200529     C*
410500200529     C  N33      RECI      CABEQ'C'       AGAIN9
410600200529     C*
410700200529     C* Check same Security
410800200529     C*
410900200529     C  N33      SDSN      COMP SSDSN                3333
411000200529     C   33                GOTO OUT10
411100200529     C*
411200200529     C* Check same Event type
411300200529     C*
411400200529     C           SDET      CABNE'MP'      AGAIN9
411500200529     C*
411600200529     C           SRMI      IFEQ 'Y'
411700200529     C                     ADD  1         EC
411800200529     C                     MOVEA' 245'    ERR,EC
411900200529     C                     SETON                     56
412000200529     C                     END
412100200529     C*
412200200529     C           OUT10     TAG                             ***  OUT10  ***
412300200529      *
412400200529     C           1         OCUR DS01
412500200529     C*
412600200529     C                     END
412700200529     C*
412800200529     C* Repayment amount - must not be blank if Current factor also
412900200529     C* blank
413000200529     C*
413100200529     C           SSRPT     IFEQ *BLANKS
413200200529     C           SSDCP     IFEQ *BLANKS
413300200529     C                     ADD  1         EC
413400200529     C                     MOVEA' 215'    ERR,EC
413500200529     C                     SETON                     56
413600200529     C                     END
413700200529     C                     ELSE
413800200529      *
413900200529      ***  The previous 'MP' record cannot have a Repayment Method
414000200529      ***  Indicator of ' '.
414100200529      *
414200200529     C           DEVKA     SETLLSEDEVDFX
414300200529     C*
414400200529     C                     Z-ADD*ZEROS    SVSDTR
414500200529     C           2         OCUR DS01
414600200529      *
414700200529     C           AGAIN3    TAG                             *** AGAIN3 ***
414800200529      *
414900200529     C                     READPSEDEVDFX                 33
415000200529     C*
415100200529     C* Check record is not a cancelled record
415200200529     C*
415300200529     C  N33      RECI      CABEQ'C'       AGAIN3
415400200529     C*
415500200529     C* Check same Security
415600200529     C*
415700200529     C  N33      SDSN      COMP SSDSN                3333
415800200529     C   33                GOTO OUT4
415900200529     C*
416000200529     C* Check same Event type
416100200529     C*
416200200529     C           SDET      CABNE'MP'      AGAIN3
416300200529     C*
416400200529     C           SRMI      IFEQ ' '
416500200529     C                     ADD  1         EC
416600200529     C                     MOVEA' 214'    ERR,EC
416700200529     C                     SETON                     56
416800200529     C                     END
416900200529     C*
417000200529     C* Save previous total repaid
417100200529     C*
417200200529     C                     Z-ADDSDTR      SVSDTR
417300200529     C*
417400200529     C           OUT4      TAG                             ***  OUT4  ***
417500200529      *
417600200529     C           1         OCUR DS01
417700200529     C*
417800200529     C* The next 'MP' record cannot have a Repayment method indicator
417900200529     C* of ' '
418000200529     C*
418100200529     C           DEVKA     SETLLSEDEVDFX
418200200529     C*
418300200529     C           2         OCUR DS01
418400200529      *
418500200529     C           AGAIN8    TAG                             *** AGAIN8 ***
418600200529      *
418700200529     C                     READ SEDEVDFX                 33
418800200529     C*
418900200529     C* Check record is not a cancelled record
419000200529     C*
419100200529     C  N33      RECI      CABEQ'C'       AGAIN8
419200200529     C*
419300200529     C* Check same Security
419400200529     C*
419500200529     C  N33      SDSN      COMP SSDSN                3333
419600200529     C   33                GOTO OUT9
419700200529     C*
419800200529     C* Check same Event type
419900200529     C*
420000200529     C           SDET      CABNE'MP'      AGAIN8
420100200529     C*
420200200529     C           SRMI      IFEQ ' '
420300200529     C                     ADD  1         EC
420400200529     C                     MOVEA' 214'    ERR,EC
420500200529     C                     SETON                     56
420600200529     C                     END
420700200529     C*
420800200529     C           OUT9      TAG                             ***  OUT9  ***
420900200529     C           1         OCUR DS01
421000200529     C*
421100200529     C* Check valid number
421200200529     C*
421300200529     C                     MOVE *BLANKS   ZFIELD
421400200529     C                     MOVE SSRPT     ZFIELD
421500200529     C                     Z-ADD15        ZADIG
421600200529     C                     Z-ADD*ZERO     ZADEC
421700200529     C                     EXSR ZALIGN
421800200529     C           *IN99     IFEQ '1'
421900200529     C                     ADD  1         EC
422000200529     C                     MOVEA' 216'    ERR,EC
422100200529     C                     SETON                     56
422200200529     C                     ELSE
422300200529     C                     MOVE ZFIELD    SCSRPT
422400200529     C*
422500200529     C* Check amount entered not greater than amount outstanding
422600200529     C*
422700200529     C           ISSA      SUB  SVSDTR    AMTOS
422800200529     C           SCSRPT    IFGT AMTOS
422900200529     C                     ADD  1         EC
423000200529     C                     MOVEA' 217'    ERR,EC
423100200529     C                     SETON                     56
423200200529     C                     END
423300200529     C                     END
423400200529     C                     END
423500200529     C*
423600200529     C* Payment date - Must be entered
423700200529     C*
423800200529     C           SSDPD     IFEQ *BLANKS
423900200529     C                     ADD  1         EC
424000200529     C                     MOVEA' 218'    ERR,EC
424100200529     C                     SETON                     52
424200200529     C                     ELSE
424300200529     C*
424400200529     C* Check date valid
424500200529     C*
424600200529     C                     MOVE SSDPD     DATEN
424700200529     C                     MOVE DATEN     DATEA
424800200529     C           SSDPD     IFNE DATEA
424900200529     C                     ADD  1         EC
425000200529     C                     MOVEA' 219'    ERR,EC
425100200529     C                     SETON                     52
425200200529     C                     ELSE
425300200529     C                     MOVE SSDPD     ZDATE
425400200529     C                     EXSR ZDATE1
425500200529     C           *IN99     IFEQ '1'
425600200529     C                     ADD  1         EC
425700200529     C                     MOVEA' 219'    ERR,EC
425800200529     C                     SETON                     52
425900200529     C                     ELSE
426000200529     C*
426100200529     C* Check not before Event date
426200200529     C*
426300200529     C           ZDAYNO    IFLT EVTDNO
426400200529     C                     ADD  1         EC
426500200529     C                     MOVEA' 220'    ERR,EC
426600200529     C                     SETON                     52
426700200529     C                     END
426800200529     C*
426900200529     C* Check not holiday in value currency (nominal if blank)
427000200529     C*    WARNING ERROR ONLY - check only if changed
427100200529     C*
427200200529     C           VLCY      IFNE '   '
427300200529     C                     MOVE VLCY      ZCCY
427400200529     C                     ELSE
427500200529     C                     MOVE NMCY      ZCCY
427600200529     C                     END
427700200529     C***********          EXSR ZDATE5                                    S01195
427800200529     C                     MOVE *BLANKS   ZLOC                            S01195
427900200529     C                     EXSR ZCHKH                                     S01195
428000200529     C************IN99     IFEQ '1'                                       S01195
428100200529     C           ZIND      IFEQ 'H'                                       S01195
428200200529     C                     ADD  1         WEC
428300200529     C                     ADD  1         EC
428400200529     C                     MOVEA' W12'    ERR,EC
428500200529     C                     SETON                     52
428600200529     C                     END
428700200529     C                     Z-ADDZDAYNO    PDAYNO
428800200529     C                     END
428900200529     C*
429000200529     C                     END
429100200529     C                     END
429200200529     C*
429300200529     C* Narrative - Mandatory entry
429400200529     C*
429500200529     C           NAR2      IFEQ *BLANKS
429600200529     C                     ADD  1         EC
429700200529     C                     MOVEA' 221'    ERR,EC
429800200529     C                     SETON                     51
429900200529     C                     END
430000200529     C*
430100200529     C                     END
430200200529     C/COPY WNCPYSRC,SE0130C030
430300200529     C*
430400200529     C* Interest Rate Change
430500200529     C*
430600200529     C           SSDET     IFEQ 'IR'
430700200529     C*
430800200529     C* Next Coupon Rate - Mandatory entry
430900200529     C*
431000200529     C           SSDNC     IFEQ *BLANKS
431100200529     C/COPY WNCPYSRC,SE0130C044
431200200529     C                     ADD  1         EC
431300200529     C                     MOVEA' 222'    ERR,EC
431400200529     C                     SETON                     58
431500200529     C                     ELSE
431600200529     C*
431700200529     C* Check valid number
431800200529     C* And that it is not lesser than the Minimum Coupon
431900200529     C*                                                                   E19447
432000200529     C                     MOVE *BLANKS   ZFIELD
432100200529     C                     MOVE SSDNC     ZFIELD
432200200529     C                     Z-ADD4         ZADIG
432300200529     C                     Z-ADD7         ZADEC
432400200529     C                     EXSR ZALIGN
432500200529     C           *IN99     IFEQ '1'
432600200529     C                     ADD  1         EC
432700200529     C                     MOVEA' 223'    ERR,EC
432800200529     C                     SETON                     58
432900200529     C                     ELSE                                           E19447
433000200529     C                     MOVE ZFIELD    SDNC                            E19447
433100200529     C           SDNC      COMP MCPN                   33                 E19447
433200200529     C*                                                                   E19447
433300200529     C           *IN33     IFEQ '1'                                       E19447
433400200529     C                     ADD  1         EC                              E19447
433500200529     C                     MOVEA' 323'    ERR,EC                          E19447
433600200529     C                     SETON                     58                   E19447
433700200529     C                     END                                            E19447
433800200529     C*                                                                   E19447
433900200529     C                     END
434000200529     C/COPY WNCPYSRC,SE0130C045
434100200529     C                     END
434200200529     C*
434300200529     C                     END
434400200529     C*
434500200529     C* Exchange Rates
434600200529     C*
434700200529     C           SSDET     IFEQ 'XR'
434800200529     C*
434900200529     C* Payment currency - Not equal to Value currency on Security for a
435000200529     C* dual currency security
435100200529     C*
435200200529     C           PAYC      IFNE '   '
435300200529     C           VLCY      IFNE NMCY
435400200529     C           PAYC      ANDNEVLCY
435500200529     C                     ADD  1         EC
435600200529     C                     MOVEA' 224'    ERR,EC
435700200529     C                     SETON                     59
435800200529     C                     END
435900200529     C*
436000200529     C* Check valid currency
436100200529     C*
436200200529     C***********          MOVE *BLANKS   KEY12A                          S01117
436300200529     C***********          MOVELPAYC      WORK4   4                       S01117
436400200529     C***********          MOVE '1'       WORK4                           S01117
436500200529     C***********          MOVEL'20'      KEY12A                          S01117
436600200529     C***********          MOVE WORK4     KEY12A                          S01117
436700200529     C***********TABKA     CHAINTABTG10F             33                   S01117
436800200529     C                     CALL 'AOCURRR0'                                S01117
436900200529     C                     PARM *BLANKS   @RTCD   7                       S01117
437000200529     C                     PARM '*KEY   ' @OPTN   7                       S01117
437100200529     C                     PARM PAYC      @AJCD   3                       S01117
437200200529     C           SDCURR    PARM SDCURR    DSSDY                           S01117
437300200529     C*                                                                   S01117
437400200529     C           @RTCD     IFNE *BLANKS                                   S01117
437500200529     C************IN33     IFEQ '1'                                       S01117
437600200529     C                     ADD  1         EC
437700200529     C                     MOVEA' 225'    ERR,EC
437800200529     C                     SETON                     59
437900200529     C***********          ELSE                                           S01117
438000200529     C***********RECI      IFEQ '*'                                       S01117
438100200529     C***********          ADD  1         EC                              S01117
438200200529     C***********          MOVEA' 225'    ERR,EC                          S01117
438300200529     C***********          SETON                     59                   S01117
438400200529     C***********          END                                            S01117
438500200529     C                     END
438600200529     C                     END
438700200529     C*
438800200529     C* Cut Coupon Exchange Rate - Mandatory entry
438900200529     C*
439000200529     C           CUTR      IFEQ *BLANKS
439100200529     C                     ADD  1         EC
439200200529     C                     MOVEA' 226'    ERR,EC
439300200529     C                     SETON                     60
439400200529     C                     ELSE
439500200529     C*
439600200529     C* Check valid number
439700200529     C*
439800200529     C                     MOVE *BLANKS   ZFIELD
439900200529     C                     MOVE CUTR      ZFIELD
440000200529     C                     Z-ADD5         ZADIG
440100200529     C                     Z-ADD8         ZADEC
440200200529     C                     EXSR ZALIGN
440300200529     C           *IN99     IFEQ '1'
440400200529     C                     ADD  1         EC
440500200529     C                     MOVEA' 227'    ERR,EC
440600200529     C                     SETON                     60
440700200529     C                     END
440800200529     C                     END
440900200529     C*
441000200529     C* Mulitply/Divide indicator - Can only be 'M' or 'D'
441100200529     C*
441200200529     C           SSDMD     IFNE 'M'
441300200529     C           SSDMD     ANDNE'D'
441400200529     C                     ADD  1         EC
441500200529     C                     MOVEA' 228'    ERR,EC
441600200529     C                     SETON                     61
441700200529     C                     END
441800200529     C*
441900200529     C                     END
442000200529     C*
442100200529     C* Redemption Calls
442200200529     C*
442300200529     C           SSDET     IFEQ 'RC'
442400200529     C*
442500200529     C* Call amount - check valid number
442600200529     C*
442700200529     C           CLAT      IFNE *BLANKS
442800200529     C                     MOVE *BLANKS   ZFIELD
442900200529     C                     MOVE CLAT      ZFIELD
443000200529     C                     Z-ADD11        ZADIG
443100200529     C                     Z-ADD*ZERO     ZADEC
443200200529     C                     EXSR ZALIGN
443300200529     C           *IN99     IFEQ '1'
443400200529     C                     ADD  1         EC
443500200529     C                     MOVEA' 229'    ERR,EC
443600200529     C                     SETON                     53
443700200529     C                     END
443800200529     C                     END
443900200529     C*
444000200529     C* Call Percentage - check valid number
444100200529     C*
444200200529     C           CPRI      IFNE *BLANKS
444300200529     C                     MOVE *BLANKS   ZFIELD
444400200529     C                     MOVE CPRI      ZFIELD
444500200529     C                     Z-ADD3         ZADIG
444600200529     C                     Z-ADD3         ZADEC
444700200529     C                     EXSR ZALIGN
444800200529     C           *IN99     IFEQ '1'
444900200529     C                     ADD  1         EC
445000200529     C                     MOVEA' 230'    ERR,EC
445100200529     C                     SETON                     54
445200200529     C                     END
445300200529     C                     END
445400200529     C*
445500200529     C* Entry not valid if Call amount entered
445600200529     C*
445700200529     C           CPRI      IFNE *BLANKS
445800200529     C           CLAT      ANDNE*BLANKS
445900200529     C                     ADD  1         EC
446000200529     C                     MOVEA' 231'    ERR,EC
446100200529     C                     SETON                     54
446200200529     C                     END
446300200529     C*
446400200529     C* Redemption Price - check valid number
446500200529     C*
446600200529     C           RAMT      IFNE *BLANKS
446700200529     C                     MOVE *BLANKS   ZFIELD
446800200529     C                     MOVE RAMT      ZFIELD
446900200529     C                     Z-ADD7         ZADIG
447000200529     C                     Z-ADD8         ZADEC
447100200529     C                     EXSR ZALIGN
447200200529     C           *IN99     IFEQ '1'
447300200529     C                     ADD  1         EC
447400200529     C                     MOVEA' 232'    ERR,EC
447500200529     C                     SETON                     67
447600200529     C                     END
447700200529     C                     END
447800200529     C*                                                                   S01509
447900200529     C           S01509    IFEQ 'Y'                                       S01509
448000200529     C* Redemption Currency - check if not blank and exists in file       S01509
448100200529     C*                                                                   S01509
448200200529     C           RCCCY     IFNE *BLANKS                                   S01509
448300200529     C                     MOVE RCCCY     @AJCD   3                       S01509
448400200529     C                     CALL 'AOCURRR0'                                S01509
448500200529     C                     PARM '       ' @RTCD   7                       S01509
448600200529     C                     PARM '*VERIFY' @OPTN   7                       S01509
448700200529     C                     PARM           @AJCD   3                       S01509
448800200529     C           SDCURR    PARM SDCURR    DSSDY                           S01509
448900200529     C           @RTCD     IFNE *BLANKS                                   S01509
449000200529     C                     ADD  1         EC                              S01509
449100200529     C                     MOVEA' 250'    ERR,EC                          S01509
449200200529     C                     SETON                     57                   S01509
449300200529     C                     END                                            S01509
449400200529     C                     ELSE                                           S01509
449500200529     C                     ADD  1         EC                              S01509
449600200529     C                     MOVEA' 251'    ERR,EC                          S01509
449700200529     C                     SETON                     57                   S01509
449800200529     C                     END                                            S01509
449900200529     C*                                                                   S01509
450000200529     C* Exchange Rate - check valid number                                S01509
450100200529     C           XRATE     IFNE *BLANKS                                   S01509
450200200529     C                     MOVE *BLANKS   ZFIELD                          S01509
450300200529     C                     MOVE XRATE     ZFIELD                          S01509
450400200529     C                     Z-ADD5         ZADIG                           S01509
450500200529     C                     Z-ADD8         ZADEC                           S01509
450600200529     C                     EXSR ZALIGN                                    S01509
450700200529     C           *IN99     IFEQ '1'                                       S01509
450800200529     C                     ADD  1         EC                              S01509
450900200529     C                     MOVEA' 252'    ERR,EC                          S01509
451000200529     C                     SETON                     65                   S01509
451100200529     C                     END                                            S01509
451200200529     C                     ELSE                                           S01509
451300200529     C                     ADD  1         EC                              S01509
451400200529     C                     MOVEA' 253'    ERR,EC                          S01509
451500200529     C                     SETON                     65                   S01509
451600200529     C                     END                                            S01509
451700200529     C*                                                                   S01509
451800200529     C* Mulitply/Divide indicator - Can only be 'M' or 'D'                S01509
451900200529     C*                                                                   S01509
452000200529     C           RCDMD     IFNE 'M'                                       S01509
452100200529     C           RCDMD     ANDNE'D'                                       S01509
452200200529     C                     ADD  1         EC                              S01509
452300200529     C                     MOVEA' 228'    ERR,EC                          S01509
452400200529     C                     SETON                     61                   S01509
452500200529     C                     END                                            S01509
452600200529     C*                                                                   S01509
452700200529     C                     END                                            S01509
452800200529     C*                                                                   S01509
452900200529     C                     END
453000200529     C*
453100200529     C* Redemption Puts
453200200529     C*
453300200529     C           SSDET     IFEQ 'RP'
453400200529     C*
453500200529     C* Put amount - check valid number
453600200529     C*
453700200529     C           CLAT      IFNE *BLANKS
453800200529     C                     MOVE *BLANKS   ZFIELD
453900200529     C                     MOVE CLAT      ZFIELD
454000200529     C                     Z-ADD11        ZADIG
454100200529     C                     Z-ADD*ZERO     ZADEC
454200200529     C                     EXSR ZALIGN
454300200529     C           *IN99     IFEQ '1'
454400200529     C                     ADD  1         EC
454500200529     C                     MOVEA' 233'    ERR,EC
454600200529     C                     SETON                     53
454700200529     C                     END
454800200529     C                     END
454900200529     C*
455000200529     C* Put Percentage - check valid number
455100200529     C*
455200200529     C           CPRI      IFNE *BLANKS
455300200529     C                     MOVE *BLANKS   ZFIELD
455400200529     C                     MOVE CPRI      ZFIELD
455500200529     C                     Z-ADD3         ZADIG
455600200529     C                     Z-ADD3         ZADEC
455700200529     C                     EXSR ZALIGN
455800200529     C           *IN99     IFEQ '1'
455900200529     C                     ADD  1         EC
456000200529     C                     MOVEA' 234'    ERR,EC
456100200529     C                     SETON                     54
456200200529     C                     END
456300200529     C                     END
456400200529     C*
456500200529     C* Entry not valid if Put amount entered
456600200529     C*
456700200529     C           CPRI      IFNE *BLANKS
456800200529     C           CLAT      ANDNE*BLANKS
456900200529     C                     ADD  1         EC
457000200529     C                     MOVEA' 235'    ERR,EC
457100200529     C                     SETON                     54
457200200529     C                     END
457300200529     C*
457400200529     C* Redemption Price - check valid number
457500200529     C*
457600200529     C           RAMT      IFNE *BLANKS
457700200529     C                     MOVE *BLANKS   ZFIELD
457800200529     C                     MOVE RAMT      ZFIELD
457900200529     C                     Z-ADD7         ZADIG
458000200529     C                     Z-ADD8         ZADEC
458100200529     C                     EXSR ZALIGN
458200200529     C           *IN99     IFEQ '1'
458300200529     C                     ADD  1         EC
458400200529     C                     MOVEA' 236'    ERR,EC
458500200529     C                     SETON                     67
458600200529     C                     END
458700200529     C                     END
458800200529     C*
458900200529     C                     END
459000200529     C*
459100200529     C* Conversions
459200200529     C*
459300200529     C           SSDET     IFEQ 'CV'
459400200529     C*
459500200529     C* Conversion security - must exist already if entered
459600200529     C*
459700200529     C           SSDCV     IFNE *BLANKS
459800200529     C           SSDCV     SETLLSECTYDF                  33
459900200529     C           *IN33     IFEQ '0'
460000200529     C                     ADD  1         EC
460100200529     C                     MOVEA' 237'    ERR,EC
460200200529     C                     SETON                     62
460300200529     C                     END
460400200529     C                     END
460500200529     C*
460600200529     C* Conversion Currency - check currency exists on table
460700200529     C*
460800200529     C           CONC      IFNE *BLANKS
460900200529     C***********          MOVE *BLANKS   KEY12A                          S01117
461000200529     C***********          MOVELCONC      WORK4                           S01117
461100200529     C***********          MOVE '1'       WORK4                           S01117
461200200529     C***********          MOVEL'20'      KEY12A                          S01117
461300200529     C***********          MOVE WORK4     KEY12A                          S01117
461400200529     C***********TABKA     CHAINTABTG10F             33                   S01117
461500200529     C                     CALL 'AOCURRR0'                                S01117
461600200529     C                     PARM *BLANKS   @RTCD   7                       S01117
461700200529     C                     PARM '*KEY   ' @OPTN   7                       S01117
461800200529     C                     PARM CONC      @AJCD   3                       S01117
461900200529     C           SDCURR    PARM SDCURR    DSSDY                           S01117
462000200529     C*                                                                   S01117
462100200529     C           @RTCD     IFNE *BLANKS                                   S01117
462200200529     C************IN33     IFEQ '1'                                       S01117
462300200529     C                     ADD  1         EC
462400200529     C                     MOVEA' 238'    ERR,EC
462500200529     C                     SETON                     63
462600200529     C***********          ELSE                                           S01117
462700200529     C***********RECI      IFEQ '*'                                       S01117
462800200529     C***********          ADD  1         EC                              S01117
462900200529     C***********          MOVEA' 238'    ERR,EC                          S01117
463000200529     C***********          SETON                     63                   S01117
463100200529     C***********          END                                            S01117
463200200529     C                     END
463300200529     C                     END
463400200529     C*
463500200529     C* Conversion Exchange rate - check valid number
463600200529     C*
463700200529     C           CONR      IFNE *BLANKS
463800200529     C                     MOVE *BLANKS   ZFIELD
463900200529     C                     MOVE CONR      ZFIELD
464000200529     C                     Z-ADD5         ZADIG
464100200529     C                     Z-ADD8         ZADEC
464200200529     C                     EXSR ZALIGN
464300200529     C           *IN99     IFEQ '1'
464400200529     C                     ADD  1         EC
464500200529     C                     MOVEA' 239'    ERR,EC
464600200529     C                     SETON                     66
464700200529     C                     END
464800200529     C                     END
464900200529     C*
465000200529     C* Conversion Price - check valid number
465100200529     C*
465200200529     C           CONP      IFNE *BLANKS
465300200529     C                     MOVE *BLANKS   ZFIELD
465400200529     C                     MOVE CONP      ZFIELD
465500200529     C                     Z-ADD7         ZADIG
465600200529     C                     Z-ADD8         ZADEC
465700200529     C                     EXSR ZALIGN
465800200529     C           *IN99     IFEQ '1'
465900200529     C                     ADD  1         EC
466000200529     C                     MOVEA' 240'    ERR,EC
466100200529     C                     SETON                     64
466200200529     C                     END
466300200529     C                     END
466400200529     C*
466500200529     C                     END
466600200529     C/COPY WNCPYSRC,SE0130C013
466700200529     C*
466800200529     C* Bonus Issues
466900200529     C*
467000200529     C           SSDET     IFEQ 'BI'
467100200529     C*
467200200529     C* Narrative - mandatory entry
467300200529     C*
467400200529     C           NAR4      IFEQ *BLANKS
467500200529     C                     ADD  1         EC
467600200529     C                     MOVEA' 241'    ERR,EC
467700200529     C                     SETON                     51
467800200529     C                     END
467900200529     C*
468000200529     C                     END
468100200529     C*
468200200529     C* Rights Issues
468300200529     C*
468400200529     C           SSDET     IFEQ 'RI'
468500200529     C*
468600200529     C* Narrative - mandatory entry
468700200529     C*
468800200529     C           NAR4      IFEQ *BLANKS
468900200529     C                     ADD  1         EC
469000200529     C                     MOVEA' 242'    ERR,EC
469100200529     C                     SETON                     51
469200200529     C                     END
469300200529     C*
469400200529     C                     END
469500200529     C*
469600200529     C* Capital Reorganisation
469700200529     C*
469800200529     C           SSDET     IFEQ 'CR'
469900200529     C*
470000200529     C* Narrative - mandatory entry
470100200529     C*
470200200529     C           NAR4      IFEQ *BLANKS
470300200529     C                     ADD  1         EC
470400200529     C                     MOVEA' 243'    ERR,EC
470500200529     C                     SETON                     51
470600200529     C                     END
470700200529     C*
470800200529     C                     END
470900200529     C*
471000200529     C* Other Changes
471100200529     C*
471200200529     C           SSDET     IFEQ 'OC'
471300200529     C*
471400200529     C* Narrative - mandatory entry
471500200529     C*
471600200529     C           NAR4      IFEQ *BLANKS
471700200529     C                     ADD  1         EC
471800200529     C                     MOVEA' 244'    ERR,EC
471900200529     C                     SETON                     51
472000200529     C                     END
472100200529     C*
472200200529     C                     END
472300200529     C*
472400200529     C                     ENDSR
472500200529      *
472600200529      *****************************************************************
472700200529      /EJECT
472800200529     C*                                                                   S01408
472900200529     C/COPY WNCPYSRC,SE0130CCP4                                           S01408
473000200529     C/COPY ZSRSRC,ZSDESCZ3                                               CSE016
473100200529     C*                                                                   S01408
473200200529      *****************************************************************   S01169
473300200529      **                                                              *   S01117
473400200529      ** *PSSR - SUBROUTINE TO HANDLE ABNORMAL ERROR CONDITIONS       *   S01117
473500200529      ** CALLED FROM: AFTER ABNORMAL OPERATION OCCURS                 *   S01117
473600200529      ** CALLS: NOTHING                                               *   S01117
473700200529      **                                                              *   S01117
473800200529     C*****************************************************************   S01117
473900200529     C*                                                                   S01117
474000200529     C           *PSSR     BEGSR                           ** *PSSR **    S01117
474100200529     C*                                                                   S01117
474200200529     C           @RUN      IFEQ *BLANKS                                   S01117
474300200529     C                     MOVE 'Y'       @RUN    1                       S01117
474400200529     C                     DUMP                                           S01117
474500200529     C                     END                                            S01117
474600200529     C                     ENDSR                           ** *PSSR **    S01117
474700200529     C*                                                                   S01117
474800200529     C********************************************************************S01117
474900200529      /EJECT
475000200529     C/COPY ZSRSRC,ZALIGNZ2
475100200529      /EJECT
475200200529     C/COPY ZSRSRC,ZDATE1Z2
475300200529      /EJECT
475400200529     C/COPY ZSRSRC,ZDATE2Z4
475500200529      /EJECT                                                              S01510
475600200529     C/COPY ZSRSRC,ZBKDT                                                  S01510
475700200529      /EJECT
475800200529     C*COPY*ZSRSRC,ZDATE6Z2********************************************   S01195
475900200529     C/COPY ZSRSRC,ZACCH                                                  S01195
476000200529     C/EJECT                                                              S01195
476100200529     C/COPY ZSRSRC,ZCHKH                                                  S01195
476200200529      /EJECT
476300200529     C/COPY ZSRSRC,ZEDITZ2
476400200529      /EJECT
476500200529     C*/COPY*ZSRSRC,ZICD2Z1***********************************************S01117
476600200529      *EJECT**                                                            S01117
476700200529     C*/COPY ZSRSRC,ZICDSEZ1**********************************************S01117
476800200529      *EJECT**                                                            S01117
476900200529     C*/COPY ZSRSRC,ZSYSTMZ1**********************************************S01117
477000200529      *EJECT**                                                            S01117
477100200529     C/COPY ZSRSRC,ZTNLU1Z2
477200200529     O/EJECT
477300200529     OSEDEVDF E                DLTREC
477400200529     O                         RECI
477500200529     O                         SDDT                                                           260331
477600200529     O                         LCD
477700200529     O                         CHTP
477800200529     O                         TNLU
477900200529     OSEDEVDF E                UPDTOT
478000200529     O                         SDTR
478100200529     O                         SDTA
478200200529     O                         SDTP
478300200529      /EJECT
478400200529      ***
478500200529**  CPY@
478600200529(c) Finastra International Limited 2001
478700200529**   INF  - File updated error message
478800200529RECORD UPDATED BY ANOTHER WORKSTATION
478900200529There is at least one live position settlement against this event
479000200529**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
4791002005290366073110961461
479200200529**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
479300200529000031059090120151181212243273304334365
479400200529**   ZMNM - MONTHS SHORT NAMES
479500200529JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
479600200529**   TABMTH/TABDAY     Month No/No of days in month
479700200529013102280331043005310630073108310930103111301231
