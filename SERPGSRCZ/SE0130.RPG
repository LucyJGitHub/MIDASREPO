     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Security diary events maintenance')
/*OVRF*: OVRDBF FILE(SEDEVX) TOFILE(SEDEV) SHARE(*NO)               : *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Securities Trading Module                            *
     F*                                                               *
     F*  SE0130  - SECURITY DIARY EVENT MAINTENANCE                   *
     F*                                                               *
     F*  Function: This program allows the maintenance and validation *
     F*   (I/C)    of Security Diary Events.                          *
     F*                                                               *
     F*  Called By: SEC02 - Input Cycle Processing                    *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. 260331             Date 31Mar16               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Prev Amend No. CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSE071             Date 19Jul05               *
      *                 CAS006             Date 21Jan03               *
      *                 208241             Date 21Aug02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CSE031             Date 09Nov01               *
      *                 196599             Date 24Aug01               *
      *                 182505             Date 13Sep00               *
      *                 179359             Date 15Jan02               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CSE016             Date 10Jan01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CAP140             Date 17Oct00               *
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CSE010             Date 21Jun99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 066635             Date 29Oct97               *
      *                 S01408             Date 22Nov96               *
     F*                 057220             DATE 19JUL96               *
     F*                 S01408             DATE 27JUN96               *
     F*                 073727             DATE 03MAY96               *
     F*                 S01408             DATE 29APR96               *
     F*                 084187             DATE 03MAR95               *
     F*                 S01509             DATE 10AUG94               *
     F*                 S01510             DATE 10AUG94               *
     F*                 052254             DATE 07JAN94               *
     F*                 054836             DATE 11AUG93               *
     F*                 S01401             DATE 16JUN93               *
     F*                 S01397             DATE 10SEP92               *
     F*                 E21824             DATE 22AUG91               *
     F*                 E23897             DATE 22AUG91               *
     F*                 E24879             DATE 22AUG91               *
     F*                 E25343             DATE 22AUG91               *
     F*                 S01220             DATE 07DEC90               *
     F*                 S01195             DATE 03DEC90               *
     F*                 S01117             DATE 29NOV90               *
     F*                 S01269             DATE 01AUG90               *
     F*                 E23591             DATE 14SEP90               *
     F*                 E23286             DATE 15AUG90               *
     F*                 E23259             DATE 09AUG90               *
     F*                 E22960             DATE 02AUG90               *
     F*                 E20651             DATE 10JAN90               *
     F*                 E20016             DATE 12DEC89               *
     F*                 E15930             DATE 09NOV89               *
     F*                 E20153             DATE 09NOV89               *
     F*                 E20085             DATE 09NOV89               *
     F*                 E19447             DATE 11OCT89               *
     F*                 E19763             DATE 10OCT89               *
     F*                 E19752             DATE 06OCT89               *
     F*                 E16772             DATE 07/08/89              *
     F*                 S01199             DATE 02/08/89              *
     F*                 E17436             DATE 17/05/89              *
     F*                 E15236             DATE 27/09/88              *
     F*                 E14856             DATE 23/08/88              *
     F*                 E14552             DATE 23/08/88              *
     F*                 E14498             DATE 23/08/88              *
     F*                 S01158             DATE 06/05/88              *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  260331 - Incorrect posting created due to a deleted diary    *
      *           event. Applied fix 255857.                          *
      *         - Applied for MD-37742.                               *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  208241 - Recompiled over changed /CPY ZSDESCZ3.              *
      *  CSE031 - Coupon Fixing for Floating Rate Notes               *
      *  196599 - Old rate is being used if event date does not match *
      *           with the security rate change date array.           *
      *         - Reverse revision to 182505. Event date entered must *
      *           matched with the security rate change date array.   *
      *           If it falls on holiday, default it in accordance    *
      *           with the business day convention.                   *
      *  182505 - DISPLAY THE ADJUSTED EVENT DATE IN ACCORDANCE WITH  *
      *           THE BUSINESS DAY CONVENTION ON INPUT AS THE EVENT   *
      *           AND ONLY ALLOW THIS DATE TO BE INSERTED.            *
      *         - Interest rate change that falls on holiday was not  *
      *           adjusted in accordance with CSE005 (Business Day    *
      *           Convention). Fix patterned after 116466.            *
      *  179359 - Not possible to insert dividend position settle-    *
      *           ments and dividend diary events for securities      *
      *           with processing type '7'.                           *
      *  CSE016 - Extended Security Descriptions                      *
      *  CAP140 - Conversion of SE Security Diary Events input into   *
      *           modular structure to use as APIs.                   *
      *  CSE010 - SE Transactions Enhancements                        *
     F*  066635 - When checking Event date for interest rate change,  *
     F*           if Rate change frequency has not been entered,      *
     F*           program should only check if the event date is      *
     F*           a rate change date in the array for the event year. *
     F*           It shouldn't start looking from issue date to       *
     F*           maturity date.                                      *
     F*  S01408 - Addition of core hook SE0130CP11                    *
     F*  057220 - Do not allow deletion of a security diary event if  *
     F*           there is a live position settlement for the event.  *
     F*  S01408 - Core hook SE0130CP10 added.                         *
     F*           Core hook SE0130CCP9 added.                         *
     F*           Core hook SE0130CCP8 added.                         *
     F*           Core hook SE0130CCP7 added.                         *
     F*           Core hook SE0130FFP1 added.                         *
     F*  073727 - DO NOT ALLOW INSERT OVER A MATURED SECURITY         *
     F*  S01408 - Addition of core hooks: SE0130IIP1
     F*                                   SE0130IIP2
     F*                                   SE0130CCP1
     F*                                   SE0130CCP2
     F*                                   SE0130CCP3
     F*                                   SE0130CCP4
     F*                                   SE0130CCP5
     F*                                   SE0130CCP6
     F*  084187 - Error 107 appears incorrectly when maturity date is *
     F*           this year.                                          *
     F*  S01509 - Value Currency to be currency of Issuer of Payments *
     F*  S01510 - Dividend Payments Based on Ex-Date                  *
     F*  052254 - CURRENT FACTOR amended from 9,8 to 10,9             *
     F*  054836 - You should not be able to backvalue the event date  *
     F*           more than the backvalue period, as specified on ICD.*
     F*  S01401 - MT5xx SWIFT Messages Feature:                       *
     F*          - Recompiled due to changes to files.                *
     F*  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
     F*          - Recompiled due to changes to files.                *
     F*  E21824 - Interest rate cannot be entered if for a date in    *
     F*           the the next century (rate change freq. not used)   *
     F*  E23897 - Diary Events must not be for date after maturity    *
     F*  E24879 - When comparing Event Date against each year         *
     F*           between Issue Date and Maturity Date the workfield  *
     F*           IDWORK should not be incremented by 366 (leap year  *
     F*           value) when that year is not a leap year. This can  *
     F*           cause error 107 to be issued incorrectly.           *
     F*  E25343 - Last fixed rate should be shown instead of next     *
     F*           rate on actions other than insert (done already)    *
     F*  S01220 - Amended for Strategic Risk Management Release 2     *
     F*           allowing the user to specify whether the            *
     F*           Redemption Call is to be included in the Risk       *
     F*           Analysis Cashflow.                                  *
     F*  S01195 - HOLIDAY AMENDMENT                                   *
     F*  S01117 - Multi-branching                                     *
     F*  S01269 - Trade authoristion: recompile over changed file     *
     F*           TABSE.                                              *
     F*  E23591 - FILE TRADSE ALSO TO INCLUDE RECI='A' RECORDS.(TRADES*   E23591
     F*           CHANGED OR AMENDED TODAY).                          *   E23591
     F*           HENCE RECOMPILED OVER TRADSE.                       *   E23591
     F*  E23286 - Further enhancement of error codes.                 *   E23286
     F*  E23259 - Amendment of Actioned Events must be prohibited     *   E23259
     F*           as SE2100 can only cope with deletions              *   E23259
     F*         - Allow Deletion and Enquiry of Actioned Items        *   E23259
     F*         - Part Payments should update future Diary items      *   E23259
     F*           and not Redemption Puts/Calls                       *   E23259
     F*         - REMOVED E20016 as Don't need 'C' recs               *   E23259
     F*  E22960 - Security shortname error codes improved.            *   E22960
     F*  E20651 - DB Error Numbers used in more than one place.       *   E20651
     F*           New Error Numbers as follows:                       *   E20651
     F*           DB ERROR 03 -> 04.                                  *   E20651
     F*           DB ERROR 03 -> 05.                                  *   E20651
     F*  E20016 - Use LF/SECED instead of SEDEV as SEDEV now ignores  *   E20016
     F*           records with RECI='C'                               *   E20016
     F*  E15930 - Partly Paids were not being processed correctly:    *   E15930
     F*          - Do not allow PP Events to be entered if Security   *   E15930
     F*            is Incomplete.                    B) IF NO PP      *   E15930
     F*          - If no PP Header record for the Security on the     *   E15930
     F*            Diary, then:                                       *   E15930
     F*            1) Use CPDP + CALAMT must not be > SFPP            *   E15930
     F*            2) Update SDTA = SDPP + CPDP AND                   *   E15930
     F*                      SDTP = SDPC + CPDP                       *   E15930
     F*  E20153 - Date checking for 'IR' changes on W/F Frequencies   *   E20153
     F*           is too strict. Part of it should be warning only.   *   E20153
     F*  E20085 - Interest and Coupon Calculations Rewrite:           *   E20085
     F*  E19447 - System allowed an Interest Rate Change of a rate    *   E19447
     F*           that falls below the minimum coupon from s/secty.   *   E19447
     F*  E19763 - Amending a PP Diary entry that was already in the   *   E19763
     F*           system, resulted in error code 206 when it was      *   E19763
     F*           just the narrative that was amended.                *   E19763
     F*  E19752 - Does not allow Rate change if Event Date equals     *   E19752
     F*           Run Date.                                           *   E19752
     F*  E16772 - The Dividend Payment Amount field SDDV has been     *   E16772
     F*           replaced by the field SDVA, to increase its size    *   E16772
     F*           from 9,4 to 13,8.                                   *   E16772
     F*  S01199 - HELP SYSTEM.                                        *   S01199
     F*  E17436 - DIARY TYPE RC AND RP - WHEN CALL OR PUT             *   E17436
     F*           PERCENTAGE =100, DISPLAYED AS 0. NO NARRATIVE       *   E17436
     F*           DISPLAYED FOR TYPE RC,RP OR XR.                     *   E17436
     F*  E15236 - Diary type MP - entry of current factor AND repay   *   E15236
     F*           amount should not be allowed.                       *   E15236
     F*  E14856 - Diary type MP should allow input of current factor  *   E14856
     F*           equal to current factor on security.                *   E14856
     F*  E14552 - If maturity date of security is in or after the     *   E14552
     F*           year 2000, event date validation fails as it is     *   E14552
     F*           using the last two characters of the alpha format   *   E14552
     F*           date field to perform a 'DOWLE' comparison.         *   E14552
     F*  E14498 - Wrong treatment of date format M causing initial    *   E14498
     F*           screen to reject valid event date.                  *   E14498
     F*  S01158 - POST INCORPORATION DEVELOPMENT FIX                  *
     F*                                                               *
     F*****************************************************************
      *
     FSE0130DFCF  E                    WORKSTN
     FINVTP   IF  E           K        DISK
     FSEDEVX  IF  E           K        DISK
     F            SEDEVDF                           KRENAMESEDEVDFX
     FSECEO   IF  E           K        DISK                               E20085
     F            SNDEVDF                           KIGNORE               E20085
     F            SEDEVDF                           KRENAMESEDEVDO        E20085
     FSECTY   IF  E           K        DISK
     F*                                                                   S01408
     F/COPY WNCPYSRC,SE0130FFP1                                           S01408
     F*                                                                   S01408
     FTRADSE  IF  E           K        DISK
     F*ABSE***IF**E           K        DISK                               S01117
     F************TABLETAF                          KIGNORE               S01117
     F************TABTE10F                          KIGNORE               S01117
     F************TABTE20F                          KIGNORE               S01117
     F************TABTG20F                          KIGNORE               S01117
     F************TABLETHF                          KIGNORE               S01117
     F************TABLETKF                          KIGNORE               S01117
     F************TABLETLF                          KIGNORE               S01117
     F************TABLETNF                          KIGNORE               S01117
     F************TABLETPF                          KIGNORE               S01117
     F************TABLETRF                          KIGNORE               S01117
     F************TABLETXF                          KIGNORE               S01117
     F************TABLET2F                          KIGNORE               S01117
     F************TABLET3F                          KIGNORE               S01117
     F************TABLET5F                          KIGNORE               S01117
     F************TABTB40F                          KIGNORE               S01117
     FSEDEV   UF  E           K        DISK         KCOMIT       A        E23259
     F*****SEDEV   UF  E           K        DISK         KCOMIT       A   E20016
     F*****SECED   UF  E           K        DISK         KCOMIT     E20016E23259
     F**********  SNDEVDF                           KIGNORE         E20016E23259
     F                                              KINFDS INFDS
     F                                              KINFSR INFSR
     FSEDEVA  UF  E                    DISK         KCOMIT
     FPOSET3  IF  E           K        DISK                               057220
     FMMODF   IF  E                    DISK                               S01220
     F/COPY WNCPYSRC,SE0130F001
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*   01  - F/3 pressed - End job                                 *
     F*   03  - Protect input capable fields in Delete/Enquiry modes  *
     F*   04  - F/10 - Delete record                                  *
     F*   05  - F/12 - Display Initial screen                         *
     F*   06  - HELP key pressed                                      *
     F*   08  - 'ROLLDOWN' key                                        *
     F*   09  - Display Error code list                               *
     F*   10  - Display 1st Narrrative field                          *
     F*   11  - Display Amount per Unit field                         *
     F*   12  - Display Call amount field for Partly paid             *
     F*   13  - Display Call percentage text and 2nd Narrative and    *
     F*         Redemption price fields                               *
     F*   14  - Display Call amount for Redemption Call and Call      *
     F*         percentage field                                      *
     F*   15  - Display Put amount and Put percentage fields for      *
     F*         Redemption Puts                                       *
     F*   16  - Display Security, Currency, Exchange rate and Price   *
     F*         fields for Conversions                                *
     F*   17  - Display 4th Narrative field                           *
     F*   18  - Display Payment date field                            *
     F*   19  - Display Current Factor and Repayment amount fields    *
     F*   20  - Display Next coupon rate field                        *
     F*   21  - Display Payment currency, Cut coupon exchange rate    *
     F*         and Multiply/Divide indicator fields                  *
     F*   22  - Display 3rd Narrative field                           *
     F*   23  - Risk Management Module is on                          *   S01220
     F*   24  - Transaction Type is a Redemption Call                 *   S01220
     F*   25  - S01509 is on                                          *   S01509
     F*   26  - Transaction Type is a 'DV' and S01510 is on           *   S01510
     F*   31  - Work indicator used in UPDFLS subroutine              *
     F*   32  - Work indicator 2 used in UPDFLS subroutine            *
     F*   33  - General work indicator                                *
     F*   34  - Seton if Event date matches a Rate Change date        *
     F*         for Interest Rate change                              *
     F*   40  - Error on Action code                                  *
     F*   41  - Error on Security shortname field                     *
     F*   42  - Error on Event date field                             *
     F*   43  - Error on Event type field                             *
     F*   44  - Seton if 'Delete' mode                                *
     F*   45  - Seton if 'Enquiry' mode                               *
     F*   49  - Error on Ex-Date                                      *   S01510
     F*   50  - Error on Amount per unit field                        *
     F*   51  - Error on any Narrative field                          *
     F*   52  - Error on Payment date field                           *
     F*   53  - Error on Call/Put amount field                        *
     F*   54  - Error on Call/Put percentage field                    *
     F*   55  - Error on Current factor field                         *
     F*   56  - Error on Repayment amount field                       *
     F*   57  - Error on Redemption currency                          *   S01509
     F*   58  - Error on Next Coupon rate field                       *
     F*   59  - Error on Payment currency field                       *
     F*   60  - Error on Cut coupon exchange rate field               *
     F*   61  - Error on Multiply/Divide indicator field              *
     F*   62  - Error on Conversion Security field                    *
     F*   63  - Error on Conversion currency field                    *
     F*   64  - Error on Conversion Price field                       *
     F*   65  - Error on Exchange Rate field                          *   S01509
     F*   66  - Error on Conversion exchange rate field               *
     F*   67  - Error on Redemption price field                       *
     F*   68  - HELP TAG CONDITIONING FOR EVENT TYPE BI               *   S01199
     F*   69  - HELP TAG CONDITIONING FOR EVENT TYPE RI               *   S01199
     F*   70  - HELP TAG CONDITIONING FOR EVENT TYPE CR               *   S01199
     F*   71  - HELP TAG CONDITIONING FOR EVENT TYPE OC               *   S01199
     F*   72  - HELP TAG CONDITIONING FOR EVENT TYPE RC               *   S01199
     F*   73  - HELP TAG CONDITIONING FOR EVENT TYPE RP               *   S01199
     F*   74  - HELP TAG CONDITIONING FOR EVENT TYPE PP               *   S01199
     F*   80  - CHANGE INDICATOR                                      *
     F*   88  - MBIN = Y                                              *   S01117
     F*   89  - Event found on SECEO.                                 *   E20085
     F*                                                               *
     F* 90-99 -  Used in standard sub-routines                        *
     F*                                                               *
     F*   U7  - Database error                                        *
     F*   U8  - Database / Control error                              *
      *   LR  - Last Record Indicator                                 *   CSE010
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*  INITL  - Process initial screen                              *
     F*  INFSR  - File exception/error handling                       *
     F*  INZDS  - Initialise/Clear multi-occurrence data structure    *
     F*  SECOND - Process second screen                               *
     F*  TRSEDE - Translate screen fields to file format              *
     F*  UPDFLS - Update files                                        *
     F*  VLDITL - Validate entries on initial screen                  *
     F*  VLDSEC - Validate entries on second screen                   *
     F*                                                               *
     F*  ZALIGN - Validate and right-align numeric fields             *
     F*  ZDATE1 - DATE - DAYNO conversion                             *
     F*  ZDATE2 - DAYNO - DATE conversion                             *
     F***ZDATE5*-*Determine*if*holiday*in*given*currency***************   S01195
     F*  ZBKDT  - Calculate the nth working day back from a given     *   S01510
     F*           start date for a currency and (optional) location   *   S01510
     F*  ZCHKH  - Determine if holiday in given Currency              *   S01195
     F*  ZEDIT  - Insert a decimal point into a numeric field and blan*
     F*           out leading zeros                                   *
     F***ZICD2**-*Access*ICD*record*2**********************************   S01117
     F***ZICDSE*-*Access*ICD*record*for*Securities*Trading*************   S01117
     F*  ZSEDIT - Insert a decimal point and sign into a numeric field*
     F*           and blank out leading zeros                         *
     F***ZSYSTM*-*GET*INSTALLATION*CONTROL*RECORD*(TABTB10)************   S01117
     F*  ZTNLU1 - Fetch next available transaction number             *
     F*                                                               *
     F*****************************************************************
      /EJECT
     E                    CPY@    1   1 80
     E                    ERR        19  4
     E********************INF     1   1 76                                057220
     E                    INF     1   2 76                                057220
     E/COPY ZSRSRC,ZDATE2Z1
     E*COPY*ZSRSRC,ZDATE6Z1                                               S01195
     E/COPY ZSRSRC,ZHOLE                                                  S01195
     E** SR.ARRAY FOR BOTH ZACCH AND ZCHKH                                S01195
     E*                                                                   S01195
     E/COPY ZSRSRC,ZALIGNZ1
     E                    CD         12  4 0
     E                    CR         12  1
     E                    DAT        12  6 0
     E                    TABMTH 12  12  2 0 TABDAY  2 0
     E/COPY WNCPYSRC,SE0130E001
     E/COPY ZSRSRC,ZSDESCZ1                                               CSE016
      /EJECT
     ISEDEVDO                                                             E20085
      ***  Rename of fields for Security Diary (by Reverse Date).         E20085
     I              RECI                            SORECI                E20085
     I              SDSN                            SOSDSN                E20085
     I              SDED                            SOSDED                E20085
     I              SDET                            SOSDET                E20085
     I              SDNV                            SOSDNV                E20085
     I              SDVA                            SOSDVA                E20085
     I              SDCP                            SOSDCP                E20085
     I              SRPT                            SOSRPT                E20085
     I              SDTR                            SOSDTR                E20085
     I              SRMI                            SOSRMI                E20085
     I              SDPD                            SOSDPD                E20085
     I              SDNC                            SOSDNC                E20085
     I              SDPP                            SOSDPP                E20085
     I              SDPC                            SOSDPC                E20085
     I              SDTA                            SOSDTA                E20085
     I              SDTP                            SOSDTP                E20085
     I              SDRP                            SOSDRP                E20085
     I              SDCV                            SOSDCV                E20085
     I              SDCX                            SOSDCX                E20085
     I              SDCE                            SOSDCE                E20085
     I              SDMD                            SOSDMD                E20085
     I              NMCY                            SONMCY                E20085
     I              SDAD                            SOSDAD                E20085
     I              SDDT                            SOSDDT                E20085
     I              RCIC                            SORCIC                S01220
      *                                                                   CAP140
      ** Rename API fields to avoid copying other file's API              CAP140
      ** fields.                                                          CAP140
     ISEDEVDF                                                             CAP140
     I              FRNT                            WFRNT                 CAP140
     I              REPA                            WREPA                 CAP140
      *                                                                   CAP140
     I/COPY WNCPYSRC,SE0130I003
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     IDS01      E DSSEDEVX                    2
     I*
     I* DATA STRUCTURE FOR RPG 01021 ERROR HANDLING
     I*
     IINFDS       DS
     I                                     *STATUS  STATUS
     I*LDA*******UDS                            256                       S01117
     I***********                           134 177 DBLOT                 S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 177 DBASE                 S01117
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS                       S01117
     ILDA         DS                            256                       S01117
     I                                      134 183 DBLOT                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     I/COPY ZSRSRC,ZTNLU1Z1
     I*                                                                   S01195
     I/COPY ZSRSRC,ZHOLI                                                  S01195
      **  EXTERNAL DS FOR HOLIDAY DETAILS                                 S01195
     I*                                                                   S01195
     I/COPY ZSRSRC,ZHOLDS                                                 S01195
      **  EXTERNAL DS FOR HOLIDAY DETAILS AND ACCESS OBJECTS              S01195
     ICMTTXT      DS
     I                                        1   50NATN
     I                                        6   7 MDID
     I                                        8  15 PGMN
     I                                       16  18 WSIDX
     I                                       19  240MTIME
     I                                       25  25 ACTNX
     I                                       26  35 USIDX
     I                                       51 306 DET
     I           SDS
     I*                                                                   S01408
     I/COPY WNCPYSRC,SE0130IIP1                                           S01408
     I*                                                                   S01408
     I                                      244 246 WSID
     I                                      254 263 USID
     I            DS
     I                                        1  76 ERR
     I                                        1  76 ERRMSG
     I            DS
     I                                        1  75 HCCY
     I                                        1  75 XCCY
     I            DS
     I                                        1  480CD
     I                                        1   40CD01
     I                                        5   80CD02
     I                                        9  120CD03
     I                                       13  160CD04
     I                                       17  200CD05
     I                                       21  240CD06
     I                                       25  280CD07
     I                                       29  320CD08
     I                                       33  360CD09
     I                                       37  400CD10
     I                                       41  440CD11
     I                                       45  480CD12
     I/COPY WNCPYSRC,SE0130I001
     I            DS
     I/COPY WNCPYSRC,SE0130I002
     I                                        1  12 CR
     I                                        1   1 CR01
     I                                        2   2 CR02
     I                                        3   3 CR03
     I                                        4   4 CR04
     I                                        5   5 CR05
     I                                        6   6 CR06
     I                                        7   7 CR07
     I                                        8   8 CR08
     I                                        9   9 CR09
     I                                       10  10 CR10
     I                                       11  11 CR11
     I                                       12  12 CR12
     I*
     IRUNDT       DS                                                      S01117
     I*                                                                   S01117
     I** DATA AREA RUNDAT                                                 S01117
     I*                                                                   S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
     I*                                                                   S01117
     IZMUSER      DS                             17                       S01117
     I*                                                                   S01117
     I** DATA AREA OF MENU USER                                           S01117
     I*                                                                   S01117
     I                                       11  13 USRBCH                S01117
     I*                                                                   S01117
     ISDCURR    E DSSDCURRPD                                              S01117
     I*                                                                   S01117
     I** Currency Details                                                 S01117
     I*                                                                   S01117
     ISDSTRD    E DSSDSTRDPD                                              S01117
     I*                                                                   S01117
     I** SECURITIES TRADING DATA                                          S01117
     I*                                                                   S01117
     IDSFDY     E DSDSFDY                                                 S01117
     I*                                                                   S01117
     I** FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE               S01117
     I*                                                                   S01408
     I/COPY WNCPYSRC,SE0130IIP2                                           S01408
     I*                                                                   S01408
     I/COPY ZSRSRC,ZSDESCZ2                                               CSE016
     I*                                                                   S01117
     C/EJECT
      *================================================================
      *  P R O G R A M   S T A R T                                    *
      *================================================================
     C*
     C           *IN09     IFEQ '0'
     C*
     C** Assemble key to access Diary Event record
     C*
     C           DEVKA     KLIST
     C                     KFLD           SSDSN
     C                     KFLD           EVTDNO
     C                     KFLD           SSDET
      *                                                                   E20085
      ***  Key for SECEO in 'Security/Event Type/Reverse Date' order.     E20085
      *                                                                   E20085
     C           KSEDO     KLIST                                          E20085
     C                     KFLD           SSDSN                           E20085
     C                     KFLD           SSDET                           E20085
     C                     KFLD           EVTDNO                          E20085
     C*
     C* Key to access Investment Type record
     C*
     C           ITPKA     KLIST
     C                     KFLD           NMCY
     C                     KFLD           SITP
     C*
     C**Key*to*access*Table*records***************************************S01117
     C*
     C***********TABKA     KLIST                                          S01117
     C***********          KFLD           KEY12A 12                       S01117
     C/COPY WNCPYSRC,SE0130C001
     C*
     C* Prepare LDA
     C*
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE *BLANKS   DBLOT
     C                     MOVE 'SE0130  'DBPGM
     C                     OUT  LDA                                       S01117
     C*
     C* Prepare COMIT text
     C*
     C                     MOVEL'SE'      MDID
     C                     MOVEL'SE0130'  PGMN
     C                     MOVELWSID      WSIDX
     C                     MOVELUSID      USIDX
     C*                                                                   S01220
     C** Access MMODF to determine if Strategic Risk Man. Ind is on       S01220
     C*                                                                   S01220
     C                     READ MMODF                    33               S01220
     C*                                                                   S01220
     C           RMFL      IFEQ 'Y'                                       S01220
     C                     SETON                     23                   S01220
     C                     END                                            S01220
     C*                                                                   S01220
     C*
     C**Get*Installation*Control*Data*record*1****************************S01117
     C***********                                                         S01117
     C***********          EXSR ZSYSTM                                    S01117
     C***********                                                         S01117
     C**If*error*in*ZSYSTM,*abend*program*********************************S01117
     C***********                                                         S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          MOVE '01'      DBASE                           S01117
     C***********          MOVEL'TABLE'   DBFILE                          S01117
     C***********          MOVELZTABKY    DBKEY                           S01117
     C***********          SETON                     U7U801               S01117
     C***********          END                                            S01117
     C***********                                                         S01117
     C**Get*Installation*Control*Data*record*2*                           S01117
     C***********                                                         S01117
     C***********          EXSR ZICD2                                     S01117
     C***********                                                         S01117
     C**If*error*in*ZICD2,*abend*program*                                 S01117
     C***********                                                         S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          MOVE '02'      DBASE                           S01117
     C***********          MOVEL'TABLE'   DBFILE                          S01117
     C***********          MOVELZTABKY    DBKEY                           S01117
     C***********          SETON                     U7U801               S01117
     C***********          END                                            S01117
     C*                                                                   S01117
     C** IN THE DATAAREA RUNDAT                                           S01117
     C*                                                                   S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C                     IN   RUNDT                                     S01117
     C*                                                                   S01117
     C**   CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.                    S01117
     C*                                                                   S01117
     C           DATF      COMP 'M'                      98               S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     SETON                         88               S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** IN THE DATAAREA ZMUSER                                           S01117
     C*                                                                   S01117
     C           *NAMVAR   DEFN           ZMUSER                          S01117
     C                     IN   ZMUSER                                    S01117
     C*                                                                   S01117
     C*
     C**Get*Installation*Control*Data record*for*Securities*Trading*******S01117
     C* Get Securities Trading Data by access object                      S01117
     C*
     C***********          EXSR ZICDSE                                    S01117
     C                     CALL 'AOSTRDR0'                                S01117
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C           SDSTRD    PARM SDSTRD    DSSDY                           S01117
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0130CCP1                                           S01408
     C*                                                                   S01408
     C*
     C**If*error*in*ZICDSE,*abend*program******************************   S01117
     C*
     C************IN99     IFEQ '1'                                       S01117
     C***********          MOVE '03'      DBASE                           E20651
     C***********          MOVE '04'      DBASE                    E20651 S01117
     C***********          MOVEL'TABLE'   DBFILE                          S01117
     C***********          MOVELZTABKY    DBKEY                           S01117
     C***********          SETON                     U7U801               S01117
     C***********          END                                            S01117
     C*
     C**  Access SAR details file to see if S01509 is installed           S01509
      *                                                                   S01509
     C                     CALL 'AOSARDR0'                                S01509
     C                     PARM '       ' @RTCD                           S01509
     C                     PARM '*VERIFY' @OPTN                           S01509
     C                     PARM 'S01509'  @SARD   6                       S01509
      *                                                                   S01509
     C           @RTCD     IFEQ *BLANK                                    S01509
     C                     MOVE 'Y'       S01509  1                       S01509
     C                     MOVE '1'       *IN25                           S01509
     C                     ELSE                                           S01509
     C                     MOVE 'N'       S01509                          S01509
     C                     END                                            S01509
     C/COPY WNCPYSRC,SE0130C019
      *                                                                   CSE010
      ** Check if CSE010 (Transaction Enhancements) is active             CSE010
      *                                                                   CSE010
     C                     CALL 'AOSARDR0'                                CSE010
     C                     PARM '       ' @RTCD                           CSE010
     C                     PARM '*VERIFY' @OPTN                           CSE010
     C                     PARM 'CSE010'  @SARD   6                       CSE010
      *                                                                   CSE010
     C           @RTCD     IFEQ *BLANK                                    CSE010
     C                     MOVE 'Y'       CSE010  1                       CSE010
     C                     ELSE                                           CSE010
     C                     MOVE 'N'       CSE010                          CSE010
      *                                                                   CSE010
      ** Database Error (return code other than *NRF)                     CSE010
      *                                                                   CSE010
     C           @RTCD     IFNE '*NRF   '                                 CSE010
     C           *LOCK     IN   LDA                                       CSE010
     C                     MOVEL'SCSARDPD'DBFILE           ***************CSE010
     C                     MOVEL'CSE010'  DBKEY            * DB ERROR 06 *CSE010
     C                     Z-ADD6         DBASE            ***************CSE010
     C                     OUT  LDA                                       CSE010
     C                     MOVE *ON       *INU7                           CSE010
     C                     MOVE *ON       *INU8                           CSE010
     C                     MOVE *ON       *INLR                           CSE010
     C                     EXSR *PSSR                                     CSE010
     C                     ENDIF                                          CSE010
     C                     ENDIF                                          CSE010
      *                                                                   S01510
     C**  Access SAR details file to see if S01510 is installed           S01510
      *                                                                   S01510
     C                     CALL 'AOSARDR0'                                S01510
     C                     PARM '       ' @RTCD                           S01510
     C                     PARM '*VERIFY' @OPTN                           S01510
     C                     PARM 'S01510'  @SARD                           S01510
      *                                                                   S01510
     C           @RTCD     IFEQ *BLANK                                    S01510
     C                     MOVE 'Y'       S01510  1                       S01510
     C                     ELSE                                           S01510
     C                     MOVE 'N'       S01510                          S01510
     C                     END                                            S01510
      *                                                                   S01510
      **  Access SAR details file to see if CSE031 is installed           CSE031
      *                                                                   CSE031
     C                     CALL 'AOSARDR0'                                CSE031
     C                     PARM '       ' @RTCD                           CSE031
     C                     PARM '*VERIFY' @OPTN                           CSE031
     C                     PARM 'CSE031'  @SARD                           CSE031
      *                                                                   CSE031
     C           @RTCD     IFEQ *BLANK                                    CSE031
     C                     MOVE 'Y'       CSE031  1                       CSE031
     C                     ELSE                                           CSE031
     C                     MOVE 'N'       CSE031                          CSE031
     C                     ENDIF                                          CSE031
      *                                                                                       260331
      **  Access SAR details file to see if S01512 is installed                               260331
      *                                                                                       260331
     C                     CALL 'AOSARDR0'                                                    260331
     C                     PARM '       ' @RTCD                                               260331
     C                     PARM '*VERIFY' @OPTN                                               260331
     C                     PARM 'S01512'  @SARD                                               260331
      *                                                                                       260331
     C           @RTCD     IFEQ *BLANK                                                        260331
     C                     MOVE 'Y'       S01512  1                                           260331
     C                     ELSE                                                               260331
     C                     MOVE 'N'       S01512                                              260331
     C                     ENDIF                                                              260331
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0130CCP7                                           S01408
     C*                                                                   S01408
     C* Define work fields
     C*
     C           *LIKE     DEFN EC        WEC
     C           *LIKE     DEFN ZDAYNO    HDAYNO
     C           *LIKE     DEFN ZDAYNO    PDAYNO
     C           *LIKE     DEFN ZDAYNO    EVTDNO
     C           *LIKE     DEFN ZDAYNO    #CPD                            182505
     C           *LIKE     DEFN SSDED     SSDED1                          182505
     C           *LIKE     DEFN SDPP      CALAMT
     C           *LIKE     DEFN SDTA      TOTAM
     C           *LIKE     DEFN SDPC      CALPC
     C           *LIKE     DEFN SRPT      OLSRPT
     C           *LIKE     DEFN SRPT      NWSRPT
     C           *LIKE     DEFN SDTR      SVSDTR
     C           *LIKE     DEFN SDTA      SVSDTA
     C           *LIKE     DEFN SDTP      SVSDTP
     C           *LIKE     DEFN SRMI      SVSRMI
     C           *LIKE     DEFN SDPP      OLSDPP
     C           *LIKE     DEFN SDPP      NWSDPP
     C           *LIKE     DEFN SDPC      OLSDPC
     C           *LIKE     DEFN SDPC      NWSDPC
     C           *LIKE     DEFN ISSA      AMTOS
     C           *LIKE     DEFN SDTR      TOTR
     C           *LIKE     DEFN SDTR      RES1
     C           *LIKE     DEFN SRPT      SCSRPT
     C           *LIKE     DEFN ZDAY      EDAY
     C           *LIKE     DEFN ZDAY      EOMDAY
     C           *LIKE     DEFN ZMTH      EMTH
     C           *LIKE     DEFN ZYEAR     EYEAR
     C           *LIKE     DEFN SDPP      OLDSPP                          E19763
     C           *LIKE     DEFN SDPC      OLDSPC                          E19763
     C           *LIKE     DEFN SDTA      ORIDTA                          E15930
     C           *LIKE     DEFN SDTP      ORIDTP                          E15930
     C           *LIKE     DEFN RUND      WBKVP                           054836
     C           *LIKE     DEFN SDCP      WK18                            052254
     C*
     C                     END
     C*
     C* Display and process screens until F3 pressed
     C*
     C           *IN01     DOWEQ'0'
     C           *INU8     ANDEQ'0'
     C*
     C* Clear/Initialise multi-occurrence data structures
     C*
     C           2         OCUR DS01
     C                     EXSR INZDS
     C*
     C           1         OCUR DS01
     C                     EXSR INZDS
     C*
     C* Initialise day no fields
     C*
     C                     Z-ADD*ZEROS    HDAYNO
     C                     Z-ADD*ZEROS    PDAYNO
     C                     Z-ADD*ZEROS    EVTDNO
     C*
     C* F12- Initial screen (blank) requested
     C*
     C           *IN05     IFEQ '1'
     C*
     C* Setof error indicators and clear error codes
     C*
     C                     SETOF                     09
     C                     MOVE *BLANKS   ERRMSG
     C                     Z-ADD*ZEROS    EC
     C                     END
     C*
     C                     Z-ADD*ZEROS    STNLU   50
     C  N09                SETOF                     0305
     C*
     C* Display initial screen
     C*
     C  N09                EXSR INITL
     C   09                WRITESE0130F1
     C*
     C* Display second screen (Not if F3 or F12 pressed)
     C*
     C           *IN01     IFEQ '0'
     C           *IN05     ANDEQ'0'
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0130CCP2                                           S01408
     C*                                                                   S01408
     C                     EXSR SECOND
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0130CCP3                                           S01408
     C*                                                                   S01408
     C*
     C* Update files (Not if F3 or F12 pressed)
     C*
     C           *IN01     IFEQ '0'
     C           *IN05     ANDEQ'0'
     C           ACTC      ANDNE'E'
     C                     EXSR UPDFLS
     C                     END
     C*
     C                     END
      *
      *================================================================
      *  P R O G R A M   E N D                                        *
      *                                                               *
     C                     SETON                     LR
     C                     RETRN
      *                                                               *
      *================================================================
      /EJECT
      *****************************************************************
      *                                                               *
      *  INITL  - Subroutine to process Initial Screen.               *
      *                                                               *
      *****************************************************************
      *
     C           INITL     BEGSR                           *** INITL  ***
     C*
     C                     MOVE 'Y'       FIRST   1
     C*
     C* Display initial screen (blank)
     C*
     C           *IN09     IFEQ '0'
     C           *IN08     ANDEQ'0'
     C                     MOVEA'000000'  *IN,40
     C                     MOVE ' '       ACTC
     C                     MOVE *BLANKS   SSDSN
     C                     MOVE *BLANKS   SSDED
     C                     MOVE *BLANKS   SSDED1                          182505
     C                     MOVE '  '      SSDET
     C                     MOVE *BLANKS   SRNME                           CSE016
     C                     END
     C*
     C* Display initial screen
     C*
     C           ZITAG1    TAG                             *** ZITAG1 ***
     C                     EXFMTSE0130F1
     C*
     C* F3 or F12 - Return to main processing
     C*
     C   01
     COR 05                GOTO ZINEND
     C*
     C**HELP*key*pressed*-*call*standard*HELP*program******************   S01199
     C***********                                                         S01199
     C********** *IN06     IFEQ '1'                                       S01199
     C**********           CALL 'MHELP'                                   S01199
     C**********           PARM           DBPGM                           S01199
     C**********           PARM           ERRMSG                          S01199
     C**********                                                          S01199
     C**********           GOTO ZITAG1                                    S01199
     C**********           END                                            S01199
     C*
     C*
     C**  If not first time through, or no screen changes, any errors
     C**  will be WARNING ERRORS -therefore no need to validate.
     C*
     C           FIRST     IFEQ 'N'
     C           WEC       ANDEQEC
     C           *IN80     ANDEQ'0'
     C                     Z-ADD0         EC
     C                     SETOF                     0942
     C                     GOTO UPD1
     C                     END
      *
     C* Validate Initial entries
     C*
     C                     EXSR VLDITL
      *
     C                     MOVE 'N'       FIRST
     C*
     C* If errors, re-display screen
     C*
     C           EC        CABGT*ZEROS    ZITAG1     09
     C*
     C           UPD1      TAG                             ***  UPD1  ***
     C*
     C* Protect fields if Delete or Enquiry mode
     C*
     C           ACTC      IFEQ 'D'
     C           ACTC      OREQ 'E'
     C                     SETON                     03
     C                     END
     C*
     C* Allow F10 to confirm Deletion in delete mode
     C*
     C           ACTC      IFEQ 'D'
     C                     SETON                     44
     C                     END
     C*
     C* Allow ROLLDOWN key in Enquiry mode
     C*
     C           ACTC      IFEQ 'E'
     C                     SETON                     45
     C                     END
     C*
     C           ZINEND    ENDSR                           *** ZINEND ***
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  INFSR  - FILE EXCEPTION/ERROR HANDLING SUBROUTINE            *
      *                                                               *
      *****************************************************************
      *
     C           INFSR     BEGSR                           *** INFSR  ***
     C*
     C**   CHECK ERROR TYPE
     C*
     C           STATUS    IFEQ 01021
     C*
     C**   CHAIN TO FILE TO GET CURRENT DETAILS
     C*
     C           DEVKA     CHAINSEDEVDF              99
     C*
     C           *IN99     IFEQ '0'
     C*
     C**   ROLL BACK UPDATES ALREADY DONE
     C*
     C                     ROLBK
     C*
     C**   RECORD ALREADY EXISTS
     C*
     C           RECI      IFEQ 'D'
     C                     MOVEL'A'       ACTC
     C                     ELSE
     C                     MOVEL'E'       ACTC
     C                     SETON                     4503
     C                     END
     C**
     C                     MOVEL'*DETC'   EXTTAG  6
     C**
     C                     ELSE
     C**
     C                     MOVE '*CANCL'  EXTTAG
     C                     END
     C**
     C                     ELSE
     C**
     C                     MOVE '*CANCL'  EXTTAG
     C                     END
     C**
     C                     ENDSREXTTAG
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  INZDS  - Subroutine to initialise numeric fields in mult-    *
      *           occurrence Data Structure.                          *
      *                                                               *
      *****************************************************************
      *
     C           INZDS     BEGSR                           *** INZDS  ***
     C*
     C                     MOVE *BLANK    RECI
     C                     MOVE *BLANKS   SDSN
     C                     Z-ADD*ZEROS    SDED
     C                     MOVE *BLANK    SDET
     C                     MOVE *BLANKS   SDNV
     C*********************Z-ADD*ZEROS    SDDV                            E16772
     C                     Z-ADD*ZEROS    SDVA                            E16772
     C                     Z-ADD*ZEROS    SDCP
     C                     Z-ADD*ZEROS    SRPT
     C                     Z-ADD*ZEROS    SDTR
     C                     MOVE *BLANK    SRMI
     C                     Z-ADD*ZEROS    SDPD
     C                     Z-ADD*ZEROS    SDNC
     C                     Z-ADD*ZEROS    SDPP
     C                     Z-ADD*ZEROS    SDPC
     C                     Z-ADD*ZEROS    SDTA
     C                     Z-ADD*ZEROS    SDTP
     C                     Z-ADD*ZEROS    SDRP
     C                     MOVE *BLANKS   SDCV
     C                     MOVE *BLANKS   SDCX
     C                     Z-ADD*ZEROS    SDCE
     C                     MOVE *BLANK    SDMD
     C                     Z-ADD*ZEROS    SDAD
     C                     Z-ADD*ZEROS    SDDT
     C                     Z-ADD*ZEROS    LCD
     C                     MOVE *BLANK    CHTP
     C                     Z-ADD*ZEROS    TNLU
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SECOND - Subroutine to process the Second Screen.            *
      *                                                               *
      *****************************************************************
      *
     C           SECOND    BEGSR                           *** SECOND ***
     C*
     C           *IN09     IFEQ '0'
     C*
     C* Setof error indicators
     C*
     C                     MOVEA'00000000'*IN,50
     C                     MOVEA'00000000'*IN,58
     C                     MOVEA'00'      *IN,66
     C*
     C* Setup display fields
     C*
     C                     MOVEA'00000000'*IN,10
     C                     MOVEA'00000'   *IN,18
     C                     SETOF                     24                   S01220
     C                     MOVE '0'       *IN26                           S01510
     C/COPY WNCPYSRC,SE0130C002
     C*
     C***  HELP PROCESSING TO CONDITION HELP DOCUMENT                     S01199
     C*                                                                   S01199
     C           SSDET     COMP 'BI'                     68               S01199
     C           SSDET     COMP 'RI'                     69               S01199
     C           SSDET     COMP 'CR'                     70               S01199
     C           SSDET     COMP 'OC'                     71               S01199
     C           SSDET     COMP 'RC'                     72               S01199
     C           SSDET     COMP 'RP'                     73               S01199
     C           SSDET     COMP 'PP'                     74               S01199
     C*                                                                   S01199
     C* Dividends Declared
     C*
     C           SSDET     IFEQ 'DV'
     C/COPY WNCPYSRC,SE0130C031
     C           ACTC      IFEQ 'I'
     C                     MOVE *BLANKS   SSDDV
     C                     MOVE *BLANKS   NAR1
     C                     MOVE *BLANKS   SSDPD
     C*
     C           S01510    IFEQ 'Y'                                       S01510
      *                                                                   S01510
     C                     MOVE '1'       *IN26                           S01510
      * Calculate default Ex-date                                         S01510
     C                     MOVELEDFT      ZNRDYS                          S01510
     C           ZNRDYS    IFNE *ZEROS                                    S01510
     C                     MOVE EDFT      WEDFT   1                       S01510
     C           WEDFT     IFEQ 'W'                                       S01510
     C                     Z-ADDEVTDNO    ZDAYNO                          S01510
     C                     MOVE VLCY      ZCCY                            S01510
     C                     MOVE *BLANKS   ZLOC                            S01510
     C                     EXSR ZBKDT                                     S01510
     C                     Z-ADDZDYNBR    ZDAYNO                          S01510
     C                     ELSE                                           S01510
     C           EVTDNO    SUB  ZNRDYS    ZDAYNO                          S01510
     C                     END                                            S01510
     C                     EXSR ZDATE2                                    S01510
     C                     MOVE ZDATE     SSDXD                           S01510
     C                     ELSE                                           S01510
     C                     MOVE SSDED     SSDXD                           S01510
     C                     END                                            S01510
      *                                                                   S01510
     C                     END                                            S01510
     C                     ELSE
     C*
     C***********SDDV      IFNE *ZEROS                                    E16772
     C           SDVA      IFNE *ZEROS                                    E16772
     C                     MOVE *BLANKS   ZFIELD
     C***********          MOVE SDDV      ZFIELD                          E16772
     C***********          Z-ADD4         ZADEC                           E16772
     C                     MOVE SDVA      ZFIELD                          E16772
     C                     Z-ADD8         ZADEC                           E16772
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SSDDV
     C                     ELSE
     C                     MOVE *BLANKS   SSDDV
     C                     END
     C*
     C           SDPD      IFNE *ZEROS
     C                     Z-ADDSDPD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SSDPD
     C                     ELSE
     C                     MOVE *BLANKS   SSDPD
     C                     END
     C*                                                                   S01510
     C           S01510    IFEQ 'Y'                                       S01510
     C                     MOVE '1'       *IN26                           S01510
     C           SDXD      IFNE *ZEROS                                    S01510
     C                     Z-ADDSDXD      ZDAYNO                          S01510
     C                     EXSR ZDATE2                                    S01510
     C                     MOVE ZDATE     SSDXD                           S01510
     C                     ELSE                                           S01510
     C                     MOVE *BLANKS   SSDXD                           S01510
     C                     END                                            S01510
     C                     END                                            S01510
     C*
     C                     MOVE SDNV      NAR1
     C                     END
     C*
     C                     SETON                     101118
     C                     END
     C*
     C* Partly Paids
     C*
     C           SSDET     IFEQ 'PP'
     C*
     C* Determine if Share to decide output
     C*
     C           ITPKA     CHAININVTPDF              33
     C           PROT      IFEQ '4'
     C                     SETON                     12
     C                     ELSE
     C                     SETON                     1314
     C                     END
     C*
     C           ACTC      IFEQ 'I'
     C   12                MOVE *BLANKS   CAMT
     C   13 14             MOVE *BLANKS   CPRI
     C                     MOVE *BLANKS   NAR1
     C                     ELSE
     C*
     C           *IN12     IFEQ '1'
     C           SDPP      IFNE *ZEROS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SDPP      ZFIELD
     C*
     C* Use nominal decimal places
     C*
     C***********          MOVE *BLANKS   KEY12A                          S01117
     C***********          MOVELNMCY      WORK4                           S01117
     C***********          MOVE '1'       WORK4                           S01117
     C***********          MOVEL'20'      KEY12A                          S01117
     C***********          MOVE WORK4     KEY12A                          S01117
     C***********TABKA     CHAINTABTG10F             33                   S01117
     C                     MOVE NMCY      @AJCD   3                       S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM           @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C***********          Z-ADDCDP       ZADEC                           S01117
     C                     Z-ADDA6NBDP    ZADEC                           S01117
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    CAMT
     C                     ELSE
     C                     MOVE *BLANKS   CAMT
     C                     END
     C                     END
     C*
     C           *IN13     IFEQ '1'
     C           *IN14     ANDEQ'1'
     C           SDPC      IFNE *ZEROS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SDPC      ZFIELD
     C                     Z-ADD3         ZADEC
     C                     EXSR ZEDIT
     C           SDPC      IFEQ 100                                       E17436
     C                     MOVE ZFIELD    WCPRI   7                       E17436
     C                     MOVELWCPRI     CPRI                            E17436
     C                     ELSE                                           E17436
     C                     MOVE ZFIELD    CPRI
     C                     END                                            E17436
     C                     ELSE
     C                     MOVE *BLANKS   CPRI
     C                     END
     C                     END
     C*
     C                     MOVE SDNV      NAR1
     C                     END
     C*
     C                     SETON                     10
     C                     END
     C*
     C* Mortgage Payments
     C*
     C           SSDET     IFEQ 'MP'
     C           ACTC      IFEQ 'I'
     C                     MOVE *BLANKS   SSDCP
     C                     MOVE *BLANKS   SSRPT
     C                     MOVE *BLANKS   SSDPD
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0130CCP8                                           S01408
     C*                                                                   S01408
     C                     MOVE *BLANKS   NAR2
     C                     ELSE
     C*
     C           SDCP      IFNE *ZEROS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SDCP      ZFIELD
     C**********           Z-ADD8         ZADEC                           052254
     C                     Z-ADD9         ZADEC                           052254
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SSDCP
     C                     ELSE
     C                     MOVE *BLANKS   SSDCP
     C                     END
     C*
     C           SRPT      IFNE *ZEROS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SRPT      ZFIELD
     C                     Z-ADD0         ZADEC
     C/COPY WNCPYSRC,SE0130C035
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SSRPT
     C                     ELSE
     C                     MOVE *BLANKS   SSRPT
     C                     END
     C*
     C           SDPD      IFNE *ZEROS
     C                     Z-ADDSDPD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SSDPD
     C                     ELSE
     C                     MOVE *BLANKS   SSDPD
     C                     END
     C*
     C                     MOVE SDNV      NAR2
     C                     END
     C*
     C                     SETON                     131819
     C                     END
     C*
     C* Interest Rate changes
     C*
     C           SSDET     IFEQ 'IR'
     C*
     C* Fetch Cum Coupon rate
     C*
     C                     MOVE *BLANKS   ZFIELD                          E20085
      *                                                                   E20085
      ***  First check the Diary for prior Prior Rate Change.             E20085
      *                                                                   E20085
     C           KSEDO     SETLLSEDEVDO                                   E20085
     C                     READ SEDEVDO                  89               E20085
     C           ACTC      IFNE 'I'                                       E25343
     C                     READ SEDEVDO                  89               E25343
     C                     END                                            E25343
     C           *IN89     IFEQ '0'                                       E20085
     C           SOSDSN    ANDEQSSDSN                                     E20085
     C           SOSDET    ANDEQ'IR'                                      E20085
     C                     MOVE SOSDNC    ZFIELD                          E20085
     C/COPY WNCPYSRC,SE0130C038
     C*                                                                   E20085
     C***  If no Prior Diary Event, default to Rate from SECTYD.          E20085
     C*                                                                   E20085
     C                     ELSE                                           E20085
     C***********CPNR      IFNE *ZEROS                                    E20085
     C***********          MOVE *BLANKS   ZFIELD                          E20085
     C                     MOVE CPNR      ZFIELD
     C                     END                                            E20085
      *                                                                   E20085
     C           ZFIELD    IFNE *ZEROS                                    E20085
     C                     Z-ADD7         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    CUMCR
     C                     ELSE
     C                     MOVE *BLANKS   CUMCR
     C                     END
     C*
     C           ACTC      IFEQ 'I'
     C                     MOVE *BLANKS   SSDNC
     C                     MOVE *BLANKS   NAR1
     C/COPY WNCPYSRC,SE0130C039
     C                     ELSE
     C*
     C           SDNC      IFNE *ZEROS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SDNC      ZFIELD
     C                     Z-ADD7         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SSDNC
     C                     ELSE
     C                     MOVE *BLANKS   SSDNC
     C                     END
     C*
     C                     MOVE SDNV      NAR1
     C/COPY WNCPYSRC,SE0130C040
     C                     END
     C*
     C                     SETON                     1020
     C                     END
     C*
     C* Exchange Rates
     C*
     C           SSDET     IFEQ 'XR'
     C*
     C* Fetch Current Exchange rate
     C*
     C           SEXR      IFNE *ZEROS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SEXR      ZFIELD
     C                     Z-ADD8         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SSEXR
     C                     ELSE
     C                     MOVE *BLANKS   SSEXR
     C                     END
     C*
     C           S01509    IFEQ 'N'                                       S01509
     C*                                                                   S01509
     C           ACTC      IFEQ 'I'
     C                     MOVE *BLANKS   PAYC
     C*
     C* Fetch previous payment currency if security is multi-currency
     C*
     C           MLTI      IFEQ 'Y'
     C           DEVKA     SETLLSEDEVDFX
     C           2         OCUR DS01
     C           READ1     TAG
     C                     READPSEDEVDFX                 33
     C           *IN33     IFEQ '1'
     C           SSDSN     ORNE SDSN
     C                     GOTO ENDRD1
     C                     END
     C*
     C* If previous 'XR' record found, use Payment currency
     C*
     C           SDET      IFEQ 'XR'
     C                     MOVE SDCX      PAYC
     C                     ELSE
     C                     GOTO READ1
     C                     END
     C*
     C           ENDRD1    TAG
     C*
     C* If not found, default to nominal currency
     C*
     C           1         OCUR DS01
     C           PAYC      IFEQ '   '
     C                     MOVE NMCY      PAYC
     C                     END
     C                     END
     C*
     C                     MOVE *BLANKS   CUTR
     C                     MOVE ' '       SSDMD
     C***********          MOVE *BLANKS   NAR2                            E17436
     C                     MOVE *BLANKS   NAR3                            E17436
     C                     ELSE
     C*
     C                     MOVE SDCX      PAYC
     C*
     C           SDCE      IFNE *ZEROS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SDCE      ZFIELD
     C                     Z-ADD8         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    CUTR
     C                     ELSE
     C                     MOVE *BLANKS   CUTR
     C                     END
     C*
     C                     MOVE SDMD      SSDMD
     C***********          MOVE SDNV      NAR2                            E17436
     C                     MOVE SDNV      NAR3                            E17436
     C                     END
     C*
     C                     ELSE                                           S01509
     C                     MOVE VLCY      PAYC                            S01509
     C*                                                                   S01509
     C           SDCE      IFNE *ZEROS                                    S01509
     C                     MOVE *BLANKS   ZFIELD                          S01509
     C                     MOVE SDCE      ZFIELD                          S01509
     C                     Z-ADD8         ZADEC                           S01509
     C                     EXSR ZEDIT                                     S01509
     C                     MOVE ZFIELD    CUTR                            S01509
     C                     ELSE                                           S01509
     C                     MOVE *BLANKS   CUTR                            S01509
     C                     END                                            S01509
     C*                                                                   S01509
     C                     MOVE SDMD      RCDMD                           S01509
     C                     MOVE SDNV      NAR3                            S01509
     C                     END                                            S01509
     C*                                                                   S01509
     C                     SETON                     2122
     C                     END
     C*
     C* Redemption Calls
     C*
     C           SSDET     IFEQ 'RC'
     C           ACTC      IFEQ 'I'
     C                     MOVE *BLANKS   CLAT
     C                     MOVE *BLANKS   CPRI
     C                     MOVE *BLANKS   RAMT
     C                     MOVE *BLANKS   NAR2
     C           S01509    IFEQ 'Y'                                       S01509
     C                     MOVELNMCY      RCCCY                           S01509
     C                     MOVE *ZEROS    @ZFLD   98                      S01509
     C                     ADD  1         @ZFLD                           S01509
     C                     MOVE *BLANKS   ZFIELD                          S01509
     C                     MOVE @ZFLD     ZFIELD                          S01509
     C                     Z-ADD8         ZADEC                           S01509
     C                     EXSR ZEDIT                                     S01509
     C                     MOVE ZFIELD    XRATE                           S01509
     C                     MOVE *BLANKS   RCDMD                           S01509
     C                     END                                            S01509
     C*                                                                   S01220
     C           *IN23     IFEQ '1'                                       S01220
     C                     MOVE 'Y'       SRCIC                           S01220
     C                     END                                            S01220
     C*                                                                   S01220
     C                     ELSE
     C*
     C           SDPP      IFNE *ZEROS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SDPP      ZFIELD
     C                     Z-ADD0         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    CLAT
     C                     ELSE
     C                     MOVE *BLANKS   CLAT
     C                     END
     C*
     C           SDPC      IFNE *ZEROS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SDPC      ZFIELD
     C                     Z-ADD3         ZADEC
     C                     EXSR ZEDIT
     C           SDPC      IFEQ 100                                       E17436
     C                     MOVE ZFIELD    WCPRI                           E17436
     C                     MOVELWCPRI     CPRI                            E17436
     C                     ELSE                                           E17436
     C                     MOVE ZFIELD    CPRI
     C                     END                                            E17436
     C                     ELSE
     C                     MOVE *BLANKS   CPRI
     C                     END
     C*
     C           SDRP      IFNE *ZEROS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SDRP      ZFIELD
     C                     Z-ADD8         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    RAMT
     C                     ELSE
     C                     MOVE *BLANKS   RAMT
     C                     END
     C*
     C***********          MOVE NAR2      SDNV                            E17436
     C                     MOVE SDNV      NAR2                            E17436
     C*                                                                   S01509
     C           S01509    IFEQ 'Y'                                       S01509
     C                     MOVE *BLANKS   RCCCY                           S01509
     C                     MOVE *BLANKS   XRATE                           S01509
     C                     MOVE *BLANK    RCDMD                           S01509
     C           SDCX      IFNE *BLANKS                                   S01509
     C                     MOVE SDCX      RCCCY                           S01509
     C                     END                                            S01509
     C           SDCE      IFNE *ZEROS                                    S01509
     C                     MOVE *BLANKS   ZFIELD                          S01509
     C                     MOVE SDCE      ZFIELD                          S01509
     C                     Z-ADD8         ZADEC                           S01509
     C                     EXSR ZEDIT                                     S01509
     C                     MOVE ZFIELD    XRATE                           S01509
     C                     END                                            S01509
     C           SDMD      IFNE *BLANKS                                   S01509
     C                     MOVE SDMD      RCDMD                           S01509
     C                     END                                            S01509
     C                     END                                            S01509
     C*                                                                   S01220
     C           *IN23     IFEQ '1'                                       S01220
     C                     MOVE RCIC      SRCIC                           S01220
     C                     END                                            S01220
     C*                                                                   S01220
     C                     END
     C*
     C                     SETON                     1314
     C                     SETON                     24                   S01220
     C                     END
     C*
     C* Redemption Puts
     C*
     C           SSDET     IFEQ 'RP'
     C           ACTC      IFEQ 'I'
     C                     MOVE *BLANKS   CLAT
     C                     MOVE *BLANKS   CPRI
     C                     MOVE *BLANKS   RAMT
     C                     MOVE *BLANKS   NAR2
     C                     ELSE
     C*
     C           SDPP      IFNE *ZEROS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SDPP      ZFIELD
     C                     Z-ADD0         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    CLAT
     C                     ELSE
     C                     MOVE *BLANKS   CLAT
     C                     END
     C*
     C           SDPC      IFNE *ZEROS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SDPC      ZFIELD
     C                     Z-ADD3         ZADEC
     C                     EXSR ZEDIT
     C           SDPC      IFEQ 100                                       E17436
     C                     MOVE ZFIELD    WCPRI                           E17436
     C                     MOVELWCPRI     CPRI                            E17436
     C                     ELSE                                           E17436
     C                     MOVE ZFIELD    CPRI
     C                     END                                            E17436
     C                     ELSE
     C                     MOVE *BLANKS   CPRI
     C                     END
     C*
     C           SDRP      IFNE *ZEROS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SDRP      ZFIELD
     C                     Z-ADD8         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    RAMT
     C                     ELSE
     C                     MOVE *BLANKS   RAMT
     C                     END
     C*
     C***********          MOVE NAR2      SDNV                            E17436
     C                     MOVE SDNV      NAR2                            E17436
     C                     END
     C*
     C                     SETON                     1315
     C                     END
     C*
     C* Conversions
     C*
     C           SSDET     IFEQ 'CV'
     C           ACTC      IFEQ 'I'
     C                     MOVE *BLANKS   SSDCV
     C                     MOVE NMCY      CONC
     C                     MOVE *BLANKS   CONR
     C                     MOVE *BLANKS   CONP
     C                     MOVE *BLANKS   NAR3
     C                     ELSE
     C*
     C                     MOVE SDCV      SSDCV
     C           SDCX      IFNE *BLANKS
     C                     MOVE SDCX      CONC
     C                     ELSE
     C                     MOVE NMCY      CONC
     C                     END
     C*
     C           SDCE      IFNE *ZEROS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SDCE      ZFIELD
     C                     Z-ADD8         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    CONR
     C                     ELSE
     C                     MOVE *BLANKS   CONR
     C                     END
     C*
     C           SDRP      IFNE *ZEROS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SDRP      ZFIELD
     C                     Z-ADD8         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    CONP
     C                     ELSE
     C                     MOVE *BLANKS   CONP
     C                     END
     C*
     C                     MOVE SDNV      NAR3
     C                     END
     C*
     C                     SETON                     1622
     C                     END
     C/COPY WNCPYSRC,SE0130C025
     C*
     C* Bonus Issues
     C*
     C           SSDET     IFEQ 'BI'
     C*
     C* Rights Issues
     C*
     C           SSDET     OREQ 'RI'
     C*
     C* Capital Reorganisation
     C*
     C           SSDET     OREQ 'CR'
     C*
     C* Other changes
     C*
     C           SSDET     OREQ 'OC'
     C           ACTC      IFEQ 'I'
     C                     MOVE *BLANKS   NAR4
     C                     ELSE
     C                     MOVE SDNV      NAR4
     C                     END
     C                     SETON                     17
     C                     END
     C/COPY WNCPYSRC,SE0130C003
     C*
     C                     END
     C*
     C                     MOVE 'Y'       FIRSTA  1
     C*
     C* Display second screen
     C*
     C           SSDED1    IFNE *BLANKS                                                       196599
     C                     MOVE SSDED1    SSDED                                               196599
     C                     ENDIF                                                              196599
     C                     WRITESE0130F1
     C           ZSTAG1    TAG                             *** ZSTAG1 ***
     C/COPY WNCPYSRC,SE0130C034
      *                                                                   CSE016
      ** Format security report description                               CSE016
      *                                                                   CSE016
     C                     MOVE *BLANKS   SRNME                           CSE016
      *                                                                   CSE016
     C           SRPN      IFNE *BLANKS                                   CSE016
      *                                                                   CSE016
     C                     MOVE BVRIDF    ZRSFD                           CSE016
     C                     MOVELSRPN      ZSRPN                           CSE016
     C                     EXSR ZSDESC                                    CSE016
     C                     MOVELZRNME     SRNME                           CSE016
      *                                                                   CSE016
     C                     WRITESE0130F1                                  CSE016
      *                                                                   CSE016
     C                     ENDIF                                          CSE016
      *                                                                   CSE016
     C                     EXFMTSE0130F2
     C*
     C* F3 - End job
     C* or F12- Display initial screen requested
     C*
     C   01
     COR 05                GOTO ZSEND
     C*
     C**HELP*key*pressed*-*call*standard*HELP*program******************   S01199
     C***********                                                         S01199
     C********** *IN06     IFEQ '1'                                       S01199
     C**********           CALL 'MHELP'                                   S01199
     C**********           PARM           DBPGM                           S01199
     C**********           PARM           ERRMSG                          S01199
     C**********                                                          S01199
     C**********           GOTO ZSTAG1                                    S01199
     C**********           END                                            S01199
     C*
     C* ROLLDOWN key pressed
     C*
     C           *IN08     IFEQ '1'
     C                     Z-ADD*ZEROS    EC
     C                     SETOF                     09
     C                     EXSR INITL
     C                     GOTO ZSTAG1
     C                     END
     C*
     C**  If been through at least once and no Screen Changes, all
     C**  errors are Warning Errors. Do not perform the Update, no
     C**  need to validate
     C*
     C           FIRSTA    IFEQ 'N'
     C           WEC       ANDEQEC
     C           *IN80     ANDEQ'0'
     C                     Z-ADD0         EC
     C                     SETOF                     0952
     C                     GOTO UPD2
     C                     END
     C*
     C** Check if selection is requested                                  S01117
     C*                                                                   S01117
     C                     MOVE 'N'       @SEL    1                       S01117
     C*                                                                   S01117
     C*   Selection requested on payment currency                         S01117
     C*                                                                   S01117
     C                     MOVELPAYC      @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM *BLANK    @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM PAYC      @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVE A6CYCD    PAYC                            S01117
     C                     ELSE                                           S01117
     C                     MOVE *BLANKS   PAYC                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*   Selection requested on payment currency                         S01117
     C*                                                                   S01117
     C                     MOVELCONC      @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM *BLANK    @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM CONC      @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVE A6CYCD    CONC                            S01117
     C                     ELSE                                           S01117
     C                     MOVE *BLANKS   CONC                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*     If selection is requested redisplay the second screen         S01117
     C*                                                                   S01117
     C           @SEL      IFEQ 'Y'                                       S01117
     C                     GOTO ZSTAG1                                    S01117
     C                     END                                            S01117
     C* Validate entries
     C*
     C           ACTC      IFEQ 'I'
     C           ACTC      OREQ 'A'
     C                     EXSR VLDSEC
     C*
     C* If any errors, re-display screen
     C*
     C                     MOVE 'N'       FIRSTA
     C*
     C*
     C           EC        CABGT*ZEROS    ZSTAG1     09
     C*
     C           UPD2      TAG                             ***  UPD2  ***
     C                     END
     C*
     C* If F10 not pressed in delete mode, re-display screen
     C*
     C           ACTC      IFEQ 'D'
     C           *IN04     ANDEQ'0'
     C                     GOTO ZSTAG1
     C                     END
     C*
     C           ZSEND     ENDSR                           *** ZSEND ***
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  TRSEDE - Subroutine to translate SEDEVD fields from Screen   *
      *           Format to File Format.                              *
      *                                                               *
      *****************************************************************
      *
     C           TRSEDE    BEGSR                           *** TRSEDE ***
     C*
     C                     MOVE SSDSN     SDSN
     C*
     C**  Event date - store as day number
     C*
     C           SSDED     IFNE '999999'                                  S01158
     C                     MOVE SSDED     ZDATE
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    SDED
     C                     ELSE                                           S01158
     C                     Z-ADD99999     SDED                            S01158
     C                     END                                            S01158
     C*
     C                     MOVE SSDET     SDET
     C*
     C*                                                                   S01220
     C**  Set Include Redemption Call in Risk Analysis Indicator to 'N'   S01220
     C**  on file if Risk Management is switched on                       S01220
     C**  (it will be overwritten by the screen value if the event type   S01220
     C**  is 'RC' later in this subroutine)                               S01220
     C*                                                                   S01220
     C           *IN23     IFEQ '1'                                       S01220
     C                     MOVE 'N'       RCIC                            S01220
     C                     END                                            S01220
     C*
     C**  Dividends
     C*
     C           SDET      IFEQ 'DV'
     C*
     C**  Output Amount per unit as valid number
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SSDDV     ZFIELD
     C***********          Z-ADD9         ZADIG                           E16772
     C***********          Z-ADD4         ZADEC                           E16772
     C                     Z-ADD5         ZADIG                           E16772
     C                     Z-ADD8         ZADEC                           E16772
     C                     EXSR ZALIGN
     C***********          MOVE ZFIELD    SDDV                            E16772
     C                     MOVE ZFIELD    SDVA                            E16772
     C*
     C**  Convert Payment date to number
     C*
     C                     MOVE SSDPD     ZDATE
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    SDPD
      *                                                                   S01510
     C                     MOVE SSDXD     ZDATE                           S01510
     C                     EXSR ZDATE1                                    S01510
     C                     Z-ADDZDAYNO    SDXD                            S01510
     C*
     C**  Narrative
     C*
     C                     MOVE NAR1      SDNV
     C/COPY WNCPYSRC,SE0130C032
     C                     END
     C*
     C* Partly paids
     C*
     C           SDET      IFEQ 'PP'
     C*
     C* If Security is a Share, output Call amount
     C*
     C           PROT      IFEQ '4'
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE CAMT      ZFIELD
     C*
     C* Use nominal decimal places
     C*
     C***********          MOVE *BLANKS   KEY12A                          S01117
     C***********          MOVELNMCY      WORK4                           S01117
     C***********          MOVE '1'       WORK4                           S01117
     C***********          MOVEL'20'      KEY12A                          S01117
     C***********          MOVE WORK4     KEY12A                          S01117
     C***********TABKA     CHAINTABTG10F             33                   S01117
     C                     MOVE NMCY      @AJCD                           S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM           @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C***********          Z-ADDCDP       ZADEC                           S01117
     C***********15        SUB  CDP       ZADIG                           S01117
     C                     Z-ADDA6NBDP    ZADEC                           S01117
     C           15        SUB  A6NBDP    ZADIG                           S01117
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    SDPP
     C*
     C* Else output Call percentage
     C*
     C                     ELSE
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE CPRI      ZFIELD
     C                     Z-ADD3         ZADIG
     C                     Z-ADD3         ZADEC
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    SDPC
     C                     END
     C*
     C           ACTC      IFEQ 'A'
     C                     Z-ADDSDPP      NWSDPP
     C                     Z-ADDSDPC      NWSDPC
     C                     END
     C*
     C* Add Call amount/percentage to 'To date' figure
     C*
     C* Fetch previous total
     C*
     C           DEVKA     SETLLSEDEVDFX
     C                     Z-ADD*ZEROS    SVSDTA
     C                     Z-ADD*ZEROS    OLSDPP
     C                     Z-ADD*ZEROS    OLSDPC
     C                     Z-ADD*ZEROS    SVSDTP
     C           2         OCUR DS01
      *
     C           AGAINZ    TAG                             *** AGAINZ ***
      *
     C                     READPSEDEVDFX                 33
     C  N33      SDSN      COMP SSDSN                3333
      *
     C* IF 33 ON ==> NO PP RECORDS ON DIARY                               E15930
     C   33                Z-ADDORIDTA    SVSDTA                          E15930
     C   33                Z-ADDORIDTP    SVSDTP                          E15930
     C   33                GOTO OUTZ
     C*
     C* Check record is not a cancelled record
     C*
     C           RECI      CABEQ'C'       AGAINZ         32
     C*
     C* Check Event type is same
     C*
     C           SDET      CABNE'PP'      AGAINZ
     C*
     C* Save previous total values
     C*
     C                     Z-ADDSDTA      SVSDTA
     C                     Z-ADDSDPP      OLSDPP
     C                     Z-ADDSDPC      OLSDPC
     C                     Z-ADDSDTP      SVSDTP
     C*
     C           OUTZ      TAG                             ***  OUTZ  ***
     C           1         OCUR DS01
     C*
     C* Add above amounts to totals
     C*
     C           SVSDTA    ADD  SDPP      SDTA
     C           SVSDTP    ADD  SDPC      SDTP
     C*
     C* Narrative
     C*
     C                     MOVE NAR1      SDNV
     C                     END
     C*
     C* Mortgage Payments
     C*
     C           SDET      IFEQ 'MP'
     C*
     C* Current Factor - If input, convert to valid number, else
     C*                  calculate as follows:-
     C*
     C**   (Issue amount - (Repayments to date + Repayment amount))
     C**   divided by issue amount
     C*
     C           SSDCP     IFNE *BLANKS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SSDCP     ZFIELD
     C                     Z-ADD1         ZADIG
     C**********           Z-ADD8         ZADEC                           052254
     C                     Z-ADD9         ZADEC                           052254
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    SDCP
     C*
     C                     ELSE
     C*
     C* Fetch total previously repaid
     C*
     C           DEVKA     SETGTSEDEVDFX
     C                     Z-ADD*ZEROS    SVSDTR
     C           2         OCUR DS01
      *
     C           AGAIN4    TAG                             *** AGAIN4 ***
      *
     C                     READPSEDEVDFX                 33
     C  N33      SDSN      COMP SSDSN                3333
     C   33                GOTO OUT5
     C*
     C* Check record is a not cancelled record
     C*
     C           RECI      CABEQ'C'       AGAIN4
     C*
     C* Check Event type is same
     C*
     C           SDET      CABNE'MP'      AGAIN4
     C*
     C* Save previous total repaid
     C*
     C                     Z-ADDSDTR      SVSDTR
     C*
     C           OUT5      TAG                             ***  OUT5  ***
      *
     C           1         OCUR DS01
     C*
     C* Convert Repayment amount to number
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SSRPT     ZFIELD
     C                     Z-ADD15        ZADIG
     C                     Z-ADD*ZERO     ZADEC
     C/COPY WNCPYSRC,SE0130C036
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    SRPT
     C*
     C* Add amount to total
     C*
     C           SDTR      ADD  SRPT      TOTR
     C*
     C* Subtract from Issue amount
     C*
     C           ISSA      SUB  TOTR      RES1
     C*
     C* Divide result by Issue amount
     C*
     C           ISSA      IFEQ *ZEROS
     C                     Z-ADD1         ISSA
     C                     END
     C*
     C           RES1      DIV  ISSA      SDCP
     C*
     C                     END
     C*
     C* Convert Repayment amount to number, and save it to update the
     C* running total
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SSRPT     ZFIELD
     C                     Z-ADD15        ZADIG
     C                     Z-ADD*ZERO     ZADEC
     C/COPY WNCPYSRC,SE0130C037
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    SRPT
     C*
     C           ACTC      IFEQ 'A'
     C                     Z-ADDSRPT      NWSRPT
     C                     END
     C*
     C* Add Repayment amount to 'To date' figure
     C*
     C* Fetch total previously repaid
     C*
     C           DEVKA     SETLLSEDEVDFX
     C                     Z-ADD*ZEROS    SVSDTR
     C                     Z-ADD*ZEROS    OLSRPT
     C                     MOVE ' '       SVSRMI
     C           2         OCUR DS01
      *
     C           AGAIN5    TAG                             *** AGAIN5 ***
      *
     C                     READPSEDEVDFX                 33
     C  N33      SDSN      COMP SSDSN                3333
     C   33                GOTO OUT6
     C*
     C* Check record is not a cancelled record
     C*
     C           RECI      CABEQ'C'       AGAIN5
     C*
     C* Check Event type is same
     C*
     C           SDET      CABNE'MP'      AGAIN5
     C*
     C* Save previous fields
     C*
     C                     Z-ADDSDTR      SVSDTR
     C                     Z-ADDSRPT      OLSRPT
     C                     MOVE SRMI      SVSRMI
     C*
     C           OUT6      TAG                             ***  OUT6  ***
      *
     C           1         OCUR DS01
     C*
     C* Add amount to total
     C*
     C           SVSDTR    ADD  SRPT      SDTR
     C*
     C* Set Repayment Method indicator to 'Y' if previously so, or if
     C* Repayment amount entered
     C*
     C           SVSRMI    IFEQ 'Y'
     C           SRPT      ORGT *ZEROS
     C                     MOVE 'Y'       SRMI
     C                     END
     C*
     C* Convert Payment date to number
     C*
     C                     MOVE SSDPD     ZDATE
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    SDPD
     C*
     C* Narrative
     C*
     C                     MOVE NAR2      SDNV
     C                     END
     C*
     C* Interest Rate change
     C*
     C           SDET      IFEQ 'IR'
     C*
     C* Convert Next Coupon Rate to Number
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SSDNC     ZFIELD
     C                     Z-ADD4         ZADIG
     C                     Z-ADD7         ZADEC
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    SDNC
     C*
     C* Narrative
     C*
     C                     MOVE NAR1      SDNV
     C/COPY WNCPYSRC,SE0130C041
     C                     END
     C*
     C* Exchange Rate
     C*
     C           SDET      IFEQ 'XR'
     C*
     C* Payment currency
     C*
     C                     MOVE PAYC      SDCX
     C*
     C* Convert Cut Coupon exchange rate to number
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE CUTR      ZFIELD
     C                     Z-ADD5         ZADIG
     C                     Z-ADD8         ZADEC
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    SDCE
     C*
     C* Multiply/Divide indicator
     C*
     C                     MOVE SSDMD     SDMD
     C*
     C* Narrative
     C*
     C                     MOVE NAR3      SDNV
     C                     END
     C*
     C* Redemption Calls/Puts
     C*
     C           SDET      IFEQ 'RC'
     C           SDET      OREQ 'RP'
     C*
     C* Convert Call amount or percentage to number, and save it to update
     C* the running total
     C*
     C* Call amount
     C*
     C           CLAT      IFNE *BLANKS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE CLAT      ZFIELD
     C                     Z-ADD11        ZADIG
     C                     Z-ADD*ZERO     ZADEC
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    SDPP
     C                     Z-ADD*ZEROS    SDPC
     C                     ELSE
     C*
     C* Call percentage
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE CPRI      ZFIELD
     C                     Z-ADD3         ZADIG
     C                     Z-ADD3         ZADEC
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    SDPC
     C                     Z-ADD*ZEROS    SDPP
     C                     END
     C*
     C** RC to be included in Cash Flow Analysis?                         S01220
     C*                                                                   S01220
     C           *IN23     IFEQ '1'                                       S01220
     C                     MOVE SRCIC     RCIC                            S01220
     C                     END                                            S01220
     C*                                                                   S01220
     C           ACTC      IFEQ 'A'
     C                     Z-ADDSDPP      NWSDPP
     C                     Z-ADDSDPC      NWSDPC
     C                     END
     C*
     C* Add Call amount/percentage to 'To date' figure
     C*
     C* Fetch previous total
     C*
     C           DEVKA     SETLLSEDEVDFX
     C                     Z-ADD*ZEROS    SVSDTA
     C                     Z-ADD*ZEROS    OLSDPP
     C                     Z-ADD*ZEROS    OLSDPC
     C                     Z-ADD*ZEROS    SVSDTP
     C           2         OCUR DS01
      *
     C           AGAIN6    TAG                             *** AGAIN6 ***
      *
     C                     READPSEDEVDFX                 33
     C  N33      SDSN      COMP SSDSN                3333
     C   33                GOTO OUT7
     C*
     C* Check record is not a cancelled record
     C*
     C           RECI      CABEQ'C'       AGAIN6         32
     C*
     C* Check Event type is same
     C*
     C           SDET      COMP 'RC'                     32
     C  N32      SDET      COMP 'RP'                     32
     C  N32                GOTO AGAIN6
     C*
     C* Save previous total values
     C*
     C                     Z-ADDSDTA      SVSDTA
     C                     Z-ADDSDPP      OLSDPP
     C                     Z-ADDSDPC      OLSDPC
     C                     Z-ADDSDTP      SVSDTP
     C*
     C           OUT7      TAG                             ***  OUT7  ***
     C           1         OCUR DS01
     C*
     C* Add above amounts to totals
     C*
     C           SVSDTA    ADD  SDPP      SDTA
     C           SVSDTP    ADD  SDPC      SDTP
     C*
     C* Convert Redemption Price to number
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE RAMT      ZFIELD
     C                     Z-ADD7         ZADIG
     C                     Z-ADD8         ZADEC
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    SDRP
     C*
     C           SDET      IFEQ 'RC'                                      S01509
     C           S01509    ANDEQ'Y'                                       S01509
     C*                                                                   S01509
     C* Save Redemption Currency                                          S01509
     C                     MOVE RCCCY     SDCX                            S01509
     C*                                                                   S01509
     C* Convert Exchange Rate to number                                   S01509
     C                     MOVE *BLANKS   ZFIELD                          S01509
     C                     MOVE XRATE     ZFIELD                          S01509
     C                     Z-ADD5         ZADIG                           S01509
     C                     Z-ADD8         ZADEC                           S01509
     C                     EXSR ZALIGN                                    S01509
     C                     MOVE ZFIELD    SDCE                            S01509
     C*                                                                   S01509
     C* Multiply/Divide indicator                                         S01509
     C                     MOVE RCDMD     SDMD                            S01509
     C*                                                                   S01509
     C                     END                                            S01509
     C*
     C* Narrative
     C*
     C                     MOVE NAR2      SDNV
     C                     END
     C*
     C* Conversions
     C*
     C           SDET      IFEQ 'CV'
     C*
     C* Conversion Security
     C*
     C                     MOVE SSDCV     SDCV
     C*
     C* Conversion Currency
     C*
     C                     MOVE CONC      SDCX
     C*
     C* Convert Conversion exchange rate to number
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE CONR      ZFIELD
     C                     Z-ADD5         ZADIG
     C                     Z-ADD8         ZADEC
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    SDCE
     C*
     C* Convert Conversion price to number
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE CONP      ZFIELD
     C                     Z-ADD7         ZADIG
     C                     Z-ADD8         ZADEC
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    SDRP
     C*
     C* Narrative
     C*
     C                     MOVE NAR3      SDNV
     C                     END
     C/COPY WNCPYSRC,SE0130C004
     C*
     C* Bonus Issues, Rights Issues, Capital Reorganisation or Other
     C* Changes
     C*
     C           SDET      IFEQ 'BI'
     C           SDET      OREQ 'RI'
     C           SDET      OREQ 'CR'
     C           SDET      OREQ 'OC'
     C/COPY WNCPYSRC,SE0130C005
     C                     MOVE NAR4      SDNV
     C                     END
     C*
     C/COPY WNCPYSRC,SE0130C014
     C                     Z-ADD*ZEROS    SDAD
     C                     Z-ADD*ZEROS    SDDT
     C/COPY WNCPYSRC,SE0130C015
     C                     Z-ADDRUND      LCD
     C                     MOVE ACTC      CHTP
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  UPDFLS - Subroutine to Update the Files.                     *
      *                                                               *
      *****************************************************************
      *
     C           UPDFLS    BEGSR                           *** UPDFLS ***
     C*
     C* Fetch last used transaction number
     C*
     C                     EXSR ZTNLU1
      *                                                                   CSE031
      ** If Amending a Security of Event type 'IR' which has been         CSE031
      ** actioned then Delete current event and Insert a new one.         CSE031
      *                                                                   CSE031
     C           CSE031    IFEQ 'Y'                                       CSE031
     C           ACTC      ANDEQ'A'                                       CSE031
     C           SSDET     ANDEQ'IR'                                      CSE031
     C           EVTDNO    ANDLTRUND                                      CSE031
     C           SDAD      ANDNE*ZEROS                                    CSE031
      *                                                                   CSE031
     C           DEVKA     CHAINSEDEVDF              31                   CSE031
      *                                                                   CSE031
      ** Delete this Diary Event                                          CSE031
     C                     MOVE 'C'       RECI                            CSE031
     C                     Z-ADDRUND      LCD                             CSE031
     C                     MOVE 'D'       CHTP                            CSE031
     C                     MOVELNATN      TNLU                            CSE031
      *                                                                   CSE031
     C                     EXCPTDLTREC                                    CSE031
      *                                                                   CSE031
      ** Fetch last used transaction number                               CSE031
     C                     EXSR ZTNLU1                                    CSE031
      *                                                                   CSE031
      ** Insert a New Diary Event                                         CSE031
     C                     EXSR TRSEDE                                    CSE031
     C                     MOVE 'D'       RECI                            CSE031
     C                     Z-ADDRUND      LCD                             CSE031
     C                     MOVE 'I'       CHTP                            CSE031
     C                     MOVELNATN      TNLU                            CSE031
      *                                                                   CSE031
     C                     WRITESEDEVDF                                   CSE031
      *                                                                   CSE031
      ** Update Audit record                                              CSE031
     C           1         CHAINSEDEVAF              U8                   CSE031
      *                                                                   CSE031
     C                     ADD  1         NOIN                            CSE031
     C                     ADD  1         NORE                            CSE031
     C                     ADD  1         NODE                            CSE031
      *                                                                   CSE031
     C                     Z-ADDRUND      LCD                             CSE031
     C                     MOVE 'A'       CHTP                            CSE031
     C                     MOVELNATN      TNLU                            CSE031
      *                                                                   CSE031
     C                     UPDATSEDEVAF                                   CSE031
      *                                                                   CSE031
     C                     GOTO CMTTAG                                    CSE031
     C                     ENDIF                                          CSE031
     C*
     C* Inputs
     C*
     C           ACTC      IFEQ 'I'
     C           DEVKA     CHAINSEDEVDF              31
     C           *IN31     IFEQ '0'
     C***********RECI      ANDEQ'D'                                       E23259
     C                     SETON                     09
     C                     MOVEAINF,1     ERRMSG
     C                     Z-ADD01021     STATUS
     C                     EXSR INFSR
     C*
     C                     ELSE
     C*
     C* Translate records from screen layout to file layout
     C*
     C********** SSDED1    IFNE *BLANKS                                                182505 196599
     C**********           MOVE SSDED1    SSDED                                        182505 196599
     C**********           ENDIF                                                       182505 196599
     C                     EXSR TRSEDE
     C                     MOVE 'D'       RECI
     C                     Z-ADDRUND      LCD
     C                     MOVE 'I'       CHTP
     C                     MOVELNATN      TNLU
     C                     END
     C   31                WRITESEDEVDF
     C  N31                UPDATSEDEVDF
     C                     ELSE
     C*
     C* Amendments
     C*
     C           ACTC      IFEQ 'A'
     C           DEVKA     CHAINSEDEVDF              31
     C           TNLU      IFNE STNLU
     C                     SETON                     09
     C                     MOVEAINF,1     ERRMSG
     C                     Z-ADD01021     STATUS
     C                     EXSR INFSR
     C*
     C                     ELSE
     C*
     C* Translate records from screen layout to file layout
     C*
     C                     EXSR TRSEDE
     C                     Z-ADDRUND      LCD
     C                     MOVE 'A'       CHTP
     C                     MOVELNATN      TNLU
     C                     END
     C  N31                UPDATSEDEVDF
     C                     ELSE
     C*
     C* Deletions
     C*
     C           ACTC      IFEQ 'D'
      *                                                                   057220
      * If there are any live position settlements for this security      057220
      * event, output message to screen, and prevent deletion.            057220
     C           SDSN      SETLLPOSETDF                                   057220
     C           SDSN      READEPOSETDF                  31               057220
     C           *IN31     DOWEQ'0'                                       057220
      *                                                                                       260331
     C           SDET      IFEQ 'MP'                                                          260331
     C           SDET      OREQ 'DV'                                                          260331
     C           S01512    ANDNE'Y'                                                           260331
     C                     Z-ADDSDPD      WWPDUD  50                                          260331
     C                     ELSE                                                               260331
     C                     Z-ADDSDED      WWPDUD                                              260331
     C                     ENDIF                                                              260331
      *                                                                                       260331
     C********** SDED      IFEQ PDUD                                                   057220 260331
     C           WWPDUD    IFEQ PDUD                                                          260331
     C           SDET      ANDEQPEVT                                      057220
     C           RECI      ANDEQ'D'                                       057220
     C           WRECI     ANDEQ'D'                                                           260331
     C                     SETON                     0931                 057220
     C                     SETOF                     4403                 057220
     C                     MOVEAINF,2     ERRMSG                          057220
     C                     Z-ADD01021     STATUS                          057220
     C                     EXSR INFSR                                     057220
     C                     END                                            057220
     C  N31      SDSN      READEPOSETDF                  31               057220
     C                     END                                            057220
     C*                                                                   057220
     C           DEVKA     CHAINSEDEVDF              31
     C           TNLU      IFNE STNLU
     C                     SETON                     09
     C                     SETOF                     4403
     C                     MOVEAINF,1     ERRMSG
     C                     Z-ADD01021     STATUS
     C                     EXSR INFSR
     C*
     C                     ELSE
     C*
     C* Amend last update details
     C*
     C           RECI      IFEQ 'D'                                                           260331
      *                                                                                       260331
     C           SDET      IFEQ 'MP'                                                          260331
     C           SDET      OREQ 'DV'                                                          260331
     C           SDET      OREQ 'PP'                                                          260331
     C                     Z-ADD0         SDDT                                                260331
     C                     ENDIF                                                              260331
      *                                                                                       260331
     C                     ENDIF                                                              260331
     C                     MOVE 'C'       RECI
     C                     Z-ADDRUND      LCD
     C                     MOVE 'D'       CHTP
     C                     MOVELNATN      TNLU
     C                     END
     C  N31                EXCPTDLTREC
     C                     END
     C                     END
     C                     END
     C*
     C* Update any running total fields on succeeding records
     C*
     C           DEVKA     SETGTSEDEVDF
     C                     SETOF                     32
     C           *IN32     DOWEQ'0'
     C           SSDSN     READESEDEVDF                  32
     C           *IN32     IFEQ '0'
     C           RECI      ANDNE'C'
     C           SSDET     ANDEQSDET
     C*
     C* Input mode - add to total
     C*
     C           ACTC      IFEQ 'I'
     C           SDET      IFEQ 'MP'
     C                     ADD  NWSRPT    SDTR
     C                     ELSE
     C***********SDET      IFEQ 'RC'                                      E23259
     C***********SDET      OREQ 'RP'                                      E23259
     C           SDET      IFEQ 'PP'                                      E23259
     C                     ADD  NWSDPP    SDTA
     C                     ADD  NWSDPC    SDTP
     C                     END
     C                     END
     C                     ELSE
     C*
     C* Amend mode - adjust total
     C*
     C           ACTC      IFEQ 'A'
     C           SDET      IFEQ 'MP'
     C                     SUB  OLSRPT    SDTR
     C                     ADD  NWSRPT    SDTR
     C                     ELSE
     C***********SDET      IFEQ 'RC'                                      E23259
     C***********SDET      OREQ 'RP'                                      E23259
     C           SDET      IFEQ 'PP'                                      E23259
     C                     SUB  OLSDPP    SDTA
     C                     ADD  NWSDPP    SDTA
     C                     SUB  OLSDPC    SDTP
     C                     ADD  NWSDPC    SDTP
     C                     END
     C                     END
     C                     ELSE
     C*
     C* Delete mode - subtract from total
     C*
     C           ACTC      IFEQ 'D'
     C           SDET      IFEQ 'MP'
     C                     SUB  OLSRPT    SDTR
     C                     ELSE
     C***********SDET      IFEQ 'RC'                                      E23259
     C***********SDET      OREQ 'RP'                                      E23259
     C           SDET      IFEQ 'PP'                                      E23259
     C                     SUB  OLSDPP    SDTA
     C                     SUB  OLSDPC    SDTP
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C*
     C* Update record
     C*
     C                     EXCPTUPDTOT
     C*
     C                     END
     C                     END
     C*
     C* Fetch Audit record
     C*
     C           1         CHAINSEDEVAF              U8
     C*
     C* Update if found
     C*
     C           *INU8     IFEQ '0'
     C*
     C           ACTC      IFEQ 'I'
     C                     ADD  1         NOIN
     C   31                ADD  1         NORE
     C                     ELSE
     C           ACTC      IFEQ 'A'
     C                     ADD  1         NOAM
     C                     ELSE
     C           ACTC      IFEQ 'D'
     C                     ADD  1         NODE
     C                     END
     C                     END
     C                     END
     C*
     C                     Z-ADDRUND      LCD
     C                     MOVE 'A'       CHTP
     C                     MOVELNATN      TNLU
     C*
     C                     UPDATSEDEVAF
     C/COPY WNCPYSRC,SE0130C026
     C*
     C* COMIT
     C*
     C           CMTTAG    TAG                                            CSE031
      *                                                                   CSE031
     C           CMTTXT    COMIT
     C*
     C                     ELSE
     C                     SETON                     U7
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVEL'03'      DBASE            ***************E20651
     C***********          MOVEL'05'      DBASE            * DB ER E20651 S01117
     C                     Z-ADD05        DBASE            * DB ERROR 05 *S01117
     C                     MOVEL'SEDEVA'  DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  VLDITL - Subroutine to validate Entries made on the Initial  *
      *           Screen.                                             *
      *                                                               *
      *****************************************************************
      *
     C           VLDITL    BEGSR                           *** VLDITL ***
     C*
     C* Clear error indicators and fields
     C*
     C                     Z-ADD*ZEROS    EC      20
     C                     Z-ADD*ZEROS    WEC
     C                     MOVE *BLANKS   ERRMSG
     C                     SETOF                     09
     C                     MOVEA'0000'    *IN,40
     C                     MOVE '0'       *IN49                           S01510
     C/COPY WNCPYSRC,SE0130C020
      *                                                                   CSE010
      ** Check Security Shortname and call Securities Selection           CSE010
      *                                                                   CSE010
     C           CSE010    IFEQ 'Y'                                       CSE010
     C                     MOVELSSDSN     @QMK    1                       CSE010
     C           @QMK      IFEQ '?'                                       CSE010
     C                     MOVELSSDSN     @SESN                           CSE010
     C                     CALL 'SE0043'                                  CSE010
     C                     PARM           @ACDE   1                       CSE010
     C                     PARM           @SESN  10                       CSE010
     C           @SESN     IFNE *BLANKS                                   CSE010
     C                     MOVE @SESN     SSDSN                           CSE010
     C                     ELSE                                           CSE010
     C                     MOVE *BLANKS   SSDSN                           CSE010
     C                     ENDIF                                          CSE010
     C                     ENDIF                                          CSE010
     C                     ENDIF                                          CSE010
     C*
     C* Convert date into day number for key
     C*
     C           SSDED     IFNE '999999'                                  S01158
     C                     MOVE SSDED     ZDATE
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    EVTDNO
     C                     ELSE                                           S01158
     C                     Z-ADD99999     EVTDNO                          S01158
     C                     END                                            S01158
     C*
     C* Action code edit
     C*
     C           ACTC      IFNE 'I'
     C           ACTC      ANDNE'A'
     C           ACTC      ANDNE'D'
     C           ACTC      ANDNE'E'
     C                     ADD  1         EC
     C                     MOVEA' 100'    ERR,EC
     C                     SETON                     40
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C**   IF SINGLE BRANCH ENVIRONMENT                                   S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'N'                                       S01117
     C                     CALL 'ZVACTU'                                  S01117
     C                     PARM ACTC      @ZACTN  1                       S01117
     C                     PARM           @ERR    10                      S01117
     C**                                                                  S01117
     C           @ERR      IFNE *ZERO                                     S01117
     C                     ADD  1         EC                              S01117
     C                     MOVEA' 302'    ERR,EC                          S01117
     C                     SETON                     40                   S01117
     C                     END                                            S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C**   IF MULTIBRANCHING ENVIRONMENT                                  S01117
     C*                                                                   S01117
     C                     CALL 'ZVACTBU'                                 S01117
     C                     PARM ACTC      @ZACTN  1                       S01117
     C                     PARM USRBCH    @ZBR    3                       S01117
     C                     PARM           @ERR    10                      S01117
     C**                                                                  S01117
     C           @ERR      IFEQ 1                                         S01117
     C                     ADD  1         EC                              S01117
     C                     MOVEA' 303'    ERR,EC                          S01117
     C                     SETON                     40                   S01117
     C                     END                                            S01117
     C           @ERR      IFEQ 2                                         S01117
     C                     ADD  1         EC                              S01117
     C                     MOVEA' 304'    ERR,EC                          S01117
     C                     SETON                     40                   S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     END
     C*
     C* Security short name
     C*
     C           ACTC      IFEQ 'I'
     C           SSDSN     IFEQ *BLANKS
     C                     ADD  1         EC
     C                     MOVEA' 101'    ERR,EC
     C                     SETON                     41
     C*
     C                     ELSE
     C*
     C* Input mode - record must exist as an active or matured
     C* Security record
     C*
     C           SSDSN     CHAINSECTYDF              33
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0130CCP9                                           S01408
     C*                                                                   S01408
     C           *IN33     IFEQ '1'
     C                     ADD  1         EC
     C***********          MOVEA' 101'    ERR,EC                          E22960
     C                     MOVEA' 102'    ERR,EC                          E22960
     C                     SETON                     41
     C                     ELSE
     C           RECI      IFNE 'D'
     C***********RECI      ANDNE'M'                                       073727
     C                     ADD  1         EC
     C***********          MOVEA' 101'    ERR,EC                          E22960
     C                     MOVEA' 102'    ERR,EC                          E22960
     C                     SETON                     41
     C                     END
     C                     END
     C*
     C* or be a reserved word
     C*
     C           SSDSN     IFEQ 'ALL'
     C                     ADD  1         EC
     C***********          MOVEA' 101'    ERR,EC                          E22960
     C                     MOVEA' 102'    ERR,EC                          E22960
     C                     SETON                     41
     C                     END
     C*
     C* An active Diary Event with a duplicate key must not already exist
     C*
     C/COPY WNCPYSRC,SE0130C006
     C           DEVKA     CHAINSEDEVDFX             33
     C           *IN33     IFEQ '0'
     C***********RECI      ANDEQ'D'                                       E23259
     C           RECI      ANDNE'C'                                       E23259
     C                     ADD  1         EC
     C***********          MOVEA' 101'    ERR,EC                          E22960
     C***********          MOVEA' 102'    ERR,EC                    E22960E23286
     C                     MOVEA' 103'    ERR,EC                          E22960
     C                     SETON                     41
     C                     END
     C/COPY WNCPYSRC,SE0130C007
     C*
     C                     END
     C*
     C* Else Fetch Security detail record
     C*
     C                     ELSE
     C           SSDSN     CHAINSECTYDF              33
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0130CP10                                           S01408
     C*                                                                   S01408
     C*
     C                     END
     C/COPY WNCPYSRC,SE0130C016
     C*
     C* Amend mode
     C*
     C           ACTC      IFEQ 'A'
     C           SSDSN     IFEQ *BLANKS
     C                     ADD  1         EC
     C***********          MOVEA' 102'    ERR,EC                          E22960
     C                     MOVEA' 101'    ERR,EC                          E22960
     C                     SETON                     41
     C                     ELSE
     C*
     C* Record must exist
     C*
     C           DEVKA     CHAINSEDEVDFX             33
     C           *IN33     IFEQ '1'
     C                     ADD  1         EC
     C***********          MOVEA' 102'    ERR,EC                          E23286
     C                     MOVEA' 104'    ERR,EC                          E23286
     C                     SETON                     41
     C                     ELSE
     C*
     C**and*be*an*active*event*****************************************   E20085
     C***********                                                         E20085
     C***********RECI      IFNE 'D'                                       E20085
     C***********          ADD  1         EC                              E20085
     C***********          MOVEA' 102'    ERR,EC                          E20085
     C***********          SETON                     41                   E20085
     C***********          END                                            E20085
     C*                                                                   E23259
     C*** and be an active event - reinstated                             E23259
     C*                                                                   E23259
     C           RECI      IFNE 'D'                                       E23259
     C                     ADD  1         EC                              E23259
     C*********************MOVEA' 102'    ERR,EC                    E23259E23286
     C                     MOVEA' 104'    ERR,EC                          E23286
     C                     SETON                     41                   E23259
     C                     END                                            E23259
     C                     END
     C                     END
     C                     END
     C*
     C* Delete mode
     C*
     C           ACTC      IFEQ 'D'
     C           SSDSN     IFEQ *BLANKS
     C                     ADD  1         EC
     C***********          MOVEA' 103'    ERR,EC                          E22960
     C                     MOVEA' 101'    ERR,EC                          E22960
     C                     SETON                     41
     C                     ELSE
     C*
     C* Record must exist
     C*
     C           DEVKA     CHAINSEDEVDFX             33
     C           *IN33     IFEQ '1'
     C                     ADD  1         EC
     C***********          MOVEA' 103'    ERR,EC                          E22960
     C***********          MOVEA' 102'    ERR,EC                    E22960E23286
     C                     MOVEA' 104'    ERR,EC                          E23286
     C                     SETON                     41
     C                     ELSE
     C*
     C* and be an active event
     C*
     C           RECI      IFNE 'D'
     C           RECI      ANDNE'M'                                       E23259
     C                     ADD  1         EC
     C***********          MOVEA' 103'    ERR,EC                          E22960
     C***********          MOVEA' 102'    ERR,EC                    E22960E23286
     C                     MOVEA' 104'    ERR,EC                          E23286
     C                     SETON                     41
     C/COPY WNCPYSRC,SE0130C008
     C                     END
      *                                                                                       260331
      ** Save RECI value                                                                      260331
      *                                                                                       260331
     C                     MOVE RECI      WRECI   1                                           260331
     C                     END
     C                     END
     C                     END
     C*
     C* Enquiry mode
     C*
     C           ACTC      IFEQ 'E'
     C           SSDSN     IFEQ *BLANKS
     C                     ADD  1         EC
     C***********          MOVEA' 104'    ERR,EC                          E22960
     C                     MOVEA' 101'    ERR,EC                          E22960
     C                     SETON                     41
     C                     ELSE
     C*
     C* Record must exist
     C*
     C           DEVKA     CHAINSEDEVDFX             33
     C           *IN33     IFEQ '1'
     C                     ADD  1         EC
     C*********************MOVEA' 104'    ERR,EC                          E22960
     C*********************MOVEA' 102'    ERR,EC                    E22960E23286
     C                     MOVEA' 104'    ERR,EC                          E23286
     C                     SETON                     41
     C                     ELSE
     C***********                                                         E23259
     C**and*be*an active event                                            E23259
     C***********                                                         E23259
     C***********RECI      IFNE 'D'                                       E23259
     C***********          ADD  1         EC                              E23259
     C*********************MOVEA' 103'    ERR,EC                          E22960
     C***********          MOVEA' 102'    ERR,EC                   E22960 E23259
     C***********          SETON                     41                   E23259
     C***********          END                                            E23259
     C                     END
     C                     END
     C                     END
     C*
     C* Save for comparison last update number from file
     C*
     C                     Z-ADDTNLU      STNLU
     C*
     C* Event date
     C*
     C           SSDED     IFEQ *BLANKS
     C                     ADD  1         EC
     C                     MOVEA' 105'    ERR,EC
     C                     SETON                     42
     C                     ELSE
     C***********SSDED     IFNE '999999'                                  S01158
     C           SSDED     IFEQ '999999'                                  S01158
     C                     Z-ADD99999     EVTDNO                          S01158
     C                     ELSE                                           S01158
     C*
     C* Check date valid
     C*
     C                     MOVE SSDED     DATEN   60
     C                     MOVE DATEN     DATEA   6
     C           SSDED     IFNE DATEA
     C                     ADD  1         EC
     C                     MOVEA' 105'    ERR,EC
     C                     SETON                     42
     C                     ELSE
     C                     MOVE SSDED     ZDATE
     C                     EXSR ZDATE1
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 105'    ERR,EC
     C                     SETON                     42
     C                     ELSE
     C*
     C* Save for later comparison
     C*
     C                     Z-ADDZDAYNO    EVTDNO
     C*                                                                   054836
     C**   If Date is Backvalued, check that it does not go past the      054836
     C**   Backvalue Period specified on SE ICD.                          054836
     C*                                                                   054836
     C           RUND      SUB  BVBVP     WBKVP                           054836
     C           EVTDNO    IFLT WBKVP                                     054836
     C                     ADD  1         EC                              054836
     C                     MOVEA' 108'    ERR,EC                          054836
     C                     SETON                     42                   054836
     C                     ENDIF                                          054836
      *                                                                   E23897
      ** Check that date is not after date of maturity.                   E23897
      *                                                                   E23897
     C           ZDAYNO    IFGT MATY                                      E23897
     C           MATY      ANDNE0                                         E23897
     C                     ADD  1         EC                              E23897
     C                     MOVEA' 122'    ERR,EC                          E23897
     C                     MOVE '1'       *IN42                           E23897
     C                     ELSE                                           E23897
     C*
     C* Check not holiday in value currency (nominal if blank)
     C*    WARNING ERROR ONLY - check only if changed and only in Input
     C*    mode
     C*
     C           ACTC      IFEQ 'I'
     C***********ZDAYNO    ANDNEHDAYNO
     C           VLCY      IFNE '   '
     C                     MOVE VLCY      ZCCY
     C                     ELSE
     C                     MOVE NMCY      ZCCY
     C                     END
     C***********          EXSR ZDATE5                                    S01195
     C                     MOVE *BLANKS   ZLOC                            S01195
     C                     EXSR ZCHKH                                     S01195
     C                     MOVE 'N'       HOLI    1                       182505
     C************IN99     IFEQ '1'                                       S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C                     ADD  1         EC
     C******               ADD  1         WEC                             182505
     C******               MOVEA' W10'    ERR,EC                          182505
     C**********           MOVEA' 107'    ERR,EC                                       182505 196599
     C                     ADD  1         WEC                                                 196599
     C                     MOVEA' W10'    ERR,EC                                              196599
     C                     MOVE 'Y'       HOLI                                                196599
     C                     SETON                     42
     C                     END
     C                     Z-ADDZDAYNO    HDAYNO
     C                     END
     C*
     C*************************************************************       E23259
     C***IF*EVENT*BACKVALUED*THE*EVENT*WOULD*BE*ACTIONED*BY*SE2100*E20085 E23259
     C*** Amendments to Actioned Events cannot be processed by SE2100     E23259
     C*** SE2100 only allows Inserts and Deletes to be Backvalued         E23259
     C**If*'Amend'*mode,*check*event*not*already*actioned**************   E20085
     C**********                                                          E20085
     C********** ACTC      IFEQ 'A'                                       E20085
     C********** ZDAYNO    ANDLTRUND                                      E20085
     C********** SDAD      ANDNE*ZEROS                                    E20085
     C**********           ADD  1         EC                              E20085
     C**********           MOVEA' 106'    ERR,EC                          E20085
     C**********           SETON                     42                   E20085
     C**********           END                                            E20085
      *                                                                   CSE031
      ** Allow Amendment of an Event type 'IR' which has been actioned    CSE031
      *                                                                   CSE031
     C           CSE031    IFEQ 'Y'                                       CSE031
     C           SSDET     ANDNE'IR'                                      CSE031
     C           CSE031    ORNE 'Y'                                       CSE031
      *                                                                   CSE031
     C**If 'Amend' mode, check event not already actioned                 E23259
     C*                                                                   E23259
     C           ACTC      IFEQ 'A'                                       E23259
     C           ZDAYNO    ANDLTRUND                                      E23259
     C           SDAD      ANDNE*ZEROS                                    E23259
     C                     ADD  1         EC                              E23259
     C                     MOVEA' 106'    ERR,EC                          E23259
     C                     SETON                     42                   E23259
     C                     END                                            E23259
      *                                                                   CSE031
     C                     ENDIF                                          CSE031
     C*
     C* If type 'IR', check event date matches a rate change date on
     C* security detail record - not if a Rate change frequency has been
     C* entered
     C*
     C           SSDET     IFEQ 'IR'
     C           ACTC      ANDEQ'I'                                       182505
     C           RCFQ      IFEQ ' '
     C                     Z-ADD*ZEROS    DAT
     C                     Z-ADD1         X       20
     C                     DO   12        X
     C           CD,X      IFNE *ZEROS
     C           *IN98     IFEQ '1'
     C                     MOVE CD,X      DAT,X
     C                     ELSE
     C                     MOVELCD,X      WK2N    20
     C                     MOVE WK2N      WK4N    40
     C                     MOVE CD,X      WK2N
     C                     MOVELWK2N      WK4N
     C                     MOVE WK4N      DAT,X
     C                     END
     C                     END
     C                     END
     C*
     C**Fetch*Issue*date*year******************************************   066635
     C**If*this*is*zero*use*initial*date*year**********************E14498 066635
     C**Also,*for*the*purposes*of*comparing*event*date*against*eachE14552 066635
     C**between*issue/initial*date*and*maturity,*put*the*relevant*dE14552 066635
     C**into*a*'work'*day*number*field.****************************E14552 066635
     C*****************************************************************   066635
     C***********          Z-ADDISSD      ZDAYNO                          066635
     C***********         *Z-ADDISSD      IDWORK  50               E14552 066635
     C*                                                                   066635
     C*** Find the year for the Event                                     066635
     C*                                                                   066635
     C                     Z-ADDEVTDNO    ZDAYNO                          066635
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     IYR     20
     C*                                                                   066635
     C***********IYR       IFEQ 0                                  E14498 066635
     C***********          Z-ADDITLD      ZDAYNO                   E14498 066635
     C***********          Z-ADDITLD      IDWORK                   E14552 066635
     C***********          EXSR ZDATE2                             E14498 066635
     C***********          MOVE ZDATE     IYR                      E14498 066635
     C***********          END                                     E14498 066635
     C*
     C* Fetch Maturity date year
     C*
     C                     Z-ADDMATY      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     MYR     20
     C*
     C* Assemble Event date into compatible format
     C* (And take date format M into consideration)                       E14498
     C*
     C                     MOVE SSDED     WK2N
     C                     MOVELWK2N      EVTDAT  60
     C           *IN98     IFEQ '1'                                       E14498
     C                     MOVELSSDED     WK4N                            E14498
     C                     ELSE                                           E14498
     C                     MOVE SSDED     WK4N
     C                     MOVELSSDED     WK2N
     C                     MOVE WK2N      WK4N
     C                     END                                            E14498
     C                     MOVE WK4N      EVTDAT
     C*****************************************************************   066635
     C**Compare*Event*date*against*each*year*between*Issue*date*and****   066635
     C**Maturity*date**************************************************   066635
     C*****************************************************************   066635
     C***********IDWORK    DOWLEMATY                               E14552 066635
     C*                                                                   066635
     C*** Only Compare Event date against the change date within the      066635
     C*** the event year.                                                 066635
     C*                                                                   066635
     C           MYR       IFLT 72                                        084187
     C           MYR       ADD  100       MYRC    30                      084187
     C                     ELSE                                           084187
     C                     Z-ADDMYR       MYRC                            084187
     C                     END                                            084187
     C           IYR       IFLT 72                                        084187
     C           IYR       ADD  100       IYRC    30                      084187
     C                     ELSE                                           084187
     C                     Z-ADDIYR       IYRC                            084187
     C                     END                                            084187
     C***********IYR       DOWLEMYR                                       E14552
     C***********IDWORK    DOWLEMATY                                E14552084187
     C           IYRC      DOWLEMYRC                                      084187
     C                     Z-ADD1         X
     C                     SETOF                     34
     C                     DO   12        X
     C           DAT,X     IFNE *ZEROS
     C                     MOVELIYR       DAT,X
     C*          EVTDAT    CABEQDAT,X     OUT1           34
     C           EVTDAT    IFEQ DAT,X
     C           CR,X      IFEQ 'R'
     C           CR,X      OREQ 'C'
     C/COPY WNCPYSRC,SE0130C042
     C           RCFQ      IFEQ ' '
     C                     SETON                     34
     C                     END
     C                     END
     C                     GOTO OUT1
     C                     END
     C*
     C                     END
     C                     END
     C           IYR       IFEQ 99                                        E21824
     C                     Z-ADD0         IYR                             E21824
     C                     ADD  1         IYRC                            084187
     C                     ELSE                                           E21824
     C                     ADD  1         IYR
     C                     ADD  1         IYRC                            084187
     C                     END                                            E21824
     C***********          ADD  366       IDWORK                    E14552E24879
     C*************************************************************E24879 066635
     C***If*IYR*contains*a*leap*year*add*366*to*IDWORK*else*add*365E24879 066635
     C*************************************************************E24879 066635
     C***********          Z-ADD0         @WRK1   70               E24879 066635
     C***********          Z-ADD0         @WRK2   75               E24879 066635
     C***********IYR       DIV  4         @WRK1                    E24879 066635
     C***********          MVR            @WRK2                    E24879 066635
     C***********@WRK2     IFGT 0                                  E24879 066635
     C***********          ADD  365       IDWORK                   E24879 066635
     C***********          ELSE                                    E24879 066635
     C***********          ADD  366       IDWORK                   E24879 066635
     C***********          END                                     E24879 066635
     C***********IYR       CABEQ*ZEROS    OUT1                            E21824
     C***********          END                                            066635
     C                     END
     C*
     C           OUT1      TAG                             *** OUT1 TAG **
     C           *IN34     IFEQ '0'
     C********** BCNV      ANDEQ' '                                                    182505 196599
     C                     ADD  1         EC
     C                     MOVEA' 107'    ERR,EC
     C                     SETON                     42
      *                                                                   182505
     C                     ELSE                                           182505
     C           SSDET     IFEQ 'IR'                                                          196599
     C           HOLI      ANDEQ'Y'                                                           196599
     C           SSDED     ANDNE'999999'                                                      196599
     C                     MOVE HDAYNO    #CPD                            182505
     C           BCNV      IFNE ' '                                       182505
     C           BCNV      ANDNE'N'                                       CSE031
     C           BCNV      IFEQ 'C'                                       182505
     C                     MOVE 'N'       NCI     1                       182505
     C                     ELSE                                           182505
     C                     MOVE 'L'       NCI     1                       182505
     C                     ENDIF                                          182505
     C                     CALL 'SE0045'                                  182505
     C                     PARM           SITP                            182505
     C                     PARM           #CPD                            182505
     C                     PARM           ITLD                            182505
     C                     PARM           FCPN                            182505
     C                     PARM           CD                              182505
     C                     PARM           CR                              182505
     C                     PARM           NMCY                            182505
     C                     PARM           #CPD                            182505
     C                     PARM           NCI                             182505
     C                     PARM           BCNV                            182505
     C                     PARM           MATY                            182505
     C                     PARM           LCPN                            CSE031
     C                     ENDIF                                          182505
     C                     MOVE #CPD      EVTDNO                                              196599
     C                     MOVE #CPD      ZDAYNO                                              196599
     C                     EXSR ZDATE2                                                        196599
     C                     MOVE ZDATE     SSDED1                                              196599
     C********** #CPD      IFNE EVTDNO                                                 182505 196599
     C**********           ADD  1         EC                                           182505 196599
     C**********           MOVEA' 107'    ERR,EC                                       182505 196599
     C**********           SETON                     42                                182505 196599
     C**********           ELSE                                                        182505 196599
     C**********           MOVE #CPD      ZDAYNO                                       182505 196599
     C**********           EXSR ZDATE2                                                 182505 196599
     C**********           MOVE ZDATE     SSDED1                                       182505 196599
     C**********           ENDIF                                                       182505 196599
      *                                                                   182505
      ** Check for duplicate key.                                         182505
      *                                                                   182505
     C           DEVKA     CHAINSEDEVDFX             33                   182505
     C           *IN33     IFEQ '0'                                       182505
     C           RECI      ANDNE'C'                                       182505
     C                     ADD  1         EC                              182505
     C                     MOVEA' 103'    ERR,EC                          182505
     C                     MOVE '1'       *IN41                           182505
     C                     ENDIF                                          182505
     C                     ENDIF                                                              196599
      *                                                                   182505
     C                     END
     C*
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END                                            E23897
     C*
     C* If Event type 'IR', validate Input and Amend modes
     C*
     C           SSDET     IFEQ 'IR'
     C           ACTC      IFEQ 'I'
     C           ACTC      OREQ 'A'
     C           EVTDNO    IFLT RUND
     C*
     C* Check no Trades input on this security
      ***  that have Value Date Greater Than or Equal To the Event Date   E20085
     C*
     C***********SSDSN     CHAINTRADSDF              33                   E20085
     C************IN33     IFEQ '0'                                       E20085
     C           SSDSN     SETLLTRADSDF                                   E20085
     C           SSDSN     READETRADSDF                  33               E20085
      *                                                                   E20085
     C           *IN33     DOWEQ'0'                                       E20085
     C           *IN42     ANDEQ'0'                                       E20085
      *                                                                   E20085
     C           TDVD      IFGE EVTDNO                                    E20085
     C                     ADD  1         EC
     C*                                                                   E20085
     C** Backvaluation of IR beyond live trade is now a warning error.    E20085
     C                     ADD  1         WEC                             E20085
     C***********          MOVEA' 108'    ERR,EC                          E20085
     C                     MOVEA' W13'    ERR,EC                          E20085
     C                     SETON                     42
     C                     ELSE                                           E20085
     C           SSDSN     READETRADSDF                  33               E20085
     C                     END
      *                                                                   E20085
     C                     END                                            E20085
     C*
     C* Check this event not before last 'IR' event
     C*
     C           SSDSN     SETGTSEDEVDFX
     C           2         OCUR DS01
      *
     C           AGAINA    TAG                             *** AGAINA ***
      *
     C                     READPSEDEVDFX                 33
     C*
     C* Check record is not a cancelled record
     C*
     C  N33      RECI      CABEQ'C'       AGAINA
     C*
     C* Check same Security
     C*
     C  N33      SDSN      COMP SSDSN                3333
     C   33                GOTO OUTA
     C*
     C* Check same Event type
     C*
     C           SDET      CABNE'IR'      AGAINA
     C*
     C           EVTDNO    IFLT SDED
     C                     ADD  1         EC
     C*                                                                   E20085
     C** Backvaluation of IR event beyond live IR is now a warning error. E20085
     C                     ADD  1         WEC                             E20085
     C***********          MOVEA' 109'    ERR,EC                          E20085
     C                     MOVEA' W14'    ERR,EC                          E20085
     C                     SETON                     42
     C                     END
     C*
     C           OUTA      TAG                             ** OUTA TAG **
     C           1         OCUR DS01
     C                     END
     C                     END
     C*
     C* If Rate change frequency is 'W', Check if date not equal to or a
     C* multiple of 7 days after Next change date  (or multiple of 7
     C* days before NCD if date < run date)
     C*
     C           RCFQ      IFEQ 'W'
     C           EVTDNO    ANDNENCHD                                      E20153
      *                                                                   E20153
     C***********EVTDNO    IFGE RUND                                      E19752
     C           EVTDNO    IFGT RUND                                      E19752
     C********** EVTDNO    IFNE NCHD                                      E20153
     C********** EVTDNO    SUB  NCHD      WORK5N  50   33                 E20153
     C********** *IN33     IFEQ '0'                                       E20153
      *                                                                   E20153
     C           EVTDNO    IFLT NCHD                                      E20153
     C                     ADD  1         WEC                             E20153
     C                     ADD  1         EC         42                   E20153
     C                     MOVEA' W15'    ERR,EC                          E20153
     C                     END                                            E20153
      *                                                                   E20153
     C           EVTDNO    SUB  NCHD      WORK5N  50                      E20153
     C           WORK5N    DIV  7         WORK5N
     C                     MVR            WORK1N  10 33
     C***********          END                                            E20153
     C*
     C           *IN33     IFEQ '1'
     C                     ADD  1         EC         42
     C                     MOVEA' 245'    ERR,EC
     C                     END                                            E20153
     C***********          END
     C*
     C                     ELSE
     C********** EVTDNO    IFNE NCHD                                      E20153
     C********** EVTDNO    SUB  NCHD      WORK5N  50 33                   E20153
     C********** *IN33     IFEQ '0'                                       E20153
      *                                                                   E20153
     C           EVTDNO    IFGT NCHD                                      E20153
     C                     ADD  1         WEC                             E20153
     C                     ADD  1         EC         42                   E20153
     C                     MOVEA' W15'    ERR,EC                          E20153
     C                     END                                            E20153
      *                                                                   E20153
     C           EVTDNO    SUB  NCHD      WORK5N  50                      E20153
     C           WORK5N    DIV  7         WORK5N
     C                     MVR            WORK1N  10 33
     C***********          END                                            E20153
     C*
     C           *IN33     IFEQ '1'
     C                     ADD  1         EC         42
     C                     MOVEA' 245'    ERR,EC
     C                     END
     C***********          END                                            E20153
     C                     END
     C                     END
     C*
     C* If Rate change frequency is 'F', Check if date not equal to or a
     C* multiple of 14 days after Next change date
     C*
     C           RCFQ      IFEQ 'F'
     C           EVTDNO    ANDNENCHD                                      E20153
      *                                                                   E20153
     C***********EVTDNO    IFGE RUND                                      E19752
     C           EVTDNO    IFGT RUND                                      E19752
     C********** EVTDNO    IFNE NCHD                                      E20153
     C********** EVTDNO    SUB  NCHD      WORK5N  50   33                 E20153
     C********** *IN33     IFEQ '0'                                       E20153
      *                                                                   E20153
     C           EVTDNO    IFLT NCHD                                      E20153
     C                     ADD  1         WEC                             E20153
     C                     ADD  1         EC         42                   E20153
     C                     MOVEA' W16'    ERR,EC                          E20153
     C                     END                                            E20153
      *                                                                   E20153
     C           EVTDNO    SUB  NCHD      WORK5N  50                      E20153
     C           WORK5N    DIV  14        WORK5N
     C                     MVR            WORK2N  20 33
     C***********          END                                            E20153
     C*
     C           *IN33     IFEQ '1'
     C                     ADD  1         EC         42
     C                     MOVEA' 246'    ERR,EC
     C                     END
     C***********          END                                            E20153
     C*
     C                     ELSE
     C********** EVTDNO    IFNE NCHD                                      E20153
     C********** EVTDNO    SUB  NCHD      WORK5N  50 33                   E20153
     C********** *IN33     IFEQ '0'                                       E20153
      *                                                                   E20153
     C           EVTDNO    IFGT NCHD                                      E20153
     C                     ADD  1         WEC                             E20153
     C                     ADD  1         EC         42                   E20153
     C                     MOVEA' W16'    ERR,EC                          E20153
     C                     END                                            E20153
      *                                                                   E20153
     C           EVTDNO    SUB  NCHD      WORK5N  50                      E20153
     C           WORK5N    DIV  14        WORK5N
     C                     MVR            WORK2N  20 33
     C**********           END                                            E20153
     C*
     C           *IN33     IFEQ '1'
     C                     ADD  1         EC         42
     C                     MOVEA' 246'    ERR,EC
     C                     END
     C**********           END                                            E20153
     C                     END
     C                     END
     C*
     C* If Rate change frequency is 'M', Check if date is not the same day
     C* of the month as as the Next change date
     C*
     C           RCFQ      IFEQ 'M'
     C           EVTDNO    ANDNENCHD
     C                     Z-ADDEVTDNO    ZDAYNO
     C                     EXSR ZDATE2
     C                     Z-ADDZDAY      EDAY
     C                     Z-ADDZMTH      EMTH
     C                     Z-ADDZYEAR     EYEAR
     C*
     C                     Z-ADDNCHD      ZDAYNO
     C                     EXSR ZDATE2
     C*
      * The Event Day is only allowed to differ from the Next Change      S01158
      *  Day for one of two reasons:-                                     S01158
      *  1 - The day prior to the Event Day is a holiday or               S01158
      *  2 - The two days are the last days of their respective months.   S01158
      *                                                                   S01158
     C           EDAY      IFNE ZDAY
      *                                                                   S01158
      * Check if day prior to the Event Day is a holiday.                 S01158
     C           EVTDNO    SUB  1         ZDAYNO                          S01158
     C           VLCY      IFEQ *BLANKS                                   S01158
     C                     MOVE NMCY      ZCCY                            S01158
     C                     ELSE                                           S01158
     C                     MOVE VLCY      ZCCY                            S01158
     C                     END                                            S01158
     C***********          MOVE *BLANK    ZOPT                     S01158 S01195
     C***********          EXSR ZDATE5                                    S01195
     C                     MOVE *BLANKS   ZLOC                            S01195
     C                     EXSR ZCHKH                                     S01195
      *                                                                   S01158
      * If it wasn't a holiday, check to see if the two days are at the   S01158
      *  ends of their months.                                            S01158
     C************IN99     IFEQ '0'                                       S01195
     C           ZIND      IFNE 'H'                                       S01195
     C           ZMTH      LOKUPTABMTH    TABDAY         33
     C           ZDAY      IFNE TABDAY
     C                     ADD  1         EC         42
     C                     MOVEA' 247'    ERR,EC
     C                     ELSE
     C           EMTH      LOKUPTABMTH    TABDAY         33
     C                     Z-ADDTABDAY    EOMDAY
     C           EMTH      IFEQ 2
     C           EYEAR     DIV  4         WORK2N
     C                     MVR            WORK1N         33
     C   33                ADD  1         EOMDAY
     C                     END
     C           EDAY      IFNE EOMDAY
     C                     ADD  1         EC         42
     C                     MOVEA' 247'    ERR,EC
     C                     END
     C                     END
     C                     END
     C                     END
     C*
     C                     END
     C                     END                                            S01158
     C*
     C* If Event type 'PP', validate Input and Amend modes
     C*
     C           SSDET     IFEQ 'PP'
     C           ACTC      IFEQ 'I'
     C           ACTC      OREQ 'A'
     C           EVTDNO    IFLT RUND
     C*
     C* Check no Trades input on this security
      ***  that have Value Date Greater Than or Equal To the Event Date   E20085
     C*
     C********** SSDSN     CHAINTRADSDF              33                   E20085
     C********** *IN33     IFEQ '0'                                       E20085
     C           SSDSN     SETLLTRADSDF                                   E20085
     C           SSDSN     READETRADSDF                  33               E20085
      *                                                                   E20085
     C           *IN33     DOWEQ'0'                                       E20085
     C           *IN42     ANDEQ'0'                                       E20085
      *                                                                   E20085
     C           TDVD      IFGE EVTDNO                                    E20085
     C                     ADD  1         EC
     C                     MOVEA' 110'    ERR,EC
     C                     SETON                     42
     C                     ELSE                                           E20085
     C           SSDSN     READETRADSDF                  33               E20085
     C                     END
      *                                                                   E20085
     C                     END                                            E20085
     C*
     C* Check this event not before last 'PP' event
     C*
     C           SSDSN     SETGTSEDEVDFX
     C           2         OCUR DS01
      *
     C           AGAINB    TAG                             *** AGAINB ***
      *
     C                     READPSEDEVDFX                 33
     C*
     C* Check record is not a cancelled record
     C*
     C  N33      RECI      CABEQ'C'       AGAINB
     C*
     C* Check same Security
     C*
     C  N33      SDSN      COMP SSDSN                3333
     C   33                GOTO OUTB
     C*
     C* Check same Event type
     C*
     C           SDET      CABNE'PP'      AGAINB
     C*
     C           EVTDNO    IFLT SDED
     C                     ADD  1         EC
     C                     MOVEA' 111'    ERR,EC
     C                     SETON                     42
     C                     END
     C*
     C           OUTB      TAG                             ***  OUTB  ***
     C           1         OCUR DS01
     C*
     C                     END
     C                     END
     C                     END
     C*
     C* Event date can not be before run date for following codes
     C*
     C           SSDET     IFEQ 'RC'
     C           SSDET     OREQ 'RP'
     C           SSDET     OREQ 'CV'
     C           SSDET     OREQ 'BI'
     C           SSDET     OREQ 'RI'
     C           SSDET     OREQ 'CR'
     C           SSDET     OREQ 'OC'
     C/COPY WNCPYSRC,SE0130C017
     C           ACTC      IFEQ 'I'
     C           ACTC      OREQ 'A'
     C***********ZDAYNO    IFLT RUND                                      S01158
     C           EVTDNO    IFLT RUND                                      S01158
     C                     ADD  1         EC
     C                     MOVEA' 112'    ERR,EC
     C                     SETON                     42
     C                     END
     C                     END
     C                     END
     C/COPY WNCPYSRC,SE0130C009
     C*
     C* Event type - Check for allowable entries
     C*
     C           SSDET     IFEQ '  '
     C           SSDET     ORNE 'DV'
     C           SSDET     ANDNE'PP'
     C           SSDET     ANDNE'MP'
     C           SSDET     ANDNE'IR'
     C           SSDET     ANDNE'XR'
     C           SSDET     ANDNE'RC'
     C           SSDET     ANDNE'RP'
     C           SSDET     ANDNE'CV'
     C           SSDET     ANDNE'BI'
     C           SSDET     ANDNE'RI'
     C           SSDET     ANDNE'CR'
     C           SSDET     ANDNE'OC'
     C/COPY WNCPYSRC,SE0130C010
     C                     ADD  1         EC
     C                     MOVEA' 121'    ERR,EC
     C                     SETON                     43
     C                     ELSE
     C/COPY WNCPYSRC,SE0130C011
     C*
     C* If entry 'DV', check Investment type is a share (PROT '4')
     C*
     C           SSDET     IFEQ 'DV'
     C           ITPKA     CHAININVTPDF              33
     C           PROT      IFNE '4'
     C           PROT      ANDNE'7'                                       179359
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0130CP11                                           S01408
     C*                                                                   S01408
     C                     ADD  1         EC
     C                     MOVEA' 113'    ERR,EC
     C                     SETON                     43
     C                     END
     C                     END
     C/COPY WNCPYSRC,SE0130C027
     C*
     C* Entry 'PP' but Security is not partly-paid
     C*
     C           SSDET     IFEQ 'PP'
     C           PPDI      ANDNE'Y'
     C                     ADD  1         EC
     C                     MOVEA' 114'    ERR,EC
     C                     SETON                     43
     C                     END
     C* Entry 'PP' but Security is not COMPLETE                           E15930
     C*                                                                   E15930
     C           SSDET     IFEQ 'PP'                                      E15930
     C           INCS      ANDNE'C'                                       E15930
     C                     ADD  1         EC                              E15930
     C                     MOVEA' 131'    ERR,EC                          E15930
     C                     SETON                     43                   E15930
     C                     END                                            E15930
     C*
     C* If entry 'MP', check Investment type is Mortgage backed (PROT '8')
     C*
     C           SSDET     IFEQ 'MP'
     C           ITPKA     CHAININVTPDF              33
     C           PROT      IFNE '8'
     C                     ADD  1         EC
     C                     MOVEA' 115'    ERR,EC
     C                     SETON                     43
     C                     END
     C                     END
     C/COPY WNCPYSRC,SE0130C028
     C*
     C* If entry 'IR', check Investment type is either a Floating Rate
     C* Note (PROT '3'), a Yen Bond (PROT '5') or a Mortgage Backed
     C* Security (PROT '8')
     C*
     C           SSDET     IFEQ 'IR'
     C           ITPKA     CHAININVTPDF              33
     C           PROT      IFNE '3'
     C           PROT      ANDNE'5'
     C           PROT      ANDNE'8'
     C/COPY WNCPYSRC,SE0130C043
     C                     ADD  1         EC
     C                     MOVEA' 116'    ERR,EC
     C                     SETON                     43
     C                     END
     C                     END
     C*
     C* If entry 'XR', check for Multi-currency or Value currency
     C*
     C           SSDET     IFEQ 'XR'
     C           MLTI      ANDNE'Y'
     C           S01509    ANDEQ'N'                                       S01509
     C           VLCY      IFEQ '   '
     C           VLCY      OREQ NMCY
     C                     ADD  1         EC
     C                     MOVEA' 117'    ERR,EC
     C                     SETON                     43
     C                     END
     C                     END
     C*
     C* If entry 'RC', check for Early Repayment indicator
     C*
     C           SSDET     IFEQ 'RC'
     C           ERPY      ANDNE'Y'
     C           EVTDNO    ANDNEMATY
     C                     ADD  1         EC
     C                     MOVEA' 118'    ERR,EC
     C                     SETON                     43
     C                     END
     C*
     C* If entry 'RP', check for Early Repayment indicator
     C*
     C           SSDET     IFEQ 'RP'
     C           ERPY      ANDNE'Y'
     C           EVTDNO    ANDNEMATY
     C                     ADD  1         EC
     C                     MOVEA' 119'    ERR,EC
     C                     SETON                     43
     C                     END
     C*
     C* If entry 'CV', check for Convertible indicator
     C*
     C           SSDET     IFEQ 'CV'
     C           ITPKA     CHAININVTPDF              33
     C           CNVI      IFNE 'Y'
     C                     ADD  1         EC
     C                     MOVEA' 120'    ERR,EC
     C                     SETON                     43
     C                     END
     C                     END
     C/COPY WNCPYSRC,SE0130C012
     C*
     C                     END
     C*
     C                     ENDSR
     C*
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  VLDSEC - Subroutine to validate entries made on the Second   *
      *           Screen.                                             *
      *                                                               *
      *****************************************************************
      *
     C           VLDSEC    BEGSR                           *** VLDSEC ***
     C*
     C* Setof error indicators
     C*
     C                     Z-ADD*ZEROS    EC
     C                     Z-ADD*ZEROS    WEC
     C                     MOVE *BLANKS   ERRMSG
     C                     MOVEA'00000000'*IN,50
     C                     MOVEA'00000000'*IN,58
     C                     MOVEA'00'      *IN,66
     C                     MOVE '0'       *IN49                           S01510
     C                     MOVE '0'       *IN57                           S01509
     C                     MOVE '0'       *IN65                           S01509
     C/COPY WNCPYSRC,SE0130C018
     C* ZEROISE WORK FIELDS                                               E15930
     C                     Z-ADD*ZEROS    ORIDTA                          E15930
     C                     Z-ADD*ZEROS    ORIDTP                          E15930
     C*
     C* Dividends Declared
     C*
     C           SSDET     IFEQ 'DV'
     C*
     C* Amount per unit
     C*
     C           SSDDV     IFEQ *BLANKS
     C                     ADD  1         EC
     C                     MOVEA' 200'    ERR,EC
     C                     SETON                     50
     C                     ELSE
     C*
     C* Check valid number
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SSDDV     ZFIELD
     C***********          Z-ADD9         ZADIG                           E16772
     C***********          Z-ADD4         ZADEC                           E16772
     C                     Z-ADD5         ZADIG                           E16772
     C                     Z-ADD8         ZADEC                           E16772
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 201'    ERR,EC
     C                     SETON                     50
     C                     END
     C                     END
     C*
     C* Narrative
     C*
     C           NAR1      IFEQ *BLANKS
     C                     ADD  1         EC
     C                     MOVEA' 202'    ERR,EC
     C                     SETON                     51
     C                     END
     C*
     C* Payment date
     C*
     C                     MOVE SSDPD     DATEN
     C                     MOVE DATEN     DATEA
     C           SSDPD     IFNE DATEA
     C                     ADD  1         EC
     C                     MOVEA' 203'    ERR,EC
     C                     SETON                     52
     C                     ELSE
     C                     MOVE SSDPD     ZDATE
     C                     EXSR ZDATE1
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 203'    ERR,EC
     C                     SETON                     52
     C                     ELSE
     C*
     C* Check not after Event date
     C*
     C           ZDAYNO    IFLT EVTDNO
     C                     ADD  1         EC
     C                     MOVEA' 204'    ERR,EC
     C                     SETON                     52
     C                     END
     C*
     C* Check not holiday in value currency (nominal if blank)
     C*    WARNING ERROR ONLY - check only if changed
     C*
     C           VLCY      IFNE '   '
     C                     MOVE VLCY      ZCCY
     C                     ELSE
     C                     MOVE NMCY      ZCCY
     C                     END
      *
     C***********          EXSR ZDATE5                                    S01195
     C                     MOVE *BLANKS   ZLOC                            S01195
     C                     EXSR ZCHKH                                     S01195
     C************IN99     IFEQ '1'                                       S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C                     ADD  1         EC
     C                     ADD  1         WEC
     C                     MOVEA' W11'    ERR,EC
     C                     SETON                     52
     C                     END
      *
     C                     Z-ADDZDAYNO    PDAYNO
     C                     END
     C                     END
      *                                                                   S01510
     C           S01510    IFEQ 'Y'                                       S01510
      * Ex-Date - validate if not blank and not past event date           S01510
     C           SSDXD     IFEQ *BLANKS                                   S01510
     C                     ADD  1         EC                              S01510
     C                     MOVEA' 254'    ERR,EC                          S01510
     C                     MOVE '1'       *IN49                           S01510
     C                     ELSE                                           S01510
     C                     MOVE SSDXD     DATEN                           S01510
     C                     MOVE DATEN     DATEA                           S01510
     C           SSDXD     IFNE DATEA                                     S01510
     C                     ADD  1         EC                              S01510
     C                     MOVEA' 255'    ERR,EC                          S01510
     C                     MOVE '1'       *IN49                           S01510
     C                     ELSE                                           S01510
     C                     MOVE SSDXD     ZDATE                           S01510
     C                     EXSR ZDATE1                                    S01510
     C           *IN99     IFEQ '1'                                       S01510
     C                     ADD  1         EC                              S01510
     C                     MOVEA' 255'    ERR,EC                          S01510
     C                     MOVE '1'       *IN49                           S01510
     C                     ELSE                                           S01510
     C           ZDAYNO    IFGT EVTDNO                                    S01510
     C                     ADD  1         EC                              S01510
     C                     MOVEA' 256'    ERR,EC                          S01510
     C                     MOVE '1'       *IN49                           S01510
     C                     END                                            S01510
     C                     END                                            S01510
     C                     END                                            S01510
     C                     END                                            S01510
     C                     END                                            S01510
     C*
     C/COPY WNCPYSRC,SE0130C033
     C                     END
     C*
     C* Partly Paids
     C*
     C           SSDET     IFEQ 'PP'
     C*
     C* Call Amount - required if entry is a share
     C*
     C           *IN12     IFEQ '1'
     C           CAMT      ANDEQ*BLANKS
     C                     ADD  1         EC
     C                     MOVEA' 205'    ERR,EC
     C                     SETON                     53
     C                     END
     C*
     C* Check for valid number
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE CAMT      ZFIELD
     C*
     C* Use number of decimal places from Nominal currency
     C*
     C***********          MOVE *BLANKS   KEY12A                          S01117
     C***********          MOVELNMCY      WORK4                           S01117
     C***********          MOVE '1'       WORK4                           S01117
     C***********          MOVEL'20'      KEY12A                          S01117
     C***********          MOVE WORK4     KEY12A                          S01117
     C***********TABKA     CHAINTABTG10F             33                   S01117
     C                     MOVE NMCY      @AJCD   3                       S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM           @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C***********15        SUB  CDP       ZADIG                           S01117
     C***********          Z-ADDCDP       ZADEC                           S01117
     C           15        SUB  A6NBDP    ZADIG                           S01117
     C                     Z-ADDA6NBDP    ZADEC                           S01117
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 207'    ERR,EC
     C                     SETON                     53
     C                     ELSE
     C                     MOVE ZFIELD    CALAMT
     C**
     C* IF IT IS AN AMENDMENT, CHAIN TO THE RECORD TO GET THE ORIGINAL    E19763
     C* AMOUNT THAT WAS KEYED IN EARLIER.                                 E19763
     C           ACTC      IFEQ 'A'                                       E19763
     C           DEVKA     CHAINSEDEVDFX             33                   E19763
     C                     Z-ADDSDPP      OLDSPP                          E19763
     C                     END                                            E19763
     C*
     C* Fetch total Paid for this security
     C*
     C           SSDSN     SETGTSEDEVDFX
     C           2         OCUR DS01
     C                     Z-ADD*ZEROS    SDTA
      *
     C           AGAIN1    TAG                             *** AGAIN1 ***
      *
     C                     READPSEDEVDFX                 33
     C*
     C* Check record is not a cancelled record
     C*
     C  N33      RECI      CABEQ'C'       AGAIN1
     C*
     C* Check same Security
     C*
     C  N33      SDSN      COMP SSDSN                3333
      *
     C* IF 33 ON ==> THERE IS NO PP RECORDS ON DIARY FOR THE SECURITY     E15930
     C   33                MOVE CPDP      SDTA                            E15930
     C   33                MOVE CPDP      ORIDTA                          E15930
     C   33                GOTO OUT2
     C*
     C* Check same Event type
     C*
     C           SDET      CABNE'PP'      AGAIN1
     C*
     C* Check total will not exceed Fully Paid Price
     C*
     C           OUT2      TAG                             ***  OUT2  ***
     C*
     C           SDTA      ADD  CALAMT    TOTAM
     C*                                                                   E19763
     C* IF AMENDMENT, SUBTRACT THE ORIGINAL AMT THAT WAS ENTERED          E19763
     C*                                                                   E19763
     C           ACTC      IFEQ 'A'                                       E19763
     C           TOTAM     SUB  OLDSPP    TOTAM                           E19763
     C                     END                                            E19763
     C*                                                                   E19763
     C           TOTAM     IFGT SFPP
     C                     ADD  1         EC
     C                     MOVEA' 206'    ERR,EC
     C                     SETON                     53
     C                     END
     C*
     C           1         OCUR DS01
     C                     END
     C*
     C* Call Percentage - required if entry is a share
     C*
     C           *IN13     IFEQ '1'
     C           *IN14     ANDEQ'1'
     C           CPRI      ANDEQ*BLANKS
     C                     ADD  1         EC
     C                     MOVEA' 208'    ERR,EC
     C                     SETON                     54
     C                     END
     C*
     C* Check for valid number
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE CPRI      ZFIELD
     C                     Z-ADD3         ZADIG
     C                     Z-ADD3         ZADEC
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 210'    ERR,EC
     C                     SETON                     54
     C                     ELSE
     C                     MOVE ZFIELD    CALPC
     C**
     C* IF IT IS AN AMENDMENT, CHAIN TO THE RECORD TO GET THE ORIGINAL    E19763
     C* AMOUNT THAT WAS KEYED IN EARLIER.                                 E19763
     C           ACTC      IFEQ 'A'                                       E19763
     C           DEVKA     CHAINSEDEVDFX             33                   E19763
     C                     Z-ADDSDPC      OLDSPC                          E19763
     C                     END                                            E19763
     C*
     C* Fetch total Percentage for this security
     C*
     C           SSDSN     SETGTSEDEVDFX
     C           2         OCUR DS01
      *
     C           AGAIN2    TAG                             *** AGAIN2 ***
      *
     C                     READPSEDEVDFX                 33
     C*
     C* Check record is not a cancelled record
     C*
     C  N33      RECI      CABEQ'C'       AGAIN2
     C*
     C* Check same Security
     C*
     C  N33      SDSN      COMP SSDSN                3333
      *
     C* IF 33 ON ==> THERE IS NO PP RECORDS ON DIARY FOR THE SECURITY     E15930
     C   33                MOVE CPDP      SDTP                            E15930
     C   33                MOVE CPDP      ORIDTP                          E15930
     C   33                GOTO OUT3
     C*
     C* Check same Event type
     C*
     C           SDET      CABNE'PP'      AGAIN2
     C*
     C* Check total will not exceed 100%
     C*
     C           OUT3      TAG                             ***  OUT3  *** E15930
     C           SDTP      ADD  CALPC     TOTPC   63
     C*
     C* IF AMENDMENT, SUBTRACT THE ORIGINAL AMT THAT WAS ENTERED
     C*
     C           ACTC      IFEQ 'A'                                       E19763
     C           TOTPC     SUB  OLDSPC    TOTPC                           E19763
     C                     END                                            E19763
     C*                                                                   E19763
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0130CCP5                                           S01408
     C*                                                                   S01408
     C           TOTPC     IFGT 100
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0130CCP6                                           S01408
     C*                                                                   S01408
     C                     ADD  1         EC
     C                     MOVEA' 209'    ERR,EC
     C                     SETON                     54
     C                     END
     C*
     C***********OUT3      TAG                             ***  OUT3  *** E15930
     C           1         OCUR DS01
     C                     END
     C*
     C* Narrative
     C*
     C           NAR1      IFEQ *BLANKS
     C                     ADD  1         EC
     C                     MOVEA' 211'    ERR,EC
     C                     SETON                     51
     C                     END
     C*
     C                     END
     C*
     C* Mortgage Payments
     C*
     C           SSDET     IFEQ 'MP'
     C/COPY WNCPYSRC,SE0130C029
     C*
     C* Current factor - must not be blank if Repayment amount also
     C* blank
     C*
     C           SSDCP     IFEQ *BLANKS
     C           SSRPT     IFEQ *BLANKS
     C                     ADD  1         EC
     C                     MOVEA' 212'    ERR,EC
     C                     SETON                     55
     C                     END
     C*                                                                   E15236
     C* Current factor entered, error if Repayment amount also entered    E15236
     C*                                                                   E15236
     C                     ELSE
     C           SSRPT     IFNE *BLANKS                                   E15236
     C                     ADD  1         EC                              E15236
     C                     MOVEA' 212'    ERR,EC                          E15236
     C                     SETON                     55                   E15236
     C                     END                                            E15236
     C*
     C* Check valid number
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SSDCP     ZFIELD
     C                     Z-ADD1         ZADIG
     C**********           Z-ADD8         ZADEC                           052254
     C                     Z-ADD9         ZADEC                           055254
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 213'    ERR,EC
     C                     SETON                     55
     C                     ELSE
     C*
     C* Check value not greater than 1
     C*
     C**********           MOVE ZFIELD    WK18    98                      052254
     C                     MOVE ZFIELD    WK18                            052254
     C/COPY WNCPYSRC,SE0130C021
     C           WK18      IFGT 1
     C                     ADD  1         EC
     C                     MOVEA' 213'    ERR,EC
     C                     SETON                     55
     C                     END
     C/COPY WNCPYSRC,SE0130C022
     C                     END
     C/COPY WNCPYSRC,SE0130C023
     C*
     C**  Check not greater than secty current factor
     C*
     C           SSDCP     IFNE *BLANKS
     C***********WK18      ANDGECFCT                                      E14856
     C           WK18      ANDGTCFCT                                      E14856
     C           SSDET     ANDEQ'MP'
     C                     ADD  1         EC
     C                     MOVEA' 249'    ERR,EC
     C                     SETON                     55
     C                     END
     C/COPY WNCPYSRC,SE0130C024
     C*
     C* The previous 'MP' record cannot have a Repayment method indicator
     C* of 'Y'
     C*
     C           DEVKA     SETLLSEDEVDFX
     C*
     C           2         OCUR DS01
     C           AGAIN7    TAG                             *** AGAIN7 ***
     C                     READPSEDEVDFX                 33
     C*
     C* Check record is not a cancelled record
     C*
     C  N33      RECI      CABEQ'C'       AGAIN7
     C*
     C* Check same Security
     C*
     C  N33      SDSN      COMP SSDSN                3333
     C   33                GOTO OUT8
     C*
     C* Check same Event type
     C*
     C           SDET      CABNE'MP'      AGAIN7
     C*
     C           SRMI      IFEQ 'Y'
     C                     ADD  1         EC
     C                     MOVEA' 248'    ERR,EC
     C                     SETON                     56
     C                     END
     C*
     C           OUT8      TAG                             ***  OUT8  ***
      *
     C           1         OCUR DS01
     C*
     C* The next 'MP' record cannot have a Repayment method indicator
     C* of 'Y'
     C*
     C           DEVKA     SETLLSEDEVDFX
     C*
     C           2         OCUR DS01
      *
     C           AGAIN9    TAG                             *** AGAIN9 ***
      *
     C                     READ SEDEVDFX                 33
     C*
     C* Check record is not a cancelled record
     C*
     C  N33      RECI      CABEQ'C'       AGAIN9
     C*
     C* Check same Security
     C*
     C  N33      SDSN      COMP SSDSN                3333
     C   33                GOTO OUT10
     C*
     C* Check same Event type
     C*
     C           SDET      CABNE'MP'      AGAIN9
     C*
     C           SRMI      IFEQ 'Y'
     C                     ADD  1         EC
     C                     MOVEA' 245'    ERR,EC
     C                     SETON                     56
     C                     END
     C*
     C           OUT10     TAG                             ***  OUT10  ***
      *
     C           1         OCUR DS01
     C*
     C                     END
     C*
     C* Repayment amount - must not be blank if Current factor also
     C* blank
     C*
     C           SSRPT     IFEQ *BLANKS
     C           SSDCP     IFEQ *BLANKS
     C                     ADD  1         EC
     C                     MOVEA' 215'    ERR,EC
     C                     SETON                     56
     C                     END
     C                     ELSE
      *
      ***  The previous 'MP' record cannot have a Repayment Method
      ***  Indicator of ' '.
      *
     C           DEVKA     SETLLSEDEVDFX
     C*
     C                     Z-ADD*ZEROS    SVSDTR
     C           2         OCUR DS01
      *
     C           AGAIN3    TAG                             *** AGAIN3 ***
      *
     C                     READPSEDEVDFX                 33
     C*
     C* Check record is not a cancelled record
     C*
     C  N33      RECI      CABEQ'C'       AGAIN3
     C*
     C* Check same Security
     C*
     C  N33      SDSN      COMP SSDSN                3333
     C   33                GOTO OUT4
     C*
     C* Check same Event type
     C*
     C           SDET      CABNE'MP'      AGAIN3
     C*
     C           SRMI      IFEQ ' '
     C                     ADD  1         EC
     C                     MOVEA' 214'    ERR,EC
     C                     SETON                     56
     C                     END
     C*
     C* Save previous total repaid
     C*
     C                     Z-ADDSDTR      SVSDTR
     C*
     C           OUT4      TAG                             ***  OUT4  ***
      *
     C           1         OCUR DS01
     C*
     C* The next 'MP' record cannot have a Repayment method indicator
     C* of ' '
     C*
     C           DEVKA     SETLLSEDEVDFX
     C*
     C           2         OCUR DS01
      *
     C           AGAIN8    TAG                             *** AGAIN8 ***
      *
     C                     READ SEDEVDFX                 33
     C*
     C* Check record is not a cancelled record
     C*
     C  N33      RECI      CABEQ'C'       AGAIN8
     C*
     C* Check same Security
     C*
     C  N33      SDSN      COMP SSDSN                3333
     C   33                GOTO OUT9
     C*
     C* Check same Event type
     C*
     C           SDET      CABNE'MP'      AGAIN8
     C*
     C           SRMI      IFEQ ' '
     C                     ADD  1         EC
     C                     MOVEA' 214'    ERR,EC
     C                     SETON                     56
     C                     END
     C*
     C           OUT9      TAG                             ***  OUT9  ***
     C           1         OCUR DS01
     C*
     C* Check valid number
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SSRPT     ZFIELD
     C                     Z-ADD15        ZADIG
     C                     Z-ADD*ZERO     ZADEC
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 216'    ERR,EC
     C                     SETON                     56
     C                     ELSE
     C                     MOVE ZFIELD    SCSRPT
     C*
     C* Check amount entered not greater than amount outstanding
     C*
     C           ISSA      SUB  SVSDTR    AMTOS
     C           SCSRPT    IFGT AMTOS
     C                     ADD  1         EC
     C                     MOVEA' 217'    ERR,EC
     C                     SETON                     56
     C                     END
     C                     END
     C                     END
     C*
     C* Payment date - Must be entered
     C*
     C           SSDPD     IFEQ *BLANKS
     C                     ADD  1         EC
     C                     MOVEA' 218'    ERR,EC
     C                     SETON                     52
     C                     ELSE
     C*
     C* Check date valid
     C*
     C                     MOVE SSDPD     DATEN
     C                     MOVE DATEN     DATEA
     C           SSDPD     IFNE DATEA
     C                     ADD  1         EC
     C                     MOVEA' 219'    ERR,EC
     C                     SETON                     52
     C                     ELSE
     C                     MOVE SSDPD     ZDATE
     C                     EXSR ZDATE1
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 219'    ERR,EC
     C                     SETON                     52
     C                     ELSE
     C*
     C* Check not before Event date
     C*
     C           ZDAYNO    IFLT EVTDNO
     C                     ADD  1         EC
     C                     MOVEA' 220'    ERR,EC
     C                     SETON                     52
     C                     END
     C*
     C* Check not holiday in value currency (nominal if blank)
     C*    WARNING ERROR ONLY - check only if changed
     C*
     C           VLCY      IFNE '   '
     C                     MOVE VLCY      ZCCY
     C                     ELSE
     C                     MOVE NMCY      ZCCY
     C                     END
     C***********          EXSR ZDATE5                                    S01195
     C                     MOVE *BLANKS   ZLOC                            S01195
     C                     EXSR ZCHKH                                     S01195
     C************IN99     IFEQ '1'                                       S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C                     ADD  1         WEC
     C                     ADD  1         EC
     C                     MOVEA' W12'    ERR,EC
     C                     SETON                     52
     C                     END
     C                     Z-ADDZDAYNO    PDAYNO
     C                     END
     C*
     C                     END
     C                     END
     C*
     C* Narrative - Mandatory entry
     C*
     C           NAR2      IFEQ *BLANKS
     C                     ADD  1         EC
     C                     MOVEA' 221'    ERR,EC
     C                     SETON                     51
     C                     END
     C*
     C                     END
     C/COPY WNCPYSRC,SE0130C030
     C*
     C* Interest Rate Change
     C*
     C           SSDET     IFEQ 'IR'
     C*
     C* Next Coupon Rate - Mandatory entry
     C*
     C           SSDNC     IFEQ *BLANKS
     C/COPY WNCPYSRC,SE0130C044
     C                     ADD  1         EC
     C                     MOVEA' 222'    ERR,EC
     C                     SETON                     58
     C                     ELSE
     C*
     C* Check valid number
     C* And that it is not lesser than the Minimum Coupon
     C*                                                                   E19447
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SSDNC     ZFIELD
     C                     Z-ADD4         ZADIG
     C                     Z-ADD7         ZADEC
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 223'    ERR,EC
     C                     SETON                     58
     C                     ELSE                                           E19447
     C                     MOVE ZFIELD    SDNC                            E19447
     C           SDNC      COMP MCPN                   33                 E19447
     C*                                                                   E19447
     C           *IN33     IFEQ '1'                                       E19447
     C                     ADD  1         EC                              E19447
     C                     MOVEA' 323'    ERR,EC                          E19447
     C                     SETON                     58                   E19447
     C                     END                                            E19447
     C*                                                                   E19447
     C                     END
     C/COPY WNCPYSRC,SE0130C045
     C                     END
     C*
     C                     END
     C*
     C* Exchange Rates
     C*
     C           SSDET     IFEQ 'XR'
     C*
     C* Payment currency - Not equal to Value currency on Security for a
     C* dual currency security
     C*
     C           PAYC      IFNE '   '
     C           VLCY      IFNE NMCY
     C           PAYC      ANDNEVLCY
     C                     ADD  1         EC
     C                     MOVEA' 224'    ERR,EC
     C                     SETON                     59
     C                     END
     C*
     C* Check valid currency
     C*
     C***********          MOVE *BLANKS   KEY12A                          S01117
     C***********          MOVELPAYC      WORK4   4                       S01117
     C***********          MOVE '1'       WORK4                           S01117
     C***********          MOVEL'20'      KEY12A                          S01117
     C***********          MOVE WORK4     KEY12A                          S01117
     C***********TABKA     CHAINTABTG10F             33                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM PAYC      @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C************IN33     IFEQ '1'                                       S01117
     C                     ADD  1         EC
     C                     MOVEA' 225'    ERR,EC
     C                     SETON                     59
     C***********          ELSE                                           S01117
     C***********RECI      IFEQ '*'                                       S01117
     C***********          ADD  1         EC                              S01117
     C***********          MOVEA' 225'    ERR,EC                          S01117
     C***********          SETON                     59                   S01117
     C***********          END                                            S01117
     C                     END
     C                     END
     C*
     C* Cut Coupon Exchange Rate - Mandatory entry
     C*
     C           CUTR      IFEQ *BLANKS
     C                     ADD  1         EC
     C                     MOVEA' 226'    ERR,EC
     C                     SETON                     60
     C                     ELSE
     C*
     C* Check valid number
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE CUTR      ZFIELD
     C                     Z-ADD5         ZADIG
     C                     Z-ADD8         ZADEC
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 227'    ERR,EC
     C                     SETON                     60
     C                     END
     C                     END
     C*
     C* Mulitply/Divide indicator - Can only be 'M' or 'D'
     C*
     C           SSDMD     IFNE 'M'
     C           SSDMD     ANDNE'D'
     C                     ADD  1         EC
     C                     MOVEA' 228'    ERR,EC
     C                     SETON                     61
     C                     END
     C*
     C                     END
     C*
     C* Redemption Calls
     C*
     C           SSDET     IFEQ 'RC'
     C*
     C* Call amount - check valid number
     C*
     C           CLAT      IFNE *BLANKS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE CLAT      ZFIELD
     C                     Z-ADD11        ZADIG
     C                     Z-ADD*ZERO     ZADEC
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 229'    ERR,EC
     C                     SETON                     53
     C                     END
     C                     END
     C*
     C* Call Percentage - check valid number
     C*
     C           CPRI      IFNE *BLANKS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE CPRI      ZFIELD
     C                     Z-ADD3         ZADIG
     C                     Z-ADD3         ZADEC
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 230'    ERR,EC
     C                     SETON                     54
     C                     END
     C                     END
     C*
     C* Entry not valid if Call amount entered
     C*
     C           CPRI      IFNE *BLANKS
     C           CLAT      ANDNE*BLANKS
     C                     ADD  1         EC
     C                     MOVEA' 231'    ERR,EC
     C                     SETON                     54
     C                     END
     C*
     C* Redemption Price - check valid number
     C*
     C           RAMT      IFNE *BLANKS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE RAMT      ZFIELD
     C                     Z-ADD7         ZADIG
     C                     Z-ADD8         ZADEC
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 232'    ERR,EC
     C                     SETON                     67
     C                     END
     C                     END
     C*                                                                   S01509
     C           S01509    IFEQ 'Y'                                       S01509
     C* Redemption Currency - check if not blank and exists in file       S01509
     C*                                                                   S01509
     C           RCCCY     IFNE *BLANKS                                   S01509
     C                     MOVE RCCCY     @AJCD   3                       S01509
     C                     CALL 'AOCURRR0'                                S01509
     C                     PARM '       ' @RTCD   7                       S01509
     C                     PARM '*VERIFY' @OPTN   7                       S01509
     C                     PARM           @AJCD   3                       S01509
     C           SDCURR    PARM SDCURR    DSSDY                           S01509
     C           @RTCD     IFNE *BLANKS                                   S01509
     C                     ADD  1         EC                              S01509
     C                     MOVEA' 250'    ERR,EC                          S01509
     C                     SETON                     57                   S01509
     C                     END                                            S01509
     C                     ELSE                                           S01509
     C                     ADD  1         EC                              S01509
     C                     MOVEA' 251'    ERR,EC                          S01509
     C                     SETON                     57                   S01509
     C                     END                                            S01509
     C*                                                                   S01509
     C* Exchange Rate - check valid number                                S01509
     C           XRATE     IFNE *BLANKS                                   S01509
     C                     MOVE *BLANKS   ZFIELD                          S01509
     C                     MOVE XRATE     ZFIELD                          S01509
     C                     Z-ADD5         ZADIG                           S01509
     C                     Z-ADD8         ZADEC                           S01509
     C                     EXSR ZALIGN                                    S01509
     C           *IN99     IFEQ '1'                                       S01509
     C                     ADD  1         EC                              S01509
     C                     MOVEA' 252'    ERR,EC                          S01509
     C                     SETON                     65                   S01509
     C                     END                                            S01509
     C                     ELSE                                           S01509
     C                     ADD  1         EC                              S01509
     C                     MOVEA' 253'    ERR,EC                          S01509
     C                     SETON                     65                   S01509
     C                     END                                            S01509
     C*                                                                   S01509
     C* Mulitply/Divide indicator - Can only be 'M' or 'D'                S01509
     C*                                                                   S01509
     C           RCDMD     IFNE 'M'                                       S01509
     C           RCDMD     ANDNE'D'                                       S01509
     C                     ADD  1         EC                              S01509
     C                     MOVEA' 228'    ERR,EC                          S01509
     C                     SETON                     61                   S01509
     C                     END                                            S01509
     C*                                                                   S01509
     C                     END                                            S01509
     C*                                                                   S01509
     C                     END
     C*
     C* Redemption Puts
     C*
     C           SSDET     IFEQ 'RP'
     C*
     C* Put amount - check valid number
     C*
     C           CLAT      IFNE *BLANKS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE CLAT      ZFIELD
     C                     Z-ADD11        ZADIG
     C                     Z-ADD*ZERO     ZADEC
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 233'    ERR,EC
     C                     SETON                     53
     C                     END
     C                     END
     C*
     C* Put Percentage - check valid number
     C*
     C           CPRI      IFNE *BLANKS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE CPRI      ZFIELD
     C                     Z-ADD3         ZADIG
     C                     Z-ADD3         ZADEC
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 234'    ERR,EC
     C                     SETON                     54
     C                     END
     C                     END
     C*
     C* Entry not valid if Put amount entered
     C*
     C           CPRI      IFNE *BLANKS
     C           CLAT      ANDNE*BLANKS
     C                     ADD  1         EC
     C                     MOVEA' 235'    ERR,EC
     C                     SETON                     54
     C                     END
     C*
     C* Redemption Price - check valid number
     C*
     C           RAMT      IFNE *BLANKS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE RAMT      ZFIELD
     C                     Z-ADD7         ZADIG
     C                     Z-ADD8         ZADEC
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 236'    ERR,EC
     C                     SETON                     67
     C                     END
     C                     END
     C*
     C                     END
     C*
     C* Conversions
     C*
     C           SSDET     IFEQ 'CV'
     C*
     C* Conversion security - must exist already if entered
     C*
     C           SSDCV     IFNE *BLANKS
     C           SSDCV     SETLLSECTYDF                  33
     C           *IN33     IFEQ '0'
     C                     ADD  1         EC
     C                     MOVEA' 237'    ERR,EC
     C                     SETON                     62
     C                     END
     C                     END
     C*
     C* Conversion Currency - check currency exists on table
     C*
     C           CONC      IFNE *BLANKS
     C***********          MOVE *BLANKS   KEY12A                          S01117
     C***********          MOVELCONC      WORK4                           S01117
     C***********          MOVE '1'       WORK4                           S01117
     C***********          MOVEL'20'      KEY12A                          S01117
     C***********          MOVE WORK4     KEY12A                          S01117
     C***********TABKA     CHAINTABTG10F             33                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM CONC      @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C************IN33     IFEQ '1'                                       S01117
     C                     ADD  1         EC
     C                     MOVEA' 238'    ERR,EC
     C                     SETON                     63
     C***********          ELSE                                           S01117
     C***********RECI      IFEQ '*'                                       S01117
     C***********          ADD  1         EC                              S01117
     C***********          MOVEA' 238'    ERR,EC                          S01117
     C***********          SETON                     63                   S01117
     C***********          END                                            S01117
     C                     END
     C                     END
     C*
     C* Conversion Exchange rate - check valid number
     C*
     C           CONR      IFNE *BLANKS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE CONR      ZFIELD
     C                     Z-ADD5         ZADIG
     C                     Z-ADD8         ZADEC
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 239'    ERR,EC
     C                     SETON                     66
     C                     END
     C                     END
     C*
     C* Conversion Price - check valid number
     C*
     C           CONP      IFNE *BLANKS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE CONP      ZFIELD
     C                     Z-ADD7         ZADIG
     C                     Z-ADD8         ZADEC
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 240'    ERR,EC
     C                     SETON                     64
     C                     END
     C                     END
     C*
     C                     END
     C/COPY WNCPYSRC,SE0130C013
     C*
     C* Bonus Issues
     C*
     C           SSDET     IFEQ 'BI'
     C*
     C* Narrative - mandatory entry
     C*
     C           NAR4      IFEQ *BLANKS
     C                     ADD  1         EC
     C                     MOVEA' 241'    ERR,EC
     C                     SETON                     51
     C                     END
     C*
     C                     END
     C*
     C* Rights Issues
     C*
     C           SSDET     IFEQ 'RI'
     C*
     C* Narrative - mandatory entry
     C*
     C           NAR4      IFEQ *BLANKS
     C                     ADD  1         EC
     C                     MOVEA' 242'    ERR,EC
     C                     SETON                     51
     C                     END
     C*
     C                     END
     C*
     C* Capital Reorganisation
     C*
     C           SSDET     IFEQ 'CR'
     C*
     C* Narrative - mandatory entry
     C*
     C           NAR4      IFEQ *BLANKS
     C                     ADD  1         EC
     C                     MOVEA' 243'    ERR,EC
     C                     SETON                     51
     C                     END
     C*
     C                     END
     C*
     C* Other Changes
     C*
     C           SSDET     IFEQ 'OC'
     C*
     C* Narrative - mandatory entry
     C*
     C           NAR4      IFEQ *BLANKS
     C                     ADD  1         EC
     C                     MOVEA' 244'    ERR,EC
     C                     SETON                     51
     C                     END
     C*
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0130CCP4                                           S01408
     C/COPY ZSRSRC,ZSDESCZ3                                               CSE016
     C*                                                                   S01408
      *****************************************************************   S01169
      **                                                              *   S01117
      ** *PSSR - SUBROUTINE TO HANDLE ABNORMAL ERROR CONDITIONS       *   S01117
      ** CALLED FROM: AFTER ABNORMAL OPERATION OCCURS                 *   S01117
      ** CALLS: NOTHING                                               *   S01117
      **                                                              *   S01117
     C*****************************************************************   S01117
     C*                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR **    S01117
     C*                                                                   S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C                     ENDSR                           ** *PSSR **    S01117
     C*                                                                   S01117
     C********************************************************************S01117
      /EJECT
     C/COPY ZSRSRC,ZALIGNZ2
      /EJECT
     C/COPY ZSRSRC,ZDATE1Z2
      /EJECT
     C/COPY ZSRSRC,ZDATE2Z4
      /EJECT                                                              S01510
     C/COPY ZSRSRC,ZBKDT                                                  S01510
      /EJECT
     C*COPY*ZSRSRC,ZDATE6Z2********************************************   S01195
     C/COPY ZSRSRC,ZACCH                                                  S01195
     C/EJECT                                                              S01195
     C/COPY ZSRSRC,ZCHKH                                                  S01195
      /EJECT
     C/COPY ZSRSRC,ZEDITZ2
      /EJECT
     C*/COPY*ZSRSRC,ZICD2Z1***********************************************S01117
      *EJECT**                                                            S01117
     C*/COPY ZSRSRC,ZICDSEZ1**********************************************S01117
      *EJECT**                                                            S01117
     C*/COPY ZSRSRC,ZSYSTMZ1**********************************************S01117
      *EJECT**                                                            S01117
     C/COPY ZSRSRC,ZTNLU1Z2
     O/EJECT
     OSEDEVDF E                DLTREC
     O                         RECI
     O                         SDDT                                                           260331
     O                         LCD
     O                         CHTP
     O                         TNLU
     OSEDEVDF E                UPDTOT
     O                         SDTR
     O                         SDTA
     O                         SDTP
      /EJECT
      ***
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
**   INF  - File updated error message
RECORD UPDATED BY ANOTHER WORKSTATION
There is at least one live position settlement against this event
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   TABMTH/TABDAY     Month No/No of days in month
013102280331043005310630073108310930103111301231
