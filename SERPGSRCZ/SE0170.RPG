     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Position settlements input')                  *
/**** ***OVRDBF*FILE(POSETX)*TOFILE(SEPOSTL0)*SHARE(*NO)***********S01496 084981
/**** ***OVRDBF*FILE(POSETX)*TOFILE(POSET)*SHARE(*NO)**************084981 186055
/*XBIA*  OVRDBF FILE(POSETX) TOFILE(POSET7) SHARE(*NO)                *   186055
      *****************************************************************
      *                                                               *
      *  Midas - Securities Trading Module                            *
      *                                                               *
      *  SE0170  - POSITION SETTLEMENTS INPUT                         *
      *                                                               *
      *  Function:  This program allows the maintenance and           *
      *   (I/C)     authorisation of system-generated settlements,    *
      *             and the input of user-generated settlements.      *
      *                                                               *
      *  Called By: SEC02 - Input Cycle Processing                    *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. AR996802           Date 22May20               *
      *  PREV Amend No. AR706573           Date 22May20               *
      *                 264059             Date 22May20               *
      *                 250115             Date 22May20               *
      *                 249578             Date 22May20               *
      *                 MD043182           Date 08Apr20               *
      *                 HUT111             Date 08Apr20               *
      *                 AR586601           Date 07Apr20               *
      *                 AR568653           Date 07Apr20               *
      *                 AR324886           Date 07Apr20               *            
      *                 MD046248           Date 27Oct17               *      
      *                 AR1095995          Date 08Apr13               *
      *                 AR1095995          Date 18Mar13               *
      *                 CLE148             Date 23Jul12               *
      *                 AR888911           Date 26Jan12               *
      *                 AR864714B          Date 28Mar12               *
      *                 AR875302A          Date 27Jan12               *
      *                 AR864714A          Date 04Jan12               *
      *                 AR879983           Date 21Dec11               *
      *                 AR880129           Date 15Dec11               *
      *                 AR875922           Date 07Dec11               *
      *                 AR875296           Date 06Dec11               *
      *                 AR851880           Date 15Nov11               *
      *                 AR851833           Date 10Nov11               *
      *                 AR851784A          Date 10Nov11               *
      *                 AR853257           Date 04Nov11               *
      *                 AR851784           Date 07Nov11               *
      *                 CER049             Date 06Dec10               *
      *                 AR584789           Date 28Jul10               *
      *                 CSW210             Date 04May10               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 247951             Date 27May07               *
      *                 247333             Date 30Apr07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      *                 CSD079             Date 05Feb07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 BUG12729           Date 20Nov06               *
      *                 BUG11688           Date 11Jul06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 234471             Date 27Jun05               *
      *                 235250             Date 01Aug05               *
      *                 234080             Date 10Jun05               *
      *                 234140             Date 17May05               *
      *                 233711             Date 25May05               *
      *                 CSE071             Date 19Jul05               *
      *                 CAS010             Date 09Feb05               *
      *                 222756             Date 21Nov03               *
      *                 220952             Date 09Oct03               *
      *                 218520             Date 04Jun03               *
      *                 217551             DATE 25APR03               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3122            Date 17Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 BUG1992            Date 23Apr04               *
      *                 CRE020             Date 20Jan04               *
      *                 CGP001             Date 18Dec03               *
      *                 CGL029             Date 01Sep03               *
      *                 212767             Date 20Jun03               *
      *                 211749             Date 13Jun03               *
      *                 220465             Date 13Aug03               *
      *                 212522             Date 13Aug03               *
      *                 208241             Date 21Aug02               *
      *                 CSD015             Date 14Oct02               *
      * Midas Release 4.01.03 ----------------------------------------*
      *                 206844             Date 10Jan03               *
      *                 206987             Date 09Oct02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 197896             Date 25Jun02               *
      *                 191232             Date 20May02               *
      *                 198729             Date 16Apr02               *
      *                 203678             Date 24Apr02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CSE034             Date 08Apr02               *
      *                 179359             Date 15Jan02               *
      *                 191161             Date 30Nov01               *
      *                 169067             Date 14Sep01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CSE028             Date 06Jun01               *
      *                 CSW201             Date 02May01               *
      *                 CSE016             Date 10Jan01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 186400             Date 07Mar01               *
      *                 173501             Date 28Feb01               *
      *                 120815             Date 26Jan01               *
      *                 188588             Date 02Jan01               *
      *                 187591             Date 28Dec00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 186166             Date 10Nov00               *
      *                 186000             Date 09Nov00               *
      *                 186055             Date 06Nov00               *
      *                 185811             Date 02Nov00               *
      *                 185397             Date 24Oct00               *
      *                 CSE023             Date 12Jul00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 178530             Date 26May00               *
      *                 174342             Date 03May00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 157808             Date 14Feb00               *
      *                 CPB001             DATE 16Aug99               *
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CSE010             Date 21Jun99               *
      *                 CGL007             Date 26Mar99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 141869             Date 27Apr99               *
      *                 130059             Date 12Oct98               *
      *                 151506             Date 29Dec98               *
      *                 143690             Date 05Oct98               *
      *                 CEU017             Date 03Apr98               *
      *                 CSE007             DATE 03Apr98               *
      *                 CEU005             DATE 05FEB98               *
      *                 118340             DATE 24Feb98               *
      *                 100604             DATE 05Feb98               *
      *                 095550             DATE 18MAR97               *
      *                 CSE003             DATE 11OCT96               *
      *                 103634             DATE 31DEC96               *
      *                 103056             DATE 31DEC96               *
      *                 102777             DATE 31DEC96               *
      *                 099270             DATE 30DEC96               *
      *                 S01408             DATE 22NOV96               *
      *                 CAC002             DATE 15SEP96               *
      *                 104633             DATE 07NOV96               *
      *                 S01408             DATE 26SEP96               *
      *                 108001             DATE 17SEP96               *
      *                 099267             DATE 22AUG96               *
      *                 105034             DATE 06AUG96               *
      *                 CSW096             DATE 03JUN96               *
      *                 CSW003             DATE 23APR96               *
      *                 076975             DATE 07MAY96               *
      *                 S01408             DATE 29APR96               *
      *                 S01408             DATE 17JAN96               *
      *                 087651             DATE 25OCT95               *
      *                 086722             DATE 24OCT95               *
      *                 088976             DATE 05SEP95               *
      *                 087178             DATE 15JUN95               *
      *                 084981             DATE 07JUN95               *
      *                 082738             DATE 12MAR95               *
      *                 S01408             DATE 11APR95               *
      *                 080050             DATE 26JAN95               *
      *                 S01408             DATE 17JAN95               *
      *                 S01496             DATE 08JUL94               *
      *                 S01486             DATE 07JUL94               *
      *                 080356             DATE 15DEC94               *
      *                 075920             DATE 13SEP94               *
      *                 S01512             DATE 10AUG94               *
      *                 S01509             DATE 10AUG94               *
      *                 068993             DATE 14OCT94               *
      *                 066716             DATE 08FEB94               *
      *                 063994             DATE 23DEC93               *
      *                 052254             DATE 24NOV93               *
      *                 051475             DATE 24NOV93               *
      *                 055839             DATE 15NOV93               *
      *                 S01446             DATE 04NOV93               *
      *                 S01447             DATE 11OCT93               *
      *                 S01401             DATE 16JUN93               *
      *                 S01412             DATE 27MAY93               *
      *                 047225             DATE 22MAR93               *
      *                 S01397             DATE 10SEP92               *
      *                 E37157             DATE 18MAR92               *
      *                 E37205             DATE 18MAR92               *
      *                 E37165             DATE 18MAR92               *
      *                 E37159             DATE 18MAR92               *
      *                 E37158             DATE 18MAR92               *
      *                 E31432             DATE 12DEC91               *
      *                 E30740             DATE 12DEC91               *
      *                 E28805             DATE 12DEC91               *
      *                 E24426             DATE 24JAN90               *
      *                 S01117             DATE 06NOV90               *
      *                 S01195             DATE 06NOV90               *
      *                 S01220             DATE 07AUG90               *
      *                 S01269             DATE 01AUG90               *
      *                 E23955             DATE 25OCT90               *
      *                 E23408             DATE 06SEP90               *
      *                 E23192             DATE 07AUG90               *
      *                 E21590             DATE 09APR90               *
      *                 E21493             DATE 09APR90               *
      *                 E20651             DATE 10JAN90               *
      *                 E20237             DATE 24NOV89               *
      *                 E19438             DATE 10NOV89               *
      *                 S01199             DATE 14SEP89               *
      *                 S01154             DATE 17/03/89              *
      *                 E18884             DATE 17/07/89              *
      *                 E18102             DATE 10/07/89              *
      *                 E17793             DATE 26/06/89              *
      *                 E17423             DATE 22/05/89              *
      *                 E18193             DATE 05/05/89              *
      *                 E17178             DATE 05/05/89              *
      *                 E16084             DATE 05/05/89              *
      *                 E17175             DATE 14/04/89              *
      *                 E16843             DATE 16/03/89              *
      *                 E17211             DATE 16/03/89              *
      *                 S01179             DATE 21/10/88              *
      *                 S01176             DATE 08/11/88              *
      *                 S01169             DATE 08/11/88              *
      *                 E14878             DATE 28/10/88              *
      *                 E14214             DATE 28/09/88              *
      *                 E14881             DATE 16/09/88              *
      *                 E14882             DATE 16/09/88              *
      *                 E14884             DATE 08/09/88              *
      *                 E14717             DATE 26/08/88              *
      *                 E14712             DATE 17/08/88              *
      *                 E14438             DATE 27/07/88              *
      *                 E13952             DATE 26/07/88              *
      *                 S01158             DATE 06/05/88              *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  AR996802 - Error 996 encountered when authorising Position   *
      *             Settlement even if it is not yet authorised.      *
      *             Add PTFR in POSETK during CHAIN in POSET.         *
      *             (Child: AR996804).                                *
      *  AR706573 - Position settlement records can be seen by        *
      *             un-authorised users. Change checking of *IN81 from*
      *             'Y' to '1' to process the branch/user validation. *
      *             (Child: AR706574)                                 *
      *  264059 - Position Settlements maintenance displays duplicate *
      *           records.                                            *
      *           Set AID to 'UP' when pagedown key is pressed and    *
      *           *IN03 is off.                                       *
      *  250115 - Restore fix 220952 and reposition endif line of     *
      *           fix 249578.                                         *
      *         - Reversal of the original projected account movement *
      *           should be done when an authorized position          *
      *           settlement is amended. Applied fix 234985.          *
      *  249578 - Position settlements.                               *
      *  MD043182 - Inconsistency in Block Dr/Cr indicator for POST   *
      *  HUT111 - Corporate Action Blocked Credit Account             *
      *           (Upgrade HUT024 to FM2.1 SP22)                      *
      *           (Include MD-43182 as it also affects HUT111         *
      *            processing)                                        *
      *           Amendment of core hook SE0170FFP1                   *
      *           Amendment of core hook SE0170CCP5                   *
      *           Addition of hooks: HUT111_001 to _008               *      
      *  AR586601 - Unable to allocate a record in PSAUT. Fix is to   *
      *             put 'N' in position 53 of CHAIN opcode used only  *
      *             for validation and not update.                    *
      *             (Upgraded as required by AR324886)                *
      *  AR568653 - Same user can Reverse and Auth, Matured position  *
      *             settlements. Additional fix for AR324886.         *
      *             (Upgraded as required by AR324886)                *
      *  AR324886 - Implement 4-eyes processing in Position           *
      *             Settlement Maintenance.                           *
      *             (Upgraded as required by HUT105)                  *      
      *  MD046248 - Finastra Rebranding                               *
      *  AR1095995C - Generate projected movement when authorising    *
      *               position settlements with no amendments during  *
      *               the day                                         *
      *  AR1095995A - Generate only 1 projected movement when amending*
      *               system generated position settlements           *
      *  CLE148 - Alpha Loan Reference (Recompile)                    *
      *  AR888911 - In reversing a deal, REV column in Stamp Tax      *
      *             Movements Enquiry is not changing from N to Y     *
      *             (Recompile)                                       *
      *           - Applied for AR944923                              *
      *  AR864714B - No movement is posted in Stamp Tax Movement      *
      *              enquiry for POST. Populate gross amount.         *
      *            - Applied for AR942839                             *
      *  AR875302A - Stamp Tax amount should be blanks if liable      *
      *              flag is 'N'                                      *
      *  AR864714A - No movement is posted in Stamp Tax Movement      *
      *              enquiry for Position Settlements                 *
      *  AR879983 - Add stamp tax exchange rate (Recompile)           *
      *  AR880129 - Stamp tax flag was changed and stamp tax charge   *
      *             code is defaulted during enquire and authorise    *
      *  AR875922 - 101 error code appears when action code Y and A   *
      *             is entered                                        *
      *  AR875296 - Security Charge Code is missing in Position       *
      *             Settlement generated from coupon payment.         *
      *  AR851880 - Stamp tax liable ind cannot be changed from N to Y*
      *  AR851833 - Stamp tax amount is excluded in the computation   *
      *  AR851784A - Stamp tax liable is defaulted to N eventhough the*
      *             customer and branch stamp tax (Reopen)            *
      *  AR853257 - Account Keys for FT were not generated            *
      *             (Recompile)                                       *
      *  AR851784 - Stamp tax liable is defaulted to N eventhough the *
      *             customer and branch stamp tax                     *
      *  CER049 - Stamp Tax                                           *
      *  AR584789 - DBERRCTL was encountered. Applied fix 235180 and  *
      *             214835.                                           *
      *  235180 - DBASE error when CP input                           *
      *           Change fix 157808 to ensure settlement ccy defaulted*
      *           in all cases (eg S01509 off and CEU005 on)          *
      *           Also apply 214835                                   *
      *  214835 - If settlement ccy is amended to blank database error*
      *  CSW210 - SWIFT 2010 Changes (Recompile)                      *
      *  247951 - Multiple entries are generated in Projected Account *
      *           Movements if position settlement is authorised more *
      *           than once. Reversed core fixes 100604 and 220952.   *
      *         - Initialise fields PSEQ and DAMT.                    *
      *         - Correct processing to retrieve the correct record   *
      *           in file when features CSE023, Portfolio Management  *
      *           and Private Banking modules are OFF.                *
      *  247333 - If action amend, delete or authorise (A, D, or Y)   *
      *           is performed to an authorised position settlement,  *
      *           do not switch action to Enquiry mode.               *
      *  CSD079 - Enhanced Customer Maintenance API (Recompile)       *
      *  BUG12729 - Existing position settlement cannot be accessed   *
      *             using the key screen                              *
      *  BUG11688 - Pass customer number to SE1817, in case shortname *
      *             was input to screen.                              *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  234471 - Program does not update settlement amount when the  *
      *           tax amount is changed.                              *
      *  235250 - To enable the tax amount amendment                  *
      *  234080 - No EU Tax field displayed in insert mode.           *
      *  234140 - EU witholding tax (recompile)                       *
      *  233711 - Allow user to update tax amount for the position    *
      *           settlement.                                         *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  CAS010 - IAS + PB Enhancements Upgrade to MidasPlus.         *
      *  222756 - Error message 701 if the customer has no record in  *
      *           withholding tax details. Change this to a warning   *
      *           message (W04) and use the default tax basket for no *
      *           documentation in this case.                         *
      *  220952 - No postings after amendment/authorisation of        *
      *           position settlements. Amend pgm to have online      *
      *           updates if action is 'Y' or on an authorised record *
      *           Applied fix 197959 partially.                       *
      *  218520 - Amended position settlement does not require        *
      *           re-authorisation. Fix is to re-set indicator if     *
      *           amended. Applied fix 202792.                        *
      *  217551 - AVOID ERROR CODE 101 IF CUSTOMER REQUESTED FOR      *
      *           CLOSURE, SO STILL LIVE.                             *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3122 - Recompiled due to changes in SDSECSPD.             *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  BUG1992 - Webfacing Changes. Screens are not being displayed.*
      *  CRE020 - Midas Plus Online Printing of Advices (GE7)         *
      *  CGP001 - Global Processing (Recompile)                       *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  212767 - Cannot insert successive records in position        *
      *           settlement maintainance. TNL1 initialized to 0      *
      *           upon every insert.                                  *
      *  211749 - Unprotect all fields when at least one is in error  *
      *           to allow correction on that field.                  *
      *  220465 - Able to leave 1st screen just by pressing enter even*
      *           if there are pending errors.  Fix is to make sure   *
      *           that SCRMSG is not blanked out if there are still   *
      *           errors.                                             *
      *  212522 - Error code '101' appears on enquire, amend, delete  *
      *           reverse and authorise of a position settlement from *
      *           subfile if it has same key preceeding it. Fix is to *
      *           disregard loop with sequence if CSE023 is on.       *
      *  208241 - Recompiled over changed /CPY ZSDESCZ3.              *
      *  CSD015 - Midas Compliance Watch - Watch List Checking        *
      *  206844 - Allow selection of records on subfile processing.   *
      *  206987 - Cursor wrongly positioned.                          *
      *  197896 - Not able to overwrite Exchange Rate. Fix is to use  *
      *           defaults only if user did not overwrite Exch Rate.  *
      *  191232 - DBerror 09 in BLC0643, pgm BL0643 in file SDNOSTPD. *
      *           Validation of nostro number reviewed.  Applied fix  *
      *           179182.                                             *
      *  198729 - Possible to use nostro settlement method even when  *
      *           the account is a retail account.  Checked account   *
      *           type if retail or retail nostro before allowing     *
      *           insertion/changes.                                  *
      *  203678 - Delete not possible. Use the right key to access    *
      *           the file. Apply improvements to 169067.             *
      *  CSE034 - Standard Settlement Instruction improvements        *
      *  179359 - Not possible to insert dividend position settle-    *
      *           ments and dividend diary events for securities      *
      *           with processing type '7'.                           *
      *  191161 - Reversal of Corporate Action did not generate       *
      *           a reversal of the position settlement. Fix is to    *
      *           ensure that position settlement generated via       *
      *           corporate action is reversed successfully when      *
      *           reversing the involved Corporate Action reference.  *
      *  169067 - Delete not possible - Use the right key to access   *
      *           the file POSETD.                                    *
      *  CSE028 - Standing Settlement Instructions Enhancement.       *
      *  CSW201 - SWIFT 2001 Standards Update                         *
      *  CSE016 - Extended Security Descriptions                      *
      *  186400 - For reversal of post. settlement, action code 'R',  *
      *           system reverts action to action code 'E'.  Applied  *
      *           fix 136880, 141770 and 146282 to correct treatment  *
      *           of reversal for position settlement.                *
      *         - Include option 'R' in first two entries in array    *
      *  173501 - The settlement method, curency and account are not  *
      *           amendable.                                          *
      *  120815 - Unable to authorise position settlement because     *
      *           of error code 602                                   *
      *  188588 - WFREEM field not initialised correctly              *
      *  187591 - Remove exemption code from Review screen            *
      *           (Recompiled due to changes in SE0170DF)             *
      *  186166 - Protect tax field for amend if CSE023 is ON and     *
      *           allow user input for maturity event.                *
      *  186000 - Tax Identification Number needs to be added to      *
      *           Customer Withholding Tax Details                    *
      *  186055 - All sort of errors are being encountered in         *
      *           Position Settlement Maintenace                      *
      *  185811 - Set up default tax basket for manual position       *
      *           settlement                                          *
      *  185397 - Problem with MG0565 for manually insert and delete  *
      *           of position settlement.                             *
      *  CSE023 - Treaty Withholding Tax                              *
      *  178530 - For Settlement method 14 check whether Account      *
      *           Currency is the same as Settlement Currency (159545)*
      *         - Closed account is accepted and causes FOOB in CoB   *
      *           due to Reci = 'C' in  POSETD (161703).              *
      *  174342 - Charge code/Commissions code update to blank not    *
      *           properly done.                                      *
      *  157808 - DBASE error when CP input                           *
      *  CPB001 - 'Private Banking' Module                            *
      *  CSE010 - SE Transactions Enhancements                        *
      *  CGL007 - Account Postings Enquiry.                           *
      *  141869 - Subfile doesn't show the correct contents of the    *
      *           record when an action is done (amendment, deletion, *
      *           or etc.) in the position setlement.  Need to rebuild*
      *           subfile in this case. Applied part of fix 108347.   *
      *  130059 - Amendment and Authorisation of Position Settlements *
      *           ignored.  Reset TNL1 in SR/INITRC only if ACTN='I'. *
      *           Assign 9997 to PTFR when SPPTFR is not blanks.      *
      *  151506 - Problem when Settlement currency  is changed to EUR:*
      *           Correct exchange rate is not defaulted when settle- *
      *           ment ccy is amended.  Recalculate base ccy rate,    *
      *           exchange rate/MD Ind., and settlement amount if     *
      *           settlement ccy is not EUR and 'IN' ccy and rundate  *
      *           is not later than EMU transition period, otherwise, *
      *           exchange rate should default to the EURO exchange   *
      *           rate in SDCURRPD.                                   *
      *           And amend the calculation of EXCHG.RATE and SETTL AM*
      *           in conjonction with 143690.                         *
      *  143690 - Incorrect Mult/Div Ind. was being used when EURO    *
      *           CCY was involved. Fix is to reverse the M/D ind. if *
      *           Nominal CCY is equal to the EURO CCY.               *
      *  CEU017 - Securities Redenomination Euro Changes              *
      *  CSE007 - Corporate Actions                                   *
      *  CEU005 - EMU SE Settlement Ccy Conversion.                   *
      *  118340 - Update immediatly trailer (POSETA) after Amending   *
      *           a record in POSETD to avoid problem of double access*
      *           by two different jobs.                              *
      *  100604 - Do not do updates to on-line positions files unless *
      *           action code is 'Y' or Due Date is today.            *
      *  095550 - When more than one selection, the information is    *
      *           incorrect.                                          *
      *  CSE003 - '?' processing for security shortname.              *
      *  103634 - Always output the settlement amount as it is used   *
      *           in SE2300.                                          *
      *  103056 - WHEN AN ACTION IS NOT PROCESSED (F12), RESET ACTION *
      *           TYPE TO BLANK                                       *
      *  102777 - WHEN AMEND OF THE SETTLEMENT CURRENCY, UPDATE FILE  *
      *           WITH THE CALCULATED SETTLEMENT AMOUNT OTHERWISE     *
      *           PROGRAM AOOUPSU0 ACCESS ACCNTAB WITH THE NOMINAL CCY*
      *           WHICH DOES NOT ALWAYS EXISTS AND PRODUCES A DB ERROR*
      *  099270 - WHEN CHANGE OF VALUE DATE, AMEND SCREEN VALUE       *
      *           IN THE SUBFILE                                      *
      *  S01408 - Addition of Core Hook SE0170CP13                    *
      *  CAC002 - Profit Centre Accounting Development - Phase 2      *
      *           If analytical accounting is installed, the tax amt  *
      *           deducted at source, refundable and by user fields   *
      *           will be repositioned to make room for new fields,   *
      *           Margin Points and Amount.                           *
      *  104633 - GUI Amendments to DSPF with non-standard footers    *
      *  S01408 - Addition of Core Hook SE0170FFP1                    *
      *           Addition of Core Hook SE0170CP12                    *
      *           Addition of Core Hook SE0170CP11                    *
      *           Addition of Core Hook SE0170CP10                    *
      *           Addition of Core Hook SE0170CCP9                    *
      *           Addition of Core Hook SE0170CCP8                    *
      *           Addition of Core Hook SE0170CCP7                    *
      *           Addition of Core Hook SE0170CCP6                    *
      *           Addition of Core Hook SE0170CCP5                    *
      *  108001 - Two errors in input processing:                     *
      *           i) When try and insert more than one record in one  *
      *           call of SE0170, DB error occurs.                    *
      *           ii) When call REVIEW screen followed by insert, the *
      *           same DB error occurs.                               *
      *           Problems due to field TNLU which has been renamed   *
      *           to TNL1 for Portfolio Management upgrade (S01486).  *
      *           The new field is not cleared in SR INITRC as it     *
      *           should be before each insert.                       *
      *  099267 - COMPLETE 084981 : IF SELECTION ON MORE THAN 1 REC   *
      *           THE FIELD DELT IS SETTED DEPENDING ON THE PREVIOUS  *
      *           RECORD                                              *
      *  105034 - Correctly verify nostro number when amending sett.  *
      *           account for settlement methods 01,02,07,08 and 12,  *
      *           else changes not accepted. AOOUPSU0 also amended.   *
      *  CSW096 - Swift Changes 1996:                                 *
      *           Add validation for field 72.                        *
      *  CSW003 - MT5xx Message Generation - Phase 2                  *
      *  076975 - For warning 'W02', verify payment/value date        *
      *           and not event date :                                *
      *           If S01512 is active, check for the position         *
      *           settlement value date rather than the due date      *
      *  S01408 - Core Hook SE0170IIP2 Added                          *
      *         - Core Hook SE0170CCP3 Added                          *
      *         - Core Hook SE0170CCP4 Added                          *
      *  S01408 - Core Hook SE0170IIP1 Added                          *
      *         - Core Hook SE0170CCP1 Added                          *
      *         - Core Hook SE0170CCP2 Added                          *
      *  087651 - Settlement branch does not have to equal booking    *
      *           branch for sett. type 15 - change validation.       *
      *         - If Settlement Branch is blank, default to booking   *
      *           branch.                                             *
      *  086722 - Always display the settlement amount                *
      *  088976 - Live / All not conditioned correctly                *
      *  087178 - Settlement amount has to include taxes added to or  *
      *           subtracted from it                                  *
      *  084981 - Allow more than 1 selection in the subfile          *
      *  082738 - Rewrite of projected account movements.             *
      *  S01408 - ADDITION OF CORE HOOK SE0170IIPG                    *
      *           ADDITION OF CORE HOOK SE0170CVS4                    *
      *           ADDITION OF CORE HOOK SE0170CVS5                    *
      *           ADDITION OF CORE HOOK SE0170CVSF                    *
      *  080050 - Narrative code on RSACMTPD changed to alphanumeric  *
      *  S01408 - ADDITION OF CORE HOOK SE0170CCPG                    *
      *           ADDITION OF CORE HOOK SE0170CVS1                    *
      *           ADDITION OF CORE HOOK SE0170CVS2                    *
      *           ADDITION OF CORE HOOK SE0170CVS3                    *
      *  S01496  -  INCORPORATION OF JYSKE ENHANCEMENTS S10978, S10985*
      *             WHERE S10978, S10985 ARE THE ORIGINAL AMENDMENT   *
      *             REFERENCE NUMBER                                  *
      *             S10978 : EARLY REDEMPTIONS                        *
      *             S10982 : RECOMPILE PG FOR FILE CHANGED (SESWHTL0) *
      *             S10985 : JYSZRH: REVERSAL OF POSITION SETTLEMENT  *
      *             ACTION 'R', REVIEW LIVE/ALL  + SMALL ERROR FIXES  *
      *  S01486 - Portfolio Management Upgrade to Release 10          *
      *  080356 - Database error caused by 068993.  Remove it.        *
      *  075920 - Amounts and DORC not updated correctly during delete*
      *  S01512 - Add value date to Position Settlements and make the *
      *           settlement amount an output field only to be        *
      *           computed during update                              *
      *  S01509 - Value Currency to be currency of Issuer of Payments *
      *  068993 - Program did not clear screen on insert.             *
      *  066716 - Protect screen when Authorising a position sett.    *
      *  063994 - Nominal to Settlement CCY validation - rates the    *
      *           wrong way round so these have been swapped round.   *
      *  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
      *           to 10,9                                             *
      *  051475 - Authorized position settlement should update        *
      *           projected Nostro movement.                          *
      *  055839 - Always validate settle amount against settle Ccy    *
      *           decimal places. Due to exchange rate checking, Pgm  *
      *           sometimes uses nominal currency decimal places.     *
      *  S01446 - CUSTOMER COMMISSIONS (COURTAGE) ENHANCEMENT.        *
      *           Recompiled due to changes in PF/SECGTD.             *
      *  S01447 - Withholding tax                                     *
      *  S01401 - Produce SWIFT Messages MT5xxs, if option available. *
      *  S01412 - SWIFT September 1993 changes - validation           *
      *           of the format of the special instructions           *
      *           field.                                              *
      *  047225 - CONDITION CALL TO AORETLR0 ON RETAIL BEING          *
      *           PRESENT. (U1 SET ON IN CL IF RE OR IA PRESENT)      *
      *  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
      *          - Recompiled due to changes to files.                *
      *  E37157 - Should be able to access more than one record with  *
      *           the same key                                        *
      *  E37205 - Multiply/Divide indicator was being set up          *
      *           incorrectly for standard subroutine ZXRATE          *
      *  E37165 - If the exchange rate entered is 1 then it does not  *
      *           matter what the multiply/divide indicator is        *
      *  E37159 - Need only check if Retail or Interest on Accounts   *
      *           is on for settlement methods 04 and 14 to be valid  *
      *  E37158 - Need to set up account code and sequence defaults   *
      *           when action code is not I as well as when it is I   *
      *  E31432 - Add action code 'Y' to the appropriate entries in   *
      *           compile-time array 'INF'. These entries are used    *
      *           to display the valid options on the screen. Note    *
      *           that it has not been possible to flag the changed   *
      *           entries with the error number because there is no   *
      *           room.                                               *
      *  E30740 - Book code must be entered if charge / commission    *
      *           entered, else the system generates incorrect        *
      *           A/C keys.                                           *
      *  E28805 - Rolldown rolls up. The write of the SFLCTL blanks   *
      *           out the AID value so it is never 'DN'               *
      *  E24426 - When amending authorised posn. settlement, files    *
      *           should not be updated - E20237 incorrect            *
      *  S01117 - SE Release 10 - Multibranching                      *
      *  S01195 - Holiday Amendment                                   *
      *  S01220 - STRATEGIC RISK MANAGEMENT                           *
      *            Recompiled over changed PF/SECTYD                  *
      *  S01269 - TRADE AUTHORISATION: Recompiled for change to       *
      *           file TABSE.                                         *
      *  E23955 - Delete old 'MHELP' text omitted from previous fix   *   E23955
      *          (S01199 - ABS HELP SYSTEM.)                          *   E23955
      *  E23408 - Settlement types 4 and 14 allowed if Retail II or   *   E23408
      *           Interest on Accounts on in system.                  *   E23408
      *  E23192 - Settlement branch should default to that on TABTB36.*   E23192
      *  E21590 - Additional to E14884: Any non-Enquiry Action on an  *   E21590
      *           Actioned record (RECI = 'M') should have a unique   *   E21590
      *           Error Message. Added Error 115.                     *   E21590
      *  E21493 - CLINTSE needs to be read for Authorisation as well  *   E21493
      *           as for Amend since the Discretionary Indicator is   *   E21493
      *           required for checking Add/Subtract of Charges/Comm. *   E21493
      *  E20651 - DB Error Numbers used in more than one place.       *   E20651
      *           New Error Numbers as follows:                       *   E20651
      *           DB ERROR 04 -> 12.                                  *   E20651
      *           DB ERROR 04 -> 13.                                  *   E20651
      *           DB ERROR 06 -> 14.                                  *   E20651
      *           DB ERROR 06 -> 15.                                  *   E20651
      *  E20237 - E19438 was wrongly incorporated. Only 'Y' should    *   E20237
      *           authorise position settlements.                     *   E20237
      *         - Allow Roll up/down on Enquire only                  *   E20237
      *         - Correct Inf messages handling                       *   E20237
      *  E19438 - Mark manually inserted records as authorised.       *   E19438
      *  S01199 - HELP SYSTEM.                                        *   S01199
      *  S01154 - ADDITION OF REAL TIME STATEMENTS                    *   S01199
      *  E18884 - DIVIDE BY ZERO ERRORS WHEN BAD VALUES ENTERED       *   E18884
      *           INTO EXCHANGE RATE. ERROR MESSAGE 227 ADDED.        *   E18884
      *  E18102 - NOMINAL AMOUNT DECIMAL PLACES NOT BEING HANDLED     *   E18102
      *           CORRECTLY AND NEGATIVE AMOUNTS NOT BEING ACCEPTED   *   E18102
      *           AT ALL. ALSO NOMINAL AMT INCORRECTLY BEING USED     *   E18102
      *           DIRECTLY FOR AMOUNT DUE.                            *   E18102
      *  E17793 - INCORRECT ACCOUNT CODE FOR POSITION SETTLEMENTS     *   E17793
      *           CAUSES DATABASE ERROR IN SE2450                     *   E17793
      *  E17423 - AFTER WARNING MESSAGE APPEARS, ASCHGS MUST BE       *   E17423
      *           EXECUTED TO CATER FOR CMD KEY RESPONSE.             *   E17423
      *           INCORRECT NARRATIVES FOR CMD KEYS.                  *   E17423
      *           INCORRECT SIZE OF COMPARED SCREEN DETAIL            *   E17423
      *           FIELD FOR FIX  E16084.                              *   E17423
      *  E18193 - DUE DATE DOESN'T DEFAULT TO RUN DATE IF THE FIELD   *   E18193
      *           IS LEFT BLANK WHEN INSERTING A SETTLEMENT.          *   E18193
      *  E17178 - WHEN INSERTING A SETTLEMENT FOR PORTFOLIO CUST.     *   E17178
      *           WITH STANDARD SETTLEMENT INSTRUCTIONS, THE PAY      *   E17178
      *           SETTLEMENT METHOD IS CORRECTLY PICKED UP FROM       *   E17178
      *           STSED, BUT THE RECEIVE ACCOUNT IS PICKED UP         *   E17178
      *           INSTEAD OF THE PAY ACCOUNT.                         *   E17178
      *  E16084 - VALIDATION OF SCREEN IF CHANGED AFTER WARNING(S).   *   E16084
      *  E17175 - WHEN AN ERROR OCCURS IN THE NOMINAL POSITION        *   E17175
      *           FIELD, THIS FIELD IS HIGHLIGHTED CORRECTLY          *   E17175
      *           BUT WHEN THE ERROR IS CORRECTED THE FIELD IS        *   E17175
      *           HIGHLIGHTED FOR ANY ACTION CODE ENTERED.            *   E17175
      *  E16843 - UPDATE SHADOW BALANCES CORRECTLY.                   *   E16843
      *  E17211 - VALIDATE  SETTLEMENT ACCOUNT CORRECTLY IF           *   E17211
      *           SETTLEMENT METHOD 05.                               *   E17211
      *  S01179 -  ****** AS400 CONVERSION ******                     *   S01179
      *  The keyword RTGAID is no longer supported on the AS400       *   S01179
      *  and command keys and indicators have been used to replace    *   S01179
      *  this in the display file. To disrupt the structure of the    *   S01179
      *  program as little as possible a new subroutine - ASCHGS -    *   S01179
      *  has been coded. This moves the values which would have       *   S01179
      *  been passed to the program (via RTGAID) into the AID         *   S01179
      *  field depending on which function key has been pressed.      *   S01179
      *  S01176 - SECURITIES TRADING 3.1 INCORPORATION                *   S01176
      *  S01169 - SECURITIES TRADING BAER INCORPORATION               *   S01176
      *  E14878 - THE SETTLEMENT BRANCH SHOULD DEFAULT TO 001 IN      *   E14878
      *           A SINGLE BRANCH ENVIRONMENT.                        *   E14878
      *  E14214 - ALLOW INPUT AND VALIDATION OF NOMINAL AMOUNT SO     *   E14214
      *           THAT CONFIRMATION SHOWS AMOUNT OF HOLDING OF SEC.   *   E14214
      *           OVERIDE WARNING INDICATORS                          *   E14214
      *  E14881 - METHOD OF ADD/SUBTRACTING COMMS AND CHGS CHANGED    *   E14881
      *           TO DEPEND ON CLASSIFICATION AND PAY/RECEIVE IND.    *   E14881
      *           ALSO VALIDATION AMENDED FOR PAY/RECEIVE IND.        *   E14881
      *  E14882 - PDTG NOW SET TO 0 NOT RUNDATE                       *   E14882
      *  E14884 - ALLOW FOR ENQUIRY ON MATURED RECORDS ON POSETD      *   E14884
      *           BUT NOT FOR UPDATE.                                 *   E14884
      *  E14717 - SET UP DEFAULT BOOK CODE IF NOT SPECIFIED           *   E14717
      *           ON INPUT.                                           *   E14717
      *  E14712 - SETTLEMENT METHOD 04 & 14 BEING REJECTED            *   E14712
      *           BECAUSE OF INCORRECT VALIDATION.                    *   E14712
      *           NO VALIDATION EXISTED FOR SETTLEMENT METHOD 04.     *   E14712
      *  E14438 - RECOMPILE PROGRAM FOR EUCLID INCORPORATION          *   E14438
      *           AND UPGRADING OF FILES.                             *   E14438
      *  E13952 - PROGRAM DOES NOT ACCEPT CUSTOMER SHORTNAME.         *   E13952
      *  S01158 - POST INCORPORATION DEVELOPMENT FIX                  *   S01158
      *                                                               *
      *****************************************************************
      *
     FSE0170DFCF  E                    WORKSTN      KINFDS SCRDS
     F                                        RRN   KSFILE SUBFLREC
     F/COPY WNCPYSRC,SE0170F001
     F*POSET***UF  E           K        DISK         KCOMIT       A       S01117
     F*POSET1**UF**E           K        DISK         KCOMIT       AS01117 CSE023
     FPOSET1  UF  E           K        DISK         KCOMIT       A                          BUG12729
     F                                              KINFDS INFDS1                           BUG12729
     F                                              KINFSR INFSR                            BUG12729
     FPOSET6  UF  E           K        DISK         KCOMIT       A        CSE023
     F            POSETDF                           KRENAMEPOSETDF6                         BUG12729
     F                                              KINFDS INFDS
     F                                              KINFSR INFSR
     FPOSETX  IF  E           K        DISK
     F            POSETDF                           KRENAMEPOSETDFX
     FPSAUT   UF  E           K        DISK         KCOMIT       A                          AR324886
      ** SE Position Settlement Authorisation detail                                        AR324886
      *                                                                                     AR324886
     FPOSETA  UF  E                    DISK         KCOMIT      
      *                                                                   CSE023
      ** Withholding tax customer details for retrieve.                   CSE023
     FSDWTCSL1IF  E           K        DISK         KINFSR INFSR          CSE023
      *                                                                   CSE023
      ** Tax basket details file for retrieve.                            CSE023
     FSDTXBSL1IF  E           K        DISK         KINFSR INFSR          CSE023
      *                                                                   CSE023
      ** Beneficial owners details file for retrieve.                     CSE023
     FSDBNFOL2IF  E           K        DISK         KINFSR INFSR          CSE023
      *                                                                   CSE023
      ** Withholding tax treaty details file for retrieve.                CSE023
     FSDWHTTL0IF  E           K        DISK         KINFSR INFSR          CSE023
      *                                                                   CSE023
      ** Exemption codes details file for retrieve.                       CSE023
     FSDEXEML1IF  E           K        DISK         KINFSR INFSR          CSE023
      *                                                                   CSE023
      ** Customer Depots details file                                     CSE023
     FCDEPS   IF  E           K        DISK         KINFSR INFSR          CSE023
      *                                                                   CSE023
      ** Customer positions file for retrieve.                            CSE023
     FCPOSH   IF  E           K        DISK         KINFSR INFSR          CSE023
     F*MEMOS**UF**E                    DISK         KCOMIT            U1  082738
     F*PRONO**UF**E           K        DISK         KCOMIT         051475 082738
     F*OLPOS**UF**E           K        DISK         KCOMIT         051475 082738
     F*CLINT**IF* E           K        DISK                               S01117
     F*********** CLINTCAF                          KIGNORE               S01117
     F*********** CLINTCBF                          KIGNORE               S01117
     F*********** CLINTCCF                          KIGNORE               S01117
     F*********** CLINTSEF                          KIGNORE               S01117
     F*********** CLINTC1F                          KIGNORE               S01117
     F*SNAME**IF* E           K        DISK                               S01117
     F*********** CLINTCBF                          KRENAMESNAMEF         S01117
     FACCNT   IF  E           K        DISK
     F            ACCNTAAF                          KIGNORE
     F            ACCNTACF                          KIGNORE
     FACNUM   IF  E           K        DISK
     F            ACCNTABF                          KRENAMEACNUMF
     FSECTY   IF  E           K        DISK
     F*SECHG**IF* E           K        DISK                               S01169
     FSECGT   IF  E           K        DISK                               S01169
     FSTDSED  IF  E           K        DISK
     F*BOOKD**IF* E           K        DISK                               S01117
     FINVTP   IF  E           K        DISK
     FSEPCCD  IF  E           K        DISK                               S01117
     FSEDEV   IF  E           K        DISK                               S01509
     F*RSACMTPDO**E                    DISK                        S01154 082738
     F************                                  KCOMIT         S01154 082738
     F*TABSE**IF  E           K        DISK                               S01117
     F**ICD*1**** TABTB10F                          KIGNORE               S01117
     F*********** TABTB11F                          KIGNORE               S01117
     F**ICD*SE*** TABTB36F                          KIGNORE               S01117
     F**ICD*5**** TABTB40F                          KIGNORE               S01117
     F**CCY****** TABTG10F                          KIGNORE               S01117
     F*********** TABTG20F                          KIGNORE               S01117
     F*********** TABLETAF                          KIGNORE               S01117
     F*********** TABLETHF                          KIGNORE               S01117
     F*********** TABLETJF                          KIGNORE               S01117
     F**NOSTROS** TABLETLF                          KIGNORE               S01117
     F**BRANCH*** TABLETRF                          KIGNORE               S01117
     F*********** TABLETXF                          KIGNORE               S01117
     F**CPTY*NOST TABLET2F                          KIGNORE               S01117
     F*********** TABLET3F                          KIGNORE               S01117
     F*********** TABLET5F                          KIGNORE               S01117
     F*********** TABTE10F                          KIGNORE               S01117
     F*********** TABTE20F                          KIGNORE               S01117
     F*********** TABLETNF                          KIGNORE               S01117
     F*********** TABLETKF                          KIGNORE               S01117
     F*********** TABLETPF                          KIGNORE               S01117
     F*TABTB20*IF**E*****               DISK                        E14712S01117
     FSESWHTL0IF  E           K        DISK                               S01447
     F* Securities WHT details file                                       S01447
     FPMPORTPDIF  E           K        DISK                           UC  S01486
     FSECOATL0IF  E           K        DISK                               CSE007
     FSECORFL0IF  E           K        DISK                                                   191161
     FSECOALLAUF  E           K        DISK         KCOMIT                                    191161
     FSECODPL7UF  E           K        DISK         KCOMIT                                    191161
     FSDCWHTL1IF  E           K        DISK                                                   CSD015
      *                                                                                       CSD015
      **  Compliance Hit list file for retrieve.                                              CSD015
     FREADVCL3UF  E           K        DISK         KCOMIT       A    UC                      CRE020
      **  Midas RE Settled Transaction Index File by Ref No/Pgm Ref                           CRE020
      *                                                                                       CRE020
     FPOSETDY3UF  E           K        DISK         KCOMIT       A                            CRE020
      **  Midas SE Position Settlement Extension file                                         CRE020
      *                                                                                       CRE020
     FSDSTMDL0UF  E           K        DISK         KCOMIT       A                            CER049
      **  Midas SD Stamp Tax History Detail file                                              CER049
     FSDCUSQL0IF  E           K        DISK                                                AR851784A
      **  Midas SD Stamp Tax Customer Extension file                                       AR851784A
     F*                                                                   S01408
     F/COPY WNCPYSRC,SE0170FFP1                                           S01408
     F*                                                                   S01408
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*   01         S/SUBFLCTL  SFLDSP                               *
     F*   02         S/SUBFLCTL  SFLDSPCTL                            *
     F*   03         S/SUBFLCTL  SFLEND                               *
     F****04*********S/SUBFLCTL**ROLLDOWN*NOT*ALLOWED******************   084981
     F*   05         S/KEYINPUT  PROTECT/NON-DISPLAY ON LOCATION      *
     F*   06         S/RECDETLS  PROTECT FIELDS                       *
     F*                                                               *
     F*   10         START  SCREEN                                    *
     F*   11         REVIEW SCREEN                                    *
     F*   12         UPDATE SCREEN                                    *
     F*                                                               *
     F*   13         Analytical accounting is installed               *   CAC002
     F*   14         Nominal and settle ccys are equal and action 'E' *   CAC002
     F*   15         INDICATOR USED ON WRITE/UPDATE OPS TO CONDITION  *
     F*                                 CALL OF INFSR                 *
     F*   16         ACCOUNT BLOCKED FOR DEBITS                       *   E16843
     F*   17         ACCOUNT BLOCKED FOR CREDITS                      *   E16843
     F*   18         S01509 IS ACTIVE                                 *   S01509
     F*   19         S01512 IS ACTIVE                                 *   S01512
     F*                                                               *
      *   20         CSE023 IS ACTIVE                                 *   CSE023
     F*   21         S/KEYINPUT  ERROR-ACTN                           *
     F****22*********S/KEYINPUT  ERROR-PBCH                           *   S01117
     F*   22         S/KEYINPUT  ERROR-PBCA                           *   S01117
     F*   23         S/KEYINPUT  ERROR-PSSH                           *
     F*   24         S/KEYINPUT  ERROR-PCPY                           *
     F*   27         S/KEYINPUT  ERROR-PTFR                           *   S01496
     F*   28         PORTFOLIO MANAGEMENT INSTALLED INDICATOR         *   S01496
     F*   31         S/KEYINPUT  ERROR-PPALL                          *   S01496
     F*   32         S/RECDETLS  DISLAY SPMTRV                        *   S01496
     F*                                                               *
     F*   30         S/RECDETLS  POSITION CURSOR                      *
     F*   34         S/RECDETLS  ERROR-PSXR                           *   E18884
     F*   35         S/RECDETLS  ERROR-PBCD                           *
     F*   36         S/RECDETLS  ERROR-PPRE                           *
     F*   37         S/RECDETLS  ERROR-PSCU                           *
     F*** 38 *** S/RECDETLS  ERROR-PSXR ** IN38 ACTUALLY USED ON PBRX *   E18884
     F*   38         S/RECDETLS  ERROR-PBRX                           *
     F*   39         S/RECDETLS  ERROR-PSMT                           *
     F*   40         S/RECDETLS  ERROR-PSEA                           *
     F*   41         S/RECDETLS  ERROR-PSEB                           *
     F*   42         S/RECDETLS  ERROR-PCPN                           *
     F*   43         S/RECDETLS  ERROR-PFAC                           *
     F*   44         S/RECDETLS  ERROR-PSPI                           *
     F*   45         S/RECDETLS  ERROR-PCHC                           *
     F*   46         S/RECDETLS  ERROR-PMDI                           *
     F*   47         S/RECDETLS  ERROR-PCCD                           *
     F*   48         S/RECDETLS  ERROR-PBRX                           *
     F*   49         S/RECDETLS  ERROR-PSAT                           *
     F*   50         S/RECDETLS  ERROR-PAMD                           *
     F*   54         S/RECDETLS  ERROR-PPFC                           *   S01117
     F*                                                               *
     F*   55         ROLLUP                                           *   S01179
     F*   56         Error in margin points (FXMP)                    *   CAC002
     F****56*********ROLLDOWN**************************************S01179 084981
     F*   57         HELP                                             *   S01179
      *                                                               *   CSE023
      *   57         S/RECDETLS  ERROR-SEXCD                          *   CSE023
      *   58         S/RECDETLS  ERROR-STXBS                          *   CSE023
      *   59         S/RECDETLS  ERROR-SBNFO                          *   CSE023
     F*                                                               *   S01179
     F*   60         ADD RECORD                                       *
     F*   61         Subfile next change indicator                    *   084981
     F*   62         No more changed subfile record                   *   084981
     F*   64         Error code already written to error line         *   084981
     F*   65         VLDCMDKY INDICATOR FOR DISPLAY FILE              *   S01179
      *   69         READVCL3 Search (CHAIN) Indicator                *                       CRE020
      *   75         Display EU Tax fields                            *                       233711
      *   76         S/RECDETLS  ERROR-STXNM                          *                       233711
     F*   81         MULTIBRANCHING INDICATOR = 'Y'                   *   S01117
     F*   82         PROFIT CENTRES USED                              *   S01117
     F*   83         PROFIT CENTRE AMENDABLE                          *   S01117
     F*   84         NOT CUSTOMER POSITION SETTLEMENT                 *   S01117
     F*   88         'Already processed' error.                       *   E21590
     F*   88         Special instruction field validation             *   S01412
     F*   89         DEFLTS ALREADY CALLED                            *
     F*                                                               *
     F*   97         WORK                                             *
     F*   98         DATF = MMDDYY                                    *
     F*   99         WORK                                             *
     F*                                                               *
     F*   U7         DATABASE ERROR                                   *
     F*   U8         PROGRAM  ERROR                                   *
      *   LR         Last Record Indicator                            *   CSE010
     F*                                                               *
     F*   'AID' VALUES USED                                           *
     F*                                                               *
     F*   01         CA3                                              *   S01179
     F*   04         CA10                                             *   S01179
     F*   05         CA12                                             *   S01179
     F*   RA         ENTER PRESSED                                    *
     F*   UP         ROLLUP                                           *
     F****DN*********ROLLDOWN******************************************   084981
     F****HP*********HELP*PRESSED**************************************   S01199
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*  INIT   - INITIALISATION OF STANDARD FIELDS,                  *
     F*                     ACCESS OF STANDING DATA                   *
     F*  START  - OUTPUT AND PROCESS KEY FIELDS SCREEN                *
     F*  REVIEW - PROCESS SUBFILE SELECTION SCREEN                    *
     F*  ROLLUP - FILL IN THE SUBFILE                                 *   084981
     F*  UPDATE - PROCESS DETAIL SCREEN AND UPDATE FILE               *
     F*  VALIDK - VALIDATE KEY FIELDS                                 *
     F*  VALIDD - VALIDATE DETAIL SCREEN                              *
     F*  VALTAX - VALIDATE WITHHOLDING FIELDS                         *   S01447
      *  WITHTX - VALIDATE WITHHOLDING FIELDS BY CSE023 PROTOCOL      *   CSE023
     F*  SRSTAX - VALIDATE STAMP TAX                                  *                       CER049
     F*  SEPTVS - VALIDATE SPECIAL INSTRUCTIONS FIELD                 *
     F*  DEFLTS - FORMAT DEFAULT FIELD VALUES                         *
     F*  INITRC - INITIALISE ALL FILE FIELDS TO ZERO/BLANK            *
     F***ACCMOV*-*WRITE*A*RECORD*TO*THE*ACCOUNT*MOVEMENT*FILE**    S01154 082738
     F*  TRSFS  - FORMAT RECORD FIELDS FOR SCREEN                     *
     F*  UPDFLS - UPDATE FILE RECORDS                                 *
     F*  PSAMT  - CALCULATE SETTLEMENT AMOUNT FOR S01512              *   S01512
     F*  UPDOWS - PROCESS UPDATE BY ANOTHER WORKSTATION               *
     F***WNOSTR*-*Update*projected*Nostro*details**                051475 082738
     F***WOLPOS*-*Update*on-line*positions*details**               051475 082738
     F*  INFSR  - FILE ERROR HANDLING S/R                             *
     F*  D1QRY  - QUERY SELECTION OF KEY FIELDS                       *   S01117
     F*  D2QRY  - QUERY SELECTION OF DETAIL FIELDS                    *   S01117
     F*  *PSSR  - HANDLING ABNORMAL ERROR CONDITIONS                  *   S01117
     F*                                                               *
     F*  ZACCH  - ACCESS A HOLIDAY RECORD FOR A PARTICULAR CURRENCY   *   S01195
     F*           AND LOCATION                                        *   S01195
     F*  ZALIGN - VALIDATE AMOUNT FIELDS                              *
     F*  ZCHKH  - DETERMINE IF A GIVEN DATE IS A HOLIDAY FOR A        *   S01195
     F*           PARTICULAR CURRENCY AND LOCATION                    *   S01195
     F*  ZDATE1 - CONVERT DATE TO DAYNO. AND REPORT IF ERROR          *
     F*  ZDATE2 - CONVERT DAYNO. TO DATE FOR DISPLAY                  *
     F***ZSYSTM*-*ACCESS*ICD*RECORD************************************   S01117
     F***ZICD2**-*ACCESS*ICD2*RECORD***********************************   S01117
     F***ZICDSE*-*ACCESS*ICD*FOR*SE*RECORD*****************************   S01117
     F***ZDATE5*-*TO*DETERMINE*IF*A*DAY*NUMBER*DATE*IS*A*HOLIDAY*******   S01195
     F************IN*GIVEN*CURRENCY,*AND,*IF*DAY*IS*A*HOLIDAY**********   S01195
     F************AND*IF*REQUIRED,*DETERMINE*NEXT*WORKING*DAY.*********   S01195
     F*  ZXRATE - TO OBTAIN A CROSS-EXCHANGE RATE AND  M/D            *
     F*           INDICATOR BETWEEN TWO CURRENCIES                    *
     F*  ZSEDIT - To insert a decimal point and sign into a           *
     F*           numeric field and to blank out leading zeros        *
     F*           (OPTIONALY inserting commas).                       *
     F*  ZTNLU1 - ACCESS DATAAREA FOR NEXT TRANSACTION NO.            *
     F*                                                               *
     F*****************************************************************
      /EJECT
     E                    CPY@    1   1 80
     E                    DET       256  1
     E                    CRW     1   6 21               2nd parameter string                 CSD015
     E                    ERR        19  4
     E/COPY WNCPYSRC,SE0170E002
     E***********         INF     1  12 76                                S01496
     E***********         INF     1  13 76                         S01496 084981
     E**********          INF     1  14 76                                           084981 AR324886
     E                    INF     1  17 76                                                  AR324886
     E/COPY WNCPYSRC,SE0170E003
     E***********         AND         5  3               NOSTRO DAT051475 082738
     E***********         ANB         5  8               NOSTRO BAL051475 082738
     E***********         ADT        16  3               ONLINE POS051475 082738
     E***********         AFI        16  8               ONLINE POS051475 082738
     E***********         AFO        16  8               ONLINE POS051475 082738
     E* Define numeric arrays                                             051475
     E***********         NND         5  5 0             NOSTRO DAT051475 082738
     E***********         NNB         5 15 0             NOSTRO BAL051475 082738
     E***********         NDT        16  5 0             ONLINE POS051475 082738
     E***********         NFI        16 15 0             ONLINE POS051475 082738
     E***********         NFO        16 15 0             ONLINE POS051475 082738
     E                    APF        16  1               VALID PAY FROM   051475
     E/COPY ZSRSRC,ZDATE2Z1
     E*COPY*ZSRSRC,ZDATE6Z1                                               S01195
     E/COPY ZSRSRC,ZHOLE                                                  S01195
     E** SR.ARRAY FOR BOTH ZACCH AND ZCHKH                                S01195
     E/COPY ZSRSRC,ZALIGNZ1
     E/COPY ZSRSRC,ZSEDITZ1
     E/COPY ZSRSRC,ZASIGNZ1
     E                    UPA    27  27  1                                S01412
     E** Valid codeword characters                                        S01412
      *                                                                                       CSW201
     E                    APN    37  37  1                                                    CSW201
      ** Valid uppercase alphabetic characters and numeric digits                             CSW201
     E*                                                                   S01412
     E                    SWCH   47  47  1                                S01412
     E** Valid SWIFT ISO characters                                       S01412
     E*                                                                   S01412
     E                    SIL        35  1                                S01412
     E** Special instruction line                                         S01412
     E*                                                                   S01412
     E                    POWER   1   7  7 3             POWER ARRAY      055839
     E                    AP      1  10 10 0                              CAC002
      ** Array - Powers of Ten.                                           CAC002
      *                                                                   CAC002
     E/COPY WNCPYSRC,SE0170E001
     E/COPY ZSRSRC,ZSDESCZ1                                               CSE016
      /EJECT
     IACCNTABF                                                            178530
     I              RECI                            RECIA                 178530
     I              PTFR                            PTFR1                 173501
     IACNUMF                                                              178530
     I              RECI                            RECIA                 178350
     I              PTFR                            PTFR2                 173501
     IPOSETDF                                                             S01486
     I              TNLU                            TNL1                  S01486
     IPOSETDFX                                                            S01486
     I              TNLU                            TNL1                  S01486
     IPOSETDF6                                                                              BUG12729
     I              TNLU                            TNL1                                    BUG12729
     ICPOSNDF                                                             186055
     I              RECI                            RECIX                 186055
      *                                                                                       CSE028
      ** DS for customer/book standard settlement instruction                                 CSE028
      **  to be passed to SESSIR0                                                             CSE028
      *                                                                                       CSE028
     IPCBSTD    E DSSTDSED                    2                                               CSE028
     I              RECI                            WRECI                                     CSE028
     I              LCD                             WLCD                                      CSE028
     I              CHTP                            WCHTP                                     CSE028
     I              TNLU                            WTNLU                                     CSE028
      *                                                                                       CSE028
      ** Data structure for standard additional settlement details                            CSE028
      ** for customer/book to be passed to SESSIR0                                            CSE028
      *                                                                                       CSE028
     IPCBSAD    E DSSTDADSED                  8                                               CSE028
     I*
     I*PRONOPNF*****                                               051475 082738
     I**************PND                             PNDA           051475 082738
     I**************PNB                             PNBA           051475 082738
     I**************CNUM                            CNUMA          051475 082738
     I**************                                                      082738
     I*OLPOSOAF*****                                               051475 082738
     I**************ODT                             ODTA           051475 082738
     I**************OFI                             OFIA           051475 082738
     I**************OFO                             OFOA           051475 082738
     I*                                                                   051475
     ICPYR@#      DS
     I*
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I*
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*
     I/COPY ZSRSRC,ZSEDITZ2
     I*TABKEY*****DS***                                                   S01117
     I***********                             1  12 KEY                   S01117
     I***********                             1   2 TYPE                  S01117
     I***********                             5  12 KCPN                  S01117
     I***********                             8  10 KCCY                  S01117
     I***********                             9  11 KCCY2                 S01117
     I*
     I*ZZ039***** DS                                                      082738
     I***********                                                         082738
     I***Define*balance fields in MEMOS                                   082738
     I***********                                                         082738
     I***********                             1  150LDBL                  082738
     I***********                            16  300BKBL                  082738
     I*
     I**********  DS                             12                                           CGL029
     I            DS                             18                                           CGL029
     I*
     I* SPLITTING UP SETTLEMENT A/C INTO PARTS
     I*
     I**********                              1  12 PSEA@                                     CGL029
     I                                        1  18 PSEA@                                     CGL029
     I**********                              1   60CUS@                                      CSD027
     I                                        1   6 CUS@                                      CSD027
     I**********                              7  100ACOD@                                     CGL029
     I**********                             11  120ACSQ@                                     CGL029
     I                                        7  160ACOD@                                     CGL029
     I                                       17  180ACSQ@                                     CGL029
     I            DS
     I                                        1  75 HCCY
     I                                        1  75 XCCY
     ISCRCTL      DS
     I*
     I** KEY FIELDS (TAKEN FROM 'KEY' PORTION OF SCREEN)
     I*
     I                                        1   1 REVW
     I                                        2   2 ACTN
     I****************************************3  23 INPK                  S01486
     I**********                              3  37 INPK           S01486 186055
     I                                        3  61 INPK                  186055
     I***********                             3  05 SPBCH                 S01117
     I                                        3  05 SPBCA                 S01117
     I                                        6  15 SPSSH
     I                                       16  25 SPCPY
     I                                       26  31 SPDUD
     I                                       32  33 SPEVT
     I                                       34  37 SPPTFR                S01486
     I                                       38  39 STXBS                 186055
     I                                       40  59 SBNFO                 186055
     I                                       60  61 SEXCD                 186055
     I***************************************34  64 PAGK                  S01486
     I***********                            34  36 PPBCH                 S01117
     I***************************************34  36 PPBCA          S01117 S01486
     I***************************************37  46 PPSSH                 S01486
     I***************************************47  56 PPCPY                 S01486
     I***************************************57  62 PPDUD                 S01486
     I***************************************63  64 PPEVT                 S01486
     I**********                             38  68 PAGK           S01486 186055
     I**********                             38  40 PPBCA          S01486 186055
     I**********                             41  50 PPSSH          S01486 186055
     I**********                             51  60 PPCPY          S01486 186055
     I**********                             61  66 PPDUD          S01486 186055
     I**********                             67  68 PPEVT          S01486 186055
     I**********                              3  33 KEYFLD         E37157 186055
     I                                       62  92 PAGK                  186055
     I                                       62  64 PPBCA                 186055
     I                                       65  74 PPSSH                 186055
     I                                       75  84 PPCPY                 186055
     I                                       85  90 PPDUD                 186055
     I                                       91  92 PPEVT                 186055
     I                                        3  61 KEYFLD                186055
     I*                                                                   E37157
     I            DS                                                      E37157
     I                                        1   3 MPBCA                 E37157
     I                                        4  13 MPSSH                 E37157
     I                                       14  23 MPCPY                 E37157
     I                                       24  29 MPDUD                 E37157
     I                                       30  31 MPEVT                 E37157
     I                                    P  69  710SPTNLU                099267
     I                                        1  31 MTYFLD                E37157
     I*                                                                   051475
     IZ#BSTS    E DSZ#BST                                                 082738
     I                                    P 168 1700TNLUX1                                    CRE020
     IZ#ASTS    E DSZ#AST                                                 082738
     I                                    P 168 1700TNLUX2                                    CRE020
     I*                                                                   082738
     I***Data*structures to format numeric arrays/fields           051475 082738
     I*********** DS                                               051475 082738
     I***********                         P   1  15 NND            051475 082738
     I***********                         P  16  55 NNB            051475 082738
     I***********                             1  15 AND            051475 082738
     I***********                            16  55 ANB            051475 082738
     I***********                                                  051475 082738
     I*********** DS                                               051475 082738
     I***********                         P   1  48 NDT            051475 082738
     I***********                         P  49 176 NFI            051475 082738
     I***********                         P 177 304 NFO            051475 082738
     I***********                             1  48 ADT            051475 082738
     I***********                            49 176 AFI            051475 082738
     I***********                           177 304 AFO            051475 082738
     I*
     IDETREC    E DSPOSETD
     I*
     I** DATA STRUCTURE FOR INITIALISING A RECORD
     I*
     I***********   PBCH                            PBCHX                 S01117
     I              PBCA                            PBCAX                 S01117
     I              PSSH                            PSSHX
     I              PCPY                            PCPYX
     I              PDUD                            PDUDX
     I              PEVT                            PEVTX
     I              PTFR                            PTFRX                 S01486
     I              TNLU                            TNLUX                 S01486
     I              TXBS                            TXBSX                 186055
     I              BNFO                            BNFOX                 186055
     I              EXCD                            EXCDX                 186055
     I*
     I***DETS******E DSSE0170DF                                           S01179
     IDETS        DS                                                      S01179
     I*                                                                   S01179
     I** DATA STRUCTURE FOR SCREEN DETAIL OUTPUT TO CMTTXT                S01179
     I*                                                                   S01179
     I                                        1   2 SPBCD                 S01179
     I                                        3  16 SPAMD                 S01179
     I                                       17  17 SPPRE                 S01179
     I                                       18  20 SPSCU                 S01179
     I                                       21  21 SPMDI                 S01179
     I                                       22  36 SPBRX                 S01179
     I                                       37  38 SPSMT                 S01179
     I**********                             39  50 SPSEA                              S01179 CGL029
     I                                       39  50 QQSEA                                     CGL029
     I                                       51  53 SPSEB                 S01179
     I                                       54  63 SPCPN                 S01179
     I                                       64  73 SPFAC                 S01179
     I                                       74 108 SPSPI                 S01179
     I                                      109 110 SPCHC                 S01179
     I                                      111 125 SPCHA                 S01179
     I                                      126 127 SPCCD                 S01179
     I                                      128 142 SPCAM                 S01179
     I                                      143 157 SPSAT                 S01179
     I                                      158 172 SPSXR                 S01179
     I                                      173 178 SPSVL                 S01512
     I                                      179 196 SPSEA                                     CGL029
     ISCRMSG      DS                          1 152
     I*
     I** DATA STRUCTURE FOR ERROR MESSAGES TO SCREEN
     I*
     I                                        1  76 ERR
     I                                        1  76 ERRMSG
     I                                       77 152 INFMSG
     I*
     ISCRDS       DS
     I*
     I** DISPLAY FORMAT STATUS DATA STRUCTURE
     I*
     I                                      287 288 AID
     I                                      376 377 SFRNO
     IINFDS       DS
     I*
     I** DATA STRUCTURE FOR RPG 01021 ERROR HANDLING
     I*
     I                                     *STATUS  STATUS
     I*LDA*******UDS****************************256                       S01117
     I**************************************134 177 DBLOT                 S01117
     I**************************************134 138 DBFILE                S01117
     I**************************************139 167 DBKEY                 S01117
     I**************************************168 175 DBPGM                 S01117
     I**************************************176 177 DBASE                 S01117
     I** *LOCK IN LDA immediately before and OUT LDA immediately          S01117
     I** after each database error handling.                              S01117
     I*
     IINFDS1      DS                                                                        BUG12729
     I                                     *STATUS  STATS1                                  BUG12729
     IPDS1      E DSSDWLTOPD                                                                  CSD015
      ** Compliance watch engine program 1st data parameter                                   CSD015
      *                                                                                       CSD015
     IPSTRNG      DS                           9999                                           CSD015
      ** Compliance watch engine program 2nd parameter                                        CSD015
      *                                                                                       CSD015
     IWWEXRC      DS                           9999                                           CSD015
      *                                                                                       CSD015
     ILDA         DS                            256                       S01117
     I*
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I*
     I                                      134 183 DBLOT                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     I*
     I/COPY ZSRSRC,ZTNLU1Z1
     I*                                                                   S01195
     I/COPY ZSRSRC,ZHOLI                                                  S01195
      **  EXTERNAL DS FOR HOLIDAY DETAILS                                 S01195
     I*                                                                   S01195
     I/COPY ZSRSRC,ZHOLDS                                                 S01195
      **  EXTERNAL DS FOR HOLIDAY DETAILS AND ACCESS OBJECTS              S01195
     I*                                                                   S01195
     I***P@DATA******DS                            100             087178 CAC002
     I/COPY WNCPYSRC,SE0170I001
     I***P@DATA*     DS                            128                               CAC002 AR851833
     IP@DATA      DS                            141                                         AR851833
     I** Data structure for the parameter passed to SEZ010                087178
     I                                        1   1 P@CLAS                087178
     I                                        2   2 P@PPRE                087178
     I                                        3  150P@PAMD                087178
     I                                       16  280P@PCHA                087178
     I                                       29  410P@PCAM                087178
     I                                       42  540P@TASO                087178
     I                                       55  670P@TAUS                087178
     I                                       68  808P@PSXR                087178
     I                                       81  81 P@PMDI                087178
     I                                       82  84 P@PNCY                087178
     I                                       85  87 P@PSCU                087178
     I                                       88 1000P@PSAT                087178
     I                                      101 1138P@FXMR                CAC002
     I                                      114 1260P@MAMT                CAC002
     I                                      127 128 P@TDTP                CAC002
     I                                      129 141 P@STAM                                  AR851833
     I/COPY WNCPYSRC,SE0170I002
     I**                                                                  S01117
     IRUNDT       DS                                                      S01117
     I** DATA AREA RUNDAT                                                 S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
     I*                                                                   S01117
     IZMUSER      DS                             17                       S01117
     I** DATA AREA OF MENU USER                                           S01117
     I                                       11  13 USRBCH                S01117
      *                                                                                       CRE020
     I            DS                                                                          CRE020
     I                                        1  26 WREFNO                                    CRE020
     I                                        1  10 WSSH                                      CRE020
     I                                       11  16 WCPY                                      CRE020
     I                                       17  19 WBCA                                      CRE020
     I                                       20  24 WDUD                                      CRE020
     I                                       25  26 WEVT                                      CRE020
      ** Reference Number Data Structure                                                      CRE020
      *                                                                                       CRE020
     I*                                                                   S01486
     ISDPLCS    E DSSDPLCSPD                                              S01486
     I* Portfolio Customer Details Accessed Via Access Program            S01486
     I*                                                                   S01486
     ISDPORT    E DSSDPORTPD                                              S01486
     I** Portfolio Definition Via Access Program                          S01486
     I*                                                                   S01117
     ISDBANK    E DSSDBANKPD                                              S01117
     I**  Bank Details                                                    S01117
     I**                                                                  S01117
     I*                                                                   S01117
     ISDBOOK    E DSSDBOOKPD                                              S01117
     I**  Book Details                                                    S01117
     I**                                                                  S01117
     I*                                                                   S01117
     ISDBRCH    E DSSDBRCHPD                                              S01117
     I**  Branch Details                                                  S01117
     I**                                                                  S01117
     ISDBRCE    E DSSDBRCHEXPD                                                                CER049
     I*                                                                   S01117
     ISDCNST    E DSSDCNSTPD                                              S01117
     I**  Counterparty Nostro Details                                     S01117
     I**                                                                  S01117
     I*                                                                   S01117
     ISDCURR    E DSSDCURRPD                                              S01117
     I**  Currency Details                                                S01117
     I**                                                                  S01117
     I*                                                                   S01117
     ISDCUST    E DSSDCUSTPD                                              S01117
     I**  Client Details                                                  S01117
     I              QQDFAC                          DFACQQ                                    CGL029
     I**                                                                  S01117
     I*                                                                   S01117
     ISDGELR    E DSSDGELRPD                                              S01117
     I**  General Ledger Details                                          S01117
     I**                                                                  S01117
     I*                                                                   S01117
     ISDMMOD    E DSSDMMODPD                                              S01117
     I**  Midas Module Details                                            S01117
     I**                                                                  S01117
     I*                                                                   S01117
     ISDNOST    E DSSDNOSTPD                                              S01117
     I**  Nostro Details                                                  S01117
     I              QQACCD                          ACCDQQ                                    CGL029
     I**                                                                  S01117
     I*                                                                   S01117
     ISDPRFC    E DSSDPRFCPD                                              S01117
     I**  Profit Centre Details                                           S01117
     I**                                                                  S01117
     I*                                                                   S01117
     ISDRETL    E DSSDRETLPD                                              S01117
     I**  Retail Details                                                  S01117
     I              QQACCD                          ACD2QQ                                    CGL029
     I**                                                                  S01117
     I*                                                                   S01117
     ISDSECS    E DSSDSECSPD                                              S01117
     I**  Securities Client Details                                       S01117
     I              QQACCD                          ACD3QQ                                    CGL029
     I**                                                                  S01117
     I*                                                                   S01117
     ISDSTRD    E DSSDSTRDPD                                              S01117
     I**  Securities Trading Details                                      S01117
     I**                                                                  S01117
     I*                                                                   S01117
     ISDTRAD    E DSSDTRADPD                                              S01117
     I**  Trading Details                                                 S01117
     I              QQACCD                          ACD4QQ                                    CGL029
     I**                                                                  S01117
     I*                                                                   S01408
     ISDPCAC    E DSSDPCACPD                                              CAC002
      **  PCA I.C.Details                                                 CAC002
     ISDWLCC    E DSSDWLCCPD                                                                  CSD015
      ** Watch list checking details                                                          CSD015
      *                                                                                       CSD015
     ISDCWCD    E DSSDCWCDPD                                                                  CSD015
      ** DS For Watch List Configuration Data File                                            CSD015
      *                                                                                       CSD015
     ISDSTAT    E DSSDSTAT                                                                    CSD015
      ** SD data area                                                                         CSD015
     ISC24X7    E DSSC24X7                                                                    CSD015
      **  24X7 status data area                                                               CSD015
     ISCSARD    E DSSCSARDPD                                                                  CSD015
     I              LCD                             LCD3                                      CSD015
      *                                                                   CAC002
     ISDLOCN    E DSSDLOCNPD                                                                  233711
      **  Location Details                                                                    233711
      *                                                                                       233711
     ISDCTRY    E DSSDCTRYPD                                                                  233711
      **  Country Details                                                                     233711
      *                                                                                       233711
     I/COPY WNCPYSRC,SE0170IIPG                                           S01408
     I*                                                                   S01408
     I*                                                                   S01117
     IDSFDY     E DSDSFDY                                                 S01117
     I*  FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE               S01117
     I*                                                                   CPB001
     IDSLDY     E DSDSLDY                                                 CPB001
     I*  THIRD DS FOR ACCESS PROGRAMS, VERY LONG DATA STRUCTURE           CPB001
     I**                                                                  S01117
     I** OVERRIDE COMMANDS                                                S01496
     I*                                                                   S01496
     IDSOVRA      DS                                                      S01496
     I*I************'OVRDBF POSETX SEPOST-    1  35 CCOVRA         S01496 084981
     I**************'L0 SECURE(*YES)'                              S01496 084981
     I*I********    'OVRDBF POSETX POSET -    1  33 CCOVRA         084981 186055
     I**********    'SECURE(*YES)'                                 084981 186055
     I I            'OVRDBF POSETX POSET7-    1  33 CCOVRA                186055
     I              ' SECURE(*YES)'                                       186055
     IDSOVRL      DS                                                      S01496
     I*I************'OVRDBF POSETX POSET -    1  32 CCOVRL         S01496 084981
     I**************'SECURE(*YES)'                                 S01496 084981
     I*I********    'OVRDBF POSETX POSET2-    1  33 CCOVRL         084981 186055
     I**********    ' SECURE(*YES)'                                084981 186055
     I I            'OVRDBF POSETX POSET8-    1  33 CCOVRL                186055
     I              ' SECURE(*YES)'                                       186055
     I              'PositionSettlement'  C         WPSET                                     CRE020
      *                                                                                       CRE020
     I*                                                                   S01117
     ICMTTXT      DS
     I*
     I** DATA STRUCTURE FOR SETUP OF COMMIT TEXT
     I*
     I                                        1   50NATN
     I                                        6   7 MDID
     I                                        8  15 PGMN
     I                                       16  18 WSIDX
     I                                       19  240MTIME
     I                                       25  25 ACTNX
     I                                       26  35 USIDX
     I                                       51 306 DET
     I*SVPOS******DS                                               E16843 082738
     I************                                                 E16843 082738
     I***Saved*fields in POSETD to be saved                        E16843 082738
     I************                                                 E16843 082738
     I************                            1   60SVPCPY         E16843 082738
     I************                            7   7 SVPAUI         E16843 082738
     I************                            8   8 SVPPRE         E16843 082738
     I************                            9  11 SVPSCU         E16843 082738
     I************                           12  130SVPSMT         E16843 082738
     I************                           14  25 SVPSEA         E16843 082738
     I************                           26  28 SVPSEB         E16843 082738
     I************                        P  29  350SVPSAT         E16843 082738
     I************                           36  38 SVPBCA         S01117 082738
     I*@POS*******DS                                               E16843 082738
     I************                                                 E16843 082738
     I**POSETD*fields moved to work fields for use in Subroutine REE16843 082738
     I************                                                 E16843 082738
     I************                            1   60@PCPY          E16843 082738
     I************                            7   7 @PAUI          E16843 082738
     I************                            8   8 @PPRE          E16843 082738
     I************                            9  11 @PSCU          E16843 082738
     I************                           12  130@PSMT          E16843 082738
     I************                           14  25 @PSEA          E16843 082738
     I************                           26  28 @PSEB          E16843 082738
     I************                        P  29  350@PSAT          E16843 082738
     I************                           36  38 @PBCA          S01117 082738
     I*                                                                   082738
     IKYACC       DS                                                      E16843
     I*                                                                   E16843
     I* Key fields used in READ of ACCNTAB for use in Subroutine RETAIL   E16843
     I*                                                                   E16843
     I**********                              1   60KYCNUM                             E16843 CSD027
     I                                        1   6 KYCNUM                                    CSD027
     I                                        7   9 KYCCY                 E16843
     I**********                             10  130KYACOD                             E16843 CGL029
     I                                       10  130QQACOD                                    CGL029
     I                                       14  150KYACSQ                E16843
     I                                       16  18 KYBRCA                S01117
     I                                       19  280KYACOD                                    CGL029
     I*
     IPSDS       SDS
     I*
     I** PROGRAM STATUS DATA STRUCTURE FOR WS/USER ID'S
     I*
      *                                                                   S01408
      ** Program status data structure (SDS suite)                        CGL007
      *                                                                   CGL007
     I                                       37  390@NOPMS                CGL007
     I/COPY WNCPYSRC,SE0170IIP2                                           S01408
      *                                                                   S01408
     I                                      244 246 WSID
     I                                      254 263 USID
      *                                                                   S01408
     I/COPY WNCPYSRC,SE0170IIP1                                           S01408
     I/COPY ZSRSRC,ZSDESCZ2                                               CSE016
      *                                                                   S01408
      *                                                                   S01401
      **  External data structure defined for passing data from this      S01401
      **  program to SE1817.                                              S01401
      *                                                                   S01401
     IPDATA     E DSSE17DT                                                S01401
     I              PPCPY                           PPCPY2                S01401
     I              PPDUD                           PPDUD2                S01401
     I              PPBCA                           PPBCA2                S01401
     I              PPSSH                           PPSSH2                S01401
     I              PPEVT                           PPEVT2                S01401
     I              PPTFR                           PPTFR2                                    CSE028
     I              PPBKC                           PPBKC2                                    CSE028
     ISDSTPD    E DSSDSTPDPD                                                                  CER049
      *                                                                   CSE003
     ISESDS     E DS                                                      CSE003
      ** SE Linked Enquiry Data Area                                      CSE003
     IDSAUTH    E DSPSAUTD                                                                  AR324886
      ** PSAUTD Data structure                                                              AR324886
      *                                                                                     AR324886
     I/COPY WNCPYSRC,SE0170I003
     C/EJECT
      *================================================================
      *  P R O G R A M   S T A R T                                    *
      *================================================================
     C*
     C**  DEFINE KEY LIST FOR CHAINING TO POSET FILE
     C*
     C           POSETK    KLIST
     C***********          KFLD           PBCH                            S01117
     C                     KFLD           PBCA                            S01117
     C                     KFLD           PSSH
     C                     KFLD           PCPY
     C                     KFLD           PDUD
     C                     KFLD           PEVT
     C                     KFLD           PTFR                                              AR996802
     C*                                                                   E16843
     C           POSTK1    KLIST                                          169067
     C                     KFLD           PBCA                            169067
     C                     KFLD           PSSH                            169067
     C                     KFLD           PCPY                            169067
     C                     KFLD           PDUD                            169067
     C                     KFLD           PEVT                            169067
     C                     KFLD           PTFR                            169067
     C**********           KFLD           SPTNLU                   169067 203678
     C                     KFLD           TNL1                            203678
     C*                                                                   S01486
     C**  DEFINE KEY LIST FOR CHAINING TO POSET FILE WITH PORTFOLIO       S01486
     C**   MANAGEMENT INSTALLED                                           S01486
     C*                                                                   S01486
     C           PTFRK     KLIST                                          S01486
     C                     KFLD           PBCA                            S01486
     C                     KFLD           PSSH                            S01486
     C                     KFLD           PCPY                            S01486
     C                     KFLD           PDUD                            S01486
     C                     KFLD           PEVT                            S01486
     C                     KFLD           PTFR                            S01486
     C                     KFLD           TNL1                            S01486
      *                                                                   CSE023
      ** Define key list for chaining to Position Settlements file        CSE023
      ** POSET6 when enhancement CSE023 is installed.                     CSE023
      ** - KLIST with Tax Basket and Beneficial Owner number.             CSE023
      *                                                                   CSE023
     C           PTXBSK    KLIST                                          CSE023
     C                     KFLD           PBCA                            CSE023
     C                     KFLD           PSSH                            CSE023
     C                     KFLD           PCPY                            CSE023
     C                     KFLD           PDUD                            CSE023
     C                     KFLD           PEVT                            CSE023
     C                     KFLD           PTFR                            CSE023
     C                     KFLD           TNL1                            CSE023
     C                     KFLD           TXBS                            CSE023
     C                     KFLD           BNFO                            CSE023
     C                     KFLD           EXCD                            CSE023
     C           PSAUTH    KLIST                                                            AR324886
     C                     KFLD           PBCA                                              AR324886
     C                     KFLD           PSSH                                              AR324886
     C                     KFLD           PCPY                                              AR324886
     C                     KFLD           PDUD                                              AR324886
     C                     KFLD           PEVT                                              AR324886
     C                     KFLD           PTFR                                              AR324886
     C                     KFLD           SPTNLU                                            AR324886
     C                     KFLD           TXBS                                              AR324886
     C                     KFLD           BNFO                                              AR324886
     C                     KFLD           EXCD                                              AR324886
      *                                                                                     AR324886
      *                                                                                     BUG12729
     C           PTXBS6    KLIST                                                            BUG12729
     C                     KFLD           PBCA                                              BUG12729
     C                     KFLD           PSSH                                              BUG12729
     C                     KFLD           PCPY                                              BUG12729
     C                     KFLD           PDUD                                              BUG12729
     C                     KFLD           PEVT                                              BUG12729
     C                     KFLD           PTFR                                              BUG12729
     C                     KFLD           TXBS                                              BUG12729
     C                     KFLD           BNFO                                              BUG12729
     C                     KFLD           EXCD                                              BUG12729
     C                     KFLD           TNL1                                              BUG12729
      *                                                                                     BUG12729
     C           PTXBS7    KLIST                                                            BUG12729
     C                     KFLD           PBCA                                              BUG12729
     C                     KFLD           PSSH                                              BUG12729
     C                     KFLD           PCPY                                              BUG12729
     C                     KFLD           PDUD                                              BUG12729
     C                     KFLD           PEVT                                              BUG12729
     C                     KFLD           PTFR                                              BUG12729
     C                     KFLD           TXBS                                              BUG12729
     C                     KFLD           BNFO                                              BUG12729
     C                     KFLD           EXCD                                              BUG12729
      *                                                                   CSE023
     C**  Key to ACCNTAB                                                  E16843
     C*                                                                   E16843
     C           KEYACC    KLIST                                          E16843
     C                     KFLD           KYCNUM                          E16843
     C                     KFLD           KYCCY                           E16843
     C                     KFLD           KYACOD                          E16843
     C                     KFLD           KYACSQ                          E16843
     C                     KFLD           KYBRCA                          S01117
     C*
     C**  DEFINE KEY LIST FOR CHAINING TO ACCNT FILE
     C*
     C           ACCNTK    KLIST
     C                     KFLD           CUS@
     C                     KFLD           PSCU
     C                     KFLD           ACOD@
     C                     KFLD           ACSQ@
     C                     KFLD           BRCA@   3                       S01117
     C*
     C****DEFINE*KEY*LIST*FOR*CHAINING*TO*SECHG*FILE*******************   S01169
     C***********                                                         S01169
     C***********SECHGK    KLIST                                          S01169
     C***********          KFLD           SPNCY                           S01169
     C***********          KFLD           CCDK                            S01169
     C*                                                                   S01169
     C**  DEFINE KEY LIST FOR CHAINING TO SECGT FILE                      S01169
     C*                                                                   S01169
     C           SECGTK    KLIST                                          S01169
     C                     KFLD           PSCU                            S01169
     C                     KFLD           CCDK                            S01169
     C*
     C*  DEFINE KEY LIST FOR READING INVTP
     C           INVTPK    KLIST
     C                     KFLD           NMCY
     C                     KFLD           SITP
     C*
     C*  DEFINE KEY LIST FOR READING STDSED
     C           STDSEK    KLIST
     C***********          KFLD           PBCH                            S01117
     C                     KFLD           PBCA                            S01117
     C                     KFLD           PCPY
     C                     KFLD           WBKCD                                               CSE028
     C                     KFLD           CURK
     C*                                                                   E16843
     C* Key to fetch ACNUM record                                         E16843
     C*                                                                   E16843
     C           ACNKA     KLIST                                          E16843
     C                     KFLD           KEY10  100                      E16843
     C*                                                                   S01117
     C**  Define Key List for chaining to Profit Centres file             S01117
     C*                                                                   S01117
     C           SEPCCK    KLIST                                          S01117
     C                     KFLD           PCCNM                           S01117
     C                     KFLD           PCBCA                           S01117
     C                     KFLD           PCSSN                           S01117
     C*                                                                   051475
     C**Define*key list for file PRONO                             051475 082738
     C***********                                                  051475 082738
     C***********KLPRON    KLIST                                   051475 082738
     C***********          KFLD           CCY                      051475 082738
     C***********          KFLD           NOSN                     051475 082738
     C***********                                                  051475 082738
     C**Define*key list for file OLPOS                             051475 082738
     C***********                                                  051475 082738
     C***********KLOLPS    KLIST                                   051475 082738
     C***********          KFLD           BRCA                     051475 082738
     C***********          KFLD           CCY                      051475 082738
     C***********          KFLD           RECN                     051475 082738
     C*                                                                   S01486
     C** DEFINE KEY LIST FOR CHAINING TO PMPORTPD                         S01486
     C*                                                                   S01486
     C           PORTK     KLIST                                          S01486
     C**********           KFLD           WWCNUM  60                                   S01486 CSD027
     C                     KFLD           WWCNUM  6                                           CSD027
     C                     KFLD           SPPTFR                          S01486
     C*                                                                   S01486
     C** DEFINE KEY LIST FOR CHAINING TO SDPLCSL2                         S01486
     C*                                                                   S01486
     C           KPLCS     KLIST                                          S01486
     C                     KFLD           WPLCS   6                       S01486
      *                                                                                       CSD015
      ** Watch list checking key used                                                         CSD015
      *                                                                                       CSD015
     C           CMPKEY    KLIST                                                              CSD015
     C                     KFLD           W4FUNT                                              CSD015
     C                     KFLD           W4IDEN                                              CSD015
     C                     KFLD           W4BRCH                                              CSD015
      *                                                                                       CSD015
      ** Midas RE Settled Transaction Index File Key List                                     CRE020
      *                                                                                       CRE020
     C           KADVC     KLIST                                                              CRE020
     C                     KFLD           KREFNO 30                                           CRE020
     C                     KFLD           KPRGMN 10                                           CRE020
     C                     KFLD           KNARR  29                                           CRE020
      *                                                                                       CRE020
      ** Midas SE Position Settlement Extension file                                          CRE020
      *                                                                                       CRE020
     C           KPOST3    KLIST                                                              CRE020
     C                     KFLD           K3PBCA  3                                           CRE020
     C                     KFLD           K3PSSH 10                                           CRE020
     C**********           KFLD           K3PCPY  60                                   CRE020 CSD027
     C                     KFLD           K3PCPY  6                                           CSD027
     C                     KFLD           K3PDUD  50                                          CRE020
     C                     KFLD           K3PEVT  2                                           CRE020
     C                     KFLD           K3TNLU  50                                          CRE020
      *                                                                                       CRE020
     C           KSTAMD    KLIST                                                              CER049
     C                     KFLD           T2KEY                                               CER049
     C                     KFLD           T2TYPE                                              CER049
     C                     KFLD           T2LNRF                                              CER049
     C                     KFLD           T2FCNM                                              CER049
     C                     KFLD           T2FACT                                              CER049
     C                     KFLD           T2FCNO                                              CER049
     C                     KFLD           T2FSEQ                                              CER049
     C                     KFLD           T2ORED                                              CER049
     C                     KFLD           T2DLNO                                              CER049
     C                     KFLD           T2TDRF                                              CER049
     C                     KFLD           T2BRCA                                              CER049
     C                     KFLD           T2CNUM                                              CER049
     C                     KFLD           T2CCY                                               CER049
     C                     KFLD           T2ACOD                                              CER049
     C                     KFLD           T2ACSQ                                              CER049
     C                     KFLD           T2PREF                                              CER049
     C                     KFLD           T2CQSQ                                              CER049
     C                     KFLD           T2PBRC                                              CER049
     C                     KFLD           T2PSSH                                              CER049
     C                     KFLD           T2PCPY                                              CER049
     C                     KFLD           T2PDUD                                              CER049
     C                     KFLD           T2PEVT                                              CER049
      *                                                                                       CER049
     C/COPY WNCPYSRC,SE0170C042
     C*
     C** PERFORM SETUP OF STANDARD FIELDS
     C*
     C                     EXSR INIT
      *
      ***  Do Until Command 3 or error
      *
     C           AID       DOUEQ'01'
     C           *INU7     OREQ '1'
     C           ENDPGM    OREQ 'Y'                                       084981
     C*
     C           *IN10     CASEQ'1'       START
     C           *IN11     CASEQ'1'       REVIEW
     C           *IN12     CASEQ'1'       UPDATE
     C*
     C                     END
     C                     END
     C/COPY WNCPYSRC,SE0170C096
      *
      *================================================================
      *  P R O G R A M     E N D                                      *
      *                                                               *
     C                     SETON                         LR
      *                                                               *
      *================================================================
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  INIT S/R  -  TO INITIALISE STATIC FIELDS AND ACCESS STANDING *
     C*               DATA                                            *
     C*  CALLED FROM: MAIN LINE PROCESSING                            *
     C*  CALLS:       ZSYSTM, ZICD2 , ZICDSE.                         *
     C*                                                               *
     C*****************************************************************
     C*
     C           INIT      BEGSR                           * INIT BEGSR *
     C*
     C** PREPARE LDA
     C*
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C/COPY WNCPYSRC,SE0170C097
     C                     MOVEL*BLANK    DBLOT
     C                     MOVEL'SE0170'  DBPGM
     C                     OUT  LDA                                       S01117
      *                                                                   CSE003
     C           *NAMVAR   DEFN           SDSTAT                                              CSD015
     C                     IN   SDSTAT                                                        CSD015
      *                                                                                       CSD015
     C           *NAMVAR   DEFN           SESDS                           CSE003
     C*
     C** PREPARE COMIT TEXT
     C*
     C                     MOVEL'SE'      MDID
     C                     MOVEL'SE0170'  PGMN
     C                     MOVELWSID      WSIDX
     C                     MOVELUSID      USIDX
     C*
     C***HELP*PROGRAM*PARAMETER****************************************   S01199
     C***********                                                         S01199
     C***********          MOVEL'SE0170'  HBPGM   8        *FOR CALL MHELPS01199
     C                     MOVEL*BLANK    WBLNK   1
     C*
     C** FOR HIGH INTENSITY SCREEN ATTRIBUTE
     C*
     C                     BITOF'01234567'HI      1                    STY
     C                     BITON'267'     HI
     C                     MOVELHI        INF,8
     C                     MOVELHI        INF,9
     C                     MOVELHI        INF,10
     C**********           MOVELHI        INF,11                          186400
     C                     MOVELHI        INF,12
     C                     MOVELHI        INF,13                          S01496
     C                     MOVELHI        INF,14                          084981
     C/COPY WNCPYSRC,SE0170C002
     C*                                                                   S01117
     C***********                                                         S01117
     C***GET*INSTALLATION*CONTROL*DATA*RECORD*1************************   S01117
     C***********                                                         S01117
     C***********          EXSR ZSYSTM                                    S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          MOVE '1'       *INU7                           S01117
     C***********          MOVE '1'       *INU8                           S01117
     C***********          MOVE 'TABLE'   DBFILE           ***************S01117
     C***********          MOVEL'ICDR1'   DBKEY            ** DB ERROR 01 S01117
     C***********          Z-ADD1         DBASE            ***************S01117
     C***********          END                                            S01117
     C***********                                                         S01117
     C****ACCESS*ICD2,*UNLESS*ERROR*ON*PREVIOUS*TABLE******************   S01117
     C***********                                                         S01117
     C************IN99     IFEQ '0'                                       S01117
     C***********          EXSR ZICD2                                     S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          MOVE '1'       *INU7                           S01117
     C***********          MOVE '1'       *INU8                           S01117
     C***********          MOVE 'TABLE'   DBFILE           ***************S01117
     C***********          MOVEL'ICDR2'   DBKEY            ** DB ERROR 02 S01117
     C***********          Z-ADD2         DBASE            ***************S01117
     C***********          END                                            S01117
     C***********          END                                            S01117
     C***********                                                         S01117
     C***********                                                         S01117
     C****ACCESS*ICD*FOR*SE*(TABTB36),*UNLESS*ERROR*ON*PREVIOUS*TABLES**  S01117
     C***********                                                         S01117
     C************IN99     IFEQ '0'                                       S01117
     C***********          EXSR ZICDSE                                    S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          MOVE '1'       *INU7                           S01117
     C***********          MOVE '1'       *INU8                           S01117
     C***********          MOVE 'TABLE'   DBFILE           ***************S01117
     C***********          MOVEL'ICDR '   DBKEY            ** DB ERROR 03 S01117
     C***********          Z-ADD3         DBASE            ***************S01117
     C***********          END                                            S01117
     C***********          END                                            S01117
     C***********                                                         S01117
     C***********                                                         S01117
     C***GET*ICD5                                                         S01117
     C***********                                                         S01117
     C***********          MOVEL'01      'ZTABKY 12                       S01117
     C***********          MOVE '  40'    ZTABKY                          S01117
     C***********ZTABKY    CHAINTABTB40F             99                   S01117
     C***********                                                         S01117
     C****ERROR*IF*NO*RECORD*FOUND*OR*IF*IT*IS*DELETED*****************   S01117
     C***********                                                         S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          MOVE 'TABLE'   DBFILE           ***************S01117
     C***********          MOVEL'TB40 '   DBKEY            ***DB*ERROR 04*E20651
     C***********          Z-ADD4         DBASE            ***************E20651
     C***********          MOVEL'TB40 '   DBKEY      ** DB ERROR 12 E20651S01117
     C***********          Z-ADD12        DBASE      ***************E20651S01117
     C***********          SETON                     U7U8                 S01117
     C***********          ELSE                                           S01117
     C***********RECI      IFNE 'D'                                       S01117
     C***********          MOVE 'TABLE'   DBFILE           ***************S01117
     C***********          MOVEL'TB40 '   DBKEY            ***DB*ERROR*04*E20651
     C***********          Z-ADD4         DBASE            ***************E20651
     C***********          MOVEL'TB40 '   DBKEY      ** DB ERROR 13 E20651S01117
     C***********          Z-ADD13        DBASE      ***************E20651S01117
     C***********          SETON                     U7U8                 S01117
     C***********          END                                            S01117
     C***********          END                                            S01117
     C***********                                                         S01117
     C***********                                                         S01117
     C****ACCESS*TABTB20*FOR*DEFAULT*ACCOUNT************************E14712S01117
     C*****************************************************************   S01117
     C***********                                                         E14712
     C***********1         CHAINTABTB20              99                   E14712
     C************IN99     IFEQ '1'                                       E14712
     C***********RECI      OREQ '*'                                       E14712
     C***********          MOVE '06'      DBASE            ***************E20651
     C***********          MOVEL'TABLE'   DBFILE           ***DB*ERROR*06*E20651
     C***********          MOVE '14'      DBASE      ***************E20651S01117
     C***********          MOVEL'TABLE'   DBFILE     ** DB ERROR 14 E20651S01117
     C***********          MOVE 'TB20'    DBKEY      ***************E20651S01117
     C***********          SETON                     U7U8           E14712S01117
     C***********          END                                      E14712S01117
     C*                                                                   S01117
     C**  In the Dataarea ZMUSER                                          S01117
     C*                                                                   S01117
     C           *NAMVAR   DEFN           ZMUSER                          S01117
     C                     IN   ZMUSER                                    S01117
     C*                                                                   S01117
     C** In the Dataarea RUNDAT                                           S01117
     C*                                                                   S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C                     IN   RUNDT                                     S01117
     C*                                                                   S01117
     C**  Check System Date Format, DDMMYY or MMDDYY.                     S01117
     C*                                                                   S01117
     C           DATF      IFEQ 'M'                                       S01117
     C                     MOVE '1'       *IN98                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**  Set Multibranching Indicator for program                        S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     MOVE '1'       *IN81                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**  Access Bank details                                             S01117
     C*                                                                   S01117
     C                     CALL 'AOBANKR0'                                S01117
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C           SDBANK    PARM SDBANK    DSFDY                           S01117
     C*                                                                   S01117
     C**  Access Midas Module details                                     S01117
     C*                                                                   S01117
     C                     CALL 'AOMMODR0'                                S01117
     C                     PARM '*DBERR ' @RTCD                           S01117
     C                     PARM '*FIRST ' @OPTN                           S01117
     C           SDMMOD    PARM SDMMOD    DSFDY                           S01117
      *                                                                   CAC002
      **  If Analytical Accounting Module is installed, access the PCA    CAC002
      **  ICD Details File.                                               CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE '1'       *IN13                           CAC002
     C                     CALL 'AOPCACR0'                                CAC002
     C                     PARM '*DBERR ' @RTCD                           CAC002
     C                     PARM '*FIRST ' @OPTN                           CAC002
     C           SDPCAC    PARM SDPCAC    DSFDY                           CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   S01117
     C**  Access Securities Trading details                               S01117
     C*                                                                   S01117
     C                     CALL 'AOSTRDR0'                                S01117
     C                     PARM '*DBERR ' @RTCD                           S01117
     C                     PARM '*FIRST ' @OPTN                           S01117
     C           SDSTRD    PARM SDSTRD    DSSDY                           S01117
     C*                                                                   S01117
     C**  Access Trading details                                          S01117
     C*                                                                   S01117
     C                     CALL 'AOTRADR0'                                S01117
     C                     PARM '*DBERR ' @RTCD                           S01117
     C                     PARM '*FIRST ' @OPTN                           S01117
     C           SDTRAD    PARM SDTRAD    DSFDY                           S01117
     C*                                                                   S01117
     C**  Access Retail details                                           S01117
     C*                                                                   S01117
     C           *INU1     IFEQ '1'                                       047225
     C                     CALL 'AORETLR0'                                S01117
     C                     PARM '*DBERR ' @RTCD                           S01117
     C                     PARM '*FIRST ' @OPTN                           S01117
     C           SDRETL    PARM SDRETL    DSFDY                           S01117
     C                     END                                            047225
     C*                                                                   S01117
     C**  Access General Ledger details                                   S01117
     C*                                                                   S01117
     C**********           CALL 'AOGELRR0'                                S01117              CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD                           S01117
     C                     PARM '*FIRST ' @OPTN                           S01117
     C********** SDGELR    PARM SDGELR    DSFDY                           S01117              CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C*                                                                   S01117
     C           BKPRCU    IFEQ 'Y'                                       S01117
     C                     MOVE '1'       *IN82                           S01117
     C           BKPRCA    IFEQ 'Y'                                       S01117
     C                     MOVE '1'       *IN83                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0170CCPG                                           S01408
     C*                                                                   S01408
     C** CHECK IF MODULE PORTFOLIO IS ON OR OFF                           S01486
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C                     MOVE '1'       *IN28                           S01486
     C                     OPEN PMPORTPD                                  S01486
     C                     ELSE                                           S01486
     C                     MOVE '0'       *IN28                           S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C** ACCESS SDPORTPD FOR PORTFOLIO REFERENCE FOR '9997' UNLESS        S01486
     C**  ERROR ON PREVIOUS ACCESS                                        S01486
     C           *IN28     IFEQ '1'                                       S01486
     C           BGPFMG    ANDEQ'Y'                                       CPB001
     C                     CALL 'AOPORTR0'                                S01486
     C                     PARM '*DBERR ' @RTCD   7                       S01486
     C                     PARM '*FIRST ' @OPTN   7                       S01486
     C           SDPORT    PARM SDPORT    DSFDY                           S01486
     C           @RTCD     IFNE *BLANKS                                   S01486
     C                     MOVE '1'       *INU7                           S01486
     C                     MOVE '1'       *INU8                           S01486
     C                     MOVE 'SDPORTPD'DBFILE           ***************S01486
     C                     MOVEL@OPTN     DBKEY            ** DB ERROR 17 S01486
     C                     Z-ADD17        DBASE            ***************S01486
     C                     END                                            S01486
     C                     END                                            S01486
     C*
     C**  PROCEED TO START SCREEN UNLESS DATABASE ERROR
     C*
     C           *INU7     IFNE '1'
     C                     MOVEA'1'       *IN,10
     C                     END
     C*
     C           *LIKE     DEFN SFRNO     XSFRNO
     C************LIKE     DEFN SPSXR     XSPSXR                          E37165
     C           *LIKE     DEFN SPSXR     WXRATP                                              197896
     C           *LIKE     DEFN SPBRX     XSPBRX
     C           *LIKE     DEFN PAGK      PPAGK                           E28805
     C************LIKE     DEFN PNMP      @WPNMP                   051475 082738
     C           *LIKE     DEFN SPSVL     XSPSVL                          S01512
     C           *LIKE     DEFN PDUD      WPDUD                           S01509
     C           *LIKE     DEFN PBCA      WSVBCA                          084981
     C           *LIKE     DEFN PSSH      WSVSSH                          084981
     C           *LIKE     DEFN PCPY      WSVCPY                          084981
     C           *LIKE     DEFN PDUD      WSVDUD                          084981
     C           *LIKE     DEFN PEVT      WSVEVT                          084981
     C           *LIKE     DEFN PTFR      WSVTFR                          084981
     C           *LIKE     DEFN TNLU      WSVTLU                          084981
     C           *LIKE     DEFN PSAT      WSVPSA                          086722
     C           *LIKE     DEFN PSAT      WPSAT                           086722
     C           *LIKE     DEFN TXBS      WSTXBS                          186055
     C           *LIKE     DEFN BNFO      WSBNFO                          186055
     C           *LIKE     DEFN EXCD      WSEXCD                          186055
     C           *LIKE     DEFN A6NQDP    ZNQDP1                          CAC002
     C           *LIKE     DEFN A6NQDP    ZNQDP2                          CAC002
     C*
     C                     MOVE *BLANKS   SFRNO
     C*
     C                     MOVE 'N'       WNATNF  1                       S01496
      *                                                                   S01401
      **  Access SAR details file to see if MT5xx SAR is installed.       S01401
      *                                                                   S01401
     C                     CALL 'AOSARDR0'                                S01401
     C                     PARM '       ' @RTCD                           S01401
     C                     PARM '*VERIFY' @OPTN                           S01401
     C                     PARM 'S01401'  @SARD   6                       S01401
      *                                                                   S01401
     C           @RTCD     IFEQ *BLANK                                    S01401
     C                     MOVE 'Y'       S01401  1                       S01401
     C                     END                                            S01401
      *                                                                   S01447
      **  Access SAR details file to see if S01447 SAR is installed.      S01447
      *                                                                   S01447
     C                     CALL 'AOSARDR0'                                S01447
     C                     PARM *BLANKS   @RTCD                           S01447
     C                     PARM '*VERIFY' @OPTN                           S01447
     C                     PARM 'S01447'  @SARD                           S01447
      *                                                                   S01447
     C           @RTCD     IFEQ *BLANK                                    S01447
     C                     MOVE 'Y'       S01447  1                       S01447
     C                     ELSE                                           S01447
     C                     MOVE 'N'       S01447                          S01447
     C                     END                                            S01447
     C*                                                                   S01496
     C**  Check if Jyske Enhancements feature (S01496) is installed       S01496
     C*                                                                   S01496
     C                     CALL 'AOSARDR0'                                S01496
     C                     PARM *BLANKS   @RTCD                           S01496
     C                     PARM '*VERIFY' @OPTN                           S01496
     C                     PARM 'S01496'  @SARD                           S01496
      *                                                                   S01496
     C           @RTCD     IFEQ *BLANK                                    S01496
     C                     MOVE 'Y'       S01496  1                       S01496
     C***********          MOVE '1'       *IN29                     S01496088976
     C                     MOVE '1'       *IN73                           088976
     C                     ELSE                                           S01496
     C                     MOVE 'N'       S01496                          S01496
     C                     END                                            S01496
      *                                                                   CSE007
      ***   Check if Corporate Action feature (CSE007) is installed       CSE007
      *                                                                   CSE007
     C                     MOVE 'N'       CSE007                          CSE007
     C                     CALL 'AOSARDR0'                                CSE007
     C                     PARM *BLANKS   @RTCD                           CSE007
     C                     PARM '*VERIFY' @OPTN                           CSE007
     C                     PARM 'CSE007'  @SARD                           CSE007
      *                                                                   CSE007
     C           @RTCD     IFEQ *BLANK                                    CSE007
     C                     MOVE 'Y'       CSE007  1                       CSE007
     C                     MOVE '1'       *IN73                           CSE007
     C                     END                                            CSE007
      *                                                                   CEU017
      ***   Check if Securities Redenominations is installed              CEU017
      *                                                                   CEU017
     C                     MOVE 'N'       CEU017                          CEU017
     C                     CALL 'AOSARDR0'                                CEU017
     C                     PARM *BLANKS   @RTCD                           CEU017
     C                     PARM '*VERIFY' @OPTN                           CEU017
     C                     PARM 'CEU017'  @SARD                           CEU017
      *                                                                   CEU017
     C           @RTCD     IFEQ *BLANK                                    CEU017
     C                     MOVE 'Y'       CEU017  1                       CEU017
     C                     MOVE '1'       *IN73                           CEU017
     C                     END                                            CEU017
     C*                                                                   S01509
     C**  Access SAR details file to see if S01509 SAR is installed.      S01509
     C*                                                                   S01509
     C                     CALL 'AOSARDR0'                                S01509
     C                     PARM *BLANKS   @RTCD                           S01509
     C                     PARM '*VERIFY' @OPTN                           S01509
     C                     PARM 'S01509'  @SARD                           S01509
     C*                                                                   S01509
     C           @RTCD     IFEQ *BLANK                                    S01509
     C                     MOVE 'Y'       S01509  1                       S01509
     C                     MOVE '1'       *IN18                           S01509
     C                     ELSE                                           S01509
     C                     MOVE 'N'       S01509                          S01509
     C                     MOVE '0'       *IN18                           S01509
     C                     END                                            S01509
     C*                                                                   S01512
     C**  Access SAR details file to see if S01512 SAR is installed.      S01512
     C*                                                                   S01512
     C                     CALL 'AOSARDR0'                                S01512
     C                     PARM *BLANKS   @RTCD                           S01512
     C                     PARM '*VERIFY' @OPTN                           S01512
     C                     PARM 'S01512'  @SARD                           S01512
     C*                                                                   S01512
     C           @RTCD     IFEQ *BLANK                                    S01512
     C                     MOVE 'Y'       S01512  1                       S01512
     C                     MOVE '1'       *IN19                           S01512
     C                     ELSE                                           S01512
     C                     MOVE 'N'       S01512                          S01512
     C                     MOVE '0'       *IN19                           S01512
     C                     END                                            S01512
      *                                                                   S01447
      **  Access SAR details file to see if ? allowed for security        CSE003
     C                     CALL 'AOSARDR0'                                CSE003
     C                     PARM *BLANKS   @RTCD                           CSE003
     C                     PARM '*VERIFY' @OPTN                           CSE003
     C                     PARM 'CSE003'  @SARD                           CSE003
      *                                                                   CSE003
     C           @RTCD     IFEQ *BLANK                                    CSE003
     C                     MOVE 'Y'       CSE003  1                       CSE003
     C                     ELSE                                           CSE003
     C                     MOVE 'N'       CSE003                          CSE003
     C                     ENDIF                                          CSE003
      *                                                                   CSE003
     C*                                                                   CEU005
     C**  Access SAR details file to see if CEU005 SAR is installed.      CEU005
     C*                                                                   CEU005
     C                     CALL 'AOSARDR0'                                CEU005
     C                     PARM *BLANKS   @RTCD                           CEU005
     C                     PARM '*VERIFY' @OPTN                           CEU005
     C                     PARM 'CEU005'  @SARD                           CEU005
     C*                                                                   CEU005
     C           @RTCD     IFEQ *BLANK                                    CEU005
     C                     MOVE 'Y'       CEU005  1                       CEU005
     C                     ELSE                                           CEU005
     C                     MOVE 'N'       CEU005                          CEU005
     C                     ENDIF                                          CEU005
      *                                                                   CSE023
      ** Initialization process for CSE023 STARTS here.                   CSE023
      **  Access SAR details file to see if CSE023 SAR is installed.      CSE023
      **  US Withholding tax treaty.                                      CSE023
      *                                                                   CSE023
     C                     CALL 'AOSARDR0'                                CSE023
     C                     PARM *BLANKS   @RTCD                           CSE023
     C                     PARM '*VERIFY' @OPTN                           CSE023
     C                     PARM 'CSE023'  @SARD                           CSE023
      *                                                                   CSE023
     C           @RTCD     IFEQ *BLANK                                    CSE023
     C                     MOVE 'Y'       CSE023  1                       CSE023
     C                     ELSE                                           CSE023
     C                     MOVE 'N'       CSE023                          CSE023
     C                     ENDIF                                          CSE023
      *                                                                                       CSW201
      ** Call SWIF2001 to check if CSW201 is switched on                                      CSW201
      *                                                                                       CSW201
     C                     CALL 'SWIF2001'             7474                                   CSW201
     C                     PARM *BLANKS   @RTCD                                               CSW201
      *                                                                                       CSW201
     C           *IN74     IFEQ *ON                                                           CSW201
     C                     Z-ADD30        DBASE                                               CSW201
     C                     MOVEL'SWIF2001'DBFILE                                              CSW201
     C                     MOVEL'*CALL'   DBKEY                                               CSW201
     C                     MOVE *ON       *INU7                                               CSW201
     C                     MOVE *ON       *INU8                                               CSW201
     C                     EXSR *PSSR                                                         CSW201
     C                     ELSE                                                               CSW201
      *                                                                                       CSW201
     C           @RTCD     IFEQ 'CSW2001'                                                     CSW201
     C                     MOVE 'Y'       CSW201  1                                           CSW201
     C                     ELSE                                                               CSW201
     C                     MOVE 'N'       CSW201                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSE028
      ** Check if CSE028 - MT5xx Standing Settlements Instructions is                         CSE028
      **   is switched on.                                                                    CSE028
      *                                                                                       CSE028
     C                     CALL 'AOSARDR0'                                                    CSE028
     C                     PARM *BLANKS   @RTCD                                               CSE028
     C                     PARM '*VERIFY' @OPTN                                               CSE028
     C                     PARM 'CSE028'  @SARD                                               CSE028
      *                                                                                       CSE028
     C           @RTCD     IFEQ *BLANK                                                        CSE028
     C                     MOVE 'Y'       CSE028  1                                           CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE 'N'       CSE028                                              CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CER049
      ** Check if CER049 - Stamp Tax is switch on                                             CER049
      *                                                                                       CER049
     C                     CALL 'AOSARDR0'                                                    CER049
     C                     PARM *BLANKS   @RTCD                                               CER049
     C                     PARM '*VERIFY' @OPTN                                               CER049
     C                     PARM 'CER049'  @SARD                                               CER049
      *                                                                                       CER049
     C           @RTCD     IFEQ *BLANK                                                        CER049
     C                     MOVE 'Y'       CER049  1                                           CER049
     C                     ELSE                                                               CER049
     C                     MOVE 'N'       CER049                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                   CSE023
      ** Key list for withholding tax customer details file.              CSE023
     C           WTAKEY    KLIST                                          CSE023
     C                     KFLD           KYCSNO                          CSE023
     C                     KFLD           KYCRTT                          CSE023
      *                                                                   CSE023
      ** Key list for tax basket details file.                            CSE023
     C           WTBKEY    KLIST                                          CSE023
     C                     KFLD           KYCRTT                          CSE023
     C                     KFLD           STXBS                           CSE023
      *                                                                   CSE023
      ** Key list for beneficial owners file.                             CSE023
     C           WBOKEY    KLIST                                          CSE023
     C                     KFLD           KYCSNO                          CSE023
     C                     KFLD           KYCRTT                          CSE023
     C                     KFLD           KYBNFO                          CSE023
      *                                                                   CSE023
      ** Key list for withholding tax treaty details file - Full          CSE023
     C           WTFKEY    KLIST                                          CSE023
     C                     KFLD           KYCRTT                          CSE023
     C                     KFLD           @SITP   3                       CSE023
     C                     KFLD           @BCOLC  2                       CSE023
      *                                                                   CSE023
      ** Key list for withholding tax treaty details file - Partial       CSE023
     C           WTPKEY    KLIST                                          CSE023
     C                     KFLD           KYCRTT                          CSE023
     C                     KFLD           @SITP                           CSE023
      *                                                                   CSE023
      ** Key list for Customer Depot - CDEPS                              CSE023
     C           CDPKEY    KLIST                                          CSE023
     C                     KFLD           @PSSH  10                       CSE023
     C**********           KFLD           @ZCUST  60                                   CSE023 CSD027
     C                     KFLD           @ZCUST  6                                           CSD027
      *                                                                   CSE023
      ** Key list for exemption codes file.                               CSE023
     C           WTEKEY    KLIST                                          CSE023
     C                     KFLD           KYCRTT                          CSE023
     C                     KFLD           SEXCD                           CSE023
      *                                                                   CSE023
      ** Key list for customer positions file.                            CSE023
     C           WCPKEY    KLIST                                          CSE023
     C                     KFLD           KYPBCA                          CSE023
     C                     KFLD           SPSSH                           CSE023
     C                     KFLD           KYCSCN                          CSE023
     C                     KFLD           BJRDNB                          CSE023
      *                                                                   CSE023
      ** Initialization process for CSE023 ENDS here.                     CSE023
      *                                                                   CGL007
     C           @NOPMS    IFNE 0                                         CGL007
      *                                                                   CGL007
      ** If the number of parameters passed to the program is not equal   CGL007
      ** 0,the program has been called from Posting enquiry GL0090        CGL007
      *                                                                   CGL007
     C           *ENTRY    PLIST                                          CGL007
     C                     PARM           ZBCA    3                       CGL007
     C                     PARM           ZSSH   10                       CGL007
     C**********           PARM           ZCPY    60                                   CGL007 CSD027
     C                     PARM           ZCPY    6                                           CSD027
     C                     PARM           ZDUD    50                      CGL007
     C                     PARM           ZEVT    2                       CGL007
     C                     PARM           ZPTFR   4                       CGL007
     C                     PARM           ZPSTA  130                      CGL007
     C                     PARM           ZRETN   1                       CGL007
      *                                                                   CGL007
      ** filled Screen's fields                                           CGL007
      *                                                                   CGL007
     C                     MOVE ZBCA      SPBCA                           CGL007
     C                     MOVE ZSSH      SPSSH                           CGL007
     C                     MOVELZCPY      SPCPY                           CGL007
     C                     Z-ADDZDUD      ZDAYNO                          CGL007
     C                     EXSR ZDATE2                                    CGL007
     C                     MOVELZDATE     SPDUD                           CGL007
     C                     MOVE ZEVT      SPEVT                           CGL007
     C                     MOVE ZPTFR     SPPTFR                          CGL007
     C                     MOVE 'E'       ACTN                            CGL007
     C                     MOVE 'Y'       REVW                            CGL007
      *                                                                   CGL007
      ** filled key's fields                                              CGL007
      *                                                                   CGL007
     C           KEY16     KLIST                                          CGL007
     C                     KFLD           PBCA                            CGL007
     C                     KFLD           PSSH                            CGL007
     C                     KFLD           PCPY                            CGL007
     C                     KFLD           PDUD                            CGL007
     C                     KFLD           PEVT                            CGL007
      *                                                                   CGL007
     C                     MOVELZBCA      PBCA                            CGL007
     C                     MOVELZSSH      PSSH                            CGL007
     C                     MOVELZCPY      PCPY                            CGL007
     C                     MOVE ZDUD      PDUD                            CGL007
     C                     MOVELZEVT      PEVT                            CGL007
     C                     MOVELZPTFR     PTFR                            CGL007
      *                                                                   CGL007
     C                     MOVE *ON       *IN04                           CGL007
     C                     EXSR UPDATE                                    CGL007
     C                     MOVE AID       ZRETN                           CGL007
     C                     MOVE *ON       *INLR                           CGL007
     C                     RETRN                                          CGL007
     C                     ENDIF                                          CGL007
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0170CCP5                                           S01408
      *                                                                   CSE010
      ** Check if CSE010 (Transaction Enhancements) is active             CSE010
      *                                                                   CSE010
     C                     CALL 'AOSARDR0'                                CSE010
     C                     PARM '       ' @RTCD                           CSE010
     C                     PARM '*VERIFY' @OPTN                           CSE010
     C                     PARM 'CSE010'  @SARD   6                       CSE010
      *                                                                   CSE010
     C           @RTCD     IFEQ *BLANK                                    CSE010
     C                     MOVE 'Y'       CSE010  1                       CSE010
     C                     ELSE                                           CSE010
     C                     MOVE 'N'       CSE010                          CSE010
      *                                                                   CSE010
      ** Database Error (return code other than *NRF)                     CSE010
      *                                                                   CSE010
     C           @RTCD     IFNE '*NRF   '                                 CSE010
     C           *LOCK     IN   LDA                                       CSE010
     C                     MOVEL'SCSARDPD'DBFILE           ***************CSE010
     C                     MOVEL'CSE010'  DBKEY            * DB ERROR 24 *CSE010
     C                     Z-ADD24        DBASE            ***************CSE010
     C                     OUT  LDA                                       CSE010
     C                     MOVE *ON       *INU7                           CSE010
     C                     MOVE *ON       *INU8                           CSE010
     C                     MOVE *ON       *INLR                           CSE010
     C                     EXSR *PSSR                                     CSE010
     C                     ENDIF                                          CSE010
     C                     ENDIF                                          CSE010
      *                                                                                       CSD015
      ** Check 24 x 7 enhancement is installed.                                               CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM '       ' @RTCD                                               CSD015
     C                     PARM '*VERIFY' @OPTN                                               CSD015
     C                     PARM 'CSC011'  @SARD   6                                           CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C                     MOVEL'N'       CSC011  1                                           CSD015
     C           @RTCD     IFEQ *BLANKS                                                       CSD015
     C           *NAMVAR   DEFN           SC24X7                                              CSD015
     C                     IN   SC24X7                                                        CSD015
     C                     MOVEL'Y'       CSC011                                              CSD015
     C                     ELSE                                                               CSD015
     C           @RTCD     IFNE '*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'CSC011'  DBKEY                                               CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     Z-ADD41        DBASE                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Check if compliance watch enhancement is switched on.                                CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM '       ' @RTCD                                               CSD015
     C                     PARM '*VERIFY' @OPTN                                               CSD015
     C                     PARM 'CSD015'  @SARD   6                                           CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C                     MOVEL'N'       CSD015  1                                           CSD015
     C           @RTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVEL'Y'       CSD015  1                                           CSD015
     C                     ELSE                                                               CSD015
     C           @RTCD     IFNE '*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'CSD015'  DBKEY                                               CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     Z-ADD42        DBASE                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Check if function code is being monitored by compliance watch.                       CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
     C                     CALL 'AOWLCCR0'                                                    CSD015
     C                     PARM *BLANKS   @RTCD                                               CSD015
     C                     PARM '*KEY   ' @OPTN                                               CSD015
     C                     PARM 'SECTTRAD'PFUNC   8                                           CSD015
     C           SDWLCC    PARM SDWLCC    DSFDY                                               CSD015
      *                                                                                       CSD015
      ** If return code not blank, then issue database error.                                 CSD015
      *                                                                                       CSD015
     C           @RTCD     IFNE *BLANKS                                                       CSD015
     C           @RTCD     ANDNE'*NRF   '                                                     CSD015
     C                     MOVE 'SECTTRAD'DBKEY                                               CSD015
     C                     MOVE 'SDWLCCPD'DBFILE                                ************  CSD015
     C                     MOVE 29        DBASE                                 *DBERR 29  *  CSD015
     C                     EXSR *PSSR                                           ************  CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Call access program AOCWCDR0 for Private Customer                                    CSD015
      ** Industry Code                                                                        CSD015
      *                                                                                       CSD015
     C                     CALL 'AOCWCDR0'                                                    CSD015
     C                     PARM *BLANKS   @RTCD                                               CSD015
     C                     PARM '*FIRST ' @OPTN                                               CSD015
     C           SDCWCD    PARM SDCWCD    DSSDY                                               CSD015
      *                                                                                       CSD015
      ** If no record is found on SDCWCDPD                                                    CSD015
      *                                                                                       CSD015
     C           @RTCD     IFNE *BLANKS                                                       CSD015
     C           @RTCD     ANDNE'*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'*FIRST'  DBKEY                                               CSD015
     C                     MOVEL'SDCWCDPD'DBFILE                                              CSD015
     C                     Z-ADD45        DBASE                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Check Concord Interface Development is installed.                                    CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM '       ' @RTCD                                               CSD015
     C                     PARM '*VERIFY' @OPTN                                               CSD015
     C                     PARM 'CCF001'  @SARD   6                                           CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C                     MOVEL'N'       CCF001  1                                           CSD015
     C           @RTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVEL'Y'       CCF001                                              CSD015
     C                     ELSE                                                               CSD015
     C           @RTCD     IFNE '*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'CCF001'  DBKEY                                               CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     Z-ADD44        DBASE                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C*                                                                   S01408
      ** Check if CRE020 is enabled.                                                          CRE020
      *                                                                                       CRE020
     C                     CALL 'AOSARDR0'                                                    CRE020
     C                     PARM *BLANKS   PRTCD                                               CRE020
     C                     PARM '*VERIFY' POPTN                                               CRE020
     C                     PARM 'CRE020'  PSARD   6                                           CRE020
     C           SCSARD    PARM SCSARD    DSFDY                                               CRE020
      *                                                                                       CRE020
     C                     MOVE 'N'       CRE020  1                                           CRE020
     C           PRTCD     IFEQ *BLANKS                                                       CRE020
     C                     MOVE 'Y'       CRE020                                              CRE020
     C                     MOVEL'SE0170'  KPRGMN                                              CRE020
     C                     ELSE                                                               CRE020
     C           PRTCD     IFNE '*NRF   '                                                     CRE020
     C           *LOCK     IN   LDA                                                           CRE020
     C                     MOVEL'SCSARDPD'DBFILE                                              CRE020
     C                     MOVEL'CRE020'  DBKEY                                               CRE020
     C                     Z-ADD46        DBASE                                               CRE020
     C                     OUT  LDA                                                           CRE020
     C                     EXSR *PSSR                                                         CRE020
     C                     ENDIF                                                              CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
      ** Check if a System Value exists for this maintenance.                                 CRE020
      *                                                                                       CRE020
     C           CRE020    IFEQ 'Y'                                                           CRE020
      *                                                                                       CRE020
     C                     CALL 'AOSVALR0'                                                    CRE020
     C                     PARM *BLANKS   PRTCD                                               CRE020
     C                     PARM WPSET     PSV01  20                                           CRE020
     C                     PARM           PCS01 200                                           CRE020
     C                     PARM           PSV02  20                                           CRE020
     C                     PARM           PCS02 200                                           CRE020
     C                     PARM           PSV03  20                                           CRE020
     C                     PARM           PCS03 200                                           CRE020
     C                     PARM           PSV04  20                                           CRE020
     C                     PARM           PCS04 200                                           CRE020
     C                     PARM           PSV05  20                                           CRE020
     C                     PARM           PCS05 200                                           CRE020
     C                     PARM           PSV06  20                                           CRE020
     C                     PARM           PCS06 200                                           CRE020
     C                     PARM           PSV07  20                                           CRE020
     C                     PARM           PCS07 200                                           CRE020
     C                     PARM           PSV08  20                                           CRE020
     C                     PARM           PCS08 200                                           CRE020
     C                     PARM           PSV09  20                                           CRE020
     C                     PARM           PCS09 200                                           CRE020
     C                     PARM           PSV10  20                                           CRE020
     C                     PARM           PCS10 200                                           CRE020
      *                                                                                       CRE020
     C                     MOVE 'N'       WSV01   1                                           CRE020
      *                                                                                       CRE020
     C           PRTCD     IFEQ *BLANKS                                                       CRE020
     C                     MOVELPCS01     WSV01                                               CRE020
     C                     ELSE                                                               CRE020
      *                                                                                       CRE020
     C           PRTCD     IFNE '*NRF'                                                        CRE020
     C           *LOCK     IN   LDA                                                           CRE020
     C                     MOVEL'SDSVALPD'DBFILE                                              CRE020
     C                     MOVELPSV01     DBKEY                                               CRE020
     C                     Z-ADD102       DBASE                                               CRE020
     C                     OUT  LDA                                                           CRE020
     C                     EXSR *PSSR                                                         CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
      ** Check if CGL031 (Taxation of Savings Income) is enabled.                             233711
      *                                                                                       233711
     C                     CALL 'AOSARDR0'                                                    233711
     C                     PARM *BLANKS   PRTCD                                               233711
     C                     PARM '*VERIFY' POPTN                                               233711
     C                     PARM 'CGL031'  PSARD   6                                           233711
     C           SCSARD    PARM SCSARD    DSFDY                                               233711
      *                                                                                       233711
     C                     MOVE 'N'       CGL031  1                                           233711
     C           PRTCD     IFEQ *BLANKS                                                       233711
     C                     MOVE 'Y'       CGL031                                              233711
     C                     ELSE                                                               233711
      *                                                                                       233711
     C           PRTCD     IFNE '*NRF   '                                                     233711
     C           *LOCK     IN   LDA                                                           233711
     C                     MOVEL'SCSARDPD'DBFILE                                              233711
     C                     MOVEL'CGL031'  DBKEY                                               233711
     C                     Z-ADD101       DBASE                                               233711
     C                     OUT  LDA                                                           233711
     C                     MOVE *ON       *INU7                                               233711
     C                     MOVE *ON       *INU8                                               233711
     C                     MOVE *ON       *INLR                                               233711
     C                     EXSR *PSSR                                                         233711
     C                     ENDIF                                                              233711
      *                                                                                       233711
     C                     ENDIF                                                              233711
      *                                                                                       233711
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  START  - S/R TO OUTPUT AND PROCESS KEY FIELDS SCREEN         *
     C*  CALLED FROM: MAIN PROCESSING                                 *
     C*  CALLS: VALIDK TO VALIDATE KEY FIELDS IF ENTERED              *
     C*                                                               *
     C*****************************************************************
     C*
     C           START     BEGSR                           ** START BSR **
     C*
     C**  INITIALISE SCREEN DATA
     C*
     C                     MOVEA'0'       *IN,10
     C                     MOVEA'000000'  *IN,21
     C                     MOVE '0'       *IN89
     C                     MOVEL*BLANK    SCRCTL
     C**********           MOVELINF,1     INFMSG                                            AR324886
     C                     MOVELINF,16    INFMSG                                            AR324886
     C                     MOVE *BLANKS   XSFRNO
     C                     MOVE 'Y'       @DPTXB                          185811
     C                     MOVE 'N'       W1STPS  1                                         AR851784
      *                                                                   CSE023
      ** Reset processing for CSE023 STARTS here.                         CSE023
      **  Initialize CSE023 error indicators, screen fields and work      CSE023
      **  variables appropriately.                                        CSE023
      *                                                                   CSE023
     C           CSE023    IFEQ 'Y'                                       CSE023
     C                     MOVE '1'       *IN20                           CSE023
     C**********           Z-ADD0         KYCSCN  60                                   CSE023 CSD027
     C                     MOVE *BLANKS   KYCSCN  6                                           CSD027
     C                     MOVEL*BLANKS   KYCSNO  6                       CSE023
     C                     MOVEL*BLANKS   KYCRTT  2                       CSE023
     C                     MOVEL*BLANKS   KYBNFO 26                       CSE023
     C                     MOVEL*BLANKS   KYBNFN 26                       CSE023
     C                     MOVEL*BLANKS   KYPBCA  3                       CSE023
     C                     MOVEL*BLANKS   WITTAX  6                       CSE023
     C                     MOVEL*BLANKS   WFREEM  1                       CSE023
     C                     MOVEL*BLANKS   WTBNAR 15                       CSE023
     C                     MOVEL*BLANKS   WTEMP1  5                       CSE023
     C                     MOVEL*BLANKS   WTEMP2  7                       CSE023
     C                     MOVEL*BLANKS   WTEMP3 13                       CSE023
     C                     MOVEL*BLANKS   WTEMP4 19                       CSE023
     C                     MOVEL*BLANKS   STXBS                           CSE023
     C                     MOVEL*BLANKS   SBNFO                           CSE023
     C                     MOVEL*BLANKS   SEXCD                           CSE023
     C                     MOVEL*BLANKS   RPCD                            CSE023
     C                     MOVE *BLANKS   DEPT                            CSE023
     C                     MOVEA'000'     *IN,57                          CSE023
     C                     ELSE                                           CSE023
     C                     MOVE '0'       *IN20                           CSE023
     C                     MOVEL*BLANKS   TXBS                            CSE023
     C                     MOVEL*BLANKS   TXBN                            CSE023
     C                     MOVEL*BLANKS   EXCD                            CSE023
     C                     MOVEL*BLANKS   CRTX                            CSE023
     C                     MOVEL*BLANKS   RPCD                            CSE023
     C                     MOVEL*BLANKS   ICTP                            CSE023
     C                     MOVEL*BLANKS   BNFO                            CSE023
     C                     MOVE 'N'       MT5R                            CSE023
     C                     MOVE 'N'       MT5G                            CSE023
     C                     MOVEL*BLANKS   CTYP                            CSE023
     C                     MOVEL*BLANKS   PREF                            CSE023
     C                     MOVEL*BLANKS   CTIN                            CSE023
     C                     Z-ADD0         PSEQ                            CSE023
     C                     Z-ADD0         DAMT                            CSE023
     C                     MOVE *BLANKS   DEPT                            CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
      ** Reset processing for CSE023 ENDS here.                           CSE023
      *                                                                                       233711
     C           CGL031    IFEQ 'Y'                                                           233711
     C                     MOVE *BLANKS   STXNM                                               233711
     C                     ENDIF                                                              233711
     C*
     C**  CLEAR WHOLE SCREEN
     C*
     C/COPY WNCPYSRC,SE0170C098
     C                     WRITECLSCREEN
     C/COPY WNCPYSRC,SE0170C099
     C                     MOVE 'L'       PPALL                           S01496
     C*
     C** D O   U N T I L   C H A N G E  O F  S C R E E N  -  S T A R T
     C*
     C           *IN10     DOUEQ'1'
     C           *IN11     OREQ '1'
     C           *IN12     OREQ '1'
      *
      ***  Start Screen Output
      *
     C/COPY WNCPYSRC,SE0170C100
     C                     MOVE *OFF      *IN11                           186400
     C**********           WRITEKEYINPUT                                                     BUG1992
     C           INFMSG    IFEQ *BLANKS                                   084981
     C**********           MOVELINF,1     INFMSG                                     S01117 AR324886
     C                     MOVELINF,16    INFMSG                                            AR324886
     C                     ENDIF                                          084981
     C                     WRITEMESSAGES
     C                     WRITEKEYINPUT                                                     BUG1992
     C                     READ KEYINPUT                 99
     C/COPY WNCPYSRC,SE0170C101
     C                     MOVELERRMSG    HERCD 160
     C                     MOVELWBLNK     HERCD
     C                     MOVEL*BLANK    SCRMSG
     C*
     C***C*K*3*,*H*E*L*P*,*O*R**E*N*T*E*R***P*R*E*S*S*E*D**-**S*T*A*R*T
     C** C K 3 , O R  E N T E R   P R E S S E D  -  S T A R T
     C*
     C** Call S/R to move values into AID                                 S01179
     C*                                                                   S01179
     C                     EXSR ASCHGS                                    S01179
     C*
     C** CK3 - TERMINATE
     C*
     C           AID       IFEQ '01'
     C                     MOVEA'1'       *IN,10
     C*
     C***HELP***CALL*HELP*PROGRAM**************************************   S01199
     C***********                                                         S01199
     C***********          ELSE                                           S01199
     C***********AID       IFEQ 'HP'                                      S01199
     C***********          MOVELHERCD     ERRMSG                          S01199
     C***********ERR,1     IFNE *BLANK                                    S01199
     C***********          MOVELHI        ERRMSG                          S01199
     C***********          END                             *ERR,1         S01199
     C***********          CALL 'MHELP'                                   S01199
     C***********          PARM           HBPGM                           S01199
     C***********          PARM           HERCD                           S01199
     C*
     C***ENTER*TAKEN*VALIDATE*KEY*INPUT*********                          S01117
     C*
     C                     ELSE
     C*                                                                   084981
     C** If F12 is taken, display error message                           084981
     C*                                                                   084981
     C           AID       IFEQ '05'                                      084981
     C                     MOVELINF,14    INFMSG                          084981
     C                     ELSE                                           084981
     C*                                                                   S01117
     C**  Enter taken, check for query selection                          S01117
     C*                                                                   S01117
     C                     MOVE '0'       *IN22                           S01117
     C                     MOVE '0'       *IN24                           S01117
     C                     EXSR D1QRY                                     S01117
     C           RDSPLY    IFEQ 'N'                                       S01117
     C*                                                                   S01117
     C**  Validate key input                                              S01117
     C*                                                                   S01117
     C                     Z-ADD0         EC                              084981
     C                     Z-ADD0         WEC                                                 222756
     C                     EXSR VALIDK
     C           EC        IFNE *ZERO                                     084981
     C                     MOVELHI        ERRMSG                          084981
     C                     MOVEL*BLANK    AID                             084981
     C                     END                                            084981
      *
     C** IF NO ERRORS, DETERMINE NEXT SCREEN
      ** or if only warning messages are shown, proceed to the next                           222756
      ** screen.                                                                              222756
     C*
     C           SCRMSG    IFEQ *BLANK
     C           EC        OREQ WEC                                                           222756
      *                                                                   185811
      ** Continue normial processing if CSE023 is OFF                     185811
      ** If CSE023 is ON, after tax basket default is displayed on        185811
      ** screen.                                                          185811
      *                                                                   185811
     C           CSE023    IFEQ 'N'                                       185811
     C           CSE023    OREQ 'Y'                                       185811
     C           @DPTXB    ANDEQ'Y'                                       185811
     C*
     C**  - IF KEY FIELD IS BLANK, NEXT SCREEN IS REVIEW SCREEN
     C*
     C           INPK      IFEQ *BLANK
     C                     MOVEA'1'       *IN,11
     C*
     C**  - OTHERWISE, DISPLAY REQUESTED DETAIL SCREEN AS PER KEY INPUT
     C*
     C                     ELSE
     C                     MOVEA'1'       *IN,12
     C                     END
     C*                                                                   185811
     C                     END                                            185811
     C*
     C                     END
     C                     END                                            S01117
     C*
     C***C*K*3*,*H*E*L*P*,*O*R**E*N*T*E*R***P*R*E*S*S*E*D**-**E*N*D       S01199
     C** C K 3 , O R  E N T E R   P R E S S E D  -  E N D                 S01199
     C*
     C***********          END                             *AID=HP        S01199
     C                     END                                            084981
     C                     END
     C*
     C** D O    U N T I L   C H A N G E  O F  S C R E E N  -  E N D
     C                     END
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  REVIEW  - S/R TO PROCESS SUBFILE SELECTION SCREEN            *
     C*  CALLED FROM: MAIN PROCESSING                                 *
     C*  CALLS: VALIDK TO VALIDATE KEY FIELDS IF SUBFILE RECORD       *
     C*         SELECTED ZDATE2                                       *
     C*****************************************************************
     C*
     C           REVIEW    BEGSR                           ** REVIEW BSR**
     C*
     C                     MOVEA'0'       *IN,11
     C*
     C**  SET PROCESSING FLAG TO FORCE SUBFILE REBUILD
     C*
     C                     MOVEL'RA'      AID
     C*                                                                   S01496
     C***FOR*LIVE/ALL*FIELD*SET*TO*'L'*OVERRIDE*POSETX*TO*POSET****S01496 084981
     C***FOR*LIVE/ALL*FIELD*SET*TO*'L'*OVERRIDE*POSETX*TO*POSET2   084981 186055
     C** FOR LIVE/ALL FIELD SET TO 'L' OVERRIDE POSETX TO POSET8          186055
     C*                                                                   S01496
     C           S01496    IFEQ 'Y'                                       S01496
     C           CSE007    OREQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0170CCP8                                           S01408
     C*                                                                   S01408
     C           PPALL     IFEQ 'L'                                       S01496
     C                     CLOSEPOSETX                                    S01496
     C                     CALL 'QCMDEXC'                                 S01496
     C                     PARM           CCOVRL                          S01496
     C***********          PARM 32        WWOVL  155               S01496 084981
     C                     PARM 33        WWOVL  155                      084981
     C                     OPEN POSETX                                    S01496
     C                     ENDIF                                          S01496
     C                     ENDIF                                          S01496
     C***********                                                         084981
     C***D*O****U*N*T*I*L***C*H*A*N*G*E**O*F**S*C*R*E*E*N**-**S*T*A*R*T*  084981
     C***********                                                         084981
     C************IN10     DOUEQ'1'                                       084981
     C************IN11     OREQ '1'                                       084981
     C************IN12     OREQ '1'                                       084981
     C***********                                                         084981
     C***I*F**R*O*L*L***U*P*/*D*O*W*N***O*R***E*N*T*E*R***P*R*E*S*S*E*D** 084981
     C***********                                                         084981
     C***R*E*B*U*I*L*D***S*U*B*F*I*L*E*********************-**S*T*A*R*T** 084981
     C***********                                                         084981
     C***-*not*if*error*found******************************************** 084981
     C***********                                                         084981
     C***********SCRMSG    IFEQ *BLANKS                                   084981
     C***********          MOVE *BLANKS   XSFRNO                          084981
     C***********                                                         084981
     C***********AID       IFEQ 'DN'                                      084981
     C***********AID       OREQ 'UP'                                      084981
     C***********AID       OREQ 'RA'                                      084981
     C***********          MOVE AID       SAVAID  2                E28805 084981
     C***********                                                         084981
     C***WRITE*CONTROL*RECORD*********************************************084981
     C***********                                                         084981
     C***********          MOVEA'000'     *IN,1                           084981
     C***********          Z-ADD*ZERO     RRN                             084981
     C***********          WRITESUBFLCTL                                  084981
     C***********          MOVEA'1'       *IN,4                           084981
     C***********                                                         E28805
     C***SET*FILE POINTER - PAGE BACK                                     E28805
     C***********                                                         E28805
     C****If*rolldown                                                     E28805
     C***********                                                         E28805
     C***********AID       IFEQ 'DN'                                      E28805
     C***********          Z-ADD0         PBCH                     S01117 E28805
     C***********          MOVEL*BLANK    PBCA                     S01117 E28805
     C***********          MOVEL*BLANK    PSSH                            E28805
     C***********          Z-ADD0         PCPY                            E28805
     C***********          Z-ADD0         PDUD                            E28805
     C***********          MOVEL*BLANK    PEVT                            E28805
     C***********          MOVEL*BLANK    PPAGK 031        *SAVE          E28805
     C***********POSETK    SETLLPOSETX                                    E28805
     C***********                                                  E28805 084981
     C***Set*file*pointer*and*read*previous*two*pages*worth********E28805 084981
     C***ignoring*matured*records*as*these*are*not*displayed.******E28805 084981
     C***If*begining*of*file*reached*set*file*pointer*to*top.******E28805 084981
     C***********                                                  E28805 084981
     C***Rolldown**************************************************E28805 084981
     C***********                                                  E28805 084981
     C***********SAVAID    IFEQ 'DN'                               E28805 084981
     C***********          MOVEL*BLANK    PTFR                     S01486 084981
     C***********BGPFMG    IFEQ 'Y'                                S01486 084981
     C***********PTFRK     SETLLPOSETX                             S01486 084981
     C***********          ELSE                                    S01486 084981
     C***********POSETK    SETLLPOSETX                             E28805 084981
     C***********          END                                     S01486 084981
     C***********          Z-ADD0         X       20               E28805 084981
     C***********                                                  E28805 084981
     C***********X         DOUEQ28                                 E28805 084981
     C************IN03     OREQ '1'                                E28805 084981
     C***********          READPPOSETX                   03        E28805 084981
     C***********                                                  E28805 084981
     C***Ignore*matured*records************************************E28805 084981
     C***********                                                  E28805 084981
     C***********RECI      IFNE 'M'                                E28805 084981
     C***********          ADD  1         X                        E28805 084981
     C***********          END                                     E28805 084981
     C************IN03     IFEQ '1'                                E28805 084981
     C************LOVAL    SETLLPOSETX                             E28805 084981
     C***********          END                                     E28805 084981
     C***********          END                                     E28805 084981
     C***********                                                         084981
     C****OTHERWISE*-*PAGE*FORWARD*************************************   084981
     C***********                                                         084981
     C***********          ELSE                                           084981
     C***********          MOVELPPBCH     PBCH                            S01117
     C***********          MOVELPPBCA     PBCA                            S01117
     C***********          MOVELPPSSH     PSSH                            084981
     C***********          MOVELPPCPY     PCPY                            084981
     C***********BGPFMG    IFEQ 'Y'                                S01486 084981
     C***********PPTFR     IFEQ FCR997                             S01486 084981
     C***********          MOVE FCR997    PTFR                     S01486 084981
     C***********          ELSE                                    S01486 084981
     C***********          MOVELPPTFR     PTFR                     S01486 084981
     C***********          END                                     S01486 084981
     C***********          ELSE                                           S01486
     C***********          MOVELPPTFR     PTFR                            S01486
     C***********          END                                     S01486 084981
     C***********                                                         084981
     C****Convert*due*date*to*stored*format****************************   084981
     C***********                                                         084981
     C***********PPDUD     IFEQ *BLANKS                                   084981
     C***********          Z-ADD0         PDUD                            084981
     C***********          ELSE                                           084981
     C***********                                                         084981
     C****Translate*and*convert*date***********************************   084981
     C***********                                                         084981
     C***********          MOVE PPDUD     PPDUDN  60                      084981
     C***********          MOVE PPDUDN    PPDUDA  6                       084981
     C***********PPDUD     COMP PPDUDA               9999                 084981
     C************IN99     IFNE '1'                                       084981
     C***********          Z-ADDPPDUDN    ZDATE                           084981
     C***********          EXSR ZDATE1                                    084981
     C***********          END                                            084981
     C************IN99     IFEQ '1'                                       084981
     C***********                                                         084981
     C****Date*in*error************************************************   084981
     C***********                                                         084981
     C***********          Z-ADD0         PDUD                            084981
     C***********          ELSE                                           084981
     C***********          Z-ADDZDAYNO    PDUD                            084981
     C***********          END                                            084981
     C***********          END                                            084981
     C***********          MOVELPPEVT     PEVT                            084981
     C** FOLLOWING LINES REMOVED BY REVIEWER                              S01486
     C** NO NEED TO DO PROCESSING TWICE                                   S01486
     C************                                                        S01486
     C***PORTFOLIO REFERENCE                                              S01486
     C************                                                        S01486
     C*******IF*PORTFOLIO MANAGEMENT INSTALLED                            S01486
     C************                                                        S01486
     C***********BGPFMG    IFEQ 'Y'                                       S01486
     C************                                                        S01486
     C***...*If*portfolio reference on record = '9997' then output 'C'    S01486
     C*******Else*output the portfolio reference from file                S01486
     C************                                                        S01486
     C***********PPTFR     IFEQ FCR997                                    S01486
     C************         MOVE '9997'    PTFR                            S01486
     C************                                                        S01486
     C*******Else*output the portfolio reference from file                S01486
     C************                                                        S01486
     C************         ELSE                                           S01486
     C************         MOVE PPTFR     PTFR                            S01486
     C************         END                                            S01486
     C************         END                                            S01486
     C***********                                                  S01486 084981
     C***********                                                  S01486 084981
     C*******Also*different*key*depending*on*whether*PM*installed**S01486 084981
     C***********                                                  S01486 084981
     C***********BGPFMG    IFEQ 'Y'                                S01486 084981
     C***********PTFRK     SETGTPOSETX                     *ROLLUP S01486 084981
     C***********          ELSE                                    S01486 084981
     C***********POSETK    SETLLPOSETX                     *ROLLUP        084981
     C***********          END                                            084981
     C***********          END                                     S01486 084981
     C***********                                                         084981
     C***READ*IN*DETAILS*-*FILL*UP*SUBFILE*****************************   084981
     C***********                                                         084981
     C***********          MOVEL*BLANKS   SAVBA                    S01117 084981
     C***********RRN       DOUEQ14                                        084981
     C************IN,03    OREQ '1'                                       084981
     C***********                                                         084981
     C***READ*DETAILS*UNTIL*SUBFILE*PAGE*IS*FULL***********************   084981
     C***********                                                         084981
     C***********          READ POSETX                   03*              084981
     C***********                                                         084981
     C****Check*user*is*authorised*to*branch*on*position*record****S01117 084981
     C****before*building*subfile**********************************S01117 084981
     C***********                                                  S01117 084981
     C***********PBCA      IFNE SAVBA                              S01117 084981
     C***********          Z-ADD0         @ERR                     S01117 084981
     C************IN81     IFEQ 'Y'                                S01117 084981
     C***********          CALL 'ZVBBU'                            S01117 084981
     C***********          PARM PBCA      @ZBRCD  3                S01117 084981
     C***********          PARM           @ERR    10               S01117 084981
     C***********          END                                     S01117 084981
     C***********          END                                     S01117 084981
     C***********                                                  S01117 084981
     C***********@ERR      IFEQ 0                                  S01117 084981
     C***********                                                  E14884 084981
     C****IGNORE*RECORDS*WITH*RECORD*ID*OF*'M'*********************E14884 084981
     C***********                                                  E14884 084981
     C***********RECI      IFNE 'M'                                E14884 084981
     C***********S01496    ANDNE'Y'                                S01496 084981
     C***********                                                  S01496 084981
     C***********S01496    OREQ 'Y'                                S01496 084981
     C***********                                                  E14884 084981
     C************IN,03    IFEQ '0'                                       084981
     C***********                                                  S01496 084981
     C****If*Jyske*Enhancements*feature*is*not*installed***********S01496 084981
     C***********                                                  S01496 084981
     C***********S01496    IFNE 'Y'                                S01496 084981
     C***********                                                         084981
     C***IF*RECORD*IS*DELETED,*FLAG*IT*AS*SO*ON*SCREEN*****************   084981
     C***********                                                         084981
     C***********RECI      IFEQ '*'                                       084981
     C***********          MOVEL'D'       STAT    1                       084981
     C***********          ELSE                                           084981
     C***********          MOVEL*BLANK    STAT                            084981
     C***********          END                                            084981
     C***********                                                  S01496 084981
     C***********          ELSE                                    S01496 084981
     C***********                                                  S01496 084981
     C***IF*RECORD*IS*MATURED/REVERSED,*FLAG*IT*AS*SO*ON*SCREEN****S01496 084981
     C***********RECI      IFNE 'D'                                S01496 084981
     C***********RECI      IFEQ '*'                                S01496 084981
     C***********          MOVEL'D'       STAT    1        *STATUS=S01496 084981
     C***********          ELSE                                    S01496 084981
     C***********          MOVE RECI      STAT                     S01496 084981
     C***********          END                                     S01496 084981
     C***********          ELSE                                    S01496 084981
     C***********          MOVEL*BLANK    STAT             *OR LIVES01496 084981
     C***********          END                             *RECI=* S01496 084981
     C***********                                                  S01496 084981
     C***********          END                                     S01496 084981
     C***********                                                         084981
     C***********          ADD  1         RRN     40     04               084981
     C***********                                                         084981
     C***********          MOVE ' '       ACTN                            084981
     C***********          MOVELPBCH      SPBCH                           S01117
     C***********          MOVELPBCA      SPBCA                    S01117 084981
     C***********          MOVELPSSH      SPSSH                           084981
     C***********          MOVELPCPY      SPCPY                           084981
     C***********          MOVELPEVT      SPEVT                           084981
     C***********                                                  S01486 084981
     C***IF*PORTFOLIO*MANAGEMENT*INSTALLED*************************S01486 084981
     C***********                                                  S01486 084981
     C***********BGPFMG    IFEQ 'Y'                                S01486 084981
     C***********PTFR      IFEQ '9997'                             S01486 084981
     C***********          MOVELFCR997    SPPTFR                   S01486 084981
     C***********          ELSE                                    S01486 084981
     C***********          MOVELPTFR      SPPTFR                   S01486 084981
     C***********          END                                     S01486 084981
     C***********          END                                     S01486 084981
     C***********                                                  S01486 084981
     C**WORK*OUT*DUE*DATE*FOR*SCREEN*******************************S01486 084981
     C***********                                                  S01486 084981
     C***********          Z-ADDPDUD      ZDAYNO                          084981
     C***********          EXSR ZDATE2                                    084981
     C***********          MOVELZDATE     SPDUD                           084981
     C***********                                                  S01512 084981
     C***If*S01512*is*active,*work*out*payment/value*date*for*screeS01512 084981
     C***********                                                  S01512 084981
     C***********S01512    IFEQ 'Y'                                S01512 084981
     C***********          Z-ADDPSVL      ZDAYNO                   S01512 084981
     C***********          EXSR ZDATE2                             S01512 084981
     C***********          MOVELZDATE     SFPSVL                   S01512 084981
     C***********          END                                     S01512 084981
     C***********                                                  S01512 084981
     C***********          MOVELPAUI      SPAUI                           084981
     C***********KEYFLD    IFEQ SAVFLD                             E37157 084981
     C***********          ADD  1         SEQ                      E37157 084981
     C***********          ELSE                                    E37157 084981
     C***********          Z-ADD1         SEQ                      E37157 084981
     C***********          MOVELKEYFLD    SAVFLD 31                E37157 084981
     C***********          END                                     E37157 084981
     C***********          WRITESUBFLREC                                  084981
     C***********                                                         084981
     C***RECORD*NOW*WRITTEN*TO*SUBFILE*********************************   084981
     C***********                                                         084981
     C***********          END                                            084981
     C***********          ELSE                                    E37157 084981
     C***********          MOVELPBCA      MPBCA                    E37157 084981
     C***********          MOVELPSSH      MPSSH                    E37157 084981
     C***********          MOVELPCPY      MPCPY                    E37157 084981
     C***********          MOVELPEVT      MPEVT                    E37157 084981
     C***********          Z-ADDPDUD      ZDAYNO                   E37157 084981
     C***********          EXSR ZDATE2                             E37157 084981
     C***********          MOVELZDATE     MPDUD                    E37157 084981
     C***********MTYFLD    IFEQ SAVFLD                             E37157 084981
     C***********          ADD  1         SEQ                      E37157 084981
     C***********          ELSE                                    E37157 084981
     C***********          Z-ADD1         SEQ                      E37157 084981
     C***********          MOVELMTYFLD    SAVFLD                   E37157 084981
     C***********          END                                     E37157 084981
     C***********          END                                     E14884 084981
     C***********          END                                     S01117 084981
     C***********                                                         084981
     C****Save*branch*code*for*authorisation*check*on*display******S01117 084981
     C***********                                                  S01117 084981
     C***********          MOVELPBCA      SAVBA   3                S01117 084981
     C***********                                                         084981
     C***PAGE*NOW*FULL*(OR*EOF)****************************************   084981
     C***********          END                                            084981
     C***********                                                         084981
     C***READ*ONE*MORE*RECORD*FOR*NEXT*SCREEN**********************       084981
     C***********                                                         084981
     C************IN,03    IFEQ '0'                                       084981
     C***********                                                         084981
     C****Check*user*is*authorised*to*branch*on*position*record****S01117 084981
     C****before*setting*'review*from'*key*************************S01117 084981
     C***********                                                  S01117 084981
     C***********@ERR      DOUEQ0                                  S01117 084981
     C***********          READ POSETX                   03               084981
     C************IN81     IFEQ 'Y'                                S01117 084981
     C***********          CALL 'ZVBBU'                            S01117 084981
     C***********          PARM PBCA      @ZBRCD  3                S01117 084981
     C***********          PARM           @ERR    10               S01117 084981
     C***********          END                                     S01117 084981
     C***********          END                                     S01117 084981
     C***********                                                  S01117 084981
     C***********          END                                            084981
     C***********                                                         084981
     C***SAVE*THE*'REVIEW*FROM'*KEY*FOR*THE*START*OF*THIS*CURRENT*PAGE*   084981
     C***********                                                         084981
     C**********           MOVELPAGK      PPAGK                    E20237 084981
     C***********          MOVELPAGK      PPAGK                    E20237 084981
     C***********                                                         084981
     C***IF*NOT*EOF*SET*NEXT*'REVIEW*FROM'*KEY*ELSE*SET*IT*TO*BLANK***    084981
     C***********                                                         084981
     C************IN,03    IFEQ '0'                                       084981
     C***********          MOVELINPK      PAGK                            084981
     C***********          ELSE                                           084981
     C***********          MOVEL*BLANK    PAGK                            084981
     C***********          END                                            084981
     C***********                                                         084981
     C***FOR*SUBFILE*CONTROL*******************************************   084981
     C***********                                                         084981
     C************IN,4     IFEQ '1'                                       084981
     C***********          MOVEA'010'     *IN,1                           084981
     C***********          ELSE                                           084981
     C***********          MOVEA'11'      *IN,1                           084981
     C***********          END                                            084981
     C***********          END                                            084981
     C***********                                                         084981
     C***R*E*B*U*I*L*D***S*U*B*F*I*L*E*****-*****E*N*D********************084981
     C***********          END                                            084981
      ***********                                                         084981
      *****Review*Screen*Output*******************************************084981
      ***********                                                         084981
     C***********          MOVELINF,2     INFMSG                          084981
     C***********          WRITESUBFLCTL                                  084981
     C***********          WRITEMESSAGES                                  084981
     C***********          READ SUBFLCTL                 99               084981
     C***********          MOVELERRMSG    HERCD                           084981
     C***********          MOVELWBLNK     HERCD                           084981
     C***********          MOVEL*BLANK    SCRMSG                          084981
     C***********          MOVEL*BLANK    REVW                            084981
     C***********          MOVEL*BLANKS   SAVFLD                   S01486 084981
     C***********                                                         084981
     C***C*K*3*,*C*K12*,*H*E*L*P*,*R*E*C*O*R*D**S*E*L*E*C*T-**S*T*A*R*T   S01199
     C***C*K*3*,*C*K12*,*R*E*C*O*R*D**S*E*L*E*C*T-**S*T*A*R*T******S01199 084981
     C***********                                                         084981
     C***Call*S/R*to*move*values*into*AID**************************S01179 084981
     C***********                                                  S01179 084981
     C***********          EXSR ASCHGS                             S01179 084981
     C***********                                                  S01179 084981
     C***CK3*-*TERMINATE***********************************************   084981
     C***********                                                         084981
     C***********AID       IFEQ '01'                                      084981
     C***********          MOVEA'1'       *IN,11                          084981
     C***********                                                         084981
     C***CK12**INITIAL*SCREEN******************************************   084981
     C***********                                                         084981
     C***********          ELSE                                           084981
     C***********AID       IFEQ '05'                                      084981
     C***********          MOVEA'1'       *IN,10                          084981
     C***********                                                         084981
     C***HELP***CALL*HELP*PROGRAM**************************************   S01199
     C***********                                                         S01199
     C***********          ELSE                                           S01199
     C***********AID       IFEQ 'HP'                                      S01199
     C***********          MOVELHERCD     ERRMSG                          S01199
     C***********ERR,1     IFNE *BLANK                                    S01199
     C***********          MOVELHI        ERRMSG                          S01199
     C***********          END                             *ERR,1         S01199
     C***********          CALL 'MHELP'                                   S01199
     C***********          PARM           HBPGM                           S01199
     C***********          PARM           HERCD                           S01199
     C***********                                                         084981
     C***ENTER*PRESSED,*PROCESS*RECORD*SELECTION***********************   084981
     C***********                                                         084981
     C***********          ELSE                                           084981
     C***********          MOVEA'1'       *IN,99                          084981
     C************IN,04    IFEQ '0'                                       084981
     C***********AGAIN     TAG                                            084981
     C***********          READCSUBFLREC                 99               084981
     C***********          END                                            084981
      ***********                                                         084981
      *****Record*Select*Validation************************************   084981
      ***********                                                         084981
     C************IN99     IFEQ '0'                                       084981
     C***********                                                         084981
     C****Ignore*blank*action*code*************************************   084981
     C***********                                                         084981
     C***********ACTN      IFEQ ' '                                       084981
     C***********          SETOF                     21                   084981
     C***********          GOTO AGAIN                                     084981
     C***********          END                                            084981
     C***********                                                         084981
     C****Validate*action*code*for*record******************************   084981
     C***********                                                         084981
     C***********          EXSR VALIDK                                    084981
     C***********                                                         084981
     C****NO*ERRORS,*UPDATE*SCREEN*CAN*BE*PROCESSED*NEXT***************   084981
     C***********                                                         084981
     C***********SCRMSG    IFEQ *BLANK                                    084981
     C***********          MOVEA'1'       *IN,12                          084981
     C***********          MOVEL'Y'       REVW                            084981
     C***********          ELSE                                           084981
     C***********          UPDATSUBFLREC                                  084981
     C***********          END                                            084981
     C***********          END                                            084981
     C***********                                                         084981
     C***C*K*3,*C*K*12*,*H*E*L*P*,*R*E*C*O*R*D**S*E*L*E*C*T*-*E*N*D       S01199
     C***C*K*3,*C*K*12*,*R*E*C*O*R*D**S*E*L*E*C*T*-*E*N*D**********S01199 084981
     C***********                                                         084981
     C***********          END                             *AID=HP        S01199
     C***********          END                                            084981
     C***********          END                                            084981
     C*
     C** D O    U N T I L   C H A N G E  O F  S C R E E N  -  S T A R T   084981
     C*                                                                   084981
     C           *IN10     DOUEQ'1'                                       084981
     C           *IN11     OREQ '1'                                       084981
     C           ENDPGM    OREQ 'Y'                                       084981
     C*                                                                   084981
     C** R E B U I L D   S U B F I L E                     -  S T A R T   084981
     C*                                                                   084981
     C** - not if error found                                             084981
     C*                                                                   084981
     C           SCRMSG    IFEQ *BLANKS                                   084981
     C                     MOVE *BLANKS   XSFRNO                          084981
     C*                                                                   084981
     C           AID       IFEQ 'RA'                                      084981
     C                     MOVE AID       SAVAID  2                       084981
     C*                                                                   084981
     C** Write control record                                             084981
     C*                                                                   084981
     C                     MOVEA'000'     *IN,1                           084981
     C                     Z-ADD*ZERO     RRN                             084981
     C/COPY WNCPYSRC,SE0170C054
     C                     WRITESUBFLCTL                                  084981
     C/COPY WNCPYSRC,SE0170C055
     C                     MOVELPPBCA     PBCA                            084981
     C                     MOVELPPSSH     PSSH                            084981
     C                     MOVELPPCPY     PCPY                            084981
     C           BGPFMG    IFEQ 'Y'                                       084981
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           PPTFR     IFEQ FCR997                                    084981
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C                     MOVE FCR997    PTFR                            084981
     C                     ELSE                                           084981
     C                     MOVELPPTFR     PTFR                            084981
     C                     ENDIF                                          084981
     C                     ENDIF                                          084981
     C*                                                                   084981
     C** Convert due date to stored format                                084981
     C*                                                                   084981
     C           PPDUD     IFEQ *BLANKS                                   084981
     C                     Z-ADD0         PDUD                            084981
     C                     ELSE                                           084981
     C*                                                                   084981
     C                     MOVE PPDUD     PPDUDN  60                      084981
     C                     MOVE PPDUDN    PPDUDA  6                       084981
     C           PPDUD     COMP PPDUDA               9999                 084981
     C           *IN99     IFNE '1'                                       084981
     C                     Z-ADDPPDUDN    ZDATE                           084981
     C                     EXSR ZDATE1                                    084981
     C                     END                                            084981
     C           *IN99     IFEQ '1'                                       084981
     C                     Z-ADD0         PDUD                            084981
     C                     ELSE                                           084981
     C                     Z-ADDZDAYNO    PDUD                            084981
     C                     END                                            084981
     C                     END                                            084981
     C                     MOVELPPEVT     PEVT                            084981
     C                     MOVEL*BLANKS   TXBS                            186055
     C                     MOVEL*BLANKS   BNFO                            186055
     C                     MOVEL*BLANKS   EXCD                            186055
     C*                                                                   084981
     C*                                                                   141869
     C** Save fields.                                                     141869
     C*                                                                   141869
     C                     MOVE PPBCA     OPBCA   3                       141869
     C                     MOVE PPSSH     OPSSH  10                       141869
     C                     MOVE PPCPY     OPCPY  10                       141869
     C                     MOVE PPDUD     OPDUD   6                       141869
     C                     MOVE PPEVT     OPEVT   2                       141869
     C                     MOVE PPTFR     OPTFR   4                       141869
     C** Also different key depending on whether PM installed             084981
     C*                                                                   084981
     C           CSE023    IFEQ 'Y'                                       186055
     C           PTXBSK    SETLLPOSETX                                    186055
     C                     ELSE                                           186055
     C           BGPFMG    IFEQ 'Y'                                       084981
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           PTFRK     SETLLPOSETX                                    084981
     C                     ELSE                                           084981
     C           POSETK    SETLLPOSETX                                    084981
     C                     END                                            084981
     C                     END                                            186055
     C*                                                                   084981
     C** Read in details - fill up subfile                                084981
     C*                                                                   084981
     C                     EXSR ROLLUP                                    084981
     C                     END                                            084981
     C*                                                                   084981
     C** R E B U I L D   S U B F I L E     -     E N D                    084981
     C                     END                                            084981
     C*                                                                   084981
     C***  Review Screen Output                                           084981
     C***  Redisplay subfile until all action codes are valid             084981
     C*                                                                   084981
     C           WRDIS     DOUEQ*BLANK                                    084981
     C           ENDPGM    OREQ 'Y'                                       084981
     C**********           MOVELINF,2     INFMSG                                     084981 AR324886
     C                     MOVELINF,17    INFMSG                                            AR324886
     C/COPY WNCPYSRC,SE0170C056
     C*                                                                   084981
     C**********           WRITESUBFLCTL                                              084981 BUG1992
     C/COPY WNCPYSRC,SE0170C057
     C                     WRITEMESSAGES                                  084981
     C           *IN01     IFEQ '0'                                       084981
     C                     WRITENOREC                                     084981
     C                     ENDIF                                          084981
     C/COPY WNCPYSRC,SE0170C058
     C                     WRITESUBFLCTL                                                     BUG1992
     C                     READ SUBFLCTL                 99               084981
     C/COPY WNCPYSRC,SE0170C059
     C                     MOVELERRMSG    HERCD                           084981
     C                     MOVELWBLNK     HERCD                           084981
     C                     MOVEL*BLANK    SCRMSG                          084981
     C                     MOVEL*BLANK    REVW                            084981
     C                     MOVE *BLANK    WRDIS   1                       084981
     C*                                                                   084981
     C** Call S/R to move values into AID                                 084981
     C*                                                                   084981
     C                     EXSR ASCHGS                                    084981
     C*                                                                   084981
     C** Determine next process depending on the action taken by user     084981
     C*                                                                   084981
     C                     SELEC                                          084981
     C*                                                                   084981
     C** F3 - terminate                                                   084981
     C           AID       WHEQ '01'                                      084981
     C                     MOVE '1'       *IN11                           084981
     C*                                                                   084981
     C** F12 - initial screen                                             084981
     C           AID       WHEQ '05'                                      084981
     C                     MOVE '1'       *IN10                           084981
     C*                                                                   084981
     C** Rollup is pressed, display more records                          084981
     C           AID       WHEQ 'UP'                                      084981
     C                     MOVE 'Y'       WRDIS                           084981
     C                     EXSR ROLLUP                                    084981
     C*                                                                   084981
     C** Enter is pressed, process record selection                       084981
     C           AID       WHEQ 'RA'                                      084981
     C           RRN       ANDGT0                                         084981
     C/COPY WNCPYSRC,SE0170C075
     C********** PAGK      ANDEQ*BLANKS                                                084981 206844
     C/COPY WNCPYSRC,SE0170C076
     C                     Z-ADD1         RRN                             084981
     C/COPY WNCPYSRC,SE0170C060
     C                     READCSUBFLREC                 62               084981
     C/COPY WNCPYSRC,SE0170C061
     C                     Z-ADD0         WRCTR   40                      084981
     C                     Z-ADD0         EC      40                      084981
     C                     Z-ADD0         WEC                                                 222756
     C                     MOVE *BLANKS   ERR                             084981
     C*                                                                   084981
     C** Process record select validation                                 084981
     C*                                                                   084981
     C           *IN62     DOWEQ'0'                                       084981
     C           ACTN      IFNE *BLANK                                    084981
     C                     MOVE '1'       *IN61                           084981
     C                     MOVE 'Y'       REVW                            CAC002
     C                     EXSR VALIDK                                    084981
     C           SCRMSG    IFNE *BLANKS                                   084981
     C                     ADD  1         WRCTR                           084981
     C           WRCTR     IFEQ 1                                         084981
     C                     Z-ADDRRN       RECNO                           084981
     C                     ENDIF                                          084981
     C                     MOVE 'Y'       WRDIS                           084981
     C                     ENDIF                                          084981
     C                     ELSE                                           084981
     C                     MOVE '0'       *IN21                           084981
     C                     ENDIF                                          084981
     C/COPY WNCPYSRC,SE0170C062
     C                     UPDATSUBFLREC                                  084981
     C                     READCSUBFLREC                 62               084981
     C/COPY WNCPYSRC,SE0170C063
     C                     ENDDO                                          084981
     C*                                                                   084981
     C** If there are no errors in the validation process each action     084981
     C*                                                                   084981
     C           WRDIS     IFEQ *BLANK                                    084981
     C                     MOVE '0'       *IN61                           084981
     C                     Z-ADD1         RRN                             084981
     C/COPY WNCPYSRC,SE0170C064
     C                     READCSUBFLREC                 62               084981
     C/COPY WNCPYSRC,SE0170C065
     C           *IN62     DOWEQ'0'                                       084981
     C           ACTN      IFNE *BLANK                                    084981
     C                     MOVELSPBCA     PBCA                            084981
     C                     MOVELSPSSH     PSSH                            084981
     C                     MOVELSPCPY     PCPY                            084981
     C                     MOVELSPEVT     PEVT                            084981
     C                     MOVELSTXBS     TXBS                            186055
     C           SBNFO     IFNE *BLANKS                                   186055
     C                     MOVELSPCPY     BNFO                            186055
     C                     MOVE SBNFO     BNFO                            186055
     C                     ELSE                                           186055
     C                     MOVE *BLANKS   BNFO                            186055
     C                     ENDIF                                          186055
     C                     MOVELSEXCD     EXCD                            186055
     C                     MOVELSPPTFR    PTFR                            099267
     C                     Z-ADDSPTNLU    TNL1                            099267
     C                     MOVE SPDUD     ZDATE                           084981
     C                     EXSR ZDATE1                                    084981
     C                     Z-ADDZDAYNO    PDUD                            084981
     C                     MOVE ACTN      OACTN   1                       141869
     C                     MOVE 'Y'       REVW                            084981
     C                     EXSR UPDATE                                    084981
     C*                                                                   084981
     C** If F3 is pressed, go out of the main loop and end the program    084981
     C                     SELEC                                          084981
     C           PCMD      WHEQ '03'                                      084981
     C           AID       OREQ '01'                                      084981
     C                     MOVE 'Y'       ENDPGM                          084981
     C                     LEAVE                                          084981
     C*                                                                   084981
     C** If F5 is pressed from SE1817, go out of the loop                 084981
     C           PCMD      WHEQ '05'                                      084981
     C                     LEAVE                                          084981
     C*                                                                   084981
     C** If F12 is pressed from detail screen, re-display subfile screen  084981
     C           AID       WHEQ '05'                                      084981
     C                     MOVE '0'       *IN11                           084981
     C                     MOVE 'Y'       WRDIS                           084981
     C                     MOVE '1'       *IN61                           084981
     C/COPY WNCPYSRC,SE0170C066
     C                     UPDATSUBFLREC                                  084981
     C/COPY WNCPYSRC,SE0170C067
     C                     Z-ADDRRN       RECNO                           084981
     C                     LEAVE                                          084981
     C*                                                                   084981
     C** If ENTER is pressed, re-display subfile page                     084981
     C                     OTHER                                          084981
     C                     MOVE 'Y'       WRDIS                           084981
     C                     Z-ADDRRN       RECNO                           084981
     C                     ENDSL                                          084981
     C*                                                                   084981
     C                     MOVE *BLANK    ACTN                            084981
     C                     ENDIF                                          084981
     C/COPY WNCPYSRC,SE0170C068
     C                     UPDATSUBFLREC                                  084981
     C                     READCSUBFLREC                 62               084981
     C/COPY WNCPYSRC,SE0170C069
     C                     ENDDO                                          084981
     C                     MOVE 'RA'      AID                             084981
     C*                                                                   084981
     C*                                                                   141869
     C** If Action is 'A' or 'D'.                                         141869
     C*                                                                   141869
     C           OACTN     IFEQ 'A'                                       141869
     C           OACTN     OREQ 'D'                                       141869
     C           OACTN     OREQ 'Y'                                       141869
     C           OACTN     OREQ 'R'                                       141869
     C           OACTN     OREQ 'U'                                                         AR324886
     C*                                                                   141869
     C                     MOVE ' '       WRDIS                           141869
     C                     MOVE *BLANK    OACTN                           141869
     C                     MOVE OPBCA     PPBCA                           141869
     C                     MOVE OPSSH     PPSSH                           141869
     C                     MOVE OPCPY     PPCPY                           141869
     C                     MOVE OPDUD     PPDUD                           141869
     C                     MOVE OPEVT     PPEVT                           141869
     C                     MOVE OPTFR     PPTFR                           141869
     C                     ENDIF                                          141869
     C** If there are errors, highlight the error message line            084981
     C                     ELSE                                           084981
     C                     MOVELHI        ERRMSG                          084981
     C                     MOVEL*BLANK    AID                             084981
     C                     ENDIF                                          084981
     C*                                                                   084981
     C                     ENDSL                                          084981
     C                     ENDDO                                          084981
     C*                                                                   084981
     C** D O    U N T I L   C H A N G E  O F  S C R E E N   - S T A R T
     C                     END
     C*                                                                   S01496
     C***FOR*LIVE/ALL*FIELD*SET TO 'L' OVERRIDE POSETX BACK TO POSETALL   S01496
     C***FOR*LIVE/ALL*FIELD*SET*TO*'L'*OVERRIDE*POSETX*BACK*TO*SEPOS01496 084981
     C***FOR*LIVE/ALL*FIELD*SET*TO*'L'*OVERRIDE*POSETX*BACK*TO*POS 084981 186055
     C** FOR LIVE/ALL FIELD SET TO 'L' OVERRIDE POSETX BACK TO POSET7     186055
     C*                                                                   S01496
     C           S01496    IFEQ 'Y'                                       S01496
     C           CSE007    OREQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0170CCP9                                           S01408
     C*                                                                   S01408
     C           PPALL     IFEQ 'L'                                       S01496
     C                     CLOSEPOSETX                                    S01496
     C                     CALL 'QCMDEXC'                                 S01496
     C                     PARM           CCOVRA                          S01496
     C***********          PARM 35        WWOVL                    S01496 084981
     C                     PARM 33        WWOVL                           084981
     C                     OPEN POSETX                                    S01496
     C                     ENDIF                                          S01496
     C                     ENDIF                                          S01496
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT                                                              084981
     C*****************************************************************   084981
     C*                                                               *   084981
     C*  ROLLUP  - S/R TO PROCESS ROLLUP REQUESTS                     *   084981
     C*  CALLED FROM: REVIEW                                          *   084981
     C*  CALLS: NONE                                                  *   084981
     C*                                                               *   084981
     C*****************************************************************   084981
     C*                                                                   084981
     C           ROLLUP    BEGSR                           ** ROLLUP BSR**084981
     C*                                                                   084981
     C                     MOVE '0'       *IN21                           084981
     C                     MOVE '0'       *IN61                           084981
     C                     Z-ADD0         WSCTR   20                      084981
     C                     MOVEL*BLANKS   SAVBA                           084981
     C           AID       IFEQ 'UP'                                      084981
     C                     Z-ADDRRNLST    RRN                             084981
     C                     MOVELWSVBCA    PBCA                            084981
     C                     MOVELWSVSSH    PSSH                            084981
     C**********           Z-ADDWSVCPY    PCPY                                         084981 CSD027
     C                     MOVE WSVCPY    PCPY                                                CSD027
     C                     Z-ADDWSVDUD    PDUD                            084981
     C                     MOVELWSVEVT    PEVT                            084981
     C                     MOVELWSVTFR    PTFR                            084981
     C                     MOVELWSVTLU    TNL1                            084981
     C                     MOVELWSTXBS    TXBS                            186055
     C                     MOVELWSBNFO    BNFO                            186055
     C                     MOVELWSEXCD    EXCD                            186055
     C           CSE023    IFEQ 'Y'                                       186055
     C           PTXBSK    SETLLPOSETX                                    186055
     C                     ELSE                                           186055
     C           BGPFMG    IFEQ 'Y'                                       084981
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           PTFRK     SETLLPOSETX                                    084981
     C                     ELSE                                           084981
     C           POSETK    SETLLPOSETX                                    084981
     C                     ENDIF                                          084981
     C                     ENDIF                                          186055
     C                     ENDIF                                          084981
     C/COPY WNCPYSRC,SE0170C077
     C                     MOVE *BLANKS   SAVFLD                                              206844
     C*                                                                   084981
     C                     READ POSETX                   03               084981
     C*                                                                   084981
     C** Read details until subfile page is full or EOF is reached        084981
     C*                                                                   084981
     C           *IN03     DOWEQ'0'                                       084981
     C/COPY WNCPYSRC,SE0170C031
     C********** WSCTR     ANDLT14                                 084981 CSE023
     C********** WSCTR     ANDLT13                                 CSE023 CSE016
     C           WSCTR     ANDLT07                                        CSE016
     C/COPY WNCPYSRC,SE0170C032
     C                     MOVE *BLANK    WRNXT   1                                           206844
      *                                                                                       206844
     C           PPBCA     IFNE *BLANK                                                        206844
     C           PPBCA     ANDNEPBCA                                                          206844
     C                     MOVE 'Y'       WRNXT                                               206844
     C                     ENDIF                                                              206844
      *                                                                                       206844
     C           PPSSH     IFNE *BLANK                                                        206844
     C           PPSSH     ANDNEPSSH                                                          206844
     C                     MOVE 'Y'       WRNXT                                               206844
     C                     ENDIF                                                              206844
      *                                                                                       206844
     C           PPCPY     IFNE *BLANK                                                        206844
     C                     MOVE *BLANK    WCPCPY 10                                           206844
     C                     MOVELPCPY      WCPCPY                                              206844
     C           PPCPY     IFNE WCPCPY                                                        206844
     C                     MOVE 'Y'       WRNXT                                               206844
     C                     ENDIF                                                              206844
     C                     ENDIF                                                              206844
      *                                                                                       206844
     C           PPDUD     IFNE *BLANK                                                        206844
     C                     Z-ADDPDUD      ZDAYNO                                              206844
     C                     EXSR ZDATE2                                                        206844
     C                     MOVE *BLANK    WCPDUD  6                                           206844
     C                     MOVELZDATE     WCPDUD                                              206844
     C           PPDUD     IFNE WCPDUD                                                        206844
     C                     MOVE 'Y'       WRNXT                                               206844
     C                     ENDIF                                                              206844
     C                     ENDIF                                                              206844
      *                                                                                       206844
     C           PPEVT     IFNE *BLANK                                                        206844
     C           PPEVT     ANDNEPEVT                                                          206844
     C                     MOVE 'Y'       WRNXT                                               206844
     C                     ENDIF                                                              206844
      *                                                                                       206844
     C           PPTFR     IFNE *BLANK                                                        206844
     C           PPTFR     ANDNEPTFR                                                          206844
     C                     MOVE 'Y'       WRNXT                                               206844
     C                     ENDIF                                                              206844
      *                                                                                       206844
      ** Read next record if WRNXT = 'Y'.                                                     206844
      *                                                                                       206844
     C           WRNXT     IFEQ *BLANK                                                        206844
     C*                                                                   084981
     C** Check if user is authorised to branch on position record         084981
     C** before building subfile                                          084981
     C*                                                                   084981
     C           PBCA      IFNE SAVBA                                     084981
     C                     Z-ADD0         @ERR                            084981
     C********** *IN81     IFEQ 'Y'                                                  084981 AR706573
     C           *IN81     IFEQ '1'                                                         AR706573
     C                     CALL 'ZVBBU'                                   084981
     C                     PARM PBCA      @ZBRCD  3                       084981
     C                     PARM           @ERR    10                      084981
     C                     ENDIF                                          084981
     C                     ENDIF                                          084981
      *                                                                   084981
     C                     Z-ADDTNL1      SPTNLU                                            AR324886
      *                                                                                     AR324886
     C           @ERR      IFEQ 0                                         084981
     C*                                                                   084981
     C** Ignore records with record ID of 'M'                             084981
     C*                                                                   084981
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0170CP10                                           S01408
     C*                                                                   S01408
     C           RECI      IFNE 'M'                                       084981
     C           S01496    ANDNE'Y'                                       084981
     C           CSE007    ANDNE'Y'                                       CSE007
     C           CEU017    ANDNE'Y'                                       CEU017
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0170CP11                                           S01408
     C*                                                                   S01408
     C           S01496    OREQ 'Y'                                       084981
     C           CSE007    OREQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C*                                                                   084981
     C           *IN,03    IFEQ '0'                                       084981
     C*                                                                   084981
     C** If Jyske Enhancements feature is not installed                   084981
     C** AND if Corporate Action feature is not installed                 CSE007
     C** AND if Securities Redenomination feature is not installed        CEU017
     C*                                                                   084981
     C           S01496    IFNE 'Y'                                       084981
     C           CSE007    ANDNE'Y'                                       CSE007
     C           CEU017    ANDNE'Y'                                       CEU017
     C*                                                                   084981
     C** If record is deleted or matured, flag it as such on screen       084981
     C*                                                                   084981
     C           RECI      IFEQ '*'                                       084981
     C                     MOVEL'D'       STAT                            084981
     C                     ELSE                                           084981
     C                     MOVEL*BLANK    STAT    1                       084981
     C                     ENDIF                                          084981
     C*                                                                   084981
     C                     ELSE                                           084981
     C*                                                                   084981
     C** If record is matured/reversed/deleted, flag it as such on screen 084981
     C*                                                                   084981
     C                     MOVEL*BLANK    STAT                            084981
     C           RECI      IFNE 'D'                                       084981
     C           RECI      IFEQ '*'                                       084981
     C                     MOVEL'D'       STAT    1        *STATUS=DELT   084981
     C                     ELSE                                           084981
     C                     MOVE RECI      STAT                            084981
     C                     ENDIF                                          084981
     C           RECI      IFEQ 'M'                                                         AR324886
     C********** PSAUTH    CHAINPSAUT                80                            AR324886 AR586601
     C           PSAUTH    CHAINPSAUT               N80                                     AR586601
     C           *IN80     IFEQ *OFF                                                        AR324886
     C           PALCTP    ANDEQ'R'                                                         AR324886
     C                     MOVE 'R'       STAT                                              AR324886
     C                     ENDIF                                                            AR324886
     C                     ENDIF                                                            AR324886
     C                     ENDIF                                          084981
     C                     ENDIF                                          084981
     C*                                                                   084981
     C                     ADD  1         RRN     40                      084981
     C                     ADD  1         WSCTR                           084981
     C*                                                                   084981
     C                     MOVE RECI      SRECI   1                                         AR324886
     C                     MOVE ' '       ACTN                            084981
     C                     MOVE '0'       SWARN                           084981
     C                     MOVELPBCA      SPBCA                           084981
     C                     MOVELPSSH      SPSSH                           084981
     C                     MOVELPCPY      SPCPY                           084981
     C                     MOVELPEVT      SPEVT                           084981
     C                     Z-ADDTNL1      SPTNLU                          099267
     C                     Z-ADDPDUD      ZDAYNO                          084981
     C                     EXSR ZDATE2                                    084981
     C                     MOVELZDATE     SPDUD                           084981
     C                     MOVELTXBS      STXBS                           186055
     C                     MOVE BNFO      SBNFO                           186055
     C                     MOVELEXCD      SEXCD                           186055
     C/COPY WNCPYSRC,SE0170C033
      *                                                                   CSE016
      ** Save indicator                                                   CSE016
      *                                                                   CSE016
     C                     MOVE *IN99     WWIN99  1                       CSE016
     C                     MOVE *BLANKS   SRNME                           CSE016
      *                                                                   CSE016
      ** Retrieve security description                                    CSE016
      *                                                                   CSE016
     C           PSSH      CHAINSECTY                99                   CSE016
     C           *IN99     IFEQ *OFF                                      CSE016
      *                                                                   CSE016
     C                     MOVE BVRIDF    ZRSFD                           CSE016
     C                     MOVELSRPN      ZSRPN                           CSE016
     C                     EXSR ZSDESC                                    CSE016
     C                     MOVELZRNME     SRNME                           CSE016
      *                                                                   CSE016
     C                     ENDIF                                          CSE016
      *                                                                   CSE016
      ** Restore indicator                                                CSE016
      *                                                                   CSE016
     C                     MOVE WWIN99    *IN99                           CSE016
     C*                                                                   084981
     C** If portfolio management is installed                             084981
     C*                                                                   084981
     C           BGPFMG    IFEQ 'Y'                                       084981
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           PTFR      IFEQ '9997'                                    084981
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C                     MOVELFCR997    SPPTFR                          084981
     C                     ELSE                                           084981
     C                     MOVELPTFR      SPPTFR                          084981
     C                     ENDIF                                          084981
     C                     ENDIF                                          084981
     C*                                                                   084981
     C** If S01512 is active, work out payment/value date for screen      084981
     C*                                                                   084981
     C           S01512    IFEQ 'Y'                                       084981
     C                     Z-ADDPSVL      ZDAYNO                          084981
     C                     EXSR ZDATE2                                    084981
     C                     MOVELZDATE     SFPSVL                          084981
     C                     ENDIF                                          084981
     C*                                                                   084981
     C           SRECI     IFEQ 'M'                                                         AR324886
     C           STAT      ANDEQ'R'                                                         AR324886
     C                     MOVE *BLANK    SPAUI                                             AR324886
     C                     ELSE                                                             AR324886
     C                     MOVELPAUI      SPAUI                           084981
     C                     ENDIF                                                            AR324886
     C           KEYFLD    IFEQ SAVFLD                                    084981
     C                     ADD  1         SEQ                             084981
     C                     ELSE                                           084981
     C                     Z-ADD1         SEQ                             084981
     C                     MOVELKEYFLD    SAVFLD 31                       084981
     C                     ENDIF                                          084981
      **********                                                   CSE023 186055
      ***Format*subfile*record*detail*for*output*to*screen.        CSE023 186055
      **********                                                   CSE023 186055
     C********** CSE023    IFEQ 'Y'                                CSE023 186055
     C**********           MOVELTXBS      STXBS                    CSE023 186055
     C**********           MOVE BNFO      SBNFO                    CSE023 186055
     C**********           MOVELEXCD      SEXCD                    CSE023 186055
     C**********           ENDIF                                   CSE023 186055
     C/COPY WNCPYSRC,SE0170C070
     C                     WRITESUBFLREC                                  084981
     C/COPY WNCPYSRC,SE0170C071
     C*                                                                   084981
     C** Record is now written to subfile                                 084981
     C*                                                                   084981
     C                     END                                            084981
     C                     ELSE                                           084981
     C                     MOVELPBCA      MPBCA                           084981
     C                     MOVELPSSH      MPSSH                           084981
     C                     MOVELPCPY      MPCPY                           084981
     C                     MOVELPEVT      MPEVT                           084981
     C                     Z-ADDPDUD      ZDAYNO                          084981
     C                     EXSR ZDATE2                                    084981
     C                     MOVELZDATE     MPDUD                           084981
     C           MTYFLD    IFEQ SAVFLD                                    084981
     C                     ADD  1         SEQ                             084981
     C                     ELSE                                           084981
     C                     Z-ADD1         SEQ                             084981
     C                     MOVELMTYFLD    SAVFLD                          084981
     C                     END                                            084981
     C                     END                                            084981
     C*                                                                   084981
     C**  Save branch code for authorisation check on display             084981
     C*                                                                   084981
     C                     MOVELPBCA      SAVBA   3                       084981
     C                     ENDIF                                          084981
     C/COPY WNCPYSRC,SE0170C078
     C                     ENDIF                                                              206844
     C*                                                                   084981
     C                     READ POSETX                   03               084981
     C*                                                                   084981
     C** Page is now full or EOF is reached on the file                   084981
     C                     ENDDO                                          084981
     C*                                                                   084981
     C** Set the subfile record number                                    084981
     C*                                                                   084981
     C********** RRN       IFLE 14                                 084981 CSE023
     C********** RRN       IFLE 13                                                     CSE023 206844
     C**********           Z-ADD1         RECNO                                        084981 206844
     C**********           ELSE                                                        084981 206844
     C********** RRN       SUB  WSCTR     RECNO                                        084981 206844
     C**********           ADD  1         RECNO                                        084981 206844
     C**********           ENDIF                                                       084981 206844
     C/COPY WNCPYSRC,SE0170C034
      *                                                                   CSE016
     C           RRN       IFLE 07                                        CSE016
     C                     Z-ADD1         RECNO                           CSE016
     C                     ELSE                                           CSE016
     C           WSCTR     IFEQ 0                                                             206844
     C           RRN       SUB  6         RECNO                                               206844
     C                     ELSE                                                               206844
     C           RRN       SUB  WSCTR     RECNO                           CSE016
     C                     ADD  1         RECNO                           CSE016
     C                     ENDIF                                                              206844
     C                     ENDIF                                          CSE016
      *                                                                   CSE016
     C                     Z-ADDRRN       RRNLST  40                      084981
     C*                                                                   084981
     C** Read one more record for next screen                             084981
     C*                                                                   084981
     C           *IN,03    IFEQ '0'                                       084981
     C*                                                                   084981
     C** Save key to access this record again on the next rollup          084981
     C*                                                                   084981
     C                     MOVELPBCA      WSVBCA                          084981
     C                     MOVELPSSH      WSVSSH                          084981
     C**********           Z-ADDPCPY      WSVCPY                                       084981 CSD027
     C                     MOVE PCPY      WSVCPY                                              CSD027
     C                     Z-ADDPDUD      WSVDUD                          084981
     C                     MOVELPEVT      WSVEVT                          084981
     C                     MOVELPTFR      WSVTFR                          084981
     C                     MOVELTNL1      WSVTLU                          084981
     C                     MOVELTXBS      WSTXBS                          186055
     C                     MOVELBNFO      WSBNFO                          186055
     C                     MOVELEXCD      WSEXCD                          186055
     C*                                                                   084981
     C** Check user is authorised to branch on position record            084981
     C** before setting 'review from' key                                 084981
     C*                                                                   084981
     C           @ERR      DOUEQ0                                         084981
     C********** *IN81     IFEQ 'Y'                                                  084981 AR706573
     C           *IN81     IFEQ '1'                                                         AR706573
     C                     CALL 'ZVBBU'                                   084981
     C                     PARM PBCA      @ZBRCD  3                       084981
     C                     PARM           @ERR    10                      084981
     C                     ENDIF                                          084981
     C           @ERR      IFNE 0                                         084981
     C/COPY WNCPYSRC,SE0170C079
     C                     READ POSETX                   03               084981
     C/COPY WNCPYSRC,SE0170C080
     C                     ENDIF                                          084981
     C                     ENDDO                                          084981
     C*                                                                   084981
     C                     ENDIF                                          084981
     C*                                                                   084981
     C** Set 'REVIEW FROM' key to blank                                   084981
     C/COPY WNCPYSRC,SE0170C081
     C*                                                                   084981
     C**********           MOVEL*BLANK    PAGK                                         084981 206844
     C/COPY WNCPYSRC,SE0170C082
     C*                                                                   084981
     C** For subfile control                                              084981
     C*                                                                   084981
     C           WSCTR     IFEQ 0                                         084981
     C           RRN       ANDEQ0                                                             206844
     C                     MOVEA'01'      *IN,1                           084981
     C                     ELSE                                           084981
     C                     MOVEA'11'      *IN,1                           084981
     C                     ENDIF                                          084981
     C*                                                                   084981
     C                     ENDSR                                          084981
     C*****************************************************************   084981
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  UPDATE  - S/R TO PROCESS DETAIL SCREEN AND UPDATE FILE       *
     C*  CALLED FROM: MAIN PROCESSING                                 *
     C*  CALLS: VALIDD, UPDFLS, INITRC, TRSFS, DEFLTS                 *
     C*                                                               *
     C*****************************************************************
     C*
     C           UPDATE    BEGSR                           ** UPDATE BSR**
     C*
     C** SET SCREEN INDICATORS - PROTECT KEY, SET OFF ERROR INDS,
     C** POSITION CURSOR
     C*
     C                     MOVEA'1'       *IN,5            *PROTECT/NDS
     C                     MOVEA'0'       *IN,11                          084981
     C                     MOVEA'0'       *IN,12
     C                     MOVEA'0'       *IN,29                          S01512
     C                     MOVEA'10000000'*IN,30
     C                     MOVEA'00000000'*IN,38
     C***********          MOVEA'0000000' *IN,46                          E17175
     C                     MOVEA'00000000'*IN,46                          E17175
     C                     MOVEA'000'     *IN,70                          S01447
     C**********           MOVE *OFF      *IN75                                        233711 234471
     C                     MOVE *OFF      *IN78                                               234471
     C                     MOVE *OFF      *IN76                                               233711
     C                     MOVEA'0'       *IN,89
     C                     MOVEA'0'       *IN,99                          S01486
     C                     MOVE '0'       *IN56                           CAC002
     C                     MOVE '0'       *IN67                                               CER049
     C                     MOVEL*BLANKS   SCRMSG                                              222756
     C                     Z-ADD0         WEC                                                 222756
     C                     Z-ADD0         EC                                                  222756
     C*
     C** ACCESS FILE RECORD FOR OLD TNLU TO CHECK AT UPDATE TIME
     C** IF NO RECORD PRESENTLY ON FILE, ZEROISE STORED TNLU
     C*
     C                     Z-ADD*ZERO     STNLU   50
     C                     MOVE *BLANK    CAEVNT  1                                           191161
     C                     MOVE *BLANK    PCPYTP  1                                           191161
     C           *IN04     IFEQ *ON                                       CGL007
      *                                                                   CGL007
      ** Program is called by posting enquiry                             CGL007
      *                                                                   CGL007
     C           KEY16     SETLLPOSETX                                    CGL007
     C           *IN99     DOWEQ*OFF                                      CGL007
     C           KEY16     READEPOSETX                   99               CGL007
     C           *IN99     IFEQ *OFF                                      CGL007
      *                                                                   CGL007
     C           PTFR      IFNE ZPTFR                                     CGL007
     C           PSAT      ORNE ZPSTA                                     CGL007
     C                     ITER                                           CGL007
     C                     ELSE                                           CGL007
      *                                                                   CGL007
      ** Record match with Criteria                                       CGL007
      *                                                                   CGL007
     C                     MOVE *ON       *IN08                           CGL007
     C                     LEAVE                                          CGL007
     C                     ENDIF                                          CGL007
      *                                                                   CGL007
     C                     ENDIF                                          CGL007
     C                     ENDDO                                          CGL007
      *                                                                   CGL007
     C           *IN08     IFEQ *OFF                                      CGL007
     C                     MOVE 'E'       ZRETN                           CGL007
     C                     MOVE *ON       *INLR                           CGL007
     C                     RETRN                                          CGL007
     C                     ENDIF                                          CGL007
      *                                                                   CGL007
     C                     ELSE                                           CGL007
     C/COPY WNCPYSRC,SE0170C014
     C*                                                                   S01486
     C** IF PORTFOLIO MANAGEMENT INSTALLED                                S01486
     C           CSE023    IFEQ 'Y'                                       186055
     C           PTXBSK    CHAINPOSETX               99                   186055
     C**********           Z-ADDSEQ       RECSEQ  30                                   186055 212522
     C********** RECSEQ    DOWGT1                                                      186055 212522
     C********** *IN99     ANDEQ'0'                                                    186055 212522
     C********** PTXBSK    READEPOSETX                   99                            186055 212522
     C********** RECI      IFNE '*'                                                    186055 212522
     C**********           SUB  1         RECSEQ                                       186055 212522
     C**********           ENDIF                                                       186055 212522
     C**********           ENDDO                                                       186055 212522
     C                     ELSE                                           186055
     C           BGPFMG    IFEQ 'Y'                                       080743
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           ACTN      IFNE 'I'                                       S01486
     C********** BGPFMG    IFEQ 'Y'                                S01486 080743
     C           PTFRK     SETLLPOSETX                                    S01486
     C**********                                                   185397 186055
     C***If*CSE023*is*present,*then*need*to*check*tax*basket,*Exemption97 186055
     C***code*and*beneficial*owner*number*as*well.                 185397 186055
     C**********                                                   185397 186055
     C********** CSE023    IFNE 'Y'                                185397 186055
     C                     READ POSETX                   99               S01486
     C**********           ELSE                                    185397 186055
     C**********           MOVE '0'       *IN99                    185397 186055
     C********** SBNFO     IFNE *BLANK                             185397 186055
     C**********           MOVE PCPY      @BNFO  26                185397 186055
     C**********           MOVE SBNFO     @BNFO                    185397 186055
     C**********           ELSE                                    185397 186055
     C**********           MOVE *BLANK    @BNFO                    185397 186055
     C**********           END                                     185397 186055
     C********** POSETK    CHAINPOSETX               99            185397 186055
     C**********           Z-ADDSEQ       RECSEQ  30               185397 186055
     C********** RECSEQ    DOWGT1                                  185397 186055
     C********** *IN99     ANDEQ'0'                                185397 186055
     C********** POSETK    READEPOSETX                   99        185397 186055
     C********** RECI      IFNE '*'                                185397 186055
     C**********           SUB  1         RECSEQ                   185397 186055
     C**********           END                                     185397 186055
     C**********           END                                     185397 186055
     C**********           END                                     185397 186055
     C******************** Z-ADDSEQ       RECSEQ  30               S01486 080743
     C********** RECSEQ    DOWGT1                                  S01486 080743
     C********** *IN99     ANDEQ'0'                                S01486 080743
     C********** PTFRK     READEPOSETX                   99        S01486 080743
     C******************** SUB  1         RECSEQ                   S01486 080743
     C******************** END                                     S01486 080743
     C                     END                                            080743
     C                     ELSE                                           S01486
     C           POSETK    CHAINPOSETX               99
     C                     Z-ADDSEQ       RECSEQ  30                      E37157
     C           RECSEQ    DOWGT1                                         E37157
     C           *IN99     ANDEQ'0'                                       E37157
     C           POSETK    READEPOSETX                   99               E37157
     C                     SUB  1         RECSEQ                          E37157
     C                     END                                            E37157
     C******************** END                                     S01486 080743
     C                     END                                            S01486
     C                     ENDIF                                          186055
      *                                                                   CGL007
     C                     ENDIF                                          CGL007
     C/COPY WNCPYSRC,SE0170C015
     C           *IN,99    IFEQ '0'
     C***********          Z-ADDTNLU      STNLU                           S01486
     C                     Z-ADDTNL1      STNLU                           S01486
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0170CCP7                                           S01408
     C*                                                                   S01408
     C                     END
     C*
     C** IF INSERT (NEW OR OVER DELETED RECORD)
     C** INITIALIZE ALL FIELDS ON THE RECORD (IE ZEROIZE/BLANK OUT)
     C*
     C           ACTN      IFEQ 'I'
     C                     EXSR INITRC
     C                     END
     C*
     C** IF DELETED RECORD-ENQUIRY ONLY (RECI IS SET TO BLANK FOR
     C** INSERTS)
     C*
     C***********RECI      IFEQ '*'                                       084981
     C***********          MOVEL'E'       ACTN                            084981
     C***********          MOVEL'DELETED' DELT    7                       084981
     C***********          ELSE                                           084981
     C                     MOVEL*BLANK    DELT
     C                     SELEC                                          084981
     C           RECI      WHEQ '*'                                       084981
     C                     MOVEL'E'       ACTN                            084981
     C                     MOVEL'DELETED' DELT                            084981
     C           RECI      WHEQ 'M'                                       084981
     C           STAT      ANDEQ'M'                                                         AR324886
     C           ACTN      IFNE 'R'                                       186400
     C                     MOVEL'E'       ACTN                            084981
     C                     END                                            186400
     C                     MOVEL'MATURED' DELT                            084981
     C           RECI      WHEQ 'D'                                       084981
     C           PAUI      ANDEQ'Y'                                       084981
     C                     MOVEL'AUTHORI' DELT                            084981
     C                     MOVE 'SED'     DELT                            084981
     C           RECI      WHEQ 'M'                                                         AR324886
     C           STAT      ANDEQ'R'                                                         AR324886
     C                     MOVEL'REVERSE' DELT                                              AR324886
     C                     MOVE 'D  '     DELT                                              AR324886
     C           RECI      WHEQ 'R'                                                         AR324886
     C                     MOVEL'REV. AU' DELT                                              AR324886
     C                     MOVE 'TH.'     DELT                                              AR324886
     C                     END
     C*
     C**  TRANSLATE RECORD DETAILS FROM FILE LAYOUT TO SCREEN LAYOUT
     C*
     C**  READ SECTY TO PICK UP NOMINAL DEC PLACES
     C*
     C                     MOVE RECI      WWRECI  1                       S01496
     C           PSSH      CHAINSECTY                99
     C*                                                                   CAC002
     C**  DO NOT ALLOW AMENDMENT OF PROFIT CENTRE                         CAC002
     C*                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C           ACTN      ANDEQ'A'                                       CAC002
     C                     MOVE *OFF      *IN83                           CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CSE023
     C           CSE023    IFEQ 'Y'                                       CSE023
     C           CRTT      ANDNE*BLANKS                                   CSE023
     C                     MOVEL'Y'       WFREEM                          CSE023
     C                     ELSE                                           188588
     C                     MOVEL' '       WFREEM                          188588
     C                     ENDIF                                          CSE023
     C*                                                                   CSE007
     C                     MOVE *BLANKS   WWPTYP                          CSE007
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           PEVT      ANDNE'CP'                                      CSE007
     C           PEVT      ANDNE'DV'                                      CSE007
     C           PEVT      ANDNE'PP'                                      CSE007
     C           PEVT      ANDNE'MT'                                      CSE007
     C           PEVT      ANDNE'MP'                                      CSE007
     C           PEVT      ANDNE'RC'                                      CSE007
     C*                                                                   CEU017
     C           CEU017    OREQ 'Y'                                       CEU017
     C           PEVT      ANDNE'CP'                                      CEU017
     C           PEVT      ANDNE'DV'                                      CEU017
     C           PEVT      ANDNE'PP'                                      CEU017
     C           PEVT      ANDNE'MT'                                      CEU017
     C           PEVT      ANDNE'MP'                                      CEU017
     C           PEVT      ANDNE'RC'                                      CEU017
     C*                                                                   CSE007
     C                     MOVE *IN99     WIN99   1                       CSE007
     C           PEVT      CHAINSECOATL0             99                   CSE007
     C           *IN99     IFEQ '0'                                       CSE007
     C                     MOVE MMPTYP    WWPTYP  2                       CSE007
     C                     MOVE 'Y'       CAEVNT                                              191161
     C           WWPTYP    IFEQ 'CC'                                      CEU017
     C           SRRB      ANDNE*BLANKS                                   CEU017
     C                     Z-ADDNMDP      NMDPOS  10                      CEU017
     C           SRRB      CHAINSECTY                99                   CEU017
     C                     ENDIF                                          CEU017
     C                     ENDIF                                          CSE007
     C                     MOVE WIN99     *IN99                           CSE007
     C*                                                                   CSE007
     C                     ENDIF                                          CSE007
      *                                                                   S01447
      *** If there is a security, check that the security is taxable      S01447
      *** If it is not, protect tax withheld fields                       S01447
      *                                                                   S01447
     C                     MOVE '1'       *IN09            PROTECT TAX FLDS01447
      *                                                                   S01447
     C           *IN99     IFEQ '0'                        *B1            S01447
     C           S01447    ANDEQ'Y'                                       S01447
     C           WFREEM    OREQ 'Y'                                       CSE023
      *                                                                   S01447
     C           PEVT      IFEQ 'CP'                       *B2            S01447
     C           PEVT      OREQ 'DV'                                      S01447
     C           PEVT      OREQ 'MT'                                      CSE023
     C           CSE007    OREQ 'Y'                                       CSE007
     C           WWPTYP    ANDEQ'DV'                                      CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C           WWPTYP    ANDEQ'DV'                                      CEU017
      *                                                                   S01447
     C           SESN      CHAINSESWHTL0             99                   S01447
     C           *IN99     IFEQ '0'                        *B3            S01447
     C           WFREEM    OREQ 'Y'                                       CSE023
     C                     MOVE '0'       *IN09                           S01447
     C                     END                             *E3            S01447
     C                     END                             *E2            S01447
     C                     END                             *E1            S01447
      *                                                                   S01447
     C           ACTN      IFNE 'I'                                       S01117
     C                     EXSR TRSFS
     C                     ELSE                                                             AR851880
     C           CER049    IFEQ 'Y'                                                         AR851880
     C                     MOVE 'N'       P3TAX                                             AR851880
     C                     ENDIF                                                            AR851880
     C                     END                                            S01117
     C*
     C**  SET UP DEFAULTS (DONE ON BLANK FIELDS)
     C*
     C           *IN89     IFEQ '0'
     C                     EXSR DEFLTS
     C                     END
     C*
     C***IF*DELETE/ENQUIRY*PROTECT*FIELD*INPUT*ON*S/RECDETLS*****         S01496
     C** IF DELETE/ENQUIRY/REVERSAL PROTECT FIELD INPUT ON S/RECDETLS     S01496
     C*
     C           ACTN      IFEQ 'D'
     C           ACTN      OREQ 'E'
     C           ACTN      OREQ 'Y'                                       066716
     C           ACTN      OREQ 'R'                                       S01496
     C           S01496    ANDEQ'Y'                                       S01496
     C           ACTN      OREQ 'R'                                       CSE007
     C           CSE007    ANDEQ'Y'                                       CSE007
     C           ACTN      OREQ 'R'                                       CEU017
     C           CEU017    ANDEQ'Y'                                       CEU017
     C           ACTN      OREQ 'U'                                                         AR324886
     C                     MOVEA'1'       *IN,6            *PROTECT/NDS
     C                     END
      *                                                                   CAC002
      **  Check Customer Exists on Securities Customer File               CAC002
      *                                                                   CAC002
     C                     MOVELPCPY      CUSTNO                          CAC002
     C                     CALL 'AOSECSR0'                                CAC002
     C                     PARM *BLANKS   @RTCD                           CAC002
     C                     PARM '*KEY   ' @OPTN                           CAC002
     C                     PARM CUSTNO    CUST                            CAC002
     C           SDSECS    PARM SDSECS    DSSDY                           CAC002
      *                                                                   CAC002
      **  Display Profit Centre field if Customer Position Settlement     CAC002
      *                                                                   CAC002
     C                     MOVE '0'       *IN84                           CAC002
     C           BFCLAS    IFNE 'S'                                       CAC002
     C           BFCLAS    ANDNE'D'                                       CAC002
     C                     MOVE '1'       *IN84                           CAC002
     C                     ELSE                                                               191161
     C                     MOVEL'C'       PCPYTP                                              191161
     C                     ENDIF                                          CAC002
      *                                                                   186166
      ** Protect Tax field if action is 'A' and security is for           186166
      ** treaty tax, and for event = 'DV' and 'CP'.                       186166
      *                                                                   186166
     C           ACTN      IFEQ 'A'                                       186166
     C           WFREEM    ANDEQ'Y'                                       186166
     C           WFREEM    OREQ 'Y'                                       186166
     C           SPEVT     ANDEQ'DV'                                      186166
     C           WFREEM    OREQ 'Y'                                       186166
     C           SPEVT     ANDEQ'CP'                                      186166
     C                     MOVE '1'       *IN66                           186166
     C                     ELSE                                           186166
     C                     MOVE '0'       *IN66                           186166
     C                     ENDIF                                          186166
      *                                                                                       233711
      ** Check if EU Tax fields should be displayed.                                          233711
      *                                                                                       233711
     C**********           MOVE *OFF      *IN75                                        233711 234471
     C                     MOVE *OFF      *IN78                                               234471
      *                                                                                       233711
     C           CGL031    IFEQ 'Y'                                                           233711
     C********** *IN09     ANDEQ*OFF                                                   233711 234080
     C           SETX      ANDEQ'Y'                                                           233711
     C********** PROT      ANDNE'2'                                                    233711 234080
     C********** PROT      ANDNE'4'                                                    233711 234080
     C           BFCLAS    IFEQ 'S'                                                           233711
     C           BFCLAS    OREQ 'D'                                                           233711
     C**********           MOVE *ON       *IN75                                        233711 234471
     C                     MOVE *ON       *IN78                                               234471
     C                     ENDIF                                                              233711
     C                     ENDIF                                                              233711
      *                                                                                       CER049
     C           CER049    IFEQ 'Y'                                                           CER049
     C                     MOVE *ON       *IN63                                               CER049
     C                     ENDIF                                                              CER049
     C*
     C** D O    U N T I L   C H A N G E  O F  S C R E E N  -  S T A R T
     C*
     C           *IN10     DOUEQ'1'                        *
     C           *IN11     OREQ '1'
     C           *IN12     OREQ '1'
     C           ENDPGM    OREQ 'Y'                                       S01401
      *
      ***  Load up Info Messages
      *
     C           INFMSG    IFEQ *BLANK
     C           ACTN      IFEQ 'I'
     C                     MOVELINF,3     INFMSG
     C                     END
     C           ACTN      IFEQ 'A'
     C                     MOVELINF,4     INFMSG
     C                     END
     C           ACTN      IFEQ 'Y'
     C                     MOVELINF,5     INFMSG
     C                     END
     C           ACTN      IFEQ 'E'
     C                     MOVELINF,6     INFMSG
     C                     END
     C           ACTN      IFEQ 'D'
     C                     MOVELINF,7     INFMSG
     C                     END
     C           ACTN      IFEQ 'R'                                       S01496
     C           S01496    ANDEQ'Y'                                       S01496
     C           ACTN      OREQ 'R'                                       CSE007
     C           CSE007    ANDEQ'Y'                                       CSE007
     C           ACTN      OREQ 'R'                                       CEU017
     C           CEU017    ANDEQ'Y'                                       CEU017
     C                     MOVELINF,13    INFMSG                          S01496
     C                     END                                            S01496
     C           ACTN      IFEQ 'U'                                                         AR324886
     C                     MOVELINF,15    INFMSG                                            AR324886
     C                     ENDIF                                                            AR324886
     C                     END
     C/COPY WNCPYSRC,SE0170C016
      *
      ***  Detail Screen Output
      *
     C                     MOVELSPSCU     XSPSCU                          151506
     C/COPY WNCPYSRC,SE0170C050
     C                     WRITEKEYINPUT
     C/COPY WNCPYSRC,SE0170C051
     C**********           WRITERECDETLS                                                     BUG1992
     C                     WRITEMESSAGES
     C                     WRITERECDETLS                                                     BUG1992
     C                     READ RECDETLS                 99
     C/COPY WNCPYSRC,SE0170C102
     C                     MOVELERRMSG    HERCD
     C                     MOVELWBLNK     HERCD
     C                     MOVEL*BLANK    SCRMSG
     C*
     C***C*K*3*,*C*K12*,*H*E*L*P*,*R*O*L*L*U*P*/*D*O*W*N***-**S*T*A*R*T   S01199
     C** C K 3 , C K12 , R O L L U P / D O W N   -  S T A R T             S01199
     C*
     C** Call S/R to move values into AID                                 S01179
     C*                                                                   S01179
     C                     EXSR ASCHGS                                    S01179
     C*                                                                   S01179
     C** CK3 - TERMINATE
     C*
     C           AID       IFEQ '01'
     C                     MOVEA'1'       *IN,12
     C*
     C** CK12- INITIAL SCREEN
     C** If screen is displayed from the subfile, return to subfile       084981
     C*
     C                     ELSE
     C           AID       IFEQ '05'
     C           REVW      IFEQ 'Y'                                       084981
     C                     MOVEA'1'       *IN,11                          084981
     C                     ELSE                                           084981
     C                     MOVEA'1'       *IN,10
     C                     ENDIF                                          084981
     C*
     C***HELP***CALL*HELP*PROGRAM**************************************   S01199
     C***********                                                         S01199
     C***********          ELSE                                           S01199
     C***********AID       IFEQ 'HP'                                      S01199
     C***********          MOVELHERCD     ERRMSG                          S01199
     C***********ERR,1     IFNE *BLANK                                    S01199
     C***********          MOVELHI        ERRMSG                          S01199
     C***********          END                             *ERR,1         S01199
     C***********          CALL 'MHELP'                                   S01199
     C***********          PARM           HBPGM                           S01199
     C***********          PARM           HERCD                           S01199
     C*
     C** PAGE FORWARD TAKEN, READ NEXT RECORD
     C*
     C                     ELSE
     C           AID       IFEQ 'UP'
     C***********ACTN      ANDNE'I'                                       E20237
     C           ACTN      IFEQ 'E'                                       E20237
     C                     READ POSETX                   12
     C*
     C** CHANGE MESSAGE IF END OF FILE REACHED - NO ROLL FWD
     C*
     C           *IN,12    IFEQ '1'
     C                     MOVELINF,8     INFMSG
     C                     SETOF                     12                   E20237
     C           *HIVAL    SETLLPOSETX                                    E20237
     C                     READPPOSETX                   12               E20237
     C                     ELSE
     C                     MOVEA'1'       *IN,12
     C***********          MOVELPBCH      SPBCH                           S01117
     C                     MOVELPBCA      SPBCA                           S01117
     C                     MOVELPSSH      SPSSH
     C                     MOVELPCPY      SPCPY
     C                     MOVELPEVT      SPEVT
     C                     MOVELTXBS      STXBS                           186055
     C                     MOVE BNFO      SBNFO                           186055
     C                     MOVELEXCD      SEXCD                           186055
     C                     Z-ADDPDUD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZDATE     SPDUD
     C**********           MOVELPAUI      SPAUI                                             AR324886
     C                     MOVELSPCPY     CUSTNO                          S01401
     C                     CALL 'AOSECSR0'                                S01401
     C                     PARM *BLANKS   @RTCD                           S01401
     C                     PARM '*KEY   ' @OPTN                           S01401
     C                     PARM CUSTNO    CUST                            S01401
     C           SDSECS    PARM SDSECS    DSSDY                           S01401
     C*                                                                   S01401
     C                     END
     C                     ELSE                                           E20237
     C                     MOVELINF,8     INFMSG                          E20237
     C                     END                                            E20237
     C** Page back is now being handled by CPF                            084981
     C***********                                                         084981
     C***PAGE*BACK*TAKEN,*READ*PREVIOUS*RECORD*************************** 084981
     C***********                                                         084981
     C***********          ELSE                                           084981
     C***********AID       IFEQ 'DN'                                      084981
     C***********ACTN      ANDNE'I'                                       E20237
     C***********ACTN      IFEQ 'E'                                E20237 084981
     C***********          READPPOSETX                   12               084981
     C***********                                                         084981
     C***CHANGE*MESSAGE*IF*BEGINNING*OF*FILE*REACHED*-*NO*ROLL*BACK****   084981
     C***********                                                         084981
     C************IN,12    IFEQ '1'                                       084981
     C***********          MOVELINF,9     INFMSG                          084981
     C***********          SETOF                     12            E20237 084981
     C************LOVAL    SETLLPOSETX                             E20237 084981
     C***********          READ POSETX                   12        E20237 084981
     C***********          ELSE                                           084981
     C***********          MOVEA'1'       *IN,12                          084981
     C***********          MOVELPBCH      SPBCH                           S01117
     C***********          MOVELPBCA      SPBCA                    S01117 084981
     C***********          MOVELPSSH      SPSSH                           084981
     C***********          MOVELPCPY      SPCPY                           084981
     C***********          MOVELPEVT      SPEVT                           084981
     C***********          Z-ADDPDUD      ZDAYNO                          084981
     C***********          EXSR ZDATE2                                    084981
     C***********          MOVELZDATE     SPDUD                           084981
     C***********          MOVELPAUI      SPAUI                           084981
     C***********          MOVELSPCPY     CUSTNO                   S01401 084981
     C***********          CALL 'AOSECSR0'                         S01401 084981
     C***********          PARM *BLANKS   @RTCD                    S01401 084981
     C***********          PARM '*KEY   ' @OPTN                    S01401 084981
     C***********          PARM CUSTNO    CUST                     S01401 084981
     C***********SDSECS    PARM SDSECS    DSSDY                    S01401 084981
     C***********                                                  S01401 084981
     C***********          END                                            084981
     C***********          ELSE                                    E20237 084981
     C***********          MOVELINF,9     INFMSG                   E20237 084981
     C***********          END                                     E20237 084981
     C***********                                                         084981
     C***NOT*CK3*CK12*HELP*ROLLUP*ROLLDOWN*****************************   S01199
     C***NOT*CK3,*CK12,*ROLLUP,*ROLLDOWN***************************S01199 084981
     C** NOT CK3, CK12, ROLLUP                                            084981
     C*
     C                     ELSE
     C*                                                                   S01117
     C**  Enter taken, check for query selection                          S01117
     C*                                                                   S01117
     C                     MOVE '0'       *IN35                           S01117
     C                     MOVE '0'       *IN37                           S01117
     C                     MOVEA'0000'    *IN,40                          S01117
     C                     MOVEA'0'       *IN,54                          S01117
     C                     EXSR D2QRY                                     S01117
     C           RDSPLY    IFEQ 'N'                                       S01117
      *
      ***  Validate Detail Screen Output
      *
     C                     EXSR VALIDD
     C                     EXSR PSAMT                                     151506
     C                     Z-ADDWPSAT     PSAT                            151506
     C/COPY WNCPYSRC,SE0170C103
     C*                                                                   E14214
     C**  IF WARNING ERRORS ONLY, UPDATE FILES                            E14214
     C*                                                                   E14214
     C           WEC       IFEQ EC                                        E14214
     C           WEC       ANDNE*ZEROS                                    E14214
     C***************      MOVE DETS      SCRDET187                       E17423
     C***********          MOVE DETS      SCRDET172                E17423 S01512
     C**********           MOVE DETS      SCRDET178                                    S01512 CGL029
     C                     MOVE DETS      SCRDET196                                           CGL029
     C/COPY WNCPYSRC,SE0170C017
     C                     WRITEKEYINPUT                                  E14214
     C/COPY WNCPYSRC,SE0170C052
     C**********           WRITERECDETLS                                              E14214 BUG1992
     C                     WRITEMESSAGES                                  E14214
     C                     WRITERECDETLS                                                     BUG1992
     C                     READ RECDETLS                 99               E14214
     C                     EXSR ASCHGS                                    E17423
     C*                                                                   E14214
     C           AID       IFEQ 'RA'                                      E14214
     C           DETS      ANDEQSCRDET                                    E16084
     C                     MOVE *BLANK    SCRDET                          E16084
     C                     MOVEL*BLANK    SCRMSG                          E14214
     C                     ELSE                                           E16084
     C*                                                                   E14214
     C           AID       IFEQ '05'                                      E17423
     C                     MOVEA'1'       *IN,10                          E17423
     C                     ELSE                                           E17423
     C*                                                                   E14214
     C***********AID       IFEQ 'HP'                               E17423 E23955
     C***********          MOVELHERCD     ERRMSG                   E17423 E23955
     C***********ERR,1     IFNE *BLANK                             E17423 E23955
     C***********          MOVELHI        ERRMSG                   E17423 E23955
     C***********          END                                     E17423 E23955
     C***********          CALL 'MHELP'                            E17423 S01199
     C***********          PARM           HBPGM                    E17423 S01199
     C***********          PARM           HERCD                    E17423 S01199
     C***********          ELSE                                    E17423 E23955
     C*                                                                   E14214
     C           AID       IFEQ '01'                                      E17423
     C                     MOVEA'1'       *IN,12                          E17423
     C                     END                                            E17423
     C*                                                                   E14214
     C***********          END                                     E17423 E23955
     C                     END                                            E17423
     C                     GOTO SCRCHG                                    E16084
     C                     END                                            E14214
     C                     END                                            E14214
     C*
     C** N O    D E T A I L   S C R E E N    E R R O R S   -  S T A R T
     C/COPY WNCPYSRC,SE0170C047
     C*
     C           SCRMSG    IFEQ *BLANK
     C           AID       ANDEQ'RA'
     C/COPY WNCPYSRC,SE0170C003
      *                                                                   S01401
      ***  If MT5xx Feature present and either Coupon or Dividend         S01401
      ***  Settlement with a Portfolio Client, call SE1817 for Input      S01401
      ***  of Extended Settlements.                                       S01401
      *                                                                   S01401
     C                     MOVE 'N'       W1817                           S01401
     C                     MOVE '00'      PCMD                            S01401
     C                     MOVE 'N'       PERR                            S01401
      *                                                                   S01401
     C           S01401    IFEQ 'Y'                                       S01401
      *                                                                   S01401
     C           SPEVT     IFEQ 'CP'                                      S01401
     C           SPEVT     OREQ 'DV'                                      S01401
      *                                                                   S01401
     C                     MOVELSPCPY     CUST                            084981
     C                     CALL 'AOSECSR0'                                084981
     C                     PARM *BLANKS   @RTCD                           084981
     C                     PARM '*KEY   ' @OPTN                           084981
     C                     PARM           CUST                            084981
     C           SDSECS    PARM SDSECS    DSSDY                           084981
      *                                                                   084981
     C           BFCLAS    IFEQ 'S'                                       S01401
     C           BFCLAS    OREQ 'D'                                       S01401
      *                                                                   S01401
     C                     MOVELACTN      PACTN                           S01401
     C                     MOVELSPBCA     PPBCA2                          S01401
     C                     MOVELSPSSH     PPSSH2                          S01401
     C**********           MOVELSPCPY     PPCPY2                                     S01401 BUG11688
     C                     MOVELBFCUST    PPCPY2                                            BUG11688
     C                     MOVELSPDUD     PPDUD2                          S01401
     C                     MOVELSPEVT     PPEVT2                          S01401
     C                     MOVELSPBCD     PPBKC2                                              CSE028
     C                     MOVELSPPTFR    PPTFR2                                              CSE028
     C                     MOVELNMCY      PPNCY                                               CSE034
     C                     MOVEL'Y'       W1817   1                       S01401
      *                                                                   S01401
     C/COPY WNCPYSRC,SE0170C104
     C                     CALL 'SE1817'                                  S01401
     C                     PARM           PCMD    2                       S01401
     C                     PARM           PERR    1                       S01401
     C                     PARM           PDATA                           S01401
     C                     PARM           WWRTRN  7                       S01401
     C                     PARM           WWEXRC                                              CSD015
     C/COPY WNCPYSRC,SE0170C105
      *                                                                   S01401
     C                     END                                            S01401
     C                     END                                            S01401
     C                     END                                            S01401
      *                                                                   S01401
      ***  Determine which Screen to return to:                           S01401
      *                                                                   S01401
      ***  If SE1817 has been called, (can only happen if MT5xx Feature   S01401
      ***  is present), selection is as follows:                          S01401
      *                                                                   S01401
      ***  :- F3 - End Program - Return to Midas Menu.                    S01401
      ***  :- F05 & REVW = 'Y'         | *IN11 | REVIEW                   S01401
      ***  :- F05 & REVW NOT = 'Y'     | *IN10 | START                    S01401
      ***  :- F12                      |       | UPDATE (by default)      S01401
      ***  :- ENTER & REVW = 'Y'       | *IN11 | REVIEW                   S01401
      ***  :- ENTER & REVW NOT = 'Y'   | *IN10 | START                    S01401
      *                                                                   S01401
     C                     MOVEL'N'       ENDPGM                          S01401
     C           W1817     IFEQ 'Y'                                       S01401
      *                                                                   S01401
     C                     SELEC                                          S01401
     C           PCMD      WHEQ '03'                                      S01401
     C                     MOVEL'01'      AID                             S01401
     C                     MOVEL'Y'       ENDPGM  1                       S01401
      *                                                                   S01401
     C           PCMD      WHEQ '05'                                      S01401
     C           REVW      ANDEQ'Y'                                       S01401
     C                     MOVEA'1'       *IN,11                          S01401
      *                                                                   S01401
     C           PCMD      WHEQ '05'                                      S01401
     C           REVW      ANDNE'Y'                                       S01401
     C                     MOVEA'1'       *IN,10                          S01401
      *                                                                   S01401
     C           PCMD      WHEQ '12'                                      S01401
      *                                                                   S01401
     C           PCMD      WHEQ '00'                                      S01401
     C           REVW      ANDEQ'Y'                                       S01401
     C***********          MOVELPPAGK     PAGK                     S01401 084981
     C                     MOVEA'1'       *IN,11                          S01401
      *                                                                   S01401
     C           PCMD      WHEQ '00'                                      S01401
     C           REVW      ANDNE'Y'                                       S01401
     C                     MOVEA'1'       *IN,10                          S01401
     C                     ENDSL                                          S01401
      *                                                                   S01401
      ***  Else SE1817 was not called                                     S01401
     C                     ELSE                                           S01401
     C*
     C**FOR REC.ADVANCE DETERMINE WHAT SCREEN TO RETURN TO
     C*
     C           REVW      IFEQ 'Y'
     C***********          MOVELPPAGK     PAGK                            084981
     C                     MOVEA'1'       *IN,11
     C                     ELSE
     C                     MOVEA'1'       *IN,10
     C                     END
      *                                                                   S01401
     C                     ENDIF                                          S01401
     C*
     C**     U  P  D  A  T  E      F  I  L  E  S
     C*
      ***  If the MT5xx Feature is present, If no command Key pressed     S01401
      ***  in SE1817 (if called) and NOT Enquiry, do the Update.          S01401
      ***  Thus, if a Command Key has been pressed in SE1817, the Main    S01401
      ***  Files do not get updated without the Extension Files.          S01401
      *                                                                   S01401
     C           S01401    IFEQ 'Y'                                       S01401
     C           PCMD      IFEQ '00'                                      S01401
     C           ACTN      ANDNE'E'                                       S01401
     C                     EXSR UPDFLS                                    S01401
     C                     ENDIF                                          S01401
     C                     ELSE                                           S01401
      *                                                                   S01401
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0170CCP3                                           S01408
     C*                                                                   S01408
     C           ACTN      IFEQ 'I'
     C           ACTN      OREQ 'A'
     C           ACTN      OREQ 'Y'
     C           ACTN      OREQ 'D'
     C           ACTN      OREQ 'R'                                       S01496
     C           S01496    ANDEQ'Y'                                       S01496
     C           ACTN      OREQ 'R'                                       CSE007
     C           CSE007    ANDEQ'Y'                                       CSE007
     C           ACTN      OREQ 'R'                                       CEU017
     C           CEU017    ANDEQ'Y'                                       CEU017
     C           ACTN      OREQ 'U'                                                         AR324886
     C                     EXSR UPDFLS
     C                     END
     C/COPY WNCPYSRC,SE0170C112
      *                                                                   S01401
     C                     ENDIF                                          S01401
     C*
     C** N O    D E T A I L   S C R E E N    E R R O R S   -  E N D
     C*
     C/COPY WNCPYSRC,SE0170C004
     C                     END
     C                     END                                            S01117
     C*
     C***C*K*3*,*C*K12*,*H*E*L*P*,*R*O*L*L*U*P*/*D*O*W*N***-**E*N:D
     C***C*K*3*,*C*K*12*,*R*O*L*L*U*P*/*D*O*W*N***-**E*N*D*************   084981
     C** C K 3 , C K 12 , R O L L U P  -  E N D                           084981
     C*
     C***********          END                                            084981
     C                     END
     C*********************END                                            S01199
     C                     END
     C                     END
     C*
     C** D O    U N T I L   C H A N G E  O F  S C R E E N  -  E N D
     C*
     C           SCRCHG    TAG                                         GE E16084
     C/COPY WNCPYSRC,SE0170C106
     C                     END
     C*
     C** RESET PROTECT/NON-DISPLAY INDS
     C*
     C                     MOVE *BLANKS   ERRMSG                          E14214
     C                     MOVE *BLANKS   INFMSG                          E14214
     C                     MOVEA'00'      *IN,5
     C/COPY WNCPYSRC,SE0170C043
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT                                                              S01179
     C*****************************************************************   S01179
     C*            ****** AS400 CONVERSION ******                     *   S01179
     C*                                                               *   S01179
     C*  ASCHGS  - S/R TO MOVE THE APPROPRIATE VALUES INTO FIELD AID, *   S01179
     C*            DEPENDING ON WHICH FUNCTION KEY HAS BEEN PRESSED.  *   S01179
     C*  CALLED FROM: UPDATE                                          *   S01179
     C*                                                               *   S01179
     C*****************************************************************   S01179
     C*                                                                   S01179
     C           ASCHGS    BEGSR                                          S01179
     C*                                                                   S01179
     C**  If ENTER pressed, the VLDCMDKEY indicator will be off           S01179
      **  or If F10 and 'REVERSAL'                                        186400
     C*                                                                   S01179
     C           *IN65     IFEQ '0'                                       S01179
     C                     MOVE 'RA'      AID                             S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C**  If F3                                                           S01179
     C*                                                                   S01179
     C           *INKC     IFEQ '1'                                       S01179
     C                     MOVE '01'      AID                             S01179
     C                     MOVE '0'       *INKC                           S01179
     C/COPY WNCPYSRC,SE0170C107
     C                     END                                            S01179
     C*                                                                   S01179
     C**  If F10                                                          S01179
      **  and 'DELETE'                                                    186400
     C*                                                                   S01179
     C           *INKJ     IFEQ '1'                                       S01179
     C           ACTN      ANDEQ'R'                                       186400
     C           *INKJ     OREQ '1'                                       186400
     C           ACTN      ANDEQ'D'                                       186400
     C                     MOVE '04'      AID                             S01179
     C                     MOVE '0'       *INKJ                           S01179
     C                     MOVE '04'      PCMD                            S01401
     C                     END                                            S01179
     C*                                                                   S01179
     C**  If F12                                                          S01179
     C*                                                                   S01179
     C           *INKL     IFEQ '1'                                       S01179
     C                     MOVE '05'      AID                             S01179
     C                     MOVE '0'       *INKL                           S01179
     C                     MOVE ' '       ACTN                            103056
     C/COPY WNCPYSRC,SE0170C108
     C                     END                                            S01179
     C*                                                                   S01179
     C****If*ROLLUP*pressed********************************************                S01179 264059
      **  If ROLLUP pressed and *IN03 is off.                                                 264059
     C*                                                                   S01179
     C           *IN55     IFEQ '1'                                       S01179
     C           *IN03     ANDEQ'0'                                                           264059
     C                     MOVE 'UP'      AID                             S01179
     C                     MOVE '0'       *IN55                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C****IF*ROLLDOWN*pressed*************************************S01179  084981
     C***********                                                 S01179  084981
     C************IN56     IFEQ '1'                               S01179  084981
     C***********          MOVE 'DN'      AID                     S01179  084981
     C***********          MOVE '0'       *IN56                   S01179  084981
     C***********          END                                    S01179  084981
     C***********                                                 S01179  084981
     C**If*HELP*key*pressed************************************** S01179  S01199
     C***********                                                 S01179  S01199
     C************IN57     IFEQ '1'                               S01179  S01199
     C***********          MOVE 'HP'      AID                     S01179  S01199
     C***********          MOVE '0'       *IN57                   S01179  S01199
     C***********          END                                    S01179  S01199
     C*                                                                   S01179
     C                     ENDSR                                          S01179
     C*                                                                   S01179
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  VALIDK  - S/R TO VALIDATE KEY FIELDS                         *
     C*  CALLED FROM: S/R START, REVIEW                               *
     C*  CALLS: ZDATE1                                                *
     C*                                                               *
     C*****************************************************************
     C*
     C           VALIDK    BEGSR                           ** VALIDK BSR**
     C*
     C** RESET ERROR INDICATORS
     C** SET ERROR ARRAY COUNTER TO ZERO
     C*
     C*********************MOVEA'000000'  *IN,21                          S01486
     C                     MOVEA'0000000' *IN,21                          S01486
     C***********          Z-ADD*ZERO     EC      40                      084981
     C***********          MOVE *BLANKS   XSPSXR                          E37165
     C                     MOVE *BLANKS   XSPBRX
     C*
     C** A C T I O N    C O D E    I N P U T - MUST BE BLANK,I,A,E,D
     C*
     C           ACTN      IFEQ 'I'                                       CSE003
      *                                                                   CSE010
      ** Process only if switchable feature CSE010 is off                 CSE010
      * If ? processing available and ? entered                           CSE003
      *                                                                   CSE010
     C           CSE010    IFEQ 'N'                                       CSE010
     C           CSE003    ANDEQ'Y'                                       CSE003
     C           SPSSH     ANDEQ'?'                                       CSE003
     C           *LOCK     IN   SESDS                                     CSE003
     C                     MOVE '6'       RTNC                            CSE003
     C                     MOVE *BLANKS   RQSESN                          CSE003
     C                     OUT  SESDS                                     CSE003
     C                     CALL 'SE0240'                                  CSE003
     C                     IN   SESDS                                     CSE003
     C           RTNC      IFNE '0'                                       CSE003
     C           RTNC      ANDNE'1'                                       CSE003
     C                     MOVE RQSESN    SPSSH                           CSE003
     C                     ENDIF                                          CSE003
     C                     ENDIF                                          CSE003
     C                     ENDIF                                          CSE010
      *                                                                   CSE003
     C           SPSSH     IFNE *BLANKS
     C           ACTN      IFNE 'I'
     C           ACTN      ANDNE'A'
     C           ACTN      ANDNE'D'
     C           ACTN      ANDNE'Y'
     C           ACTN      ANDNE'E'
     C           S01496    ANDNE'Y'                                       S01496
     C           CSE007    ANDNE'Y'                                       CSE007
     C           CEU017    ANDNE'Y'                                       CEU017
     C           ACTN      ANDNE'U'                                                         AR324886
     C*                                                                   S01496
     C           ACTN      ORNE 'I'                                       S01496
     C           ACTN      ANDNE'A'                                       S01496
     C           ACTN      ANDNE'D'                                       S01496
     C           ACTN      ANDNE'Y'                                       S01496
     C           ACTN      ANDNE'E'                                       S01496
     C           ACTN      ANDNE'R'                                       S01496
     C           S01496    ANDEQ'Y'                                       S01496
     C           ACTN      ANDNE'U'                                                         AR324886
     C*                                                                   CSE007
     C           ACTN      ORNE 'I'                                       CSE007
     C           ACTN      ANDNE'A'                                       CSE007
     C           ACTN      ANDNE'D'                                       CSE007
     C           ACTN      ANDNE'Y'                                       CSE007
     C           ACTN      ANDNE'E'                                       CSE007
     C           ACTN      ANDNE'R'                                       CSE007
     C           CSE007    ANDEQ'Y'                                       CSE007
     C           ACTN      ANDNE'U'                                                         AR324886
     C*                                                                   CEU017
     C           ACTN      ORNE 'I'                                       CEU017
     C           ACTN      ANDNE'A'                                       CEU017
     C           ACTN      ANDNE'D'                                       CEU017
     C           ACTN      ANDNE'Y'                                       CEU017
     C           ACTN      ANDNE'E'                                       CEU017
     C           ACTN      ANDNE'R'                                       CEU017
     C           CEU017    ANDEQ'Y'                                       CEU017
     C           ACTN      ANDNE'U'                                                         AR324886
     C*                                                                   084981
     C** Make sure that for subfile, this error will appear only once     084981
     C***********          ADD  1         EC                              084981
     C                     MOVE '1'       *IN21
     C           ' 100'    LOKUPERR                      64               084981
     C           *IN64     IFEQ '0'                                       084981
     C                     ADD  1         EC                              084981
     C                     MOVEL' 100'    ERR,EC
     C                     ENDIF                                          084981
     C                     END
     C                     ELSE
     C           ACTN      IFNE *BLANKS
     C*                                                                   084981
     C** Make sure that for subfile, this error will appear only once     084981
     C***********          ADD  1         EC                              084981
     C                     MOVE '1'       *IN21
     C           ' 100'    LOKUPERR                      64               084981
     C           *IN64     IFEQ '0'                                       084981
     C                     ADD  1         EC                              084981
     C                     MOVEL' 100'    ERR,EC
     C                     ENDIF                                          084981
     C                     END
     C                     END
     C*
     C** A C T I O N    C O D E    V A L I D - CHECK KEY FIELDS
     C*
     C           *IN,21    IFNE '1'
     C*
     C           ACTN      IFNE *BLANK
     C*
     C                     ELSE
     C*
     C** ACTION CODE BLANK BUT KEY INPUT
     C*
     C***********SPBCH     IFNE *BLANK                                    S01117
     C           SPBCA     IFNE *BLANK                                    S01117
     C           SPSSH     ORNE *BLANK
     C           SPCPY     ORNE *BLANK
     C           SPDUD     ORNE *BLANK
     C           SPEVT     ORNE *BLANK
     C           SPPTFR    ORNE *BLANK                     *PTFR INPUT    S01486
     C           BGPFMG    ANDEQ'Y'                                       S01486
     C           SPPTFR    ORNE *BLANK                     *PTFR INPUT    CPB001
     C           BGN4ST    ANDEQ'Y'                                       CPB001
     C           STXBS     ORNE *BLANKS                                   CSE023
     C           CSE023    ANDEQ'Y'                                       CSE023
     C           SBNFO     ORNE *BLANKS                                   CSE023
     C           CSE023    ANDEQ'Y'                                       CSE023
     C           SEXCD     ORNE *BLANKS                                   CSE023
     C           CSE023    ANDEQ'Y'                                       CSE023
     C*
     C** Make sure that for subfile, this error will appear only once     084981
     C           ' 100'    LOKUPERR                      64               084981
     C           *IN64     IFEQ '0'                                       084981
     C                     ADD  1         EC         21
     C                     MOVEL' 100'    ERR,EC
     C                     ENDIF                                          084981
     C*
     C                     END
     C*                                                                   S01496
     C** VALIDATE LIVE/ALL FIELD                                          S01496
     C** Make sure that for subfile, any error will appear only once      084981
     C           S01496    IFEQ 'Y'                                       S01496
     C           CSE007    OREQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0170CP12                                           S01408
     C*                                                                   S01408
     C           REVW      IFEQ 'N'                                       S01496
     C           PPALL     ANDNE'L'                                       S01496
     C           PPALL     ANDNE'A'                                       S01496
     C           ' 998'    LOKUPERR                      64               084981
     C           *IN64     IFEQ '0'                                       084981
     C                     ADD  1         EC                              S01496
     C                     MOVEL' 998'    ERR,EC                          S01496
     C                     ENDIF                                          084981
     C                     MOVE *ON       *IN31                           S01496
     C                     ENDIF                                          S01496
     C                     ENDIF                                          S01496
     C*                                                                   S01496
     C                     END
     C                     END
     C*
     C** A C T I O N    C O D E    I
     C*
     C           ACTN      IFEQ 'I'
     C*
     C**  S E C U R I T Y  S H O R T N A M E
     C*
     C**  Must reference an active security on PF/SECTYD
     C*
     C           SPSSH     CHAINSECTY                99
     C  N99      RECI      COMP '*'                      99
     C           *IN99     IFEQ '1'
     C                     MOVE '1'       *IN23
     C*                                                                   084981
     C           ' 103'    LOKUPERR                      64               084981
     C           *IN64     IFEQ '0'                                       084981
     C                     ADD  1         EC
     C                     MOVEL' 103'    ERR,EC
     C                     ENDIF                                          084981
     C                     ELSE
     C           INVTPK    CHAININVTP                99
     C  N99      RECI      COMP '*'                      99
     C           *IN99     IFEQ '1'
     C                     MOVE '1'       *IN23
     C*                                                                   084981
     C           ' 103'    LOKUPERR                      64               084981
     C           *IN64     IFEQ '0'                                       084981
     C                     ADD  1         EC
     C                     MOVEL' 103'    ERR,EC
     C                     ENDIF                                          084981
     C                     ELSE
     C                     MOVELSPSSH     PSSH
     C                     END
     C                     END
     C*
     C**  If security OK check Event type
     C*
     C           *IN23     IFNE '1'
     C*
     C**  If Event type = 'CP', security on PF/SECTYD must
     C**  be interest bearing
     C** Make sure that for subfile, any error should appear only once    084981
     C*
     C           SPEVT     IFEQ 'CP'
     C           PROT      IFNE '1'
     C           PROT      ANDNE'3'
     C           PROT      ANDNE'5'
     C           PROT      ANDNE'6'
     C           PROT      ANDNE'8'
     C           PROT      ANDNE'9'                                       S01176
     C           STBS      ORNE 'P'
     C           STBS      ANDNE'Y'
     C                     MOVE '1'       *IN23
     C           ' 104'    LOKUPERR                      64               084981
     C           *IN64     IFEQ '0'                                       084981
     C                     ADD  1         EC
     C                     MOVEL' 104'    ERR,EC
     C                     ENDIF                                          084981
     C                     END
     C                     END
     C*
     C**  If Event type = 'DV', processing type must be for shares
     C*
     C           SPEVT     IFEQ 'DV'
     C           PROT      ANDNE'4'
     C           PROT      ANDNE'7'                                       179359
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0170CP13                                           S01408
     C*                                                                   S01408
     C                     MOVE '1'       *IN23
     C           ' 105'    LOKUPERR                      64               084981
     C           *IN64     IFEQ '0'                                       084981
     C                     ADD  1         EC
     C                     MOVEL' 105'    ERR,EC
     C                     ENDIF                                          084981
     C                     END
     C*
     C**  If Event type = 'PP', Partly paid ind must equal 'Y'
     C*
     C           SPEVT     IFEQ 'PP'
     C           PPDI      ANDNE'Y'
     C                     MOVE '1'       *IN23
     C           ' 106'    LOKUPERR                      64               084981
     C           *IN64     IFEQ '0'                                       084981
     C                     ADD  1         EC
     C                     MOVEL' 106'    ERR,EC
     C                     ENDIF                                          084981
     C                     END
     C*
     C**If*Event*type*=*'MT',*security*must*be*a*discount*******          S01496
     C* If Event type = 'MT' or 'RC', security must be a discount         S01496
     C**  or interest security with maturity date not all 9's
     C** Make sure that for subfile, any error should appear only once    084981
     C*
     C           SPEVT     IFEQ 'MT'
     C           SPEVT     OREQ 'RC'                                      S01496
     C           S01496    ANDEQ'Y'                                       S01496
     C           STBS      IFNE 'D'
     C           PROT      IFNE '1'
     C           PROT      ANDNE'3'
     C           PROT      ANDNE'5'
     C           PROT      ANDNE'6'
     C           PROT      ANDNE'8'
     C           PROT      ANDNE'9'                                       S01176
     C           STBS      ORNE 'P'
     C           STBS      ANDNE'Y'
     C           ' 107'    LOKUPERR                      64               084981
     C           *IN64     IFEQ '0'                                       084981
     C                     ADD  1         EC
     C                     MOVEL' 107'    ERR,EC
     C                     ENDIF                                          084981
     C                     ELSE
     C           MATY      IFEQ 99999
     C                     MOVE '1'       *IN23
     C           ' 107'    LOKUPERR                      64               084981
     C           *IN64     IFEQ '0'                                       084981
     C                     ADD  1         EC
     C                     MOVEL' 107'    ERR,EC
     C                     ENDIF                                          084981
     C                     END
     C                     END
     C                     ELSE
     C           MATY      IFEQ 99999
     C                     MOVE '1'       *IN23
     C           ' 107'    LOKUPERR                      64               084981
     C           *IN64     IFEQ '0'                                       084981
     C                     ADD  1         EC
     C                     MOVEL' 107'    ERR,EC
     C                     ENDIF                                          084981
     C                     END
     C                     END
     C                     END
     C                     END
     C*
     C**  C U S T O M E R   N U M B E R / S H O R T N A M E
     C*
     C***********          MOVELSPCPY     WRK6A   6                       S01117
     C***********          MOVE SPCPY     WRK4A   4                 E13952S01117
     C***********                                                         S01117
     C****If*numeric entry read CLINTSE file Else Read SNAME file         S01117
     C***********                                                         S01117
     C***********          TESTN          WRK6A      99                   S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          MOVELWRK6A     WRK6N   60                      S01117
     C***********WRK6N     CHAINCLINTSEF             99                   S01117
     C**N99******RECI      COMP '*'                      99               S01117
     C**N99******WRK4A     COMP *BLANKS              9999           E13952S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          MOVE '1'       *IN24                           S01117
     C***********          ADD  1         EC                              S01117
     C***********          MOVEL' 108'    ERR,EC                          S01117
     C***********          ELSE                                           S01117
     C***********          Z-ADDWRK6N     PCPY                            S01117
     C***********                                                         S01117
     C***********                                                   E17793S01117
     C****Store*Account Code and Account Sequence for defaulting laterE177S01117
     C***********                                                   E17793S01117
     C***********          MOVELC1AC      PC1AC   40                E17793S01117
     C***********          MOVELC1SQ      PC1SQ   20                E17793S01117
     C***********                                                   E17793S01117
     C***********          END                                            S01117
     C***********                                                         S01117
     C****Else*read SNAME file                                            S01117
     C***********                                                         S01117
     C***********          ELSE                                           S01117
     C***********                                                         S01117
     C***********SPCPY     CHAINSNAME                99                   S01117
     C**N99******RECI      COMP '*'                      99               S01117
     C***********                                                         S01117
     C****Error*if record not found here                                  S01117
     C***********                                                         S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          MOVE '1'       *IN24                           S01117
     C***********          ADD  1         EC                              S01117
     C***********          MOVEL' 108'    ERR,EC                          S01117
     C***********                                                         S01117
     C****Else*record found, use Customer number to read CLINTSE          S01117
     C***********                                                         S01117
     C***********          ELSE                                           S01117
     C***********CNUM      CHAINCLINTSEF             99    *              S01117
     C**N99******RECI      COMP '*'                      99*              S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          MOVE '1'       *IN24                           S01117
     C***********          ADD  1         EC                              S01117
     C***********          MOVEL' 108'    ERR,EC                          S01117
     C***********          ELSE                                           S01117
     C***********          Z-ADDCNUM      PCPY                            S01117
     C*                                                                   S01117
     C**  Check for numeric entry, or customer shortname                  S01117
     C*                                                                   S01117
     C                     MOVE '0'       *IN24                           S01117
     C***********          TESTN          SPCPY      85                   S01117              CSD027
     C************IN85     IFEQ '0'                                       S01117              CSD027
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SPCPY     @KEY1  10                       S01117
     C                     PARM *BLANKS   @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C*                                                                   S01117
     C**  Invalid Entry                                                   S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE '1'       *IN24                           S01117
     C                     MOVELSPCPY     CUSTNO                                              CSD027
     C                     ELSE                                           S01117
     C                     MOVELBBCUST    CUSTNO                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C************         ELSE                                           S01117              CSD027
     C************         MOVELSPCPY     CUSTNO                          S01117              CSD027
     C************         END                                            S01117              CSD027
     C*                                                                   S01117
     C**  Check Customer Exists on Securities Customer File               S01117
     C*                                                                   S01117
     C           *IN24     IFEQ '0'                                       S01117
     C                     CALL 'AOSECSR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM CUSTNO    CUST                            S01117
     C           SDSECS    PARM SDSECS    DSSDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE '1'       *IN24                           S01117
     C                     ELSE                                           S01117
     C                     MOVELBFCUST    PCPY                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**  Display error message                                           S01117
     C** For subfiles, this error must appear only once                   084981
     C*                                                                   S01117
     C           *IN24     IFEQ '1'                                       S01117
     C           ' 108'    LOKUPERR                      64               084981
     C           *IN64     IFEQ '0'                                       084981
     C                     ADD  1         EC                              S01117
     C                     MOVEL' 108'    ERR,EC                          S01117
     C                     ENDIF                                          084981
     C                     END                                            S01117
     C*                                                                   E17793
     C**  Store Account Code and Account Sequence for defaulting later    E17793
     C*                                                                   E17793
     C***********          MOVELC1AC      PC1AC                     E17793S01117
     C***********          MOVELC1SQ      PC1SQ                     E17793S01117
     C**********           MOVELBFACCD    PC1AC   40                                  S011117 CGL029
     C                     MOVELBFACCD    PC1AC  100                                          CGL029
     C                     MOVELBFACSN    PC1SQ   20                      S01117
     C*                                                                   S01117
     C**  Display Profit Centre field if Customer Position Settlement     S01117
     C*                                                                   S01117
     C                     MOVE '0'       *IN84                           S01117
     C           BFCLAS    IFNE 'S'                                       S01117
     C           BFCLAS    ANDNE'D'                                       S01117
     C                     MOVE '1'       *IN84                           S01117
     C                     END                                            S01117
     C*                                                                   E17793
     C***********          END                                            S01117
     C***********          END                                            S01117
     C***********          END                                            S01117
     C*
     C**  B R A N C H    C O D E
     C*
     C***********SPBCH     IFNE '   '                                     S01117
     C***********          MOVE *BLANKS   KEY                             S01117
     C***********          MOVEL'10'      TYPE                            S01117
     C***********          MOVE SPBCH     KEY                             S01117
     C***********TABKEY    CHAINTABLETRF             99                   S01117
     C**N99******RECI      COMP '*'                      99               S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          MOVE '1'       *IN22                           S01117
     C***********          ADD  1         EC                              S01117
     C***********          MOVEL' 109'    ERR,EC                          S01117
     C***********          ELSE                                           S01117
     C***********          MOVELSPBCH     PBCH                            S01117
     C***********          END                                            S01117
     C*                                                                   S01117
     C**  If Multibranching Indicator is on, use access object            S01117
     C*                                                                   S01117
     C           *IN81     IFEQ '1'                                       S01117
     C           SPBCA     IFNE *BLANKS                                   S01117
     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SPBCA     @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01117              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01117
     C** Invalid Branch                                                   S01117
     C** For subfile, this error must appear only once                    084981
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE '1'       *IN22                           S01117
     C           ' 109'    LOKUPERR                      64               084981
     C           *IN64     IFEQ '0'                                       084981
     C                     ADD  1         EC                              S01117
     C                     MOVEL' 109'    ERR,EC                          S01117
     C                     ENDIF                                          084981
     C                     ELSE                                           S01117
     C                     MOVELSPBCA     PBCA                            S01117
     C                     END                                            S01117
     C*
     C****ELSE*USE*DEFAULT*FROM*TABTB36********************************   S01117
     C**  Else use default from DTAARA/ZMUSER                             S01117
     C*
     C                     ELSE
     C***********          MOVELDSTB      PBCH                            S01117
     C***********          MOVELDSTB      SPBCH                           S01117
     C                     MOVELUSRBCH    PBCA                            S01117
     C                     MOVELUSRBCH    SPBCA                           S01117
     C                     END
     C*                                                                   S01117
     C**  System not multibranched, use default branch from ZMUSER        S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C                     MOVELUSRBCH    PBCA                            S01117
     C                     END                                            S01117
      *                                                                   CSE023
      ** Validation processing for CSE023 STARTS here.                    CSE023
      **  Do this only if security, customer and event type are ok.       CSE023
      **  Validate tax basket and beneficial customer/owner number if,    CSE023
      **  CSE023 - Withholding tax treaty is installed.                   CSE023
      *                                                                   CSE023
     C           CSE023    IFEQ 'Y'                                       CSE023
     C           *IN23     ANDNE'1'                                       CSE023
     C           *IN24     ANDNE'1'                                       CSE023
      *                                                                   CSE023
      ** Initialize error indicators before validation.                   CSE023
     C                     MOVEA'000'     *IN,57                          CSE023
      *                                                                   CSE023
      ** Retrieve security details for the country of tax treaty.         CSE023
     C           SPSSH     CHAINSECTY                99                   CSE023
      *                                                                   CSE023
     C           CRTT      IFEQ *BLANKS                                   CSE023
      *                                                                   CSE023
      ** Set fields from enhancement to non-display.                      CSE023
      ** No need for tax fields to be available on detail screen input.   CSE023
      ** Do not override previous conditions for the tax fields.          CSE023
     C                     MOVE '0'       *IN20                           CSE023
     C                     MOVEL'N'       WFREEM                          CSE023
      *                                                                   CSE023
     C                     ELSE                                           CSE023
      *                                                                   CSE023
      ** Tax Basket and Beneficial owner not allowed if event type is     CSE023
      ** not 'DV' 'CP' or 'MT'.                                           CSE023
     C           SPEVT     IFNE 'DV'                                      CSE023
     C           SPEVT     ANDNE'CP'                                      CSE023
     C           SPEVT     ANDNE'MT'                                      CSE023
      *                                                                   CSE023
     C           STXBS     IFNE *BLANKS                                   CSE023
     C           SBNFO     ORNE *BLANKS                                   CSE023
      *                                                                   CSE023
      ** Make sure error message appears only once on screen.             CSE023
     C           ' 700'    LOKUPERR                      64               CSE023
     C           *IN64     IFEQ '0'                                       CSE023
     C                     ADD  1         EC                              CSE023
     C                     MOVEL' 700'    ERR,EC                          CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
      ** Highlight fields in error.                                       CSE023
     C           STXBS     IFNE *BLANKS                                   CSE023
     C                     MOVE '1'       *IN58                           CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C           SBNFO     IFNE *BLANKS                                   CSE023
     C                     MOVE '1'       *IN59                           CSE023
     C                     ENDIF                                          CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C                     ELSE                                           CSE023
      *                   *=====*                                         CSE023
      *                                                                   CSE023
      ** Country of tax treaty defined, validate tax basket and           CSE023
      ** beneficial owner.                                                CSE023
      *                                                                   CSE023
      ** Make sure fields from enhancement are displayed on screen.       CSE023
      ** Override availability of tax fields on previous conditions.      CSE023
     C                     MOVE '1'       *IN20                           CSE023
     C                     MOVEL'Y'       WFREEM                          CSE023
      *                                                                   CSE023
      ** Setup key fields.                                                CSE023
     C                     MOVELBFCUST    KYCSNO                          CSE023
     C                     MOVELCRTT      KYCRTT                          CSE023
     C           SBNFO     IFNE *BLANKS                                   CSE023
     C                     MOVELBFCUST    KYBNFO                          CSE023
     C                     MOVE SBNFO     KYBNFO                          CSE023
     C                     ELSE                                           CSE023
     C                     MOVE *BLANKS   KYBNFO                          CSE023
     C                     END                                            CSE023
      *                                                                   CSE023
      ** Perform chaining of necessary data files for validation.         CSE023
     C           BFCLAS    IFEQ 'S'                                       CSE023
     C           BFCLAS    OREQ 'D'                                       CSE023
     C           WTAKEY    CHAINSDWTCSL1             99                   CSE023
     C           *IN99     IFEQ *ON                                       CSE023
     C                     MOVE '1'       *IN24                           CSE023
      *                                                                   CSE023
      ** Make sure error message appears only once on screen.             CSE023
     C********** ' 701'    LOKUPERR                      64                            CSE023 222756
     C           ' W04'    LOKUPERR                      64                                   222756
     C           *IN64     IFEQ '0'                                       CSE023
     C                     ADD  1         WEC                                                 222756
     C                     ADD  1         EC                              CSE023
     C**********           MOVEL' 701'    ERR,EC                                       CSE023 222756
     C                     MOVEL' W04'    ERR,EC                                              222756
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C                     ELSE                                           CSE023
     C                     MOVE WHRPCD    RPCD                            CSE023
     C                     ENDIF                                          CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C           STXBS     IFNE *BLANKS                                   CSE023
     C           WTBKEY    CHAINSDTXBSL1             99                   CSE023
     C           *IN99     IFEQ *ON                                       CSE023
     C                     MOVE '1'       *IN58                           CSE023
      *                                                                   CSE023
      ** Make sure error message appears only once on screen.             CSE023
     C           ' 702'    LOKUPERR                      64               CSE023
     C           *IN64     IFEQ '0'                                       CSE023
     C                     ADD  1         EC                              CSE023
     C                     MOVEL' 702'    ERR,EC                          CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C                     ENDIF                                          CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
      ** Beneficial Customer is optional, but if entered must be a        CSE023
      ** valid record on file.                                            CSE023
     C           SBNFO     IFNE *BLANKS                                   CSE023
     C/COPY WNCPYSRC,SE0170C110
     C           WBOKEY    CHAINSDBNFOL2             99                   CSE023
     C/COPY WNCPYSRC,SE0170C111
     C           *IN99     IFEQ *ON                                       CSE023
     C                     MOVE '1'       *IN59                           CSE023
      *                                                                   CSE023
      ** Make sure error message appears only once on screen.             CSE023
     C           ' 704'    LOKUPERR                      64               CSE023
     C           *IN64     IFEQ '0'                                       CSE023
     C                     ADD  1         EC                              CSE023
     C                     MOVEL' 704'    ERR,EC                          CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C********** SBNFO     IFNE *BLANKS                            CSE023 185811
     C**********           MOVE '1'       *IN59                    CSE023 185811
     C**********           ENDIF                                   CSE023 185811
      *                                                                   CSE023
     C**********           ENDIF                                   CSE023 185811
      *                                                                   CSE023
      ** Beneficial Owner not allowed if Intermediary Status is 'QI'.     CSE023
     C           WHINTS    IFEQ 'QI'                                      CSE023
     C           SBNFO     ANDNE*BLANKS                                   CSE023
      *                                                                   CSE023
     C                     MOVE '1'       *IN59                           CSE023
      *                                                                   CSE023
      ** Make sure error message appears only once on screen.             CSE023
     C           ' 703'    LOKUPERR                      64               CSE023
     C           *IN64     IFEQ '0'                                       CSE023
     C                     ADD  1         EC                              CSE023
     C                     MOVEL' 703'    ERR,EC                          CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
      *                                                                   CSE023
     C           SEXCD     IFNE *BLANKS                                   CSE023
     C           WTEKEY    CHAINSDEXEML1             99                   CSE023
      *                                                                   CSE023
     C           *IN99     IFEQ *ON                                       CSE023
     C                     MOVE '1'       *IN57                           CSE023
      *                                                                   CSE023
      ** Make sure error message appears only once on screen.             CSE023
     C           ' 705'    LOKUPERR                      64               CSE023
     C           *IN64     IFEQ '0'                                       CSE023
     C                     ADD  1         EC                              CSE023
     C                     MOVEL' 705'    ERR,EC                          CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C                     ENDIF                                          CSE023
      *                                                                   185811
      ** Default Tax basket and Exemption Code if no error and for        185811
      ** Insert.                                                          185811
      *                                                                   185811
     C                     MOVE 'Y'       @DPTXB  1                       185811
     C           ACTN      IFEQ 'I'                                       185811
     C           *IN24     ANDNE'1'                                       185811
     C           *IN57     ANDNE'1'                                       185811
     C           *IN58     ANDNE'1'                                       185811
     C           *IN59     ANDNE'1'                                       185811
     C           *IN64     ANDNE'1'                                       185811
     C*                                                                   185811
     C           BFCLAS    IFEQ 'S'                                       185811
     C           BFCLAS    OREQ 'D'                                       185811
     C           STXBS     IFEQ *BLANKS                                   185811
      *                                                                   185811
     C                     CALL 'SETXBDFT'             99                 185811
     C                     PARM BFCUST    @CUST   6                       185811
     C                     PARM SPSSH     @SECT  10                       185811
     C                     PARM SBNFO     @BEN   20                       185811
     C                     PARM SPEVT     @EVNT   2                       185811
     C                     PARM           @BAST   2                       185811
     C                     PARM           @EXCD   2                       185811
     C                     PARM           @RECD   2                       185811
     C                     PARM           @PGMER  1                       185811
      *                                                                   185811
     C           @PGMER    IFEQ 'Y'                                       185811
     C           *IN99     OREQ 'Y'                                       185811
     C           *LOCK     IN   LDA                                       185811
     C                     MOVEL'SETXBDFT'DBFILE           ***************185811
     C                     MOVEL'*PGM'    DBKEY            * DB ERROR 28 *185811
     C                     Z-ADD28        DBASE            ***************185811
     C                     OUT  LDA                                       185811
     C                     MOVE *ON       *INU7                           185811
     C                     MOVE *ON       *INU8                           185811
     C                     MOVE *ON       *INLR                           185811
     C                     EXSR *PSSR                                     185811
     C                     END                                            185811
      *                                                                   185811
      ** If no error, set up default                                      185811
      *                                                                   185811
     C           STXBS     IFEQ *BLANKS                                   185811
     C                     MOVE @BAST     STXBS                           185811
     C                     END                                            185811
      *                                                                   185811
     C           SEXCD     IFEQ *BLANKS                                   185811
     C                     MOVE @EXCD     SEXCD                           185811
     C                     END                                            185811
      *                                                                   185811
     C                     MOVE 'N'       @DPTXB                          185811
      *                                                                   185811
     C                     END                                            185811
     C                     END                                            185811
     C                     END                                            185811
      *                                                                   CSE023
     C                     ENDIF                                          185811
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
      ** Validation processing for CSE023 ENDS here.                      CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C*
     C**  D U E  D A T E
     C** For subfiles, make sure that error codes must appear only once   084981
     C*
     C           SPDUD     IFNE *BLANKS
     C                     MOVE SPDUD     SPDUDN  60
     C                     MOVE SPDUDN    SPDUDA  6
     C           SPDUD     COMP SPDUDA               9999
     C           *IN99     IFNE '1'
     C                     Z-ADDSPDUDN    ZDATE
     C                     EXSR ZDATE1
     C                     END
     C                     ELSE                                           E18193
     C                     MOVE RUND      ZDAYNO                          E18193
     C                     EXSR ZDATE2                                    E18193
     C                     MOVE ZDATE     SPDUD                           E18193
     C                     END
     C           *IN99     IFEQ '1'
     C***********SPDUD     OREQ *BLANKS                                   E18193
     C                     MOVE '1'       *IN25
     C*                                                                   084981
     C           ' 112'    LOKUPERR                      64               084981
     C           *IN64     IFEQ '0'                                       084981
     C                     ADD  1         EC
     C                     MOVEL' 112'    ERR,EC
     C                     ENDIF                                          084981
     C                     ELSE
     C           ZDAYNO    IFGT RUND
     C                     MOVE '1'       *IN25
     C*                                                                   084981
     C           ' 114'    LOKUPERR                      64               084981
     C           *IN64     IFEQ '0'                                       084981
     C                     ADD  1         EC
     C                     MOVEL' 114'    ERR,EC
     C                     ENDIF                                          084981
     C                     ELSE
     C                     Z-ADDZDAYNO    PDUD
     C                     END
     C                     END
     C*
     C           SPEVT     IFNE 'CP'
     C           SPEVT     ANDNE'DV'
     C           SPEVT     ANDNE'PP'
     C           SPEVT     ANDNE'MT'
     C           SPEVT     ANDNE'MP'
     C*                                                                   S01496
     C           SPEVT     IFEQ 'RC'                                      S01496
     C           S01496    ANDEQ'Y'                                       S01496
     C                     MOVELSPEVT     PEVT                            S01496
     C                     ELSE                                           S01496
     C*                                                                   S01496
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C*                                                                   CSE007
     C           SPEVT     CHAINSECOATL0             99                   CSE007
     C           *IN99     IFEQ '0'                                       CSE007
     C                     MOVELSPEVT     PEVT                            CSE007
     C                     ENDIF                                          CSE007
     C*                                                                   CSE007
     C                     ELSE                                           CSE007
     C                     MOVE '0'       *IN99                           CSE007
     C                     ENDIF                                          CSE007
     C*                                                                   CSE007
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           *IN99     ANDEQ'1'                                       CSE007
     C           CSE007    ORNE 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C           *IN99     ANDEQ'1'                                       CEU017
     C           CEU017    ORNE 'Y'                                       CEU017
     C                     MOVE '1'       *IN26
     C           ' 113'    LOKUPERR                      64               084981
     C           *IN64     IFEQ '0'                                       084981
     C                     ADD  1         EC
     C                     MOVEL' 113'    ERR,EC
     C                     ENDIF                                          084981
     C                     ENDIF                                          CSE007
     C                     END                                            S01496
     C*                                                                   S01496
     C                     ELSE
     C                     MOVELSPEVT     PEVT
     C                     END
     C** IF PORTFOLIO MANAGEMENT INSTALLED VALIDATE PORTFOLIO REFERENCE   S01486
     C** OR IF PRIVATE BANKING INSTALLED                                  CPB001
     C*                                                                   S01486
     C           BGPFMG    IFEQ 'Y'                        B1             S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C                     MOVE 'N'       WWEXC   1                       CPB001
     C           BGPFMG    IFEQ 'Y'                        B2             CPB001
     C*                                                                   S01486
     C** MOVE CHAR. FIELD INTO NUMERIC FOR CHAIN TO PMPORTPD              S01486
     C***********          MOVE SPCPY     WWCNUM                          S01486
     C**********           Z-ADDPCPY      WWCNUM                                       S01486 CSD027
     C                     MOVE PCPY      WWCNUM                                              CSD027
     C                     MOVELSPCPY     WPLCS                           S01486
     C*                                                                   S01486
     C**    Check if the customer is a Portfolio Management Customer      S01486
     C*                                                                   S01486
     C                     CALL 'AOPLCSR0'                                S01486
     C                     PARM *BLANKS   PRTCD   7                       S01486
     C                     PARM '*KEY'    POPTN   7                       S01486
     C                     PARM WPLCS     PLCUS  10                       S01486
     C***********          PARM           PKYST   7                       S01486
     C           SDPLCS    PARM SDPLCS    DSFDY                           S01486
     C*                                                                   CPB001
     C           PRTCD     IFEQ *BLANKS                                   CPB001
     C                     MOVE 'Y'       WWEXC                           CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                           E2             CPB001
     C*                                                                   CPB001
     C           BGN4ST    IFEQ 'Y'                        B2             CPB001
     C**********           Z-ADDPCPY      WWCNUM                                       CPB001 CSD027
     C                     MOVE PCPY      WWCNUM                                              CSD027
     C                     MOVELSPCPY     WPLCS                           CPB001
     C                     CALL 'AOCUSTR1'                                CPB001
     C                     PARM *BLANKS   @RTCD                           CPB001
     C                     PARM '*KEY   ' @OPTN                           CPB001
     C                     PARM WPLCS     @KEY1                           CPB001
     C                     PARM *BLANKS   @KYST                           CPB001
     C           SDCUST    PARM SDCUST    DSLDY                           CPB001
     C           @RTCD     IFEQ *BLANKS                                   CPB001
     C           BBPRBA    ANDEQ'Y'                                       CPB001
     C                     MOVE 'Y'       WWEXC                           CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                           E2             CPB001
     C*                                                                   S01486
     C**    If the customer is a Portfolio Management Customer ...        S01486
     C**    Or Private Banking Customer                                   CPB001
     C*                                                                   S01486
     C********** PRTCD     IFEQ *BLANKS                            S01486 CPB001
     C           WWEXC     IFEQ 'Y'                                       CPB001
     C*                                                                   CPB001
     C           SPPTFR    IFEQ *BLANKS                                   CPB001
     C           WWCNUM    SETLLPMPORTPD                                  CPB001
     C           WWCNUM    READEPMPORTPD                 99               CPB001
     C           *IN99     IFEQ *OFF                                      CPB001
     C                     MOVELPNPTFR    SPPTFR                          CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   S01486
     C*     then validate the reference                                   S01486
     C*                                                                   S01486
     C           PORTK     CHAINPMPORTPD             99                   S01486
     C*                                                                   S01486
     C*       If the reference is invalid then check it is not the        S01486
     C*        9997 reference and if not then error this                  S01486
     C*                                                                   S01486
     C           *IN99     IFEQ '1'                        B3             S01486
     C           PNRECI    OREQ '*'                                       S01486
     C           FCR997    IFNE SPPTFR                     B4             S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C                     MOVE '1'       *IN27                           S01486
     C                     ADD  1         EC                              S01486
     C                     MOVEL' 999'    ERR,EC                          S01486
     C                     ELSE                            X4             S01486
     C                     MOVE '9997'    PTFR                            S01486
     C                     END                             E4          P  S01486
     C*                                                                   S01486
     C                     ELSE                            X3             S01486
     C*                                                                   S01486
     C*      otherwise copy the reference into the file field ...         S01486
     C*                                                                   S01486
     C                     MOVE SPPTFR    PTFR                            S01486
     C                     END                             E3          OK S01486
     C                     ELSE                            X2             S01486
     C*                                                                   S01486
     C*  ELSE if NOT Portfolio Management Customer then error any entry   S01486
     C*  Or not Private Banking Customer                                  CPB001
     C*                                                                   S01486
     C           SPPTFR    IFNE *BLANKS                    B2             S01486
     C                     MOVE '1'       *IN27                           S01486
     C                     ADD  1         EC                              S01486
     C                     MOVEL' 999'    ERR,EC                          S01486
     C                     ELSE                            X2             S01486
     C                     MOVE *BLANKS   PTFR                            S01486
     C                     END                             E2             S01486
     C*                                                                   S01486
     C                     END                             E1          1  S01486
     C                     END                                            S01486
     C*
     C** N O   E R R O R  O N  K E Y  F I E L D S
     C*
     C           *IN22     IFNE '1'
     C           *IN23     ANDNE'1'
     C           *IN24     ANDNE'1'
     C           *IN25     ANDNE'1'
     C           *IN26     ANDNE'1'
     C           BGPFMG    ANDNE'Y'                                       S01486
     C*                                                                   S01486
     C           BGPFMG    OREQ 'Y'                                       S01486
     C           *IN22     ANDNE'1'                                       S01486
     C           *IN23     ANDNE'1'                                       S01486
     C           *IN24     ANDNE'1'                                       S01486
     C           *IN25     ANDNE'1'                                       S01486
     C           *IN26     ANDNE'1'                                       S01486
     C           *IN27     ANDNE'1'                                       S01486
     C*                                                                   CPB001
     C           *IN22     ORNE '1'                                       CPB001
     C           *IN23     ANDNE'1'                                       CPB001
     C           *IN24     ANDNE'1'                                       CPB001
     C           *IN25     ANDNE'1'                                       CPB001
     C           *IN26     ANDNE'1'                                       CPB001
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C*                                                                   CPB001
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           *IN22     ANDNE'1'                                       CPB001
     C           *IN23     ANDNE'1'                                       CPB001
     C           *IN24     ANDNE'1'                                       CPB001
     C           *IN25     ANDNE'1'                                       CPB001
     C           *IN26     ANDNE'1'                                       CPB001
     C           *IN27     ANDNE'1'                                       CPB001
     C*                                                                   S01117
     C           ACTN      IFEQ 'I'                                       S01117
     C*                                                                   S01117
     C**  Validate SPF-Action of user                                     S01117
     C** For subfiles, make sure that any error must appear only once     084981
     C*                                                                   S01117
     C**  If Single Branch Environment                                    S01117
     C*                                                                   S01117
     C           MBIN      IFNE 'Y'                                       S01117
     C                     CALL 'ZVACTU'                                  S01117
     C                     PARM ACTN      @ZACTN  1                       S01117
     C                     PARM           @ERR    10                      S01117
     C*                                                                   S01117
     C           @ERR      IFNE *ZERO                                     S01117
     C           ' 302'    LOKUPERR                      64               084981
     C           *IN64     IFEQ '0'                                       084981
     C                     ADD  1         EC                              S01117
     C                     MOVEA' 302'    ERR,EC                          S01117
     C                     ENDIF                                          084981
     C                     MOVE '1'       *IN21                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C**  If Multibranching Environment                                   S01117
     C*                                                                   S01117
     C                     CALL 'ZVACTBU'                                 S01117
     C                     PARM ACTN      @ZACTN  1                       S01117
     C                     PARM SPBCA     @ZBR    3                       S01117
     C                     PARM           @ERR    10                      S01117
     C*                                                                   S01117
     C           @ERR      IFEQ 1                                         S01117
     C           ' 303'    LOKUPERR                      64               084981
     C           *IN64     IFEQ '0'                                       084981
     C                     ADD  1         EC                              S01117
     C                     MOVEA' 303'    ERR,EC                          S01117
     C                     ENDIF                                          084981
     C                     MOVE '1'       *IN21                           S01117
     C                     MOVE '1'       *IN22                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           @ERR      IFEQ 2                                         S01117
     C           ' 304'    LOKUPERR                      64               084981
     C           *IN64     IFEQ '0'                                       084981
     C                     ADD  1         EC                              S01117
     C                     MOVEA' 304'    ERR,EC                          S01117
     C                     ENDIF                                          084981
     C                     MOVE '1'       *IN21                           S01117
     C                     MOVE '1'       *IN22                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**  SPF-Action validated for user                                   S01117
     C*                                                                   S01117
     C           @ERR      IFEQ *ZERO                                     S01117
     C*
     C** RECORD MUST NOT BE AN ACTIVE RECORD ON POSET
     C*
     C           ACTN      IFEQ 'I'
     C                     Z-ADD0         TNL1                                                212767
     C*                                                                   S01486
     C** IF PORTFOLIO MANAGEMENT INSTALLED USE DIFFERENT TO WHEN NOT      S01486
     C*                                                                   S01486
     C           CSE023    IFEQ 'Y'                                       186055
     C           PTXBSK    CHAINPOSETX               99                   186055
     C                     Z-ADDSEQ       RECSEQ                          186055
     C           RECSEQ    DOWGT1                                         186055
     C           *IN99     ANDEQ'0'                                       186055
     C           PTXBSK    READEPOSETX                   99               186055
     C           RECI      IFNE '*'                                       186055
     C                     SUB  1         RECSEQ                          186055
     C                     ENDIF                                          186055
     C                     ENDDO                                          186055
     C                     ELSE                                           186055
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           PTFRK     CHAINPOSETX               99                   S01486
     C******************** Z-ADDSEQ       RECSEQ                   S01486 080743
     C********** RECSEQ    DOWGT1                                  S01486 080743
     C********** *IN99     ANDEQ'0'                                S01486 080743
     C********** PTFRK     READEPOSETX                   99        S01486 080743
     C******************** SUB  1         RECSEQ                   S01486 080743
     C******************** END                                     S01486 080743
     C                     ELSE                                           S01486
     C           POSETK    CHAINPOSETX               99
     C                     Z-ADDSEQ       RECSEQ                          E37157
     C           RECSEQ    DOWGT1                                         E37157
     C           *IN99     ANDEQ'0'                                       E37157
     C           POSETK    READEPOSETX                   99               E37157
     C                     SUB  1         RECSEQ                          E37157
     C                     END                                            S01486
     C                     END                                            E37157
     C                     ENDIF                                          186055
     C**********                                                   185397 186055
     C***If*CSE023*is*present,*then*need*to*check*tax*basket,*Exemp185397 186055
     C***code*and*beneficial*owner*number*as*well.                 185397 186055
     C**********                                                   185397 186055
     C********** CSE023    IFEQ 'Y'                                185397 186055
     C********** *IN99     ANDEQ'0'                                185397 186055
     C********** SBNFO     IFNE *BLANK                             185397 186055
     C**********           MOVE PCPY      @BNFO  26                185397 186055
     C**********           MOVE SBNFO     @BNFO                    185397 186055
     C**********           ELSE                                    185397 186055
     C**********           MOVE *BLANK    @BNFO                    185397 186055
     C**********           END                                     185397 186055
     C********** STXBS     IFNE TXBS                               185397 186055
     C********** SEXCD     ORNE EXCD                               185397 186055
     C********** @BNFO     ORNE BNFO                               185397 186055
     C********** RECI      OREQ '*'                                185397 186055
     C**********           MOVE '1'       *IN99                    185397 186055
     C**********           END                                     185397 186055
     C**********           END                                     185397 186055
     C           *IN99     IFEQ '0'
     C           RECI      IFEQ '*'                        *OVERWRITE
     C                     SETON                     99
     C                     END
     C                     END
     C           *IN99     IFEQ '0'
     C***********SPBCH     OREQ *BLANK                                    S01117
     C           SPBCA     OREQ *BLANK                                    S01117
     C           *IN81     ANDEQ'1'                                       S01117
     C                     MOVE '1'       *IN21
     C*                                                                   084981
     C** Make sure that for subfiles, this error will appear only once    084981
     C           ' 102'    LOKUPERR                      64               084981
     C           *IN64     IFEQ '0'                                       084981
     C                     ADD  1         EC
     C                     MOVEL' 102'    ERR,EC
     C                     ENDIF                                          084981
     C                     END
     C                     END
     C                     END                                            S01117
     C                     END
     C*                                                                   E14881
     C                     ELSE                                           E14881
     C***********                                                   E14881S01117
     C**CUSTOMER*NUMBER/SHORTNAME*ACCESS********************        E14881S01117
     C***********                                                   E14881S01117
     C***********ACTN      IFEQ 'A'                                 E14881S01117
     C***********ACTN      OREQ 'Y'                                 E21493S01117
     C***********          MOVELSPCPY     WRK6A                     E14881S01117
     C***********                                                   E14881S01117
     C**IF*NUMERIC*ENTRY*READ*CLINTSE*FILE*ELSE*READ*SNAME*FILE***  E14881S01117
     C***********                                                   E14881S01117
     C***********          TESTN          WRK6A      99             E14881S01117
     C************IN99     IFEQ '1'                                 E14881S01117
     C***********          MOVELWRK6A     WRK6N                     E14881S01117
     C***********WRK6N     CHAINCLINTSEF             99             E14881S01117
     C***********          ELSE                                     E14881S01117
     C***********SPCPY     CHAINSNAMEF               99             E14881S01117
     C***********CNUM      CHAINCLINTSEF             99             E14881S01117
     C***********          END                                      E14881S01117
     C***********          END                                      E14881S01117
     C*
     C**********           ELSE                                           E14881
     C           ACTN      IFEQ 'A'
     C           ACTN      OREQ 'D'
     C           ACTN      OREQ 'E'
     C           ACTN      OREQ 'Y'
     C*
     C           ACTN      OREQ 'R'                                       S01496
     C           S01496    ANDEQ'Y'                                       S01496
     C           ACTN      OREQ 'R'                                       CSE007
     C           CSE007    ANDEQ'Y'                                       CSE007
     C           ACTN      OREQ 'R'                                       CEU017
     C           CEU017    ANDEQ'Y'                                       CEU017
      *                                                                                     AR324886
     C           ACTN      OREQ 'U'                                                         AR324886
     C*
     C***A*C*T*I*O*N****C*O*D*E****A*,*D*,E*OR*Y*********                 S01496
     C** A C T I O N    C O D E    A , D ,E OR Y OR R                     S01496
     C*
     C***********          MOVELSPBCH     PBCH                            S01117
     C                     MOVELSPBCA     PBCA                            S01117
     C                     MOVELSPSSH     PSSH
     C                     MOVELSPCPY     PCPY
     C                     MOVELSPEVT     PEVT
     C                     Z-ADDSPTNLU    TNL1                            099267
     C                     MOVELSTXBS     TXBS                            186055
     C           SBNFO     IFNE *BLANKS                                   186055
     C                     MOVELSPCPY     BNFO                            186055
     C                     MOVE SBNFO     BNFO                            186055
     C                     ELSE                                           186055
     C                     MOVE *BLANKS   BNFO                            186055
     C                     ENDIF                                          186055
     C                     MOVELSEXCD     EXCD                            186055
     C*                                                                   S01486
     C** IF PORTFOLIO MANAGEMENT INSTALLED                                S01486
     C*                                                                   S01486
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C                     MOVELSPPTFR    PTFR                            S01486
     C                     END                                            S01486
     C*                                                                   S01117
     C**  Validate SPF-Action of user                                     S01117
     C** Make sure that for subfile, any  error will appear only once     084981
     C*                                                                   S01117
     C**  If Single Branch Environment                                    S01117
     C*                                                                   S01117
     C           MBIN      IFNE 'Y'                                       S01117
     C                     CALL 'ZVACTU'                                  S01117
     C                     PARM ACTN      @ZACTN  1                       S01117
     C                     PARM           @ERR    10                      S01117
     C*                                                                   S01117
     C           @ERR      IFNE *ZERO                                     S01117
     C           ' 302'    LOKUPERR                      64               084981
     C           *IN64     IFEQ '0'                                       084981
     C                     ADD  1         EC                              S01117
     C                     MOVEA' 302'    ERR,EC                          S01117
     C                     ENDIF                                          084981
     C                     MOVE '1'       *IN21                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C**  If Multibranching Environment                                   S01117
     C*                                                                   S01117
     C                     CALL 'ZVACTBU'                                 S01117
     C                     PARM ACTN      @ZACTN  1                       S01117
     C                     PARM SPBCA     @ZBR    3                       S01117
     C                     PARM           @ERR    10                      S01117
     C*                                                                   S01117
     C           @ERR      IFEQ 1                                         S01117
     C           ' 303'    LOKUPERR                      64               084981
     C           *IN64     IFEQ '0'                                       084981
     C                     ADD  1         EC                              S01117
     C                     MOVEA' 303'    ERR,EC                          S01117
     C                     ENDIF                                          084981
     C                     MOVE '1'       *IN21                           S01117
     C                     MOVE '1'       *IN22                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           @ERR      IFEQ 2                                         S01117
     C           ' 304'    LOKUPERR                      64               084981
     C           *IN64     IFEQ '0'                                       084981
     C                     ADD  1         EC                              S01117
     C                     MOVEA' 304'    ERR,EC                          S01117
     C                     ENDIF                                          084981
     C                     MOVE '1'       *IN21                           S01117
     C                     MOVE '1'       *IN22                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**  SPF-Action validated for user                                   S01117
     C*                                                                   S01117
     C           @ERR      IFEQ *ZERO                                     S01117
     C*
     C**  D U E  D A T E
     C*
     C           SPDUD     IFNE *BLANKS
     C                     MOVE SPDUD     SPDUDN  60
     C                     MOVE SPDUDN    SPDUDA  6
     C           SPDUD     COMP SPDUDA               9999
     C           *IN99     IFNE '1'
     C                     Z-ADDSPDUDN    ZDATE
     C                     EXSR ZDATE1
     C                     END
     C                     END
     C           *IN99     IFEQ '1'
     C           SPDUD     OREQ *BLANKS
     C                     MOVE '1'       *IN25
     C*                                                                   084981
     C** Make sure that for subfile, this error will appear only once     084981
     C           ' 112'    LOKUPERR                      64               084981
     C           *IN64     IFEQ '0'                                       084981
     C                     ADD  1         EC
     C                     MOVEL' 112'    ERR,EC
     C                     ENDIF                                          084981
     C                     ELSE
     C                     Z-ADDZDAYNO    PDUD
     C                     END                             *IN99=1
     C*
     C** CHECK RECORD EXISTS ON POSET
     C*
     C           *IN25     IFNE '1'
     C***********                                                   E13952S01117
     C****If*alphameric read SNAME file for client number.          E13952S01117
     C***********                                                   E13952S01117
     C***********          MOVELSPCPY     WRK6A   6                 E13952S01117
     C***********          MOVE SPCPY     WRK4A   4                 E13952S01117
     C***********          TESTN          WRK6A      99             E13952S01117
     C**N99******SPCPY     CHAINSNAME                99             E13952S01117
     C**N99******RECI      COMP '*'                      99         E13952S01117
     C**N99******          Z-ADDCNUM      PCPY                      E13952S01117
     C***********                                                   E13952S01117
     C****Error*if client number has too many digits/letters on end.E13952S01117
     C***********                                                   E13952S01117
     C************IN99     IFEQ '1'                                 E13952S01117
     C***********WRK4A     COMP *BLANKS              9999           E13952S01117
     C***********          END                                      E13952S01117
     C*                                                                   E13952
     C*                                                                   S01117
     C**  If Customer Shortname entered, access Customer file for         S01117
     C**  Customer number                                                 S01117
     C*                                                                   S01117
     C                     MOVE '0'       *IN99                           S01117
     C**********           TESTN          SPCPY      85                   S01117              CSD027
     C********** *IN85     IFEQ '0'                                       S01117              CSD027
     C**********           CALL 'AOCUSTR0'                                             S01117 217551
     C                     CALL 'AOCUSTR1'                                                    217551
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SPCPY     @KEY1                           S01117
     C                     PARM *BLANKS   @KYST                           S01117
     C********** SDCUST    PARM SDCUST    DSSDY                                        S01117 217551
     C           SDCUST    PARM SDCUST    DSLDY                                               217551
     C*                                                                   S01117
     C**  Invalid Customer                                                S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C           BBCLST    ANDNE'Y'                                                           217551
     C                     MOVE '1'       *IN99                           S01117
     C                     MOVELSPCPY     CUSTNO                                              CSD027
     C                     ELSE                                           S01117
     C                     MOVELBBCUST    PCPY                            S01117
     C                     MOVELBBCUST    CUSTNO                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**********           ELSE                                           S01117              CSD027
     C**********           MOVELSPCPY     CUSTNO                          S01117              CSD027
     C***********          END                                            S01117              CSD027
     C*                                                                   S01117
     C**  Access Securities Customer file to pick up classification       S01117
     C*                                                                   S01117
     C           *IN99     IFEQ '0'                                       S01117
     C*                                                                   S01117
     C                     CALL 'AOSECSR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM CUSTNO    CUST                            S01117
     C           SDSECS    PARM SDSECS    DSSDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE '1'       *IN99                           S01117
     C                     ELSE                                           E37158
     C                     MOVELBFACCD    PC1AC                           E37158
     C                     MOVELBFACSN    PC1SQ                           E37158
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           *IN99     IFEQ '0'                                       E13952
     C           MBIN      IFEQ 'N'                                       173501
     C           PBCA      ANDEQ*BLANKS                                   173501
     C                     MOVE USRBCH    PBCA                            173501
     C                     END                                            173501
     C           CSE023    IFEQ 'Y'                                       186055
     C********** PTXBSK    CHAINPOSETX               99                              186055 BUG12729
     C           PTXBS7    CHAINPOSETDF6            N99                                     BUG12729
      *                                                                                     AR875922
      ** Skip record if deleted                                                             AR875922
      *                                                                                     AR875922
     C           *IN99     DOWEQ'0'                                                         AR875922
     C           RECI      IFNE '*'                                                         AR875922
     C                     LEAVE                                                            AR875922
     C                     ENDIF                                                            AR875922
     C           PTXBS7    READEPOSETDF6                 99                                 AR875922
     C                     ENDDO                                                            AR875922
      **                                                                                    AR875922
     C                     ELSE                                           186055
     C           POSETK    CHAINPOSETX               99
     C                     ENDIF                                          186055
     C                     Z-ADDSEQ       RECSEQ                          E37157
     C           RECSEQ    DOWGT1                                         E37157
     C           *IN99     ANDEQ'0'                                       E37157
     C           CSE023    ANDNE'Y'                                                           212522
     C           POSETK    READEPOSETX                   99               E37157
     C                     SUB  1         RECSEQ                          E37157
     C                     END                                            E37157
     C           *IN99     IFEQ '0'
     C           RECI      IFEQ '*'
     C           ACTN      ANDNE'E'                                       084981
     C                     SETON                     99
     C                     ELSE                                           E14884
     C*                                                                   E21590
     C           RECI      IFEQ 'M'                                       E14884
     C           ACTN      ANDNE'E'                                       E14884
     C           S01496    ANDNE'Y'                                       S01496
     C           CSE007    ANDNE'Y'                                       CSE007
     C           CEU017    ANDNE'Y'                                       CEU017
     C           ACTN      ANDNE'Y'                                                         AR324886
     C*
     C           RECI      OREQ 'M'                                       S01496
     C           ACTN      ANDNE'E'                                       S01496
     C           ACTN      ANDNE'R'                                       S01496
     C           S01496    ANDEQ'Y'                                       S01496
     C           ACTN      ANDNE'Y'                                                         AR324886
     C*                                                                   CSE007
     C           RECI      OREQ 'M'                                       CSE007
     C           ACTN      ANDNE'E'                                       CSE007
     C           ACTN      ANDNE'R'                                       CSE007
     C           CSE007    ANDEQ'Y'                                       CSE007
     C           ACTN      ANDNE'Y'                                                         AR324886
     C*                                                                   CEU017
     C           RECI      OREQ 'M'                                       CEU017
     C           ACTN      ANDNE'E'                                       CEU017
     C           ACTN      ANDNE'R'                                       CEU017
     C           CEU017    ANDEQ'Y'                                       CEU017
     C           ACTN      ANDNE'Y'                                                         AR324886
      *                                                                                     AR324886
     C********** PSAUTH    CHAINPSAUT                80                            AR324886 AR586601
     C           PSAUTH    CHAINPSAUT               N80                                     AR586601
     C           *IN80     IFEQ *OFF                                                        AR324886
     C           PALCTP    ANDNE'R'                                                         AR324886
     C           ACTN      ANDEQ'Y'                                                         AR324886
     C           ACTN      ORNE 'E'                                                         AR324886
     C           ACTN      ANDNE'R'                                                         AR324886
     C******               SETON                     99            E14884 S01496
     C*                                                                   E21590
     C**  Produce Error 115 for non-Enquiry Action on Actioned record.    E21590
     C*                                                                   E21590
     C                     SETON                     88                   E21590
     C                     MOVE '1'       *IN21                           E21590
     C*                                                                   084981
     C** Make sure that for subfile, this error will appear only once     084981
     C           ' 115'    LOKUPERR                      64               084981
     C           *IN64     IFEQ '0'                                       084981
     C                     ADD  1         EC                              E21590
     C                     MOVEL' 115'    ERR,EC                          E21590
     C                     ENDIF                                          084981
     C                     ENDIF                                                            AR324886
     C                     ELSE                                           S01496
     C           RECI      IFEQ 'R'                                       S01496
     C           ACTN      ANDNE'E'                                       S01496
     C           S01496    ANDEQ'Y'                                       S01496
     C           RECI      OREQ 'R'                                       CSE007
     C           ACTN      ANDNE'E'                                       CSE007
     C           CSE007    ANDEQ'Y'                                       CSE007
     C           RECI      OREQ 'R'                                       CEU017
     C           ACTN      ANDNE'E'                                       CEU017
     C           CEU017    ANDEQ'Y'                                       CEU017
      *                                                                   S01496
      ***  Produce Error 992 for non-Enquiry Action on Reversed record    S01496
     C** Make sure that for subfile, this error will appear only once     084981
     C                     SETON                     88                   S01496
     C                     MOVE '1'       *IN21                           S01496
     C           ' 992'    LOKUPERR                      64               084981
     C           *IN64     IFEQ '0'                                       084981
     C                     ADD  1         EC                              S01496
     C                     MOVEL' 992'    ERR,EC                          S01496
     C                     ENDIF                                          084981
     C                     ELSE                                           S01496
     C           ACTN      IFEQ 'R'                                       S01496
     C           RECI      ANDNE'M'                                       S01496
      *                                                                   S01496
      ***  Produce Error 991 for Reverse Action on non-Actioned record    S01496
     C** Make sure that for subfile, this error will appear only once     084981
     C                     SETON                     88                   S01496
     C                     MOVE '1'       *IN21                           S01496
     C           ' 992'    LOKUPERR                      64               084981
     C           *IN64     IFEQ '0'                                       084981
     C                     ADD  1         EC                              S01496
     C                     MOVEL' 991'    ERR,EC                          S01496
     C                     ENDIF                                          084981
     C                     ELSE                                                             AR324886
     C           ACTN      IFEQ 'U'                                                         AR324886
     C           PAUI      ANDNE'Y'                                                         AR324886
     C                     MOVE *ON       *IN88                                             AR324886
     C                     MOVE *ON       *IN21                                             AR324886
     C           ' 993'    LOKUPERR                      64                                 AR324886
     C           *IN64     IFEQ '0'                                                         AR324886
     C                     ADD  1         EC                                                AR324886
     C                     MOVEL' 993'    ERR,EC                                            AR324886
     C                     ENDIF                                                            AR324886
     C                     ELSE                                                             AR324886
     C           ACTN      IFEQ 'Y'                                                         AR324886
     C           PAUI      ANDNE'Y'                                                         AR324886
     C           ACTN      OREQ 'Y'                                                         AR568653
     C           STAT      ANDEQ'R'                                                         AR568653
     C********** PSAUTH    CHAINPSAUT                80                            AR324886 AR586601
     C           PSAUTH    CHAINPSAUT               N80                                     AR586601
     C           *IN80     IFEQ *OFF                                                        AR324886
     C           USID      ANDEQPALUSR                                                      AR324886
     C                     MOVE *ON       *IN88                                             AR324886
     C                     MOVE *ON       *IN21                                             AR324886
     C           ' 994'    LOKUPERR                      64                                 AR324886
     C           *IN64     IFEQ '0'                                                         AR324886
     C                     ADD  1         EC                                                AR324886
     C                     MOVEL' 994'    ERR,EC                                            AR324886
     C                     ENDIF                                                            AR324886
     C                     ENDIF                                                            AR324886
     C                     ELSE                                                             AR324886
     C           ACTN      IFEQ 'R'                                                         AR324886
     C********** PSAUTH    CHAINPSAUT                80                            AR324886 AR586601
     C           PSAUTH    CHAINPSAUT               N80                                     AR586601
     C           *IN80     IFEQ *OFF                                                        AR324886
     C           PALCTP    ANDEQ'R'                                                         AR324886
     C                     MOVE *ON       *IN88                                             AR324886
     C                     MOVE *ON       *IN21                                             AR324886
     C           ' 995'    LOKUPERR                      64                                 AR324886
     C           *IN64     IFEQ '0'                                                         AR324886
     C                     ADD  1         EC                                                AR324886
     C                     MOVEL' 995'    ERR,EC                                            AR324886
     C                     ENDIF                                                            AR324886
     C                     ENDIF                                                            AR324886
     C                     ENDIF                                                            AR324886
     C                     ENDIF                                                            AR324886
     C                     ENDIF                                                            AR324886
     C                     ENDIF                                          S01496
     C                     ENDIF                                          S01496
     C*                                                                   S01496
     C*                                                                   E21590
     C                     END                                            E14884
     C                     END
     C                     END
     C                     END                                            E13952
     C*                                                                   E21590
     C           *IN99     IFEQ '1'
     C*                                                                   E21590
     C           *IN88     IFEQ '0'                                       E21590
     C                     MOVE '1'       *IN21
     C*                                                                   084981
     C** Make sure that for subfile, this error will appear only once     084981
     C           ' 101'    LOKUPERR                      64               084981
     C           *IN64     IFEQ '0'                                       084981
     C                     ADD  1         EC
     C                     MOVEL' 101'    ERR,EC
     C                     ENDIF                                          084981
     C                     ELSE                                           E21590
     C                     SETOF                     88                   E21590
     C                     END                                            E21590
     C*                                                                   E21590
     C                     ELSE
     C*                                                                   E21590
     C**  READ SECTY TO PICK UP NOMINAL DEC PLACES
     C*                                                                   E21590
     C           SPSSH     CHAINSECTY                99
      *                                                                   CSE023
     C           CSE023    IFEQ 'Y'                                       CSE023
     C           CRTT      ANDNE*BLANKS                                   CSE023
     C                     MOVEL'Y'       WFREEM                          CSE023
     C                     ELSE                                           188588
     C                     MOVEL' '       WFREEM                          188588
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C                     END
     C*
     C** A C T I O N    C O D E    A , D  OR  Y
     C*
     C           ACTN      IFEQ 'A'
     C           ACTN      OREQ 'D'
     C           ACTN      OREQ 'Y'
     C           PAUI      IFEQ 'Y'
     C           STAT      ANDNE'R'                                                         AR324886
     C********** SFRNO     ANDNEXSFRNO                                                      AR324886
     C********** SWARN     ANDEQ'0'                                                  084981 AR324886
     C                     MOVE '1'       *IN21
     C*                                                                   084981
     C** Make sure that for subfile, this error will appear only once     084981
     C********** ' W01'    LOKUPERR                      64                          084981 AR324886
     C           ' 996'    LOKUPERR                      64                                 AR324886
     C           *IN64     IFEQ '0'                                       084981
     C**********           ADD  1         WEC                                        E14214 AR324886
     C                     ADD  1         EC
     C**********           MOVEL' W01'    ERR,EC                                            AR324886
     C                     MOVEL' 996'    ERR,EC                                            AR324886
     C                     ENDIF                                          084981
     C                     MOVE SFRNO     XSFRNO
     C**********           MOVEL'E'       ACTN                                         E20237 247333
     C                     END                             AUTHFL=Y
     C                     END
     C*                                                                   S01117
     C**  Display Profit Centre field if Customer Position Settlement     S01117
     C*                                                                   S01117
     C                     MOVE '0'       *IN84                           S01117
     C           BFCLAS    IFNE 'S'                                       S01117
     C           BFCLAS    ANDNE'D'                                       S01117
     C                     MOVE '1'       *IN84                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END
     C                     END                                            S01117
     C                     END
     C*
     C                     END
     C/COPY WNCPYSRC,SE0170C109
     C***********                                                         084981
     C***ERROR*ON*SCREEN*SO*HIGHLIGHT*ERROR*CODES**********************   084981
     C***********                                                         084981
     C***********EC        IFNE *ZERO                                     084981
     C***********          MOVELHI        ERRMSG                          084981
     C***********          MOVEL*BLANK    AID                             084981
     C***********          END                                            084981
      *                                                                                       CSD015
      ** If compliance watch enhancement is on, check if customers involved are in            CSD015
      ** the watch list.  If so then avoid the authorisation of the transaction.              CSD015
      *                                                                                       CSD015
     C           W1EWLC    IFEQ 'Y'                                                           CSD015
     C           ACTN      ANDEQ'Y'                                                           CSD015
      *                                                                                       CSD015
     C           CSC011    IFEQ 'N'                                                           CSD015
     C           CSC011    OREQ 'Y'                                                           CSD015
     C           S1MAIN    ANDEQLIBR                                                          CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   RSLT   30                                           CSD015
     C                     MOVELPDUD      PDUDA   5                                           CSD015
     C                     MOVELPCPY      PCPYA   6                                           CSD015
      *                                                                                       CSD015
     C           PBCA      CAT  PSSH:0    RSLTMP 13                                           CSD015
     C           RSLTMP    CAT  PCPYA     RSLT                                                CSD015
     C           RSLT      CAT  PDUDA:0   RSLT                                                CSD015
     C           RSLT      CAT  PEVT:0    RSLT   30                                           CSD015
     C                     MOVELRSLT      W4IDEN                                              CSD015
     C                     MOVEL'POSETD'  W4FUNT                                              CSD015
     C                     MOVELPBCA      W4BRCH                                              CSD015
      *                                                                                       CSD015
     C           CMPKEY    CHAINSDCWHTL1             75                                       CSD015
     C           *IN75     IFEQ '0'                                                           CSD015
     C           W3TREL    ANDNE'Y'                                                           CSD015
     C                     MOVE '1'       *IN21                                               CSD015
     C           ' 117'    LOKUPERR                      64                                   CSD015
     C           *IN64     IFEQ '0'                                                           CSD015
     C                     ADD  1         EC                                                  CSD015
     C                     MOVEL' 117'    ERR,EC                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  VALIDD S/R  - TO VALIDATE DETAIL SCREEN                      *
     C*  CALLED FROM: UPDATE S/R                                      *
     C*  CALLS: DEFLTS; ZSEDIT; ZALIGN; ZASIGN; ZXRATE;               *
     C*                                                               *
     C*****************************************************************
     C*
     C           VALIDD    BEGSR
     C*
     C** RESET SCREEN ERROR INDICATORS
     C*
     C**********           MOVE *BLANKS   XPSEA  12                                    CSD015 CGL029
     C                     MOVE *BLANKS   XPSEA  18                                           CGL029
     C                     MOVE *BLANKS   XPCPN   8                                           CSD015
     C                     MOVE *BLANKS   XPFAC   8                                           CSD015
     C                     MOVE *BLANKS   WSTAX   1                                           CER049
     C                     MOVE *BLANKS   WCTAX   1                                           CER049
     C/COPY WNCPYSRC,HUT111_001                                                               HUT111
      *                                                                                       CSD015
     C                     MOVE '0'       *IN29                           S01512
     C                     MOVEA'00000000'*IN,30
     C                     MOVEA'00000000'*IN,38
     C***********          MOVEA'0000000' *IN,46                          E17175
     C                     MOVEA'00000000'*IN,46                          E17175
     C                     MOVEA'0'       *IN,54                          S01117
     C                     MOVEA'000'     *IN,70                          S01447
     C                     MOVE '0'       *IN56                           CAC002
     C                     MOVE *OFF      *IN76                                               233711
     C                     MOVE *OFF      *IN67                                               CER049
     C*
     C** SET ERROR COUNT TO ZERO
     C*
     C                     Z-ADD0         WEC     10                      E14214
     C                     Z-ADD0         EC
     C*
     C** ENTER KEY PRESSSED
     C*
     C           AID       IFEQ 'RA'
     C*
     C** ACTION = I OR A OR Y
     C*
     C           ACTN      IFEQ 'I'
     C           ACTN      OREQ 'A'
     C           ACTN      OREQ 'Y'
     C*
     C** DO DEFAULTS (first time only)
     C*
     C           *IN89     IFEQ '0'
     C                     EXSR DEFLTS
     C                     END
     C***********          MOVELSPNCY     KCCY2                           S01117
     C*
     C**  THE FOLLOWING USE OF ZALIGN, TO CONVERT THE SCREEN NOMINAL      E18102
     C**  FIELD INTO AN AMOUNT DUE, IS NO LONGER NECESSARY.               E18102
     C*                                                                   E18102
     C***********          Z-ADD4         ZADEC                           E18102
     C***********          Z-ADD11        ZADIG                           E18102
     C***********          MOVE *BLANKS   ZFIELD                          E18102
     C***********          MOVELSPNMP     ZFIELD                          E18102
     C***********          EXSR ZALIGN                                    E18102
     C***********          MOVE ZFIELD    PAMD                            E18102
     C***********ZFSIGN    IFEQ '-'                                       E14881
     C***********          Z-SUBPAMD      PAMD                            E14881
     C***********          END                                            E14881
     C                     MOVELSPNCY     PNCY
     C*
     C**  VALIDATION OF FIELDS FOR INSERT/AMEND/Y
     C*
     C***SETUP*NOMINAL*DEC*PLACES*MULT*FACTOR**************************   E18102
     C***********NMDP      ADD  5         NMLT    10                      E18102
     C*
     C**  Fetch Nominal Currency decimal places
     C*
     C***********          MOVE *BLANKS   KEY                             S01117
     C***********          MOVEL'20'      TYPE                            S01117
     C***********          MOVE '1'       KEY                             S01117
     C***********          MOVELSPNCY     KCCY2                           S01117
     C***********TABKEY    CHAINTABTG10F             99                   S01117
     C***********          Z-ADDCDP       NOMCDP  10                      S01117
     C*                                                                   S01117
     C** Bypass the set-up of nominal ccy dec places if S01509 is active  S01509
     C*                                                                   S01509
     C           S01509    IFEQ 'N'                                       S01509
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR'  @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C***********          PARM SPNCY     @AJCD   3                S01117 S01509
     C                     PARM NMCY      @AJCD   3                       S01509
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C                     Z-ADDA6NBDP    NOMCDP  10                      S01117
     C                     MOVE A6NQDP    ZNQDP1                          CAC002
     C                     MOVE A6CYCD    NOMCCY  3                                           233711
     C                     END                                            S01509
     C*                                                                   S01117
     C*
     C**  TRANSLATE AND VALIDATE SPNMP (#NOM) AMOUNT DUE                  E14214
     C**  NEGATIVE NOMINAL IS POSSIBLE - USE ZASIGN INSTEAD OF ZALIGN     E18102
     C**  AND USE NOMINAL DECIMAL PLACES FROM THE SECURITY RECORD.        E18102
     C*                                                            E14214 E18102
     C***********          Z-ADD0         ZADEC                    E14214 E18102
     C***********          Z-ADD15        ZADIG                    E14214 E18102
     C***********          MOVE *BLANKS   ZFIELD                   E14214 E18102
     C***********          MOVELSPNMP     ZFIELD                   E14214 E18102
     C***********          EXSR ZALIGN                             E14214 E18102
     C*
     C                     Z-ADDNMDP      ZSDEC                           E18102
     C           15        SUB  NMDP      ZSDIG                           E18102
     C                     MOVE *BLANKS   ZFLD17                          E18102
     C                     MOVE SPNMP     ZFLD17                          E18102
     C                     EXSR ZASIGN                                    E18102
     C*
     C           *IN99     IFEQ '1'                                       E14214
     C                     ADD  1         EC         53                   E14214
     C                     MOVEL' 204'    ERR,EC                          E14214
     C                     ELSE                                           E14214
     C***********          MOVE ZFIELD    PNMP                     E14214 E18102
     C                     MOVE ZOUT15    PNMP                            E18102
     C*
     C**  SIGN CHECK FOR ZASIGN                                           E18102
     C*
     C           ZFSIGN    IFEQ '-'                                       E14214
     C                     Z-SUBPNMP      PNMP                            E14214
     C                     END                                            E14214
     C                     END                             *IN99=1        E14214
     C*
     C**  TRANSLATE AND VALIDATE SPAMD (#AMNT) AMOUNT DUE
     C** If S01509 is active, process using due currency, else            S01509
     C** use the existing which is the nominal currency                   S01509
     C*
     C           S01509    IFEQ 'N'                                       S01509
     C                     Z-ADDNOMCDP    ZADEC
     C           13        SUB  NOMCDP    ZADIG
     C                     ELSE                                           S01509
     C                     CALL 'AOCURRR0'                                S01509
     C                     PARM '*DBERR'  @RTCD                           S01509
     C                     PARM '*KEY   ' @OPTN                           S01509
     C                     PARM SPNCY     @AJCD   3                       S01509
     C           SDCURR    PARM SDCURR    DSSDY                           S01509
     C                     Z-ADDA6NBDP    POSCDP  10                      S01509
     C                     MOVE A6NQDP    ZNQDP1                          CAC002
     C                     MOVE A6CYCD    POSCCY  3                                           233711
     C*                                                                   S01509
     C                     Z-ADDPOSCDP    ZADEC                           S01509
     C           13        SUB  POSCDP    ZADIG                           S01509
     C                     END                                            S01509
     C*                                                                   S01509
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSPAMD     ZFIELD
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC         50
     C                     MOVEL' 200'    ERR,EC
     C                     ELSE
     C                     MOVE ZFIELD    PAMD
     C***********ZFSIGN    IFEQ '-'                                       E14881
     C***********          Z-SUBPAMD      PAMD                            E14881
     C***********          END                                            E14881
     C                     END                             *IN99=1
     C*                                                                   S01512
     C** If S01512 is active, translate and validate SPSVL : value date   S01512
     C** Check this is a valid date                                       S01512
     C*                                                                   S01512
     C           S01512    IFEQ 'Y'                                       S01512
     C           SPSVL     IFNE *BLANKS                    B2             S01512
     C                     MOVE SPSVL     SPSVLN  60                      S01512
     C                     MOVE SPSVL     SPSVLA  6                       S01512
     C           SPSVL     COMP SPSVLA               9999                 S01512
     C           *IN99     IFNE '1'                        B3             S01512
     C                     Z-ADDSPSVLN    ZDATE                           S01512
     C                     EXSR ZDATE1                                    S01512
     C                     END                             E3             S01512
     C           *IN99     IFNE '1'                        B3             S01512
     C                     EXSR ZDATE2                                    S01512
     C                     MOVE ZDATE     SPSVL                           S01512
     C                     END                             E3             S01512
     C*                                                                   S01512
     C           *IN99     IFEQ '1'                        B3             S01512
     C                     MOVE '1'       *IN29                           S01512
     C                     ADD  1         EC                              S01512
     C                     MOVEL' 502'    ERR,EC                          S01512
     C                     ELSE                            X3             S01512
     C           ZDAYNO    IFLT PDUD                       B4             S01512
     C                     MOVE '1'       *IN29                           S01512
     C                     ADD  1         EC                              S01512
     C                     MOVEL' 502'    ERR,EC                          S01512
     C                     ELSE                            X4             S01512
     C*                                                                   S01512
     C** Warning only errors - check first time through                   S01512
     C** Warn if a holiday in due currency.                               S01512
     C*                                                                   S01512
     C           SPSVL     IFNE XSPSVL                     B5             S01512
     C*                                                                   S01512
     C                     MOVELSPNCY     ZCCY                            S01512
     C                     MOVELBJSLCD    ZLOC                            S01512
     C                     EXSR ZCHKH                                     S01512
     C*                                                                   S01512
     C           ZIND      IFEQ 'H'                                       S01512
     C                     ADD  1         WEC                             S01512
     C                     ADD  1         EC                              S01512
     C                     MOVEL' W08'    ERR,EC                          S01512
     C                     MOVE '1'       *IN29                           S01512
     C                     Z-ADDZDAYNO    PSVL                            S01512
     C                     END                             E6             S01512
     C*                                                                   S01512
     C** Warn if a holiday in settlement currency.                        S01512
     C*                                                                   S01512
     C                     MOVELSPSCU     ZCCY                            S01512
     C                     MOVELBJSLCD    ZLOC                            S01512
     C           ZIND      IFEQ 'H'                                       S01512
     C                     ADD  1         WEC                             S01512
     C                     ADD  1         EC                              S01512
     C                     MOVEL' W09'    ERR,EC                          S01512
     C                     MOVE '1'       *IN29                           S01512
     C                     Z-ADDZDAYNO    PSVL                            S01512
     C                     END                             E6             S01512
     C                     MOVE SPSVL     XSPSVL                          S01512
     C*                                                                   S01512
     C                     END                             E5             S01512
     C*                                                                   S01512
     C                     END                             E4             S01512
     C                     END                             E3             S01512
     C*                                                                   S01512
     C           *IN29     IFEQ '0'                        B3             S01512
     C                     Z-ADDZDAYNO    PSVL                            S01512
     C                     END                             E3             S01512
     C*                                                                   S01512
     C** Otherwise (value date blank) report error                        S01512
     C*                                                                   S01512
     C                     ELSE                            X2             S01512
     C                     MOVE '1'       *IN29                           S01512
     C                     ADD  1         EC                              S01512
     C                     MOVEL' 502'    ERR,EC                          S01512
     C*                                                                   S01512
     C                     END                             E2             S01512
     C                     END                             E2             S01512
     C*
     C**  TRANSLATE AND VALIDATE SPBCD (#ALPV) BOOK CODE
     C*
     C                     MOVELSPBCD     PBCD
     C*
     C           SPBCD     IFNE *BLANK
     C***********SPBCD     CHAINBOOKD                99                   S01117
     C**N99******RECI      COMP '*'                      99*              S01117
     C************IN99     IFEQ '1'                                       S01117
     C************         ADD  1         EC         35                   S01117
     C************         MOVEL' 201'    ERR,EC                          S01117
     C************         END                             *IN99=1        S01117
     C*                                                                   S01117
     C                     CALL 'AOBOOKR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SPBCD     @BKCD   2                       S01117
     C           SDBOOK    PARM SDBOOK    DSFDY                           S01117
     C*                                                                   S01117
     C** Invalid Book                                                     S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     ADD  1         EC         35                   S01117
     C                     MOVEL' 201'    ERR,EC                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ELSE                                           E14717
     C*                                                                   S01117
     C***********SPCPY     CHAINSNAMEF               99             E14717S01117
     C************IN99     IFEQ '0'                                 E14717S01117
     C***********          Z-ADDCNUM      WRK6N                     E14717S01117
     C***********          ELSE                                     E14717S01117
     C***********          MOVELSPCPY     WRK6N                     E14717S01117
     C***********          END                                      E14717S01117
     C***********WRK6N     CHAINCLINTSEF             99             E14717S01117
     C**N99******RECI      COMP '*'                      99         E14717S01117
     C************IN99     IFEQ '0'                                 E14717S01117
     C***********C1DI      IFEQ 'S'                                 E14717S01117
     C***********C1DI      OREQ 'D'                                 E14717S01117
     C***********          MOVE DPFB      PBCD                      E14717S01117
     C***********          ELSE                                     E14717S01117
     C***********          MOVE DMKB      PBCD                      E14717S01117
     C***********          END                                      E14717S01117
     C***********          END                                      E14717S01117
     C*                                                                   S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM '*DBERR'  @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SPCPY     @KEY1                           S01117
     C                     PARM *BLANKS   @KYST                           S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C*                                                                   S01117
     C                     MOVELBBCUST    CUSTNO                          S01117
     C*                                                                   S01117
     C**  Check Customer Exists on Securities Customer File               S01117
     C*                                                                   S01117
     C                     CALL 'AOSECSR0'                                S01117
     C                     PARM '*DBERR'  @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM CUSTNO    CUST                            S01117
     C           SDSECS    PARM SDSECS    DSSDY                           S01117
     C*                                                                   S01117
     C           BFCLAS    IFEQ 'S'                                       S01117
     C           BFCLAS    OREQ 'D'                                       S01117
     C                     MOVE BVDPBC    PBCD                            S01117
     C                     ELSE                                           S01117
     C                     MOVE BVDMBC    PBCD                            S01117
     C                     END                                            S01117
     C                     END                             *SPBCD         S01117
     C*                                                                   S01117
     C**  TRANSLATE AND VALIDATE SPPFC (#ALPV) PROFIT CENTRE              S01117
     C*                                                                   S01117
     C           *IN82     IFEQ '1'                                       S01117
     C           *IN84     ANDNE'1'                                       S01117
     C*                                                                   CAC002
     C**   If Analytical Accounting is installed, profit centre           CAC002
     C**   is mandatory for Portfolio Customer.                           CAC002
     C*                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C           SPPFC     ANDEQ*BLANKS                                   CAC002
     C                     ADD  1         EC         54                   CAC002
     C                     MOVEL' 333'    ERR,EC                          CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C                     MOVELSPPFC     PPFC                            S01117
     C           *IN83     IFEQ '1'                                       S01117
     C*                                                                   S01117
     C           SPPFC     IFNE *BLANK                                    S01117
     C                     CALL 'AOPRFCR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SPPFC     @PCCD   4                       S01117
     C           SDPRFC    PARM SDPRFC    DSFDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     ADD  1         EC         54                   S01117
     C                     MOVEL' 240'    ERR,EC                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   CAC002
     C**  If Analytical Accounting is installed, default SE               CAC002
     C**  ICD profit centre for non-portfolio customer.                   CAC002
     C*                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C           *IN84     ANDEQ'1'                                       CAC002
     C                     MOVELBVSEPC    PPFC                            CAC002
     C                     ENDIF                                          CAC002
     C*
     C**  TRANSLATE AND VALIDATE SPPRE (#ALPV) PAY/RECEIVE CODE
     C*
     C                     MOVELSPPRE     PPRE
     C                     MOVELSPPRE     PPPRE                           CSW003
     C*
     C           SPPRE     IFNE 'P'
     C           SPPRE     ANDNE'R'
     C                     ADD  1         EC         36
     C                     MOVEL' 225'    ERR,EC
     C                     END                             *SPPRE
     C*
     C**  TRANSLATE AND VALIDATE SPSCU (#ALPV) SETTLEMENT CCY
     C*
     C           SPSCU     IFEQ *BLANKS                                                       214835
     C                     MOVE XSPSCU    SPSCU                                               214835
     C                     END                                                                214835
     C                     MOVELSPSCU     PSCU
     C*
     C           SPSCU     IFNE *BLANK
     C***********          MOVE *BLANKS   KEY                             S01117
     C***********          MOVEL'20'      TYPE                            S01117
     C***********          MOVE '1'       KEY                             S01117
     C***********          MOVELSPSCU     KCCY2                           S01117
     C***********TABKEY    CHAINTABTG10F             99                   S01117
     C**N99******RECI      COMP '*'                      99               S01117
     C************IN99     IFEQ '0'                                       S01117
     C***********DCCY      ANDNE'Y'                                       S01117
     C***********          SETON                     99                   S01117
     C***********          END                                            S01117
     C************IN99     IFEQ '1'                                       S01117
     C*                                                                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SPSCU     @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C           A6DLCI    ORNE 'Y'                                       S01117
     C                     ADD  1         EC         37
     C                     MOVEL' 202'    ERR,EC
     C                     ELSE                                           151506
     C                     Z-ADDA6NBDP    SETCDP  10                      151506
     C                     MOVE A6NQDP    ZNQDP2                          151506
     C                     MOVELA6INCY    WSINCY  1                       151506
     C                     Z-ADDA6TPSD    WSTPSD  50                      151506
     C                     Z-ADDA6EUER    WSEUER 138                      151506
     C                     MOVELA6EUMD    WSEUMD  1                       151506
     C                     MOVE ' '       W2SCR                           151506
     C           SPSCU     IFNE XSPSCU                                    151506
     C           SPSXR     ORNE WXRATP                                                        197896
     C                     MOVE 'Y'       W2SCR                           151506
     C                     MOVE A6SPRT    ZFLD15                          151506
     C                     Z-ADD8         ZDECS                           151506
     C                     MOVE ' '       ZECODE                          151506
     C                     EXSR ZSEDIT                                    151506
     C                     MOVEL*BLANKS   SPBRX                           151506
     C                     MOVE ZOUT21    SPBRX                           151506
     C           PNCY      IFEQ SPSCU                                     151506
     C                     Z-ADD100000000 ZFLD15                          151506
     C                     MOVE 'M'       SPMDI                           151506
     C                     ELSE                                           151506
     C                     Z-ADDA6SPRT    ZRATE2 138                      151506
     C                     MOVE A6MDIN    ZMDI2   1                       151506
     C*                                                                   151506
     C* Get position currency spot rate                                   151506
     C*                                                                   151506
     C                     CALL 'AOCURRR0'                                151506
     C                     PARM '*DBERR'  @RTCD   7                       151506
     C                     PARM '*KEY   ' @OPTN   7                       151506
     C                     PARM PNCY      @AJCD   3                       151506
     C           SDCURR    PARM SDCURR    DSSDY                           151506
     C*                                                                   151506
     C                     Z-ADDA6SPRT    ZRATE1 138                      151506
     C                     MOVE A6MDIN    ZMDI1   1                       151506
     C                     EXSR ZXRATE                                    151506
     C*                                                                   151506
      ** Use default rate if the Exchange Rate has not been overwritten                       197896
      *                                                                                       197896
     C           SPSXR     IFNE *BLANKS                                                       197896
     C           SPSXR     ANDNEWXRATP                                                        197896
     C                     Z-ADD8         ZADEC                                               197896
     C                     Z-ADD5         ZADIG                                               197896
     C                     MOVE *BLANKS   ZFIELD                                              197896
     C                     MOVELSPSXR     ZFIELD                                              197896
     C                     EXSR ZALIGN                                                        197896
     C                     MOVE ZFIELD    ZFLD15                                              197896
     C                     ELSE                                                               197896
     C           SPSCU     IFEQ BKEURO                                    151506
     C           A6INCY    ANDEQ'Y'                                       151506
     C           RUND      ANDGEA6TPSD                                    151506
     C                     MOVE A6EUER    ZFLD15                          151506
     C                     MOVELA6EUMD    ZMDIX                           151506
     C                     ELSE                                           151506
     C           PNCY      IFEQ BKEURO                                    151506
     C           WSINCY    ANDEQ'Y'                                       151506
     C           RUND      ANDGEWSTPSD                                    151506
     C                     MOVE WSEUER    ZFLD15                          151506
     C           WSEUMD    IFEQ 'D'                                       151506
     C                     MOVEL'M'       ZMDIX                           151506
     C                     ELSE                                           151506
     C                     MOVEL'D'       ZMDIX                           151506
     C                     ENDIF                                          151506
     C                     ELSE                                           151506
     C                     MOVE ZRATEX    ZFLD15                          151506
     C                     ENDIF                                          151506
     C                     ENDIF                                          151506
     C                     ENDIF                                                              197896
      *                                                                                       197896
     C                     MOVE ZMDIX     SPMDI                           151506
     C                     MOVE SPMDI     PMDI                            151506
     C                     ENDIF                                          151506
     C*                                                                   151506
     C                     Z-ADD8         ZDECS                           151506
     C                     MOVE ' '       ZECODE                          151506
     C                     EXSR ZSEDIT                                    151506
     C                     MOVEL*BLANKS   SPSXR                           151506
     C                     MOVE ZOUT21    SPSXR                           151506
     C                     Z-ADD8         ZADEC                           151506
     C                     Z-ADD5         ZADIG                           151506
     C                     MOVE *BLANKS   ZFIELD                          151506
     C                     MOVELSPSXR     ZFIELD                          151506
     C                     EXSR ZALIGN                                    151506
     C                     MOVE ZFIELD    PSXR                            151506
     C*                                                                   151506
     C** Set up parameter for call to SEZ010                              151506
     C*                                                                   151506
     C                     MOVELBFCLAS    P@CLAS                          151506
     C                     MOVELSPPRE     P@PPRE                          151506
     C                     Z-ADDPAMD      P@PAMD                          151506
     C                     Z-ADDPCHA      P@PCHA                          151506
     C                     Z-ADDPCAM      P@PCAM                          151506
     C                     Z-ADDTASO      P@TASO                          151506
     C                     Z-ADDTAUS      P@TAUS                          151506
     C                     Z-ADDPSXR      P@PSXR                          151506
     C                     MOVELPMDI      P@PMDI                          151506
     C                     MOVELSPNCY     P@PNCY                          151506
     C                     MOVELSPSCU     P@PSCU                          151506
     C                     MOVELWTAXA     P@STAM                                            AR851833
      *                                                                                       233711
     C********** *IN75     IFEQ *ON                                                    233711 234471
     C           *IN78     IFEQ *ON                                                           234471
     C                     ADD  TXNM      P@TASO                                              233711
     C                     ENDIF                                                              233711
     C** Call SEZ010 to calculate the settlement amount                   151506
     C*                                                                   151506
     C                     CALL 'SEZ010'                                  151506
     C                     PARM *BLANKS   P@RCDE  7                       151506
     C                     PARM           P@DATA                          151506
     C           P@RCDE    IFEQ *BLANKS                                   151506
     C                     Z-ADDP@PSAT    PSAT                            151506
     C                     ELSE                                           151506
     C                     EXSR *PSSR                                     151506
     C                     ENDIF                                          151506
     C*                                                                   151506
     C                     Z-ADDSETCDP    ZDECS                           151506
     C                     MOVE P@PSAT    ZFLD15                          151506
     C                     MOVE ' '       ZECODE                          151506
     C                     EXSR ZSEDIT                                    151506
     C                     MOVEL*BLANKS   SPSAT                           151506
     C                     MOVE ZOUT21    SPSAT                           151506
     C                     MOVELSPSCU     XSPSCU  3                       151506
     C                     ENDIF                                          151506
     C                     END
     C                     END
     C*                                                                   055839
     C** Store settle CCY D.P for later validation.                       055839
     C*                                                                   055839
     C***********          Z-ADDA6NBDP    SETCDP  10                055839151506
     C***********          MOVE A6NQDP    ZNQDP2                    CAC002151506
     C*
     C**  TRANSLATE AND VALIDATE SPMDI (#AMNT) M/D INDICATOR
     C*
     C           SPMDI     IFNE 'M'
     C           SPMDI     ANDNE'D'
     C                     ADD  1         EC         51
     C**********           MOVEL' W05'    ERR,EC                          S01158
     C                     MOVEL' 203'    ERR,EC                          S01158
     C                     ELSE
     C                     MOVELSPMDI     PMDI
     C                     END
     C*
     C**  TRANSLATE AND VALIDATE SPSXR (#AMNT) EXCHANGE RATE
     C*
     C           SPSXR     IFEQ *BLANKS                                   E18884
     C                     ADD  1         EC                              E18884
     C                     SETON                     34                   E18884
     C                     MOVEL' 227'    ERR,EC                          E18884
     C*                                                                   E18884
     C                     ELSE                                           E18884
     C*                                                                   E18884
     C**********           Z-ADD8         ZSDEC      REPLACED BY ZALIGN   E18884
     C**********           Z-ADD5         ZSDIG                           E18884
     C**********           MOVE *BLANKS   ZFLD17                          E18884
     C**********           MOVELSPSXR     ZFLD17                          E18884
     C**********           EXSR ZASIGN                                    E18884
     C*                                                                   E18884
     C                     Z-ADD8         ZADEC                           E18884
     C                     Z-ADD5         ZADIG                           E18884
     C                     MOVE *BLANKS   ZFIELD                          E18884
     C                     MOVELSPSXR     ZFIELD                          E18884
     C                     EXSR ZALIGN                                    E18884
     C           *IN99     IFEQ '1'
     C**********           ADD  1         EC         52                   E18884
     C                     ADD  1         EC                              E18884
     C**********           ADD  1         WEC                      E14214 E18884
     C                     SETON                     34                   E18884
     C**********           MOVEL' W05'    ERR,EC    *INAPPROPIATE MSG     E18884
     C                     MOVEL' 227'    ERR,EC                          E18884
     C                     ELSE
     C**********           MOVE ZOUT15    PSXR                            E18884
     C                     MOVE ZFIELD    PSXR                            E18884
     C********** ZFSIGN    IFEQ '-'                                       E18884
     C**********           Z-SUBPSXR      PSXR                            E18884
     C**********           END                                            E18884
     C*
     C**  .. must be within 10% of Nominal settlement cross rate
     C**  WARNING ERROR ONLY - CHECK FIRST TIME THROUGH *******
     C*
     C***********SPSXR     IFNE XSPSXR                                    E37165
     C***********          MOVE *BLANKS   KEY                             S01117
     C***********          MOVEL'20'      TYPE                            S01117
     C***********          MOVE '1'       KEY                             S01117
     C***********          MOVELSPSCU     KCCY2                           S01117
     C***********TABKEY    CHAINTABTG10F             99                   S01117
     C***********          Z-ADDSPOT      ZRATE1 138                      S01117
     C***********MDIN      IFEQ 0                                         S01117
     C*                                                                   S01117
     C           SPSCU     IFEQ *BLANKS                                                       214835
     C                     MOVE XSPSCU    SPSCU                                               214835
     C                     END                                                                214835
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SPSCU     @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C                     MOVELA6EUMD    WSEUMD                          151506
     C                     MOVELA6INCY    WSINCY                          151506
     C                     Z-ADDA6TPSD    WSTPSD                          151506
     C                     Z-ADDA6EUER    WSEUER                          151506
     C*                                                                   S01117
     C***********          Z-ADDA6SPRT    ZRATE1 138               S01117 063994
     C                     Z-ADDA6SPRT    ZRATE2 138                      063994
     C***********A6MDIN    IFEQ *BLANKS                             S01117E37205
     C***********          MOVEL'D'       ZMDI1   1                       E37205
     C***********          ELSE                                           E37205
     C***********          MOVEL'M'       ZMDI1   1                       E37205
     C***********          END                                            E37205
     C***********          MOVELA6MDIN    ZMDI1   1                E37205 063994
     C                     MOVELA6MDIN    ZMDI2   1                       063994
     C***********          MOVELSPNCY     KCCY2                           S01117
     C***********TABKEY    CHAINTABTG10F             99                   S01117
     C***********          Z-ADDSPOT      ZRATE2 138                      S01117
     C***********MDIN      IFEQ 0                                         S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR'  @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SPNCY     @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C*                                                                   S01117
     C***********          Z-ADDA6SPRT    ZRATE2 138               S01117 063994
     C                     Z-ADDA6SPRT    ZRATE1 138                      063994
     C***********A6MDIN    IFEQ *BLANKS                             S01117E37205
     C***********          MOVEL'D'       ZMDI2   1                       E37205
     C***********          ELSE                                           E37205
     C***********          MOVEL'M'       ZMDI2   1                       E37205
     C***********          END                                            E37205
     C***********          MOVELA6MDIN    ZMDI2   1                E37205 063994
     C                     MOVELA6MDIN    ZMDI1   1                       063994
     C                     EXSR ZXRATE
     C           SPSCU     IFEQ BKEURO                                    151506
     C           A6INCY    ANDEQ'Y'                                       151506
     C           RUND      ANDGEA6TPSD                                    151506
     C                     MOVE A6EUER    ZRATEX                          151506
     C                     MOVELA6EUMD    ZMDIX                           151506
     C                     ELSE                                           151506
     C           PNCY      IFEQ BKEURO                                    151506
     C           WSINCY    ANDEQ'Y'                                       151506
     C           RUND      ANDGEWSTPSD                                    151506
     C                     MOVE WSEUER    ZRATEX                          151506
     C           WSEUMD    IFEQ 'D'                                       151506
     C                     MOVEL'M'       ZMDIX                           151506
     C                     ELSE                                           151506
     C                     MOVEL'D'       ZMDIX                           151506
     C                     ENDIF                                          151506
     C                     ENDIF                                          151506
     C                     ENDIF                                          151506
     C           ZRATEX    DIV  10        ZZWRK1 138H
     C           ZRATEX    ADD  ZZWRK1    ZZWRK2 138
     C           PSXR      IFGT ZZWRK2
     C           ZMDIX     ORNE SPMDI
     C           PSXR      ANDNE1                                         E37165
     C                     ADD  1         EC
     C                     ADD  1         WEC                             E14214
     C                     MOVEL' W05'    ERR,EC
     C                     SETON                     5251
     C                     ELSE
     C*
     C           ZRATEX    SUB  ZZWRK1    ZZWRK2
     C           PSXR      IFLT ZZWRK2
     C           ZMDIX     ORNE SPMDI
     C           PSXR      ANDNE1                                         E37165
     C                     ADD  1         EC
     C                     ADD  1         WEC                             E14214
     C                     MOVEL' W05'    ERR,EC
     C                     SETON                     5251
     C                     END
     C                     END
     C***********          MOVE SPSXR     XSPSXR                          E37165
     C***********          END                                            E37165
     C                     END                             *IN99=1
     C                     END                             *PSXR BLANK    E18884
      *                                                                   CAC002
     C           ACTN      IFEQ 'I'                                       CAC002
     C                     Z-ADD0         FXMP                            CAC002
     C                     Z-ADD0         FXMR                            CAC002
     C                     Z-ADD0         MAMT                            CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
      **  Validate Margin Points if entered and if analytical acctg.      CAC002
      **  is installed                                                    CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C           SFXMP     ANDNE*BLANKS                                   CAC002
      *                                                                   CAC002
      **  Allow entry of Margin Points if nominal and settlement          CAC002
      **  currencies are not the same                                     CAC002
      *                                                                   CAC002
     C           NMCY      IFNE SPSCU                                     CAC002
      *                                                                   CAC002
      **  Validate Margin Points entered                                  CAC002
      *                                                                   CAC002
     C                     MOVE *BLANKS   ZFIELD                          CAC002
     C                     MOVELSFXMP     ZFIELD                          CAC002
     C                     Z-ADD5         ZADIG                           CAC002
     C                     Z-ADD2         ZADEC                           CAC002
     C                     EXSR ZALIGN                                    CAC002
     C                     MOVE ZFIELD    FXMP    72                      CAC002
     C           *IN99     IFEQ '1'                                       CAC002
     C                     ADD  1         EC                              CAC002
     C                     MOVEL' 601'    ERR,EC                          CAC002
     C                     MOVE '1'       *IN56                           CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
      **  If valid FX Margin Points, check if equivalent exchange rate    CAC002
      **  is within the defined tolerance                                 CAC002
      *                                                                   CAC002
     C           *IN56     IFEQ *OFF                                      CAC002
      *                                                                   CAC002
      **  Get Tolerance for FX Margin                                     CAC002
      *                                                                   CAC002
      **  Get Normally-quoted Decimal Places                              CAC002
      *                                                                   CAC002
     C                     EXSR SRNQDP                                    CAC002
     C           ZNQDPX    ADD  1         ZA      10                      CAC002
      *                                                                   CAC002
      **  Compute the maximum margin points allowed:                      CAC002
      **  Exchg. rate * Tolerance * 10**normally quoted d.p.              CAC002
      *                                                                   CAC002
     C           FTTMRT    DIV  100       W1      32                      CAC002
     C           PSXR      MULT W1        W2     138H                     CAC002
     C           W2        MULT AP,ZA     WMAXPT  72H                     CAC002
      *                                                                   CAC002
      **  If Margin Points is greater than the maximum allowed, display   CAC002
      **  warning error code                                              CAC002
      *                                                                   CAC002
     C           FXMP      IFGT WMAXPT                                    CAC002
     C                     ADD  1         WEC                             CAC002
     C                     ADD  1         EC                              CAC002
     C                     MOVEL' W10'    ERR,EC                          CAC002
     C                     MOVE '1'       *IN56                           CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
      **  Calculate margin rate and new exchange rate                     CAC002
      *                                                                   CAC002
     C           FXMP      DIV  AP,ZA     FXMR      H                     CAC002
      *                                                                   CAC002
     C           SPPRE     IFEQ 'R'                                       CAC002
     C           SPMDI     ANDEQ'M'                                       CAC002
     C           SPPRE     OREQ 'P'                                       CAC002
     C           SPMDI     ANDEQ'D'                                       CAC002
     C                     ADD  FXMR      PSXR                            CAC002
     C                     ELSE                                           CAC002
     C                     SUB  FXMR      PSXR                            CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
     C                     ELSE                                           CAC002
     C           FXMP      IFNE 0                                         120815
      *                                                                   CAC002
      **  Error if nominal and settlement currencies are the same         CAC002
      *                                                                   CAC002
     C                     ADD  1         EC                              CAC002
     C                     MOVEL' 602'    ERR,EC                          CAC002
     C                     MOVE '1'       *IN56                           CAC002
     C                     ENDIF                                          120815
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
     C*
     C* TRANSLATE AND VALIDATE SPBRX (#AMNT) BASE CURRENCY RATE
     C*
     C                     Z-ADD8         ZSDEC
     C                     Z-ADD5         ZSDIG
     C*
     C                     MOVE *BLANKS   ZFLD17
     C                     MOVELSPBRX     ZFLD17
     C                     EXSR ZASIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         WEC                             E14214
     C                     ADD  1         EC         38
     C                     MOVEL' W06'    ERR,EC
     C                     ELSE
     C                     MOVE ZOUT15    PBRX
     C           ZFSIGN    IFEQ '-'
     C                     Z-SUBPBRX      PBRX
     C                     END
     C*
     C*    .. must be within 10% of SPOT RATE
     C**** WARNING ERROR ONLY - CHECK FIRST TIME THROUGH *******
     C*
     C*  Get SPOT rate for base currency
     C*
     C           SPBRX     IFNE XSPBRX
     C***********          MOVE *BLANKS   KEY                             S01117
     C***********          MOVEL'20'      TYPE                            S01117
     C***********          MOVE '1'       KEY                             S01117
     C***********          MOVELPSCU      KCCY2                           S01117
     C***********TABKEY    CHAINTABTG10F             99                   S01117
     C***********SPOT      DIV  10        SPWRK1 138                      S01117
     C***********SPOT      ADD  SPWRK1    SPWRK2 138                      S01117
     C*                                                                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM PSCU      @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C*                                                                   S01117
     C           A6SPRT    DIV  10        SPWRK1 138                      S01117
     C           A6SPRT    ADD  SPWRK1    SPWRK2 138                      S01117
     C           PBRX      IFGT SPWRK2
     C                     ADD  1         WEC                             E14214
     C                     ADD  1         EC
     C                     MOVEL' W06'    ERR,EC
     C                     SETON                     38
     C                     ELSE
     C*
     C***********SPOT      SUB  SPWRK1    SPWRK2                          S01117
     C           A6SPRT    SUB  SPWRK1    SPWRK2                          S01117
     C           PBRX      IFLT SPWRK2
     C                     ADD  1         WEC                             E14214
     C                     ADD  1         EC
     C                     MOVEL' W06'    ERR,EC
     C                     SETON                     38
     C                     END
     C                     END
     C                     MOVE SPBRX     XSPBRX
     C                     END
     C                     END                             *IN99=1
     C*
     C**  TRANSLATE AND VALIDATE SPSMT (#ALPV) SETTLEMENT METHOD
     C*
     C           SPSMT     IFNE '00'
     C           SPSMT     ANDNE'01'
     C           SPSMT     ANDNE'02'
     C           SPSMT     ANDNE'03'
     C           SPSMT     ANDNE'04'
     C           SPSMT     ANDNE'05'
     C           SPSMT     ANDNE'06'
     C           SPSMT     ANDNE'07'
     C           SPSMT     ANDNE'08'
     C           SPSMT     ANDNE'12'
     C           SPSMT     ANDNE'14'
     C           SPSMT     ANDNE'15'
     C                     ADD  1         EC         39    *
     C                     MOVEL' 205'    ERR,EC
     C                     ELSE
     C                     MOVELSPSMT     PSMT
     C                     END                             *SPSMT
     C*
     C**If*method*is*04*of*14*retail*module*must*be*present***************E23408
     C* If method is 04 of 14 retail or int. on accounts must be present  E23408
     C*
     C***********                                                         S01117
     C           SPSMT     IFEQ '04'
     C           SPSMT     OREQ '14'
     C***********          TESTB'6'       MODI2          99               E14712
     C***********          TESTB'7'       MODI2          99         E14712S01117
     C**N99******          TESTB'2'       MODI5          99         E23408S01117
     C           BGRTBN    IFEQ 'Y'                                       S01117
     C***********BGIOAC    ANDEQ'Y'                                 S01117E37159
     C           BGIOAC    OREQ 'Y'                                       E37159
     C                     MOVE '1'       *IN99                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           *IN99     IFEQ '0'
     C                     ADD  1         EC         39    *
     C                     MOVEL' 206'    ERR,EC
     C                     END                             *IN99
     C                     END                             *SPSMT
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0170CVSF                                           S01408
     C*                                                                   S01408
     C*                                                                   E14712
     C* If method is 04 must reference an active ACCNT record             E14712
     C*                                                                   E14712
     C           SPSMT     IFEQ '04'                                      E14712
     C***********          MOVELSPCPY     CUS@                      E14712E16843
     C***********          Z-ADDCADC      ACOD@                     E14712E16843
     C***********          MOVE SPSCU     PSCU                      E14712E16843
     C                     MOVELSPCPY     KYCNUM                          E16843
     C***********          Z-ADDCADC      KYACOD                    E16843S01117
     C                     MOVE BMACCD    KYACOD                          S01117
     C                     MOVE SPSCU     KYCCY                           E16843
     C*                                                                   E14712
     C****access*TABLETR*for*A/C*Sequence******                     E14712S01117
     C*                                                                   E14712
     C                     SETOF                         99               E14712
     C***********MBIN      IFEQ 'Y'                                 E14712S01117
     C***********          MOVE *BLANKS   KEY12  12                 E14712S01117
     C***********          MOVE SPSEB     KEY12                     E14712S01117
     C***********          MOVEL'10'      KEY12                     E14712S01117
     C***********KEY12     CHAINTABLETRF             99             E14712S01117
     C***********          Z-ADDNSACS     ACSQ@                     E14712E16843
     C***********          Z-ADDNSACS     KYACSQ                    E16843S01117
     C***********          ELSE                                     E14712S01117
     C***********          Z-ADD1         ACSQ@                     E14712E16843
     C***********          Z-ADD1         KYACSQ                    E16843S01117
     C***********          END                                      E14712S01117
     C*                                                                   E14712
     C                     Z-ADD1         KYACSQ                          S01117
     C                     MOVELSPBCA     KYBRCA                          S01117
     C**N99***** ACCNTK    CHAINACCNTABF             99             E14712E16843
     C  N99      KEYACC    CHAINACCNTABF             99                   E16843
     C*                                                                   E14712
     C           *IN99     IFEQ '1'                                       E14712
     C***********RECI      OREQ '*'                                E14712 178530
     C           RECIA     OREQ 'C'                                       178530
     C                     ADD  1         EC         39                   E14712
     C                     MOVEL' 226'    ERR,EC                          E14712
     C*********            END                                      E14712E16843
     C*                                                                   E14712
     C**  Else check account is not blocked                               E16843
     C*                                                                   E16843
     C                     ELSE                                           E16843
     C                     TESTB'2'       RETB           16               E16843
     C                     TESTB'3'       RETB           17               E16843
     C           SPPRE     IFEQ 'P'                                       E16843
     C********** *IN16     ANDEQ'1'                                                  E16843 MD043182
     C           *IN17     ANDEQ'1'                                                         MD043182
     C           SPPRE     OREQ 'R'                                       E16843
     C********** *IN17     ANDEQ'1'                                                  E16843 MD043182
     C           *IN16     ANDEQ'1'                                                         MD043182
     C/COPY WNCPYSRC,HUT111_002                                                               HUT111
     C                     ADD  1         EC         39                   E16843
     C                     MOVEL' 226'    ERR,EC                          E16843
     C/COPY WNCPYSRC,HUT111_003                                                               HUT111
     C                     END                                            E16843
     C                     END                                            E16843
     C*                                                                   E14712
     C                     END                                            E14712
     C*
     C* If method is 07 currency must be USD
     C*
     C           SPSMT     IFEQ '07'
     C***********SPSCU     ANDNEUSCY                                      S01117
     C           SPSCU     ANDNEBLUSCY                                    S01117
     C                     ADD  1         EC         39    *
     C                     MOVEL' 207'    ERR,EC
     C                     END                             *SPSMT
     C*
     C* CHECK DUE DATE IS NOT A HOLIDAY FOR THE FOLLOWING METHODS         S01195
     C* This processing is now done after the nostro field has been       S01195
     C*  validated                                                        S01195
     C*                                                                   S01195
     C***********SPSMT     IFEQ '01'                                      S01195
     C***********SPSMT     OREQ '02'                                      S01195
     C***********SPSMT     OREQ '07'                                      S01195
     C***********SPSMT     OREQ '08'                                      S01195
     C***********SPSMT     OREQ '12'                                      S01195
     C***********          Z-ADDPDUD      ZDAYNO                          S01195
     C***********          MOVELSPSCU     ZCCY                            S01195
     C***********          MOVE '0'       ZOPT                            S01195
     C***********          EXSR ZDATE5                                    S01195
     C************IN99     IFEQ '1'                                       S01195
     C***********          ADD  1         WEC                       E14214S01195
     C***********          ADD  1         EC         39    *              S01195
     C***********          MOVEL' W02'    ERR,EC                          S01195
     C***********          END                             *IN99          S01195
     C***********          END                             *SPSMT         S01195
     C*
     C* CHECK DUE DATE IS NOT A HOLIDAY IN LOCAL CURRENCY
     C* FOR THE FOLLOWING METHODS
     C*
     C           SPSMT     IFEQ '03'
     C           SPSMT     OREQ '04'
     C           SPSMT     OREQ '05'
     C           SPSMT     OREQ '14'
     C           SPSMT     OREQ '15'
     C*                                                                   S01512
     C** If S01512 is active, check for the pos. settlement value date    S01512
     C** rather than the due date                                         S01512
     C*                                                                   S01512
     C           S01512    IFEQ 'Y'                                       S01512
     C                     Z-ADDPSVL      ZDAYNO                          S01512
     C                     ELSE                                           S01512
     C                     Z-ADDPDUD      ZDAYNO
     C                     END                                            S01512
     C***********          MOVELLOCY      ZCCY                            S01195
     C                     MOVELBJLCCY    ZCCY                            S01195
     C***********          MOVE '0'       ZOPT                            S01195
     C***********          EXSR ZDATE5                                    S01195
     C                     MOVE BJSLCD    ZLOC                            S01195
     C                     EXSR ZCHKH                                     S01195
     C************IN99     IFEQ '1'                                       S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C                     ADD  1         WEC                             E14214
     C                     ADD  1         EC         39    *
     C                     MOVEL' W03'    ERR,EC
     C                     END                             *IN99
     C                     END                             *SPSMT
     C*
     C***********                                                         E14881
     C**TRANSLATE*AND*VALIDATE*SPPRE*(#ALPV)*****                         E14881
     C***********                                                         E14881
     C***********          MOVELSPPRE     PPRE                            E14881
     C***********                                                         E14881
     C***********SPPRE     IFEQ *BLANK                                    E14881
     C***********          ADD  1         EC         36    *              E14881
     C***********          MOVEL' 225'    ERR,EC                          E14881
     C***********          END                             *SPPRE         E14881
     C                     MOVELSPMDI     PMDI
     C*
     C* TRANSLATE AND VALIDATE SPSEA (#ALPV) SETTLEMENT A/C
     C*
     C                     MOVELPSEA      XPSEA                                               CSD015
     C                     MOVELSPSEA     PSEA
     C*
     C           SPSEA     IFNE '  '
     C           SPSMT     ANDNE'01'
     C           SPSMT     ANDNE'02'
     C           SPSMT     ANDNE'05'
     C           SPSMT     ANDNE'07'
     C           SPSMT     ANDNE'08'
     C           SPSMT     ANDNE'12'
     C           SPSMT     ANDNE'14'
     C           SPSMT     ANDNE'15'
     C                     ADD  1         EC         40    *
     C                     MOVEL' 208'    ERR,EC
     C                     END                             *SPSEA
     C*
     C** Check an entry exists on the Nostro table
     C*
     C           SPSMT     IFEQ '01'
     C           SPSMT     OREQ '02'
     C           SPSMT     OREQ '07'
     C           SPSMT     OREQ '08'
     C           SPSMT     OREQ '12'
     C***********          MOVE *BLANKS   KEY                             S01117
     C***********          MOVEL'70      'KEY                             S01117
     C***********          MOVELSPSEA     WORK2A  2                       S01117
     C***********          MOVE WORK2A    KEY                             S01117
     C***********          MOVE SPSCU     KCCY                            S01117
     C***********TABKEY    CHAINTABLETLF             99                   S01117
     C************IN99     IFEQ '0'                                       S01117
     C***********RECI      IFEQ '*'                                       S01117
     C***********          SETON                     99                   S01117
     C***********          END                                            S01117
     C***********          END                                            S01117
     C************IN99     IFEQ '1'                                       S01117
     C*                                                                   S01117
     C                     MOVE '1'       VALID   1                                           198729
     C                     MOVE *BLANK    ACSQ2A  2                                           198729
     C                     MOVE SPSEA     ACSQ2A                                              198729
     C           ACSQ2A    IFNE *BLANK                                                        198729
     C**********           MOVELSPSEA     ACCT10 10                                    198729 CGL029
     C                     MOVELSPSEA     ACCT10 16                                           CGL029
     C                     MOVELACCT10    CNUM6A  6                                           198729
     C**********           MOVE ACCT10    ACOD4A  4                                    198729 CGL029
     C                     MOVE ACCT10    ACOD4A 10                                           CGL029
     C                     MOVELCNUM6A    KYCNUM                                              198729
     C                     MOVELSPSCU     KYCCY                                               198729
     C                     MOVELACOD4A    KYACOD                                              198729
     C                     MOVELACSQ2A    KYACSQ                                              198729
     C                     MOVELSPSEB     KYBRCA                                              198729
     C           KEYACC    CHAINACCNTABF             77                                       198729
     C           *IN77     IFEQ '0'                                                           198729
     C           ATYP      IFEQ 'R'                                                           198729
     C                     CALL 'AONOSTR0'                                                    198729
     C                     PARM *BLANKS   @RTCD                                               198729
     C                     PARM '*KEY   ' @OPTN                                               198729
     C                     PARM CNUM6A    @CUST                                               198729
     C                     PARM KYCCY     @CCYC                                               198729
     C                     PARM ACOD4A    @ACCD                                               198729
     C                     PARM ACSQ2A    @ACSQ                                               198729
     C                     PARM *BLANKS   @NOSN                                               198729
     C                     PARM KYBRCA    @BRCD                                               198729
     C                     PARM *BLANKS   @CUSN                                               198729
     C                     PARM *BLANKS   @PRNO                                               198729
     C           SDNOST    PARM SDNOST    DSFDY                                               198729
     C           @RTCD     IFNE *BLANKS                                                       198729
     C                     MOVE '0'       VALID                                               198729
     C                     ENDIF                                                              198729
     C                     ENDIF                                                              198729
     C                     ENDIF                                                              198729
     C                     ENDIF                                                              198729
      *                                                                                       198729
     C           VALID     IFEQ '1'                                                           198729
     C***********          MOVELSPSEA     NOS2A                     S01117105034
     C**********           MOVELSPSEA     NOS6A   6                                    105034 191232
     C**********           MOVE NOS6A     NOS1A   1                                    105034 191232
     C********** NOS1A     IFNE *BLANK                                                 105034 191232
     C**********           MOVE SPSEA     NOS2A                                        105034 191232
     C**********           ELSE                                                        105034 191232
     C**********           MOVELSPSEA     NOS5A   5                                    105034 191232
     C**********           MOVELNOS5A     NOS3A   3                                    105034 191232
     C**********           MOVE NOS3A     NOS1B   1                                    105034 191232
     C********** NOS1B     IFNE *BLANK                                                 105034 191232
     C**********           MOVE NOS5A     NOS2A                                        105034 191232
     C**********           ELSE                                                        105034 191232
     C**********           MOVELNOS5A     NOS2A                                        105034 191232
     C**********           END                                                         105034 191232
     C**********           END                                                         105034 191232
     C                     MOVELSPSEA     NOS2A                                               191232
     C**********           MOVE SPSEA     NOS10A 10                                    191232 CGL029
     C                     MOVE SPSEA     NOS10A 16                                           CGL029
     C           NOS2A     IFEQ *BLANKS                                                       191232
     C           NOS10A    ORNE *BLANKS                                                       191232
     C                     MOVEL'*ERROR'  @RTCD                                               191232
     C                     ELSE                                                               191232
     C                     CALL 'AONOSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM *BLANKS   @CUST   6                       S01117
     C                     PARM SPSCU     @CCYC   3                       S01117
     C**********           PARM *BLANKS   @ACCD   4                                    S01117 CGL029
     C                     PARM *BLANKS   @ACCD  10                                           CGL029
     C                     PARM *BLANKS   @ACSQ   2                       S01117
     C                     PARM NOS2A     @NOSN   2                       S01117
     C                     PARM *BLANKS   @BRCD   3                       S01117
     C                     PARM *BLANKS   @CUSN  10                       S01117
     C                     PARM *BLANKS   @PRNO   1                       S01117
     C           SDNOST    PARM SDNOST    DSFDY                           S01117
     C                     ENDIF                                                              191232
     C                     ENDIF                                                              198729
     C*                                                                   S01117
     C**  Invalid Entry                                                   S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     ADD  1         EC         40    *
     C                     MOVEL' 209'    ERR,EC
     C                     ELSE                                           S01195
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0170CVS4                                           S01408
     C*                                                                   S01408
     C*                                                                   S01195
     C**  Check due date is not a holiday for nostro location/ccy         S01195
     C**  Use branch code from Nostro file to get nostro location         S01195
     C*                                                                   S01195
     C**********           CALL 'AOBRCHR0'                                S01195              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD                           S01195
     C                     PARM '*KEY   ' @OPTN                           S01195
     C                     PARM A7BRCD    @DSNB                           S01195
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01195              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01195
     C                     MOVE A8LCCD    ZLOC                            S01195
     C*                                                                   S01195
     C** If S01512 is active, check for the pos. settlement value date    076975
     C** rather than the due date                                         076975
     C*                                                                   076975
     C***********          Z-ADDPDUD      ZDAYNO                    S01195076975
     C           S01512    IFEQ 'Y'                                       076975
     C                     Z-ADDPSVL      ZDAYNO                          076975
     C                     ELSE                                           076975
     C                     Z-ADDPDUD      ZDAYNO                          076975
     C                     END                                            S01512
     C*                                                                   076975
     C                     MOVELSPSCU     ZCCY                            S01195
     C                     EXSR ZCHKH                                     S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C                     ADD  1         WEC                             S01195
     C                     ADD  1         EC         39    *              S01195
     C                     MOVEL' W02'    ERR,EC                          S01195
     C                     END                             ZIND           S01195
     C                     END
     C                     END                             *SPSMT
     C*
     C**  Check Settlement A/C exists on ACCNT
     C*
     C           SPSMT     IFEQ '05'
     C*
     C**  First check I/p is numeric
     C*
     C                     TESTN          SPSEA      99
     C           *IN99     IFEQ '1'
     C                     MOVELSPSEA     PSEA@
     C                     MOVELSPSEB     BRCA@                           S01117
     C           ACCNTK    CHAINACCNT                99
     C************IN99     IFEQ '0'                                       E17211
     C***********RECI      IFEQ '*'                                       E17211
     C           *IN99     IFEQ '1'                                       E17211
     C***********RECI      OREQ '*'                                E17211 178530
     C           RECIA     OREQ 'C'                                       178530
     C                     SETON                     99
     C***********                                                   E16843S01117
     C****Else*if*branch*not*equal*to*settlement*branch****               S01117
     C***********                                                   E16843S01117
     C***********          ELSE                                           S01117
     C***********          MOVELBRCD      WRK03   3                       S01117
     C***********WRK03     IFNE SPSEB                                     S01117
     C***********          SETON                     99                   S01117
     C*                                                                   E16843
     C**  else check account is not blocked                               E16843
     C*                                                                   E16843
     C                     ELSE                                           E16843
     C                     TESTB'2'       RETB           16               E16843
     C                     TESTB'3'       RETB           17               E16843
     C           SPPRE     IFEQ 'P'                                       E16843
     C********** *IN16     ANDEQ'1'                                                  E16843 MD043182
     C           *IN17     ANDEQ'1'                                                         MD043182
     C           SPPRE     OREQ 'R'                                       E16843
     C********** *IN17     ANDEQ'1'                                                  E16843 MD043182
     C           *IN16     ANDEQ'1'                                                         MD043182
     C/COPY WNCPYSRC,HUT111_004                                                               HUT111
     C                     SETON                     99                   E16843
     C/COPY WNCPYSRC,HUT111_005                                                               HUT111
     C                     END                                            E16843
     C*                                                                   E16843
     C***********          END                                            S01117
     C                     END
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC         40    *
     C                     MOVEL' 210'    ERR,EC
     C                     END
     C***********          END                                            E17211
     C*
     C**  Else Entry Not Numeric
     C*
     C                     ELSE
     C                     ADD  1         EC         40    *
     C                     MOVEL' 210'    ERR,EC
     C                     END
     C                     END
     C*
     C***Check*A/C*exists*on*ACNUM*and*the*Pay*Branch*matches*********    S01117
     C** Check Settlement A/C exists on ACNUM                             S01117
     C*
     C           SPSMT     IFEQ '14'
     C*
     C**  First check I/p is numeric
     C*
     C                     MOVELSPSEA     WRK10A 10
     C                     TESTN          WRK10A     99
     C*
     C**  If numeric, record must exist on ACNUM
     C*
     C           *IN99     IFEQ '1'
     C                     MOVELSPSEA     ACNO
     C           ACNO      CHAINACNUM                99
     C           *IN99     IFEQ '0'
     C***********RECI      IFEQ '*'                                       178530
     C           RECIA     IFEQ 'C'                                       178530
      *                                                                   178530
      **  CCY must be equal to settlement CCY                             178530
      *                                                                   178530
     C           CCY       ORNE SPSCU                                     178530
      *                                                                   178530
     C                     SETON                     99
     C************                                                        S01117
     C****Else*if*branch*not*equal*to*settlement*branch*******            S01117
     C************                                                        S01117
     C                     ELSE
     C*
     C****READ*ACCNT*TO*GET*PAY*BRANCH************                        S01117
     C**  READ ACCNT                                                      S01117
     C*
     C**********           Z-ADDCNUM      CUS@                                                CSD027
     C                     MOVE CNUM      CUS@                                                CSD027
     C                     Z-ADDACOD      ACOD@
     C                     Z-ADDACSQ      ACSQ@
     C                     MOVELBRCA      BRCA@                           S01117
     C           ACCNTK    CHAINACCNT                99
     C           *IN99     IFEQ '1'                                       E16843
     C***********RECI      OREQ '*'                                E16843 178530
     C           RECIA     OREQ 'C'                                       178350
     C                     SETON                     99                   E16843
     C                     ELSE                                           E16843
     C***********          MOVELBRCD      WRK03
     C                     MOVELBRCA      WRK03   3
     C           WRK03     IFNE SPSEB
     C                     SETON                     99
     C*                                                                   E16843
     C**  else check account is not blocked                               E16843
     C*                                                                   E16843
     C                     ELSE                                           E16843
     C                     TESTB'2'       RETB           16               E16843
     C                     TESTB'3'       RETB           17               E16843
     C           SPPRE     IFEQ 'P'                                       E16843
     C********** *IN16     ANDEQ'1'                                                  E16843 MD043182
     C           *IN17     ANDEQ'1'                                                         MD043182
     C           SPPRE     OREQ 'R'                                       E16843
     C********** *IN17     ANDEQ'1'                                                  E16843 MD043182
     C           *IN16     ANDEQ'1'                                                         MD043182
     C/COPY WNCPYSRC,HUT111_006                                                               HUT111
     C                     SETON                     99                   E16843
     C/COPY WNCPYSRC,HUT111_007                                                               HUT111
     C                     END                             *SPPRE =P OR R E16843
     C                     END                                            E16843
     C*                                                                   E16843
     C                     END
     C                     END                                            178530
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC         40
     C                     MOVEL' 211'    ERR,EC
     C                     END
     C***********          END                                            178530
     C                     ELSE
     C                     ADD  1         EC         40    *
     C                     MOVEL' 211'    ERR,EC
     C                     END
     C                     ELSE
     C                     ADD  1         EC         40    *
     C                     MOVEL' 211'    ERR,EC
     C                     END                             *IN99=1
     C                     END                             *SPSMT
     C*
     C***Check*Cust*exists*on*CLINTSE*and*Settlement*A/c*Input*********   E17793
     C*                                                                   E17793
     C           SPSMT     IFEQ '15'
     C*                                                                   E17793
     C**First*check*I/p*is*numeric*************************************   E17793
     C***********          MOVELSPSEA     WRK06A  6                       E17793
     C***********          TESTN          WRK06A     99                   E17793
     C**If*numeric,*record*must*exist*on*CLINTSE***********************   E17793
     C************IN99     IFEQ '1'                                       E17793
     C***********          MOVELSPSEA     PSEA@                           E17793
     C***********CUS@      CHAINCLINTSEF             99                   E17793
     C************IN99     IFEQ '0'                                       E17793
     C***********RECI      IFEQ '*'                                       E17793
     C***********          SETON                     99                   E17793
     C***********          ELSE                                           E17793
     C***********C1AC      IFEQ 0                                         E17793
     C***********          SETON                     99                   E17793
     C***********          END                                            E17793
     C***********C1SQ      IFEQ 0                                         E17793
     C***********          SETON                     99                   E17793
     C***********          END                                            E17793
     C***********          END                                            E17793
     C***********          END                                            E17793
     C***********                                                  E16843 E17793
     C**If*active*record*exists*on*CLINTSE*and*no*errors***********E16843 E17793
     C*****check*account*is*not*blocked*on*ACCNT*******************E16843 E17793
     C***********                                                  E16843 E17793
     C************IN99     IFEQ '0'                                E16843 E17793
     C/COPY WNCPYSRC,SE0170C072
     C*                                                                   E17793
     C**  Set up defaults for Settlement Account and check that account   E17793
     C**  is not blocked on ACCNT                                         E17793
     C*                                                                   E17793
     C                     MOVELPCPY      CUS@                            E17793
     C                     MOVELPC1AC     ACOD@                           E17793
     C                     MOVELPC1SQ     ACSQ@                           E17793
     C                     MOVELPSEA@     SPSEA                           E17793
     C/COPY WNCPYSRC,SE0170C073
     C           SPSEB     IFNE *BLANKS                                   087651
     C                     MOVELSPSEB     BRCA@                           087651
     C                     ELSE                                           087651
     C                     MOVELPBCA      BRCA@                           S01117
     C                     MOVELPBCA      SPSEB                           087651
     C                     END                                            087651
     C*                                                                   E17793
     C**********           Z-ADDCUS@      KYCNUM                                       E16843 CSD027
     C                     MOVE CUS@      KYCNUM                                              CSD027
     C                     MOVELSPSCU     KYCCY                           E16843
     C***********          MOVELC1AC      KYACOD                   E16843 E17793
     C***********          Z-ADDC1SQ      KYACSQ                   E16843 E17793
     C                     MOVELACOD@     KYACOD                          E17793
     C                     Z-ADDACSQ@     KYACSQ                          E17793
     C                     MOVELBRCA@     KYBRCA                          S01117
     C           KEYACC    CHAINACCNTABF             99                   E16843
     C           *IN99     IFEQ '1'                                       E16843
     C***********RECI      OREQ '*'                                E16843 178530
     C           RECIA     OREQ 'C'                                       178530
     C                     SETON                     99                   E16843
     C                     ELSE                                           E16843
     C                     TESTB'2'       RETB           16               E16843
     C                     TESTB'3'       RETB           17               E16843
     C           SPPRE     IFEQ 'P'                                       E16843
     C********** *IN16     ANDEQ'1'                                                  E16843 MD043182
     C           *IN17     ANDEQ'1'                                                         MD043182
     C           SPPRE     OREQ 'R'                                       E16843
     C********** *IN17     ANDEQ'1'                                                  E16843 MD043182
     C           *IN16     ANDEQ'1'                                                         MD043182
     C                     SETON                     99                   E16843
     C                     END                             *SPPRE =P OR R E16843
     C                     END                             *IN99=1        E16843
     C***********          END                             *IN99=0 E16843 E17793
     C*                                                                   E16843
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC         40
     C                     MOVEL' 212'    ERR,EC
     C                     END                             *IN99=1
     C***********          ELSE                                           E17793
     C***********          ADD  1         EC         40                   E17793
     C***********          MOVEL' 212'    ERR,EC                          E17793
     C***********          END                                            E17793
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0170CVS5                                           S01408
     C*                                                                   S01408
     C*
     C**  TRANSLATE AND VALIDATE SPSEB (#ALPH) Settlement Branch
     C*
     C                     MOVELSPSEB     PSEB
     C*
     C***********          MOVE *BLANKS   KEY                             S01117
     C***********          MOVEL'10'      TYPE                            S01117
     C***********          MOVE SPSEB     KEY                             S01117
     C***********TABKEY    CHAINTABLETRF             99                   S01117
     C************IN99     IFEQ '1'                                       S01117
     C*                                                                   S01117
     C           *IN81     IFEQ '1'                                       S01117
     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SPSEB     @DSNB                           S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01117              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01117
     C** Invalid Branch                                                   S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     ADD  1         EC         41
     C                     MOVEL' 213'    ERR,EC
     C                     END
     C*                                                                   S01117
     C**  For Settlement Methods 01, 02, 07, 08, 12                       S01117
     C**  Settlement Branch must equal Nostro Branch Code                 S01117
     C*                                                                   S01117
     C           SPSMT     IFEQ '01'                                      S01117
     C           SPSMT     OREQ '02'                                      S01117
     C           SPSMT     OREQ '07'                                      S01117
     C           SPSMT     OREQ '08'                                      S01117
     C           SPSMT     OREQ '12'                                      S01117
     C           SPSEB     IFNE A7BRCD                                    S01117
     C                     ADD  1         EC         41                   S01117
     C                     MOVEL' 230'    ERR,EC                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C**  For all other Settlement Methods except 05 and 14               S01117
     C**  Settlement Branch must equal Trade Booking Branch               S01117
     C*                                                                   S01117
     C           SPSMT     IFEQ '00'                                      S01117
     C           SPSMT     OREQ '03'                                      S01117
     C           SPSMT     OREQ '04'                                      S01117
     C           SPSMT     OREQ '06'                                      S01117
     C***********SPSMT     OREQ '15'                               S01117 087651
     C           SPSEB     IFNE SPBCA                                     S01117
     C                     ADD  1         EC         41                   S01117
     C                     MOVEL' 231'    ERR,EC                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*
     C**  TRANSLATE AND VALIDATE SPCPN (#ALPV) COUNTERPARTY BANK
     C*
     C                     MOVELPCPN      XPCPN                                               CSD015
     C                     MOVELSPCPN     PCPN
     C*
     C           SPCPN     IFNE *BLANK
     C/COPY WNCPYSRC,SE0170C048
     C*
     C**  If entered must be valid
     C*
     C           SPSMT     IFNE '01'
     C           SPSMT     ANDNE'07'
     C           SPSMT     ANDNE'08'
     C/COPY WNCPYSRC,SE0170C049
     C                     ADD  1         EC         42
     C                     MOVEL' 214'    ERR,EC
     C                     ELSE
     C*
     C****Check*entry*refers*to*a*customer*on*CLINT*or*a*counterparty**   S01117
     C****Nostro*on*TABLET2********************************************   S01117
     C***********                                                         S01117
     C****If*numeric*entry*read*CLINTCB*file*Else*Read*SNAME*file******   S01117
     C*
     C***********          MOVELSPCPN     WRK6A                           S01117
     C***********          TESTN          WRK6A      99                   S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          MOVELWRK6A     WRK6N   60                      S01117
     C***********WRK6N     CHAINCLINT                99                   S01117
     C**N99******RECI      COMP '*'                      99               S01117
     C***********                                                         S01117
     C****Else*read*SNAME*file*************                               S01117
     C***********                                                         S01117
     C***********          ELSE                                           S01117
     C***********SPCPN     CHAINSNAME                99                   S01117
     C**N99******RECI      COMP '*'                      99               S01117
     C***********          END                                            S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          MOVEL*BLANKS   KEY                             S01117
     C***********          MOVE '71'      TYPE                            S01117
     C***********          MOVELSPCPN     KCPN                            S01117
     C***********TABKEY    CHAINTABLET2F             99                   S01117
     C************IN99     IFEQ '0'                                       S01117
     C***********RECI      IFEQ '*'                                       S01117
     C***********          SETON                     99                   S01117
     C***********          END                                            S01117
     C***********          END                                            S01117
     C***********          END                                            S01117
     C************IN99     IFEQ '1'                                       S01117
     C*                                                                   S01117
     C**  Check Customer file for valid Customer number                   S01117
     C*                                                                   S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SPCPN     @KEY1                           S01117
     C                     PARM *BLANKS   @KYST                           S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C*                                                                   S01117
     C**  Invalid Entry                                                   S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C*                                                                   S01117
     C**  Else check for valid nostro on Counterparty Nostro File         S01117
     C*                                                                   S01117
     C                     MOVELSPCPN     CPNST   8                       S01117
     C                     CALL 'AOCNSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM CPNST     @CPNC   8                       S01117
     C           SDCNST    PARM SDCNST    DSFDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C*                                                                   S01117
     C                     ADD  1         EC         42
     C                     MOVEL' 215'    ERR,EC
     C                     END
     C                     END                                            S01117
     C                     END
     C                     END
     C*
     C**  TRANSLATE AND VALIDATE SPFAC (#ALPV) FOR A/C OF
     C*
     C                     MOVELPFAC      XPFAC                                               CSD015
     C                     MOVELSPFAC     PFAC
     C*
     C           SPFAC     IFNE *BLANK
     C*
     C**  If entered must be valid
     C*
     C           SPSMT     IFNE '01'
     C           SPSMT     ANDNE'07'
     C           SPSMT     ANDNE'08'
     C           SPFAC     ORNE *BLANK
     C           SPPRE     ANDNE'P'
     C                     ADD  1         EC         43
     C                     MOVEL' 216'    ERR,EC
     C                     ELSE
     C***********                                                         S01117
     C****If*numeric*entry*read*CLINTCB*file*Else*Read*SNAME*file***      S01117
     C***********                                                         S01117
     C***********          MOVELSPFAC     WRK6A                           S01117
     C***********          TESTN          WRK6A      99                   S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          MOVELWRK6A     WRK6N   60                      S01117
     C***********WRK6N     CHAINCLINT                99                   S01117
     C**N99******RECI      COMP '*'                      99               S01117
     C***********                                                         S01117
     C****Else*read*SNAME*file******                                      S01117
     C***********                                                         S01117
     C***********          ELSE                                           S01117
     C***********SPFAC     CHAINSNAME                99                   S01117
     C**N99******RECI      COMP '*'                      99               S01117
     C***********          END                                            S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          MOVEL*BLANKS   KEY                             S01117
     C***********          MOVE '71'      TYPE                            S01117
     C***********          MOVELSPFAC     KCPN                            S01117
     C***********TABKEY    CHAINTABLET2F             99                   S01117
     C************IN99     IFEQ '0'                                       S01117
     C***********RECI      IFEQ '*'                                       S01117
     C***********          SETON                     99                   S01117
     C***********          END                                            S01117
     C***********          END                                            S01117
     C***********          END                                            S01117
     C************IN99     IFEQ '1'                                       S01117
     C*                                                                   S01117
     C**  Check Customer file for valid Customer number                   S01117
     C*                                                                   S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SPFAC     @KEY1                           S01117
     C                     PARM *BLANKS   @KYST                           S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C*                                                                   S01117
     C**  Invalid Entry                                                   S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C*                                                                   S01117
     C**  Else check for valid nostro on Counterparty Nostro File         S01117
     C*                                                                   S01117
     C                     MOVELSPFAC     CPNST                           S01117
     C                     CALL 'AOCNSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM CPNST     @CPNC                           S01117
     C           SDCNST    PARM SDCNST    DSFDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     ADD  1         EC         43
     C                     MOVEL' 217'    ERR,EC
     C                     END
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END
     C                     END
     C*
     C**  TRANSLATE AND VALIDATE SPCHC (#ALPV) CHARGE CODE
     C**  (NON MANDATORY)
     C*
     C/COPY WNCPYSRC,SE0170C018
     C           SPCHC     IFNE *BLANKS
     C                     MOVELSPCHC     PCHC
     C                     MOVELSPCHC     CCDK    2
     C***********SECHGK    CHAINSECHG                99                   S01169
     C           SECGTK    CHAINSECGT                99                   S01169
     C           *IN99     IFEQ '0'
     C           RECI      IFEQ '*'
     C                     SETON                     99
     C                     END
     C                     END
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC         45
     C                     MOVEL' 218'    ERR,EC
     C                     END
     C                     ELSE                                           174342
     C                     MOVE *BLANKS   PCHC                            174342
     C/COPY WNCPYSRC,SE0170C024
     C                     END
     C*
     C**  TRANSLATE AND VALIDATE SPCHA (#AMNT) CHARGE AMOUNT
     C*
     C**   MUST BE BLANK IF CHARGE CODE BLANK
     C*
     C/COPY WNCPYSRC,SE0170C025
     C           SPCHA     IFNE *BLANKS
     C           SPCHC     ANDEQ*BLANKS
     C                     ADD  1         EC         46    *
     C                     MOVEL' 219'    ERR,EC
     C                     END
     C*
     C**  MUST BE ENTERED AND VALID IF CHARGE CODE ENTERED
     C*
     C           SPCHA     IFEQ *BLANKS
     C           SPCHC     ANDNE*BLANKS
     C/COPY WNCPYSRC,SE0170C026
     C                     ADD  1         EC         46    *
     C                     MOVEL' 219'    ERR,EC
     C/COPY WNCPYSRC,SE0170C040
     C                     ELSE
     C***********          MOVE *BLANKS   KEY                             S01117
     C**********           MOVEL'20'      TYPE
     C**********           MOVE '1'       KEY
     C**********           MOVELSPNCY     KCCY2
     C********** TABKEY    CHAINTABTG10F             99
     C           S01509    IFEQ 'Y'                                       S01509
     C                     Z-ADDPOSCDP    ZSDEC                           S01509
     C           13        SUB  POSCDP    ZSDIG                           S01509
     C                     ELSE                                           S01509
     C                     Z-ADDNOMCDP    ZSDEC
     C           13        SUB  NOMCDP    ZSDIG
     C                     END                                            S01509
     C                     MOVE *BLANKS   ZFLD17
     C                     MOVELSPCHA     ZFLD17
     C                     EXSR ZASIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC         46    *
     C                     MOVEL' 220'    ERR,EC
     C                     ELSE
     C                     MOVE ZOUT15    PCHA
     C           ZFSIGN    IFEQ '-'
     C                     Z-SUBPCHA      PCHA
     C                     END
     C                     END
     C                     END
     C*
     C**  TRANSLATE AND VALIDATE SPCCD (#ALPV) COMMISSION CODE
     C*
     C/COPY WNCPYSRC,SE0170C019
     C           SPCCD     IFNE *BLANKS
     C                     MOVELSPCCD     PCCD
     C                     MOVELSPCCD     CCDK
     C***********SECHGK    CHAINSECHG                99                   S01169
     C           SECGTK    CHAINSECGT                99                   S01169
     C           *IN99     IFEQ '0'
     C           RECI      IFEQ '*'
     C                     SETON                     99
     C                     END
     C                     END
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC         47    *
     C                     MOVEL' 221'    ERR,EC
     C                     END
     C           SPBCD     IFEQ *BLANKS                                   E30740
     C                     ADD  1         EC         35                   E30740
     C                     MOVEL' 501'    ERR,EC                          E30740
     C                     END                                            E30740
     C                     ELSE                                           174342
     C                     MOVE *BLANKS   PCCD                            174342
     C/COPY WNCPYSRC,SE0170C027
     C                     END
     C*
     C**  TRANSLATE AND VALIDATE SPCAM (#AMNT)
     C*
     C**  MUST BE BLANK IF COMMISSION CODE BLANK
     C*
     C/COPY WNCPYSRC,SE0170C028
     C           SPCAM     IFNE *BLANKS
     C           SPCCD     ANDEQ*BLANKS
     C                     ADD  1         EC         48    *
     C                     MOVEL' 222'    ERR,EC
     C                     END
     C*
     C**  MUST BE ENTERED IF COMMISSION CODE ENTERED
     C*
     C           SPCAM     IFEQ *BLANKS
     C           SPCCD     ANDNE*BLANKS
     C/COPY WNCPYSRC,SE0170C029
     C                     ADD  1         EC         48    *
     C                     MOVEL' 222'    ERR,EC
     C/COPY WNCPYSRC,SE0170C041
     C                     ELSE
     C           S01509    IFEQ 'Y'                                       S01509
     C                     Z-ADDPOSCDP    ZSDEC                           S01509
     C           13        SUB  POSCDP    ZSDIG                           S01509
     C                     ELSE                                           S01509
     C                     Z-ADDNOMCDP    ZSDEC
     C           13        SUB  NOMCDP    ZSDIG
     C                     END                                            S01509
     C                     MOVE *BLANKS   ZFLD17
     C                     MOVELSPCAM     ZFLD17
     C                     EXSR ZASIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC         48    *
     C                     MOVEL' 223'    ERR,EC
     C                     ELSE
     C                     MOVE ZOUT15    PCAM
     C           ZFSIGN    IFEQ '-'
     C                     Z-SUBPCAM      PCAM
     C                     END
     C                     END
     C                     END
     C/COPY WNCPYSRC,SE0170C030
      *                                                                   S01447
      *** Validate new tax deductible flds if tax withheld (S01447=ON)    S01447
      *                                                                   S01447
     C                     CLEARTASO                                      S01447
     C                     CLEARTASR                                      S01447
     C                     CLEARTAUS                                      S01447
     C           S01447    IFEQ 'Y'                        *B1            S01447
     C********** CSE023    ANDNE'Y'                                CSE023 186166
     C           WFREEM    ANDNE'Y'                                       186166
     C           STASO     IFNE *BLANKS                    *B2            S01447
     C           STASR     ORNE *BLANKS                                   S01447
     C           STAUS     ORNE *BLANKS                                   S01447
     C                     EXSR VALTAX                                    S01447
     C**********           ELSE                                    CSE023 186166
      *                                                            CSE023 186166
     C********** WFREEM    IFEQ 'Y'                                CSE023 186166
     C**********           EXSR WITHTX                             CSE023 186166
     C**********           ENDIF                                   CSE023 186166
      *                                                                   CSE023
     C                     END                             *E2            S01447
      *                                                                   CSE023
     C                     ELSE                                           CSE023
     C           WFREEM    IFEQ 'Y'                                       CSE023
     C           SPEVT     IFNE 'MT'                                      186166
     C           BFCLAS    OREQ 'S'                                       186166
     C           BFCLAS    OREQ 'D'                                       186166
     C                     EXSR WITHTX                                    CSE023
     C                     ELSE                                           186166
     C*                                                                   186166
     C           S01509    IFEQ 'N'                                       186166
     C                     Z-ADDNOMCDP    ZADEC                           186166
     C                     ELSE                                           186166
     C                     Z-ADDPOSCDP    ZADEC                           186166
     C                     ENDIF                                          186166
     C           13        SUB  ZADEC     ZADIG                           186166
     C                     MOVE *BLANK    ZFIELD                          186166
     C                     MOVELSTASO     ZFIELD                          186166
     C                     EXSR ZALIGN                                    186166
     C                     MOVE ZFIELD    TASO                            186166
     C*                                                                   186166
     C                     MOVE *BLANK    ZFIELD                          186166
     C                     MOVELSTASR     ZFIELD                          186166
     C                     EXSR ZALIGN                                    186166
     C                     MOVE ZFIELD    TASR                            186166
     C*                                                                   186166
     C                     MOVE *BLANK    ZFIELD                          186166
     C                     MOVELSTAUS     ZFIELD                          186166
     C                     EXSR ZALIGN                                    186166
     C                     MOVE ZFIELD    TAUS                            186166
     C                     ENDIF                                          186166
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C                     END                             *E1            S01447
      *                                                                                       233711
      ** Validate EU Tax Amount.                                                              233711
      *                                                                                       233711
     C********** *IN75     IFEQ *ON                                                    233711 234471
     C           *IN78     IFEQ *ON                                                           234471
     C                     EXSR SRVTXN                                                        233711
     C                     ENDIF                                                              233711
      *                                                                   S01447
     C*                                                                   S01447
     C**  TRANSLATE AND VALIDATE SPSAT (#ALPV) SETTLEMENT AMOUNT
     C*
     C***********          Z-ADDCDP       ZSDEC                           S01117
     C***********13        SUB  CDP       ZSDIG                           S01117
     C*                                                                   055839
     C** Use settle CCY D.P for validation                                055839
     C*
     C***********          Z-ADDA6NBDP    ZSDEC                     S01117055839
     C***********13        SUB  A6NBDP    ZSDIG                     S01117055839
     C*                                                                   103634
     C                     Z-ADDSETCDP    ZSDEC                           103634
     C           13        SUB  SETCDP    ZSDIG                           103634
     C                     MOVE *BLANKS   ZFLD17                          103634
     C                     MOVELSPSAT     ZFLD17                          103634
     C                     EXSR ZASIGN                                    103634
     C                     MOVE ZOUT15    PSAT                            103634
     C/COPY WNCPYSRC,SE0170C044
     C*                                                                   S01512
     C** If S01512 is active, translation and validation of amount        S01512
     C** is bypassed since this would become an output field only         S01512
     C*                                                                   S01512
     C           S01512    IFEQ 'N'                                       S01512
     C                     Z-ADDSETCDP    ZSDEC                           055839
     C           13        SUB  SETCDP    ZSDIG                           055839
     C                     MOVE *BLANKS   ZFLD17
     C                     MOVELSPSAT     ZFLD17
     C                     EXSR ZASIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC         49
     C                     MOVEL' 224'    ERR,EC
     C                     ELSE
     C*                                                                   E18884
     C**  IF EXCHANGE RATE IS INVALID THEN DO NOT CALCULATE SETTLEMENT    E18884
     C**  AMOUNT.                                                         E18884
     C*                                                                   E18884
     C           *IN34     IFEQ '0'                                       E18884
     C                     MOVE ZOUT15    PSAT
     C           ZFSIGN    IFEQ '-'
     C                     Z-SUBPSAT      PSAT
     C                     END
     C*
     C**  SETTLEMENT AMOUNT MUST EQUAL AMOUNT DUE PLUS CHARGES
     C**  and commission if receipt else minus charges/comm
     C**  converted to settlement currency
     C*
     C*                                                                   S01447
      *** If tax withheld, then workout amount to be added/subtracted     S01447
      *** later                                                           S01447
      *                                                                   S01447
     C           S01447    IFEQ 'Y'                        *B1            S01447
     C           *IN70     ANDEQ'0'                                       S01447
     C           *IN72     ANDEQ'0'                                       S01447
     C           TASO      ADD  TAUS      TAXAMT 130                      S01447
     C                     ELSE                                           S01447
     C                     Z-ADD*ZERO     TAXAMT                          S01447
     C                     END                                            S01447
     C/COPY WNCPYSRC,SE0170C020
     C*                                                                   S01447
     C***********C1DI      IFEQ 'S'                                 E14881S01117
     C***********C1DI      OREQ 'D'                                 E14881S01117
     C           BFCLAS    IFEQ 'S'                                       S01117
     C           BFCLAS    OREQ 'D'                                       S01117
     C*                                                                   E14881
     C           SPPRE     IFEQ 'R'
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0170CVS1                                           S01408
     C*                                                                   S01408
     C           PAMD      ADD  PCHA      WRK130 130
     C           WRK130    ADD  PCAM      WRK130
     C           WRK130    ADD  TAXAMT    WRK130                          S01447
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0170CVS2                                           S01408
     C*                                                                   S01408
     C                     ELSE
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0170CVS3                                           S01408
     C*                                                                   S01408
     C           PAMD      SUB  PCHA      WRK130
     C           WRK130    SUB  PCAM      WRK130
     C           WRK130    SUB  TAXAMT    WRK130                          S01447
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0170CVS2                                           S01408
     C*                                                                   S01408
     C                     END
     C*                                                                   E14881
     C                     ELSE                                           E14881
     C*                                                                   E14881
     C           SPPRE     IFEQ 'R'                                       E14881
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0170CVS3                                           S01408
     C*                                                                   S01408
     C           PAMD      SUB  PCHA      WRK130                          E14881
     C           WRK130    SUB  PCAM      WRK130                          E14881
     C           WRK130    SUB  TAXAMT    WRK130                          S01447
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0170CVS2                                           S01408
     C*                                                                   S01408
     C                     ELSE                                           E14881
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0170CVS1                                           S01408
     C*                                                                   S01408
     C           PAMD      ADD  PCHA      WRK130                          E14881
     C           WRK130    ADD  PCAM      WRK130                          E14881
     C           WRK130    ADD  TAXAMT    WRK130                          S01447
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0170CVS2                                           S01408
     C*                                                                   S01408
     C                     END                                            E14881
     C                     END                                            E14881
     C/COPY WNCPYSRC,SE0170C021
     C                     Z-ADDWRK130    WRK203 203                      151506
     C*
     C** If S01509 is off, check settlement ccy against nominal ccy       S01509
     C*                                                                   S01509
     C           SETCDP    IFNE NOMCDP                                    055839
     C           S01509    ANDEQ'N'                                       S01509
     C           SETCDP    SUB  NOMCDP    ZPX     10                      055839
     C                     ADD  4         ZPX                             055839
     C           POWER,ZPX IFLT 1                          from d.p *LT   055839
     C***********WRK130    MULT POWER,ZPX WRK130            to d.p. 055839151506
     C           WRK130    MULT POWER,ZPX WRK203            to d.p.       151506
     C                     ELSE                            from d.p. *GT  055839
     C***********WRK130    MULT POWER,ZPX WRK130             to d.p 055839151506
     C           WRK130    MULT POWER,ZPX WRK203             to d.p.      151506
     C                     END                                            055839
     C                     END                                            055839
     C*
     C** If S01509 is active, check settlement ccy against due ccy        S01509
     C*                                                                   S01509
     C           SETCDP    IFNE POSCDP                                    S01509
     C           S01509    ANDEQ'Y'                                       S01509
     C           SETCDP    SUB  POSCDP    ZPX     10                      S01509
     C                     ADD  4         ZPX                             S01509
     C           POWER,ZPX IFLT 1                          from d.p *LT   S01509
     C***********WRK130    MULT POWER,ZPX WRK130            to d.p. S01509151506
     C           WRK130    MULT POWER,ZPX WRK203            to d.p.       151506
     C                     ELSE                            from d.p. *GT  S01509
     C***********WRK130    MULT POWER,ZPX WRK130             to d.p S01509151506
     C           WRK130    MULT POWER,ZPX WRK203 203         to d.p.      151506
     C                     END                                            S01509
     C                     END                                            S01509
      *                                                                   055839
     C           PMDI      IFEQ 'M'
     C***********WRK130    MULT PSXR      WRK130                          151506
     C           WRK203    MULT PSXR      WRK130    H                     151506
     C                     ELSE
     C           PMDI      IFEQ 'D'
     C***********WRK130    DIV  PSXR      WRK130    H                     151506
     C           WRK203    DIV  PSXR      WRK130    H                     151506
     C                     END
     C                     END
     C/COPY WNCPYSRC,SE0170C005
     C********** PSAT      IFNE WRK130                                                        235250
     C**********           ADD  1         EC         49                                       235250
     C**********           MOVEL' 224'    ERR,EC                                              235250
     C**********           END                                                                235250
     C/COPY WNCPYSRC,SE0170C006
     C                     END                                            E18884
     C                     END
     C                     END                                            S01512
     C*
     C**  TRANSLATE AND VALIDATE SPSPI (#ALPV) SPECIAL INSTRUCTIONS
     C*
     C                     MOVELSPSPI     PSPI
     C*                                                                   S01412
     C** Validate the format of the special instruction field             S01412
     C** for an electronic pay settlement method                          S01412
     C*                                                                   S01412
     C           SPSPI     IFNE *BLANKS                                   S01412
     C           SPSMT     IFEQ '01'                                      S01412
     C           SPSMT     OREQ '08'                                      S01412
     C                     MOVEA*BLANKS   SIL                             S01412
     C                     MOVEASPSPI     SIL                             S01412
     C                     EXSR SEPTVS                                    S01412
     C           CUL       IFEQ 'E'                                       S01412
     C                     ADD  1         EC         44                   S01412
     C                     MOVEL' 253'    ERR,EC                          S01412
     C                     END                                            S01412
     C           CUL       IFEQ 'X'                                       CSW096
     C                     ADD  1         EC                              CSW096
     C                     MOVE ' 254'    ERR,EC                          CSW096
     C                     MOVE '1'       *IN44                           CSW096
     C                     ENDIF                                          CSW096
     C                     END                                            S01412
     C                     END                                            S01412
     C*
     C                     ELSE
     C*
     C**  IF ACTION=D WITH ENTER PRESSED THEN ERROR
     C*
     C           ACTN      IFEQ 'D'
     C           ACTN      OREQ 'R'                                       186400
     C                     MOVELINF,10    INFMSG
     C                     END
     C                     END
     C                     ELSE
     C*
     C**  IF COMMAND 10 TAKEN
     C*
     C           AID       IFEQ '04'
     C*
     C**  COMMAND 10 TAKEN CORRECTLY WHEN ACTION IS D-FORCE 'RECORD
     c**  ADVANCE'
     C*
     C           ACTN      IFEQ 'D'
     C           ACTN      OREQ 'R'                                       186400
     C                     MOVEL'RA'      AID
     C*
     C** COMMAND 10 TAKEN INCORRECTLY WHEN ACTION IS NOT D-HENCE ERROR
     C*
     C                     ELSE
     C                     MOVELINF,11    INFMSG
     C                     END
     C                     END
     C*
     C                     END
      *                                                                                       CER049
     C           CER049    IFEQ 'Y'                                                           CER049
     C                     CALL 'AOBRCHR2'                                                    CER049
     C                     PARM *BLANKS   @RTCD                                               CER049
     C                     PARM '*KEY   ' @OPTN                                               CER049
     C**********           PARM SPSEB     @DSNB                                      CER049 AR851784
     C                     PARM SPBCA     @DSNB                                             AR851784
     C           SDBRCE    PARM SDBRCE    DSSDY                                               CER049
     C           @RTCD     IFEQ *BLANKS                                                       CER049
     C                     MOVE BXTAX     WSTAX                                               CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C                     CALL 'AOCUSTR0'                                                    CER049
     C                     PARM *BLANKS   @RTCD                                               CER049
     C                     PARM '*KEY   ' @OPTN                                               CER049
     C                     PARM SPCPY     @KEY1                                               CER049
     C                     PARM *BLANKS   @KYST                                               CER049
     C           SDCUST    PARM SDCUST    DSSDY                                               CER049
     C           @RTCD     IFEQ *BLANKS                                                       CER049
     C                     CALL 'AOBRCHR2'                                                    CER049
     C                     PARM *BLANKS   @RTCD                                               CER049
     C                     PARM '*KEY   ' @OPTN                                               CER049
     C                     PARM BBBRCD    @DSNB                                               CER049
     C           SDBRCE    PARM SDBRCE    DSSDY                                               CER049
     C           @RTCD     IFEQ *BLANKS                                                       CER049
     C                     MOVELSPCPY     SPCPY6  6                                        AR851784A
     C           SPCPY6    CHAINSDCUSQL0             99                                    AR851784A
     C           *IN99     IFEQ '0'                                                        AR851784A
     C**********           MOVE BXTAX     WCTAX                                     CER049 AR851784A
     C                     MOVE CQTAX     WCTAX                                            AR851784A
     C                     ENDIF                                                           AR851784A
     C                     ENDIF                                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
      ** Default Stamp Tax Liable                                                             CER049
      *                                                                                       CER049
     C           WSTAX     IFEQ 'Y'                                                           CER049
     C           WCTAX     ANDEQ'Y'                                                           CER049
     C           SPTAXL    ANDEQ*BLANK                                                        CER049
     C                     MOVE 'Y'       SPTAXL                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C           SPTAXL    IFNE 'N'                                                           CER049
     C           SPTAXL    ANDNE'Y'                                                           CER049
     C                     ADD  1         EC         67                                       CER049
     C                     MOVEL' 232'    ERR,EC                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C           P3TAX     IFEQ 'N'                                                           CER049
     C           SPTAXL    ANDEQ'Y'                                                           CER049
      *                                                                                       CER049
     C           WSTAX     IFNE 'Y'                                                           CER049
     C                     ADD  1         EC         67                                       CER049
     C                     MOVEL' 233'    ERR,EC                                              CER049
     C                     ENDIF                                                              CER049
     C           WCTAX     IFNE 'Y'                                                           CER049
     C                     ADD  1         EC         67                                       CER049
     C                     MOVEL' 234'    ERR,EC                                              CER049
     C                     ENDIF                                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C           *IN67     IFEQ '0'                                                           CER049
     C                     EXSR SRSTAX                                                        CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C                     ENDIF                                                              CER049
     C*
     C**  ERROR ON SCREEN SO HIGHLIGHT ERROR CODES
     C*
     C           EC        IFNE *ZERO
     C                     MOVELHI        ERRMSG
     C                     END
     C*                                                                   CEU005
     C** If CEU005 is on check for EURO Currency.                         CEU005
     C*                                                                   CEU005
     C           CEU005    IFEQ 'Y'                                       CEU005
     C           SPNCY     ANDEQBKEURO                                    CEU005
     C                     CALL 'AOCURRR0'                                CEU005
     C                     PARM *BLANKS   @RTCD                           CEU005
     C                     PARM '*KEY   ' @OPTN                           CEU005
     C                     PARM SPSCU     @AJCD                           CEU005
     C           SDCURR    PARM SDCURR    DSSDY                           CEU005
     C           @RTCD     IFNE *BLANKS                                   CEU005
     C                     MOVEL'SDCURRPD'DBFILE           ***************CEU005
     C                     MOVEL'022'     DBASE            * DBERROR 022 *CEU005
     C                     MOVELSPSCU     DBKEY            ***************CEU005
     C                     EXSR *PSSR                                     CEU005
     C                     END                                            CEU005
     C*                                                                   CEU005
     C** If the due currency is the EURO currency and the settlement      CEU005
     C** currency is 'in', the exchange rate should be equal to the EURO  143690
     C** rate & M/D indicator should be reversed.                         143690
     C***currency*is*'in',*the*exchange*rate*&*mult/div*indicator  CEU005 143690
     C***should*be*equal*to*the*EURO*rate*&*mult/div*indicator.    CEU005 143690
     C*                                                                   CEU005
     C           A6INCY    IFEQ 'Y'                                       CEU005
     C           RUND      ANDGEA6TPSD                                    CEU005
     C                     Z-ADD8         ZADEC                           CEU005
     C                     Z-ADD5         ZADIG                           CEU005
     C                     MOVE *BLANKS   ZFIELD                          CEU005
     C                     MOVELSPSXR     ZFIELD                          CEU005
     C                     EXSR ZALIGN                                    CEU005
     C           *LIKE     DEFN A6EUER    NUMEXC                          CEU005
     C                     MOVE ZFIELD    NUMEXC                          CEU005
     C           A6EUER    IFNE NUMEXC                                    CEU005
     C                     ADD  1         EC                              CEU005
     C                     SETON                     34                   CEU005
     C                     MOVEL' 228'    ERR,EC                          CEU005
     C                     END                                            CEU005
     C***********SPMDI     IFNE A6EUMD                             CEU005 143690
     C           SPMDI     IFEQ A6EUMD                                    143690
     C                     ADD  1         EC         51                   CEU005
     C                     MOVEL' 229'    ERR,EC                          CEU005
     C                     END                                            CEU005
     C                     ENDIF                                          CEU005
     C                     ENDIF                                          CEU005
     C*                                                                   CEU005
     C           CEU005    IFEQ 'Y'                                       CEU005
     C           SPSCU     ANDEQBKEURO                                    CEU005
     C                     CALL 'AOCURRR0'                                CEU005
     C                     PARM *BLANKS   @RTCD                           CEU005
     C                     PARM '*KEY   ' @OPTN                           CEU005
     C                     PARM SPNCY     @AJCD                           CEU005
     C           SDCURR    PARM SDCURR    DSSDY                           CEU005
     C           @RTCD     IFNE *BLANKS                                   CEU005
     C                     MOVEL'SDCURRPD'DBFILE           ***************CEU005
     C                     MOVEL'023'     DBASE            * DBERROR 023 *CEU005
     C                     MOVELSPNCY     DBKEY            ***************CEU005
     C                     EXSR *PSSR                                     CEU005
     C                     END                                            CEU005
     C*                                                                   CEU005
     C** If the settlement currency is the EURO currency and the due      CEU005
     C** currency is 'in', the exchange rate & mult/div indicator         CEU005
     C** should be equal to the EURO rate & M/D indicator.                143690
     C***should*be*equal*to*the*EURO*rate*&*reversed*mult/div      CEU005 143690
     C***indicator.                                                CEU005 143690
     C*                                                                   CEU005
     C           A6INCY    IFGE 'Y'                                       CEU005
     C           RUND      ANDGEA6TPSD                                    CEU005
     C                     Z-ADD8         ZADEC                           CEU005
     C                     Z-ADD5         ZADIG                           CEU005
     C                     MOVE *BLANKS   ZFIELD                          CEU005
     C                     MOVELSPSXR     ZFIELD                          CEU005
     C                     EXSR ZALIGN                                    CEU005
     C                     MOVE ZFIELD    NUMEXC                          CEU005
     C           A6EUER    IFNE NUMEXC                                    CEU005
     C                     ADD  1         EC                              CEU005
     C                     SETON                     34                   CEU005
     C                     MOVEL' 228'    ERR,EC                          CEU005
     C                     END                                            CEU005
     C***********A6EUMD    IFEQ 'M'                                CEU005 143690
     C***********SPMDI     ANDNE'D'                                CEU005 143690
     C***********A6EUMD    OREQ 'D'                                CEU005 143690
     C***********SPMDI     ANDNE'M'                                CEU005 143690
     C           SPMDI     IFNE A6EUMD                                    143690
     C                     ADD  1         EC         51                   CEU005
     C                     MOVEL' 229'    ERR,EC                          CEU005
     C                     END                                            CEU005
     C                     ENDIF                                          CEU005
     C                     ENDIF                                          CEU005
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************   S01447
      *                                                               *   S01447
      *  VALTAX  - Validate Tax deductible screen amounts             *   S01447
      *                                                               *   S01447
      *  CALLED FROM: VALIDD                                          *   S01447
      *                                                               *   S01447
      *  CALLS: ZALIGN                                                *   S01447
      *                                                               *   S01447
      *****************************************************************   S01447
      *                                                                   S01447
     C           VALTAX    BEGSR                                          S01447
      *                                                                   S01447
      *** Validate Tax amount deductible at source                        S01447
      ** If S01509 is active, use decimal places from due ccy             S01509
      *                                                                   S01447
     C           S01509    IFEQ 'Y'                                       S01509
     C                     Z-ADDPOSCDP    ZADEC                           S01509
     C           13        SUB  POSCDP    ZADIG                           S01509
     C                     ELSE                                           S01509
     C                     Z-ADDNOMCDP    ZADEC                           S01447
     C           13        SUB  NOMCDP    ZADIG                           S01447
     C                     END                                            S01509
     C                     CLEARZFIELD                                    S01447
     C                     MOVELSTASO     ZFIELD                          S01447
     C                     EXSR ZALIGN                                    S01447
     C           *IN99     IFEQ '1'                        *B1            S01447
     C                     ADD  1         EC         70                   S01447
     C                     MOVEL' 240'    ERR,EC                          S01447
     C                     ELSE                            *X1            S01447
     C                     MOVE ZFIELD    TASO                            S01447
     C           ZFSIGN    IFEQ '-'                        *B2            S01447
     C                     Z-SUBTASO      TASO                            S01447
     C                     END                             *E2            S01447
     C                     END                             *E1            S01447
      *                                                                   S01447
      *** Validate Tax amount deductible at source - refundable           S01447
      ** If S01509 is active, use decimal places from due ccy             S01509
      *                                                                   S01447
     C           S01509    IFEQ 'Y'                                       S01509
     C                     Z-ADDPOSCDP    ZADEC                           S01509
     C           13        SUB  POSCDP    ZADIG                           S01509
     C                     ELSE                                           S01509
     C                     Z-ADDNOMCDP    ZADEC                           S01447
     C           13        SUB  NOMCDP    ZADIG                           S01447
     C                     END                                            S01509
     C                     CLEARZFIELD                                    S01447
     C                     MOVELSTASR     ZFIELD                          S01447
     C                     EXSR ZALIGN                                    S01447
     C           *IN99     IFEQ '1'                        *B1            S01447
     C                     ADD  1         EC         71                   S01447
     C                     MOVEL' 241'    ERR,EC                          S01447
     C                     ELSE                            *X1            S01447
     C                     MOVE ZFIELD    TASR                            S01447
     C           ZFSIGN    IFEQ '-'                        *B2            S01447
     C                     Z-SUBTASR      TASR                            S01447
     C                     END                             *E2            S01447
     C                     END                             *E1            S01447
      *                                                                   S01447
      *** Validate Tax amount deducted by user                            S01447
      ** If S01509 is active, use decimal places from due ccy             S01509
      *                                                                   S01447
     C           S01509    IFEQ 'Y'                                       S01509
     C                     Z-ADDPOSCDP    ZADEC                           S01509
     C           13        SUB  POSCDP    ZADIG                           S01509
     C                     ELSE                                           S01509
     C                     Z-ADDNOMCDP    ZADEC                           S01447
     C           13        SUB  NOMCDP    ZADIG                           S01447
     C                     END                                            S01509
     C                     CLEARZFIELD                                    S01447
     C                     MOVELSTAUS     ZFIELD                          S01447
     C                     EXSR ZALIGN                                    S01447
     C           *IN99     IFEQ '1'                        *B1            S01447
     C                     ADD  1         EC         72                   S01447
     C                     MOVEL' 242'    ERR,EC                          S01447
     C                     ELSE                            *X1            S01447
     C                     MOVE ZFIELD    TAUS                            S01447
     C           ZFSIGN    IFEQ '-'                        *B2            S01447
     C                     Z-SUBTAUS      TAUS                            S01447
     C                     END                             *E2            S01447
     C                     END                             *E1            S01447
      *                                                                   S01447
      *** Error if Tax amount deducted at source is greater than amt      S01447
      *** due.                                                            S01447
      *                                                                   S01447
     C           *IN70     IFEQ '0'                        *B1            S01447
     C           *IN50     ANDEQ'0'                                       S01447
     C           TASO      ANDGTPAMD                                      S01447
     C                     ADD  1         EC         70                   S01447
     C                     MOVEL' 243'    ERR,EC                          S01447
     C                     END                             *E1            S01447
      *                                                                   S01447
     C                     ENDSR
      *****************************************************************                       233711
      /EJECT                                                                                  233711
      *****************************************************************                       233711
      *                                                               *                       233711
      * SRVTXN - Validate EU Tax amount.                              *                       233711
      *                                                               *                       233711
      *****************************************************************                       233711
     C           SRVTXN    BEGSR                                                              233711
      *                                                                                       233711
      ** EU Tax Amount Deducted - At Source                                                   233711
      *                                                                                       233711
     C           S01509    IFEQ 'Y'                                                           233711
     C                     Z-ADDPOSCDP    ZADEC                                               233711
     C           13        SUB  POSCDP    ZADIG                                               233711
     C                     MOVE POSCCY    WCCY    3                                           233711
     C                     ELSE                                                               233711
     C                     Z-ADDNOMCDP    ZADEC                                               233711
     C           13        SUB  NOMCDP    ZADIG                                               233711
     C                     MOVE NOMCCY    WCCY                                                233711
     C                     ENDIF                                                              233711
      *                                                                                       233711
     C                     MOVE *BLANKS   ZFIELD                                              233711
     C                     MOVELSTXNM     ZFIELD                                              233711
     C                     EXSR ZALIGN                                                        233711
      *                                                                                       233711
     C           *IN99     IFEQ *ON                                                           233711
     C                     ADD  1         EC                                                  233711
     C                     MOVE *ON       *IN76                                               233711
     C                     MOVEL' 801'    ERR,EC                                              233711
     C                     GOTO EVTXN                                                         233711
     C                     ENDIF                                                              233711
      *                                                                                       233711
     C                     MOVE ZFIELD    TXNM                                                233711
     C           ZFSIGN    IFEQ '-'                                                           233711
     C                     Z-SUBTXNM      TXNM                                                233711
     C                     ENDIF                                                              233711
      *                                                                                       233711
      ** EU Tax Amount in Settlement Currency                                                 233711
      *                                                                                       233711
     C           SPSCU     IFNE *BLANKS                                                       233711
     C           *IN37     ANDEQ*OFF                                                          233711
      *                                                                                       233711
     C           WCCY      IFEQ PSCU                                                          233711
     C                     Z-ADDTXNM      TXST                                                233711
     C                     ELSE                                                               233711
      *                                                                                       233711
     C                     MOVE WCCY      PCCY                                                233711
     C                     EXSR SRCURR                                                        233711
     C                     Z-ADDA6SPRT    ZRATE1 138                                          233711
     C                     MOVE A6MDIN    ZMDI1   1                                           233711
     C                     MOVE A6NBDP    ZCDPI                                               233711
      *                                                                                       233711
     C                     MOVE PSCU      PCCY                                                233711
     C                     EXSR SRCURR                                                        233711
     C                     Z-ADDA6SPRT    ZRATE2 138                                          233711
     C                     MOVE A6MDIN    ZMDI2   1                                           233711
     C                     MOVE A6NBDP    ZCDPO                                               233711
      *                                                                                       233711
     C                     EXSR ZXRATE                                                        233711
      *                                                                                       233711
     C                     Z-ADDTXNM      ZAMTCI                                              233711
     C                     Z-ADDZRATEX    ZEXCH                                               233711
     C                     MOVE ZMDIX     ZMD                                                 233711
     C                     MOVE WCCY      ZCCYI                                               233711
     C                     MOVE PSCU      ZCCYO                                               233711
      *                                                                                       233711
     C                     EXSR ZCONV                                                         233711
     C                     Z-ADDZAMTCO    TXST                                                233711
     C                     ENDIF                                                              233711
      *                                                                                       233711
     C                     ENDIF                                                              233711
      *                                                                                       233711
      ** Get tax currency if necessary.                                                       233711
      *                                                                                       233711
     C           TXCY      IFEQ *BLANKS                                                       233711
      *                                                                                       233711
     C                     MOVE PBCA      PBRCH                                               233711
     C                     EXSR SRBRCH                                                        233711
     C                     MOVE A8LCCD    PLOCN                                               233711
     C                     EXSR SRLOCN                                                        233711
     C                     MOVE DVCNCD    PCTRY                                               233711
     C                     EXSR SRCTRY                                                        233711
      *                                                                                       233711
     C           A4TXCY    IFNE *BLANKS                                                       233711
     C                     MOVE A4TXCY    TXCY                                                233711
     C                     ELSE                                                               233711
     C                     MOVE WCCY      TXCY                                                233711
     C                     ENDIF                                                              233711
      *                                                                                       233711
     C                     ENDIF                                                              233711
      *                                                                                       233711
      ** EU Tax Amount in Tax Currency                                                        233711
      *                                                                                       233711
     C           WCCY      IFEQ TXCY                                                          233711
     C                     Z-ADDTXNM      TAXA                                                233711
     C                     ELSE                                                               233711
      *                                                                                       233711
     C                     MOVE WCCY      PCCY                                                233711
     C                     EXSR SRCURR                                                        233711
     C                     Z-ADDA6SPRT    ZRATE1 138                                          233711
     C                     MOVE A6MDIN    ZMDI1   1                                           233711
     C                     MOVE A6NBDP    ZCDPI                                               233711
      *                                                                                       233711
     C                     MOVE TXCY      PCCY                                                233711
     C                     EXSR SRCURR                                                        233711
     C                     Z-ADDA6SPRT    ZRATE2 138                                          233711
     C                     MOVE A6MDIN    ZMDI2   1                                           233711
     C                     MOVE A6NBDP    ZCDPO                                               233711
      *                                                                                       233711
     C                     EXSR ZXRATE                                                        233711
      *                                                                                       233711
     C                     Z-ADDTXNM      ZAMTCI                                              233711
     C                     Z-ADDZRATEX    ZEXCH                                               233711
     C                     MOVE ZMDIX     ZMD                                                 233711
     C                     MOVE WCCY      ZCCYI                                               233711
     C                     MOVE TXCY      ZCCYO                                               233711
      *                                                                                       233711
     C                     EXSR ZCONV                                                         233711
     C                     Z-ADDZAMTCO    TAXA                                                233711
     C                     ENDIF                                                              233711
      *                                                                                       233711
     C           EVTXN     ENDSR                                                              233711
      *****************************************************************                       233711
      /EJECT                                                                                  233711
      *****************************************************************                       233711
      *                                                               *                       233711
      *  SRBRCH - Gets branch details.                                *                       233711
      *                                                               *                       233711
      *****************************************************************                       233711
     C           SRBRCH    BEGSR                                                              233711
      *                                                                                       233711
     C                     CALL 'AOBRCHR0'                                                    233711
     C                     PARM *BLANKS   PRTCD                                               233711
     C                     PARM '*KEY   ' POPTN                                               233711
     C                     PARM           PBRCH   3                                           233711
     C           SDBRCH    PARM SDBRCH    DSFDY                                               233711
      *                                                                                       233711
     C           PRTCD     IFNE *BLANKS                                                       233711
     C           *LOCK     IN   LDA                                                           233711
     C                     MOVEL'SDBRCHPD'DBFILE                                              233711
     C                     MOVELPBRCH     DBKEY                                               233711
     C                     Z-ADD102       DBASE                                               233711
     C                     OUT  LDA                                                           233711
     C                     MOVE *ON       *INU7                                               233711
     C                     MOVE *ON       *INU8                                               233711
     C                     MOVE *ON       *INLR                                               233711
     C                     EXSR *PSSR                                                         233711
     C                     ENDIF                                                              233711
      *                                                                                       233711
     C                     ENDSR                                                              233711
      *****************************************************************                       233711
      /EJECT                                                                                  233711
      *****************************************************************                       233711
      *                                                               *                       233711
      *  SRLOCN - Gets location details.                              *                       233711
      *                                                               *                       233711
      *****************************************************************                       233711
     C           SRLOCN    BEGSR                                                              233711
      *                                                                                       233711
     C                     CALL 'AOLOCNR0'                                                    233711
     C                     PARM *BLANKS   PRTCD                                               233711
     C                     PARM '*KEY   ' POPTN                                               233711
     C                     PARM           PLOCN   3                                           233711
     C           SDLOCN    PARM SDLOCN    DSFDY                                               233711
      *                                                                                       233711
     C           PRTCD     IFNE *BLANKS                                                       233711
     C           *LOCK     IN   LDA                                                           233711
     C                     MOVEL'SDLOCNPD'DBFILE                                              233711
     C                     MOVELPLOCN     DBKEY                                               233711
     C                     Z-ADD103       DBASE                                               233711
     C                     OUT  LDA                                                           233711
     C                     MOVE *ON       *INU7                                               233711
     C                     MOVE *ON       *INU8                                               233711
     C                     MOVE *ON       *INLR                                               233711
     C                     EXSR *PSSR                                                         233711
     C                     ENDIF                                                              233711
      *                                                                                       233711
     C                     ENDSR                                                              233711
      *****************************************************************                       233711
      /EJECT                                                                                  233711
      *****************************************************************                       233711
      *                                                               *                       233711
      *  SRCTRY - Gets country details.                               *                       233711
      *                                                               *                       233711
      *****************************************************************                       233711
     C           SRCTRY    BEGSR                                                              233711
      *                                                                                       233711
     C                     CALL 'AOCTRYR0'                                                    233711
     C                     PARM *BLANKS   PRTCD                                               233711
     C                     PARM '*KEY   ' POPTN                                               233711
     C                     PARM           PCTRY   2                                           233711
     C           SDCTRY    PARM SDCTRY    DSFDY                                               233711
      *                                                                                       233711
     C           PRTCD     IFNE *BLANKS                                                       233711
     C           *LOCK     IN   LDA                                                           233711
     C                     MOVEL'SDCTRYPD'DBFILE                                              233711
     C                     MOVELPCTRY     DBKEY                                               233711
     C                     Z-ADD104       DBASE                                               233711
     C                     OUT  LDA                                                           233711
     C                     MOVE *ON       *INU7                                               233711
     C                     MOVE *ON       *INU8                                               233711
     C                     MOVE *ON       *INLR                                               233711
     C                     EXSR *PSSR                                                         233711
     C                     ENDIF                                                              233711
      *                                                                                       233711
     C                     ENDSR                                                              233711
      *****************************************************************                       233711
      /EJECT                                                                                  233711
      *****************************************************************                       233711
      *                                                               *                       233711
      *  SRCURR - Gets currency details.                              *                       233711
      *                                                               *                       233711
      *****************************************************************                       233711
     C           SRCURR    BEGSR                                                              233711
      *                                                                                       233711
     C                     CALL 'AOCURRR0'                                                    233711
     C                     PARM *BLANKS   PRTCD                                               233711
     C                     PARM '*KEY   ' POPTN                                               233711
     C                     PARM           PCCY    3                                           233711
     C           SDCURR    PARM SDCURR    DSSDY                                               233711
      *                                                                                       233711
     C           PRTCD     IFNE *BLANKS                                                       233711
     C           *LOCK     IN   LDA                                                           233711
     C                     MOVEL'SDCURRPD'DBFILE                                              233711
     C                     MOVELPCCY      DBKEY                                               233711
     C                     Z-ADD105       DBASE                                               233711
     C                     OUT  LDA                                                           233711
     C                     MOVE *ON       *INU7                                               233711
     C                     MOVE *ON       *INU8                                               233711
     C                     MOVE *ON       *INLR                                               233711
     C                     EXSR *PSSR                                                         233711
     C                     ENDIF                                                              233711
      *                                                                                       233711
     C                     ENDSR                                                              233711
      *****************************************************************                       233711
      *                                                                   S01447
     C*****************************************************************   S01447
      /EJECT                                                              S01447
      *****************************************************************   CSE023
      *                                                               *   CSE023
      *  WITHTX - Calculate withholding tax.                          *   CSE023
      *                                                               *   CSE023
      *  CALLED FROM: VALIDD                                          *   CSE023
      *                                                               *   CSE023
      *  CALLS: CLDAMT                                                *   CSE023
      *                                                               *   CSE023
      *****************************************************************   CSE023
      *                                                                   CSE023
     C           WITHTX    BEGSR                                          CSE023
      *                                                                   CSE023
      ** Set Tax Deducted at Source Refundable to zero, reset other tax   CSE023
      ** fields as well.                                                  CSE023
     C                     Z-ADD0         TASR                            CSE023
     C                     Z-ADD0         TASO                            CSE023
     C                     Z-ADD0         TAUS                            CSE023
      *                                                                   CSE023
      ** Retrieve withholding tax treaty details, issue database error    CSE023
      ** if not found as record should be present on the withholding      CSE023
      ** tax details file.                                                CSE023
      *                                                                   CSE023
     C                     MOVE CRTT      KYCRTT                          185397
     C                     MOVE SITP      @SITP                           CSE023
     C                     MOVE BBCOLC    @BCOLC                          CSE023
     C           WTFKEY    CHAINSDWHTTL0             99                   CSE023
     C           *IN99     IFEQ '1'                                       CSE023
     C                     MOVE '0'       *IN99                           CSE023
     C                     MOVE '   '     @SITP                           CSE023
     C           WTFKEY    CHAINSDWHTTL0             99                   CSE023
     C                     ENDIF                                          CSE023
     C           *IN99     IFEQ '1'                                       CSE023
     C                     MOVE '0'       *IN99                           CSE023
     C                     MOVE SITP      @SITP                           CSE023
     C           WTPKEY    CHAINSDWHTTL0             99                   CSE023
     C                     ENDIF                                          CSE023
     C           *IN99     IFEQ '1'                                       CSE023
     C                     MOVE '0'       *IN99                           CSE023
     C                     MOVE '   '     @SITP                           CSE023
     C           WTPKEY    CHAINSDWHTTL0             99                   CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C           *IN99     IFEQ '1'                                       CSE023
     C                     MOVELKYCRTT    WTEMP1                          CSE023
     C                     MOVE SITP      WTEMP1                          CSE023
     C                     MOVELWTEMP1    WTEMP2                          CSE023
     C                     MOVE BBCOLC    WTEMP2                          CSE023
     C                     MOVEL'SDWHTTPD'DBFILE           ***************CSE023
     C                     Z-ADD26        DBASE            * DB ERROR 26 *CSE023
     C                     MOVELWTEMP2    DBKEY            ***************CSE023
     C                     EXSR *PSSR                                     CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C           STXBS     IFNE *BLANKS                                   CSE023
     C                     CALL 'AOTXBSR0'                                CSE023
     C                     PARM *BLANKS   PIRTCD  7                       CSE023
     C                     PARM '*KEY   ' PIOPTN  7                       CSE023
     C                     PARM KYCRTT    PICRTT  2                       CSE023
     C                     PARM STXBS     PITXBS  2                       CSE023
     C                     PARM PDUD      PIDATE  50                      CSE023
     C                     PARM *BLANKS   PINARR 15                       CSE023
     C                     PARM *ZEROS    PIRATE  64                      CSE023
      *                                                                   CSE023
     C                     ELSE                                           CSE023
     C                     Z-ADD0         PIRATE                          CSE023
     C                     MOVE *BLANKS   PINARR                          CSE023
     C                     END                                            CSE023
      *                                                                   185397
     C                     MOVE PINARR    TXBN                            185397
      *                                                                   CSE023
      ** Setup amount to used for computing the tax fields.               CSE023
      *                                                                   CSE023
     C           PEVT      IFEQ 'MT'                                      CSE023
     C                     EXSR CLDAMT                                    CSE023
     C                     Z-ADDWDAMT     WPAMT  130                      CSE023
     C                     ELSE                                           CSE023
     C                     Z-ADDPAMD      WPAMT                           CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
      ** Calculate tax deducted at source or tax deducted at user         CSE023
      ** using the tax rate retrieve based on the customers withholding   CSE023
      ** tax details.                                                     CSE023
      *                                                                   CSE023
     C                     SELEC                                          CSE023
     C           WTDTSU    WHEQ 'S'                                       CSE023
     C           WPAMT     MULT PIRATE    TASO                            CSE023
     C           TASO      DIV  100       TASO                            CSE023
      *                                                                   CSE023
     C                     MOVE TASO      ZFLD15                          CSE023
      *                                                                   CSE023
     C           S01509    IFEQ 'Y'                                       CSE023
     C                     Z-ADDPOSCDP    ZDECS                           CSE023
     C                     ELSE                                           CSE023
     C                     Z-ADDNOMCDP    ZDECS                           CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C                     MOVE ' '       ZECODE                          CSE023
     C                     EXSR ZSEDIT                                    CSE023
     C                     MOVE ZOUT21    STASO                           CSE023
      *                                                                   CSE023
     C                     OTHER                                          CSE023
     C           WPAMT     MULT PIRATE    TAUS                            CSE023
     C           TAUS      DIV  100       TAUS                            CSE023
      *                                                                   CSE023
     C                     MOVE TAUS      ZFLD15                          CSE023
      *                                                                   CSE023
     C           S01509    IFEQ 'Y'                                       CSE023
     C                     Z-ADDPOSCDP    ZDECS                           CSE023
     C                     ELSE                                           CSE023
     C                     Z-ADDNOMCDP    ZDECS                           CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C                     MOVE ' '       ZECODE                          CSE023
     C                     EXSR ZSEDIT                                    CSE023
     C                     MOVE ZOUT21    STAUS                           CSE023
     C                     ENDSL                                          CSE023
      *                                                                   CSE023
      *                                                                   CSE023
     C                     ENDSR                                          CSE023
      *                                                                   CSE023
      *****************************************************************   CSE023
      /EJECT                                                              CSE023
      *****************************************************************   CSE023
      *                                                               *   CSE023
      *  CLDAMT - Calculate discounted amount.                        *   CSE023
      *                                                               *   CSE023
      *  CALLED FROM: VALIDD, UPDFLS                                  *   CSE023
      *                                                               *   CSE023
      *  CALLS:                                                       *   CSE023
      *                                                               *   CSE023
      *****************************************************************   CSE023
      *                                                                   CSE023
     C           CLDAMT    BEGSR                                          CSE023
      *                                                                   CSE023
     C                     Z-ADD0         WDAMT                           CSE023
      *                                                                   CSE023
     C           BFCLAS    IFEQ 'S'                                       CSE023
     C********** BFCLAS    ANDEQ'D'                                CSE023 186055
     C           BFCLAS    OREQ 'D'                                       186055
      *                                                                   CSE023
      ** Total discount amount - based on Original Interest Discount,     CSE023
      ** reset or calculate.                                              CSE023
     C           OIDI      IFEQ 'Y'                                       CSE023
      *                                                                   CSE023
      ** Setup key field combination for customer positions file.         CSE023
     C**********           MOVELKYCSNO    KYCSCN                   CSE023 186055
     C                     MOVELPCPY      KYCSCN                          186055
     C                     SELEC                                          CSE023
     C           SPBCA     WHNE *BLANKS                                   CSE023
     C                     MOVELSPBCA     KYPBCA                          CSE023
     C                     OTHER                                          CSE023
     C                     MOVELBJSBRC    KYPBCA                          CSE023
     C                     ENDSL                                          CSE023
      *                                                                   CSE023
     C           WCPKEY    SETGTCPOSH                                     CSE023
     C                     READPCPOSH                    99               CSE023
     C                     MOVELCSCN      WCSCN   6                       CSE023
      *                                                                   CSE023
     C           CSBA      IFNE KYPBCA                                    CSE023
     C********** WCSCN     ORNE KYCSNO                             CSE023 186055
     C           CSCN      ORNE KYCSCN                                    186055
     C           CSSC      ORNE SPSSH                                     CSE023
     C                     MOVELKYPBCA    WTEMP3                          CSE023
     C                     MOVE SPSSH     WTEMP3                          CSE023
     C                     MOVELWTEMP3    WTEMP4                          CSE023
     C                     MOVE KYCSCN    WTEMP4                          CSE023
     C                     MOVEL'CPOSND'  DBFILE           ***************CSE023
     C                     Z-ADD25        DBASE            * DBERROR 025 *CSE023
     C                     MOVELWTEMP4    DBKEY            ***************CSE023
     C                     EXSR *PSSR                                     CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
      ** Calculate Total Discount Amount if nominal not zero.             CSE023
     C           PNMP      IFNE 0                                         CSE023
     C**********           Z-ADD0         WDAMT  130               CSE023 186055
     C                     Z-ADD0         WDAMT  210                      186055
     C           PNMP      MULT CSPT      WDAMT                           CSE023
     C           WDAMT     DIV  CSNT      WDAMT                           CSE023
     C********** PNMP      SUB  WDAMT     WDAMT                    CSE023 186055
     C           NOMCDP    ADD  1         A       10                      186055
     C           PNMP      MULT AP,A      PNMPAT 210                      186055
     C           PNMPAT    SUB  WDAMT     WDAMT                           186055
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C                     ENDSR                                          CSE023
      *                                                                   CSE023
      *****************************************************************   CSE023
      /EJECT                                                              CSE023
     C*****************************************************************
     C*                                                               *
     C*  DEFLTS  - S/R TO FORMAT DEFAULT FIELD VALUES FOR INSERT SCRN *
     C*  CALLED FROM: UPDATE, VALIDD                                  *
     C*  CALLS: ZSEDIT                                                *
     C*                                                               *
     C*****************************************************************
     C*
     C           DEFLTS    BEGSR
     C*
     C                     MOVE '1'       *IN89
     C           ACTN      IFEQ 'I'
     C*                                                                   S01512
     C** Blank out screen fields                                          S01512
     C*                                                                   S01512
     C                     MOVE *BLANKS   SPNMP                           S01512
     C                     MOVE *BLANKS   SPBCD                           S01512
     C                     MOVE *BLANKS   SPAMD                           S01512
     C                     MOVE *BLANKS   SPPRE                           S01512
     C                     MOVE *BLANKS   SPSCU                           S01512
     C                     MOVE *BLANKS   XSPSCU                          151506
     C                     MOVE *BLANKS   SPMDI                           S01512
     C                     MOVE *BLANKS   SPBRX                           S01512
     C                     MOVE *BLANKS   SPSMT                           S01512
     C                     MOVE *BLANKS   SPSEA                           S01512
     C                     MOVE *BLANKS   SPSEB                           S01512
     C                     MOVE *BLANKS   SPCPN                           S01512
     C                     MOVE *BLANKS   SPFAC                           S01512
     C                     MOVE *BLANKS   SPSPI                           S01512
     C                     MOVE *BLANKS   SPCHC                           S01512
     C                     MOVE *BLANKS   SPCHA                           S01512
     C                     MOVE *BLANKS   SPCCD                           S01512
     C                     MOVE *BLANKS   SPCAM                           S01512
     C                     MOVE *BLANKS   SPSAT                           S01512
     C                     MOVE *BLANKS   SPSXR                           S01512
     C                     MOVE *BLANKS   SPSVL                           S01512
     C                     MOVE *BLANKS   XSPSVL                          S01512
     C                     MOVE *BLANKS   SFXMP                           CAC002
     C                     MOVE *BLANKS   SMAMT                           CAC002
     C                     MOVE *BLANKS   SPTAXL                                              CER049
      *                                                                   S01447
      *** If S01447 is ON and event is dividend or coupon, set zero       S01447
      *** tax fields.                                                     S01447
     C           S01447    IFEQ 'Y'                                       S01447
     C           PEVT      IFEQ 'CP'                       *B2            S01447
     C           PEVT      OREQ 'DV'                                      S01447
     C                     CLEARSTASO                                     S01447
     C                     CLEARSTASR                                     S01447
     C                     CLEARSTAUS                                     S01447
     C                     END                             *E2            S01447
     C           CSE023    IFEQ 'Y'                                       186166
     C           PEVT      ANDEQ'MT'                                      186166
     C                     CLEARSTASO                                     186166
     C                     CLEARSTASR                                     186166
     C                     CLEARSTAUS                                     186166
     C                     ENDIF                                          186166
     C                     END                             *E1            S01447
      *                                                                   S01447
     C           S01509    IFEQ 'N'                                       S01509
     C                     MOVELNMCY      SPNCY
     C                     MOVELNMCY      PNCY
     C                     END                                            S01509
     C*                                                                   S01117
     C**  Default SPPFC from Profit Centre Position record                S01117
     C**   if 'Profit Centre Used' indicator on                           S01117
     C*                                                                   S01117
     C           *IN82     IFEQ '1'                                       S01117
     C           *IN84     ANDNE'1'                                       S01117
     C                     MOVEL*BLANKS   SPPFC                           S01117
     C**********           Z-ADDPCPY      PCCNM   60                                   S01117 CSD027
     C                     MOVE PCPY      PCCNM   6                                           CSD027
     C                     MOVELPBCA      PCBCA   3                       S01117
     C                     MOVELPSSH      PCSSN  10                       S01117
     C           SEPCCK    CHAINSEPCCDF              99                   S01117
     C           *IN99     IFEQ '0'                                       S01117
     C                     MOVELPCCU      SPPFC                           S01117
     C*                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVELPCCU      PPFC                            CAC002
     C                     SETON                     68                   CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C                     END                                            S01117
     C*                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C           *IN99     IFEQ '1'                                       CAC002
     C                     MOVEL*BLANKS   SPPFC                           CAC002
     C                     MOVEL*BLANKS   PPFC                            CAC002
     C                     SETOF                     68                   CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C                     END                                            S01117
     C*
     C**  DEFAULTS FOR PAY/RECEIVE INDICATOR
     C*
     C           SPPRE     IFEQ *BLANKS
     C           PPRE      ANDEQ*BLANKS
     C***********C1DI      IFNE 'S'                                       S01117
     C***********C1DI      ANDNE'D'                                       S01117
     C           BFCLAS    IFNE 'S'                                       S01117
     C           BFCLAS    ANDNE'D'                                       S01117
     C           PEVT      IFEQ 'PP'
     C                     MOVE 'P'       SPPRE
     C                     ELSE
     C                     MOVE 'R'       SPPRE
     C                     END
     C                     ELSE
     C           PEVT      IFNE 'PP'
     C                     MOVE 'P'       SPPRE
     C                     ELSE
     C                     MOVE 'R'       SPPRE
     C                     END
     C                     END
     C                     END
     C/COPY WNCPYSRC,SE0170C088
     C*
     C**  DEFAULTS FOR SETTLEMENT CURRENCY
     C** If not already entered                                           S01509
     C*
     C           SPSCU     IFEQ *BLANKS
     C           PSCU      ANDEQ*BLANKS
     C*                                                                   S01509
     C** If S01509 is active,                                             S01509
     C** Issuers settlement ccy depends on event type                     S01509
     C** (NB VLCY = SPYC always)                                          S01509
     C*                                                                   S01509
     C           S01509    IFEQ 'Y'                                       S01509
     C                     SELEC                                          S01509
     C*                                                                   S01509
     C           PEVT      WHEQ 'PP'                                      S01509
     C           PEVT      OREQ 'MP'                                      S01509
     C                     MOVE NMCY      WPSETC                          S01509
     C                     MOVE NMCY      SPNCY                           S01509
     C*                                                                   S01509
     C           PEVT      WHEQ 'MT'                                      S01509
     C           WRKEY     KLIST                                          S01509
     C                     KFLD           SPSSH                           S01509
     C                     KFLD           WPDUD                           S01509
     C                     KFLD           WETYP   2                       S01509
     C                     MOVELSPDUD     ZDATE                           S01509
     C                     EXSR ZDATE1                                    S01509
     C                     Z-ADDZDAYNO    WPDUD                           S01509
     C                     MOVE 'RC'      WETYP                           S01509
     C           WRKEY     CHAINSEDEV                90                   S01509
     C           *IN90     IFEQ '0'                                       S01509
     C           SDCX      ANDNE*BLANKS                                   S01509
     C                     MOVE SDCX      WPSETC                          S01509
     C                     MOVE SDCX      SPNCY                           S01509
     C                     ELSE                                           S01509
     C                     MOVE NMCY      WPSETC                          S01509
     C                     MOVE NMCY      SPNCY                           S01509
     C                     END                                            S01509
     C*                                                                   S01509
     C                     OTHER                                          S01509
     C                     MOVE VLCY      WPSETC  3                       S01509
     C                     MOVE VLCY      SPNCY                           S01509
     C*                                                                   S01509
     C                     ENDSL                                          S01509
     C                     END                                            S01509
     C*                                                                   S01509
     C** If a portfolio customer there may be a preferred settlement ccy  S01509
     C*                                                                   S01509
     C***********C1DI      IFEQ 'S'                                       S01117
     C***********C1DI      OREQ 'D'                                       S01117
     C           BFCLAS    IFEQ 'S'                                       S01117
     C           BFCLAS    OREQ 'D'                                       S01117
     C*                                                                   S01509
     C**   .. does the customer have standard settlements?                S01509
     C*                                                                   S01509
     C           S01509    IFEQ 'Y'                                       S01509
     C                     MOVELWPSETC    CURK    3                       S01509
     C                     ELSE                                           S01509
     C                     MOVELVLCY      CURK    3
     C                     END                                            S01509
     C/COPY WNCPYSRC,SE0170C036
      *                                                                                       CSE028
      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
      *                                                                                       CSE028
     C                     MOVE PBCD      WBKCD                                               CSE028
     C                     EXSR SRSSIR                                                        CSE028
     C           NOTFND    IFEQ 'Y'                                                           CSE028
     C                     MOVE '1'       *IN99                                               CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE '0'       *IN99                                               CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     ELSE                                                               CSE028
      *                                                                                       CSE028
     C                     MOVE *BLANKS   WBKCD                                               CSE028
      *                                                                                       CSE028
     C           STDSEK    CHAINSTDSED               99
      *                                                                                       CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C/COPY WNCPYSRC,SE0170C037
     C           *IN99     IFEQ '0'
     C*                                                                   CEU005
     C** If CEU005 is active use date defaults here.                      CEU005
     C*                                                                   CEU005
     C           CEU005    IFEQ 'Y'                                       CEU005
     C           S01512    IFEQ 'Y'                                       CEU005
     C           PSVL      IFEQ 0                                         CEU005
     C                     MOVELSPDUD     SPSVL                           CEU005
     C                     MOVE SPDUD     ZDATE                           CEU005
     C                     EXSR ZDATE1                                    CEU005
     C                     MOVELZDAYNO    PSVL                            CEU005
     C                     ELSE                                           CEU005
     C                     Z-ADDPSVL      ZDAYNO                          CEU005
     C                     EXSR ZDATE2                                    CEU005
     C                     MOVELZDATE     SPSVL                           CEU005
     C                     END                                            CEU005
     C                     END                                            CEU005
     C                     ENDIF                                          CEU005
     C*                                                                   CEU005
     C** If CEU005 is on check for EURO Currency.                         CEU005
     C*                                                                   CEU005
     C           CEU005    IFEQ 'Y'                                       CEU005
     C           SCCY      ANDNE*BLANKS                                   CEU005
     C*                                                                   CEU005
     C** If the Due Currency is the EURO Currency.                        CEU005
     C*                                                                   CEU005
     C           SPNCY     IFEQ BKEURO                                    CEU005
     C                     CALL 'AOCURRR0'                                CEU005
     C                     PARM *BLANKS   @RTCD                           CEU005
     C                     PARM '*KEY   ' @OPTN                           CEU005
     C                     PARM SCCY      @AJCD                           CEU005
     C           SDCURR    PARM SDCURR    DSSDY                           CEU005
     C           @RTCD     IFNE *BLANKS                                   CEU005
     C                     MOVEL'SDCURRPD'DBFILE           ***************CEU005
     C                     MOVEL'018'     DBASE            * DBERROR 018 *CEU005
     C                     MOVELSCCY      DBKEY            ***************CEU005
     C                     EXSR *PSSR                                     CEU005
     C                     END                                            CEU005
     C                     Z-ADD0         DATE    50                      CEU005
     C                     MOVE PSVL      DATE                            CEU005
     C*                                                                   CEU005
     C** If the Currency is 'IN' then enter the exchange rate             CEU005
     C** and mult/div indicator of the currency into POSETD.              CEU005
     C*                                                                   CEU005
     C           A6INCY    IFEQ 'Y'                                       CEU005
     C           DATE      ANDGEA6TPSD                                    CEU005
     C                     Z-ADDA6EUER    PSXR                            CEU005
     C                     MOVE PSXR      ZFLD15                          CEU005
     C                     Z-ADD8         ZDECS                           CEU005
     C                     MOVE ' '       ZECODE                          CEU005
     C                     EXSR ZSEDIT                                    CEU005
     C                     MOVEL*BLANKS   SPSXR                           CEU005
     C                     MOVE ZOUT21    SPSXR                           CEU005
     C*                                                                   CEU005
     C           A6EUMD    IFEQ 'M'                                       143690
     C                     MOVE 'D'       PMDI                            143690
     C                     MOVE 'D'       SPMDI                           143690
     C                     ELSE                                           143690
     C                     MOVE 'M'       PMDI                            143690
     C                     MOVE 'M'       SPMDI                           143690
     C                     ENDIF                                          143690
     C***********          MOVE A6EUMD    PMDI                     CEU005 143690
     C***********          MOVE A6EUMD    SPMDI                    CEU005 143690
     C                     ENDIF                                          CEU005
     C*                                                                   CEU005
     C                     ENDIF                                          CEU005
     C*                                                                   CEU005
     C** If the Settlement Currency is the EURO Currency.                 CEU005
     C*                                                                   CEU005
     C           SCCY      IFEQ BKEURO                                    CEU005
     C                     CALL 'AOCURRR0'                                CEU005
     C                     PARM *BLANKS   @RTCD                           CEU005
     C                     PARM '*KEY   ' @OPTN                           CEU005
     C                     PARM SPNCY     @AJCD                           CEU005
     C           SDCURR    PARM SDCURR    DSSDY                           CEU005
     C           @RTCD     IFNE *BLANKS                                   CEU005
     C                     MOVEL'SDCURRPD'DBFILE           ***************CEU005
     C                     MOVEL'019'     DBASE            * DBERROR 019 *CEU005
     C                     MOVELSPNCY     DBKEY            ***************CEU005
     C                     EXSR *PSSR                                     CEU005
     C                     END                                            CEU005
     C                     Z-ADD0         DATE                            CEU005
     C                     MOVELPSVL      DATE                            CEU005
     C*                                                                   CEU005
     C** If the Currency is 'IN' then enter the exchange rate             CEU005
     C** and mult/div indicator of the currency into POSETD.              CEU005
     C*                                                                   CEU005
     C           A6INCY    IFEQ 'Y'                                       CEU005
     C           DATE      ANDGEA6TPSD                                    CEU005
     C                     Z-ADDA6EUER    PSXR                            CEU005
     C                     MOVE PSXR      ZFLD15                          CEU005
     C                     Z-ADD8         ZDECS                           CEU005
     C                     MOVE ' '       ZECODE                          CEU005
     C                     EXSR ZSEDIT                                    CEU005
     C                     MOVEL*BLANKS   SPSXR                           CEU005
     C                     MOVE ZOUT21    SPSXR                           CEU005
     C*                                                                   CEU005
     C                     MOVE A6EUMD    PMDI                            143690
     C                     MOVE A6EUMD    SPMDI                           143690
     C***********A6EUMD    IFEQ 'M'                                CEU005 143690
     C***********          MOVE 'D'       PMDI                     CEU005 143690
     C***********          MOVE 'D'       SPMDI                    CEU005 143690
     C***********          ELSE                                    CEU005 143690
     C***********          MOVE 'M'       PMDI                     CEU005 143690
     C***********          MOVE 'M'       SPMDI                    CEU005 143690
     C***********          ENDIF                                   CEU005 143690
     C                     ENDIF                                          CEU005
     C*                                                                   CEU005
     C                     ENDIF                                          CEU005
     C*                                                                   CEU005
     C** Check for settlement details for Settlement Currency.            CEU005
     C*                                                                   CEU005
     C                     MOVELSCCY      PSCU      P                     CEU005
     C                     MOVELSCCY      WPSETC    P                     CEU005
     C           SCCY      IFNE CURK                                      CEU005
     C                     MOVELSCCY      CURK      P                     CEU005
     C/COPY WNCPYSRC,SE0170C083
     C           STDSEK    SETLLSTDSED                   99               CEU005
     C           *IN99     IFEQ '1'                                       CEU005
      *                                                                                       CSE028
      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
      *                                                                                       CSE028
     C                     MOVE PBCD      WBKCD                                               CSE028
     C                     EXSR SRSSIR                                                        CSE028
     C           NOTFND    IFEQ 'Y'                                                           CSE028
     C                     MOVE '1'       *IN99                                               CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE '0'       *IN99                                               CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     ELSE                                                               CSE028
      *                                                                                       CSE028
     C                     MOVE *BLANKS   WBKCD                                               CSE028
      *                                                                                       CSE028
     C           STDSEK    CHAINSTDSED               99                   CEU005
      *                                                                                       CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     ELSE                                           CEU005
     C*                                                                   CEU005
     C** Blank out fields if no currency settlements instructions         CEU005
     C*                                                                   CEU005
     C                     MOVE *BLANKS   SRSM                            CEU005
     C                     MOVE *BLANKS   SRAC                            CEU005
     C                     MOVE *BLANKS   SRAB                            CEU005
     C                     MOVE *BLANKS   SRCB                            CEU005
     C                     MOVE *BLANKS   SPSM                            CEU005
     C                     MOVE *BLANKS   SPAT                            CEU005
     C                     MOVE *BLANKS   SPBA                            CEU005
     C                     MOVE *BLANKS   SPCB                            CEU005
     C                     MOVE *BLANKS   SPFA                            CEU005
     C                     MOVE *BLANKS   SPSI                            CEU005
     C                     MOVE *BLANKS   SPCP                            CEU005
     C                     ENDIF                                          CEU005
     C/COPY WNCPYSRC,SE0170C084
     C                     ENDIF                                          CEU005
     C                     ENDIF                                          CEU005
     C*                                                                   CEU005
     C           S01509    IFEQ 'Y'                                       S01509
     C                     MOVELWPSETC    SPSCU                           S01509
     C                     ELSE                                           S01509
     C                     MOVELVLCY      SPSCU
     C                     END                                            S01509
     C*                                                                   S01509
     C**  .. else does the customer have a normal settlement CCY?         S01509
     C*                                                                   S01509
     C                     ELSE
     C***********C1SC      IFNE *BLANKS                                   S01117
     C***********          MOVELC1SC      SPSCU                           S01117
     C           BFCYCD    IFNE *BLANKS                                   S01117
     C                     MOVELBFCYCD    SPSCU                           S01117
     C                     ELSE
     C*                                                                   S01509
     C** If S01509 is active default to the ccy expected by the user      S01509
     C*                                                                   S01509
     C           S01509    IFEQ 'Y'                                       S01509
     C                     MOVELWPSETC    SPSCU                           S01509
     C                     ELSE                                           S01509
     C           VLCY      IFNE *BLANKS
     C                     MOVELVLCY      SPSCU
     C                     ELSE
     C                     MOVELNMCY      SPSCU
     C                     END
     C                     END                                            S01509
     C                     END
     C                     END
     C                     ELSE
     C*
     C**  IF CLASSIFICATION NOT 'S' OR 'D', TEST MULTICURRENCY IND = Y
     C** If S01509 is active, this is a market client and offer a         S01509
     C** standard default, otherwise check multicurrency ind = Y          S01509
     C** If CEU005 is active, check for standard settlement instructions. CEU005
     C*
     C           S01509    IFEQ 'Y'                                       S01509
     C           CEU005    IFEQ 'Y'                                       CEU005
     C                     MOVELWPSETC    CURK    3                       CEU005
      *                                                                                       CSE028
      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
      *                                                                                       CSE028
     C                     MOVE PBCD      WBKCD                                               CSE028
     C                     EXSR SRSSIR                                                        CSE028
     C           NOTFND    IFEQ 'Y'                                                           CSE028
     C                     MOVE '1'       *IN99                                               CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE '0'       *IN99                                               CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     ELSE                                                               CSE028
      *                                                                                       CSE028
     C                     MOVE *BLANKS   WBKCD                                               CSE028
      *                                                                                       CSE028
     C           STDSEK    CHAINSTDSED               99                   CEU005
      *                                                                                       CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C/COPY WNCPYSRC,SE0170C085
     C           *IN99     IFEQ '0'                                       CEU005
     C*                                                                   CEU005
     C** If CEU005 is active use date defaults here.                      CEU005
     C*                                                                   CEU005
     C           S01512    IFEQ 'Y'                                       CEU005
     C           PSVL      IFEQ 0                                         CEU005
     C                     MOVELSPDUD     SPSVL                           CEU005
     C                     MOVE SPDUD     ZDATE                           CEU005
     C                     EXSR ZDATE1                                    CEU005
     C                     MOVELZDAYNO    PSVL                            CEU005
     C                     ELSE                                           CEU005
     C                     Z-ADDPSVL      ZDAYNO                          CEU005
     C                     EXSR ZDATE2                                    CEU005
     C                     MOVELZDATE     SPSVL                           CEU005
     C                     END                                            CEU005
     C                     END                                            CEU005
     C*                                                                   CEU005
     C** Check for EURO Currency.                                         CEU005
     C*                                                                   CEU005
     C           SCCY      IFNE *BLANKS                                   CEU005
     C*                                                                   CEU005
     C** If the Due Currency is the EURO Currency.                        CEU005
     C*                                                                   CEU005
     C           SPNCY     IFEQ BKEURO                                    CEU005
     C                     CALL 'AOCURRR0'                                CEU005
     C                     PARM *BLANKS   @RTCD                           CEU005
     C                     PARM '*KEY   ' @OPTN                           CEU005
     C                     PARM SCCY      @AJCD                           CEU005
     C           SDCURR    PARM SDCURR    DSSDY                           CEU005
     C           @RTCD     IFNE *BLANKS                                   CEU005
     C                     MOVEL'SDCURRPD'DBFILE           ***************CEU005
     C                     MOVEL'018'     DBASE            * DBERROR 018 *CEU005
     C                     MOVELSCCY      DBKEY            ***************CEU005
     C                     EXSR *PSSR                                     CEU005
     C                     END                                            CEU005
     C                     Z-ADD0         DATE    50                      CEU005
     C                     MOVE PSVL      DATE                            CEU005
     C*                                                                   CEU005
     C** If the Currency is 'IN' then enter the exchange rate             CEU005
     C** and mult/div indicator of the currency into POSETD.              CEU005
     C*                                                                   CEU005
     C           A6INCY    IFEQ 'Y'                                       CEU005
     C           DATE      ANDGEA6TPSD                                    CEU005
     C                     Z-ADDA6EUER    PSXR                            CEU005
     C                     MOVE PSXR      ZFLD15                          CEU005
     C                     Z-ADD8         ZDECS                           CEU005
     C                     MOVE ' '       ZECODE                          CEU005
     C                     EXSR ZSEDIT                                    CEU005
     C                     MOVEL*BLANKS   SPSXR                           CEU005
     C                     MOVE ZOUT21    SPSXR                           CEU005
     C*                                                                   CEU005
     C           A6EUMD    IFEQ 'M'                                       143690
     C                     MOVE 'D'       PMDI                            143690
     C                     MOVE 'D'       SPMDI                           143690
     C                     ELSE                                           143690
     C                     MOVE 'M'       PMDI                            143690
     C                     MOVE 'M'       SPMDI                           143690
     C                     ENDIF                                          143690
     C***********          MOVE A6EUMD    PMDI                     CEU005 143690
     C***********          MOVE A6EUMD    SPMDI                    CEU005 143690
     C                     ENDIF                                          CEU005
     C*                                                                   CEU005
     C                     ENDIF                                          CEU005
     C*                                                                   CEU005
     C** If the Settlement Currency is the EURO Currency.                 CEU005
     C*                                                                   CEU005
     C           SCCY      IFEQ BKEURO                                    CEU005
     C                     CALL 'AOCURRR0'                                CEU005
     C                     PARM *BLANKS   @RTCD                           CEU005
     C                     PARM '*KEY   ' @OPTN                           CEU005
     C                     PARM SPNCY     @AJCD                           CEU005
     C           SDCURR    PARM SDCURR    DSSDY                           CEU005
     C           @RTCD     IFNE *BLANKS                                   CEU005
     C                     MOVEL'SDCURRPD'DBFILE           ***************CEU005
     C                     MOVEL'019'     DBASE            * DBERROR 019 *CEU005
     C                     MOVELSPNCY     DBKEY            ***************CEU005
     C                     EXSR *PSSR                                     CEU005
     C                     END                                            CEU005
     C                     Z-ADD0         DATE                            CEU005
     C                     MOVELPSVL      DATE                            CEU005
     C*                                                                   CEU005
     C** If the Currency is 'IN' then enter the exchange rate             CEU005
     C** and mult/div indicator of the currency into POSETD.              CEU005
     C*                                                                   CEU005
     C           A6INCY    IFEQ 'Y'                                       CEU005
     C           DATE      ANDGEA6TPSD                                    CEU005
     C                     Z-ADDA6EUER    PSXR                            CEU005
     C                     MOVE PSXR      ZFLD15                          CEU005
     C                     Z-ADD8         ZDECS                           CEU005
     C                     MOVE ' '       ZECODE                          CEU005
     C                     EXSR ZSEDIT                                    CEU005
     C                     MOVEL*BLANKS   SPSXR                           CEU005
     C                     MOVE ZOUT21    SPSXR                           CEU005
     C*                                                                   CEU005
     C                     MOVE A6EUMD    PMDI                            143690
     C                     MOVE A6EUMD    SPMDI                           143690
     C***********A6EUMD    IFEQ 'M'                                CEU005 143690
     C***********          MOVE 'D'       PMDI                     CEU005 143690
     C***********          MOVE 'D'       SPMDI                    CEU005 143690
     C***********          ELSE                                    CEU005 143690
     C***********          MOVE 'M'       PMDI                     CEU005 143690
     C***********          MOVE 'M'       SPMDI                    CEU005 143690
     C***********          ENDIF                                   CEU005 143690
     C                     ENDIF                                          CEU005
     C*                                                                   CEU005
     C                     ENDIF                                          CEU005
     C*                                                                   CEU005
     C** Check for settlement details for Settlement Currency.            CEU005
     C*                                                                   CEU005
     C                     MOVELSCCY      PSCU      P                     CEU005
     C                     MOVELSCCY      WPSETC    P                     CEU005
     C           SCCY      IFNE CURK                                      CEU005
     C                     MOVELSCCY      CURK      P                     CEU005
     C/COPY WNCPYSRC,SE0170C086
     C           STDSEK    SETLLSTDSED                   99               CEU005
     C           *IN99     IFEQ '1'                                       CEU005
      *                                                                                       CSE028
      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
      *                                                                                       CSE028
     C                     MOVE PBCD      WBKCD                                               CSE028
     C                     EXSR SRSSIR                                                        CSE028
     C           NOTFND    IFEQ 'Y'                                                           CSE028
     C                     MOVE '1'       *IN99                                               CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE '0'       *IN99                                               CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     ELSE                                                               CSE028
      *                                                                                       CSE028
     C                     MOVE *BLANKS   WBKCD                                               CSE028
      *                                                                                       CSE028
     C           STDSEK    CHAINSTDSED               99                   CEU005
      *                                                                                       CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     ELSE                                           CEU005
     C*                                                                   CEU005
     C** Blank out fields if no currency settlements instructions         CEU005
     C*                                                                   CEU005
     C                     MOVE *BLANKS   SRSM                            CEU005
     C                     MOVE *BLANKS   SRAC                            CEU005
     C                     MOVE *BLANKS   SRAB                            CEU005
     C                     MOVE *BLANKS   SRCB                            CEU005
     C                     MOVE *BLANKS   SPSM                            CEU005
     C                     MOVE *BLANKS   SPAT                            CEU005
     C                     MOVE *BLANKS   SPBA                            CEU005
     C                     MOVE *BLANKS   SPCB                            CEU005
     C                     MOVE *BLANKS   SPFA                            CEU005
     C                     MOVE *BLANKS   SPSI                            CEU005
     C                     MOVE *BLANKS   SPCP                            CEU005
     C                     ENDIF                                          CEU005
     C/COPY WNCPYSRC,SE0170C087
     C                     ENDIF                                          CEU005
     C* Settlement Ccy not present                                        CEU005
     C                     ELSE                                           CEU005
     C                     MOVELWPSETC    SPSCU                           S01509
     C                     ENDIF                                          CEU005
     C                     ENDIF                                          CEU005
     C* CEU005 not active.                                                CEU005
     C                     MOVELWPSETC    SPSCU                           CEU005
     C                     ENDIF                                          CEU005
     C*                                                                   CEU005
     C********             ELSE                                     S01509157808
     C                     END                                            157808
     C********** CEU005    IFNE 'Y'                                                    157808 235180
     C           SPSCU     IFEQ *BLANKS                                                       235180
     C           MLTI      IFEQ 'Y'
     C           SPYC      IFNE *BLANKS
     C                     MOVELSPYC      SPSCU
     C                     ELSE
     C                     MOVELNMCY      SPSCU
     C                     END
     C                     ELSE
     C           MLTI      IFEQ 'N'
     C           VLCY      IFNE *BLANKS
     C                     MOVELVLCY      SPSCU
     C                     ELSE
     C                     MOVELNMCY      SPSCU
     C                     END
     C                     END
     C                     END
     C                     END                                            S01509
     C                     END
     C                     END
     C                     MOVELSPSCU     XSPSCU                          151506
     C*
     C**  EXCHANGE RATE
     C** Process only if S01509 is not active                             S01509
     C*
     C           SPSXR     IFEQ *BLANKS
     C           PSXR      ANDEQ0
     C           S01509    ANDEQ'N'                                       S01509
     C*
     C**  IF SETTLEMENT CUR = PAYMENT CUR (SECTYD) OUTPUT EXCHANGE
     C**  RATE AND M/D IND FROM SECTYD
     C*
     C           SPYC      IFEQ SPSCU
     C                     MOVE SMDI      SPMDI
     C                     MOVE SEXR      ZFLD15
     C                     Z-ADD8         ZDECS
     C                     MOVE ' '       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVEL*BLANKS   SPSXR
     C                     MOVE ZOUT21    SPSXR
     C                     END
     C                     END
     C*                                                                   S01509
     C** DEFAULTS FOR SETTLEMENT/PAYMENT CURRENCY EXCHANGE RATE           S01509
     C** Process only if S01509 is active                                 S01509
     C*                                                                   S01509
     C**  This is the rate between ccy of the position and the defaulted  S01509
     C**  settlement currency.   If not already entered set it up ...     S01509
     C*                                                                   S01509
     C           SPSXR     IFEQ *BLANKS                                   S01509
     C           PSXR      ANDEQ0                                         S01509
     C           S01509    ANDEQ'Y'                                       S01509
     C*                                                                   S01509
     C*   If position ccy= settlement ccy then the default rate is 1.0    S01509
     C*   (NB this is a 13,8 field so put 100000000 into it.)             S01509
     C*                                                                   S01509
     C           WPSETC    IFEQ SPSCU                                     S01509
     C                     Z-ADD100000000 ZFLD15                          S01509
     C                     MOVE 'M'       SPMDI                           S01509
     C                     ELSE                                           S01509
     C*                                                                   S01509
     C* Use the spot rates of settlement and position currencies to       S01509
     C* calculate the cross rate between the two.                         S01509
     C* Note that for system generated POSETD records the position        S01509
     C* amount, if not in nominal currency, will already have been        S01509
     C* into position currency, using SEXR from SECTYD.  For records      S01509
     C* being inserted it is assumed that the user will use the correct   S01509
     C* currency.                                                         S01509
     C*                                                                   S01509
     C* Get settlement currency spot rate                                 S01509
     C*                                                                   S01509
     C                     CALL 'AOCURRR0'                                S01509
     C                     PARM '*DBERR'  @RTCD   7                       S01509
     C                     PARM '*KEY   ' @OPTN   7                       S01509
     C                     PARM WPSETC    @AJCD   3                       S01509
     C           SDCURR    PARM SDCURR    DSSDY                           S01509
     C*                                                                   S01509
     C                     Z-ADDA6SPRT    ZRATE1 138                      S01509
     C                     MOVE A6MDIN    ZMDI1   1                       S01509
     C*                                                                   S01509
     C* Get position currency spot rate                                   S01509
     C*                                                                   S01509
     C*                                                                   157808
     C           PNCY      IFEQ *BLANKS                                   157808
     C                     MOVE SPNCY     PNCY                            157808
     C                     END                                            157808
     C*                                                                   157808
     C                     CALL 'AOCURRR0'                                S01509
     C                     PARM '*DBERR'  @RTCD   7                       S01509
     C                     PARM '*KEY   ' @OPTN   7                       S01509
     C                     PARM PNCY      @AJCD   3                       S01509
     C           SDCURR    PARM SDCURR    DSSDY                           S01509
     C*                                                                   S01509
     C                     Z-ADDA6SPRT    ZRATE2 138                      S01509
     C                     MOVE A6MDIN    ZMDI2   1                       S01509
     C                     EXSR ZXRATE                                    S01509
     C*                                                                   S01509
     C                     MOVE ZRATEX    ZFLD15                          S01509
     C                     MOVE ZMDIX     SPMDI                           S01509
     C                     END                                            S01509
     C*                                                                   S01509
     C                     Z-ADD8         ZDECS                           S01509
     C                     MOVE ' '       ZECODE                          S01509
     C                     EXSR ZSEDIT                                    S01509
     C                     MOVEL*BLANKS   SPSXR                           S01509
     C                     MOVE ZOUT21    SPSXR                           S01509
     C                     END                                            S01509
     C/COPY WNCPYSRC,SE0170C001
     C*
     C**  BASE CURRENCY RATE
     C*
     C           SPBRX     IFEQ *BLANKS
     C           PBRX      ANDEQ0
     C*
     C****GET*SETTLEMENT*CURRENCY*RECORD*FROM*TABTG10*AND*USE*SPOT*RATE   S01117
     C**  Get Settlement Currency record from Currency file               S01117
     C*
     C***********          MOVE *BLANKS   KEY                             S01117
     C***********          MOVEL'20'      TYPE                            S01117
     C***********          MOVE '1'       KEY                             S01117
     C***********          MOVELSPSCU     KCCY2                           S01117
     C***********TABKEY    CHAINTABTG10F             99                   S01117
     C************IN99     IFEQ '0'                                       S01117
     C***********RECI      ANDNE'*'                                       S01117
     C***********                                                         S01117
     C***********          MOVE SPOT      ZFLD15                          S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR'  @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SPSCU     @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C*                                                                   S01117
     C                     MOVE A6SPRT    ZFLD15                          S01117
     C                     Z-ADD8         ZDECS
     C                     MOVE ' '       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVEL*BLANKS   SPBRX
     C                     MOVE ZOUT21    SPBRX
     C*
     C***********          END                                            S01117
     C                     END
     C/COPY WNCPYSRC,SE0170C089
     C*
     C**  GENERATE DEFLTS FOR THE FOLLOWING FIELDS
     C*
     C**  SETTLEMENT METHOD  &
     C**  SETTLEMENT ACCOUNT &
     C**  SETTLEMENT BRANCH  &
     C**  COUNTERPARTY BANK  &
     C**  FOR A/C OF         &
     C**  SPECIAL INSTRUCTIONS
     C*
     C                     MOVELSPSCU     CURK
     C/COPY WNCPYSRC,SE0170C038
      *                                                                                       CSE028
      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
      *                                                                                       CSE028
     C                     MOVE PBCD      WBKCD                                               CSE028
     C                     EXSR SRSSIR                                                        CSE028
     C           NOTFND    IFEQ 'Y'                                                           CSE028
     C                     MOVE '1'       *IN99                                               CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE '0'       *IN99                                               CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     ELSE                                                               CSE028
      *                                                                                       CSE028
     C                     MOVE *BLANKS   WBKCD                                               CSE028
      *                                                                                       CSE028
     C           STDSEK    CHAINSTDSED               99
      *                                                                                       CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C/COPY WNCPYSRC,SE0170C039
     C           *IN99     IFEQ '0'
     C*                                                                   CEU005
     C** If CEU005 is active use date defaults here.                      CEU005
     C*                                                                   CEU005
     C           CEU005    IFEQ 'Y'                                       CEU005
     C           S01512    IFEQ 'Y'                                       CEU005
     C           PSVL      IFEQ 0                                         CEU005
     C                     MOVELSPDUD     SPSVL                           CEU005
     C                     MOVE SPDUD     ZDATE                           CEU005
     C                     EXSR ZDATE1                                    CEU005
     C                     MOVELZDAYNO    PSVL                            CEU005
     C                     ELSE                                           CEU005
     C                     Z-ADDPSVL      ZDAYNO                          CEU005
     C                     EXSR ZDATE2                                    CEU005
     C                     MOVELZDATE     SPSVL                           CEU005
     C                     END                                            CEU005
     C                     END                                            CEU005
     C                     ENDIF                                          CEU005
     C*                                                                   CEU005
     C** If CEU005 is on check for EURO Currency.                         CEU005
     C*                                                                   CEU005
     C           CEU005    IFEQ 'Y'                                       CEU005
     C           SCCY      ANDNE*BLANKS                                   CEU005
     C*                                                                   CEU005
     C** If the Due Currency is the EURO Currency.                        CEU005
     C*                                                                   CEU005
     C           SPNCY     IFEQ BKEURO                                    CEU005
     C                     CALL 'AOCURRR0'                                CEU005
     C                     PARM *BLANKS   @RTCD                           CEU005
     C                     PARM '*KEY   ' @OPTN                           CEU005
     C                     PARM SCCY      @AJCD                           CEU005
     C           SDCURR    PARM SDCURR    DSSDY                           CEU005
     C           @RTCD     IFNE *BLANKS                                   CEU005
     C                     MOVEL'SDCURRPD'DBFILE           ***************CEU005
     C                     MOVEL'020'     DBASE            * DBERROR 020 *CEU005
     C                     MOVELSCCY      DBKEY            ***************CEU005
     C                     EXSR *PSSR                                     CEU005
     C                     END                                            CEU005
     C                     Z-ADD0         DATE                            CEU005
     C                     MOVE PSVL      DATE                            CEU005
     C*                                                                   CEU005
     C** If the Currency is 'IN' then enter the exchange rate             CEU005
     C** and mult/div indicator of the currency into POSETD.              CEU005
     C*                                                                   CEU005
     C           A6INCY    IFEQ 'Y'                                       CEU005
     C           DATE      ANDGEA6TPSD                                    CEU005
     C                     Z-ADDA6EUER    PSXR                            CEU005
     C                     MOVE PSXR      ZFLD15                          CEU005
     C                     Z-ADD8         ZDECS                           CEU005
     C                     MOVE ' '       ZECODE                          CEU005
     C                     EXSR ZSEDIT                                    CEU005
     C                     MOVEL*BLANKS   SPSXR                           CEU005
     C                     MOVE ZOUT21    SPSXR                           CEU005
     C*                                                                   CEU005
     C           A6EUMD    IFEQ 'M'                                       143690
     C                     MOVE 'D'       PMDI                            143690
     C                     MOVE 'D'       SPMDI                           143690
     C                     ELSE                                           143690
     C                     MOVE 'M'       PMDI                            143690
     C                     MOVE 'M'       SPMDI                           143690
     C                     ENDIF                                          143690
     C***********          MOVE A6EUMD    PMDI                     CEU005 143690
     C***********          MOVE A6EUMD    SPMDI                    CEU005 143690
     C                     ENDIF                                          CEU005
     C*                                                                   CEU005
     C                     ENDIF                                          CEU005
     C*                                                                   CEU005
     C** If the Settlement Currency is the EURO Currency.                 CEU005
     C*                                                                   CEU005
     C           SCCY      IFEQ BKEURO                                    CEU005
     C                     CALL 'AOCURRR0'                                CEU005
     C                     PARM *BLANKS   @RTCD                           CEU005
     C                     PARM '*KEY   ' @OPTN                           CEU005
     C                     PARM SPNCY     @AJCD                           CEU005
     C           SDCURR    PARM SDCURR    DSSDY                           CEU005
     C           @RTCD     IFNE *BLANKS                                   CEU005
     C                     MOVEL'SDCURRPD'DBFILE           ***************CEU005
     C                     MOVEL'021'     DBASE            * DBERROR 021 *CEU005
     C                     MOVELSPNCY     DBKEY            ***************CEU005
     C                     EXSR *PSSR                                     CEU005
     C                     END                                            CEU005
     C                     Z-ADD0         DATE                            CEU005
     C                     MOVE PSVL      DATE                            CEU005
     C*                                                                   CEU005
     C** If the Currency is 'IN' then enter the exchange rate             CEU005
     C** and mult/div indicator of the currency into POSETD.              CEU005
     C*                                                                   CEU005
     C           A6INCY    IFEQ 'Y'                                       CEU005
     C           DATE      ANDGEA6TPSD                                    CEU005
     C                     Z-ADDA6EUER    PSXR                            CEU005
     C                     MOVE PSXR      ZFLD15                          CEU005
     C                     Z-ADD8         ZDECS                           CEU005
     C                     MOVE ' '       ZECODE                          CEU005
     C                     EXSR ZSEDIT                                    CEU005
     C                     MOVEL*BLANKS   SPSXR                           CEU005
     C                     MOVE ZOUT21    SPSXR                           CEU005
     C*                                                                   CEU005
     C                     MOVE A6EUMD    PMDI                            143690
     C                     MOVE A6EUMD    SPMDI                           143690
     C***********A6EUMD    IFEQ 'M'                                CEU005 143690
     C***********          MOVE 'D'       PMDI                     CEU005 143690
     C***********          MOVE 'D'       SPMDI                    CEU005 143690
     C***********          ELSE                                    CEU005 143690
     C***********          MOVE 'M'       PMDI                     CEU005 143690
     C***********          MOVE 'M'       SPMDI                    CEU005 143690
     C***********          ENDIF                                   CEU005 143690
     C                     ENDIF                                          CEU005
     C*                                                                   CEU005
     C                     ENDIF                                          CEU005
     C*                                                                   CEU005
     C                     ENDIF                                          CEU005
     C*                                                                   CEU005
     C*
     C**  IF S/D CUSTOMER
     C*
     C***********C1DI      IFEQ 'S'                                       S01117
     C***********C1DI      OREQ 'D'                                       S01117
     C           BFCLAS    IFEQ 'S'                                       S01117
     C           BFCLAS    OREQ 'D'                                       S01117
     C*
     C           PEVT      IFEQ 'PP'
     C           PSMT      IFEQ 0
     C                     MOVELSRSM      SPSMT
     C                     END
     C           PSEA      IFEQ *BLANKS
     C                     MOVELSRAC      SPSEA
     C                     END
     C           PSEB      IFEQ *BLANKS
     C***********          MOVELSRBR      SPSEB                           S01117
     C                     MOVELSRAB      SPSEB                           S01117
     C                     END
     C           PCPN      IFEQ *BLANKS
     C                     MOVELSRCB      SPCPN
     C                     END
     C                     MOVELSPSI      SPSPI
     C                     ELSE
     C           PSMT      IFEQ 0
     C                     MOVELSPSM      SPSMT
     C                     END
     C           PSEA      IFEQ *BLANKS
     C***********          MOVELSRAC      SPSEA                           E17178
     C                     MOVELSPAT      SPSEA                           E17178
     C                     END
     C           PSEB      IFEQ *BLANKS
     C***********          MOVELSPBR      SPSEB                           S01117
     C                     MOVELSPBA      SPSEB                           S01117
     C                     END
     C           PCPN      IFEQ *BLANKS
     C                     MOVELSPCB      SPCPN
     C                     END
     C           PFAC      IFEQ *BLANKS
     C                     MOVELSPFA      SPFAC
     C                     END
     C           PSPI      IFEQ *BLANKS
     C                     MOVELSPSI      SPSPI
     C                     END
     C                     END
     C*
     C**  ELSE DEPOT
     C*
     C                     ELSE
     C           PEVT      IFNE 'PP'
     C           PSMT      IFEQ 0
     C                     MOVELSRSM      SPSMT
     C                     END
     C           PSEA      IFEQ *BLANKS
     C                     MOVELSRAC      SPSEA
     C                     END
     C           PSEB      IFEQ *BLANKS
     C***********          MOVELSRBR      SPSEB                           S01117
     C                     MOVELSRAB      SPSEB                           S01117
     C                     END
     C           PCPN      IFEQ *BLANKS
     C                     MOVELSRCB      SPCPN
     C                     END
     C                     MOVELSPSI      SPSPI
     C                     ELSE
     C           PSMT      IFEQ 0
     C                     MOVELSPSM      SPSMT
     C                     END
     C           PSEA      IFEQ *BLANKS
     C                     MOVELSRAC      SPSEA
     C                     END
     C           PSEB      IFEQ *BLANKS
     C***********          MOVELSPBR      SPSEB                           S01117
     C                     MOVELSPBA      SPSEB                           S01117
     C                     END
     C           PCPN      IFEQ *BLANKS
     C                     MOVELSPCB      SPCPN
     C                     END
     C           PFAC      IFEQ *BLANKS
     C                     MOVELSPFA      SPFAC
     C                     END
     C           PSPI      IFEQ *BLANKS
     C                     MOVELSPSI      SPSPI
     C                     END
     C                     END
     C                     END
     C*                                                                   E14878
     C                     ELSE                                           E14878
     C*                                                                   E14878
     C**  NO DEFAULT SETTLEMENT INSTRUCTIONS, CHECK IF MULTIBRANCH        E14878
     C****ENVIRONMENT.*IF*NOT,*SETTLEMENT*BRANCH*DEFAULTS*TO*'001'.****   E14878
     C**  ENVIRONMENT. IF NOT, SETTLEMENT BRANCH DEFAULTS FROM ZMUSER.    E14878
     C*                                                                   E14878
     C           MBIN      IFEQ 'N'                                       E14878
     C***********          MOVE '001'     SPSEB                    E14878 S01117
     C                     MOVE USRBCH    SPSEB                           S01117
     C                     END                                            E14878
     C/COPY WNCPYSRC,SE0170C013
     C                     END
     C/COPY WNCPYSRC,SE0170C074
     C                     ELSE
     C*
     C**  GENERATE DEFAULT FOR PAY/RECEIVE IND IF BLANK
     C*
     C***********SPMDI     IFEQ *BLANKS                                   E14881
     C           SPPRE     IFEQ *BLANKS                                   E14881
     C*
     C**  IF CUSTOMER S/D
     C*
     C***********C1DI      IFEQ 'S'                                       S01117
     C***********C1DI      OREQ 'D'                                       S01117
     C           BFCLAS    IFEQ 'S'                                       S01117
     C           BFCLAS    OREQ 'D'                                       S01117
     C           PEVT      IFEQ 'PP'
     C           PNMP      IFGE 0
     C                     MOVE 'R'       SPPRE
     C                     ELSE
     C                     MOVE 'P'       SPPRE
     C                     END
     C                     ELSE
     C           PNMP      IFGE 0
     C                     MOVE 'P'       SPPRE
     C                     ELSE
     C                     MOVE 'R'       SPPRE
     C                     END
     C                     END
     C*
     C**  ELSE DEPOT
     C*
     C                     ELSE
     C           PEVT      IFEQ 'PP'
     C           PNMP      IFGE 0
     C                     MOVE 'P'       SPPRE
     C                     ELSE
     C                     MOVE 'R'       SPPRE
     C                     END
     C                     ELSE
     C           PNMP      IFGE 0
     C                     MOVE 'R'       SPPRE
     C                     ELSE
     C                     MOVE 'P'       SPPRE
     C                     END
     C                     END
     C                     END
     C                     END
     C/COPY WNCPYSRC,SE0170C090
     C                     END
     C*                                                                   S01512
     C** If S01512 is active, value date defaults to due date             S01512
     C*                                                                   S01512
     C** If CEU005 is active do not use date defaults here.               CEU005
     C           CEU005    IFNE 'Y'                                       CEU005
     C           S01512    IFEQ 'Y'                                       S01512
     C           PSVL      IFEQ 0                                         S01512
     C                     MOVELSPDUD     SPSVL                           S01512
     C                     ELSE                                           S01512
     C                     Z-ADDPSVL      ZDAYNO                          S01512
     C                     EXSR ZDATE2                                    S01512
     C                     MOVELZDATE     SPSVL                           S01512
     C                     END                                            S01512
     C                     END                                            S01512
     C                     ENDIF                                          CEU005
     C*
     C                     MOVE SPSXR     WXRATP                                              197896
      *                                                                                       CER049
     C           CER049    IFEQ 'Y'                                                           CER049
     C           SPTAXL    ANDEQ*BLANKS                                                       CER049
     C                     MOVE 'N'       SPTAXL                                              CER049
     C                     EXSR SRSTAX                                                        CER049
     C                     ENDIF                                                              CER049
      *                                                                   S01447
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  INITRC  - S/R TO INITIALISE ALL FILE FIELDS TO ZERO/BLANK    *
     C*  CALLED FROM: UPDATE; UPDFLS                                  *
     C*  CALLS: NO OTHER S/R'S                                        *
     C*                                                               *
     C*****************************************************************
     C*
     C           INITRC    BEGSR
     C*
     C** INITIALIZE ALL DATA ON RECORD DEFINED IN DETREC (KEY EXCLUDED)
     C*
     C                     MOVEL*BLANKS   DETREC
     C***********          MOVEL*BLANKS   DETS                     068993 080356
     C                     Z-ADD0         PNMP
     C                     Z-ADD0         PAMD
     C                     Z-ADD0         PSXR
     C                     Z-ADD0         PBRX
     C                     Z-ADD0         PSMT
     C                     Z-ADD0         PCHA
     C                     Z-ADD0         PCAM
     C                     Z-ADD0         PSAT
     C                     Z-ADD0         WPSAT                           173501
     C                     Z-ADD0         LCD
     C***********          Z-ADD0         TNLU                            S01486
     C                     Z-ADD0         TNLUX                           S01486
     C                     Z-ADD0         PDTG
     C                     Z-ADD0         PSVL                            S01512
     C                     Z-ADD0         BAUS                            S01496
     C*
     C                     CLEARTASO                                      S01447
     C                     CLEARTASR                                      S01447
     C                     CLEARTAUS                                      S01447
     C                     Z-ADD*ZERO     TXNM                                                233711
     C                     Z-ADD*ZERO     TXST                                                233711
     C                     Z-ADD*ZERO     TAXA                                                233711
     C                     Z-ADD0         PSEQ                                                247951
     C                     Z-ADD0         DAMT                                                247951
     C*
     C** Initialize field TNL1 before each insert or else DB error        108001
     C** occurs                                                           108001
     C*                                                                   108001
     C/COPY WNCPYSRC,SE0170C007
     C           ACTN      IFEQ 'I'                                       130059
     C                     Z-ADD0         TNL1                            108001
     C                     MOVE *BLANKS   TXCY                                                233711
     C                     END                                            130059
     C/COPY WNCPYSRC,SE0170C008
     C*                                                                   108001
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  TRSFS  - S/R TO FORMAT RECORD FIELDS FOR SCREEN              *
     C*  CALLED FROM: UPDATE                                          *
     C*  CALLS: ZSEDIT                                                *
     C*                                                               *
     C*****************************************************************
     C*
     C           TRSFS     BEGSR
     C*
     C*                                                                   S01496
     C** FILL SPMTRV  (MATURED/REVERSED)                                  S01496
     C*                                                                   S01496
     C           S01496    IFEQ 'Y'                                       S01496
     C           CSE007    OREQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C*                                                                   S01496
     C                     MOVEL*BLANKS   SPMTRV                          S01496
     C                     MOVE *OFF      *IN32                           S01496
     C           WWRECI    IFEQ 'M'                                       S01496
     C                     MOVEL'MATURED 'SPMTRV                          S01496
     C                     MOVE *ON       *IN32                           S01496
     C                     ELSE                                           S01496
     C           WWRECI    IFEQ 'R'                                       S01496
     C                     MOVEL'REVERSED'SPMTRV                          S01496
     C                     MOVE *ON       *IN32                           S01496
     C                     ENDIF                                          S01496
     C                     ENDIF                                          S01496
     C*                                                                   S01496
     C                     ENDIF                                          S01496
      *                                                                   185397
      ** Record already found in SR UPDATE so do not need to chain        185397
      ** again here.                                                      185397
     C**********                                                   095550 185397
     C****DEFINE*KEY*LIST*FOR*CHAINING*TO*POSET*FILE*WITH*PORTFOLIO095550 185397
     C*****MANAGEMENT*INSTALLED                                    095550 185397
     C**********                                                   095550 185397
     C********** PTFRKC    KLIST                                   095550 185397
     C**********           KFLD           SPBCA                    095550 185397
     C**********           KFLD           SPSSH                    095550 185397
     C**********           KFLD           SPCPYX                   095550 185397
     C**********           KFLD           SDUDX                    095550 185397
     C**********           KFLD           SPEVT                    095550 185397
     C**********           KFLD           SPPTFR                   095550 185397
     C**********           KFLD           SPTNLU                   141869 185397
     C**********                                                   095550 185397
     C**********           MOVE SPDUD     PPDUDN  60               095550 185397
     C**********           Z-ADDPPDUDN    ZDATE                    095550 185397
     C**********           EXSR ZDATE1                             095550 185397
     C**********           Z-ADDZDAYNO    SDUDX   50               095550 185397
     C**********           MOVELSPCPY     SPCPYX  60               095550 185397
     C**********                                                   095550 185397
     C********** PTFRKC    CHAINPOSETX               99            095550 185397
     C**********                                                   095550 185397
     C**  TRANSLATE PAUI (#ALPV) AUTH IND
     C*
     C**********           MOVELPAUI      SPAUI                                             AR324886
     C*
     C**  TRANSLATE PNMP (#AMNT)  NOMINAL POSITION
     C*
     C           WWPTYP    IFEQ 'CC'                                      CEU017
     C                     Z-ADDNMDPOS    NMDP                            CEU017
     C                     ENDIF                                          CEU017
     C*                                                                   CEU017
     C                     MOVE PNMP      ZFLD15
     C***********          Z-ADD4         ZDECS                           NA
     C                     Z-ADDNMDP      ZDECS                           NA
     C                     MOVE ' '       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVEL*BLANKS   SPNMP
     C                     MOVE ZOUT21    SPNMP
     C*
     C**  TRANSLATE PNCY (#ALPV)  NOMINAL CURRENCY
     C*
     C                     MOVELPNCY      SPNCY
     C*
     C**  Fetch Nominal Currency decimal places
     C** If S01509 is active, bypass processing for nominal currency      S01509
     C*
     C***********          MOVE *BLANKS   KEY                             S01117
     C***********          MOVEL'20'      TYPE                            S01117
     C***********          MOVE '1'       KEY                             S01117
     C***********          MOVELPNCY      KCCY2                           S01117
     C***********TABKEY    CHAINTABTG10F             99                   S01117
     C***********          Z-ADDCDP       NOMCDP                          S01117
     C           S01509    IFEQ 'N'                                       S01509
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR'  @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C***********          PARM PNCY      @AJCD   3                S01117 S01509
     C                     PARM NMCY      @AJCD   3                       S01509
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C*                                                                   S01117
     C                     Z-ADDA6NBDP    NOMCDP                          S01117
     C                     MOVE A6CYCD    NOMCCY                                              233711
     C                     END                                            S01509
     C*                                                                   S01512
     C** Translate PSVL - value date if S01512 is active                  S01512
     C*                                                                   S01512
     C           S01512    IFEQ 'Y'                                       S01512
     C                     Z-ADDPSVL      ZDAYNO                          S01512
     C                     EXSR ZDATE2                                    S01512
     C                     MOVELZDATE     SPSVL                           S01512
     C                     END                                            S01512
     C*
     C**  TRANSLATE PBCD (#ALPV)
     C*
     C                     MOVELPBCD      SPBCD
     C*                                                                   S01117
     C**  TRANSLATE PPFC (#ALPV)                                          S01117
     C*                                                                   S01117
     C           *IN82     IFEQ '1'                                       S01117
     C                     MOVELPPFC      SPPFC                           S01117
     C                     END                                            S01117
     C*
     C**  TRANSLATE PAMD (#AMNT) AMOUNT DUE
     C** Fetch Payment Currency decimal places if S01509 is active        S01509
     C*                                                                   S01509
     C           S01509    IFEQ 'Y'                                       S01509
     C                     CALL 'AOCURRR0'                                S01509
     C                     PARM '*DBERR'  @RTCD                           S01509
     C                     PARM '*KEY   ' @OPTN                           S01509
     C                     PARM PNCY      @AJCD   3                       S01509
     C           SDCURR    PARM SDCURR    DSSDY                           S01509
     C*                                                                   S01509
     C                     Z-ADDA6NBDP    POSCDP                          S01509
     C                     MOVE A6CYCD    POSCCY                                              233711
     C                     END                                            S01509
     C*                                                                   S01509
     C           PAMD      IFNE 0
     C                     MOVE PAMD      ZFLD15
     C           S01509    IFEQ 'Y'                                       S01509
     C                     Z-ADDPOSCDP    ZDECS                           S01509
     C                     ELSE                                           S01509
     C                     Z-ADDNOMCDP    ZDECS
     C                     END                                            S01509
     C                     MOVE ' '       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVEL*BLANKS   SPAMD
     C                     MOVE ZOUT21    SPAMD
     C                     ELSE
     C                     MOVEL*BLANKS   SPAMD
     C                     END
     C/COPY WNCPYSRC,SE0170C113
     C*
     C**  TRANSLATE PPRE (#ALPV) PAY/RECEIVE INDICATOR
     C*
     C                     MOVELPPRE      SPPRE
     C*
     C**  TRANSLATE PSCU (#ALPV) SETTLEMENT CURRENCY
     C*
     C                     MOVELPSCU      SPSCU
     C                     MOVELPSCU      XSPSCU                          151506
     C*
     C**  TRANSLATE PSXR (#AMNT) SETTLEMENT EXCHANGE RATE
     C*
     C           PSXR      IFNE 0
      *                                                                   CAC002
      **  Re-calculate exchange rate if anal acctg is installed, so       CAC002
      **  that what would be shown would be the rate entered              CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C           PPRE      IFEQ 'R'                                       CAC002
     C           PMDI      ANDEQ'M'                                       CAC002
     C           PPRE      OREQ 'P'                                       CAC002
     C           PMDI      ANDEQ'D'                                       CAC002
     C                     SUB  FXMR      PSXR                            CAC002
     C                     ELSE                                           CAC002
     C                     ADD  FXMR      PSXR                            CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C                     MOVE PSXR      ZFLD15
     C                     Z-ADD8         ZDECS
     C                     MOVE ' '       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVEL*BLANKS   SPSXR
     C                     MOVE ZOUT21    SPSXR
      *                                                                   CAC002
      **  Restore back original PSXR if anal acctg is installed           CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C           PPRE      IFEQ 'R'                                       CAC002
     C           PMDI      ANDEQ'M'                                       CAC002
     C           PPRE      OREQ 'P'                                       CAC002
     C           PMDI      ANDEQ'D'                                       CAC002
     C                     ADD  FXMR      PSXR                            CAC002
     C                     ELSE                                           CAC002
     C                     SUB  FXMR      PSXR                            CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C                     ELSE
     C                     MOVEL*BLANKS   SPSXR
     C                     END
     C*
     C**  TRANSLATE PMDI (#ALPV) SETTLEMENT EXCHANGE RATE M/D IND
     C*
     C                     MOVELPMDI      SPMDI
     C*
     C**  TRANSLATE PBRX (#AMNT) BASE EXCHANGE RATE
     C*
     C           PBRX      IFNE 0
     C                     MOVE PBRX      ZFLD15
     C                     Z-ADD8         ZDECS
     C                     MOVE ' '       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVEL*BLANKS   SPBRX
     C                     MOVE ZOUT21    SPBRX
     C                     ELSE
     C                     MOVEL*BLANKS   SPBRX
     C                     END
     C*
     C**  TRANSLATE PSMT (#ALPV) SETTLEMENT METHOD
     C*
     C                     MOVELPSMT      SPSMT
     C*
     C**  TRANSLATE PSEA (#ALPV)  SETTLEMENT ACCOUNT
     C*
     C                     MOVELPSEA      SPSEA
     C*
     C**  TRANSLATE PSEB (#NUMV)  SETTLEMENT BRANCH
     C**IF*BLANK*THEN*SET*TO*DEFAULT*SE*BRANCH*FROM*TABTB36***      E23192S01117
     C** If blank use default from DTAARA/ZMUSER                          S01117
     C*
     C           PSEB      IFNE *ZERO
     C           PSEB      ANDNE*BLANKS                                   E23192
     C                     MOVELPSEB      SPSEB
     C                     ELSE
     C*********************MOVEL*BLANKS   SPSEB                           E23192
     C***********          MOVE DSTB      SPSEB                     E23192S01117
     C                     MOVELUSRBCH    SPSEB                           S01117
     C                     END                             *PSEB
     C*
     C**  TRANSLATE PCPN (#ALPV)  COUNTERPARTY BANK
     C*
     C                     MOVELPCPN      SPCPN
     C*
     C**  TRANSLATE PFAC (#ALPV)  FOR A/C OF
     C*
     C                     MOVELPFAC      SPFAC
     C*
     C**  TRANSLATE PSPI (#ALPV) SPECIAL INSTRUCTIONS
     C*
     C                     MOVELPSPI      SPSPI
     C*
     C**  TRANSLATE PCHC (#ALPV) CHARGE CODE
     C*
     C                     MOVELPCHC      SPCHC
     C*
     C**  TRANSLATE PCHA (#AMNT) CHARGE AMOUNT
     C*
     C           PCHA      IFNE 0
     C                     MOVE PCHA      ZFLD15
     C           S01509    IFEQ 'Y'                                       S01509
     C                     Z-ADDPOSCDP    ZDECS                           S01509
     C                     ELSE                                           S01509
     C                     Z-ADDNOMCDP    ZDECS
     C                     END                                            S01509
     C                     MOVE ' '       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVEL*BLANKS   SPCHA
     C                     MOVE ZOUT21    SPCHA
     C                     ELSE
     C                     MOVEL*BLANKS   SPCHA
     C                     END
     C*
     C**  TRANSLATE PCCD (#ALPV) COMMISSION CODE
     C*
     C                     MOVELPCCD      SPCCD
     C*
     C**  TRANSLATE PCAM (#AMNT) COMMISSION AMOUNT
     C*
     C           PCAM      IFNE 0
     C                     MOVE PCAM      ZFLD15
     C           S01509    IFEQ 'Y'                                       S01509
     C                     Z-ADDPOSCDP    ZDECS                           S01509
     C                     ELSE                                           S01509
     C                     Z-ADDNOMCDP    ZDECS
     C                     END                                            S01509
     C                     MOVE ' '       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVEL*BLANKS   SPCAM
     C                     MOVE ZOUT21    SPCAM
     C                     ELSE
     C                     MOVEL*BLANKS   SPCAM
     C                     END
     C*
     C**  TRANSLATE PSAT (#AMNT) SETTLEMENT AMOUNT
     C*
     C****GET*SETTLEMENT*CURRENCY*RECORD*FROM*TABTG10*AND*USE*SPOT*RATE   S01117
     C**  Get Settlement Currency record from Currency file               S01117
     C*
     C***********          MOVE *BLANKS   KEY                             S01117
     C***********          MOVEL'20'      TYPE                            S01117
     C***********          MOVE '1'       KEY                             S01117
     C***********          MOVELSPSCU     KCCY2                           S01117
     C***********TABKEY    CHAINTABTG10F             99                   S01117
     C*                                                                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR'  @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SPSCU     @AJCD                           S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
      *                                                                   CAC002
      **  Translate FX Marg Points and Amount if anal acctg installed     CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
      *                                                                   CAC002
      **  FX Margin points and amount should not be displayed if          CAC002
      **  nominal ccy = settle ccy and action code is 'E'                 CAC002
      *                                                                   CAC002
     C           PNCY      IFEQ PSCU                                      CAC002
     C           ACTN      ANDEQ'E'                                       CAC002
     C                     MOVE '1'       *IN14                           CAC002
     C                     ELSE                                           CAC002
     C                     MOVE '0'       *IN14                           CAC002
      *                                                                   CAC002
      **  FX Margin Points                                                CAC002
      *                                                                   CAC002
     C                     MOVE *BLANKS   ZFLD15                          CAC002
     C                     MOVE FXMP      ZFLD15                          CAC002
     C                     Z-ADD2         ZDECS                           CAC002
     C                     MOVE *BLANK    ZECODE                          CAC002
     C                     EXSR ZSEDIT                                    CAC002
     C                     MOVE ZOUT21    SFXMP                           CAC002
      *                                                                   CAC002
      **  FX Margin Amount                                                CAC002
      *                                                                   CAC002
     C                     MOVE *BLANKS   ZFLD15                          CAC002
     C                     MOVE MAMT      ZFLD15                          CAC002
     C                     Z-ADDA6NBDP    ZDECS                           CAC002
     C                     MOVE 'J'       ZECODE                          CAC002
     C                     EXSR ZSEDIT                                    CAC002
     C                     MOVE *BLANKS   SMAMT                           CAC002
     C                     MOVE ZOUT21    SMAMT                           CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
     C*
     C           PSAT      IFNE 0
     C                     MOVE PSAT      ZFLD15
     C***********          Z-ADDCDP       ZDECS                           S01117
     C                     Z-ADDA6NBDP    ZDECS                           S01117
     C                     MOVE ' '       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVEL*BLANKS   SPSAT
     C                     MOVE ZOUT21    SPSAT
     C                     Z-ADDPSAT      WSVPSA                          086722
     C                     ELSE
     C*                                                                   086722
     C** If amount is 0, it is possible that it hasn't been computed,     086722
     C** therefore, calculate the settlement amount for S01512            086722
     C*                                                                   086722
     C           S01512    IFEQ 'Y'                                       086722
     C                     MOVE *BLANK    W2SCR                           086722
     C                     MOVELSPCPY     CUST                            086722
     C                     CALL 'AOSECSR0'                                086722
     C                     PARM *BLANKS   @RTCD                           086722
     C                     PARM '*KEY   ' @OPTN                           086722
     C                     PARM           CUST                            086722
     C           SDSECS    PARM SDSECS    DSSDY                           086722
     C                     EXSR PSAMT                                     086722
     C                     Z-ADDWPSAT     WSVPSA                          086722
     C                     ELSE                                           086722
     C                     MOVEL*BLANKS   SPSAT
     C                     ENDIF                                          086722
     C*                                                                   086722
     C                     END
      *                                                                   S01447
      *** Find and display tax deductible fields if S01447 installed      S01447
      ** If S01509 is active, use the decimal places from position ccy
      *                                                                   S01447
     C           S01447    IFEQ 'Y'                        *B1            S01447
     C           CSE007    OREQ 'Y'                                       CSE007
     C           WWPTYP    ANDEQ'DV'                                      CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C           WWPTYP    ANDEQ'DV'                                      CEU017
     C           CSE023    OREQ 'Y'                                       186055
      *                                                                   S01447
     C                     CLEARSTASO                                     S01447
     C                     CLEARSTASR                                     S01447
     C                     CLEARSTAUS                                     S01447
      *                                                                   S01447
     C           PEVT      IFEQ 'CP'                       *B2            S01447
     C           PEVT      OREQ 'DV'                                      S01447
     C           CSE007    OREQ 'Y'                                       CSE007
     C           WWPTYP    ANDEQ'DV'                                      CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C           WWPTYP    ANDEQ'DV'                                      CEU017
     C           CSE023    OREQ 'Y'                                       186166
     C           PEVT      ANDEQ'MT'                                      186166
      *                                                                   S01447
     C                     MOVE TASO      ZFLD15                          S01447
     C           S01509    IFEQ 'Y'                                       S01509
     C                     Z-ADDPOSCDP    ZDECS                           S01509
     C                     ELSE                                           S01509
     C                     Z-ADDNOMCDP    ZDECS                           S01447
     C                     END                                            S01509
     C                     MOVE ' '       ZECODE                          S01447
     C                     EXSR ZSEDIT                                    S01447
     C                     MOVE ZOUT21    STASO                           S01447
      *                                                                   S01447
     C                     MOVE TASR      ZFLD15                          S01447
     C           S01509    IFEQ 'Y'                                       S01509
     C                     Z-ADDPOSCDP    ZDECS                           S01509
     C                     ELSE                                           S01509
     C                     Z-ADDNOMCDP    ZDECS                           S01447
     C                     END                                            S01509
     C                     MOVE ' '       ZECODE                          S01447
     C                     EXSR ZSEDIT                                    S01447
     C                     MOVE ZOUT21    STASR                           S01447
      *                                                                   S01447
     C                     MOVE TAUS      ZFLD15                          S01447
     C           S01509    IFEQ 'Y'                                       S01509
     C                     Z-ADDPOSCDP    ZDECS                           S01509
     C                     ELSE                                           S01509
     C                     Z-ADDNOMCDP    ZDECS                           S01447
     C                     END                                            S01509
     C                     MOVE ' '       ZECODE                          S01447
     C                     EXSR ZSEDIT                                    S01447
     C                     MOVE ZOUT21    STAUS                           S01447
      *                                                                   S01447
     C                     END                             *E2            S01447
     C                     END                             *E1            S01447
      *                                                                                       233711
      ** Display EU Tax field if necessary.                                                   233711
      *                                                                                       233711
     C           CGL031    IFEQ 'Y'                                                           233711
     C           TXNM      IFNE *ZERO                                                         233711
     C                     MOVE TXNM      ZFLD15                                              233711
     C           S01509    IFEQ 'Y'                                                           233711
     C                     Z-ADDPOSCDP    ZDECS                                               233711
     C                     ELSE                                                               233711
     C                     Z-ADDNOMCDP    ZDECS                                               233711
     C                     ENDIF                                                              233711
     C                     MOVE *BLANK    ZECODE                                              233711
     C                     EXSR ZSEDIT                                                        233711
     C                     MOVE *BLANKS   STXNM                                               233711
     C                     MOVE ZOUT21    STXNM                                               233711
     C                     ELSE                                                               233711
     C                     MOVE *BLANKS   STXNM                                               233711
     C                     ENDIF                                                              233711
     C                     ENDIF                                                              233711
      *                                                                   S01447
     C           CER049    IFEQ 'Y'                                                           CER049
     C                     MOVELPBCA      K3PBCA                                              CER049
     C                     MOVELPSSH      K3PSSH                                              CER049
     C                     MOVE PCPY      K3PCPY                                              CER049
     C                     MOVE PDUD      K3PDUD                                              CER049
     C                     MOVELPEVT      K3PEVT                                              CER049
     C                     MOVE 99999     K3TNLU                                              CER049
     C           KPOST3    SETGTPOSETDD3                                                      CER049
     C                     READPPOSETDD3                 78                                   CER049
     C           *IN78     IFEQ '0'                                                           CER049
     C           PBCA      ANDEQP3PBCA                                                        CER049
     C           PSSH      ANDEQP3PSSH                                                        CER049
     C           PCPY      ANDEQP3PCPY                                                        CER049
     C           PDUD      ANDEQP3PDUD                                                        CER049
     C           PEVT      ANDEQP3PEVT                                                        CER049
     C                     MOVE *BLANKS   SPCHCD                                            AR875296
     C                     MOVEL*BLANKS   SPTAXA                                           AR875302A
     C                     MOVEL*BLANKS   SPCHAM                                           AR875302A
     C                     MOVE P3TAX     SPTAXL                                              CER049
     C                     MOVE P3STAF    WTAXA                                               CER049
     C                     ENDIF                                                              CER049
     C           SPTAXL    IFEQ 'Y'                                                         AR880129
     C                     CALL 'SD008141'                                                    CER049
     C                     PARM BJRDNB    U#DATE  50                                          CER049
     C                     PARM 'SECURITY'U#ORGN 10                                           CER049
     C                     PARM           ##TYPE  4                                           CER049
     C                     PARM           U#CTAX 138                                          CER049
     C                     PARM           U#MTAX 138                                          CER049
     C                     PARM           U#CCCY  3                                           CER049
     C                     PARM           U#MCCY  3                                           CER049
     C                     PARM           U#CSCC  2                                           CER049
     C                     PARM           U#MSCC  2                                           CER049
     C                     PARM           U#TXTY  1                                           CER049
     C                     PARM           SDSTPD                                              CER049
      *                                                                                       CER049
      * If there is a default for the Module use this tax rate and ccy                        CER049
      * otherwise use the ICD Control defaults.                                               CER049
     C           U#MTAX    IFNE *ZEROS                                                        CER049
     C                     MOVE U#MCCY    U#SCCY                                              CER049
     C                     MOVE U#MSCC    SPCHCD                                            AR875296
     C                     ELSE                                                               CER049
     C                     MOVE U#CCCY    U#SCCY                                              CER049
     C                     MOVE U#CSCC    SPCHCD                                            AR875296
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
      ** Access stamp tax currency for decimal places                                         CER049
      *                                                                                       CER049
     C                     CALL 'AOCURRR0'                                                    CER049
     C                     PARM '*DBERR'  @RTCD                                               CER049
     C                     PARM '*KEY   ' @OPTN                                               CER049
     C                     PARM U#SCCY    @AJCD                                               CER049
     C           SDCURR    PARM SDCURR    DSSDY                                               CER049
      *                                                                                       CER049
     C                     Z-ADDA6NBDP    ZDECS                                               CER049
     C                     MOVE WTAXA     ZFLD15                                              CER049
     C                     MOVE ' '       ZECODE                                              CER049
     C                     EXSR ZSEDIT                                                        CER049
     C                     MOVEL*BLANKS   SPTAXA                                              CER049
     C                     MOVEL*BLANKS   SPCHAM                                              CER049
     C                     MOVE ZOUT21    SPTAXA                                              CER049
     C                     MOVE ZOUT21    SPCHAM                                              CER049
     C                     ENDIF                                                              CER049
     C                     ENDIF                                                            AR880129
      *                                                                                       CER049
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
      *****************************************************************   S01412
      *   SEPTVS    - Validate field 72                               *   S01412
      *   Called by - VALIDD                                          *   S01412
      *                                                               *   S01412
      *   Input     - SIL    - the field to be validated              *   S01412
      *                                                               *   S01412
      *   Output    - CUL    - the field was invalid                  *   S01412
      *****************************************************************   S01412
      *                                                                   S01412
     C           SEPTVS    BEGSR                                          S01412
      *                                                                   S01412
      ** Store the current value of indicator 88                          S01412
      *                                                                   S01412
     C                     MOVEA*IN,88    STOAR   1                       S01412
      *                                                                   S01412
     C                     Z-ADD1         L       30                      S01412
     C                     MOVE *BLANK    CUL     1                       S01412
     C                     MOVE 'F'       SSF     1                       S01412
     C                     SETOF                     88                   S01412
      *                                                                   S01412
      ** First position must be a '/'                                     S01412
      *                                                                   S01412
     C           SIL,L     IFNE '/'                                       S01412
     C                     MOVE 'E'       CUL                             S01412
     C                     END                                            S01412
      *                                                                   S01412
     C                     Z-ADD2         L                               S01412
      *                                                                   S01412
      ** The first special instruction line cannot have '/'               S01412
      ** in position 2                                                    S01412
      *                                                                   S01412
     C           SIL,L     IFEQ '/'                                       S01412
     C                     MOVE 'E'       CUL                             S01412
     C                     END                                            S01412
      *                                                                   S01412
      ** Check the line for '8a/', where 8a represents                    S01412
      ** up to eight upper case alphabetic charaters                      S01412
      *                                                                   S01412
     C           SSF       DOUEQ'T'                                       S01412
     C           L         ORGT 10                                        S01412
     C           CUL       OREQ 'E'                                       S01412
      *                                                                   S01412
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C           SIL,L     LOKUPAPN                      88                                   CSW201
     C                     ELSE                                                               CSW201
     C           SIL,L     LOKUPUPA                      88               S01412
     C                     ENDIF                                                              CSW201
      *                                                                   S01412
     C           *IN88     IFNE '1'                                       S01412
     C                     MOVE 'E'       CUL                             S01412
     C                     END                                            S01412
      *                                                                   S01412
     C           SIL,L     IFEQ '/'                                       S01412
     C                     MOVE 'T'       SSF                             S01412
     C                     END                                            S01412
      *                                                                   S01412
     C                     ADD  1         L                               S01412
      *                                                                   S01412
     C                     END                                            S01412
      *                                                                   S01412
      ** Invalid if a second slash is not found                           S01412
      ** within the first ten characters of the                           S01412
      ** field being checked                                              S01412
      *                                                                   S01412
     C           SSF       IFEQ 'F'                                       S01412
     C                     MOVE 'E'       CUL                             S01412
     C                     END                                            S01412
      *                                                                   S01412
      ** Test the rest of the line for ISO format characters              S01412
      *                                                                   S01412
     C           L         DOUGT35                                        S01412
     C           CUL       OREQ 'E'                                       S01412
      *                                                                   S01412
     C           SIL,L     LOKUPSWCH                     88               S01412
      *                                                                   S01412
     C           *IN88     IFEQ '0'                                       S01412
     C                     MOVE 'E'       CUL                             S01412
     C                     END                                            S01412
      *                                                                   S01412
     C                     ADD  1         L                               S01412
      *                                                                   S01412
     C                     END                                            S01412
      *                                                                   CSW096
      ** Check for "/RCB/"                                                CSW096
      *                                                                   CSW096
     C                     MOVEL*BLANKS   USRCB   5                       CSW096
     C                     MOVEASIL,1     USRCB                           CSW096
     C           USRCB     IFEQ '/RCB/'                                   CSW096
     C                     MOVE 'X'       CUL                             CSW096
     C                     ENDIF                                          CSW096
      *                                                                   S01412
      ** Restore the current value of indicator 88                        S01412
      *                                                                   S01412
     C                     MOVEASTOAR     *IN,88                          S01412
      *                                                                   S01412
     C                     ENDSR                                          S01412
      *****************************************************************   S01412
     C/EJECT                                                              S01512
     C*****************************************************************   S01512
     C*                                                               *   S01512
     C*  PSAMT  - CALCULATE NEW SETTLEMENT AMOUNT AND AFTERWARDS      *   S01512
     C*           RE-DISPLAY THE SCREEN                               *   S01512
     C*                                                               *   S01512
     C*****************************************************************   S01512
     C*                                                                   S01512
     C           PSAMT     BEGSR                                          S01512
     C***********                                                  S01512 087178
     C***Calculate*settlement*amount*in*value*currency************ S01512 087178
     C***********                                                  S01512 087178
     C***********BFCLAS    IFEQ 'S'                        B1      S01512 087178
     C***********BFCLAS    OREQ 'D'                                S01512 087178
     C***********                                                  S01512 087178
     C***********SPPRE     IFEQ 'R'                        B2      S01512 087178
     C***********PAMD      ADD  PCHA      WRK130 130               S01512 087178
     C***********WRK130    ADD  PCAM      WRK130                   S01512 087178
     C***********          ELSE                            X2      S01512 087178
     C***********PAMD      SUB  PCHA      WRK130                   S01512 087178
     C***********WRK130    SUB  PCAM      WRK130                   S01512 087178
     C***********          END                             E2      S01512 087178
     C***********                                                  S01512 087178
     C***********          ELSE                            X1      S01512 087178
     C***********                                                  S01512 087178
     C***********SPPRE     IFEQ 'R'                        B2      S01512 087178
     C***********PAMD      SUB  PCHA      WRK130                   S01512 087178
     C***********WRK130    SUB  PCAM      WRK130                   S01512 087178
     C***********          ELSE                            X2      S01512 087178
     C***********PAMD      ADD  PCHA      WRK130                   S01512 087178
     C***********WRK130    ADD  PCAM      WRK130                   S01512 087178
     C***********          END                             E2      S01512 087178
     C***********          END                             E1      S01512 087178
     C***********                                                  S01512 087178
     C***Make*WRK130*a*positive*amount*for*conversion**************S01512 087178
     C***********                                                  S01512 087178
     C***********          MOVE 'N'       WWNEG   1                S01512 087178
     C***********WRK130    IFLT 0                                  S01512 087178
     C***********          Z-SUBWRK130    WRK130                   S01512 087178
     C***********          MOVE 'Y'       WWNEG   1                S01512 087178
     C***********          END                                     S01512 087178
     C***********                                                  S01512 087178
     C***Access*value*currency*for*decimal*places******************S01512 087178
     C***********                                                  S01512 087178
     C***********          CALL 'AOCURRR0'                         S01512 087178
     C***********          PARM '*DBERR'  @RTCD   7                S01512 087178
     C***********          PARM '*KEY   ' @OPTN   7                S01512 087178
     C***********          PARM SPNCY     @AJCD   3                S01512 087178
     C***********SDCURR    PARM SDCURR    DSSDY                    S01512 087178
     C***********          Z-ADDA6NBDP    ZCDPI                    S01512 087178
     C*                                                                   S01512
     C** Access settlement currency for decimal places                    S01512
     C*                                                                   S01512
     C                     CALL 'AOCURRR0'                                S01512
     C                     PARM '*DBERR'  @RTCD                           S01512
     C                     PARM '*KEY   ' @OPTN                           S01512
     C                     PARM SPSCU     @AJCD                           S01512
     C           SDCURR    PARM SDCURR    DSSDY                           S01512
     C*                                                                   S01512
     C                     Z-ADDA6NBDP    ZCDPO                           S01512
     C***********                                                  S01512 087178
     C***Convert*settlement*amount*from*value*currency*to*settlemenS01512 087178
     C***currency**************************************************S01512 087178
     C***********                                                  S01512 087178
     C***********          MOVE SPNCY     ZCCYI                    S01512 087178
     C***********          MOVE SPSCU     ZCCYO                    S01512 087178
     C***********          Z-ADDWRK130    ZAMTCI                   S01512 087178
     C***********          Z-ADDPSXR      ZEXCH                    S01512 087178
     C***********          MOVE PMDI      ZMD                      S01512 087178
     C***********          EXSR ZCONV                              S01512 087178
     C***********                                                  S01512 087178
     C***Format*settlement*amount*for*output***********************S01512 087178
     C***********                                                  S01512 087178
     C***********WWNEG     IFEQ 'Y'                                S01512 087178
     C***********          Z-SUBZAMTCO    ZAMTCO                   S01512 087178
     C***********          END                                     S01512 087178
     C***********          Z-ADDZAMTCO    PSAT                     S01512 087178
     C***********                                                  S01512 087178
     C***********          Z-ADDPSAT      WSPSAT 150               S01512 087178
     C***********                                                  S01512 087178
     C***********          Z-ADDSETCDP    ZDECS                    S01512 087178
     C*                                                                   087178
     C** Set up parameter for call to SEZ010                              087178
     C*                                                                   087178
     C                     MOVELBFCLAS    P@CLAS                          087178
     C                     MOVELSPPRE     P@PPRE                          087178
     C                     Z-ADDPAMD      P@PAMD                          087178
     C                     Z-ADDPCHA      P@PCHA                          087178
     C                     Z-ADDPCAM      P@PCAM                          087178
     C                     Z-ADDTASO      P@TASO                          087178
     C                     Z-ADDTAUS      P@TAUS                          087178
     C                     Z-ADDPSXR      P@PSXR                          087178
     C                     MOVELPMDI      P@PMDI                          087178
     C                     MOVELSPNCY     P@PNCY                          087178
     C                     MOVELSPSCU     P@PSCU                          087178
     C                     MOVELWTAXA     P@STAM                                            AR851833
     C/COPY WNCPYSRC,SE0170C009
      *                                                                                       233711
     C********** *IN75     IFEQ *ON                                                    233711 234471
     C           *IN78     IFEQ *ON                                                           234471
     C                     ADD  TXNM      P@TASO                                              233711
     C                     ENDIF                                                              233711
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     Z-ADDFXMR      P@FXMR                          CAC002
      *                                                                   CAC002
     C           SPPRE     IFEQ 'R'                                       CAC002
     C                     MOVE 'TS'      P@TDTP                          CAC002
     C                     ELSE                                           CAC002
     C                     MOVE 'TP'      P@TDTP                          CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   087178
     C** Call SEZ010 to calculate the settlement amount                   087178
     C*                                                                   087178
     C                     CALL 'SEZ010'                                  087178
     C                     PARM *BLANKS   P@RCDE  7                       087178
     C                     PARM           P@DATA                          087178
     C           P@RCDE    IFEQ *BLANKS                                   087178
     C                     Z-ADDP@PSAT    PSAT                            087178
     C                     Z-ADDPSAT      WPSAT                           CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     Z-ADDP@MAMT    MAMT                            CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C                     ELSE                                           087178
     C                     EXSR *PSSR                                     087178
     C                     ENDIF                                          087178
     C*                                                                   087178
     C***********          MOVE ZAMTCO    ZFLD15                          087178
     C                     Z-ADDZCDPO     ZDECS                    S01512 087178
     C                     MOVE P@PSAT    ZFLD15                   S01512 087178
     C                     MOVE ' '       ZECODE                          S01512
     C                     EXSR ZSEDIT                                    S01512
     C                     MOVEL*BLANKS   SPSAT                           S01512
     C                     MOVE ZOUT21    SPSAT                           S01512
      *                                                                   CAC002
      **  Convert marg amt to screen format if anal acctg is installed    CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE *BLANKS   ZFLD15                          CAC002
     C                     MOVE MAMT      ZFLD15                          CAC002
     C                     Z-ADDZCDPO     ZDECS                           CAC002
     C                     MOVE 'J'       ZECODE                          CAC002
     C                     EXSR ZSEDIT                                    CAC002
     C                     MOVE *BLANKS   SMAMT                           CAC002
     C                     MOVE ZOUT21    SMAMT                           CAC002
     C                     ENDIF                                          CAC002
      *                                                                   186166
      ** Protect Tax field if action is 'A' and security is for           186166
      ** treaty tax.                                                      186166
      *                                                                   186166
     C           ACTN      IFEQ 'A'                                       186166
     C           WFREEM    ANDEQ'Y'                                       186166
     C                     MOVE '1'       *IN66                           186166
     C                     ELSE                                           186166
     C                     MOVE '0'       *IN66                           186166
     C                     ENDIF                                          186166
     C*                                                                   S01512
     C** Redisplay screen to show the computed settlement amount          S01512
     C** Only if action is insert or settlement amount was changed        086722
     C*                                                                   S01512
     C           ACTN      IFEQ 'I'                                       086722
     C           ACTN      OREQ 'A'                                       086722
     C           WPSAT     ANDNEWSVPSA                                    086722
     C           W2SCR     ANDEQ'Y'                                       086722
     C/COPY WNCPYSRC,SE0170C045
     C                     MOVEA'11'      *IN,5                           S01512
      *                                                                                       211749
      ** Switch off *IN06 to allow change of fields in error.                                 211749
      *                                                                                       211749
     C           ACTN      IFEQ 'I'                                                           211749
     C                     MOVE '0'       *IN06                                               211749
     C                     ENDIF                                                              211749
     C           ACTN      IFEQ 'R'                                       186400
     C                     MOVELINF,13    INFMSG                          186400
     C                     END                                            186400
      *                                                                   186400
     C********** INFMSG    DOUEQ*BLANK                                                 S01512 220465
     C/COPY WNCPYSRC,SE0170C022
     C**********           WRITEKEYINPUT                                               S01512 220465
     C/COPY WNCPYSRC,SE0170C053
     C**********           WRITERECDETLS                                               S01512 220465
     C**********           WRITEMESSAGES                                               S01512 220465
     C**********           READ RECDETLS                 99                            S01512 220465
     C**********           MOVE *BLANKS   SCRMSG                                       S01512 220465
     C                     MOVE *BLANKS   WCNCL   1                       S01512
     C*                                                                   S01512
     C** Check for the keys pressed                                       S01512
     C*                                                                   S01512
     C                     EXSR ASCHGS                                    S01512
     C                     SELEC                                          S01512
     C           AID       WHEQ '01'                                      S01512
     C                     MOVE '1'       *IN12                           S01512
     C                     MOVE 'Y'       WCNCL                           S01512
     C           AID       WHEQ '05'                                      S01512
     C                     MOVE '1'       *IN10                           S01512
     C                     MOVE 'Y'       WCNCL                           S01512
     C           AID       WHEQ '04'                                      S01512
     C                     MOVELINF,11    INFMSG                          S01512
     C           AID       WHEQ 'UP'                                      S01512
     C                     MOVELINF,8     INFMSG                          S01512
     C***********AID       WHEQ 'DN'                               S01512 084981
     C***********          MOVELINF,9     INFMSG                   S01512 084981
     C                     ENDSL                                          S01512
     C**********           END                                                         S01512 220465
     C*                                                                   S01512
     C                     ENDIF                                          086722
     C*                                                                   086722
     C/COPY WNCPYSRC,SE0170C046
     C           PSAMT9    ENDSR                                          S01512
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  UPDFLS  - S/R TO UPDATE FILE RECORDS                         *
     C*  CALLED FROM: UPDATE                                          *
     C*  CALLS: UPDOWS; VALIDD; INITRC; ZTNLU1; INFSR                 *
     C*                                                               *
     C*****************************************************************
     C*
     C           UPDFLS    BEGSR
     C*
     C** INITIALIZE ALL FIELDS ON THE RECORD (IE ZEROIZE/BLANK OUT)
     C*
     C                     EXSR INITRC
     C*
     C** RETRIEVE NEXT TRANSACTION NUMBER
     C*
     C/COPY WNCPYSRC,SE0170C010
     C                     EXSR ZTNLU1
     C/COPY WNCPYSRC,SE0170C011
     C*
     C** INITIALISE ERROR BAND
     C*
     C                     MOVEL*BLANK    INFMSG
      *                                                                                       191161
     C           *LIKE     DEFN TNL1      TNLU1                                               191161
     C                     Z-ADDTNL1      TNLU1                                               191161
     C*                                                                   S01486
     C** SET UP PORTFOLIO REFERENCE                                       S01486
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           SPPTFR    IFEQ FCR997                                    S01486
     C           SPPTFR    ANDNE*BLANKS                                   130059
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C                     MOVE '9997'    PTFR                            S01486
     C                     ELSE                                           S01486
     C                     MOVE SPPTFR    PTFR                            S01486
     C                     END                                            S01486
     C                     END                                            S01486
      *                                                                   CSE023
      ** Update processing for CSE023 STARTS here.                        CSE023
      **  If CSE023 - Withholding tax details is installed, setup         CSE023
      **  necessary fields.                                               CSE023
      *                                                                   CSE023
     C           CSE023    IFEQ 'Y'                                       CSE023
      *                                                                   CSE023
      ** If Tax Basket entered is valid.                                  CSE023
      ** Narrative - from tax basket details.                             CSE023
     C                     MOVELSTXBS     TXBS                            CSE023
     C                     MOVELWTBNAR    TXBN                            CSE023
      *                                                                   CSE023
      ** Exemption code                                                   CSE023
     C                     MOVE SEXCD     EXCD                            CSE023
      *                                                                   CSE023
      ** Income Type and Country of Tax Treaty - from securities detail.  CSE023
     C                     MOVELINCT      ICTP                            CSE023
     C                     MOVELCRTT      CRTX                            CSE023
      *                                                                   CSE023
     C                     MOVELKYBNFO    BNFO                            CSE023
      *                                                                   CSE023
      ** Customer Type - based on classification of customer.             CSE023
     C           BFCLAS    IFEQ 'S'                                       CSE023
     C           BFCLAS    OREQ 'D'                                       CSE023
     C                     MOVEL'C'       CTYP                            CSE023
     C                     ELSE                                           CSE023
     C                     MOVEL'D'       CTYP                            CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
      ** MT565 message required - only if customer type is 'D' and        CSE023
      ** a swift address exist.                                           CSE023
     C           CTYP      IFEQ 'D'                                       CSE023
     C           BBCSID    ANDEQ*BLANKS                                   CSE023
     C           BBSTAD    ANDEQ*BLANKS                                   CSE023
     C           BBTXA1    ANDEQ*BLANKS                                   CSE023
     C                     MOVEL'N'       MT5R                            CSE023
     C                     ELSE                                           CSE023
     C                     MOVEL'Y'       MT5R                            CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
      ** Action code is 'I - insert'.                                     CSE023
      ** Initialize necessary fields.                                     CSE023
     C           ACTN      IFEQ 'I'                                       CSE023
     C                     MOVEL'N'       MT5G                            CSE023
     C                     Z-ADD001       PSEQ                            CSE023
     C                     MOVEL*ZEROS    PREF                            CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
      ** Customer Tax ID no - based on user input or customer number      CSE023
      ** and beneficial owner combination.                                CSE023
     C           SBNFO     IFNE *BLANKS                                   CSE023
     C                     MOVELBNTXID    CTIN                            CSE023
     C                     ELSE                                           CSE023
     C           BFCLAS    IFEQ 'S'                                       186000
     C           BFCLAS    OREQ 'D'                                       186000
     C                     MOVELWHTIN     CTIN                            186000
     C                     ELSE                                           186000
     C                     MOVEL*BLANKS   CTIN                            CSE023
     C                     ENDIF                                          CSE023
     C                     ENDIF                                          186000
      *                                                                   CSE023
      ** Total discount amount - based on Original Interest Discount,     CSE023
      ** reset or calculate.                                              CSE023
     C                     EXSR CLDAMT                                    CSE023
     C                     Z-ADDWDAMT     DAMT                            CSE023
      *                                                                   CSE023
      ** Update processing for CSE023 ENDS here.                          CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C                     MOVE ACTN      SACTN   1                                         AR324886
     C*
     C**  I  N  S  E  R  T  S                 -  S T A R T
     C*
     C           ACTN      IFEQ 'I'
      *                                                                   CSE023
      ** If CSE023 is *ON, Then set up depot field.                       CSE023
      *                                                                   CSE023
     C           CSE023    IFEQ 'Y'                                       CSE023
     C           BFCLAS    IFEQ 'S'                                       CSE023
     C           BFCLAS    OREQ 'D'                                       CSE023
     C           SBNFO     IFNE *BLANKS                                   CSE023
     C           BNDEPT    ANDNE*BLANKS                                   CSE023
     C                     MOVE BNDEPT    DEPT                            CSE023
     C                     ELSE                                           CSE023
     C                     MOVE SPSSH     @PSSH                           CSE023
     C                     MOVELCUSTNO    @ZCUST                          CSE023
     C           CDPKEY    CHAINCDEPS                99                   CSE023
     C                     MOVE CDPT      DEPT                            CSE023
     C                     ENDIF                                          CSE023
     C                     ENDIF                                          CSE023
     C                     ENDIF                                          CSE023
     C********** BGPFMG    IFEQ 'Y'                                S01486 CSE023
     C********** BGN4ST    OREQ 'Y'                                CPB001 CSE023
     C********** PTFRK     CHAINPOSETDF              60    *       S01486 CSE023
     C******************** Z-ADDSEQ       RECSEQ                   S01486 080743
     C********** RECSEQ    DOWGT1                                  S01486 080743
     C********** *IN60     ANDEQ'0'                                S01486 080743
     C********** PTFRK     READEPOSETDF                  60        S01486 080743
     C******************** SUB  1         RECSEQ                   S01486 080743
     C******************** END                                     S01486 080743
     C**********           ELSE                                    S01486 CSE023
     C********** POSETK    CHAINPOSETDF              60    *              CSE023
     C**********           Z-ADDSEQ       RECSEQ                   E37157 CSE023
     C********** RECSEQ    DOWGT1                                  E37157 CSE023
     C********** *IN60     ANDEQ'0'                                E37157 CSE023
     C********** POSETK    READEPOSETDF                  60        E37157 CSE023
     C**********           SUB  1         RECSEQ                   E37157 CSE023
     C**********           END                                     E37157 CSE023
     C**********           END                                     S01486 CSE023
      *                                                                   CSE023
     C                     SELEC                                          CSE023
     C           CSE023    WHEQ 'Y'                                       CSE023
     C********** STXBS     ANDNE*BLANKS                            CSE023 186055
     C********** PTXBSK    CHAINPOSETDF              60                              CSE023 BUG12729
     C           PTXBS6    CHAINPOSETDF6             60                                     BUG12729
      *                                                                   CSE023
     C           BGPFMG    WHEQ 'Y'                                       CSE023
     C           BGN4ST    OREQ 'Y'                                       CSE023
     C           PTFRK     CHAINPOSETDF              60                   CSE023
      *                                                                   CSE023
     C                     OTHER                                          CSE023
     C********** POSETK    CHAINPOSETDF              60            CSE023 203678
     C           POSTK1    CHAINPOSETDF              60                   203678
     C**********           Z-ADDSEQ       RECSEQ                                       CSE023 247951
      **********                                                                       CSE023 247951
     C********** RECSEQ    DOWGT1                                                      CSE023 247951
     C********** *IN60     ANDEQ'0'                                                    CSE023 247951
     C********** POSETK    READEPOSETDF                  60                            CSE023 247951
     C**********           SUB  1         RECSEQ                                       CSE023 247951
     C**********           ENDDO                                                       CSE023 247951
      *                                                                   CSE023
     C                     ENDSL                                          CSE023
      *                                                                   CSE023
     C***********TNLU      IFNE STNLU                                     S01486
     C           TNL1      IFNE STNLU                                     S01486
     C           *IN60     ANDEQ'0'                                       185397
     C                     EXSR UPDOWS
     C*
     C** IF NO PROCESSING OCCURRED EXIT TO SUPPRESS AUDIT UPDATE
     C*
     C                     GOTO XTUPDF
     C*
     C                     ELSE
     C*
     C** TRANSLATE RECORD DETAILS FROM SCREEN LAYOUT TO FILE LAYOUT
     C*
     C                     EXSR VALIDD
     C*                                                                   S01512
     C** If S01512 is active, compute for the settlement amount           S01512
     C** and redisplay the screen to shown the computed value.            S01512
     C** Exit to suppress update when F3 or F12 is taken from screen      S01512
     C*                                                                   S01512
      *                                                                   CAC002
      **  Ignore checking of S01512 when executing PSAMT if anal acctg    CAC002
      **  is installed                                                    CAC002
      *                                                                   CAC002
     C           S01512    IFEQ 'Y'                                       S01512
     C           BGN0ST    OREQ 'Y'                                       CAC002
     C                     EXSR PSAMT                                     S01512
     C                     Z-ADDWPSAT     PSAT                            086722
     C           WCNCL     IFEQ 'Y'                                       S01512
     C                     GOTO XTUPDF                                    S01512
     C                     END                                            S01512
     C                     END                                            S01512
     C                     MOVEL'D'       RECI
     C                     MOVE 'S'       PMAR
     C*
     C**  Only action code 'Y' should authorise Settlements               E20237
     C***MANUAL*SETTLEMENTS*SHOULD*NOT*REQUIRE*SEPARATE*AUTHORIZATION.9438E20237
     C*
     C***********          MOVE 'Y'       PAUI                      E19438E20237
     C                     MOVE ' '       PAUI                            E20237
     C                     MOVE 'Y'       PSMI                            S01401
     C                     Z-ADDRUND      LCD
     C***********          Z-ADDRUND      PDTG                            E14882
     C                     Z-ADD0         PDTG                            E14882
     C                     MOVEL'I'       CHTP
     C***********          MOVELNATN      TNLU                            S01486
      *                                                                                       CRE020
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C           CER049    OREQ 'Y'                                                           CER049
     C                     MOVE TNL1      WTNL1   50                                          CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     MOVELNATN      TNL1                            S01486
     C                     Z-ADD0         SABC                            185397
     C                     END
      *                                                                                       CSD015
     C           W1EWLC    IFEQ 'Y'                                                           CSD015
     C           CSC011    IFEQ 'N'                                                           CSD015
     C           CSC011    OREQ 'Y'                                                           CSD015
     C           S1MAIN    ANDEQLIBR                                                          CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C***60******          WRITEPOSETDF                15  *              118340
      *                                                                   185397
      ** If CSE023 is present and the new record inserted is for depot wit185397
      ** SWIFT, then need to get SWIFT Reference from the other records   185397
      ** from position settlement file and set the generation indicator fo185397
      ** the re-send of messages.                                         185397
      *                                                                   185397
     C           CSE023    IFEQ 'Y'                                       185397
     C           MT5R      ANDEQ'Y'                                       185397
     C                     CALL 'SE1878'                                  185397
     C                     PARM           PBCA                            185397
     C                     PARM           PSSH                            185397
     C                     PARM           PDUD                            185397
     C                     PARM           PEVT                            185397
     C                     PARM           PCPY                            185397
     C                     PARM           @PREF   6                       185397
     C                     PARM           @PSEQ   30                      185397
     C                     ENDIF                                          185397
     C           @PREF     IFNE '000000'                                  185397
     C           @PREF     ANDNE*BLANK                                    185397
     C                     MOVE @PREF     PREF                            185397
     C                     Z-ADD@PSEQ     PSEQ                            185397
     C                     MOVE 'R'       MT5G                            185397
     C                     END                                            185397
      *                                                                   185397
     C********** *IN60     IFEQ '1'                                118340 186400
     C           CSE023    IFEQ 'Y'                                                         BUG12729
     C                     WRITEPOSETDF6               15                                   BUG12729
     C                     EXSR PSAUDT                                                      AR324886
     C                     ELSE                                                             BUG12729
     C                     WRITEPOSETDF                15  *              118340
     C                     EXSR PSAUDT                                                      AR324886
     C                     ENDIF                                                            BUG12729
     C           *IN15     IFEQ '0'                                       118340
      *                                                                                       CRE020
      ** Handle the advice index of this transaction if CRE020 is enabled.                    CRE020
      *                                                                                       CRE020
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C           WSV01     ANDEQ'Y'                                                           CRE020
     C           CER049    OREQ 'Y'                                                           CER049
     C                     EXSR SRTNLU                                                        CRE020
     C                     EXSR SRIDXT                                                        CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C           1         CHAINPOSETAF              99    *              118340
     C*                                                                   118340
     C** UPDATE AUDIT RECORD IF FOUND                                     118340
     C*                                                                   118340
     C           *IN99     IFEQ '0'                                       118340
     C*                                                                   118340
     C** FOR INSERT, UPDATE LIVE RECORDS INSERTED TODAY, AND NO. OF LIVE  118340
     C** RECORDS                                                          118340
     C*                                                                   118340
     C           ACTN      IFEQ 'I'                                       118340
     C                     ADD  1         NOIN             *NO.INSD TDY   118340
     C                     ADD  1         NORE             *NO.LIVE RCS   118340
     C                     END                                            118340
     C*                                                                   118340
     C** FORMAT COMIT TEXT                                                118340
     C*                                                                   118340
     C                     TIME           MTIME                           118340
     C                     MOVELACTN      ACTNX                           118340
     C                     MOVEASCRCTL    DET,01                          118340
     C                     MOVEADETS      DET,26                          118340
     C*                                                                   118340
     C** UPDATE AUDIT RECORD                                              118340
     C*                                                                   118340
     C                     UPDATPOSETAF                                   118340
     C                     ENDIF                                          118340
     C                     ENDIF                                          118340
     C**********           ENDIF                                   118340 186400
     C/COPY WNCPYSRC,SE0170C091
     C*
     C**  TEST FOR UPDATE BY ANOTHER W/S, OR A TERMINAL ERROR
     C*
     C           *IN15     IFEQ '1'
     C           STATUS    ANDEQ01021
     C** IF PORTFOLIO MANAGEMENT INSTALLED                                S01486
     C           CSE023    IFEQ 'Y'                                       186055
     C           PTXBSK    CHAINPOSETX               15                   186055
     C                     ELSE                                           186055
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           PTFRK     CHAINPOSETX               15                   S01486
     C******************** Z-ADDSEQ       RECSEQ                   S01486 080743
     C********** RECSEQ    DOWGT1                                  S01486 080743
     C********** *IN15     ANDEQ'0'                                S01486 080743
     C********** PTFRK     READEPOSETX                   15        S01486 080743
     C******************** SUB  1         RECSEQ                   S01486 080743
     C******************** END                                     S01486 080743
     C                     ELSE                                           S01486
     C           POSETK    CHAINPOSETX               15    *RECORD
     C                     Z-ADDSEQ       RECSEQ                          E37157
     C           RECSEQ    DOWGT1                                         E37157
     C           *IN15     ANDEQ'0'                                       E37157
     C           POSETK    READEPOSETX                   15               E37157
     C                     SUB  1         RECSEQ                          E37157
     C                     END                                            E37157
     C                     END                                            S01486
     C                     ENDIF                                          186055
     C           *IN15     IFEQ '0'                        *EXISTS
     C                     EXSR UPDOWS
     C                     GOTO XTUPDF
     C                     END                             *IN,15=0
     C                     END                             *IN,15=1
     C           *IN15     IFEQ '1'                        *NO RECORD
     C                     EXSR INFSR                      *END PGM
     C                     END                             *IN,15=1
     C*
     C**********           MOVE 'S'       PMAR                            186400
     C**N60*****           UPDATPOSETDF                                   186400
     C/COPY WNCPYSRC,SE0170C092
      *                                                                   082738
      ** Insertion - Before & After Status                                082738
      *                                                                   082738
     C                     MOVEL*BLANK    Z#BSTS                          082738
     C                     MOVELPBCA      PBCAX                           082738
     C                     MOVELPSSH      PSSHX                           082738
     C                     MOVELPCPY      PCPYX                           082738
     C                     MOVELPDUD      PDUDX                           082738
     C                     MOVELPEVT      PEVTX                           082738
     C                     MOVELTXBS      TXBSX                           186055
     C                     MOVELBNFO      BNFOX                           186055
     C                     MOVELEXCD      EXCDX                           186055
     C                     MOVELDETREC    Z#ASTS                          082738
      *                                                                   082738
     C                     ELSE
     C*
     C**  I  N  S  E  R  T  S                 -  E N D
     C*
     C**  A  M  E  N  D  S                    -  S T A R T
     C*
     C           ACTN      IFEQ 'A'
     C           ACTN      OREQ 'U'                                                         AR324886
     C** IF PORTFOLIO MANAGEMENT INSTALLED                                S01486
     C********** BGPFMG    IFEQ 'Y'                                S01486 CSE023
     C********** BGN4ST    OREQ 'Y'                                CPB001 CSE023
     C********** PTFRK     CHAINPOSETX               60            S01486 080743
     C********** PTFRK     CHAINPOSETDF              60            080743 CSE023
     C******************** Z-ADDSEQ       RECSEQ                   S01486 080743
     C********** RECSEQ    DOWGT1                                  S01486 080743
     C********** *IN60     ANDEQ'0'                                S01486 080743
     C********** PTFRK     READEPOSETDF                  60        S01486 080743
     C******************** SUB  1         RECSEQ                   S01486 080743
     C******************** END                                     S01486 080743
     C**********           ELSE                                    S01486 CSE023
     C********** POSETK    CHAINPOSETDF              60    *              CSE023
     C**********           Z-ADDSEQ       RECSEQ                   E37157 CSE023
     C********** RECSEQ    DOWGT1                                  E37157 CSE023
     C********** *IN60     ANDEQ'0'                                E37157 CSE023
     C********** POSETK    READEPOSETDF                  60        E37157 CSE023
     C**********           SUB  1         RECSEQ                   E37157 CSE023
     C**********           END                                     E37157 CSE023
     C**********           END                                     S01486 CSE023
      *                                                                   CSE023
     C                     SELEC                                          CSE023
     C           CSE023    WHEQ 'Y'                                       CSE023
     C********** STXBS     ANDNE*BLANKS                            CSE023 186055
      *                                                                   186055
      ** Set up key for CHAIN                                             186055
      *                                                                   186055
     C           SBNFO     IFNE *BLANKS                                   186055
     C                     MOVELBFCUST    BNFO                            186055
     C                     MOVE SBNFO     BNFO                            186055
     C                     ELSE                                           186055
     C                     MOVE *BLANKS   BNFO                            186055
     C                     END                                            186055
      *                                                                   186055
     C********** PTXBSK    CHAINPOSETDF              60                              CSE023 BUG12729
     C           PTXBS6    CHAINPOSETDF6             60                                     BUG12729
      *                                                                   CSE023
     C           BGPFMG    WHEQ 'Y'                                       CSE023
     C           BGN4ST    OREQ 'Y'                                       CSE023
     C           PTFRK     CHAINPOSETDF              60                   CSE023
      *                                                                   CSE023
     C                     OTHER                                          CSE023
     C********** POSETK    CHAINPOSETDF              60            CSE023 203678
     C           POSTK1    CHAINPOSETDF              60                   203678
     C**********           Z-ADDSEQ       RECSEQ                                       CSE023 247951
      **********                                                                       CSE023 247951
     C********** RECSEQ    DOWGT1                                                      CSE023 247951
     C********** *IN60     ANDEQ'0'                                                    CSE023 247951
     C********** POSETK    READEPOSETDF                  60                            CSE023 247951
     C**********           SUB  1         RECSEQ                                       CSE023 247951
     C**********           ENDDO                                                       CSE023 247951
      *                                                                   CSE023
     C                     ENDSL                                          CSE023
      *                                                                   CSE023
     C***********                                                   E20237E24426
     C****ONLY*UNAUTHORISED*SETTLEMENTS*CAN*BE*AMENDED***           E20237E24426
     C***********                                                   E20237E24426
     C***********PAUI      IFEQ 'Y'                                 E20237E24426
     C***********          MOVEL'E'       ACTN                      E20237E24426
     C***********          GOTO XTUPDF                              E20237E24426
     C***********          END                                      E20237E24426
     C***********                                                   E20237E24426
     C**N60******          Z-ADDPCPY      SVPCPY                   E16843 082738
     C**N60******          MOVEDPAUI      SVPAUI                   E16843 082738
     C**N60******          MOVEDPPRE      SVPPRE                   E16843 082738
     C**N60******          MOVEDPSCU      SVPSCU                   E16843 082738
     C**N60******          Z-ADDPSMT      SVPSMT                   E16843 082738
     C**N60******          MOVEDPSEA      SVPSEA                   E16843 082738
     C**N60******          MOVEDPSEB      SVPSEB                   E16843 082738
     C**N60******          Z-ADDPSAT      SVPSAT                   E16843 082738
     C**N60******          MOVEDPBCA      SVPBCA                   S01117 082738
     C***********TNLU      IFNE STNLU                                     S01486
     C           TNL1      IFNE STNLU                                     S01486
     C                     EXSR UPDOWS
     C*
     C** IF NO PROCESSING OCCURRED EXIT TO SUPPRESS AUDIT UPDATE
     C*
     C                     GOTO XTUPDF
     C*
     C                     ELSE
     C*
      ** Amendment - Before Status                                        082738
      *                                                                   082738
     C                     MOVELPBCA      PBCAX                           082738
     C                     MOVELPSSH      PSSHX                           082738
     C                     MOVELPCPY      PCPYX                           082738
     C                     MOVELPDUD      PDUDX                           082738
     C                     MOVELPEVT      PEVTX                           082738
     C                     MOVELTXBS      TXBSX                           186055
     C                     MOVELBNFO      BNFOX                           186055
     C                     MOVELEXCD      EXCDX                           186055
     C**********           MOVELDETREC    Z#BSTS                                       082738 220952
      *****************************************************************                220952 247951
      ***Before*status*not*needed*to*avoid*twice*update*in*ACMV*files**                220952 247951
      *****************************************************************                220952 247951
     C**********           MOVEL*BLANKS   Z#BSTS                                       220952 247951
     C**********           MOVELDETREC    Z#BSTS                                       247951 250115
     C           PAUI      IFEQ 'Y'                                                           250115
     C                     MOVELDETREC    Z#BSTS                                              250115
     C                     ELSE                                                               250115
     C                     MOVEL*BLANKS   Z#BSTS                                              250115
     C                     ENDIF                                                              250115
      *                                                                                   AR1095995A
     C           PDTG      IFNE *ZERO                                                     AR1095995A
     C           LCD       ANDLTBJRDNB                                                    AR1095995A
     C                     MOVEL*BLANKS   Z#BSTS                                          AR1095995A
     C                     ENDIF                                                          AR1095995A
      *                                                                   CAC002
      **  Save exchange rate and margin points fields for checking        CAC002
      **  of entry changes after validation                               CAC002
      *                                                                   CAC002
     C                     MOVE SPSXR     WSPSXR 15                       CAC002
     C                     MOVE SPMDI     WSPMDI  1                       CAC002
     C                     MOVE SFXMP     WSFXMP  9                       CAC002
      *                                                                   082738
      ** Store details that will affect projection on a temp variable                         CRE020
      *                                                                                       CRE020
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C                     Z-ADDPAMD      WPAMD  130                                          CRE020
     C                     MOVE *BLANKS   WPPRE                                               CRE020
     C                     MOVE PPRE      WPPRE   1                                           CRE020
     C                     MOVE *BLANKS   WPSCU                                               CRE020
     C                     MOVE PSCU      WPSCU   3                                           CRE020
     C                     Z-ADDPSXR      WPSXR  138                                          CRE020
     C                     MOVE *BLANKS   WPMDI                                               CRE020
     C                     MOVE PMDI      WPMDI   1                                           CRE020
     C                     Z-ADDPBRX      WPBRX  138                                          CRE020
     C                     Z-ADDPSMT      WPSMT   20                                          CRE020
     C                     MOVE *BLANKS   WPSEA                                               CRE020
     C**********           MOVE PSEA      WPSEA  12                                    CRE020 CAS010
     C                     MOVE PSEA      WPSEA  18                                           CAS010
     C                     MOVE *BLANKS   WPSEB                                               CRE020
     C                     MOVE PSEB      WPSEB   3                                           CRE020
     C                     Z-ADDPCHA      WPCHA  130                                          CRE020
     C                     Z-ADDPCAM      WPCAM  130                                          CRE020
     C                     Z-ADDPSAT      WPSAT2 130                                          CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C** TRANSLATE RECORD DETAILS FROM SCREEN LAYOUT TO FILE LAYOUT
     C*
     C                     EXSR VALIDD
     C*                                                                   S01512
     C** If S01512 is active, compute for the settlement amount           S01512
     C** and redisplay the screen to shown the computed value.            S01512
     C** Exit to suppress update when F3 or F12 is taken from screen      S01512
     C*                                                                   S01512
      **  Execute PSAMT also if anal acctg is installed and either        CAC002
      **  exchange rate or margin points were changed                     CAC002
      *                                                                   CAC002
     C           S01512    IFEQ 'Y'                                       S01512
     C           BGN0ST    OREQ 'Y'                                       CAC002
     C           SPSXR     ANDNEWSPSXR                                    CAC002
     C           BGN0ST    OREQ 'Y'                                       CAC002
     C           SPMDI     ANDNEWSPMDI                                    CAC002
     C           BGN0ST    OREQ 'Y'                                       CAC002
     C           SFXMP     ANDNEWSFXMP                                    CAC002
     C                     MOVE 'Y'       W2SCR   1                       086722
     C                     EXSR PSAMT                                     S01512
     C                     Z-ADDWPSAT     PSAT                            086722
     C           WCNCL     IFEQ 'Y'                                       S01512
     C                     GOTO XTUPDF                                    S01512
     C                     END                                            S01512
     C                     END                                            S01512
     C*
     C** Only action 'Y' should authorise settlements                     E20237
     C*
     C***********          MOVE 'Y'       PAUI                            E20237
     C                     MOVE ' '       PAUI                                                218520
     C                     MOVE 'Y'       PSMI                            S01401
     C                     Z-ADDRUND      LCD
     C                     MOVEL'A'       CHTP
     C***********          MOVELNATN      TNLU                            S01486
      *                                                                                       CRE020
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C           CER049    OREQ 'Y'                                                           CER049
     C                     MOVE TNL1      WTNL1                                               CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     MOVELNATN      TNL1                            S01486
     C                     END
     C                     MOVE 'S'       PMAR
     C*                                                                   099270
     C** If S01512 is active, work out payment/value date for screen      099270
     C*                                                                   099270
     C  N60      S01512    IFEQ 'Y'                                       099270
     C                     Z-ADDPSVL      ZDAYNO                          099270
     C                     EXSR ZDATE2                                    099270
     C                     MOVELZDATE     SFPSVL                          099270
     C                     ENDIF                                          099270
     C*                                                                   099270
     C           PSAT      IFEQ 0                                         102777
     C           P@PSAT    ANDNE0                                         102777
     C                     Z-ADDP@PSAT    PSAT                            102777
     C                     END                                            102777
     C**N60******          UPDATPOSETDF                                   118340
     C           *IN60     IFEQ '0'                                       118340
     C           W1EWLC    IFEQ 'Y'                                                           CSD015
     C           CSC011    IFEQ 'N'                                                           CSD015
     C           CSC011    OREQ 'Y'                                                           CSD015
     C           S1MAIN    ANDEQLIBR                                                          CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           CSE023    IFEQ 'Y'                                                         BUG12729
     C                     UPDATPOSETDF6                                                    BUG12729
     C                     EXSR PSAUDT                                                      AR324886
     C                     ELSE                                                             BUG12729
     C                     UPDATPOSETDF                                   118340
     C                     EXSR PSAUDT                                                      AR324886
     C                     ENDIF                                                            BUG12729
      *                                                                                       CRE020
      ** Handle the advice index of this transaction if CRE020 is enabled.                    CRE020
      *                                                                                       CRE020
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C           WSV01     ANDEQ'Y'                                                           CRE020
     C           CER049    OREQ 'Y'                                                           CER049
     C                     EXSR SRTNLU                                                        CRE020
     C                     EXSR SRIDXT                                                        CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     MOVE PAUI      SPAUI                                               218520
     C           1         CHAINPOSETAF              99    *              118340
     C*                                                                   118340
     C** UPDATE AUDIT RECORD IF FOUND                                     118340
     C*                                                                   118340
     C           *IN99     IFEQ '0'                                       118340
     C*                                                                   118340
     C** FOR AMENDS, UPDATE NO. OF RECORDS AMENDED TODAY                  118340
     C*                                                                   118340
     C           ACTN      IFEQ 'A'                                       118340
     C           ACTN      OREQ 'Y'                                       118340
     C                     ADD  1         NOAM             *NO.AMND TDY   118340
     C                     END                                            118340
     C*                                                                   118340
     C** FORMAT COMIT TEXT                                                118340
     C*                                                                   118340
     C                     TIME           MTIME                           118340
     C                     MOVELACTN      ACTNX                           118340
     C                     MOVEASCRCTL    DET,01                          118340
     C                     MOVEADETS      DET,26                          118340
     C*                                                                   118340
     C** UPDATE AUDIT RECORD                                              118340
     C*                                                                   118340
     C                     UPDATPOSETAF                                   118340
     C                     ENDIF                                          118340
      *                                                                                       191161
     C           CAEVNT    IFEQ 'Y'                                                           191161
     C                     EXSR UPDCAF                                                        191161
     C                     ENDIF                                                              191161
      *                                                                                       191161
     C                     ENDIF                                          118340
      *                                                                   082738
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0170CCP6                                           S01408
     C*                                                                   S01408
      ** Amendment - After Status                                         082738
      *                                                                   082738
     C                     MOVELDETREC    Z#ASTS                          082738
      *                                                                   082738
     C                     ELSE
     C*
     C**               A  M  E  N  D  S                    -  E N D
     C*
     C**               D  E  L  E  T  E  S                 -  S T A R T
     C*
     C           ACTN      IFEQ 'D'
     C** IF PORTFOLIO MANAGEMENT INSTALLED                                S01486
     C********** BGPFMG    IFEQ 'Y'                                S01486 CSE023
     C********** BGN4ST    OREQ 'Y'                                CPB001 CSE023
     C********** PTFRK     CHAINPOSETX               60            S01486 080743
     C********** PTFRK     CHAINPOSETDF              60            080743 CSE023
     C******************** Z-ADDSEQ       RECSEQ                   S01486 080743
     C********** RECSEQ    DOWGT1                                  S01486 080743
     C********** *IN60     ANDEQ'0'                                S01486 080743
     C********** PTFRK     READEPOSETDF                  60        S01486 080743
     C******************** SUB  1         RECSEQ                   S01486 080743
     C******************** END                                     S01486 080743
     C**********           ELSE                                    S01486 CSE023
     C********** POSETK    CHAINPOSETDF              60    *              CSE023
     C**********           Z-ADDSEQ       RECSEQ                   E37157 CSE023
     C********** RECSEQ    DOWGT1                                  E37157 CSE023
     C********** *IN60     ANDEQ'0'                                E37157 CSE023
     C********** POSETK    READEPOSETDF                  60        E37157 CSE023
     C**********           SUB  1         RECSEQ                   E37157 CSE023
     C**********           END                                     E37157 CSE023
     C**********           END                                     S01486 CSE023
      *                                                                   CSE023
     C                     SELEC                                          CSE023
     C           CSE023    WHEQ 'Y'                                       CSE023
     C********** STXBS     ANDNE*BLANKS                            CSE023 186055
      *                                                                   CSE023
      ** Set up key for CHAIN                                             CSE023
      *                                                                   CSE023
     C           SBNFO     IFNE *BLANKS                                   185397
     C                     MOVELBFCUST    BNFO                            CSE023
     C                     MOVE SBNFO     BNFO                            CSE023
     C                     ELSE                                           185397
     C                     MOVE *BLANKS   BNFO                            185397
     C                     END                                            185397
      *                                                                   CSE023
     C********** PTXBSK    CHAINPOSETDF              60                              CSE023 BUG12729
     C           PTXBS6    CHAINPOSETDF6             60                                     BUG12729
      *                                                                   CSE023
     C           BGPFMG    WHEQ 'Y'                                       CSE023
     C           BGN4ST    OREQ 'Y'                                       CSE023
     C           PTFRK     CHAINPOSETDF              60                   CSE023
      *                                                                   CSE023
     C                     OTHER                                          CSE023
     C********** POSETK    CHAINPOSETDF              60            CSE023 169067
     C           POSTK1    CHAINPOSETDF              60                   169067
     C**********           Z-ADDSEQ       RECSEQ                                       CSE023 247951
      **********                                                                       CSE023 247951
     C********** RECSEQ    DOWGT1                                                      CSE023 247951
     C********** *IN60     ANDEQ'0'                                                    CSE023 247951
     C********** POSETK    READEPOSETDF                  60                            CSE023 247951
     C**********           SUB  1         RECSEQ                                       CSE023 247951
     C**********           ENDDO                                                       CSE023 247951
      *                                                                   CSE023
     C                     ENDSL                                          CSE023
      *                                                                   CSE023
     C**N60******          Z-ADDPCPY      SVPCPY                   E16843 082738
     C**N60******          MOVEDPAUI      SVPAUI                   E16843 082738
     C**N60******          MOVEDPPRE      SVPPRE                   E16843 082738
     C**N60******          MOVEDPSCU      SVPSCU                   E16843 082738
     C**N60******          Z-ADDPSMT      SVPSMT                   E16843 082738
     C**N60******          MOVEDPSEA      SVPSEA                   E16843 082738
     C**N60******          MOVEDPSEB      SVPSEB                   E16843 082738
     C**N60******          Z-ADDPSAT      SVPSAT                   E16843 082738
     C**N60******          MOVE PBCA      SVPBCA                   S01117 082738
     C***********TNLU      IFNE STNLU                                     S01486
     C           TNL1      IFNE STNLU                                     S01486
     C                     EXSR UPDOWS
     C*
     C** IF NO PROCESSING OCCURRED EXIT TO SUPPRESS AUDIT UPDATE
     C*
     C                     GOTO XTUPDF
     C*
     C                     ELSE
      *                                                                   082738
      ** Deletion - Before Status                                         082738
      *                                                                   082738
     C                     MOVELPBCA      PBCAX                           082738
     C                     MOVELPSSH      PSSHX                           082738
     C                     MOVELPCPY      PCPYX                           082738
     C                     MOVELPDUD      PDUDX                           082738
     C                     MOVELPEVT      PEVTX                           082738
     C                     MOVELTXBS      TXBSX                           186055
     C                     MOVELBNFO      BNFOX                           186055
     C                     MOVELEXCD      EXCDX                           186055
     C                     MOVELDETREC    Z#BSTS                          082738
     C           MT5G      IFEQ 'Y'                                       CSE023
     C           MT5G      OREQ 'R'                                       185397
     C                     MOVE 'C'       MT5G                            CSE023
     C                     END                                            CSE023
      *                                                                   082738
     C                     MOVEL'*'       RECI
     C                     MOVE 'Y'       PSMI                            S01401
     C                     Z-ADDRUND      LCD
     C                     MOVEL'D'       CHTP
     C***********          MOVELNATN      TNLU                            S01486
      *                                                                                       CRE020
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C           CER049    OREQ 'Y'                                                           CER049
     C                     MOVE TNL1      WTNL1                                               CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     MOVELNATN      TNL1                            S01486
     C                     END                             *TNLU=STNLU
     C                     MOVE 'S'       PMAR
     C**N60******          UPDATPOSETDF                                   118340
     C/COPY WNCPYSRC,SE0170C093
     C**N60******          MOVE 'D'       STAT                      084981118340
     C           *IN60     IFEQ '0'                                       118340
     C           CSE023    IFEQ 'Y'                                                         BUG12729
     C                     UPDATPOSETDF6                                                    BUG12729
     C                     EXSR PSAUDT                                                      AR324886
     C                     ELSE                                                             BUG12729
     C                     UPDATPOSETDF                                   118340
     C                     EXSR PSAUDT                                                      AR324886
     C                     ENDIF                                                            BUG12729
      *                                                                                       CRE020
      ** Handle the advice index of this transaction if CRE020 is enabled.                    CRE020
      *                                                                                       CRE020
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C           WSV01     ANDEQ'Y'                                                           CRE020
     C           CER049    OREQ 'Y'                                                           CER049
     C                     EXSR SRTNLU                                                        CRE020
     C                     EXSR SRIDXT                                                        CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     MOVE 'D'       STAT                            118340
      *                                                                   118340
     C           1         CHAINPOSETAF              99    *              118340
     C*                                                                   118340
     C** UPDATE AUDIT RECORD IF FOUND                                     118340
     C*                                                                   118340
     C           *IN99     IFEQ '0'                                       118340
     C*                                                                   118340
     C** FOR DELETIONS, UPDATE NO. DELETIONS TODAY, AND NO. OF LIVE RECS  118340
     C*                                                                   118340
     C           ACTN      IFEQ 'D'                                       118340
     C                     ADD  1         NODE             *NO.DLTD TDY   118340
     C                     SUB  1         NORE             *NO.LIVE RCS   118340
     C                     END                                            118340
     C*                                                                   118340
     C** FORMAT COMIT TEXT                                                118340
     C*                                                                   118340
     C                     TIME           MTIME                           118340
     C                     MOVELACTN      ACTNX                           118340
     C                     MOVEASCRCTL    DET,01                          118340
     C                     MOVEADETS      DET,26                          118340
     C*                                                                   118340
     C** UPDATE AUDIT RECORD                                              118340
     C*                                                                   118340
     C                     UPDATPOSETAF                                   118340
     C                     ENDIF                                          118340
      *                                                                                       191161
     C           CAEVNT    IFEQ 'Y'                                                           191161
     C                     EXSR UPDCAF                                                        191161
     C                     ENDIF                                                              191161
      *                                                                                       191161
     C                     ENDIF                                          118340
      *                                                                   082738
      ** Deletion - After Status                                          082738
      *                                                                   082738
     C                     MOVELDETREC    Z#ASTS                          082738
      *                                                                   082738
     C                     ELSE
     C*
     C**               D  E  L  E  T  E  S                 -  E N D
     C*
     C**      A  U  T  H  O  R  I  T  A  T  I  O  N  S     -  S T A R T
     C*
     C           ACTN      IFEQ 'Y'
     C           STAT      ANDNE'R'                                                         AR324886
     C** IF PORTFOLIO MANAGEMENT INSTALLED                                S01486
     C********** BGPFMG    IFEQ 'Y'                                S01486 CSE023
     C********** BGN4ST    OREQ 'Y'                                CPB001 CSE023
     C********** PTFRK     CHAINPOSETX               60            S01486 080743
     C********** PTFRK     CHAINPOSETDF              60            080743 CSE023
     C******************** Z-ADDSEQ       RECSEQ                   S01486 080743
     C********** RECSEQ    DOWGT1                                  S01486 080743
     C********** *IN60     ANDEQ'0'                                S01486 080743
     C********** PTFRK     READEPOSETDF                  60        S01486 080743
     C******************** SUB  1         RECSEQ                   S01486 080743
     C******************** END                                     S01486 080743
     C**********           ELSE                                    S01486 CSE023
     C********** POSETK    CHAINPOSETDF              60    *              CSE023
     C**********           Z-ADDSEQ       RECSEQ                   E37157 CSE023
     C********** RECSEQ    DOWGT1                                  E37157 CSE023
     C********** *IN60     ANDEQ'0'                                E37157 CSE023
     C********** POSETK    READEPOSETDF                  60        E37157 CSE023
     C**********           SUB  1         RECSEQ                   E37157 CSE023
     C**********           END                                     E37157 CSE023
     C**********           END                                     S01486 CSE023
      *                                                                   CSE023
     C                     SELEC                                          CSE023
     C           CSE023    WHEQ 'Y'                                       CSE023
     C********** STXBS     ANDNE*BLANKS                            CSE023 186055
      *                                                                   186055
      ** Set up key for CHAIN                                             186055
      *                                                                   186055
     C           SBNFO     IFNE *BLANKS                                   186055
     C                     MOVELBFCUST    BNFO                            186055
     C                     MOVE SBNFO     BNFO                            186055
     C                     ELSE                                           186055
     C                     MOVE *BLANKS   BNFO                            186055
     C                     END                                            186055
      *                                                                   186055
     C********** PTXBSK    CHAINPOSETDF              60                              CSE023 BUG12729
     C           PTXBS6    CHAINPOSETDF6             60                                     BUG12729
      *                                                                   CSE023
     C           BGPFMG    WHEQ 'Y'                                       CSE023
     C           BGN4ST    OREQ 'Y'                                       CSE023
     C           PTFRK     CHAINPOSETDF              60                   CSE023
      *                                                                   CSE023
     C                     OTHER                                          CSE023
     C********** POSETK    CHAINPOSETDF              60            CSE023 203678
     C           POSTK1    CHAINPOSETDF              60                   203678
     C**********           Z-ADDSEQ       RECSEQ                                       CSE023 247951
      **********                                                                       CSE023 247951
     C********** RECSEQ    DOWGT1                                                      CSE023 247951
     C********** *IN60     ANDEQ'0'                                                    CSE023 247951
     C********** POSETK    READEPOSETDF                  60                            CSE023 247951
     C**********           SUB  1         RECSEQ                                       CSE023 247951
     C**********           ENDDO                                                       CSE023 247951
      *                                                                   CSE023
     C                     ENDSL                                          CSE023
      *                                                                   CSE023
     C**N60******          Z-ADDPCPY      SVPCPY                   E16843 082738
     C**N60******          MOVEDPAUI      SVPAUI                   E16843 082738
     C**N60******          MOVEDPPRE      SVPPRE                   E16843 082738
     C**N60******          MOVEDPSCU      SVPSCU                   E16843 082738
     C**N60******          Z-ADDPSMT      SVPSMT                   E16843 082738
     C**N60******          MOVEDPSEA      SVPSEA                   E16843 082738
     C**N60******          MOVEDPSEB      SVPSEB                   E16843 082738
     C**N60******          Z-ADDPSAT      SVPSAT                   E16843 082738
     C**N60******          MOVEDPBCA      SVPBCA                   S01117 082738
     C***********TNLU      IFNE STNLU                                     S01486
     C           TNL1      IFNE STNLU                                     S01486
     C                     EXSR UPDOWS
     C*
     C** IF NO PROCESSING OCCURRED EXIT TO SUPPRESS AUDIT UPDATE
     C*
     C                     GOTO XTUPDF
     C*
     C                     ELSE
     C*
      ** Authorization - Before Status                                    082738
      *                                                                   082738
     C                     MOVELPBCA      PBCAX                           082738
     C                     MOVELPSSH      PSSHX                           082738
     C                     MOVELPCPY      PCPYX                           082738
     C                     MOVELPDUD      PDUDX                           082738
     C                     MOVELPEVT      PEVTX                           082738
     C                     MOVELTXBS      TXBSX                           186055
     C                     MOVELBNFO      BNFOX                           186055
     C                     MOVELEXCD      EXCDX                           186055
     C                     MOVELDETREC    Z#BSTS                          082738
      *                                                                                   AR1095995C
     C           LCD       IFLT BJRDNB                                                    AR1095995C
     C                     MOVEL*BLANKS   Z#BSTS                                          AR1095995C
     C                     ENDIF                                                          AR1095995C
      *                                                                                       CRE020
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C           CER049    OREQ 'Y'                                                           CER049
     C                     MOVELCHTP      W2CHTP  1                                           CRE020
     C                     MOVE TNL1      WTNL1                                               CRE020
     C                     ENDIF                                                              CRE020
      *                                                                   082738
      *****************************************************************                220952 247951
      ***Before*status*not*needed*to*avoid*twice*update*in*ACMV*files**                220952 247951
      *****************************************************************                220952 247951
     C**********           MOVEL*BLANKS   Z#BSTS                                       220952 247951
     C                     MOVEL*BLANKS   Z#BSTS                                              250115
     C** TRANSLATE RECORD DETAILS FROM SCREEN LAYOUT TO FILE LAYOUT
     C*
     C                     EXSR VALIDD
     C                     MOVE 'Y'       PAUI
     C                     MOVE 'Y'       PSMI                            S01401
     C                     Z-ADDRUND      LCD
     C                     MOVEL'Y'       CHTP
     C***********          MOVELNATN      TNLU                            S01486
     C                     MOVELNATN      TNL1                            S01486
     C                     END
     C                     MOVE 'S'       PMAR
     C           CSE023    IFEQ 'Y'                                                         BUG12729
     C  N60                UPDATPOSETDF6                                                    BUG12729
     C           *IN60     IFEQ *OFF                                                        AR324886
     C                     EXSR PSAUDT                                                      AR324886
     C                     ENDIF                                                            AR324886
     C                     ELSE                                                             BUG12729
     C  N60                UPDATPOSETDF
     C           *IN60     IFEQ *OFF                                                        AR324886
     C                     EXSR PSAUDT                                                      AR324886
     C                     ENDIF                                                            AR324886
     C                     ENDIF                                                            BUG12729
      *                                                                                       CRE020
      ** Handle the advice index of this transaction if CRE020 is enabled.                    CRE020
      *                                                                                       CRE020
     C           *IN60     IFEQ *OFF                                                          CRE020
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C           WSV01     ANDEQ'Y'                                                           CRE020
     C           CER049    OREQ 'Y'                                                           CER049
     C                     EXSR SRTNLU                                                        CRE020
     C                     EXSR SRIDXT                                                        CRE020
     C                     ENDIF                                                              CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C/COPY WNCPYSRC,SE0170C094
      *                                                                                       191161
     C           CAEVNT    IFEQ 'Y'                                                           191161
     C           *IN60     ANDEQ'0'                                                           191161
     C                     EXSR UPDCAF                                                        191161
     C                     ENDIF                                                              191161
      *                                                                                       191161
     C  N60                MOVELPAUI      SPAUI                           084981
     C*                                                                   099270
     C** If S01512 is active, work out payment/value date for screen      099270
     C*                                                                   099270
     C  N60      S01512    IFEQ 'Y'                                       099270
     C                     Z-ADDPSVL      ZDAYNO                          099270
     C                     EXSR ZDATE2                                    099270
     C                     MOVELZDATE     SFPSVL                          099270
     C                     ENDIF                                          099270
     C*                                                                   099270
      *                                                                   082738
      ** Authorization - After Status                                     082738
      *                                                                   082738
     C                     MOVELDETREC    Z#ASTS                          082738
     C*
     C**      A  U  T  H  O  R  I  T  A  T  I  O  N  S     -  E  N  D
     C*
     C                     ELSE                                           S01496
     C*                                                                   S01496
     C**      A  U  T  H  O  R  I  T  A  T  I  O  N  S     -  E  N  D     S01496
     C*                                                                   S01496
     C           S01496    IFEQ 'Y'                                       S01496
     C           CSE007    OREQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C*                                                                   S01496
     C**      R E V E R S A L S    -  S T A R T                           S01496
     C*                                                                   S01496
     C           ACTN      IFEQ 'R'                                       S01496
     C                     MOVE 'D'       RECI                                              AR324886
     C                     EXSR PSAUDT                                                      AR324886
     C                     ENDIF                                                            AR324886
     C           ACTN      IFEQ 'Y'                                                         AR324886
     C           STAT      ANDEQ'R'                                                         AR324886
     C                     MOVE 'R'       ACTN                                              AR324886
     C***********          Z-ADDSTNLU     TNLU                     S01496 S01486
     C                     Z-ADDSTNLU     TNL1                            S01486
     C           CSE023    IFEQ 'Y'                                       186055
      *                                                                   186055
      ** Set up key for CHAIN                                             186055
      *                                                                   186055
     C           SBNFO     IFNE *BLANKS                                   186055
     C                     MOVELBFCUST    BNFO                            186055
     C                     MOVE SBNFO     BNFO                            186055
     C                     ELSE                                           186055
     C                     MOVE *BLANKS   BNFO                            186055
     C                     END                                            186055
      *                                                                   186055
     C********** PTXBSK    CHAINPOSETDF              60                              186055 BUG12729
     C           PTXBS6    CHAINPOSETDF6             60                                     BUG12729
     C                     ELSE                                           186055
     C           PTFRK     CHAINPOSETDF              60    *              S01496
     C                     ENDIF                                          186055
     C************IN60     IFEQ *OFF                               S01496 082738
     C************         Z-ADDPCPY      SVPCPY                   S01496 082738
     C************         MOVE PAUI      SVPAUI                   S01496 082738
     C************         MOVE PPRE      SVPPRE                   S01496 082738
     C************         MOVE PSCU      SVPSCU                   S01496 082738
     C************         Z-ADDPSMT      SVPSMT                   S01496 082738
     C************         MOVE PSEA      SVPSEA                   S01496 082738
     C************         MOVE PSEB      SVPSEB                   S01496 082738
     C************         Z-ADDPSAT      SVPSAT                   S01496 082738
     C************         ENDIF                                   S01496 082738
     C*                                                                   S01496
     C** IF NO PROCESSING OCCURRED EXIT TO SUPPRESS AUDIT UPDATE          S01496
     C*                                                                   S01496
     C***********TNLU      IFNE STNLU                              S01496 S01486
     C           TNL1      IFNE STNLU                                     S01486
     C                     EXSR UPDOWS                                    S01496
     C                     GOTO XTUPDF                                    S01496
     C*                                                                   S01496
     C                     ELSE                                           S01496
     C                     MOVEL'R'       RECI                            S01496
     C                     MOVE 'R'       STAT                            186400
     C                     Z-ADDRUND      LCD                             S01496
      *                                                                                       CRE020
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C           CER049    OREQ 'Y'                                                           CER049
     C                     MOVELCHTP      W2CHTP                                              CRE020
     C                     MOVE TNL1      WTNL1                                               CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     MOVEL'R'       CHTP                            S01496
     C***********          Z-ADDSTNLU     TNLU                    S01496  S01486
     C                     Z-ADDSTNLU     TNL1                            S01486
     C                     END                             *TNLU=STNLU    S01496
     C*                                                                   S01496
     C                     MOVE 'S'       PMAR                            S01496
     C           *IN60     IFEQ *OFF                                      S01496
     C           CSE023    IFEQ 'Y'                                                         BUG12729
     C                     UPDATPOSETDF6                                                    BUG12729
     C                     EXSR PSAUDT                                                      AR324886
     C                     ELSE                                                             BUG12729
     C                     UPDATPOSETDF                                   S01496
     C                     EXSR PSAUDT                                                      AR324886
     C                     ENDIF                                                            BUG12729
      *                                                                                       CRE020
      ** Handle the advice index of this transaction if CRE020 is enabled.                    CRE020
      *                                                                                       CRE020
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C           WSV01     ANDEQ'Y'                                                           CRE020
     C           CER049    OREQ 'Y'                                                           CER049
     C                     EXSR SRTNLU                                                        CRE020
     C                     EXSR SRIDXT                                                        CRE020
     C                     ENDIF                                                              CRE020
     C/COPY WNCPYSRC,SE0170C095
     C                     ENDIF                                          S01496
     C                     ENDIF                                          S01496
     C*                                                                   S01496
     C**      R E V E R S A L S    -  E N D                               S01496
     C*                                                                   S01496
     C                     END                             S01496=Y       S01496
     C                     END                             *ACTN=Y
     C                     END                             *ACTN=D
     C                     END                             *ACTN=A
     C*                                                                   051475
     C****Need*to update Projected Nostro if position settlement is051475 082738
     C****authorised and the settlemenet method is '1', '2', '7', '051475 082738
     C****or*'12'.                                                 051475 082738
     C***********                                                  051475 082738
     C***********PSMT      IFEQ 1                                  051475 082738
     C***********PSMT      OREQ 2                                  051475 082738
     C***********PSMT      OREQ 7                                  051475 082738
     C***********PSMT      OREQ 8                                  051475 082738
     C***********PSMT      OREQ 12                                 051475 082738
     C***********                                                  051475 082738
     C***********ACTN      IFEQ 'Y'                                051475 082738
     C***********ACTN      OREQ 'D'                                051475 082738
     C***********PAUI      ANDEQ'Y'                                051475 082738
     C***********          EXSR WNOSTR                             051475 082738
     C***********          EXSR WOLPOS                             051475 082738
     C***********          END                                     051475 082738
     C***********                                                  051475 082738
     C***********          END                                     051475 082738
     C*                                                                   051475
     C                     END                             *ACTN=I
     C*                                                                   S01496
     C** FOR ACTION 'R' NO CHANGE TO PF/POSETA                            S01496
     C*                                                                   S01496
     C           S01496    IFEQ 'Y'                                       S01496
     C           CSE007    OREQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C           ACTN      IFEQ 'R'                                       S01496
     C                     MOVE *BLANKS   XSFRNO                          S01496
     C           CMTTXT    COMIT                                          S01496
     C                     GOTO XTUPDF                                    S01496
     C                     ENDIF                                          S01496
     C                     ENDIF                                          S01496
      *****************************************************************                100604 247951
      **Only*do*updates*to*on-line*position*files*if*action*code*is****                100604 247951
      **Y*for*Authorization*or*Due*Date*is*today***********************                100604 247951
     C********** ACTN      IFEQ 'Y'                                                    100604 247951
     C********** PDUD      OREQ RUND                                                   100604 247951
      *****************************************************************                100604 247951
     C           PAUI      IFEQ 'Y'                                                           249578
     C********** ACTN      OREQ 'A'                                                  250115 AR324886
     C           ACTN      OREQ 'U'                                                         AR324886
     C           Z#BSTS    ANDNE*BLANKS                                                       250115
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C                     MOVE TNL1      TNLUX1                                              CRE020
     C                     MOVE TNL1      TNLUX2                                              CRE020
     C                     ENDIF                                                              CRE020
     C**********           ENDIF                                                       249578 250115
     C*                                                                   082738
     C* Do On-line Updates                                                082738
     C*                                                                   082738
     C                     CALL 'AOOUPSU0'                                082738
     C                     PARM           ##RTCD  7                       082738
     C                     PARM           Z#BSTS                          082738
     C                     PARM           Z#ASTS                          082738
     C           ##RTCD    IFEQ '*ERROR*'                                 082738
     C                     SETON                     U7U8                 082738
     C           *LOCK     IN   LDA                                       082738
     C                     Z-ADD80        DBASE            ***************082738
     C                     MOVEL'AOOUPSU0'DBFILE           * DB ERROR 80 *082738
     C                     MOVELKEYFLD    DBKEY            ***************082738
     C                     OUT  LDA                                       082738
     C                     EXSR *PSSR                                     082738
     C                     GOTO XTUPDF                                    082738
     C                     END                                            082738
      **********                                                                       100604 247951
     C**********           END                                                         100604 247951
     C                     ENDIF                                                              250115
     C*
     C** GET AUDIT RECORD
     C*
     C           1         CHAINPOSETAF              99    *
     C*
     C** UPDATE AUDIT RECORD IF FOUND
     C*
     C           *IN99     IFEQ '0'
     C***********                                                         118340
     C***********                                                         118340
     C***FOR*INSERT, UPDATE LIVE RECORDS INSERTED TODAY, AND NO. OF LIVE  118340
     C***RECORDS*                                                         118340
     C***********                                                         118340
     C***********ACTN      IFEQ 'I'                                       118340
     C***********          ADD  1         NOIN             *NO.INSD TDY   118340
     C***********          ADD  1         NORE             *NO.LIVE RCS   118340
     C***********          END                                            118340
     C***********                                                         118340
     C***FOR*AMENDS, UPDATE NO. OF RECORDS AMENDED TODAY                  118340
     C***********                                                         118340
     C***********ACTN      IFEQ 'A'                                       118340
     C***********ACTN      OREQ 'Y'                                       118340
     C***********          ADD  1         NOAM             *NO.AMND TDY   118340
     C***********          END                                            118340
     C***********                                                         118340
     C***FOR*DELETIONS, UPDATE NO. DELETIONS TODAY, AND NO. OF LIVE RECS  118340
     C***********                                                         118340
     C***********ACTN      IFEQ 'D'                                       118340
     C***********          ADD  1         NODE             *NO.DLTD TDY   118340
     C***********          SUB  1         NORE             *NO.LIVE RCS   118340
     C***********          END                                            118340
     C***********                                                         118340
     C***FORMAT*COMIT TEXT                                                118340
     C***********                                                         118340
     C***********          TIME           MTIME                           118340
     C***********          MOVELACTN      ACTNX                           118340
     C***********          MOVEASCRCTL    DET,01                          118340
     C***********          MOVEADETS      DET,26                          118340
     C***********                                                         118340
     C***UPDATE*AUDIT RECORD                                              118340
     C***********                                                         118340
     C***********          UPDATPOSETAF                                   118340
     C*
     C***If*retail*module*present*in*system*and*settlement*type********   E16843
     C***equals*04,*05,*14,*or*15**************************************   E16843
     C***********                                                         E16843
     C***********                                                         E16843
     C**If*method*is*04*of*14*retail*module*must*be*present************   E16843
     C***********                                                         E16843
     C***********PSMT      IFEQ 04                                        E16843
     C***********PSMT      OREQ 05                                        E16843
     C***********PSMT      OREQ 14                                        E16843
     C***********PSMT      OREQ 15                                        E16843
     C************         TESTB'6'       MODI2          99               E16843
     C************IN99     IFEQ '0'                                       E16843
     C***********ACCNTK    CHAINACCNT                99                   E16843
     C************IN99     IFEQ '0'                                       E16843
     C**If*account*type*on*ACCNTAB*=*R*update*Ledger*and*book**********   E16843
     C*****balances*on*PF/MEMOS****************************************   E16843
     C***********                                                         E16843
     C***********ATYP      IFEQ 'R'                                       E16843
     C***********                                                         E16843
     C***Access*MEMOS*by*RRN*******************************************   E16843
     C***********                                                         E16843
     C***********RRNM      CHAINMEMOSMDF             99                   E16843
     C************IN99     IFEQ '0'                                       E16843
     C***********RECI      ANDNE'*'                                       E16843
     C***********                                                         E16843
     C***If*Pay.Receive*indicator*= P,*subtract*Settlement*************   E16843
     C******amount*from*Balances,*ELSE*add*settlement*amount***********   E16843
     C***********                                                         E16843
     C***********PPRE      IFEQ 'P'                                       E16843
     C***********          SUB  PSAT      LDBL                            E16843
     C***********          SUB  PSAT      BKBL                            E16843
     C***********          ELSE                                           E16843
     C***********          ADD  PSAT      LDBL                            E16843
     C***********          ADD  PSAT      BKBL                            E16843
     C***********          END                                            E16843
     C***********                                                         E16843
     C***********          UPDATMEMOSMDF                                  E16843
     C***********          END                             *IN99=0        E16843
     C***********          END                             *ATYP=R        E16843
     C***********          END                                            E16843
     C***********          END                                            E16843
     C***********          END                                            E16843
     C*                                                                   E16843
     C***If*RETAIL module is present.                              E16843 082738
     C***********                                                  E16843 082738
     C************INU1     IFEQ '1'                                E16843 082738
     C***********                                                  E16843 082738
     C***********ACTN      IFEQ 'A'                                E16843 082738
     C***********ACTN      OREQ 'Y'                                E16843 082738
     C***********ACTN      OREQ 'D'                                E16843 082738
     C***********                                                  E16843 082738
     C****If*authorised reverse out amounts                        E16843 082738
     C***********                                                  E16843 082738
     C***********SVPAUI    IFEQ 'Y'                                E16843 082738
     C***********                                                  E16843 082738
     C****Is*settlement account is retail                          E16843 082738
     C***********                                                  E16843 082738
     C***********          MOVE SVPOS     @POS                     E16843 082738
     C***********          MOVE *BLANKS   ATYP                     E16843 082738
     C***********@PSMT     IFEQ 4                                  E16843 082738
     C***********@PSMT     OREQ 5                                  E16843 082738
     C***********@PSMT     OREQ 14                                 E16843 082738
     C***********@PSMT     OREQ 15                                 E16843 082738
     C***********          EXSR RETAIL                             E16843 082738
     C***U7******          GOTO XTUPDF                             E16843 082738
     C***********          END                                     E16843 082738
     C***********                                                  E16843 082738
     C***********ATYP      IFEQ 'R'                                E16843 082738
     C***********                                                  E16843 082738
     C****Access*MEMOS by RRN                                      E16843 082738
     C***********                                                  E16843 082738
     C***********RRNM      CHAINMEMOSMDF             99            E16843 082738
     C************IN99     IFEQ '1'                                E16843 082738
     C***********RECI      ORNE 'D'                                E16843 082738
     C***********          SETON                       U7U8        E16843 082738
     C************LOCK     IN   LDA                                S01117 082738
     C***********          MOVE 'MEMOS'   DBFILE           ********E16843 082738
     C***********          MOVELRRNM      DBKEY            ***DB*ERROR*06*E20651
     C***********          Z-ADD6         DBASE            ***************E20651
     C***********          MOVELRRNM      DBKEY            ** DB ERE20651 082738
     C***********          Z-ADD15        DBASE            ********E20651 082738
     C***********          OUT  LDA                                S01117 082738
     C***********          EXSR *PSSR                              S01117 082738
     C***********          GOTO XTUPDF                             E16843 082738
     C***********                                                  E16843 082738
     C***********          ELSE                                    E16843 082738
     C***********                                                  E16843 082738
     C***********@PPRE     IFEQ 'P'                                E16843 082738
     C***********          ADD  SVPSAT    LDBLN                    E16843 082738
     C***********          ADD  SVPSAT    CLBLN                    E16843 082738
     C***********          Z-ADD0         DORC                     S01154 082738
     C***********          ELSE                                    E16843 082738
     C***********          SUB  SVPSAT    LDBLN                    E16843 082738
     C***********          SUB  SVPSAT    CLBLN                    E16843 082738
     C***********          Z-ADD1         DORC                     S01154 082738
     C***********          END                                     E16843 082738
     C***********                                                  E16843 082738
     C****SAVE*FIELD FOR ACCOUNT MOVEMENT FILE                     S01154 082738
     C***********                                                  S01154 082738
     C***********          Z-ADDSVPSAT    MVAM                     S01154 082738
     C***********                                                  E16843 082738
     C***********          UPDATMEMOSMDF                           E16843 082738
     C***********                                                  E16843 082738
     C***********          EXSR ACCMOV                             S01154 082738
     C***********                                                  S01154 082738
     C***********          END                                     E16843 082738
     C***********          END                                     E16843 082738
     C***********          END                                     E16843 082738
     C***********          END                                     E16843 082738
     C***********                                                  E16843 082738
     C****Update MEMOS with amounts entered                        E16843 082738
     C***********                                                  E16843 082738
     C***********ACTN      IFEQ 'A'                                E16843 082738
     C***********ACTN      OREQ 'Y'                                E16843 082738
     C***********                                                  E16843 082738
     C****Is*settlement account is retail                          E16843 082738
     C***********                                                  E16843 082738
     C***********          Z-ADDPCPY      @PCPY                    E16843 082738
     C***********          MOVE PAUI      @PAUI                    E16843 082738
     C***********          MOVE PPRE      @PPRE                    E16843 082738
     C***********          MOVE PSCU      @PSCU                    E16843 082738
     C***********          Z-ADDPSMT      @PSMT                    E16843 082738
     C***********          MOVE PSEA      @PSEA                    E16843 082738
     C***********          MOVE PSEB      @PSEB                    E16843 082738
     C***********          Z-ADDPSAT      @PSAT                    E16843 082738
     C***********          MOVELPBCA      @PBCA                    S01117 082738
     C***********          MOVE *BLANKS   ATYP                     E16843 082738
     C***********@PSMT     IFEQ 4                                  E16843 082738
     C***********@PSMT     OREQ 5                                  E16843 082738
     C***********@PSMT     OREQ 14                                 E16843 082738
     C***********@PSMT     OREQ 15                                 E16843 082738
     C***********          EXSR RETAIL                             E16843 082738
     C***U7******          GOTO XTUPDF                             E16843 082738
     C***********          END                                     E16843 082738
     C***********                                                  E16843 082738
     C***********ATYP      IFEQ 'R'                                E16843 082738
     C***********                                                  E16843 082738
     C****Access*MEMOS by RRN                                      E16843 082738
     C***********                                                  E16843 082738
     C***********RRNM      CHAINMEMOSMDF             99            E16843 082738
     C************IN99     IFEQ '1'                                E16843 082738
     C***********RECI      ORNE 'D'                                E16843 082738
     C***********          SETON                       U7U8        E16843 082738
     C************LOCK     IN   LDA                                S01117 082738
     C***********          MOVE 'MEMOS'   DBFILE           ********E16843 082738
     C***********          MOVELRRNM      DBKEY            ** DB ERE16843 082738
     C***********          Z-ADD07        DBASE            ********E16843 082738
     C***********          OUT  LDA                                S01117 082738
     C***********          EXSR *PSSR                              S01117 082738
     C***********          GOTO XTUPDF                             E16843 082738
     C***********                                                  E16843 082738
     C***********          ELSE                                    E16843 082738
     C***********                                                  E16843 082738
     C***********PPRE      IFEQ 'P'                                E16843 082738
     C***********          SUB  PSAT      LDBLN                    E16843 082738
     C***********          SUB  PSAT      CLBLN                    E16843 082738
     C***********          Z-ADD1         DORC                     S01154 082738
     C***********          ELSE                                    E16843 082738
     C***********          ADD  PSAT      LDBLN                    E16843 082738
     C***********          ADD  PSAT      CLBLN                    E16843 082738
     C***********          Z-ADD0         DORC                     S01154 082738
     C***********          END                                     E16843 082738
     C***********                                                  E16843 082738
     C****SAVE*FIELD FOR ACCOUNT MOVEMENT FILE                     S01154 082738
     C***********                                                  E16843 082738
     C***********          Z-ADDPSAT      MVAM                     S01154 082738
     C***********                                                  E16843 082738
     C***********          UPDATMEMOSMDF                           E16843 082738
     C***********                                                  E16843 082738
     C***********          EXSR ACCMOV                             S01154 082738
     C***********                                                  S01154 082738
     C***********          END                                     E16843 082738
     C***********          END                                     E16843 082738
     C***********          END                                     E16843 082738
     C***********          END                             *INU1=1 E16843 082738
     C/COPY WNCPYSRC,HUT111_008                                                               HUT111
     C*
     C**  C  O  M  I  T
     C*
     C           CMTTXT    COMIT
      *                                                                   185397
      ** If CSE023 is present and action is for deletel, and MG565 is  wit185397
      ** needed then set the generation indicator for the same depot    fo185397
      ** for re-send of messages.                                         185397
      *                                                                   185397
     C           CSE023    IFEQ 'Y'                                       185397
     C           MT5R      ANDEQ'Y'                                       185397
     C           ACTN      ANDEQ'D'                                       185397
     C                     CALL 'SE1878'                                  185397
     C                     PARM           PBCA                            185397
     C                     PARM           PSSH                            185397
     C                     PARM           PDUD                            185397
     C                     PARM           PEVT                            185397
     C                     PARM           PCPY                            185397
     C                     PARM           PREF                            185397
     C                     PARM           PSEQ                            185397
     C                     COMIT                                          185397
     C                     ENDIF                                          185397
      *                                                                   S01408
     C/COPY WNCPYSRC,SE0170CCP1                                           S01408
      *                                                                   S01408
     C*
     C**  AUDIT RECORD NOT FOUND: DATABASE ERROR
     C*
     C                     ELSE
     C*
     C                     SETON                     U7U8
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVEL'05'      DBASE            ***************S01117
     C                     Z-ADD5         DBASE            * DB ERROR 05 *S01117
     C                     MOVEL'POSET'   DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     END
     C*
     C                     MOVE *BLANKS   XSFRNO
     C*
     C           XTUPDF    ENDSR
      *                                                                   S01408
     C/COPY WNCPYSRC,SE0170CCP2                                           S01408
      *                                                                   S01408
     C*
     C*****************************************************************
      *EJECT*****                                                  E16843 082738
     C*****************************************************************   E16843
     C***********                                                  E16843 082738
     C** RETAIL  - S/R TO DETERMINE IF SETTLEMENT ACCOUNT IS RETAIL   *   E16843
     C***********                                                  E16843 082738
     C*****************************************************************   E16843
     C***********                                                  E16843 082738
     C***********RETAIL    BEGSR                                   E16843 082738
     C***********                                                  E16843 082738
     C****Settlement method 04                                     E16843 082738
     C***********                                                  E16843 082738
     C***********@PSMT     IFEQ 4                                  E16843 082738
     C***********          Z-ADD@PCPY     KYCNUM                   E16843 082738
     C***********          MOVEL@PSCU     KYCCY                    E16843 082738
     C***********          MOVEL@PBCA     KYBRCA                   S01117 082738
     C***********          Z-ADDCADC      KYACOD                    E16843S01117
     C***********          MOVE BMACCD    KYACOD                   S01117 082738
     C***********MBIN      IFEQ 'N'                                 E16843S01117
     C***********          Z-ADD1         KYACSQ                   E16843 082738
     C***********          ELSE                                     E16843S01117
     C***********          MOVE *BLANKS   KEY                       E16843S01117
     C***********          MOVEL'10'      TYPE                      E16843S01117
     C***********          MOVE @PSEB     KEY                       E16843S01117
     C***********TABKEY    CHAINTABLETRF             99             E16843S01117
     C************IN99     IFEQ '1'                                 E16843S01117
     C***********          SETON                       U7U8         E16843S01117
     C***********          MOVE 'TABLE'   DBFILE     ***************E16843S01117
     C***********          MOVELKEY       DBKEY      ** DB ERROR 08 E16843S01117
     C***********          Z-ADD8         DBASE      ***************E16843S01117
     C***********          GOTO ENDRTL                              E16843S01117
     C***********          END                                      E16843S01117
     C***********                                                   E16843S01117
     C***********          Z-ADDNSACS     KYACSQ                    E16843S01117
     C***********          END                                      E16843S01117
     C***********          END                                     E16843 082738
     C***********                                                  E16843 082738
     C****Settlement method 05                                     E16843 082738
     C***********                                                  E16843 082738
     C***********@PSMT     IFEQ 5                                  E16843 082738
     C***********          MOVEL@PSEA     KYCNUM                   E16843 082738
     C***********          MOVEL@PSCU     KYCCY                    E16843 082738
     C***********          MOVE @PSEA     WORK6   6                E16843 082738
     C***********          MOVELWORK6     KYACOD                   E16843 082738
     C***********          MOVE WORK6     KYACSQ                   E16843 082738
     C***********          MOVEL@PBCA     KYBRCA                   S01117 082738
     C***********          END                                     E16843 082738
     C***********                                                  E16843 082738
     C****Settlement method 14                                     E16843 082738
     C***********                                                  E16843 082738
     C***********@PSMT     IFEQ 14                                 E16843 082738
     C***********          MOVEL@PSEA     KEY10                    E16843 082738
     C***********ACNKA     CHAINACNUMF               99            E16843 082738
     C***99******          MOVE *BLANKS   ATYP                     E16843 082738
     C***99******          GOTO ENDRTL                             E16843 082738
     C***********          MOVE CNUM      KYCNUM                   E16843 082738
     C***********          MOVE CCY       KYCCY                    E16843 082738
     C***********          Z-ADDACOD      KYACOD                   E16843 082738
     C***********          Z-ADDACSQ      KYACSQ                   E16843 082738
     C***********          MOVELBRCA      KYBRCA                   S01117 082738
     C***********          END                                     E16843 082738
     C***********                                                  E16843 082738
     C****Settlement method 15                                     E16843 082738
     C***********                                                  E16843 082738
     C***********@PSMT     IFEQ 15                                 E16843 082738
     C***********          MOVEL@PSEA     KYCNUM                    E16843S01117
     C***********          MOVEL@PSEA     CUSTNO                   S01117 082738
     C***********          MOVEL@PSCU     KYCCY                    E16843 082738
     C***********KYCNUM    CHAINCLINTSEF             99             E16843S01117
     C************IN99     IFEQ '1'                                 E16843S01117
     C***********          SETON                       U7U8         E16843S01117
     C***********          MOVE 'CLINTSE' DBFILE     ***************E16843S01117
     C***********          MOVEL@PSEA     DBKEY      ** DB ERROR 10 E16843S01117
     C***********          Z-ADD10        DBASE      ***************E16843S01117
     C***********          GOTO ENDRTL                              E16843S01117
     C***********          END                                      E16843S01117
     C***********          Z-ADDC1AC      KYACOD                    E16843S01117
     C***********          Z-ADDC1SQ      KYACSQ                    E16843S01117
     C***********                                                  S01117 082738
     C***********          CALL 'AOSECSR0'                         S01117 082738
     C***********          PARM '*DBERR'  @RTCD   7                S01117 082738
     C***********          PARM '*KEY   ' @OPTN   7                S01117 082738
     C***********          PARM CUSTNO    CUST                     S01117 082738
     C***********SDSECS    PARM SDSECS    DSSDY                    S01117 082738
     C***********                                                  S01117 082738
     C***********          MOVEL*BLANKS   KYACOD                   S01117 082738
     C***********          MOVE BFACCD    KYACOD                   S01117 082738
     C***********          Z-ADDBFACSN    KYACSQ                   S01117 082738
     C***********          END                                     E16843 082738
     C***********                                                  E16843 082738
     C****If*account type is retail, update related PF/MEMOS recordE16843 082738
     C***********                                                  E16843 082738
     C***********KEYACC    CHAINACCNTABF             99            E16843 082738
     C************IN99     IFEQ '1'                                E16843 082738
     C***********          SETON                       U7U8        E16843 082738
     C************LOCK     IN   LDA                                S01117 082738
     C***********          MOVE 'ACCNTAB' DBFILE           ********E16843 082738
     C***********          MOVELKYACC     DBKEY            ** DB ERE16843 082738
     C***********          Z-ADD11        DBASE            ********E16843 082738
     C***********          OUT  LDA                                S01117 082738
     C***********          EXSR *PSSR                              S01117 082738
     C***********          GOTO ENDRTL                             E16843 082738
     C***********          END                                     E16843 082738
     C***********                                                  E16843 082738
     C***********ENDRTL    ENDSR                                   E16843 082738
     C***********                                                  E16843 082738
     C*****************************************************************   E16843
      *EJECT*****                                                  S01154 082738
     C*****************************************************************   S01154
     C***********                                                  S01154 082738
     C***ACCMOV**- S/R TO WRITE A RECORD TO THE ACCOUNT MOVEMENT FIS01154 082738
     C***********  WHEN MEMOS IS UPDATED                           S01154 082738
     C***CALLED FROM: UPDFLS                                       S01154 082738
     C***CALLS: NO OTHER S/R'S                                     S01154 082738
     C***********                                                  S01154 082738
     C*****************************************************************   S01154
     C***********                                                  S01154 082738
     C***********ACCMOV    BEGSR                                   S01154 082738
     C***********                                                  S01154 082738
     C***********          Z-ADDCNUM      CUSN                     S01154 082738
     C***********          MOVE CCY       CCYD                     S01154 082738
     C***********          Z-ADDACOD      ACDE                     S01154 082738
     C***********          Z-ADDACSQ      ASNC                     S01154 082738
     C***********          Z-ADDRUND      PTDT                     S01154 082738
     C***********          Z-ADDRUND      VUDT                     S01154 082738
     C***********          MOVE 'PS'      TRYP                     S01154 082738
     C***************      Z-ADD0         NRTC                     S01154 080050
     C*********************MOVE *BLANK    NRTC              S01154 080050 082738
     C***********          MOVELPSSH      NRTD                     S01154 082738
     C***********          MOVE *BLANKS   TNMR                     S01154 082738
     C***********          Z-ADD0         CQNR                     S01154 082738
     C***********                                                  S01154 082738
     C***********          WRITERSACMTPO                           S01154 082738
     C***********                                                  S01154 082738
     C***********          ENDSR                                   S01154 082738
     C***********                                                  S01154 082738
     C*****************************************************************   S01154
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  UPDOWS  - S/R TO PROCESS UPDATE BY ANOTHER WORKSTATION       *
     C*  CALLED FROM: UPDFLS                                          *
     C*  CALLS: NO OTHER S/R'S                                        *
     C*                                                               *
     C*****************************************************************
     C*
     C           UPDOWS    BEGSR
     C**
     C                     ROLBK
     C*
     C**  SET UP NEXT SCREEN TO BE DISPLAYED:
     C**  IF RECORD IS LIVE, ALLOW AMEND PROCESSING;
     C*
     C           RECI      IFEQ 'D'
     C           PAUI      ANDNE'Y'
     C***********          MOVEL'A'       ACTN                            E20237
     C                     ELSE
     C*
     C**  IF RECORD HAS BEEN DELETED, ALLOW ENQUIRY
     C*
     C                     MOVEL'E'       ACTN
     C                     END
     C*
     C**  SET SCREEN PROCESSOR TO UPDATE AND MOVE UPDATE MESSAGE TO
     C**  ERROR
     C*
     C                     MOVEA'001'     *IN,10
     C                     MOVELINF,12    INFMSG
     C*
     C                     ENDSR
     C**
      *****************************************************************                       CRE020
      /EJECT                                                                                  CRE020
      *****************************************************************                       CRE020
      *                                                               *                       CRE020
      *  SRTNLU - Store original TNLU field on extension file         *                       CRE020
      *                                                               *                       CRE020
      *****************************************************************                       CRE020
     C           SRTNLU    BEGSR                                                              CRE020
      *                                                                                       CRE020
      ** If Insert, keep record keys and original TNLU on file                                CRE020
      *                                                                                       CRE020
     C                     MOVELPBCA      P3PBCA                                              CRE020
     C                     MOVELPSSH      P3PSSH                                              CRE020
     C                     MOVE PCPY      P3PCPY                                              CRE020
     C                     MOVE PDUD      P3PDUD                                              CRE020
     C                     MOVELPEVT      P3PEVT                                              CRE020
     C                     MOVELSPTAXL    P3TAX                                               CER049
     C                     MOVELWTAXA     P3STAF                                              CER049
     C                     MOVELBJRDNB    P3CDTE                                              CER049
      *                                                                                       CRE020
     C           CHTP      IFEQ 'I'                                                           CRE020
     C                     MOVE TNL1      P3OTNL                                              CRE020
     C                     MOVE TNL1      P3TNLU                                              CRE020
     C                     WRITEPOSETDD3                                                      CRE020
     C                     ELSE                                                               CRE020
     C                     MOVELP3PBCA    K3PBCA                                              CRE020
     C                     MOVELP3PSSH    K3PSSH                                              CRE020
     C                     MOVE P3PCPY    K3PCPY                                              CRE020
     C                     MOVE P3PDUD    K3PDUD                                              CRE020
     C                     MOVELP3PEVT    K3PEVT                                              CRE020
     C                     MOVE WTNL1     K3TNLU                                              CRE020
      *                                                                                       CRE020
     C           KPOST3    CHAINPOSETDD3             78                                       CRE020
     C           *IN78     IFEQ '0'                                                           CRE020
     C                     MOVE TNL1      P3TNLU                                              CRE020
     C                     MOVELSPTAXL    P3TAX                                               CER049
     C                     MOVELWTAXA     P3STAF                                              CER049
     C                     MOVELBJRDNB    P3CDTE                                              CER049
     C                     UPDATPOSETDD3                                                      CRE020
     C                     ELSE                                                               CRE020
     C                     MOVE WTNL1     P3OTNL                                              CRE020
     C                     MOVE TNL1      P3TNLU                                              CRE020
     C                     WRITEPOSETDD3                                                      CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     ENDIF                                                              CRE020
     C                     MOVELP3OTNL    KNARR                                               CRE020
      *                                                                                       CER049
     C           CER049    IFEQ 'Y'                                                           CER049
     C                     EXSR SRSTMD                                                        CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CRE020
     C                     ENDSR                                                              CRE020
      *****************************************************************                       CRE020
      /EJECT                                                                                  CRE020
      *****************************************************************                       CRE020
      *                                                               *                       CRE020
      *  SRIDXT - Handles the advice index of the current             *                       CRE020
      *           transaction.                                        *                       CRE020
      *                                                               *                       CRE020
      *****************************************************************                       CRE020
     C           SRIDXT    BEGSR                                                              CRE020
      *                                                                                       CRE020
      ** Only process authorised transactions.                                                CRE020
      *                                                                                       CRE020
     C           PAUI      IFEQ 'Y'                                                           CRE020
     C           CRE020    ANDEQ'Y'                                                           CER049
     C           WSV01     ANDEQ'Y'                                                           CER049
      *                                                                                       CRE020
      ** On Amend Mode, check if amendments done will affect the                              CRE020
      ** projections.  If not, do not generate advice                                         CRE020
      *                                                                                       CRE020
     C           CHTP      IFEQ 'A'                                                           CRE020
     C           PAMD      IFNE WPAMD                                                         CRE020
     C           PPRE      ORNE WPPRE                                                         CRE020
     C           PSCU      ORNE WPSCU                                                         CRE020
     C           PSXR      ORNE WPSXR                                                         CRE020
     C           PMDI      ORNE WPMDI                                                         CRE020
     C           PBRX      ORNE WPBRX                                                         CRE020
     C           PSMT      ORNE WPSMT                                                         CRE020
     C           PSEA      ORNE WPSEA                                                         CRE020
     C           PSEB      ORNE WPSEB                                                         CRE020
     C           PCHA      ORNE WPCHA                                                         CRE020
     C           PCAM      ORNE WPCAM                                                         CRE020
     C           PSAT      ORNE WPSAT2                                                        CRE020
     C                     ELSE                                                               CRE020
     C                     GOTO EIDXT                                                         CRE020
     C                     ENDIF                                                              CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     MOVE *BLANKS   WREFNO                                              CRE020
     C                     MOVE PSSH      WSSH                                                CRE020
     C                     MOVE PCPY      WCPY                                                CRE020
     C                     MOVE PBCA      WBCA                                                CRE020
     C                     MOVE PDUD      WDUD                                                CRE020
     C                     MOVE PEVT      WEVT                                                CRE020
      *                                                                                       CRE020
     C                     MOVE *BLANKS   KREFNO                                              CRE020
     C                     MOVELWREFNO    KREFNO                                              CRE020
      *                                                                                       CRE020
     C                     OPEN READVCL3                                                      CRE020
     C           KADVC     CHAINREADVCL3             69                                       CRE020
      *                                                                                       CRE020
     C           *IN69     IFEQ *ON                                                           CRE020
     C                     MOVE *BLANKS   RREFNO                                              CRE020
     C                     MOVELWREFNO    RREFNO                                              CRE020
     C                     MOVE *BLANKS   RPRGMN                                              CRE020
     C                     MOVEL'SE0170'  RPRGMN                                              CRE020
     C                     MOVE *BLANKS   RSEQNO                                              CRE020
     C                     MOVE PEVT      RTRTYP                                              CRE020
      *                                                                                       CRE020
     C           CHTP      IFEQ 'Y'                                                           CRE020
     C                     MOVEL'I'       RCHTYP                                              CRE020
     C                     ELSE                                                               CRE020
     C           CHTP      IFEQ 'R'                                                           CRE020
     C                     MOVEL'D'       RCHTYP                                              CRE020
     C                     ELSE                                                               CRE020
     C                     MOVE CHTP      RCHTYP                                              CRE020
     C                     ENDIF                                                              CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     MOVE 'Y'       RAUTHI                                              CRE020
     C                     MOVE 'N'       RSAPIN                                              CRE020
     C                     MOVELP3OTNL    RENARR                                              CRE020
     C                     WRITEREADVCD0                                                      CRE020
      *                                                                                       CRE020
     C                     ELSE                                                               CRE020
      *                                                                                       CRE020
      ** Check first if this is a new record.                                                 CRE020
      *                                                                                       CRE020
     C           RCHTYP    IFEQ 'I'                                                           CRE020
     C           RSAPIN    ANDEQ'N'                                                           CRE020
      *                                                                                       CRE020
     C           CHTP      IFEQ 'D'                                                           CRE020
     C                     MOVE 'D'       RCHTYP                                              CRE020
     C                     MOVE 'Y'       RAUTHI                                              CRE020
     C                     MOVE 'Y'       RSAPIN                                              CRE020
     C                     UPDATREADVCD0                                                      CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C           CHTP      IFEQ 'A'                                                           CRE020
     C                     MOVE 'Y'       RAUTHI                                              CRE020
     C                     UPDATREADVCD0                                                      CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     GOTO EIDXT                                                         CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C           CHTP      IFEQ 'Y'                                                           CRE020
     C                     MOVEL'I'       RCHTYP                                              CRE020
     C                     ELSE                                                               CRE020
     C           CHTP      IFEQ 'R'                                                           CRE020
     C                     MOVEL'D'       RCHTYP                                              CRE020
     C                     ELSE                                                               CRE020
     C                     MOVE CHTP      RCHTYP                                              CRE020
     C                     ENDIF                                                              CRE020
     C                     ENDIF                                                              CRE020
     C                     MOVE 'Y'       RAUTHI                                              CRE020
     C                     MOVE 'N'       RSAPIN                                              CRE020
     C                     UPDATREADVCD0                                                      CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     CLOSEREADVCL3                                                      CRE020
     C                     UNLCKREADVCL3                                                      CRE020
      *                                                                                       CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C           EIDXT     ENDSR                                                              CRE020
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  INFSR  - FILE EXEPTION/ERROR HANDLING SUBROUTINE             *
     C*                                                               *
     C*****************************************************************
     C*
     C           INFSR     BEGSR
     C*
     C**  ROLL BACK CHANGES AND CANCEL PROGRAM
     C*
     C                     ROLBK
     C                     MOVE '*CANCL'  EXTTAG  6
     C*
     C                     ENDSREXTTAG
     C*
     C*****************************************************************
      /EJECT                                                              S01117
     C*****************************************************************   S01117
     C*                                                               *   S01117
     C*  D1QRY  - SUBROUTINE TO TEST QUERY SELECTION ON KEY FIELDS    *   S01117
     C*                                                               *   S01117
     C*****************************************************************   S01117
     C*                                                                   S01117
     C           D1QRY     BEGSR                            ** D1QRY **   S01117
     C*                                                                   S01117
     C                     MOVE 'N'       RDSPLY                          S01117
     C*                                                                   S01117
     C**  Test query selection on Booking Branch field                    S01117
     C*                                                                   S01117
     C                     MOVELSPBCA     QMARK                           S01117
     C           QMARK     IFEQ '?'                                       S01117
     C                     MOVE 'Y'       RDSPLY                          S01117
     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SPBCA     @DSNB                           S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01117              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEL*BLANKS   SPBCA                           S01117
     C                     ELSE                                           S01117
     C                     MOVEL*BLANKS   SPBCA                           S01117
     C                     MOVELA8BRCD    SPBCA                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C/COPY WNCPYSRC,SE0170C012
      *                                                                   CSE010
      ** Check Security Shortname and call Securities Selection           CSE010
      *                                                                   CSE010
     C           CSE010    IFEQ 'Y'                                       CSE010
     C                     MOVELSPSSH     @QMK    1                       CSE010
     C           @QMK      IFEQ '?'                                       CSE010
     C                     MOVE 'Y'       RDSPLY                          CSE010
     C                     MOVELSPSSH     @SESN                           CSE010
     C                     CALL 'SE0043'                                  CSE010
     C                     PARM           @ACDE   1                       CSE010
     C                     PARM           @SESN  10                       CSE010
     C           @SESN     IFNE *BLANKS                                   CSE010
     C                     MOVE @SESN     SPSSH                           CSE010
     C                     ELSE                                           CSE010
     C                     MOVE *BLANKS   SPSSH                           CSE010
     C                     ENDIF                                          CSE010
     C                     ENDIF                                          CSE010
     C                     ENDIF                                          CSE010
     C*                                                                   S01117
     C**  Test query selection on Client field                            S01117
     C*                                                                   S01117
     C                     MOVELSPCPY     QMARK   1                       S01117
     C           QMARK     IFEQ '?'                                       S01117
     C                     MOVELSPCPY     CUSTNO  6                       S01117
     C                     MOVE 'Y'       RDSPLY  1                       S01117
     C                     CALL 'AOSECSR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM CUSTNO    CUST    6                       S01117
     C           SDSECS    PARM SDSECS    DSSDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEL*BLANKS   SPCPY                           S01117
     C                     ELSE                                           S01117
     C                     MOVEL*BLANKS   SPCPY                           S01117
     C                     MOVELBFCUST    SPCPY                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C*****************************************************************   S01117
      *EJECT*****                                                  051475 082738
      *****************************************************************   051475
      ***********                                                  051475 082738
      ***WNOSTR*- Subroutine to Update Projected Nostro Details.   051475 082738
      ***********                                                  051475 082738
      *****************************************************************   051475
      ***********                                                  051475 082738
     C***********                                                  051475 082738
     C***********WNOSTR    BEGSR                                   051475 082738
     C***********                                                  051475 082738
     C***Access*nostro details                                     051475 082738
     C***********                                                  051475 082738
     C***********          MOVE PSCU      CCY                      051475 082738
     C***********          MOVELPSEA      NOSN                     051475 082738
     C***********                                                  051475 082738
     C****If*it*is an delete action, inverse the position so that i051475 082738
     C****will*update PRONO with the correct amount.               051475 082738
     C***********                                                  051475 082738
     C***********ACTN      IFEQ 'Y'                                051475 082738
     C***********          Z-ADDPNMP      @WPNMP                   051475 082738
     C***********          ELSE                                    051475 082738
     C***********          Z-SUBPNMP      @WPNMP                   051475 082738
     C***********          END                                     051475 082738
     C***********                                                  051475 082738
     C***********          MOVELNOSN      SNOSN   20               051475 082738
     C***********KLPRON    CHAINPRONOPNF             44            051475 082738
     C************IN44     IFEQ '1'                                051475 082738
     C************IN44     OREQ '0'                                051475 082738
     C***********RECI      ANDEQ'*'                                051475 082738
     C***********          Z-ADD*ZEROS    NOSN                     051475 082738
     C***********KLPRON    CHAINPRONOPNF             44            051475 082738
     C***********          END                                     051475 082738
     C***********          Z-ADD9         DORC                     051475 082738
     C***********                                                  051475 082738
     C***Update*corresponding nostro balances                      051475 082738
     C***********                                                  051475 082738
     C************IN44     IFEQ '0'                                051475 082738
     C***********RECI      ANDNE'*'                                051475 082738
     C***********          MOVEAPNBA      ANB                      051475 082738
     C***********          MOVEAPNDA      AND                      051475 082738
     C***********                                                  051475 082738
     C***********          Z-ADD1         ZY                       051475 082738
     C***********          DO   5         ZY                       051475 082738
     C***********NND,ZY    IFGE PDUD                               051475 082738
     C***********@WPNMP    IFGE 0                                  051475 082738
     C***********PEVT      IFEQ 'PP'                               051475 082738
     C***********          SUB  PSAT      NNB,ZY                   051475 082738
     C***********          Z-ADD1         DORC                     051475 082738
     C***********          ELSE                                    051475 082738
     C***********          ADD  PSAT      NNB,ZY                   051475 082738
     C***********          Z-ADD0         DORC                     051475 082738
     C***********          END                                     051475 082738
     C***********          END                                     051475 082738
     C***********@WPNMP    IFLT 0                                  051475 082738
     C***********PEVT      IFNE 'PP'                               051475 082738
     C***********          SUB  PSAT      NNB,ZY                   051475 082738
     C***********          Z-ADD1         DORC                     051475 082738
     C***********          ELSE                                    051475 082738
     C***********          ADD  PSAT      NNB,ZY                   051475 082738
     C***********          Z-ADD0         DORC                     051475 082738
     C***********          END                                     051475 082738
     C***********          END                                     051475 082738
     C***********          END                                     051475 082738
     C***********                                                  051475 082738
     C***********          MOVEAANB       PNBA                     051475 082738
     C***********          Z-ADDNATN      TNLU                     051475 082738
     C***********                                                  051475 082738
     C*****..*save movement details for PF/RSACMTPD                051475 082738
     C***********                                                  051475 082738
     C***********          Z-ADDPSAT      MVAM                     051475 082738
     C***********          Z-ADDPDUD      MVPDUD  50               051475 082738
     C***********          MOVE PSCU      MVSETC  3                051475 082738
     C***********          END                                     051475 082738
     C***********                                                  051475 082738
     C***********          UPDATPRONOPNF                           051475 082738
     C***********                                                  051475 082738
     C*****..upon update of prono write account movement record    051475 082738
     C***********                                                  051475 082738
     C***********DORC      IFLT 9                                  051475 082738
     C***********                                                  051475 082738
     C*****..Get*account code and sequence from SDNOSTPD           051475 082738
     C***********                                                  051475 082738
     C***********          MOVE '*DBERR ' @RTCD                    051475 082738
     C***********          MOVELCCY       P@CYCD                   051475 082738
     C***********          MOVELSNOSN     P@NONB                   051475 082738
     C***********          EXSR AONOST                             051475 082738
     C***********          MOVELA7ACCD    ACOD                     051475 082738
     C***********          MOVELA7BRCD    BRCA                     051475 082738
     C***********          MOVELA7CUST    CNUM                     051475 082738
     C***********          MOVELA7ACSN    ACSQ                     051475 082738
     C***********                                                  051475 082738
     C***********          EXSR ACCMOV                             051475 082738
     C***********          END                                     051475 082738
     C***********                                                  051475 082738
     C***********                                                  051475 082738
     C***********          END                                     051475 082738
     C***********                                                  051475 082738
     C***********EUPBEF    ENDSR                                   051475 082738
     C***********                                                  051475 082738
      *****************************************************************   051475
      *EJECT******                                                 051475 082738
      *****************************************************************   051475
      ***********                                                  051475 082738
      ***WOLPOS*- Subroutine to Update On-line Positions Details.  051475 082738
      ***********                                                  051475 082738
      *****************************************************************   051475
      ***********                                                  051475 082738
     C***********WOLPOS    BEGSR                                   051475 082738
     C***********                                                  051475 082738
     C***Access OLPOS file for settlement currency                 051475 082738
     C***********                                                  051475 082738
     C****...*Insert/Delete                                        051475 082738
     C***********          MOVE PBCA      BRCA                     051475 082738
     C***********          MOVE PSCU      CCY                      051475 082738
     C***********          Z-ADD1         RECN                     051475 082738
     C***********                                                  051475 082738
     C***********KLOLPS    CHAINOLPOSOAF             44            051475 082738
     C************IN44     IFEQ '0'                                051475 082738
     C***********RECI      ANDNE'*'                                051475 082738
     C***********          MOVEAODTA      ADT                      051475 082738
     C***********          MOVEAOFIA      AFI                      051475 082738
     C***********          MOVEAOFOA      AFO                      051475 082738
     C***********                                                  051475 082738
     C***********          DO   16        ZY                       051475 082738
     C***********PDUD      IFGE NDT,ZY                             051475 082738
     C***********          Z-ADDZY        ZX                       051475 082738
     C***********          END                                     051475 082738
     C***********          END                                     051475 082738
     C***********                                                  051475 082738
     C***********PDUD      IFLT NDT,1                              051475 082738
     C***********          Z-ADD1         ZX                       051475 082738
     C***********          END                                     051475 082738
     C***********                                                  051475 082738
     C***********ACTN      IFEQ 'Y'                                051475 082738
     C***********                                                  051475 082738
     C***********PNMP      IFGE 0                                  051475 082738
     C***********                                                  051475 082738
     C***********PEVT      IFEQ 'PP'                               051475 082738
     C***********          ADD  PSAT      NFO,ZX                   051475 082738
     C***********          ELSE                                    051475 082738
     C***********          ADD  PSAT      NFI,ZX                   051475 082738
     C***********          END                                     051475 082738
     C***********                                                  051475 082738
     C***********          ELSE                                    051475 082738
     C***********                                                  051475 082738
     C***********PEVT      IFEQ 'PP'                               051475 082738
     C***********          ADD  PSAT      NFI,ZX                   051475 082738
     C***********          ELSE                                    051475 082738
     C***********          ADD  PSAT      NFO,ZX                   051475 082738
     C***********          END                                     051475 082738
     C***********                                                  051475 082738
     C***********          END                                     051475 082738
     C***********                                                  051475 082738
     C***********          END                                     051475 082738
     C***********                                                  051475 082738
     C***********                                                  051475 082738
     C***********ACTN      IFEQ 'D'                                051475 082738
     C***********                                                  051475 082738
     C***********PNMP      IFGE 0                                  051475 082738
     C***********                                                  051475 082738
     C***********PEVT      IFEQ 'PP'                               051475 082738
     C***********          SUB  PSAT      NFO,ZX                   051475 082738
     C***********          ELSE                                    051475 082738
     C***********          SUB  PSAT      NFI,ZX                   051475 082738
     C***********          END                                     051475 082738
     C***********                                                  051475 082738
     C***********          ELSE                                    051475 082738
     C***********                                                  051475 082738
     C***********PEVT      IFEQ 'PP'                               051475 082738
     C***********          SUB  PSAT      NFI,ZX                   051475 082738
     C***********          ELSE                                    051475 082738
     C***********          SUB  PSAT      NFO,ZX                   051475 082738
     C***********          END                                     051475 082738
     C***********                                                  051475 082738
     C***********          END                                     051475 082738
     C***********                                                  051475 082738
     C***********          END                                     051475 082738
     C***********                                                  051475 082738
     C***********          MOVEAAFI       OFIA                     051475 082738
     C***********          MOVEAAFO       OFOA                     051475 082738
     C***********          Z-ADDNATN      TNLU                     051475 082738
     C***********                                                  051475 082738
     C***********          UPDATOLPOSOAF                           051475 082738
     C***********          END                                     051475 082738
     C***********                                                  051475 082738
     C***Access*OLPOS file for nominal currency                    051475 082738
     C***********                                                  051475 082738
     C***********          MOVE PBCA      BRCA                     051475 082738
     C***********          MOVE PNCY      CCY                      051475 082738
     C***********          Z-ADD1         RECN                     051475 082738
     C***********KLOLPS    CHAINOLPOSOAF             44            051475 082738
     C************IN44     IFEQ '0'                                051475 082738
     C***********RECI      ANDNE'*'                                051475 082738
     C***********          MOVEAODTA      ADT                      051475 082738
     C***********          MOVEAOFIA      AFI                      051475 082738
     C***********          MOVEAOFOA      AFO                      051475 082738
     C***********                                                  051475 082738
     C***********          DO   16        ZY                       051475 082738
     C***********PDUD      IFGE NDT,ZY                             051475 082738
     C***********          Z-ADDZY        ZX                       051475 082738
     C***********          END                                     051475 082738
     C***********          END                                     051475 082738
     C***********                                                  051475 082738
     C***********PDUD      IFLT NDT,1                              051475 082738
     C***********          Z-ADD1         ZX                       051475 082738
     C***********          END                                     051475 082738
     C***********                                                  051475 082738
     C***********ACTN      IFEQ 'Y'                                051475 082738
     C***********                                                  051475 082738
     C***********PNMP      IFGE 0                                  051475 082738
     C***********                                                  051475 082738
     C***********PEVT      IFEQ 'PP'                               051475 082738
     C***********          ADD  PSAT      NFO,ZX                   051475 082738
     C***********          ELSE                                    051475 082738
     C***********          ADD  PSAT      NFI,ZX                   051475 082738
     C***********          END                                     051475 082738
     C***********                                                  051475 082738
     C***********          ELSE                                    051475 082738
     C***********                                                  051475 082738
     C***********PEVT      IFEQ 'PP'                               051475 082738
     C***********          ADD  PSAT      NFI,ZX                   051475 082738
     C***********          ELSE                                    051475 082738
     C***********          ADD  PSAT      NFO,ZX                   051475 082738
     C***********          END                                     051475 082738
     C***********                                                  051475 082738
     C***********          END                                     051475 082738
     C***********                                                  051475 082738
     C***********          END                                     051475 082738
     C***********                                                  051475 082738
     C***********                                                  051475 082738
     C***********ACTN      IFEQ 'D'                                051475 082738
     C***********                                                  051475 082738
     C***********PNMP      IFGE 0                                  051475 082738
     C***********                                                  051475 082738
     C***********PEVT      IFEQ 'PP'                               051475 082738
     C***********          SUB  PSAT      NFO,ZX                   051475 082738
     C***********          ELSE                                    051475 082738
     C***********          SUB  PSAT      NFI,ZX                   051475 082738
     C***********          END                                     051475 082738
     C***********                                                  051475 082738
     C***********          ELSE                                    051475 082738
     C***********                                                  051475 082738
     C***********PEVT      IFEQ 'PP'                               051475 082738
     C***********          SUB  PSAT      NFI,ZX                   051475 082738
     C***********          ELSE                                    051475 082738
     C***********          SUB  PSAT      NFO,ZX                   051475 082738
     C***********          END                                     051475 082738
     C***********                                                  051475 082738
     C***********          END                                     051475 082738
     C***********                                                  051475 082738
     C***********          END                                     051475 082738
     C***********                                                  051475 082738
     C***********                                                  051475 082738
     C***********          MOVEAAFI       OFIA                     051475 082738
     C***********          MOVEAAFO       OFOA                     051475 082738
     C***********          Z-ADDNATN      TNLU                     051475 082738
     C***********                                                  051475 082738
     C***********          UPDATOLPOSOAF                           051475 082738
     C***********          END                                     051475 082738
     C***********                                                  051475 082738
     C***********          ENDSR                                   051475 082738
      ***********                                                  051475 082738
     C********************************************************************051475
      *EJECT*****                                                  051475 082738
      ********************************************************************051475
     C***********                                                  051475 082738
     C**AONOST*-*SUBROUTINE TO CALL ACCESS OBJECT : NOSTRO DETAILS 051475 082738
     C***********                                                  051475 082738
     C***********AONOST    BEGSR                           ** AONOS051475 082738
     C***********                                                  051475 082738
     C***********          CALL 'AONOSTR0'                         051475 082738
     C***********          PARM           @RTCD   7                051475 082738
     C***********          PARM '*KEY   ' @OPTN   7                051475 082738
     C***********          PARM *BLANKS   P@CUST  6          Custom051475 082738
     C***********          PARM           P@CYCD  3          Curren051475 082738
     C***********          PARM *BLANKS   P@ACCD  4          A/c Co051475 082738
     C***********          PARM *BLANKS   P@ACSN  2          A/c Se051475 082738
     C***********          PARM           P@NONB  2          Nostro051475 082738
     C***********          PARM *BLANKS   P@BRCD  3          Branch051475 082738
     C***********          PARM *BLANKS   P@CSSN 10          Cust S051475 082738
     C***********          PARM *BLANKS   P@PNOI  1          Prime 051475 082738
     C***********SDNOST    PARM SDNOST    DSFDY                    051475 082738
     C***********                                                  051475 082738
     C***********          ENDSR                                   051475 082738
     C********************************************************************051475
      /EJECT                                                              S01117
     C*****************************************************************   S01117
     C*                                                               *   S01117
     C*  D2QRY - SUBROUTINE TO TEST QUERY SELECTION ON DETAIL FIELDS  *   S01117
     C*                                                               *   S01117
     C*****************************************************************   S01117
     C*                                                                   S01117
     C           D2QRY     BEGSR                            ** D2QRY **   S01117
     C*                                                                   S01117
     C                     MOVE 'N'       RDSPLY                          S01117
     C*                                                                   S01117
     C**  Test query selection on Book Code field                         S01117
     C*                                                                   S01117
     C                     MOVELSPBCD     QMARK                           S01117
     C           QMARK     IFEQ '?'                                       S01117
     C                     MOVE 'Y'       RDSPLY                          S01117
     C                     CALL 'AOBOOKR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SPBCD     @BKCD                           S01117
     C           SDBOOK    PARM SDBOOK    DSFDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEL*BLANKS   SPBCD                           S01117
     C                     ELSE                                           S01117
     C                     MOVEL*BLANKS   SPBCD                           S01117
     C                     MOVELBDBKCD    SPBCD                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**  Test query selection on Profit Centre Field                     S01117
     C*                                                                   S01117
     C           *IN83     IFEQ '1'                                       S01117
     C                     MOVELSPPFC     QMARK                           S01117
     C           QMARK     IFEQ '?'                                       S01117
     C                     MOVE 'Y'       RDSPLY                          S01117
     C                     CALL 'AOPRFCR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SPPFC     @PCCD                           S01117
     C           SDPRFC    PARM SDPRFC    DSFDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEL*BLANKS   SPPFC                           S01117
     C                     ELSE                                           S01117
     C                     MOVEL*BLANKS   SPPFC                           S01117
     C                     MOVELDSPCCD    SPPFC                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**  Test query selection on Settlement Currency field               S01117
     C*                                                                   S01117
     C                     MOVELSPSCU     QMARK                           S01117
     C           QMARK     IFEQ '?'                                       S01117
     C                     MOVE 'Y'       RDSPLY                          S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SPSCU     @AJCD                           S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEL*BLANKS   SPSCU                           S01117
     C                     ELSE                                           S01117
     C                     MOVEL*BLANKS   SPSCU                           S01117
     C                     MOVELA6CYCD    SPSCU                           S01117
     C                     END                                            S01117
     C                     MOVELSPSCU     XSPSCU                          151506
     C                     END                                            S01117
     C*                                                                   S01117
     C**  Test query selection on Settlement A/c field                    S01117
     C**  if settlement method is through nostro                          S01117
     C*                                                                   S01117
     C                     MOVELSPSEA     QMARK                           S01117
     C           QMARK     IFEQ '?'                                       S01117
     C*                                                                   S01117
     C           SPSMT     IFEQ '01'                                      S01117
     C           SPSMT     OREQ '02'                                      S01117
     C           SPSMT     OREQ '07'                                      S01117
     C           SPSMT     OREQ '08'                                      S01117
     C           SPSMT     OREQ '12'                                      S01117
     C                     MOVE 'Y'       RDSPLY                          S01117
     C                     MOVELSPNCY     NOCUR   3                       S01117
     C                     MOVELSPSEA     NOS2A   2                       S01117
     C                     CALL 'AONOSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM *BLANKS   @CUST                           S01117
     C                     PARM NOCUR     @CCYC                           S01117
     C                     PARM *BLANKS   @ACCD                           S01117
     C                     PARM *BLANKS   @ACSQ                           S01117
     C                     PARM NOS2A     @NOSN                           S01117
     C                     PARM *BLANKS   @BRCD                           S01117
     C                     PARM *BLANKS   @CUSN                           S01117
     C                     PARM *BLANKS   @PRNO                           S01117
     C           SDNOST    PARM SDNOST    DSFDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEL*BLANKS   SPSEA                           S01117
     C                     ELSE                                           S01117
     C                     MOVEL*BLANKS   SPSEA                           S01117
     C                     MOVELA7NONB    SPSEA                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**  Test query selection on Settlement Branch field                 S01117
     C**  If Multibranching indicator is on                               S01117
     C*                                                                   S01117
     C           *IN81     IFEQ '1'                                       S01117
     C                     MOVELSPSEB     QMARK                           S01117
     C           QMARK     IFEQ '?'                                       S01117
     C                     MOVE 'Y'       RDSPLY                          S01117
     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SPSEB     @DSNB                           S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01117              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEL*BLANKS   SPSEB                           S01117
     C                     ELSE                                           S01117
     C                     MOVEL*BLANKS   SPSEB                           S01117
     C                     MOVELA8BRCD    SPSEB                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**  Test query selection on Counterparty Bank field                 S01117
     C*                                                                   S01117
     C                     MOVELSPCPN     QMARK                           S01117
     C           QMARK     IFEQ '?'                                       S01117
     C*                                                                   S01117
     C           SPSMT     IFEQ '01'                                      S01117
     C           SPSMT     OREQ '07'                                      S01117
     C           SPSMT     OREQ '08'                                      S01117
     C                     MOVE 'Y'       RDSPLY                          S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SPCPN     @KEY1                           S01117
     C                     PARM *BLANKS   @KYST                           S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVEL*BLANKS   SPCPN                           S01117
     C                     MOVELBBCUST    SPCPN                           S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C**  No selection made, display Counterparty Nostro details          S01117
     C*                                                                   S01117
     C           @RTCD     IFEQ '*NOSEL'                                  S01117
     C                     MOVELSPCPN     CPNST                           S01117
     C                     CALL 'AOCNSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM CPNST     @CPNC                           S01117
     C           SDCNST    PARM SDCNST    DSFDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEL*BLANKS   SPCPN                           S01117
     C                     ELSE                                           S01117
     C                     MOVEL*BLANKS   SPCPN                           S01117
     C                     MOVELAWCPNC    SPCPN                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**  Test query selection on For A/C of field                        S01117
     C*                                                                   S01117
     C                     MOVELSPFAC     QMARK                           S01117
     C           QMARK     IFEQ '?'                                       S01117
     C*                                                                   S01117
     C           SPSMT     IFEQ '01'                                      S01117
     C           SPSMT     OREQ '07'                                      S01117
     C           SPSMT     OREQ '08'                                      S01117
     C           SPPRE     IFEQ 'P'                                       S01117
     C                     MOVE 'Y'       RDSPLY                          S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SPFAC     @KEY1                           S01117
     C                     PARM *BLANKS   @KYST                           S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVEL*BLANKS   SPFAC                           S01117
     C                     MOVELBBCUST    SPFAC                           S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C**  No selection made, display Counterparty Nostro details          S01117
     C*                                                                   S01117
     C           @RTCD     IFEQ '*NOSEL'                                  S01117
     C                     MOVELSPFAC     CPNST                           S01117
     C                     CALL 'AOCNSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM CPNST     @CPNC                           S01117
     C           SDCNST    PARM SDCNST    DSFDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEL*BLANKS   SPFAC                           S01117
     C                     ELSE                                           S01117
     C                     MOVEL*BLANKS   SPFAC                           S01117
     C                     MOVELAWCPNC    SPFAC                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C/COPY WNCPYSRC,SE0170C023
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C*****************************************************************   S01117
      /EJECT
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0170CCP4                                           S01408
     C*                                                                   S01408
      *****************************************************************   CAC002
      *                                                               *   CAC002
      *  Subroutine  :  SRNQDP                                        *   CAC002
      *  Function    :  Get Normally-Quoted Decimal Places            *   CAC002
      *                                                               *   CAC002
      *  Called by   :  D3VALD - Validate Screen 3 Data Entry         *   CAC002
      *  Calls       :  -                                             *   CAC002
      *                                                               *   CAC002
      *****************************************************************   CAC002
      *                                                                   CAC002
     C           SRNQDP    BEGSR                           ** SRNQDP **   CAC002
      *                                                                   CAC002
      ** --------------------------------------------------------------   CAC002
      **  If either the nominal or settlement currency is the base        CAC002
      **  currency obtain the number of normally-quoted decimal places    CAC002
      **  for the other currency. Otherwise:                              CAC002
      **      A)  If ZNQDP1 =  ZNQDP2 =  5       :   ZNQDPX = 5           CAC002
      **      B)  If ZNQDP1 =  ZNQDP2 <> 5  or                            CAC002
      **             ZNQDP1 <> ZNQDP2                                     CAC002
      **             1)  If Rate >= 100          :   ZNQDPX = 2           CAC002
      **             2)  If 100 > Rate >= 20     :   ZNQDPX = 3           CAC002
      **             3)  If 20  > Rate >= 1      :   ZNQDPX = 4           CAC002
      **             4)  If 1   > Rate           :   ZNQDPX = 5           CAC002
      **---------------------------------------------------------------   CAC002
      *                                                                   CAC002
     C                     SELEC                                          CAC002
      *                                                                   CAC002
     C           NMCY      WHEQ BJCYCD                                    CAC002
     C                     Z-ADDZNQDP2    ZNQDPX  10                      CAC002
      *                                                                   CAC002
     C           SPSCU     WHEQ BJCYCD                                    CAC002
     C                     Z-ADDZNQDP1    ZNQDPX                          CAC002
      *                                                                   CAC002
     C           ZNQDP1    WHEQ ZNQDP2                                    CAC002
     C           ZNQDP1    ANDEQ5                                         CAC002
     C                     Z-ADD5         ZNQDPX                          CAC002
      *                                                                   CAC002
     C           PSXR      WHEQ 100                                       CAC002
     C                     Z-ADD2         ZNQDPX                          CAC002
      *                                                                   CAC002
     C           PSXR      WHLT 100                                       CAC002
     C           PSXR      ANDGE20                                        CAC002
     C                     Z-ADD3         ZNQDPX                          CAC002
      *                                                                   CAC002
     C           PSXR      WHLT 20                                        CAC002
     C           PSXR      ANDGE1                                         CAC002
     C                     Z-ADD4         ZNQDPX                          CAC002
      *                                                                   CAC002
     C           PSXR      WHLT 1                                         CAC002
     C                     Z-ADD5         ZNQDPX                          CAC002
      *                                                                   CAC002
     C                     ENDSL                                          CAC002
      *                                                                   CAC002
     C           SRNQD9    ENDSR                           ** SRNQD9 **   CAC002
      *                                                                   CAC002
     C*****************************************************************   CAC002
      /EJECT                                                                                  CSE028
      *****************************************************************                       CSE028
      *                                                               *                       CSE028
      * SRSSIR - Sub-routine to call SESSIR0.                         *                       CSE028
      *                                                               *                       CSE028
      * Called by: DEFLTS                                             *                       CSE028
      *                                                               *                       CSE028
      * Calls:                                                        *                       CSE028
      *                                                               *                       CSE028
      *****************************************************************                       CSE028
     C           SRSSIR    BEGSR                                                              CSE028
      *                                                                                       CSE028
     C                     MOVE 'N'       NOTFND                                              CSE028
     C                     MOVE PCPY      WCUST   6                                           CSE028
     C                     CALL 'SESSIR0'                                                     CSE028
     C                     PARM 'D'       POTYP   1                                           CSE028
     C                     PARM           PBCA                                                CSE028
     C                     PARM           WCUST                                               CSE028
     C                     PARM           WBKCD   2                                           CSE028
     C                     PARM           CURK                                                CSE028
     C                     PARM           SMCC                                                CSE034
     C                     PARM *BLANKS   WSITP   3                                           CSE028
     C                     PARM *BLANKS   WPTFR   4                                           CSE028
     C                     PARM           PCBSTD                                              CSE028
     C                     PARM           PCBSAD                                              CSE028
     C                     PARM *BLANKS   PRETCD  5                                           CSE028
      *                                                                                       CSE028
     C           PRETCD    IFNE '*NCRF'                                                       CSE028
     C           PRETCD    ANDNE'*NRF '                                                       CSE028
     C           2         OCUR PCBSTD                                                        CSE028
     C                     ELSE                                                               CSE028
     C           PRETCD    IFNE '*NBRF'                                                       CSE028
     C           PRETCD    ANDNE'*NRF '                                                       CSE028
     C           1         OCUR PCBSTD                                                        CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE 'Y'       NOTFND  1                                           CSE028
     C                     ENDIF                                                              CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     ENDSR                                                              CSE028
      *****************************************************************                       CSE028
      /EJECT                                                              CAC002
     C*****************************************************************   S01117
     C*                                                               *   S01117
     C* *PSSR - SUBROUTINE TO HANDLE ABNORMAL ERROR CONDITIONS        *   S01117
     C*                                                               *   S01117
     C* CALLED FROM : AFTER ABNORMAL OPERATION OCCURS                 *   S01117
     C*                                                               *   S01117
     C* CALLS : NOTHING                                               *   S01117
     C*****************************************************************   S01117
     C*                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR **    S01117
     C*                                                                   S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C*                                                                   S01447
     C                     CALL 'DBERRCTL'                                S01447
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C********************************************************************S01117
      /EJECT
     C/COPY ZSRSRC,ZALIGNZ2
      /EJECT
     C/COPY ZSRSRC,ZASIGNZ2
      /EJECT                                                              S01512
     C/COPY ZSRSRC,ZCONVZ1                                                S01512
      /EJECT
     C/COPY ZSRSRC,ZDATE1Z2
      /EJECT
     C/COPY ZSRSRC,ZDATE2Z4
      /EJECT
     C*COPY*ZSRSRC,ZDATE6Z2****************                               S01195
      /EJECT
     C/COPY ZSRSRC,ZACCH                                                  S01195
     C/EJECT                                                              S01195
     C/COPY ZSRSRC,ZCHKH                                                  S01195
      /EJECT
     C*COPY*ZSRSRC*ZICD2Z1*************                                   S01117
      *EJECT*****                                                         S01117
     C*COPY*ZSRSRC*ZICDSEZ1************                                   S01117
      *EJECT*****                                                         S01117
     C/COPY ZSRSRC,ZSEDITZ3
      /EJECT
     C*COPY*ZSRSRC*ZSYSTMZ1************                                   S01117
      *EJECT*****                                                         S01117
     C/COPY ZSRSRC,ZTNLU1Z2
      /EJECT
     C/COPY ZSRSRC,ZXRATEZ1
      /EJECT                                                                                  191161
      *****************************************************************                       191161
      * Subroutine  :  UPDCAF                                         *                       191161
      * Function    :  Update Transaction Number of Last Update       *                       191161
      *                in PF/SECOALPD and/or PF/SECODPPD.             *                       191161
      *                                                               *                       191161
      * Called by   :  Subroutine UPDFLS                              *                       191161
      * Calls       :                                                 *                       191161
      *****************************************************************                       191161
      *                                                                                       191161
     C           UPDCAF    BEGSR                                                              191161
      *                                                                                       191161
     C           CUSTTP    KLIST                                                              191161
     C                     KFLD           PBCA                                                191161
     C                     KFLD           PCPY                                                191161
     C                     KFLD           PEVT                                                191161
     C                     KFLD           PTFR                                                191161
     C                     KFLD           TNLU1                                               191161
      *                                                                                       191161
     C           DEPOTP    KLIST                                                              191161
     C                     KFLD           PBCA                                                191161
     C                     KFLD           PCPY                                                191161
     C                     KFLD           PEVT                                                191161
     C                     KFLD           TNLU1                                               191161
      *                                                                                       191161
     C                     MOVE *BLANK    FOUND   1                                           191161
      *                                                                                       191161
     C           PCPYTP    IFEQ 'C'                                                           191161
     C           CUSTTP    SETLLSECOALLA                                                      191161
     C           CUSTTP    READESECOALLA                 58                                   191161
     C                     ELSE                                                               191161
     C           DEPOTP    SETLLSECODPL7                                                      191161
     C           DEPOTP    READESECODPL7                 58                                   191161
     C                     ENDIF                                                              191161
      *                                                                                       191161
     C           *IN58     DOUEQ'1'                                                           191161
     C           FOUND     OREQ 'Y'                                                           191161
      *                                                                                       191161
     C           PCPYTP    IFEQ 'C'                                                           191161
     C           MCCORF    CHAINSECORFL0             59                                       191161
     C                     ELSE                                                               191161
     C           MBCORF    CHAINSECORFL0             59                                       191161
     C                     ENDIF                                                              191161
      *                                                                                       191161
     C           *IN59     IFEQ '0'                                                           191161
     C           MASESN    ANDEQPSSH                                                          191161
     C           MAALEF    ANDEQPDUD                                                          191161
     C           MACOAT    ANDEQPEVT                                                          191161
      *                                                                                       191161
     C                     MOVEL'Y'       FOUND                                               191161
      *                                                                                       191161
     C           PCPYTP    IFEQ 'C'                                                           191161
     C                     Z-ADDTNL1      MCTNL1                                              191161
     C                     UPDATSECOALD0                                                      191161
     C                     ELSE                                                               191161
     C                     Z-ADDTNL1      MBTNL1                                              191161
     C                     UPDATSECODPD0                                                      191161
     C                     ENDIF                                                              191161
     C                     ENDIF                                                              191161
      *                                                                                       191161
     C           PCPYTP    IFEQ 'C'                                                           191161
     C           CUSTTP    READESECOALLA                 58                                   191161
     C                     ELSE                                                               191161
     C           DEPOTP    READESECODPL7                 58                                   191161
     C                     ENDIF                                                              191161
      *                                                                                       191161
     C                     END                                                                191161
     C                     ENDSR                                                              191161
      *****************************************************************                       191161
      /EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
      * Subroutine  :  SRWTCH                                         *                       CSD015
      * Function    :  This subroutine will send details to the       *                       CSD015
      *                Compliance watch engine program.               *                       CSD015
      *                                                               *                       CSD015
      * Called by   :  Subroutine UPDFLS                              *                       CSD015
      * Calls       :  SDCWLCHK                                       *                       CSD015
      *****************************************************************                       CSD015
      *                                                                                       CSD015
     C           SRWTCH    BEGSR                                                              CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   RSLT2 216                                           CSD015
     C                     MOVE *BLANKS   RSLT3 216                                           CSD015
     C                     MOVE *BLANKS   RSLT4 216                                           CSD015
     C                     MOVE *BLANKS   RSLT   30                                           CSD015
     C                     MOVE PDUD      PDUDA   5                                           CSD015
     C                     MOVE PCPY      PCPYA   6                                           CSD015
      *                                                                                       CSD015
     C                     MOVE 'SEPOSS'  W4ITEM                                              CSD015
      *                                                                                       CSD015
     C           PBCA      CAT  PSSH:0    RSLTMP                                              CSD015
     C           RSLTMP    CAT  PCPYA     RSLT                                                CSD015
     C           RSLT      CAT  PDUDA:0   RSLT                                                CSD015
     C           RSLT      CAT  PEVT:0    RSLT   30                                           CSD015
     C                     MOVELRSLT      W4IDEN                                              CSD015
     C                     MOVELPBCA      W4BRCH                                              CSD015
     C                     MOVELLIBR      W4SYSM                                              CSD015
     C                     MOVEL'POSETD'  W4FUNT                                              CSD015
      *                                                                                       CSD015
     C                     CALL 'AOCUSTR0'                                                    CSD015
     C                     PARM *BLANKS   @RTCD                                               CSD015
     C                     PARM '*KEY   ' @OPTN                                               CSD015
     C                     PARM PCPYA     @KEY1  10                                           CSD015
     C                     PARM *BLANKS   @KYST   7                                           CSD015
     C           SDCUST    PARM SDCUST    DSSDY                                               CSD015
      *                                                                                       CSD015
     C           @RTCD     IFNE *BLANKS                                                       CSD015
     C           @RTCD     ANDNE'*NRF   '                                                     CSD015
     C                     MOVE 47        DBASE                                               CSD015
     C                     MOVELPCPY      DBKEY                                               CSD015
     C                     MOVEL'SDCUSTPD'DBFILE                                              CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     MOVELPCPY      W4CNUM                                              CSD015
     C           @RTCD     IFEQ *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           BBCRNM    CAT  BBCRTN    W4CUST                                              CSD015
      *                                                                                       CSD015
     C           CCF001    IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
     C           BBCRPC    IFEQ 'Y'                                                           CSD015
     C                     MOVE 'C'       W4CTYP                                              CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'I'       W4CTYP                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
     C           BBLICD    IFNE *BLANK                                                        CSD015
     C           BBLICD    ANDNEW1IND1                                                        CSD015
     C           BBLICD    ANDNEW1IND2                                                        CSD015
     C           BBLICD    ANDNEW1IND3                                                        CSD015
     C           BBLICD    ANDNEW1IND4                                                        CSD015
     C           BBLICD    ANDNEW1IND5                                                        CSD015
     C                     MOVEL'C'       W4CTYP                                              CSD015
     C                     ELSE                                                               CSD015
     C                     MOVEL'I'       W4CTYP                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     MOVELPDUD      W4DDAT                                              CSD015
     C                     MOVELPSVL      W4VDAT                                              CSD015
     C                     Z-ADD0         W4MDAT                                              CSD015
     C                     MOVELPSSH      W4DEN1                                              CSD015
     C                     MOVEL*BLANKS   W4DEN2                                              CSD015
     C                     Z-ADDPNMP      W4AMT1                                              CSD015
     C                     Z-ADD0         W4AMT2                                              CSD015
      *                                                                                       CSD015
      **  If action code is amend check the current status of the existing transaction.       CSD015
      *                                                                                       CSD015
     C           ACTN      IFEQ 'A'                                                           CSD015
     C           CMPKEY    CHAINSDCWHTL1             76                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           ACTN      IFEQ 'I'                                                           CSD015
     C           W3UNCF    OREQ 'Y'                                                           CSD015
     C           ACTN      OREQ 'A'                                                           CSD015
     C           PSEA      ANDNEXPSEA                                                         CSD015
     C                     MOVE *BLANKS   FLD1   18                                           CSD015
     C                     MOVELPSEA      FLD1   18                                           CSD015
     C                     EXSR CONV                                                          CSD015
     C                     MOVELOUTFMT    RSLT2 216                                           CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           ACTN      IFEQ 'I'                                                           CSD015
     C           W3UNCF    OREQ 'Y'                                                           CSD015
     C           ACTN      OREQ 'A'                                                           CSD015
     C           PCPN      ANDNEXPCPN                                                         CSD015
     C                     MOVE *BLANKS   FLD1   18                                           CSD015
     C                     MOVELPCPN      FLD1   18                                           CSD015
     C                     EXSR CONV                                                          CSD015
     C                     MOVELOUTFMT    RSLT3                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           ACTN      IFEQ 'I'                                                           CSD015
     C           W3UNCF    OREQ 'Y'                                                           CSD015
     C           ACTN      OREQ 'A'                                                           CSD015
     C           PFAC      ANDNEXPFAC                                                         CSD015
     C                     MOVE *BLANKS   FLD1   18                                           CSD015
     C                     MOVELPCPN      FLD1   18                                           CSD015
     C                     EXSR CONV                                                          CSD015
     C                     MOVELOUTFMT    RSLT4 216                                           CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           RSLT2     IFNE *BLANKS                                                       CSD015
     C           CRW,1     CAT  RSLT2:0   PSTRNG                                              CSD015
     C           PSTRNG    CAT  CRW,2:0   PSTRNG                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           RSLT2     IFNE *BLANKS                                                       CSD015
     C           CRW,1     CAT  RSLT2:0   PSTRNG                                              CSD015
     C           PSTRNG    CAT  CRW,2:0   PSTRNG                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           RSLT3     IFNE *BLANKS                                                       CSD015
     C           PSTRNG    CAT  CRW,3:0   PSTRNG                                              CSD015
     C           PSTRNG    CAT  RSLT3:0   PSTRNG                                              CSD015
     C           PSTRNG    CAT  CRW,4:0   PSTRNG                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           RSLT4     IFNE *BLANKS                                                       CSD015
     C           PSTRNG    CAT  CRW,5:0   PSTRNG                                              CSD015
     C           PSTRNG    CAT  RSLT4:0   PSTRNG                                              CSD015
     C           PSTRNG    CAT  CRW,6:0   PSTRNG                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Send position settlement and extended settlment details to the engine program.       CSD015
      *                                                                                       CSD015
     C           WWEXRC    IFNE *BLANKS                                                       CSD015
     C           PSTRNG    CAT  WWEXRC:0  PSTRNG                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PSTRNG    IFNE *BLANKS                                                       CSD015
     C                     CALL 'SDWLCLOP'                                                    CSD015
     C                     PARM           PDS1                                                CSD015
     C                     PARM           PSTRNG                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
      /EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
      * Subroutine  :  CONV                                           *                       CSD015
      * Function    :  This subroutine will convert accounts, customer*                       CSD015
      *                no. to customer name and address.              *                       CSD015
      *                                                               *                       CSD015
      * Called by   :  Subroutine UPDFLS                              *                       CSD015
      * Calls       :  SDCWLCHK                                       *                       CSD015
      *****************************************************************                       CSD015
      *                                                                                       CSD015
     C           CONV      BEGSR                                                              CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   OUTFMT216                                           CSD015
     C                     MOVE *BLANKS   WRTCD  35                                           CSD015
      *                                                                                       CSD015
     C           FLD1      IFNE *BLANKS                                                       CSD015
     C                     CALL 'SDCWLFMT'                                                    CSD015
     C                     PARM *BLANKS   PRTCD   7                                           CSD015
     C                     PARM FLD1      WRTC1  35                                           CSD015
     C                     PARM           WRTC2  35                                           CSD015
     C                     PARM           WRTC3  35                                           CSD015
     C                     PARM           WRTC4  35                                           CSD015
     C                     PARM           WRTC5  35                                           CSD015
     C                     PARM           WRTC6  35                                           CSD015
     C                     PARM PNCY      WRTC7   3                                           CSD015
     C                     PARM           OUTFMT216                                           CSD015
     C                     PARM           OUTCUS  6                                           CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
      /EJECT                                                                                  CER049
      *****************************************************************                       CER049
      * Subroutine  :  SRSTAX                                         *                       CER049
      * Function    :  This subroutine will calculate the stamp tax   *                       CER049
      *                and charge amount.                             *                       CER049
      *****************************************************************                       CER049
      *                                                                                       CER049
     C           SRSTAX    BEGSR                                                              CER049
      *                                                                                       CER049
     C           SPTAXL    IFEQ 'N'                                                           CER049
     C                     MOVEL*BLANKS   SPCHCD                                              CER049
     C                     MOVEL*BLANKS   SPTAXA                                           AR875302A
     C                     MOVEL*BLANKS   SPCHAM                                           AR875302A
     C                     MOVEL*ZEROS    WTAXA                                               CER049
     C                     MOVELBJLCCY    U#SCCY                                              CER049
      ** Default Stamp Tax Liable                                                           AR851784
     C           W1STPS    IFNE 'Y'                                                         AR851784
     C                     MOVE 'Y'       W1STPS                                            AR851784
     C                     CALL 'AOBRCHR2'                                                  AR851784
     C                     PARM *BLANKS   @RTCD                                             AR851784
     C                     PARM '*KEY   ' @OPTN                                             AR851784
     C                     PARM SPBCA     @DSNB                                             AR851784
     C           SDBRCE    PARM SDBRCE    DSSDY                                             AR851784
     C           @RTCD     IFEQ *BLANKS                                                     AR851784
     C                     MOVE BXTAX     WSTAX                                             AR851784
     C                     ENDIF                                                            AR851784
      *                                                                                     AR851784
     C                     CALL 'AOCUSTR0'                                                  AR851784
     C                     PARM *BLANKS   @RTCD                                             AR851784
     C                     PARM '*KEY   ' @OPTN                                             AR851784
     C                     PARM SPCPY     @KEY1                                             AR851784
     C                     PARM *BLANKS   @KYST                                             AR851784
     C           SDCUST    PARM SDCUST    DSSDY                                             AR851784
     C           @RTCD     IFEQ *BLANKS                                                     AR851784
     C                     CALL 'AOBRCHR2'                                                  AR851784
     C                     PARM *BLANKS   @RTCD                                             AR851784
     C                     PARM '*KEY   ' @OPTN                                             AR851784
     C                     PARM BBBRCD    @DSNB                                             AR851784
     C           SDBRCE    PARM SDBRCE    DSSDY                                             AR851784
     C           @RTCD     IFEQ *BLANKS                                                     AR851784
     C                     MOVELSPCPY     SPCPY6                                           AR851784A
     C           SPCPY6    CHAINSDCUSQL0             99                                    AR851784A
     C           *IN99     IFEQ '0'                                                        AR851784A
     C**********           MOVE BXTAX     WCTAX                                   AR851784 AR851784A
     C                     MOVE CQTAX     WCTAX                                            AR851784A
     C                     ENDIF                                                           AR851784A
     C                     ENDIF                                                            AR851784
     C                     ENDIF                                                            AR851784
      *                                                                                     AR851784
      ** Default Stamp Tax Liable                                                           AR851784
      *                                                                                     AR851784
     C           WSTAX     IFEQ 'Y'                                                         AR851784
     C           WCTAX     ANDEQ'Y'                                                         AR851784
     C           ACTN      ANDEQ'I'                                                         AR880129
     C                     MOVE 'Y'       SPTAXL                                            AR851784
     C                     ENDIF                                                            AR851784
     C                     ENDIF                                                            AR851784
      *                                                                                     AR851784
     C                     ELSE                                                               CER049
     C                     CALL 'SD008141'                                                    CER049
     C                     PARM BJRDNB    U#DATE  50                                          CER049
     C                     PARM 'SECURITY'U#ORGN 10                                           CER049
     C                     PARM           ##TYPE  4                                           CER049
     C                     PARM           U#CTAX 138                                          CER049
     C                     PARM           U#MTAX 138                                          CER049
     C                     PARM           U#CCCY  3                                           CER049
     C                     PARM           U#MCCY  3                                           CER049
     C                     PARM           U#CSCC  2                                           CER049
     C                     PARM           U#MSCC  2                                           CER049
     C                     PARM           U#TXTY  1                                           CER049
     C                     PARM           SDSTPD                                              CER049
      *                                                                                       CER049
      ** If there is a default for the Module use this tax rate and ccy                       CER049
      ** otherwise use the ICD Control defaults.                                              CER049
      *                                                                                       CER049
     C           U#MTAX    IFNE *ZEROS                                                        CER049
     C                     Z-ADDU#MTAX    U#TAXR 138                                          CER049
     C                     MOVE U#MCCY    U#SCCY  3                                           CER049
     C                     MOVE U#MSCC    SPCHCD                                              CER049
     C                     ELSE                                                               CER049
     C                     Z-ADDU#CTAX    U#TAXR                                              CER049
     C                     MOVE U#CCCY    U#SCCY                                              CER049
     C                     MOVE U#CSCC    SPCHCD                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C                     MOVELPCHA      WTAXA  130                                          CER049
     C                     ADD  PCAM      WTAXA                                               CER049
     C                     MULT U#TAXR    WTAXA     H                                         CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
      ** Access stamp tax currency for decimal places                                         CER049
      *                                                                                       CER049
     C           WTAXA     IFNE *ZEROS                                                      AR880129
     C                     CALL 'AOCURRR0'                                                    CER049
     C                     PARM '*DBERR'  @RTCD                                               CER049
     C                     PARM '*KEY   ' @OPTN                                               CER049
     C                     PARM U#SCCY    @AJCD                                               CER049
     C           SDCURR    PARM SDCURR    DSSDY                                               CER049
      *                                                                                       CER049
     C                     Z-ADDA6NBDP    ZDECS                                               CER049
     C                     MOVE WTAXA     ZFLD15                                              CER049
     C                     MOVE ' '       ZECODE                                              CER049
     C                     EXSR ZSEDIT                                                        CER049
     C                     MOVEL*BLANKS   SPTAXA                                              CER049
     C                     MOVEL*BLANKS   SPCHAM                                              CER049
     C                     MOVE ZOUT21    SPTAXA                                              CER049
     C                     MOVE ZOUT21    SPCHAM                                              CER049
     C                     ENDIF                                                            AR880129
     C                     ENDSR                                                              CER049
      *****************************************************************                       CER049
      /EJECT                                                                                  CER049
      *****************************************************************                       CER049
      * Subroutine  :  SRSTMD                                         *                       CER049
      * Function    :  This subroutine will write/update records in   *                       CER049
      *                Stamp Tax Historic/Details (SDSTMDPD)          *                       CER049
      *****************************************************************                       CER049
      *                                                                                       CER049
     C           SRSTMD    BEGSR                                                              CER049
      *                                                                                       CER049
     C                     MOVE SPSEB     T2PBRC                                              CER049
     C                     MOVE SPSSH     T2PSSH                                              CER049
     C**********           MOVE SPCPY     T2PCPY                                    CER049 AR864714A
     C**********           MOVE SPDUD     T2PDUD                                    CER049 AR864714A
     C                     MOVELSPCPY     T2PCPY                                           AR864714A
     C                     MOVELSPDUD     ZDATE                                            AR864714A
     C                     EXSR ZDATE1                                                     AR864714A
     C                     Z-ADDZDAYNO    T2PDUD                                           AR864714A
     C                     MOVE SPEVT     T2PEVT                                              CER049
     C                     MOVEL'POSSET'  T2KEY                                               CER049
      *                                                                                       CER049
     C           KSTAMD    CHAINSDSTMDL0             85                                       CER049
      *                                                                                       CER049
      ** If record not found and taxable then write it                                        CER049
      *                                                                                       CER049
     C           *IN85     IFEQ *ON                                                           CER049
     C           SPTAXL    ANDEQ'Y'                                                           CER049
      *                                                                                       CER049
     C                     MOVE 'T'       T2RCTP                                              CER049
     C                     MOVE U#SCCY    T2SCCY                                              CER049
     C                     MOVE SPSCU     T2ECCY                                              CER049
     C                     MOVE 'Y'       T2TCAL                                              CER049
     C                     MOVE U#TAXR    T2TXRT                                              CER049
     C                     Z-ADDWTAXA     T2TATC                                              CER049
     C                     MOVE 'Y'       T2STFF                                              CER049
     C                     Z-ADDBJRDNB    T2LCD                                               CER049
     C                     MOVE 'I'       T2TYLC                                              CER049
     C           PCHA      ADD  PCAM      T2GROS                                           AR864714B
     C                     WRITE@STMDV0                                                       CER049
      *                                                                                       CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
      ** If record  found and taxable then update it                                          CER049
      *                                                                                       CER049
     C           *IN85     IFEQ *OFF                                                          CER049
     C           SPTAXL    ANDEQ'Y'                                                           CER049
      *                                                                                       CER049
     C                     MOVE 'P'       T2RCTP                                              CER049
     C                     MOVE U#SCCY    T2SCCY                                              CER049
     C                     MOVE SPSCU     T2ECCY                                              CER049
     C                     MOVE 'Y'       T2TCAL                                              CER049
     C                     MOVE U#TAXR    T2TXRT                                              CER049
     C                     Z-ADDWTAXA     T2TATC                                              CER049
     C                     MOVE 'Y'       T2STFF                                              CER049
     C                     MOVE 'A'       T2TYLC                                              CER049
     C           PCHA      ADD  PCAM      T2GROS                                           AR864714B
     C                     UPDAT@STMDV0                                                       CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
      ** If record found and non taxable then delete it                                       CER049
      *                                                                                       CER049
     C           *IN85     IFEQ *OFF                                                          CER049
     C           SPTAXL    ANDEQ'N'                                                           CER049
     C                     DELETSDSTMDL0                                                      CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C                     ENDSR                                                              CER049
      *****************************************************************                       CER049
      /EJECT                                                                                AR324886
      *****************************************************************                     AR324886
     C           PSAUDT    BEGSR                                                            AR324886
      *                                                                                     AR324886
     C                     CLEARDSAUTH                                                      AR324886
     C           PSAUTH    CHAINPSAUT                80                                     AR324886
      *                                                                                     AR324886
     C                     MOVE RECI      PARECI                                            AR324886
     C                     MOVE TNL1      PATNLU                                            AR324886
      *                                                                                     AR324886
     C           SACTN     IFEQ 'U'                                                         AR324886
     C                     MOVE USID      PAUUSR                                            AR324886
     C                     MOVE RUND      PALUD                                             AR324886
     C                     ENDIF                                                            AR324886
      *                                                                                     AR324886
     C           *IN80     IFEQ *ON                                                         AR324886
     C                     MOVE PBCA      PAPBCA                                            AR324886
     C                     MOVE PSSH      PAPSSH                                            AR324886
     C                     MOVE PCPY      PAPCPY                                            AR324886
     C                     MOVE PDUD      PAPDUD                                            AR324886
     C                     MOVE PEVT      PAPEVT                                            AR324886
     C                     MOVE PTFR      PAPTFR                                            AR324886
     C                     MOVE TXBS      PATXBS                                            AR324886
     C                     MOVE BNFO      PABNFO                                            AR324886
     C                     MOVE EXCD      PAEXCD                                            AR324886
     C                     MOVE USID      PALUSR                                            AR324886
     C                     MOVE RUND      PALCD                                             AR324886
     C                     MOVE SACTN     PALCTP                                            AR324886
     C                     WRITEPSAUTDF                                                     AR324886
      *                                                                                     AR324886
     C                     ELSE                                                             AR324886
     C           SACTN     IFNE 'A'                                                         AR324886
     C           SACTN     OREQ 'A'                                                         AR324886
     C           PALCTP    ANDNE'A'                                                         AR324886
     C           SACTN     OREQ 'A'                                                         AR324886
     C           PALCTP    ANDEQ'A'                                                         AR324886
     C           USID      ANDNEPALUSR                                                      AR324886
     C                     MOVE PALUSR    PAPUSR                                            AR324886
     C                     MOVE PALCD     PAPCD                                             AR324886
     C                     MOVE PALCTP    PAPCTP                                            AR324886
     C                     ENDIF                                                            AR324886
     C                     MOVE USID      PALUSR                                            AR324886
     C                     MOVE RUND      PALCD                                             AR324886
     C                     MOVE SACTN     PALCTP                                            AR324886
     C                     UPDATPSAUTDF                                                     AR324886
      *                                                                                     AR324886
     C                     ENDIF                                                            AR324886
      *                                                                                     AR324886
     C                     ENDSR                                                            AR324886
      *****************************************************************                     AR324886
      /EJECT
     C/COPY WNCPYSRC,SE0170C035
     C/COPY ZSRSRC,ZSDESCZ3                                               CSE016
      ***
      * /104633/ CHANGE
      *INF,7  DELETION F3:F10 to delete this record:F12:Rollup:Rolldown:Help
      *INF,10 F10 is required
      *INF,11 F10 is not required
      *INF,13 REVERSAL F3:F10 to revert:F12:Help
      *INF,14 F12 is not possible
**  CPY@
(c) Finastra International Limited 2001
** CRW                                                                                        CSD015
<Settlement account>                                                                          CSD015
</Settlement account>                                                                         CSD015
<Counterparty bank>                                                                           CSD015
</Counterparty bank>                                                                          CSD015
<For account of>                                                                              CSD015
</For account of>                                                                             CSD015
** INF REMOVED Rollup & Rolldown from Insert, Ammend, Delete , & Auth.    E20237
 Enter:Action Code I,A,D,E,R,Y and selection:Review from point:F3:Help
 Enter:Review from point:Action Code A,D,E,R,Y:F3:F12:Rollup:Rolldown:Help
 INSERTION Enter:F3:F12:Help
 AMENDMENT Enter:F3:F12:Help
 AUTHORISATION Enter:F3:F12:Help
 ENQUIRY Enter:F3:F12:Rollup:Rolldown:Help
 DELETION F3:F10=Delete record:F12:Help
 Rollup is not possible
 Rolldown is not possible
 F10=Confirm

 Record has been updated by another workstation
 REVERSAL F3:F10=Revert:F12:Help
 F12=Not possible
 UNAUTHORISATION Enter:F3:F12:Help                                                          AR324886
 Enter:Action Code I,A,D,E,R,Y,U and selection:Review from point:F3:Help                    AR324886
 Enter:Review from point:Action Code A,D,E,R,Y,U:F3:F12:Rollup:Rolldown:Help                AR324886
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   UPA   -  Valid codeword characters                                   S01412
ABCDEFGHIJKLMNOPQRSTUVWXYZ/
**   APN   -  Valid uppercase alphabetic characters and numeric digits                        CSW201
ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789/                                                         CSW201
**   SWCH  -  Valid SWIFT ISO fromat characters                           S01412
ABCDEFGHIJKLMNOPQRSTUVWXYZ 1234567890/-?:().,'+
**  POWER - Array of powers for currency conversion                       055839
0000001
0000010
0000100
0001000
0010000
0100000
1000000
** AP - Array of powers of 10.                                            CAC002
0000000001                                                                CAC002
0000000010                                                                CAC002
0000000100                                                                CAC002
0000001000                                                                CAC002
0000010000                                                                CAC002
0000100000                                                                CAC002
0001000000                                                                CAC002
0010000000                                                                CAC002
0100000000                                                                CAC002
1000000000                                                                CAC002
