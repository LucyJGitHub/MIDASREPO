000100200529     H        1
000110200529      *****************************************************************
000120200529/*STD *  RPGBASE                                                      *
000130200529/*EXI *  TEXT('Midas SE Position settlements input')                  *
000140200529/**** ***OVRDBF*FILE(POSETX)*TOFILE(SEPOSTL0)*SHARE(*NO)***********S01496 084981
000150200529/**** ***OVRDBF*FILE(POSETX)*TOFILE(POSET)*SHARE(*NO)**************084981 186055
000160200529/*XBIA*  OVRDBF FILE(POSETX) TOFILE(POSET7) SHARE(*NO)                *   186055
000170200529      *****************************************************************
000180200529      *                                                               *
000190200529      *  Midas - Securities Trading Module                            *
000200200529      *                                                               *
000210200529      *  SE0170  - POSITION SETTLEMENTS INPUT                         *
000220200529      *                                                               *
000230200529      *  Function:  This program allows the maintenance and           *
000240200529      *   (I/C)     authorisation of system-generated settlements,    *
000250200529      *             and the input of user-generated settlements.      *
000260200529      *                                                               *
000270200529      *  Called By: SEC02 - Input Cycle Processing                    *
000280200529      *                                                               *
000290200529      *  (c) Finastra International Limited 2001                      *
000300200529      *                                                               *
000310200604      *  Last Amend No. AR996802           Date 22May20               *
000320200604      *  PREV Amend No. AR706573           Date 22May20               *
000330200604      *                 AR568653           Date 22May20               *
000340200604      *                 AR586601           Date 22May20               *
000350200604      *                 AR324886           Date 22May20               *
000360200604      *                 264059             Date 22May20               *
000370200604      *                 250115             Date 22May20               *
000380200604      *                 249578             Date 22May20               *
000390200604      *                 MD046248           Date 27Oct17               *
000400200602      *                 MD043182           Date 08Apr20               *
000410200602      *                 HUT111             Date 08Apr20               *
000420200529      *                 AR1095995          Date 08Apr13               *
000430200529      *                 AR1095995          Date 18Mar13               *
000440200529      *                 CLE148             Date 23Jul12               *
000450200529      *                 AR888911           Date 26Jan12               *
000460200529      *                 AR864714B          Date 28Mar12               *
000470200529      *                 AR875302A          Date 27Jan12               *
000480200529      *                 AR864714A          Date 04Jan12               *
000490200529      *                 AR879983           Date 21Dec11               *
000500200529      *                 AR880129           Date 15Dec11               *
000510200529      *                 AR875922           Date 07Dec11               *
000520200529      *                 AR875296           Date 06Dec11               *
000530200529      *                 AR851880           Date 15Nov11               *
000540200529      *                 AR851833           Date 10Nov11               *
000550200529      *                 AR851784A          Date 10Nov11               *
000560200529      *                 AR853257           Date 04Nov11               *
000570200529      *                 AR851784           Date 07Nov11               *
000580200529      *                 CER049             Date 06Dec10               *
000590200529      *                 AR584789           Date 28Jul10               *
000600200529      *                 CSW210             Date 04May10               *
000610200529      * Bank Fusion Midas 1.4 Base -----------------------------------*
000620200529      * Midas Plus 1.4 Base 04 ---------------------------------------*
000630200529      *                 247951             Date 27May07               *
000640200529      *                 247333             Date 30Apr07               *
000650200529      * Midas Plus 1.4 Base ------------------------------------------*
000660200529      *                 CSD079             Date 05Feb07               *
000670200529      * Midas Plus 1.3 ----------- Base ------------------------------*
000680200529      *                 BUG12729           Date 20Nov06               *
000690200529      *                 BUG11688           Date 11Jul06               *
000700200529      *                 CSD031             Date 10Apr06               *
000710200529      *                 CSD027             Date 09Dec05               *
000720200529      *                 234471             Date 27Jun05               *
000730200529      *                 235250             Date 01Aug05               *
000740200529      *                 234080             Date 10Jun05               *
000750200529      *                 234140             Date 17May05               *
000760200529      *                 233711             Date 25May05               *
000770200529      *                 CSE071             Date 19Jul05               *
000780200529      *                 CAS010             Date 09Feb05               *
000790200529      *                 222756             Date 21Nov03               *
000800200529      *                 220952             Date 09Oct03               *
000810200529      *                 218520             Date 04Jun03               *
000820200529      *                 217551             DATE 25APR03               *
000830200529      *                 CSW037A            Date 02May05               *
000840200529      *                 CSD025             Date 11Jan05               *
000850200529      *                 CSW037             Date 15Dec04               *
000860200529      *                 CSW036             Date 15Dec04               *
000870200529      *                 BUG3122            Date 17Jul04               *
000880200529      *                 CLE025             Date 20Oct03               *
000890200529      *                 BUG1992            Date 23Apr04               *
000900200529      *                 CRE020             Date 20Jan04               *
000910200529      *                 CGP001             Date 18Dec03               *
000920200529      *                 CGL029             Date 01Sep03               *
000930200529      *                 212767             Date 20Jun03               *
000940200529      *                 211749             Date 13Jun03               *
000950200529      *                 220465             Date 13Aug03               *
000960200529      *                 212522             Date 13Aug03               *
000970200529      *                 208241             Date 21Aug02               *
000980200529      *                 CSD015             Date 14Oct02               *
000990200529      * Midas Release 4.01.03 ----------------------------------------*
001000200529      *                 206844             Date 10Jan03               *
001010200529      *                 206987             Date 09Oct02               *
001020200529      * Midas Release 4.01.02 ----------------------------------------*
001030200529      *                 197896             Date 25Jun02               *
001040200529      *                 191232             Date 20May02               *
001050200529      *                 198729             Date 16Apr02               *
001060200529      *                 203678             Date 24Apr02               *
001070200529      * Midas Release 4.01 -------------------------------------------*
001080200529      *                 CSE034             Date 08Apr02               *
001090200529      *                 179359             Date 15Jan02               *
001100200529      *                 191161             Date 30Nov01               *
001110200529      *                 169067             Date 14Sep01               *
001120200529      * Midas Release 4 --------------- Base -------------------------*
001130200529      *                 CSE028             Date 06Jun01               *
001140200529      *                 CSW201             Date 02May01               *
001150200529      *                 CSE016             Date 10Jan01               *
001160200529      * Midas DBA 3.05 -----------------------------------------------*
001170200529      *                 186400             Date 07Mar01               *
001180200529      *                 173501             Date 28Feb01               *
001190200529      *                 120815             Date 26Jan01               *
001200200529      *                 188588             Date 02Jan01               *
001210200529      *                 187591             Date 28Dec00               *
001220200529      * Midas DBA 3.04 -----------------------------------------------*
001230200529      *                 186166             Date 10Nov00               *
001240200529      *                 186000             Date 09Nov00               *
001250200529      *                 186055             Date 06Nov00               *
001260200529      *                 185811             Date 02Nov00               *
001270200529      *                 185397             Date 24Oct00               *
001280200529      *                 CSE023             Date 12Jul00               *
001290200529      * Midas DBA 3.03 -----------------------------------------------*
001300200529      *                 178530             Date 26May00               *
001310200529      *                 174342             Date 03May00               *
001320200529      * Midas DBA 3.02 -----------------------------------------------*
001330200529      *                 157808             Date 14Feb00               *
001340200529      *                 CPB001             DATE 16Aug99               *
001350200529      * Midas DBA 3.01 -----------------------------------------------*
001360200529      *                 CSE010             Date 21Jun99               *
001370200529      *                 CGL007             Date 26Mar99               *
001380200529      * Midas DBA 3.00 ---------------- Base -------------------------*
001390200529      *                 141869             Date 27Apr99               *
001400200529      *                 130059             Date 12Oct98               *
001410200529      *                 151506             Date 29Dec98               *
001420200529      *                 143690             Date 05Oct98               *
001430200529      *                 CEU017             Date 03Apr98               *
001440200529      *                 CSE007             DATE 03Apr98               *
001450200529      *                 CEU005             DATE 05FEB98               *
001460200529      *                 118340             DATE 24Feb98               *
001470200529      *                 100604             DATE 05Feb98               *
001480200529      *                 095550             DATE 18MAR97               *
001490200529      *                 CSE003             DATE 11OCT96               *
001500200529      *                 103634             DATE 31DEC96               *
001510200529      *                 103056             DATE 31DEC96               *
001520200529      *                 102777             DATE 31DEC96               *
001530200529      *                 099270             DATE 30DEC96               *
001540200529      *                 S01408             DATE 22NOV96               *
001550200529      *                 CAC002             DATE 15SEP96               *
001560200529      *                 104633             DATE 07NOV96               *
001570200529      *                 S01408             DATE 26SEP96               *
001580200529      *                 108001             DATE 17SEP96               *
001590200529      *                 099267             DATE 22AUG96               *
001600200529      *                 105034             DATE 06AUG96               *
001610200529      *                 CSW096             DATE 03JUN96               *
001620200529      *                 CSW003             DATE 23APR96               *
001630200529      *                 076975             DATE 07MAY96               *
001640200529      *                 S01408             DATE 29APR96               *
001650200529      *                 S01408             DATE 17JAN96               *
001660200529      *                 087651             DATE 25OCT95               *
001670200529      *                 086722             DATE 24OCT95               *
001680200529      *                 088976             DATE 05SEP95               *
001690200529      *                 087178             DATE 15JUN95               *
001700200529      *                 084981             DATE 07JUN95               *
001710200529      *                 082738             DATE 12MAR95               *
001720200529      *                 S01408             DATE 11APR95               *
001730200529      *                 080050             DATE 26JAN95               *
001740200529      *                 S01408             DATE 17JAN95               *
001750200529      *                 S01496             DATE 08JUL94               *
001760200529      *                 S01486             DATE 07JUL94               *
001770200529      *                 080356             DATE 15DEC94               *
001780200529      *                 075920             DATE 13SEP94               *
001790200529      *                 S01512             DATE 10AUG94               *
001800200529      *                 S01509             DATE 10AUG94               *
001810200529      *                 068993             DATE 14OCT94               *
001820200529      *                 066716             DATE 08FEB94               *
001830200529      *                 063994             DATE 23DEC93               *
001840200529      *                 052254             DATE 24NOV93               *
001850200529      *                 051475             DATE 24NOV93               *
001860200529      *                 055839             DATE 15NOV93               *
001870200529      *                 S01446             DATE 04NOV93               *
001880200529      *                 S01447             DATE 11OCT93               *
001890200529      *                 S01401             DATE 16JUN93               *
001900200529      *                 S01412             DATE 27MAY93               *
001910200529      *                 047225             DATE 22MAR93               *
001920200529      *                 S01397             DATE 10SEP92               *
001930200529      *                 E37157             DATE 18MAR92               *
001940200529      *                 E37205             DATE 18MAR92               *
001950200529      *                 E37165             DATE 18MAR92               *
001960200529      *                 E37159             DATE 18MAR92               *
001970200529      *                 E37158             DATE 18MAR92               *
001980200529      *                 E31432             DATE 12DEC91               *
001990200529      *                 E30740             DATE 12DEC91               *
002000200529      *                 E28805             DATE 12DEC91               *
002010200529      *                 E24426             DATE 24JAN90               *
002020200529      *                 S01117             DATE 06NOV90               *
002030200529      *                 S01195             DATE 06NOV90               *
002040200529      *                 S01220             DATE 07AUG90               *
002050200529      *                 S01269             DATE 01AUG90               *
002060200529      *                 E23955             DATE 25OCT90               *
002070200529      *                 E23408             DATE 06SEP90               *
002080200529      *                 E23192             DATE 07AUG90               *
002090200529      *                 E21590             DATE 09APR90               *
002100200529      *                 E21493             DATE 09APR90               *
002110200529      *                 E20651             DATE 10JAN90               *
002120200529      *                 E20237             DATE 24NOV89               *
002130200529      *                 E19438             DATE 10NOV89               *
002140200529      *                 S01199             DATE 14SEP89               *
002150200529      *                 S01154             DATE 17/03/89              *
002160200529      *                 E18884             DATE 17/07/89              *
002170200529      *                 E18102             DATE 10/07/89              *
002180200529      *                 E17793             DATE 26/06/89              *
002190200529      *                 E17423             DATE 22/05/89              *
002200200529      *                 E18193             DATE 05/05/89              *
002210200529      *                 E17178             DATE 05/05/89              *
002220200529      *                 E16084             DATE 05/05/89              *
002230200529      *                 E17175             DATE 14/04/89              *
002240200529      *                 E16843             DATE 16/03/89              *
002250200529      *                 E17211             DATE 16/03/89              *
002260200529      *                 S01179             DATE 21/10/88              *
002270200529      *                 S01176             DATE 08/11/88              *
002280200529      *                 S01169             DATE 08/11/88              *
002290200529      *                 E14878             DATE 28/10/88              *
002300200529      *                 E14214             DATE 28/09/88              *
002310200529      *                 E14881             DATE 16/09/88              *
002320200529      *                 E14882             DATE 16/09/88              *
002330200529      *                 E14884             DATE 08/09/88              *
002340200529      *                 E14717             DATE 26/08/88              *
002350200529      *                 E14712             DATE 17/08/88              *
002360200529      *                 E14438             DATE 27/07/88              *
002370200529      *                 E13952             DATE 26/07/88              *
002380200529      *                 S01158             DATE 06/05/88              *
002390200529      *                                                               *
002400200529      *---------------------------------------------------------------*
002410200529      *                                                               *
002420200529      *  AR996802 - Error 996 encountered when authorising Position   *
002430200529      *             Settlement even if it is not yet authorised.      *
002440200529      *             Add PTFR in POSETK during CHAIN in POSET.         *
002450200529      *             (Child: AR996804).                                *
002460200529      *  AR706573 - Position settlement records can be seen by        *
002470200529      *             un-authorised users. Change checking of *IN81 from*
002480200529      *             'Y' to '1' to process the branch/user validation. *
002490200529      *             (Child: AR706574)                                 *
002500200529      *  AR568653 - Same user can Reverse and Authorise, Matured      *
002510200529      *             position settlements. Additional fix for          *
002520200529      *             AR324886.                                         *
002530200529      *  AR586601 - Unable to allocate a record in PSAUT. Fix is to   *
002540200529      *             put 'N' in position 53 of CHAIN opcode used only  *
002550200529      *             for validation and not update.                    *
002560200529      *  AR324886 - Implement 4-eyes processing in Position           *
002570200529      *             Settlement Maintenance.                           *
002580200529      *  264059 - Position Settlements maintenance displays duplicate *
002590200529      *           records.                                            *
002600200529      *           Set AID to 'UP' when pagedown key is pressed and    *
002610200529      *           *IN03 is off.                                       *
002620200529      *  250115 - Restore fix 220952 and reposition endif line of     *
002630200529      *           fix 249578.                                         *
002640200529      *         - Reversal of the original projected account movement *
002650200529      *           should be done when an authorized position          *
002660200529      *           settlement is amended. Applied fix 234985.          *
002670200529      *  249578 - Position settlements.                               *
002680200529      *  MD046248 - Finastra Rebranding                               *
002690200529      *  AR1095995C - Generate projected movement when authorising    *
002700200529      *               position settlements with no amendments during  *
002710200529      *               the day                                         *
002720200529      *  AR1095995A - Generate only 1 projected movement when amending*
002730200529      *               system generated position settlements           *
002740200602      *  MD043182 - Inconsistency in Block Dr/Cr indicator for POST   *
002750200602      *  HUT111 - Corporate Action Blocked Credit Account             *
002760200602      *           (Upgrade HUT024 to FM2.1 SP22)                      *
002770200602      *           (Include MD-43182)                                  *
002780200602      *           Amendment of core hook SE0170FFP1                   *
002790200602      *           Amendment of core hook SE0170CCP5                   *
002800200602      *           Addition of hooks: HUT111_001 to _008               *
002810200529      *  CLE148 - Alpha Loan Reference (Recompile)                    *
002820200529      *  AR888911 - In reversing a deal, REV column in Stamp Tax      *
002830200529      *             Movements Enquiry is not changing from N to Y     *
002840200529      *             (Recompile)                                       *
002850200529      *           - Applied for AR944923                              *
002860200529      *  AR864714B - No movement is posted in Stamp Tax Movement      *
002870200529      *              enquiry for POST. Populate gross amount.         *
002880200529      *            - Applied for AR942839                             *
002890200529      *  AR875302A - Stamp Tax amount should be blanks if liable      *
002900200529      *              flag is 'N'                                      *
002910200529      *  AR864714A - No movement is posted in Stamp Tax Movement      *
002920200529      *              enquiry for Position Settlements                 *
002930200529      *  AR879983 - Add stamp tax exchange rate (Recompile)           *
002940200529      *  AR880129 - Stamp tax flag was changed and stamp tax charge   *
002950200529      *             code is defaulted during enquire and authorise    *
002960200529      *  AR875922 - 101 error code appears when action code Y and A   *
002970200529      *             is entered                                        *
002980200529      *  AR875296 - Security Charge Code is missing in Position       *
002990200529      *             Settlement generated from coupon payment.         *
003000200529      *  AR851880 - Stamp tax liable ind cannot be changed from N to Y*
003010200529      *  AR851833 - Stamp tax amount is excluded in the computation   *
003020200529      *  AR851784A - Stamp tax liable is defaulted to N eventhough the*
003030200529      *             customer and branch stamp tax (Reopen)            *
003040200529      *  AR853257 - Account Keys for FT were not generated            *
003050200529      *             (Recompile)                                       *
003060200529      *  AR851784 - Stamp tax liable is defaulted to N eventhough the *
003070200529      *             customer and branch stamp tax                     *
003080200529      *  CER049 - Stamp Tax                                           *
003090200529      *  AR584789 - DBERRCTL was encountered. Applied fix 235180 and  *
003100200529      *             214835.                                           *
003110200529      *  235180 - DBASE error when CP input                           *
003120200529      *           Change fix 157808 to ensure settlement ccy defaulted*
003130200529      *           in all cases (eg S01509 off and CEU005 on)          *
003140200529      *           Also apply 214835                                   *
003150200529      *  214835 - If settlement ccy is amended to blank database error*
003160200529      *  CSW210 - SWIFT 2010 Changes (Recompile)                      *
003170200529      *  247951 - Multiple entries are generated in Projected Account *
003180200529      *           Movements if position settlement is authorised more *
003190200529      *           than once. Reversed core fixes 100604 and 220952.   *
003200200529      *         - Initialise fields PSEQ and DAMT.                    *
003210200529      *         - Correct processing to retrieve the correct record   *
003220200529      *           in file when features CSE023, Portfolio Management  *
003230200529      *           and Private Banking modules are OFF.                *
003240200529      *  247333 - If action amend, delete or authorise (A, D, or Y)   *
003250200529      *           is performed to an authorised position settlement,  *
003260200529      *           do not switch action to Enquiry mode.               *
003270200529      *  CSD079 - Enhanced Customer Maintenance API (Recompile)       *
003280200529      *  BUG12729 - Existing position settlement cannot be accessed   *
003290200529      *             using the key screen                              *
003300200529      *  BUG11688 - Pass customer number to SE1817, in case shortname *
003310200529      *             was input to screen.                              *
003320200529      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
003330200529      *  CSD027 - Conversion Of Customer Number to Alpha              *
003340200529      *  234471 - Program does not update settlement amount when the  *
003350200529      *           tax amount is changed.                              *
003360200529      *  235250 - To enable the tax amount amendment                  *
003370200529      *  234080 - No EU Tax field displayed in insert mode.           *
003380200529      *  234140 - EU witholding tax (recompile)                       *
003390200529      *  233711 - Allow user to update tax amount for the position    *
003400200529      *           settlement.                                         *
003410200529      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
003420200529      *  CAS010 - IAS + PB Enhancements Upgrade to MidasPlus.         *
003430200529      *  222756 - Error message 701 if the customer has no record in  *
003440200529      *           withholding tax details. Change this to a warning   *
003450200529      *           message (W04) and use the default tax basket for no *
003460200529      *           documentation in this case.                         *
003470200529      *  220952 - No postings after amendment/authorisation of        *
003480200529      *           position settlements. Amend pgm to have online      *
003490200529      *           updates if action is 'Y' or on an authorised record *
003500200529      *           Applied fix 197959 partially.                       *
003510200529      *  218520 - Amended position settlement does not require        *
003520200529      *           re-authorisation. Fix is to re-set indicator if     *
003530200529      *           amended. Applied fix 202792.                        *
003540200529      *  217551 - AVOID ERROR CODE 101 IF CUSTOMER REQUESTED FOR      *
003550200529      *           CLOSURE, SO STILL LIVE.                             *
003560200529      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
003570200529      *  CSD025 - Customer De-Activation                              *
003580200529      *  CSW037 - Additional Field Data on MT300/MT320                *
003590200529      *  CSW036 - Dual SWIFT BIC held on Client Details               *
003600200529      *  BUG3122 - Recompiled due to changes in SDSECSPD.             *
003610200529      *  CLE025 - Credit Lines (Recompile)                            *
003620200529      *  BUG1992 - Webfacing Changes. Screens are not being displayed.*
003630200529      *  CRE020 - Midas Plus Online Printing of Advices (GE7)         *
003640200529      *  CGP001 - Global Processing (Recompile)                       *
003650200529      *  CGL029 - Increase Account Code to 10 digits                  *
003660200529      *  212767 - Cannot insert successive records in position        *
003670200529      *           settlement maintainance. TNL1 initialized to 0      *
003680200529      *           upon every insert.                                  *
003690200529      *  211749 - Unprotect all fields when at least one is in error  *
003700200529      *           to allow correction on that field.                  *
003710200529      *  220465 - Able to leave 1st screen just by pressing enter even*
003720200529      *           if there are pending errors.  Fix is to make sure   *
003730200529      *           that SCRMSG is not blanked out if there are still   *
003740200529      *           errors.                                             *
003750200529      *  212522 - Error code '101' appears on enquire, amend, delete  *
003760200529      *           reverse and authorise of a position settlement from *
003770200529      *           subfile if it has same key preceeding it. Fix is to *
003780200529      *           disregard loop with sequence if CSE023 is on.       *
003790200529      *  208241 - Recompiled over changed /CPY ZSDESCZ3.              *
003800200529      *  CSD015 - Midas Compliance Watch - Watch List Checking        *
003810200529      *  206844 - Allow selection of records on subfile processing.   *
003820200529      *  206987 - Cursor wrongly positioned.                          *
003830200529      *  197896 - Not able to overwrite Exchange Rate. Fix is to use  *
003840200529      *           defaults only if user did not overwrite Exch Rate.  *
003850200529      *  191232 - DBerror 09 in BLC0643, pgm BL0643 in file SDNOSTPD. *
003860200529      *           Validation of nostro number reviewed.  Applied fix  *
003870200529      *           179182.                                             *
003880200529      *  198729 - Possible to use nostro settlement method even when  *
003890200529      *           the account is a retail account.  Checked account   *
003900200529      *           type if retail or retail nostro before allowing     *
003910200529      *           insertion/changes.                                  *
003920200529      *  203678 - Delete not possible. Use the right key to access    *
003930200529      *           the file. Apply improvements to 169067.             *
003940200529      *  CSE034 - Standard Settlement Instruction improvements        *
003950200529      *  179359 - Not possible to insert dividend position settle-    *
003960200529      *           ments and dividend diary events for securities      *
003970200529      *           with processing type '7'.                           *
003980200529      *  191161 - Reversal of Corporate Action did not generate       *
003990200529      *           a reversal of the position settlement. Fix is to    *
004000200529      *           ensure that position settlement generated via       *
004010200529      *           corporate action is reversed successfully when      *
004020200529      *           reversing the involved Corporate Action reference.  *
004030200529      *  169067 - Delete not possible - Use the right key to access   *
004040200529      *           the file POSETD.                                    *
004050200529      *  CSE028 - Standing Settlement Instructions Enhancement.       *
004060200529      *  CSW201 - SWIFT 2001 Standards Update                         *
004070200529      *  CSE016 - Extended Security Descriptions                      *
004080200529      *  186400 - For reversal of post. settlement, action code 'R',  *
004090200529      *           system reverts action to action code 'E'.  Applied  *
004100200529      *           fix 136880, 141770 and 146282 to correct treatment  *
004110200529      *           of reversal for position settlement.                *
004120200529      *         - Include option 'R' in first two entries in array    *
004130200529      *  173501 - The settlement method, curency and account are not  *
004140200529      *           amendable.                                          *
004150200529      *  120815 - Unable to authorise position settlement because     *
004160200529      *           of error code 602                                   *
004170200529      *  188588 - WFREEM field not initialised correctly              *
004180200529      *  187591 - Remove exemption code from Review screen            *
004190200529      *           (Recompiled due to changes in SE0170DF)             *
004200200529      *  186166 - Protect tax field for amend if CSE023 is ON and     *
004210200529      *           allow user input for maturity event.                *
004220200529      *  186000 - Tax Identification Number needs to be added to      *
004230200529      *           Customer Withholding Tax Details                    *
004240200529      *  186055 - All sort of errors are being encountered in         *
004250200529      *           Position Settlement Maintenace                      *
004260200529      *  185811 - Set up default tax basket for manual position       *
004270200529      *           settlement                                          *
004280200529      *  185397 - Problem with MG0565 for manually insert and delete  *
004290200529      *           of position settlement.                             *
004300200529      *  CSE023 - Treaty Withholding Tax                              *
004310200529      *  178530 - For Settlement method 14 check whether Account      *
004320200529      *           Currency is the same as Settlement Currency (159545)*
004330200529      *         - Closed account is accepted and causes FOOB in CoB   *
004340200529      *           due to Reci = 'C' in  POSETD (161703).              *
004350200529      *  174342 - Charge code/Commissions code update to blank not    *
004360200529      *           properly done.                                      *
004370200529      *  157808 - DBASE error when CP input                           *
004380200529      *  CPB001 - 'Private Banking' Module                            *
004390200529      *  CSE010 - SE Transactions Enhancements                        *
004400200529      *  CGL007 - Account Postings Enquiry.                           *
004410200529      *  141869 - Subfile doesn't show the correct contents of the    *
004420200529      *           record when an action is done (amendment, deletion, *
004430200529      *           or etc.) in the position setlement.  Need to rebuild*
004440200529      *           subfile in this case. Applied part of fix 108347.   *
004450200529      *  130059 - Amendment and Authorisation of Position Settlements *
004460200529      *           ignored.  Reset TNL1 in SR/INITRC only if ACTN='I'. *
004470200529      *           Assign 9997 to PTFR when SPPTFR is not blanks.      *
004480200529      *  151506 - Problem when Settlement currency  is changed to EUR:*
004490200529      *           Correct exchange rate is not defaulted when settle- *
004500200529      *           ment ccy is amended.  Recalculate base ccy rate,    *
004510200529      *           exchange rate/MD Ind., and settlement amount if     *
004520200529      *           settlement ccy is not EUR and 'IN' ccy and rundate  *
004530200529      *           is not later than EMU transition period, otherwise, *
004540200529      *           exchange rate should default to the EURO exchange   *
004550200529      *           rate in SDCURRPD.                                   *
004560200529      *           And amend the calculation of EXCHG.RATE and SETTL AM*
004570200529      *           in conjonction with 143690.                         *
004580200529      *  143690 - Incorrect Mult/Div Ind. was being used when EURO    *
004590200529      *           CCY was involved. Fix is to reverse the M/D ind. if *
004600200529      *           Nominal CCY is equal to the EURO CCY.               *
004610200529      *  CEU017 - Securities Redenomination Euro Changes              *
004620200529      *  CSE007 - Corporate Actions                                   *
004630200529      *  CEU005 - EMU SE Settlement Ccy Conversion.                   *
004640200529      *  118340 - Update immediatly trailer (POSETA) after Amending   *
004650200529      *           a record in POSETD to avoid problem of double access*
004660200529      *           by two different jobs.                              *
004670200529      *  100604 - Do not do updates to on-line positions files unless *
004680200529      *           action code is 'Y' or Due Date is today.            *
004690200529      *  095550 - When more than one selection, the information is    *
004700200529      *           incorrect.                                          *
004710200529      *  CSE003 - '?' processing for security shortname.              *
004720200529      *  103634 - Always output the settlement amount as it is used   *
004730200529      *           in SE2300.                                          *
004740200529      *  103056 - WHEN AN ACTION IS NOT PROCESSED (F12), RESET ACTION *
004750200529      *           TYPE TO BLANK                                       *
004760200529      *  102777 - WHEN AMEND OF THE SETTLEMENT CURRENCY, UPDATE FILE  *
004770200529      *           WITH THE CALCULATED SETTLEMENT AMOUNT OTHERWISE     *
004780200529      *           PROGRAM AOOUPSU0 ACCESS ACCNTAB WITH THE NOMINAL CCY*
004790200529      *           WHICH DOES NOT ALWAYS EXISTS AND PRODUCES A DB ERROR*
004800200529      *  099270 - WHEN CHANGE OF VALUE DATE, AMEND SCREEN VALUE       *
004810200529      *           IN THE SUBFILE                                      *
004820200529      *  S01408 - Addition of Core Hook SE0170CP13                    *
004830200529      *  CAC002 - Profit Centre Accounting Development - Phase 2      *
004840200529      *           If analytical accounting is installed, the tax amt  *
004850200529      *           deducted at source, refundable and by user fields   *
004860200529      *           will be repositioned to make room for new fields,   *
004870200529      *           Margin Points and Amount.                           *
004880200529      *  104633 - GUI Amendments to DSPF with non-standard footers    *
004890200529      *  S01408 - Addition of Core Hook SE0170FFP1                    *
004900200529      *           Addition of Core Hook SE0170CP12                    *
004910200529      *           Addition of Core Hook SE0170CP11                    *
004920200529      *           Addition of Core Hook SE0170CP10                    *
004930200529      *           Addition of Core Hook SE0170CCP9                    *
004940200529      *           Addition of Core Hook SE0170CCP8                    *
004950200529      *           Addition of Core Hook SE0170CCP7                    *
004960200529      *           Addition of Core Hook SE0170CCP6                    *
004970200529      *           Addition of Core Hook SE0170CCP5                    *
004980200529      *  108001 - Two errors in input processing:                     *
004990200529      *           i) When try and insert more than one record in one  *
005000200529      *           call of SE0170, DB error occurs.                    *
005010200529      *           ii) When call REVIEW screen followed by insert, the *
005020200529      *           same DB error occurs.                               *
005030200529      *           Problems due to field TNLU which has been renamed   *
005040200529      *           to TNL1 for Portfolio Management upgrade (S01486).  *
005050200529      *           The new field is not cleared in SR INITRC as it     *
005060200529      *           should be before each insert.                       *
005070200529      *  099267 - COMPLETE 084981 : IF SELECTION ON MORE THAN 1 REC   *
005080200529      *           THE FIELD DELT IS SETTED DEPENDING ON THE PREVIOUS  *
005090200529      *           RECORD                                              *
005100200529      *  105034 - Correctly verify nostro number when amending sett.  *
005110200529      *           account for settlement methods 01,02,07,08 and 12,  *
005120200529      *           else changes not accepted. AOOUPSU0 also amended.   *
005130200529      *  CSW096 - Swift Changes 1996:                                 *
005140200529      *           Add validation for field 72.                        *
005150200529      *  CSW003 - MT5xx Message Generation - Phase 2                  *
005160200529      *  076975 - For warning 'W02', verify payment/value date        *
005170200529      *           and not event date :                                *
005180200529      *           If S01512 is active, check for the position         *
005190200529      *           settlement value date rather than the due date      *
005200200529      *  S01408 - Core Hook SE0170IIP2 Added                          *
005210200529      *         - Core Hook SE0170CCP3 Added                          *
005220200529      *         - Core Hook SE0170CCP4 Added                          *
005230200529      *  S01408 - Core Hook SE0170IIP1 Added                          *
005240200529      *         - Core Hook SE0170CCP1 Added                          *
005250200529      *         - Core Hook SE0170CCP2 Added                          *
005260200529      *  087651 - Settlement branch does not have to equal booking    *
005270200529      *           branch for sett. type 15 - change validation.       *
005280200529      *         - If Settlement Branch is blank, default to booking   *
005290200529      *           branch.                                             *
005300200529      *  086722 - Always display the settlement amount                *
005310200529      *  088976 - Live / All not conditioned correctly                *
005320200529      *  087178 - Settlement amount has to include taxes added to or  *
005330200529      *           subtracted from it                                  *
005340200529      *  084981 - Allow more than 1 selection in the subfile          *
005350200529      *  082738 - Rewrite of projected account movements.             *
005360200529      *  S01408 - ADDITION OF CORE HOOK SE0170IIPG                    *
005370200529      *           ADDITION OF CORE HOOK SE0170CVS4                    *
005380200529      *           ADDITION OF CORE HOOK SE0170CVS5                    *
005390200529      *           ADDITION OF CORE HOOK SE0170CVSF                    *
005400200529      *  080050 - Narrative code on RSACMTPD changed to alphanumeric  *
005410200529      *  S01408 - ADDITION OF CORE HOOK SE0170CCPG                    *
005420200529      *           ADDITION OF CORE HOOK SE0170CVS1                    *
005430200529      *           ADDITION OF CORE HOOK SE0170CVS2                    *
005440200529      *           ADDITION OF CORE HOOK SE0170CVS3                    *
005450200529      *  S01496  -  INCORPORATION OF JYSKE ENHANCEMENTS S10978, S10985*
005460200529      *             WHERE S10978, S10985 ARE THE ORIGINAL AMENDMENT   *
005470200529      *             REFERENCE NUMBER                                  *
005480200529      *             S10978 : EARLY REDEMPTIONS                        *
005490200529      *             S10982 : RECOMPILE PG FOR FILE CHANGED (SESWHTL0) *
005500200529      *             S10985 : JYSZRH: REVERSAL OF POSITION SETTLEMENT  *
005510200529      *             ACTION 'R', REVIEW LIVE/ALL  + SMALL ERROR FIXES  *
005520200529      *  S01486 - Portfolio Management Upgrade to Release 10          *
005530200529      *  080356 - Database error caused by 068993.  Remove it.        *
005540200529      *  075920 - Amounts and DORC not updated correctly during delete*
005550200529      *  S01512 - Add value date to Position Settlements and make the *
005560200529      *           settlement amount an output field only to be        *
005570200529      *           computed during update                              *
005580200529      *  S01509 - Value Currency to be currency of Issuer of Payments *
005590200529      *  068993 - Program did not clear screen on insert.             *
005600200529      *  066716 - Protect screen when Authorising a position sett.    *
005610200529      *  063994 - Nominal to Settlement CCY validation - rates the    *
005620200529      *           wrong way round so these have been swapped round.   *
005630200529      *  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
005640200529      *           to 10,9                                             *
005650200529      *  051475 - Authorized position settlement should update        *
005660200529      *           projected Nostro movement.                          *
005670200529      *  055839 - Always validate settle amount against settle Ccy    *
005680200529      *           decimal places. Due to exchange rate checking, Pgm  *
005690200529      *           sometimes uses nominal currency decimal places.     *
005700200529      *  S01446 - CUSTOMER COMMISSIONS (COURTAGE) ENHANCEMENT.        *
005710200529      *           Recompiled due to changes in PF/SECGTD.             *
005720200529      *  S01447 - Withholding tax                                     *
005730200529      *  S01401 - Produce SWIFT Messages MT5xxs, if option available. *
005740200529      *  S01412 - SWIFT September 1993 changes - validation           *
005750200529      *           of the format of the special instructions           *
005760200529      *           field.                                              *
005770200529      *  047225 - CONDITION CALL TO AORETLR0 ON RETAIL BEING          *
005780200529      *           PRESENT. (U1 SET ON IN CL IF RE OR IA PRESENT)      *
005790200529      *  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
005800200529      *          - Recompiled due to changes to files.                *
005810200529      *  E37157 - Should be able to access more than one record with  *
005820200529      *           the same key                                        *
005830200529      *  E37205 - Multiply/Divide indicator was being set up          *
005840200529      *           incorrectly for standard subroutine ZXRATE          *
005850200529      *  E37165 - If the exchange rate entered is 1 then it does not  *
005860200529      *           matter what the multiply/divide indicator is        *
005870200529      *  E37159 - Need only check if Retail or Interest on Accounts   *
005880200529      *           is on for settlement methods 04 and 14 to be valid  *
005890200529      *  E37158 - Need to set up account code and sequence defaults   *
005900200529      *           when action code is not I as well as when it is I   *
005910200529      *  E31432 - Add action code 'Y' to the appropriate entries in   *
005920200529      *           compile-time array 'INF'. These entries are used    *
005930200529      *           to display the valid options on the screen. Note    *
005940200529      *           that it has not been possible to flag the changed   *
005950200529      *           entries with the error number because there is no   *
005960200529      *           room.                                               *
005970200529      *  E30740 - Book code must be entered if charge / commission    *
005980200529      *           entered, else the system generates incorrect        *
005990200529      *           A/C keys.                                           *
006000200529      *  E28805 - Rolldown rolls up. The write of the SFLCTL blanks   *
006010200529      *           out the AID value so it is never 'DN'               *
006020200529      *  E24426 - When amending authorised posn. settlement, files    *
006030200529      *           should not be updated - E20237 incorrect            *
006040200529      *  S01117 - SE Release 10 - Multibranching                      *
006050200529      *  S01195 - Holiday Amendment                                   *
006060200529      *  S01220 - STRATEGIC RISK MANAGEMENT                           *
006070200529      *            Recompiled over changed PF/SECTYD                  *
006080200529      *  S01269 - TRADE AUTHORISATION: Recompiled for change to       *
006090200529      *           file TABSE.                                         *
006100200529      *  E23955 - Delete old 'MHELP' text omitted from previous fix   *   E23955
006110200529      *          (S01199 - ABS HELP SYSTEM.)                          *   E23955
006120200529      *  E23408 - Settlement types 4 and 14 allowed if Retail II or   *   E23408
006130200529      *           Interest on Accounts on in system.                  *   E23408
006140200529      *  E23192 - Settlement branch should default to that on TABTB36.*   E23192
006150200529      *  E21590 - Additional to E14884: Any non-Enquiry Action on an  *   E21590
006160200529      *           Actioned record (RECI = 'M') should have a unique   *   E21590
006170200529      *           Error Message. Added Error 115.                     *   E21590
006180200529      *  E21493 - CLINTSE needs to be read for Authorisation as well  *   E21493
006190200529      *           as for Amend since the Discretionary Indicator is   *   E21493
006200200529      *           required for checking Add/Subtract of Charges/Comm. *   E21493
006210200529      *  E20651 - DB Error Numbers used in more than one place.       *   E20651
006220200529      *           New Error Numbers as follows:                       *   E20651
006230200529      *           DB ERROR 04 -> 12.                                  *   E20651
006240200529      *           DB ERROR 04 -> 13.                                  *   E20651
006250200529      *           DB ERROR 06 -> 14.                                  *   E20651
006260200529      *           DB ERROR 06 -> 15.                                  *   E20651
006270200529      *  E20237 - E19438 was wrongly incorporated. Only 'Y' should    *   E20237
006280200529      *           authorise position settlements.                     *   E20237
006290200529      *         - Allow Roll up/down on Enquire only                  *   E20237
006300200529      *         - Correct Inf messages handling                       *   E20237
006310200529      *  E19438 - Mark manually inserted records as authorised.       *   E19438
006320200529      *  S01199 - HELP SYSTEM.                                        *   S01199
006330200529      *  S01154 - ADDITION OF REAL TIME STATEMENTS                    *   S01199
006340200529      *  E18884 - DIVIDE BY ZERO ERRORS WHEN BAD VALUES ENTERED       *   E18884
006350200529      *           INTO EXCHANGE RATE. ERROR MESSAGE 227 ADDED.        *   E18884
006360200529      *  E18102 - NOMINAL AMOUNT DECIMAL PLACES NOT BEING HANDLED     *   E18102
006370200529      *           CORRECTLY AND NEGATIVE AMOUNTS NOT BEING ACCEPTED   *   E18102
006380200529      *           AT ALL. ALSO NOMINAL AMT INCORRECTLY BEING USED     *   E18102
006390200529      *           DIRECTLY FOR AMOUNT DUE.                            *   E18102
006400200529      *  E17793 - INCORRECT ACCOUNT CODE FOR POSITION SETTLEMENTS     *   E17793
006410200529      *           CAUSES DATABASE ERROR IN SE2450                     *   E17793
006420200529      *  E17423 - AFTER WARNING MESSAGE APPEARS, ASCHGS MUST BE       *   E17423
006430200529      *           EXECUTED TO CATER FOR CMD KEY RESPONSE.             *   E17423
006440200529      *           INCORRECT NARRATIVES FOR CMD KEYS.                  *   E17423
006450200529      *           INCORRECT SIZE OF COMPARED SCREEN DETAIL            *   E17423
006460200529      *           FIELD FOR FIX  E16084.                              *   E17423
006470200529      *  E18193 - DUE DATE DOESN'T DEFAULT TO RUN DATE IF THE FIELD   *   E18193
006480200529      *           IS LEFT BLANK WHEN INSERTING A SETTLEMENT.          *   E18193
006490200529      *  E17178 - WHEN INSERTING A SETTLEMENT FOR PORTFOLIO CUST.     *   E17178
006500200529      *           WITH STANDARD SETTLEMENT INSTRUCTIONS, THE PAY      *   E17178
006510200529      *           SETTLEMENT METHOD IS CORRECTLY PICKED UP FROM       *   E17178
006520200529      *           STSED, BUT THE RECEIVE ACCOUNT IS PICKED UP         *   E17178
006530200529      *           INSTEAD OF THE PAY ACCOUNT.                         *   E17178
006540200529      *  E16084 - VALIDATION OF SCREEN IF CHANGED AFTER WARNING(S).   *   E16084
006550200529      *  E17175 - WHEN AN ERROR OCCURS IN THE NOMINAL POSITION        *   E17175
006560200529      *           FIELD, THIS FIELD IS HIGHLIGHTED CORRECTLY          *   E17175
006570200529      *           BUT WHEN THE ERROR IS CORRECTED THE FIELD IS        *   E17175
006580200529      *           HIGHLIGHTED FOR ANY ACTION CODE ENTERED.            *   E17175
006590200529      *  E16843 - UPDATE SHADOW BALANCES CORRECTLY.                   *   E16843
006600200529      *  E17211 - VALIDATE  SETTLEMENT ACCOUNT CORRECTLY IF           *   E17211
006610200529      *           SETTLEMENT METHOD 05.                               *   E17211
006620200529      *  S01179 -  ****** AS400 CONVERSION ******                     *   S01179
006630200529      *  The keyword RTGAID is no longer supported on the AS400       *   S01179
006640200529      *  and command keys and indicators have been used to replace    *   S01179
006650200529      *  this in the display file. To disrupt the structure of the    *   S01179
006660200529      *  program as little as possible a new subroutine - ASCHGS -    *   S01179
006670200529      *  has been coded. This moves the values which would have       *   S01179
006680200529      *  been passed to the program (via RTGAID) into the AID         *   S01179
006690200529      *  field depending on which function key has been pressed.      *   S01179
006700200529      *  S01176 - SECURITIES TRADING 3.1 INCORPORATION                *   S01176
006710200529      *  S01169 - SECURITIES TRADING BAER INCORPORATION               *   S01176
006720200529      *  E14878 - THE SETTLEMENT BRANCH SHOULD DEFAULT TO 001 IN      *   E14878
006730200529      *           A SINGLE BRANCH ENVIRONMENT.                        *   E14878
006740200529      *  E14214 - ALLOW INPUT AND VALIDATION OF NOMINAL AMOUNT SO     *   E14214
006750200529      *           THAT CONFIRMATION SHOWS AMOUNT OF HOLDING OF SEC.   *   E14214
006760200529      *           OVERIDE WARNING INDICATORS                          *   E14214
006770200529      *  E14881 - METHOD OF ADD/SUBTRACTING COMMS AND CHGS CHANGED    *   E14881
006780200529      *           TO DEPEND ON CLASSIFICATION AND PAY/RECEIVE IND.    *   E14881
006790200529      *           ALSO VALIDATION AMENDED FOR PAY/RECEIVE IND.        *   E14881
006800200529      *  E14882 - PDTG NOW SET TO 0 NOT RUNDATE                       *   E14882
006810200529      *  E14884 - ALLOW FOR ENQUIRY ON MATURED RECORDS ON POSETD      *   E14884
006820200529      *           BUT NOT FOR UPDATE.                                 *   E14884
006830200529      *  E14717 - SET UP DEFAULT BOOK CODE IF NOT SPECIFIED           *   E14717
006840200529      *           ON INPUT.                                           *   E14717
006850200529      *  E14712 - SETTLEMENT METHOD 04 & 14 BEING REJECTED            *   E14712
006860200529      *           BECAUSE OF INCORRECT VALIDATION.                    *   E14712
006870200529      *           NO VALIDATION EXISTED FOR SETTLEMENT METHOD 04.     *   E14712
006880200529      *  E14438 - RECOMPILE PROGRAM FOR EUCLID INCORPORATION          *   E14438
006890200529      *           AND UPGRADING OF FILES.                             *   E14438
006900200529      *  E13952 - PROGRAM DOES NOT ACCEPT CUSTOMER SHORTNAME.         *   E13952
006910200529      *  S01158 - POST INCORPORATION DEVELOPMENT FIX                  *   S01158
006920200529      *                                                               *
006930200529      *****************************************************************
006940200529      *
006950200529     FSE0170DFCF  E                    WORKSTN      KINFDS SCRDS
006960200529     F                                        RRN   KSFILE SUBFLREC
006970200529     F/COPY WNCPYSRC,SE0170F001
006980200529     F*POSET***UF  E           K        DISK         KCOMIT       A       S01117
006990200529     F*POSET1**UF**E           K        DISK         KCOMIT       AS01117 CSE023
007000200529     FPOSET1  UF  E           K        DISK         KCOMIT       A                          BUG12729
007010200529     F                                              KINFDS INFDS1                           BUG12729
007020200529     F                                              KINFSR INFSR                            BUG12729
007030200529     FPOSET6  UF  E           K        DISK         KCOMIT       A        CSE023
007040200529     F            POSETDF                           KRENAMEPOSETDF6                         BUG12729
007050200529     F                                              KINFDS INFDS
007060200529     F                                              KINFSR INFSR
007070200529     FPOSETX  IF  E           K        DISK
007080200529     F            POSETDF                           KRENAMEPOSETDFX
007090200529     FPOSETA  UF  E                    DISK         KCOMIT
007100200529     FPSAUT   UF  E           K        DISK         KCOMIT       A                          AR324886
007110200529      ** SE Position Settlement Authorisation detail                                        AR324886
007120200529      *                                                                                     AR324886
007130200529      *                                                                   CSE023
007140200529      ** Withholding tax customer details for retrieve.                   CSE023
007150200529     FSDWTCSL1IF  E           K        DISK         KINFSR INFSR          CSE023
007160200529      *                                                                   CSE023
007170200529      ** Tax basket details file for retrieve.                            CSE023
007180200529     FSDTXBSL1IF  E           K        DISK         KINFSR INFSR          CSE023
007190200529      *                                                                   CSE023
007200200529      ** Beneficial owners details file for retrieve.                     CSE023
007210200529     FSDBNFOL2IF  E           K        DISK         KINFSR INFSR          CSE023
007220200529      *                                                                   CSE023
007230200529      ** Withholding tax treaty details file for retrieve.                CSE023
007240200529     FSDWHTTL0IF  E           K        DISK         KINFSR INFSR          CSE023
007250200529      *                                                                   CSE023
007260200529      ** Exemption codes details file for retrieve.                       CSE023
007270200529     FSDEXEML1IF  E           K        DISK         KINFSR INFSR          CSE023
007280200529      *                                                                   CSE023
007290200529      ** Customer Depots details file                                     CSE023
007300200529     FCDEPS   IF  E           K        DISK         KINFSR INFSR          CSE023
007310200529      *                                                                   CSE023
007320200529      ** Customer positions file for retrieve.                            CSE023
007330200529     FCPOSH   IF  E           K        DISK         KINFSR INFSR          CSE023
007340200529     F*MEMOS**UF**E                    DISK         KCOMIT            U1  082738
007350200529     F*PRONO**UF**E           K        DISK         KCOMIT         051475 082738
007360200529     F*OLPOS**UF**E           K        DISK         KCOMIT         051475 082738
007370200529     F*CLINT**IF* E           K        DISK                               S01117
007380200529     F*********** CLINTCAF                          KIGNORE               S01117
007390200529     F*********** CLINTCBF                          KIGNORE               S01117
007400200529     F*********** CLINTCCF                          KIGNORE               S01117
007410200529     F*********** CLINTSEF                          KIGNORE               S01117
007420200529     F*********** CLINTC1F                          KIGNORE               S01117
007430200529     F*SNAME**IF* E           K        DISK                               S01117
007440200529     F*********** CLINTCBF                          KRENAMESNAMEF         S01117
007450200529     FACCNT   IF  E           K        DISK
007460200529     F            ACCNTAAF                          KIGNORE
007470200529     F            ACCNTACF                          KIGNORE
007480200529     FACNUM   IF  E           K        DISK
007490200529     F            ACCNTABF                          KRENAMEACNUMF
007500200529     FSECTY   IF  E           K        DISK
007510200529     F*SECHG**IF* E           K        DISK                               S01169
007520200529     FSECGT   IF  E           K        DISK                               S01169
007530200529     FSTDSED  IF  E           K        DISK
007540200529     F*BOOKD**IF* E           K        DISK                               S01117
007550200529     FINVTP   IF  E           K        DISK
007560200529     FSEPCCD  IF  E           K        DISK                               S01117
007570200529     FSEDEV   IF  E           K        DISK                               S01509
007580200529     F*RSACMTPDO**E                    DISK                        S01154 082738
007590200529     F************                                  KCOMIT         S01154 082738
007600200529     F*TABSE**IF  E           K        DISK                               S01117
007610200529     F**ICD*1**** TABTB10F                          KIGNORE               S01117
007620200529     F*********** TABTB11F                          KIGNORE               S01117
007630200529     F**ICD*SE*** TABTB36F                          KIGNORE               S01117
007640200529     F**ICD*5**** TABTB40F                          KIGNORE               S01117
007650200529     F**CCY****** TABTG10F                          KIGNORE               S01117
007660200529     F*********** TABTG20F                          KIGNORE               S01117
007670200529     F*********** TABLETAF                          KIGNORE               S01117
007680200529     F*********** TABLETHF                          KIGNORE               S01117
007690200529     F*********** TABLETJF                          KIGNORE               S01117
007700200529     F**NOSTROS** TABLETLF                          KIGNORE               S01117
007710200529     F**BRANCH*** TABLETRF                          KIGNORE               S01117
007720200529     F*********** TABLETXF                          KIGNORE               S01117
007730200529     F**CPTY*NOST TABLET2F                          KIGNORE               S01117
007740200529     F*********** TABLET3F                          KIGNORE               S01117
007750200529     F*********** TABLET5F                          KIGNORE               S01117
007760200529     F*********** TABTE10F                          KIGNORE               S01117
007770200529     F*********** TABTE20F                          KIGNORE               S01117
007780200529     F*********** TABLETNF                          KIGNORE               S01117
007790200529     F*********** TABLETKF                          KIGNORE               S01117
007800200529     F*********** TABLETPF                          KIGNORE               S01117
007810200529     F*TABTB20*IF**E*****               DISK                        E14712S01117
007820200529     FSESWHTL0IF  E           K        DISK                               S01447
007830200529     F* Securities WHT details file                                       S01447
007840200529     FPMPORTPDIF  E           K        DISK                           UC  S01486
007850200529     FSECOATL0IF  E           K        DISK                               CSE007
007860200529     FSECORFL0IF  E           K        DISK                                                   191161
007870200529     FSECOALLAUF  E           K        DISK         KCOMIT                                    191161
007880200529     FSECODPL7UF  E           K        DISK         KCOMIT                                    191161
007890200529     FSDCWHTL1IF  E           K        DISK                                                   CSD015
007900200529      *                                                                                       CSD015
007910200529      **  Compliance Hit list file for retrieve.                                              CSD015
007920200529     FREADVCL3UF  E           K        DISK         KCOMIT       A    UC                      CRE020
007930200529      **  Midas RE Settled Transaction Index File by Ref No/Pgm Ref                           CRE020
007940200529      *                                                                                       CRE020
007950200529     FPOSETDY3UF  E           K        DISK         KCOMIT       A                            CRE020
007960200529      **  Midas SE Position Settlement Extension file                                         CRE020
007970200529      *                                                                                       CRE020
007980200529     FSDSTMDL0UF  E           K        DISK         KCOMIT       A                            CER049
007990200529      **  Midas SD Stamp Tax History Detail file                                              CER049
008000200529     FSDCUSQL0IF  E           K        DISK                                                AR851784A
008010200529      **  Midas SD Stamp Tax Customer Extension file                                       AR851784A
008020200529     F*                                                                   S01408
008030200529     F/COPY WNCPYSRC,SE0170FFP1                                           S01408
008040200529     F*                                                                   S01408
008050200529      /EJECT
008060200529     F*****************************************************************
008070200529     F*                                                               *
008080200529     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
008090200529     F*                                                               *
008100200529     F*   01         S/SUBFLCTL  SFLDSP                               *
008110200529     F*   02         S/SUBFLCTL  SFLDSPCTL                            *
008120200529     F*   03         S/SUBFLCTL  SFLEND                               *
008130200529     F****04*********S/SUBFLCTL**ROLLDOWN*NOT*ALLOWED******************   084981
008140200529     F*   05         S/KEYINPUT  PROTECT/NON-DISPLAY ON LOCATION      *
008150200529     F*   06         S/RECDETLS  PROTECT FIELDS                       *
008160200529     F*                                                               *
008170200529     F*   10         START  SCREEN                                    *
008180200529     F*   11         REVIEW SCREEN                                    *
008190200529     F*   12         UPDATE SCREEN                                    *
008200200529     F*                                                               *
008210200529     F*   13         Analytical accounting is installed               *   CAC002
008220200529     F*   14         Nominal and settle ccys are equal and action 'E' *   CAC002
008230200529     F*   15         INDICATOR USED ON WRITE/UPDATE OPS TO CONDITION  *
008240200529     F*                                 CALL OF INFSR                 *
008250200529     F*   16         ACCOUNT BLOCKED FOR DEBITS                       *   E16843
008260200529     F*   17         ACCOUNT BLOCKED FOR CREDITS                      *   E16843
008270200529     F*   18         S01509 IS ACTIVE                                 *   S01509
008280200529     F*   19         S01512 IS ACTIVE                                 *   S01512
008290200529     F*                                                               *
008300200529      *   20         CSE023 IS ACTIVE                                 *   CSE023
008310200529     F*   21         S/KEYINPUT  ERROR-ACTN                           *
008320200529     F****22*********S/KEYINPUT  ERROR-PBCH                           *   S01117
008330200529     F*   22         S/KEYINPUT  ERROR-PBCA                           *   S01117
008340200529     F*   23         S/KEYINPUT  ERROR-PSSH                           *
008350200529     F*   24         S/KEYINPUT  ERROR-PCPY                           *
008360200529     F*   27         S/KEYINPUT  ERROR-PTFR                           *   S01496
008370200529     F*   28         PORTFOLIO MANAGEMENT INSTALLED INDICATOR         *   S01496
008380200529     F*   31         S/KEYINPUT  ERROR-PPALL                          *   S01496
008390200529     F*   32         S/RECDETLS  DISLAY SPMTRV                        *   S01496
008400200529     F*                                                               *
008410200529     F*   30         S/RECDETLS  POSITION CURSOR                      *
008420200529     F*   34         S/RECDETLS  ERROR-PSXR                           *   E18884
008430200529     F*   35         S/RECDETLS  ERROR-PBCD                           *
008440200529     F*   36         S/RECDETLS  ERROR-PPRE                           *
008450200529     F*   37         S/RECDETLS  ERROR-PSCU                           *
008460200529     F*** 38 *** S/RECDETLS  ERROR-PSXR ** IN38 ACTUALLY USED ON PBRX *   E18884
008470200529     F*   38         S/RECDETLS  ERROR-PBRX                           *
008480200529     F*   39         S/RECDETLS  ERROR-PSMT                           *
008490200529     F*   40         S/RECDETLS  ERROR-PSEA                           *
008500200529     F*   41         S/RECDETLS  ERROR-PSEB                           *
008510200529     F*   42         S/RECDETLS  ERROR-PCPN                           *
008520200529     F*   43         S/RECDETLS  ERROR-PFAC                           *
008530200529     F*   44         S/RECDETLS  ERROR-PSPI                           *
008540200529     F*   45         S/RECDETLS  ERROR-PCHC                           *
008550200529     F*   46         S/RECDETLS  ERROR-PMDI                           *
008560200529     F*   47         S/RECDETLS  ERROR-PCCD                           *
008570200529     F*   48         S/RECDETLS  ERROR-PBRX                           *
008580200529     F*   49         S/RECDETLS  ERROR-PSAT                           *
008590200529     F*   50         S/RECDETLS  ERROR-PAMD                           *
008600200529     F*   54         S/RECDETLS  ERROR-PPFC                           *   S01117
008610200529     F*                                                               *
008620200529     F*   55         ROLLUP                                           *   S01179
008630200529     F*   56         Error in margin points (FXMP)                    *   CAC002
008640200529     F****56*********ROLLDOWN**************************************S01179 084981
008650200529     F*   57         HELP                                             *   S01179
008660200529      *                                                               *   CSE023
008670200529      *   57         S/RECDETLS  ERROR-SEXCD                          *   CSE023
008680200529      *   58         S/RECDETLS  ERROR-STXBS                          *   CSE023
008690200529      *   59         S/RECDETLS  ERROR-SBNFO                          *   CSE023
008700200529     F*                                                               *   S01179
008710200529     F*   60         ADD RECORD                                       *
008720200529     F*   61         Subfile next change indicator                    *   084981
008730200529     F*   62         No more changed subfile record                   *   084981
008740200529     F*   64         Error code already written to error line         *   084981
008750200529     F*   65         VLDCMDKY INDICATOR FOR DISPLAY FILE              *   S01179
008760200529      *   69         READVCL3 Search (CHAIN) Indicator                *                       CRE020
008770200529      *   75         Display EU Tax fields                            *                       233711
008780200529      *   76         S/RECDETLS  ERROR-STXNM                          *                       233711
008790200529     F*   81         MULTIBRANCHING INDICATOR = 'Y'                   *   S01117
008800200529     F*   82         PROFIT CENTRES USED                              *   S01117
008810200529     F*   83         PROFIT CENTRE AMENDABLE                          *   S01117
008820200529     F*   84         NOT CUSTOMER POSITION SETTLEMENT                 *   S01117
008830200529     F*   88         'Already processed' error.                       *   E21590
008840200529     F*   88         Special instruction field validation             *   S01412
008850200529     F*   89         DEFLTS ALREADY CALLED                            *
008860200529     F*                                                               *
008870200529     F*   97         WORK                                             *
008880200529     F*   98         DATF = MMDDYY                                    *
008890200529     F*   99         WORK                                             *
008900200529     F*                                                               *
008910200529     F*   U7         DATABASE ERROR                                   *
008920200529     F*   U8         PROGRAM  ERROR                                   *
008930200529      *   LR         Last Record Indicator                            *   CSE010
008940200529     F*                                                               *
008950200529     F*   'AID' VALUES USED                                           *
008960200529     F*                                                               *
008970200529     F*   01         CA3                                              *   S01179
008980200529     F*   04         CA10                                             *   S01179
008990200529     F*   05         CA12                                             *   S01179
009000200529     F*   RA         ENTER PRESSED                                    *
009010200529     F*   UP         ROLLUP                                           *
009020200529     F****DN*********ROLLDOWN******************************************   084981
009030200529     F****HP*********HELP*PRESSED**************************************   S01199
009040200529     F*                                                               *
009050200529     F*****************************************************************
009060200529      /EJECT
009070200529     F*****************************************************************
009080200529     F*                                                               *
009090200529     F*  S U B R O U T I N E   I N D E X                              *
009100200529     F*                                                               *
009110200529     F*  INIT   - INITIALISATION OF STANDARD FIELDS,                  *
009120200529     F*                     ACCESS OF STANDING DATA                   *
009130200529     F*  START  - OUTPUT AND PROCESS KEY FIELDS SCREEN                *
009140200529     F*  REVIEW - PROCESS SUBFILE SELECTION SCREEN                    *
009150200529     F*  ROLLUP - FILL IN THE SUBFILE                                 *   084981
009160200529     F*  UPDATE - PROCESS DETAIL SCREEN AND UPDATE FILE               *
009170200529     F*  VALIDK - VALIDATE KEY FIELDS                                 *
009180200529     F*  VALIDD - VALIDATE DETAIL SCREEN                              *
009190200529     F*  VALTAX - VALIDATE WITHHOLDING FIELDS                         *   S01447
009200200529      *  WITHTX - VALIDATE WITHHOLDING FIELDS BY CSE023 PROTOCOL      *   CSE023
009210200529     F*  SRSTAX - VALIDATE STAMP TAX                                  *                       CER049
009220200529     F*  SEPTVS - VALIDATE SPECIAL INSTRUCTIONS FIELD                 *
009230200529     F*  DEFLTS - FORMAT DEFAULT FIELD VALUES                         *
009240200529     F*  INITRC - INITIALISE ALL FILE FIELDS TO ZERO/BLANK            *
009250200529     F***ACCMOV*-*WRITE*A*RECORD*TO*THE*ACCOUNT*MOVEMENT*FILE**    S01154 082738
009260200529     F*  TRSFS  - FORMAT RECORD FIELDS FOR SCREEN                     *
009270200529     F*  UPDFLS - UPDATE FILE RECORDS                                 *
009280200529     F*  PSAMT  - CALCULATE SETTLEMENT AMOUNT FOR S01512              *   S01512
009290200529     F*  UPDOWS - PROCESS UPDATE BY ANOTHER WORKSTATION               *
009300200529     F***WNOSTR*-*Update*projected*Nostro*details**                051475 082738
009310200529     F***WOLPOS*-*Update*on-line*positions*details**               051475 082738
009320200529     F*  INFSR  - FILE ERROR HANDLING S/R                             *
009330200529     F*  D1QRY  - QUERY SELECTION OF KEY FIELDS                       *   S01117
009340200529     F*  D2QRY  - QUERY SELECTION OF DETAIL FIELDS                    *   S01117
009350200529     F*  *PSSR  - HANDLING ABNORMAL ERROR CONDITIONS                  *   S01117
009360200529     F*                                                               *
009370200529     F*  ZACCH  - ACCESS A HOLIDAY RECORD FOR A PARTICULAR CURRENCY   *   S01195
009380200529     F*           AND LOCATION                                        *   S01195
009390200529     F*  ZALIGN - VALIDATE AMOUNT FIELDS                              *
009400200529     F*  ZCHKH  - DETERMINE IF A GIVEN DATE IS A HOLIDAY FOR A        *   S01195
009410200529     F*           PARTICULAR CURRENCY AND LOCATION                    *   S01195
009420200529     F*  ZDATE1 - CONVERT DATE TO DAYNO. AND REPORT IF ERROR          *
009430200529     F*  ZDATE2 - CONVERT DAYNO. TO DATE FOR DISPLAY                  *
009440200529     F***ZSYSTM*-*ACCESS*ICD*RECORD************************************   S01117
009450200529     F***ZICD2**-*ACCESS*ICD2*RECORD***********************************   S01117
009460200529     F***ZICDSE*-*ACCESS*ICD*FOR*SE*RECORD*****************************   S01117
009470200529     F***ZDATE5*-*TO*DETERMINE*IF*A*DAY*NUMBER*DATE*IS*A*HOLIDAY*******   S01195
009480200529     F************IN*GIVEN*CURRENCY,*AND,*IF*DAY*IS*A*HOLIDAY**********   S01195
009490200529     F************AND*IF*REQUIRED,*DETERMINE*NEXT*WORKING*DAY.*********   S01195
009500200529     F*  ZXRATE - TO OBTAIN A CROSS-EXCHANGE RATE AND  M/D            *
009510200529     F*           INDICATOR BETWEEN TWO CURRENCIES                    *
009520200529     F*  ZSEDIT - To insert a decimal point and sign into a           *
009530200529     F*           numeric field and to blank out leading zeros        *
009540200529     F*           (OPTIONALY inserting commas).                       *
009550200529     F*  ZTNLU1 - ACCESS DATAAREA FOR NEXT TRANSACTION NO.            *
009560200529     F*                                                               *
009570200529     F*****************************************************************
009580200529      /EJECT
009590200529     E                    CPY@    1   1 80
009600200529     E                    DET       256  1
009610200529     E                    CRW     1   6 21               2nd parameter string                 CSD015
009620200529     E                    ERR        19  4
009630200529     E/COPY WNCPYSRC,SE0170E002
009640200529     E***********         INF     1  12 76                                S01496
009650200529     E***********         INF     1  13 76                         S01496 084981
009660200529     E**********          INF     1  14 76                                           084981 AR324886
009670200529     E                    INF     1  17 76                                                  AR324886
009680200529     E*
009690200529     E/COPY WNCPYSRC,SE0170E003
009700200529     E***********         AND         5  3               NOSTRO DAT051475 082738
009710200529     E***********         ANB         5  8               NOSTRO BAL051475 082738
009720200529     E***********         ADT        16  3               ONLINE POS051475 082738
009730200529     E***********         AFI        16  8               ONLINE POS051475 082738
009740200529     E***********         AFO        16  8               ONLINE POS051475 082738
009750200529     E* Define numeric arrays                                             051475
009760200529     E***********         NND         5  5 0             NOSTRO DAT051475 082738
009770200529     E***********         NNB         5 15 0             NOSTRO BAL051475 082738
009780200529     E***********         NDT        16  5 0             ONLINE POS051475 082738
009790200529     E***********         NFI        16 15 0             ONLINE POS051475 082738
009800200529     E***********         NFO        16 15 0             ONLINE POS051475 082738
009810200529     E                    APF        16  1               VALID PAY FROM   051475
009820200529     E/COPY ZSRSRC,ZDATE2Z1
009830200529     E*COPY*ZSRSRC,ZDATE6Z1                                               S01195
009840200529     E/COPY ZSRSRC,ZHOLE                                                  S01195
009850200529     E** SR.ARRAY FOR BOTH ZACCH AND ZCHKH                                S01195
009860200529     E/COPY ZSRSRC,ZALIGNZ1
009870200529     E/COPY ZSRSRC,ZSEDITZ1
009880200529     E/COPY ZSRSRC,ZASIGNZ1
009890200529     E                    UPA    27  27  1                                S01412
009900200529     E** Valid codeword characters                                        S01412
009910200529      *                                                                                       CSW201
009920200529     E                    APN    37  37  1                                                    CSW201
009930200529      ** Valid uppercase alphabetic characters and numeric digits                             CSW201
009940200529     E*                                                                   S01412
009950200529     E                    SWCH   47  47  1                                S01412
009960200529     E** Valid SWIFT ISO characters                                       S01412
009970200529     E*                                                                   S01412
009980200529     E                    SIL        35  1                                S01412
009990200529     E** Special instruction line                                         S01412
010000200529     E*                                                                   S01412
010010200529     E                    POWER   1   7  7 3             POWER ARRAY      055839
010020200529     E                    AP      1  10 10 0                              CAC002
010030200529      ** Array - Powers of Ten.                                           CAC002
010040200529      *                                                                   CAC002
010050200529     E/COPY WNCPYSRC,SE0170E001
010060200529     E/COPY ZSRSRC,ZSDESCZ1                                               CSE016
010070200529      /EJECT
010080200529     IACCNTABF                                                            178530
010090200529     I              RECI                            RECIA                 178530
010100200529     I              PTFR                            PTFR1                 173501
010110200529     IACNUMF                                                              178530
010120200529     I              RECI                            RECIA                 178350
010130200529     I              PTFR                            PTFR2                 173501
010140200529     IPOSETDF                                                             S01486
010150200529     I              TNLU                            TNL1                  S01486
010160200529     IPOSETDFX                                                            S01486
010170200529     I              TNLU                            TNL1                  S01486
010180200529     IPOSETDF6                                                                              BUG12729
010190200529     I              TNLU                            TNL1                                    BUG12729
010200200529     ICPOSNDF                                                             186055
010210200529     I              RECI                            RECIX                 186055
010220200529      *                                                                                       CSE028
010230200529      ** DS for customer/book standard settlement instruction                                 CSE028
010240200529      **  to be passed to SESSIR0                                                             CSE028
010250200529      *                                                                                       CSE028
010260200529     IPCBSTD    E DSSTDSED                    2                                               CSE028
010270200529     I              RECI                            WRECI                                     CSE028
010280200529     I              LCD                             WLCD                                      CSE028
010290200529     I              CHTP                            WCHTP                                     CSE028
010300200529     I              TNLU                            WTNLU                                     CSE028
010310200529      *                                                                                       CSE028
010320200529      ** Data structure for standard additional settlement details                            CSE028
010330200529      ** for customer/book to be passed to SESSIR0                                            CSE028
010340200529      *                                                                                       CSE028
010350200529     IPCBSAD    E DSSTDADSED                  8                                               CSE028
010360200529     I*
010370200529     I*PRONOPNF*****                                               051475 082738
010380200529     I**************PND                             PNDA           051475 082738
010390200529     I**************PNB                             PNBA           051475 082738
010400200529     I**************CNUM                            CNUMA          051475 082738
010410200529     I**************                                                      082738
010420200529     I*OLPOSOAF*****                                               051475 082738
010430200529     I**************ODT                             ODTA           051475 082738
010440200529     I**************OFI                             OFIA           051475 082738
010450200529     I**************OFO                             OFOA           051475 082738
010460200529     I*                                                                   051475
010470200529     ICPYR@#      DS
010480200529     I*
010490200529     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
010500200529     I*
010510200529     I                                        1  80 CPY@
010520200529     I                                        1  20 CPY@##
010530200529     I*
010540200529     I/COPY ZSRSRC,ZSEDITZ2
010550200529     I*TABKEY*****DS***                                                   S01117
010560200529     I***********                             1  12 KEY                   S01117
010570200529     I***********                             1   2 TYPE                  S01117
010580200529     I***********                             5  12 KCPN                  S01117
010590200529     I***********                             8  10 KCCY                  S01117
010600200529     I***********                             9  11 KCCY2                 S01117
010610200529     I*
010620200529     I*ZZ039***** DS                                                      082738
010630200529     I***********                                                         082738
010640200529     I***Define*balance fields in MEMOS                                   082738
010650200529     I***********                                                         082738
010660200529     I***********                             1  150LDBL                  082738
010670200529     I***********                            16  300BKBL                  082738
010680200529     I*
010690200529     I**********  DS                             12                                           CGL029
010700200529     I            DS                             18                                           CGL029
010710200529     I*
010720200529     I* SPLITTING UP SETTLEMENT A/C INTO PARTS
010730200529     I*
010740200529     I**********                              1  12 PSEA@                                     CGL029
010750200529     I                                        1  18 PSEA@                                     CGL029
010760200529     I**********                              1   60CUS@                                      CSD027
010770200529     I                                        1   6 CUS@                                      CSD027
010780200529     I**********                              7  100ACOD@                                     CGL029
010790200529     I**********                             11  120ACSQ@                                     CGL029
010800200529     I                                        7  160ACOD@                                     CGL029
010810200529     I                                       17  180ACSQ@                                     CGL029
010820200529     I            DS
010830200529     I                                        1  75 HCCY
010840200529     I                                        1  75 XCCY
010850200529     ISCRCTL      DS
010860200529     I*
010870200529     I** KEY FIELDS (TAKEN FROM 'KEY' PORTION OF SCREEN)
010880200529     I*
010890200529     I                                        1   1 REVW
010900200529     I                                        2   2 ACTN
010910200529     I****************************************3  23 INPK                  S01486
010920200529     I**********                              3  37 INPK           S01486 186055
010930200529     I                                        3  61 INPK                  186055
010940200529     I***********                             3  05 SPBCH                 S01117
010950200529     I                                        3  05 SPBCA                 S01117
010960200529     I                                        6  15 SPSSH
010970200529     I                                       16  25 SPCPY
010980200529     I                                       26  31 SPDUD
010990200529     I                                       32  33 SPEVT
011000200529     I                                       34  37 SPPTFR                S01486
011010200529     I                                       38  39 STXBS                 186055
011020200529     I                                       40  59 SBNFO                 186055
011030200529     I                                       60  61 SEXCD                 186055
011040200529     I***************************************34  64 PAGK                  S01486
011050200529     I***********                            34  36 PPBCH                 S01117
011060200529     I***************************************34  36 PPBCA          S01117 S01486
011070200529     I***************************************37  46 PPSSH                 S01486
011080200529     I***************************************47  56 PPCPY                 S01486
011090200529     I***************************************57  62 PPDUD                 S01486
011100200529     I***************************************63  64 PPEVT                 S01486
011110200529     I**********                             38  68 PAGK           S01486 186055
011120200529     I**********                             38  40 PPBCA          S01486 186055
011130200529     I**********                             41  50 PPSSH          S01486 186055
011140200529     I**********                             51  60 PPCPY          S01486 186055
011150200529     I**********                             61  66 PPDUD          S01486 186055
011160200529     I**********                             67  68 PPEVT          S01486 186055
011170200529     I**********                              3  33 KEYFLD         E37157 186055
011180200529     I                                       62  92 PAGK                  186055
011190200529     I                                       62  64 PPBCA                 186055
011200200529     I                                       65  74 PPSSH                 186055
011210200529     I                                       75  84 PPCPY                 186055
011220200529     I                                       85  90 PPDUD                 186055
011230200529     I                                       91  92 PPEVT                 186055
011240200529     I                                        3  61 KEYFLD                186055
011250200529     I*                                                                   E37157
011260200529     I            DS                                                      E37157
011270200529     I                                        1   3 MPBCA                 E37157
011280200529     I                                        4  13 MPSSH                 E37157
011290200529     I                                       14  23 MPCPY                 E37157
011300200529     I                                       24  29 MPDUD                 E37157
011310200529     I                                       30  31 MPEVT                 E37157
011320200529     I                                    P  69  710SPTNLU                099267
011330200529     I                                        1  31 MTYFLD                E37157
011340200529     I*                                                                   051475
011350200529     IZ#BSTS    E DSZ#BST                                                 082738
011360200529     I                                    P 168 1700TNLUX1                                    CRE020
011370200529     IZ#ASTS    E DSZ#AST                                                 082738
011380200529     I                                    P 168 1700TNLUX2                                    CRE020
011390200529     I*                                                                   082738
011400200529     I***Data*structures to format numeric arrays/fields           051475 082738
011410200529     I*********** DS                                               051475 082738
011420200529     I***********                         P   1  15 NND            051475 082738
011430200529     I***********                         P  16  55 NNB            051475 082738
011440200529     I***********                             1  15 AND            051475 082738
011450200529     I***********                            16  55 ANB            051475 082738
011460200529     I***********                                                  051475 082738
011470200529     I*********** DS                                               051475 082738
011480200529     I***********                         P   1  48 NDT            051475 082738
011490200529     I***********                         P  49 176 NFI            051475 082738
011500200529     I***********                         P 177 304 NFO            051475 082738
011510200529     I***********                             1  48 ADT            051475 082738
011520200529     I***********                            49 176 AFI            051475 082738
011530200529     I***********                           177 304 AFO            051475 082738
011540200529     I*
011550200529     IDETREC    E DSPOSETD
011560200529     I*
011570200529     I** DATA STRUCTURE FOR INITIALISING A RECORD
011580200529     I*
011590200529     I***********   PBCH                            PBCHX                 S01117
011600200529     I              PBCA                            PBCAX                 S01117
011610200529     I              PSSH                            PSSHX
011620200529     I              PCPY                            PCPYX
011630200529     I              PDUD                            PDUDX
011640200529     I              PEVT                            PEVTX
011650200529     I              PTFR                            PTFRX                 S01486
011660200529     I              TNLU                            TNLUX                 S01486
011670200529     I              TXBS                            TXBSX                 186055
011680200529     I              BNFO                            BNFOX                 186055
011690200529     I              EXCD                            EXCDX                 186055
011700200529     I*
011710200529     I***DETS******E DSSE0170DF                                           S01179
011720200529     IDETS        DS                                                      S01179
011730200529     I*                                                                   S01179
011740200529     I** DATA STRUCTURE FOR SCREEN DETAIL OUTPUT TO CMTTXT                S01179
011750200529     I*                                                                   S01179
011760200529     I                                        1   2 SPBCD                 S01179
011770200529     I                                        3  16 SPAMD                 S01179
011780200529     I                                       17  17 SPPRE                 S01179
011790200529     I                                       18  20 SPSCU                 S01179
011800200529     I                                       21  21 SPMDI                 S01179
011810200529     I                                       22  36 SPBRX                 S01179
011820200529     I                                       37  38 SPSMT                 S01179
011830200529     I**********                             39  50 SPSEA                              S01179 CGL029
011840200529     I                                       39  50 QQSEA                                     CGL029
011850200529     I                                       51  53 SPSEB                 S01179
011860200529     I                                       54  63 SPCPN                 S01179
011870200529     I                                       64  73 SPFAC                 S01179
011880200529     I                                       74 108 SPSPI                 S01179
011890200529     I                                      109 110 SPCHC                 S01179
011900200529     I                                      111 125 SPCHA                 S01179
011910200529     I                                      126 127 SPCCD                 S01179
011920200529     I                                      128 142 SPCAM                 S01179
011930200529     I                                      143 157 SPSAT                 S01179
011940200529     I                                      158 172 SPSXR                 S01179
011950200529     I                                      173 178 SPSVL                 S01512
011960200529     I                                      179 196 SPSEA                                     CGL029
011970200529     ISCRMSG      DS                          1 152
011980200529     I*
011990200529     I** DATA STRUCTURE FOR ERROR MESSAGES TO SCREEN
012000200529     I*
012010200529     I                                        1  76 ERR
012020200529     I                                        1  76 ERRMSG
012030200529     I                                       77 152 INFMSG
012040200529     I*
012050200529     ISCRDS       DS
012060200529     I*
012070200529     I** DISPLAY FORMAT STATUS DATA STRUCTURE
012080200529     I*
012090200529     I                                      287 288 AID
012100200529     I                                      376 377 SFRNO
012110200529     IINFDS       DS
012120200529     I*
012130200529     I** DATA STRUCTURE FOR RPG 01021 ERROR HANDLING
012140200529     I*
012150200529     I                                     *STATUS  STATUS
012160200529     I*LDA*******UDS****************************256                       S01117
012170200529     I**************************************134 177 DBLOT                 S01117
012180200529     I**************************************134 138 DBFILE                S01117
012190200529     I**************************************139 167 DBKEY                 S01117
012200200529     I**************************************168 175 DBPGM                 S01117
012210200529     I**************************************176 177 DBASE                 S01117
012220200529     I** *LOCK IN LDA immediately before and OUT LDA immediately          S01117
012230200529     I** after each database error handling.                              S01117
012240200529     I*
012250200529     IINFDS1      DS                                                                        BUG12729
012260200529     I                                     *STATUS  STATS1                                  BUG12729
012270200529     IPDS1      E DSSDWLTOPD                                                                  CSD015
012280200529      ** Compliance watch engine program 1st data parameter                                   CSD015
012290200529      *                                                                                       CSD015
012300200529     IPSTRNG      DS                           9999                                           CSD015
012310200529      ** Compliance watch engine program 2nd parameter                                        CSD015
012320200529      *                                                                                       CSD015
012330200529     IWWEXRC      DS                           9999                                           CSD015
012340200529      *                                                                                       CSD015
012350200529     ILDA         DS                            256                       S01117
012360200529     I*
012370200529     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
012380200529     I*
012390200529     I                                      134 183 DBLOT                 S01117
012400200529     I                                      134 141 DBFILE                S01117
012410200529     I                                      142 170 DBKEY                 S01117
012420200529     I                                      171 180 DBPGM                 S01117
012430200529     I                                      181 1830DBASE                 S01117
012440200529     I*
012450200529     I/COPY ZSRSRC,ZTNLU1Z1
012460200529     I*                                                                   S01195
012470200529     I/COPY ZSRSRC,ZHOLI                                                  S01195
012480200529      **  EXTERNAL DS FOR HOLIDAY DETAILS                                 S01195
012490200529     I*                                                                   S01195
012500200529     I/COPY ZSRSRC,ZHOLDS                                                 S01195
012510200529      **  EXTERNAL DS FOR HOLIDAY DETAILS AND ACCESS OBJECTS              S01195
012520200529     I*                                                                   S01195
012530200529     I***P@DATA******DS                            100             087178 CAC002
012540200529     I/COPY WNCPYSRC,SE0170I001
012550200529     I***P@DATA*     DS                            128                               CAC002 AR851833
012560200529     IP@DATA      DS                            141                                         AR851833
012570200529     I** Data structure for the parameter passed to SEZ010                087178
012580200529     I                                        1   1 P@CLAS                087178
012590200529     I                                        2   2 P@PPRE                087178
012600200529     I                                        3  150P@PAMD                087178
012610200529     I                                       16  280P@PCHA                087178
012620200529     I                                       29  410P@PCAM                087178
012630200529     I                                       42  540P@TASO                087178
012640200529     I                                       55  670P@TAUS                087178
012650200529     I                                       68  808P@PSXR                087178
012660200529     I                                       81  81 P@PMDI                087178
012670200529     I                                       82  84 P@PNCY                087178
012680200529     I                                       85  87 P@PSCU                087178
012690200529     I                                       88 1000P@PSAT                087178
012700200529     I                                      101 1138P@FXMR                CAC002
012710200529     I                                      114 1260P@MAMT                CAC002
012720200529     I                                      127 128 P@TDTP                CAC002
012730200529     I                                      129 141 P@STAM                                  AR851833
012740200529     I/COPY WNCPYSRC,SE0170I002
012750200529     I**                                                                  S01117
012760200529     IRUNDT       DS                                                      S01117
012770200529     I** DATA AREA RUNDAT                                                 S01117
012780200529     I                                        1   7 RUNA                  S01117
012790200529     I                                    P   8  100RUND                  S01117
012800200529     I                                       11  11 SSF                   S01117
012810200529     I                                       12  12 DATF                  S01117
012820200529     I                                       13  13 MBIN                  S01117
012830200529     I*                                                                   S01117
012840200529     IZMUSER      DS                             17                       S01117
012850200529     I** DATA AREA OF MENU USER                                           S01117
012860200529     I                                       11  13 USRBCH                S01117
012870200529      *                                                                                       CRE020
012880200529     I            DS                                                                          CRE020
012890200529     I                                        1  26 WREFNO                                    CRE020
012900200529     I                                        1  10 WSSH                                      CRE020
012910200529     I                                       11  16 WCPY                                      CRE020
012920200529     I                                       17  19 WBCA                                      CRE020
012930200529     I                                       20  24 WDUD                                      CRE020
012940200529     I                                       25  26 WEVT                                      CRE020
012950200529      ** Reference Number Data Structure                                                      CRE020
012960200529      *                                                                                       CRE020
012970200529     I*                                                                   S01486
012980200529     ISDPLCS    E DSSDPLCSPD                                              S01486
012990200529     I* Portfolio Customer Details Accessed Via Access Program            S01486
013000200529     I*                                                                   S01486
013010200529     ISDPORT    E DSSDPORTPD                                              S01486
013020200529     I** Portfolio Definition Via Access Program                          S01486
013030200529     I*                                                                   S01117
013040200529     ISDBANK    E DSSDBANKPD                                              S01117
013050200529     I**  Bank Details                                                    S01117
013060200529     I**                                                                  S01117
013070200529     I*                                                                   S01117
013080200529     ISDBOOK    E DSSDBOOKPD                                              S01117
013090200529     I**  Book Details                                                    S01117
013100200529     I**                                                                  S01117
013110200529     I*                                                                   S01117
013120200529     ISDBRCH    E DSSDBRCHPD                                              S01117
013130200529     I**  Branch Details                                                  S01117
013140200529     I**                                                                  S01117
013150200529     ISDBRCE    E DSSDBRCHEXPD                                                                CER049
013160200529     I*                                                                   S01117
013170200529     ISDCNST    E DSSDCNSTPD                                              S01117
013180200529     I**  Counterparty Nostro Details                                     S01117
013190200529     I**                                                                  S01117
013200200529     I*                                                                   S01117
013210200529     ISDCURR    E DSSDCURRPD                                              S01117
013220200529     I**  Currency Details                                                S01117
013230200529     I**                                                                  S01117
013240200529     I*                                                                   S01117
013250200529     ISDCUST    E DSSDCUSTPD                                              S01117
013260200529     I**  Client Details                                                  S01117
013270200529     I              QQDFAC                          DFACQQ                                    CGL029
013280200529     I**                                                                  S01117
013290200529     I*                                                                   S01117
013300200529     ISDGELR    E DSSDGELRPD                                              S01117
013310200529     I**  General Ledger Details                                          S01117
013320200529     I**                                                                  S01117
013330200529     I*                                                                   S01117
013340200529     ISDMMOD    E DSSDMMODPD                                              S01117
013350200529     I**  Midas Module Details                                            S01117
013360200529     I**                                                                  S01117
013370200529     I*                                                                   S01117
013380200529     ISDNOST    E DSSDNOSTPD                                              S01117
013390200529     I**  Nostro Details                                                  S01117
013400200529     I              QQACCD                          ACCDQQ                                    CGL029
013410200529     I**                                                                  S01117
013420200529     I*                                                                   S01117
013430200529     ISDPRFC    E DSSDPRFCPD                                              S01117
013440200529     I**  Profit Centre Details                                           S01117
013450200529     I**                                                                  S01117
013460200529     I*                                                                   S01117
013470200529     ISDRETL    E DSSDRETLPD                                              S01117
013480200529     I**  Retail Details                                                  S01117
013490200529     I              QQACCD                          ACD2QQ                                    CGL029
013500200529     I**                                                                  S01117
013510200529     I*                                                                   S01117
013520200529     ISDSECS    E DSSDSECSPD                                              S01117
013530200529     I**  Securities Client Details                                       S01117
013540200529     I              QQACCD                          ACD3QQ                                    CGL029
013550200529     I**                                                                  S01117
013560200529     I*                                                                   S01117
013570200529     ISDSTRD    E DSSDSTRDPD                                              S01117
013580200529     I**  Securities Trading Details                                      S01117
013590200529     I**                                                                  S01117
013600200529     I*                                                                   S01117
013610200529     ISDTRAD    E DSSDTRADPD                                              S01117
013620200529     I**  Trading Details                                                 S01117
013630200529     I              QQACCD                          ACD4QQ                                    CGL029
013640200529     I**                                                                  S01117
013650200529     I*                                                                   S01408
013660200529     ISDPCAC    E DSSDPCACPD                                              CAC002
013670200529      **  PCA I.C.Details                                                 CAC002
013680200529     ISDWLCC    E DSSDWLCCPD                                                                  CSD015
013690200529      ** Watch list checking details                                                          CSD015
013700200529      *                                                                                       CSD015
013710200529     ISDCWCD    E DSSDCWCDPD                                                                  CSD015
013720200529      ** DS For Watch List Configuration Data File                                            CSD015
013730200529      *                                                                                       CSD015
013740200529     ISDSTAT    E DSSDSTAT                                                                    CSD015
013750200529      ** SD data area                                                                         CSD015
013760200529     ISC24X7    E DSSC24X7                                                                    CSD015
013770200529      **  24X7 status data area                                                               CSD015
013780200529     ISCSARD    E DSSCSARDPD                                                                  CSD015
013790200529     I              LCD                             LCD3                                      CSD015
013800200529      *                                                                   CAC002
013810200529     ISDLOCN    E DSSDLOCNPD                                                                  233711
013820200529      **  Location Details                                                                    233711
013830200529      *                                                                                       233711
013840200529     ISDCTRY    E DSSDCTRYPD                                                                  233711
013850200529      **  Country Details                                                                     233711
013860200529      *                                                                                       233711
013870200529     I/COPY WNCPYSRC,SE0170IIPG                                           S01408
013880200529     I*                                                                   S01408
013890200529     I*                                                                   S01117
013900200529     IDSFDY     E DSDSFDY                                                 S01117
013910200529     I*  FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE               S01117
013920200529     I*                                                                   CPB001
013930200529     IDSLDY     E DSDSLDY                                                 CPB001
013940200529     I*  THIRD DS FOR ACCESS PROGRAMS, VERY LONG DATA STRUCTURE           CPB001
013950200529     I**                                                                  S01117
013960200529     I** OVERRIDE COMMANDS                                                S01496
013970200529     I*                                                                   S01496
013980200529     IDSOVRA      DS                                                      S01496
013990200529     I*I************'OVRDBF POSETX SEPOST-    1  35 CCOVRA         S01496 084981
014000200529     I**************'L0 SECURE(*YES)'                              S01496 084981
014010200529     I*I********    'OVRDBF POSETX POSET -    1  33 CCOVRA         084981 186055
014020200529     I**********    'SECURE(*YES)'                                 084981 186055
014030200529     I I            'OVRDBF POSETX POSET7-    1  33 CCOVRA                186055
014040200529     I              ' SECURE(*YES)'                                       186055
014050200529     IDSOVRL      DS                                                      S01496
014060200529     I*I************'OVRDBF POSETX POSET -    1  32 CCOVRL         S01496 084981
014070200529     I**************'SECURE(*YES)'                                 S01496 084981
014080200529     I*I********    'OVRDBF POSETX POSET2-    1  33 CCOVRL         084981 186055
014090200529     I**********    ' SECURE(*YES)'                                084981 186055
014100200529     I I            'OVRDBF POSETX POSET8-    1  33 CCOVRL                186055
014110200529     I              ' SECURE(*YES)'                                       186055
014120200529     I              'PositionSettlement'  C         WPSET                                     CRE020
014130200529      *                                                                                       CRE020
014140200529     I*                                                                   S01117
014150200529     ICMTTXT      DS
014160200529     I*
014170200529     I** DATA STRUCTURE FOR SETUP OF COMMIT TEXT
014180200529     I*
014190200529     I                                        1   50NATN
014200200529     I                                        6   7 MDID
014210200529     I                                        8  15 PGMN
014220200529     I                                       16  18 WSIDX
014230200529     I                                       19  240MTIME
014240200529     I                                       25  25 ACTNX
014250200529     I                                       26  35 USIDX
014260200529     I                                       51 306 DET
014270200529     I*SVPOS******DS                                               E16843 082738
014280200529     I************                                                 E16843 082738
014290200529     I***Saved*fields in POSETD to be saved                        E16843 082738
014300200529     I************                                                 E16843 082738
014310200529     I************                            1   60SVPCPY         E16843 082738
014320200529     I************                            7   7 SVPAUI         E16843 082738
014330200529     I************                            8   8 SVPPRE         E16843 082738
014340200529     I************                            9  11 SVPSCU         E16843 082738
014350200529     I************                           12  130SVPSMT         E16843 082738
014360200529     I************                           14  25 SVPSEA         E16843 082738
014370200529     I************                           26  28 SVPSEB         E16843 082738
014380200529     I************                        P  29  350SVPSAT         E16843 082738
014390200529     I************                           36  38 SVPBCA         S01117 082738
014400200529     I*@POS*******DS                                               E16843 082738
014410200529     I************                                                 E16843 082738
014420200529     I**POSETD*fields moved to work fields for use in Subroutine REE16843 082738
014430200529     I************                                                 E16843 082738
014440200529     I************                            1   60@PCPY          E16843 082738
014450200529     I************                            7   7 @PAUI          E16843 082738
014460200529     I************                            8   8 @PPRE          E16843 082738
014470200529     I************                            9  11 @PSCU          E16843 082738
014480200529     I************                           12  130@PSMT          E16843 082738
014490200529     I************                           14  25 @PSEA          E16843 082738
014500200529     I************                           26  28 @PSEB          E16843 082738
014510200529     I************                        P  29  350@PSAT          E16843 082738
014520200529     I************                           36  38 @PBCA          S01117 082738
014530200529     I*                                                                   082738
014540200529     IKYACC       DS                                                      E16843
014550200529     I*                                                                   E16843
014560200529     I* Key fields used in READ of ACCNTAB for use in Subroutine RETAIL   E16843
014570200529     I*                                                                   E16843
014580200529     I**********                              1   60KYCNUM                             E16843 CSD027
014590200529     I                                        1   6 KYCNUM                                    CSD027
014600200529     I                                        7   9 KYCCY                 E16843
014610200529     I**********                             10  130KYACOD                             E16843 CGL029
014620200529     I                                       10  130QQACOD                                    CGL029
014630200529     I                                       14  150KYACSQ                E16843
014640200529     I                                       16  18 KYBRCA                S01117
014650200529     I                                       19  280KYACOD                                    CGL029
014660200529     I*
014670200529     IPSDS       SDS
014680200529     I*
014690200529     I** PROGRAM STATUS DATA STRUCTURE FOR WS/USER ID'S
014700200529     I*
014710200529      *                                                                   S01408
014720200529      ** Program status data structure (SDS suite)                        CGL007
014730200529      *                                                                   CGL007
014740200529     I                                       37  390@NOPMS                CGL007
014750200529     I/COPY WNCPYSRC,SE0170IIP2                                           S01408
014760200529      *                                                                   S01408
014770200529     I                                      244 246 WSID
014780200529     I                                      254 263 USID
014790200529      *                                                                   S01408
014800200529     I/COPY WNCPYSRC,SE0170IIP1                                           S01408
014810200529     I/COPY ZSRSRC,ZSDESCZ2                                               CSE016
014820200529      *                                                                   S01408
014830200529      *                                                                   S01401
014840200529      **  External data structure defined for passing data from this      S01401
014850200529      **  program to SE1817.                                              S01401
014860200529      *                                                                   S01401
014870200529     IPDATA     E DSSE17DT                                                S01401
014880200529     I              PPCPY                           PPCPY2                S01401
014890200529     I              PPDUD                           PPDUD2                S01401
014900200529     I              PPBCA                           PPBCA2                S01401
014910200529     I              PPSSH                           PPSSH2                S01401
014920200529     I              PPEVT                           PPEVT2                S01401
014930200529     I              PPTFR                           PPTFR2                                    CSE028
014940200529     I              PPBKC                           PPBKC2                                    CSE028
014950200529     ISDSTPD    E DSSDSTPDPD                                                                  CER049
014960200529      *                                                                   CSE003
014970200529     ISESDS     E DS                                                      CSE003
014980200529      ** SE Linked Enquiry Data Area                                      CSE003
014990200529     IDSAUTH    E DSPSAUTD                                                                  AR324886
015000200529      ** PSAUTD Data structure                                                              AR324886
015010200529      *                                                                                     AR324886
015020200529     I/COPY WNCPYSRC,SE0170I003
015030200529     C/EJECT
015040200529      *================================================================
015050200529      *  P R O G R A M   S T A R T                                    *
015060200529      *================================================================
015070200529     C*
015080200529     C**  DEFINE KEY LIST FOR CHAINING TO POSET FILE
015090200529     C*
015100200529     C           POSETK    KLIST
015110200529     C***********          KFLD           PBCH                            S01117
015120200529     C                     KFLD           PBCA                            S01117
015130200529     C                     KFLD           PSSH
015140200529     C                     KFLD           PCPY
015150200529     C                     KFLD           PDUD
015160200529     C                     KFLD           PEVT
015170200529     C                     KFLD           PTFR                                              AR996802
015180200529     C*                                                                   E16843
015190200529     C           POSTK1    KLIST                                          169067
015200200529     C                     KFLD           PBCA                            169067
015210200529     C                     KFLD           PSSH                            169067
015220200529     C                     KFLD           PCPY                            169067
015230200529     C                     KFLD           PDUD                            169067
015240200529     C                     KFLD           PEVT                            169067
015250200529     C                     KFLD           PTFR                            169067
015260200529     C**********           KFLD           SPTNLU                   169067 203678
015270200529     C                     KFLD           TNL1                            203678
015280200529     C*                                                                   S01486
015290200529     C**  DEFINE KEY LIST FOR CHAINING TO POSET FILE WITH PORTFOLIO       S01486
015300200529     C**   MANAGEMENT INSTALLED                                           S01486
015310200529     C*                                                                   S01486
015320200529     C           PTFRK     KLIST                                          S01486
015330200529     C                     KFLD           PBCA                            S01486
015340200529     C                     KFLD           PSSH                            S01486
015350200529     C                     KFLD           PCPY                            S01486
015360200529     C                     KFLD           PDUD                            S01486
015370200529     C                     KFLD           PEVT                            S01486
015380200529     C                     KFLD           PTFR                            S01486
015390200529     C                     KFLD           TNL1                            S01486
015400200529      *                                                                   CSE023
015410200529      ** Define key list for chaining to Position Settlements file        CSE023
015420200529      ** POSET6 when enhancement CSE023 is installed.                     CSE023
015430200529      ** - KLIST with Tax Basket and Beneficial Owner number.             CSE023
015440200529      *                                                                   CSE023
015450200529     C           PTXBSK    KLIST                                          CSE023
015460200529     C                     KFLD           PBCA                            CSE023
015470200529     C                     KFLD           PSSH                            CSE023
015480200529     C                     KFLD           PCPY                            CSE023
015490200529     C                     KFLD           PDUD                            CSE023
015500200529     C                     KFLD           PEVT                            CSE023
015510200529     C                     KFLD           PTFR                            CSE023
015520200529     C                     KFLD           TNL1                            CSE023
015530200529     C                     KFLD           TXBS                            CSE023
015540200529     C                     KFLD           BNFO                            CSE023
015550200529     C                     KFLD           EXCD                            CSE023
015560200529     C*
015570200529     C           PSAUTH    KLIST                                                            AR324886
015580200529     C                     KFLD           PBCA                                              AR324886
015590200529     C                     KFLD           PSSH                                              AR324886
015600200529     C                     KFLD           PCPY                                              AR324886
015610200529     C                     KFLD           PDUD                                              AR324886
015620200529     C                     KFLD           PEVT                                              AR324886
015630200529     C                     KFLD           PTFR                                              AR324886
015640200529     C                     KFLD           SPTNLU                                            AR324886
015650200529     C                     KFLD           TXBS                                              AR324886
015660200529     C                     KFLD           BNFO                                              AR324886
015670200529     C                     KFLD           EXCD                                              AR324886
015680200529      *                                                                                     AR324886
015690200529      *                                                                                     BUG12729
015700200529     C           PTXBS6    KLIST                                                            BUG12729
015710200529     C                     KFLD           PBCA                                              BUG12729
015720200529     C                     KFLD           PSSH                                              BUG12729
015730200529     C                     KFLD           PCPY                                              BUG12729
015740200529     C                     KFLD           PDUD                                              BUG12729
015750200529     C                     KFLD           PEVT                                              BUG12729
015760200529     C                     KFLD           PTFR                                              BUG12729
015770200529     C                     KFLD           TXBS                                              BUG12729
015780200529     C                     KFLD           BNFO                                              BUG12729
015790200529     C                     KFLD           EXCD                                              BUG12729
015800200529     C                     KFLD           TNL1                                              BUG12729
015810200529      *                                                                                     BUG12729
015820200529     C           PTXBS7    KLIST                                                            BUG12729
015830200529     C                     KFLD           PBCA                                              BUG12729
015840200529     C                     KFLD           PSSH                                              BUG12729
015850200529     C                     KFLD           PCPY                                              BUG12729
015860200529     C                     KFLD           PDUD                                              BUG12729
015870200529     C                     KFLD           PEVT                                              BUG12729
015880200529     C                     KFLD           PTFR                                              BUG12729
015890200529     C                     KFLD           TXBS                                              BUG12729
015900200529     C                     KFLD           BNFO                                              BUG12729
015910200529     C                     KFLD           EXCD                                              BUG12729
015920200529      *                                                                   CSE023
015930200529     C**  Key to ACCNTAB                                                  E16843
015940200529     C*                                                                   E16843
015950200529     C           KEYACC    KLIST                                          E16843
015960200529     C                     KFLD           KYCNUM                          E16843
015970200529     C                     KFLD           KYCCY                           E16843
015980200529     C                     KFLD           KYACOD                          E16843
015990200529     C                     KFLD           KYACSQ                          E16843
016000200529     C                     KFLD           KYBRCA                          S01117
016010200529     C*
016020200529     C**  DEFINE KEY LIST FOR CHAINING TO ACCNT FILE
016030200529     C*
016040200529     C           ACCNTK    KLIST
016050200529     C                     KFLD           CUS@
016060200529     C                     KFLD           PSCU
016070200529     C                     KFLD           ACOD@
016080200529     C                     KFLD           ACSQ@
016090200529     C                     KFLD           BRCA@   3                       S01117
016100200529     C*
016110200529     C****DEFINE*KEY*LIST*FOR*CHAINING*TO*SECHG*FILE*******************   S01169
016120200529     C***********                                                         S01169
016130200529     C***********SECHGK    KLIST                                          S01169
016140200529     C***********          KFLD           SPNCY                           S01169
016150200529     C***********          KFLD           CCDK                            S01169
016160200529     C*                                                                   S01169
016170200529     C**  DEFINE KEY LIST FOR CHAINING TO SECGT FILE                      S01169
016180200529     C*                                                                   S01169
016190200529     C           SECGTK    KLIST                                          S01169
016200200529     C                     KFLD           PSCU                            S01169
016210200529     C                     KFLD           CCDK                            S01169
016220200529     C*
016230200529     C*  DEFINE KEY LIST FOR READING INVTP
016240200529     C           INVTPK    KLIST
016250200529     C                     KFLD           NMCY
016260200529     C                     KFLD           SITP
016270200529     C*
016280200529     C*  DEFINE KEY LIST FOR READING STDSED
016290200529     C           STDSEK    KLIST
016300200529     C***********          KFLD           PBCH                            S01117
016310200529     C                     KFLD           PBCA                            S01117
016320200529     C                     KFLD           PCPY
016330200529     C                     KFLD           WBKCD                                               CSE028
016340200529     C                     KFLD           CURK
016350200529     C*                                                                   E16843
016360200529     C* Key to fetch ACNUM record                                         E16843
016370200529     C*                                                                   E16843
016380200529     C           ACNKA     KLIST                                          E16843
016390200529     C                     KFLD           KEY10  100                      E16843
016400200529     C*                                                                   S01117
016410200529     C**  Define Key List for chaining to Profit Centres file             S01117
016420200529     C*                                                                   S01117
016430200529     C           SEPCCK    KLIST                                          S01117
016440200529     C                     KFLD           PCCNM                           S01117
016450200529     C                     KFLD           PCBCA                           S01117
016460200529     C                     KFLD           PCSSN                           S01117
016470200529     C*                                                                   051475
016480200529     C**Define*key list for file PRONO                             051475 082738
016490200529     C***********                                                  051475 082738
016500200529     C***********KLPRON    KLIST                                   051475 082738
016510200529     C***********          KFLD           CCY                      051475 082738
016520200529     C***********          KFLD           NOSN                     051475 082738
016530200529     C***********                                                  051475 082738
016540200529     C**Define*key list for file OLPOS                             051475 082738
016550200529     C***********                                                  051475 082738
016560200529     C***********KLOLPS    KLIST                                   051475 082738
016570200529     C***********          KFLD           BRCA                     051475 082738
016580200529     C***********          KFLD           CCY                      051475 082738
016590200529     C***********          KFLD           RECN                     051475 082738
016600200529     C*                                                                   S01486
016610200529     C** DEFINE KEY LIST FOR CHAINING TO PMPORTPD                         S01486
016620200529     C*                                                                   S01486
016630200529     C           PORTK     KLIST                                          S01486
016640200529     C**********           KFLD           WWCNUM  60                                   S01486 CSD027
016650200529     C                     KFLD           WWCNUM  6                                           CSD027
016660200529     C                     KFLD           SPPTFR                          S01486
016670200529     C*                                                                   S01486
016680200529     C** DEFINE KEY LIST FOR CHAINING TO SDPLCSL2                         S01486
016690200529     C*                                                                   S01486
016700200529     C           KPLCS     KLIST                                          S01486
016710200529     C                     KFLD           WPLCS   6                       S01486
016720200529      *                                                                                       CSD015
016730200529      ** Watch list checking key used                                                         CSD015
016740200529      *                                                                                       CSD015
016750200529     C           CMPKEY    KLIST                                                              CSD015
016760200529     C                     KFLD           W4FUNT                                              CSD015
016770200529     C                     KFLD           W4IDEN                                              CSD015
016780200529     C                     KFLD           W4BRCH                                              CSD015
016790200529      *                                                                                       CSD015
016800200529      ** Midas RE Settled Transaction Index File Key List                                     CRE020
016810200529      *                                                                                       CRE020
016820200529     C           KADVC     KLIST                                                              CRE020
016830200529     C                     KFLD           KREFNO 30                                           CRE020
016840200529     C                     KFLD           KPRGMN 10                                           CRE020
016850200529     C                     KFLD           KNARR  29                                           CRE020
016860200529      *                                                                                       CRE020
016870200529      ** Midas SE Position Settlement Extension file                                          CRE020
016880200529      *                                                                                       CRE020
016890200529     C           KPOST3    KLIST                                                              CRE020
016900200529     C                     KFLD           K3PBCA  3                                           CRE020
016910200529     C                     KFLD           K3PSSH 10                                           CRE020
016920200529     C**********           KFLD           K3PCPY  60                                   CRE020 CSD027
016930200529     C                     KFLD           K3PCPY  6                                           CSD027
016940200529     C                     KFLD           K3PDUD  50                                          CRE020
016950200529     C                     KFLD           K3PEVT  2                                           CRE020
016960200529     C                     KFLD           K3TNLU  50                                          CRE020
016970200529      *                                                                                       CRE020
016980200529     C           KSTAMD    KLIST                                                              CER049
016990200529     C                     KFLD           T2KEY                                               CER049
017000200529     C                     KFLD           T2TYPE                                              CER049
017010200529     C                     KFLD           T2LNRF                                              CER049
017020200529     C                     KFLD           T2FCNM                                              CER049
017030200529     C                     KFLD           T2FACT                                              CER049
017040200529     C                     KFLD           T2FCNO                                              CER049
017050200529     C                     KFLD           T2FSEQ                                              CER049
017060200529     C                     KFLD           T2ORED                                              CER049
017070200529     C                     KFLD           T2DLNO                                              CER049
017080200529     C                     KFLD           T2TDRF                                              CER049
017090200529     C                     KFLD           T2BRCA                                              CER049
017100200529     C                     KFLD           T2CNUM                                              CER049
017110200529     C                     KFLD           T2CCY                                               CER049
017120200529     C                     KFLD           T2ACOD                                              CER049
017130200529     C                     KFLD           T2ACSQ                                              CER049
017140200529     C                     KFLD           T2PREF                                              CER049
017150200529     C                     KFLD           T2CQSQ                                              CER049
017160200529     C                     KFLD           T2PBRC                                              CER049
017170200529     C                     KFLD           T2PSSH                                              CER049
017180200529     C                     KFLD           T2PCPY                                              CER049
017190200529     C                     KFLD           T2PDUD                                              CER049
017200200529     C                     KFLD           T2PEVT                                              CER049
017210200529      *                                                                                       CER049
017220200529     C/COPY WNCPYSRC,SE0170C042
017230200529     C*
017240200529     C** PERFORM SETUP OF STANDARD FIELDS
017250200529     C*
017260200529     C                     EXSR INIT
017270200529      *
017280200529      ***  Do Until Command 3 or error
017290200529      *
017300200529     C           AID       DOUEQ'01'
017310200529     C           *INU7     OREQ '1'
017320200529     C           ENDPGM    OREQ 'Y'                                       084981
017330200529     C*
017340200529     C           *IN10     CASEQ'1'       START
017350200529     C           *IN11     CASEQ'1'       REVIEW
017360200529     C           *IN12     CASEQ'1'       UPDATE
017370200529     C*
017380200529     C                     END
017390200529     C                     END
017400200529     C/COPY WNCPYSRC,SE0170C096
017410200529      *
017420200529      *================================================================
017430200529      *  P R O G R A M     E N D                                      *
017440200529      *                                                               *
017450200529     C                     SETON                         LR
017460200529      *                                                               *
017470200529      *================================================================
017480200529      /EJECT
017490200529     C*****************************************************************
017500200529     C*                                                               *
017510200529     C*  INIT S/R  -  TO INITIALISE STATIC FIELDS AND ACCESS STANDING *
017520200529     C*               DATA                                            *
017530200529     C*  CALLED FROM: MAIN LINE PROCESSING                            *
017540200529     C*  CALLS:       ZSYSTM, ZICD2 , ZICDSE.                         *
017550200529     C*                                                               *
017560200529     C*****************************************************************
017570200529     C*
017580200529     C           INIT      BEGSR                           * INIT BEGSR *
017590200529     C*
017600200529     C** PREPARE LDA
017610200529     C*
017620200529     C           *NAMVAR   DEFN           LDA                             S01117
017630200529     C           *LOCK     IN   LDA                                       S01117
017640200529     C/COPY WNCPYSRC,SE0170C097
017650200529     C                     MOVEL*BLANK    DBLOT
017660200529     C                     MOVEL'SE0170'  DBPGM
017670200529     C                     OUT  LDA                                       S01117
017680200529      *                                                                   CSE003
017690200529     C           *NAMVAR   DEFN           SDSTAT                                              CSD015
017700200529     C                     IN   SDSTAT                                                        CSD015
017710200529      *                                                                                       CSD015
017720200529     C           *NAMVAR   DEFN           SESDS                           CSE003
017730200529     C*
017740200529     C** PREPARE COMIT TEXT
017750200529     C*
017760200529     C                     MOVEL'SE'      MDID
017770200529     C                     MOVEL'SE0170'  PGMN
017780200529     C                     MOVELWSID      WSIDX
017790200529     C                     MOVELUSID      USIDX
017800200529     C*
017810200529     C***HELP*PROGRAM*PARAMETER****************************************   S01199
017820200529     C***********                                                         S01199
017830200529     C***********          MOVEL'SE0170'  HBPGM   8        *FOR CALL MHELPS01199
017840200529     C                     MOVEL*BLANK    WBLNK   1
017850200529     C*
017860200529     C** FOR HIGH INTENSITY SCREEN ATTRIBUTE
017870200529     C*
017880200529     C                     BITOF'01234567'HI      1                    STY
017890200529     C                     BITON'267'     HI
017900200529     C                     MOVELHI        INF,8
017910200529     C                     MOVELHI        INF,9
017920200529     C                     MOVELHI        INF,10
017930200529     C**********           MOVELHI        INF,11                          186400
017940200529     C                     MOVELHI        INF,12
017950200529     C                     MOVELHI        INF,13                          S01496
017960200529     C                     MOVELHI        INF,14                          084981
017970200529     C/COPY WNCPYSRC,SE0170C002
017980200529     C*                                                                   S01117
017990200529     C***********                                                         S01117
018000200529     C***GET*INSTALLATION*CONTROL*DATA*RECORD*1************************   S01117
018010200529     C***********                                                         S01117
018020200529     C***********          EXSR ZSYSTM                                    S01117
018030200529     C************IN99     IFEQ '1'                                       S01117
018040200529     C***********          MOVE '1'       *INU7                           S01117
018050200529     C***********          MOVE '1'       *INU8                           S01117
018060200529     C***********          MOVE 'TABLE'   DBFILE           ***************S01117
018070200529     C***********          MOVEL'ICDR1'   DBKEY            ** DB ERROR 01 S01117
018080200529     C***********          Z-ADD1         DBASE            ***************S01117
018090200529     C***********          END                                            S01117
018100200529     C***********                                                         S01117
018110200529     C****ACCESS*ICD2,*UNLESS*ERROR*ON*PREVIOUS*TABLE******************   S01117
018120200529     C***********                                                         S01117
018130200529     C************IN99     IFEQ '0'                                       S01117
018140200529     C***********          EXSR ZICD2                                     S01117
018150200529     C************IN99     IFEQ '1'                                       S01117
018160200529     C***********          MOVE '1'       *INU7                           S01117
018170200529     C***********          MOVE '1'       *INU8                           S01117
018180200529     C***********          MOVE 'TABLE'   DBFILE           ***************S01117
018190200529     C***********          MOVEL'ICDR2'   DBKEY            ** DB ERROR 02 S01117
018200200529     C***********          Z-ADD2         DBASE            ***************S01117
018210200529     C***********          END                                            S01117
018220200529     C***********          END                                            S01117
018230200529     C***********                                                         S01117
018240200529     C***********                                                         S01117
018250200529     C****ACCESS*ICD*FOR*SE*(TABTB36),*UNLESS*ERROR*ON*PREVIOUS*TABLES**  S01117
018260200529     C***********                                                         S01117
018270200529     C************IN99     IFEQ '0'                                       S01117
018280200529     C***********          EXSR ZICDSE                                    S01117
018290200529     C************IN99     IFEQ '1'                                       S01117
018300200529     C***********          MOVE '1'       *INU7                           S01117
018310200529     C***********          MOVE '1'       *INU8                           S01117
018320200529     C***********          MOVE 'TABLE'   DBFILE           ***************S01117
018330200529     C***********          MOVEL'ICDR '   DBKEY            ** DB ERROR 03 S01117
018340200529     C***********          Z-ADD3         DBASE            ***************S01117
018350200529     C***********          END                                            S01117
018360200529     C***********          END                                            S01117
018370200529     C***********                                                         S01117
018380200529     C***********                                                         S01117
018390200529     C***GET*ICD5                                                         S01117
018400200529     C***********                                                         S01117
018410200529     C***********          MOVEL'01      'ZTABKY 12                       S01117
018420200529     C***********          MOVE '  40'    ZTABKY                          S01117
018430200529     C***********ZTABKY    CHAINTABTB40F             99                   S01117
018440200529     C***********                                                         S01117
018450200529     C****ERROR*IF*NO*RECORD*FOUND*OR*IF*IT*IS*DELETED*****************   S01117
018460200529     C***********                                                         S01117
018470200529     C************IN99     IFEQ '1'                                       S01117
018480200529     C***********          MOVE 'TABLE'   DBFILE           ***************S01117
018490200529     C***********          MOVEL'TB40 '   DBKEY            ***DB*ERROR 04*E20651
018500200529     C***********          Z-ADD4         DBASE            ***************E20651
018510200529     C***********          MOVEL'TB40 '   DBKEY      ** DB ERROR 12 E20651S01117
018520200529     C***********          Z-ADD12        DBASE      ***************E20651S01117
018530200529     C***********          SETON                     U7U8                 S01117
018540200529     C***********          ELSE                                           S01117
018550200529     C***********RECI      IFNE 'D'                                       S01117
018560200529     C***********          MOVE 'TABLE'   DBFILE           ***************S01117
018570200529     C***********          MOVEL'TB40 '   DBKEY            ***DB*ERROR*04*E20651
018580200529     C***********          Z-ADD4         DBASE            ***************E20651
018590200529     C***********          MOVEL'TB40 '   DBKEY      ** DB ERROR 13 E20651S01117
018600200529     C***********          Z-ADD13        DBASE      ***************E20651S01117
018610200529     C***********          SETON                     U7U8                 S01117
018620200529     C***********          END                                            S01117
018630200529     C***********          END                                            S01117
018640200529     C***********                                                         S01117
018650200529     C***********                                                         S01117
018660200529     C****ACCESS*TABTB20*FOR*DEFAULT*ACCOUNT************************E14712S01117
018670200529     C*****************************************************************   S01117
018680200529     C***********                                                         E14712
018690200529     C***********1         CHAINTABTB20              99                   E14712
018700200529     C************IN99     IFEQ '1'                                       E14712
018710200529     C***********RECI      OREQ '*'                                       E14712
018720200529     C***********          MOVE '06'      DBASE            ***************E20651
018730200529     C***********          MOVEL'TABLE'   DBFILE           ***DB*ERROR*06*E20651
018740200529     C***********          MOVE '14'      DBASE      ***************E20651S01117
018750200529     C***********          MOVEL'TABLE'   DBFILE     ** DB ERROR 14 E20651S01117
018760200529     C***********          MOVE 'TB20'    DBKEY      ***************E20651S01117
018770200529     C***********          SETON                     U7U8           E14712S01117
018780200529     C***********          END                                      E14712S01117
018790200529     C*                                                                   S01117
018800200529     C**  In the Dataarea ZMUSER                                          S01117
018810200529     C*                                                                   S01117
018820200529     C           *NAMVAR   DEFN           ZMUSER                          S01117
018830200529     C                     IN   ZMUSER                                    S01117
018840200529     C*                                                                   S01117
018850200529     C** In the Dataarea RUNDAT                                           S01117
018860200529     C*                                                                   S01117
018870200529     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
018880200529     C                     IN   RUNDT                                     S01117
018890200529     C*                                                                   S01117
018900200529     C**  Check System Date Format, DDMMYY or MMDDYY.                     S01117
018910200529     C*                                                                   S01117
018920200529     C           DATF      IFEQ 'M'                                       S01117
018930200529     C                     MOVE '1'       *IN98                           S01117
018940200529     C                     END                                            S01117
018950200529     C*                                                                   S01117
018960200529     C**  Set Multibranching Indicator for program                        S01117
018970200529     C*                                                                   S01117
018980200529     C           MBIN      IFEQ 'Y'                                       S01117
018990200529     C                     MOVE '1'       *IN81                           S01117
019000200529     C                     END                                            S01117
019010200529     C*                                                                   S01117
019020200529     C**  Access Bank details                                             S01117
019030200529     C*                                                                   S01117
019040200529     C                     CALL 'AOBANKR0'                                S01117
019050200529     C                     PARM '*DBERR ' @RTCD   7                       S01117
019060200529     C                     PARM '*FIRST ' @OPTN   7                       S01117
019070200529     C           SDBANK    PARM SDBANK    DSFDY                           S01117
019080200529     C*                                                                   S01117
019090200529     C**  Access Midas Module details                                     S01117
019100200529     C*                                                                   S01117
019110200529     C                     CALL 'AOMMODR0'                                S01117
019120200529     C                     PARM '*DBERR ' @RTCD                           S01117
019130200529     C                     PARM '*FIRST ' @OPTN                           S01117
019140200529     C           SDMMOD    PARM SDMMOD    DSFDY                           S01117
019150200529      *                                                                   CAC002
019160200529      **  If Analytical Accounting Module is installed, access the PCA    CAC002
019170200529      **  ICD Details File.                                               CAC002
019180200529      *                                                                   CAC002
019190200529     C           BGN0ST    IFEQ 'Y'                                       CAC002
019200200529     C                     MOVE '1'       *IN13                           CAC002
019210200529     C                     CALL 'AOPCACR0'                                CAC002
019220200529     C                     PARM '*DBERR ' @RTCD                           CAC002
019230200529     C                     PARM '*FIRST ' @OPTN                           CAC002
019240200529     C           SDPCAC    PARM SDPCAC    DSFDY                           CAC002
019250200529     C                     ENDIF                                          CAC002
019260200529     C*                                                                   S01117
019270200529     C**  Access Securities Trading details                               S01117
019280200529     C*                                                                   S01117
019290200529     C                     CALL 'AOSTRDR0'                                S01117
019300200529     C                     PARM '*DBERR ' @RTCD                           S01117
019310200529     C                     PARM '*FIRST ' @OPTN                           S01117
019320200529     C           SDSTRD    PARM SDSTRD    DSSDY                           S01117
019330200529     C*                                                                   S01117
019340200529     C**  Access Trading details                                          S01117
019350200529     C*                                                                   S01117
019360200529     C                     CALL 'AOTRADR0'                                S01117
019370200529     C                     PARM '*DBERR ' @RTCD                           S01117
019380200529     C                     PARM '*FIRST ' @OPTN                           S01117
019390200529     C           SDTRAD    PARM SDTRAD    DSFDY                           S01117
019400200529     C*                                                                   S01117
019410200529     C**  Access Retail details                                           S01117
019420200529     C*                                                                   S01117
019430200529     C           *INU1     IFEQ '1'                                       047225
019440200529     C                     CALL 'AORETLR0'                                S01117
019450200529     C                     PARM '*DBERR ' @RTCD                           S01117
019460200529     C                     PARM '*FIRST ' @OPTN                           S01117
019470200529     C           SDRETL    PARM SDRETL    DSFDY                           S01117
019480200529     C                     END                                            047225
019490200529     C*                                                                   S01117
019500200529     C**  Access General Ledger details                                   S01117
019510200529     C*                                                                   S01117
019520200529     C**********           CALL 'AOGELRR0'                                S01117              CGL029
019530200529     C                     CALL 'AOGELRR1'                                                    CGL029
019540200529     C                     PARM '*DBERR ' @RTCD                           S01117
019550200529     C                     PARM '*FIRST ' @OPTN                           S01117
019560200529     C********** SDGELR    PARM SDGELR    DSFDY                           S01117              CGL029
019570200529     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
019580200529     C*                                                                   S01117
019590200529     C           BKPRCU    IFEQ 'Y'                                       S01117
019600200529     C                     MOVE '1'       *IN82                           S01117
019610200529     C           BKPRCA    IFEQ 'Y'                                       S01117
019620200529     C                     MOVE '1'       *IN83                           S01117
019630200529     C                     END                                            S01117
019640200529     C                     END                                            S01117
019650200529     C*                                                                   S01408
019660200529     C/COPY WNCPYSRC,SE0170CCPG                                           S01408
019670200529     C*                                                                   S01408
019680200529     C** CHECK IF MODULE PORTFOLIO IS ON OR OFF                           S01486
019690200529     C           BGPFMG    IFEQ 'Y'                                       S01486
019700200529     C           BGN4ST    OREQ 'Y'                                       CPB001
019710200529     C                     MOVE '1'       *IN28                           S01486
019720200529     C                     OPEN PMPORTPD                                  S01486
019730200529     C                     ELSE                                           S01486
019740200529     C                     MOVE '0'       *IN28                           S01486
019750200529     C                     END                                            S01486
019760200529     C*                                                                   S01486
019770200529     C** ACCESS SDPORTPD FOR PORTFOLIO REFERENCE FOR '9997' UNLESS        S01486
019780200529     C**  ERROR ON PREVIOUS ACCESS                                        S01486
019790200529     C           *IN28     IFEQ '1'                                       S01486
019800200529     C           BGPFMG    ANDEQ'Y'                                       CPB001
019810200529     C                     CALL 'AOPORTR0'                                S01486
019820200529     C                     PARM '*DBERR ' @RTCD   7                       S01486
019830200529     C                     PARM '*FIRST ' @OPTN   7                       S01486
019840200529     C           SDPORT    PARM SDPORT    DSFDY                           S01486
019850200529     C           @RTCD     IFNE *BLANKS                                   S01486
019860200529     C                     MOVE '1'       *INU7                           S01486
019870200529     C                     MOVE '1'       *INU8                           S01486
019880200529     C                     MOVE 'SDPORTPD'DBFILE           ***************S01486
019890200529     C                     MOVEL@OPTN     DBKEY            ** DB ERROR 17 S01486
019900200529     C                     Z-ADD17        DBASE            ***************S01486
019910200529     C                     END                                            S01486
019920200529     C                     END                                            S01486
019930200529     C*
019940200529     C**  PROCEED TO START SCREEN UNLESS DATABASE ERROR
019950200529     C*
019960200529     C           *INU7     IFNE '1'
019970200529     C                     MOVEA'1'       *IN,10
019980200529     C                     END
019990200529     C*
020000200529     C           *LIKE     DEFN SFRNO     XSFRNO
020010200529     C************LIKE     DEFN SPSXR     XSPSXR                          E37165
020020200529     C           *LIKE     DEFN SPSXR     WXRATP                                              197896
020030200529     C           *LIKE     DEFN SPBRX     XSPBRX
020040200529     C           *LIKE     DEFN PAGK      PPAGK                           E28805
020050200529     C************LIKE     DEFN PNMP      @WPNMP                   051475 082738
020060200529     C           *LIKE     DEFN SPSVL     XSPSVL                          S01512
020070200529     C           *LIKE     DEFN PDUD      WPDUD                           S01509
020080200529     C           *LIKE     DEFN PBCA      WSVBCA                          084981
020090200529     C           *LIKE     DEFN PSSH      WSVSSH                          084981
020100200529     C           *LIKE     DEFN PCPY      WSVCPY                          084981
020110200529     C           *LIKE     DEFN PDUD      WSVDUD                          084981
020120200529     C           *LIKE     DEFN PEVT      WSVEVT                          084981
020130200529     C           *LIKE     DEFN PTFR      WSVTFR                          084981
020140200529     C           *LIKE     DEFN TNLU      WSVTLU                          084981
020150200529     C           *LIKE     DEFN PSAT      WSVPSA                          086722
020160200529     C           *LIKE     DEFN PSAT      WPSAT                           086722
020170200529     C           *LIKE     DEFN TXBS      WSTXBS                          186055
020180200529     C           *LIKE     DEFN BNFO      WSBNFO                          186055
020190200529     C           *LIKE     DEFN EXCD      WSEXCD                          186055
020200200529     C           *LIKE     DEFN A6NQDP    ZNQDP1                          CAC002
020210200529     C           *LIKE     DEFN A6NQDP    ZNQDP2                          CAC002
020220200529     C*
020230200529     C                     MOVE *BLANKS   SFRNO
020240200529     C*
020250200529     C                     MOVE 'N'       WNATNF  1                       S01496
020260200529      *                                                                   S01401
020270200529      **  Access SAR details file to see if MT5xx SAR is installed.       S01401
020280200529      *                                                                   S01401
020290200529     C                     CALL 'AOSARDR0'                                S01401
020300200529     C                     PARM '       ' @RTCD                           S01401
020310200529     C                     PARM '*VERIFY' @OPTN                           S01401
020320200529     C                     PARM 'S01401'  @SARD   6                       S01401
020330200529      *                                                                   S01401
020340200529     C           @RTCD     IFEQ *BLANK                                    S01401
020350200529     C                     MOVE 'Y'       S01401  1                       S01401
020360200529     C                     END                                            S01401
020370200529      *                                                                   S01447
020380200529      **  Access SAR details file to see if S01447 SAR is installed.      S01447
020390200529      *                                                                   S01447
020400200529     C                     CALL 'AOSARDR0'                                S01447
020410200529     C                     PARM *BLANKS   @RTCD                           S01447
020420200529     C                     PARM '*VERIFY' @OPTN                           S01447
020430200529     C                     PARM 'S01447'  @SARD                           S01447
020440200529      *                                                                   S01447
020450200529     C           @RTCD     IFEQ *BLANK                                    S01447
020460200529     C                     MOVE 'Y'       S01447  1                       S01447
020470200529     C                     ELSE                                           S01447
020480200529     C                     MOVE 'N'       S01447                          S01447
020490200529     C                     END                                            S01447
020500200529     C*                                                                   S01496
020510200529     C**  Check if Jyske Enhancements feature (S01496) is installed       S01496
020520200529     C*                                                                   S01496
020530200529     C                     CALL 'AOSARDR0'                                S01496
020540200529     C                     PARM *BLANKS   @RTCD                           S01496
020550200529     C                     PARM '*VERIFY' @OPTN                           S01496
020560200529     C                     PARM 'S01496'  @SARD                           S01496
020570200529      *                                                                   S01496
020580200529     C           @RTCD     IFEQ *BLANK                                    S01496
020590200529     C                     MOVE 'Y'       S01496  1                       S01496
020600200529     C***********          MOVE '1'       *IN29                     S01496088976
020610200529     C                     MOVE '1'       *IN73                           088976
020620200529     C                     ELSE                                           S01496
020630200529     C                     MOVE 'N'       S01496                          S01496
020640200529     C                     END                                            S01496
020650200529      *                                                                   CSE007
020660200529      ***   Check if Corporate Action feature (CSE007) is installed       CSE007
020670200529      *                                                                   CSE007
020680200529     C                     MOVE 'N'       CSE007                          CSE007
020690200529     C                     CALL 'AOSARDR0'                                CSE007
020700200529     C                     PARM *BLANKS   @RTCD                           CSE007
020710200529     C                     PARM '*VERIFY' @OPTN                           CSE007
020720200529     C                     PARM 'CSE007'  @SARD                           CSE007
020730200529      *                                                                   CSE007
020740200529     C           @RTCD     IFEQ *BLANK                                    CSE007
020750200529     C                     MOVE 'Y'       CSE007  1                       CSE007
020760200529     C                     MOVE '1'       *IN73                           CSE007
020770200529     C                     END                                            CSE007
020780200529      *                                                                   CEU017
020790200529      ***   Check if Securities Redenominations is installed              CEU017
020800200529      *                                                                   CEU017
020810200529     C                     MOVE 'N'       CEU017                          CEU017
020820200529     C                     CALL 'AOSARDR0'                                CEU017
020830200529     C                     PARM *BLANKS   @RTCD                           CEU017
020840200529     C                     PARM '*VERIFY' @OPTN                           CEU017
020850200529     C                     PARM 'CEU017'  @SARD                           CEU017
020860200529      *                                                                   CEU017
020870200529     C           @RTCD     IFEQ *BLANK                                    CEU017
020880200529     C                     MOVE 'Y'       CEU017  1                       CEU017
020890200529     C                     MOVE '1'       *IN73                           CEU017
020900200529     C                     END                                            CEU017
020910200529     C*                                                                   S01509
020920200529     C**  Access SAR details file to see if S01509 SAR is installed.      S01509
020930200529     C*                                                                   S01509
020940200529     C                     CALL 'AOSARDR0'                                S01509
020950200529     C                     PARM *BLANKS   @RTCD                           S01509
020960200529     C                     PARM '*VERIFY' @OPTN                           S01509
020970200529     C                     PARM 'S01509'  @SARD                           S01509
020980200529     C*                                                                   S01509
020990200529     C           @RTCD     IFEQ *BLANK                                    S01509
021000200529     C                     MOVE 'Y'       S01509  1                       S01509
021010200529     C                     MOVE '1'       *IN18                           S01509
021020200529     C                     ELSE                                           S01509
021030200529     C                     MOVE 'N'       S01509                          S01509
021040200529     C                     MOVE '0'       *IN18                           S01509
021050200529     C                     END                                            S01509
021060200529     C*                                                                   S01512
021070200529     C**  Access SAR details file to see if S01512 SAR is installed.      S01512
021080200529     C*                                                                   S01512
021090200529     C                     CALL 'AOSARDR0'                                S01512
021100200529     C                     PARM *BLANKS   @RTCD                           S01512
021110200529     C                     PARM '*VERIFY' @OPTN                           S01512
021120200529     C                     PARM 'S01512'  @SARD                           S01512
021130200529     C*                                                                   S01512
021140200529     C           @RTCD     IFEQ *BLANK                                    S01512
021150200529     C                     MOVE 'Y'       S01512  1                       S01512
021160200529     C                     MOVE '1'       *IN19                           S01512
021170200529     C                     ELSE                                           S01512
021180200529     C                     MOVE 'N'       S01512                          S01512
021190200529     C                     MOVE '0'       *IN19                           S01512
021200200529     C                     END                                            S01512
021210200529      *                                                                   S01447
021220200529      **  Access SAR details file to see if ? allowed for security        CSE003
021230200529     C                     CALL 'AOSARDR0'                                CSE003
021240200529     C                     PARM *BLANKS   @RTCD                           CSE003
021250200529     C                     PARM '*VERIFY' @OPTN                           CSE003
021260200529     C                     PARM 'CSE003'  @SARD                           CSE003
021270200529      *                                                                   CSE003
021280200529     C           @RTCD     IFEQ *BLANK                                    CSE003
021290200529     C                     MOVE 'Y'       CSE003  1                       CSE003
021300200529     C                     ELSE                                           CSE003
021310200529     C                     MOVE 'N'       CSE003                          CSE003
021320200529     C                     ENDIF                                          CSE003
021330200529      *                                                                   CSE003
021340200529     C*                                                                   CEU005
021350200529     C**  Access SAR details file to see if CEU005 SAR is installed.      CEU005
021360200529     C*                                                                   CEU005
021370200529     C                     CALL 'AOSARDR0'                                CEU005
021380200529     C                     PARM *BLANKS   @RTCD                           CEU005
021390200529     C                     PARM '*VERIFY' @OPTN                           CEU005
021400200529     C                     PARM 'CEU005'  @SARD                           CEU005
021410200529     C*                                                                   CEU005
021420200529     C           @RTCD     IFEQ *BLANK                                    CEU005
021430200529     C                     MOVE 'Y'       CEU005  1                       CEU005
021440200529     C                     ELSE                                           CEU005
021450200529     C                     MOVE 'N'       CEU005                          CEU005
021460200529     C                     ENDIF                                          CEU005
021470200529      *                                                                   CSE023
021480200529      ** Initialization process for CSE023 STARTS here.                   CSE023
021490200529      **  Access SAR details file to see if CSE023 SAR is installed.      CSE023
021500200529      **  US Withholding tax treaty.                                      CSE023
021510200529      *                                                                   CSE023
021520200529     C                     CALL 'AOSARDR0'                                CSE023
021530200529     C                     PARM *BLANKS   @RTCD                           CSE023
021540200529     C                     PARM '*VERIFY' @OPTN                           CSE023
021550200529     C                     PARM 'CSE023'  @SARD                           CSE023
021560200529      *                                                                   CSE023
021570200529     C           @RTCD     IFEQ *BLANK                                    CSE023
021580200529     C                     MOVE 'Y'       CSE023  1                       CSE023
021590200529     C                     ELSE                                           CSE023
021600200529     C                     MOVE 'N'       CSE023                          CSE023
021610200529     C                     ENDIF                                          CSE023
021620200529      *                                                                                       CSW201
021630200529      ** Call SWIF2001 to check if CSW201 is switched on                                      CSW201
021640200529      *                                                                                       CSW201
021650200529     C                     CALL 'SWIF2001'             7474                                   CSW201
021660200529     C                     PARM *BLANKS   @RTCD                                               CSW201
021670200529      *                                                                                       CSW201
021680200529     C           *IN74     IFEQ *ON                                                           CSW201
021690200529     C                     Z-ADD30        DBASE                                               CSW201
021700200529     C                     MOVEL'SWIF2001'DBFILE                                              CSW201
021710200529     C                     MOVEL'*CALL'   DBKEY                                               CSW201
021720200529     C                     MOVE *ON       *INU7                                               CSW201
021730200529     C                     MOVE *ON       *INU8                                               CSW201
021740200529     C                     EXSR *PSSR                                                         CSW201
021750200529     C                     ELSE                                                               CSW201
021760200529      *                                                                                       CSW201
021770200529     C           @RTCD     IFEQ 'CSW2001'                                                     CSW201
021780200529     C                     MOVE 'Y'       CSW201  1                                           CSW201
021790200529     C                     ELSE                                                               CSW201
021800200529     C                     MOVE 'N'       CSW201                                              CSW201
021810200529     C                     ENDIF                                                              CSW201
021820200529      *                                                                                       CSW201
021830200529     C                     ENDIF                                                              CSW201
021840200529      *                                                                                       CSE028
021850200529      ** Check if CSE028 - MT5xx Standing Settlements Instructions is                         CSE028
021860200529      **   is switched on.                                                                    CSE028
021870200529      *                                                                                       CSE028
021880200529     C                     CALL 'AOSARDR0'                                                    CSE028
021890200529     C                     PARM *BLANKS   @RTCD                                               CSE028
021900200529     C                     PARM '*VERIFY' @OPTN                                               CSE028
021910200529     C                     PARM 'CSE028'  @SARD                                               CSE028
021920200529      *                                                                                       CSE028
021930200529     C           @RTCD     IFEQ *BLANK                                                        CSE028
021940200529     C                     MOVE 'Y'       CSE028  1                                           CSE028
021950200529     C                     ELSE                                                               CSE028
021960200529     C                     MOVE 'N'       CSE028                                              CSE028
021970200529     C                     ENDIF                                                              CSE028
021980200529      *                                                                                       CER049
021990200529      ** Check if CER049 - Stamp Tax is switch on                                             CER049
022000200529      *                                                                                       CER049
022010200529     C                     CALL 'AOSARDR0'                                                    CER049
022020200529     C                     PARM *BLANKS   @RTCD                                               CER049
022030200529     C                     PARM '*VERIFY' @OPTN                                               CER049
022040200529     C                     PARM 'CER049'  @SARD                                               CER049
022050200529      *                                                                                       CER049
022060200529     C           @RTCD     IFEQ *BLANK                                                        CER049
022070200529     C                     MOVE 'Y'       CER049  1                                           CER049
022080200529     C                     ELSE                                                               CER049
022090200529     C                     MOVE 'N'       CER049                                              CER049
022100200529     C                     ENDIF                                                              CER049
022110200529      *                                                                   CSE023
022120200529      ** Key list for withholding tax customer details file.              CSE023
022130200529     C           WTAKEY    KLIST                                          CSE023
022140200529     C                     KFLD           KYCSNO                          CSE023
022150200529     C                     KFLD           KYCRTT                          CSE023
022160200529      *                                                                   CSE023
022170200529      ** Key list for tax basket details file.                            CSE023
022180200529     C           WTBKEY    KLIST                                          CSE023
022190200529     C                     KFLD           KYCRTT                          CSE023
022200200529     C                     KFLD           STXBS                           CSE023
022210200529      *                                                                   CSE023
022220200529      ** Key list for beneficial owners file.                             CSE023
022230200529     C           WBOKEY    KLIST                                          CSE023
022240200529     C                     KFLD           KYCSNO                          CSE023
022250200529     C                     KFLD           KYCRTT                          CSE023
022260200529     C                     KFLD           KYBNFO                          CSE023
022270200529      *                                                                   CSE023
022280200529      ** Key list for withholding tax treaty details file - Full          CSE023
022290200529     C           WTFKEY    KLIST                                          CSE023
022300200529     C                     KFLD           KYCRTT                          CSE023
022310200529     C                     KFLD           @SITP   3                       CSE023
022320200529     C                     KFLD           @BCOLC  2                       CSE023
022330200529      *                                                                   CSE023
022340200529      ** Key list for withholding tax treaty details file - Partial       CSE023
022350200529     C           WTPKEY    KLIST                                          CSE023
022360200529     C                     KFLD           KYCRTT                          CSE023
022370200529     C                     KFLD           @SITP                           CSE023
022380200529      *                                                                   CSE023
022390200529      ** Key list for Customer Depot - CDEPS                              CSE023
022400200529     C           CDPKEY    KLIST                                          CSE023
022410200529     C                     KFLD           @PSSH  10                       CSE023
022420200529     C**********           KFLD           @ZCUST  60                                   CSE023 CSD027
022430200529     C                     KFLD           @ZCUST  6                                           CSD027
022440200529      *                                                                   CSE023
022450200529      ** Key list for exemption codes file.                               CSE023
022460200529     C           WTEKEY    KLIST                                          CSE023
022470200529     C                     KFLD           KYCRTT                          CSE023
022480200529     C                     KFLD           SEXCD                           CSE023
022490200529      *                                                                   CSE023
022500200529      ** Key list for customer positions file.                            CSE023
022510200529     C           WCPKEY    KLIST                                          CSE023
022520200529     C                     KFLD           KYPBCA                          CSE023
022530200529     C                     KFLD           SPSSH                           CSE023
022540200529     C                     KFLD           KYCSCN                          CSE023
022550200529     C                     KFLD           BJRDNB                          CSE023
022560200529      *                                                                   CSE023
022570200529      ** Initialization process for CSE023 ENDS here.                     CSE023
022580200529      *                                                                   CGL007
022590200529     C           @NOPMS    IFNE 0                                         CGL007
022600200529      *                                                                   CGL007
022610200529      ** If the number of parameters passed to the program is not equal   CGL007
022620200529      ** 0,the program has been called from Posting enquiry GL0090        CGL007
022630200529      *                                                                   CGL007
022640200529     C           *ENTRY    PLIST                                          CGL007
022650200529     C                     PARM           ZBCA    3                       CGL007
022660200529     C                     PARM           ZSSH   10                       CGL007
022670200529     C**********           PARM           ZCPY    60                                   CGL007 CSD027
022680200529     C                     PARM           ZCPY    6                                           CSD027
022690200529     C                     PARM           ZDUD    50                      CGL007
022700200529     C                     PARM           ZEVT    2                       CGL007
022710200529     C                     PARM           ZPTFR   4                       CGL007
022720200529     C                     PARM           ZPSTA  130                      CGL007
022730200529     C                     PARM           ZRETN   1                       CGL007
022740200529      *                                                                   CGL007
022750200529      ** filled Screen's fields                                           CGL007
022760200529      *                                                                   CGL007
022770200529     C                     MOVE ZBCA      SPBCA                           CGL007
022780200529     C                     MOVE ZSSH      SPSSH                           CGL007
022790200529     C                     MOVELZCPY      SPCPY                           CGL007
022800200529     C                     Z-ADDZDUD      ZDAYNO                          CGL007
022810200529     C                     EXSR ZDATE2                                    CGL007
022820200529     C                     MOVELZDATE     SPDUD                           CGL007
022830200529     C                     MOVE ZEVT      SPEVT                           CGL007
022840200529     C                     MOVE ZPTFR     SPPTFR                          CGL007
022850200529     C                     MOVE 'E'       ACTN                            CGL007
022860200529     C                     MOVE 'Y'       REVW                            CGL007
022870200529      *                                                                   CGL007
022880200529      ** filled key's fields                                              CGL007
022890200529      *                                                                   CGL007
022900200529     C           KEY16     KLIST                                          CGL007
022910200529     C                     KFLD           PBCA                            CGL007
022920200529     C                     KFLD           PSSH                            CGL007
022930200529     C                     KFLD           PCPY                            CGL007
022940200529     C                     KFLD           PDUD                            CGL007
022950200529     C                     KFLD           PEVT                            CGL007
022960200529      *                                                                   CGL007
022970200529     C                     MOVELZBCA      PBCA                            CGL007
022980200529     C                     MOVELZSSH      PSSH                            CGL007
022990200529     C                     MOVELZCPY      PCPY                            CGL007
023000200529     C                     MOVE ZDUD      PDUD                            CGL007
023010200529     C                     MOVELZEVT      PEVT                            CGL007
023020200529     C                     MOVELZPTFR     PTFR                            CGL007
023030200529      *                                                                   CGL007
023040200529     C                     MOVE *ON       *IN04                           CGL007
023050200529     C                     EXSR UPDATE                                    CGL007
023060200529     C                     MOVE AID       ZRETN                           CGL007
023070200529     C                     MOVE *ON       *INLR                           CGL007
023080200529     C                     RETRN                                          CGL007
023090200529     C                     ENDIF                                          CGL007
023100200529     C*                                                                   S01408
023110200529     C/COPY WNCPYSRC,SE0170CCP5                                           S01408
023120200529      *                                                                   CSE010
023130200529      ** Check if CSE010 (Transaction Enhancements) is active             CSE010
023140200529      *                                                                   CSE010
023150200529     C                     CALL 'AOSARDR0'                                CSE010
023160200529     C                     PARM '       ' @RTCD                           CSE010
023170200529     C                     PARM '*VERIFY' @OPTN                           CSE010
023180200529     C                     PARM 'CSE010'  @SARD   6                       CSE010
023190200529      *                                                                   CSE010
023200200529     C           @RTCD     IFEQ *BLANK                                    CSE010
023210200529     C                     MOVE 'Y'       CSE010  1                       CSE010
023220200529     C                     ELSE                                           CSE010
023230200529     C                     MOVE 'N'       CSE010                          CSE010
023240200529      *                                                                   CSE010
023250200529      ** Database Error (return code other than *NRF)                     CSE010
023260200529      *                                                                   CSE010
023270200529     C           @RTCD     IFNE '*NRF   '                                 CSE010
023280200529     C           *LOCK     IN   LDA                                       CSE010
023290200529     C                     MOVEL'SCSARDPD'DBFILE           ***************CSE010
023300200529     C                     MOVEL'CSE010'  DBKEY            * DB ERROR 24 *CSE010
023310200529     C                     Z-ADD24        DBASE            ***************CSE010
023320200529     C                     OUT  LDA                                       CSE010
023330200529     C                     MOVE *ON       *INU7                           CSE010
023340200529     C                     MOVE *ON       *INU8                           CSE010
023350200529     C                     MOVE *ON       *INLR                           CSE010
023360200529     C                     EXSR *PSSR                                     CSE010
023370200529     C                     ENDIF                                          CSE010
023380200529     C                     ENDIF                                          CSE010
023390200529      *                                                                                       CSD015
023400200529      ** Check 24 x 7 enhancement is installed.                                               CSD015
023410200529      *                                                                                       CSD015
023420200529     C                     CALL 'AOSARDR0'                                                    CSD015
023430200529     C                     PARM '       ' @RTCD                                               CSD015
023440200529     C                     PARM '*VERIFY' @OPTN                                               CSD015
023450200529     C                     PARM 'CSC011'  @SARD   6                                           CSD015
023460200529     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
023470200529      *                                                                                       CSD015
023480200529     C                     MOVEL'N'       CSC011  1                                           CSD015
023490200529     C           @RTCD     IFEQ *BLANKS                                                       CSD015
023500200529     C           *NAMVAR   DEFN           SC24X7                                              CSD015
023510200529     C                     IN   SC24X7                                                        CSD015
023520200529     C                     MOVEL'Y'       CSC011                                              CSD015
023530200529     C                     ELSE                                                               CSD015
023540200529     C           @RTCD     IFNE '*NRF   '                                                     CSD015
023550200529     C           *LOCK     IN   LDA                                                           CSD015
023560200529     C                     MOVEL'CSC011'  DBKEY                                               CSD015
023570200529     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
023580200529     C                     Z-ADD41        DBASE                                               CSD015
023590200529     C                     OUT  LDA                                                           CSD015
023600200529     C                     EXSR *PSSR                                                         CSD015
023610200529     C                     ENDIF                                                              CSD015
023620200529     C                     ENDIF                                                              CSD015
023630200529      *                                                                                       CSD015
023640200529      ** Check if compliance watch enhancement is switched on.                                CSD015
023650200529      *                                                                                       CSD015
023660200529     C                     CALL 'AOSARDR0'                                                    CSD015
023670200529     C                     PARM '       ' @RTCD                                               CSD015
023680200529     C                     PARM '*VERIFY' @OPTN                                               CSD015
023690200529     C                     PARM 'CSD015'  @SARD   6                                           CSD015
023700200529     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
023710200529      *                                                                                       CSD015
023720200529     C                     MOVEL'N'       CSD015  1                                           CSD015
023730200529     C           @RTCD     IFEQ *BLANKS                                                       CSD015
023740200529     C                     MOVEL'Y'       CSD015  1                                           CSD015
023750200529     C                     ELSE                                                               CSD015
023760200529     C           @RTCD     IFNE '*NRF   '                                                     CSD015
023770200529     C           *LOCK     IN   LDA                                                           CSD015
023780200529     C                     MOVEL'CSD015'  DBKEY                                               CSD015
023790200529     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
023800200529     C                     Z-ADD42        DBASE                                               CSD015
023810200529     C                     OUT  LDA                                                           CSD015
023820200529     C                     EXSR *PSSR                                                         CSD015
023830200529     C                     ENDIF                                                              CSD015
023840200529     C                     ENDIF                                                              CSD015
023850200529      *                                                                                       CSD015
023860200529      ** Check if function code is being monitored by compliance watch.                       CSD015
023870200529      *                                                                                       CSD015
023880200529     C           CSD015    IFEQ 'Y'                                                           CSD015
023890200529      *                                                                                       CSD015
023900200529     C                     CALL 'AOWLCCR0'                                                    CSD015
023910200529     C                     PARM *BLANKS   @RTCD                                               CSD015
023920200529     C                     PARM '*KEY   ' @OPTN                                               CSD015
023930200529     C                     PARM 'SECTTRAD'PFUNC   8                                           CSD015
023940200529     C           SDWLCC    PARM SDWLCC    DSFDY                                               CSD015
023950200529      *                                                                                       CSD015
023960200529      ** If return code not blank, then issue database error.                                 CSD015
023970200529      *                                                                                       CSD015
023980200529     C           @RTCD     IFNE *BLANKS                                                       CSD015
023990200529     C           @RTCD     ANDNE'*NRF   '                                                     CSD015
024000200529     C                     MOVE 'SECTTRAD'DBKEY                                               CSD015
024010200529     C                     MOVE 'SDWLCCPD'DBFILE                                ************  CSD015
024020200529     C                     MOVE 29        DBASE                                 *DBERR 29  *  CSD015
024030200529     C                     EXSR *PSSR                                           ************  CSD015
024040200529     C                     ENDIF                                                              CSD015
024050200529      *                                                                                       CSD015
024060200529      ** Call access program AOCWCDR0 for Private Customer                                    CSD015
024070200529      ** Industry Code                                                                        CSD015
024080200529      *                                                                                       CSD015
024090200529     C                     CALL 'AOCWCDR0'                                                    CSD015
024100200529     C                     PARM *BLANKS   @RTCD                                               CSD015
024110200529     C                     PARM '*FIRST ' @OPTN                                               CSD015
024120200529     C           SDCWCD    PARM SDCWCD    DSSDY                                               CSD015
024130200529      *                                                                                       CSD015
024140200529      ** If no record is found on SDCWCDPD                                                    CSD015
024150200529      *                                                                                       CSD015
024160200529     C           @RTCD     IFNE *BLANKS                                                       CSD015
024170200529     C           @RTCD     ANDNE'*NRF   '                                                     CSD015
024180200529     C           *LOCK     IN   LDA                                                           CSD015
024190200529     C                     MOVEL'*FIRST'  DBKEY                                               CSD015
024200200529     C                     MOVEL'SDCWCDPD'DBFILE                                              CSD015
024210200529     C                     Z-ADD45        DBASE                                               CSD015
024220200529     C                     OUT  LDA                                                           CSD015
024230200529     C                     EXSR *PSSR                                                         CSD015
024240200529     C                     ENDIF                                                              CSD015
024250200529     C                     ENDIF                                                              CSD015
024260200529      *                                                                                       CSD015
024270200529      ** Check Concord Interface Development is installed.                                    CSD015
024280200529      *                                                                                       CSD015
024290200529     C                     CALL 'AOSARDR0'                                                    CSD015
024300200529     C                     PARM '       ' @RTCD                                               CSD015
024310200529     C                     PARM '*VERIFY' @OPTN                                               CSD015
024320200529     C                     PARM 'CCF001'  @SARD   6                                           CSD015
024330200529     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
024340200529      *                                                                                       CSD015
024350200529     C                     MOVEL'N'       CCF001  1                                           CSD015
024360200529     C           @RTCD     IFEQ *BLANKS                                                       CSD015
024370200529     C                     MOVEL'Y'       CCF001                                              CSD015
024380200529     C                     ELSE                                                               CSD015
024390200529     C           @RTCD     IFNE '*NRF   '                                                     CSD015
024400200529     C           *LOCK     IN   LDA                                                           CSD015
024410200529     C                     MOVEL'CCF001'  DBKEY                                               CSD015
024420200529     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
024430200529     C                     Z-ADD44        DBASE                                               CSD015
024440200529     C                     OUT  LDA                                                           CSD015
024450200529     C                     EXSR *PSSR                                                         CSD015
024460200529     C                     ENDIF                                                              CSD015
024470200529     C                     ENDIF                                                              CSD015
024480200529     C*                                                                   S01408
024490200529      ** Check if CRE020 is enabled.                                                          CRE020
024500200529      *                                                                                       CRE020
024510200529     C                     CALL 'AOSARDR0'                                                    CRE020
024520200529     C                     PARM *BLANKS   PRTCD                                               CRE020
024530200529     C                     PARM '*VERIFY' POPTN                                               CRE020
024540200529     C                     PARM 'CRE020'  PSARD   6                                           CRE020
024550200529     C           SCSARD    PARM SCSARD    DSFDY                                               CRE020
024560200529      *                                                                                       CRE020
024570200529     C                     MOVE 'N'       CRE020  1                                           CRE020
024580200529     C           PRTCD     IFEQ *BLANKS                                                       CRE020
024590200529     C                     MOVE 'Y'       CRE020                                              CRE020
024600200529     C                     MOVEL'SE0170'  KPRGMN                                              CRE020
024610200529     C                     ELSE                                                               CRE020
024620200529     C           PRTCD     IFNE '*NRF   '                                                     CRE020
024630200529     C           *LOCK     IN   LDA                                                           CRE020
024640200529     C                     MOVEL'SCSARDPD'DBFILE                                              CRE020
024650200529     C                     MOVEL'CRE020'  DBKEY                                               CRE020
024660200529     C                     Z-ADD46        DBASE                                               CRE020
024670200529     C                     OUT  LDA                                                           CRE020
024680200529     C                     EXSR *PSSR                                                         CRE020
024690200529     C                     ENDIF                                                              CRE020
024700200529     C                     ENDIF                                                              CRE020
024710200529      *                                                                                       CRE020
024720200529      ** Check if a System Value exists for this maintenance.                                 CRE020
024730200529      *                                                                                       CRE020
024740200529     C           CRE020    IFEQ 'Y'                                                           CRE020
024750200529      *                                                                                       CRE020
024760200529     C                     CALL 'AOSVALR0'                                                    CRE020
024770200529     C                     PARM *BLANKS   PRTCD                                               CRE020
024780200529     C                     PARM WPSET     PSV01  20                                           CRE020
024790200529     C                     PARM           PCS01 200                                           CRE020
024800200529     C                     PARM           PSV02  20                                           CRE020
024810200529     C                     PARM           PCS02 200                                           CRE020
024820200529     C                     PARM           PSV03  20                                           CRE020
024830200529     C                     PARM           PCS03 200                                           CRE020
024840200529     C                     PARM           PSV04  20                                           CRE020
024850200529     C                     PARM           PCS04 200                                           CRE020
024860200529     C                     PARM           PSV05  20                                           CRE020
024870200529     C                     PARM           PCS05 200                                           CRE020
024880200529     C                     PARM           PSV06  20                                           CRE020
024890200529     C                     PARM           PCS06 200                                           CRE020
024900200529     C                     PARM           PSV07  20                                           CRE020
024910200529     C                     PARM           PCS07 200                                           CRE020
024920200529     C                     PARM           PSV08  20                                           CRE020
024930200529     C                     PARM           PCS08 200                                           CRE020
024940200529     C                     PARM           PSV09  20                                           CRE020
024950200529     C                     PARM           PCS09 200                                           CRE020
024960200529     C                     PARM           PSV10  20                                           CRE020
024970200529     C                     PARM           PCS10 200                                           CRE020
024980200529      *                                                                                       CRE020
024990200529     C                     MOVE 'N'       WSV01   1                                           CRE020
025000200529      *                                                                                       CRE020
025010200529     C           PRTCD     IFEQ *BLANKS                                                       CRE020
025020200529     C                     MOVELPCS01     WSV01                                               CRE020
025030200529     C                     ELSE                                                               CRE020
025040200529      *                                                                                       CRE020
025050200529     C           PRTCD     IFNE '*NRF'                                                        CRE020
025060200529     C           *LOCK     IN   LDA                                                           CRE020
025070200529     C                     MOVEL'SDSVALPD'DBFILE                                              CRE020
025080200529     C                     MOVELPSV01     DBKEY                                               CRE020
025090200529     C                     Z-ADD102       DBASE                                               CRE020
025100200529     C                     OUT  LDA                                                           CRE020
025110200529     C                     EXSR *PSSR                                                         CRE020
025120200529     C                     ENDIF                                                              CRE020
025130200529      *                                                                                       CRE020
025140200529     C                     ENDIF                                                              CRE020
025150200529      *                                                                                       CRE020
025160200529     C                     ENDIF                                                              CRE020
025170200529      *                                                                                       CRE020
025180200529      ** Check if CGL031 (Taxation of Savings Income) is enabled.                             233711
025190200529      *                                                                                       233711
025200200529     C                     CALL 'AOSARDR0'                                                    233711
025210200529     C                     PARM *BLANKS   PRTCD                                               233711
025220200529     C                     PARM '*VERIFY' POPTN                                               233711
025230200529     C                     PARM 'CGL031'  PSARD   6                                           233711
025240200529     C           SCSARD    PARM SCSARD    DSFDY                                               233711
025250200529      *                                                                                       233711
025260200529     C                     MOVE 'N'       CGL031  1                                           233711
025270200529     C           PRTCD     IFEQ *BLANKS                                                       233711
025280200529     C                     MOVE 'Y'       CGL031                                              233711
025290200529     C                     ELSE                                                               233711
025300200529      *                                                                                       233711
025310200529     C           PRTCD     IFNE '*NRF   '                                                     233711
025320200529     C           *LOCK     IN   LDA                                                           233711
025330200529     C                     MOVEL'SCSARDPD'DBFILE                                              233711
025340200529     C                     MOVEL'CGL031'  DBKEY                                               233711
025350200529     C                     Z-ADD101       DBASE                                               233711
025360200529     C                     OUT  LDA                                                           233711
025370200529     C                     MOVE *ON       *INU7                                               233711
025380200529     C                     MOVE *ON       *INU8                                               233711
025390200529     C                     MOVE *ON       *INLR                                               233711
025400200529     C                     EXSR *PSSR                                                         233711
025410200529     C                     ENDIF                                                              233711
025420200529      *                                                                                       233711
025430200529     C                     ENDIF                                                              233711
025440200529      *                                                                                       233711
025450200529     C                     ENDSR
025460200529     C*
025470200529     C*****************************************************************
025480200529      /EJECT
025490200529     C*****************************************************************
025500200529     C*                                                               *
025510200529     C*  START  - S/R TO OUTPUT AND PROCESS KEY FIELDS SCREEN         *
025520200529     C*  CALLED FROM: MAIN PROCESSING                                 *
025530200529     C*  CALLS: VALIDK TO VALIDATE KEY FIELDS IF ENTERED              *
025540200529     C*                                                               *
025550200529     C*****************************************************************
025560200529     C*
025570200529     C           START     BEGSR                           ** START BSR **
025580200529     C*
025590200529     C**  INITIALISE SCREEN DATA
025600200529     C*
025610200529     C                     MOVEA'0'       *IN,10
025620200529     C                     MOVEA'000000'  *IN,21
025630200529     C                     MOVE '0'       *IN89
025640200529     C                     MOVEL*BLANK    SCRCTL
025650200529     C**********           MOVELINF,1     INFMSG                                            AR324886
025660200529     C                     MOVELINF,16    INFMSG                                            AR324886
025670200529     C                     MOVE *BLANKS   XSFRNO
025680200529     C                     MOVE 'Y'       @DPTXB                          185811
025690200529     C                     MOVE 'N'       W1STPS  1                                         AR851784
025700200529      *                                                                   CSE023
025710200529      ** Reset processing for CSE023 STARTS here.                         CSE023
025720200529      **  Initialize CSE023 error indicators, screen fields and work      CSE023
025730200529      **  variables appropriately.                                        CSE023
025740200529      *                                                                   CSE023
025750200529     C           CSE023    IFEQ 'Y'                                       CSE023
025760200529     C                     MOVE '1'       *IN20                           CSE023
025770200529     C**********           Z-ADD0         KYCSCN  60                                   CSE023 CSD027
025780200529     C                     MOVE *BLANKS   KYCSCN  6                                           CSD027
025790200529     C                     MOVEL*BLANKS   KYCSNO  6                       CSE023
025800200529     C                     MOVEL*BLANKS   KYCRTT  2                       CSE023
025810200529     C                     MOVEL*BLANKS   KYBNFO 26                       CSE023
025820200529     C                     MOVEL*BLANKS   KYBNFN 26                       CSE023
025830200529     C                     MOVEL*BLANKS   KYPBCA  3                       CSE023
025840200529     C                     MOVEL*BLANKS   WITTAX  6                       CSE023
025850200529     C                     MOVEL*BLANKS   WFREEM  1                       CSE023
025860200529     C                     MOVEL*BLANKS   WTBNAR 15                       CSE023
025870200529     C                     MOVEL*BLANKS   WTEMP1  5                       CSE023
025880200529     C                     MOVEL*BLANKS   WTEMP2  7                       CSE023
025890200529     C                     MOVEL*BLANKS   WTEMP3 13                       CSE023
025900200529     C                     MOVEL*BLANKS   WTEMP4 19                       CSE023
025910200529     C                     MOVEL*BLANKS   STXBS                           CSE023
025920200529     C                     MOVEL*BLANKS   SBNFO                           CSE023
025930200529     C                     MOVEL*BLANKS   SEXCD                           CSE023
025940200529     C                     MOVEL*BLANKS   RPCD                            CSE023
025950200529     C                     MOVE *BLANKS   DEPT                            CSE023
025960200529     C                     MOVEA'000'     *IN,57                          CSE023
025970200529     C                     ELSE                                           CSE023
025980200529     C                     MOVE '0'       *IN20                           CSE023
025990200529     C                     MOVEL*BLANKS   TXBS                            CSE023
026000200529     C                     MOVEL*BLANKS   TXBN                            CSE023
026010200529     C                     MOVEL*BLANKS   EXCD                            CSE023
026020200529     C                     MOVEL*BLANKS   CRTX                            CSE023
026030200529     C                     MOVEL*BLANKS   RPCD                            CSE023
026040200529     C                     MOVEL*BLANKS   ICTP                            CSE023
026050200529     C                     MOVEL*BLANKS   BNFO                            CSE023
026060200529     C                     MOVE 'N'       MT5R                            CSE023
026070200529     C                     MOVE 'N'       MT5G                            CSE023
026080200529     C                     MOVEL*BLANKS   CTYP                            CSE023
026090200529     C                     MOVEL*BLANKS   PREF                            CSE023
026100200529     C                     MOVEL*BLANKS   CTIN                            CSE023
026110200529     C                     Z-ADD0         PSEQ                            CSE023
026120200529     C                     Z-ADD0         DAMT                            CSE023
026130200529     C                     MOVE *BLANKS   DEPT                            CSE023
026140200529     C                     ENDIF                                          CSE023
026150200529      *                                                                   CSE023
026160200529      ** Reset processing for CSE023 ENDS here.                           CSE023
026170200529      *                                                                                       233711
026180200529     C           CGL031    IFEQ 'Y'                                                           233711
026190200529     C                     MOVE *BLANKS   STXNM                                               233711
026200200529     C                     ENDIF                                                              233711
026210200529     C*
026220200529     C**  CLEAR WHOLE SCREEN
026230200529     C*
026240200529     C/COPY WNCPYSRC,SE0170C098
026250200529     C                     WRITECLSCREEN
026260200529     C/COPY WNCPYSRC,SE0170C099
026270200529     C                     MOVE 'L'       PPALL                           S01496
026280200529     C*
026290200529     C** D O   U N T I L   C H A N G E  O F  S C R E E N  -  S T A R T
026300200529     C*
026310200529     C           *IN10     DOUEQ'1'
026320200529     C           *IN11     OREQ '1'
026330200529     C           *IN12     OREQ '1'
026340200529      *
026350200529      ***  Start Screen Output
026360200529      *
026370200529     C/COPY WNCPYSRC,SE0170C100
026380200529     C                     MOVE *OFF      *IN11                           186400
026390200529     C**********           WRITEKEYINPUT                                                     BUG1992
026400200529     C           INFMSG    IFEQ *BLANKS                                   084981
026410200529     C**********           MOVELINF,1     INFMSG                                     S01117 AR324886
026420200529     C                     MOVELINF,16    INFMSG                                            AR324886
026430200529     C                     ENDIF                                          084981
026440200529     C                     WRITEMESSAGES
026450200529     C                     WRITEKEYINPUT                                                     BUG1992
026460200529     C                     READ KEYINPUT                 99
026470200529     C/COPY WNCPYSRC,SE0170C101
026480200529     C                     MOVELERRMSG    HERCD 160
026490200529     C                     MOVELWBLNK     HERCD
026500200529     C                     MOVEL*BLANK    SCRMSG
026510200529     C*
026520200529     C***C*K*3*,*H*E*L*P*,*O*R**E*N*T*E*R***P*R*E*S*S*E*D**-**S*T*A*R*T
026530200529     C** C K 3 , O R  E N T E R   P R E S S E D  -  S T A R T
026540200529     C*
026550200529     C** Call S/R to move values into AID                                 S01179
026560200529     C*                                                                   S01179
026570200529     C                     EXSR ASCHGS                                    S01179
026580200529     C*
026590200529     C** CK3 - TERMINATE
026600200529     C*
026610200529     C           AID       IFEQ '01'
026620200529     C                     MOVEA'1'       *IN,10
026630200529     C*
026640200529     C***HELP***CALL*HELP*PROGRAM**************************************   S01199
026650200529     C***********                                                         S01199
026660200529     C***********          ELSE                                           S01199
026670200529     C***********AID       IFEQ 'HP'                                      S01199
026680200529     C***********          MOVELHERCD     ERRMSG                          S01199
026690200529     C***********ERR,1     IFNE *BLANK                                    S01199
026700200529     C***********          MOVELHI        ERRMSG                          S01199
026710200529     C***********          END                             *ERR,1         S01199
026720200529     C***********          CALL 'MHELP'                                   S01199
026730200529     C***********          PARM           HBPGM                           S01199
026740200529     C***********          PARM           HERCD                           S01199
026750200529     C*
026760200529     C***ENTER*TAKEN*VALIDATE*KEY*INPUT*********                          S01117
026770200529     C*
026780200529     C                     ELSE
026790200529     C*                                                                   084981
026800200529     C** If F12 is taken, display error message                           084981
026810200529     C*                                                                   084981
026820200529     C           AID       IFEQ '05'                                      084981
026830200529     C                     MOVELINF,14    INFMSG                          084981
026840200529     C                     ELSE                                           084981
026850200529     C*                                                                   S01117
026860200529     C**  Enter taken, check for query selection                          S01117
026870200529     C*                                                                   S01117
026880200529     C                     MOVE '0'       *IN22                           S01117
026890200529     C                     MOVE '0'       *IN24                           S01117
026900200529     C                     EXSR D1QRY                                     S01117
026910200529     C           RDSPLY    IFEQ 'N'                                       S01117
026920200529     C*                                                                   S01117
026930200529     C**  Validate key input                                              S01117
026940200529     C*                                                                   S01117
026950200529     C                     Z-ADD0         EC                              084981
026960200529     C                     Z-ADD0         WEC                                                 222756
026970200529     C                     EXSR VALIDK
026980200529     C           EC        IFNE *ZERO                                     084981
026990200529     C                     MOVELHI        ERRMSG                          084981
027000200529     C                     MOVEL*BLANK    AID                             084981
027010200529     C                     END                                            084981
027020200529      *
027030200529     C** IF NO ERRORS, DETERMINE NEXT SCREEN
027040200529      ** or if only warning messages are shown, proceed to the next                           222756
027050200529      ** screen.                                                                              222756
027060200529     C*
027070200529     C           SCRMSG    IFEQ *BLANK
027080200529     C           EC        OREQ WEC                                                           222756
027090200529      *                                                                   185811
027100200529      ** Continue normial processing if CSE023 is OFF                     185811
027110200529      ** If CSE023 is ON, after tax basket default is displayed on        185811
027120200529      ** screen.                                                          185811
027130200529      *                                                                   185811
027140200529     C           CSE023    IFEQ 'N'                                       185811
027150200529     C           CSE023    OREQ 'Y'                                       185811
027160200529     C           @DPTXB    ANDEQ'Y'                                       185811
027170200529     C*
027180200529     C**  - IF KEY FIELD IS BLANK, NEXT SCREEN IS REVIEW SCREEN
027190200529     C*
027200200529     C           INPK      IFEQ *BLANK
027210200529     C                     MOVEA'1'       *IN,11
027220200529     C*
027230200529     C**  - OTHERWISE, DISPLAY REQUESTED DETAIL SCREEN AS PER KEY INPUT
027240200529     C*
027250200529     C                     ELSE
027260200529     C                     MOVEA'1'       *IN,12
027270200529     C                     END
027280200529     C*                                                                   185811
027290200529     C                     END                                            185811
027300200529     C*
027310200529     C                     END
027320200529     C                     END                                            S01117
027330200529     C*
027340200529     C***C*K*3*,*H*E*L*P*,*O*R**E*N*T*E*R***P*R*E*S*S*E*D**-**E*N*D       S01199
027350200529     C** C K 3 , O R  E N T E R   P R E S S E D  -  E N D                 S01199
027360200529     C*
027370200529     C***********          END                             *AID=HP        S01199
027380200529     C                     END                                            084981
027390200529     C                     END
027400200529     C*
027410200529     C** D O    U N T I L   C H A N G E  O F  S C R E E N  -  E N D
027420200529     C                     END
027430200529     C*
027440200529     C                     ENDSR
027450200529     C*
027460200529     C*****************************************************************
027470200529      /EJECT
027480200529     C*****************************************************************
027490200529     C*                                                               *
027500200529     C*  REVIEW  - S/R TO PROCESS SUBFILE SELECTION SCREEN            *
027510200529     C*  CALLED FROM: MAIN PROCESSING                                 *
027520200529     C*  CALLS: VALIDK TO VALIDATE KEY FIELDS IF SUBFILE RECORD       *
027530200529     C*         SELECTED ZDATE2                                       *
027540200529     C*****************************************************************
027550200529     C*
027560200529     C           REVIEW    BEGSR                           ** REVIEW BSR**
027570200529     C*
027580200529     C                     MOVEA'0'       *IN,11
027590200529     C*
027600200529     C**  SET PROCESSING FLAG TO FORCE SUBFILE REBUILD
027610200529     C*
027620200529     C                     MOVEL'RA'      AID
027630200529     C*                                                                   S01496
027640200529     C***FOR*LIVE/ALL*FIELD*SET*TO*'L'*OVERRIDE*POSETX*TO*POSET****S01496 084981
027650200529     C***FOR*LIVE/ALL*FIELD*SET*TO*'L'*OVERRIDE*POSETX*TO*POSET2   084981 186055
027660200529     C** FOR LIVE/ALL FIELD SET TO 'L' OVERRIDE POSETX TO POSET8          186055
027670200529     C*                                                                   S01496
027680200529     C           S01496    IFEQ 'Y'                                       S01496
027690200529     C           CSE007    OREQ 'Y'                                       CSE007
027700200529     C           CEU017    OREQ 'Y'                                       CEU017
027710200529     C*                                                                   S01408
027720200529     C/COPY WNCPYSRC,SE0170CCP8                                           S01408
027730200529     C*                                                                   S01408
027740200529     C           PPALL     IFEQ 'L'                                       S01496
027750200529     C                     CLOSEPOSETX                                    S01496
027760200529     C                     CALL 'QCMDEXC'                                 S01496
027770200529     C                     PARM           CCOVRL                          S01496
027780200529     C***********          PARM 32        WWOVL  155               S01496 084981
027790200529     C                     PARM 33        WWOVL  155                      084981
027800200529     C                     OPEN POSETX                                    S01496
027810200529     C                     ENDIF                                          S01496
027820200529     C                     ENDIF                                          S01496
027830200529     C***********                                                         084981
027840200529     C***D*O****U*N*T*I*L***C*H*A*N*G*E**O*F**S*C*R*E*E*N**-**S*T*A*R*T*  084981
027850200529     C***********                                                         084981
027860200529     C************IN10     DOUEQ'1'                                       084981
027870200529     C************IN11     OREQ '1'                                       084981
027880200529     C************IN12     OREQ '1'                                       084981
027890200529     C***********                                                         084981
027900200529     C***I*F**R*O*L*L***U*P*/*D*O*W*N***O*R***E*N*T*E*R***P*R*E*S*S*E*D** 084981
027910200529     C***********                                                         084981
027920200529     C***R*E*B*U*I*L*D***S*U*B*F*I*L*E*********************-**S*T*A*R*T** 084981
027930200529     C***********                                                         084981
027940200529     C***-*not*if*error*found******************************************** 084981
027950200529     C***********                                                         084981
027960200529     C***********SCRMSG    IFEQ *BLANKS                                   084981
027970200529     C***********          MOVE *BLANKS   XSFRNO                          084981
027980200529     C***********                                                         084981
027990200529     C***********AID       IFEQ 'DN'                                      084981
028000200529     C***********AID       OREQ 'UP'                                      084981
028010200529     C***********AID       OREQ 'RA'                                      084981
028020200529     C***********          MOVE AID       SAVAID  2                E28805 084981
028030200529     C***********                                                         084981
028040200529     C***WRITE*CONTROL*RECORD*********************************************084981
028050200529     C***********                                                         084981
028060200529     C***********          MOVEA'000'     *IN,1                           084981
028070200529     C***********          Z-ADD*ZERO     RRN                             084981
028080200529     C***********          WRITESUBFLCTL                                  084981
028090200529     C***********          MOVEA'1'       *IN,4                           084981
028100200529     C***********                                                         E28805
028110200529     C***SET*FILE POINTER - PAGE BACK                                     E28805
028120200529     C***********                                                         E28805
028130200529     C****If*rolldown                                                     E28805
028140200529     C***********                                                         E28805
028150200529     C***********AID       IFEQ 'DN'                                      E28805
028160200529     C***********          Z-ADD0         PBCH                     S01117 E28805
028170200529     C***********          MOVEL*BLANK    PBCA                     S01117 E28805
028180200529     C***********          MOVEL*BLANK    PSSH                            E28805
028190200529     C***********          Z-ADD0         PCPY                            E28805
028200200529     C***********          Z-ADD0         PDUD                            E28805
028210200529     C***********          MOVEL*BLANK    PEVT                            E28805
028220200529     C***********          MOVEL*BLANK    PPAGK 031        *SAVE          E28805
028230200529     C***********POSETK    SETLLPOSETX                                    E28805
028240200529     C***********                                                  E28805 084981
028250200529     C***Set*file*pointer*and*read*previous*two*pages*worth********E28805 084981
028260200529     C***ignoring*matured*records*as*these*are*not*displayed.******E28805 084981
028270200529     C***If*begining*of*file*reached*set*file*pointer*to*top.******E28805 084981
028280200529     C***********                                                  E28805 084981
028290200529     C***Rolldown**************************************************E28805 084981
028300200529     C***********                                                  E28805 084981
028310200529     C***********SAVAID    IFEQ 'DN'                               E28805 084981
028320200529     C***********          MOVEL*BLANK    PTFR                     S01486 084981
028330200529     C***********BGPFMG    IFEQ 'Y'                                S01486 084981
028340200529     C***********PTFRK     SETLLPOSETX                             S01486 084981
028350200529     C***********          ELSE                                    S01486 084981
028360200529     C***********POSETK    SETLLPOSETX                             E28805 084981
028370200529     C***********          END                                     S01486 084981
028380200529     C***********          Z-ADD0         X       20               E28805 084981
028390200529     C***********                                                  E28805 084981
028400200529     C***********X         DOUEQ28                                 E28805 084981
028410200529     C************IN03     OREQ '1'                                E28805 084981
028420200529     C***********          READPPOSETX                   03        E28805 084981
028430200529     C***********                                                  E28805 084981
028440200529     C***Ignore*matured*records************************************E28805 084981
028450200529     C***********                                                  E28805 084981
028460200529     C***********RECI      IFNE 'M'                                E28805 084981
028470200529     C***********          ADD  1         X                        E28805 084981
028480200529     C***********          END                                     E28805 084981
028490200529     C************IN03     IFEQ '1'                                E28805 084981
028500200529     C************LOVAL    SETLLPOSETX                             E28805 084981
028510200529     C***********          END                                     E28805 084981
028520200529     C***********          END                                     E28805 084981
028530200529     C***********                                                         084981
028540200529     C****OTHERWISE*-*PAGE*FORWARD*************************************   084981
028550200529     C***********                                                         084981
028560200529     C***********          ELSE                                           084981
028570200529     C***********          MOVELPPBCH     PBCH                            S01117
028580200529     C***********          MOVELPPBCA     PBCA                            S01117
028590200529     C***********          MOVELPPSSH     PSSH                            084981
028600200529     C***********          MOVELPPCPY     PCPY                            084981
028610200529     C***********BGPFMG    IFEQ 'Y'                                S01486 084981
028620200529     C***********PPTFR     IFEQ FCR997                             S01486 084981
028630200529     C***********          MOVE FCR997    PTFR                     S01486 084981
028640200529     C***********          ELSE                                    S01486 084981
028650200529     C***********          MOVELPPTFR     PTFR                     S01486 084981
028660200529     C***********          END                                     S01486 084981
028670200529     C***********          ELSE                                           S01486
028680200529     C***********          MOVELPPTFR     PTFR                            S01486
028690200529     C***********          END                                     S01486 084981
028700200529     C***********                                                         084981
028710200529     C****Convert*due*date*to*stored*format****************************   084981
028720200529     C***********                                                         084981
028730200529     C***********PPDUD     IFEQ *BLANKS                                   084981
028740200529     C***********          Z-ADD0         PDUD                            084981
028750200529     C***********          ELSE                                           084981
028760200529     C***********                                                         084981
028770200529     C****Translate*and*convert*date***********************************   084981
028780200529     C***********                                                         084981
028790200529     C***********          MOVE PPDUD     PPDUDN  60                      084981
028800200529     C***********          MOVE PPDUDN    PPDUDA  6                       084981
028810200529     C***********PPDUD     COMP PPDUDA               9999                 084981
028820200529     C************IN99     IFNE '1'                                       084981
028830200529     C***********          Z-ADDPPDUDN    ZDATE                           084981
028840200529     C***********          EXSR ZDATE1                                    084981
028850200529     C***********          END                                            084981
028860200529     C************IN99     IFEQ '1'                                       084981
028870200529     C***********                                                         084981
028880200529     C****Date*in*error************************************************   084981
028890200529     C***********                                                         084981
028900200529     C***********          Z-ADD0         PDUD                            084981
028910200529     C***********          ELSE                                           084981
028920200529     C***********          Z-ADDZDAYNO    PDUD                            084981
028930200529     C***********          END                                            084981
028940200529     C***********          END                                            084981
028950200529     C***********          MOVELPPEVT     PEVT                            084981
028960200529     C** FOLLOWING LINES REMOVED BY REVIEWER                              S01486
028970200529     C** NO NEED TO DO PROCESSING TWICE                                   S01486
028980200529     C************                                                        S01486
028990200529     C***PORTFOLIO REFERENCE                                              S01486
029000200529     C************                                                        S01486
029010200529     C*******IF*PORTFOLIO MANAGEMENT INSTALLED                            S01486
029020200529     C************                                                        S01486
029030200529     C***********BGPFMG    IFEQ 'Y'                                       S01486
029040200529     C************                                                        S01486
029050200529     C***...*If*portfolio reference on record = '9997' then output 'C'    S01486
029060200529     C*******Else*output the portfolio reference from file                S01486
029070200529     C************                                                        S01486
029080200529     C***********PPTFR     IFEQ FCR997                                    S01486
029090200529     C************         MOVE '9997'    PTFR                            S01486
029100200529     C************                                                        S01486
029110200529     C*******Else*output the portfolio reference from file                S01486
029120200529     C************                                                        S01486
029130200529     C************         ELSE                                           S01486
029140200529     C************         MOVE PPTFR     PTFR                            S01486
029150200529     C************         END                                            S01486
029160200529     C************         END                                            S01486
029170200529     C***********                                                  S01486 084981
029180200529     C***********                                                  S01486 084981
029190200529     C*******Also*different*key*depending*on*whether*PM*installed**S01486 084981
029200200529     C***********                                                  S01486 084981
029210200529     C***********BGPFMG    IFEQ 'Y'                                S01486 084981
029220200529     C***********PTFRK     SETGTPOSETX                     *ROLLUP S01486 084981
029230200529     C***********          ELSE                                    S01486 084981
029240200529     C***********POSETK    SETLLPOSETX                     *ROLLUP        084981
029250200529     C***********          END                                            084981
029260200529     C***********          END                                     S01486 084981
029270200529     C***********                                                         084981
029280200529     C***READ*IN*DETAILS*-*FILL*UP*SUBFILE*****************************   084981
029290200529     C***********                                                         084981
029300200529     C***********          MOVEL*BLANKS   SAVBA                    S01117 084981
029310200529     C***********RRN       DOUEQ14                                        084981
029320200529     C************IN,03    OREQ '1'                                       084981
029330200529     C***********                                                         084981
029340200529     C***READ*DETAILS*UNTIL*SUBFILE*PAGE*IS*FULL***********************   084981
029350200529     C***********                                                         084981
029360200529     C***********          READ POSETX                   03*              084981
029370200529     C***********                                                         084981
029380200529     C****Check*user*is*authorised*to*branch*on*position*record****S01117 084981
029390200529     C****before*building*subfile**********************************S01117 084981
029400200529     C***********                                                  S01117 084981
029410200529     C***********PBCA      IFNE SAVBA                              S01117 084981
029420200529     C***********          Z-ADD0         @ERR                     S01117 084981
029430200529     C************IN81     IFEQ 'Y'                                S01117 084981
029440200529     C***********          CALL 'ZVBBU'                            S01117 084981
029450200529     C***********          PARM PBCA      @ZBRCD  3                S01117 084981
029460200529     C***********          PARM           @ERR    10               S01117 084981
029470200529     C***********          END                                     S01117 084981
029480200529     C***********          END                                     S01117 084981
029490200529     C***********                                                  S01117 084981
029500200529     C***********@ERR      IFEQ 0                                  S01117 084981
029510200529     C***********                                                  E14884 084981
029520200529     C****IGNORE*RECORDS*WITH*RECORD*ID*OF*'M'*********************E14884 084981
029530200529     C***********                                                  E14884 084981
029540200529     C***********RECI      IFNE 'M'                                E14884 084981
029550200529     C***********S01496    ANDNE'Y'                                S01496 084981
029560200529     C***********                                                  S01496 084981
029570200529     C***********S01496    OREQ 'Y'                                S01496 084981
029580200529     C***********                                                  E14884 084981
029590200529     C************IN,03    IFEQ '0'                                       084981
029600200529     C***********                                                  S01496 084981
029610200529     C****If*Jyske*Enhancements*feature*is*not*installed***********S01496 084981
029620200529     C***********                                                  S01496 084981
029630200529     C***********S01496    IFNE 'Y'                                S01496 084981
029640200529     C***********                                                         084981
029650200529     C***IF*RECORD*IS*DELETED,*FLAG*IT*AS*SO*ON*SCREEN*****************   084981
029660200529     C***********                                                         084981
029670200529     C***********RECI      IFEQ '*'                                       084981
029680200529     C***********          MOVEL'D'       STAT    1                       084981
029690200529     C***********          ELSE                                           084981
029700200529     C***********          MOVEL*BLANK    STAT                            084981
029710200529     C***********          END                                            084981
029720200529     C***********                                                  S01496 084981
029730200529     C***********          ELSE                                    S01496 084981
029740200529     C***********                                                  S01496 084981
029750200529     C***IF*RECORD*IS*MATURED/REVERSED,*FLAG*IT*AS*SO*ON*SCREEN****S01496 084981
029760200529     C***********RECI      IFNE 'D'                                S01496 084981
029770200529     C***********RECI      IFEQ '*'                                S01496 084981
029780200529     C***********          MOVEL'D'       STAT    1        *STATUS=S01496 084981
029790200529     C***********          ELSE                                    S01496 084981
029800200529     C***********          MOVE RECI      STAT                     S01496 084981
029810200529     C***********          END                                     S01496 084981
029820200529     C***********          ELSE                                    S01496 084981
029830200529     C***********          MOVEL*BLANK    STAT             *OR LIVES01496 084981
029840200529     C***********          END                             *RECI=* S01496 084981
029850200529     C***********                                                  S01496 084981
029860200529     C***********          END                                     S01496 084981
029870200529     C***********                                                         084981
029880200529     C***********          ADD  1         RRN     40     04               084981
029890200529     C***********                                                         084981
029900200529     C***********          MOVE ' '       ACTN                            084981
029910200529     C***********          MOVELPBCH      SPBCH                           S01117
029920200529     C***********          MOVELPBCA      SPBCA                    S01117 084981
029930200529     C***********          MOVELPSSH      SPSSH                           084981
029940200529     C***********          MOVELPCPY      SPCPY                           084981
029950200529     C***********          MOVELPEVT      SPEVT                           084981
029960200529     C***********                                                  S01486 084981
029970200529     C***IF*PORTFOLIO*MANAGEMENT*INSTALLED*************************S01486 084981
029980200529     C***********                                                  S01486 084981
029990200529     C***********BGPFMG    IFEQ 'Y'                                S01486 084981
030000200529     C***********PTFR      IFEQ '9997'                             S01486 084981
030010200529     C***********          MOVELFCR997    SPPTFR                   S01486 084981
030020200529     C***********          ELSE                                    S01486 084981
030030200529     C***********          MOVELPTFR      SPPTFR                   S01486 084981
030040200529     C***********          END                                     S01486 084981
030050200529     C***********          END                                     S01486 084981
030060200529     C***********                                                  S01486 084981
030070200529     C**WORK*OUT*DUE*DATE*FOR*SCREEN*******************************S01486 084981
030080200529     C***********                                                  S01486 084981
030090200529     C***********          Z-ADDPDUD      ZDAYNO                          084981
030100200529     C***********          EXSR ZDATE2                                    084981
030110200529     C***********          MOVELZDATE     SPDUD                           084981
030120200529     C***********                                                  S01512 084981
030130200529     C***If*S01512*is*active,*work*out*payment/value*date*for*screeS01512 084981
030140200529     C***********                                                  S01512 084981
030150200529     C***********S01512    IFEQ 'Y'                                S01512 084981
030160200529     C***********          Z-ADDPSVL      ZDAYNO                   S01512 084981
030170200529     C***********          EXSR ZDATE2                             S01512 084981
030180200529     C***********          MOVELZDATE     SFPSVL                   S01512 084981
030190200529     C***********          END                                     S01512 084981
030200200529     C***********                                                  S01512 084981
030210200529     C***********          MOVELPAUI      SPAUI                           084981
030220200529     C***********KEYFLD    IFEQ SAVFLD                             E37157 084981
030230200529     C***********          ADD  1         SEQ                      E37157 084981
030240200529     C***********          ELSE                                    E37157 084981
030250200529     C***********          Z-ADD1         SEQ                      E37157 084981
030260200529     C***********          MOVELKEYFLD    SAVFLD 31                E37157 084981
030270200529     C***********          END                                     E37157 084981
030280200529     C***********          WRITESUBFLREC                                  084981
030290200529     C***********                                                         084981
030300200529     C***RECORD*NOW*WRITTEN*TO*SUBFILE*********************************   084981
030310200529     C***********                                                         084981
030320200529     C***********          END                                            084981
030330200529     C***********          ELSE                                    E37157 084981
030340200529     C***********          MOVELPBCA      MPBCA                    E37157 084981
030350200529     C***********          MOVELPSSH      MPSSH                    E37157 084981
030360200529     C***********          MOVELPCPY      MPCPY                    E37157 084981
030370200529     C***********          MOVELPEVT      MPEVT                    E37157 084981
030380200529     C***********          Z-ADDPDUD      ZDAYNO                   E37157 084981
030390200529     C***********          EXSR ZDATE2                             E37157 084981
030400200529     C***********          MOVELZDATE     MPDUD                    E37157 084981
030410200529     C***********MTYFLD    IFEQ SAVFLD                             E37157 084981
030420200529     C***********          ADD  1         SEQ                      E37157 084981
030430200529     C***********          ELSE                                    E37157 084981
030440200529     C***********          Z-ADD1         SEQ                      E37157 084981
030450200529     C***********          MOVELMTYFLD    SAVFLD                   E37157 084981
030460200529     C***********          END                                     E37157 084981
030470200529     C***********          END                                     E14884 084981
030480200529     C***********          END                                     S01117 084981
030490200529     C***********                                                         084981
030500200529     C****Save*branch*code*for*authorisation*check*on*display******S01117 084981
030510200529     C***********                                                  S01117 084981
030520200529     C***********          MOVELPBCA      SAVBA   3                S01117 084981
030530200529     C***********                                                         084981
030540200529     C***PAGE*NOW*FULL*(OR*EOF)****************************************   084981
030550200529     C***********          END                                            084981
030560200529     C***********                                                         084981
030570200529     C***READ*ONE*MORE*RECORD*FOR*NEXT*SCREEN**********************       084981
030580200529     C***********                                                         084981
030590200529     C************IN,03    IFEQ '0'                                       084981
030600200529     C***********                                                         084981
030610200529     C****Check*user*is*authorised*to*branch*on*position*record****S01117 084981
030620200529     C****before*setting*'review*from'*key*************************S01117 084981
030630200529     C***********                                                  S01117 084981
030640200529     C***********@ERR      DOUEQ0                                  S01117 084981
030650200529     C***********          READ POSETX                   03               084981
030660200529     C************IN81     IFEQ 'Y'                                S01117 084981
030670200529     C***********          CALL 'ZVBBU'                            S01117 084981
030680200529     C***********          PARM PBCA      @ZBRCD  3                S01117 084981
030690200529     C***********          PARM           @ERR    10               S01117 084981
030700200529     C***********          END                                     S01117 084981
030710200529     C***********          END                                     S01117 084981
030720200529     C***********                                                  S01117 084981
030730200529     C***********          END                                            084981
030740200529     C***********                                                         084981
030750200529     C***SAVE*THE*'REVIEW*FROM'*KEY*FOR*THE*START*OF*THIS*CURRENT*PAGE*   084981
030760200529     C***********                                                         084981
030770200529     C**********           MOVELPAGK      PPAGK                    E20237 084981
030780200529     C***********          MOVELPAGK      PPAGK                    E20237 084981
030790200529     C***********                                                         084981
030800200529     C***IF*NOT*EOF*SET*NEXT*'REVIEW*FROM'*KEY*ELSE*SET*IT*TO*BLANK***    084981
030810200529     C***********                                                         084981
030820200529     C************IN,03    IFEQ '0'                                       084981
030830200529     C***********          MOVELINPK      PAGK                            084981
030840200529     C***********          ELSE                                           084981
030850200529     C***********          MOVEL*BLANK    PAGK                            084981
030860200529     C***********          END                                            084981
030870200529     C***********                                                         084981
030880200529     C***FOR*SUBFILE*CONTROL*******************************************   084981
030890200529     C***********                                                         084981
030900200529     C************IN,4     IFEQ '1'                                       084981
030910200529     C***********          MOVEA'010'     *IN,1                           084981
030920200529     C***********          ELSE                                           084981
030930200529     C***********          MOVEA'11'      *IN,1                           084981
030940200529     C***********          END                                            084981
030950200529     C***********          END                                            084981
030960200529     C***********                                                         084981
030970200529     C***R*E*B*U*I*L*D***S*U*B*F*I*L*E*****-*****E*N*D********************084981
030980200529     C***********          END                                            084981
030990200529      ***********                                                         084981
031000200529      *****Review*Screen*Output*******************************************084981
031010200529      ***********                                                         084981
031020200529     C***********          MOVELINF,2     INFMSG                          084981
031030200529     C***********          WRITESUBFLCTL                                  084981
031040200529     C***********          WRITEMESSAGES                                  084981
031050200529     C***********          READ SUBFLCTL                 99               084981
031060200529     C***********          MOVELERRMSG    HERCD                           084981
031070200529     C***********          MOVELWBLNK     HERCD                           084981
031080200529     C***********          MOVEL*BLANK    SCRMSG                          084981
031090200529     C***********          MOVEL*BLANK    REVW                            084981
031100200529     C***********          MOVEL*BLANKS   SAVFLD                   S01486 084981
031110200529     C***********                                                         084981
031120200529     C***C*K*3*,*C*K12*,*H*E*L*P*,*R*E*C*O*R*D**S*E*L*E*C*T-**S*T*A*R*T   S01199
031130200529     C***C*K*3*,*C*K12*,*R*E*C*O*R*D**S*E*L*E*C*T-**S*T*A*R*T******S01199 084981
031140200529     C***********                                                         084981
031150200529     C***Call*S/R*to*move*values*into*AID**************************S01179 084981
031160200529     C***********                                                  S01179 084981
031170200529     C***********          EXSR ASCHGS                             S01179 084981
031180200529     C***********                                                  S01179 084981
031190200529     C***CK3*-*TERMINATE***********************************************   084981
031200200529     C***********                                                         084981
031210200529     C***********AID       IFEQ '01'                                      084981
031220200529     C***********          MOVEA'1'       *IN,11                          084981
031230200529     C***********                                                         084981
031240200529     C***CK12**INITIAL*SCREEN******************************************   084981
031250200529     C***********                                                         084981
031260200529     C***********          ELSE                                           084981
031270200529     C***********AID       IFEQ '05'                                      084981
031280200529     C***********          MOVEA'1'       *IN,10                          084981
031290200529     C***********                                                         084981
031300200529     C***HELP***CALL*HELP*PROGRAM**************************************   S01199
031310200529     C***********                                                         S01199
031320200529     C***********          ELSE                                           S01199
031330200529     C***********AID       IFEQ 'HP'                                      S01199
031340200529     C***********          MOVELHERCD     ERRMSG                          S01199
031350200529     C***********ERR,1     IFNE *BLANK                                    S01199
031360200529     C***********          MOVELHI        ERRMSG                          S01199
031370200529     C***********          END                             *ERR,1         S01199
031380200529     C***********          CALL 'MHELP'                                   S01199
031390200529     C***********          PARM           HBPGM                           S01199
031400200529     C***********          PARM           HERCD                           S01199
031410200529     C***********                                                         084981
031420200529     C***ENTER*PRESSED,*PROCESS*RECORD*SELECTION***********************   084981
031430200529     C***********                                                         084981
031440200529     C***********          ELSE                                           084981
031450200529     C***********          MOVEA'1'       *IN,99                          084981
031460200529     C************IN,04    IFEQ '0'                                       084981
031470200529     C***********AGAIN     TAG                                            084981
031480200529     C***********          READCSUBFLREC                 99               084981
031490200529     C***********          END                                            084981
031500200529      ***********                                                         084981
031510200529      *****Record*Select*Validation************************************   084981
031520200529      ***********                                                         084981
031530200529     C************IN99     IFEQ '0'                                       084981
031540200529     C***********                                                         084981
031550200529     C****Ignore*blank*action*code*************************************   084981
031560200529     C***********                                                         084981
031570200529     C***********ACTN      IFEQ ' '                                       084981
031580200529     C***********          SETOF                     21                   084981
031590200529     C***********          GOTO AGAIN                                     084981
031600200529     C***********          END                                            084981
031610200529     C***********                                                         084981
031620200529     C****Validate*action*code*for*record******************************   084981
031630200529     C***********                                                         084981
031640200529     C***********          EXSR VALIDK                                    084981
031650200529     C***********                                                         084981
031660200529     C****NO*ERRORS,*UPDATE*SCREEN*CAN*BE*PROCESSED*NEXT***************   084981
031670200529     C***********                                                         084981
031680200529     C***********SCRMSG    IFEQ *BLANK                                    084981
031690200529     C***********          MOVEA'1'       *IN,12                          084981
031700200529     C***********          MOVEL'Y'       REVW                            084981
031710200529     C***********          ELSE                                           084981
031720200529     C***********          UPDATSUBFLREC                                  084981
031730200529     C***********          END                                            084981
031740200529     C***********          END                                            084981
031750200529     C***********                                                         084981
031760200529     C***C*K*3,*C*K*12*,*H*E*L*P*,*R*E*C*O*R*D**S*E*L*E*C*T*-*E*N*D       S01199
031770200529     C***C*K*3,*C*K*12*,*R*E*C*O*R*D**S*E*L*E*C*T*-*E*N*D**********S01199 084981
031780200529     C***********                                                         084981
031790200529     C***********          END                             *AID=HP        S01199
031800200529     C***********          END                                            084981
031810200529     C***********          END                                            084981
031820200529     C*
031830200529     C** D O    U N T I L   C H A N G E  O F  S C R E E N  -  S T A R T   084981
031840200529     C*                                                                   084981
031850200529     C           *IN10     DOUEQ'1'                                       084981
031860200529     C           *IN11     OREQ '1'                                       084981
031870200529     C           ENDPGM    OREQ 'Y'                                       084981
031880200529     C*                                                                   084981
031890200529     C** R E B U I L D   S U B F I L E                     -  S T A R T   084981
031900200529     C*                                                                   084981
031910200529     C** - not if error found                                             084981
031920200529     C*                                                                   084981
031930200529     C           SCRMSG    IFEQ *BLANKS                                   084981
031940200529     C                     MOVE *BLANKS   XSFRNO                          084981
031950200529     C*                                                                   084981
031960200529     C           AID       IFEQ 'RA'                                      084981
031970200529     C                     MOVE AID       SAVAID  2                       084981
031980200529     C*                                                                   084981
031990200529     C** Write control record                                             084981
032000200529     C*                                                                   084981
032010200529     C                     MOVEA'000'     *IN,1                           084981
032020200529     C                     Z-ADD*ZERO     RRN                             084981
032030200529     C/COPY WNCPYSRC,SE0170C054
032040200529     C                     WRITESUBFLCTL                                  084981
032050200529     C/COPY WNCPYSRC,SE0170C055
032060200529     C                     MOVELPPBCA     PBCA                            084981
032070200529     C                     MOVELPPSSH     PSSH                            084981
032080200529     C                     MOVELPPCPY     PCPY                            084981
032090200529     C           BGPFMG    IFEQ 'Y'                                       084981
032100200529     C           BGN4ST    OREQ 'Y'                                       CPB001
032110200529     C           PPTFR     IFEQ FCR997                                    084981
032120200529     C           BGN4ST    ANDNE'Y'                                       CPB001
032130200529     C                     MOVE FCR997    PTFR                            084981
032140200529     C                     ELSE                                           084981
032150200529     C                     MOVELPPTFR     PTFR                            084981
032160200529     C                     ENDIF                                          084981
032170200529     C                     ENDIF                                          084981
032180200529     C*                                                                   084981
032190200529     C** Convert due date to stored format                                084981
032200200529     C*                                                                   084981
032210200529     C           PPDUD     IFEQ *BLANKS                                   084981
032220200529     C                     Z-ADD0         PDUD                            084981
032230200529     C                     ELSE                                           084981
032240200529     C*                                                                   084981
032250200529     C                     MOVE PPDUD     PPDUDN  60                      084981
032260200529     C                     MOVE PPDUDN    PPDUDA  6                       084981
032270200529     C           PPDUD     COMP PPDUDA               9999                 084981
032280200529     C           *IN99     IFNE '1'                                       084981
032290200529     C                     Z-ADDPPDUDN    ZDATE                           084981
032300200529     C                     EXSR ZDATE1                                    084981
032310200529     C                     END                                            084981
032320200529     C           *IN99     IFEQ '1'                                       084981
032330200529     C                     Z-ADD0         PDUD                            084981
032340200529     C                     ELSE                                           084981
032350200529     C                     Z-ADDZDAYNO    PDUD                            084981
032360200529     C                     END                                            084981
032370200529     C                     END                                            084981
032380200529     C                     MOVELPPEVT     PEVT                            084981
032390200529     C                     MOVEL*BLANKS   TXBS                            186055
032400200529     C                     MOVEL*BLANKS   BNFO                            186055
032410200529     C                     MOVEL*BLANKS   EXCD                            186055
032420200529     C*                                                                   084981
032430200529     C*                                                                   141869
032440200529     C** Save fields.                                                     141869
032450200529     C*                                                                   141869
032460200529     C                     MOVE PPBCA     OPBCA   3                       141869
032470200529     C                     MOVE PPSSH     OPSSH  10                       141869
032480200529     C                     MOVE PPCPY     OPCPY  10                       141869
032490200529     C                     MOVE PPDUD     OPDUD   6                       141869
032500200529     C                     MOVE PPEVT     OPEVT   2                       141869
032510200529     C                     MOVE PPTFR     OPTFR   4                       141869
032520200529     C** Also different key depending on whether PM installed             084981
032530200529     C*                                                                   084981
032540200529     C           CSE023    IFEQ 'Y'                                       186055
032550200529     C           PTXBSK    SETLLPOSETX                                    186055
032560200529     C                     ELSE                                           186055
032570200529     C           BGPFMG    IFEQ 'Y'                                       084981
032580200529     C           BGN4ST    OREQ 'Y'                                       CPB001
032590200529     C           PTFRK     SETLLPOSETX                                    084981
032600200529     C                     ELSE                                           084981
032610200529     C           POSETK    SETLLPOSETX                                    084981
032620200529     C                     END                                            084981
032630200529     C                     END                                            186055
032640200529     C*                                                                   084981
032650200529     C** Read in details - fill up subfile                                084981
032660200529     C*                                                                   084981
032670200529     C                     EXSR ROLLUP                                    084981
032680200529     C                     END                                            084981
032690200529     C*                                                                   084981
032700200529     C** R E B U I L D   S U B F I L E     -     E N D                    084981
032710200529     C                     END                                            084981
032720200529     C*                                                                   084981
032730200529     C***  Review Screen Output                                           084981
032740200529     C***  Redisplay subfile until all action codes are valid             084981
032750200529     C*                                                                   084981
032760200529     C           WRDIS     DOUEQ*BLANK                                    084981
032770200529     C           ENDPGM    OREQ 'Y'                                       084981
032780200529     C**********           MOVELINF,2     INFMSG                                     084981 AR324886
032790200529     C                     MOVELINF,17    INFMSG                                            AR324886
032800200529     C/COPY WNCPYSRC,SE0170C056
032810200529     C*                                                                   084981
032820200529     C**********           WRITESUBFLCTL                                              084981 BUG1992
032830200529     C/COPY WNCPYSRC,SE0170C057
032840200529     C                     WRITEMESSAGES                                  084981
032850200529     C           *IN01     IFEQ '0'                                       084981
032860200529     C                     WRITENOREC                                     084981
032870200529     C                     ENDIF                                          084981
032880200529     C/COPY WNCPYSRC,SE0170C058
032890200529     C                     WRITESUBFLCTL                                                     BUG1992
032900200529     C                     READ SUBFLCTL                 99               084981
032910200529     C/COPY WNCPYSRC,SE0170C059
032920200529     C                     MOVELERRMSG    HERCD                           084981
032930200529     C                     MOVELWBLNK     HERCD                           084981
032940200529     C                     MOVEL*BLANK    SCRMSG                          084981
032950200529     C                     MOVEL*BLANK    REVW                            084981
032960200529     C                     MOVE *BLANK    WRDIS   1                       084981
032970200529     C*                                                                   084981
032980200529     C** Call S/R to move values into AID                                 084981
032990200529     C*                                                                   084981
033000200529     C                     EXSR ASCHGS                                    084981
033010200529     C*                                                                   084981
033020200529     C** Determine next process depending on the action taken by user     084981
033030200529     C*                                                                   084981
033040200529     C                     SELEC                                          084981
033050200529     C*                                                                   084981
033060200529     C** F3 - terminate                                                   084981
033070200529     C           AID       WHEQ '01'                                      084981
033080200529     C                     MOVE '1'       *IN11                           084981
033090200529     C*                                                                   084981
033100200529     C** F12 - initial screen                                             084981
033110200529     C           AID       WHEQ '05'                                      084981
033120200529     C                     MOVE '1'       *IN10                           084981
033130200529     C*                                                                   084981
033140200529     C** Rollup is pressed, display more records                          084981
033150200529     C           AID       WHEQ 'UP'                                      084981
033160200529     C                     MOVE 'Y'       WRDIS                           084981
033170200529     C                     EXSR ROLLUP                                    084981
033180200529     C*                                                                   084981
033190200529     C** Enter is pressed, process record selection                       084981
033200200529     C           AID       WHEQ 'RA'                                      084981
033210200529     C           RRN       ANDGT0                                         084981
033220200529     C/COPY WNCPYSRC,SE0170C075
033230200529     C********** PAGK      ANDEQ*BLANKS                                                084981 206844
033240200529     C/COPY WNCPYSRC,SE0170C076
033250200529     C                     Z-ADD1         RRN                             084981
033260200529     C/COPY WNCPYSRC,SE0170C060
033270200529     C                     READCSUBFLREC                 62               084981
033280200529     C/COPY WNCPYSRC,SE0170C061
033290200529     C                     Z-ADD0         WRCTR   40                      084981
033300200529     C                     Z-ADD0         EC      40                      084981
033310200529     C                     Z-ADD0         WEC                                                 222756
033320200529     C                     MOVE *BLANKS   ERR                             084981
033330200529     C*                                                                   084981
033340200529     C** Process record select validation                                 084981
033350200529     C*                                                                   084981
033360200529     C           *IN62     DOWEQ'0'                                       084981
033370200529     C           ACTN      IFNE *BLANK                                    084981
033380200529     C                     MOVE '1'       *IN61                           084981
033390200529     C                     MOVE 'Y'       REVW                            CAC002
033400200529     C                     EXSR VALIDK                                    084981
033410200529     C           SCRMSG    IFNE *BLANKS                                   084981
033420200529     C                     ADD  1         WRCTR                           084981
033430200529     C           WRCTR     IFEQ 1                                         084981
033440200529     C                     Z-ADDRRN       RECNO                           084981
033450200529     C                     ENDIF                                          084981
033460200529     C                     MOVE 'Y'       WRDIS                           084981
033470200529     C                     ENDIF                                          084981
033480200529     C                     ELSE                                           084981
033490200529     C                     MOVE '0'       *IN21                           084981
033500200529     C                     ENDIF                                          084981
033510200529     C/COPY WNCPYSRC,SE0170C062
033520200529     C                     UPDATSUBFLREC                                  084981
033530200529     C                     READCSUBFLREC                 62               084981
033540200529     C/COPY WNCPYSRC,SE0170C063
033550200529     C                     ENDDO                                          084981
033560200529     C*                                                                   084981
033570200529     C** If there are no errors in the validation process each action     084981
033580200529     C*                                                                   084981
033590200529     C           WRDIS     IFEQ *BLANK                                    084981
033600200529     C                     MOVE '0'       *IN61                           084981
033610200529     C                     Z-ADD1         RRN                             084981
033620200529     C/COPY WNCPYSRC,SE0170C064
033630200529     C                     READCSUBFLREC                 62               084981
033640200529     C/COPY WNCPYSRC,SE0170C065
033650200529     C           *IN62     DOWEQ'0'                                       084981
033660200529     C           ACTN      IFNE *BLANK                                    084981
033670200529     C                     MOVELSPBCA     PBCA                            084981
033680200529     C                     MOVELSPSSH     PSSH                            084981
033690200529     C                     MOVELSPCPY     PCPY                            084981
033700200529     C                     MOVELSPEVT     PEVT                            084981
033710200529     C                     MOVELSTXBS     TXBS                            186055
033720200529     C           SBNFO     IFNE *BLANKS                                   186055
033730200529     C                     MOVELSPCPY     BNFO                            186055
033740200529     C                     MOVE SBNFO     BNFO                            186055
033750200529     C                     ELSE                                           186055
033760200529     C                     MOVE *BLANKS   BNFO                            186055
033770200529     C                     ENDIF                                          186055
033780200529     C                     MOVELSEXCD     EXCD                            186055
033790200529     C                     MOVELSPPTFR    PTFR                            099267
033800200529     C                     Z-ADDSPTNLU    TNL1                            099267
033810200529     C                     MOVE SPDUD     ZDATE                           084981
033820200529     C                     EXSR ZDATE1                                    084981
033830200529     C                     Z-ADDZDAYNO    PDUD                            084981
033840200529     C                     MOVE ACTN      OACTN   1                       141869
033850200529     C                     MOVE 'Y'       REVW                            084981
033860200529     C                     EXSR UPDATE                                    084981
033870200529     C*                                                                   084981
033880200529     C** If F3 is pressed, go out of the main loop and end the program    084981
033890200529     C                     SELEC                                          084981
033900200529     C           PCMD      WHEQ '03'                                      084981
033910200529     C           AID       OREQ '01'                                      084981
033920200529     C                     MOVE 'Y'       ENDPGM                          084981
033930200529     C                     LEAVE                                          084981
033940200529     C*                                                                   084981
033950200529     C** If F5 is pressed from SE1817, go out of the loop                 084981
033960200529     C           PCMD      WHEQ '05'                                      084981
033970200529     C                     LEAVE                                          084981
033980200529     C*                                                                   084981
033990200529     C** If F12 is pressed from detail screen, re-display subfile screen  084981
034000200529     C           AID       WHEQ '05'                                      084981
034010200529     C                     MOVE '0'       *IN11                           084981
034020200529     C                     MOVE 'Y'       WRDIS                           084981
034030200529     C                     MOVE '1'       *IN61                           084981
034040200529     C/COPY WNCPYSRC,SE0170C066
034050200529     C                     UPDATSUBFLREC                                  084981
034060200529     C/COPY WNCPYSRC,SE0170C067
034070200529     C                     Z-ADDRRN       RECNO                           084981
034080200529     C                     LEAVE                                          084981
034090200529     C*                                                                   084981
034100200529     C** If ENTER is pressed, re-display subfile page                     084981
034110200529     C                     OTHER                                          084981
034120200529     C                     MOVE 'Y'       WRDIS                           084981
034130200529     C                     Z-ADDRRN       RECNO                           084981
034140200529     C                     ENDSL                                          084981
034150200529     C*                                                                   084981
034160200529     C                     MOVE *BLANK    ACTN                            084981
034170200529     C                     ENDIF                                          084981
034180200529     C/COPY WNCPYSRC,SE0170C068
034190200529     C                     UPDATSUBFLREC                                  084981
034200200529     C                     READCSUBFLREC                 62               084981
034210200529     C/COPY WNCPYSRC,SE0170C069
034220200529     C                     ENDDO                                          084981
034230200529     C                     MOVE 'RA'      AID                             084981
034240200529     C*                                                                   084981
034250200529     C*                                                                   141869
034260200529     C** If Action is 'A' or 'D'.                                         141869
034270200529     C*                                                                   141869
034280200529     C           OACTN     IFEQ 'A'                                       141869
034290200529     C           OACTN     OREQ 'D'                                       141869
034300200529     C           OACTN     OREQ 'Y'                                       141869
034310200529     C           OACTN     OREQ 'R'                                       141869
034320200529     C           OACTN     OREQ 'U'                                                         AR324886
034330200529     C*                                                                   141869
034340200529     C                     MOVE ' '       WRDIS                           141869
034350200529     C                     MOVE *BLANK    OACTN                           141869
034360200529     C                     MOVE OPBCA     PPBCA                           141869
034370200529     C                     MOVE OPSSH     PPSSH                           141869
034380200529     C                     MOVE OPCPY     PPCPY                           141869
034390200529     C                     MOVE OPDUD     PPDUD                           141869
034400200529     C                     MOVE OPEVT     PPEVT                           141869
034410200529     C                     MOVE OPTFR     PPTFR                           141869
034420200529     C                     ENDIF                                          141869
034430200529     C** If there are errors, highlight the error message line            084981
034440200529     C                     ELSE                                           084981
034450200529     C                     MOVELHI        ERRMSG                          084981
034460200529     C                     MOVEL*BLANK    AID                             084981
034470200529     C                     ENDIF                                          084981
034480200529     C*                                                                   084981
034490200529     C                     ENDSL                                          084981
034500200529     C                     ENDDO                                          084981
034510200529     C*                                                                   084981
034520200529     C** D O    U N T I L   C H A N G E  O F  S C R E E N   - S T A R T
034530200529     C                     END
034540200529     C*                                                                   S01496
034550200529     C***FOR*LIVE/ALL*FIELD*SET TO 'L' OVERRIDE POSETX BACK TO POSETALL   S01496
034560200529     C***FOR*LIVE/ALL*FIELD*SET*TO*'L'*OVERRIDE*POSETX*BACK*TO*SEPOS01496 084981
034570200529     C***FOR*LIVE/ALL*FIELD*SET*TO*'L'*OVERRIDE*POSETX*BACK*TO*POS 084981 186055
034580200529     C** FOR LIVE/ALL FIELD SET TO 'L' OVERRIDE POSETX BACK TO POSET7     186055
034590200529     C*                                                                   S01496
034600200529     C           S01496    IFEQ 'Y'                                       S01496
034610200529     C           CSE007    OREQ 'Y'                                       CSE007
034620200529     C           CEU017    OREQ 'Y'                                       CEU017
034630200529     C*                                                                   S01408
034640200529     C/COPY WNCPYSRC,SE0170CCP9                                           S01408
034650200529     C*                                                                   S01408
034660200529     C           PPALL     IFEQ 'L'                                       S01496
034670200529     C                     CLOSEPOSETX                                    S01496
034680200529     C                     CALL 'QCMDEXC'                                 S01496
034690200529     C                     PARM           CCOVRA                          S01496
034700200529     C***********          PARM 35        WWOVL                    S01496 084981
034710200529     C                     PARM 33        WWOVL                           084981
034720200529     C                     OPEN POSETX                                    S01496
034730200529     C                     ENDIF                                          S01496
034740200529     C                     ENDIF                                          S01496
034750200529     C*
034760200529     C                     ENDSR
034770200529     C*
034780200529     C*****************************************************************
034790200529      /EJECT                                                              084981
034800200529     C*****************************************************************   084981
034810200529     C*                                                               *   084981
034820200529     C*  ROLLUP  - S/R TO PROCESS ROLLUP REQUESTS                     *   084981
034830200529     C*  CALLED FROM: REVIEW                                          *   084981
034840200529     C*  CALLS: NONE                                                  *   084981
034850200529     C*                                                               *   084981
034860200529     C*****************************************************************   084981
034870200529     C*                                                                   084981
034880200529     C           ROLLUP    BEGSR                           ** ROLLUP BSR**084981
034890200529     C*                                                                   084981
034900200529     C                     MOVE '0'       *IN21                           084981
034910200529     C                     MOVE '0'       *IN61                           084981
034920200529     C                     Z-ADD0         WSCTR   20                      084981
034930200529     C                     MOVEL*BLANKS   SAVBA                           084981
034940200529     C           AID       IFEQ 'UP'                                      084981
034950200529     C                     Z-ADDRRNLST    RRN                             084981
034960200529     C                     MOVELWSVBCA    PBCA                            084981
034970200529     C                     MOVELWSVSSH    PSSH                            084981
034980200529     C**********           Z-ADDWSVCPY    PCPY                                         084981 CSD027
034990200529     C                     MOVE WSVCPY    PCPY                                                CSD027
035000200529     C                     Z-ADDWSVDUD    PDUD                            084981
035010200529     C                     MOVELWSVEVT    PEVT                            084981
035020200529     C                     MOVELWSVTFR    PTFR                            084981
035030200529     C                     MOVELWSVTLU    TNL1                            084981
035040200529     C                     MOVELWSTXBS    TXBS                            186055
035050200529     C                     MOVELWSBNFO    BNFO                            186055
035060200529     C                     MOVELWSEXCD    EXCD                            186055
035070200529     C           CSE023    IFEQ 'Y'                                       186055
035080200529     C           PTXBSK    SETLLPOSETX                                    186055
035090200529     C                     ELSE                                           186055
035100200529     C           BGPFMG    IFEQ 'Y'                                       084981
035110200529     C           BGN4ST    OREQ 'Y'                                       CPB001
035120200529     C           PTFRK     SETLLPOSETX                                    084981
035130200529     C                     ELSE                                           084981
035140200529     C           POSETK    SETLLPOSETX                                    084981
035150200529     C                     ENDIF                                          084981
035160200529     C                     ENDIF                                          186055
035170200529     C                     ENDIF                                          084981
035180200529     C/COPY WNCPYSRC,SE0170C077
035190200529     C                     MOVE *BLANKS   SAVFLD                                              206844
035200200529     C*                                                                   084981
035210200529     C                     READ POSETX                   03               084981
035220200529     C*                                                                   084981
035230200529     C** Read details until subfile page is full or EOF is reached        084981
035240200529     C*                                                                   084981
035250200529     C           *IN03     DOWEQ'0'                                       084981
035260200529     C/COPY WNCPYSRC,SE0170C031
035270200529     C********** WSCTR     ANDLT14                                 084981 CSE023
035280200529     C********** WSCTR     ANDLT13                                 CSE023 CSE016
035290200529     C           WSCTR     ANDLT07                                        CSE016
035300200529     C/COPY WNCPYSRC,SE0170C032
035310200529     C                     MOVE *BLANK    WRNXT   1                                           206844
035320200529      *                                                                                       206844
035330200529     C           PPBCA     IFNE *BLANK                                                        206844
035340200529     C           PPBCA     ANDNEPBCA                                                          206844
035350200529     C                     MOVE 'Y'       WRNXT                                               206844
035360200529     C                     ENDIF                                                              206844
035370200529      *                                                                                       206844
035380200529     C           PPSSH     IFNE *BLANK                                                        206844
035390200529     C           PPSSH     ANDNEPSSH                                                          206844
035400200529     C                     MOVE 'Y'       WRNXT                                               206844
035410200529     C                     ENDIF                                                              206844
035420200529      *                                                                                       206844
035430200529     C           PPCPY     IFNE *BLANK                                                        206844
035440200529     C                     MOVE *BLANK    WCPCPY 10                                           206844
035450200529     C                     MOVELPCPY      WCPCPY                                              206844
035460200529     C           PPCPY     IFNE WCPCPY                                                        206844
035470200529     C                     MOVE 'Y'       WRNXT                                               206844
035480200529     C                     ENDIF                                                              206844
035490200529     C                     ENDIF                                                              206844
035500200529      *                                                                                       206844
035510200529     C           PPDUD     IFNE *BLANK                                                        206844
035520200529     C                     Z-ADDPDUD      ZDAYNO                                              206844
035530200529     C                     EXSR ZDATE2                                                        206844
035540200529     C                     MOVE *BLANK    WCPDUD  6                                           206844
035550200529     C                     MOVELZDATE     WCPDUD                                              206844
035560200529     C           PPDUD     IFNE WCPDUD                                                        206844
035570200529     C                     MOVE 'Y'       WRNXT                                               206844
035580200529     C                     ENDIF                                                              206844
035590200529     C                     ENDIF                                                              206844
035600200529      *                                                                                       206844
035610200529     C           PPEVT     IFNE *BLANK                                                        206844
035620200529     C           PPEVT     ANDNEPEVT                                                          206844
035630200529     C                     MOVE 'Y'       WRNXT                                               206844
035640200529     C                     ENDIF                                                              206844
035650200529      *                                                                                       206844
035660200529     C           PPTFR     IFNE *BLANK                                                        206844
035670200529     C           PPTFR     ANDNEPTFR                                                          206844
035680200529     C                     MOVE 'Y'       WRNXT                                               206844
035690200529     C                     ENDIF                                                              206844
035700200529      *                                                                                       206844
035710200529      ** Read next record if WRNXT = 'Y'.                                                     206844
035720200529      *                                                                                       206844
035730200529     C           WRNXT     IFEQ *BLANK                                                        206844
035740200529     C*                                                                   084981
035750200529     C** Check if user is authorised to branch on position record         084981
035760200529     C** before building subfile                                          084981
035770200529     C*                                                                   084981
035780200529     C           PBCA      IFNE SAVBA                                     084981
035790200529     C                     Z-ADD0         @ERR                            084981
035800200529     C********** *IN81     IFEQ 'Y'                                                  084981 AR706573
035810200529     C           *IN81     IFEQ '1'                                                         AR706573
035820200529     C                     CALL 'ZVBBU'                                   084981
035830200529     C                     PARM PBCA      @ZBRCD  3                       084981
035840200529     C                     PARM           @ERR    10                      084981
035850200529     C                     ENDIF                                          084981
035860200529     C                     ENDIF                                          084981
035870200529     C                     Z-ADDTNL1      SPTNLU                                            AR324886
035880200529      *                                                                                     AR324886
035890200529     C*                                                                   084981
035900200529     C           @ERR      IFEQ 0                                         084981
035910200529     C*                                                                   084981
035920200529     C** Ignore records with record ID of 'M'                             084981
035930200529     C*                                                                   084981
035940200529     C*                                                                   S01408
035950200529     C/COPY WNCPYSRC,SE0170CP10                                           S01408
035960200529     C*                                                                   S01408
035970200529     C           RECI      IFNE 'M'                                       084981
035980200529     C           S01496    ANDNE'Y'                                       084981
035990200529     C           CSE007    ANDNE'Y'                                       CSE007
036000200529     C           CEU017    ANDNE'Y'                                       CEU017
036010200529     C*                                                                   S01408
036020200529     C/COPY WNCPYSRC,SE0170CP11                                           S01408
036030200529     C*                                                                   S01408
036040200529     C           S01496    OREQ 'Y'                                       084981
036050200529     C           CSE007    OREQ 'Y'                                       CSE007
036060200529     C           CEU017    OREQ 'Y'                                       CEU017
036070200529     C*                                                                   084981
036080200529     C           *IN,03    IFEQ '0'                                       084981
036090200529     C*                                                                   084981
036100200529     C** If Jyske Enhancements feature is not installed                   084981
036110200529     C** AND if Corporate Action feature is not installed                 CSE007
036120200529     C** AND if Securities Redenomination feature is not installed        CEU017
036130200529     C*                                                                   084981
036140200529     C           S01496    IFNE 'Y'                                       084981
036150200529     C           CSE007    ANDNE'Y'                                       CSE007
036160200529     C           CEU017    ANDNE'Y'                                       CEU017
036170200529     C*                                                                   084981
036180200529     C** If record is deleted or matured, flag it as such on screen       084981
036190200529     C*                                                                   084981
036200200529     C           RECI      IFEQ '*'                                       084981
036210200529     C                     MOVEL'D'       STAT                            084981
036220200529     C                     ELSE                                           084981
036230200529     C                     MOVEL*BLANK    STAT    1                       084981
036240200529     C                     ENDIF                                          084981
036250200529     C*                                                                   084981
036260200529     C                     ELSE                                           084981
036270200529     C*                                                                   084981
036280200529     C** If record is matured/reversed/deleted, flag it as such on screen 084981
036290200529     C*                                                                   084981
036300200529     C                     MOVEL*BLANK    STAT                            084981
036310200529     C           RECI      IFNE 'D'                                       084981
036320200529     C           RECI      IFEQ '*'                                       084981
036330200529     C                     MOVEL'D'       STAT    1        *STATUS=DELT   084981
036340200529     C                     ELSE                                           084981
036350200529     C                     MOVE RECI      STAT                            084981
036360200529     C                     ENDIF                                          084981
036370200529     C           RECI      IFEQ 'M'                                                         AR324886
036380200529     C********** PSAUTH    CHAINPSAUT                80                            AR324886 AR586601
036390200529     C           PSAUTH    CHAINPSAUT               N80                                     AR586601
036400200529     C           *IN80     IFEQ *OFF                                                        AR324886
036410200529     C           PALCTP    ANDEQ'R'                                                         AR324886
036420200529     C                     MOVE 'R'       STAT                                              AR324886
036430200529     C                     ENDIF                                                            AR324886
036440200529     C                     ENDIF                                                            AR324886
036450200529     C                     ENDIF                                          084981
036460200529     C                     ENDIF                                          084981
036470200529     C*                                                                   084981
036480200529     C                     ADD  1         RRN     40                      084981
036490200529     C                     ADD  1         WSCTR                           084981
036500200529     C*                                                                   084981
036510200529     C                     MOVE RECI      SRECI   1                                         AR324886
036520200529     C                     MOVE ' '       ACTN                            084981
036530200529     C                     MOVE '0'       SWARN                           084981
036540200529     C                     MOVELPBCA      SPBCA                           084981
036550200529     C                     MOVELPSSH      SPSSH                           084981
036560200529     C                     MOVELPCPY      SPCPY                           084981
036570200529     C                     MOVELPEVT      SPEVT                           084981
036580200529     C                     Z-ADDTNL1      SPTNLU                          099267
036590200529     C                     Z-ADDPDUD      ZDAYNO                          084981
036600200529     C                     EXSR ZDATE2                                    084981
036610200529     C                     MOVELZDATE     SPDUD                           084981
036620200529     C                     MOVELTXBS      STXBS                           186055
036630200529     C                     MOVE BNFO      SBNFO                           186055
036640200529     C                     MOVELEXCD      SEXCD                           186055
036650200529     C/COPY WNCPYSRC,SE0170C033
036660200529      *                                                                   CSE016
036670200529      ** Save indicator                                                   CSE016
036680200529      *                                                                   CSE016
036690200529     C                     MOVE *IN99     WWIN99  1                       CSE016
036700200529     C                     MOVE *BLANKS   SRNME                           CSE016
036710200529      *                                                                   CSE016
036720200529      ** Retrieve security description                                    CSE016
036730200529      *                                                                   CSE016
036740200529     C           PSSH      CHAINSECTY                99                   CSE016
036750200529     C           *IN99     IFEQ *OFF                                      CSE016
036760200529      *                                                                   CSE016
036770200529     C                     MOVE BVRIDF    ZRSFD                           CSE016
036780200529     C                     MOVELSRPN      ZSRPN                           CSE016
036790200529     C                     EXSR ZSDESC                                    CSE016
036800200529     C                     MOVELZRNME     SRNME                           CSE016
036810200529      *                                                                   CSE016
036820200529     C                     ENDIF                                          CSE016
036830200529      *                                                                   CSE016
036840200529      ** Restore indicator                                                CSE016
036850200529      *                                                                   CSE016
036860200529     C                     MOVE WWIN99    *IN99                           CSE016
036870200529     C*                                                                   084981
036880200529     C** If portfolio management is installed                             084981
036890200529     C*                                                                   084981
036900200529     C           BGPFMG    IFEQ 'Y'                                       084981
036910200529     C           BGN4ST    OREQ 'Y'                                       CPB001
036920200529     C           PTFR      IFEQ '9997'                                    084981
036930200529     C           BGN4ST    ANDNE'Y'                                       CPB001
036940200529     C                     MOVELFCR997    SPPTFR                          084981
036950200529     C                     ELSE                                           084981
036960200529     C                     MOVELPTFR      SPPTFR                          084981
036970200529     C                     ENDIF                                          084981
036980200529     C                     ENDIF                                          084981
036990200529     C*                                                                   084981
037000200529     C** If S01512 is active, work out payment/value date for screen      084981
037010200529     C*                                                                   084981
037020200529     C           S01512    IFEQ 'Y'                                       084981
037030200529     C                     Z-ADDPSVL      ZDAYNO                          084981
037040200529     C                     EXSR ZDATE2                                    084981
037050200529     C                     MOVELZDATE     SFPSVL                          084981
037060200529     C                     ENDIF                                          084981
037070200529     C*                                                                   084981
037080200529     C           SRECI     IFEQ 'M'                                                         AR324886
037090200529     C           STAT      ANDEQ'R'                                                         AR324886
037100200529     C                     MOVE *BLANK    SPAUI                                             AR324886
037110200529     C                     ELSE                                                             AR324886
037120200529     C                     MOVELPAUI      SPAUI                           084981
037130200529     C                     ENDIF                                                            AR324886
037140200529     C           KEYFLD    IFEQ SAVFLD                                    084981
037150200529     C                     ADD  1         SEQ                             084981
037160200529     C                     ELSE                                           084981
037170200529     C                     Z-ADD1         SEQ                             084981
037180200529     C                     MOVELKEYFLD    SAVFLD 31                       084981
037190200529     C                     ENDIF                                          084981
037200200529      **********                                                   CSE023 186055
037210200529      ***Format*subfile*record*detail*for*output*to*screen.        CSE023 186055
037220200529      **********                                                   CSE023 186055
037230200529     C********** CSE023    IFEQ 'Y'                                CSE023 186055
037240200529     C**********           MOVELTXBS      STXBS                    CSE023 186055
037250200529     C**********           MOVE BNFO      SBNFO                    CSE023 186055
037260200529     C**********           MOVELEXCD      SEXCD                    CSE023 186055
037270200529     C**********           ENDIF                                   CSE023 186055
037280200529     C/COPY WNCPYSRC,SE0170C070
037290200529     C                     WRITESUBFLREC                                  084981
037300200529     C/COPY WNCPYSRC,SE0170C071
037310200529     C*                                                                   084981
037320200529     C** Record is now written to subfile                                 084981
037330200529     C*                                                                   084981
037340200529     C                     END                                            084981
037350200529     C                     ELSE                                           084981
037360200529     C                     MOVELPBCA      MPBCA                           084981
037370200529     C                     MOVELPSSH      MPSSH                           084981
037380200529     C                     MOVELPCPY      MPCPY                           084981
037390200529     C                     MOVELPEVT      MPEVT                           084981
037400200529     C                     Z-ADDPDUD      ZDAYNO                          084981
037410200529     C                     EXSR ZDATE2                                    084981
037420200529     C                     MOVELZDATE     MPDUD                           084981
037430200529     C           MTYFLD    IFEQ SAVFLD                                    084981
037440200529     C                     ADD  1         SEQ                             084981
037450200529     C                     ELSE                                           084981
037460200529     C                     Z-ADD1         SEQ                             084981
037470200529     C                     MOVELMTYFLD    SAVFLD                          084981
037480200529     C                     END                                            084981
037490200529     C                     END                                            084981
037500200529     C*                                                                   084981
037510200529     C**  Save branch code for authorisation check on display             084981
037520200529     C*                                                                   084981
037530200529     C                     MOVELPBCA      SAVBA   3                       084981
037540200529     C                     ENDIF                                          084981
037550200529     C/COPY WNCPYSRC,SE0170C078
037560200529     C                     ENDIF                                                              206844
037570200529     C*                                                                   084981
037580200529     C                     READ POSETX                   03               084981
037590200529     C*                                                                   084981
037600200529     C** Page is now full or EOF is reached on the file                   084981
037610200529     C                     ENDDO                                          084981
037620200529     C*                                                                   084981
037630200529     C** Set the subfile record number                                    084981
037640200529     C*                                                                   084981
037650200529     C********** RRN       IFLE 14                                 084981 CSE023
037660200529     C********** RRN       IFLE 13                                                     CSE023 206844
037670200529     C**********           Z-ADD1         RECNO                                        084981 206844
037680200529     C**********           ELSE                                                        084981 206844
037690200529     C********** RRN       SUB  WSCTR     RECNO                                        084981 206844
037700200529     C**********           ADD  1         RECNO                                        084981 206844
037710200529     C**********           ENDIF                                                       084981 206844
037720200529     C/COPY WNCPYSRC,SE0170C034
037730200529      *                                                                   CSE016
037740200529     C           RRN       IFLE 07                                        CSE016
037750200529     C                     Z-ADD1         RECNO                           CSE016
037760200529     C                     ELSE                                           CSE016
037770200529     C           WSCTR     IFEQ 0                                                             206844
037780200529     C           RRN       SUB  6         RECNO                                               206844
037790200529     C                     ELSE                                                               206844
037800200529     C           RRN       SUB  WSCTR     RECNO                           CSE016
037810200529     C                     ADD  1         RECNO                           CSE016
037820200529     C                     ENDIF                                                              206844
037830200529     C                     ENDIF                                          CSE016
037840200529      *                                                                   CSE016
037850200529     C                     Z-ADDRRN       RRNLST  40                      084981
037860200529     C*                                                                   084981
037870200529     C** Read one more record for next screen                             084981
037880200529     C*                                                                   084981
037890200529     C           *IN,03    IFEQ '0'                                       084981
037900200529     C*                                                                   084981
037910200529     C** Save key to access this record again on the next rollup          084981
037920200529     C*                                                                   084981
037930200529     C                     MOVELPBCA      WSVBCA                          084981
037940200529     C                     MOVELPSSH      WSVSSH                          084981
037950200529     C**********           Z-ADDPCPY      WSVCPY                                       084981 CSD027
037960200529     C                     MOVE PCPY      WSVCPY                                              CSD027
037970200529     C                     Z-ADDPDUD      WSVDUD                          084981
037980200529     C                     MOVELPEVT      WSVEVT                          084981
037990200529     C                     MOVELPTFR      WSVTFR                          084981
038000200529     C                     MOVELTNL1      WSVTLU                          084981
038010200529     C                     MOVELTXBS      WSTXBS                          186055
038020200529     C                     MOVELBNFO      WSBNFO                          186055
038030200529     C                     MOVELEXCD      WSEXCD                          186055
038040200529     C*                                                                   084981
038050200529     C** Check user is authorised to branch on position record            084981
038060200529     C** before setting 'review from' key                                 084981
038070200529     C*                                                                   084981
038080200529     C           @ERR      DOUEQ0                                         084981
038090200529     C********** *IN81     IFEQ 'Y'                                                  084981 AR706573
038100200529     C           *IN81     IFEQ '1'                                                         AR706573
038110200529     C                     CALL 'ZVBBU'                                   084981
038120200529     C                     PARM PBCA      @ZBRCD  3                       084981
038130200529     C                     PARM           @ERR    10                      084981
038140200529     C                     ENDIF                                          084981
038150200529     C           @ERR      IFNE 0                                         084981
038160200529     C/COPY WNCPYSRC,SE0170C079
038170200529     C                     READ POSETX                   03               084981
038180200529     C/COPY WNCPYSRC,SE0170C080
038190200529     C                     ENDIF                                          084981
038200200529     C                     ENDDO                                          084981
038210200529     C*                                                                   084981
038220200529     C                     ENDIF                                          084981
038230200529     C*                                                                   084981
038240200529     C** Set 'REVIEW FROM' key to blank                                   084981
038250200529     C/COPY WNCPYSRC,SE0170C081
038260200529     C*                                                                   084981
038270200529     C**********           MOVEL*BLANK    PAGK                                         084981 206844
038280200529     C/COPY WNCPYSRC,SE0170C082
038290200529     C*                                                                   084981
038300200529     C** For subfile control                                              084981
038310200529     C*                                                                   084981
038320200529     C           WSCTR     IFEQ 0                                         084981
038330200529     C           RRN       ANDEQ0                                                             206844
038340200529     C                     MOVEA'01'      *IN,1                           084981
038350200529     C                     ELSE                                           084981
038360200529     C                     MOVEA'11'      *IN,1                           084981
038370200529     C                     ENDIF                                          084981
038380200529     C*                                                                   084981
038390200529     C                     ENDSR                                          084981
038400200529     C*****************************************************************   084981
038410200529      /EJECT
038420200529     C*****************************************************************
038430200529     C*                                                               *
038440200529     C*  UPDATE  - S/R TO PROCESS DETAIL SCREEN AND UPDATE FILE       *
038450200529     C*  CALLED FROM: MAIN PROCESSING                                 *
038460200529     C*  CALLS: VALIDD, UPDFLS, INITRC, TRSFS, DEFLTS                 *
038470200529     C*                                                               *
038480200529     C*****************************************************************
038490200529     C*
038500200529     C           UPDATE    BEGSR                           ** UPDATE BSR**
038510200529     C*
038520200529     C** SET SCREEN INDICATORS - PROTECT KEY, SET OFF ERROR INDS,
038530200529     C** POSITION CURSOR
038540200529     C*
038550200529     C                     MOVEA'1'       *IN,5            *PROTECT/NDS
038560200529     C                     MOVEA'0'       *IN,11                          084981
038570200529     C                     MOVEA'0'       *IN,12
038580200529     C                     MOVEA'0'       *IN,29                          S01512
038590200529     C                     MOVEA'10000000'*IN,30
038600200529     C                     MOVEA'00000000'*IN,38
038610200529     C***********          MOVEA'0000000' *IN,46                          E17175
038620200529     C                     MOVEA'00000000'*IN,46                          E17175
038630200529     C                     MOVEA'000'     *IN,70                          S01447
038640200529     C**********           MOVE *OFF      *IN75                                        233711 234471
038650200529     C                     MOVE *OFF      *IN78                                               234471
038660200529     C                     MOVE *OFF      *IN76                                               233711
038670200529     C                     MOVEA'0'       *IN,89
038680200529     C                     MOVEA'0'       *IN,99                          S01486
038690200529     C                     MOVE '0'       *IN56                           CAC002
038700200529     C                     MOVE '0'       *IN67                                               CER049
038710200529     C                     MOVEL*BLANKS   SCRMSG                                              222756
038720200529     C                     Z-ADD0         WEC                                                 222756
038730200529     C                     Z-ADD0         EC                                                  222756
038740200529     C*
038750200529     C** ACCESS FILE RECORD FOR OLD TNLU TO CHECK AT UPDATE TIME
038760200529     C** IF NO RECORD PRESENTLY ON FILE, ZEROISE STORED TNLU
038770200529     C*
038780200529     C                     Z-ADD*ZERO     STNLU   50
038790200529     C                     MOVE *BLANK    CAEVNT  1                                           191161
038800200529     C                     MOVE *BLANK    PCPYTP  1                                           191161
038810200529     C           *IN04     IFEQ *ON                                       CGL007
038820200529      *                                                                   CGL007
038830200529      ** Program is called by posting enquiry                             CGL007
038840200529      *                                                                   CGL007
038850200529     C           KEY16     SETLLPOSETX                                    CGL007
038860200529     C           *IN99     DOWEQ*OFF                                      CGL007
038870200529     C           KEY16     READEPOSETX                   99               CGL007
038880200529     C           *IN99     IFEQ *OFF                                      CGL007
038890200529      *                                                                   CGL007
038900200529     C           PTFR      IFNE ZPTFR                                     CGL007
038910200529     C           PSAT      ORNE ZPSTA                                     CGL007
038920200529     C                     ITER                                           CGL007
038930200529     C                     ELSE                                           CGL007
038940200529      *                                                                   CGL007
038950200529      ** Record match with Criteria                                       CGL007
038960200529      *                                                                   CGL007
038970200529     C                     MOVE *ON       *IN08                           CGL007
038980200529     C                     LEAVE                                          CGL007
038990200529     C                     ENDIF                                          CGL007
039000200529      *                                                                   CGL007
039010200529     C                     ENDIF                                          CGL007
039020200529     C                     ENDDO                                          CGL007
039030200529      *                                                                   CGL007
039040200529     C           *IN08     IFEQ *OFF                                      CGL007
039050200529     C                     MOVE 'E'       ZRETN                           CGL007
039060200529     C                     MOVE *ON       *INLR                           CGL007
039070200529     C                     RETRN                                          CGL007
039080200529     C                     ENDIF                                          CGL007
039090200529      *                                                                   CGL007
039100200529     C                     ELSE                                           CGL007
039110200529     C/COPY WNCPYSRC,SE0170C014
039120200529     C*                                                                   S01486
039130200529     C** IF PORTFOLIO MANAGEMENT INSTALLED                                S01486
039140200529     C           CSE023    IFEQ 'Y'                                       186055
039150200529     C           PTXBSK    CHAINPOSETX               99                   186055
039160200529     C**********           Z-ADDSEQ       RECSEQ  30                                   186055 212522
039170200529     C********** RECSEQ    DOWGT1                                                      186055 212522
039180200529     C********** *IN99     ANDEQ'0'                                                    186055 212522
039190200529     C********** PTXBSK    READEPOSETX                   99                            186055 212522
039200200529     C********** RECI      IFNE '*'                                                    186055 212522
039210200529     C**********           SUB  1         RECSEQ                                       186055 212522
039220200529     C**********           ENDIF                                                       186055 212522
039230200529     C**********           ENDDO                                                       186055 212522
039240200529     C                     ELSE                                           186055
039250200529     C           BGPFMG    IFEQ 'Y'                                       080743
039260200529     C           BGN4ST    OREQ 'Y'                                       CPB001
039270200529     C           ACTN      IFNE 'I'                                       S01486
039280200529     C********** BGPFMG    IFEQ 'Y'                                S01486 080743
039290200529     C           PTFRK     SETLLPOSETX                                    S01486
039300200529     C**********                                                   185397 186055
039310200529     C***If*CSE023*is*present,*then*need*to*check*tax*basket,*Exemption97 186055
039320200529     C***code*and*beneficial*owner*number*as*well.                 185397 186055
039330200529     C**********                                                   185397 186055
039340200529     C********** CSE023    IFNE 'Y'                                185397 186055
039350200529     C                     READ POSETX                   99               S01486
039360200529     C**********           ELSE                                    185397 186055
039370200529     C**********           MOVE '0'       *IN99                    185397 186055
039380200529     C********** SBNFO     IFNE *BLANK                             185397 186055
039390200529     C**********           MOVE PCPY      @BNFO  26                185397 186055
039400200529     C**********           MOVE SBNFO     @BNFO                    185397 186055
039410200529     C**********           ELSE                                    185397 186055
039420200529     C**********           MOVE *BLANK    @BNFO                    185397 186055
039430200529     C**********           END                                     185397 186055
039440200529     C********** POSETK    CHAINPOSETX               99            185397 186055
039450200529     C**********           Z-ADDSEQ       RECSEQ  30               185397 186055
039460200529     C********** RECSEQ    DOWGT1                                  185397 186055
039470200529     C********** *IN99     ANDEQ'0'                                185397 186055
039480200529     C********** POSETK    READEPOSETX                   99        185397 186055
039490200529     C********** RECI      IFNE '*'                                185397 186055
039500200529     C**********           SUB  1         RECSEQ                   185397 186055
039510200529     C**********           END                                     185397 186055
039520200529     C**********           END                                     185397 186055
039530200529     C**********           END                                     185397 186055
039540200529     C******************** Z-ADDSEQ       RECSEQ  30               S01486 080743
039550200529     C********** RECSEQ    DOWGT1                                  S01486 080743
039560200529     C********** *IN99     ANDEQ'0'                                S01486 080743
039570200529     C********** PTFRK     READEPOSETX                   99        S01486 080743
039580200529     C******************** SUB  1         RECSEQ                   S01486 080743
039590200529     C******************** END                                     S01486 080743
039600200529     C                     END                                            080743
039610200529     C                     ELSE                                           S01486
039620200529     C           POSETK    CHAINPOSETX               99
039630200529     C                     Z-ADDSEQ       RECSEQ  30                      E37157
039640200529     C           RECSEQ    DOWGT1                                         E37157
039650200529     C           *IN99     ANDEQ'0'                                       E37157
039660200529     C           POSETK    READEPOSETX                   99               E37157
039670200529     C                     SUB  1         RECSEQ                          E37157
039680200529     C                     END                                            E37157
039690200529     C******************** END                                     S01486 080743
039700200529     C                     END                                            S01486
039710200529     C                     ENDIF                                          186055
039720200529      *                                                                   CGL007
039730200529     C                     ENDIF                                          CGL007
039740200529     C/COPY WNCPYSRC,SE0170C015
039750200529     C           *IN,99    IFEQ '0'
039760200529     C***********          Z-ADDTNLU      STNLU                           S01486
039770200529     C                     Z-ADDTNL1      STNLU                           S01486
039780200529     C*                                                                   S01408
039790200529     C/COPY WNCPYSRC,SE0170CCP7                                           S01408
039800200529     C*                                                                   S01408
039810200529     C                     END
039820200529     C*
039830200529     C** IF INSERT (NEW OR OVER DELETED RECORD)
039840200529     C** INITIALIZE ALL FIELDS ON THE RECORD (IE ZEROIZE/BLANK OUT)
039850200529     C*
039860200529     C           ACTN      IFEQ 'I'
039870200529     C                     EXSR INITRC
039880200529     C                     END
039890200529     C*
039900200529     C** IF DELETED RECORD-ENQUIRY ONLY (RECI IS SET TO BLANK FOR
039910200529     C** INSERTS)
039920200529     C*
039930200529     C***********RECI      IFEQ '*'                                       084981
039940200529     C***********          MOVEL'E'       ACTN                            084981
039950200529     C***********          MOVEL'DELETED' DELT    7                       084981
039960200529     C***********          ELSE                                           084981
039970200529     C                     MOVEL*BLANK    DELT
039980200529     C                     SELEC                                          084981
039990200529     C           RECI      WHEQ '*'                                       084981
040000200529     C                     MOVEL'E'       ACTN                            084981
040010200529     C                     MOVEL'DELETED' DELT                            084981
040020200529     C           RECI      WHEQ 'M'                                       084981
040030200529     C           STAT      ANDEQ'M'                                                         AR324886
040040200529     C           ACTN      IFNE 'R'                                       186400
040050200529     C                     MOVEL'E'       ACTN                            084981
040060200529     C                     END                                            186400
040070200529     C                     MOVEL'MATURED' DELT                            084981
040080200529     C           RECI      WHEQ 'D'                                       084981
040090200529     C           PAUI      ANDEQ'Y'                                       084981
040100200529     C                     MOVEL'AUTHORI' DELT                            084981
040110200529     C                     MOVE 'SED'     DELT                            084981
040120200529     C           RECI      WHEQ 'M'                                                         AR324886
040130200529     C           STAT      ANDEQ'R'                                                         AR324886
040140200529     C                     MOVEL'REVERSE' DELT                                              AR324886
040150200529     C                     MOVE 'D  '     DELT                                              AR324886
040160200529     C           RECI      WHEQ 'R'                                                         AR324886
040170200529     C                     MOVEL'REV. AU' DELT                                              AR324886
040180200529     C                     MOVE 'TH.'     DELT                                              AR324886
040190200529     C                     END
040200200529     C*
040210200529     C**  TRANSLATE RECORD DETAILS FROM FILE LAYOUT TO SCREEN LAYOUT
040220200529     C*
040230200529     C**  READ SECTY TO PICK UP NOMINAL DEC PLACES
040240200529     C*
040250200529     C                     MOVE RECI      WWRECI  1                       S01496
040260200529     C           PSSH      CHAINSECTY                99
040270200529     C*                                                                   CAC002
040280200529     C**  DO NOT ALLOW AMENDMENT OF PROFIT CENTRE                         CAC002
040290200529     C*                                                                   CAC002
040300200529     C           BGN0ST    IFEQ 'Y'                                       CAC002
040310200529     C           ACTN      ANDEQ'A'                                       CAC002
040320200529     C                     MOVE *OFF      *IN83                           CAC002
040330200529     C                     ENDIF                                          CAC002
040340200529      *                                                                   CSE023
040350200529     C           CSE023    IFEQ 'Y'                                       CSE023
040360200529     C           CRTT      ANDNE*BLANKS                                   CSE023
040370200529     C                     MOVEL'Y'       WFREEM                          CSE023
040380200529     C                     ELSE                                           188588
040390200529     C                     MOVEL' '       WFREEM                          188588
040400200529     C                     ENDIF                                          CSE023
040410200529     C*                                                                   CSE007
040420200529     C                     MOVE *BLANKS   WWPTYP                          CSE007
040430200529     C           CSE007    IFEQ 'Y'                                       CSE007
040440200529     C           PEVT      ANDNE'CP'                                      CSE007
040450200529     C           PEVT      ANDNE'DV'                                      CSE007
040460200529     C           PEVT      ANDNE'PP'                                      CSE007
040470200529     C           PEVT      ANDNE'MT'                                      CSE007
040480200529     C           PEVT      ANDNE'MP'                                      CSE007
040490200529     C           PEVT      ANDNE'RC'                                      CSE007
040500200529     C*                                                                   CEU017
040510200529     C           CEU017    OREQ 'Y'                                       CEU017
040520200529     C           PEVT      ANDNE'CP'                                      CEU017
040530200529     C           PEVT      ANDNE'DV'                                      CEU017
040540200529     C           PEVT      ANDNE'PP'                                      CEU017
040550200529     C           PEVT      ANDNE'MT'                                      CEU017
040560200529     C           PEVT      ANDNE'MP'                                      CEU017
040570200529     C           PEVT      ANDNE'RC'                                      CEU017
040580200529     C*                                                                   CSE007
040590200529     C                     MOVE *IN99     WIN99   1                       CSE007
040600200529     C           PEVT      CHAINSECOATL0             99                   CSE007
040610200529     C           *IN99     IFEQ '0'                                       CSE007
040620200529     C                     MOVE MMPTYP    WWPTYP  2                       CSE007
040630200529     C                     MOVE 'Y'       CAEVNT                                              191161
040640200529     C           WWPTYP    IFEQ 'CC'                                      CEU017
040650200529     C           SRRB      ANDNE*BLANKS                                   CEU017
040660200529     C                     Z-ADDNMDP      NMDPOS  10                      CEU017
040670200529     C           SRRB      CHAINSECTY                99                   CEU017
040680200529     C                     ENDIF                                          CEU017
040690200529     C                     ENDIF                                          CSE007
040700200529     C                     MOVE WIN99     *IN99                           CSE007
040710200529     C*                                                                   CSE007
040720200529     C                     ENDIF                                          CSE007
040730200529      *                                                                   S01447
040740200529      *** If there is a security, check that the security is taxable      S01447
040750200529      *** If it is not, protect tax withheld fields                       S01447
040760200529      *                                                                   S01447
040770200529     C                     MOVE '1'       *IN09            PROTECT TAX FLDS01447
040780200529      *                                                                   S01447
040790200529     C           *IN99     IFEQ '0'                        *B1            S01447
040800200529     C           S01447    ANDEQ'Y'                                       S01447
040810200529     C           WFREEM    OREQ 'Y'                                       CSE023
040820200529      *                                                                   S01447
040830200529     C           PEVT      IFEQ 'CP'                       *B2            S01447
040840200529     C           PEVT      OREQ 'DV'                                      S01447
040850200529     C           PEVT      OREQ 'MT'                                      CSE023
040860200529     C           CSE007    OREQ 'Y'                                       CSE007
040870200529     C           WWPTYP    ANDEQ'DV'                                      CSE007
040880200529     C           CEU017    OREQ 'Y'                                       CEU017
040890200529     C           WWPTYP    ANDEQ'DV'                                      CEU017
040900200529      *                                                                   S01447
040910200529     C           SESN      CHAINSESWHTL0             99                   S01447
040920200529     C           *IN99     IFEQ '0'                        *B3            S01447
040930200529     C           WFREEM    OREQ 'Y'                                       CSE023
040940200529     C                     MOVE '0'       *IN09                           S01447
040950200529     C                     END                             *E3            S01447
040960200529     C                     END                             *E2            S01447
040970200529     C                     END                             *E1            S01447
040980200529      *                                                                   S01447
040990200529     C           ACTN      IFNE 'I'                                       S01117
041000200529     C                     EXSR TRSFS
041010200529     C                     ELSE                                                             AR851880
041020200529     C           CER049    IFEQ 'Y'                                                         AR851880
041030200529     C                     MOVE 'N'       P3TAX                                             AR851880
041040200529     C                     ENDIF                                                            AR851880
041050200529     C                     END                                            S01117
041060200529     C*
041070200529     C**  SET UP DEFAULTS (DONE ON BLANK FIELDS)
041080200529     C*
041090200529     C           *IN89     IFEQ '0'
041100200529     C                     EXSR DEFLTS
041110200529     C                     END
041120200529     C*
041130200529     C***IF*DELETE/ENQUIRY*PROTECT*FIELD*INPUT*ON*S/RECDETLS*****         S01496
041140200529     C** IF DELETE/ENQUIRY/REVERSAL PROTECT FIELD INPUT ON S/RECDETLS     S01496
041150200529     C*
041160200529     C           ACTN      IFEQ 'D'
041170200529     C           ACTN      OREQ 'E'
041180200529     C           ACTN      OREQ 'Y'                                       066716
041190200529     C           ACTN      OREQ 'R'                                       S01496
041200200529     C           S01496    ANDEQ'Y'                                       S01496
041210200529     C           ACTN      OREQ 'R'                                       CSE007
041220200529     C           CSE007    ANDEQ'Y'                                       CSE007
041230200529     C           ACTN      OREQ 'R'                                       CEU017
041240200529     C           CEU017    ANDEQ'Y'                                       CEU017
041250200529     C           ACTN      OREQ 'U'                                                         AR324886
041260200529     C                     MOVEA'1'       *IN,6            *PROTECT/NDS
041270200529     C                     END
041280200529      *                                                                   CAC002
041290200529      **  Check Customer Exists on Securities Customer File               CAC002
041300200529      *                                                                   CAC002
041310200529     C                     MOVELPCPY      CUSTNO                          CAC002
041320200529     C                     CALL 'AOSECSR0'                                CAC002
041330200529     C                     PARM *BLANKS   @RTCD                           CAC002
041340200529     C                     PARM '*KEY   ' @OPTN                           CAC002
041350200529     C                     PARM CUSTNO    CUST                            CAC002
041360200529     C           SDSECS    PARM SDSECS    DSSDY                           CAC002
041370200529      *                                                                   CAC002
041380200529      **  Display Profit Centre field if Customer Position Settlement     CAC002
041390200529      *                                                                   CAC002
041400200529     C                     MOVE '0'       *IN84                           CAC002
041410200529     C           BFCLAS    IFNE 'S'                                       CAC002
041420200529     C           BFCLAS    ANDNE'D'                                       CAC002
041430200529     C                     MOVE '1'       *IN84                           CAC002
041440200529     C                     ELSE                                                               191161
041450200529     C                     MOVEL'C'       PCPYTP                                              191161
041460200529     C                     ENDIF                                          CAC002
041470200529      *                                                                   186166
041480200529      ** Protect Tax field if action is 'A' and security is for           186166
041490200529      ** treaty tax, and for event = 'DV' and 'CP'.                       186166
041500200529      *                                                                   186166
041510200529     C           ACTN      IFEQ 'A'                                       186166
041520200529     C           WFREEM    ANDEQ'Y'                                       186166
041530200529     C           WFREEM    OREQ 'Y'                                       186166
041540200529     C           SPEVT     ANDEQ'DV'                                      186166
041550200529     C           WFREEM    OREQ 'Y'                                       186166
041560200529     C           SPEVT     ANDEQ'CP'                                      186166
041570200529     C                     MOVE '1'       *IN66                           186166
041580200529     C                     ELSE                                           186166
041590200529     C                     MOVE '0'       *IN66                           186166
041600200529     C                     ENDIF                                          186166
041610200529      *                                                                                       233711
041620200529      ** Check if EU Tax fields should be displayed.                                          233711
041630200529      *                                                                                       233711
041640200529     C**********           MOVE *OFF      *IN75                                        233711 234471
041650200529     C                     MOVE *OFF      *IN78                                               234471
041660200529      *                                                                                       233711
041670200529     C           CGL031    IFEQ 'Y'                                                           233711
041680200529     C********** *IN09     ANDEQ*OFF                                                   233711 234080
041690200529     C           SETX      ANDEQ'Y'                                                           233711
041700200529     C********** PROT      ANDNE'2'                                                    233711 234080
041710200529     C********** PROT      ANDNE'4'                                                    233711 234080
041720200529     C           BFCLAS    IFEQ 'S'                                                           233711
041730200529     C           BFCLAS    OREQ 'D'                                                           233711
041740200529     C**********           MOVE *ON       *IN75                                        233711 234471
041750200529     C                     MOVE *ON       *IN78                                               234471
041760200529     C                     ENDIF                                                              233711
041770200529     C                     ENDIF                                                              233711
041780200529      *                                                                                       CER049
041790200529     C           CER049    IFEQ 'Y'                                                           CER049
041800200529     C                     MOVE *ON       *IN63                                               CER049
041810200529     C                     ENDIF                                                              CER049
041820200529     C*
041830200529     C** D O    U N T I L   C H A N G E  O F  S C R E E N  -  S T A R T
041840200529     C*
041850200529     C           *IN10     DOUEQ'1'                        *
041860200529     C           *IN11     OREQ '1'
041870200529     C           *IN12     OREQ '1'
041880200529     C           ENDPGM    OREQ 'Y'                                       S01401
041890200529      *
041900200529      ***  Load up Info Messages
041910200529      *
041920200529     C           INFMSG    IFEQ *BLANK
041930200529     C           ACTN      IFEQ 'I'
041940200529     C                     MOVELINF,3     INFMSG
041950200529     C                     END
041960200529     C           ACTN      IFEQ 'A'
041970200529     C                     MOVELINF,4     INFMSG
041980200529     C                     END
041990200529     C           ACTN      IFEQ 'Y'
042000200529     C                     MOVELINF,5     INFMSG
042010200529     C                     END
042020200529     C           ACTN      IFEQ 'E'
042030200529     C                     MOVELINF,6     INFMSG
042040200529     C                     END
042050200529     C           ACTN      IFEQ 'D'
042060200529     C                     MOVELINF,7     INFMSG
042070200529     C                     END
042080200529     C           ACTN      IFEQ 'R'                                       S01496
042090200529     C           S01496    ANDEQ'Y'                                       S01496
042100200529     C           ACTN      OREQ 'R'                                       CSE007
042110200529     C           CSE007    ANDEQ'Y'                                       CSE007
042120200529     C           ACTN      OREQ 'R'                                       CEU017
042130200529     C           CEU017    ANDEQ'Y'                                       CEU017
042140200529     C                     MOVELINF,13    INFMSG                          S01496
042150200529     C                     END                                            S01496
042160200529     C           ACTN      IFEQ 'U'                                                         AR324886
042170200529     C                     MOVELINF,15    INFMSG                                            AR324886
042180200529     C                     ENDIF                                                            AR324886
042190200529     C                     END
042200200529     C/COPY WNCPYSRC,SE0170C016
042210200529      *
042220200529      ***  Detail Screen Output
042230200529      *
042240200529     C                     MOVELSPSCU     XSPSCU                          151506
042250200529     C/COPY WNCPYSRC,SE0170C050
042260200529     C                     WRITEKEYINPUT
042270200529     C/COPY WNCPYSRC,SE0170C051
042280200529     C**********           WRITERECDETLS                                                     BUG1992
042290200529     C                     WRITEMESSAGES
042300200529     C                     WRITERECDETLS                                                     BUG1992
042310200529     C                     READ RECDETLS                 99
042320200529     C/COPY WNCPYSRC,SE0170C102
042330200529     C                     MOVELERRMSG    HERCD
042340200529     C                     MOVELWBLNK     HERCD
042350200529     C                     MOVEL*BLANK    SCRMSG
042360200529     C*
042370200529     C***C*K*3*,*C*K12*,*H*E*L*P*,*R*O*L*L*U*P*/*D*O*W*N***-**S*T*A*R*T   S01199
042380200529     C** C K 3 , C K12 , R O L L U P / D O W N   -  S T A R T             S01199
042390200529     C*
042400200529     C** Call S/R to move values into AID                                 S01179
042410200529     C*                                                                   S01179
042420200529     C                     EXSR ASCHGS                                    S01179
042430200529     C*                                                                   S01179
042440200529     C** CK3 - TERMINATE
042450200529     C*
042460200529     C           AID       IFEQ '01'
042470200529     C                     MOVEA'1'       *IN,12
042480200529     C*
042490200529     C** CK12- INITIAL SCREEN
042500200529     C** If screen is displayed from the subfile, return to subfile       084981
042510200529     C*
042520200529     C                     ELSE
042530200529     C           AID       IFEQ '05'
042540200529     C           REVW      IFEQ 'Y'                                       084981
042550200529     C                     MOVEA'1'       *IN,11                          084981
042560200529     C                     ELSE                                           084981
042570200529     C                     MOVEA'1'       *IN,10
042580200529     C                     ENDIF                                          084981
042590200529     C*
042600200529     C***HELP***CALL*HELP*PROGRAM**************************************   S01199
042610200529     C***********                                                         S01199
042620200529     C***********          ELSE                                           S01199
042630200529     C***********AID       IFEQ 'HP'                                      S01199
042640200529     C***********          MOVELHERCD     ERRMSG                          S01199
042650200529     C***********ERR,1     IFNE *BLANK                                    S01199
042660200529     C***********          MOVELHI        ERRMSG                          S01199
042670200529     C***********          END                             *ERR,1         S01199
042680200529     C***********          CALL 'MHELP'                                   S01199
042690200529     C***********          PARM           HBPGM                           S01199
042700200529     C***********          PARM           HERCD                           S01199
042710200529     C*
042720200529     C** PAGE FORWARD TAKEN, READ NEXT RECORD
042730200529     C*
042740200529     C                     ELSE
042750200529     C           AID       IFEQ 'UP'
042760200529     C***********ACTN      ANDNE'I'                                       E20237
042770200529     C           ACTN      IFEQ 'E'                                       E20237
042780200529     C                     READ POSETX                   12
042790200529     C*
042800200529     C** CHANGE MESSAGE IF END OF FILE REACHED - NO ROLL FWD
042810200529     C*
042820200529     C           *IN,12    IFEQ '1'
042830200529     C                     MOVELINF,8     INFMSG
042840200529     C                     SETOF                     12                   E20237
042850200529     C           *HIVAL    SETLLPOSETX                                    E20237
042860200529     C                     READPPOSETX                   12               E20237
042870200529     C                     ELSE
042880200529     C                     MOVEA'1'       *IN,12
042890200529     C***********          MOVELPBCH      SPBCH                           S01117
042900200529     C                     MOVELPBCA      SPBCA                           S01117
042910200529     C                     MOVELPSSH      SPSSH
042920200529     C                     MOVELPCPY      SPCPY
042930200529     C                     MOVELPEVT      SPEVT
042940200529     C                     MOVELTXBS      STXBS                           186055
042950200529     C                     MOVE BNFO      SBNFO                           186055
042960200529     C                     MOVELEXCD      SEXCD                           186055
042970200529     C                     Z-ADDPDUD      ZDAYNO
042980200529     C                     EXSR ZDATE2
042990200529     C                     MOVELZDATE     SPDUD
043000200529     C**********           MOVELPAUI      SPAUI                                             AR324886
043010200529     C                     MOVELSPCPY     CUSTNO                          S01401
043020200529     C                     CALL 'AOSECSR0'                                S01401
043030200529     C                     PARM *BLANKS   @RTCD                           S01401
043040200529     C                     PARM '*KEY   ' @OPTN                           S01401
043050200529     C                     PARM CUSTNO    CUST                            S01401
043060200529     C           SDSECS    PARM SDSECS    DSSDY                           S01401
043070200529     C*                                                                   S01401
043080200529     C                     END
043090200529     C                     ELSE                                           E20237
043100200529     C                     MOVELINF,8     INFMSG                          E20237
043110200529     C                     END                                            E20237
043120200529     C** Page back is now being handled by CPF                            084981
043130200529     C***********                                                         084981
043140200529     C***PAGE*BACK*TAKEN,*READ*PREVIOUS*RECORD*************************** 084981
043150200529     C***********                                                         084981
043160200529     C***********          ELSE                                           084981
043170200529     C***********AID       IFEQ 'DN'                                      084981
043180200529     C***********ACTN      ANDNE'I'                                       E20237
043190200529     C***********ACTN      IFEQ 'E'                                E20237 084981
043200200529     C***********          READPPOSETX                   12               084981
043210200529     C***********                                                         084981
043220200529     C***CHANGE*MESSAGE*IF*BEGINNING*OF*FILE*REACHED*-*NO*ROLL*BACK****   084981
043230200529     C***********                                                         084981
043240200529     C************IN,12    IFEQ '1'                                       084981
043250200529     C***********          MOVELINF,9     INFMSG                          084981
043260200529     C***********          SETOF                     12            E20237 084981
043270200529     C************LOVAL    SETLLPOSETX                             E20237 084981
043280200529     C***********          READ POSETX                   12        E20237 084981
043290200529     C***********          ELSE                                           084981
043300200529     C***********          MOVEA'1'       *IN,12                          084981
043310200529     C***********          MOVELPBCH      SPBCH                           S01117
043320200529     C***********          MOVELPBCA      SPBCA                    S01117 084981
043330200529     C***********          MOVELPSSH      SPSSH                           084981
043340200529     C***********          MOVELPCPY      SPCPY                           084981
043350200529     C***********          MOVELPEVT      SPEVT                           084981
043360200529     C***********          Z-ADDPDUD      ZDAYNO                          084981
043370200529     C***********          EXSR ZDATE2                                    084981
043380200529     C***********          MOVELZDATE     SPDUD                           084981
043390200529     C***********          MOVELPAUI      SPAUI                           084981
043400200529     C***********          MOVELSPCPY     CUSTNO                   S01401 084981
043410200529     C***********          CALL 'AOSECSR0'                         S01401 084981
043420200529     C***********          PARM *BLANKS   @RTCD                    S01401 084981
043430200529     C***********          PARM '*KEY   ' @OPTN                    S01401 084981
043440200529     C***********          PARM CUSTNO    CUST                     S01401 084981
043450200529     C***********SDSECS    PARM SDSECS    DSSDY                    S01401 084981
043460200529     C***********                                                  S01401 084981
043470200529     C***********          END                                            084981
043480200529     C***********          ELSE                                    E20237 084981
043490200529     C***********          MOVELINF,9     INFMSG                   E20237 084981
043500200529     C***********          END                                     E20237 084981
043510200529     C***********                                                         084981
043520200529     C***NOT*CK3*CK12*HELP*ROLLUP*ROLLDOWN*****************************   S01199
043530200529     C***NOT*CK3,*CK12,*ROLLUP,*ROLLDOWN***************************S01199 084981
043540200529     C** NOT CK3, CK12, ROLLUP                                            084981
043550200529     C*
043560200529     C                     ELSE
043570200529     C*                                                                   S01117
043580200529     C**  Enter taken, check for query selection                          S01117
043590200529     C*                                                                   S01117
043600200529     C                     MOVE '0'       *IN35                           S01117
043610200529     C                     MOVE '0'       *IN37                           S01117
043620200529     C                     MOVEA'0000'    *IN,40                          S01117
043630200529     C                     MOVEA'0'       *IN,54                          S01117
043640200529     C                     EXSR D2QRY                                     S01117
043650200529     C           RDSPLY    IFEQ 'N'                                       S01117
043660200529      *
043670200529      ***  Validate Detail Screen Output
043680200529      *
043690200529     C                     EXSR VALIDD
043700200529     C                     EXSR PSAMT                                     151506
043710200529     C                     Z-ADDWPSAT     PSAT                            151506
043720200529     C/COPY WNCPYSRC,SE0170C103
043730200529     C*                                                                   E14214
043740200529     C**  IF WARNING ERRORS ONLY, UPDATE FILES                            E14214
043750200529     C*                                                                   E14214
043760200529     C           WEC       IFEQ EC                                        E14214
043770200529     C           WEC       ANDNE*ZEROS                                    E14214
043780200529     C***************      MOVE DETS      SCRDET187                       E17423
043790200529     C***********          MOVE DETS      SCRDET172                E17423 S01512
043800200529     C**********           MOVE DETS      SCRDET178                                    S01512 CGL029
043810200529     C                     MOVE DETS      SCRDET196                                           CGL029
043820200529     C/COPY WNCPYSRC,SE0170C017
043830200529     C                     WRITEKEYINPUT                                  E14214
043840200529     C/COPY WNCPYSRC,SE0170C052
043850200529     C**********           WRITERECDETLS                                              E14214 BUG1992
043860200529     C                     WRITEMESSAGES                                  E14214
043870200529     C                     WRITERECDETLS                                                     BUG1992
043880200529     C                     READ RECDETLS                 99               E14214
043890200529     C                     EXSR ASCHGS                                    E17423
043900200529     C*                                                                   E14214
043910200529     C           AID       IFEQ 'RA'                                      E14214
043920200529     C           DETS      ANDEQSCRDET                                    E16084
043930200529     C                     MOVE *BLANK    SCRDET                          E16084
043940200529     C                     MOVEL*BLANK    SCRMSG                          E14214
043950200529     C                     ELSE                                           E16084
043960200529     C*                                                                   E14214
043970200529     C           AID       IFEQ '05'                                      E17423
043980200529     C                     MOVEA'1'       *IN,10                          E17423
043990200529     C                     ELSE                                           E17423
044000200529     C*                                                                   E14214
044010200529     C***********AID       IFEQ 'HP'                               E17423 E23955
044020200529     C***********          MOVELHERCD     ERRMSG                   E17423 E23955
044030200529     C***********ERR,1     IFNE *BLANK                             E17423 E23955
044040200529     C***********          MOVELHI        ERRMSG                   E17423 E23955
044050200529     C***********          END                                     E17423 E23955
044060200529     C***********          CALL 'MHELP'                            E17423 S01199
044070200529     C***********          PARM           HBPGM                    E17423 S01199
044080200529     C***********          PARM           HERCD                    E17423 S01199
044090200529     C***********          ELSE                                    E17423 E23955
044100200529     C*                                                                   E14214
044110200529     C           AID       IFEQ '01'                                      E17423
044120200529     C                     MOVEA'1'       *IN,12                          E17423
044130200529     C                     END                                            E17423
044140200529     C*                                                                   E14214
044150200529     C***********          END                                     E17423 E23955
044160200529     C                     END                                            E17423
044170200529     C                     GOTO SCRCHG                                    E16084
044180200529     C                     END                                            E14214
044190200529     C                     END                                            E14214
044200200529     C*
044210200529     C** N O    D E T A I L   S C R E E N    E R R O R S   -  S T A R T
044220200529     C/COPY WNCPYSRC,SE0170C047
044230200529     C*
044240200529     C           SCRMSG    IFEQ *BLANK
044250200529     C           AID       ANDEQ'RA'
044260200529     C/COPY WNCPYSRC,SE0170C003
044270200529      *                                                                   S01401
044280200529      ***  If MT5xx Feature present and either Coupon or Dividend         S01401
044290200529      ***  Settlement with a Portfolio Client, call SE1817 for Input      S01401
044300200529      ***  of Extended Settlements.                                       S01401
044310200529      *                                                                   S01401
044320200529     C                     MOVE 'N'       W1817                           S01401
044330200529     C                     MOVE '00'      PCMD                            S01401
044340200529     C                     MOVE 'N'       PERR                            S01401
044350200529      *                                                                   S01401
044360200529     C           S01401    IFEQ 'Y'                                       S01401
044370200529      *                                                                   S01401
044380200529     C           SPEVT     IFEQ 'CP'                                      S01401
044390200529     C           SPEVT     OREQ 'DV'                                      S01401
044400200529      *                                                                   S01401
044410200529     C                     MOVELSPCPY     CUST                            084981
044420200529     C                     CALL 'AOSECSR0'                                084981
044430200529     C                     PARM *BLANKS   @RTCD                           084981
044440200529     C                     PARM '*KEY   ' @OPTN                           084981
044450200529     C                     PARM           CUST                            084981
044460200529     C           SDSECS    PARM SDSECS    DSSDY                           084981
044470200529      *                                                                   084981
044480200529     C           BFCLAS    IFEQ 'S'                                       S01401
044490200529     C           BFCLAS    OREQ 'D'                                       S01401
044500200529      *                                                                   S01401
044510200529     C                     MOVELACTN      PACTN                           S01401
044520200529     C                     MOVELSPBCA     PPBCA2                          S01401
044530200529     C                     MOVELSPSSH     PPSSH2                          S01401
044540200529     C**********           MOVELSPCPY     PPCPY2                                     S01401 BUG11688
044550200529     C                     MOVELBFCUST    PPCPY2                                            BUG11688
044560200529     C                     MOVELSPDUD     PPDUD2                          S01401
044570200529     C                     MOVELSPEVT     PPEVT2                          S01401
044580200529     C                     MOVELSPBCD     PPBKC2                                              CSE028
044590200529     C                     MOVELSPPTFR    PPTFR2                                              CSE028
044600200529     C                     MOVELNMCY      PPNCY                                               CSE034
044610200529     C                     MOVEL'Y'       W1817   1                       S01401
044620200529      *                                                                   S01401
044630200529     C/COPY WNCPYSRC,SE0170C104
044640200529     C                     CALL 'SE1817'                                  S01401
044650200529     C                     PARM           PCMD    2                       S01401
044660200529     C                     PARM           PERR    1                       S01401
044670200529     C                     PARM           PDATA                           S01401
044680200529     C                     PARM           WWRTRN  7                       S01401
044690200529     C                     PARM           WWEXRC                                              CSD015
044700200529     C/COPY WNCPYSRC,SE0170C105
044710200529      *                                                                   S01401
044720200529     C                     END                                            S01401
044730200529     C                     END                                            S01401
044740200529     C                     END                                            S01401
044750200529      *                                                                   S01401
044760200529      ***  Determine which Screen to return to:                           S01401
044770200529      *                                                                   S01401
044780200529      ***  If SE1817 has been called, (can only happen if MT5xx Feature   S01401
044790200529      ***  is present), selection is as follows:                          S01401
044800200529      *                                                                   S01401
044810200529      ***  :- F3 - End Program - Return to Midas Menu.                    S01401
044820200529      ***  :- F05 & REVW = 'Y'         | *IN11 | REVIEW                   S01401
044830200529      ***  :- F05 & REVW NOT = 'Y'     | *IN10 | START                    S01401
044840200529      ***  :- F12                      |       | UPDATE (by default)      S01401
044850200529      ***  :- ENTER & REVW = 'Y'       | *IN11 | REVIEW                   S01401
044860200529      ***  :- ENTER & REVW NOT = 'Y'   | *IN10 | START                    S01401
044870200529      *                                                                   S01401
044880200529     C                     MOVEL'N'       ENDPGM                          S01401
044890200529     C           W1817     IFEQ 'Y'                                       S01401
044900200529      *                                                                   S01401
044910200529     C                     SELEC                                          S01401
044920200529     C           PCMD      WHEQ '03'                                      S01401
044930200529     C                     MOVEL'01'      AID                             S01401
044940200529     C                     MOVEL'Y'       ENDPGM  1                       S01401
044950200529      *                                                                   S01401
044960200529     C           PCMD      WHEQ '05'                                      S01401
044970200529     C           REVW      ANDEQ'Y'                                       S01401
044980200529     C                     MOVEA'1'       *IN,11                          S01401
044990200529      *                                                                   S01401
045000200529     C           PCMD      WHEQ '05'                                      S01401
045010200529     C           REVW      ANDNE'Y'                                       S01401
045020200529     C                     MOVEA'1'       *IN,10                          S01401
045030200529      *                                                                   S01401
045040200529     C           PCMD      WHEQ '12'                                      S01401
045050200529      *                                                                   S01401
045060200529     C           PCMD      WHEQ '00'                                      S01401
045070200529     C           REVW      ANDEQ'Y'                                       S01401
045080200529     C***********          MOVELPPAGK     PAGK                     S01401 084981
045090200529     C                     MOVEA'1'       *IN,11                          S01401
045100200529      *                                                                   S01401
045110200529     C           PCMD      WHEQ '00'                                      S01401
045120200529     C           REVW      ANDNE'Y'                                       S01401
045130200529     C                     MOVEA'1'       *IN,10                          S01401
045140200529     C                     ENDSL                                          S01401
045150200529      *                                                                   S01401
045160200529      ***  Else SE1817 was not called                                     S01401
045170200529     C                     ELSE                                           S01401
045180200529     C*
045190200529     C**FOR REC.ADVANCE DETERMINE WHAT SCREEN TO RETURN TO
045200200529     C*
045210200529     C           REVW      IFEQ 'Y'
045220200529     C***********          MOVELPPAGK     PAGK                            084981
045230200529     C                     MOVEA'1'       *IN,11
045240200529     C                     ELSE
045250200529     C                     MOVEA'1'       *IN,10
045260200529     C                     END
045270200529      *                                                                   S01401
045280200529     C                     ENDIF                                          S01401
045290200529     C*
045300200529     C**     U  P  D  A  T  E      F  I  L  E  S
045310200529     C*
045320200529      ***  If the MT5xx Feature is present, If no command Key pressed     S01401
045330200529      ***  in SE1817 (if called) and NOT Enquiry, do the Update.          S01401
045340200529      ***  Thus, if a Command Key has been pressed in SE1817, the Main    S01401
045350200529      ***  Files do not get updated without the Extension Files.          S01401
045360200529      *                                                                   S01401
045370200529     C           S01401    IFEQ 'Y'                                       S01401
045380200529     C           PCMD      IFEQ '00'                                      S01401
045390200529     C           ACTN      ANDNE'E'                                       S01401
045400200529     C                     EXSR UPDFLS                                    S01401
045410200529     C                     ENDIF                                          S01401
045420200529     C                     ELSE                                           S01401
045430200529      *                                                                   S01401
045440200529     C*                                                                   S01408
045450200529     C/COPY WNCPYSRC,SE0170CCP3                                           S01408
045460200529     C*                                                                   S01408
045470200529     C           ACTN      IFEQ 'I'
045480200529     C           ACTN      OREQ 'A'
045490200529     C           ACTN      OREQ 'Y'
045500200529     C           ACTN      OREQ 'D'
045510200529     C           ACTN      OREQ 'R'                                       S01496
045520200529     C           S01496    ANDEQ'Y'                                       S01496
045530200529     C           ACTN      OREQ 'R'                                       CSE007
045540200529     C           CSE007    ANDEQ'Y'                                       CSE007
045550200529     C           ACTN      OREQ 'R'                                       CEU017
045560200529     C           CEU017    ANDEQ'Y'                                       CEU017
045570200529     C           ACTN      OREQ 'U'                                                         AR324886
045580200529     C                     EXSR UPDFLS
045590200529     C                     END
045600200529     C/COPY WNCPYSRC,SE0170C112
045610200529      *                                                                   S01401
045620200529     C                     ENDIF                                          S01401
045630200529     C*
045640200529     C** N O    D E T A I L   S C R E E N    E R R O R S   -  E N D
045650200529     C*
045660200529     C/COPY WNCPYSRC,SE0170C004
045670200529     C                     END
045680200529     C                     END                                            S01117
045690200529     C*
045700200529     C***C*K*3*,*C*K12*,*H*E*L*P*,*R*O*L*L*U*P*/*D*O*W*N***-**E*N:D
045710200529     C***C*K*3*,*C*K*12*,*R*O*L*L*U*P*/*D*O*W*N***-**E*N*D*************   084981
045720200529     C** C K 3 , C K 12 , R O L L U P  -  E N D                           084981
045730200529     C*
045740200529     C***********          END                                            084981
045750200529     C                     END
045760200529     C*********************END                                            S01199
045770200529     C                     END
045780200529     C                     END
045790200529     C*
045800200529     C** D O    U N T I L   C H A N G E  O F  S C R E E N  -  E N D
045810200529     C*
045820200529     C           SCRCHG    TAG                                         GE E16084
045830200529     C/COPY WNCPYSRC,SE0170C106
045840200529     C                     END
045850200529     C*
045860200529     C** RESET PROTECT/NON-DISPLAY INDS
045870200529     C*
045880200529     C                     MOVE *BLANKS   ERRMSG                          E14214
045890200529     C                     MOVE *BLANKS   INFMSG                          E14214
045900200529     C                     MOVEA'00'      *IN,5
045910200529     C/COPY WNCPYSRC,SE0170C043
045920200529     C*
045930200529     C                     ENDSR
045940200529     C*
045950200529     C*****************************************************************
045960200529      /EJECT                                                              S01179
045970200529     C*****************************************************************   S01179
045980200529     C*            ****** AS400 CONVERSION ******                     *   S01179
045990200529     C*                                                               *   S01179
046000200529     C*  ASCHGS  - S/R TO MOVE THE APPROPRIATE VALUES INTO FIELD AID, *   S01179
046010200529     C*            DEPENDING ON WHICH FUNCTION KEY HAS BEEN PRESSED.  *   S01179
046020200529     C*  CALLED FROM: UPDATE                                          *   S01179
046030200529     C*                                                               *   S01179
046040200529     C*****************************************************************   S01179
046050200529     C*                                                                   S01179
046060200529     C           ASCHGS    BEGSR                                          S01179
046070200529     C*                                                                   S01179
046080200529     C**  If ENTER pressed, the VLDCMDKEY indicator will be off           S01179
046090200529      **  or If F10 and 'REVERSAL'                                        186400
046100200529     C*                                                                   S01179
046110200529     C           *IN65     IFEQ '0'                                       S01179
046120200529     C                     MOVE 'RA'      AID                             S01179
046130200529     C                     END                                            S01179
046140200529     C*                                                                   S01179
046150200529     C**  If F3                                                           S01179
046160200529     C*                                                                   S01179
046170200529     C           *INKC     IFEQ '1'                                       S01179
046180200529     C                     MOVE '01'      AID                             S01179
046190200529     C                     MOVE '0'       *INKC                           S01179
046200200529     C/COPY WNCPYSRC,SE0170C107
046210200529     C                     END                                            S01179
046220200529     C*                                                                   S01179
046230200529     C**  If F10                                                          S01179
046240200529      **  and 'DELETE'                                                    186400
046250200529     C*                                                                   S01179
046260200529     C           *INKJ     IFEQ '1'                                       S01179
046270200529     C           ACTN      ANDEQ'R'                                       186400
046280200529     C           *INKJ     OREQ '1'                                       186400
046290200529     C           ACTN      ANDEQ'D'                                       186400
046300200529     C                     MOVE '04'      AID                             S01179
046310200529     C                     MOVE '0'       *INKJ                           S01179
046320200529     C                     MOVE '04'      PCMD                            S01401
046330200529     C                     END                                            S01179
046340200529     C*                                                                   S01179
046350200529     C**  If F12                                                          S01179
046360200529     C*                                                                   S01179
046370200529     C           *INKL     IFEQ '1'                                       S01179
046380200529     C                     MOVE '05'      AID                             S01179
046390200529     C                     MOVE '0'       *INKL                           S01179
046400200529     C                     MOVE ' '       ACTN                            103056
046410200529     C/COPY WNCPYSRC,SE0170C108
046420200529     C                     END                                            S01179
046430200529     C*                                                                   S01179
046440200529     C****If*ROLLUP*pressed********************************************                S01179 264059
046450200529      **  If ROLLUP pressed and *IN03 is off.                                                 264059
046460200529     C*                                                                   S01179
046470200529     C           *IN55     IFEQ '1'                                       S01179
046480200529     C           *IN03     ANDEQ'0'                                                           264059
046490200529     C                     MOVE 'UP'      AID                             S01179
046500200529     C                     MOVE '0'       *IN55                           S01179
046510200529     C                     END                                            S01179
046520200529     C*                                                                   S01179
046530200529     C****IF*ROLLDOWN*pressed*************************************S01179  084981
046540200529     C***********                                                 S01179  084981
046550200529     C************IN56     IFEQ '1'                               S01179  084981
046560200529     C***********          MOVE 'DN'      AID                     S01179  084981
046570200529     C***********          MOVE '0'       *IN56                   S01179  084981
046580200529     C***********          END                                    S01179  084981
046590200529     C***********                                                 S01179  084981
046600200529     C**If*HELP*key*pressed************************************** S01179  S01199
046610200529     C***********                                                 S01179  S01199
046620200529     C************IN57     IFEQ '1'                               S01179  S01199
046630200529     C***********          MOVE 'HP'      AID                     S01179  S01199
046640200529     C***********          MOVE '0'       *IN57                   S01179  S01199
046650200529     C***********          END                                    S01179  S01199
046660200529     C*                                                                   S01179
046670200529     C                     ENDSR                                          S01179
046680200529     C*                                                                   S01179
046690200529     C*****************************************************************
046700200529      /EJECT
046710200529     C*****************************************************************
046720200529     C*                                                               *
046730200529     C*  VALIDK  - S/R TO VALIDATE KEY FIELDS                         *
046740200529     C*  CALLED FROM: S/R START, REVIEW                               *
046750200529     C*  CALLS: ZDATE1                                                *
046760200529     C*                                                               *
046770200529     C*****************************************************************
046780200529     C*
046790200529     C           VALIDK    BEGSR                           ** VALIDK BSR**
046800200529     C*
046810200529     C** RESET ERROR INDICATORS
046820200529     C** SET ERROR ARRAY COUNTER TO ZERO
046830200529     C*
046840200529     C*********************MOVEA'000000'  *IN,21                          S01486
046850200529     C                     MOVEA'0000000' *IN,21                          S01486
046860200529     C***********          Z-ADD*ZERO     EC      40                      084981
046870200529     C***********          MOVE *BLANKS   XSPSXR                          E37165
046880200529     C                     MOVE *BLANKS   XSPBRX
046890200529     C*
046900200529     C** A C T I O N    C O D E    I N P U T - MUST BE BLANK,I,A,E,D
046910200529     C*
046920200529     C           ACTN      IFEQ 'I'                                       CSE003
046930200529      *                                                                   CSE010
046940200529      ** Process only if switchable feature CSE010 is off                 CSE010
046950200529      * If ? processing available and ? entered                           CSE003
046960200529      *                                                                   CSE010
046970200529     C           CSE010    IFEQ 'N'                                       CSE010
046980200529     C           CSE003    ANDEQ'Y'                                       CSE003
046990200529     C           SPSSH     ANDEQ'?'                                       CSE003
047000200529     C           *LOCK     IN   SESDS                                     CSE003
047010200529     C                     MOVE '6'       RTNC                            CSE003
047020200529     C                     MOVE *BLANKS   RQSESN                          CSE003
047030200529     C                     OUT  SESDS                                     CSE003
047040200529     C                     CALL 'SE0240'                                  CSE003
047050200529     C                     IN   SESDS                                     CSE003
047060200529     C           RTNC      IFNE '0'                                       CSE003
047070200529     C           RTNC      ANDNE'1'                                       CSE003
047080200529     C                     MOVE RQSESN    SPSSH                           CSE003
047090200529     C                     ENDIF                                          CSE003
047100200529     C                     ENDIF                                          CSE003
047110200529     C                     ENDIF                                          CSE010
047120200529      *                                                                   CSE003
047130200529     C           SPSSH     IFNE *BLANKS
047140200529     C           ACTN      IFNE 'I'
047150200529     C           ACTN      ANDNE'A'
047160200529     C           ACTN      ANDNE'D'
047170200529     C           ACTN      ANDNE'Y'
047180200529     C           ACTN      ANDNE'E'
047190200529     C           S01496    ANDNE'Y'                                       S01496
047200200529     C           CSE007    ANDNE'Y'                                       CSE007
047210200529     C           CEU017    ANDNE'Y'                                       CEU017
047220200529     C           ACTN      ANDNE'U'                                                         AR324886
047230200529     C*                                                                   S01496
047240200529     C           ACTN      ORNE 'I'                                       S01496
047250200529     C           ACTN      ANDNE'A'                                       S01496
047260200529     C           ACTN      ANDNE'D'                                       S01496
047270200529     C           ACTN      ANDNE'Y'                                       S01496
047280200529     C           ACTN      ANDNE'E'                                       S01496
047290200529     C           ACTN      ANDNE'R'                                       S01496
047300200529     C           S01496    ANDEQ'Y'                                       S01496
047310200529     C           ACTN      ANDNE'U'                                                         AR324886
047320200529     C*                                                                   CSE007
047330200529     C           ACTN      ORNE 'I'                                       CSE007
047340200529     C           ACTN      ANDNE'A'                                       CSE007
047350200529     C           ACTN      ANDNE'D'                                       CSE007
047360200529     C           ACTN      ANDNE'Y'                                       CSE007
047370200529     C           ACTN      ANDNE'E'                                       CSE007
047380200529     C           ACTN      ANDNE'R'                                       CSE007
047390200529     C           CSE007    ANDEQ'Y'                                       CSE007
047400200529     C           ACTN      ANDNE'U'                                                         AR324886
047410200529     C*                                                                   CEU017
047420200529     C           ACTN      ORNE 'I'                                       CEU017
047430200529     C           ACTN      ANDNE'A'                                       CEU017
047440200529     C           ACTN      ANDNE'D'                                       CEU017
047450200529     C           ACTN      ANDNE'Y'                                       CEU017
047460200529     C           ACTN      ANDNE'E'                                       CEU017
047470200529     C           ACTN      ANDNE'R'                                       CEU017
047480200529     C           CEU017    ANDEQ'Y'                                       CEU017
047490200529     C           ACTN      ANDNE'U'                                                         AR324886
047500200529     C*                                                                   084981
047510200529     C** Make sure that for subfile, this error will appear only once     084981
047520200529     C***********          ADD  1         EC                              084981
047530200529     C                     MOVE '1'       *IN21
047540200529     C           ' 100'    LOKUPERR                      64               084981
047550200529     C           *IN64     IFEQ '0'                                       084981
047560200529     C                     ADD  1         EC                              084981
047570200529     C                     MOVEL' 100'    ERR,EC
047580200529     C                     ENDIF                                          084981
047590200529     C                     END
047600200529     C                     ELSE
047610200529     C           ACTN      IFNE *BLANKS
047620200529     C*                                                                   084981
047630200529     C** Make sure that for subfile, this error will appear only once     084981
047640200529     C***********          ADD  1         EC                              084981
047650200529     C                     MOVE '1'       *IN21
047660200529     C           ' 100'    LOKUPERR                      64               084981
047670200529     C           *IN64     IFEQ '0'                                       084981
047680200529     C                     ADD  1         EC                              084981
047690200529     C                     MOVEL' 100'    ERR,EC
047700200529     C                     ENDIF                                          084981
047710200529     C                     END
047720200529     C                     END
047730200529     C*
047740200529     C** A C T I O N    C O D E    V A L I D - CHECK KEY FIELDS
047750200529     C*
047760200529     C           *IN,21    IFNE '1'
047770200529     C*
047780200529     C           ACTN      IFNE *BLANK
047790200529     C*
047800200529     C                     ELSE
047810200529     C*
047820200529     C** ACTION CODE BLANK BUT KEY INPUT
047830200529     C*
047840200529     C***********SPBCH     IFNE *BLANK                                    S01117
047850200529     C           SPBCA     IFNE *BLANK                                    S01117
047860200529     C           SPSSH     ORNE *BLANK
047870200529     C           SPCPY     ORNE *BLANK
047880200529     C           SPDUD     ORNE *BLANK
047890200529     C           SPEVT     ORNE *BLANK
047900200529     C           SPPTFR    ORNE *BLANK                     *PTFR INPUT    S01486
047910200529     C           BGPFMG    ANDEQ'Y'                                       S01486
047920200529     C           SPPTFR    ORNE *BLANK                     *PTFR INPUT    CPB001
047930200529     C           BGN4ST    ANDEQ'Y'                                       CPB001
047940200529     C           STXBS     ORNE *BLANKS                                   CSE023
047950200529     C           CSE023    ANDEQ'Y'                                       CSE023
047960200529     C           SBNFO     ORNE *BLANKS                                   CSE023
047970200529     C           CSE023    ANDEQ'Y'                                       CSE023
047980200529     C           SEXCD     ORNE *BLANKS                                   CSE023
047990200529     C           CSE023    ANDEQ'Y'                                       CSE023
048000200529     C*
048010200529     C** Make sure that for subfile, this error will appear only once     084981
048020200529     C           ' 100'    LOKUPERR                      64               084981
048030200529     C           *IN64     IFEQ '0'                                       084981
048040200529     C                     ADD  1         EC         21
048050200529     C                     MOVEL' 100'    ERR,EC
048060200529     C                     ENDIF                                          084981
048070200529     C*
048080200529     C                     END
048090200529     C*                                                                   S01496
048100200529     C** VALIDATE LIVE/ALL FIELD                                          S01496
048110200529     C** Make sure that for subfile, any error will appear only once      084981
048120200529     C           S01496    IFEQ 'Y'                                       S01496
048130200529     C           CSE007    OREQ 'Y'                                       CSE007
048140200529     C           CEU017    OREQ 'Y'                                       CEU017
048150200529     C*                                                                   S01408
048160200529     C/COPY WNCPYSRC,SE0170CP12                                           S01408
048170200529     C*                                                                   S01408
048180200529     C           REVW      IFEQ 'N'                                       S01496
048190200529     C           PPALL     ANDNE'L'                                       S01496
048200200529     C           PPALL     ANDNE'A'                                       S01496
048210200529     C           ' 998'    LOKUPERR                      64               084981
048220200529     C           *IN64     IFEQ '0'                                       084981
048230200529     C                     ADD  1         EC                              S01496
048240200529     C                     MOVEL' 998'    ERR,EC                          S01496
048250200529     C                     ENDIF                                          084981
048260200529     C                     MOVE *ON       *IN31                           S01496
048270200529     C                     ENDIF                                          S01496
048280200529     C                     ENDIF                                          S01496
048290200529     C*                                                                   S01496
048300200529     C                     END
048310200529     C                     END
048320200529     C*
048330200529     C** A C T I O N    C O D E    I
048340200529     C*
048350200529     C           ACTN      IFEQ 'I'
048360200529     C*
048370200529     C**  S E C U R I T Y  S H O R T N A M E
048380200529     C*
048390200529     C**  Must reference an active security on PF/SECTYD
048400200529     C*
048410200529     C           SPSSH     CHAINSECTY                99
048420200529     C  N99      RECI      COMP '*'                      99
048430200529     C           *IN99     IFEQ '1'
048440200529     C                     MOVE '1'       *IN23
048450200529     C*                                                                   084981
048460200529     C           ' 103'    LOKUPERR                      64               084981
048470200529     C           *IN64     IFEQ '0'                                       084981
048480200529     C                     ADD  1         EC
048490200529     C                     MOVEL' 103'    ERR,EC
048500200529     C                     ENDIF                                          084981
048510200529     C                     ELSE
048520200529     C           INVTPK    CHAININVTP                99
048530200529     C  N99      RECI      COMP '*'                      99
048540200529     C           *IN99     IFEQ '1'
048550200529     C                     MOVE '1'       *IN23
048560200529     C*                                                                   084981
048570200529     C           ' 103'    LOKUPERR                      64               084981
048580200529     C           *IN64     IFEQ '0'                                       084981
048590200529     C                     ADD  1         EC
048600200529     C                     MOVEL' 103'    ERR,EC
048610200529     C                     ENDIF                                          084981
048620200529     C                     ELSE
048630200529     C                     MOVELSPSSH     PSSH
048640200529     C                     END
048650200529     C                     END
048660200529     C*
048670200529     C**  If security OK check Event type
048680200529     C*
048690200529     C           *IN23     IFNE '1'
048700200529     C*
048710200529     C**  If Event type = 'CP', security on PF/SECTYD must
048720200529     C**  be interest bearing
048730200529     C** Make sure that for subfile, any error should appear only once    084981
048740200529     C*
048750200529     C           SPEVT     IFEQ 'CP'
048760200529     C           PROT      IFNE '1'
048770200529     C           PROT      ANDNE'3'
048780200529     C           PROT      ANDNE'5'
048790200529     C           PROT      ANDNE'6'
048800200529     C           PROT      ANDNE'8'
048810200529     C           PROT      ANDNE'9'                                       S01176
048820200529     C           STBS      ORNE 'P'
048830200529     C           STBS      ANDNE'Y'
048840200529     C                     MOVE '1'       *IN23
048850200529     C           ' 104'    LOKUPERR                      64               084981
048860200529     C           *IN64     IFEQ '0'                                       084981
048870200529     C                     ADD  1         EC
048880200529     C                     MOVEL' 104'    ERR,EC
048890200529     C                     ENDIF                                          084981
048900200529     C                     END
048910200529     C                     END
048920200529     C*
048930200529     C**  If Event type = 'DV', processing type must be for shares
048940200529     C*
048950200529     C           SPEVT     IFEQ 'DV'
048960200529     C           PROT      ANDNE'4'
048970200529     C           PROT      ANDNE'7'                                       179359
048980200529     C*                                                                   S01408
048990200529     C/COPY WNCPYSRC,SE0170CP13                                           S01408
049000200529     C*                                                                   S01408
049010200529     C                     MOVE '1'       *IN23
049020200529     C           ' 105'    LOKUPERR                      64               084981
049030200529     C           *IN64     IFEQ '0'                                       084981
049040200529     C                     ADD  1         EC
049050200529     C                     MOVEL' 105'    ERR,EC
049060200529     C                     ENDIF                                          084981
049070200529     C                     END
049080200529     C*
049090200529     C**  If Event type = 'PP', Partly paid ind must equal 'Y'
049100200529     C*
049110200529     C           SPEVT     IFEQ 'PP'
049120200529     C           PPDI      ANDNE'Y'
049130200529     C                     MOVE '1'       *IN23
049140200529     C           ' 106'    LOKUPERR                      64               084981
049150200529     C           *IN64     IFEQ '0'                                       084981
049160200529     C                     ADD  1         EC
049170200529     C                     MOVEL' 106'    ERR,EC
049180200529     C                     ENDIF                                          084981
049190200529     C                     END
049200200529     C*
049210200529     C**If*Event*type*=*'MT',*security*must*be*a*discount*******          S01496
049220200529     C* If Event type = 'MT' or 'RC', security must be a discount         S01496
049230200529     C**  or interest security with maturity date not all 9's
049240200529     C** Make sure that for subfile, any error should appear only once    084981
049250200529     C*
049260200529     C           SPEVT     IFEQ 'MT'
049270200529     C           SPEVT     OREQ 'RC'                                      S01496
049280200529     C           S01496    ANDEQ'Y'                                       S01496
049290200529     C           STBS      IFNE 'D'
049300200529     C           PROT      IFNE '1'
049310200529     C           PROT      ANDNE'3'
049320200529     C           PROT      ANDNE'5'
049330200529     C           PROT      ANDNE'6'
049340200529     C           PROT      ANDNE'8'
049350200529     C           PROT      ANDNE'9'                                       S01176
049360200529     C           STBS      ORNE 'P'
049370200529     C           STBS      ANDNE'Y'
049380200529     C           ' 107'    LOKUPERR                      64               084981
049390200529     C           *IN64     IFEQ '0'                                       084981
049400200529     C                     ADD  1         EC
049410200529     C                     MOVEL' 107'    ERR,EC
049420200529     C                     ENDIF                                          084981
049430200529     C                     ELSE
049440200529     C           MATY      IFEQ 99999
049450200529     C                     MOVE '1'       *IN23
049460200529     C           ' 107'    LOKUPERR                      64               084981
049470200529     C           *IN64     IFEQ '0'                                       084981
049480200529     C                     ADD  1         EC
049490200529     C                     MOVEL' 107'    ERR,EC
049500200529     C                     ENDIF                                          084981
049510200529     C                     END
049520200529     C                     END
049530200529     C                     ELSE
049540200529     C           MATY      IFEQ 99999
049550200529     C                     MOVE '1'       *IN23
049560200529     C           ' 107'    LOKUPERR                      64               084981
049570200529     C           *IN64     IFEQ '0'                                       084981
049580200529     C                     ADD  1         EC
049590200529     C                     MOVEL' 107'    ERR,EC
049600200529     C                     ENDIF                                          084981
049610200529     C                     END
049620200529     C                     END
049630200529     C                     END
049640200529     C                     END
049650200529     C*
049660200529     C**  C U S T O M E R   N U M B E R / S H O R T N A M E
049670200529     C*
049680200529     C***********          MOVELSPCPY     WRK6A   6                       S01117
049690200529     C***********          MOVE SPCPY     WRK4A   4                 E13952S01117
049700200529     C***********                                                         S01117
049710200529     C****If*numeric entry read CLINTSE file Else Read SNAME file         S01117
049720200529     C***********                                                         S01117
049730200529     C***********          TESTN          WRK6A      99                   S01117
049740200529     C************IN99     IFEQ '1'                                       S01117
049750200529     C***********          MOVELWRK6A     WRK6N   60                      S01117
049760200529     C***********WRK6N     CHAINCLINTSEF             99                   S01117
049770200529     C**N99******RECI      COMP '*'                      99               S01117
049780200529     C**N99******WRK4A     COMP *BLANKS              9999           E13952S01117
049790200529     C************IN99     IFEQ '1'                                       S01117
049800200529     C***********          MOVE '1'       *IN24                           S01117
049810200529     C***********          ADD  1         EC                              S01117
049820200529     C***********          MOVEL' 108'    ERR,EC                          S01117
049830200529     C***********          ELSE                                           S01117
049840200529     C***********          Z-ADDWRK6N     PCPY                            S01117
049850200529     C***********                                                         S01117
049860200529     C***********                                                   E17793S01117
049870200529     C****Store*Account Code and Account Sequence for defaulting laterE177S01117
049880200529     C***********                                                   E17793S01117
049890200529     C***********          MOVELC1AC      PC1AC   40                E17793S01117
049900200529     C***********          MOVELC1SQ      PC1SQ   20                E17793S01117
049910200529     C***********                                                   E17793S01117
049920200529     C***********          END                                            S01117
049930200529     C***********                                                         S01117
049940200529     C****Else*read SNAME file                                            S01117
049950200529     C***********                                                         S01117
049960200529     C***********          ELSE                                           S01117
049970200529     C***********                                                         S01117
049980200529     C***********SPCPY     CHAINSNAME                99                   S01117
049990200529     C**N99******RECI      COMP '*'                      99               S01117
050000200529     C***********                                                         S01117
050010200529     C****Error*if record not found here                                  S01117
050020200529     C***********                                                         S01117
050030200529     C************IN99     IFEQ '1'                                       S01117
050040200529     C***********          MOVE '1'       *IN24                           S01117
050050200529     C***********          ADD  1         EC                              S01117
050060200529     C***********          MOVEL' 108'    ERR,EC                          S01117
050070200529     C***********                                                         S01117
050080200529     C****Else*record found, use Customer number to read CLINTSE          S01117
050090200529     C***********                                                         S01117
050100200529     C***********          ELSE                                           S01117
050110200529     C***********CNUM      CHAINCLINTSEF             99    *              S01117
050120200529     C**N99******RECI      COMP '*'                      99*              S01117
050130200529     C************IN99     IFEQ '1'                                       S01117
050140200529     C***********          MOVE '1'       *IN24                           S01117
050150200529     C***********          ADD  1         EC                              S01117
050160200529     C***********          MOVEL' 108'    ERR,EC                          S01117
050170200529     C***********          ELSE                                           S01117
050180200529     C***********          Z-ADDCNUM      PCPY                            S01117
050190200529     C*                                                                   S01117
050200200529     C**  Check for numeric entry, or customer shortname                  S01117
050210200529     C*                                                                   S01117
050220200529     C                     MOVE '0'       *IN24                           S01117
050230200529     C***********          TESTN          SPCPY      85                   S01117              CSD027
050240200529     C************IN85     IFEQ '0'                                       S01117              CSD027
050250200529     C                     CALL 'AOCUSTR0'                                S01117
050260200529     C                     PARM *BLANKS   @RTCD                           S01117
050270200529     C                     PARM '*KEY   ' @OPTN                           S01117
050280200529     C                     PARM SPCPY     @KEY1  10                       S01117
050290200529     C                     PARM *BLANKS   @KYST   7                       S01117
050300200529     C           SDCUST    PARM SDCUST    DSSDY                           S01117
050310200529     C*                                                                   S01117
050320200529     C**  Invalid Entry                                                   S01117
050330200529     C*                                                                   S01117
050340200529     C           @RTCD     IFNE *BLANKS                                   S01117
050350200529     C                     MOVE '1'       *IN24                           S01117
050360200529     C                     MOVELSPCPY     CUSTNO                                              CSD027
050370200529     C                     ELSE                                           S01117
050380200529     C                     MOVELBBCUST    CUSTNO                          S01117
050390200529     C                     END                                            S01117
050400200529     C*                                                                   S01117
050410200529     C************         ELSE                                           S01117              CSD027
050420200529     C************         MOVELSPCPY     CUSTNO                          S01117              CSD027
050430200529     C************         END                                            S01117              CSD027
050440200529     C*                                                                   S01117
050450200529     C**  Check Customer Exists on Securities Customer File               S01117
050460200529     C*                                                                   S01117
050470200529     C           *IN24     IFEQ '0'                                       S01117
050480200529     C                     CALL 'AOSECSR0'                                S01117
050490200529     C                     PARM *BLANKS   @RTCD                           S01117
050500200529     C                     PARM '*KEY   ' @OPTN                           S01117
050510200529     C                     PARM CUSTNO    CUST                            S01117
050520200529     C           SDSECS    PARM SDSECS    DSSDY                           S01117
050530200529     C*                                                                   S01117
050540200529     C           @RTCD     IFNE *BLANKS                                   S01117
050550200529     C                     MOVE '1'       *IN24                           S01117
050560200529     C                     ELSE                                           S01117
050570200529     C                     MOVELBFCUST    PCPY                            S01117
050580200529     C                     END                                            S01117
050590200529     C                     END                                            S01117
050600200529     C*                                                                   S01117
050610200529     C**  Display error message                                           S01117
050620200529     C** For subfiles, this error must appear only once                   084981
050630200529     C*                                                                   S01117
050640200529     C           *IN24     IFEQ '1'                                       S01117
050650200529     C           ' 108'    LOKUPERR                      64               084981
050660200529     C           *IN64     IFEQ '0'                                       084981
050670200529     C                     ADD  1         EC                              S01117
050680200529     C                     MOVEL' 108'    ERR,EC                          S01117
050690200529     C                     ENDIF                                          084981
050700200529     C                     END                                            S01117
050710200529     C*                                                                   E17793
050720200529     C**  Store Account Code and Account Sequence for defaulting later    E17793
050730200529     C*                                                                   E17793
050740200529     C***********          MOVELC1AC      PC1AC                     E17793S01117
050750200529     C***********          MOVELC1SQ      PC1SQ                     E17793S01117
050760200529     C**********           MOVELBFACCD    PC1AC   40                                  S011117 CGL029
050770200529     C                     MOVELBFACCD    PC1AC  100                                          CGL029
050780200529     C                     MOVELBFACSN    PC1SQ   20                      S01117
050790200529     C*                                                                   S01117
050800200529     C**  Display Profit Centre field if Customer Position Settlement     S01117
050810200529     C*                                                                   S01117
050820200529     C                     MOVE '0'       *IN84                           S01117
050830200529     C           BFCLAS    IFNE 'S'                                       S01117
050840200529     C           BFCLAS    ANDNE'D'                                       S01117
050850200529     C                     MOVE '1'       *IN84                           S01117
050860200529     C                     END                                            S01117
050870200529     C*                                                                   E17793
050880200529     C***********          END                                            S01117
050890200529     C***********          END                                            S01117
050900200529     C***********          END                                            S01117
050910200529     C*
050920200529     C**  B R A N C H    C O D E
050930200529     C*
050940200529     C***********SPBCH     IFNE '   '                                     S01117
050950200529     C***********          MOVE *BLANKS   KEY                             S01117
050960200529     C***********          MOVEL'10'      TYPE                            S01117
050970200529     C***********          MOVE SPBCH     KEY                             S01117
050980200529     C***********TABKEY    CHAINTABLETRF             99                   S01117
050990200529     C**N99******RECI      COMP '*'                      99               S01117
051000200529     C************IN99     IFEQ '1'                                       S01117
051010200529     C***********          MOVE '1'       *IN22                           S01117
051020200529     C***********          ADD  1         EC                              S01117
051030200529     C***********          MOVEL' 109'    ERR,EC                          S01117
051040200529     C***********          ELSE                                           S01117
051050200529     C***********          MOVELSPBCH     PBCH                            S01117
051060200529     C***********          END                                            S01117
051070200529     C*                                                                   S01117
051080200529     C**  If Multibranching Indicator is on, use access object            S01117
051090200529     C*                                                                   S01117
051100200529     C           *IN81     IFEQ '1'                                       S01117
051110200529     C           SPBCA     IFNE *BLANKS                                   S01117
051120200529     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
051130200529     C                     CALL 'AOBRCHR1'                                                    CGL029
051140200529     C                     PARM *BLANKS   @RTCD                           S01117
051150200529     C                     PARM '*KEY   ' @OPTN                           S01117
051160200529     C                     PARM SPBCA     @DSNB   3                       S01117
051170200529     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01117              CGL029
051180200529     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
051190200529     C*                                                                   S01117
051200200529     C** Invalid Branch                                                   S01117
051210200529     C** For subfile, this error must appear only once                    084981
051220200529     C*                                                                   S01117
051230200529     C           @RTCD     IFNE *BLANKS                                   S01117
051240200529     C                     MOVE '1'       *IN22                           S01117
051250200529     C           ' 109'    LOKUPERR                      64               084981
051260200529     C           *IN64     IFEQ '0'                                       084981
051270200529     C                     ADD  1         EC                              S01117
051280200529     C                     MOVEL' 109'    ERR,EC                          S01117
051290200529     C                     ENDIF                                          084981
051300200529     C                     ELSE                                           S01117
051310200529     C                     MOVELSPBCA     PBCA                            S01117
051320200529     C                     END                                            S01117
051330200529     C*
051340200529     C****ELSE*USE*DEFAULT*FROM*TABTB36********************************   S01117
051350200529     C**  Else use default from DTAARA/ZMUSER                             S01117
051360200529     C*
051370200529     C                     ELSE
051380200529     C***********          MOVELDSTB      PBCH                            S01117
051390200529     C***********          MOVELDSTB      SPBCH                           S01117
051400200529     C                     MOVELUSRBCH    PBCA                            S01117
051410200529     C                     MOVELUSRBCH    SPBCA                           S01117
051420200529     C                     END
051430200529     C*                                                                   S01117
051440200529     C**  System not multibranched, use default branch from ZMUSER        S01117
051450200529     C*                                                                   S01117
051460200529     C                     ELSE                                           S01117
051470200529     C                     MOVELUSRBCH    PBCA                            S01117
051480200529     C                     END                                            S01117
051490200529      *                                                                   CSE023
051500200529      ** Validation processing for CSE023 STARTS here.                    CSE023
051510200529      **  Do this only if security, customer and event type are ok.       CSE023
051520200529      **  Validate tax basket and beneficial customer/owner number if,    CSE023
051530200529      **  CSE023 - Withholding tax treaty is installed.                   CSE023
051540200529      *                                                                   CSE023
051550200529     C           CSE023    IFEQ 'Y'                                       CSE023
051560200529     C           *IN23     ANDNE'1'                                       CSE023
051570200529     C           *IN24     ANDNE'1'                                       CSE023
051580200529      *                                                                   CSE023
051590200529      ** Initialize error indicators before validation.                   CSE023
051600200529     C                     MOVEA'000'     *IN,57                          CSE023
051610200529      *                                                                   CSE023
051620200529      ** Retrieve security details for the country of tax treaty.         CSE023
051630200529     C           SPSSH     CHAINSECTY                99                   CSE023
051640200529      *                                                                   CSE023
051650200529     C           CRTT      IFEQ *BLANKS                                   CSE023
051660200529      *                                                                   CSE023
051670200529      ** Set fields from enhancement to non-display.                      CSE023
051680200529      ** No need for tax fields to be available on detail screen input.   CSE023
051690200529      ** Do not override previous conditions for the tax fields.          CSE023
051700200529     C                     MOVE '0'       *IN20                           CSE023
051710200529     C                     MOVEL'N'       WFREEM                          CSE023
051720200529      *                                                                   CSE023
051730200529     C                     ELSE                                           CSE023
051740200529      *                                                                   CSE023
051750200529      ** Tax Basket and Beneficial owner not allowed if event type is     CSE023
051760200529      ** not 'DV' 'CP' or 'MT'.                                           CSE023
051770200529     C           SPEVT     IFNE 'DV'                                      CSE023
051780200529     C           SPEVT     ANDNE'CP'                                      CSE023
051790200529     C           SPEVT     ANDNE'MT'                                      CSE023
051800200529      *                                                                   CSE023
051810200529     C           STXBS     IFNE *BLANKS                                   CSE023
051820200529     C           SBNFO     ORNE *BLANKS                                   CSE023
051830200529      *                                                                   CSE023
051840200529      ** Make sure error message appears only once on screen.             CSE023
051850200529     C           ' 700'    LOKUPERR                      64               CSE023
051860200529     C           *IN64     IFEQ '0'                                       CSE023
051870200529     C                     ADD  1         EC                              CSE023
051880200529     C                     MOVEL' 700'    ERR,EC                          CSE023
051890200529     C                     ENDIF                                          CSE023
051900200529      *                                                                   CSE023
051910200529      ** Highlight fields in error.                                       CSE023
051920200529     C           STXBS     IFNE *BLANKS                                   CSE023
051930200529     C                     MOVE '1'       *IN58                           CSE023
051940200529     C                     ENDIF                                          CSE023
051950200529      *                                                                   CSE023
051960200529     C           SBNFO     IFNE *BLANKS                                   CSE023
051970200529     C                     MOVE '1'       *IN59                           CSE023
051980200529     C                     ENDIF                                          CSE023
051990200529     C                     ENDIF                                          CSE023
052000200529      *                                                                   CSE023
052010200529     C                     ELSE                                           CSE023
052020200529      *                   *=====*                                         CSE023
052030200529      *                                                                   CSE023
052040200529      ** Country of tax treaty defined, validate tax basket and           CSE023
052050200529      ** beneficial owner.                                                CSE023
052060200529      *                                                                   CSE023
052070200529      ** Make sure fields from enhancement are displayed on screen.       CSE023
052080200529      ** Override availability of tax fields on previous conditions.      CSE023
052090200529     C                     MOVE '1'       *IN20                           CSE023
052100200529     C                     MOVEL'Y'       WFREEM                          CSE023
052110200529      *                                                                   CSE023
052120200529      ** Setup key fields.                                                CSE023
052130200529     C                     MOVELBFCUST    KYCSNO                          CSE023
052140200529     C                     MOVELCRTT      KYCRTT                          CSE023
052150200529     C           SBNFO     IFNE *BLANKS                                   CSE023
052160200529     C                     MOVELBFCUST    KYBNFO                          CSE023
052170200529     C                     MOVE SBNFO     KYBNFO                          CSE023
052180200529     C                     ELSE                                           CSE023
052190200529     C                     MOVE *BLANKS   KYBNFO                          CSE023
052200200529     C                     END                                            CSE023
052210200529      *                                                                   CSE023
052220200529      ** Perform chaining of necessary data files for validation.         CSE023
052230200529     C           BFCLAS    IFEQ 'S'                                       CSE023
052240200529     C           BFCLAS    OREQ 'D'                                       CSE023
052250200529     C           WTAKEY    CHAINSDWTCSL1             99                   CSE023
052260200529     C           *IN99     IFEQ *ON                                       CSE023
052270200529     C                     MOVE '1'       *IN24                           CSE023
052280200529      *                                                                   CSE023
052290200529      ** Make sure error message appears only once on screen.             CSE023
052300200529     C********** ' 701'    LOKUPERR                      64                            CSE023 222756
052310200529     C           ' W04'    LOKUPERR                      64                                   222756
052320200529     C           *IN64     IFEQ '0'                                       CSE023
052330200529     C                     ADD  1         WEC                                                 222756
052340200529     C                     ADD  1         EC                              CSE023
052350200529     C**********           MOVEL' 701'    ERR,EC                                       CSE023 222756
052360200529     C                     MOVEL' W04'    ERR,EC                                              222756
052370200529     C                     ENDIF                                          CSE023
052380200529      *                                                                   CSE023
052390200529     C                     ELSE                                           CSE023
052400200529     C                     MOVE WHRPCD    RPCD                            CSE023
052410200529     C                     ENDIF                                          CSE023
052420200529     C                     ENDIF                                          CSE023
052430200529      *                                                                   CSE023
052440200529     C           STXBS     IFNE *BLANKS                                   CSE023
052450200529     C           WTBKEY    CHAINSDTXBSL1             99                   CSE023
052460200529     C           *IN99     IFEQ *ON                                       CSE023
052470200529     C                     MOVE '1'       *IN58                           CSE023
052480200529      *                                                                   CSE023
052490200529      ** Make sure error message appears only once on screen.             CSE023
052500200529     C           ' 702'    LOKUPERR                      64               CSE023
052510200529     C           *IN64     IFEQ '0'                                       CSE023
052520200529     C                     ADD  1         EC                              CSE023
052530200529     C                     MOVEL' 702'    ERR,EC                          CSE023
052540200529     C                     ENDIF                                          CSE023
052550200529      *                                                                   CSE023
052560200529     C                     ENDIF                                          CSE023
052570200529     C                     ENDIF                                          CSE023
052580200529      *                                                                   CSE023
052590200529      ** Beneficial Customer is optional, but if entered must be a        CSE023
052600200529      ** valid record on file.                                            CSE023
052610200529     C           SBNFO     IFNE *BLANKS                                   CSE023
052620200529     C/COPY WNCPYSRC,SE0170C110
052630200529     C           WBOKEY    CHAINSDBNFOL2             99                   CSE023
052640200529     C/COPY WNCPYSRC,SE0170C111
052650200529     C           *IN99     IFEQ *ON                                       CSE023
052660200529     C                     MOVE '1'       *IN59                           CSE023
052670200529      *                                                                   CSE023
052680200529      ** Make sure error message appears only once on screen.             CSE023
052690200529     C           ' 704'    LOKUPERR                      64               CSE023
052700200529     C           *IN64     IFEQ '0'                                       CSE023
052710200529     C                     ADD  1         EC                              CSE023
052720200529     C                     MOVEL' 704'    ERR,EC                          CSE023
052730200529     C                     ENDIF                                          CSE023
052740200529      *                                                                   CSE023
052750200529     C                     ENDIF                                          CSE023
052760200529      *                                                                   CSE023
052770200529     C                     ENDIF                                          CSE023
052780200529      *                                                                   CSE023
052790200529     C********** SBNFO     IFNE *BLANKS                            CSE023 185811
052800200529     C**********           MOVE '1'       *IN59                    CSE023 185811
052810200529     C**********           ENDIF                                   CSE023 185811
052820200529      *                                                                   CSE023
052830200529     C**********           ENDIF                                   CSE023 185811
052840200529      *                                                                   CSE023
052850200529      ** Beneficial Owner not allowed if Intermediary Status is 'QI'.     CSE023
052860200529     C           WHINTS    IFEQ 'QI'                                      CSE023
052870200529     C           SBNFO     ANDNE*BLANKS                                   CSE023
052880200529      *                                                                   CSE023
052890200529     C                     MOVE '1'       *IN59                           CSE023
052900200529      *                                                                   CSE023
052910200529      ** Make sure error message appears only once on screen.             CSE023
052920200529     C           ' 703'    LOKUPERR                      64               CSE023
052930200529     C           *IN64     IFEQ '0'                                       CSE023
052940200529     C                     ADD  1         EC                              CSE023
052950200529     C                     MOVEL' 703'    ERR,EC                          CSE023
052960200529     C                     ENDIF                                          CSE023
052970200529      *                                                                   CSE023
052980200529     C                     ENDIF                                          CSE023
052990200529      *                                                                   CSE023
053000200529      *                                                                   CSE023
053010200529     C           SEXCD     IFNE *BLANKS                                   CSE023
053020200529     C           WTEKEY    CHAINSDEXEML1             99                   CSE023
053030200529      *                                                                   CSE023
053040200529     C           *IN99     IFEQ *ON                                       CSE023
053050200529     C                     MOVE '1'       *IN57                           CSE023
053060200529      *                                                                   CSE023
053070200529      ** Make sure error message appears only once on screen.             CSE023
053080200529     C           ' 705'    LOKUPERR                      64               CSE023
053090200529     C           *IN64     IFEQ '0'                                       CSE023
053100200529     C                     ADD  1         EC                              CSE023
053110200529     C                     MOVEL' 705'    ERR,EC                          CSE023
053120200529     C                     ENDIF                                          CSE023
053130200529      *                                                                   CSE023
053140200529     C                     ENDIF                                          CSE023
053150200529      *                                                                   CSE023
053160200529     C                     ENDIF                                          CSE023
053170200529      *                                                                   185811
053180200529      ** Default Tax basket and Exemption Code if no error and for        185811
053190200529      ** Insert.                                                          185811
053200200529      *                                                                   185811
053210200529     C                     MOVE 'Y'       @DPTXB  1                       185811
053220200529     C           ACTN      IFEQ 'I'                                       185811
053230200529     C           *IN24     ANDNE'1'                                       185811
053240200529     C           *IN57     ANDNE'1'                                       185811
053250200529     C           *IN58     ANDNE'1'                                       185811
053260200529     C           *IN59     ANDNE'1'                                       185811
053270200529     C           *IN64     ANDNE'1'                                       185811
053280200529     C*                                                                   185811
053290200529     C           BFCLAS    IFEQ 'S'                                       185811
053300200529     C           BFCLAS    OREQ 'D'                                       185811
053310200529     C           STXBS     IFEQ *BLANKS                                   185811
053320200529      *                                                                   185811
053330200529     C                     CALL 'SETXBDFT'             99                 185811
053340200529     C                     PARM BFCUST    @CUST   6                       185811
053350200529     C                     PARM SPSSH     @SECT  10                       185811
053360200529     C                     PARM SBNFO     @BEN   20                       185811
053370200529     C                     PARM SPEVT     @EVNT   2                       185811
053380200529     C                     PARM           @BAST   2                       185811
053390200529     C                     PARM           @EXCD   2                       185811
053400200529     C                     PARM           @RECD   2                       185811
053410200529     C                     PARM           @PGMER  1                       185811
053420200529      *                                                                   185811
053430200529     C           @PGMER    IFEQ 'Y'                                       185811
053440200529     C           *IN99     OREQ 'Y'                                       185811
053450200529     C           *LOCK     IN   LDA                                       185811
053460200529     C                     MOVEL'SETXBDFT'DBFILE           ***************185811
053470200529     C                     MOVEL'*PGM'    DBKEY            * DB ERROR 28 *185811
053480200529     C                     Z-ADD28        DBASE            ***************185811
053490200529     C                     OUT  LDA                                       185811
053500200529     C                     MOVE *ON       *INU7                           185811
053510200529     C                     MOVE *ON       *INU8                           185811
053520200529     C                     MOVE *ON       *INLR                           185811
053530200529     C                     EXSR *PSSR                                     185811
053540200529     C                     END                                            185811
053550200529      *                                                                   185811
053560200529      ** If no error, set up default                                      185811
053570200529      *                                                                   185811
053580200529     C           STXBS     IFEQ *BLANKS                                   185811
053590200529     C                     MOVE @BAST     STXBS                           185811
053600200529     C                     END                                            185811
053610200529      *                                                                   185811
053620200529     C           SEXCD     IFEQ *BLANKS                                   185811
053630200529     C                     MOVE @EXCD     SEXCD                           185811
053640200529     C                     END                                            185811
053650200529      *                                                                   185811
053660200529     C                     MOVE 'N'       @DPTXB                          185811
053670200529      *                                                                   185811
053680200529     C                     END                                            185811
053690200529     C                     END                                            185811
053700200529     C                     END                                            185811
053710200529      *                                                                   CSE023
053720200529     C                     ENDIF                                          185811
053730200529     C                     ENDIF                                          CSE023
053740200529      *                                                                   CSE023
053750200529      ** Validation processing for CSE023 ENDS here.                      CSE023
053760200529     C                     ENDIF                                          CSE023
053770200529      *                                                                   CSE023
053780200529     C*
053790200529     C**  D U E  D A T E
053800200529     C** For subfiles, make sure that error codes must appear only once   084981
053810200529     C*
053820200529     C           SPDUD     IFNE *BLANKS
053830200529     C                     MOVE SPDUD     SPDUDN  60
053840200529     C                     MOVE SPDUDN    SPDUDA  6
053850200529     C           SPDUD     COMP SPDUDA               9999
053860200529     C           *IN99     IFNE '1'
053870200529     C                     Z-ADDSPDUDN    ZDATE
053880200529     C                     EXSR ZDATE1
053890200529     C                     END
053900200529     C                     ELSE                                           E18193
053910200529     C                     MOVE RUND      ZDAYNO                          E18193
053920200529     C                     EXSR ZDATE2                                    E18193
053930200529     C                     MOVE ZDATE     SPDUD                           E18193
053940200529     C                     END
053950200529     C           *IN99     IFEQ '1'
053960200529     C***********SPDUD     OREQ *BLANKS                                   E18193
053970200529     C                     MOVE '1'       *IN25
053980200529     C*                                                                   084981
053990200529     C           ' 112'    LOKUPERR                      64               084981
054000200529     C           *IN64     IFEQ '0'                                       084981
054010200529     C                     ADD  1         EC
054020200529     C                     MOVEL' 112'    ERR,EC
054030200529     C                     ENDIF                                          084981
054040200529     C                     ELSE
054050200529     C           ZDAYNO    IFGT RUND
054060200529     C                     MOVE '1'       *IN25
054070200529     C*                                                                   084981
054080200529     C           ' 114'    LOKUPERR                      64               084981
054090200529     C           *IN64     IFEQ '0'                                       084981
054100200529     C                     ADD  1         EC
054110200529     C                     MOVEL' 114'    ERR,EC
054120200529     C                     ENDIF                                          084981
054130200529     C                     ELSE
054140200529     C                     Z-ADDZDAYNO    PDUD
054150200529     C                     END
054160200529     C                     END
054170200529     C*
054180200529     C           SPEVT     IFNE 'CP'
054190200529     C           SPEVT     ANDNE'DV'
054200200529     C           SPEVT     ANDNE'PP'
054210200529     C           SPEVT     ANDNE'MT'
054220200529     C           SPEVT     ANDNE'MP'
054230200529     C*                                                                   S01496
054240200529     C           SPEVT     IFEQ 'RC'                                      S01496
054250200529     C           S01496    ANDEQ'Y'                                       S01496
054260200529     C                     MOVELSPEVT     PEVT                            S01496
054270200529     C                     ELSE                                           S01496
054280200529     C*                                                                   S01496
054290200529     C           CSE007    IFEQ 'Y'                                       CSE007
054300200529     C           CEU017    OREQ 'Y'                                       CEU017
054310200529     C*                                                                   CSE007
054320200529     C           SPEVT     CHAINSECOATL0             99                   CSE007
054330200529     C           *IN99     IFEQ '0'                                       CSE007
054340200529     C                     MOVELSPEVT     PEVT                            CSE007
054350200529     C                     ENDIF                                          CSE007
054360200529     C*                                                                   CSE007
054370200529     C                     ELSE                                           CSE007
054380200529     C                     MOVE '0'       *IN99                           CSE007
054390200529     C                     ENDIF                                          CSE007
054400200529     C*                                                                   CSE007
054410200529     C           CSE007    IFEQ 'Y'                                       CSE007
054420200529     C           *IN99     ANDEQ'1'                                       CSE007
054430200529     C           CSE007    ORNE 'Y'                                       CSE007
054440200529     C           CEU017    OREQ 'Y'                                       CEU017
054450200529     C           *IN99     ANDEQ'1'                                       CEU017
054460200529     C           CEU017    ORNE 'Y'                                       CEU017
054470200529     C                     MOVE '1'       *IN26
054480200529     C           ' 113'    LOKUPERR                      64               084981
054490200529     C           *IN64     IFEQ '0'                                       084981
054500200529     C                     ADD  1         EC
054510200529     C                     MOVEL' 113'    ERR,EC
054520200529     C                     ENDIF                                          084981
054530200529     C                     ENDIF                                          CSE007
054540200529     C                     END                                            S01496
054550200529     C*                                                                   S01496
054560200529     C                     ELSE
054570200529     C                     MOVELSPEVT     PEVT
054580200529     C                     END
054590200529     C** IF PORTFOLIO MANAGEMENT INSTALLED VALIDATE PORTFOLIO REFERENCE   S01486
054600200529     C** OR IF PRIVATE BANKING INSTALLED                                  CPB001
054610200529     C*                                                                   S01486
054620200529     C           BGPFMG    IFEQ 'Y'                        B1             S01486
054630200529     C           BGN4ST    OREQ 'Y'                                       CPB001
054640200529     C                     MOVE 'N'       WWEXC   1                       CPB001
054650200529     C           BGPFMG    IFEQ 'Y'                        B2             CPB001
054660200529     C*                                                                   S01486
054670200529     C** MOVE CHAR. FIELD INTO NUMERIC FOR CHAIN TO PMPORTPD              S01486
054680200529     C***********          MOVE SPCPY     WWCNUM                          S01486
054690200529     C**********           Z-ADDPCPY      WWCNUM                                       S01486 CSD027
054700200529     C                     MOVE PCPY      WWCNUM                                              CSD027
054710200529     C                     MOVELSPCPY     WPLCS                           S01486
054720200529     C*                                                                   S01486
054730200529     C**    Check if the customer is a Portfolio Management Customer      S01486
054740200529     C*                                                                   S01486
054750200529     C                     CALL 'AOPLCSR0'                                S01486
054760200529     C                     PARM *BLANKS   PRTCD   7                       S01486
054770200529     C                     PARM '*KEY'    POPTN   7                       S01486
054780200529     C                     PARM WPLCS     PLCUS  10                       S01486
054790200529     C***********          PARM           PKYST   7                       S01486
054800200529     C           SDPLCS    PARM SDPLCS    DSFDY                           S01486
054810200529     C*                                                                   CPB001
054820200529     C           PRTCD     IFEQ *BLANKS                                   CPB001
054830200529     C                     MOVE 'Y'       WWEXC                           CPB001
054840200529     C                     ENDIF                                          CPB001
054850200529     C                     ENDIF                           E2             CPB001
054860200529     C*                                                                   CPB001
054870200529     C           BGN4ST    IFEQ 'Y'                        B2             CPB001
054880200529     C**********           Z-ADDPCPY      WWCNUM                                       CPB001 CSD027
054890200529     C                     MOVE PCPY      WWCNUM                                              CSD027
054900200529     C                     MOVELSPCPY     WPLCS                           CPB001
054910200529     C                     CALL 'AOCUSTR1'                                CPB001
054920200529     C                     PARM *BLANKS   @RTCD                           CPB001
054930200529     C                     PARM '*KEY   ' @OPTN                           CPB001
054940200529     C                     PARM WPLCS     @KEY1                           CPB001
054950200529     C                     PARM *BLANKS   @KYST                           CPB001
054960200529     C           SDCUST    PARM SDCUST    DSLDY                           CPB001
054970200529     C           @RTCD     IFEQ *BLANKS                                   CPB001
054980200529     C           BBPRBA    ANDEQ'Y'                                       CPB001
054990200529     C                     MOVE 'Y'       WWEXC                           CPB001
055000200529     C                     ENDIF                                          CPB001
055010200529     C                     ENDIF                           E2             CPB001
055020200529     C*                                                                   S01486
055030200529     C**    If the customer is a Portfolio Management Customer ...        S01486
055040200529     C**    Or Private Banking Customer                                   CPB001
055050200529     C*                                                                   S01486
055060200529     C********** PRTCD     IFEQ *BLANKS                            S01486 CPB001
055070200529     C           WWEXC     IFEQ 'Y'                                       CPB001
055080200529     C*                                                                   CPB001
055090200529     C           SPPTFR    IFEQ *BLANKS                                   CPB001
055100200529     C           WWCNUM    SETLLPMPORTPD                                  CPB001
055110200529     C           WWCNUM    READEPMPORTPD                 99               CPB001
055120200529     C           *IN99     IFEQ *OFF                                      CPB001
055130200529     C                     MOVELPNPTFR    SPPTFR                          CPB001
055140200529     C                     ENDIF                                          CPB001
055150200529     C                     ENDIF                                          CPB001
055160200529     C*                                                                   S01486
055170200529     C*     then validate the reference                                   S01486
055180200529     C*                                                                   S01486
055190200529     C           PORTK     CHAINPMPORTPD             99                   S01486
055200200529     C*                                                                   S01486
055210200529     C*       If the reference is invalid then check it is not the        S01486
055220200529     C*        9997 reference and if not then error this                  S01486
055230200529     C*                                                                   S01486
055240200529     C           *IN99     IFEQ '1'                        B3             S01486
055250200529     C           PNRECI    OREQ '*'                                       S01486
055260200529     C           FCR997    IFNE SPPTFR                     B4             S01486
055270200529     C           BGN4ST    OREQ 'Y'                                       CPB001
055280200529     C                     MOVE '1'       *IN27                           S01486
055290200529     C                     ADD  1         EC                              S01486
055300200529     C                     MOVEL' 999'    ERR,EC                          S01486
055310200529     C                     ELSE                            X4             S01486
055320200529     C                     MOVE '9997'    PTFR                            S01486
055330200529     C                     END                             E4          P  S01486
055340200529     C*                                                                   S01486
055350200529     C                     ELSE                            X3             S01486
055360200529     C*                                                                   S01486
055370200529     C*      otherwise copy the reference into the file field ...         S01486
055380200529     C*                                                                   S01486
055390200529     C                     MOVE SPPTFR    PTFR                            S01486
055400200529     C                     END                             E3          OK S01486
055410200529     C                     ELSE                            X2             S01486
055420200529     C*                                                                   S01486
055430200529     C*  ELSE if NOT Portfolio Management Customer then error any entry   S01486
055440200529     C*  Or not Private Banking Customer                                  CPB001
055450200529     C*                                                                   S01486
055460200529     C           SPPTFR    IFNE *BLANKS                    B2             S01486
055470200529     C                     MOVE '1'       *IN27                           S01486
055480200529     C                     ADD  1         EC                              S01486
055490200529     C                     MOVEL' 999'    ERR,EC                          S01486
055500200529     C                     ELSE                            X2             S01486
055510200529     C                     MOVE *BLANKS   PTFR                            S01486
055520200529     C                     END                             E2             S01486
055530200529     C*                                                                   S01486
055540200529     C                     END                             E1          1  S01486
055550200529     C                     END                                            S01486
055560200529     C*
055570200529     C** N O   E R R O R  O N  K E Y  F I E L D S
055580200529     C*
055590200529     C           *IN22     IFNE '1'
055600200529     C           *IN23     ANDNE'1'
055610200529     C           *IN24     ANDNE'1'
055620200529     C           *IN25     ANDNE'1'
055630200529     C           *IN26     ANDNE'1'
055640200529     C           BGPFMG    ANDNE'Y'                                       S01486
055650200529     C*                                                                   S01486
055660200529     C           BGPFMG    OREQ 'Y'                                       S01486
055670200529     C           *IN22     ANDNE'1'                                       S01486
055680200529     C           *IN23     ANDNE'1'                                       S01486
055690200529     C           *IN24     ANDNE'1'                                       S01486
055700200529     C           *IN25     ANDNE'1'                                       S01486
055710200529     C           *IN26     ANDNE'1'                                       S01486
055720200529     C           *IN27     ANDNE'1'                                       S01486
055730200529     C*                                                                   CPB001
055740200529     C           *IN22     ORNE '1'                                       CPB001
055750200529     C           *IN23     ANDNE'1'                                       CPB001
055760200529     C           *IN24     ANDNE'1'                                       CPB001
055770200529     C           *IN25     ANDNE'1'                                       CPB001
055780200529     C           *IN26     ANDNE'1'                                       CPB001
055790200529     C           BGN4ST    ANDNE'Y'                                       CPB001
055800200529     C*                                                                   CPB001
055810200529     C           BGN4ST    OREQ 'Y'                                       CPB001
055820200529     C           *IN22     ANDNE'1'                                       CPB001
055830200529     C           *IN23     ANDNE'1'                                       CPB001
055840200529     C           *IN24     ANDNE'1'                                       CPB001
055850200529     C           *IN25     ANDNE'1'                                       CPB001
055860200529     C           *IN26     ANDNE'1'                                       CPB001
055870200529     C           *IN27     ANDNE'1'                                       CPB001
055880200529     C*                                                                   S01117
055890200529     C           ACTN      IFEQ 'I'                                       S01117
055900200529     C*                                                                   S01117
055910200529     C**  Validate SPF-Action of user                                     S01117
055920200529     C** For subfiles, make sure that any error must appear only once     084981
055930200529     C*                                                                   S01117
055940200529     C**  If Single Branch Environment                                    S01117
055950200529     C*                                                                   S01117
055960200529     C           MBIN      IFNE 'Y'                                       S01117
055970200529     C                     CALL 'ZVACTU'                                  S01117
055980200529     C                     PARM ACTN      @ZACTN  1                       S01117
055990200529     C                     PARM           @ERR    10                      S01117
056000200529     C*                                                                   S01117
056010200529     C           @ERR      IFNE *ZERO                                     S01117
056020200529     C           ' 302'    LOKUPERR                      64               084981
056030200529     C           *IN64     IFEQ '0'                                       084981
056040200529     C                     ADD  1         EC                              S01117
056050200529     C                     MOVEA' 302'    ERR,EC                          S01117
056060200529     C                     ENDIF                                          084981
056070200529     C                     MOVE '1'       *IN21                           S01117
056080200529     C                     END                                            S01117
056090200529     C*                                                                   S01117
056100200529     C                     ELSE                                           S01117
056110200529     C*                                                                   S01117
056120200529     C**  If Multibranching Environment                                   S01117
056130200529     C*                                                                   S01117
056140200529     C                     CALL 'ZVACTBU'                                 S01117
056150200529     C                     PARM ACTN      @ZACTN  1                       S01117
056160200529     C                     PARM SPBCA     @ZBR    3                       S01117
056170200529     C                     PARM           @ERR    10                      S01117
056180200529     C*                                                                   S01117
056190200529     C           @ERR      IFEQ 1                                         S01117
056200200529     C           ' 303'    LOKUPERR                      64               084981
056210200529     C           *IN64     IFEQ '0'                                       084981
056220200529     C                     ADD  1         EC                              S01117
056230200529     C                     MOVEA' 303'    ERR,EC                          S01117
056240200529     C                     ENDIF                                          084981
056250200529     C                     MOVE '1'       *IN21                           S01117
056260200529     C                     MOVE '1'       *IN22                           S01117
056270200529     C                     END                                            S01117
056280200529     C*                                                                   S01117
056290200529     C           @ERR      IFEQ 2                                         S01117
056300200529     C           ' 304'    LOKUPERR                      64               084981
056310200529     C           *IN64     IFEQ '0'                                       084981
056320200529     C                     ADD  1         EC                              S01117
056330200529     C                     MOVEA' 304'    ERR,EC                          S01117
056340200529     C                     ENDIF                                          084981
056350200529     C                     MOVE '1'       *IN21                           S01117
056360200529     C                     MOVE '1'       *IN22                           S01117
056370200529     C                     END                                            S01117
056380200529     C                     END                                            S01117
056390200529     C*                                                                   S01117
056400200529     C                     END                                            S01117
056410200529     C*                                                                   S01117
056420200529     C**  SPF-Action validated for user                                   S01117
056430200529     C*                                                                   S01117
056440200529     C           @ERR      IFEQ *ZERO                                     S01117
056450200529     C*
056460200529     C** RECORD MUST NOT BE AN ACTIVE RECORD ON POSET
056470200529     C*
056480200529     C           ACTN      IFEQ 'I'
056490200529     C                     Z-ADD0         TNL1                                                212767
056500200529     C*                                                                   S01486
056510200529     C** IF PORTFOLIO MANAGEMENT INSTALLED USE DIFFERENT TO WHEN NOT      S01486
056520200529     C*                                                                   S01486
056530200529     C           CSE023    IFEQ 'Y'                                       186055
056540200529     C           PTXBSK    CHAINPOSETX               99                   186055
056550200529     C                     Z-ADDSEQ       RECSEQ                          186055
056560200529     C           RECSEQ    DOWGT1                                         186055
056570200529     C           *IN99     ANDEQ'0'                                       186055
056580200529     C           PTXBSK    READEPOSETX                   99               186055
056590200529     C           RECI      IFNE '*'                                       186055
056600200529     C                     SUB  1         RECSEQ                          186055
056610200529     C                     ENDIF                                          186055
056620200529     C                     ENDDO                                          186055
056630200529     C                     ELSE                                           186055
056640200529     C           BGPFMG    IFEQ 'Y'                                       S01486
056650200529     C           BGN4ST    OREQ 'Y'                                       CPB001
056660200529     C           PTFRK     CHAINPOSETX               99                   S01486
056670200529     C******************** Z-ADDSEQ       RECSEQ                   S01486 080743
056680200529     C********** RECSEQ    DOWGT1                                  S01486 080743
056690200529     C********** *IN99     ANDEQ'0'                                S01486 080743
056700200529     C********** PTFRK     READEPOSETX                   99        S01486 080743
056710200529     C******************** SUB  1         RECSEQ                   S01486 080743
056720200529     C******************** END                                     S01486 080743
056730200529     C                     ELSE                                           S01486
056740200529     C           POSETK    CHAINPOSETX               99
056750200529     C                     Z-ADDSEQ       RECSEQ                          E37157
056760200529     C           RECSEQ    DOWGT1                                         E37157
056770200529     C           *IN99     ANDEQ'0'                                       E37157
056780200529     C           POSETK    READEPOSETX                   99               E37157
056790200529     C                     SUB  1         RECSEQ                          E37157
056800200529     C                     END                                            S01486
056810200529     C                     END                                            E37157
056820200529     C                     ENDIF                                          186055
056830200529     C**********                                                   185397 186055
056840200529     C***If*CSE023*is*present,*then*need*to*check*tax*basket,*Exemp185397 186055
056850200529     C***code*and*beneficial*owner*number*as*well.                 185397 186055
056860200529     C**********                                                   185397 186055
056870200529     C********** CSE023    IFEQ 'Y'                                185397 186055
056880200529     C********** *IN99     ANDEQ'0'                                185397 186055
056890200529     C********** SBNFO     IFNE *BLANK                             185397 186055
056900200529     C**********           MOVE PCPY      @BNFO  26                185397 186055
056910200529     C**********           MOVE SBNFO     @BNFO                    185397 186055
056920200529     C**********           ELSE                                    185397 186055
056930200529     C**********           MOVE *BLANK    @BNFO                    185397 186055
056940200529     C**********           END                                     185397 186055
056950200529     C********** STXBS     IFNE TXBS                               185397 186055
056960200529     C********** SEXCD     ORNE EXCD                               185397 186055
056970200529     C********** @BNFO     ORNE BNFO                               185397 186055
056980200529     C********** RECI      OREQ '*'                                185397 186055
056990200529     C**********           MOVE '1'       *IN99                    185397 186055
057000200529     C**********           END                                     185397 186055
057010200529     C**********           END                                     185397 186055
057020200529     C           *IN99     IFEQ '0'
057030200529     C           RECI      IFEQ '*'                        *OVERWRITE
057040200529     C                     SETON                     99
057050200529     C                     END
057060200529     C                     END
057070200529     C           *IN99     IFEQ '0'
057080200529     C***********SPBCH     OREQ *BLANK                                    S01117
057090200529     C           SPBCA     OREQ *BLANK                                    S01117
057100200529     C           *IN81     ANDEQ'1'                                       S01117
057110200529     C                     MOVE '1'       *IN21
057120200529     C*                                                                   084981
057130200529     C** Make sure that for subfiles, this error will appear only once    084981
057140200529     C           ' 102'    LOKUPERR                      64               084981
057150200529     C           *IN64     IFEQ '0'                                       084981
057160200529     C                     ADD  1         EC
057170200529     C                     MOVEL' 102'    ERR,EC
057180200529     C                     ENDIF                                          084981
057190200529     C                     END
057200200529     C                     END
057210200529     C                     END                                            S01117
057220200529     C                     END
057230200529     C*                                                                   E14881
057240200529     C                     ELSE                                           E14881
057250200529     C***********                                                   E14881S01117
057260200529     C**CUSTOMER*NUMBER/SHORTNAME*ACCESS********************        E14881S01117
057270200529     C***********                                                   E14881S01117
057280200529     C***********ACTN      IFEQ 'A'                                 E14881S01117
057290200529     C***********ACTN      OREQ 'Y'                                 E21493S01117
057300200529     C***********          MOVELSPCPY     WRK6A                     E14881S01117
057310200529     C***********                                                   E14881S01117
057320200529     C**IF*NUMERIC*ENTRY*READ*CLINTSE*FILE*ELSE*READ*SNAME*FILE***  E14881S01117
057330200529     C***********                                                   E14881S01117
057340200529     C***********          TESTN          WRK6A      99             E14881S01117
057350200529     C************IN99     IFEQ '1'                                 E14881S01117
057360200529     C***********          MOVELWRK6A     WRK6N                     E14881S01117
057370200529     C***********WRK6N     CHAINCLINTSEF             99             E14881S01117
057380200529     C***********          ELSE                                     E14881S01117
057390200529     C***********SPCPY     CHAINSNAMEF               99             E14881S01117
057400200529     C***********CNUM      CHAINCLINTSEF             99             E14881S01117
057410200529     C***********          END                                      E14881S01117
057420200529     C***********          END                                      E14881S01117
057430200529     C*
057440200529     C**********           ELSE                                           E14881
057450200529     C           ACTN      IFEQ 'A'
057460200529     C           ACTN      OREQ 'D'
057470200529     C           ACTN      OREQ 'E'
057480200529     C           ACTN      OREQ 'Y'
057490200529     C*
057500200529     C           ACTN      OREQ 'R'                                       S01496
057510200529     C           S01496    ANDEQ'Y'                                       S01496
057520200529     C           ACTN      OREQ 'R'                                       CSE007
057530200529     C           CSE007    ANDEQ'Y'                                       CSE007
057540200529     C           ACTN      OREQ 'R'                                       CEU017
057550200529     C           CEU017    ANDEQ'Y'                                       CEU017
057560200529      *                                                                                     AR324886
057570200529     C           ACTN      OREQ 'U'                                                         AR324886
057580200529     C*
057590200529     C***A*C*T*I*O*N****C*O*D*E****A*,*D*,E*OR*Y*********                 S01496
057600200529     C** A C T I O N    C O D E    A , D ,E OR Y OR R                     S01496
057610200529     C*
057620200529     C***********          MOVELSPBCH     PBCH                            S01117
057630200529     C                     MOVELSPBCA     PBCA                            S01117
057640200529     C                     MOVELSPSSH     PSSH
057650200529     C                     MOVELSPCPY     PCPY
057660200529     C                     MOVELSPEVT     PEVT
057670200529     C                     Z-ADDSPTNLU    TNL1                            099267
057680200529     C                     MOVELSTXBS     TXBS                            186055
057690200529     C           SBNFO     IFNE *BLANKS                                   186055
057700200529     C                     MOVELSPCPY     BNFO                            186055
057710200529     C                     MOVE SBNFO     BNFO                            186055
057720200529     C                     ELSE                                           186055
057730200529     C                     MOVE *BLANKS   BNFO                            186055
057740200529     C                     ENDIF                                          186055
057750200529     C                     MOVELSEXCD     EXCD                            186055
057760200529     C*                                                                   S01486
057770200529     C** IF PORTFOLIO MANAGEMENT INSTALLED                                S01486
057780200529     C*                                                                   S01486
057790200529     C           BGPFMG    IFEQ 'Y'                                       S01486
057800200529     C           BGN4ST    OREQ 'Y'                                       CPB001
057810200529     C                     MOVELSPPTFR    PTFR                            S01486
057820200529     C                     END                                            S01486
057830200529     C*                                                                   S01117
057840200529     C**  Validate SPF-Action of user                                     S01117
057850200529     C** Make sure that for subfile, any  error will appear only once     084981
057860200529     C*                                                                   S01117
057870200529     C**  If Single Branch Environment                                    S01117
057880200529     C*                                                                   S01117
057890200529     C           MBIN      IFNE 'Y'                                       S01117
057900200529     C                     CALL 'ZVACTU'                                  S01117
057910200529     C                     PARM ACTN      @ZACTN  1                       S01117
057920200529     C                     PARM           @ERR    10                      S01117
057930200529     C*                                                                   S01117
057940200529     C           @ERR      IFNE *ZERO                                     S01117
057950200529     C           ' 302'    LOKUPERR                      64               084981
057960200529     C           *IN64     IFEQ '0'                                       084981
057970200529     C                     ADD  1         EC                              S01117
057980200529     C                     MOVEA' 302'    ERR,EC                          S01117
057990200529     C                     ENDIF                                          084981
058000200529     C                     MOVE '1'       *IN21                           S01117
058010200529     C                     END                                            S01117
058020200529     C*                                                                   S01117
058030200529     C                     ELSE                                           S01117
058040200529     C*                                                                   S01117
058050200529     C**  If Multibranching Environment                                   S01117
058060200529     C*                                                                   S01117
058070200529     C                     CALL 'ZVACTBU'                                 S01117
058080200529     C                     PARM ACTN      @ZACTN  1                       S01117
058090200529     C                     PARM SPBCA     @ZBR    3                       S01117
058100200529     C                     PARM           @ERR    10                      S01117
058110200529     C*                                                                   S01117
058120200529     C           @ERR      IFEQ 1                                         S01117
058130200529     C           ' 303'    LOKUPERR                      64               084981
058140200529     C           *IN64     IFEQ '0'                                       084981
058150200529     C                     ADD  1         EC                              S01117
058160200529     C                     MOVEA' 303'    ERR,EC                          S01117
058170200529     C                     ENDIF                                          084981
058180200529     C                     MOVE '1'       *IN21                           S01117
058190200529     C                     MOVE '1'       *IN22                           S01117
058200200529     C                     END                                            S01117
058210200529     C*                                                                   S01117
058220200529     C           @ERR      IFEQ 2                                         S01117
058230200529     C           ' 304'    LOKUPERR                      64               084981
058240200529     C           *IN64     IFEQ '0'                                       084981
058250200529     C                     ADD  1         EC                              S01117
058260200529     C                     MOVEA' 304'    ERR,EC                          S01117
058270200529     C                     ENDIF                                          084981
058280200529     C                     MOVE '1'       *IN21                           S01117
058290200529     C                     MOVE '1'       *IN22                           S01117
058300200529     C                     END                                            S01117
058310200529     C                     END                                            S01117
058320200529     C*                                                                   S01117
058330200529     C**  SPF-Action validated for user                                   S01117
058340200529     C*                                                                   S01117
058350200529     C           @ERR      IFEQ *ZERO                                     S01117
058360200529     C*
058370200529     C**  D U E  D A T E
058380200529     C*
058390200529     C           SPDUD     IFNE *BLANKS
058400200529     C                     MOVE SPDUD     SPDUDN  60
058410200529     C                     MOVE SPDUDN    SPDUDA  6
058420200529     C           SPDUD     COMP SPDUDA               9999
058430200529     C           *IN99     IFNE '1'
058440200529     C                     Z-ADDSPDUDN    ZDATE
058450200529     C                     EXSR ZDATE1
058460200529     C                     END
058470200529     C                     END
058480200529     C           *IN99     IFEQ '1'
058490200529     C           SPDUD     OREQ *BLANKS
058500200529     C                     MOVE '1'       *IN25
058510200529     C*                                                                   084981
058520200529     C** Make sure that for subfile, this error will appear only once     084981
058530200529     C           ' 112'    LOKUPERR                      64               084981
058540200529     C           *IN64     IFEQ '0'                                       084981
058550200529     C                     ADD  1         EC
058560200529     C                     MOVEL' 112'    ERR,EC
058570200529     C                     ENDIF                                          084981
058580200529     C                     ELSE
058590200529     C                     Z-ADDZDAYNO    PDUD
058600200529     C                     END                             *IN99=1
058610200529     C*
058620200529     C** CHECK RECORD EXISTS ON POSET
058630200529     C*
058640200529     C           *IN25     IFNE '1'
058650200529     C***********                                                   E13952S01117
058660200529     C****If*alphameric read SNAME file for client number.          E13952S01117
058670200529     C***********                                                   E13952S01117
058680200529     C***********          MOVELSPCPY     WRK6A   6                 E13952S01117
058690200529     C***********          MOVE SPCPY     WRK4A   4                 E13952S01117
058700200529     C***********          TESTN          WRK6A      99             E13952S01117
058710200529     C**N99******SPCPY     CHAINSNAME                99             E13952S01117
058720200529     C**N99******RECI      COMP '*'                      99         E13952S01117
058730200529     C**N99******          Z-ADDCNUM      PCPY                      E13952S01117
058740200529     C***********                                                   E13952S01117
058750200529     C****Error*if client number has too many digits/letters on end.E13952S01117
058760200529     C***********                                                   E13952S01117
058770200529     C************IN99     IFEQ '1'                                 E13952S01117
058780200529     C***********WRK4A     COMP *BLANKS              9999           E13952S01117
058790200529     C***********          END                                      E13952S01117
058800200529     C*                                                                   E13952
058810200529     C*                                                                   S01117
058820200529     C**  If Customer Shortname entered, access Customer file for         S01117
058830200529     C**  Customer number                                                 S01117
058840200529     C*                                                                   S01117
058850200529     C                     MOVE '0'       *IN99                           S01117
058860200529     C**********           TESTN          SPCPY      85                   S01117              CSD027
058870200529     C********** *IN85     IFEQ '0'                                       S01117              CSD027
058880200529     C**********           CALL 'AOCUSTR0'                                             S01117 217551
058890200529     C                     CALL 'AOCUSTR1'                                                    217551
058900200529     C                     PARM *BLANKS   @RTCD                           S01117
058910200529     C                     PARM '*KEY   ' @OPTN                           S01117
058920200529     C                     PARM SPCPY     @KEY1                           S01117
058930200529     C                     PARM *BLANKS   @KYST                           S01117
058940200529     C********** SDCUST    PARM SDCUST    DSSDY                                        S01117 217551
058950200529     C           SDCUST    PARM SDCUST    DSLDY                                               217551
058960200529     C*                                                                   S01117
058970200529     C**  Invalid Customer                                                S01117
058980200529     C*                                                                   S01117
058990200529     C           @RTCD     IFNE *BLANKS                                   S01117
059000200529     C           BBCLST    ANDNE'Y'                                                           217551
059010200529     C                     MOVE '1'       *IN99                           S01117
059020200529     C                     MOVELSPCPY     CUSTNO                                              CSD027
059030200529     C                     ELSE                                           S01117
059040200529     C                     MOVELBBCUST    PCPY                            S01117
059050200529     C                     MOVELBBCUST    CUSTNO                          S01117
059060200529     C                     END                                            S01117
059070200529     C*                                                                   S01117
059080200529     C**********           ELSE                                           S01117              CSD027
059090200529     C**********           MOVELSPCPY     CUSTNO                          S01117              CSD027
059100200529     C***********          END                                            S01117              CSD027
059110200529     C*                                                                   S01117
059120200529     C**  Access Securities Customer file to pick up classification       S01117
059130200529     C*                                                                   S01117
059140200529     C           *IN99     IFEQ '0'                                       S01117
059150200529     C*                                                                   S01117
059160200529     C                     CALL 'AOSECSR0'                                S01117
059170200529     C                     PARM *BLANKS   @RTCD                           S01117
059180200529     C                     PARM '*KEY   ' @OPTN                           S01117
059190200529     C                     PARM CUSTNO    CUST                            S01117
059200200529     C           SDSECS    PARM SDSECS    DSSDY                           S01117
059210200529     C*                                                                   S01117
059220200529     C           @RTCD     IFNE *BLANKS                                   S01117
059230200529     C                     MOVE '1'       *IN99                           S01117
059240200529     C                     ELSE                                           E37158
059250200529     C                     MOVELBFACCD    PC1AC                           E37158
059260200529     C                     MOVELBFACSN    PC1SQ                           E37158
059270200529     C                     END                                            S01117
059280200529     C*                                                                   S01117
059290200529     C                     END                                            S01117
059300200529     C*                                                                   S01117
059310200529     C           *IN99     IFEQ '0'                                       E13952
059320200529     C           MBIN      IFEQ 'N'                                       173501
059330200529     C           PBCA      ANDEQ*BLANKS                                   173501
059340200529     C                     MOVE USRBCH    PBCA                            173501
059350200529     C                     END                                            173501
059360200529     C           CSE023    IFEQ 'Y'                                       186055
059370200529     C********** PTXBSK    CHAINPOSETX               99                              186055 BUG12729
059380200529     C           PTXBS7    CHAINPOSETDF6            N99                                     BUG12729
059390200529      *                                                                                     AR875922
059400200529      ** Skip record if deleted                                                             AR875922
059410200529      *                                                                                     AR875922
059420200529     C           *IN99     DOWEQ'0'                                                         AR875922
059430200529     C           RECI      IFNE '*'                                                         AR875922
059440200529     C                     LEAVE                                                            AR875922
059450200529     C                     ENDIF                                                            AR875922
059460200529     C           PTXBS7    READEPOSETDF6                 99                                 AR875922
059470200529     C                     ENDDO                                                            AR875922
059480200529      **                                                                                    AR875922
059490200529     C                     ELSE                                           186055
059500200529     C           POSETK    CHAINPOSETX               99
059510200529     C                     ENDIF                                          186055
059520200529     C                     Z-ADDSEQ       RECSEQ                          E37157
059530200529     C           RECSEQ    DOWGT1                                         E37157
059540200529     C           *IN99     ANDEQ'0'                                       E37157
059550200529     C           CSE023    ANDNE'Y'                                                           212522
059560200529     C           POSETK    READEPOSETX                   99               E37157
059570200529     C                     SUB  1         RECSEQ                          E37157
059580200529     C                     END                                            E37157
059590200529     C           *IN99     IFEQ '0'
059600200529     C           RECI      IFEQ '*'
059610200529     C           ACTN      ANDNE'E'                                       084981
059620200529     C                     SETON                     99
059630200529     C                     ELSE                                           E14884
059640200529     C*                                                                   E21590
059650200529     C           RECI      IFEQ 'M'                                       E14884
059660200529     C           ACTN      ANDNE'E'                                       E14884
059670200529     C           S01496    ANDNE'Y'                                       S01496
059680200529     C           CSE007    ANDNE'Y'                                       CSE007
059690200529     C           CEU017    ANDNE'Y'                                       CEU017
059700200529     C           ACTN      ANDNE'Y'                                                         AR324886
059710200529     C*
059720200529     C           RECI      OREQ 'M'                                       S01496
059730200529     C           ACTN      ANDNE'E'                                       S01496
059740200529     C           ACTN      ANDNE'R'                                       S01496
059750200529     C           S01496    ANDEQ'Y'                                       S01496
059760200529     C           ACTN      ANDNE'Y'                                                         AR324886
059770200529     C*                                                                   CSE007
059780200529     C           RECI      OREQ 'M'                                       CSE007
059790200529     C           ACTN      ANDNE'E'                                       CSE007
059800200529     C           ACTN      ANDNE'R'                                       CSE007
059810200529     C           CSE007    ANDEQ'Y'                                       CSE007
059820200529     C           ACTN      ANDNE'Y'                                                         AR324886
059830200529     C*                                                                   CEU017
059840200529     C           RECI      OREQ 'M'                                       CEU017
059850200529     C           ACTN      ANDNE'E'                                       CEU017
059860200529     C           ACTN      ANDNE'R'                                       CEU017
059870200529     C           CEU017    ANDEQ'Y'                                       CEU017
059880200529     C           ACTN      ANDNE'Y'                                                         AR324886
059890200529      *                                                                                     AR324886
059900200529     C********** PSAUTH    CHAINPSAUT                80                            AR324886 AR586601
059910200529     C           PSAUTH    CHAINPSAUT               N80                                     AR586601
059920200529     C           *IN80     IFEQ *OFF                                                        AR324886
059930200529     C           PALCTP    ANDNE'R'                                                         AR324886
059940200529     C           ACTN      ANDEQ'Y'                                                         AR324886
059950200529     C           ACTN      ORNE 'E'                                                         AR324886
059960200529     C           ACTN      ANDNE'R'                                                         AR324886
059970200529     C******               SETON                     99            E14884 S01496
059980200529     C*                                                                   E21590
059990200529     C**  Produce Error 115 for non-Enquiry Action on Actioned record.    E21590
060000200529     C*                                                                   E21590
060010200529     C                     SETON                     88                   E21590
060020200529     C                     MOVE '1'       *IN21                           E21590
060030200529     C*                                                                   084981
060040200529     C** Make sure that for subfile, this error will appear only once     084981
060050200529     C           ' 115'    LOKUPERR                      64               084981
060060200529     C           *IN64     IFEQ '0'                                       084981
060070200529     C                     ADD  1         EC                              E21590
060080200529     C                     MOVEL' 115'    ERR,EC                          E21590
060090200529     C                     ENDIF                                          084981
060100200529     C                     ENDIF                                                            AR324886
060110200529     C                     ELSE                                           S01496
060120200529     C           RECI      IFEQ 'R'                                       S01496
060130200529     C           ACTN      ANDNE'E'                                       S01496
060140200529     C           S01496    ANDEQ'Y'                                       S01496
060150200529     C           RECI      OREQ 'R'                                       CSE007
060160200529     C           ACTN      ANDNE'E'                                       CSE007
060170200529     C           CSE007    ANDEQ'Y'                                       CSE007
060180200529     C           RECI      OREQ 'R'                                       CEU017
060190200529     C           ACTN      ANDNE'E'                                       CEU017
060200200529     C           CEU017    ANDEQ'Y'                                       CEU017
060210200529      *                                                                   S01496
060220200529      ***  Produce Error 992 for non-Enquiry Action on Reversed record    S01496
060230200529     C** Make sure that for subfile, this error will appear only once     084981
060240200529     C                     SETON                     88                   S01496
060250200529     C                     MOVE '1'       *IN21                           S01496
060260200529     C           ' 992'    LOKUPERR                      64               084981
060270200529     C           *IN64     IFEQ '0'                                       084981
060280200529     C                     ADD  1         EC                              S01496
060290200529     C                     MOVEL' 992'    ERR,EC                          S01496
060300200529     C                     ENDIF                                          084981
060310200529     C                     ELSE                                           S01496
060320200529     C           ACTN      IFEQ 'R'                                       S01496
060330200529     C           RECI      ANDNE'M'                                       S01496
060340200529      *                                                                   S01496
060350200529      ***  Produce Error 991 for Reverse Action on non-Actioned record    S01496
060360200529     C** Make sure that for subfile, this error will appear only once     084981
060370200529     C                     SETON                     88                   S01496
060380200529     C                     MOVE '1'       *IN21                           S01496
060390200529     C           ' 992'    LOKUPERR                      64               084981
060400200529     C           *IN64     IFEQ '0'                                       084981
060410200529     C                     ADD  1         EC                              S01496
060420200529     C                     MOVEL' 991'    ERR,EC                          S01496
060430200529     C                     ENDIF                                          084981
060440200529     C                     ELSE                                                             AR324886
060450200529     C           ACTN      IFEQ 'U'                                                         AR324886
060460200529     C           PAUI      ANDNE'Y'                                                         AR324886
060470200529     C                     MOVE *ON       *IN88                                             AR324886
060480200529     C                     MOVE *ON       *IN21                                             AR324886
060490200529     C           ' 993'    LOKUPERR                      64                                 AR324886
060500200529     C           *IN64     IFEQ '0'                                                         AR324886
060510200529     C                     ADD  1         EC                                                AR324886
060520200529     C                     MOVEL' 993'    ERR,EC                                            AR324886
060530200529     C                     ENDIF                                                            AR324886
060540200529     C                     ELSE                                                             AR324886
060550200529     C           ACTN      IFEQ 'Y'                                                         AR324886
060560200529     C           PAUI      ANDNE'Y'                                                         AR324886
060570200529     C           ACTN      OREQ 'Y'                                                         AR568653
060580200529     C           STAT      ANDEQ'R'                                                         AR568653
060590200529     C********** PSAUTH    CHAINPSAUT                80                            AR324886 AR586601
060600200529     C           PSAUTH    CHAINPSAUT               N80                                     AR586601
060610200529     C           *IN80     IFEQ *OFF                                                        AR324886
060620200529     C           USID      ANDEQPALUSR                                                      AR324886
060630200529     C                     MOVE *ON       *IN88                                             AR324886
060640200529     C                     MOVE *ON       *IN21                                             AR324886
060650200529     C           ' 994'    LOKUPERR                      64                                 AR324886
060660200529     C           *IN64     IFEQ '0'                                                         AR324886
060670200529     C                     ADD  1         EC                                                AR324886
060680200529     C                     MOVEL' 994'    ERR,EC                                            AR324886
060690200529     C                     ENDIF                                                            AR324886
060700200529     C                     ENDIF                                                            AR324886
060710200529     C                     ELSE                                                             AR324886
060720200529     C           ACTN      IFEQ 'R'                                                         AR324886
060730200529     C********** PSAUTH    CHAINPSAUT                80                            AR324886 AR586601
060740200529     C           PSAUTH    CHAINPSAUT               N80                                     AR586601
060750200529     C           *IN80     IFEQ *OFF                                                        AR324886
060760200529     C           PALCTP    ANDEQ'R'                                                         AR324886
060770200529     C                     MOVE *ON       *IN88                                             AR324886
060780200529     C                     MOVE *ON       *IN21                                             AR324886
060790200529     C           ' 995'    LOKUPERR                      64                                 AR324886
060800200529     C           *IN64     IFEQ '0'                                                         AR324886
060810200529     C                     ADD  1         EC                                                AR324886
060820200529     C                     MOVEL' 995'    ERR,EC                                            AR324886
060830200529     C                     ENDIF                                                            AR324886
060840200529     C                     ENDIF                                                            AR324886
060850200529     C                     ENDIF                                                            AR324886
060860200529     C                     ENDIF                                                            AR324886
060870200529     C                     ENDIF                                                            AR324886
060880200529     C                     ENDIF                                          S01496
060890200529     C                     ENDIF                                          S01496
060900200529     C*                                                                   S01496
060910200529     C*                                                                   E21590
060920200529     C                     END                                            E14884
060930200529     C                     END
060940200529     C                     END
060950200529     C                     END                                            E13952
060960200529     C*                                                                   E21590
060970200529     C           *IN99     IFEQ '1'
060980200529     C*                                                                   E21590
060990200529     C           *IN88     IFEQ '0'                                       E21590
061000200529     C                     MOVE '1'       *IN21
061010200529     C*                                                                   084981
061020200529     C** Make sure that for subfile, this error will appear only once     084981
061030200529     C           ' 101'    LOKUPERR                      64               084981
061040200529     C           *IN64     IFEQ '0'                                       084981
061050200529     C                     ADD  1         EC
061060200529     C                     MOVEL' 101'    ERR,EC
061070200529     C                     ENDIF                                          084981
061080200529     C                     ELSE                                           E21590
061090200529     C                     SETOF                     88                   E21590
061100200529     C                     END                                            E21590
061110200529     C*                                                                   E21590
061120200529     C                     ELSE
061130200529     C*                                                                   E21590
061140200529     C**  READ SECTY TO PICK UP NOMINAL DEC PLACES
061150200529     C*                                                                   E21590
061160200529     C           SPSSH     CHAINSECTY                99
061170200529      *                                                                   CSE023
061180200529     C           CSE023    IFEQ 'Y'                                       CSE023
061190200529     C           CRTT      ANDNE*BLANKS                                   CSE023
061200200529     C                     MOVEL'Y'       WFREEM                          CSE023
061210200529     C                     ELSE                                           188588
061220200529     C                     MOVEL' '       WFREEM                          188588
061230200529     C                     ENDIF                                          CSE023
061240200529      *                                                                   CSE023
061250200529     C                     END
061260200529     C*
061270200529     C** A C T I O N    C O D E    A , D  OR  Y
061280200529     C*
061290200529     C           ACTN      IFEQ 'A'
061300200529     C           ACTN      OREQ 'D'
061310200529     C           ACTN      OREQ 'Y'
061320200529     C           PAUI      IFEQ 'Y'
061330200529     C           STAT      ANDNE'R'                                                         AR324886
061340200529     C********** SFRNO     ANDNEXSFRNO                                                      AR324886
061350200529     C********** SWARN     ANDEQ'0'                                                  084981 AR324886
061360200529     C                     MOVE '1'       *IN21
061370200529     C*                                                                   084981
061380200529     C** Make sure that for subfile, this error will appear only once     084981
061390200529     C********** ' W01'    LOKUPERR                      64                          084981 AR324886
061400200529     C           ' 996'    LOKUPERR                      64                                 AR324886
061410200529     C           *IN64     IFEQ '0'                                       084981
061420200529     C**********           ADD  1         WEC                                        E14214 AR324886
061430200529     C                     ADD  1         EC
061440200529     C**********           MOVEL' W01'    ERR,EC                                            AR324886
061450200529     C                     MOVEL' 996'    ERR,EC                                            AR324886
061460200529     C                     ENDIF                                          084981
061470200529     C                     MOVE SFRNO     XSFRNO
061480200529     C**********           MOVEL'E'       ACTN                                         E20237 247333
061490200529     C                     END                             AUTHFL=Y
061500200529     C                     END
061510200529     C*                                                                   S01117
061520200529     C**  Display Profit Centre field if Customer Position Settlement     S01117
061530200529     C*                                                                   S01117
061540200529     C                     MOVE '0'       *IN84                           S01117
061550200529     C           BFCLAS    IFNE 'S'                                       S01117
061560200529     C           BFCLAS    ANDNE'D'                                       S01117
061570200529     C                     MOVE '1'       *IN84                           S01117
061580200529     C                     END                                            S01117
061590200529     C*                                                                   S01117
061600200529     C                     END
061610200529     C                     END                                            S01117
061620200529     C                     END
061630200529     C*
061640200529     C                     END
061650200529     C/COPY WNCPYSRC,SE0170C109
061660200529     C***********                                                         084981
061670200529     C***ERROR*ON*SCREEN*SO*HIGHLIGHT*ERROR*CODES**********************   084981
061680200529     C***********                                                         084981
061690200529     C***********EC        IFNE *ZERO                                     084981
061700200529     C***********          MOVELHI        ERRMSG                          084981
061710200529     C***********          MOVEL*BLANK    AID                             084981
061720200529     C***********          END                                            084981
061730200529      *                                                                                       CSD015
061740200529      ** If compliance watch enhancement is on, check if customers involved are in            CSD015
061750200529      ** the watch list.  If so then avoid the authorisation of the transaction.              CSD015
061760200529      *                                                                                       CSD015
061770200529     C           W1EWLC    IFEQ 'Y'                                                           CSD015
061780200529     C           ACTN      ANDEQ'Y'                                                           CSD015
061790200529      *                                                                                       CSD015
061800200529     C           CSC011    IFEQ 'N'                                                           CSD015
061810200529     C           CSC011    OREQ 'Y'                                                           CSD015
061820200529     C           S1MAIN    ANDEQLIBR                                                          CSD015
061830200529      *                                                                                       CSD015
061840200529     C                     MOVE *BLANKS   RSLT   30                                           CSD015
061850200529     C                     MOVELPDUD      PDUDA   5                                           CSD015
061860200529     C                     MOVELPCPY      PCPYA   6                                           CSD015
061870200529      *                                                                                       CSD015
061880200529     C           PBCA      CAT  PSSH:0    RSLTMP 13                                           CSD015
061890200529     C           RSLTMP    CAT  PCPYA     RSLT                                                CSD015
061900200529     C           RSLT      CAT  PDUDA:0   RSLT                                                CSD015
061910200529     C           RSLT      CAT  PEVT:0    RSLT   30                                           CSD015
061920200529     C                     MOVELRSLT      W4IDEN                                              CSD015
061930200529     C                     MOVEL'POSETD'  W4FUNT                                              CSD015
061940200529     C                     MOVELPBCA      W4BRCH                                              CSD015
061950200529      *                                                                                       CSD015
061960200529     C           CMPKEY    CHAINSDCWHTL1             75                                       CSD015
061970200529     C           *IN75     IFEQ '0'                                                           CSD015
061980200529     C           W3TREL    ANDNE'Y'                                                           CSD015
061990200529     C                     MOVE '1'       *IN21                                               CSD015
062000200529     C           ' 117'    LOKUPERR                      64                                   CSD015
062010200529     C           *IN64     IFEQ '0'                                                           CSD015
062020200529     C                     ADD  1         EC                                                  CSD015
062030200529     C                     MOVEL' 117'    ERR,EC                                              CSD015
062040200529     C                     ENDIF                                                              CSD015
062050200529     C                     ENDIF                                                              CSD015
062060200529     C                     ENDIF                                                              CSD015
062070200529     C                     ENDIF                                                              CSD015
062080200529     C*
062090200529     C                     ENDSR
062100200529     C*
062110200529     C*****************************************************************
062120200529      /EJECT
062130200529     C*****************************************************************
062140200529     C*                                                               *
062150200529     C*  VALIDD S/R  - TO VALIDATE DETAIL SCREEN                      *
062160200529     C*  CALLED FROM: UPDATE S/R                                      *
062170200529     C*  CALLS: DEFLTS; ZSEDIT; ZALIGN; ZASIGN; ZXRATE;               *
062180200529     C*                                                               *
062190200529     C*****************************************************************
062200200529     C*
062210200529     C           VALIDD    BEGSR
062220200529     C*
062230200529     C** RESET SCREEN ERROR INDICATORS
062240200529     C*
062250200529     C**********           MOVE *BLANKS   XPSEA  12                                    CSD015 CGL029
062260200529     C                     MOVE *BLANKS   XPSEA  18                                           CGL029
062270200529     C                     MOVE *BLANKS   XPCPN   8                                           CSD015
062280200529     C                     MOVE *BLANKS   XPFAC   8                                           CSD015
062290200529     C                     MOVE *BLANKS   WSTAX   1                                           CER049
062300200529     C                     MOVE *BLANKS   WCTAX   1                                           CER049
062310200602     C/COPY WNCPYSRC,HUT111_001                                                               HUT111
062320200529      *                                                                                       CSD015
062330200529     C                     MOVE '0'       *IN29                           S01512
062340200529     C                     MOVEA'00000000'*IN,30
062350200529     C                     MOVEA'00000000'*IN,38
062360200529     C***********          MOVEA'0000000' *IN,46                          E17175
062370200529     C                     MOVEA'00000000'*IN,46                          E17175
062380200529     C                     MOVEA'0'       *IN,54                          S01117
062390200529     C                     MOVEA'000'     *IN,70                          S01447
062400200529     C                     MOVE '0'       *IN56                           CAC002
062410200529     C                     MOVE *OFF      *IN76                                               233711
062420200529     C                     MOVE *OFF      *IN67                                               CER049
062430200529     C*
062440200529     C** SET ERROR COUNT TO ZERO
062450200529     C*
062460200529     C                     Z-ADD0         WEC     10                      E14214
062470200529     C                     Z-ADD0         EC
062480200529     C*
062490200529     C** ENTER KEY PRESSSED
062500200529     C*
062510200529     C           AID       IFEQ 'RA'
062520200529     C*
062530200529     C** ACTION = I OR A OR Y
062540200529     C*
062550200529     C           ACTN      IFEQ 'I'
062560200529     C           ACTN      OREQ 'A'
062570200529     C           ACTN      OREQ 'Y'
062580200529     C*
062590200529     C** DO DEFAULTS (first time only)
062600200529     C*
062610200529     C           *IN89     IFEQ '0'
062620200529     C                     EXSR DEFLTS
062630200529     C                     END
062640200529     C***********          MOVELSPNCY     KCCY2                           S01117
062650200529     C*
062660200529     C**  THE FOLLOWING USE OF ZALIGN, TO CONVERT THE SCREEN NOMINAL      E18102
062670200529     C**  FIELD INTO AN AMOUNT DUE, IS NO LONGER NECESSARY.               E18102
062680200529     C*                                                                   E18102
062690200529     C***********          Z-ADD4         ZADEC                           E18102
062700200529     C***********          Z-ADD11        ZADIG                           E18102
062710200529     C***********          MOVE *BLANKS   ZFIELD                          E18102
062720200529     C***********          MOVELSPNMP     ZFIELD                          E18102
062730200529     C***********          EXSR ZALIGN                                    E18102
062740200529     C***********          MOVE ZFIELD    PAMD                            E18102
062750200529     C***********ZFSIGN    IFEQ '-'                                       E14881
062760200529     C***********          Z-SUBPAMD      PAMD                            E14881
062770200529     C***********          END                                            E14881
062780200529     C                     MOVELSPNCY     PNCY
062790200529     C*
062800200529     C**  VALIDATION OF FIELDS FOR INSERT/AMEND/Y
062810200529     C*
062820200529     C***SETUP*NOMINAL*DEC*PLACES*MULT*FACTOR**************************   E18102
062830200529     C***********NMDP      ADD  5         NMLT    10                      E18102
062840200529     C*
062850200529     C**  Fetch Nominal Currency decimal places
062860200529     C*
062870200529     C***********          MOVE *BLANKS   KEY                             S01117
062880200529     C***********          MOVEL'20'      TYPE                            S01117
062890200529     C***********          MOVE '1'       KEY                             S01117
062900200529     C***********          MOVELSPNCY     KCCY2                           S01117
062910200529     C***********TABKEY    CHAINTABTG10F             99                   S01117
062920200529     C***********          Z-ADDCDP       NOMCDP  10                      S01117
062930200529     C*                                                                   S01117
062940200529     C** Bypass the set-up of nominal ccy dec places if S01509 is active  S01509
062950200529     C*                                                                   S01509
062960200529     C           S01509    IFEQ 'N'                                       S01509
062970200529     C                     CALL 'AOCURRR0'                                S01117
062980200529     C                     PARM '*DBERR'  @RTCD                           S01117
062990200529     C                     PARM '*KEY   ' @OPTN                           S01117
063000200529     C***********          PARM SPNCY     @AJCD   3                S01117 S01509
063010200529     C                     PARM NMCY      @AJCD   3                       S01509
063020200529     C           SDCURR    PARM SDCURR    DSSDY                           S01117
063030200529     C                     Z-ADDA6NBDP    NOMCDP  10                      S01117
063040200529     C                     MOVE A6NQDP    ZNQDP1                          CAC002
063050200529     C                     MOVE A6CYCD    NOMCCY  3                                           233711
063060200529     C                     END                                            S01509
063070200529     C*                                                                   S01117
063080200529     C*
063090200529     C**  TRANSLATE AND VALIDATE SPNMP (#NOM) AMOUNT DUE                  E14214
063100200529     C**  NEGATIVE NOMINAL IS POSSIBLE - USE ZASIGN INSTEAD OF ZALIGN     E18102
063110200529     C**  AND USE NOMINAL DECIMAL PLACES FROM THE SECURITY RECORD.        E18102
063120200529     C*                                                            E14214 E18102
063130200529     C***********          Z-ADD0         ZADEC                    E14214 E18102
063140200529     C***********          Z-ADD15        ZADIG                    E14214 E18102
063150200529     C***********          MOVE *BLANKS   ZFIELD                   E14214 E18102
063160200529     C***********          MOVELSPNMP     ZFIELD                   E14214 E18102
063170200529     C***********          EXSR ZALIGN                             E14214 E18102
063180200529     C*
063190200529     C                     Z-ADDNMDP      ZSDEC                           E18102
063200200529     C           15        SUB  NMDP      ZSDIG                           E18102
063210200529     C                     MOVE *BLANKS   ZFLD17                          E18102
063220200529     C                     MOVE SPNMP     ZFLD17                          E18102
063230200529     C                     EXSR ZASIGN                                    E18102
063240200529     C*
063250200529     C           *IN99     IFEQ '1'                                       E14214
063260200529     C                     ADD  1         EC         53                   E14214
063270200529     C                     MOVEL' 204'    ERR,EC                          E14214
063280200529     C                     ELSE                                           E14214
063290200529     C***********          MOVE ZFIELD    PNMP                     E14214 E18102
063300200529     C                     MOVE ZOUT15    PNMP                            E18102
063310200529     C*
063320200529     C**  SIGN CHECK FOR ZASIGN                                           E18102
063330200529     C*
063340200529     C           ZFSIGN    IFEQ '-'                                       E14214
063350200529     C                     Z-SUBPNMP      PNMP                            E14214
063360200529     C                     END                                            E14214
063370200529     C                     END                             *IN99=1        E14214
063380200529     C*
063390200529     C**  TRANSLATE AND VALIDATE SPAMD (#AMNT) AMOUNT DUE
063400200529     C** If S01509 is active, process using due currency, else            S01509
063410200529     C** use the existing which is the nominal currency                   S01509
063420200529     C*
063430200529     C           S01509    IFEQ 'N'                                       S01509
063440200529     C                     Z-ADDNOMCDP    ZADEC
063450200529     C           13        SUB  NOMCDP    ZADIG
063460200529     C                     ELSE                                           S01509
063470200529     C                     CALL 'AOCURRR0'                                S01509
063480200529     C                     PARM '*DBERR'  @RTCD                           S01509
063490200529     C                     PARM '*KEY   ' @OPTN                           S01509
063500200529     C                     PARM SPNCY     @AJCD   3                       S01509
063510200529     C           SDCURR    PARM SDCURR    DSSDY                           S01509
063520200529     C                     Z-ADDA6NBDP    POSCDP  10                      S01509
063530200529     C                     MOVE A6NQDP    ZNQDP1                          CAC002
063540200529     C                     MOVE A6CYCD    POSCCY  3                                           233711
063550200529     C*                                                                   S01509
063560200529     C                     Z-ADDPOSCDP    ZADEC                           S01509
063570200529     C           13        SUB  POSCDP    ZADIG                           S01509
063580200529     C                     END                                            S01509
063590200529     C*                                                                   S01509
063600200529     C                     MOVE *BLANKS   ZFIELD
063610200529     C                     MOVELSPAMD     ZFIELD
063620200529     C                     EXSR ZALIGN
063630200529     C           *IN99     IFEQ '1'
063640200529     C                     ADD  1         EC         50
063650200529     C                     MOVEL' 200'    ERR,EC
063660200529     C                     ELSE
063670200529     C                     MOVE ZFIELD    PAMD
063680200529     C***********ZFSIGN    IFEQ '-'                                       E14881
063690200529     C***********          Z-SUBPAMD      PAMD                            E14881
063700200529     C***********          END                                            E14881
063710200529     C                     END                             *IN99=1
063720200529     C*                                                                   S01512
063730200529     C** If S01512 is active, translate and validate SPSVL : value date   S01512
063740200529     C** Check this is a valid date                                       S01512
063750200529     C*                                                                   S01512
063760200529     C           S01512    IFEQ 'Y'                                       S01512
063770200529     C           SPSVL     IFNE *BLANKS                    B2             S01512
063780200529     C                     MOVE SPSVL     SPSVLN  60                      S01512
063790200529     C                     MOVE SPSVL     SPSVLA  6                       S01512
063800200529     C           SPSVL     COMP SPSVLA               9999                 S01512
063810200529     C           *IN99     IFNE '1'                        B3             S01512
063820200529     C                     Z-ADDSPSVLN    ZDATE                           S01512
063830200529     C                     EXSR ZDATE1                                    S01512
063840200529     C                     END                             E3             S01512
063850200529     C           *IN99     IFNE '1'                        B3             S01512
063860200529     C                     EXSR ZDATE2                                    S01512
063870200529     C                     MOVE ZDATE     SPSVL                           S01512
063880200529     C                     END                             E3             S01512
063890200529     C*                                                                   S01512
063900200529     C           *IN99     IFEQ '1'                        B3             S01512
063910200529     C                     MOVE '1'       *IN29                           S01512
063920200529     C                     ADD  1         EC                              S01512
063930200529     C                     MOVEL' 502'    ERR,EC                          S01512
063940200529     C                     ELSE                            X3             S01512
063950200529     C           ZDAYNO    IFLT PDUD                       B4             S01512
063960200529     C                     MOVE '1'       *IN29                           S01512
063970200529     C                     ADD  1         EC                              S01512
063980200529     C                     MOVEL' 502'    ERR,EC                          S01512
063990200529     C                     ELSE                            X4             S01512
064000200529     C*                                                                   S01512
064010200529     C** Warning only errors - check first time through                   S01512
064020200529     C** Warn if a holiday in due currency.                               S01512
064030200529     C*                                                                   S01512
064040200529     C           SPSVL     IFNE XSPSVL                     B5             S01512
064050200529     C*                                                                   S01512
064060200529     C                     MOVELSPNCY     ZCCY                            S01512
064070200529     C                     MOVELBJSLCD    ZLOC                            S01512
064080200529     C                     EXSR ZCHKH                                     S01512
064090200529     C*                                                                   S01512
064100200529     C           ZIND      IFEQ 'H'                                       S01512
064110200529     C                     ADD  1         WEC                             S01512
064120200529     C                     ADD  1         EC                              S01512
064130200529     C                     MOVEL' W08'    ERR,EC                          S01512
064140200529     C                     MOVE '1'       *IN29                           S01512
064150200529     C                     Z-ADDZDAYNO    PSVL                            S01512
064160200529     C                     END                             E6             S01512
064170200529     C*                                                                   S01512
064180200529     C** Warn if a holiday in settlement currency.                        S01512
064190200529     C*                                                                   S01512
064200200529     C                     MOVELSPSCU     ZCCY                            S01512
064210200529     C                     MOVELBJSLCD    ZLOC                            S01512
064220200529     C           ZIND      IFEQ 'H'                                       S01512
064230200529     C                     ADD  1         WEC                             S01512
064240200529     C                     ADD  1         EC                              S01512
064250200529     C                     MOVEL' W09'    ERR,EC                          S01512
064260200529     C                     MOVE '1'       *IN29                           S01512
064270200529     C                     Z-ADDZDAYNO    PSVL                            S01512
064280200529     C                     END                             E6             S01512
064290200529     C                     MOVE SPSVL     XSPSVL                          S01512
064300200529     C*                                                                   S01512
064310200529     C                     END                             E5             S01512
064320200529     C*                                                                   S01512
064330200529     C                     END                             E4             S01512
064340200529     C                     END                             E3             S01512
064350200529     C*                                                                   S01512
064360200529     C           *IN29     IFEQ '0'                        B3             S01512
064370200529     C                     Z-ADDZDAYNO    PSVL                            S01512
064380200529     C                     END                             E3             S01512
064390200529     C*                                                                   S01512
064400200529     C** Otherwise (value date blank) report error                        S01512
064410200529     C*                                                                   S01512
064420200529     C                     ELSE                            X2             S01512
064430200529     C                     MOVE '1'       *IN29                           S01512
064440200529     C                     ADD  1         EC                              S01512
064450200529     C                     MOVEL' 502'    ERR,EC                          S01512
064460200529     C*                                                                   S01512
064470200529     C                     END                             E2             S01512
064480200529     C                     END                             E2             S01512
064490200529     C*
064500200529     C**  TRANSLATE AND VALIDATE SPBCD (#ALPV) BOOK CODE
064510200529     C*
064520200529     C                     MOVELSPBCD     PBCD
064530200529     C*
064540200529     C           SPBCD     IFNE *BLANK
064550200529     C***********SPBCD     CHAINBOOKD                99                   S01117
064560200529     C**N99******RECI      COMP '*'                      99*              S01117
064570200529     C************IN99     IFEQ '1'                                       S01117
064580200529     C************         ADD  1         EC         35                   S01117
064590200529     C************         MOVEL' 201'    ERR,EC                          S01117
064600200529     C************         END                             *IN99=1        S01117
064610200529     C*                                                                   S01117
064620200529     C                     CALL 'AOBOOKR0'                                S01117
064630200529     C                     PARM *BLANKS   @RTCD                           S01117
064640200529     C                     PARM '*KEY   ' @OPTN                           S01117
064650200529     C                     PARM SPBCD     @BKCD   2                       S01117
064660200529     C           SDBOOK    PARM SDBOOK    DSFDY                           S01117
064670200529     C*                                                                   S01117
064680200529     C** Invalid Book                                                     S01117
064690200529     C*                                                                   S01117
064700200529     C           @RTCD     IFNE *BLANKS                                   S01117
064710200529     C                     ADD  1         EC         35                   S01117
064720200529     C                     MOVEL' 201'    ERR,EC                          S01117
064730200529     C                     END                                            S01117
064740200529     C*                                                                   S01117
064750200529     C                     ELSE                                           E14717
064760200529     C*                                                                   S01117
064770200529     C***********SPCPY     CHAINSNAMEF               99             E14717S01117
064780200529     C************IN99     IFEQ '0'                                 E14717S01117
064790200529     C***********          Z-ADDCNUM      WRK6N                     E14717S01117
064800200529     C***********          ELSE                                     E14717S01117
064810200529     C***********          MOVELSPCPY     WRK6N                     E14717S01117
064820200529     C***********          END                                      E14717S01117
064830200529     C***********WRK6N     CHAINCLINTSEF             99             E14717S01117
064840200529     C**N99******RECI      COMP '*'                      99         E14717S01117
064850200529     C************IN99     IFEQ '0'                                 E14717S01117
064860200529     C***********C1DI      IFEQ 'S'                                 E14717S01117
064870200529     C***********C1DI      OREQ 'D'                                 E14717S01117
064880200529     C***********          MOVE DPFB      PBCD                      E14717S01117
064890200529     C***********          ELSE                                     E14717S01117
064900200529     C***********          MOVE DMKB      PBCD                      E14717S01117
064910200529     C***********          END                                      E14717S01117
064920200529     C***********          END                                      E14717S01117
064930200529     C*                                                                   S01117
064940200529     C                     CALL 'AOCUSTR0'                                S01117
064950200529     C                     PARM '*DBERR'  @RTCD                           S01117
064960200529     C                     PARM '*KEY   ' @OPTN                           S01117
064970200529     C                     PARM SPCPY     @KEY1                           S01117
064980200529     C                     PARM *BLANKS   @KYST                           S01117
064990200529     C           SDCUST    PARM SDCUST    DSSDY                           S01117
065000200529     C*                                                                   S01117
065010200529     C                     MOVELBBCUST    CUSTNO                          S01117
065020200529     C*                                                                   S01117
065030200529     C**  Check Customer Exists on Securities Customer File               S01117
065040200529     C*                                                                   S01117
065050200529     C                     CALL 'AOSECSR0'                                S01117
065060200529     C                     PARM '*DBERR'  @RTCD                           S01117
065070200529     C                     PARM '*KEY   ' @OPTN                           S01117
065080200529     C                     PARM CUSTNO    CUST                            S01117
065090200529     C           SDSECS    PARM SDSECS    DSSDY                           S01117
065100200529     C*                                                                   S01117
065110200529     C           BFCLAS    IFEQ 'S'                                       S01117
065120200529     C           BFCLAS    OREQ 'D'                                       S01117
065130200529     C                     MOVE BVDPBC    PBCD                            S01117
065140200529     C                     ELSE                                           S01117
065150200529     C                     MOVE BVDMBC    PBCD                            S01117
065160200529     C                     END                                            S01117
065170200529     C                     END                             *SPBCD         S01117
065180200529     C*                                                                   S01117
065190200529     C**  TRANSLATE AND VALIDATE SPPFC (#ALPV) PROFIT CENTRE              S01117
065200200529     C*                                                                   S01117
065210200529     C           *IN82     IFEQ '1'                                       S01117
065220200529     C           *IN84     ANDNE'1'                                       S01117
065230200529     C*                                                                   CAC002
065240200529     C**   If Analytical Accounting is installed, profit centre           CAC002
065250200529     C**   is mandatory for Portfolio Customer.                           CAC002
065260200529     C*                                                                   CAC002
065270200529     C           BGN0ST    IFEQ 'Y'                                       CAC002
065280200529     C           SPPFC     ANDEQ*BLANKS                                   CAC002
065290200529     C                     ADD  1         EC         54                   CAC002
065300200529     C                     MOVEL' 333'    ERR,EC                          CAC002
065310200529     C                     ENDIF                                          CAC002
065320200529     C*                                                                   CAC002
065330200529     C                     MOVELSPPFC     PPFC                            S01117
065340200529     C           *IN83     IFEQ '1'                                       S01117
065350200529     C*                                                                   S01117
065360200529     C           SPPFC     IFNE *BLANK                                    S01117
065370200529     C                     CALL 'AOPRFCR0'                                S01117
065380200529     C                     PARM *BLANKS   @RTCD                           S01117
065390200529     C                     PARM '*KEY   ' @OPTN                           S01117
065400200529     C                     PARM SPPFC     @PCCD   4                       S01117
065410200529     C           SDPRFC    PARM SDPRFC    DSFDY                           S01117
065420200529     C*                                                                   S01117
065430200529     C           @RTCD     IFNE *BLANKS                                   S01117
065440200529     C                     ADD  1         EC         54                   S01117
065450200529     C                     MOVEL' 240'    ERR,EC                          S01117
065460200529     C                     END                                            S01117
065470200529     C                     END                                            S01117
065480200529     C*                                                                   S01117
065490200529     C                     END                                            S01117
065500200529     C                     END                                            S01117
065510200529     C*                                                                   CAC002
065520200529     C**  If Analytical Accounting is installed, default SE               CAC002
065530200529     C**  ICD profit centre for non-portfolio customer.                   CAC002
065540200529     C*                                                                   CAC002
065550200529     C           BGN0ST    IFEQ 'Y'                                       CAC002
065560200529     C           *IN84     ANDEQ'1'                                       CAC002
065570200529     C                     MOVELBVSEPC    PPFC                            CAC002
065580200529     C                     ENDIF                                          CAC002
065590200529     C*
065600200529     C**  TRANSLATE AND VALIDATE SPPRE (#ALPV) PAY/RECEIVE CODE
065610200529     C*
065620200529     C                     MOVELSPPRE     PPRE
065630200529     C                     MOVELSPPRE     PPPRE                           CSW003
065640200529     C*
065650200529     C           SPPRE     IFNE 'P'
065660200529     C           SPPRE     ANDNE'R'
065670200529     C                     ADD  1         EC         36
065680200529     C                     MOVEL' 225'    ERR,EC
065690200529     C                     END                             *SPPRE
065700200529     C*
065710200529     C**  TRANSLATE AND VALIDATE SPSCU (#ALPV) SETTLEMENT CCY
065720200529     C*
065730200529     C           SPSCU     IFEQ *BLANKS                                                       214835
065740200529     C                     MOVE XSPSCU    SPSCU                                               214835
065750200529     C                     END                                                                214835
065760200529     C                     MOVELSPSCU     PSCU
065770200529     C*
065780200529     C           SPSCU     IFNE *BLANK
065790200529     C***********          MOVE *BLANKS   KEY                             S01117
065800200529     C***********          MOVEL'20'      TYPE                            S01117
065810200529     C***********          MOVE '1'       KEY                             S01117
065820200529     C***********          MOVELSPSCU     KCCY2                           S01117
065830200529     C***********TABKEY    CHAINTABTG10F             99                   S01117
065840200529     C**N99******RECI      COMP '*'                      99               S01117
065850200529     C************IN99     IFEQ '0'                                       S01117
065860200529     C***********DCCY      ANDNE'Y'                                       S01117
065870200529     C***********          SETON                     99                   S01117
065880200529     C***********          END                                            S01117
065890200529     C************IN99     IFEQ '1'                                       S01117
065900200529     C*                                                                   S01117
065910200529     C                     CALL 'AOCURRR0'                                S01117
065920200529     C                     PARM *BLANKS   @RTCD                           S01117
065930200529     C                     PARM '*KEY   ' @OPTN                           S01117
065940200529     C                     PARM SPSCU     @AJCD   3                       S01117
065950200529     C           SDCURR    PARM SDCURR    DSSDY                           S01117
065960200529     C*                                                                   S01117
065970200529     C           @RTCD     IFNE *BLANKS                                   S01117
065980200529     C           A6DLCI    ORNE 'Y'                                       S01117
065990200529     C                     ADD  1         EC         37
066000200529     C                     MOVEL' 202'    ERR,EC
066010200529     C                     ELSE                                           151506
066020200529     C                     Z-ADDA6NBDP    SETCDP  10                      151506
066030200529     C                     MOVE A6NQDP    ZNQDP2                          151506
066040200529     C                     MOVELA6INCY    WSINCY  1                       151506
066050200529     C                     Z-ADDA6TPSD    WSTPSD  50                      151506
066060200529     C                     Z-ADDA6EUER    WSEUER 138                      151506
066070200529     C                     MOVELA6EUMD    WSEUMD  1                       151506
066080200529     C                     MOVE ' '       W2SCR                           151506
066090200529     C           SPSCU     IFNE XSPSCU                                    151506
066100200529     C           SPSXR     ORNE WXRATP                                                        197896
066110200529     C                     MOVE 'Y'       W2SCR                           151506
066120200529     C                     MOVE A6SPRT    ZFLD15                          151506
066130200529     C                     Z-ADD8         ZDECS                           151506
066140200529     C                     MOVE ' '       ZECODE                          151506
066150200529     C                     EXSR ZSEDIT                                    151506
066160200529     C                     MOVEL*BLANKS   SPBRX                           151506
066170200529     C                     MOVE ZOUT21    SPBRX                           151506
066180200529     C           PNCY      IFEQ SPSCU                                     151506
066190200529     C                     Z-ADD100000000 ZFLD15                          151506
066200200529     C                     MOVE 'M'       SPMDI                           151506
066210200529     C                     ELSE                                           151506
066220200529     C                     Z-ADDA6SPRT    ZRATE2 138                      151506
066230200529     C                     MOVE A6MDIN    ZMDI2   1                       151506
066240200529     C*                                                                   151506
066250200529     C* Get position currency spot rate                                   151506
066260200529     C*                                                                   151506
066270200529     C                     CALL 'AOCURRR0'                                151506
066280200529     C                     PARM '*DBERR'  @RTCD   7                       151506
066290200529     C                     PARM '*KEY   ' @OPTN   7                       151506
066300200529     C                     PARM PNCY      @AJCD   3                       151506
066310200529     C           SDCURR    PARM SDCURR    DSSDY                           151506
066320200529     C*                                                                   151506
066330200529     C                     Z-ADDA6SPRT    ZRATE1 138                      151506
066340200529     C                     MOVE A6MDIN    ZMDI1   1                       151506
066350200529     C                     EXSR ZXRATE                                    151506
066360200529     C*                                                                   151506
066370200529      ** Use default rate if the Exchange Rate has not been overwritten                       197896
066380200529      *                                                                                       197896
066390200529     C           SPSXR     IFNE *BLANKS                                                       197896
066400200529     C           SPSXR     ANDNEWXRATP                                                        197896
066410200529     C                     Z-ADD8         ZADEC                                               197896
066420200529     C                     Z-ADD5         ZADIG                                               197896
066430200529     C                     MOVE *BLANKS   ZFIELD                                              197896
066440200529     C                     MOVELSPSXR     ZFIELD                                              197896
066450200529     C                     EXSR ZALIGN                                                        197896
066460200529     C                     MOVE ZFIELD    ZFLD15                                              197896
066470200529     C                     ELSE                                                               197896
066480200529     C           SPSCU     IFEQ BKEURO                                    151506
066490200529     C           A6INCY    ANDEQ'Y'                                       151506
066500200529     C           RUND      ANDGEA6TPSD                                    151506
066510200529     C                     MOVE A6EUER    ZFLD15                          151506
066520200529     C                     MOVELA6EUMD    ZMDIX                           151506
066530200529     C                     ELSE                                           151506
066540200529     C           PNCY      IFEQ BKEURO                                    151506
066550200529     C           WSINCY    ANDEQ'Y'                                       151506
066560200529     C           RUND      ANDGEWSTPSD                                    151506
066570200529     C                     MOVE WSEUER    ZFLD15                          151506
066580200529     C           WSEUMD    IFEQ 'D'                                       151506
066590200529     C                     MOVEL'M'       ZMDIX                           151506
066600200529     C                     ELSE                                           151506
066610200529     C                     MOVEL'D'       ZMDIX                           151506
066620200529     C                     ENDIF                                          151506
066630200529     C                     ELSE                                           151506
066640200529     C                     MOVE ZRATEX    ZFLD15                          151506
066650200529     C                     ENDIF                                          151506
066660200529     C                     ENDIF                                          151506
066670200529     C                     ENDIF                                                              197896
066680200529      *                                                                                       197896
066690200529     C                     MOVE ZMDIX     SPMDI                           151506
066700200529     C                     MOVE SPMDI     PMDI                            151506
066710200529     C                     ENDIF                                          151506
066720200529     C*                                                                   151506
066730200529     C                     Z-ADD8         ZDECS                           151506
066740200529     C                     MOVE ' '       ZECODE                          151506
066750200529     C                     EXSR ZSEDIT                                    151506
066760200529     C                     MOVEL*BLANKS   SPSXR                           151506
066770200529     C                     MOVE ZOUT21    SPSXR                           151506
066780200529     C                     Z-ADD8         ZADEC                           151506
066790200529     C                     Z-ADD5         ZADIG                           151506
066800200529     C                     MOVE *BLANKS   ZFIELD                          151506
066810200529     C                     MOVELSPSXR     ZFIELD                          151506
066820200529     C                     EXSR ZALIGN                                    151506
066830200529     C                     MOVE ZFIELD    PSXR                            151506
066840200529     C*                                                                   151506
066850200529     C** Set up parameter for call to SEZ010                              151506
066860200529     C*                                                                   151506
066870200529     C                     MOVELBFCLAS    P@CLAS                          151506
066880200529     C                     MOVELSPPRE     P@PPRE                          151506
066890200529     C                     Z-ADDPAMD      P@PAMD                          151506
066900200529     C                     Z-ADDPCHA      P@PCHA                          151506
066910200529     C                     Z-ADDPCAM      P@PCAM                          151506
066920200529     C                     Z-ADDTASO      P@TASO                          151506
066930200529     C                     Z-ADDTAUS      P@TAUS                          151506
066940200529     C                     Z-ADDPSXR      P@PSXR                          151506
066950200529     C                     MOVELPMDI      P@PMDI                          151506
066960200529     C                     MOVELSPNCY     P@PNCY                          151506
066970200529     C                     MOVELSPSCU     P@PSCU                          151506
066980200529     C                     MOVELWTAXA     P@STAM                                            AR851833
066990200529      *                                                                                       233711
067000200529     C********** *IN75     IFEQ *ON                                                    233711 234471
067010200529     C           *IN78     IFEQ *ON                                                           234471
067020200529     C                     ADD  TXNM      P@TASO                                              233711
067030200529     C                     ENDIF                                                              233711
067040200529     C** Call SEZ010 to calculate the settlement amount                   151506
067050200529     C*                                                                   151506
067060200529     C                     CALL 'SEZ010'                                  151506
067070200529     C                     PARM *BLANKS   P@RCDE  7                       151506
067080200529     C                     PARM           P@DATA                          151506
067090200529     C           P@RCDE    IFEQ *BLANKS                                   151506
067100200529     C                     Z-ADDP@PSAT    PSAT                            151506
067110200529     C                     ELSE                                           151506
067120200529     C                     EXSR *PSSR                                     151506
067130200529     C                     ENDIF                                          151506
067140200529     C*                                                                   151506
067150200529     C                     Z-ADDSETCDP    ZDECS                           151506
067160200529     C                     MOVE P@PSAT    ZFLD15                          151506
067170200529     C                     MOVE ' '       ZECODE                          151506
067180200529     C                     EXSR ZSEDIT                                    151506
067190200529     C                     MOVEL*BLANKS   SPSAT                           151506
067200200529     C                     MOVE ZOUT21    SPSAT                           151506
067210200529     C                     MOVELSPSCU     XSPSCU  3                       151506
067220200529     C                     ENDIF                                          151506
067230200529     C                     END
067240200529     C                     END
067250200529     C*                                                                   055839
067260200529     C** Store settle CCY D.P for later validation.                       055839
067270200529     C*                                                                   055839
067280200529     C***********          Z-ADDA6NBDP    SETCDP  10                055839151506
067290200529     C***********          MOVE A6NQDP    ZNQDP2                    CAC002151506
067300200529     C*
067310200529     C**  TRANSLATE AND VALIDATE SPMDI (#AMNT) M/D INDICATOR
067320200529     C*
067330200529     C           SPMDI     IFNE 'M'
067340200529     C           SPMDI     ANDNE'D'
067350200529     C                     ADD  1         EC         51
067360200529     C**********           MOVEL' W05'    ERR,EC                          S01158
067370200529     C                     MOVEL' 203'    ERR,EC                          S01158
067380200529     C                     ELSE
067390200529     C                     MOVELSPMDI     PMDI
067400200529     C                     END
067410200529     C*
067420200529     C**  TRANSLATE AND VALIDATE SPSXR (#AMNT) EXCHANGE RATE
067430200529     C*
067440200529     C           SPSXR     IFEQ *BLANKS                                   E18884
067450200529     C                     ADD  1         EC                              E18884
067460200529     C                     SETON                     34                   E18884
067470200529     C                     MOVEL' 227'    ERR,EC                          E18884
067480200529     C*                                                                   E18884
067490200529     C                     ELSE                                           E18884
067500200529     C*                                                                   E18884
067510200529     C**********           Z-ADD8         ZSDEC      REPLACED BY ZALIGN   E18884
067520200529     C**********           Z-ADD5         ZSDIG                           E18884
067530200529     C**********           MOVE *BLANKS   ZFLD17                          E18884
067540200529     C**********           MOVELSPSXR     ZFLD17                          E18884
067550200529     C**********           EXSR ZASIGN                                    E18884
067560200529     C*                                                                   E18884
067570200529     C                     Z-ADD8         ZADEC                           E18884
067580200529     C                     Z-ADD5         ZADIG                           E18884
067590200529     C                     MOVE *BLANKS   ZFIELD                          E18884
067600200529     C                     MOVELSPSXR     ZFIELD                          E18884
067610200529     C                     EXSR ZALIGN                                    E18884
067620200529     C           *IN99     IFEQ '1'
067630200529     C**********           ADD  1         EC         52                   E18884
067640200529     C                     ADD  1         EC                              E18884
067650200529     C**********           ADD  1         WEC                      E14214 E18884
067660200529     C                     SETON                     34                   E18884
067670200529     C**********           MOVEL' W05'    ERR,EC    *INAPPROPIATE MSG     E18884
067680200529     C                     MOVEL' 227'    ERR,EC                          E18884
067690200529     C                     ELSE
067700200529     C**********           MOVE ZOUT15    PSXR                            E18884
067710200529     C                     MOVE ZFIELD    PSXR                            E18884
067720200529     C********** ZFSIGN    IFEQ '-'                                       E18884
067730200529     C**********           Z-SUBPSXR      PSXR                            E18884
067740200529     C**********           END                                            E18884
067750200529     C*
067760200529     C**  .. must be within 10% of Nominal settlement cross rate
067770200529     C**  WARNING ERROR ONLY - CHECK FIRST TIME THROUGH *******
067780200529     C*
067790200529     C***********SPSXR     IFNE XSPSXR                                    E37165
067800200529     C***********          MOVE *BLANKS   KEY                             S01117
067810200529     C***********          MOVEL'20'      TYPE                            S01117
067820200529     C***********          MOVE '1'       KEY                             S01117
067830200529     C***********          MOVELSPSCU     KCCY2                           S01117
067840200529     C***********TABKEY    CHAINTABTG10F             99                   S01117
067850200529     C***********          Z-ADDSPOT      ZRATE1 138                      S01117
067860200529     C***********MDIN      IFEQ 0                                         S01117
067870200529     C*                                                                   S01117
067880200529     C           SPSCU     IFEQ *BLANKS                                                       214835
067890200529     C                     MOVE XSPSCU    SPSCU                                               214835
067900200529     C                     END                                                                214835
067910200529     C                     CALL 'AOCURRR0'                                S01117
067920200529     C                     PARM *BLANKS   @RTCD   7                       S01117
067930200529     C                     PARM '*KEY   ' @OPTN   7                       S01117
067940200529     C                     PARM SPSCU     @AJCD   3                       S01117
067950200529     C           SDCURR    PARM SDCURR    DSSDY                           S01117
067960200529     C                     MOVELA6EUMD    WSEUMD                          151506
067970200529     C                     MOVELA6INCY    WSINCY                          151506
067980200529     C                     Z-ADDA6TPSD    WSTPSD                          151506
067990200529     C                     Z-ADDA6EUER    WSEUER                          151506
068000200529     C*                                                                   S01117
068010200529     C***********          Z-ADDA6SPRT    ZRATE1 138               S01117 063994
068020200529     C                     Z-ADDA6SPRT    ZRATE2 138                      063994
068030200529     C***********A6MDIN    IFEQ *BLANKS                             S01117E37205
068040200529     C***********          MOVEL'D'       ZMDI1   1                       E37205
068050200529     C***********          ELSE                                           E37205
068060200529     C***********          MOVEL'M'       ZMDI1   1                       E37205
068070200529     C***********          END                                            E37205
068080200529     C***********          MOVELA6MDIN    ZMDI1   1                E37205 063994
068090200529     C                     MOVELA6MDIN    ZMDI2   1                       063994
068100200529     C***********          MOVELSPNCY     KCCY2                           S01117
068110200529     C***********TABKEY    CHAINTABTG10F             99                   S01117
068120200529     C***********          Z-ADDSPOT      ZRATE2 138                      S01117
068130200529     C***********MDIN      IFEQ 0                                         S01117
068140200529     C                     CALL 'AOCURRR0'                                S01117
068150200529     C                     PARM '*DBERR'  @RTCD   7                       S01117
068160200529     C                     PARM '*KEY   ' @OPTN   7                       S01117
068170200529     C                     PARM SPNCY     @AJCD   3                       S01117
068180200529     C           SDCURR    PARM SDCURR    DSSDY                           S01117
068190200529     C*                                                                   S01117
068200200529     C***********          Z-ADDA6SPRT    ZRATE2 138               S01117 063994
068210200529     C                     Z-ADDA6SPRT    ZRATE1 138                      063994
068220200529     C***********A6MDIN    IFEQ *BLANKS                             S01117E37205
068230200529     C***********          MOVEL'D'       ZMDI2   1                       E37205
068240200529     C***********          ELSE                                           E37205
068250200529     C***********          MOVEL'M'       ZMDI2   1                       E37205
068260200529     C***********          END                                            E37205
068270200529     C***********          MOVELA6MDIN    ZMDI2   1                E37205 063994
068280200529     C                     MOVELA6MDIN    ZMDI1   1                       063994
068290200529     C                     EXSR ZXRATE
068300200529     C           SPSCU     IFEQ BKEURO                                    151506
068310200529     C           A6INCY    ANDEQ'Y'                                       151506
068320200529     C           RUND      ANDGEA6TPSD                                    151506
068330200529     C                     MOVE A6EUER    ZRATEX                          151506
068340200529     C                     MOVELA6EUMD    ZMDIX                           151506
068350200529     C                     ELSE                                           151506
068360200529     C           PNCY      IFEQ BKEURO                                    151506
068370200529     C           WSINCY    ANDEQ'Y'                                       151506
068380200529     C           RUND      ANDGEWSTPSD                                    151506
068390200529     C                     MOVE WSEUER    ZRATEX                          151506
068400200529     C           WSEUMD    IFEQ 'D'                                       151506
068410200529     C                     MOVEL'M'       ZMDIX                           151506
068420200529     C                     ELSE                                           151506
068430200529     C                     MOVEL'D'       ZMDIX                           151506
068440200529     C                     ENDIF                                          151506
068450200529     C                     ENDIF                                          151506
068460200529     C                     ENDIF                                          151506
068470200529     C           ZRATEX    DIV  10        ZZWRK1 138H
068480200529     C           ZRATEX    ADD  ZZWRK1    ZZWRK2 138
068490200529     C           PSXR      IFGT ZZWRK2
068500200529     C           ZMDIX     ORNE SPMDI
068510200529     C           PSXR      ANDNE1                                         E37165
068520200529     C                     ADD  1         EC
068530200529     C                     ADD  1         WEC                             E14214
068540200529     C                     MOVEL' W05'    ERR,EC
068550200529     C                     SETON                     5251
068560200529     C                     ELSE
068570200529     C*
068580200529     C           ZRATEX    SUB  ZZWRK1    ZZWRK2
068590200529     C           PSXR      IFLT ZZWRK2
068600200529     C           ZMDIX     ORNE SPMDI
068610200529     C           PSXR      ANDNE1                                         E37165
068620200529     C                     ADD  1         EC
068630200529     C                     ADD  1         WEC                             E14214
068640200529     C                     MOVEL' W05'    ERR,EC
068650200529     C                     SETON                     5251
068660200529     C                     END
068670200529     C                     END
068680200529     C***********          MOVE SPSXR     XSPSXR                          E37165
068690200529     C***********          END                                            E37165
068700200529     C                     END                             *IN99=1
068710200529     C                     END                             *PSXR BLANK    E18884
068720200529      *                                                                   CAC002
068730200529     C           ACTN      IFEQ 'I'                                       CAC002
068740200529     C                     Z-ADD0         FXMP                            CAC002
068750200529     C                     Z-ADD0         FXMR                            CAC002
068760200529     C                     Z-ADD0         MAMT                            CAC002
068770200529     C                     ENDIF                                          CAC002
068780200529      *                                                                   CAC002
068790200529      **  Validate Margin Points if entered and if analytical acctg.      CAC002
068800200529      **  is installed                                                    CAC002
068810200529      *                                                                   CAC002
068820200529     C           BGN0ST    IFEQ 'Y'                                       CAC002
068830200529     C           SFXMP     ANDNE*BLANKS                                   CAC002
068840200529      *                                                                   CAC002
068850200529      **  Allow entry of Margin Points if nominal and settlement          CAC002
068860200529      **  currencies are not the same                                     CAC002
068870200529      *                                                                   CAC002
068880200529     C           NMCY      IFNE SPSCU                                     CAC002
068890200529      *                                                                   CAC002
068900200529      **  Validate Margin Points entered                                  CAC002
068910200529      *                                                                   CAC002
068920200529     C                     MOVE *BLANKS   ZFIELD                          CAC002
068930200529     C                     MOVELSFXMP     ZFIELD                          CAC002
068940200529     C                     Z-ADD5         ZADIG                           CAC002
068950200529     C                     Z-ADD2         ZADEC                           CAC002
068960200529     C                     EXSR ZALIGN                                    CAC002
068970200529     C                     MOVE ZFIELD    FXMP    72                      CAC002
068980200529     C           *IN99     IFEQ '1'                                       CAC002
068990200529     C                     ADD  1         EC                              CAC002
069000200529     C                     MOVEL' 601'    ERR,EC                          CAC002
069010200529     C                     MOVE '1'       *IN56                           CAC002
069020200529     C                     ENDIF                                          CAC002
069030200529      *                                                                   CAC002
069040200529      **  If valid FX Margin Points, check if equivalent exchange rate    CAC002
069050200529      **  is within the defined tolerance                                 CAC002
069060200529      *                                                                   CAC002
069070200529     C           *IN56     IFEQ *OFF                                      CAC002
069080200529      *                                                                   CAC002
069090200529      **  Get Tolerance for FX Margin                                     CAC002
069100200529      *                                                                   CAC002
069110200529      **  Get Normally-quoted Decimal Places                              CAC002
069120200529      *                                                                   CAC002
069130200529     C                     EXSR SRNQDP                                    CAC002
069140200529     C           ZNQDPX    ADD  1         ZA      10                      CAC002
069150200529      *                                                                   CAC002
069160200529      **  Compute the maximum margin points allowed:                      CAC002
069170200529      **  Exchg. rate * Tolerance * 10**normally quoted d.p.              CAC002
069180200529      *                                                                   CAC002
069190200529     C           FTTMRT    DIV  100       W1      32                      CAC002
069200200529     C           PSXR      MULT W1        W2     138H                     CAC002
069210200529     C           W2        MULT AP,ZA     WMAXPT  72H                     CAC002
069220200529      *                                                                   CAC002
069230200529      **  If Margin Points is greater than the maximum allowed, display   CAC002
069240200529      **  warning error code                                              CAC002
069250200529      *                                                                   CAC002
069260200529     C           FXMP      IFGT WMAXPT                                    CAC002
069270200529     C                     ADD  1         WEC                             CAC002
069280200529     C                     ADD  1         EC                              CAC002
069290200529     C                     MOVEL' W10'    ERR,EC                          CAC002
069300200529     C                     MOVE '1'       *IN56                           CAC002
069310200529     C                     ENDIF                                          CAC002
069320200529      *                                                                   CAC002
069330200529      **  Calculate margin rate and new exchange rate                     CAC002
069340200529      *                                                                   CAC002
069350200529     C           FXMP      DIV  AP,ZA     FXMR      H                     CAC002
069360200529      *                                                                   CAC002
069370200529     C           SPPRE     IFEQ 'R'                                       CAC002
069380200529     C           SPMDI     ANDEQ'M'                                       CAC002
069390200529     C           SPPRE     OREQ 'P'                                       CAC002
069400200529     C           SPMDI     ANDEQ'D'                                       CAC002
069410200529     C                     ADD  FXMR      PSXR                            CAC002
069420200529     C                     ELSE                                           CAC002
069430200529     C                     SUB  FXMR      PSXR                            CAC002
069440200529     C                     ENDIF                                          CAC002
069450200529     C                     ENDIF                                          CAC002
069460200529     C                     ELSE                                           CAC002
069470200529     C           FXMP      IFNE 0                                         120815
069480200529      *                                                                   CAC002
069490200529      **  Error if nominal and settlement currencies are the same         CAC002
069500200529      *                                                                   CAC002
069510200529     C                     ADD  1         EC                              CAC002
069520200529     C                     MOVEL' 602'    ERR,EC                          CAC002
069530200529     C                     MOVE '1'       *IN56                           CAC002
069540200529     C                     ENDIF                                          120815
069550200529     C                     ENDIF                                          CAC002
069560200529     C                     ENDIF                                          CAC002
069570200529     C*
069580200529     C* TRANSLATE AND VALIDATE SPBRX (#AMNT) BASE CURRENCY RATE
069590200529     C*
069600200529     C                     Z-ADD8         ZSDEC
069610200529     C                     Z-ADD5         ZSDIG
069620200529     C*
069630200529     C                     MOVE *BLANKS   ZFLD17
069640200529     C                     MOVELSPBRX     ZFLD17
069650200529     C                     EXSR ZASIGN
069660200529     C           *IN99     IFEQ '1'
069670200529     C                     ADD  1         WEC                             E14214
069680200529     C                     ADD  1         EC         38
069690200529     C                     MOVEL' W06'    ERR,EC
069700200529     C                     ELSE
069710200529     C                     MOVE ZOUT15    PBRX
069720200529     C           ZFSIGN    IFEQ '-'
069730200529     C                     Z-SUBPBRX      PBRX
069740200529     C                     END
069750200529     C*
069760200529     C*    .. must be within 10% of SPOT RATE
069770200529     C**** WARNING ERROR ONLY - CHECK FIRST TIME THROUGH *******
069780200529     C*
069790200529     C*  Get SPOT rate for base currency
069800200529     C*
069810200529     C           SPBRX     IFNE XSPBRX
069820200529     C***********          MOVE *BLANKS   KEY                             S01117
069830200529     C***********          MOVEL'20'      TYPE                            S01117
069840200529     C***********          MOVE '1'       KEY                             S01117
069850200529     C***********          MOVELPSCU      KCCY2                           S01117
069860200529     C***********TABKEY    CHAINTABTG10F             99                   S01117
069870200529     C***********SPOT      DIV  10        SPWRK1 138                      S01117
069880200529     C***********SPOT      ADD  SPWRK1    SPWRK2 138                      S01117
069890200529     C*                                                                   S01117
069900200529     C                     CALL 'AOCURRR0'                                S01117
069910200529     C                     PARM *BLANKS   @RTCD   7                       S01117
069920200529     C                     PARM '*KEY   ' @OPTN   7                       S01117
069930200529     C                     PARM PSCU      @AJCD   3                       S01117
069940200529     C           SDCURR    PARM SDCURR    DSSDY                           S01117
069950200529     C*                                                                   S01117
069960200529     C           A6SPRT    DIV  10        SPWRK1 138                      S01117
069970200529     C           A6SPRT    ADD  SPWRK1    SPWRK2 138                      S01117
069980200529     C           PBRX      IFGT SPWRK2
069990200529     C                     ADD  1         WEC                             E14214
070000200529     C                     ADD  1         EC
070010200529     C                     MOVEL' W06'    ERR,EC
070020200529     C                     SETON                     38
070030200529     C                     ELSE
070040200529     C*
070050200529     C***********SPOT      SUB  SPWRK1    SPWRK2                          S01117
070060200529     C           A6SPRT    SUB  SPWRK1    SPWRK2                          S01117
070070200529     C           PBRX      IFLT SPWRK2
070080200529     C                     ADD  1         WEC                             E14214
070090200529     C                     ADD  1         EC
070100200529     C                     MOVEL' W06'    ERR,EC
070110200529     C                     SETON                     38
070120200529     C                     END
070130200529     C                     END
070140200529     C                     MOVE SPBRX     XSPBRX
070150200529     C                     END
070160200529     C                     END                             *IN99=1
070170200529     C*
070180200529     C**  TRANSLATE AND VALIDATE SPSMT (#ALPV) SETTLEMENT METHOD
070190200529     C*
070200200529     C           SPSMT     IFNE '00'
070210200529     C           SPSMT     ANDNE'01'
070220200529     C           SPSMT     ANDNE'02'
070230200529     C           SPSMT     ANDNE'03'
070240200529     C           SPSMT     ANDNE'04'
070250200529     C           SPSMT     ANDNE'05'
070260200529     C           SPSMT     ANDNE'06'
070270200529     C           SPSMT     ANDNE'07'
070280200529     C           SPSMT     ANDNE'08'
070290200529     C           SPSMT     ANDNE'12'
070300200529     C           SPSMT     ANDNE'14'
070310200529     C           SPSMT     ANDNE'15'
070320200529     C                     ADD  1         EC         39    *
070330200529     C                     MOVEL' 205'    ERR,EC
070340200529     C                     ELSE
070350200529     C                     MOVELSPSMT     PSMT
070360200529     C                     END                             *SPSMT
070370200529     C*
070380200529     C**If*method*is*04*of*14*retail*module*must*be*present***************E23408
070390200529     C* If method is 04 of 14 retail or int. on accounts must be present  E23408
070400200529     C*
070410200529     C***********                                                         S01117
070420200529     C           SPSMT     IFEQ '04'
070430200529     C           SPSMT     OREQ '14'
070440200529     C***********          TESTB'6'       MODI2          99               E14712
070450200529     C***********          TESTB'7'       MODI2          99         E14712S01117
070460200529     C**N99******          TESTB'2'       MODI5          99         E23408S01117
070470200529     C           BGRTBN    IFEQ 'Y'                                       S01117
070480200529     C***********BGIOAC    ANDEQ'Y'                                 S01117E37159
070490200529     C           BGIOAC    OREQ 'Y'                                       E37159
070500200529     C                     MOVE '1'       *IN99                           S01117
070510200529     C                     END                                            S01117
070520200529     C*                                                                   S01117
070530200529     C           *IN99     IFEQ '0'
070540200529     C                     ADD  1         EC         39    *
070550200529     C                     MOVEL' 206'    ERR,EC
070560200529     C                     END                             *IN99
070570200529     C                     END                             *SPSMT
070580200529     C*                                                                   S01408
070590200529     C/COPY WNCPYSRC,SE0170CVSF                                           S01408
070600200529     C*                                                                   S01408
070610200529     C*                                                                   E14712
070620200529     C* If method is 04 must reference an active ACCNT record             E14712
070630200529     C*                                                                   E14712
070640200529     C           SPSMT     IFEQ '04'                                      E14712
070650200529     C***********          MOVELSPCPY     CUS@                      E14712E16843
070660200529     C***********          Z-ADDCADC      ACOD@                     E14712E16843
070670200529     C***********          MOVE SPSCU     PSCU                      E14712E16843
070680200529     C                     MOVELSPCPY     KYCNUM                          E16843
070690200529     C***********          Z-ADDCADC      KYACOD                    E16843S01117
070700200529     C                     MOVE BMACCD    KYACOD                          S01117
070710200529     C                     MOVE SPSCU     KYCCY                           E16843
070720200529     C*                                                                   E14712
070730200529     C****access*TABLETR*for*A/C*Sequence******                     E14712S01117
070740200529     C*                                                                   E14712
070750200529     C                     SETOF                         99               E14712
070760200529     C***********MBIN      IFEQ 'Y'                                 E14712S01117
070770200529     C***********          MOVE *BLANKS   KEY12  12                 E14712S01117
070780200529     C***********          MOVE SPSEB     KEY12                     E14712S01117
070790200529     C***********          MOVEL'10'      KEY12                     E14712S01117
070800200529     C***********KEY12     CHAINTABLETRF             99             E14712S01117
070810200529     C***********          Z-ADDNSACS     ACSQ@                     E14712E16843
070820200529     C***********          Z-ADDNSACS     KYACSQ                    E16843S01117
070830200529     C***********          ELSE                                     E14712S01117
070840200529     C***********          Z-ADD1         ACSQ@                     E14712E16843
070850200529     C***********          Z-ADD1         KYACSQ                    E16843S01117
070860200529     C***********          END                                      E14712S01117
070870200529     C*                                                                   E14712
070880200529     C                     Z-ADD1         KYACSQ                          S01117
070890200529     C                     MOVELSPBCA     KYBRCA                          S01117
070900200529     C**N99***** ACCNTK    CHAINACCNTABF             99             E14712E16843
070910200529     C  N99      KEYACC    CHAINACCNTABF             99                   E16843
070920200529     C*                                                                   E14712
070930200529     C           *IN99     IFEQ '1'                                       E14712
070940200529     C***********RECI      OREQ '*'                                E14712 178530
070950200529     C           RECIA     OREQ 'C'                                       178530
070960200529     C                     ADD  1         EC         39                   E14712
070970200529     C                     MOVEL' 226'    ERR,EC                          E14712
070980200529     C*********            END                                      E14712E16843
070990200529     C*                                                                   E14712
071000200529     C**  Else check account is not blocked                               E16843
071010200529     C*                                                                   E16843
071020200529     C                     ELSE                                           E16843
071030200529     C                     TESTB'2'       RETB           16               E16843
071040200529     C                     TESTB'3'       RETB           17               E16843
071050200529     C           SPPRE     IFEQ 'P'                                       E16843
071060200602     C********** *IN16     ANDEQ'1'                                                  E16843 MD043182
071070200602     C           *IN17     ANDEQ'1'                                                         MD043182
071080200529     C           SPPRE     OREQ 'R'                                       E16843
071090200602     C********** *IN17     ANDEQ'1'                                                  E16843 MD043182
071100200602     C           *IN16     ANDEQ'1'                                                         MD043182
071110200602     C/COPY WNCPYSRC,HUT111_002                                                               HUT111
071120200529     C                     ADD  1         EC         39                   E16843
071130200529     C                     MOVEL' 226'    ERR,EC                          E16843
071140200602     C/COPY WNCPYSRC,HUT111_003                                                               HUT111
071150200529     C                     END                                            E16843
071160200529     C                     END                                            E16843
071170200529     C*                                                                   E14712
071180200529     C                     END                                            E14712
071190200529     C*
071200200529     C* If method is 07 currency must be USD
071210200529     C*
071220200529     C           SPSMT     IFEQ '07'
071230200529     C***********SPSCU     ANDNEUSCY                                      S01117
071240200529     C           SPSCU     ANDNEBLUSCY                                    S01117
071250200529     C                     ADD  1         EC         39    *
071260200529     C                     MOVEL' 207'    ERR,EC
071270200529     C                     END                             *SPSMT
071280200529     C*
071290200529     C* CHECK DUE DATE IS NOT A HOLIDAY FOR THE FOLLOWING METHODS         S01195
071300200529     C* This processing is now done after the nostro field has been       S01195
071310200529     C*  validated                                                        S01195
071320200529     C*                                                                   S01195
071330200529     C***********SPSMT     IFEQ '01'                                      S01195
071340200529     C***********SPSMT     OREQ '02'                                      S01195
071350200529     C***********SPSMT     OREQ '07'                                      S01195
071360200529     C***********SPSMT     OREQ '08'                                      S01195
071370200529     C***********SPSMT     OREQ '12'                                      S01195
071380200529     C***********          Z-ADDPDUD      ZDAYNO                          S01195
071390200529     C***********          MOVELSPSCU     ZCCY                            S01195
071400200529     C***********          MOVE '0'       ZOPT                            S01195
071410200529     C***********          EXSR ZDATE5                                    S01195
071420200529     C************IN99     IFEQ '1'                                       S01195
071430200529     C***********          ADD  1         WEC                       E14214S01195
071440200529     C***********          ADD  1         EC         39    *              S01195
071450200529     C***********          MOVEL' W02'    ERR,EC                          S01195
071460200529     C***********          END                             *IN99          S01195
071470200529     C***********          END                             *SPSMT         S01195
071480200529     C*
071490200529     C* CHECK DUE DATE IS NOT A HOLIDAY IN LOCAL CURRENCY
071500200529     C* FOR THE FOLLOWING METHODS
071510200529     C*
071520200529     C           SPSMT     IFEQ '03'
071530200529     C           SPSMT     OREQ '04'
071540200529     C           SPSMT     OREQ '05'
071550200529     C           SPSMT     OREQ '14'
071560200529     C           SPSMT     OREQ '15'
071570200529     C*                                                                   S01512
071580200529     C** If S01512 is active, check for the pos. settlement value date    S01512
071590200529     C** rather than the due date                                         S01512
071600200529     C*                                                                   S01512
071610200529     C           S01512    IFEQ 'Y'                                       S01512
071620200529     C                     Z-ADDPSVL      ZDAYNO                          S01512
071630200529     C                     ELSE                                           S01512
071640200529     C                     Z-ADDPDUD      ZDAYNO
071650200529     C                     END                                            S01512
071660200529     C***********          MOVELLOCY      ZCCY                            S01195
071670200529     C                     MOVELBJLCCY    ZCCY                            S01195
071680200529     C***********          MOVE '0'       ZOPT                            S01195
071690200529     C***********          EXSR ZDATE5                                    S01195
071700200529     C                     MOVE BJSLCD    ZLOC                            S01195
071710200529     C                     EXSR ZCHKH                                     S01195
071720200529     C************IN99     IFEQ '1'                                       S01195
071730200529     C           ZIND      IFEQ 'H'                                       S01195
071740200529     C                     ADD  1         WEC                             E14214
071750200529     C                     ADD  1         EC         39    *
071760200529     C                     MOVEL' W03'    ERR,EC
071770200529     C                     END                             *IN99
071780200529     C                     END                             *SPSMT
071790200529     C*
071800200529     C***********                                                         E14881
071810200529     C**TRANSLATE*AND*VALIDATE*SPPRE*(#ALPV)*****                         E14881
071820200529     C***********                                                         E14881
071830200529     C***********          MOVELSPPRE     PPRE                            E14881
071840200529     C***********                                                         E14881
071850200529     C***********SPPRE     IFEQ *BLANK                                    E14881
071860200529     C***********          ADD  1         EC         36    *              E14881
071870200529     C***********          MOVEL' 225'    ERR,EC                          E14881
071880200529     C***********          END                             *SPPRE         E14881
071890200529     C                     MOVELSPMDI     PMDI
071900200529     C*
071910200529     C* TRANSLATE AND VALIDATE SPSEA (#ALPV) SETTLEMENT A/C
071920200529     C*
071930200529     C                     MOVELPSEA      XPSEA                                               CSD015
071940200529     C                     MOVELSPSEA     PSEA
071950200529     C*
071960200529     C           SPSEA     IFNE '  '
071970200529     C           SPSMT     ANDNE'01'
071980200529     C           SPSMT     ANDNE'02'
071990200529     C           SPSMT     ANDNE'05'
072000200529     C           SPSMT     ANDNE'07'
072010200529     C           SPSMT     ANDNE'08'
072020200529     C           SPSMT     ANDNE'12'
072030200529     C           SPSMT     ANDNE'14'
072040200529     C           SPSMT     ANDNE'15'
072050200529     C                     ADD  1         EC         40    *
072060200529     C                     MOVEL' 208'    ERR,EC
072070200529     C                     END                             *SPSEA
072080200529     C*
072090200529     C** Check an entry exists on the Nostro table
072100200529     C*
072110200529     C           SPSMT     IFEQ '01'
072120200529     C           SPSMT     OREQ '02'
072130200529     C           SPSMT     OREQ '07'
072140200529     C           SPSMT     OREQ '08'
072150200529     C           SPSMT     OREQ '12'
072160200529     C***********          MOVE *BLANKS   KEY                             S01117
072170200529     C***********          MOVEL'70      'KEY                             S01117
072180200529     C***********          MOVELSPSEA     WORK2A  2                       S01117
072190200529     C***********          MOVE WORK2A    KEY                             S01117
072200200529     C***********          MOVE SPSCU     KCCY                            S01117
072210200529     C***********TABKEY    CHAINTABLETLF             99                   S01117
072220200529     C************IN99     IFEQ '0'                                       S01117
072230200529     C***********RECI      IFEQ '*'                                       S01117
072240200529     C***********          SETON                     99                   S01117
072250200529     C***********          END                                            S01117
072260200529     C***********          END                                            S01117
072270200529     C************IN99     IFEQ '1'                                       S01117
072280200529     C*                                                                   S01117
072290200529     C                     MOVE '1'       VALID   1                                           198729
072300200529     C                     MOVE *BLANK    ACSQ2A  2                                           198729
072310200529     C                     MOVE SPSEA     ACSQ2A                                              198729
072320200529     C           ACSQ2A    IFNE *BLANK                                                        198729
072330200529     C**********           MOVELSPSEA     ACCT10 10                                    198729 CGL029
072340200529     C                     MOVELSPSEA     ACCT10 16                                           CGL029
072350200529     C                     MOVELACCT10    CNUM6A  6                                           198729
072360200529     C**********           MOVE ACCT10    ACOD4A  4                                    198729 CGL029
072370200529     C                     MOVE ACCT10    ACOD4A 10                                           CGL029
072380200529     C                     MOVELCNUM6A    KYCNUM                                              198729
072390200529     C                     MOVELSPSCU     KYCCY                                               198729
072400200529     C                     MOVELACOD4A    KYACOD                                              198729
072410200529     C                     MOVELACSQ2A    KYACSQ                                              198729
072420200529     C                     MOVELSPSEB     KYBRCA                                              198729
072430200529     C           KEYACC    CHAINACCNTABF             77                                       198729
072440200529     C           *IN77     IFEQ '0'                                                           198729
072450200529     C           ATYP      IFEQ 'R'                                                           198729
072460200529     C                     CALL 'AONOSTR0'                                                    198729
072470200529     C                     PARM *BLANKS   @RTCD                                               198729
072480200529     C                     PARM '*KEY   ' @OPTN                                               198729
072490200529     C                     PARM CNUM6A    @CUST                                               198729
072500200529     C                     PARM KYCCY     @CCYC                                               198729
072510200529     C                     PARM ACOD4A    @ACCD                                               198729
072520200529     C                     PARM ACSQ2A    @ACSQ                                               198729
072530200529     C                     PARM *BLANKS   @NOSN                                               198729
072540200529     C                     PARM KYBRCA    @BRCD                                               198729
072550200529     C                     PARM *BLANKS   @CUSN                                               198729
072560200529     C                     PARM *BLANKS   @PRNO                                               198729
072570200529     C           SDNOST    PARM SDNOST    DSFDY                                               198729
072580200529     C           @RTCD     IFNE *BLANKS                                                       198729
072590200529     C                     MOVE '0'       VALID                                               198729
072600200529     C                     ENDIF                                                              198729
072610200529     C                     ENDIF                                                              198729
072620200529     C                     ENDIF                                                              198729
072630200529     C                     ENDIF                                                              198729
072640200529      *                                                                                       198729
072650200529     C           VALID     IFEQ '1'                                                           198729
072660200529     C***********          MOVELSPSEA     NOS2A                     S01117105034
072670200529     C**********           MOVELSPSEA     NOS6A   6                                    105034 191232
072680200529     C**********           MOVE NOS6A     NOS1A   1                                    105034 191232
072690200529     C********** NOS1A     IFNE *BLANK                                                 105034 191232
072700200529     C**********           MOVE SPSEA     NOS2A                                        105034 191232
072710200529     C**********           ELSE                                                        105034 191232
072720200529     C**********           MOVELSPSEA     NOS5A   5                                    105034 191232
072730200529     C**********           MOVELNOS5A     NOS3A   3                                    105034 191232
072740200529     C**********           MOVE NOS3A     NOS1B   1                                    105034 191232
072750200529     C********** NOS1B     IFNE *BLANK                                                 105034 191232
072760200529     C**********           MOVE NOS5A     NOS2A                                        105034 191232
072770200529     C**********           ELSE                                                        105034 191232
072780200529     C**********           MOVELNOS5A     NOS2A                                        105034 191232
072790200529     C**********           END                                                         105034 191232
072800200529     C**********           END                                                         105034 191232
072810200529     C                     MOVELSPSEA     NOS2A                                               191232
072820200529     C**********           MOVE SPSEA     NOS10A 10                                    191232 CGL029
072830200529     C                     MOVE SPSEA     NOS10A 16                                           CGL029
072840200529     C           NOS2A     IFEQ *BLANKS                                                       191232
072850200529     C           NOS10A    ORNE *BLANKS                                                       191232
072860200529     C                     MOVEL'*ERROR'  @RTCD                                               191232
072870200529     C                     ELSE                                                               191232
072880200529     C                     CALL 'AONOSTR0'                                S01117
072890200529     C                     PARM *BLANKS   @RTCD                           S01117
072900200529     C                     PARM '*KEY   ' @OPTN                           S01117
072910200529     C                     PARM *BLANKS   @CUST   6                       S01117
072920200529     C                     PARM SPSCU     @CCYC   3                       S01117
072930200529     C**********           PARM *BLANKS   @ACCD   4                                    S01117 CGL029
072940200529     C                     PARM *BLANKS   @ACCD  10                                           CGL029
072950200529     C                     PARM *BLANKS   @ACSQ   2                       S01117
072960200529     C                     PARM NOS2A     @NOSN   2                       S01117
072970200529     C                     PARM *BLANKS   @BRCD   3                       S01117
072980200529     C                     PARM *BLANKS   @CUSN  10                       S01117
072990200529     C                     PARM *BLANKS   @PRNO   1                       S01117
073000200529     C           SDNOST    PARM SDNOST    DSFDY                           S01117
073010200529     C                     ENDIF                                                              191232
073020200529     C                     ENDIF                                                              198729
073030200529     C*                                                                   S01117
073040200529     C**  Invalid Entry                                                   S01117
073050200529     C*                                                                   S01117
073060200529     C           @RTCD     IFNE *BLANKS                                   S01117
073070200529     C                     ADD  1         EC         40    *
073080200529     C                     MOVEL' 209'    ERR,EC
073090200529     C                     ELSE                                           S01195
073100200529     C*                                                                   S01408
073110200529     C/COPY WNCPYSRC,SE0170CVS4                                           S01408
073120200529     C*                                                                   S01408
073130200529     C*                                                                   S01195
073140200529     C**  Check due date is not a holiday for nostro location/ccy         S01195
073150200529     C**  Use branch code from Nostro file to get nostro location         S01195
073160200529     C*                                                                   S01195
073170200529     C**********           CALL 'AOBRCHR0'                                S01195              CGL029
073180200529     C                     CALL 'AOBRCHR1'                                                    CGL029
073190200529     C                     PARM *BLANKS   @RTCD                           S01195
073200200529     C                     PARM '*KEY   ' @OPTN                           S01195
073210200529     C                     PARM A7BRCD    @DSNB                           S01195
073220200529     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01195              CGL029
073230200529     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
073240200529     C*                                                                   S01195
073250200529     C                     MOVE A8LCCD    ZLOC                            S01195
073260200529     C*                                                                   S01195
073270200529     C** If S01512 is active, check for the pos. settlement value date    076975
073280200529     C** rather than the due date                                         076975
073290200529     C*                                                                   076975
073300200529     C***********          Z-ADDPDUD      ZDAYNO                    S01195076975
073310200529     C           S01512    IFEQ 'Y'                                       076975
073320200529     C                     Z-ADDPSVL      ZDAYNO                          076975
073330200529     C                     ELSE                                           076975
073340200529     C                     Z-ADDPDUD      ZDAYNO                          076975
073350200529     C                     END                                            S01512
073360200529     C*                                                                   076975
073370200529     C                     MOVELSPSCU     ZCCY                            S01195
073380200529     C                     EXSR ZCHKH                                     S01195
073390200529     C           ZIND      IFEQ 'H'                                       S01195
073400200529     C                     ADD  1         WEC                             S01195
073410200529     C                     ADD  1         EC         39    *              S01195
073420200529     C                     MOVEL' W02'    ERR,EC                          S01195
073430200529     C                     END                             ZIND           S01195
073440200529     C                     END
073450200529     C                     END                             *SPSMT
073460200529     C*
073470200529     C**  Check Settlement A/C exists on ACCNT
073480200529     C*
073490200529     C           SPSMT     IFEQ '05'
073500200529     C*
073510200529     C**  First check I/p is numeric
073520200529     C*
073530200529     C                     TESTN          SPSEA      99
073540200529     C           *IN99     IFEQ '1'
073550200529     C                     MOVELSPSEA     PSEA@
073560200529     C                     MOVELSPSEB     BRCA@                           S01117
073570200529     C           ACCNTK    CHAINACCNT                99
073580200529     C************IN99     IFEQ '0'                                       E17211
073590200529     C***********RECI      IFEQ '*'                                       E17211
073600200529     C           *IN99     IFEQ '1'                                       E17211
073610200529     C***********RECI      OREQ '*'                                E17211 178530
073620200529     C           RECIA     OREQ 'C'                                       178530
073630200529     C                     SETON                     99
073640200529     C***********                                                   E16843S01117
073650200529     C****Else*if*branch*not*equal*to*settlement*branch****               S01117
073660200529     C***********                                                   E16843S01117
073670200529     C***********          ELSE                                           S01117
073680200529     C***********          MOVELBRCD      WRK03   3                       S01117
073690200529     C***********WRK03     IFNE SPSEB                                     S01117
073700200529     C***********          SETON                     99                   S01117
073710200529     C*                                                                   E16843
073720200529     C**  else check account is not blocked                               E16843
073730200529     C*                                                                   E16843
073740200529     C                     ELSE                                           E16843
073750200529     C                     TESTB'2'       RETB           16               E16843
073760200529     C                     TESTB'3'       RETB           17               E16843
073770200529     C           SPPRE     IFEQ 'P'                                       E16843
073780200602     C********** *IN16     ANDEQ'1'                                                  E16843 MD043182
073790200602     C           *IN17     ANDEQ'1'                                                         MD043182
073800200529     C           SPPRE     OREQ 'R'                                       E16843
073810200602     C********** *IN17     ANDEQ'1'                                                  E16843 MD043182
073820200602     C           *IN16     ANDEQ'1'                                                         MD043182
073830200602     C/COPY WNCPYSRC,HUT111_004                                                               HUT111
073840200529     C                     SETON                     99                   E16843
073850200602     C/COPY WNCPYSRC,HUT111_005                                                               HUT111
073860200529     C                     END                                            E16843
073870200529     C*                                                                   E16843
073880200529     C***********          END                                            S01117
073890200529     C                     END
073900200529     C           *IN99     IFEQ '1'
073910200529     C                     ADD  1         EC         40    *
073920200529     C                     MOVEL' 210'    ERR,EC
073930200529     C                     END
073940200529     C***********          END                                            E17211
073950200529     C*
073960200529     C**  Else Entry Not Numeric
073970200529     C*
073980200529     C                     ELSE
073990200529     C                     ADD  1         EC         40    *
074000200529     C                     MOVEL' 210'    ERR,EC
074010200529     C                     END
074020200529     C                     END
074030200529     C*
074040200529     C***Check*A/C*exists*on*ACNUM*and*the*Pay*Branch*matches*********    S01117
074050200529     C** Check Settlement A/C exists on ACNUM                             S01117
074060200529     C*
074070200529     C           SPSMT     IFEQ '14'
074080200529     C*
074090200529     C**  First check I/p is numeric
074100200529     C*
074110200529     C                     MOVELSPSEA     WRK10A 10
074120200529     C                     TESTN          WRK10A     99
074130200529     C*
074140200529     C**  If numeric, record must exist on ACNUM
074150200529     C*
074160200529     C           *IN99     IFEQ '1'
074170200529     C                     MOVELSPSEA     ACNO
074180200529     C           ACNO      CHAINACNUM                99
074190200529     C           *IN99     IFEQ '0'
074200200529     C***********RECI      IFEQ '*'                                       178530
074210200529     C           RECIA     IFEQ 'C'                                       178530
074220200529      *                                                                   178530
074230200529      **  CCY must be equal to settlement CCY                             178530
074240200529      *                                                                   178530
074250200529     C           CCY       ORNE SPSCU                                     178530
074260200529      *                                                                   178530
074270200529     C                     SETON                     99
074280200529     C************                                                        S01117
074290200529     C****Else*if*branch*not*equal*to*settlement*branch*******            S01117
074300200529     C************                                                        S01117
074310200529     C                     ELSE
074320200529     C*
074330200529     C****READ*ACCNT*TO*GET*PAY*BRANCH************                        S01117
074340200529     C**  READ ACCNT                                                      S01117
074350200529     C*
074360200529     C**********           Z-ADDCNUM      CUS@                                                CSD027
074370200529     C                     MOVE CNUM      CUS@                                                CSD027
074380200529     C                     Z-ADDACOD      ACOD@
074390200529     C                     Z-ADDACSQ      ACSQ@
074400200529     C                     MOVELBRCA      BRCA@                           S01117
074410200529     C           ACCNTK    CHAINACCNT                99
074420200529     C           *IN99     IFEQ '1'                                       E16843
074430200529     C***********RECI      OREQ '*'                                E16843 178530
074440200529     C           RECIA     OREQ 'C'                                       178350
074450200529     C                     SETON                     99                   E16843
074460200529     C                     ELSE                                           E16843
074470200529     C***********          MOVELBRCD      WRK03
074480200529     C                     MOVELBRCA      WRK03   3
074490200529     C           WRK03     IFNE SPSEB
074500200529     C                     SETON                     99
074510200529     C*                                                                   E16843
074520200529     C**  else check account is not blocked                               E16843
074530200529     C*                                                                   E16843
074540200529     C                     ELSE                                           E16843
074550200529     C                     TESTB'2'       RETB           16               E16843
074560200529     C                     TESTB'3'       RETB           17               E16843
074570200529     C           SPPRE     IFEQ 'P'                                       E16843
074580200602     C********** *IN16     ANDEQ'1'                                                  E16843 MD043182
074590200602     C           *IN17     ANDEQ'1'                                                         MD043182
074600200529     C           SPPRE     OREQ 'R'                                       E16843
074610200602     C********** *IN17     ANDEQ'1'                                                  E16843 MD043182
074620200602     C           *IN16     ANDEQ'1'                                                         MD043182
074630200602     C/COPY WNCPYSRC,HUT111_006                                                               HUT111
074640200529     C                     SETON                     99                   E16843
074650200602     C/COPY WNCPYSRC,HUT111_007                                                               HUT111
074660200529     C                     END                             *SPPRE =P OR R E16843
074670200529     C                     END                                            E16843
074680200529     C*                                                                   E16843
074690200529     C                     END
074700200529     C                     END                                            178530
074710200529     C           *IN99     IFEQ '1'
074720200529     C                     ADD  1         EC         40
074730200529     C                     MOVEL' 211'    ERR,EC
074740200529     C                     END
074750200529     C***********          END                                            178530
074760200529     C                     ELSE
074770200529     C                     ADD  1         EC         40    *
074780200529     C                     MOVEL' 211'    ERR,EC
074790200529     C                     END
074800200529     C                     ELSE
074810200529     C                     ADD  1         EC         40    *
074820200529     C                     MOVEL' 211'    ERR,EC
074830200529     C                     END                             *IN99=1
074840200529     C                     END                             *SPSMT
074850200529     C*
074860200529     C***Check*Cust*exists*on*CLINTSE*and*Settlement*A/c*Input*********   E17793
074870200529     C*                                                                   E17793
074880200529     C           SPSMT     IFEQ '15'
074890200529     C*                                                                   E17793
074900200529     C**First*check*I/p*is*numeric*************************************   E17793
074910200529     C***********          MOVELSPSEA     WRK06A  6                       E17793
074920200529     C***********          TESTN          WRK06A     99                   E17793
074930200529     C**If*numeric,*record*must*exist*on*CLINTSE***********************   E17793
074940200529     C************IN99     IFEQ '1'                                       E17793
074950200529     C***********          MOVELSPSEA     PSEA@                           E17793
074960200529     C***********CUS@      CHAINCLINTSEF             99                   E17793
074970200529     C************IN99     IFEQ '0'                                       E17793
074980200529     C***********RECI      IFEQ '*'                                       E17793
074990200529     C***********          SETON                     99                   E17793
075000200529     C***********          ELSE                                           E17793
075010200529     C***********C1AC      IFEQ 0                                         E17793
075020200529     C***********          SETON                     99                   E17793
075030200529     C***********          END                                            E17793
075040200529     C***********C1SQ      IFEQ 0                                         E17793
075050200529     C***********          SETON                     99                   E17793
075060200529     C***********          END                                            E17793
075070200529     C***********          END                                            E17793
075080200529     C***********          END                                            E17793
075090200529     C***********                                                  E16843 E17793
075100200529     C**If*active*record*exists*on*CLINTSE*and*no*errors***********E16843 E17793
075110200529     C*****check*account*is*not*blocked*on*ACCNT*******************E16843 E17793
075120200529     C***********                                                  E16843 E17793
075130200529     C************IN99     IFEQ '0'                                E16843 E17793
075140200529     C/COPY WNCPYSRC,SE0170C072
075150200529     C*                                                                   E17793
075160200529     C**  Set up defaults for Settlement Account and check that account   E17793
075170200529     C**  is not blocked on ACCNT                                         E17793
075180200529     C*                                                                   E17793
075190200529     C                     MOVELPCPY      CUS@                            E17793
075200200529     C                     MOVELPC1AC     ACOD@                           E17793
075210200529     C                     MOVELPC1SQ     ACSQ@                           E17793
075220200529     C                     MOVELPSEA@     SPSEA                           E17793
075230200529     C/COPY WNCPYSRC,SE0170C073
075240200529     C           SPSEB     IFNE *BLANKS                                   087651
075250200529     C                     MOVELSPSEB     BRCA@                           087651
075260200529     C                     ELSE                                           087651
075270200529     C                     MOVELPBCA      BRCA@                           S01117
075280200529     C                     MOVELPBCA      SPSEB                           087651
075290200529     C                     END                                            087651
075300200529     C*                                                                   E17793
075310200529     C**********           Z-ADDCUS@      KYCNUM                                       E16843 CSD027
075320200529     C                     MOVE CUS@      KYCNUM                                              CSD027
075330200529     C                     MOVELSPSCU     KYCCY                           E16843
075340200529     C***********          MOVELC1AC      KYACOD                   E16843 E17793
075350200529     C***********          Z-ADDC1SQ      KYACSQ                   E16843 E17793
075360200529     C                     MOVELACOD@     KYACOD                          E17793
075370200529     C                     Z-ADDACSQ@     KYACSQ                          E17793
075380200529     C                     MOVELBRCA@     KYBRCA                          S01117
075390200529     C           KEYACC    CHAINACCNTABF             99                   E16843
075400200529     C           *IN99     IFEQ '1'                                       E16843
075410200529     C***********RECI      OREQ '*'                                E16843 178530
075420200529     C           RECIA     OREQ 'C'                                       178530
075430200529     C                     SETON                     99                   E16843
075440200529     C                     ELSE                                           E16843
075450200529     C                     TESTB'2'       RETB           16               E16843
075460200529     C                     TESTB'3'       RETB           17               E16843
075470200529     C           SPPRE     IFEQ 'P'                                       E16843
075480200602     C********** *IN16     ANDEQ'1'                                                  E16843 MD043182
075490200602     C           *IN17     ANDEQ'1'                                                         MD043182
075500200529     C           SPPRE     OREQ 'R'                                       E16843
075510200602     C********** *IN17     ANDEQ'1'                                                  E16843 MD043182
075520200602     C           *IN16     ANDEQ'1'                                                         MD043182
075530200529     C                     SETON                     99                   E16843
075540200529     C                     END                             *SPPRE =P OR R E16843
075550200529     C                     END                             *IN99=1        E16843
075560200529     C***********          END                             *IN99=0 E16843 E17793
075570200529     C*                                                                   E16843
075580200529     C           *IN99     IFEQ '1'
075590200529     C                     ADD  1         EC         40
075600200529     C                     MOVEL' 212'    ERR,EC
075610200529     C                     END                             *IN99=1
075620200529     C***********          ELSE                                           E17793
075630200529     C***********          ADD  1         EC         40                   E17793
075640200529     C***********          MOVEL' 212'    ERR,EC                          E17793
075650200529     C***********          END                                            E17793
075660200529     C                     END
075670200529     C*                                                                   S01408
075680200529     C/COPY WNCPYSRC,SE0170CVS5                                           S01408
075690200529     C*                                                                   S01408
075700200529     C*
075710200529     C**  TRANSLATE AND VALIDATE SPSEB (#ALPH) Settlement Branch
075720200529     C*
075730200529     C                     MOVELSPSEB     PSEB
075740200529     C*
075750200529     C***********          MOVE *BLANKS   KEY                             S01117
075760200529     C***********          MOVEL'10'      TYPE                            S01117
075770200529     C***********          MOVE SPSEB     KEY                             S01117
075780200529     C***********TABKEY    CHAINTABLETRF             99                   S01117
075790200529     C************IN99     IFEQ '1'                                       S01117
075800200529     C*                                                                   S01117
075810200529     C           *IN81     IFEQ '1'                                       S01117
075820200529     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
075830200529     C                     CALL 'AOBRCHR1'                                                    CGL029
075840200529     C                     PARM *BLANKS   @RTCD                           S01117
075850200529     C                     PARM '*KEY   ' @OPTN                           S01117
075860200529     C                     PARM SPSEB     @DSNB                           S01117
075870200529     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01117              CGL029
075880200529     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
075890200529     C*                                                                   S01117
075900200529     C** Invalid Branch                                                   S01117
075910200529     C*                                                                   S01117
075920200529     C           @RTCD     IFNE *BLANKS                                   S01117
075930200529     C                     ADD  1         EC         41
075940200529     C                     MOVEL' 213'    ERR,EC
075950200529     C                     END
075960200529     C*                                                                   S01117
075970200529     C**  For Settlement Methods 01, 02, 07, 08, 12                       S01117
075980200529     C**  Settlement Branch must equal Nostro Branch Code                 S01117
075990200529     C*                                                                   S01117
076000200529     C           SPSMT     IFEQ '01'                                      S01117
076010200529     C           SPSMT     OREQ '02'                                      S01117
076020200529     C           SPSMT     OREQ '07'                                      S01117
076030200529     C           SPSMT     OREQ '08'                                      S01117
076040200529     C           SPSMT     OREQ '12'                                      S01117
076050200529     C           SPSEB     IFNE A7BRCD                                    S01117
076060200529     C                     ADD  1         EC         41                   S01117
076070200529     C                     MOVEL' 230'    ERR,EC                          S01117
076080200529     C                     END                                            S01117
076090200529     C*                                                                   S01117
076100200529     C                     ELSE                                           S01117
076110200529     C*                                                                   S01117
076120200529     C**  For all other Settlement Methods except 05 and 14               S01117
076130200529     C**  Settlement Branch must equal Trade Booking Branch               S01117
076140200529     C*                                                                   S01117
076150200529     C           SPSMT     IFEQ '00'                                      S01117
076160200529     C           SPSMT     OREQ '03'                                      S01117
076170200529     C           SPSMT     OREQ '04'                                      S01117
076180200529     C           SPSMT     OREQ '06'                                      S01117
076190200529     C***********SPSMT     OREQ '15'                               S01117 087651
076200200529     C           SPSEB     IFNE SPBCA                                     S01117
076210200529     C                     ADD  1         EC         41                   S01117
076220200529     C                     MOVEL' 231'    ERR,EC                          S01117
076230200529     C                     END                                            S01117
076240200529     C                     END                                            S01117
076250200529     C                     END                                            S01117
076260200529     C                     END                                            S01117
076270200529     C*
076280200529     C**  TRANSLATE AND VALIDATE SPCPN (#ALPV) COUNTERPARTY BANK
076290200529     C*
076300200529     C                     MOVELPCPN      XPCPN                                               CSD015
076310200529     C                     MOVELSPCPN     PCPN
076320200529     C*
076330200529     C           SPCPN     IFNE *BLANK
076340200529     C/COPY WNCPYSRC,SE0170C048
076350200529     C*
076360200529     C**  If entered must be valid
076370200529     C*
076380200529     C           SPSMT     IFNE '01'
076390200529     C           SPSMT     ANDNE'07'
076400200529     C           SPSMT     ANDNE'08'
076410200529     C/COPY WNCPYSRC,SE0170C049
076420200529     C                     ADD  1         EC         42
076430200529     C                     MOVEL' 214'    ERR,EC
076440200529     C                     ELSE
076450200529     C*
076460200529     C****Check*entry*refers*to*a*customer*on*CLINT*or*a*counterparty**   S01117
076470200529     C****Nostro*on*TABLET2********************************************   S01117
076480200529     C***********                                                         S01117
076490200529     C****If*numeric*entry*read*CLINTCB*file*Else*Read*SNAME*file******   S01117
076500200529     C*
076510200529     C***********          MOVELSPCPN     WRK6A                           S01117
076520200529     C***********          TESTN          WRK6A      99                   S01117
076530200529     C************IN99     IFEQ '1'                                       S01117
076540200529     C***********          MOVELWRK6A     WRK6N   60                      S01117
076550200529     C***********WRK6N     CHAINCLINT                99                   S01117
076560200529     C**N99******RECI      COMP '*'                      99               S01117
076570200529     C***********                                                         S01117
076580200529     C****Else*read*SNAME*file*************                               S01117
076590200529     C***********                                                         S01117
076600200529     C***********          ELSE                                           S01117
076610200529     C***********SPCPN     CHAINSNAME                99                   S01117
076620200529     C**N99******RECI      COMP '*'                      99               S01117
076630200529     C***********          END                                            S01117
076640200529     C************IN99     IFEQ '1'                                       S01117
076650200529     C***********          MOVEL*BLANKS   KEY                             S01117
076660200529     C***********          MOVE '71'      TYPE                            S01117
076670200529     C***********          MOVELSPCPN     KCPN                            S01117
076680200529     C***********TABKEY    CHAINTABLET2F             99                   S01117
076690200529     C************IN99     IFEQ '0'                                       S01117
076700200529     C***********RECI      IFEQ '*'                                       S01117
076710200529     C***********          SETON                     99                   S01117
076720200529     C***********          END                                            S01117
076730200529     C***********          END                                            S01117
076740200529     C***********          END                                            S01117
076750200529     C************IN99     IFEQ '1'                                       S01117
076760200529     C*                                                                   S01117
076770200529     C**  Check Customer file for valid Customer number                   S01117
076780200529     C*                                                                   S01117
076790200529     C                     CALL 'AOCUSTR0'                                S01117
076800200529     C                     PARM *BLANKS   @RTCD                           S01117
076810200529     C                     PARM '*KEY   ' @OPTN                           S01117
076820200529     C                     PARM SPCPN     @KEY1                           S01117
076830200529     C                     PARM *BLANKS   @KYST                           S01117
076840200529     C           SDCUST    PARM SDCUST    DSSDY                           S01117
076850200529     C*                                                                   S01117
076860200529     C**  Invalid Entry                                                   S01117
076870200529     C*                                                                   S01117
076880200529     C           @RTCD     IFNE *BLANKS                                   S01117
076890200529     C*                                                                   S01117
076900200529     C**  Else check for valid nostro on Counterparty Nostro File         S01117
076910200529     C*                                                                   S01117
076920200529     C                     MOVELSPCPN     CPNST   8                       S01117
076930200529     C                     CALL 'AOCNSTR0'                                S01117
076940200529     C                     PARM *BLANKS   @RTCD                           S01117
076950200529     C                     PARM '*KEY   ' @OPTN                           S01117
076960200529     C                     PARM CPNST     @CPNC   8                       S01117
076970200529     C           SDCNST    PARM SDCNST    DSFDY                           S01117
076980200529     C*                                                                   S01117
076990200529     C           @RTCD     IFNE *BLANKS                                   S01117
077000200529     C*                                                                   S01117
077010200529     C                     ADD  1         EC         42
077020200529     C                     MOVEL' 215'    ERR,EC
077030200529     C                     END
077040200529     C                     END                                            S01117
077050200529     C                     END
077060200529     C                     END
077070200529     C*
077080200529     C**  TRANSLATE AND VALIDATE SPFAC (#ALPV) FOR A/C OF
077090200529     C*
077100200529     C                     MOVELPFAC      XPFAC                                               CSD015
077110200529     C                     MOVELSPFAC     PFAC
077120200529     C*
077130200529     C           SPFAC     IFNE *BLANK
077140200529     C*
077150200529     C**  If entered must be valid
077160200529     C*
077170200529     C           SPSMT     IFNE '01'
077180200529     C           SPSMT     ANDNE'07'
077190200529     C           SPSMT     ANDNE'08'
077200200529     C           SPFAC     ORNE *BLANK
077210200529     C           SPPRE     ANDNE'P'
077220200529     C                     ADD  1         EC         43
077230200529     C                     MOVEL' 216'    ERR,EC
077240200529     C                     ELSE
077250200529     C***********                                                         S01117
077260200529     C****If*numeric*entry*read*CLINTCB*file*Else*Read*SNAME*file***      S01117
077270200529     C***********                                                         S01117
077280200529     C***********          MOVELSPFAC     WRK6A                           S01117
077290200529     C***********          TESTN          WRK6A      99                   S01117
077300200529     C************IN99     IFEQ '1'                                       S01117
077310200529     C***********          MOVELWRK6A     WRK6N   60                      S01117
077320200529     C***********WRK6N     CHAINCLINT                99                   S01117
077330200529     C**N99******RECI      COMP '*'                      99               S01117
077340200529     C***********                                                         S01117
077350200529     C****Else*read*SNAME*file******                                      S01117
077360200529     C***********                                                         S01117
077370200529     C***********          ELSE                                           S01117
077380200529     C***********SPFAC     CHAINSNAME                99                   S01117
077390200529     C**N99******RECI      COMP '*'                      99               S01117
077400200529     C***********          END                                            S01117
077410200529     C************IN99     IFEQ '1'                                       S01117
077420200529     C***********          MOVEL*BLANKS   KEY                             S01117
077430200529     C***********          MOVE '71'      TYPE                            S01117
077440200529     C***********          MOVELSPFAC     KCPN                            S01117
077450200529     C***********TABKEY    CHAINTABLET2F             99                   S01117
077460200529     C************IN99     IFEQ '0'                                       S01117
077470200529     C***********RECI      IFEQ '*'                                       S01117
077480200529     C***********          SETON                     99                   S01117
077490200529     C***********          END                                            S01117
077500200529     C***********          END                                            S01117
077510200529     C***********          END                                            S01117
077520200529     C************IN99     IFEQ '1'                                       S01117
077530200529     C*                                                                   S01117
077540200529     C**  Check Customer file for valid Customer number                   S01117
077550200529     C*                                                                   S01117
077560200529     C                     CALL 'AOCUSTR0'                                S01117
077570200529     C                     PARM *BLANKS   @RTCD                           S01117
077580200529     C                     PARM '*KEY   ' @OPTN                           S01117
077590200529     C                     PARM SPFAC     @KEY1                           S01117
077600200529     C                     PARM *BLANKS   @KYST                           S01117
077610200529     C           SDCUST    PARM SDCUST    DSSDY                           S01117
077620200529     C*                                                                   S01117
077630200529     C**  Invalid Entry                                                   S01117
077640200529     C*                                                                   S01117
077650200529     C           @RTCD     IFNE *BLANKS                                   S01117
077660200529     C*                                                                   S01117
077670200529     C**  Else check for valid nostro on Counterparty Nostro File         S01117
077680200529     C*                                                                   S01117
077690200529     C                     MOVELSPFAC     CPNST                           S01117
077700200529     C                     CALL 'AOCNSTR0'                                S01117
077710200529     C                     PARM *BLANKS   @RTCD                           S01117
077720200529     C                     PARM '*KEY   ' @OPTN                           S01117
077730200529     C                     PARM CPNST     @CPNC                           S01117
077740200529     C           SDCNST    PARM SDCNST    DSFDY                           S01117
077750200529     C*                                                                   S01117
077760200529     C           @RTCD     IFNE *BLANKS                                   S01117
077770200529     C                     ADD  1         EC         43
077780200529     C                     MOVEL' 217'    ERR,EC
077790200529     C                     END
077800200529     C                     END                                            S01117
077810200529     C*                                                                   S01117
077820200529     C                     END
077830200529     C                     END
077840200529     C*
077850200529     C**  TRANSLATE AND VALIDATE SPCHC (#ALPV) CHARGE CODE
077860200529     C**  (NON MANDATORY)
077870200529     C*
077880200529     C/COPY WNCPYSRC,SE0170C018
077890200529     C           SPCHC     IFNE *BLANKS
077900200529     C                     MOVELSPCHC     PCHC
077910200529     C                     MOVELSPCHC     CCDK    2
077920200529     C***********SECHGK    CHAINSECHG                99                   S01169
077930200529     C           SECGTK    CHAINSECGT                99                   S01169
077940200529     C           *IN99     IFEQ '0'
077950200529     C           RECI      IFEQ '*'
077960200529     C                     SETON                     99
077970200529     C                     END
077980200529     C                     END
077990200529     C           *IN99     IFEQ '1'
078000200529     C                     ADD  1         EC         45
078010200529     C                     MOVEL' 218'    ERR,EC
078020200529     C                     END
078030200529     C                     ELSE                                           174342
078040200529     C                     MOVE *BLANKS   PCHC                            174342
078050200529     C/COPY WNCPYSRC,SE0170C024
078060200529     C                     END
078070200529     C*
078080200529     C**  TRANSLATE AND VALIDATE SPCHA (#AMNT) CHARGE AMOUNT
078090200529     C*
078100200529     C**   MUST BE BLANK IF CHARGE CODE BLANK
078110200529     C*
078120200529     C/COPY WNCPYSRC,SE0170C025
078130200529     C           SPCHA     IFNE *BLANKS
078140200529     C           SPCHC     ANDEQ*BLANKS
078150200529     C                     ADD  1         EC         46    *
078160200529     C                     MOVEL' 219'    ERR,EC
078170200529     C                     END
078180200529     C*
078190200529     C**  MUST BE ENTERED AND VALID IF CHARGE CODE ENTERED
078200200529     C*
078210200529     C           SPCHA     IFEQ *BLANKS
078220200529     C           SPCHC     ANDNE*BLANKS
078230200529     C/COPY WNCPYSRC,SE0170C026
078240200529     C                     ADD  1         EC         46    *
078250200529     C                     MOVEL' 219'    ERR,EC
078260200529     C/COPY WNCPYSRC,SE0170C040
078270200529     C                     ELSE
078280200529     C***********          MOVE *BLANKS   KEY                             S01117
078290200529     C**********           MOVEL'20'      TYPE
078300200529     C**********           MOVE '1'       KEY
078310200529     C**********           MOVELSPNCY     KCCY2
078320200529     C********** TABKEY    CHAINTABTG10F             99
078330200529     C           S01509    IFEQ 'Y'                                       S01509
078340200529     C                     Z-ADDPOSCDP    ZSDEC                           S01509
078350200529     C           13        SUB  POSCDP    ZSDIG                           S01509
078360200529     C                     ELSE                                           S01509
078370200529     C                     Z-ADDNOMCDP    ZSDEC
078380200529     C           13        SUB  NOMCDP    ZSDIG
078390200529     C                     END                                            S01509
078400200529     C                     MOVE *BLANKS   ZFLD17
078410200529     C                     MOVELSPCHA     ZFLD17
078420200529     C                     EXSR ZASIGN
078430200529     C           *IN99     IFEQ '1'
078440200529     C                     ADD  1         EC         46    *
078450200529     C                     MOVEL' 220'    ERR,EC
078460200529     C                     ELSE
078470200529     C                     MOVE ZOUT15    PCHA
078480200529     C           ZFSIGN    IFEQ '-'
078490200529     C                     Z-SUBPCHA      PCHA
078500200529     C                     END
078510200529     C                     END
078520200529     C                     END
078530200529     C*
078540200529     C**  TRANSLATE AND VALIDATE SPCCD (#ALPV) COMMISSION CODE
078550200529     C*
078560200529     C/COPY WNCPYSRC,SE0170C019
078570200529     C           SPCCD     IFNE *BLANKS
078580200529     C                     MOVELSPCCD     PCCD
078590200529     C                     MOVELSPCCD     CCDK
078600200529     C***********SECHGK    CHAINSECHG                99                   S01169
078610200529     C           SECGTK    CHAINSECGT                99                   S01169
078620200529     C           *IN99     IFEQ '0'
078630200529     C           RECI      IFEQ '*'
078640200529     C                     SETON                     99
078650200529     C                     END
078660200529     C                     END
078670200529     C           *IN99     IFEQ '1'
078680200529     C                     ADD  1         EC         47    *
078690200529     C                     MOVEL' 221'    ERR,EC
078700200529     C                     END
078710200529     C           SPBCD     IFEQ *BLANKS                                   E30740
078720200529     C                     ADD  1         EC         35                   E30740
078730200529     C                     MOVEL' 501'    ERR,EC                          E30740
078740200529     C                     END                                            E30740
078750200529     C                     ELSE                                           174342
078760200529     C                     MOVE *BLANKS   PCCD                            174342
078770200529     C/COPY WNCPYSRC,SE0170C027
078780200529     C                     END
078790200529     C*
078800200529     C**  TRANSLATE AND VALIDATE SPCAM (#AMNT)
078810200529     C*
078820200529     C**  MUST BE BLANK IF COMMISSION CODE BLANK
078830200529     C*
078840200529     C/COPY WNCPYSRC,SE0170C028
078850200529     C           SPCAM     IFNE *BLANKS
078860200529     C           SPCCD     ANDEQ*BLANKS
078870200529     C                     ADD  1         EC         48    *
078880200529     C                     MOVEL' 222'    ERR,EC
078890200529     C                     END
078900200529     C*
078910200529     C**  MUST BE ENTERED IF COMMISSION CODE ENTERED
078920200529     C*
078930200529     C           SPCAM     IFEQ *BLANKS
078940200529     C           SPCCD     ANDNE*BLANKS
078950200529     C/COPY WNCPYSRC,SE0170C029
078960200529     C                     ADD  1         EC         48    *
078970200529     C                     MOVEL' 222'    ERR,EC
078980200529     C/COPY WNCPYSRC,SE0170C041
078990200529     C                     ELSE
079000200529     C           S01509    IFEQ 'Y'                                       S01509
079010200529     C                     Z-ADDPOSCDP    ZSDEC                           S01509
079020200529     C           13        SUB  POSCDP    ZSDIG                           S01509
079030200529     C                     ELSE                                           S01509
079040200529     C                     Z-ADDNOMCDP    ZSDEC
079050200529     C           13        SUB  NOMCDP    ZSDIG
079060200529     C                     END                                            S01509
079070200529     C                     MOVE *BLANKS   ZFLD17
079080200529     C                     MOVELSPCAM     ZFLD17
079090200529     C                     EXSR ZASIGN
079100200529     C           *IN99     IFEQ '1'
079110200529     C                     ADD  1         EC         48    *
079120200529     C                     MOVEL' 223'    ERR,EC
079130200529     C                     ELSE
079140200529     C                     MOVE ZOUT15    PCAM
079150200529     C           ZFSIGN    IFEQ '-'
079160200529     C                     Z-SUBPCAM      PCAM
079170200529     C                     END
079180200529     C                     END
079190200529     C                     END
079200200529     C/COPY WNCPYSRC,SE0170C030
079210200529      *                                                                   S01447
079220200529      *** Validate new tax deductible flds if tax withheld (S01447=ON)    S01447
079230200529      *                                                                   S01447
079240200529     C                     CLEARTASO                                      S01447
079250200529     C                     CLEARTASR                                      S01447
079260200529     C                     CLEARTAUS                                      S01447
079270200529     C           S01447    IFEQ 'Y'                        *B1            S01447
079280200529     C********** CSE023    ANDNE'Y'                                CSE023 186166
079290200529     C           WFREEM    ANDNE'Y'                                       186166
079300200529     C           STASO     IFNE *BLANKS                    *B2            S01447
079310200529     C           STASR     ORNE *BLANKS                                   S01447
079320200529     C           STAUS     ORNE *BLANKS                                   S01447
079330200529     C                     EXSR VALTAX                                    S01447
079340200529     C**********           ELSE                                    CSE023 186166
079350200529      *                                                            CSE023 186166
079360200529     C********** WFREEM    IFEQ 'Y'                                CSE023 186166
079370200529     C**********           EXSR WITHTX                             CSE023 186166
079380200529     C**********           ENDIF                                   CSE023 186166
079390200529      *                                                                   CSE023
079400200529     C                     END                             *E2            S01447
079410200529      *                                                                   CSE023
079420200529     C                     ELSE                                           CSE023
079430200529     C           WFREEM    IFEQ 'Y'                                       CSE023
079440200529     C           SPEVT     IFNE 'MT'                                      186166
079450200529     C           BFCLAS    OREQ 'S'                                       186166
079460200529     C           BFCLAS    OREQ 'D'                                       186166
079470200529     C                     EXSR WITHTX                                    CSE023
079480200529     C                     ELSE                                           186166
079490200529     C*                                                                   186166
079500200529     C           S01509    IFEQ 'N'                                       186166
079510200529     C                     Z-ADDNOMCDP    ZADEC                           186166
079520200529     C                     ELSE                                           186166
079530200529     C                     Z-ADDPOSCDP    ZADEC                           186166
079540200529     C                     ENDIF                                          186166
079550200529     C           13        SUB  ZADEC     ZADIG                           186166
079560200529     C                     MOVE *BLANK    ZFIELD                          186166
079570200529     C                     MOVELSTASO     ZFIELD                          186166
079580200529     C                     EXSR ZALIGN                                    186166
079590200529     C                     MOVE ZFIELD    TASO                            186166
079600200529     C*                                                                   186166
079610200529     C                     MOVE *BLANK    ZFIELD                          186166
079620200529     C                     MOVELSTASR     ZFIELD                          186166
079630200529     C                     EXSR ZALIGN                                    186166
079640200529     C                     MOVE ZFIELD    TASR                            186166
079650200529     C*                                                                   186166
079660200529     C                     MOVE *BLANK    ZFIELD                          186166
079670200529     C                     MOVELSTAUS     ZFIELD                          186166
079680200529     C                     EXSR ZALIGN                                    186166
079690200529     C                     MOVE ZFIELD    TAUS                            186166
079700200529     C                     ENDIF                                          186166
079710200529     C                     ENDIF                                          CSE023
079720200529      *                                                                   CSE023
079730200529     C                     END                             *E1            S01447
079740200529      *                                                                                       233711
079750200529      ** Validate EU Tax Amount.                                                              233711
079760200529      *                                                                                       233711
079770200529     C********** *IN75     IFEQ *ON                                                    233711 234471
079780200529     C           *IN78     IFEQ *ON                                                           234471
079790200529     C                     EXSR SRVTXN                                                        233711
079800200529     C                     ENDIF                                                              233711
079810200529      *                                                                   S01447
079820200529     C*                                                                   S01447
079830200529     C**  TRANSLATE AND VALIDATE SPSAT (#ALPV) SETTLEMENT AMOUNT
079840200529     C*
079850200529     C***********          Z-ADDCDP       ZSDEC                           S01117
079860200529     C***********13        SUB  CDP       ZSDIG                           S01117
079870200529     C*                                                                   055839
079880200529     C** Use settle CCY D.P for validation                                055839
079890200529     C*
079900200529     C***********          Z-ADDA6NBDP    ZSDEC                     S01117055839
079910200529     C***********13        SUB  A6NBDP    ZSDIG                     S01117055839
079920200529     C*                                                                   103634
079930200529     C                     Z-ADDSETCDP    ZSDEC                           103634
079940200529     C           13        SUB  SETCDP    ZSDIG                           103634
079950200529     C                     MOVE *BLANKS   ZFLD17                          103634
079960200529     C                     MOVELSPSAT     ZFLD17                          103634
079970200529     C                     EXSR ZASIGN                                    103634
079980200529     C                     MOVE ZOUT15    PSAT                            103634
079990200529     C/COPY WNCPYSRC,SE0170C044
080000200529     C*                                                                   S01512
080010200529     C** If S01512 is active, translation and validation of amount        S01512
080020200529     C** is bypassed since this would become an output field only         S01512
080030200529     C*                                                                   S01512
080040200529     C           S01512    IFEQ 'N'                                       S01512
080050200529     C                     Z-ADDSETCDP    ZSDEC                           055839
080060200529     C           13        SUB  SETCDP    ZSDIG                           055839
080070200529     C                     MOVE *BLANKS   ZFLD17
080080200529     C                     MOVELSPSAT     ZFLD17
080090200529     C                     EXSR ZASIGN
080100200529     C           *IN99     IFEQ '1'
080110200529     C                     ADD  1         EC         49
080120200529     C                     MOVEL' 224'    ERR,EC
080130200529     C                     ELSE
080140200529     C*                                                                   E18884
080150200529     C**  IF EXCHANGE RATE IS INVALID THEN DO NOT CALCULATE SETTLEMENT    E18884
080160200529     C**  AMOUNT.                                                         E18884
080170200529     C*                                                                   E18884
080180200529     C           *IN34     IFEQ '0'                                       E18884
080190200529     C                     MOVE ZOUT15    PSAT
080200200529     C           ZFSIGN    IFEQ '-'
080210200529     C                     Z-SUBPSAT      PSAT
080220200529     C                     END
080230200529     C*
080240200529     C**  SETTLEMENT AMOUNT MUST EQUAL AMOUNT DUE PLUS CHARGES
080250200529     C**  and commission if receipt else minus charges/comm
080260200529     C**  converted to settlement currency
080270200529     C*
080280200529     C*                                                                   S01447
080290200529      *** If tax withheld, then workout amount to be added/subtracted     S01447
080300200529      *** later                                                           S01447
080310200529      *                                                                   S01447
080320200529     C           S01447    IFEQ 'Y'                        *B1            S01447
080330200529     C           *IN70     ANDEQ'0'                                       S01447
080340200529     C           *IN72     ANDEQ'0'                                       S01447
080350200529     C           TASO      ADD  TAUS      TAXAMT 130                      S01447
080360200529     C                     ELSE                                           S01447
080370200529     C                     Z-ADD*ZERO     TAXAMT                          S01447
080380200529     C                     END                                            S01447
080390200529     C/COPY WNCPYSRC,SE0170C020
080400200529     C*                                                                   S01447
080410200529     C***********C1DI      IFEQ 'S'                                 E14881S01117
080420200529     C***********C1DI      OREQ 'D'                                 E14881S01117
080430200529     C           BFCLAS    IFEQ 'S'                                       S01117
080440200529     C           BFCLAS    OREQ 'D'                                       S01117
080450200529     C*                                                                   E14881
080460200529     C           SPPRE     IFEQ 'R'
080470200529     C*                                                                   S01408
080480200529     C/COPY WNCPYSRC,SE0170CVS1                                           S01408
080490200529     C*                                                                   S01408
080500200529     C           PAMD      ADD  PCHA      WRK130 130
080510200529     C           WRK130    ADD  PCAM      WRK130
080520200529     C           WRK130    ADD  TAXAMT    WRK130                          S01447
080530200529     C*                                                                   S01408
080540200529     C/COPY WNCPYSRC,SE0170CVS2                                           S01408
080550200529     C*                                                                   S01408
080560200529     C                     ELSE
080570200529     C*                                                                   S01408
080580200529     C/COPY WNCPYSRC,SE0170CVS3                                           S01408
080590200529     C*                                                                   S01408
080600200529     C           PAMD      SUB  PCHA      WRK130
080610200529     C           WRK130    SUB  PCAM      WRK130
080620200529     C           WRK130    SUB  TAXAMT    WRK130                          S01447
080630200529     C*                                                                   S01408
080640200529     C/COPY WNCPYSRC,SE0170CVS2                                           S01408
080650200529     C*                                                                   S01408
080660200529     C                     END
080670200529     C*                                                                   E14881
080680200529     C                     ELSE                                           E14881
080690200529     C*                                                                   E14881
080700200529     C           SPPRE     IFEQ 'R'                                       E14881
080710200529     C*                                                                   S01408
080720200529     C/COPY WNCPYSRC,SE0170CVS3                                           S01408
080730200529     C*                                                                   S01408
080740200529     C           PAMD      SUB  PCHA      WRK130                          E14881
080750200529     C           WRK130    SUB  PCAM      WRK130                          E14881
080760200529     C           WRK130    SUB  TAXAMT    WRK130                          S01447
080770200529     C*                                                                   S01408
080780200529     C/COPY WNCPYSRC,SE0170CVS2                                           S01408
080790200529     C*                                                                   S01408
080800200529     C                     ELSE                                           E14881
080810200529     C*                                                                   S01408
080820200529     C/COPY WNCPYSRC,SE0170CVS1                                           S01408
080830200529     C*                                                                   S01408
080840200529     C           PAMD      ADD  PCHA      WRK130                          E14881
080850200529     C           WRK130    ADD  PCAM      WRK130                          E14881
080860200529     C           WRK130    ADD  TAXAMT    WRK130                          S01447
080870200529     C*                                                                   S01408
080880200529     C/COPY WNCPYSRC,SE0170CVS2                                           S01408
080890200529     C*                                                                   S01408
080900200529     C                     END                                            E14881
080910200529     C                     END                                            E14881
080920200529     C/COPY WNCPYSRC,SE0170C021
080930200529     C                     Z-ADDWRK130    WRK203 203                      151506
080940200529     C*
080950200529     C** If S01509 is off, check settlement ccy against nominal ccy       S01509
080960200529     C*                                                                   S01509
080970200529     C           SETCDP    IFNE NOMCDP                                    055839
080980200529     C           S01509    ANDEQ'N'                                       S01509
080990200529     C           SETCDP    SUB  NOMCDP    ZPX     10                      055839
081000200529     C                     ADD  4         ZPX                             055839
081010200529     C           POWER,ZPX IFLT 1                          from d.p *LT   055839
081020200529     C***********WRK130    MULT POWER,ZPX WRK130            to d.p. 055839151506
081030200529     C           WRK130    MULT POWER,ZPX WRK203            to d.p.       151506
081040200529     C                     ELSE                            from d.p. *GT  055839
081050200529     C***********WRK130    MULT POWER,ZPX WRK130             to d.p 055839151506
081060200529     C           WRK130    MULT POWER,ZPX WRK203             to d.p.      151506
081070200529     C                     END                                            055839
081080200529     C                     END                                            055839
081090200529     C*
081100200529     C** If S01509 is active, check settlement ccy against due ccy        S01509
081110200529     C*                                                                   S01509
081120200529     C           SETCDP    IFNE POSCDP                                    S01509
081130200529     C           S01509    ANDEQ'Y'                                       S01509
081140200529     C           SETCDP    SUB  POSCDP    ZPX     10                      S01509
081150200529     C                     ADD  4         ZPX                             S01509
081160200529     C           POWER,ZPX IFLT 1                          from d.p *LT   S01509
081170200529     C***********WRK130    MULT POWER,ZPX WRK130            to d.p. S01509151506
081180200529     C           WRK130    MULT POWER,ZPX WRK203            to d.p.       151506
081190200529     C                     ELSE                            from d.p. *GT  S01509
081200200529     C***********WRK130    MULT POWER,ZPX WRK130             to d.p S01509151506
081210200529     C           WRK130    MULT POWER,ZPX WRK203 203         to d.p.      151506
081220200529     C                     END                                            S01509
081230200529     C                     END                                            S01509
081240200529      *                                                                   055839
081250200529     C           PMDI      IFEQ 'M'
081260200529     C***********WRK130    MULT PSXR      WRK130                          151506
081270200529     C           WRK203    MULT PSXR      WRK130    H                     151506
081280200529     C                     ELSE
081290200529     C           PMDI      IFEQ 'D'
081300200529     C***********WRK130    DIV  PSXR      WRK130    H                     151506
081310200529     C           WRK203    DIV  PSXR      WRK130    H                     151506
081320200529     C                     END
081330200529     C                     END
081340200529     C/COPY WNCPYSRC,SE0170C005
081350200529     C********** PSAT      IFNE WRK130                                                        235250
081360200529     C**********           ADD  1         EC         49                                       235250
081370200529     C**********           MOVEL' 224'    ERR,EC                                              235250
081380200529     C**********           END                                                                235250
081390200529     C/COPY WNCPYSRC,SE0170C006
081400200529     C                     END                                            E18884
081410200529     C                     END
081420200529     C                     END                                            S01512
081430200529     C*
081440200529     C**  TRANSLATE AND VALIDATE SPSPI (#ALPV) SPECIAL INSTRUCTIONS
081450200529     C*
081460200529     C                     MOVELSPSPI     PSPI
081470200529     C*                                                                   S01412
081480200529     C** Validate the format of the special instruction field             S01412
081490200529     C** for an electronic pay settlement method                          S01412
081500200529     C*                                                                   S01412
081510200529     C           SPSPI     IFNE *BLANKS                                   S01412
081520200529     C           SPSMT     IFEQ '01'                                      S01412
081530200529     C           SPSMT     OREQ '08'                                      S01412
081540200529     C                     MOVEA*BLANKS   SIL                             S01412
081550200529     C                     MOVEASPSPI     SIL                             S01412
081560200529     C                     EXSR SEPTVS                                    S01412
081570200529     C           CUL       IFEQ 'E'                                       S01412
081580200529     C                     ADD  1         EC         44                   S01412
081590200529     C                     MOVEL' 253'    ERR,EC                          S01412
081600200529     C                     END                                            S01412
081610200529     C           CUL       IFEQ 'X'                                       CSW096
081620200529     C                     ADD  1         EC                              CSW096
081630200529     C                     MOVE ' 254'    ERR,EC                          CSW096
081640200529     C                     MOVE '1'       *IN44                           CSW096
081650200529     C                     ENDIF                                          CSW096
081660200529     C                     END                                            S01412
081670200529     C                     END                                            S01412
081680200529     C*
081690200529     C                     ELSE
081700200529     C*
081710200529     C**  IF ACTION=D WITH ENTER PRESSED THEN ERROR
081720200529     C*
081730200529     C           ACTN      IFEQ 'D'
081740200529     C           ACTN      OREQ 'R'                                       186400
081750200529     C                     MOVELINF,10    INFMSG
081760200529     C                     END
081770200529     C                     END
081780200529     C                     ELSE
081790200529     C*
081800200529     C**  IF COMMAND 10 TAKEN
081810200529     C*
081820200529     C           AID       IFEQ '04'
081830200529     C*
081840200529     C**  COMMAND 10 TAKEN CORRECTLY WHEN ACTION IS D-FORCE 'RECORD
081850200529     c**  ADVANCE'
081860200529     C*
081870200529     C           ACTN      IFEQ 'D'
081880200529     C           ACTN      OREQ 'R'                                       186400
081890200529     C                     MOVEL'RA'      AID
081900200529     C*
081910200529     C** COMMAND 10 TAKEN INCORRECTLY WHEN ACTION IS NOT D-HENCE ERROR
081920200529     C*
081930200529     C                     ELSE
081940200529     C                     MOVELINF,11    INFMSG
081950200529     C                     END
081960200529     C                     END
081970200529     C*
081980200529     C                     END
081990200529      *                                                                                       CER049
082000200529     C           CER049    IFEQ 'Y'                                                           CER049
082010200529     C                     CALL 'AOBRCHR2'                                                    CER049
082020200529     C                     PARM *BLANKS   @RTCD                                               CER049
082030200529     C                     PARM '*KEY   ' @OPTN                                               CER049
082040200529     C**********           PARM SPSEB     @DSNB                                      CER049 AR851784
082050200529     C                     PARM SPBCA     @DSNB                                             AR851784
082060200529     C           SDBRCE    PARM SDBRCE    DSSDY                                               CER049
082070200529     C           @RTCD     IFEQ *BLANKS                                                       CER049
082080200529     C                     MOVE BXTAX     WSTAX                                               CER049
082090200529     C                     ENDIF                                                              CER049
082100200529      *                                                                                       CER049
082110200529     C                     CALL 'AOCUSTR0'                                                    CER049
082120200529     C                     PARM *BLANKS   @RTCD                                               CER049
082130200529     C                     PARM '*KEY   ' @OPTN                                               CER049
082140200529     C                     PARM SPCPY     @KEY1                                               CER049
082150200529     C                     PARM *BLANKS   @KYST                                               CER049
082160200529     C           SDCUST    PARM SDCUST    DSSDY                                               CER049
082170200529     C           @RTCD     IFEQ *BLANKS                                                       CER049
082180200529     C                     CALL 'AOBRCHR2'                                                    CER049
082190200529     C                     PARM *BLANKS   @RTCD                                               CER049
082200200529     C                     PARM '*KEY   ' @OPTN                                               CER049
082210200529     C                     PARM BBBRCD    @DSNB                                               CER049
082220200529     C           SDBRCE    PARM SDBRCE    DSSDY                                               CER049
082230200529     C           @RTCD     IFEQ *BLANKS                                                       CER049
082240200529     C                     MOVELSPCPY     SPCPY6  6                                        AR851784A
082250200529     C           SPCPY6    CHAINSDCUSQL0             99                                    AR851784A
082260200529     C           *IN99     IFEQ '0'                                                        AR851784A
082270200529     C**********           MOVE BXTAX     WCTAX                                     CER049 AR851784A
082280200529     C                     MOVE CQTAX     WCTAX                                            AR851784A
082290200529     C                     ENDIF                                                           AR851784A
082300200529     C                     ENDIF                                                              CER049
082310200529     C                     ENDIF                                                              CER049
082320200529      *                                                                                       CER049
082330200529      ** Default Stamp Tax Liable                                                             CER049
082340200529      *                                                                                       CER049
082350200529     C           WSTAX     IFEQ 'Y'                                                           CER049
082360200529     C           WCTAX     ANDEQ'Y'                                                           CER049
082370200529     C           SPTAXL    ANDEQ*BLANK                                                        CER049
082380200529     C                     MOVE 'Y'       SPTAXL                                              CER049
082390200529     C                     ENDIF                                                              CER049
082400200529      *                                                                                       CER049
082410200529     C           SPTAXL    IFNE 'N'                                                           CER049
082420200529     C           SPTAXL    ANDNE'Y'                                                           CER049
082430200529     C                     ADD  1         EC         67                                       CER049
082440200529     C                     MOVEL' 232'    ERR,EC                                              CER049
082450200529     C                     ENDIF                                                              CER049
082460200529      *                                                                                       CER049
082470200529     C           P3TAX     IFEQ 'N'                                                           CER049
082480200529     C           SPTAXL    ANDEQ'Y'                                                           CER049
082490200529      *                                                                                       CER049
082500200529     C           WSTAX     IFNE 'Y'                                                           CER049
082510200529     C                     ADD  1         EC         67                                       CER049
082520200529     C                     MOVEL' 233'    ERR,EC                                              CER049
082530200529     C                     ENDIF                                                              CER049
082540200529     C           WCTAX     IFNE 'Y'                                                           CER049
082550200529     C                     ADD  1         EC         67                                       CER049
082560200529     C                     MOVEL' 234'    ERR,EC                                              CER049
082570200529     C                     ENDIF                                                              CER049
082580200529     C                     ENDIF                                                              CER049
082590200529      *                                                                                       CER049
082600200529     C           *IN67     IFEQ '0'                                                           CER049
082610200529     C                     EXSR SRSTAX                                                        CER049
082620200529     C                     ENDIF                                                              CER049
082630200529      *                                                                                       CER049
082640200529     C                     ENDIF                                                              CER049
082650200529     C*
082660200529     C**  ERROR ON SCREEN SO HIGHLIGHT ERROR CODES
082670200529     C*
082680200529     C           EC        IFNE *ZERO
082690200529     C                     MOVELHI        ERRMSG
082700200529     C                     END
082710200529     C*                                                                   CEU005
082720200529     C** If CEU005 is on check for EURO Currency.                         CEU005
082730200529     C*                                                                   CEU005
082740200529     C           CEU005    IFEQ 'Y'                                       CEU005
082750200529     C           SPNCY     ANDEQBKEURO                                    CEU005
082760200529     C                     CALL 'AOCURRR0'                                CEU005
082770200529     C                     PARM *BLANKS   @RTCD                           CEU005
082780200529     C                     PARM '*KEY   ' @OPTN                           CEU005
082790200529     C                     PARM SPSCU     @AJCD                           CEU005
082800200529     C           SDCURR    PARM SDCURR    DSSDY                           CEU005
082810200529     C           @RTCD     IFNE *BLANKS                                   CEU005
082820200529     C                     MOVEL'SDCURRPD'DBFILE           ***************CEU005
082830200529     C                     MOVEL'022'     DBASE            * DBERROR 022 *CEU005
082840200529     C                     MOVELSPSCU     DBKEY            ***************CEU005
082850200529     C                     EXSR *PSSR                                     CEU005
082860200529     C                     END                                            CEU005
082870200529     C*                                                                   CEU005
082880200529     C** If the due currency is the EURO currency and the settlement      CEU005
082890200529     C** currency is 'in', the exchange rate should be equal to the EURO  143690
082900200529     C** rate & M/D indicator should be reversed.                         143690
082910200529     C***currency*is*'in',*the*exchange*rate*&*mult/div*indicator  CEU005 143690
082920200529     C***should*be*equal*to*the*EURO*rate*&*mult/div*indicator.    CEU005 143690
082930200529     C*                                                                   CEU005
082940200529     C           A6INCY    IFEQ 'Y'                                       CEU005
082950200529     C           RUND      ANDGEA6TPSD                                    CEU005
082960200529     C                     Z-ADD8         ZADEC                           CEU005
082970200529     C                     Z-ADD5         ZADIG                           CEU005
082980200529     C                     MOVE *BLANKS   ZFIELD                          CEU005
082990200529     C                     MOVELSPSXR     ZFIELD                          CEU005
083000200529     C                     EXSR ZALIGN                                    CEU005
083010200529     C           *LIKE     DEFN A6EUER    NUMEXC                          CEU005
083020200529     C                     MOVE ZFIELD    NUMEXC                          CEU005
083030200529     C           A6EUER    IFNE NUMEXC                                    CEU005
083040200529     C                     ADD  1         EC                              CEU005
083050200529     C                     SETON                     34                   CEU005
083060200529     C                     MOVEL' 228'    ERR,EC                          CEU005
083070200529     C                     END                                            CEU005
083080200529     C***********SPMDI     IFNE A6EUMD                             CEU005 143690
083090200529     C           SPMDI     IFEQ A6EUMD                                    143690
083100200529     C                     ADD  1         EC         51                   CEU005
083110200529     C                     MOVEL' 229'    ERR,EC                          CEU005
083120200529     C                     END                                            CEU005
083130200529     C                     ENDIF                                          CEU005
083140200529     C                     ENDIF                                          CEU005
083150200529     C*                                                                   CEU005
083160200529     C           CEU005    IFEQ 'Y'                                       CEU005
083170200529     C           SPSCU     ANDEQBKEURO                                    CEU005
083180200529     C                     CALL 'AOCURRR0'                                CEU005
083190200529     C                     PARM *BLANKS   @RTCD                           CEU005
083200200529     C                     PARM '*KEY   ' @OPTN                           CEU005
083210200529     C                     PARM SPNCY     @AJCD                           CEU005
083220200529     C           SDCURR    PARM SDCURR    DSSDY                           CEU005
083230200529     C           @RTCD     IFNE *BLANKS                                   CEU005
083240200529     C                     MOVEL'SDCURRPD'DBFILE           ***************CEU005
083250200529     C                     MOVEL'023'     DBASE            * DBERROR 023 *CEU005
083260200529     C                     MOVELSPNCY     DBKEY            ***************CEU005
083270200529     C                     EXSR *PSSR                                     CEU005
083280200529     C                     END                                            CEU005
083290200529     C*                                                                   CEU005
083300200529     C** If the settlement currency is the EURO currency and the due      CEU005
083310200529     C** currency is 'in', the exchange rate & mult/div indicator         CEU005
083320200529     C** should be equal to the EURO rate & M/D indicator.                143690
083330200529     C***should*be*equal*to*the*EURO*rate*&*reversed*mult/div      CEU005 143690
083340200529     C***indicator.                                                CEU005 143690
083350200529     C*                                                                   CEU005
083360200529     C           A6INCY    IFGE 'Y'                                       CEU005
083370200529     C           RUND      ANDGEA6TPSD                                    CEU005
083380200529     C                     Z-ADD8         ZADEC                           CEU005
083390200529     C                     Z-ADD5         ZADIG                           CEU005
083400200529     C                     MOVE *BLANKS   ZFIELD                          CEU005
083410200529     C                     MOVELSPSXR     ZFIELD                          CEU005
083420200529     C                     EXSR ZALIGN                                    CEU005
083430200529     C                     MOVE ZFIELD    NUMEXC                          CEU005
083440200529     C           A6EUER    IFNE NUMEXC                                    CEU005
083450200529     C                     ADD  1         EC                              CEU005
083460200529     C                     SETON                     34                   CEU005
083470200529     C                     MOVEL' 228'    ERR,EC                          CEU005
083480200529     C                     END                                            CEU005
083490200529     C***********A6EUMD    IFEQ 'M'                                CEU005 143690
083500200529     C***********SPMDI     ANDNE'D'                                CEU005 143690
083510200529     C***********A6EUMD    OREQ 'D'                                CEU005 143690
083520200529     C***********SPMDI     ANDNE'M'                                CEU005 143690
083530200529     C           SPMDI     IFNE A6EUMD                                    143690
083540200529     C                     ADD  1         EC         51                   CEU005
083550200529     C                     MOVEL' 229'    ERR,EC                          CEU005
083560200529     C                     END                                            CEU005
083570200529     C                     ENDIF                                          CEU005
083580200529     C                     ENDIF                                          CEU005
083590200529     C*
083600200529     C                     ENDSR
083610200529     C*
083620200529     C*****************************************************************
083630200529      /EJECT
083640200529     C*****************************************************************   S01447
083650200529      *                                                               *   S01447
083660200529      *  VALTAX  - Validate Tax deductible screen amounts             *   S01447
083670200529      *                                                               *   S01447
083680200529      *  CALLED FROM: VALIDD                                          *   S01447
083690200529      *                                                               *   S01447
083700200529      *  CALLS: ZALIGN                                                *   S01447
083710200529      *                                                               *   S01447
083720200529      *****************************************************************   S01447
083730200529      *                                                                   S01447
083740200529     C           VALTAX    BEGSR                                          S01447
083750200529      *                                                                   S01447
083760200529      *** Validate Tax amount deductible at source                        S01447
083770200529      ** If S01509 is active, use decimal places from due ccy             S01509
083780200529      *                                                                   S01447
083790200529     C           S01509    IFEQ 'Y'                                       S01509
083800200529     C                     Z-ADDPOSCDP    ZADEC                           S01509
083810200529     C           13        SUB  POSCDP    ZADIG                           S01509
083820200529     C                     ELSE                                           S01509
083830200529     C                     Z-ADDNOMCDP    ZADEC                           S01447
083840200529     C           13        SUB  NOMCDP    ZADIG                           S01447
083850200529     C                     END                                            S01509
083860200529     C                     CLEARZFIELD                                    S01447
083870200529     C                     MOVELSTASO     ZFIELD                          S01447
083880200529     C                     EXSR ZALIGN                                    S01447
083890200529     C           *IN99     IFEQ '1'                        *B1            S01447
083900200529     C                     ADD  1         EC         70                   S01447
083910200529     C                     MOVEL' 240'    ERR,EC                          S01447
083920200529     C                     ELSE                            *X1            S01447
083930200529     C                     MOVE ZFIELD    TASO                            S01447
083940200529     C           ZFSIGN    IFEQ '-'                        *B2            S01447
083950200529     C                     Z-SUBTASO      TASO                            S01447
083960200529     C                     END                             *E2            S01447
083970200529     C                     END                             *E1            S01447
083980200529      *                                                                   S01447
083990200529      *** Validate Tax amount deductible at source - refundable           S01447
084000200529      ** If S01509 is active, use decimal places from due ccy             S01509
084010200529      *                                                                   S01447
084020200529     C           S01509    IFEQ 'Y'                                       S01509
084030200529     C                     Z-ADDPOSCDP    ZADEC                           S01509
084040200529     C           13        SUB  POSCDP    ZADIG                           S01509
084050200529     C                     ELSE                                           S01509
084060200529     C                     Z-ADDNOMCDP    ZADEC                           S01447
084070200529     C           13        SUB  NOMCDP    ZADIG                           S01447
084080200529     C                     END                                            S01509
084090200529     C                     CLEARZFIELD                                    S01447
084100200529     C                     MOVELSTASR     ZFIELD                          S01447
084110200529     C                     EXSR ZALIGN                                    S01447
084120200529     C           *IN99     IFEQ '1'                        *B1            S01447
084130200529     C                     ADD  1         EC         71                   S01447
084140200529     C                     MOVEL' 241'    ERR,EC                          S01447
084150200529     C                     ELSE                            *X1            S01447
084160200529     C                     MOVE ZFIELD    TASR                            S01447
084170200529     C           ZFSIGN    IFEQ '-'                        *B2            S01447
084180200529     C                     Z-SUBTASR      TASR                            S01447
084190200529     C                     END                             *E2            S01447
084200200529     C                     END                             *E1            S01447
084210200529      *                                                                   S01447
084220200529      *** Validate Tax amount deducted by user                            S01447
084230200529      ** If S01509 is active, use decimal places from due ccy             S01509
084240200529      *                                                                   S01447
084250200529     C           S01509    IFEQ 'Y'                                       S01509
084260200529     C                     Z-ADDPOSCDP    ZADEC                           S01509
084270200529     C           13        SUB  POSCDP    ZADIG                           S01509
084280200529     C                     ELSE                                           S01509
084290200529     C                     Z-ADDNOMCDP    ZADEC                           S01447
084300200529     C           13        SUB  NOMCDP    ZADIG                           S01447
084310200529     C                     END                                            S01509
084320200529     C                     CLEARZFIELD                                    S01447
084330200529     C                     MOVELSTAUS     ZFIELD                          S01447
084340200529     C                     EXSR ZALIGN                                    S01447
084350200529     C           *IN99     IFEQ '1'                        *B1            S01447
084360200529     C                     ADD  1         EC         72                   S01447
084370200529     C                     MOVEL' 242'    ERR,EC                          S01447
084380200529     C                     ELSE                            *X1            S01447
084390200529     C                     MOVE ZFIELD    TAUS                            S01447
084400200529     C           ZFSIGN    IFEQ '-'                        *B2            S01447
084410200529     C                     Z-SUBTAUS      TAUS                            S01447
084420200529     C                     END                             *E2            S01447
084430200529     C                     END                             *E1            S01447
084440200529      *                                                                   S01447
084450200529      *** Error if Tax amount deducted at source is greater than amt      S01447
084460200529      *** due.                                                            S01447
084470200529      *                                                                   S01447
084480200529     C           *IN70     IFEQ '0'                        *B1            S01447
084490200529     C           *IN50     ANDEQ'0'                                       S01447
084500200529     C           TASO      ANDGTPAMD                                      S01447
084510200529     C                     ADD  1         EC         70                   S01447
084520200529     C                     MOVEL' 243'    ERR,EC                          S01447
084530200529     C                     END                             *E1            S01447
084540200529      *                                                                   S01447
084550200529     C                     ENDSR
084560200529      *****************************************************************                       233711
084570200529      /EJECT                                                                                  233711
084580200529      *****************************************************************                       233711
084590200529      *                                                               *                       233711
084600200529      * SRVTXN - Validate EU Tax amount.                              *                       233711
084610200529      *                                                               *                       233711
084620200529      *****************************************************************                       233711
084630200529     C           SRVTXN    BEGSR                                                              233711
084640200529      *                                                                                       233711
084650200529      ** EU Tax Amount Deducted - At Source                                                   233711
084660200529      *                                                                                       233711
084670200529     C           S01509    IFEQ 'Y'                                                           233711
084680200529     C                     Z-ADDPOSCDP    ZADEC                                               233711
084690200529     C           13        SUB  POSCDP    ZADIG                                               233711
084700200529     C                     MOVE POSCCY    WCCY    3                                           233711
084710200529     C                     ELSE                                                               233711
084720200529     C                     Z-ADDNOMCDP    ZADEC                                               233711
084730200529     C           13        SUB  NOMCDP    ZADIG                                               233711
084740200529     C                     MOVE NOMCCY    WCCY                                                233711
084750200529     C                     ENDIF                                                              233711
084760200529      *                                                                                       233711
084770200529     C                     MOVE *BLANKS   ZFIELD                                              233711
084780200529     C                     MOVELSTXNM     ZFIELD                                              233711
084790200529     C                     EXSR ZALIGN                                                        233711
084800200529      *                                                                                       233711
084810200529     C           *IN99     IFEQ *ON                                                           233711
084820200529     C                     ADD  1         EC                                                  233711
084830200529     C                     MOVE *ON       *IN76                                               233711
084840200529     C                     MOVEL' 801'    ERR,EC                                              233711
084850200529     C                     GOTO EVTXN                                                         233711
084860200529     C                     ENDIF                                                              233711
084870200529      *                                                                                       233711
084880200529     C                     MOVE ZFIELD    TXNM                                                233711
084890200529     C           ZFSIGN    IFEQ '-'                                                           233711
084900200529     C                     Z-SUBTXNM      TXNM                                                233711
084910200529     C                     ENDIF                                                              233711
084920200529      *                                                                                       233711
084930200529      ** EU Tax Amount in Settlement Currency                                                 233711
084940200529      *                                                                                       233711
084950200529     C           SPSCU     IFNE *BLANKS                                                       233711
084960200529     C           *IN37     ANDEQ*OFF                                                          233711
084970200529      *                                                                                       233711
084980200529     C           WCCY      IFEQ PSCU                                                          233711
084990200529     C                     Z-ADDTXNM      TXST                                                233711
085000200529     C                     ELSE                                                               233711
085010200529      *                                                                                       233711
085020200529     C                     MOVE WCCY      PCCY                                                233711
085030200529     C                     EXSR SRCURR                                                        233711
085040200529     C                     Z-ADDA6SPRT    ZRATE1 138                                          233711
085050200529     C                     MOVE A6MDIN    ZMDI1   1                                           233711
085060200529     C                     MOVE A6NBDP    ZCDPI                                               233711
085070200529      *                                                                                       233711
085080200529     C                     MOVE PSCU      PCCY                                                233711
085090200529     C                     EXSR SRCURR                                                        233711
085100200529     C                     Z-ADDA6SPRT    ZRATE2 138                                          233711
085110200529     C                     MOVE A6MDIN    ZMDI2   1                                           233711
085120200529     C                     MOVE A6NBDP    ZCDPO                                               233711
085130200529      *                                                                                       233711
085140200529     C                     EXSR ZXRATE                                                        233711
085150200529      *                                                                                       233711
085160200529     C                     Z-ADDTXNM      ZAMTCI                                              233711
085170200529     C                     Z-ADDZRATEX    ZEXCH                                               233711
085180200529     C                     MOVE ZMDIX     ZMD                                                 233711
085190200529     C                     MOVE WCCY      ZCCYI                                               233711
085200200529     C                     MOVE PSCU      ZCCYO                                               233711
085210200529      *                                                                                       233711
085220200529     C                     EXSR ZCONV                                                         233711
085230200529     C                     Z-ADDZAMTCO    TXST                                                233711
085240200529     C                     ENDIF                                                              233711
085250200529      *                                                                                       233711
085260200529     C                     ENDIF                                                              233711
085270200529      *                                                                                       233711
085280200529      ** Get tax currency if necessary.                                                       233711
085290200529      *                                                                                       233711
085300200529     C           TXCY      IFEQ *BLANKS                                                       233711
085310200529      *                                                                                       233711
085320200529     C                     MOVE PBCA      PBRCH                                               233711
085330200529     C                     EXSR SRBRCH                                                        233711
085340200529     C                     MOVE A8LCCD    PLOCN                                               233711
085350200529     C                     EXSR SRLOCN                                                        233711
085360200529     C                     MOVE DVCNCD    PCTRY                                               233711
085370200529     C                     EXSR SRCTRY                                                        233711
085380200529      *                                                                                       233711
085390200529     C           A4TXCY    IFNE *BLANKS                                                       233711
085400200529     C                     MOVE A4TXCY    TXCY                                                233711
085410200529     C                     ELSE                                                               233711
085420200529     C                     MOVE WCCY      TXCY                                                233711
085430200529     C                     ENDIF                                                              233711
085440200529      *                                                                                       233711
085450200529     C                     ENDIF                                                              233711
085460200529      *                                                                                       233711
085470200529      ** EU Tax Amount in Tax Currency                                                        233711
085480200529      *                                                                                       233711
085490200529     C           WCCY      IFEQ TXCY                                                          233711
085500200529     C                     Z-ADDTXNM      TAXA                                                233711
085510200529     C                     ELSE                                                               233711
085520200529      *                                                                                       233711
085530200529     C                     MOVE WCCY      PCCY                                                233711
085540200529     C                     EXSR SRCURR                                                        233711
085550200529     C                     Z-ADDA6SPRT    ZRATE1 138                                          233711
085560200529     C                     MOVE A6MDIN    ZMDI1   1                                           233711
085570200529     C                     MOVE A6NBDP    ZCDPI                                               233711
085580200529      *                                                                                       233711
085590200529     C                     MOVE TXCY      PCCY                                                233711
085600200529     C                     EXSR SRCURR                                                        233711
085610200529     C                     Z-ADDA6SPRT    ZRATE2 138                                          233711
085620200529     C                     MOVE A6MDIN    ZMDI2   1                                           233711
085630200529     C                     MOVE A6NBDP    ZCDPO                                               233711
085640200529      *                                                                                       233711
085650200529     C                     EXSR ZXRATE                                                        233711
085660200529      *                                                                                       233711
085670200529     C                     Z-ADDTXNM      ZAMTCI                                              233711
085680200529     C                     Z-ADDZRATEX    ZEXCH                                               233711
085690200529     C                     MOVE ZMDIX     ZMD                                                 233711
085700200529     C                     MOVE WCCY      ZCCYI                                               233711
085710200529     C                     MOVE TXCY      ZCCYO                                               233711
085720200529      *                                                                                       233711
085730200529     C                     EXSR ZCONV                                                         233711
085740200529     C                     Z-ADDZAMTCO    TAXA                                                233711
085750200529     C                     ENDIF                                                              233711
085760200529      *                                                                                       233711
085770200529     C           EVTXN     ENDSR                                                              233711
085780200529      *****************************************************************                       233711
085790200529      /EJECT                                                                                  233711
085800200529      *****************************************************************                       233711
085810200529      *                                                               *                       233711
085820200529      *  SRBRCH - Gets branch details.                                *                       233711
085830200529      *                                                               *                       233711
085840200529      *****************************************************************                       233711
085850200529     C           SRBRCH    BEGSR                                                              233711
085860200529      *                                                                                       233711
085870200529     C                     CALL 'AOBRCHR0'                                                    233711
085880200529     C                     PARM *BLANKS   PRTCD                                               233711
085890200529     C                     PARM '*KEY   ' POPTN                                               233711
085900200529     C                     PARM           PBRCH   3                                           233711
085910200529     C           SDBRCH    PARM SDBRCH    DSFDY                                               233711
085920200529      *                                                                                       233711
085930200529     C           PRTCD     IFNE *BLANKS                                                       233711
085940200529     C           *LOCK     IN   LDA                                                           233711
085950200529     C                     MOVEL'SDBRCHPD'DBFILE                                              233711
085960200529     C                     MOVELPBRCH     DBKEY                                               233711
085970200529     C                     Z-ADD102       DBASE                                               233711
085980200529     C                     OUT  LDA                                                           233711
085990200529     C                     MOVE *ON       *INU7                                               233711
086000200529     C                     MOVE *ON       *INU8                                               233711
086010200529     C                     MOVE *ON       *INLR                                               233711
086020200529     C                     EXSR *PSSR                                                         233711
086030200529     C                     ENDIF                                                              233711
086040200529      *                                                                                       233711
086050200529     C                     ENDSR                                                              233711
086060200529      *****************************************************************                       233711
086070200529      /EJECT                                                                                  233711
086080200529      *****************************************************************                       233711
086090200529      *                                                               *                       233711
086100200529      *  SRLOCN - Gets location details.                              *                       233711
086110200529      *                                                               *                       233711
086120200529      *****************************************************************                       233711
086130200529     C           SRLOCN    BEGSR                                                              233711
086140200529      *                                                                                       233711
086150200529     C                     CALL 'AOLOCNR0'                                                    233711
086160200529     C                     PARM *BLANKS   PRTCD                                               233711
086170200529     C                     PARM '*KEY   ' POPTN                                               233711
086180200529     C                     PARM           PLOCN   3                                           233711
086190200529     C           SDLOCN    PARM SDLOCN    DSFDY                                               233711
086200200529      *                                                                                       233711
086210200529     C           PRTCD     IFNE *BLANKS                                                       233711
086220200529     C           *LOCK     IN   LDA                                                           233711
086230200529     C                     MOVEL'SDLOCNPD'DBFILE                                              233711
086240200529     C                     MOVELPLOCN     DBKEY                                               233711
086250200529     C                     Z-ADD103       DBASE                                               233711
086260200529     C                     OUT  LDA                                                           233711
086270200529     C                     MOVE *ON       *INU7                                               233711
086280200529     C                     MOVE *ON       *INU8                                               233711
086290200529     C                     MOVE *ON       *INLR                                               233711
086300200529     C                     EXSR *PSSR                                                         233711
086310200529     C                     ENDIF                                                              233711
086320200529      *                                                                                       233711
086330200529     C                     ENDSR                                                              233711
086340200529      *****************************************************************                       233711
086350200529      /EJECT                                                                                  233711
086360200529      *****************************************************************                       233711
086370200529      *                                                               *                       233711
086380200529      *  SRCTRY - Gets country details.                               *                       233711
086390200529      *                                                               *                       233711
086400200529      *****************************************************************                       233711
086410200529     C           SRCTRY    BEGSR                                                              233711
086420200529      *                                                                                       233711
086430200529     C                     CALL 'AOCTRYR0'                                                    233711
086440200529     C                     PARM *BLANKS   PRTCD                                               233711
086450200529     C                     PARM '*KEY   ' POPTN                                               233711
086460200529     C                     PARM           PCTRY   2                                           233711
086470200529     C           SDCTRY    PARM SDCTRY    DSFDY                                               233711
086480200529      *                                                                                       233711
086490200529     C           PRTCD     IFNE *BLANKS                                                       233711
086500200529     C           *LOCK     IN   LDA                                                           233711
086510200529     C                     MOVEL'SDCTRYPD'DBFILE                                              233711
086520200529     C                     MOVELPCTRY     DBKEY                                               233711
086530200529     C                     Z-ADD104       DBASE                                               233711
086540200529     C                     OUT  LDA                                                           233711
086550200529     C                     MOVE *ON       *INU7                                               233711
086560200529     C                     MOVE *ON       *INU8                                               233711
086570200529     C                     MOVE *ON       *INLR                                               233711
086580200529     C                     EXSR *PSSR                                                         233711
086590200529     C                     ENDIF                                                              233711
086600200529      *                                                                                       233711
086610200529     C                     ENDSR                                                              233711
086620200529      *****************************************************************                       233711
086630200529      /EJECT                                                                                  233711
086640200529      *****************************************************************                       233711
086650200529      *                                                               *                       233711
086660200529      *  SRCURR - Gets currency details.                              *                       233711
086670200529      *                                                               *                       233711
086680200529      *****************************************************************                       233711
086690200529     C           SRCURR    BEGSR                                                              233711
086700200529      *                                                                                       233711
086710200529     C                     CALL 'AOCURRR0'                                                    233711
086720200529     C                     PARM *BLANKS   PRTCD                                               233711
086730200529     C                     PARM '*KEY   ' POPTN                                               233711
086740200529     C                     PARM           PCCY    3                                           233711
086750200529     C           SDCURR    PARM SDCURR    DSSDY                                               233711
086760200529      *                                                                                       233711
086770200529     C           PRTCD     IFNE *BLANKS                                                       233711
086780200529     C           *LOCK     IN   LDA                                                           233711
086790200529     C                     MOVEL'SDCURRPD'DBFILE                                              233711
086800200529     C                     MOVELPCCY      DBKEY                                               233711
086810200529     C                     Z-ADD105       DBASE                                               233711
086820200529     C                     OUT  LDA                                                           233711
086830200529     C                     MOVE *ON       *INU7                                               233711
086840200529     C                     MOVE *ON       *INU8                                               233711
086850200529     C                     MOVE *ON       *INLR                                               233711
086860200529     C                     EXSR *PSSR                                                         233711
086870200529     C                     ENDIF                                                              233711
086880200529      *                                                                                       233711
086890200529     C                     ENDSR                                                              233711
086900200529      *****************************************************************                       233711
086910200529      *                                                                   S01447
086920200529     C*****************************************************************   S01447
086930200529      /EJECT                                                              S01447
086940200529      *****************************************************************   CSE023
086950200529      *                                                               *   CSE023
086960200529      *  WITHTX - Calculate withholding tax.                          *   CSE023
086970200529      *                                                               *   CSE023
086980200529      *  CALLED FROM: VALIDD                                          *   CSE023
086990200529      *                                                               *   CSE023
087000200529      *  CALLS: CLDAMT                                                *   CSE023
087010200529      *                                                               *   CSE023
087020200529      *****************************************************************   CSE023
087030200529      *                                                                   CSE023
087040200529     C           WITHTX    BEGSR                                          CSE023
087050200529      *                                                                   CSE023
087060200529      ** Set Tax Deducted at Source Refundable to zero, reset other tax   CSE023
087070200529      ** fields as well.                                                  CSE023
087080200529     C                     Z-ADD0         TASR                            CSE023
087090200529     C                     Z-ADD0         TASO                            CSE023
087100200529     C                     Z-ADD0         TAUS                            CSE023
087110200529      *                                                                   CSE023
087120200529      ** Retrieve withholding tax treaty details, issue database error    CSE023
087130200529      ** if not found as record should be present on the withholding      CSE023
087140200529      ** tax details file.                                                CSE023
087150200529      *                                                                   CSE023
087160200529     C                     MOVE CRTT      KYCRTT                          185397
087170200529     C                     MOVE SITP      @SITP                           CSE023
087180200529     C                     MOVE BBCOLC    @BCOLC                          CSE023
087190200529     C           WTFKEY    CHAINSDWHTTL0             99                   CSE023
087200200529     C           *IN99     IFEQ '1'                                       CSE023
087210200529     C                     MOVE '0'       *IN99                           CSE023
087220200529     C                     MOVE '   '     @SITP                           CSE023
087230200529     C           WTFKEY    CHAINSDWHTTL0             99                   CSE023
087240200529     C                     ENDIF                                          CSE023
087250200529     C           *IN99     IFEQ '1'                                       CSE023
087260200529     C                     MOVE '0'       *IN99                           CSE023
087270200529     C                     MOVE SITP      @SITP                           CSE023
087280200529     C           WTPKEY    CHAINSDWHTTL0             99                   CSE023
087290200529     C                     ENDIF                                          CSE023
087300200529     C           *IN99     IFEQ '1'                                       CSE023
087310200529     C                     MOVE '0'       *IN99                           CSE023
087320200529     C                     MOVE '   '     @SITP                           CSE023
087330200529     C           WTPKEY    CHAINSDWHTTL0             99                   CSE023
087340200529     C                     ENDIF                                          CSE023
087350200529      *                                                                   CSE023
087360200529     C           *IN99     IFEQ '1'                                       CSE023
087370200529     C                     MOVELKYCRTT    WTEMP1                          CSE023
087380200529     C                     MOVE SITP      WTEMP1                          CSE023
087390200529     C                     MOVELWTEMP1    WTEMP2                          CSE023
087400200529     C                     MOVE BBCOLC    WTEMP2                          CSE023
087410200529     C                     MOVEL'SDWHTTPD'DBFILE           ***************CSE023
087420200529     C                     Z-ADD26        DBASE            * DB ERROR 26 *CSE023
087430200529     C                     MOVELWTEMP2    DBKEY            ***************CSE023
087440200529     C                     EXSR *PSSR                                     CSE023
087450200529     C                     ENDIF                                          CSE023
087460200529      *                                                                   CSE023
087470200529     C           STXBS     IFNE *BLANKS                                   CSE023
087480200529     C                     CALL 'AOTXBSR0'                                CSE023
087490200529     C                     PARM *BLANKS   PIRTCD  7                       CSE023
087500200529     C                     PARM '*KEY   ' PIOPTN  7                       CSE023
087510200529     C                     PARM KYCRTT    PICRTT  2                       CSE023
087520200529     C                     PARM STXBS     PITXBS  2                       CSE023
087530200529     C                     PARM PDUD      PIDATE  50                      CSE023
087540200529     C                     PARM *BLANKS   PINARR 15                       CSE023
087550200529     C                     PARM *ZEROS    PIRATE  64                      CSE023
087560200529      *                                                                   CSE023
087570200529     C                     ELSE                                           CSE023
087580200529     C                     Z-ADD0         PIRATE                          CSE023
087590200529     C                     MOVE *BLANKS   PINARR                          CSE023
087600200529     C                     END                                            CSE023
087610200529      *                                                                   185397
087620200529     C                     MOVE PINARR    TXBN                            185397
087630200529      *                                                                   CSE023
087640200529      ** Setup amount to used for computing the tax fields.               CSE023
087650200529      *                                                                   CSE023
087660200529     C           PEVT      IFEQ 'MT'                                      CSE023
087670200529     C                     EXSR CLDAMT                                    CSE023
087680200529     C                     Z-ADDWDAMT     WPAMT  130                      CSE023
087690200529     C                     ELSE                                           CSE023
087700200529     C                     Z-ADDPAMD      WPAMT                           CSE023
087710200529     C                     ENDIF                                          CSE023
087720200529      *                                                                   CSE023
087730200529      ** Calculate tax deducted at source or tax deducted at user         CSE023
087740200529      ** using the tax rate retrieve based on the customers withholding   CSE023
087750200529      ** tax details.                                                     CSE023
087760200529      *                                                                   CSE023
087770200529     C                     SELEC                                          CSE023
087780200529     C           WTDTSU    WHEQ 'S'                                       CSE023
087790200529     C           WPAMT     MULT PIRATE    TASO                            CSE023
087800200529     C           TASO      DIV  100       TASO                            CSE023
087810200529      *                                                                   CSE023
087820200529     C                     MOVE TASO      ZFLD15                          CSE023
087830200529      *                                                                   CSE023
087840200529     C           S01509    IFEQ 'Y'                                       CSE023
087850200529     C                     Z-ADDPOSCDP    ZDECS                           CSE023
087860200529     C                     ELSE                                           CSE023
087870200529     C                     Z-ADDNOMCDP    ZDECS                           CSE023
087880200529     C                     ENDIF                                          CSE023
087890200529      *                                                                   CSE023
087900200529     C                     MOVE ' '       ZECODE                          CSE023
087910200529     C                     EXSR ZSEDIT                                    CSE023
087920200529     C                     MOVE ZOUT21    STASO                           CSE023
087930200529      *                                                                   CSE023
087940200529     C                     OTHER                                          CSE023
087950200529     C           WPAMT     MULT PIRATE    TAUS                            CSE023
087960200529     C           TAUS      DIV  100       TAUS                            CSE023
087970200529      *                                                                   CSE023
087980200529     C                     MOVE TAUS      ZFLD15                          CSE023
087990200529      *                                                                   CSE023
088000200529     C           S01509    IFEQ 'Y'                                       CSE023
088010200529     C                     Z-ADDPOSCDP    ZDECS                           CSE023
088020200529     C                     ELSE                                           CSE023
088030200529     C                     Z-ADDNOMCDP    ZDECS                           CSE023
088040200529     C                     ENDIF                                          CSE023
088050200529      *                                                                   CSE023
088060200529     C                     MOVE ' '       ZECODE                          CSE023
088070200529     C                     EXSR ZSEDIT                                    CSE023
088080200529     C                     MOVE ZOUT21    STAUS                           CSE023
088090200529     C                     ENDSL                                          CSE023
088100200529      *                                                                   CSE023
088110200529      *                                                                   CSE023
088120200529     C                     ENDSR                                          CSE023
088130200529      *                                                                   CSE023
088140200529      *****************************************************************   CSE023
088150200529      /EJECT                                                              CSE023
088160200529      *****************************************************************   CSE023
088170200529      *                                                               *   CSE023
088180200529      *  CLDAMT - Calculate discounted amount.                        *   CSE023
088190200529      *                                                               *   CSE023
088200200529      *  CALLED FROM: VALIDD, UPDFLS                                  *   CSE023
088210200529      *                                                               *   CSE023
088220200529      *  CALLS:                                                       *   CSE023
088230200529      *                                                               *   CSE023
088240200529      *****************************************************************   CSE023
088250200529      *                                                                   CSE023
088260200529     C           CLDAMT    BEGSR                                          CSE023
088270200529      *                                                                   CSE023
088280200529     C                     Z-ADD0         WDAMT                           CSE023
088290200529      *                                                                   CSE023
088300200529     C           BFCLAS    IFEQ 'S'                                       CSE023
088310200529     C********** BFCLAS    ANDEQ'D'                                CSE023 186055
088320200529     C           BFCLAS    OREQ 'D'                                       186055
088330200529      *                                                                   CSE023
088340200529      ** Total discount amount - based on Original Interest Discount,     CSE023
088350200529      ** reset or calculate.                                              CSE023
088360200529     C           OIDI      IFEQ 'Y'                                       CSE023
088370200529      *                                                                   CSE023
088380200529      ** Setup key field combination for customer positions file.         CSE023
088390200529     C**********           MOVELKYCSNO    KYCSCN                   CSE023 186055
088400200529     C                     MOVELPCPY      KYCSCN                          186055
088410200529     C                     SELEC                                          CSE023
088420200529     C           SPBCA     WHNE *BLANKS                                   CSE023
088430200529     C                     MOVELSPBCA     KYPBCA                          CSE023
088440200529     C                     OTHER                                          CSE023
088450200529     C                     MOVELBJSBRC    KYPBCA                          CSE023
088460200529     C                     ENDSL                                          CSE023
088470200529      *                                                                   CSE023
088480200529     C           WCPKEY    SETGTCPOSH                                     CSE023
088490200529     C                     READPCPOSH                    99               CSE023
088500200529     C                     MOVELCSCN      WCSCN   6                       CSE023
088510200529      *                                                                   CSE023
088520200529     C           CSBA      IFNE KYPBCA                                    CSE023
088530200529     C********** WCSCN     ORNE KYCSNO                             CSE023 186055
088540200529     C           CSCN      ORNE KYCSCN                                    186055
088550200529     C           CSSC      ORNE SPSSH                                     CSE023
088560200529     C                     MOVELKYPBCA    WTEMP3                          CSE023
088570200529     C                     MOVE SPSSH     WTEMP3                          CSE023
088580200529     C                     MOVELWTEMP3    WTEMP4                          CSE023
088590200529     C                     MOVE KYCSCN    WTEMP4                          CSE023
088600200529     C                     MOVEL'CPOSND'  DBFILE           ***************CSE023
088610200529     C                     Z-ADD25        DBASE            * DBERROR 025 *CSE023
088620200529     C                     MOVELWTEMP4    DBKEY            ***************CSE023
088630200529     C                     EXSR *PSSR                                     CSE023
088640200529     C                     ENDIF                                          CSE023
088650200529      *                                                                   CSE023
088660200529      ** Calculate Total Discount Amount if nominal not zero.             CSE023
088670200529     C           PNMP      IFNE 0                                         CSE023
088680200529     C**********           Z-ADD0         WDAMT  130               CSE023 186055
088690200529     C                     Z-ADD0         WDAMT  210                      186055
088700200529     C           PNMP      MULT CSPT      WDAMT                           CSE023
088710200529     C           WDAMT     DIV  CSNT      WDAMT                           CSE023
088720200529     C********** PNMP      SUB  WDAMT     WDAMT                    CSE023 186055
088730200529     C           NOMCDP    ADD  1         A       10                      186055
088740200529     C           PNMP      MULT AP,A      PNMPAT 210                      186055
088750200529     C           PNMPAT    SUB  WDAMT     WDAMT                           186055
088760200529     C                     ENDIF                                          CSE023
088770200529      *                                                                   CSE023
088780200529     C                     ENDIF                                          CSE023
088790200529      *                                                                   CSE023
088800200529     C                     ENDIF                                          CSE023
088810200529      *                                                                   CSE023
088820200529     C                     ENDSR                                          CSE023
088830200529      *                                                                   CSE023
088840200529      *****************************************************************   CSE023
088850200529      /EJECT                                                              CSE023
088860200529     C*****************************************************************
088870200529     C*                                                               *
088880200529     C*  DEFLTS  - S/R TO FORMAT DEFAULT FIELD VALUES FOR INSERT SCRN *
088890200529     C*  CALLED FROM: UPDATE, VALIDD                                  *
088900200529     C*  CALLS: ZSEDIT                                                *
088910200529     C*                                                               *
088920200529     C*****************************************************************
088930200529     C*
088940200529     C           DEFLTS    BEGSR
088950200529     C*
088960200529     C                     MOVE '1'       *IN89
088970200529     C           ACTN      IFEQ 'I'
088980200529     C*                                                                   S01512
088990200529     C** Blank out screen fields                                          S01512
089000200529     C*                                                                   S01512
089010200529     C                     MOVE *BLANKS   SPNMP                           S01512
089020200529     C                     MOVE *BLANKS   SPBCD                           S01512
089030200529     C                     MOVE *BLANKS   SPAMD                           S01512
089040200529     C                     MOVE *BLANKS   SPPRE                           S01512
089050200529     C                     MOVE *BLANKS   SPSCU                           S01512
089060200529     C                     MOVE *BLANKS   XSPSCU                          151506
089070200529     C                     MOVE *BLANKS   SPMDI                           S01512
089080200529     C                     MOVE *BLANKS   SPBRX                           S01512
089090200529     C                     MOVE *BLANKS   SPSMT                           S01512
089100200529     C                     MOVE *BLANKS   SPSEA                           S01512
089110200529     C                     MOVE *BLANKS   SPSEB                           S01512
089120200529     C                     MOVE *BLANKS   SPCPN                           S01512
089130200529     C                     MOVE *BLANKS   SPFAC                           S01512
089140200529     C                     MOVE *BLANKS   SPSPI                           S01512
089150200529     C                     MOVE *BLANKS   SPCHC                           S01512
089160200529     C                     MOVE *BLANKS   SPCHA                           S01512
089170200529     C                     MOVE *BLANKS   SPCCD                           S01512
089180200529     C                     MOVE *BLANKS   SPCAM                           S01512
089190200529     C                     MOVE *BLANKS   SPSAT                           S01512
089200200529     C                     MOVE *BLANKS   SPSXR                           S01512
089210200529     C                     MOVE *BLANKS   SPSVL                           S01512
089220200529     C                     MOVE *BLANKS   XSPSVL                          S01512
089230200529     C                     MOVE *BLANKS   SFXMP                           CAC002
089240200529     C                     MOVE *BLANKS   SMAMT                           CAC002
089250200529     C                     MOVE *BLANKS   SPTAXL                                              CER049
089260200529      *                                                                   S01447
089270200529      *** If S01447 is ON and event is dividend or coupon, set zero       S01447
089280200529      *** tax fields.                                                     S01447
089290200529     C           S01447    IFEQ 'Y'                                       S01447
089300200529     C           PEVT      IFEQ 'CP'                       *B2            S01447
089310200529     C           PEVT      OREQ 'DV'                                      S01447
089320200529     C                     CLEARSTASO                                     S01447
089330200529     C                     CLEARSTASR                                     S01447
089340200529     C                     CLEARSTAUS                                     S01447
089350200529     C                     END                             *E2            S01447
089360200529     C           CSE023    IFEQ 'Y'                                       186166
089370200529     C           PEVT      ANDEQ'MT'                                      186166
089380200529     C                     CLEARSTASO                                     186166
089390200529     C                     CLEARSTASR                                     186166
089400200529     C                     CLEARSTAUS                                     186166
089410200529     C                     ENDIF                                          186166
089420200529     C                     END                             *E1            S01447
089430200529      *                                                                   S01447
089440200529     C           S01509    IFEQ 'N'                                       S01509
089450200529     C                     MOVELNMCY      SPNCY
089460200529     C                     MOVELNMCY      PNCY
089470200529     C                     END                                            S01509
089480200529     C*                                                                   S01117
089490200529     C**  Default SPPFC from Profit Centre Position record                S01117
089500200529     C**   if 'Profit Centre Used' indicator on                           S01117
089510200529     C*                                                                   S01117
089520200529     C           *IN82     IFEQ '1'                                       S01117
089530200529     C           *IN84     ANDNE'1'                                       S01117
089540200529     C                     MOVEL*BLANKS   SPPFC                           S01117
089550200529     C**********           Z-ADDPCPY      PCCNM   60                                   S01117 CSD027
089560200529     C                     MOVE PCPY      PCCNM   6                                           CSD027
089570200529     C                     MOVELPBCA      PCBCA   3                       S01117
089580200529     C                     MOVELPSSH      PCSSN  10                       S01117
089590200529     C           SEPCCK    CHAINSEPCCDF              99                   S01117
089600200529     C           *IN99     IFEQ '0'                                       S01117
089610200529     C                     MOVELPCCU      SPPFC                           S01117
089620200529     C*                                                                   CAC002
089630200529     C           BGN0ST    IFEQ 'Y'                                       CAC002
089640200529     C                     MOVELPCCU      PPFC                            CAC002
089650200529     C                     SETON                     68                   CAC002
089660200529     C                     ENDIF                                          CAC002
089670200529     C*                                                                   CAC002
089680200529     C                     END                                            S01117
089690200529     C*                                                                   CAC002
089700200529     C           BGN0ST    IFEQ 'Y'                                       CAC002
089710200529     C           *IN99     IFEQ '1'                                       CAC002
089720200529     C                     MOVEL*BLANKS   SPPFC                           CAC002
089730200529     C                     MOVEL*BLANKS   PPFC                            CAC002
089740200529     C                     SETOF                     68                   CAC002
089750200529     C                     ENDIF                                          CAC002
089760200529     C                     ENDIF                                          CAC002
089770200529     C*                                                                   CAC002
089780200529     C                     END                                            S01117
089790200529     C*
089800200529     C**  DEFAULTS FOR PAY/RECEIVE INDICATOR
089810200529     C*
089820200529     C           SPPRE     IFEQ *BLANKS
089830200529     C           PPRE      ANDEQ*BLANKS
089840200529     C***********C1DI      IFNE 'S'                                       S01117
089850200529     C***********C1DI      ANDNE'D'                                       S01117
089860200529     C           BFCLAS    IFNE 'S'                                       S01117
089870200529     C           BFCLAS    ANDNE'D'                                       S01117
089880200529     C           PEVT      IFEQ 'PP'
089890200529     C                     MOVE 'P'       SPPRE
089900200529     C                     ELSE
089910200529     C                     MOVE 'R'       SPPRE
089920200529     C                     END
089930200529     C                     ELSE
089940200529     C           PEVT      IFNE 'PP'
089950200529     C                     MOVE 'P'       SPPRE
089960200529     C                     ELSE
089970200529     C                     MOVE 'R'       SPPRE
089980200529     C                     END
089990200529     C                     END
090000200529     C                     END
090010200529     C/COPY WNCPYSRC,SE0170C088
090020200529     C*
090030200529     C**  DEFAULTS FOR SETTLEMENT CURRENCY
090040200529     C** If not already entered                                           S01509
090050200529     C*
090060200529     C           SPSCU     IFEQ *BLANKS
090070200529     C           PSCU      ANDEQ*BLANKS
090080200529     C*                                                                   S01509
090090200529     C** If S01509 is active,                                             S01509
090100200529     C** Issuers settlement ccy depends on event type                     S01509
090110200529     C** (NB VLCY = SPYC always)                                          S01509
090120200529     C*                                                                   S01509
090130200529     C           S01509    IFEQ 'Y'                                       S01509
090140200529     C                     SELEC                                          S01509
090150200529     C*                                                                   S01509
090160200529     C           PEVT      WHEQ 'PP'                                      S01509
090170200529     C           PEVT      OREQ 'MP'                                      S01509
090180200529     C                     MOVE NMCY      WPSETC                          S01509
090190200529     C                     MOVE NMCY      SPNCY                           S01509
090200200529     C*                                                                   S01509
090210200529     C           PEVT      WHEQ 'MT'                                      S01509
090220200529     C           WRKEY     KLIST                                          S01509
090230200529     C                     KFLD           SPSSH                           S01509
090240200529     C                     KFLD           WPDUD                           S01509
090250200529     C                     KFLD           WETYP   2                       S01509
090260200529     C                     MOVELSPDUD     ZDATE                           S01509
090270200529     C                     EXSR ZDATE1                                    S01509
090280200529     C                     Z-ADDZDAYNO    WPDUD                           S01509
090290200529     C                     MOVE 'RC'      WETYP                           S01509
090300200529     C           WRKEY     CHAINSEDEV                90                   S01509
090310200529     C           *IN90     IFEQ '0'                                       S01509
090320200529     C           SDCX      ANDNE*BLANKS                                   S01509
090330200529     C                     MOVE SDCX      WPSETC                          S01509
090340200529     C                     MOVE SDCX      SPNCY                           S01509
090350200529     C                     ELSE                                           S01509
090360200529     C                     MOVE NMCY      WPSETC                          S01509
090370200529     C                     MOVE NMCY      SPNCY                           S01509
090380200529     C                     END                                            S01509
090390200529     C*                                                                   S01509
090400200529     C                     OTHER                                          S01509
090410200529     C                     MOVE VLCY      WPSETC  3                       S01509
090420200529     C                     MOVE VLCY      SPNCY                           S01509
090430200529     C*                                                                   S01509
090440200529     C                     ENDSL                                          S01509
090450200529     C                     END                                            S01509
090460200529     C*                                                                   S01509
090470200529     C** If a portfolio customer there may be a preferred settlement ccy  S01509
090480200529     C*                                                                   S01509
090490200529     C***********C1DI      IFEQ 'S'                                       S01117
090500200529     C***********C1DI      OREQ 'D'                                       S01117
090510200529     C           BFCLAS    IFEQ 'S'                                       S01117
090520200529     C           BFCLAS    OREQ 'D'                                       S01117
090530200529     C*                                                                   S01509
090540200529     C**   .. does the customer have standard settlements?                S01509
090550200529     C*                                                                   S01509
090560200529     C           S01509    IFEQ 'Y'                                       S01509
090570200529     C                     MOVELWPSETC    CURK    3                       S01509
090580200529     C                     ELSE                                           S01509
090590200529     C                     MOVELVLCY      CURK    3
090600200529     C                     END                                            S01509
090610200529     C/COPY WNCPYSRC,SE0170C036
090620200529      *                                                                                       CSE028
090630200529      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
090640200529      *                                                                                       CSE028
090650200529     C           CSE028    IFEQ 'Y'                                                           CSE028
090660200529      *                                                                                       CSE028
090670200529     C                     MOVE PBCD      WBKCD                                               CSE028
090680200529     C                     EXSR SRSSIR                                                        CSE028
090690200529     C           NOTFND    IFEQ 'Y'                                                           CSE028
090700200529     C                     MOVE '1'       *IN99                                               CSE028
090710200529     C                     ELSE                                                               CSE028
090720200529     C                     MOVE '0'       *IN99                                               CSE028
090730200529     C                     ENDIF                                                              CSE028
090740200529      *                                                                                       CSE028
090750200529     C                     ELSE                                                               CSE028
090760200529      *                                                                                       CSE028
090770200529     C                     MOVE *BLANKS   WBKCD                                               CSE028
090780200529      *                                                                                       CSE028
090790200529     C           STDSEK    CHAINSTDSED               99
090800200529      *                                                                                       CSE028
090810200529     C                     ENDIF                                                              CSE028
090820200529      *                                                                                       CSE028
090830200529     C/COPY WNCPYSRC,SE0170C037
090840200529     C           *IN99     IFEQ '0'
090850200529     C*                                                                   CEU005
090860200529     C** If CEU005 is active use date defaults here.                      CEU005
090870200529     C*                                                                   CEU005
090880200529     C           CEU005    IFEQ 'Y'                                       CEU005
090890200529     C           S01512    IFEQ 'Y'                                       CEU005
090900200529     C           PSVL      IFEQ 0                                         CEU005
090910200529     C                     MOVELSPDUD     SPSVL                           CEU005
090920200529     C                     MOVE SPDUD     ZDATE                           CEU005
090930200529     C                     EXSR ZDATE1                                    CEU005
090940200529     C                     MOVELZDAYNO    PSVL                            CEU005
090950200529     C                     ELSE                                           CEU005
090960200529     C                     Z-ADDPSVL      ZDAYNO                          CEU005
090970200529     C                     EXSR ZDATE2                                    CEU005
090980200529     C                     MOVELZDATE     SPSVL                           CEU005
090990200529     C                     END                                            CEU005
091000200529     C                     END                                            CEU005
091010200529     C                     ENDIF                                          CEU005
091020200529     C*                                                                   CEU005
091030200529     C** If CEU005 is on check for EURO Currency.                         CEU005
091040200529     C*                                                                   CEU005
091050200529     C           CEU005    IFEQ 'Y'                                       CEU005
091060200529     C           SCCY      ANDNE*BLANKS                                   CEU005
091070200529     C*                                                                   CEU005
091080200529     C** If the Due Currency is the EURO Currency.                        CEU005
091090200529     C*                                                                   CEU005
091100200529     C           SPNCY     IFEQ BKEURO                                    CEU005
091110200529     C                     CALL 'AOCURRR0'                                CEU005
091120200529     C                     PARM *BLANKS   @RTCD                           CEU005
091130200529     C                     PARM '*KEY   ' @OPTN                           CEU005
091140200529     C                     PARM SCCY      @AJCD                           CEU005
091150200529     C           SDCURR    PARM SDCURR    DSSDY                           CEU005
091160200529     C           @RTCD     IFNE *BLANKS                                   CEU005
091170200529     C                     MOVEL'SDCURRPD'DBFILE           ***************CEU005
091180200529     C                     MOVEL'018'     DBASE            * DBERROR 018 *CEU005
091190200529     C                     MOVELSCCY      DBKEY            ***************CEU005
091200200529     C                     EXSR *PSSR                                     CEU005
091210200529     C                     END                                            CEU005
091220200529     C                     Z-ADD0         DATE    50                      CEU005
091230200529     C                     MOVE PSVL      DATE                            CEU005
091240200529     C*                                                                   CEU005
091250200529     C** If the Currency is 'IN' then enter the exchange rate             CEU005
091260200529     C** and mult/div indicator of the currency into POSETD.              CEU005
091270200529     C*                                                                   CEU005
091280200529     C           A6INCY    IFEQ 'Y'                                       CEU005
091290200529     C           DATE      ANDGEA6TPSD                                    CEU005
091300200529     C                     Z-ADDA6EUER    PSXR                            CEU005
091310200529     C                     MOVE PSXR      ZFLD15                          CEU005
091320200529     C                     Z-ADD8         ZDECS                           CEU005
091330200529     C                     MOVE ' '       ZECODE                          CEU005
091340200529     C                     EXSR ZSEDIT                                    CEU005
091350200529     C                     MOVEL*BLANKS   SPSXR                           CEU005
091360200529     C                     MOVE ZOUT21    SPSXR                           CEU005
091370200529     C*                                                                   CEU005
091380200529     C           A6EUMD    IFEQ 'M'                                       143690
091390200529     C                     MOVE 'D'       PMDI                            143690
091400200529     C                     MOVE 'D'       SPMDI                           143690
091410200529     C                     ELSE                                           143690
091420200529     C                     MOVE 'M'       PMDI                            143690
091430200529     C                     MOVE 'M'       SPMDI                           143690
091440200529     C                     ENDIF                                          143690
091450200529     C***********          MOVE A6EUMD    PMDI                     CEU005 143690
091460200529     C***********          MOVE A6EUMD    SPMDI                    CEU005 143690
091470200529     C                     ENDIF                                          CEU005
091480200529     C*                                                                   CEU005
091490200529     C                     ENDIF                                          CEU005
091500200529     C*                                                                   CEU005
091510200529     C** If the Settlement Currency is the EURO Currency.                 CEU005
091520200529     C*                                                                   CEU005
091530200529     C           SCCY      IFEQ BKEURO                                    CEU005
091540200529     C                     CALL 'AOCURRR0'                                CEU005
091550200529     C                     PARM *BLANKS   @RTCD                           CEU005
091560200529     C                     PARM '*KEY   ' @OPTN                           CEU005
091570200529     C                     PARM SPNCY     @AJCD                           CEU005
091580200529     C           SDCURR    PARM SDCURR    DSSDY                           CEU005
091590200529     C           @RTCD     IFNE *BLANKS                                   CEU005
091600200529     C                     MOVEL'SDCURRPD'DBFILE           ***************CEU005
091610200529     C                     MOVEL'019'     DBASE            * DBERROR 019 *CEU005
091620200529     C                     MOVELSPNCY     DBKEY            ***************CEU005
091630200529     C                     EXSR *PSSR                                     CEU005
091640200529     C                     END                                            CEU005
091650200529     C                     Z-ADD0         DATE                            CEU005
091660200529     C                     MOVELPSVL      DATE                            CEU005
091670200529     C*                                                                   CEU005
091680200529     C** If the Currency is 'IN' then enter the exchange rate             CEU005
091690200529     C** and mult/div indicator of the currency into POSETD.              CEU005
091700200529     C*                                                                   CEU005
091710200529     C           A6INCY    IFEQ 'Y'                                       CEU005
091720200529     C           DATE      ANDGEA6TPSD                                    CEU005
091730200529     C                     Z-ADDA6EUER    PSXR                            CEU005
091740200529     C                     MOVE PSXR      ZFLD15                          CEU005
091750200529     C                     Z-ADD8         ZDECS                           CEU005
091760200529     C                     MOVE ' '       ZECODE                          CEU005
091770200529     C                     EXSR ZSEDIT                                    CEU005
091780200529     C                     MOVEL*BLANKS   SPSXR                           CEU005
091790200529     C                     MOVE ZOUT21    SPSXR                           CEU005
091800200529     C*                                                                   CEU005
091810200529     C                     MOVE A6EUMD    PMDI                            143690
091820200529     C                     MOVE A6EUMD    SPMDI                           143690
091830200529     C***********A6EUMD    IFEQ 'M'                                CEU005 143690
091840200529     C***********          MOVE 'D'       PMDI                     CEU005 143690
091850200529     C***********          MOVE 'D'       SPMDI                    CEU005 143690
091860200529     C***********          ELSE                                    CEU005 143690
091870200529     C***********          MOVE 'M'       PMDI                     CEU005 143690
091880200529     C***********          MOVE 'M'       SPMDI                    CEU005 143690
091890200529     C***********          ENDIF                                   CEU005 143690
091900200529     C                     ENDIF                                          CEU005
091910200529     C*                                                                   CEU005
091920200529     C                     ENDIF                                          CEU005
091930200529     C*                                                                   CEU005
091940200529     C** Check for settlement details for Settlement Currency.            CEU005
091950200529     C*                                                                   CEU005
091960200529     C                     MOVELSCCY      PSCU      P                     CEU005
091970200529     C                     MOVELSCCY      WPSETC    P                     CEU005
091980200529     C           SCCY      IFNE CURK                                      CEU005
091990200529     C                     MOVELSCCY      CURK      P                     CEU005
092000200529     C/COPY WNCPYSRC,SE0170C083
092010200529     C           STDSEK    SETLLSTDSED                   99               CEU005
092020200529     C           *IN99     IFEQ '1'                                       CEU005
092030200529      *                                                                                       CSE028
092040200529      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
092050200529      *                                                                                       CSE028
092060200529     C           CSE028    IFEQ 'Y'                                                           CSE028
092070200529      *                                                                                       CSE028
092080200529     C                     MOVE PBCD      WBKCD                                               CSE028
092090200529     C                     EXSR SRSSIR                                                        CSE028
092100200529     C           NOTFND    IFEQ 'Y'                                                           CSE028
092110200529     C                     MOVE '1'       *IN99                                               CSE028
092120200529     C                     ELSE                                                               CSE028
092130200529     C                     MOVE '0'       *IN99                                               CSE028
092140200529     C                     ENDIF                                                              CSE028
092150200529      *                                                                                       CSE028
092160200529     C                     ELSE                                                               CSE028
092170200529      *                                                                                       CSE028
092180200529     C                     MOVE *BLANKS   WBKCD                                               CSE028
092190200529      *                                                                                       CSE028
092200200529     C           STDSEK    CHAINSTDSED               99                   CEU005
092210200529      *                                                                                       CSE028
092220200529     C                     ENDIF                                                              CSE028
092230200529      *                                                                                       CSE028
092240200529     C                     ELSE                                           CEU005
092250200529     C*                                                                   CEU005
092260200529     C** Blank out fields if no currency settlements instructions         CEU005
092270200529     C*                                                                   CEU005
092280200529     C                     MOVE *BLANKS   SRSM                            CEU005
092290200529     C                     MOVE *BLANKS   SRAC                            CEU005
092300200529     C                     MOVE *BLANKS   SRAB                            CEU005
092310200529     C                     MOVE *BLANKS   SRCB                            CEU005
092320200529     C                     MOVE *BLANKS   SPSM                            CEU005
092330200529     C                     MOVE *BLANKS   SPAT                            CEU005
092340200529     C                     MOVE *BLANKS   SPBA                            CEU005
092350200529     C                     MOVE *BLANKS   SPCB                            CEU005
092360200529     C                     MOVE *BLANKS   SPFA                            CEU005
092370200529     C                     MOVE *BLANKS   SPSI                            CEU005
092380200529     C                     MOVE *BLANKS   SPCP                            CEU005
092390200529     C                     ENDIF                                          CEU005
092400200529     C/COPY WNCPYSRC,SE0170C084
092410200529     C                     ENDIF                                          CEU005
092420200529     C                     ENDIF                                          CEU005
092430200529     C*                                                                   CEU005
092440200529     C           S01509    IFEQ 'Y'                                       S01509
092450200529     C                     MOVELWPSETC    SPSCU                           S01509
092460200529     C                     ELSE                                           S01509
092470200529     C                     MOVELVLCY      SPSCU
092480200529     C                     END                                            S01509
092490200529     C*                                                                   S01509
092500200529     C**  .. else does the customer have a normal settlement CCY?         S01509
092510200529     C*                                                                   S01509
092520200529     C                     ELSE
092530200529     C***********C1SC      IFNE *BLANKS                                   S01117
092540200529     C***********          MOVELC1SC      SPSCU                           S01117
092550200529     C           BFCYCD    IFNE *BLANKS                                   S01117
092560200529     C                     MOVELBFCYCD    SPSCU                           S01117
092570200529     C                     ELSE
092580200529     C*                                                                   S01509
092590200529     C** If S01509 is active default to the ccy expected by the user      S01509
092600200529     C*                                                                   S01509
092610200529     C           S01509    IFEQ 'Y'                                       S01509
092620200529     C                     MOVELWPSETC    SPSCU                           S01509
092630200529     C                     ELSE                                           S01509
092640200529     C           VLCY      IFNE *BLANKS
092650200529     C                     MOVELVLCY      SPSCU
092660200529     C                     ELSE
092670200529     C                     MOVELNMCY      SPSCU
092680200529     C                     END
092690200529     C                     END                                            S01509
092700200529     C                     END
092710200529     C                     END
092720200529     C                     ELSE
092730200529     C*
092740200529     C**  IF CLASSIFICATION NOT 'S' OR 'D', TEST MULTICURRENCY IND = Y
092750200529     C** If S01509 is active, this is a market client and offer a         S01509
092760200529     C** standard default, otherwise check multicurrency ind = Y          S01509
092770200529     C** If CEU005 is active, check for standard settlement instructions. CEU005
092780200529     C*
092790200529     C           S01509    IFEQ 'Y'                                       S01509
092800200529     C           CEU005    IFEQ 'Y'                                       CEU005
092810200529     C                     MOVELWPSETC    CURK    3                       CEU005
092820200529      *                                                                                       CSE028
092830200529      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
092840200529      *                                                                                       CSE028
092850200529     C           CSE028    IFEQ 'Y'                                                           CSE028
092860200529      *                                                                                       CSE028
092870200529     C                     MOVE PBCD      WBKCD                                               CSE028
092880200529     C                     EXSR SRSSIR                                                        CSE028
092890200529     C           NOTFND    IFEQ 'Y'                                                           CSE028
092900200529     C                     MOVE '1'       *IN99                                               CSE028
092910200529     C                     ELSE                                                               CSE028
092920200529     C                     MOVE '0'       *IN99                                               CSE028
092930200529     C                     ENDIF                                                              CSE028
092940200529      *                                                                                       CSE028
092950200529     C                     ELSE                                                               CSE028
092960200529      *                                                                                       CSE028
092970200529     C                     MOVE *BLANKS   WBKCD                                               CSE028
092980200529      *                                                                                       CSE028
092990200529     C           STDSEK    CHAINSTDSED               99                   CEU005
093000200529      *                                                                                       CSE028
093010200529     C                     ENDIF                                                              CSE028
093020200529      *                                                                                       CSE028
093030200529     C/COPY WNCPYSRC,SE0170C085
093040200529     C           *IN99     IFEQ '0'                                       CEU005
093050200529     C*                                                                   CEU005
093060200529     C** If CEU005 is active use date defaults here.                      CEU005
093070200529     C*                                                                   CEU005
093080200529     C           S01512    IFEQ 'Y'                                       CEU005
093090200529     C           PSVL      IFEQ 0                                         CEU005
093100200529     C                     MOVELSPDUD     SPSVL                           CEU005
093110200529     C                     MOVE SPDUD     ZDATE                           CEU005
093120200529     C                     EXSR ZDATE1                                    CEU005
093130200529     C                     MOVELZDAYNO    PSVL                            CEU005
093140200529     C                     ELSE                                           CEU005
093150200529     C                     Z-ADDPSVL      ZDAYNO                          CEU005
093160200529     C                     EXSR ZDATE2                                    CEU005
093170200529     C                     MOVELZDATE     SPSVL                           CEU005
093180200529     C                     END                                            CEU005
093190200529     C                     END                                            CEU005
093200200529     C*                                                                   CEU005
093210200529     C** Check for EURO Currency.                                         CEU005
093220200529     C*                                                                   CEU005
093230200529     C           SCCY      IFNE *BLANKS                                   CEU005
093240200529     C*                                                                   CEU005
093250200529     C** If the Due Currency is the EURO Currency.                        CEU005
093260200529     C*                                                                   CEU005
093270200529     C           SPNCY     IFEQ BKEURO                                    CEU005
093280200529     C                     CALL 'AOCURRR0'                                CEU005
093290200529     C                     PARM *BLANKS   @RTCD                           CEU005
093300200529     C                     PARM '*KEY   ' @OPTN                           CEU005
093310200529     C                     PARM SCCY      @AJCD                           CEU005
093320200529     C           SDCURR    PARM SDCURR    DSSDY                           CEU005
093330200529     C           @RTCD     IFNE *BLANKS                                   CEU005
093340200529     C                     MOVEL'SDCURRPD'DBFILE           ***************CEU005
093350200529     C                     MOVEL'018'     DBASE            * DBERROR 018 *CEU005
093360200529     C                     MOVELSCCY      DBKEY            ***************CEU005
093370200529     C                     EXSR *PSSR                                     CEU005
093380200529     C                     END                                            CEU005
093390200529     C                     Z-ADD0         DATE    50                      CEU005
093400200529     C                     MOVE PSVL      DATE                            CEU005
093410200529     C*                                                                   CEU005
093420200529     C** If the Currency is 'IN' then enter the exchange rate             CEU005
093430200529     C** and mult/div indicator of the currency into POSETD.              CEU005
093440200529     C*                                                                   CEU005
093450200529     C           A6INCY    IFEQ 'Y'                                       CEU005
093460200529     C           DATE      ANDGEA6TPSD                                    CEU005
093470200529     C                     Z-ADDA6EUER    PSXR                            CEU005
093480200529     C                     MOVE PSXR      ZFLD15                          CEU005
093490200529     C                     Z-ADD8         ZDECS                           CEU005
093500200529     C                     MOVE ' '       ZECODE                          CEU005
093510200529     C                     EXSR ZSEDIT                                    CEU005
093520200529     C                     MOVEL*BLANKS   SPSXR                           CEU005
093530200529     C                     MOVE ZOUT21    SPSXR                           CEU005
093540200529     C*                                                                   CEU005
093550200529     C           A6EUMD    IFEQ 'M'                                       143690
093560200529     C                     MOVE 'D'       PMDI                            143690
093570200529     C                     MOVE 'D'       SPMDI                           143690
093580200529     C                     ELSE                                           143690
093590200529     C                     MOVE 'M'       PMDI                            143690
093600200529     C                     MOVE 'M'       SPMDI                           143690
093610200529     C                     ENDIF                                          143690
093620200529     C***********          MOVE A6EUMD    PMDI                     CEU005 143690
093630200529     C***********          MOVE A6EUMD    SPMDI                    CEU005 143690
093640200529     C                     ENDIF                                          CEU005
093650200529     C*                                                                   CEU005
093660200529     C                     ENDIF                                          CEU005
093670200529     C*                                                                   CEU005
093680200529     C** If the Settlement Currency is the EURO Currency.                 CEU005
093690200529     C*                                                                   CEU005
093700200529     C           SCCY      IFEQ BKEURO                                    CEU005
093710200529     C                     CALL 'AOCURRR0'                                CEU005
093720200529     C                     PARM *BLANKS   @RTCD                           CEU005
093730200529     C                     PARM '*KEY   ' @OPTN                           CEU005
093740200529     C                     PARM SPNCY     @AJCD                           CEU005
093750200529     C           SDCURR    PARM SDCURR    DSSDY                           CEU005
093760200529     C           @RTCD     IFNE *BLANKS                                   CEU005
093770200529     C                     MOVEL'SDCURRPD'DBFILE           ***************CEU005
093780200529     C                     MOVEL'019'     DBASE            * DBERROR 019 *CEU005
093790200529     C                     MOVELSPNCY     DBKEY            ***************CEU005
093800200529     C                     EXSR *PSSR                                     CEU005
093810200529     C                     END                                            CEU005
093820200529     C                     Z-ADD0         DATE                            CEU005
093830200529     C                     MOVELPSVL      DATE                            CEU005
093840200529     C*                                                                   CEU005
093850200529     C** If the Currency is 'IN' then enter the exchange rate             CEU005
093860200529     C** and mult/div indicator of the currency into POSETD.              CEU005
093870200529     C*                                                                   CEU005
093880200529     C           A6INCY    IFEQ 'Y'                                       CEU005
093890200529     C           DATE      ANDGEA6TPSD                                    CEU005
093900200529     C                     Z-ADDA6EUER    PSXR                            CEU005
093910200529     C                     MOVE PSXR      ZFLD15                          CEU005
093920200529     C                     Z-ADD8         ZDECS                           CEU005
093930200529     C                     MOVE ' '       ZECODE                          CEU005
093940200529     C                     EXSR ZSEDIT                                    CEU005
093950200529     C                     MOVEL*BLANKS   SPSXR                           CEU005
093960200529     C                     MOVE ZOUT21    SPSXR                           CEU005
093970200529     C*                                                                   CEU005
093980200529     C                     MOVE A6EUMD    PMDI                            143690
093990200529     C                     MOVE A6EUMD    SPMDI                           143690
094000200529     C***********A6EUMD    IFEQ 'M'                                CEU005 143690
094010200529     C***********          MOVE 'D'       PMDI                     CEU005 143690
094020200529     C***********          MOVE 'D'       SPMDI                    CEU005 143690
094030200529     C***********          ELSE                                    CEU005 143690
094040200529     C***********          MOVE 'M'       PMDI                     CEU005 143690
094050200529     C***********          MOVE 'M'       SPMDI                    CEU005 143690
094060200529     C***********          ENDIF                                   CEU005 143690
094070200529     C                     ENDIF                                          CEU005
094080200529     C*                                                                   CEU005
094090200529     C                     ENDIF                                          CEU005
094100200529     C*                                                                   CEU005
094110200529     C** Check for settlement details for Settlement Currency.            CEU005
094120200529     C*                                                                   CEU005
094130200529     C                     MOVELSCCY      PSCU      P                     CEU005
094140200529     C                     MOVELSCCY      WPSETC    P                     CEU005
094150200529     C           SCCY      IFNE CURK                                      CEU005
094160200529     C                     MOVELSCCY      CURK      P                     CEU005
094170200529     C/COPY WNCPYSRC,SE0170C086
094180200529     C           STDSEK    SETLLSTDSED                   99               CEU005
094190200529     C           *IN99     IFEQ '1'                                       CEU005
094200200529      *                                                                                       CSE028
094210200529      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
094220200529      *                                                                                       CSE028
094230200529     C           CSE028    IFEQ 'Y'                                                           CSE028
094240200529      *                                                                                       CSE028
094250200529     C                     MOVE PBCD      WBKCD                                               CSE028
094260200529     C                     EXSR SRSSIR                                                        CSE028
094270200529     C           NOTFND    IFEQ 'Y'                                                           CSE028
094280200529     C                     MOVE '1'       *IN99                                               CSE028
094290200529     C                     ELSE                                                               CSE028
094300200529     C                     MOVE '0'       *IN99                                               CSE028
094310200529     C                     ENDIF                                                              CSE028
094320200529      *                                                                                       CSE028
094330200529     C                     ELSE                                                               CSE028
094340200529      *                                                                                       CSE028
094350200529     C                     MOVE *BLANKS   WBKCD                                               CSE028
094360200529      *                                                                                       CSE028
094370200529     C           STDSEK    CHAINSTDSED               99                   CEU005
094380200529      *                                                                                       CSE028
094390200529     C                     ENDIF                                                              CSE028
094400200529      *                                                                                       CSE028
094410200529     C                     ELSE                                           CEU005
094420200529     C*                                                                   CEU005
094430200529     C** Blank out fields if no currency settlements instructions         CEU005
094440200529     C*                                                                   CEU005
094450200529     C                     MOVE *BLANKS   SRSM                            CEU005
094460200529     C                     MOVE *BLANKS   SRAC                            CEU005
094470200529     C                     MOVE *BLANKS   SRAB                            CEU005
094480200529     C                     MOVE *BLANKS   SRCB                            CEU005
094490200529     C                     MOVE *BLANKS   SPSM                            CEU005
094500200529     C                     MOVE *BLANKS   SPAT                            CEU005
094510200529     C                     MOVE *BLANKS   SPBA                            CEU005
094520200529     C                     MOVE *BLANKS   SPCB                            CEU005
094530200529     C                     MOVE *BLANKS   SPFA                            CEU005
094540200529     C                     MOVE *BLANKS   SPSI                            CEU005
094550200529     C                     MOVE *BLANKS   SPCP                            CEU005
094560200529     C                     ENDIF                                          CEU005
094570200529     C/COPY WNCPYSRC,SE0170C087
094580200529     C                     ENDIF                                          CEU005
094590200529     C* Settlement Ccy not present                                        CEU005
094600200529     C                     ELSE                                           CEU005
094610200529     C                     MOVELWPSETC    SPSCU                           S01509
094620200529     C                     ENDIF                                          CEU005
094630200529     C                     ENDIF                                          CEU005
094640200529     C* CEU005 not active.                                                CEU005
094650200529     C                     MOVELWPSETC    SPSCU                           CEU005
094660200529     C                     ENDIF                                          CEU005
094670200529     C*                                                                   CEU005
094680200529     C********             ELSE                                     S01509157808
094690200529     C                     END                                            157808
094700200529     C********** CEU005    IFNE 'Y'                                                    157808 235180
094710200529     C           SPSCU     IFEQ *BLANKS                                                       235180
094720200529     C           MLTI      IFEQ 'Y'
094730200529     C           SPYC      IFNE *BLANKS
094740200529     C                     MOVELSPYC      SPSCU
094750200529     C                     ELSE
094760200529     C                     MOVELNMCY      SPSCU
094770200529     C                     END
094780200529     C                     ELSE
094790200529     C           MLTI      IFEQ 'N'
094800200529     C           VLCY      IFNE *BLANKS
094810200529     C                     MOVELVLCY      SPSCU
094820200529     C                     ELSE
094830200529     C                     MOVELNMCY      SPSCU
094840200529     C                     END
094850200529     C                     END
094860200529     C                     END
094870200529     C                     END                                            S01509
094880200529     C                     END
094890200529     C                     END
094900200529     C                     MOVELSPSCU     XSPSCU                          151506
094910200529     C*
094920200529     C**  EXCHANGE RATE
094930200529     C** Process only if S01509 is not active                             S01509
094940200529     C*
094950200529     C           SPSXR     IFEQ *BLANKS
094960200529     C           PSXR      ANDEQ0
094970200529     C           S01509    ANDEQ'N'                                       S01509
094980200529     C*
094990200529     C**  IF SETTLEMENT CUR = PAYMENT CUR (SECTYD) OUTPUT EXCHANGE
095000200529     C**  RATE AND M/D IND FROM SECTYD
095010200529     C*
095020200529     C           SPYC      IFEQ SPSCU
095030200529     C                     MOVE SMDI      SPMDI
095040200529     C                     MOVE SEXR      ZFLD15
095050200529     C                     Z-ADD8         ZDECS
095060200529     C                     MOVE ' '       ZECODE
095070200529     C                     EXSR ZSEDIT
095080200529     C                     MOVEL*BLANKS   SPSXR
095090200529     C                     MOVE ZOUT21    SPSXR
095100200529     C                     END
095110200529     C                     END
095120200529     C*                                                                   S01509
095130200529     C** DEFAULTS FOR SETTLEMENT/PAYMENT CURRENCY EXCHANGE RATE           S01509
095140200529     C** Process only if S01509 is active                                 S01509
095150200529     C*                                                                   S01509
095160200529     C**  This is the rate between ccy of the position and the defaulted  S01509
095170200529     C**  settlement currency.   If not already entered set it up ...     S01509
095180200529     C*                                                                   S01509
095190200529     C           SPSXR     IFEQ *BLANKS                                   S01509
095200200529     C           PSXR      ANDEQ0                                         S01509
095210200529     C           S01509    ANDEQ'Y'                                       S01509
095220200529     C*                                                                   S01509
095230200529     C*   If position ccy= settlement ccy then the default rate is 1.0    S01509
095240200529     C*   (NB this is a 13,8 field so put 100000000 into it.)             S01509
095250200529     C*                                                                   S01509
095260200529     C           WPSETC    IFEQ SPSCU                                     S01509
095270200529     C                     Z-ADD100000000 ZFLD15                          S01509
095280200529     C                     MOVE 'M'       SPMDI                           S01509
095290200529     C                     ELSE                                           S01509
095300200529     C*                                                                   S01509
095310200529     C* Use the spot rates of settlement and position currencies to       S01509
095320200529     C* calculate the cross rate between the two.                         S01509
095330200529     C* Note that for system generated POSETD records the position        S01509
095340200529     C* amount, if not in nominal currency, will already have been        S01509
095350200529     C* into position currency, using SEXR from SECTYD.  For records      S01509
095360200529     C* being inserted it is assumed that the user will use the correct   S01509
095370200529     C* currency.                                                         S01509
095380200529     C*                                                                   S01509
095390200529     C* Get settlement currency spot rate                                 S01509
095400200529     C*                                                                   S01509
095410200529     C                     CALL 'AOCURRR0'                                S01509
095420200529     C                     PARM '*DBERR'  @RTCD   7                       S01509
095430200529     C                     PARM '*KEY   ' @OPTN   7                       S01509
095440200529     C                     PARM WPSETC    @AJCD   3                       S01509
095450200529     C           SDCURR    PARM SDCURR    DSSDY                           S01509
095460200529     C*                                                                   S01509
095470200529     C                     Z-ADDA6SPRT    ZRATE1 138                      S01509
095480200529     C                     MOVE A6MDIN    ZMDI1   1                       S01509
095490200529     C*                                                                   S01509
095500200529     C* Get position currency spot rate                                   S01509
095510200529     C*                                                                   S01509
095520200529     C*                                                                   157808
095530200529     C           PNCY      IFEQ *BLANKS                                   157808
095540200529     C                     MOVE SPNCY     PNCY                            157808
095550200529     C                     END                                            157808
095560200529     C*                                                                   157808
095570200529     C                     CALL 'AOCURRR0'                                S01509
095580200529     C                     PARM '*DBERR'  @RTCD   7                       S01509
095590200529     C                     PARM '*KEY   ' @OPTN   7                       S01509
095600200529     C                     PARM PNCY      @AJCD   3                       S01509
095610200529     C           SDCURR    PARM SDCURR    DSSDY                           S01509
095620200529     C*                                                                   S01509
095630200529     C                     Z-ADDA6SPRT    ZRATE2 138                      S01509
095640200529     C                     MOVE A6MDIN    ZMDI2   1                       S01509
095650200529     C                     EXSR ZXRATE                                    S01509
095660200529     C*                                                                   S01509
095670200529     C                     MOVE ZRATEX    ZFLD15                          S01509
095680200529     C                     MOVE ZMDIX     SPMDI                           S01509
095690200529     C                     END                                            S01509
095700200529     C*                                                                   S01509
095710200529     C                     Z-ADD8         ZDECS                           S01509
095720200529     C                     MOVE ' '       ZECODE                          S01509
095730200529     C                     EXSR ZSEDIT                                    S01509
095740200529     C                     MOVEL*BLANKS   SPSXR                           S01509
095750200529     C                     MOVE ZOUT21    SPSXR                           S01509
095760200529     C                     END                                            S01509
095770200529     C/COPY WNCPYSRC,SE0170C001
095780200529     C*
095790200529     C**  BASE CURRENCY RATE
095800200529     C*
095810200529     C           SPBRX     IFEQ *BLANKS
095820200529     C           PBRX      ANDEQ0
095830200529     C*
095840200529     C****GET*SETTLEMENT*CURRENCY*RECORD*FROM*TABTG10*AND*USE*SPOT*RATE   S01117
095850200529     C**  Get Settlement Currency record from Currency file               S01117
095860200529     C*
095870200529     C***********          MOVE *BLANKS   KEY                             S01117
095880200529     C***********          MOVEL'20'      TYPE                            S01117
095890200529     C***********          MOVE '1'       KEY                             S01117
095900200529     C***********          MOVELSPSCU     KCCY2                           S01117
095910200529     C***********TABKEY    CHAINTABTG10F             99                   S01117
095920200529     C************IN99     IFEQ '0'                                       S01117
095930200529     C***********RECI      ANDNE'*'                                       S01117
095940200529     C***********                                                         S01117
095950200529     C***********          MOVE SPOT      ZFLD15                          S01117
095960200529     C                     CALL 'AOCURRR0'                                S01117
095970200529     C                     PARM '*DBERR'  @RTCD   7                       S01117
095980200529     C                     PARM '*KEY   ' @OPTN   7                       S01117
095990200529     C                     PARM SPSCU     @AJCD   3                       S01117
096000200529     C           SDCURR    PARM SDCURR    DSSDY                           S01117
096010200529     C*                                                                   S01117
096020200529     C                     MOVE A6SPRT    ZFLD15                          S01117
096030200529     C                     Z-ADD8         ZDECS
096040200529     C                     MOVE ' '       ZECODE
096050200529     C                     EXSR ZSEDIT
096060200529     C                     MOVEL*BLANKS   SPBRX
096070200529     C                     MOVE ZOUT21    SPBRX
096080200529     C*
096090200529     C***********          END                                            S01117
096100200529     C                     END
096110200529     C/COPY WNCPYSRC,SE0170C089
096120200529     C*
096130200529     C**  GENERATE DEFLTS FOR THE FOLLOWING FIELDS
096140200529     C*
096150200529     C**  SETTLEMENT METHOD  &
096160200529     C**  SETTLEMENT ACCOUNT &
096170200529     C**  SETTLEMENT BRANCH  &
096180200529     C**  COUNTERPARTY BANK  &
096190200529     C**  FOR A/C OF         &
096200200529     C**  SPECIAL INSTRUCTIONS
096210200529     C*
096220200529     C                     MOVELSPSCU     CURK
096230200529     C/COPY WNCPYSRC,SE0170C038
096240200529      *                                                                                       CSE028
096250200529      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
096260200529      *                                                                                       CSE028
096270200529     C           CSE028    IFEQ 'Y'                                                           CSE028
096280200529      *                                                                                       CSE028
096290200529     C                     MOVE PBCD      WBKCD                                               CSE028
096300200529     C                     EXSR SRSSIR                                                        CSE028
096310200529     C           NOTFND    IFEQ 'Y'                                                           CSE028
096320200529     C                     MOVE '1'       *IN99                                               CSE028
096330200529     C                     ELSE                                                               CSE028
096340200529     C                     MOVE '0'       *IN99                                               CSE028
096350200529     C                     ENDIF                                                              CSE028
096360200529      *                                                                                       CSE028
096370200529     C                     ELSE                                                               CSE028
096380200529      *                                                                                       CSE028
096390200529     C                     MOVE *BLANKS   WBKCD                                               CSE028
096400200529      *                                                                                       CSE028
096410200529     C           STDSEK    CHAINSTDSED               99
096420200529      *                                                                                       CSE028
096430200529     C                     ENDIF                                                              CSE028
096440200529      *                                                                                       CSE028
096450200529     C/COPY WNCPYSRC,SE0170C039
096460200529     C           *IN99     IFEQ '0'
096470200529     C*                                                                   CEU005
096480200529     C** If CEU005 is active use date defaults here.                      CEU005
096490200529     C*                                                                   CEU005
096500200529     C           CEU005    IFEQ 'Y'                                       CEU005
096510200529     C           S01512    IFEQ 'Y'                                       CEU005
096520200529     C           PSVL      IFEQ 0                                         CEU005
096530200529     C                     MOVELSPDUD     SPSVL                           CEU005
096540200529     C                     MOVE SPDUD     ZDATE                           CEU005
096550200529     C                     EXSR ZDATE1                                    CEU005
096560200529     C                     MOVELZDAYNO    PSVL                            CEU005
096570200529     C                     ELSE                                           CEU005
096580200529     C                     Z-ADDPSVL      ZDAYNO                          CEU005
096590200529     C                     EXSR ZDATE2                                    CEU005
096600200529     C                     MOVELZDATE     SPSVL                           CEU005
096610200529     C                     END                                            CEU005
096620200529     C                     END                                            CEU005
096630200529     C                     ENDIF                                          CEU005
096640200529     C*                                                                   CEU005
096650200529     C** If CEU005 is on check for EURO Currency.                         CEU005
096660200529     C*                                                                   CEU005
096670200529     C           CEU005    IFEQ 'Y'                                       CEU005
096680200529     C           SCCY      ANDNE*BLANKS                                   CEU005
096690200529     C*                                                                   CEU005
096700200529     C** If the Due Currency is the EURO Currency.                        CEU005
096710200529     C*                                                                   CEU005
096720200529     C           SPNCY     IFEQ BKEURO                                    CEU005
096730200529     C                     CALL 'AOCURRR0'                                CEU005
096740200529     C                     PARM *BLANKS   @RTCD                           CEU005
096750200529     C                     PARM '*KEY   ' @OPTN                           CEU005
096760200529     C                     PARM SCCY      @AJCD                           CEU005
096770200529     C           SDCURR    PARM SDCURR    DSSDY                           CEU005
096780200529     C           @RTCD     IFNE *BLANKS                                   CEU005
096790200529     C                     MOVEL'SDCURRPD'DBFILE           ***************CEU005
096800200529     C                     MOVEL'020'     DBASE            * DBERROR 020 *CEU005
096810200529     C                     MOVELSCCY      DBKEY            ***************CEU005
096820200529     C                     EXSR *PSSR                                     CEU005
096830200529     C                     END                                            CEU005
096840200529     C                     Z-ADD0         DATE                            CEU005
096850200529     C                     MOVE PSVL      DATE                            CEU005
096860200529     C*                                                                   CEU005
096870200529     C** If the Currency is 'IN' then enter the exchange rate             CEU005
096880200529     C** and mult/div indicator of the currency into POSETD.              CEU005
096890200529     C*                                                                   CEU005
096900200529     C           A6INCY    IFEQ 'Y'                                       CEU005
096910200529     C           DATE      ANDGEA6TPSD                                    CEU005
096920200529     C                     Z-ADDA6EUER    PSXR                            CEU005
096930200529     C                     MOVE PSXR      ZFLD15                          CEU005
096940200529     C                     Z-ADD8         ZDECS                           CEU005
096950200529     C                     MOVE ' '       ZECODE                          CEU005
096960200529     C                     EXSR ZSEDIT                                    CEU005
096970200529     C                     MOVEL*BLANKS   SPSXR                           CEU005
096980200529     C                     MOVE ZOUT21    SPSXR                           CEU005
096990200529     C*                                                                   CEU005
097000200529     C           A6EUMD    IFEQ 'M'                                       143690
097010200529     C                     MOVE 'D'       PMDI                            143690
097020200529     C                     MOVE 'D'       SPMDI                           143690
097030200529     C                     ELSE                                           143690
097040200529     C                     MOVE 'M'       PMDI                            143690
097050200529     C                     MOVE 'M'       SPMDI                           143690
097060200529     C                     ENDIF                                          143690
097070200529     C***********          MOVE A6EUMD    PMDI                     CEU005 143690
097080200529     C***********          MOVE A6EUMD    SPMDI                    CEU005 143690
097090200529     C                     ENDIF                                          CEU005
097100200529     C*                                                                   CEU005
097110200529     C                     ENDIF                                          CEU005
097120200529     C*                                                                   CEU005
097130200529     C** If the Settlement Currency is the EURO Currency.                 CEU005
097140200529     C*                                                                   CEU005
097150200529     C           SCCY      IFEQ BKEURO                                    CEU005
097160200529     C                     CALL 'AOCURRR0'                                CEU005
097170200529     C                     PARM *BLANKS   @RTCD                           CEU005
097180200529     C                     PARM '*KEY   ' @OPTN                           CEU005
097190200529     C                     PARM SPNCY     @AJCD                           CEU005
097200200529     C           SDCURR    PARM SDCURR    DSSDY                           CEU005
097210200529     C           @RTCD     IFNE *BLANKS                                   CEU005
097220200529     C                     MOVEL'SDCURRPD'DBFILE           ***************CEU005
097230200529     C                     MOVEL'021'     DBASE            * DBERROR 021 *CEU005
097240200529     C                     MOVELSPNCY     DBKEY            ***************CEU005
097250200529     C                     EXSR *PSSR                                     CEU005
097260200529     C                     END                                            CEU005
097270200529     C                     Z-ADD0         DATE                            CEU005
097280200529     C                     MOVE PSVL      DATE                            CEU005
097290200529     C*                                                                   CEU005
097300200529     C** If the Currency is 'IN' then enter the exchange rate             CEU005
097310200529     C** and mult/div indicator of the currency into POSETD.              CEU005
097320200529     C*                                                                   CEU005
097330200529     C           A6INCY    IFEQ 'Y'                                       CEU005
097340200529     C           DATE      ANDGEA6TPSD                                    CEU005
097350200529     C                     Z-ADDA6EUER    PSXR                            CEU005
097360200529     C                     MOVE PSXR      ZFLD15                          CEU005
097370200529     C                     Z-ADD8         ZDECS                           CEU005
097380200529     C                     MOVE ' '       ZECODE                          CEU005
097390200529     C                     EXSR ZSEDIT                                    CEU005
097400200529     C                     MOVEL*BLANKS   SPSXR                           CEU005
097410200529     C                     MOVE ZOUT21    SPSXR                           CEU005
097420200529     C*                                                                   CEU005
097430200529     C                     MOVE A6EUMD    PMDI                            143690
097440200529     C                     MOVE A6EUMD    SPMDI                           143690
097450200529     C***********A6EUMD    IFEQ 'M'                                CEU005 143690
097460200529     C***********          MOVE 'D'       PMDI                     CEU005 143690
097470200529     C***********          MOVE 'D'       SPMDI                    CEU005 143690
097480200529     C***********          ELSE                                    CEU005 143690
097490200529     C***********          MOVE 'M'       PMDI                     CEU005 143690
097500200529     C***********          MOVE 'M'       SPMDI                    CEU005 143690
097510200529     C***********          ENDIF                                   CEU005 143690
097520200529     C                     ENDIF                                          CEU005
097530200529     C*                                                                   CEU005
097540200529     C                     ENDIF                                          CEU005
097550200529     C*                                                                   CEU005
097560200529     C                     ENDIF                                          CEU005
097570200529     C*                                                                   CEU005
097580200529     C*
097590200529     C**  IF S/D CUSTOMER
097600200529     C*
097610200529     C***********C1DI      IFEQ 'S'                                       S01117
097620200529     C***********C1DI      OREQ 'D'                                       S01117
097630200529     C           BFCLAS    IFEQ 'S'                                       S01117
097640200529     C           BFCLAS    OREQ 'D'                                       S01117
097650200529     C*
097660200529     C           PEVT      IFEQ 'PP'
097670200529     C           PSMT      IFEQ 0
097680200529     C                     MOVELSRSM      SPSMT
097690200529     C                     END
097700200529     C           PSEA      IFEQ *BLANKS
097710200529     C                     MOVELSRAC      SPSEA
097720200529     C                     END
097730200529     C           PSEB      IFEQ *BLANKS
097740200529     C***********          MOVELSRBR      SPSEB                           S01117
097750200529     C                     MOVELSRAB      SPSEB                           S01117
097760200529     C                     END
097770200529     C           PCPN      IFEQ *BLANKS
097780200529     C                     MOVELSRCB      SPCPN
097790200529     C                     END
097800200529     C                     MOVELSPSI      SPSPI
097810200529     C                     ELSE
097820200529     C           PSMT      IFEQ 0
097830200529     C                     MOVELSPSM      SPSMT
097840200529     C                     END
097850200529     C           PSEA      IFEQ *BLANKS
097860200529     C***********          MOVELSRAC      SPSEA                           E17178
097870200529     C                     MOVELSPAT      SPSEA                           E17178
097880200529     C                     END
097890200529     C           PSEB      IFEQ *BLANKS
097900200529     C***********          MOVELSPBR      SPSEB                           S01117
097910200529     C                     MOVELSPBA      SPSEB                           S01117
097920200529     C                     END
097930200529     C           PCPN      IFEQ *BLANKS
097940200529     C                     MOVELSPCB      SPCPN
097950200529     C                     END
097960200529     C           PFAC      IFEQ *BLANKS
097970200529     C                     MOVELSPFA      SPFAC
097980200529     C                     END
097990200529     C           PSPI      IFEQ *BLANKS
098000200529     C                     MOVELSPSI      SPSPI
098010200529     C                     END
098020200529     C                     END
098030200529     C*
098040200529     C**  ELSE DEPOT
098050200529     C*
098060200529     C                     ELSE
098070200529     C           PEVT      IFNE 'PP'
098080200529     C           PSMT      IFEQ 0
098090200529     C                     MOVELSRSM      SPSMT
098100200529     C                     END
098110200529     C           PSEA      IFEQ *BLANKS
098120200529     C                     MOVELSRAC      SPSEA
098130200529     C                     END
098140200529     C           PSEB      IFEQ *BLANKS
098150200529     C***********          MOVELSRBR      SPSEB                           S01117
098160200529     C                     MOVELSRAB      SPSEB                           S01117
098170200529     C                     END
098180200529     C           PCPN      IFEQ *BLANKS
098190200529     C                     MOVELSRCB      SPCPN
098200200529     C                     END
098210200529     C                     MOVELSPSI      SPSPI
098220200529     C                     ELSE
098230200529     C           PSMT      IFEQ 0
098240200529     C                     MOVELSPSM      SPSMT
098250200529     C                     END
098260200529     C           PSEA      IFEQ *BLANKS
098270200529     C                     MOVELSRAC      SPSEA
098280200529     C                     END
098290200529     C           PSEB      IFEQ *BLANKS
098300200529     C***********          MOVELSPBR      SPSEB                           S01117
098310200529     C                     MOVELSPBA      SPSEB                           S01117
098320200529     C                     END
098330200529     C           PCPN      IFEQ *BLANKS
098340200529     C                     MOVELSPCB      SPCPN
098350200529     C                     END
098360200529     C           PFAC      IFEQ *BLANKS
098370200529     C                     MOVELSPFA      SPFAC
098380200529     C                     END
098390200529     C           PSPI      IFEQ *BLANKS
098400200529     C                     MOVELSPSI      SPSPI
098410200529     C                     END
098420200529     C                     END
098430200529     C                     END
098440200529     C*                                                                   E14878
098450200529     C                     ELSE                                           E14878
098460200529     C*                                                                   E14878
098470200529     C**  NO DEFAULT SETTLEMENT INSTRUCTIONS, CHECK IF MULTIBRANCH        E14878
098480200529     C****ENVIRONMENT.*IF*NOT,*SETTLEMENT*BRANCH*DEFAULTS*TO*'001'.****   E14878
098490200529     C**  ENVIRONMENT. IF NOT, SETTLEMENT BRANCH DEFAULTS FROM ZMUSER.    E14878
098500200529     C*                                                                   E14878
098510200529     C           MBIN      IFEQ 'N'                                       E14878
098520200529     C***********          MOVE '001'     SPSEB                    E14878 S01117
098530200529     C                     MOVE USRBCH    SPSEB                           S01117
098540200529     C                     END                                            E14878
098550200529     C/COPY WNCPYSRC,SE0170C013
098560200529     C                     END
098570200529     C/COPY WNCPYSRC,SE0170C074
098580200529     C                     ELSE
098590200529     C*
098600200529     C**  GENERATE DEFAULT FOR PAY/RECEIVE IND IF BLANK
098610200529     C*
098620200529     C***********SPMDI     IFEQ *BLANKS                                   E14881
098630200529     C           SPPRE     IFEQ *BLANKS                                   E14881
098640200529     C*
098650200529     C**  IF CUSTOMER S/D
098660200529     C*
098670200529     C***********C1DI      IFEQ 'S'                                       S01117
098680200529     C***********C1DI      OREQ 'D'                                       S01117
098690200529     C           BFCLAS    IFEQ 'S'                                       S01117
098700200529     C           BFCLAS    OREQ 'D'                                       S01117
098710200529     C           PEVT      IFEQ 'PP'
098720200529     C           PNMP      IFGE 0
098730200529     C                     MOVE 'R'       SPPRE
098740200529     C                     ELSE
098750200529     C                     MOVE 'P'       SPPRE
098760200529     C                     END
098770200529     C                     ELSE
098780200529     C           PNMP      IFGE 0
098790200529     C                     MOVE 'P'       SPPRE
098800200529     C                     ELSE
098810200529     C                     MOVE 'R'       SPPRE
098820200529     C                     END
098830200529     C                     END
098840200529     C*
098850200529     C**  ELSE DEPOT
098860200529     C*
098870200529     C                     ELSE
098880200529     C           PEVT      IFEQ 'PP'
098890200529     C           PNMP      IFGE 0
098900200529     C                     MOVE 'P'       SPPRE
098910200529     C                     ELSE
098920200529     C                     MOVE 'R'       SPPRE
098930200529     C                     END
098940200529     C                     ELSE
098950200529     C           PNMP      IFGE 0
098960200529     C                     MOVE 'R'       SPPRE
098970200529     C                     ELSE
098980200529     C                     MOVE 'P'       SPPRE
098990200529     C                     END
099000200529     C                     END
099010200529     C                     END
099020200529     C                     END
099030200529     C/COPY WNCPYSRC,SE0170C090
099040200529     C                     END
099050200529     C*                                                                   S01512
099060200529     C** If S01512 is active, value date defaults to due date             S01512
099070200529     C*                                                                   S01512
099080200529     C** If CEU005 is active do not use date defaults here.               CEU005
099090200529     C           CEU005    IFNE 'Y'                                       CEU005
099100200529     C           S01512    IFEQ 'Y'                                       S01512
099110200529     C           PSVL      IFEQ 0                                         S01512
099120200529     C                     MOVELSPDUD     SPSVL                           S01512
099130200529     C                     ELSE                                           S01512
099140200529     C                     Z-ADDPSVL      ZDAYNO                          S01512
099150200529     C                     EXSR ZDATE2                                    S01512
099160200529     C                     MOVELZDATE     SPSVL                           S01512
099170200529     C                     END                                            S01512
099180200529     C                     END                                            S01512
099190200529     C                     ENDIF                                          CEU005
099200200529     C*
099210200529     C                     MOVE SPSXR     WXRATP                                              197896
099220200529      *                                                                                       CER049
099230200529     C           CER049    IFEQ 'Y'                                                           CER049
099240200529     C           SPTAXL    ANDEQ*BLANKS                                                       CER049
099250200529     C                     MOVE 'N'       SPTAXL                                              CER049
099260200529     C                     EXSR SRSTAX                                                        CER049
099270200529     C                     ENDIF                                                              CER049
099280200529      *                                                                   S01447
099290200529     C                     ENDSR
099300200529     C*
099310200529     C*****************************************************************
099320200529      /EJECT
099330200529     C*****************************************************************
099340200529     C*                                                               *
099350200529     C*  INITRC  - S/R TO INITIALISE ALL FILE FIELDS TO ZERO/BLANK    *
099360200529     C*  CALLED FROM: UPDATE; UPDFLS                                  *
099370200529     C*  CALLS: NO OTHER S/R'S                                        *
099380200529     C*                                                               *
099390200529     C*****************************************************************
099400200529     C*
099410200529     C           INITRC    BEGSR
099420200529     C*
099430200529     C** INITIALIZE ALL DATA ON RECORD DEFINED IN DETREC (KEY EXCLUDED)
099440200529     C*
099450200529     C                     MOVEL*BLANKS   DETREC
099460200529     C***********          MOVEL*BLANKS   DETS                     068993 080356
099470200529     C                     Z-ADD0         PNMP
099480200529     C                     Z-ADD0         PAMD
099490200529     C                     Z-ADD0         PSXR
099500200529     C                     Z-ADD0         PBRX
099510200529     C                     Z-ADD0         PSMT
099520200529     C                     Z-ADD0         PCHA
099530200529     C                     Z-ADD0         PCAM
099540200529     C                     Z-ADD0         PSAT
099550200529     C                     Z-ADD0         WPSAT                           173501
099560200529     C                     Z-ADD0         LCD
099570200529     C***********          Z-ADD0         TNLU                            S01486
099580200529     C                     Z-ADD0         TNLUX                           S01486
099590200529     C                     Z-ADD0         PDTG
099600200529     C                     Z-ADD0         PSVL                            S01512
099610200529     C                     Z-ADD0         BAUS                            S01496
099620200529     C*
099630200529     C                     CLEARTASO                                      S01447
099640200529     C                     CLEARTASR                                      S01447
099650200529     C                     CLEARTAUS                                      S01447
099660200529     C                     Z-ADD*ZERO     TXNM                                                233711
099670200529     C                     Z-ADD*ZERO     TXST                                                233711
099680200529     C                     Z-ADD*ZERO     TAXA                                                233711
099690200529     C                     Z-ADD0         PSEQ                                                247951
099700200529     C                     Z-ADD0         DAMT                                                247951
099710200529     C*
099720200529     C** Initialize field TNL1 before each insert or else DB error        108001
099730200529     C** occurs                                                           108001
099740200529     C*                                                                   108001
099750200529     C/COPY WNCPYSRC,SE0170C007
099760200529     C           ACTN      IFEQ 'I'                                       130059
099770200529     C                     Z-ADD0         TNL1                            108001
099780200529     C                     MOVE *BLANKS   TXCY                                                233711
099790200529     C                     END                                            130059
099800200529     C/COPY WNCPYSRC,SE0170C008
099810200529     C*                                                                   108001
099820200529     C                     ENDSR
099830200529     C*
099840200529     C*****************************************************************
099850200529      /EJECT
099860200529     C*****************************************************************
099870200529     C*                                                               *
099880200529     C*  TRSFS  - S/R TO FORMAT RECORD FIELDS FOR SCREEN              *
099890200529     C*  CALLED FROM: UPDATE                                          *
099900200529     C*  CALLS: ZSEDIT                                                *
099910200529     C*                                                               *
099920200529     C*****************************************************************
099930200529     C*
099940200529     C           TRSFS     BEGSR
099950200529     C*
099960200529     C*                                                                   S01496
099970200529     C** FILL SPMTRV  (MATURED/REVERSED)                                  S01496
099980200529     C*                                                                   S01496
099990200529     C           S01496    IFEQ 'Y'                                       S01496
100000200529     C           CSE007    OREQ 'Y'                                       CSE007
100010200529     C           CEU017    OREQ 'Y'                                       CEU017
100020200529     C*                                                                   S01496
100030200529     C                     MOVEL*BLANKS   SPMTRV                          S01496
100040200529     C                     MOVE *OFF      *IN32                           S01496
100050200529     C           WWRECI    IFEQ 'M'                                       S01496
100060200529     C                     MOVEL'MATURED 'SPMTRV                          S01496
100070200529     C                     MOVE *ON       *IN32                           S01496
100080200529     C                     ELSE                                           S01496
100090200529     C           WWRECI    IFEQ 'R'                                       S01496
100100200529     C                     MOVEL'REVERSED'SPMTRV                          S01496
100110200529     C                     MOVE *ON       *IN32                           S01496
100120200529     C                     ENDIF                                          S01496
100130200529     C                     ENDIF                                          S01496
100140200529     C*                                                                   S01496
100150200529     C                     ENDIF                                          S01496
100160200529      *                                                                   185397
100170200529      ** Record already found in SR UPDATE so do not need to chain        185397
100180200529      ** again here.                                                      185397
100190200529     C**********                                                   095550 185397
100200200529     C****DEFINE*KEY*LIST*FOR*CHAINING*TO*POSET*FILE*WITH*PORTFOLIO095550 185397
100210200529     C*****MANAGEMENT*INSTALLED                                    095550 185397
100220200529     C**********                                                   095550 185397
100230200529     C********** PTFRKC    KLIST                                   095550 185397
100240200529     C**********           KFLD           SPBCA                    095550 185397
100250200529     C**********           KFLD           SPSSH                    095550 185397
100260200529     C**********           KFLD           SPCPYX                   095550 185397
100270200529     C**********           KFLD           SDUDX                    095550 185397
100280200529     C**********           KFLD           SPEVT                    095550 185397
100290200529     C**********           KFLD           SPPTFR                   095550 185397
100300200529     C**********           KFLD           SPTNLU                   141869 185397
100310200529     C**********                                                   095550 185397
100320200529     C**********           MOVE SPDUD     PPDUDN  60               095550 185397
100330200529     C**********           Z-ADDPPDUDN    ZDATE                    095550 185397
100340200529     C**********           EXSR ZDATE1                             095550 185397
100350200529     C**********           Z-ADDZDAYNO    SDUDX   50               095550 185397
100360200529     C**********           MOVELSPCPY     SPCPYX  60               095550 185397
100370200529     C**********                                                   095550 185397
100380200529     C********** PTFRKC    CHAINPOSETX               99            095550 185397
100390200529     C**********                                                   095550 185397
100400200529     C**  TRANSLATE PAUI (#ALPV) AUTH IND
100410200529     C*
100420200529     C**********           MOVELPAUI      SPAUI                                             AR324886
100430200529     C*
100440200529     C**  TRANSLATE PNMP (#AMNT)  NOMINAL POSITION
100450200529     C*
100460200529     C           WWPTYP    IFEQ 'CC'                                      CEU017
100470200529     C                     Z-ADDNMDPOS    NMDP                            CEU017
100480200529     C                     ENDIF                                          CEU017
100490200529     C*                                                                   CEU017
100500200529     C                     MOVE PNMP      ZFLD15
100510200529     C***********          Z-ADD4         ZDECS                           NA
100520200529     C                     Z-ADDNMDP      ZDECS                           NA
100530200529     C                     MOVE ' '       ZECODE
100540200529     C                     EXSR ZSEDIT
100550200529     C                     MOVEL*BLANKS   SPNMP
100560200529     C                     MOVE ZOUT21    SPNMP
100570200529     C*
100580200529     C**  TRANSLATE PNCY (#ALPV)  NOMINAL CURRENCY
100590200529     C*
100600200529     C                     MOVELPNCY      SPNCY
100610200529     C*
100620200529     C**  Fetch Nominal Currency decimal places
100630200529     C** If S01509 is active, bypass processing for nominal currency      S01509
100640200529     C*
100650200529     C***********          MOVE *BLANKS   KEY                             S01117
100660200529     C***********          MOVEL'20'      TYPE                            S01117
100670200529     C***********          MOVE '1'       KEY                             S01117
100680200529     C***********          MOVELPNCY      KCCY2                           S01117
100690200529     C***********TABKEY    CHAINTABTG10F             99                   S01117
100700200529     C***********          Z-ADDCDP       NOMCDP                          S01117
100710200529     C           S01509    IFEQ 'N'                                       S01509
100720200529     C                     CALL 'AOCURRR0'                                S01117
100730200529     C                     PARM '*DBERR'  @RTCD                           S01117
100740200529     C                     PARM '*KEY   ' @OPTN                           S01117
100750200529     C***********          PARM PNCY      @AJCD   3                S01117 S01509
100760200529     C                     PARM NMCY      @AJCD   3                       S01509
100770200529     C           SDCURR    PARM SDCURR    DSSDY                           S01117
100780200529     C*                                                                   S01117
100790200529     C                     Z-ADDA6NBDP    NOMCDP                          S01117
100800200529     C                     MOVE A6CYCD    NOMCCY                                              233711
100810200529     C                     END                                            S01509
100820200529     C*                                                                   S01512
100830200529     C** Translate PSVL - value date if S01512 is active                  S01512
100840200529     C*                                                                   S01512
100850200529     C           S01512    IFEQ 'Y'                                       S01512
100860200529     C                     Z-ADDPSVL      ZDAYNO                          S01512
100870200529     C                     EXSR ZDATE2                                    S01512
100880200529     C                     MOVELZDATE     SPSVL                           S01512
100890200529     C                     END                                            S01512
100900200529     C*
100910200529     C**  TRANSLATE PBCD (#ALPV)
100920200529     C*
100930200529     C                     MOVELPBCD      SPBCD
100940200529     C*                                                                   S01117
100950200529     C**  TRANSLATE PPFC (#ALPV)                                          S01117
100960200529     C*                                                                   S01117
100970200529     C           *IN82     IFEQ '1'                                       S01117
100980200529     C                     MOVELPPFC      SPPFC                           S01117
100990200529     C                     END                                            S01117
101000200529     C*
101010200529     C**  TRANSLATE PAMD (#AMNT) AMOUNT DUE
101020200529     C** Fetch Payment Currency decimal places if S01509 is active        S01509
101030200529     C*                                                                   S01509
101040200529     C           S01509    IFEQ 'Y'                                       S01509
101050200529     C                     CALL 'AOCURRR0'                                S01509
101060200529     C                     PARM '*DBERR'  @RTCD                           S01509
101070200529     C                     PARM '*KEY   ' @OPTN                           S01509
101080200529     C                     PARM PNCY      @AJCD   3                       S01509
101090200529     C           SDCURR    PARM SDCURR    DSSDY                           S01509
101100200529     C*                                                                   S01509
101110200529     C                     Z-ADDA6NBDP    POSCDP                          S01509
101120200529     C                     MOVE A6CYCD    POSCCY                                              233711
101130200529     C                     END                                            S01509
101140200529     C*                                                                   S01509
101150200529     C           PAMD      IFNE 0
101160200529     C                     MOVE PAMD      ZFLD15
101170200529     C           S01509    IFEQ 'Y'                                       S01509
101180200529     C                     Z-ADDPOSCDP    ZDECS                           S01509
101190200529     C                     ELSE                                           S01509
101200200529     C                     Z-ADDNOMCDP    ZDECS
101210200529     C                     END                                            S01509
101220200529     C                     MOVE ' '       ZECODE
101230200529     C                     EXSR ZSEDIT
101240200529     C                     MOVEL*BLANKS   SPAMD
101250200529     C                     MOVE ZOUT21    SPAMD
101260200529     C                     ELSE
101270200529     C                     MOVEL*BLANKS   SPAMD
101280200529     C                     END
101290200529     C/COPY WNCPYSRC,SE0170C113
101300200529     C*
101310200529     C**  TRANSLATE PPRE (#ALPV) PAY/RECEIVE INDICATOR
101320200529     C*
101330200529     C                     MOVELPPRE      SPPRE
101340200529     C*
101350200529     C**  TRANSLATE PSCU (#ALPV) SETTLEMENT CURRENCY
101360200529     C*
101370200529     C                     MOVELPSCU      SPSCU
101380200529     C                     MOVELPSCU      XSPSCU                          151506
101390200529     C*
101400200529     C**  TRANSLATE PSXR (#AMNT) SETTLEMENT EXCHANGE RATE
101410200529     C*
101420200529     C           PSXR      IFNE 0
101430200529      *                                                                   CAC002
101440200529      **  Re-calculate exchange rate if anal acctg is installed, so       CAC002
101450200529      **  that what would be shown would be the rate entered              CAC002
101460200529      *                                                                   CAC002
101470200529     C           BGN0ST    IFEQ 'Y'                                       CAC002
101480200529     C           PPRE      IFEQ 'R'                                       CAC002
101490200529     C           PMDI      ANDEQ'M'                                       CAC002
101500200529     C           PPRE      OREQ 'P'                                       CAC002
101510200529     C           PMDI      ANDEQ'D'                                       CAC002
101520200529     C                     SUB  FXMR      PSXR                            CAC002
101530200529     C                     ELSE                                           CAC002
101540200529     C                     ADD  FXMR      PSXR                            CAC002
101550200529     C                     ENDIF                                          CAC002
101560200529     C                     ENDIF                                          CAC002
101570200529      *                                                                   CAC002
101580200529     C                     MOVE PSXR      ZFLD15
101590200529     C                     Z-ADD8         ZDECS
101600200529     C                     MOVE ' '       ZECODE
101610200529     C                     EXSR ZSEDIT
101620200529     C                     MOVEL*BLANKS   SPSXR
101630200529     C                     MOVE ZOUT21    SPSXR
101640200529      *                                                                   CAC002
101650200529      **  Restore back original PSXR if anal acctg is installed           CAC002
101660200529      *                                                                   CAC002
101670200529     C           BGN0ST    IFEQ 'Y'                                       CAC002
101680200529     C           PPRE      IFEQ 'R'                                       CAC002
101690200529     C           PMDI      ANDEQ'M'                                       CAC002
101700200529     C           PPRE      OREQ 'P'                                       CAC002
101710200529     C           PMDI      ANDEQ'D'                                       CAC002
101720200529     C                     ADD  FXMR      PSXR                            CAC002
101730200529     C                     ELSE                                           CAC002
101740200529     C                     SUB  FXMR      PSXR                            CAC002
101750200529     C                     ENDIF                                          CAC002
101760200529     C                     ENDIF                                          CAC002
101770200529      *                                                                   CAC002
101780200529     C                     ELSE
101790200529     C                     MOVEL*BLANKS   SPSXR
101800200529     C                     END
101810200529     C*
101820200529     C**  TRANSLATE PMDI (#ALPV) SETTLEMENT EXCHANGE RATE M/D IND
101830200529     C*
101840200529     C                     MOVELPMDI      SPMDI
101850200529     C*
101860200529     C**  TRANSLATE PBRX (#AMNT) BASE EXCHANGE RATE
101870200529     C*
101880200529     C           PBRX      IFNE 0
101890200529     C                     MOVE PBRX      ZFLD15
101900200529     C                     Z-ADD8         ZDECS
101910200529     C                     MOVE ' '       ZECODE
101920200529     C                     EXSR ZSEDIT
101930200529     C                     MOVEL*BLANKS   SPBRX
101940200529     C                     MOVE ZOUT21    SPBRX
101950200529     C                     ELSE
101960200529     C                     MOVEL*BLANKS   SPBRX
101970200529     C                     END
101980200529     C*
101990200529     C**  TRANSLATE PSMT (#ALPV) SETTLEMENT METHOD
102000200529     C*
102010200529     C                     MOVELPSMT      SPSMT
102020200529     C*
102030200529     C**  TRANSLATE PSEA (#ALPV)  SETTLEMENT ACCOUNT
102040200529     C*
102050200529     C                     MOVELPSEA      SPSEA
102060200529     C*
102070200529     C**  TRANSLATE PSEB (#NUMV)  SETTLEMENT BRANCH
102080200529     C**IF*BLANK*THEN*SET*TO*DEFAULT*SE*BRANCH*FROM*TABTB36***      E23192S01117
102090200529     C** If blank use default from DTAARA/ZMUSER                          S01117
102100200529     C*
102110200529     C           PSEB      IFNE *ZERO
102120200529     C           PSEB      ANDNE*BLANKS                                   E23192
102130200529     C                     MOVELPSEB      SPSEB
102140200529     C                     ELSE
102150200529     C*********************MOVEL*BLANKS   SPSEB                           E23192
102160200529     C***********          MOVE DSTB      SPSEB                     E23192S01117
102170200529     C                     MOVELUSRBCH    SPSEB                           S01117
102180200529     C                     END                             *PSEB
102190200529     C*
102200200529     C**  TRANSLATE PCPN (#ALPV)  COUNTERPARTY BANK
102210200529     C*
102220200529     C                     MOVELPCPN      SPCPN
102230200529     C*
102240200529     C**  TRANSLATE PFAC (#ALPV)  FOR A/C OF
102250200529     C*
102260200529     C                     MOVELPFAC      SPFAC
102270200529     C*
102280200529     C**  TRANSLATE PSPI (#ALPV) SPECIAL INSTRUCTIONS
102290200529     C*
102300200529     C                     MOVELPSPI      SPSPI
102310200529     C*
102320200529     C**  TRANSLATE PCHC (#ALPV) CHARGE CODE
102330200529     C*
102340200529     C                     MOVELPCHC      SPCHC
102350200529     C*
102360200529     C**  TRANSLATE PCHA (#AMNT) CHARGE AMOUNT
102370200529     C*
102380200529     C           PCHA      IFNE 0
102390200529     C                     MOVE PCHA      ZFLD15
102400200529     C           S01509    IFEQ 'Y'                                       S01509
102410200529     C                     Z-ADDPOSCDP    ZDECS                           S01509
102420200529     C                     ELSE                                           S01509
102430200529     C                     Z-ADDNOMCDP    ZDECS
102440200529     C                     END                                            S01509
102450200529     C                     MOVE ' '       ZECODE
102460200529     C                     EXSR ZSEDIT
102470200529     C                     MOVEL*BLANKS   SPCHA
102480200529     C                     MOVE ZOUT21    SPCHA
102490200529     C                     ELSE
102500200529     C                     MOVEL*BLANKS   SPCHA
102510200529     C                     END
102520200529     C*
102530200529     C**  TRANSLATE PCCD (#ALPV) COMMISSION CODE
102540200529     C*
102550200529     C                     MOVELPCCD      SPCCD
102560200529     C*
102570200529     C**  TRANSLATE PCAM (#AMNT) COMMISSION AMOUNT
102580200529     C*
102590200529     C           PCAM      IFNE 0
102600200529     C                     MOVE PCAM      ZFLD15
102610200529     C           S01509    IFEQ 'Y'                                       S01509
102620200529     C                     Z-ADDPOSCDP    ZDECS                           S01509
102630200529     C                     ELSE                                           S01509
102640200529     C                     Z-ADDNOMCDP    ZDECS
102650200529     C                     END                                            S01509
102660200529     C                     MOVE ' '       ZECODE
102670200529     C                     EXSR ZSEDIT
102680200529     C                     MOVEL*BLANKS   SPCAM
102690200529     C                     MOVE ZOUT21    SPCAM
102700200529     C                     ELSE
102710200529     C                     MOVEL*BLANKS   SPCAM
102720200529     C                     END
102730200529     C*
102740200529     C**  TRANSLATE PSAT (#AMNT) SETTLEMENT AMOUNT
102750200529     C*
102760200529     C****GET*SETTLEMENT*CURRENCY*RECORD*FROM*TABTG10*AND*USE*SPOT*RATE   S01117
102770200529     C**  Get Settlement Currency record from Currency file               S01117
102780200529     C*
102790200529     C***********          MOVE *BLANKS   KEY                             S01117
102800200529     C***********          MOVEL'20'      TYPE                            S01117
102810200529     C***********          MOVE '1'       KEY                             S01117
102820200529     C***********          MOVELSPSCU     KCCY2                           S01117
102830200529     C***********TABKEY    CHAINTABTG10F             99                   S01117
102840200529     C*                                                                   S01117
102850200529     C                     CALL 'AOCURRR0'                                S01117
102860200529     C                     PARM '*DBERR'  @RTCD                           S01117
102870200529     C                     PARM '*KEY   ' @OPTN                           S01117
102880200529     C                     PARM SPSCU     @AJCD                           S01117
102890200529     C           SDCURR    PARM SDCURR    DSSDY                           S01117
102900200529      *                                                                   CAC002
102910200529      **  Translate FX Marg Points and Amount if anal acctg installed     CAC002
102920200529      *                                                                   CAC002
102930200529     C           BGN0ST    IFEQ 'Y'                                       CAC002
102940200529      *                                                                   CAC002
102950200529      **  FX Margin points and amount should not be displayed if          CAC002
102960200529      **  nominal ccy = settle ccy and action code is 'E'                 CAC002
102970200529      *                                                                   CAC002
102980200529     C           PNCY      IFEQ PSCU                                      CAC002
102990200529     C           ACTN      ANDEQ'E'                                       CAC002
103000200529     C                     MOVE '1'       *IN14                           CAC002
103010200529     C                     ELSE                                           CAC002
103020200529     C                     MOVE '0'       *IN14                           CAC002
103030200529      *                                                                   CAC002
103040200529      **  FX Margin Points                                                CAC002
103050200529      *                                                                   CAC002
103060200529     C                     MOVE *BLANKS   ZFLD15                          CAC002
103070200529     C                     MOVE FXMP      ZFLD15                          CAC002
103080200529     C                     Z-ADD2         ZDECS                           CAC002
103090200529     C                     MOVE *BLANK    ZECODE                          CAC002
103100200529     C                     EXSR ZSEDIT                                    CAC002
103110200529     C                     MOVE ZOUT21    SFXMP                           CAC002
103120200529      *                                                                   CAC002
103130200529      **  FX Margin Amount                                                CAC002
103140200529      *                                                                   CAC002
103150200529     C                     MOVE *BLANKS   ZFLD15                          CAC002
103160200529     C                     MOVE MAMT      ZFLD15                          CAC002
103170200529     C                     Z-ADDA6NBDP    ZDECS                           CAC002
103180200529     C                     MOVE 'J'       ZECODE                          CAC002
103190200529     C                     EXSR ZSEDIT                                    CAC002
103200200529     C                     MOVE *BLANKS   SMAMT                           CAC002
103210200529     C                     MOVE ZOUT21    SMAMT                           CAC002
103220200529     C                     ENDIF                                          CAC002
103230200529     C                     ENDIF                                          CAC002
103240200529     C*
103250200529     C           PSAT      IFNE 0
103260200529     C                     MOVE PSAT      ZFLD15
103270200529     C***********          Z-ADDCDP       ZDECS                           S01117
103280200529     C                     Z-ADDA6NBDP    ZDECS                           S01117
103290200529     C                     MOVE ' '       ZECODE
103300200529     C                     EXSR ZSEDIT
103310200529     C                     MOVEL*BLANKS   SPSAT
103320200529     C                     MOVE ZOUT21    SPSAT
103330200529     C                     Z-ADDPSAT      WSVPSA                          086722
103340200529     C                     ELSE
103350200529     C*                                                                   086722
103360200529     C** If amount is 0, it is possible that it hasn't been computed,     086722
103370200529     C** therefore, calculate the settlement amount for S01512            086722
103380200529     C*                                                                   086722
103390200529     C           S01512    IFEQ 'Y'                                       086722
103400200529     C                     MOVE *BLANK    W2SCR                           086722
103410200529     C                     MOVELSPCPY     CUST                            086722
103420200529     C                     CALL 'AOSECSR0'                                086722
103430200529     C                     PARM *BLANKS   @RTCD                           086722
103440200529     C                     PARM '*KEY   ' @OPTN                           086722
103450200529     C                     PARM           CUST                            086722
103460200529     C           SDSECS    PARM SDSECS    DSSDY                           086722
103470200529     C                     EXSR PSAMT                                     086722
103480200529     C                     Z-ADDWPSAT     WSVPSA                          086722
103490200529     C                     ELSE                                           086722
103500200529     C                     MOVEL*BLANKS   SPSAT
103510200529     C                     ENDIF                                          086722
103520200529     C*                                                                   086722
103530200529     C                     END
103540200529      *                                                                   S01447
103550200529      *** Find and display tax deductible fields if S01447 installed      S01447
103560200529      ** If S01509 is active, use the decimal places from position ccy
103570200529      *                                                                   S01447
103580200529     C           S01447    IFEQ 'Y'                        *B1            S01447
103590200529     C           CSE007    OREQ 'Y'                                       CSE007
103600200529     C           WWPTYP    ANDEQ'DV'                                      CSE007
103610200529     C           CEU017    OREQ 'Y'                                       CEU017
103620200529     C           WWPTYP    ANDEQ'DV'                                      CEU017
103630200529     C           CSE023    OREQ 'Y'                                       186055
103640200529      *                                                                   S01447
103650200529     C                     CLEARSTASO                                     S01447
103660200529     C                     CLEARSTASR                                     S01447
103670200529     C                     CLEARSTAUS                                     S01447
103680200529      *                                                                   S01447
103690200529     C           PEVT      IFEQ 'CP'                       *B2            S01447
103700200529     C           PEVT      OREQ 'DV'                                      S01447
103710200529     C           CSE007    OREQ 'Y'                                       CSE007
103720200529     C           WWPTYP    ANDEQ'DV'                                      CSE007
103730200529     C           CEU017    OREQ 'Y'                                       CEU017
103740200529     C           WWPTYP    ANDEQ'DV'                                      CEU017
103750200529     C           CSE023    OREQ 'Y'                                       186166
103760200529     C           PEVT      ANDEQ'MT'                                      186166
103770200529      *                                                                   S01447
103780200529     C                     MOVE TASO      ZFLD15                          S01447
103790200529     C           S01509    IFEQ 'Y'                                       S01509
103800200529     C                     Z-ADDPOSCDP    ZDECS                           S01509
103810200529     C                     ELSE                                           S01509
103820200529     C                     Z-ADDNOMCDP    ZDECS                           S01447
103830200529     C                     END                                            S01509
103840200529     C                     MOVE ' '       ZECODE                          S01447
103850200529     C                     EXSR ZSEDIT                                    S01447
103860200529     C                     MOVE ZOUT21    STASO                           S01447
103870200529      *                                                                   S01447
103880200529     C                     MOVE TASR      ZFLD15                          S01447
103890200529     C           S01509    IFEQ 'Y'                                       S01509
103900200529     C                     Z-ADDPOSCDP    ZDECS                           S01509
103910200529     C                     ELSE                                           S01509
103920200529     C                     Z-ADDNOMCDP    ZDECS                           S01447
103930200529     C                     END                                            S01509
103940200529     C                     MOVE ' '       ZECODE                          S01447
103950200529     C                     EXSR ZSEDIT                                    S01447
103960200529     C                     MOVE ZOUT21    STASR                           S01447
103970200529      *                                                                   S01447
103980200529     C                     MOVE TAUS      ZFLD15                          S01447
103990200529     C           S01509    IFEQ 'Y'                                       S01509
104000200529     C                     Z-ADDPOSCDP    ZDECS                           S01509
104010200529     C                     ELSE                                           S01509
104020200529     C                     Z-ADDNOMCDP    ZDECS                           S01447
104030200529     C                     END                                            S01509
104040200529     C                     MOVE ' '       ZECODE                          S01447
104050200529     C                     EXSR ZSEDIT                                    S01447
104060200529     C                     MOVE ZOUT21    STAUS                           S01447
104070200529      *                                                                   S01447
104080200529     C                     END                             *E2            S01447
104090200529     C                     END                             *E1            S01447
104100200529      *                                                                                       233711
104110200529      ** Display EU Tax field if necessary.                                                   233711
104120200529      *                                                                                       233711
104130200529     C           CGL031    IFEQ 'Y'                                                           233711
104140200529     C           TXNM      IFNE *ZERO                                                         233711
104150200529     C                     MOVE TXNM      ZFLD15                                              233711
104160200529     C           S01509    IFEQ 'Y'                                                           233711
104170200529     C                     Z-ADDPOSCDP    ZDECS                                               233711
104180200529     C                     ELSE                                                               233711
104190200529     C                     Z-ADDNOMCDP    ZDECS                                               233711
104200200529     C                     ENDIF                                                              233711
104210200529     C                     MOVE *BLANK    ZECODE                                              233711
104220200529     C                     EXSR ZSEDIT                                                        233711
104230200529     C                     MOVE *BLANKS   STXNM                                               233711
104240200529     C                     MOVE ZOUT21    STXNM                                               233711
104250200529     C                     ELSE                                                               233711
104260200529     C                     MOVE *BLANKS   STXNM                                               233711
104270200529     C                     ENDIF                                                              233711
104280200529     C                     ENDIF                                                              233711
104290200529      *                                                                   S01447
104300200529     C           CER049    IFEQ 'Y'                                                           CER049
104310200529     C                     MOVELPBCA      K3PBCA                                              CER049
104320200529     C                     MOVELPSSH      K3PSSH                                              CER049
104330200529     C                     MOVE PCPY      K3PCPY                                              CER049
104340200529     C                     MOVE PDUD      K3PDUD                                              CER049
104350200529     C                     MOVELPEVT      K3PEVT                                              CER049
104360200529     C                     MOVE 99999     K3TNLU                                              CER049
104370200529     C           KPOST3    SETGTPOSETDD3                                                      CER049
104380200529     C                     READPPOSETDD3                 78                                   CER049
104390200529     C           *IN78     IFEQ '0'                                                           CER049
104400200529     C           PBCA      ANDEQP3PBCA                                                        CER049
104410200529     C           PSSH      ANDEQP3PSSH                                                        CER049
104420200529     C           PCPY      ANDEQP3PCPY                                                        CER049
104430200529     C           PDUD      ANDEQP3PDUD                                                        CER049
104440200529     C           PEVT      ANDEQP3PEVT                                                        CER049
104450200529     C                     MOVE *BLANKS   SPCHCD                                            AR875296
104460200529     C                     MOVEL*BLANKS   SPTAXA                                           AR875302A
104470200529     C                     MOVEL*BLANKS   SPCHAM                                           AR875302A
104480200529     C                     MOVE P3TAX     SPTAXL                                              CER049
104490200529     C                     MOVE P3STAF    WTAXA                                               CER049
104500200529     C                     ENDIF                                                              CER049
104510200529     C           SPTAXL    IFEQ 'Y'                                                         AR880129
104520200529     C                     CALL 'SD008141'                                                    CER049
104530200529     C                     PARM BJRDNB    U#DATE  50                                          CER049
104540200529     C                     PARM 'SECURITY'U#ORGN 10                                           CER049
104550200529     C                     PARM           ##TYPE  4                                           CER049
104560200529     C                     PARM           U#CTAX 138                                          CER049
104570200529     C                     PARM           U#MTAX 138                                          CER049
104580200529     C                     PARM           U#CCCY  3                                           CER049
104590200529     C                     PARM           U#MCCY  3                                           CER049
104600200529     C                     PARM           U#CSCC  2                                           CER049
104610200529     C                     PARM           U#MSCC  2                                           CER049
104620200529     C                     PARM           U#TXTY  1                                           CER049
104630200529     C                     PARM           SDSTPD                                              CER049
104640200529      *                                                                                       CER049
104650200529      * If there is a default for the Module use this tax rate and ccy                        CER049
104660200529      * otherwise use the ICD Control defaults.                                               CER049
104670200529     C           U#MTAX    IFNE *ZEROS                                                        CER049
104680200529     C                     MOVE U#MCCY    U#SCCY                                              CER049
104690200529     C                     MOVE U#MSCC    SPCHCD                                            AR875296
104700200529     C                     ELSE                                                               CER049
104710200529     C                     MOVE U#CCCY    U#SCCY                                              CER049
104720200529     C                     MOVE U#CSCC    SPCHCD                                            AR875296
104730200529     C                     ENDIF                                                              CER049
104740200529      *                                                                                       CER049
104750200529      ** Access stamp tax currency for decimal places                                         CER049
104760200529      *                                                                                       CER049
104770200529     C                     CALL 'AOCURRR0'                                                    CER049
104780200529     C                     PARM '*DBERR'  @RTCD                                               CER049
104790200529     C                     PARM '*KEY   ' @OPTN                                               CER049
104800200529     C                     PARM U#SCCY    @AJCD                                               CER049
104810200529     C           SDCURR    PARM SDCURR    DSSDY                                               CER049
104820200529      *                                                                                       CER049
104830200529     C                     Z-ADDA6NBDP    ZDECS                                               CER049
104840200529     C                     MOVE WTAXA     ZFLD15                                              CER049
104850200529     C                     MOVE ' '       ZECODE                                              CER049
104860200529     C                     EXSR ZSEDIT                                                        CER049
104870200529     C                     MOVEL*BLANKS   SPTAXA                                              CER049
104880200529     C                     MOVEL*BLANKS   SPCHAM                                              CER049
104890200529     C                     MOVE ZOUT21    SPTAXA                                              CER049
104900200529     C                     MOVE ZOUT21    SPCHAM                                              CER049
104910200529     C                     ENDIF                                                              CER049
104920200529     C                     ENDIF                                                            AR880129
104930200529      *                                                                                       CER049
104940200529     C                     ENDSR
104950200529     C*
104960200529     C*****************************************************************
104970200529      /EJECT
104980200529      *****************************************************************   S01412
104990200529      *   SEPTVS    - Validate field 72                               *   S01412
105000200529      *   Called by - VALIDD                                          *   S01412
105010200529      *                                                               *   S01412
105020200529      *   Input     - SIL    - the field to be validated              *   S01412
105030200529      *                                                               *   S01412
105040200529      *   Output    - CUL    - the field was invalid                  *   S01412
105050200529      *****************************************************************   S01412
105060200529      *                                                                   S01412
105070200529     C           SEPTVS    BEGSR                                          S01412
105080200529      *                                                                   S01412
105090200529      ** Store the current value of indicator 88                          S01412
105100200529      *                                                                   S01412
105110200529     C                     MOVEA*IN,88    STOAR   1                       S01412
105120200529      *                                                                   S01412
105130200529     C                     Z-ADD1         L       30                      S01412
105140200529     C                     MOVE *BLANK    CUL     1                       S01412
105150200529     C                     MOVE 'F'       SSF     1                       S01412
105160200529     C                     SETOF                     88                   S01412
105170200529      *                                                                   S01412
105180200529      ** First position must be a '/'                                     S01412
105190200529      *                                                                   S01412
105200200529     C           SIL,L     IFNE '/'                                       S01412
105210200529     C                     MOVE 'E'       CUL                             S01412
105220200529     C                     END                                            S01412
105230200529      *                                                                   S01412
105240200529     C                     Z-ADD2         L                               S01412
105250200529      *                                                                   S01412
105260200529      ** The first special instruction line cannot have '/'               S01412
105270200529      ** in position 2                                                    S01412
105280200529      *                                                                   S01412
105290200529     C           SIL,L     IFEQ '/'                                       S01412
105300200529     C                     MOVE 'E'       CUL                             S01412
105310200529     C                     END                                            S01412
105320200529      *                                                                   S01412
105330200529      ** Check the line for '8a/', where 8a represents                    S01412
105340200529      ** up to eight upper case alphabetic charaters                      S01412
105350200529      *                                                                   S01412
105360200529     C           SSF       DOUEQ'T'                                       S01412
105370200529     C           L         ORGT 10                                        S01412
105380200529     C           CUL       OREQ 'E'                                       S01412
105390200529      *                                                                   S01412
105400200529     C           CSW201    IFEQ 'Y'                                                           CSW201
105410200529     C           SIL,L     LOKUPAPN                      88                                   CSW201
105420200529     C                     ELSE                                                               CSW201
105430200529     C           SIL,L     LOKUPUPA                      88               S01412
105440200529     C                     ENDIF                                                              CSW201
105450200529      *                                                                   S01412
105460200529     C           *IN88     IFNE '1'                                       S01412
105470200529     C                     MOVE 'E'       CUL                             S01412
105480200529     C                     END                                            S01412
105490200529      *                                                                   S01412
105500200529     C           SIL,L     IFEQ '/'                                       S01412
105510200529     C                     MOVE 'T'       SSF                             S01412
105520200529     C                     END                                            S01412
105530200529      *                                                                   S01412
105540200529     C                     ADD  1         L                               S01412
105550200529      *                                                                   S01412
105560200529     C                     END                                            S01412
105570200529      *                                                                   S01412
105580200529      ** Invalid if a second slash is not found                           S01412
105590200529      ** within the first ten characters of the                           S01412
105600200529      ** field being checked                                              S01412
105610200529      *                                                                   S01412
105620200529     C           SSF       IFEQ 'F'                                       S01412
105630200529     C                     MOVE 'E'       CUL                             S01412
105640200529     C                     END                                            S01412
105650200529      *                                                                   S01412
105660200529      ** Test the rest of the line for ISO format characters              S01412
105670200529      *                                                                   S01412
105680200529     C           L         DOUGT35                                        S01412
105690200529     C           CUL       OREQ 'E'                                       S01412
105700200529      *                                                                   S01412
105710200529     C           SIL,L     LOKUPSWCH                     88               S01412
105720200529      *                                                                   S01412
105730200529     C           *IN88     IFEQ '0'                                       S01412
105740200529     C                     MOVE 'E'       CUL                             S01412
105750200529     C                     END                                            S01412
105760200529      *                                                                   S01412
105770200529     C                     ADD  1         L                               S01412
105780200529      *                                                                   S01412
105790200529     C                     END                                            S01412
105800200529      *                                                                   CSW096
105810200529      ** Check for "/RCB/"                                                CSW096
105820200529      *                                                                   CSW096
105830200529     C                     MOVEL*BLANKS   USRCB   5                       CSW096
105840200529     C                     MOVEASIL,1     USRCB                           CSW096
105850200529     C           USRCB     IFEQ '/RCB/'                                   CSW096
105860200529     C                     MOVE 'X'       CUL                             CSW096
105870200529     C                     ENDIF                                          CSW096
105880200529      *                                                                   S01412
105890200529      ** Restore the current value of indicator 88                        S01412
105900200529      *                                                                   S01412
105910200529     C                     MOVEASTOAR     *IN,88                          S01412
105920200529      *                                                                   S01412
105930200529     C                     ENDSR                                          S01412
105940200529      *****************************************************************   S01412
105950200529     C/EJECT                                                              S01512
105960200529     C*****************************************************************   S01512
105970200529     C*                                                               *   S01512
105980200529     C*  PSAMT  - CALCULATE NEW SETTLEMENT AMOUNT AND AFTERWARDS      *   S01512
105990200529     C*           RE-DISPLAY THE SCREEN                               *   S01512
106000200529     C*                                                               *   S01512
106010200529     C*****************************************************************   S01512
106020200529     C*                                                                   S01512
106030200529     C           PSAMT     BEGSR                                          S01512
106040200529     C***********                                                  S01512 087178
106050200529     C***Calculate*settlement*amount*in*value*currency************ S01512 087178
106060200529     C***********                                                  S01512 087178
106070200529     C***********BFCLAS    IFEQ 'S'                        B1      S01512 087178
106080200529     C***********BFCLAS    OREQ 'D'                                S01512 087178
106090200529     C***********                                                  S01512 087178
106100200529     C***********SPPRE     IFEQ 'R'                        B2      S01512 087178
106110200529     C***********PAMD      ADD  PCHA      WRK130 130               S01512 087178
106120200529     C***********WRK130    ADD  PCAM      WRK130                   S01512 087178
106130200529     C***********          ELSE                            X2      S01512 087178
106140200529     C***********PAMD      SUB  PCHA      WRK130                   S01512 087178
106150200529     C***********WRK130    SUB  PCAM      WRK130                   S01512 087178
106160200529     C***********          END                             E2      S01512 087178
106170200529     C***********                                                  S01512 087178
106180200529     C***********          ELSE                            X1      S01512 087178
106190200529     C***********                                                  S01512 087178
106200200529     C***********SPPRE     IFEQ 'R'                        B2      S01512 087178
106210200529     C***********PAMD      SUB  PCHA      WRK130                   S01512 087178
106220200529     C***********WRK130    SUB  PCAM      WRK130                   S01512 087178
106230200529     C***********          ELSE                            X2      S01512 087178
106240200529     C***********PAMD      ADD  PCHA      WRK130                   S01512 087178
106250200529     C***********WRK130    ADD  PCAM      WRK130                   S01512 087178
106260200529     C***********          END                             E2      S01512 087178
106270200529     C***********          END                             E1      S01512 087178
106280200529     C***********                                                  S01512 087178
106290200529     C***Make*WRK130*a*positive*amount*for*conversion**************S01512 087178
106300200529     C***********                                                  S01512 087178
106310200529     C***********          MOVE 'N'       WWNEG   1                S01512 087178
106320200529     C***********WRK130    IFLT 0                                  S01512 087178
106330200529     C***********          Z-SUBWRK130    WRK130                   S01512 087178
106340200529     C***********          MOVE 'Y'       WWNEG   1                S01512 087178
106350200529     C***********          END                                     S01512 087178
106360200529     C***********                                                  S01512 087178
106370200529     C***Access*value*currency*for*decimal*places******************S01512 087178
106380200529     C***********                                                  S01512 087178
106390200529     C***********          CALL 'AOCURRR0'                         S01512 087178
106400200529     C***********          PARM '*DBERR'  @RTCD   7                S01512 087178
106410200529     C***********          PARM '*KEY   ' @OPTN   7                S01512 087178
106420200529     C***********          PARM SPNCY     @AJCD   3                S01512 087178
106430200529     C***********SDCURR    PARM SDCURR    DSSDY                    S01512 087178
106440200529     C***********          Z-ADDA6NBDP    ZCDPI                    S01512 087178
106450200529     C*                                                                   S01512
106460200529     C** Access settlement currency for decimal places                    S01512
106470200529     C*                                                                   S01512
106480200529     C                     CALL 'AOCURRR0'                                S01512
106490200529     C                     PARM '*DBERR'  @RTCD                           S01512
106500200529     C                     PARM '*KEY   ' @OPTN                           S01512
106510200529     C                     PARM SPSCU     @AJCD                           S01512
106520200529     C           SDCURR    PARM SDCURR    DSSDY                           S01512
106530200529     C*                                                                   S01512
106540200529     C                     Z-ADDA6NBDP    ZCDPO                           S01512
106550200529     C***********                                                  S01512 087178
106560200529     C***Convert*settlement*amount*from*value*currency*to*settlemenS01512 087178
106570200529     C***currency**************************************************S01512 087178
106580200529     C***********                                                  S01512 087178
106590200529     C***********          MOVE SPNCY     ZCCYI                    S01512 087178
106600200529     C***********          MOVE SPSCU     ZCCYO                    S01512 087178
106610200529     C***********          Z-ADDWRK130    ZAMTCI                   S01512 087178
106620200529     C***********          Z-ADDPSXR      ZEXCH                    S01512 087178
106630200529     C***********          MOVE PMDI      ZMD                      S01512 087178
106640200529     C***********          EXSR ZCONV                              S01512 087178
106650200529     C***********                                                  S01512 087178
106660200529     C***Format*settlement*amount*for*output***********************S01512 087178
106670200529     C***********                                                  S01512 087178
106680200529     C***********WWNEG     IFEQ 'Y'                                S01512 087178
106690200529     C***********          Z-SUBZAMTCO    ZAMTCO                   S01512 087178
106700200529     C***********          END                                     S01512 087178
106710200529     C***********          Z-ADDZAMTCO    PSAT                     S01512 087178
106720200529     C***********                                                  S01512 087178
106730200529     C***********          Z-ADDPSAT      WSPSAT 150               S01512 087178
106740200529     C***********                                                  S01512 087178
106750200529     C***********          Z-ADDSETCDP    ZDECS                    S01512 087178
106760200529     C*                                                                   087178
106770200529     C** Set up parameter for call to SEZ010                              087178
106780200529     C*                                                                   087178
106790200529     C                     MOVELBFCLAS    P@CLAS                          087178
106800200529     C                     MOVELSPPRE     P@PPRE                          087178
106810200529     C                     Z-ADDPAMD      P@PAMD                          087178
106820200529     C                     Z-ADDPCHA      P@PCHA                          087178
106830200529     C                     Z-ADDPCAM      P@PCAM                          087178
106840200529     C                     Z-ADDTASO      P@TASO                          087178
106850200529     C                     Z-ADDTAUS      P@TAUS                          087178
106860200529     C                     Z-ADDPSXR      P@PSXR                          087178
106870200529     C                     MOVELPMDI      P@PMDI                          087178
106880200529     C                     MOVELSPNCY     P@PNCY                          087178
106890200529     C                     MOVELSPSCU     P@PSCU                          087178
106900200529     C                     MOVELWTAXA     P@STAM                                            AR851833
106910200529     C/COPY WNCPYSRC,SE0170C009
106920200529      *                                                                                       233711
106930200529     C********** *IN75     IFEQ *ON                                                    233711 234471
106940200529     C           *IN78     IFEQ *ON                                                           234471
106950200529     C                     ADD  TXNM      P@TASO                                              233711
106960200529     C                     ENDIF                                                              233711
106970200529      *                                                                   CAC002
106980200529     C           BGN0ST    IFEQ 'Y'                                       CAC002
106990200529     C                     Z-ADDFXMR      P@FXMR                          CAC002
107000200529      *                                                                   CAC002
107010200529     C           SPPRE     IFEQ 'R'                                       CAC002
107020200529     C                     MOVE 'TS'      P@TDTP                          CAC002
107030200529     C                     ELSE                                           CAC002
107040200529     C                     MOVE 'TP'      P@TDTP                          CAC002
107050200529     C                     ENDIF                                          CAC002
107060200529     C                     ENDIF                                          CAC002
107070200529     C*                                                                   087178
107080200529     C** Call SEZ010 to calculate the settlement amount                   087178
107090200529     C*                                                                   087178
107100200529     C                     CALL 'SEZ010'                                  087178
107110200529     C                     PARM *BLANKS   P@RCDE  7                       087178
107120200529     C                     PARM           P@DATA                          087178
107130200529     C           P@RCDE    IFEQ *BLANKS                                   087178
107140200529     C                     Z-ADDP@PSAT    PSAT                            087178
107150200529     C                     Z-ADDPSAT      WPSAT                           CAC002
107160200529      *                                                                   CAC002
107170200529     C           BGN0ST    IFEQ 'Y'                                       CAC002
107180200529     C                     Z-ADDP@MAMT    MAMT                            CAC002
107190200529     C                     ENDIF                                          CAC002
107200200529      *                                                                   CAC002
107210200529     C                     ELSE                                           087178
107220200529     C                     EXSR *PSSR                                     087178
107230200529     C                     ENDIF                                          087178
107240200529     C*                                                                   087178
107250200529     C***********          MOVE ZAMTCO    ZFLD15                          087178
107260200529     C                     Z-ADDZCDPO     ZDECS                    S01512 087178
107270200529     C                     MOVE P@PSAT    ZFLD15                   S01512 087178
107280200529     C                     MOVE ' '       ZECODE                          S01512
107290200529     C                     EXSR ZSEDIT                                    S01512
107300200529     C                     MOVEL*BLANKS   SPSAT                           S01512
107310200529     C                     MOVE ZOUT21    SPSAT                           S01512
107320200529      *                                                                   CAC002
107330200529      **  Convert marg amt to screen format if anal acctg is installed    CAC002
107340200529      *                                                                   CAC002
107350200529     C           BGN0ST    IFEQ 'Y'                                       CAC002
107360200529     C                     MOVE *BLANKS   ZFLD15                          CAC002
107370200529     C                     MOVE MAMT      ZFLD15                          CAC002
107380200529     C                     Z-ADDZCDPO     ZDECS                           CAC002
107390200529     C                     MOVE 'J'       ZECODE                          CAC002
107400200529     C                     EXSR ZSEDIT                                    CAC002
107410200529     C                     MOVE *BLANKS   SMAMT                           CAC002
107420200529     C                     MOVE ZOUT21    SMAMT                           CAC002
107430200529     C                     ENDIF                                          CAC002
107440200529      *                                                                   186166
107450200529      ** Protect Tax field if action is 'A' and security is for           186166
107460200529      ** treaty tax.                                                      186166
107470200529      *                                                                   186166
107480200529     C           ACTN      IFEQ 'A'                                       186166
107490200529     C           WFREEM    ANDEQ'Y'                                       186166
107500200529     C                     MOVE '1'       *IN66                           186166
107510200529     C                     ELSE                                           186166
107520200529     C                     MOVE '0'       *IN66                           186166
107530200529     C                     ENDIF                                          186166
107540200529     C*                                                                   S01512
107550200529     C** Redisplay screen to show the computed settlement amount          S01512
107560200529     C** Only if action is insert or settlement amount was changed        086722
107570200529     C*                                                                   S01512
107580200529     C           ACTN      IFEQ 'I'                                       086722
107590200529     C           ACTN      OREQ 'A'                                       086722
107600200529     C           WPSAT     ANDNEWSVPSA                                    086722
107610200529     C           W2SCR     ANDEQ'Y'                                       086722
107620200529     C/COPY WNCPYSRC,SE0170C045
107630200529     C                     MOVEA'11'      *IN,5                           S01512
107640200529      *                                                                                       211749
107650200529      ** Switch off *IN06 to allow change of fields in error.                                 211749
107660200529      *                                                                                       211749
107670200529     C           ACTN      IFEQ 'I'                                                           211749
107680200529     C                     MOVE '0'       *IN06                                               211749
107690200529     C                     ENDIF                                                              211749
107700200529     C           ACTN      IFEQ 'R'                                       186400
107710200529     C                     MOVELINF,13    INFMSG                          186400
107720200529     C                     END                                            186400
107730200529      *                                                                   186400
107740200529     C********** INFMSG    DOUEQ*BLANK                                                 S01512 220465
107750200529     C/COPY WNCPYSRC,SE0170C022
107760200529     C**********           WRITEKEYINPUT                                               S01512 220465
107770200529     C/COPY WNCPYSRC,SE0170C053
107780200529     C**********           WRITERECDETLS                                               S01512 220465
107790200529     C**********           WRITEMESSAGES                                               S01512 220465
107800200529     C**********           READ RECDETLS                 99                            S01512 220465
107810200529     C**********           MOVE *BLANKS   SCRMSG                                       S01512 220465
107820200529     C                     MOVE *BLANKS   WCNCL   1                       S01512
107830200529     C*                                                                   S01512
107840200529     C** Check for the keys pressed                                       S01512
107850200529     C*                                                                   S01512
107860200529     C                     EXSR ASCHGS                                    S01512
107870200529     C                     SELEC                                          S01512
107880200529     C           AID       WHEQ '01'                                      S01512
107890200529     C                     MOVE '1'       *IN12                           S01512
107900200529     C                     MOVE 'Y'       WCNCL                           S01512
107910200529     C           AID       WHEQ '05'                                      S01512
107920200529     C                     MOVE '1'       *IN10                           S01512
107930200529     C                     MOVE 'Y'       WCNCL                           S01512
107940200529     C           AID       WHEQ '04'                                      S01512
107950200529     C                     MOVELINF,11    INFMSG                          S01512
107960200529     C           AID       WHEQ 'UP'                                      S01512
107970200529     C                     MOVELINF,8     INFMSG                          S01512
107980200529     C***********AID       WHEQ 'DN'                               S01512 084981
107990200529     C***********          MOVELINF,9     INFMSG                   S01512 084981
108000200529     C                     ENDSL                                          S01512
108010200529     C**********           END                                                         S01512 220465
108020200529     C*                                                                   S01512
108030200529     C                     ENDIF                                          086722
108040200529     C*                                                                   086722
108050200529     C/COPY WNCPYSRC,SE0170C046
108060200529     C           PSAMT9    ENDSR                                          S01512
108070200529      /EJECT
108080200529     C*****************************************************************
108090200529     C*                                                               *
108100200529     C*  UPDFLS  - S/R TO UPDATE FILE RECORDS                         *
108110200529     C*  CALLED FROM: UPDATE                                          *
108120200529     C*  CALLS: UPDOWS; VALIDD; INITRC; ZTNLU1; INFSR                 *
108130200529     C*                                                               *
108140200529     C*****************************************************************
108150200529     C*
108160200529     C           UPDFLS    BEGSR
108170200529     C*
108180200529     C** INITIALIZE ALL FIELDS ON THE RECORD (IE ZEROIZE/BLANK OUT)
108190200529     C*
108200200529     C                     EXSR INITRC
108210200529     C*
108220200529     C** RETRIEVE NEXT TRANSACTION NUMBER
108230200529     C*
108240200529     C/COPY WNCPYSRC,SE0170C010
108250200529     C                     EXSR ZTNLU1
108260200529     C/COPY WNCPYSRC,SE0170C011
108270200529     C*
108280200529     C** INITIALISE ERROR BAND
108290200529     C*
108300200529     C                     MOVEL*BLANK    INFMSG
108310200529      *                                                                                       191161
108320200529     C           *LIKE     DEFN TNL1      TNLU1                                               191161
108330200529     C                     Z-ADDTNL1      TNLU1                                               191161
108340200529     C*                                                                   S01486
108350200529     C** SET UP PORTFOLIO REFERENCE                                       S01486
108360200529     C           BGPFMG    IFEQ 'Y'                                       S01486
108370200529     C           BGN4ST    OREQ 'Y'                                       CPB001
108380200529     C           SPPTFR    IFEQ FCR997                                    S01486
108390200529     C           SPPTFR    ANDNE*BLANKS                                   130059
108400200529     C           BGN4ST    ANDNE'Y'                                       CPB001
108410200529     C                     MOVE '9997'    PTFR                            S01486
108420200529     C                     ELSE                                           S01486
108430200529     C                     MOVE SPPTFR    PTFR                            S01486
108440200529     C                     END                                            S01486
108450200529     C                     END                                            S01486
108460200529      *                                                                   CSE023
108470200529      ** Update processing for CSE023 STARTS here.                        CSE023
108480200529      **  If CSE023 - Withholding tax details is installed, setup         CSE023
108490200529      **  necessary fields.                                               CSE023
108500200529      *                                                                   CSE023
108510200529     C           CSE023    IFEQ 'Y'                                       CSE023
108520200529      *                                                                   CSE023
108530200529      ** If Tax Basket entered is valid.                                  CSE023
108540200529      ** Narrative - from tax basket details.                             CSE023
108550200529     C                     MOVELSTXBS     TXBS                            CSE023
108560200529     C                     MOVELWTBNAR    TXBN                            CSE023
108570200529      *                                                                   CSE023
108580200529      ** Exemption code                                                   CSE023
108590200529     C                     MOVE SEXCD     EXCD                            CSE023
108600200529      *                                                                   CSE023
108610200529      ** Income Type and Country of Tax Treaty - from securities detail.  CSE023
108620200529     C                     MOVELINCT      ICTP                            CSE023
108630200529     C                     MOVELCRTT      CRTX                            CSE023
108640200529      *                                                                   CSE023
108650200529     C                     MOVELKYBNFO    BNFO                            CSE023
108660200529      *                                                                   CSE023
108670200529      ** Customer Type - based on classification of customer.             CSE023
108680200529     C           BFCLAS    IFEQ 'S'                                       CSE023
108690200529     C           BFCLAS    OREQ 'D'                                       CSE023
108700200529     C                     MOVEL'C'       CTYP                            CSE023
108710200529     C                     ELSE                                           CSE023
108720200529     C                     MOVEL'D'       CTYP                            CSE023
108730200529     C                     ENDIF                                          CSE023
108740200529      *                                                                   CSE023
108750200529      ** MT565 message required - only if customer type is 'D' and        CSE023
108760200529      ** a swift address exist.                                           CSE023
108770200529     C           CTYP      IFEQ 'D'                                       CSE023
108780200529     C           BBCSID    ANDEQ*BLANKS                                   CSE023
108790200529     C           BBSTAD    ANDEQ*BLANKS                                   CSE023
108800200529     C           BBTXA1    ANDEQ*BLANKS                                   CSE023
108810200529     C                     MOVEL'N'       MT5R                            CSE023
108820200529     C                     ELSE                                           CSE023
108830200529     C                     MOVEL'Y'       MT5R                            CSE023
108840200529     C                     ENDIF                                          CSE023
108850200529      *                                                                   CSE023
108860200529      ** Action code is 'I - insert'.                                     CSE023
108870200529      ** Initialize necessary fields.                                     CSE023
108880200529     C           ACTN      IFEQ 'I'                                       CSE023
108890200529     C                     MOVEL'N'       MT5G                            CSE023
108900200529     C                     Z-ADD001       PSEQ                            CSE023
108910200529     C                     MOVEL*ZEROS    PREF                            CSE023
108920200529     C                     ENDIF                                          CSE023
108930200529      *                                                                   CSE023
108940200529      ** Customer Tax ID no - based on user input or customer number      CSE023
108950200529      ** and beneficial owner combination.                                CSE023
108960200529     C           SBNFO     IFNE *BLANKS                                   CSE023
108970200529     C                     MOVELBNTXID    CTIN                            CSE023
108980200529     C                     ELSE                                           CSE023
108990200529     C           BFCLAS    IFEQ 'S'                                       186000
109000200529     C           BFCLAS    OREQ 'D'                                       186000
109010200529     C                     MOVELWHTIN     CTIN                            186000
109020200529     C                     ELSE                                           186000
109030200529     C                     MOVEL*BLANKS   CTIN                            CSE023
109040200529     C                     ENDIF                                          CSE023
109050200529     C                     ENDIF                                          186000
109060200529      *                                                                   CSE023
109070200529      ** Total discount amount - based on Original Interest Discount,     CSE023
109080200529      ** reset or calculate.                                              CSE023
109090200529     C                     EXSR CLDAMT                                    CSE023
109100200529     C                     Z-ADDWDAMT     DAMT                            CSE023
109110200529      *                                                                   CSE023
109120200529      ** Update processing for CSE023 ENDS here.                          CSE023
109130200529     C                     ENDIF                                          CSE023
109140200529     C                     MOVE ACTN      SACTN   1                                         AR324886
109150200529      *                                                                   CSE023
109160200529     C*
109170200529     C**  I  N  S  E  R  T  S                 -  S T A R T
109180200529     C*
109190200529     C           ACTN      IFEQ 'I'
109200200529      *                                                                   CSE023
109210200529      ** If CSE023 is *ON, Then set up depot field.                       CSE023
109220200529      *                                                                   CSE023
109230200529     C           CSE023    IFEQ 'Y'                                       CSE023
109240200529     C           BFCLAS    IFEQ 'S'                                       CSE023
109250200529     C           BFCLAS    OREQ 'D'                                       CSE023
109260200529     C           SBNFO     IFNE *BLANKS                                   CSE023
109270200529     C           BNDEPT    ANDNE*BLANKS                                   CSE023
109280200529     C                     MOVE BNDEPT    DEPT                            CSE023
109290200529     C                     ELSE                                           CSE023
109300200529     C                     MOVE SPSSH     @PSSH                           CSE023
109310200529     C                     MOVELCUSTNO    @ZCUST                          CSE023
109320200529     C           CDPKEY    CHAINCDEPS                99                   CSE023
109330200529     C                     MOVE CDPT      DEPT                            CSE023
109340200529     C                     ENDIF                                          CSE023
109350200529     C                     ENDIF                                          CSE023
109360200529     C                     ENDIF                                          CSE023
109370200529     C********** BGPFMG    IFEQ 'Y'                                S01486 CSE023
109380200529     C********** BGN4ST    OREQ 'Y'                                CPB001 CSE023
109390200529     C********** PTFRK     CHAINPOSETDF              60    *       S01486 CSE023
109400200529     C******************** Z-ADDSEQ       RECSEQ                   S01486 080743
109410200529     C********** RECSEQ    DOWGT1                                  S01486 080743
109420200529     C********** *IN60     ANDEQ'0'                                S01486 080743
109430200529     C********** PTFRK     READEPOSETDF                  60        S01486 080743
109440200529     C******************** SUB  1         RECSEQ                   S01486 080743
109450200529     C******************** END                                     S01486 080743
109460200529     C**********           ELSE                                    S01486 CSE023
109470200529     C********** POSETK    CHAINPOSETDF              60    *              CSE023
109480200529     C**********           Z-ADDSEQ       RECSEQ                   E37157 CSE023
109490200529     C********** RECSEQ    DOWGT1                                  E37157 CSE023
109500200529     C********** *IN60     ANDEQ'0'                                E37157 CSE023
109510200529     C********** POSETK    READEPOSETDF                  60        E37157 CSE023
109520200529     C**********           SUB  1         RECSEQ                   E37157 CSE023
109530200529     C**********           END                                     E37157 CSE023
109540200529     C**********           END                                     S01486 CSE023
109550200529      *                                                                   CSE023
109560200529     C                     SELEC                                          CSE023
109570200529     C           CSE023    WHEQ 'Y'                                       CSE023
109580200529     C********** STXBS     ANDNE*BLANKS                            CSE023 186055
109590200529     C********** PTXBSK    CHAINPOSETDF              60                              CSE023 BUG12729
109600200529     C           PTXBS6    CHAINPOSETDF6             60                                     BUG12729
109610200529      *                                                                   CSE023
109620200529     C           BGPFMG    WHEQ 'Y'                                       CSE023
109630200529     C           BGN4ST    OREQ 'Y'                                       CSE023
109640200529     C           PTFRK     CHAINPOSETDF              60                   CSE023
109650200529      *                                                                   CSE023
109660200529     C                     OTHER                                          CSE023
109670200529     C********** POSETK    CHAINPOSETDF              60            CSE023 203678
109680200529     C           POSTK1    CHAINPOSETDF              60                   203678
109690200529     C**********           Z-ADDSEQ       RECSEQ                                       CSE023 247951
109700200529      **********                                                                       CSE023 247951
109710200529     C********** RECSEQ    DOWGT1                                                      CSE023 247951
109720200529     C********** *IN60     ANDEQ'0'                                                    CSE023 247951
109730200529     C********** POSETK    READEPOSETDF                  60                            CSE023 247951
109740200529     C**********           SUB  1         RECSEQ                                       CSE023 247951
109750200529     C**********           ENDDO                                                       CSE023 247951
109760200529      *                                                                   CSE023
109770200529     C                     ENDSL                                          CSE023
109780200529      *                                                                   CSE023
109790200529     C***********TNLU      IFNE STNLU                                     S01486
109800200529     C           TNL1      IFNE STNLU                                     S01486
109810200529     C           *IN60     ANDEQ'0'                                       185397
109820200529     C                     EXSR UPDOWS
109830200529     C*
109840200529     C** IF NO PROCESSING OCCURRED EXIT TO SUPPRESS AUDIT UPDATE
109850200529     C*
109860200529     C                     GOTO XTUPDF
109870200529     C*
109880200529     C                     ELSE
109890200529     C*
109900200529     C** TRANSLATE RECORD DETAILS FROM SCREEN LAYOUT TO FILE LAYOUT
109910200529     C*
109920200529     C                     EXSR VALIDD
109930200529     C*                                                                   S01512
109940200529     C** If S01512 is active, compute for the settlement amount           S01512
109950200529     C** and redisplay the screen to shown the computed value.            S01512
109960200529     C** Exit to suppress update when F3 or F12 is taken from screen      S01512
109970200529     C*                                                                   S01512
109980200529      *                                                                   CAC002
109990200529      **  Ignore checking of S01512 when executing PSAMT if anal acctg    CAC002
110000200529      **  is installed                                                    CAC002
110010200529      *                                                                   CAC002
110020200529     C           S01512    IFEQ 'Y'                                       S01512
110030200529     C           BGN0ST    OREQ 'Y'                                       CAC002
110040200529     C                     EXSR PSAMT                                     S01512
110050200529     C                     Z-ADDWPSAT     PSAT                            086722
110060200529     C           WCNCL     IFEQ 'Y'                                       S01512
110070200529     C                     GOTO XTUPDF                                    S01512
110080200529     C                     END                                            S01512
110090200529     C                     END                                            S01512
110100200529     C                     MOVEL'D'       RECI
110110200529     C                     MOVE 'S'       PMAR
110120200529     C*
110130200529     C**  Only action code 'Y' should authorise Settlements               E20237
110140200529     C***MANUAL*SETTLEMENTS*SHOULD*NOT*REQUIRE*SEPARATE*AUTHORIZATION.9438E20237
110150200529     C*
110160200529     C***********          MOVE 'Y'       PAUI                      E19438E20237
110170200529     C                     MOVE ' '       PAUI                            E20237
110180200529     C                     MOVE 'Y'       PSMI                            S01401
110190200529     C                     Z-ADDRUND      LCD
110200200529     C***********          Z-ADDRUND      PDTG                            E14882
110210200529     C                     Z-ADD0         PDTG                            E14882
110220200529     C                     MOVEL'I'       CHTP
110230200529     C***********          MOVELNATN      TNLU                            S01486
110240200529      *                                                                                       CRE020
110250200529     C           CRE020    IFEQ 'Y'                                                           CRE020
110260200529     C           CER049    OREQ 'Y'                                                           CER049
110270200529     C                     MOVE TNL1      WTNL1   50                                          CRE020
110280200529     C                     ENDIF                                                              CRE020
110290200529      *                                                                                       CRE020
110300200529     C                     MOVELNATN      TNL1                            S01486
110310200529     C                     Z-ADD0         SABC                            185397
110320200529     C                     END
110330200529      *                                                                                       CSD015
110340200529     C           W1EWLC    IFEQ 'Y'                                                           CSD015
110350200529     C           CSC011    IFEQ 'N'                                                           CSD015
110360200529     C           CSC011    OREQ 'Y'                                                           CSD015
110370200529     C           S1MAIN    ANDEQLIBR                                                          CSD015
110380200529     C                     EXSR SRWTCH                                                        CSD015
110390200529     C                     ENDIF                                                              CSD015
110400200529     C                     ENDIF                                                              CSD015
110410200529      *                                                                                       CSD015
110420200529     C***60******          WRITEPOSETDF                15  *              118340
110430200529      *                                                                   185397
110440200529      ** If CSE023 is present and the new record inserted is for depot wit185397
110450200529      ** SWIFT, then need to get SWIFT Reference from the other records   185397
110460200529      ** from position settlement file and set the generation indicator fo185397
110470200529      ** the re-send of messages.                                         185397
110480200529      *                                                                   185397
110490200529     C           CSE023    IFEQ 'Y'                                       185397
110500200529     C           MT5R      ANDEQ'Y'                                       185397
110510200529     C                     CALL 'SE1878'                                  185397
110520200529     C                     PARM           PBCA                            185397
110530200529     C                     PARM           PSSH                            185397
110540200529     C                     PARM           PDUD                            185397
110550200529     C                     PARM           PEVT                            185397
110560200529     C                     PARM           PCPY                            185397
110570200529     C                     PARM           @PREF   6                       185397
110580200529     C                     PARM           @PSEQ   30                      185397
110590200529     C                     ENDIF                                          185397
110600200529     C           @PREF     IFNE '000000'                                  185397
110610200529     C           @PREF     ANDNE*BLANK                                    185397
110620200529     C                     MOVE @PREF     PREF                            185397
110630200529     C                     Z-ADD@PSEQ     PSEQ                            185397
110640200529     C                     MOVE 'R'       MT5G                            185397
110650200529     C                     END                                            185397
110660200529      *                                                                   185397
110670200529     C********** *IN60     IFEQ '1'                                118340 186400
110680200529     C           CSE023    IFEQ 'Y'                                                         BUG12729
110690200529     C                     WRITEPOSETDF6               15                                   BUG12729
110700200529     C                     ELSE                                                             BUG12729
110710200529     C                     WRITEPOSETDF                15  *              118340
110720200529     C                     ENDIF                                                            BUG12729
110730200529     C                     EXSR PSAUDT                                                      AR324886
110740200529     C           *IN15     IFEQ '0'                                       118340
110750200529      *                                                                                       CRE020
110760200529      ** Handle the advice index of this transaction if CRE020 is enabled.                    CRE020
110770200529      *                                                                                       CRE020
110780200529     C           CRE020    IFEQ 'Y'                                                           CRE020
110790200529     C           WSV01     ANDEQ'Y'                                                           CRE020
110800200529     C           CER049    OREQ 'Y'                                                           CER049
110810200529     C                     EXSR SRTNLU                                                        CRE020
110820200529     C                     EXSR SRIDXT                                                        CRE020
110830200529     C                     ENDIF                                                              CRE020
110840200529      *                                                                                       CRE020
110850200529     C           1         CHAINPOSETAF              99    *              118340
110860200529     C*                                                                   118340
110870200529     C** UPDATE AUDIT RECORD IF FOUND                                     118340
110880200529     C*                                                                   118340
110890200529     C           *IN99     IFEQ '0'                                       118340
110900200529     C*                                                                   118340
110910200529     C** FOR INSERT, UPDATE LIVE RECORDS INSERTED TODAY, AND NO. OF LIVE  118340
110920200529     C** RECORDS                                                          118340
110930200529     C*                                                                   118340
110940200529     C           ACTN      IFEQ 'I'                                       118340
110950200529     C                     ADD  1         NOIN             *NO.INSD TDY   118340
110960200529     C                     ADD  1         NORE             *NO.LIVE RCS   118340
110970200529     C                     END                                            118340
110980200529     C*                                                                   118340
110990200529     C** FORMAT COMIT TEXT                                                118340
111000200529     C*                                                                   118340
111010200529     C                     TIME           MTIME                           118340
111020200529     C                     MOVELACTN      ACTNX                           118340
111030200529     C                     MOVEASCRCTL    DET,01                          118340
111040200529     C                     MOVEADETS      DET,26                          118340
111050200529     C*                                                                   118340
111060200529     C** UPDATE AUDIT RECORD                                              118340
111070200529     C*                                                                   118340
111080200529     C                     UPDATPOSETAF                                   118340
111090200529     C                     ENDIF                                          118340
111100200529     C                     ENDIF                                          118340
111110200529     C**********           ENDIF                                   118340 186400
111120200529     C/COPY WNCPYSRC,SE0170C091
111130200529     C*
111140200529     C**  TEST FOR UPDATE BY ANOTHER W/S, OR A TERMINAL ERROR
111150200529     C*
111160200529     C           *IN15     IFEQ '1'
111170200529     C           STATUS    ANDEQ01021
111180200529     C** IF PORTFOLIO MANAGEMENT INSTALLED                                S01486
111190200529     C           CSE023    IFEQ 'Y'                                       186055
111200200529     C           PTXBSK    CHAINPOSETX               15                   186055
111210200529     C                     ELSE                                           186055
111220200529     C           BGPFMG    IFEQ 'Y'                                       S01486
111230200529     C           BGN4ST    OREQ 'Y'                                       CPB001
111240200529     C           PTFRK     CHAINPOSETX               15                   S01486
111250200529     C******************** Z-ADDSEQ       RECSEQ                   S01486 080743
111260200529     C********** RECSEQ    DOWGT1                                  S01486 080743
111270200529     C********** *IN15     ANDEQ'0'                                S01486 080743
111280200529     C********** PTFRK     READEPOSETX                   15        S01486 080743
111290200529     C******************** SUB  1         RECSEQ                   S01486 080743
111300200529     C******************** END                                     S01486 080743
111310200529     C                     ELSE                                           S01486
111320200529     C           POSETK    CHAINPOSETX               15    *RECORD
111330200529     C                     Z-ADDSEQ       RECSEQ                          E37157
111340200529     C           RECSEQ    DOWGT1                                         E37157
111350200529     C           *IN15     ANDEQ'0'                                       E37157
111360200529     C           POSETK    READEPOSETX                   15               E37157
111370200529     C                     SUB  1         RECSEQ                          E37157
111380200529     C                     END                                            E37157
111390200529     C                     END                                            S01486
111400200529     C                     ENDIF                                          186055
111410200529     C           *IN15     IFEQ '0'                        *EXISTS
111420200529     C                     EXSR UPDOWS
111430200529     C                     GOTO XTUPDF
111440200529     C                     END                             *IN,15=0
111450200529     C                     END                             *IN,15=1
111460200529     C           *IN15     IFEQ '1'                        *NO RECORD
111470200529     C                     EXSR INFSR                      *END PGM
111480200529     C                     END                             *IN,15=1
111490200529     C*
111500200529     C**********           MOVE 'S'       PMAR                            186400
111510200529     C**N60*****           UPDATPOSETDF                                   186400
111520200529     C/COPY WNCPYSRC,SE0170C092
111530200529      *                                                                   082738
111540200529      ** Insertion - Before & After Status                                082738
111550200529      *                                                                   082738
111560200529     C                     MOVEL*BLANK    Z#BSTS                          082738
111570200529     C                     MOVELPBCA      PBCAX                           082738
111580200529     C                     MOVELPSSH      PSSHX                           082738
111590200529     C                     MOVELPCPY      PCPYX                           082738
111600200529     C                     MOVELPDUD      PDUDX                           082738
111610200529     C                     MOVELPEVT      PEVTX                           082738
111620200529     C                     MOVELTXBS      TXBSX                           186055
111630200529     C                     MOVELBNFO      BNFOX                           186055
111640200529     C                     MOVELEXCD      EXCDX                           186055
111650200529     C                     MOVELDETREC    Z#ASTS                          082738
111660200529      *                                                                   082738
111670200529     C                     ELSE
111680200529     C*
111690200529     C**  I  N  S  E  R  T  S                 -  E N D
111700200529     C*
111710200529     C**  A  M  E  N  D  S                    -  S T A R T
111720200529     C*
111730200529     C           ACTN      IFEQ 'A'
111740200529     C           ACTN      OREQ 'U'                                                         AR324886
111750200529     C** IF PORTFOLIO MANAGEMENT INSTALLED                                S01486
111760200529     C********** BGPFMG    IFEQ 'Y'                                S01486 CSE023
111770200529     C********** BGN4ST    OREQ 'Y'                                CPB001 CSE023
111780200529     C********** PTFRK     CHAINPOSETX               60            S01486 080743
111790200529     C********** PTFRK     CHAINPOSETDF              60            080743 CSE023
111800200529     C******************** Z-ADDSEQ       RECSEQ                   S01486 080743
111810200529     C********** RECSEQ    DOWGT1                                  S01486 080743
111820200529     C********** *IN60     ANDEQ'0'                                S01486 080743
111830200529     C********** PTFRK     READEPOSETDF                  60        S01486 080743
111840200529     C******************** SUB  1         RECSEQ                   S01486 080743
111850200529     C******************** END                                     S01486 080743
111860200529     C**********           ELSE                                    S01486 CSE023
111870200529     C********** POSETK    CHAINPOSETDF              60    *              CSE023
111880200529     C**********           Z-ADDSEQ       RECSEQ                   E37157 CSE023
111890200529     C********** RECSEQ    DOWGT1                                  E37157 CSE023
111900200529     C********** *IN60     ANDEQ'0'                                E37157 CSE023
111910200529     C********** POSETK    READEPOSETDF                  60        E37157 CSE023
111920200529     C**********           SUB  1         RECSEQ                   E37157 CSE023
111930200529     C**********           END                                     E37157 CSE023
111940200529     C**********           END                                     S01486 CSE023
111950200529      *                                                                   CSE023
111960200529     C                     SELEC                                          CSE023
111970200529     C           CSE023    WHEQ 'Y'                                       CSE023
111980200529     C********** STXBS     ANDNE*BLANKS                            CSE023 186055
111990200529      *                                                                   186055
112000200529      ** Set up key for CHAIN                                             186055
112010200529      *                                                                   186055
112020200529     C           SBNFO     IFNE *BLANKS                                   186055
112030200529     C                     MOVELBFCUST    BNFO                            186055
112040200529     C                     MOVE SBNFO     BNFO                            186055
112050200529     C                     ELSE                                           186055
112060200529     C                     MOVE *BLANKS   BNFO                            186055
112070200529     C                     END                                            186055
112080200529      *                                                                   186055
112090200529     C********** PTXBSK    CHAINPOSETDF              60                              CSE023 BUG12729
112100200529     C           PTXBS6    CHAINPOSETDF6             60                                     BUG12729
112110200529      *                                                                   CSE023
112120200529     C           BGPFMG    WHEQ 'Y'                                       CSE023
112130200529     C           BGN4ST    OREQ 'Y'                                       CSE023
112140200529     C           PTFRK     CHAINPOSETDF              60                   CSE023
112150200529      *                                                                   CSE023
112160200529     C                     OTHER                                          CSE023
112170200529     C********** POSETK    CHAINPOSETDF              60            CSE023 203678
112180200529     C           POSTK1    CHAINPOSETDF              60                   203678
112190200529     C**********           Z-ADDSEQ       RECSEQ                                       CSE023 247951
112200200529      **********                                                                       CSE023 247951
112210200529     C********** RECSEQ    DOWGT1                                                      CSE023 247951
112220200529     C********** *IN60     ANDEQ'0'                                                    CSE023 247951
112230200529     C********** POSETK    READEPOSETDF                  60                            CSE023 247951
112240200529     C**********           SUB  1         RECSEQ                                       CSE023 247951
112250200529     C**********           ENDDO                                                       CSE023 247951
112260200529      *                                                                   CSE023
112270200529     C                     ENDSL                                          CSE023
112280200529      *                                                                   CSE023
112290200529     C***********                                                   E20237E24426
112300200529     C****ONLY*UNAUTHORISED*SETTLEMENTS*CAN*BE*AMENDED***           E20237E24426
112310200529     C***********                                                   E20237E24426
112320200529     C***********PAUI      IFEQ 'Y'                                 E20237E24426
112330200529     C***********          MOVEL'E'       ACTN                      E20237E24426
112340200529     C***********          GOTO XTUPDF                              E20237E24426
112350200529     C***********          END                                      E20237E24426
112360200529     C***********                                                   E20237E24426
112370200529     C**N60******          Z-ADDPCPY      SVPCPY                   E16843 082738
112380200529     C**N60******          MOVEDPAUI      SVPAUI                   E16843 082738
112390200529     C**N60******          MOVEDPPRE      SVPPRE                   E16843 082738
112400200529     C**N60******          MOVEDPSCU      SVPSCU                   E16843 082738
112410200529     C**N60******          Z-ADDPSMT      SVPSMT                   E16843 082738
112420200529     C**N60******          MOVEDPSEA      SVPSEA                   E16843 082738
112430200529     C**N60******          MOVEDPSEB      SVPSEB                   E16843 082738
112440200529     C**N60******          Z-ADDPSAT      SVPSAT                   E16843 082738
112450200529     C**N60******          MOVEDPBCA      SVPBCA                   S01117 082738
112460200529     C***********TNLU      IFNE STNLU                                     S01486
112470200529     C           TNL1      IFNE STNLU                                     S01486
112480200529     C                     EXSR UPDOWS
112490200529     C*
112500200529     C** IF NO PROCESSING OCCURRED EXIT TO SUPPRESS AUDIT UPDATE
112510200529     C*
112520200529     C                     GOTO XTUPDF
112530200529     C*
112540200529     C                     ELSE
112550200529     C*
112560200529      ** Amendment - Before Status                                        082738
112570200529      *                                                                   082738
112580200529     C                     MOVELPBCA      PBCAX                           082738
112590200529     C                     MOVELPSSH      PSSHX                           082738
112600200529     C                     MOVELPCPY      PCPYX                           082738
112610200529     C                     MOVELPDUD      PDUDX                           082738
112620200529     C                     MOVELPEVT      PEVTX                           082738
112630200529     C                     MOVELTXBS      TXBSX                           186055
112640200529     C                     MOVELBNFO      BNFOX                           186055
112650200529     C                     MOVELEXCD      EXCDX                           186055
112660200529     C**********           MOVELDETREC    Z#BSTS                                       082738 220952
112670200529      *****************************************************************                220952 247951
112680200529      ***Before*status*not*needed*to*avoid*twice*update*in*ACMV*files**                220952 247951
112690200529      *****************************************************************                220952 247951
112700200529     C**********           MOVEL*BLANKS   Z#BSTS                                       220952 247951
112710200529     C**********           MOVELDETREC    Z#BSTS                                       247951 250115
112720200529     C           PAUI      IFEQ 'Y'                                                           250115
112730200529     C                     MOVELDETREC    Z#BSTS                                              250115
112740200529     C                     ELSE                                                               250115
112750200529     C                     MOVEL*BLANKS   Z#BSTS                                              250115
112760200529     C                     ENDIF                                                              250115
112770200529      *                                                                                   AR1095995A
112780200529     C           PDTG      IFNE *ZERO                                                     AR1095995A
112790200529     C           LCD       ANDLTBJRDNB                                                    AR1095995A
112800200529     C                     MOVEL*BLANKS   Z#BSTS                                          AR1095995A
112810200529     C                     ENDIF                                                          AR1095995A
112820200529      *                                                                   CAC002
112830200529      **  Save exchange rate and margin points fields for checking        CAC002
112840200529      **  of entry changes after validation                               CAC002
112850200529      *                                                                   CAC002
112860200529     C                     MOVE SPSXR     WSPSXR 15                       CAC002
112870200529     C                     MOVE SPMDI     WSPMDI  1                       CAC002
112880200529     C                     MOVE SFXMP     WSFXMP  9                       CAC002
112890200529      *                                                                   082738
112900200529      ** Store details that will affect projection on a temp variable                         CRE020
112910200529      *                                                                                       CRE020
112920200529     C           CRE020    IFEQ 'Y'                                                           CRE020
112930200529     C                     Z-ADDPAMD      WPAMD  130                                          CRE020
112940200529     C                     MOVE *BLANKS   WPPRE                                               CRE020
112950200529     C                     MOVE PPRE      WPPRE   1                                           CRE020
112960200529     C                     MOVE *BLANKS   WPSCU                                               CRE020
112970200529     C                     MOVE PSCU      WPSCU   3                                           CRE020
112980200529     C                     Z-ADDPSXR      WPSXR  138                                          CRE020
112990200529     C                     MOVE *BLANKS   WPMDI                                               CRE020
113000200529     C                     MOVE PMDI      WPMDI   1                                           CRE020
113010200529     C                     Z-ADDPBRX      WPBRX  138                                          CRE020
113020200529     C                     Z-ADDPSMT      WPSMT   20                                          CRE020
113030200529     C                     MOVE *BLANKS   WPSEA                                               CRE020
113040200529     C**********           MOVE PSEA      WPSEA  12                                    CRE020 CAS010
113050200529     C                     MOVE PSEA      WPSEA  18                                           CAS010
113060200529     C                     MOVE *BLANKS   WPSEB                                               CRE020
113070200529     C                     MOVE PSEB      WPSEB   3                                           CRE020
113080200529     C                     Z-ADDPCHA      WPCHA  130                                          CRE020
113090200529     C                     Z-ADDPCAM      WPCAM  130                                          CRE020
113100200529     C                     Z-ADDPSAT      WPSAT2 130                                          CRE020
113110200529     C                     ENDIF                                                              CRE020
113120200529      *                                                                                       CRE020
113130200529     C** TRANSLATE RECORD DETAILS FROM SCREEN LAYOUT TO FILE LAYOUT
113140200529     C*
113150200529     C                     EXSR VALIDD
113160200529     C*                                                                   S01512
113170200529     C** If S01512 is active, compute for the settlement amount           S01512
113180200529     C** and redisplay the screen to shown the computed value.            S01512
113190200529     C** Exit to suppress update when F3 or F12 is taken from screen      S01512
113200200529     C*                                                                   S01512
113210200529      **  Execute PSAMT also if anal acctg is installed and either        CAC002
113220200529      **  exchange rate or margin points were changed                     CAC002
113230200529      *                                                                   CAC002
113240200529     C           S01512    IFEQ 'Y'                                       S01512
113250200529     C           BGN0ST    OREQ 'Y'                                       CAC002
113260200529     C           SPSXR     ANDNEWSPSXR                                    CAC002
113270200529     C           BGN0ST    OREQ 'Y'                                       CAC002
113280200529     C           SPMDI     ANDNEWSPMDI                                    CAC002
113290200529     C           BGN0ST    OREQ 'Y'                                       CAC002
113300200529     C           SFXMP     ANDNEWSFXMP                                    CAC002
113310200529     C                     MOVE 'Y'       W2SCR   1                       086722
113320200529     C                     EXSR PSAMT                                     S01512
113330200529     C                     Z-ADDWPSAT     PSAT                            086722
113340200529     C           WCNCL     IFEQ 'Y'                                       S01512
113350200529     C                     GOTO XTUPDF                                    S01512
113360200529     C                     END                                            S01512
113370200529     C                     END                                            S01512
113380200529     C*
113390200529     C** Only action 'Y' should authorise settlements                     E20237
113400200529     C*
113410200529     C***********          MOVE 'Y'       PAUI                            E20237
113420200529     C                     MOVE ' '       PAUI                                                218520
113430200529     C                     MOVE 'Y'       PSMI                            S01401
113440200529     C                     Z-ADDRUND      LCD
113450200529     C                     MOVEL'A'       CHTP
113460200529     C***********          MOVELNATN      TNLU                            S01486
113470200529      *                                                                                       CRE020
113480200529     C           CRE020    IFEQ 'Y'                                                           CRE020
113490200529     C           CER049    OREQ 'Y'                                                           CER049
113500200529     C                     MOVE TNL1      WTNL1                                               CRE020
113510200529     C                     ENDIF                                                              CRE020
113520200529      *                                                                                       CRE020
113530200529     C                     MOVELNATN      TNL1                            S01486
113540200529     C                     END
113550200529     C                     MOVE 'S'       PMAR
113560200529     C*                                                                   099270
113570200529     C** If S01512 is active, work out payment/value date for screen      099270
113580200529     C*                                                                   099270
113590200529     C  N60      S01512    IFEQ 'Y'                                       099270
113600200529     C                     Z-ADDPSVL      ZDAYNO                          099270
113610200529     C                     EXSR ZDATE2                                    099270
113620200529     C                     MOVELZDATE     SFPSVL                          099270
113630200529     C                     ENDIF                                          099270
113640200529     C*                                                                   099270
113650200529     C           PSAT      IFEQ 0                                         102777
113660200529     C           P@PSAT    ANDNE0                                         102777
113670200529     C                     Z-ADDP@PSAT    PSAT                            102777
113680200529     C                     END                                            102777
113690200529     C**N60******          UPDATPOSETDF                                   118340
113700200529     C           *IN60     IFEQ '0'                                       118340
113710200529     C           W1EWLC    IFEQ 'Y'                                                           CSD015
113720200529     C           CSC011    IFEQ 'N'                                                           CSD015
113730200529     C           CSC011    OREQ 'Y'                                                           CSD015
113740200529     C           S1MAIN    ANDEQLIBR                                                          CSD015
113750200529     C                     EXSR SRWTCH                                                        CSD015
113760200529     C                     ENDIF                                                              CSD015
113770200529     C                     ENDIF                                                              CSD015
113780200529      *                                                                                       CSD015
113790200529     C           CSE023    IFEQ 'Y'                                                         BUG12729
113800200529     C                     UPDATPOSETDF6                                                    BUG12729
113810200529     C                     ELSE                                                             BUG12729
113820200529     C                     UPDATPOSETDF                                   118340
113830200529     C                     ENDIF                                                            BUG12729
113840200529     C                     EXSR PSAUDT                                                      AR324886
113850200529      *                                                                                       CRE020
113860200529      ** Handle the advice index of this transaction if CRE020 is enabled.                    CRE020
113870200529      *                                                                                       CRE020
113880200529     C           CRE020    IFEQ 'Y'                                                           CRE020
113890200529     C           WSV01     ANDEQ'Y'                                                           CRE020
113900200529     C           CER049    OREQ 'Y'                                                           CER049
113910200529     C                     EXSR SRTNLU                                                        CRE020
113920200529     C                     EXSR SRIDXT                                                        CRE020
113930200529     C                     ENDIF                                                              CRE020
113940200529      *                                                                                       CRE020
113950200529     C                     MOVE PAUI      SPAUI                                               218520
113960200529     C           1         CHAINPOSETAF              99    *              118340
113970200529     C*                                                                   118340
113980200529     C** UPDATE AUDIT RECORD IF FOUND                                     118340
113990200529     C*                                                                   118340
114000200529     C           *IN99     IFEQ '0'                                       118340
114010200529     C*                                                                   118340
114020200529     C** FOR AMENDS, UPDATE NO. OF RECORDS AMENDED TODAY                  118340
114030200529     C*                                                                   118340
114040200529     C           ACTN      IFEQ 'A'                                       118340
114050200529     C           ACTN      OREQ 'Y'                                       118340
114060200529     C                     ADD  1         NOAM             *NO.AMND TDY   118340
114070200529     C                     END                                            118340
114080200529     C*                                                                   118340
114090200529     C** FORMAT COMIT TEXT                                                118340
114100200529     C*                                                                   118340
114110200529     C                     TIME           MTIME                           118340
114120200529     C                     MOVELACTN      ACTNX                           118340
114130200529     C                     MOVEASCRCTL    DET,01                          118340
114140200529     C                     MOVEADETS      DET,26                          118340
114150200529     C*                                                                   118340
114160200529     C** UPDATE AUDIT RECORD                                              118340
114170200529     C*                                                                   118340
114180200529     C                     UPDATPOSETAF                                   118340
114190200529     C                     ENDIF                                          118340
114200200529      *                                                                                       191161
114210200529     C           CAEVNT    IFEQ 'Y'                                                           191161
114220200529     C                     EXSR UPDCAF                                                        191161
114230200529     C                     ENDIF                                                              191161
114240200529      *                                                                                       191161
114250200529     C                     ENDIF                                          118340
114260200529      *                                                                   082738
114270200529     C*                                                                   S01408
114280200529     C/COPY WNCPYSRC,SE0170CCP6                                           S01408
114290200529     C*                                                                   S01408
114300200529      ** Amendment - After Status                                         082738
114310200529      *                                                                   082738
114320200529     C                     MOVELDETREC    Z#ASTS                          082738
114330200529      *                                                                   082738
114340200529     C                     ELSE
114350200529     C*
114360200529     C**               A  M  E  N  D  S                    -  E N D
114370200529     C*
114380200529     C**               D  E  L  E  T  E  S                 -  S T A R T
114390200529     C*
114400200529     C           ACTN      IFEQ 'D'
114410200529     C** IF PORTFOLIO MANAGEMENT INSTALLED                                S01486
114420200529     C********** BGPFMG    IFEQ 'Y'                                S01486 CSE023
114430200529     C********** BGN4ST    OREQ 'Y'                                CPB001 CSE023
114440200529     C********** PTFRK     CHAINPOSETX               60            S01486 080743
114450200529     C********** PTFRK     CHAINPOSETDF              60            080743 CSE023
114460200529     C******************** Z-ADDSEQ       RECSEQ                   S01486 080743
114470200529     C********** RECSEQ    DOWGT1                                  S01486 080743
114480200529     C********** *IN60     ANDEQ'0'                                S01486 080743
114490200529     C********** PTFRK     READEPOSETDF                  60        S01486 080743
114500200529     C******************** SUB  1         RECSEQ                   S01486 080743
114510200529     C******************** END                                     S01486 080743
114520200529     C**********           ELSE                                    S01486 CSE023
114530200529     C********** POSETK    CHAINPOSETDF              60    *              CSE023
114540200529     C**********           Z-ADDSEQ       RECSEQ                   E37157 CSE023
114550200529     C********** RECSEQ    DOWGT1                                  E37157 CSE023
114560200529     C********** *IN60     ANDEQ'0'                                E37157 CSE023
114570200529     C********** POSETK    READEPOSETDF                  60        E37157 CSE023
114580200529     C**********           SUB  1         RECSEQ                   E37157 CSE023
114590200529     C**********           END                                     E37157 CSE023
114600200529     C**********           END                                     S01486 CSE023
114610200529      *                                                                   CSE023
114620200529     C                     SELEC                                          CSE023
114630200529     C           CSE023    WHEQ 'Y'                                       CSE023
114640200529     C********** STXBS     ANDNE*BLANKS                            CSE023 186055
114650200529      *                                                                   CSE023
114660200529      ** Set up key for CHAIN                                             CSE023
114670200529      *                                                                   CSE023
114680200529     C           SBNFO     IFNE *BLANKS                                   185397
114690200529     C                     MOVELBFCUST    BNFO                            CSE023
114700200529     C                     MOVE SBNFO     BNFO                            CSE023
114710200529     C                     ELSE                                           185397
114720200529     C                     MOVE *BLANKS   BNFO                            185397
114730200529     C                     END                                            185397
114740200529      *                                                                   CSE023
114750200529     C********** PTXBSK    CHAINPOSETDF              60                              CSE023 BUG12729
114760200529     C           PTXBS6    CHAINPOSETDF6             60                                     BUG12729
114770200529      *                                                                   CSE023
114780200529     C           BGPFMG    WHEQ 'Y'                                       CSE023
114790200529     C           BGN4ST    OREQ 'Y'                                       CSE023
114800200529     C           PTFRK     CHAINPOSETDF              60                   CSE023
114810200529      *                                                                   CSE023
114820200529     C                     OTHER                                          CSE023
114830200529     C********** POSETK    CHAINPOSETDF              60            CSE023 169067
114840200529     C           POSTK1    CHAINPOSETDF              60                   169067
114850200529     C**********           Z-ADDSEQ       RECSEQ                                       CSE023 247951
114860200529      **********                                                                       CSE023 247951
114870200529     C********** RECSEQ    DOWGT1                                                      CSE023 247951
114880200529     C********** *IN60     ANDEQ'0'                                                    CSE023 247951
114890200529     C********** POSETK    READEPOSETDF                  60                            CSE023 247951
114900200529     C**********           SUB  1         RECSEQ                                       CSE023 247951
114910200529     C**********           ENDDO                                                       CSE023 247951
114920200529      *                                                                   CSE023
114930200529     C                     ENDSL                                          CSE023
114940200529      *                                                                   CSE023
114950200529     C**N60******          Z-ADDPCPY      SVPCPY                   E16843 082738
114960200529     C**N60******          MOVEDPAUI      SVPAUI                   E16843 082738
114970200529     C**N60******          MOVEDPPRE      SVPPRE                   E16843 082738
114980200529     C**N60******          MOVEDPSCU      SVPSCU                   E16843 082738
114990200529     C**N60******          Z-ADDPSMT      SVPSMT                   E16843 082738
115000200529     C**N60******          MOVEDPSEA      SVPSEA                   E16843 082738
115010200529     C**N60******          MOVEDPSEB      SVPSEB                   E16843 082738
115020200529     C**N60******          Z-ADDPSAT      SVPSAT                   E16843 082738
115030200529     C**N60******          MOVE PBCA      SVPBCA                   S01117 082738
115040200529     C***********TNLU      IFNE STNLU                                     S01486
115050200529     C           TNL1      IFNE STNLU                                     S01486
115060200529     C                     EXSR UPDOWS
115070200529     C*
115080200529     C** IF NO PROCESSING OCCURRED EXIT TO SUPPRESS AUDIT UPDATE
115090200529     C*
115100200529     C                     GOTO XTUPDF
115110200529     C*
115120200529     C                     ELSE
115130200529      *                                                                   082738
115140200529      ** Deletion - Before Status                                         082738
115150200529      *                                                                   082738
115160200529     C                     MOVELPBCA      PBCAX                           082738
115170200529     C                     MOVELPSSH      PSSHX                           082738
115180200529     C                     MOVELPCPY      PCPYX                           082738
115190200529     C                     MOVELPDUD      PDUDX                           082738
115200200529     C                     MOVELPEVT      PEVTX                           082738
115210200529     C                     MOVELTXBS      TXBSX                           186055
115220200529     C                     MOVELBNFO      BNFOX                           186055
115230200529     C                     MOVELEXCD      EXCDX                           186055
115240200529     C                     MOVELDETREC    Z#BSTS                          082738
115250200529     C           MT5G      IFEQ 'Y'                                       CSE023
115260200529     C           MT5G      OREQ 'R'                                       185397
115270200529     C                     MOVE 'C'       MT5G                            CSE023
115280200529     C                     END                                            CSE023
115290200529      *                                                                   082738
115300200529     C                     MOVEL'*'       RECI
115310200529     C                     MOVE 'Y'       PSMI                            S01401
115320200529     C                     Z-ADDRUND      LCD
115330200529     C                     MOVEL'D'       CHTP
115340200529     C***********          MOVELNATN      TNLU                            S01486
115350200529      *                                                                                       CRE020
115360200529     C           CRE020    IFEQ 'Y'                                                           CRE020
115370200529     C           CER049    OREQ 'Y'                                                           CER049
115380200529     C                     MOVE TNL1      WTNL1                                               CRE020
115390200529     C                     ENDIF                                                              CRE020
115400200529      *                                                                                       CRE020
115410200529     C                     MOVELNATN      TNL1                            S01486
115420200529     C                     END                             *TNLU=STNLU
115430200529     C                     MOVE 'S'       PMAR
115440200529     C**N60******          UPDATPOSETDF                                   118340
115450200529     C/COPY WNCPYSRC,SE0170C093
115460200529     C**N60******          MOVE 'D'       STAT                      084981118340
115470200529     C           *IN60     IFEQ '0'                                       118340
115480200529     C           CSE023    IFEQ 'Y'                                                         BUG12729
115490200529     C                     UPDATPOSETDF6                                                    BUG12729
115500200529     C                     ELSE                                                             BUG12729
115510200529     C                     UPDATPOSETDF                                   118340
115520200529     C                     ENDIF                                                            BUG12729
115530200529     C                     EXSR PSAUDT                                                      AR324886
115540200529      *                                                                                       CRE020
115550200529      ** Handle the advice index of this transaction if CRE020 is enabled.                    CRE020
115560200529      *                                                                                       CRE020
115570200529     C           CRE020    IFEQ 'Y'                                                           CRE020
115580200529     C           WSV01     ANDEQ'Y'                                                           CRE020
115590200529     C           CER049    OREQ 'Y'                                                           CER049
115600200529     C                     EXSR SRTNLU                                                        CRE020
115610200529     C                     EXSR SRIDXT                                                        CRE020
115620200529     C                     ENDIF                                                              CRE020
115630200529      *                                                                                       CRE020
115640200529     C                     MOVE 'D'       STAT                            118340
115650200529      *                                                                   118340
115660200529     C           1         CHAINPOSETAF              99    *              118340
115670200529     C*                                                                   118340
115680200529     C** UPDATE AUDIT RECORD IF FOUND                                     118340
115690200529     C*                                                                   118340
115700200529     C           *IN99     IFEQ '0'                                       118340
115710200529     C*                                                                   118340
115720200529     C** FOR DELETIONS, UPDATE NO. DELETIONS TODAY, AND NO. OF LIVE RECS  118340
115730200529     C*                                                                   118340
115740200529     C           ACTN      IFEQ 'D'                                       118340
115750200529     C                     ADD  1         NODE             *NO.DLTD TDY   118340
115760200529     C                     SUB  1         NORE             *NO.LIVE RCS   118340
115770200529     C                     END                                            118340
115780200529     C*                                                                   118340
115790200529     C** FORMAT COMIT TEXT                                                118340
115800200529     C*                                                                   118340
115810200529     C                     TIME           MTIME                           118340
115820200529     C                     MOVELACTN      ACTNX                           118340
115830200529     C                     MOVEASCRCTL    DET,01                          118340
115840200529     C                     MOVEADETS      DET,26                          118340
115850200529     C*                                                                   118340
115860200529     C** UPDATE AUDIT RECORD                                              118340
115870200529     C*                                                                   118340
115880200529     C                     UPDATPOSETAF                                   118340
115890200529     C                     ENDIF                                          118340
115900200529      *                                                                                       191161
115910200529     C           CAEVNT    IFEQ 'Y'                                                           191161
115920200529     C                     EXSR UPDCAF                                                        191161
115930200529     C                     ENDIF                                                              191161
115940200529      *                                                                                       191161
115950200529     C                     ENDIF                                          118340
115960200529      *                                                                   082738
115970200529      ** Deletion - After Status                                          082738
115980200529      *                                                                   082738
115990200529     C                     MOVELDETREC    Z#ASTS                          082738
116000200529      *                                                                   082738
116010200529     C                     ELSE
116020200529     C*
116030200529     C**               D  E  L  E  T  E  S                 -  E N D
116040200529     C*
116050200529     C**      A  U  T  H  O  R  I  T  A  T  I  O  N  S     -  S T A R T
116060200529     C*
116070200529     C           ACTN      IFEQ 'Y'
116080200529     C           STAT      ANDNE'R'                                                         AR324886
116090200529     C** IF PORTFOLIO MANAGEMENT INSTALLED                                S01486
116100200529     C********** BGPFMG    IFEQ 'Y'                                S01486 CSE023
116110200529     C********** BGN4ST    OREQ 'Y'                                CPB001 CSE023
116120200529     C********** PTFRK     CHAINPOSETX               60            S01486 080743
116130200529     C********** PTFRK     CHAINPOSETDF              60            080743 CSE023
116140200529     C******************** Z-ADDSEQ       RECSEQ                   S01486 080743
116150200529     C********** RECSEQ    DOWGT1                                  S01486 080743
116160200529     C********** *IN60     ANDEQ'0'                                S01486 080743
116170200529     C********** PTFRK     READEPOSETDF                  60        S01486 080743
116180200529     C******************** SUB  1         RECSEQ                   S01486 080743
116190200529     C******************** END                                     S01486 080743
116200200529     C**********           ELSE                                    S01486 CSE023
116210200529     C********** POSETK    CHAINPOSETDF              60    *              CSE023
116220200529     C**********           Z-ADDSEQ       RECSEQ                   E37157 CSE023
116230200529     C********** RECSEQ    DOWGT1                                  E37157 CSE023
116240200529     C********** *IN60     ANDEQ'0'                                E37157 CSE023
116250200529     C********** POSETK    READEPOSETDF                  60        E37157 CSE023
116260200529     C**********           SUB  1         RECSEQ                   E37157 CSE023
116270200529     C**********           END                                     E37157 CSE023
116280200529     C**********           END                                     S01486 CSE023
116290200529      *                                                                   CSE023
116300200529     C                     SELEC                                          CSE023
116310200529     C           CSE023    WHEQ 'Y'                                       CSE023
116320200529     C********** STXBS     ANDNE*BLANKS                            CSE023 186055
116330200529      *                                                                   186055
116340200529      ** Set up key for CHAIN                                             186055
116350200529      *                                                                   186055
116360200529     C           SBNFO     IFNE *BLANKS                                   186055
116370200529     C                     MOVELBFCUST    BNFO                            186055
116380200529     C                     MOVE SBNFO     BNFO                            186055
116390200529     C                     ELSE                                           186055
116400200529     C                     MOVE *BLANKS   BNFO                            186055
116410200529     C                     END                                            186055
116420200529      *                                                                   186055
116430200529     C********** PTXBSK    CHAINPOSETDF              60                              CSE023 BUG12729
116440200529     C           PTXBS6    CHAINPOSETDF6             60                                     BUG12729
116450200529      *                                                                   CSE023
116460200529     C           BGPFMG    WHEQ 'Y'                                       CSE023
116470200529     C           BGN4ST    OREQ 'Y'                                       CSE023
116480200529     C           PTFRK     CHAINPOSETDF              60                   CSE023
116490200529      *                                                                   CSE023
116500200529     C                     OTHER                                          CSE023
116510200529     C********** POSETK    CHAINPOSETDF              60            CSE023 203678
116520200529     C           POSTK1    CHAINPOSETDF              60                   203678
116530200529     C**********           Z-ADDSEQ       RECSEQ                                       CSE023 247951
116540200529      **********                                                                       CSE023 247951
116550200529     C********** RECSEQ    DOWGT1                                                      CSE023 247951
116560200529     C********** *IN60     ANDEQ'0'                                                    CSE023 247951
116570200529     C********** POSETK    READEPOSETDF                  60                            CSE023 247951
116580200529     C**********           SUB  1         RECSEQ                                       CSE023 247951
116590200529     C**********           ENDDO                                                       CSE023 247951
116600200529      *                                                                   CSE023
116610200529     C                     ENDSL                                          CSE023
116620200529      *                                                                   CSE023
116630200529     C**N60******          Z-ADDPCPY      SVPCPY                   E16843 082738
116640200529     C**N60******          MOVEDPAUI      SVPAUI                   E16843 082738
116650200529     C**N60******          MOVEDPPRE      SVPPRE                   E16843 082738
116660200529     C**N60******          MOVEDPSCU      SVPSCU                   E16843 082738
116670200529     C**N60******          Z-ADDPSMT      SVPSMT                   E16843 082738
116680200529     C**N60******          MOVEDPSEA      SVPSEA                   E16843 082738
116690200529     C**N60******          MOVEDPSEB      SVPSEB                   E16843 082738
116700200529     C**N60******          Z-ADDPSAT      SVPSAT                   E16843 082738
116710200529     C**N60******          MOVEDPBCA      SVPBCA                   S01117 082738
116720200529     C***********TNLU      IFNE STNLU                                     S01486
116730200529     C           TNL1      IFNE STNLU                                     S01486
116740200529     C                     EXSR UPDOWS
116750200529     C*
116760200529     C** IF NO PROCESSING OCCURRED EXIT TO SUPPRESS AUDIT UPDATE
116770200529     C*
116780200529     C                     GOTO XTUPDF
116790200529     C*
116800200529     C                     ELSE
116810200529     C*
116820200529      ** Authorization - Before Status                                    082738
116830200529      *                                                                   082738
116840200529     C                     MOVELPBCA      PBCAX                           082738
116850200529     C                     MOVELPSSH      PSSHX                           082738
116860200529     C                     MOVELPCPY      PCPYX                           082738
116870200529     C                     MOVELPDUD      PDUDX                           082738
116880200529     C                     MOVELPEVT      PEVTX                           082738
116890200529     C                     MOVELTXBS      TXBSX                           186055
116900200529     C                     MOVELBNFO      BNFOX                           186055
116910200529     C                     MOVELEXCD      EXCDX                           186055
116920200529     C                     MOVELDETREC    Z#BSTS                          082738
116930200529      *                                                                                   AR1095995C
116940200529     C           LCD       IFLT BJRDNB                                                    AR1095995C
116950200529     C                     MOVEL*BLANKS   Z#BSTS                                          AR1095995C
116960200529     C                     ENDIF                                                          AR1095995C
116970200529      *                                                                                       CRE020
116980200529     C           CRE020    IFEQ 'Y'                                                           CRE020
116990200529     C           CER049    OREQ 'Y'                                                           CER049
117000200529     C                     MOVELCHTP      W2CHTP  1                                           CRE020
117010200529     C                     MOVE TNL1      WTNL1                                               CRE020
117020200529     C                     ENDIF                                                              CRE020
117030200529      *                                                                   082738
117040200529      *****************************************************************                220952 247951
117050200529      ***Before*status*not*needed*to*avoid*twice*update*in*ACMV*files**                220952 247951
117060200529      *****************************************************************                220952 247951
117070200529     C**********           MOVEL*BLANKS   Z#BSTS                                       220952 247951
117080200529     C                     MOVEL*BLANKS   Z#BSTS                                              250115
117090200529     C** TRANSLATE RECORD DETAILS FROM SCREEN LAYOUT TO FILE LAYOUT
117100200529     C*
117110200529     C                     EXSR VALIDD
117120200529     C                     MOVE 'Y'       PAUI
117130200529     C                     MOVE 'Y'       PSMI                            S01401
117140200529     C                     Z-ADDRUND      LCD
117150200529     C                     MOVEL'Y'       CHTP
117160200529     C***********          MOVELNATN      TNLU                            S01486
117170200529     C                     MOVELNATN      TNL1                            S01486
117180200529     C                     END
117190200529     C                     MOVE 'S'       PMAR
117200200529     C           CSE023    IFEQ 'Y'                                                         BUG12729
117210200529     C  N60                UPDATPOSETDF6                                                    BUG12729
117220200529     C                     ELSE                                                             BUG12729
117230200529     C  N60                UPDATPOSETDF
117240200529     C                     ENDIF                                                            BUG12729
117250200529     C           *IN60     IFEQ *OFF                                                        AR324886
117260200529     C                     EXSR PSAUDT                                                      AR324886
117270200529     C                     ENDIF                                                            AR324886
117280200529      *                                                                                       CRE020
117290200529      ** Handle the advice index of this transaction if CRE020 is enabled.                    CRE020
117300200529      *                                                                                       CRE020
117310200529     C           *IN60     IFEQ *OFF                                                          CRE020
117320200529     C           CRE020    IFEQ 'Y'                                                           CRE020
117330200529     C           WSV01     ANDEQ'Y'                                                           CRE020
117340200529     C           CER049    OREQ 'Y'                                                           CER049
117350200529     C                     EXSR SRTNLU                                                        CRE020
117360200529     C                     EXSR SRIDXT                                                        CRE020
117370200529     C                     ENDIF                                                              CRE020
117380200529     C                     ENDIF                                                              CRE020
117390200529      *                                                                                       CRE020
117400200529     C/COPY WNCPYSRC,SE0170C094
117410200529      *                                                                                       191161
117420200529     C           CAEVNT    IFEQ 'Y'                                                           191161
117430200529     C           *IN60     ANDEQ'0'                                                           191161
117440200529     C                     EXSR UPDCAF                                                        191161
117450200529     C                     ENDIF                                                              191161
117460200529      *                                                                                       191161
117470200529     C  N60                MOVELPAUI      SPAUI                           084981
117480200529     C*                                                                   099270
117490200529     C** If S01512 is active, work out payment/value date for screen      099270
117500200529     C*                                                                   099270
117510200529     C  N60      S01512    IFEQ 'Y'                                       099270
117520200529     C                     Z-ADDPSVL      ZDAYNO                          099270
117530200529     C                     EXSR ZDATE2                                    099270
117540200529     C                     MOVELZDATE     SFPSVL                          099270
117550200529     C                     ENDIF                                          099270
117560200529     C*                                                                   099270
117570200529      *                                                                   082738
117580200529      ** Authorization - After Status                                     082738
117590200529      *                                                                   082738
117600200529     C                     MOVELDETREC    Z#ASTS                          082738
117610200529     C*
117620200529     C**      A  U  T  H  O  R  I  T  A  T  I  O  N  S     -  E  N  D
117630200529     C*
117640200529     C                     ELSE                                           S01496
117650200529     C*                                                                   S01496
117660200529     C**      A  U  T  H  O  R  I  T  A  T  I  O  N  S     -  E  N  D     S01496
117670200529     C*                                                                   S01496
117680200529     C           S01496    IFEQ 'Y'                                       S01496
117690200529     C           CSE007    OREQ 'Y'                                       CSE007
117700200529     C           CEU017    OREQ 'Y'                                       CEU017
117710200529     C*                                                                   S01496
117720200529     C**      R E V E R S A L S    -  S T A R T                           S01496
117730200529     C*                                                                   S01496
117740200529     C           ACTN      IFEQ 'R'                                       S01496
117750200529     C                     MOVE 'D'       RECI                                              AR324886
117760200529     C                     EXSR PSAUDT                                                      AR324886
117770200529     C                     ENDIF                                                            AR324886
117780200529     C           ACTN      IFEQ 'Y'                                                         AR324886
117790200529     C           STAT      ANDEQ'R'                                                         AR324886
117800200529     C                     MOVE 'R'       ACTN                                              AR324886
117810200529     C***********          Z-ADDSTNLU     TNLU                     S01496 S01486
117820200529     C                     Z-ADDSTNLU     TNL1                            S01486
117830200529     C           CSE023    IFEQ 'Y'                                       186055
117840200529      *                                                                   186055
117850200529      ** Set up key for CHAIN                                             186055
117860200529      *                                                                   186055
117870200529     C           SBNFO     IFNE *BLANKS                                   186055
117880200529     C                     MOVELBFCUST    BNFO                            186055
117890200529     C                     MOVE SBNFO     BNFO                            186055
117900200529     C                     ELSE                                           186055
117910200529     C                     MOVE *BLANKS   BNFO                            186055
117920200529     C                     END                                            186055
117930200529      *                                                                   186055
117940200529     C********** PTXBSK    CHAINPOSETDF              60                              186055 BUG12729
117950200529     C           PTXBS6    CHAINPOSETDF6             60                                     BUG12729
117960200529     C                     ELSE                                           186055
117970200529     C           PTFRK     CHAINPOSETDF              60    *              S01496
117980200529     C                     ENDIF                                          186055
117990200529     C************IN60     IFEQ *OFF                               S01496 082738
118000200529     C************         Z-ADDPCPY      SVPCPY                   S01496 082738
118010200529     C************         MOVE PAUI      SVPAUI                   S01496 082738
118020200529     C************         MOVE PPRE      SVPPRE                   S01496 082738
118030200529     C************         MOVE PSCU      SVPSCU                   S01496 082738
118040200529     C************         Z-ADDPSMT      SVPSMT                   S01496 082738
118050200529     C************         MOVE PSEA      SVPSEA                   S01496 082738
118060200529     C************         MOVE PSEB      SVPSEB                   S01496 082738
118070200529     C************         Z-ADDPSAT      SVPSAT                   S01496 082738
118080200529     C************         ENDIF                                   S01496 082738
118090200529     C*                                                                   S01496
118100200529     C** IF NO PROCESSING OCCURRED EXIT TO SUPPRESS AUDIT UPDATE          S01496
118110200529     C*                                                                   S01496
118120200529     C***********TNLU      IFNE STNLU                              S01496 S01486
118130200529     C           TNL1      IFNE STNLU                                     S01486
118140200529     C                     EXSR UPDOWS                                    S01496
118150200529     C                     GOTO XTUPDF                                    S01496
118160200529     C*                                                                   S01496
118170200529     C                     ELSE                                           S01496
118180200529     C                     MOVEL'R'       RECI                            S01496
118190200529     C                     MOVE 'R'       STAT                            186400
118200200529     C                     Z-ADDRUND      LCD                             S01496
118210200529      *                                                                                       CRE020
118220200529     C           CRE020    IFEQ 'Y'                                                           CRE020
118230200529     C           CER049    OREQ 'Y'                                                           CER049
118240200529     C                     MOVELCHTP      W2CHTP                                              CRE020
118250200529     C                     MOVE TNL1      WTNL1                                               CRE020
118260200529     C                     ENDIF                                                              CRE020
118270200529      *                                                                                       CRE020
118280200529     C                     MOVEL'R'       CHTP                            S01496
118290200529     C***********          Z-ADDSTNLU     TNLU                    S01496  S01486
118300200529     C                     Z-ADDSTNLU     TNL1                            S01486
118310200529     C                     END                             *TNLU=STNLU    S01496
118320200529     C*                                                                   S01496
118330200529     C                     MOVE 'S'       PMAR                            S01496
118340200529     C           *IN60     IFEQ *OFF                                      S01496
118350200529     C           CSE023    IFEQ 'Y'                                                         BUG12729
118360200529     C                     UPDATPOSETDF6                                                    BUG12729
118370200529     C                     ELSE                                                             BUG12729
118380200529     C                     UPDATPOSETDF                                   S01496
118390200529     C                     ENDIF                                                            BUG12729
118400200529     C                     EXSR PSAUDT                                                      AR324886
118410200529      *                                                                                       CRE020
118420200529      ** Handle the advice index of this transaction if CRE020 is enabled.                    CRE020
118430200529      *                                                                                       CRE020
118440200529     C           CRE020    IFEQ 'Y'                                                           CRE020
118450200529     C           WSV01     ANDEQ'Y'                                                           CRE020
118460200529     C           CER049    OREQ 'Y'                                                           CER049
118470200529     C                     EXSR SRTNLU                                                        CRE020
118480200529     C                     EXSR SRIDXT                                                        CRE020
118490200529     C                     ENDIF                                                              CRE020
118500200529     C/COPY WNCPYSRC,SE0170C095
118510200529     C                     ENDIF                                          S01496
118520200529     C                     ENDIF                                          S01496
118530200529     C*                                                                   S01496
118540200529     C**      R E V E R S A L S    -  E N D                               S01496
118550200529     C*                                                                   S01496
118560200529     C                     END                             S01496=Y       S01496
118570200529     C                     END                             *ACTN=Y
118580200529     C                     END                             *ACTN=D
118590200529     C                     END                             *ACTN=A
118600200529     C*                                                                   051475
118610200529     C****Need*to update Projected Nostro if position settlement is051475 082738
118620200529     C****authorised and the settlemenet method is '1', '2', '7', '051475 082738
118630200529     C****or*'12'.                                                 051475 082738
118640200529     C***********                                                  051475 082738
118650200529     C***********PSMT      IFEQ 1                                  051475 082738
118660200529     C***********PSMT      OREQ 2                                  051475 082738
118670200529     C***********PSMT      OREQ 7                                  051475 082738
118680200529     C***********PSMT      OREQ 8                                  051475 082738
118690200529     C***********PSMT      OREQ 12                                 051475 082738
118700200529     C***********                                                  051475 082738
118710200529     C***********ACTN      IFEQ 'Y'                                051475 082738
118720200529     C***********ACTN      OREQ 'D'                                051475 082738
118730200529     C***********PAUI      ANDEQ'Y'                                051475 082738
118740200529     C***********          EXSR WNOSTR                             051475 082738
118750200529     C***********          EXSR WOLPOS                             051475 082738
118760200529     C***********          END                                     051475 082738
118770200529     C***********                                                  051475 082738
118780200529     C***********          END                                     051475 082738
118790200529     C*                                                                   051475
118800200529     C                     END                             *ACTN=I
118810200529     C*                                                                   S01496
118820200529     C** FOR ACTION 'R' NO CHANGE TO PF/POSETA                            S01496
118830200529     C*                                                                   S01496
118840200529     C           S01496    IFEQ 'Y'                                       S01496
118850200529     C           CSE007    OREQ 'Y'                                       CSE007
118860200529     C           CEU017    OREQ 'Y'                                       CEU017
118870200529     C           ACTN      IFEQ 'R'                                       S01496
118880200529     C                     MOVE *BLANKS   XSFRNO                          S01496
118890200529     C           CMTTXT    COMIT                                          S01496
118900200529     C                     GOTO XTUPDF                                    S01496
118910200529     C                     ENDIF                                          S01496
118920200529     C                     ENDIF                                          S01496
118930200529      *****************************************************************                100604 247951
118940200529      **Only*do*updates*to*on-line*position*files*if*action*code*is****                100604 247951
118950200529      **Y*for*Authorization*or*Due*Date*is*today***********************                100604 247951
118960200529     C********** ACTN      IFEQ 'Y'                                                    100604 247951
118970200529     C********** PDUD      OREQ RUND                                                   100604 247951
118980200529      *****************************************************************                100604 247951
118990200529     C           PAUI      IFEQ 'Y'                                                           249578
119000200529     C********** ACTN      OREQ 'A'                                                  250115 AR324886
119010200529     C           ACTN      OREQ 'U'                                                         AR324886
119020200529     C           Z#BSTS    ANDNE*BLANKS                                                       250115
119030200529     C           CRE020    IFEQ 'Y'                                                           CRE020
119040200529     C                     MOVE TNL1      TNLUX1                                              CRE020
119050200529     C                     MOVE TNL1      TNLUX2                                              CRE020
119060200529     C                     ENDIF                                                              CRE020
119070200529     C**********           ENDIF                                                       249578 250115
119080200529     C*                                                                   082738
119090200529     C* Do On-line Updates                                                082738
119100200529     C*                                                                   082738
119110200529     C                     CALL 'AOOUPSU0'                                082738
119120200529     C                     PARM           ##RTCD  7                       082738
119130200529     C                     PARM           Z#BSTS                          082738
119140200529     C                     PARM           Z#ASTS                          082738
119150200529     C           ##RTCD    IFEQ '*ERROR*'                                 082738
119160200529     C                     SETON                     U7U8                 082738
119170200529     C           *LOCK     IN   LDA                                       082738
119180200529     C                     Z-ADD80        DBASE            ***************082738
119190200529     C                     MOVEL'AOOUPSU0'DBFILE           * DB ERROR 80 *082738
119200200529     C                     MOVELKEYFLD    DBKEY            ***************082738
119210200529     C                     OUT  LDA                                       082738
119220200529     C                     EXSR *PSSR                                     082738
119230200529     C                     GOTO XTUPDF                                    082738
119240200529     C                     END                                            082738
119250200529      **********                                                                       100604 247951
119260200529     C**********           END                                                         100604 247951
119270200529     C                     ENDIF                                                              250115
119280200529     C*
119290200529     C** GET AUDIT RECORD
119300200529     C*
119310200529     C           1         CHAINPOSETAF              99    *
119320200529     C*
119330200529     C** UPDATE AUDIT RECORD IF FOUND
119340200529     C*
119350200529     C           *IN99     IFEQ '0'
119360200529     C***********                                                         118340
119370200529     C***********                                                         118340
119380200529     C***FOR*INSERT, UPDATE LIVE RECORDS INSERTED TODAY, AND NO. OF LIVE  118340
119390200529     C***RECORDS*                                                         118340
119400200529     C***********                                                         118340
119410200529     C***********ACTN      IFEQ 'I'                                       118340
119420200529     C***********          ADD  1         NOIN             *NO.INSD TDY   118340
119430200529     C***********          ADD  1         NORE             *NO.LIVE RCS   118340
119440200529     C***********          END                                            118340
119450200529     C***********                                                         118340
119460200529     C***FOR*AMENDS, UPDATE NO. OF RECORDS AMENDED TODAY                  118340
119470200529     C***********                                                         118340
119480200529     C***********ACTN      IFEQ 'A'                                       118340
119490200529     C***********ACTN      OREQ 'Y'                                       118340
119500200529     C***********          ADD  1         NOAM             *NO.AMND TDY   118340
119510200529     C***********          END                                            118340
119520200529     C***********                                                         118340
119530200529     C***FOR*DELETIONS, UPDATE NO. DELETIONS TODAY, AND NO. OF LIVE RECS  118340
119540200529     C***********                                                         118340
119550200529     C***********ACTN      IFEQ 'D'                                       118340
119560200529     C***********          ADD  1         NODE             *NO.DLTD TDY   118340
119570200529     C***********          SUB  1         NORE             *NO.LIVE RCS   118340
119580200529     C***********          END                                            118340
119590200529     C***********                                                         118340
119600200529     C***FORMAT*COMIT TEXT                                                118340
119610200529     C***********                                                         118340
119620200529     C***********          TIME           MTIME                           118340
119630200529     C***********          MOVELACTN      ACTNX                           118340
119640200529     C***********          MOVEASCRCTL    DET,01                          118340
119650200529     C***********          MOVEADETS      DET,26                          118340
119660200529     C***********                                                         118340
119670200529     C***UPDATE*AUDIT RECORD                                              118340
119680200529     C***********                                                         118340
119690200529     C***********          UPDATPOSETAF                                   118340
119700200529     C*
119710200529     C***If*retail*module*present*in*system*and*settlement*type********   E16843
119720200529     C***equals*04,*05,*14,*or*15**************************************   E16843
119730200529     C***********                                                         E16843
119740200529     C***********                                                         E16843
119750200529     C**If*method*is*04*of*14*retail*module*must*be*present************   E16843
119760200529     C***********                                                         E16843
119770200529     C***********PSMT      IFEQ 04                                        E16843
119780200529     C***********PSMT      OREQ 05                                        E16843
119790200529     C***********PSMT      OREQ 14                                        E16843
119800200529     C***********PSMT      OREQ 15                                        E16843
119810200529     C************         TESTB'6'       MODI2          99               E16843
119820200529     C************IN99     IFEQ '0'                                       E16843
119830200529     C***********ACCNTK    CHAINACCNT                99                   E16843
119840200529     C************IN99     IFEQ '0'                                       E16843
119850200529     C**If*account*type*on*ACCNTAB*=*R*update*Ledger*and*book**********   E16843
119860200529     C*****balances*on*PF/MEMOS****************************************   E16843
119870200529     C***********                                                         E16843
119880200529     C***********ATYP      IFEQ 'R'                                       E16843
119890200529     C***********                                                         E16843
119900200529     C***Access*MEMOS*by*RRN*******************************************   E16843
119910200529     C***********                                                         E16843
119920200529     C***********RRNM      CHAINMEMOSMDF             99                   E16843
119930200529     C************IN99     IFEQ '0'                                       E16843
119940200529     C***********RECI      ANDNE'*'                                       E16843
119950200529     C***********                                                         E16843
119960200529     C***If*Pay.Receive*indicator*= P,*subtract*Settlement*************   E16843
119970200529     C******amount*from*Balances,*ELSE*add*settlement*amount***********   E16843
119980200529     C***********                                                         E16843
119990200529     C***********PPRE      IFEQ 'P'                                       E16843
120000200529     C***********          SUB  PSAT      LDBL                            E16843
120010200529     C***********          SUB  PSAT      BKBL                            E16843
120020200529     C***********          ELSE                                           E16843
120030200529     C***********          ADD  PSAT      LDBL                            E16843
120040200529     C***********          ADD  PSAT      BKBL                            E16843
120050200529     C***********          END                                            E16843
120060200529     C***********                                                         E16843
120070200529     C***********          UPDATMEMOSMDF                                  E16843
120080200529     C***********          END                             *IN99=0        E16843
120090200529     C***********          END                             *ATYP=R        E16843
120100200529     C***********          END                                            E16843
120110200529     C***********          END                                            E16843
120120200529     C***********          END                                            E16843
120130200529     C*                                                                   E16843
120140200529     C***If*RETAIL module is present.                              E16843 082738
120150200529     C***********                                                  E16843 082738
120160200529     C************INU1     IFEQ '1'                                E16843 082738
120170200529     C***********                                                  E16843 082738
120180200529     C***********ACTN      IFEQ 'A'                                E16843 082738
120190200529     C***********ACTN      OREQ 'Y'                                E16843 082738
120200200529     C***********ACTN      OREQ 'D'                                E16843 082738
120210200529     C***********                                                  E16843 082738
120220200529     C****If*authorised reverse out amounts                        E16843 082738
120230200529     C***********                                                  E16843 082738
120240200529     C***********SVPAUI    IFEQ 'Y'                                E16843 082738
120250200529     C***********                                                  E16843 082738
120260200529     C****Is*settlement account is retail                          E16843 082738
120270200529     C***********                                                  E16843 082738
120280200529     C***********          MOVE SVPOS     @POS                     E16843 082738
120290200529     C***********          MOVE *BLANKS   ATYP                     E16843 082738
120300200529     C***********@PSMT     IFEQ 4                                  E16843 082738
120310200529     C***********@PSMT     OREQ 5                                  E16843 082738
120320200529     C***********@PSMT     OREQ 14                                 E16843 082738
120330200529     C***********@PSMT     OREQ 15                                 E16843 082738
120340200529     C***********          EXSR RETAIL                             E16843 082738
120350200529     C***U7******          GOTO XTUPDF                             E16843 082738
120360200529     C***********          END                                     E16843 082738
120370200529     C***********                                                  E16843 082738
120380200529     C***********ATYP      IFEQ 'R'                                E16843 082738
120390200529     C***********                                                  E16843 082738
120400200529     C****Access*MEMOS by RRN                                      E16843 082738
120410200529     C***********                                                  E16843 082738
120420200529     C***********RRNM      CHAINMEMOSMDF             99            E16843 082738
120430200529     C************IN99     IFEQ '1'                                E16843 082738
120440200529     C***********RECI      ORNE 'D'                                E16843 082738
120450200529     C***********          SETON                       U7U8        E16843 082738
120460200529     C************LOCK     IN   LDA                                S01117 082738
120470200529     C***********          MOVE 'MEMOS'   DBFILE           ********E16843 082738
120480200529     C***********          MOVELRRNM      DBKEY            ***DB*ERROR*06*E20651
120490200529     C***********          Z-ADD6         DBASE            ***************E20651
120500200529     C***********          MOVELRRNM      DBKEY            ** DB ERE20651 082738
120510200529     C***********          Z-ADD15        DBASE            ********E20651 082738
120520200529     C***********          OUT  LDA                                S01117 082738
120530200529     C***********          EXSR *PSSR                              S01117 082738
120540200529     C***********          GOTO XTUPDF                             E16843 082738
120550200529     C***********                                                  E16843 082738
120560200529     C***********          ELSE                                    E16843 082738
120570200529     C***********                                                  E16843 082738
120580200529     C***********@PPRE     IFEQ 'P'                                E16843 082738
120590200529     C***********          ADD  SVPSAT    LDBLN                    E16843 082738
120600200529     C***********          ADD  SVPSAT    CLBLN                    E16843 082738
120610200529     C***********          Z-ADD0         DORC                     S01154 082738
120620200529     C***********          ELSE                                    E16843 082738
120630200529     C***********          SUB  SVPSAT    LDBLN                    E16843 082738
120640200529     C***********          SUB  SVPSAT    CLBLN                    E16843 082738
120650200529     C***********          Z-ADD1         DORC                     S01154 082738
120660200529     C***********          END                                     E16843 082738
120670200529     C***********                                                  E16843 082738
120680200529     C****SAVE*FIELD FOR ACCOUNT MOVEMENT FILE                     S01154 082738
120690200529     C***********                                                  S01154 082738
120700200529     C***********          Z-ADDSVPSAT    MVAM                     S01154 082738
120710200529     C***********                                                  E16843 082738
120720200529     C***********          UPDATMEMOSMDF                           E16843 082738
120730200529     C***********                                                  E16843 082738
120740200529     C***********          EXSR ACCMOV                             S01154 082738
120750200529     C***********                                                  S01154 082738
120760200529     C***********          END                                     E16843 082738
120770200529     C***********          END                                     E16843 082738
120780200529     C***********          END                                     E16843 082738
120790200529     C***********          END                                     E16843 082738
120800200529     C***********                                                  E16843 082738
120810200529     C****Update MEMOS with amounts entered                        E16843 082738
120820200529     C***********                                                  E16843 082738
120830200529     C***********ACTN      IFEQ 'A'                                E16843 082738
120840200529     C***********ACTN      OREQ 'Y'                                E16843 082738
120850200529     C***********                                                  E16843 082738
120860200529     C****Is*settlement account is retail                          E16843 082738
120870200529     C***********                                                  E16843 082738
120880200529     C***********          Z-ADDPCPY      @PCPY                    E16843 082738
120890200529     C***********          MOVE PAUI      @PAUI                    E16843 082738
120900200529     C***********          MOVE PPRE      @PPRE                    E16843 082738
120910200529     C***********          MOVE PSCU      @PSCU                    E16843 082738
120920200529     C***********          Z-ADDPSMT      @PSMT                    E16843 082738
120930200529     C***********          MOVE PSEA      @PSEA                    E16843 082738
120940200529     C***********          MOVE PSEB      @PSEB                    E16843 082738
120950200529     C***********          Z-ADDPSAT      @PSAT                    E16843 082738
120960200529     C***********          MOVELPBCA      @PBCA                    S01117 082738
120970200529     C***********          MOVE *BLANKS   ATYP                     E16843 082738
120980200529     C***********@PSMT     IFEQ 4                                  E16843 082738
120990200529     C***********@PSMT     OREQ 5                                  E16843 082738
121000200529     C***********@PSMT     OREQ 14                                 E16843 082738
121010200529     C***********@PSMT     OREQ 15                                 E16843 082738
121020200529     C***********          EXSR RETAIL                             E16843 082738
121030200529     C***U7******          GOTO XTUPDF                             E16843 082738
121040200529     C***********          END                                     E16843 082738
121050200529     C***********                                                  E16843 082738
121060200529     C***********ATYP      IFEQ 'R'                                E16843 082738
121070200529     C***********                                                  E16843 082738
121080200529     C****Access*MEMOS by RRN                                      E16843 082738
121090200529     C***********                                                  E16843 082738
121100200529     C***********RRNM      CHAINMEMOSMDF             99            E16843 082738
121110200529     C************IN99     IFEQ '1'                                E16843 082738
121120200529     C***********RECI      ORNE 'D'                                E16843 082738
121130200529     C***********          SETON                       U7U8        E16843 082738
121140200529     C************LOCK     IN   LDA                                S01117 082738
121150200529     C***********          MOVE 'MEMOS'   DBFILE           ********E16843 082738
121160200529     C***********          MOVELRRNM      DBKEY            ** DB ERE16843 082738
121170200529     C***********          Z-ADD07        DBASE            ********E16843 082738
121180200529     C***********          OUT  LDA                                S01117 082738
121190200529     C***********          EXSR *PSSR                              S01117 082738
121200200529     C***********          GOTO XTUPDF                             E16843 082738
121210200529     C***********                                                  E16843 082738
121220200529     C***********          ELSE                                    E16843 082738
121230200529     C***********                                                  E16843 082738
121240200529     C***********PPRE      IFEQ 'P'                                E16843 082738
121250200529     C***********          SUB  PSAT      LDBLN                    E16843 082738
121260200529     C***********          SUB  PSAT      CLBLN                    E16843 082738
121270200529     C***********          Z-ADD1         DORC                     S01154 082738
121280200529     C***********          ELSE                                    E16843 082738
121290200529     C***********          ADD  PSAT      LDBLN                    E16843 082738
121300200529     C***********          ADD  PSAT      CLBLN                    E16843 082738
121310200529     C***********          Z-ADD0         DORC                     S01154 082738
121320200529     C***********          END                                     E16843 082738
121330200529     C***********                                                  E16843 082738
121340200529     C****SAVE*FIELD FOR ACCOUNT MOVEMENT FILE                     S01154 082738
121350200529     C***********                                                  E16843 082738
121360200529     C***********          Z-ADDPSAT      MVAM                     S01154 082738
121370200529     C***********                                                  E16843 082738
121380200529     C***********          UPDATMEMOSMDF                           E16843 082738
121390200529     C***********                                                  E16843 082738
121400200529     C***********          EXSR ACCMOV                             S01154 082738
121410200529     C***********                                                  S01154 082738
121420200529     C***********          END                                     E16843 082738
121430200529     C***********          END                                     E16843 082738
121440200529     C***********          END                                     E16843 082738
121450200529     C***********          END                             *INU1=1 E16843 082738
121460200602     C/COPY WNCPYSRC,HUT111_008                                                               HUT111
121470200529     C*
121480200529     C**  C  O  M  I  T
121490200529     C*
121500200529     C           CMTTXT    COMIT
121510200529      *                                                                   185397
121520200529      ** If CSE023 is present and action is for deletel, and MG565 is  wit185397
121530200529      ** needed then set the generation indicator for the same depot    fo185397
121540200529      ** for re-send of messages.                                         185397
121550200529      *                                                                   185397
121560200529     C           CSE023    IFEQ 'Y'                                       185397
121570200529     C           MT5R      ANDEQ'Y'                                       185397
121580200529     C           ACTN      ANDEQ'D'                                       185397
121590200529     C                     CALL 'SE1878'                                  185397
121600200529     C                     PARM           PBCA                            185397
121610200529     C                     PARM           PSSH                            185397
121620200529     C                     PARM           PDUD                            185397
121630200529     C                     PARM           PEVT                            185397
121640200529     C                     PARM           PCPY                            185397
121650200529     C                     PARM           PREF                            185397
121660200529     C                     PARM           PSEQ                            185397
121670200529     C                     COMIT                                          185397
121680200529     C                     ENDIF                                          185397
121690200529      *                                                                   S01408
121700200529     C/COPY WNCPYSRC,SE0170CCP1                                           S01408
121710200529      *                                                                   S01408
121720200529     C*
121730200529     C**  AUDIT RECORD NOT FOUND: DATABASE ERROR
121740200529     C*
121750200529     C                     ELSE
121760200529     C*
121770200529     C                     SETON                     U7U8
121780200529     C           *LOCK     IN   LDA                                       S01117
121790200529     C***********          MOVEL'05'      DBASE            ***************S01117
121800200529     C                     Z-ADD5         DBASE            * DB ERROR 05 *S01117
121810200529     C                     MOVEL'POSET'   DBFILE           ***************
121820200529     C                     MOVEL'AUDIT'   DBKEY
121830200529     C                     OUT  LDA                                       S01117
121840200529     C                     EXSR *PSSR                                     S01117
121850200529     C                     END
121860200529     C*
121870200529     C                     MOVE *BLANKS   XSFRNO
121880200529     C*
121890200529     C           XTUPDF    ENDSR
121900200529      *                                                                   S01408
121910200529     C/COPY WNCPYSRC,SE0170CCP2                                           S01408
121920200529      *                                                                   S01408
121930200529     C*
121940200529     C*****************************************************************
121950200529      *EJECT*****                                                  E16843 082738
121960200529     C*****************************************************************   E16843
121970200529     C***********                                                  E16843 082738
121980200529     C** RETAIL  - S/R TO DETERMINE IF SETTLEMENT ACCOUNT IS RETAIL   *   E16843
121990200529     C***********                                                  E16843 082738
122000200529     C*****************************************************************   E16843
122010200529     C***********                                                  E16843 082738
122020200529     C***********RETAIL    BEGSR                                   E16843 082738
122030200529     C***********                                                  E16843 082738
122040200529     C****Settlement method 04                                     E16843 082738
122050200529     C***********                                                  E16843 082738
122060200529     C***********@PSMT     IFEQ 4                                  E16843 082738
122070200529     C***********          Z-ADD@PCPY     KYCNUM                   E16843 082738
122080200529     C***********          MOVEL@PSCU     KYCCY                    E16843 082738
122090200529     C***********          MOVEL@PBCA     KYBRCA                   S01117 082738
122100200529     C***********          Z-ADDCADC      KYACOD                    E16843S01117
122110200529     C***********          MOVE BMACCD    KYACOD                   S01117 082738
122120200529     C***********MBIN      IFEQ 'N'                                 E16843S01117
122130200529     C***********          Z-ADD1         KYACSQ                   E16843 082738
122140200529     C***********          ELSE                                     E16843S01117
122150200529     C***********          MOVE *BLANKS   KEY                       E16843S01117
122160200529     C***********          MOVEL'10'      TYPE                      E16843S01117
122170200529     C***********          MOVE @PSEB     KEY                       E16843S01117
122180200529     C***********TABKEY    CHAINTABLETRF             99             E16843S01117
122190200529     C************IN99     IFEQ '1'                                 E16843S01117
122200200529     C***********          SETON                       U7U8         E16843S01117
122210200529     C***********          MOVE 'TABLE'   DBFILE     ***************E16843S01117
122220200529     C***********          MOVELKEY       DBKEY      ** DB ERROR 08 E16843S01117
122230200529     C***********          Z-ADD8         DBASE      ***************E16843S01117
122240200529     C***********          GOTO ENDRTL                              E16843S01117
122250200529     C***********          END                                      E16843S01117
122260200529     C***********                                                   E16843S01117
122270200529     C***********          Z-ADDNSACS     KYACSQ                    E16843S01117
122280200529     C***********          END                                      E16843S01117
122290200529     C***********          END                                     E16843 082738
122300200529     C***********                                                  E16843 082738
122310200529     C****Settlement method 05                                     E16843 082738
122320200529     C***********                                                  E16843 082738
122330200529     C***********@PSMT     IFEQ 5                                  E16843 082738
122340200529     C***********          MOVEL@PSEA     KYCNUM                   E16843 082738
122350200529     C***********          MOVEL@PSCU     KYCCY                    E16843 082738
122360200529     C***********          MOVE @PSEA     WORK6   6                E16843 082738
122370200529     C***********          MOVELWORK6     KYACOD                   E16843 082738
122380200529     C***********          MOVE WORK6     KYACSQ                   E16843 082738
122390200529     C***********          MOVEL@PBCA     KYBRCA                   S01117 082738
122400200529     C***********          END                                     E16843 082738
122410200529     C***********                                                  E16843 082738
122420200529     C****Settlement method 14                                     E16843 082738
122430200529     C***********                                                  E16843 082738
122440200529     C***********@PSMT     IFEQ 14                                 E16843 082738
122450200529     C***********          MOVEL@PSEA     KEY10                    E16843 082738
122460200529     C***********ACNKA     CHAINACNUMF               99            E16843 082738
122470200529     C***99******          MOVE *BLANKS   ATYP                     E16843 082738
122480200529     C***99******          GOTO ENDRTL                             E16843 082738
122490200529     C***********          MOVE CNUM      KYCNUM                   E16843 082738
122500200529     C***********          MOVE CCY       KYCCY                    E16843 082738
122510200529     C***********          Z-ADDACOD      KYACOD                   E16843 082738
122520200529     C***********          Z-ADDACSQ      KYACSQ                   E16843 082738
122530200529     C***********          MOVELBRCA      KYBRCA                   S01117 082738
122540200529     C***********          END                                     E16843 082738
122550200529     C***********                                                  E16843 082738
122560200529     C****Settlement method 15                                     E16843 082738
122570200529     C***********                                                  E16843 082738
122580200529     C***********@PSMT     IFEQ 15                                 E16843 082738
122590200529     C***********          MOVEL@PSEA     KYCNUM                    E16843S01117
122600200529     C***********          MOVEL@PSEA     CUSTNO                   S01117 082738
122610200529     C***********          MOVEL@PSCU     KYCCY                    E16843 082738
122620200529     C***********KYCNUM    CHAINCLINTSEF             99             E16843S01117
122630200529     C************IN99     IFEQ '1'                                 E16843S01117
122640200529     C***********          SETON                       U7U8         E16843S01117
122650200529     C***********          MOVE 'CLINTSE' DBFILE     ***************E16843S01117
122660200529     C***********          MOVEL@PSEA     DBKEY      ** DB ERROR 10 E16843S01117
122670200529     C***********          Z-ADD10        DBASE      ***************E16843S01117
122680200529     C***********          GOTO ENDRTL                              E16843S01117
122690200529     C***********          END                                      E16843S01117
122700200529     C***********          Z-ADDC1AC      KYACOD                    E16843S01117
122710200529     C***********          Z-ADDC1SQ      KYACSQ                    E16843S01117
122720200529     C***********                                                  S01117 082738
122730200529     C***********          CALL 'AOSECSR0'                         S01117 082738
122740200529     C***********          PARM '*DBERR'  @RTCD   7                S01117 082738
122750200529     C***********          PARM '*KEY   ' @OPTN   7                S01117 082738
122760200529     C***********          PARM CUSTNO    CUST                     S01117 082738
122770200529     C***********SDSECS    PARM SDSECS    DSSDY                    S01117 082738
122780200529     C***********                                                  S01117 082738
122790200529     C***********          MOVEL*BLANKS   KYACOD                   S01117 082738
122800200529     C***********          MOVE BFACCD    KYACOD                   S01117 082738
122810200529     C***********          Z-ADDBFACSN    KYACSQ                   S01117 082738
122820200529     C***********          END                                     E16843 082738
122830200529     C***********                                                  E16843 082738
122840200529     C****If*account type is retail, update related PF/MEMOS recordE16843 082738
122850200529     C***********                                                  E16843 082738
122860200529     C***********KEYACC    CHAINACCNTABF             99            E16843 082738
122870200529     C************IN99     IFEQ '1'                                E16843 082738
122880200529     C***********          SETON                       U7U8        E16843 082738
122890200529     C************LOCK     IN   LDA                                S01117 082738
122900200529     C***********          MOVE 'ACCNTAB' DBFILE           ********E16843 082738
122910200529     C***********          MOVELKYACC     DBKEY            ** DB ERE16843 082738
122920200529     C***********          Z-ADD11        DBASE            ********E16843 082738
122930200529     C***********          OUT  LDA                                S01117 082738
122940200529     C***********          EXSR *PSSR                              S01117 082738
122950200529     C***********          GOTO ENDRTL                             E16843 082738
122960200529     C***********          END                                     E16843 082738
122970200529     C***********                                                  E16843 082738
122980200529     C***********ENDRTL    ENDSR                                   E16843 082738
122990200529     C***********                                                  E16843 082738
123000200529     C*****************************************************************   E16843
123010200529      *EJECT*****                                                  S01154 082738
123020200529     C*****************************************************************   S01154
123030200529     C***********                                                  S01154 082738
123040200529     C***ACCMOV**- S/R TO WRITE A RECORD TO THE ACCOUNT MOVEMENT FIS01154 082738
123050200529     C***********  WHEN MEMOS IS UPDATED                           S01154 082738
123060200529     C***CALLED FROM: UPDFLS                                       S01154 082738
123070200529     C***CALLS: NO OTHER S/R'S                                     S01154 082738
123080200529     C***********                                                  S01154 082738
123090200529     C*****************************************************************   S01154
123100200529     C***********                                                  S01154 082738
123110200529     C***********ACCMOV    BEGSR                                   S01154 082738
123120200529     C***********                                                  S01154 082738
123130200529     C***********          Z-ADDCNUM      CUSN                     S01154 082738
123140200529     C***********          MOVE CCY       CCYD                     S01154 082738
123150200529     C***********          Z-ADDACOD      ACDE                     S01154 082738
123160200529     C***********          Z-ADDACSQ      ASNC                     S01154 082738
123170200529     C***********          Z-ADDRUND      PTDT                     S01154 082738
123180200529     C***********          Z-ADDRUND      VUDT                     S01154 082738
123190200529     C***********          MOVE 'PS'      TRYP                     S01154 082738
123200200529     C***************      Z-ADD0         NRTC                     S01154 080050
123210200529     C*********************MOVE *BLANK    NRTC              S01154 080050 082738
123220200529     C***********          MOVELPSSH      NRTD                     S01154 082738
123230200529     C***********          MOVE *BLANKS   TNMR                     S01154 082738
123240200529     C***********          Z-ADD0         CQNR                     S01154 082738
123250200529     C***********                                                  S01154 082738
123260200529     C***********          WRITERSACMTPO                           S01154 082738
123270200529     C***********                                                  S01154 082738
123280200529     C***********          ENDSR                                   S01154 082738
123290200529     C***********                                                  S01154 082738
123300200529     C*****************************************************************   S01154
123310200529      /EJECT
123320200529     C*****************************************************************
123330200529     C*                                                               *
123340200529     C*  UPDOWS  - S/R TO PROCESS UPDATE BY ANOTHER WORKSTATION       *
123350200529     C*  CALLED FROM: UPDFLS                                          *
123360200529     C*  CALLS: NO OTHER S/R'S                                        *
123370200529     C*                                                               *
123380200529     C*****************************************************************
123390200529     C*
123400200529     C           UPDOWS    BEGSR
123410200529     C**
123420200529     C                     ROLBK
123430200529     C*
123440200529     C**  SET UP NEXT SCREEN TO BE DISPLAYED:
123450200529     C**  IF RECORD IS LIVE, ALLOW AMEND PROCESSING;
123460200529     C*
123470200529     C           RECI      IFEQ 'D'
123480200529     C           PAUI      ANDNE'Y'
123490200529     C***********          MOVEL'A'       ACTN                            E20237
123500200529     C                     ELSE
123510200529     C*
123520200529     C**  IF RECORD HAS BEEN DELETED, ALLOW ENQUIRY
123530200529     C*
123540200529     C                     MOVEL'E'       ACTN
123550200529     C                     END
123560200529     C*
123570200529     C**  SET SCREEN PROCESSOR TO UPDATE AND MOVE UPDATE MESSAGE TO
123580200529     C**  ERROR
123590200529     C*
123600200529     C                     MOVEA'001'     *IN,10
123610200529     C                     MOVELINF,12    INFMSG
123620200529     C*
123630200529     C                     ENDSR
123640200529     C**
123650200529      *****************************************************************                       CRE020
123660200529      /EJECT                                                                                  CRE020
123670200529      *****************************************************************                       CRE020
123680200529      *                                                               *                       CRE020
123690200529      *  SRTNLU - Store original TNLU field on extension file         *                       CRE020
123700200529      *                                                               *                       CRE020
123710200529      *****************************************************************                       CRE020
123720200529     C           SRTNLU    BEGSR                                                              CRE020
123730200529      *                                                                                       CRE020
123740200529      ** If Insert, keep record keys and original TNLU on file                                CRE020
123750200529      *                                                                                       CRE020
123760200529     C                     MOVELPBCA      P3PBCA                                              CRE020
123770200529     C                     MOVELPSSH      P3PSSH                                              CRE020
123780200529     C                     MOVE PCPY      P3PCPY                                              CRE020
123790200529     C                     MOVE PDUD      P3PDUD                                              CRE020
123800200529     C                     MOVELPEVT      P3PEVT                                              CRE020
123810200529     C                     MOVELSPTAXL    P3TAX                                               CER049
123820200529     C                     MOVELWTAXA     P3STAF                                              CER049
123830200529     C                     MOVELBJRDNB    P3CDTE                                              CER049
123840200529      *                                                                                       CRE020
123850200529     C           CHTP      IFEQ 'I'                                                           CRE020
123860200529     C                     MOVE TNL1      P3OTNL                                              CRE020
123870200529     C                     MOVE TNL1      P3TNLU                                              CRE020
123880200529     C                     WRITEPOSETDD3                                                      CRE020
123890200529     C                     ELSE                                                               CRE020
123900200529     C                     MOVELP3PBCA    K3PBCA                                              CRE020
123910200529     C                     MOVELP3PSSH    K3PSSH                                              CRE020
123920200529     C                     MOVE P3PCPY    K3PCPY                                              CRE020
123930200529     C                     MOVE P3PDUD    K3PDUD                                              CRE020
123940200529     C                     MOVELP3PEVT    K3PEVT                                              CRE020
123950200529     C                     MOVE WTNL1     K3TNLU                                              CRE020
123960200529      *                                                                                       CRE020
123970200529     C           KPOST3    CHAINPOSETDD3             78                                       CRE020
123980200529     C           *IN78     IFEQ '0'                                                           CRE020
123990200529     C                     MOVE TNL1      P3TNLU                                              CRE020
124000200529     C                     MOVELSPTAXL    P3TAX                                               CER049
124010200529     C                     MOVELWTAXA     P3STAF                                              CER049
124020200529     C                     MOVELBJRDNB    P3CDTE                                              CER049
124030200529     C                     UPDATPOSETDD3                                                      CRE020
124040200529     C                     ELSE                                                               CRE020
124050200529     C                     MOVE WTNL1     P3OTNL                                              CRE020
124060200529     C                     MOVE TNL1      P3TNLU                                              CRE020
124070200529     C                     WRITEPOSETDD3                                                      CRE020
124080200529     C                     ENDIF                                                              CRE020
124090200529      *                                                                                       CRE020
124100200529     C                     ENDIF                                                              CRE020
124110200529     C                     MOVELP3OTNL    KNARR                                               CRE020
124120200529      *                                                                                       CER049
124130200529     C           CER049    IFEQ 'Y'                                                           CER049
124140200529     C                     EXSR SRSTMD                                                        CER049
124150200529     C                     ENDIF                                                              CER049
124160200529      *                                                                                       CRE020
124170200529     C                     ENDSR                                                              CRE020
124180200529      *****************************************************************                       CRE020
124190200529      /EJECT                                                                                  CRE020
124200200529      *****************************************************************                       CRE020
124210200529      *                                                               *                       CRE020
124220200529      *  SRIDXT - Handles the advice index of the current             *                       CRE020
124230200529      *           transaction.                                        *                       CRE020
124240200529      *                                                               *                       CRE020
124250200529      *****************************************************************                       CRE020
124260200529     C           SRIDXT    BEGSR                                                              CRE020
124270200529      *                                                                                       CRE020
124280200529      ** Only process authorised transactions.                                                CRE020
124290200529      *                                                                                       CRE020
124300200529     C           PAUI      IFEQ 'Y'                                                           CRE020
124310200529     C           CRE020    ANDEQ'Y'                                                           CER049
124320200529     C           WSV01     ANDEQ'Y'                                                           CER049
124330200529      *                                                                                       CRE020
124340200529      ** On Amend Mode, check if amendments done will affect the                              CRE020
124350200529      ** projections.  If not, do not generate advice                                         CRE020
124360200529      *                                                                                       CRE020
124370200529     C           CHTP      IFEQ 'A'                                                           CRE020
124380200529     C           PAMD      IFNE WPAMD                                                         CRE020
124390200529     C           PPRE      ORNE WPPRE                                                         CRE020
124400200529     C           PSCU      ORNE WPSCU                                                         CRE020
124410200529     C           PSXR      ORNE WPSXR                                                         CRE020
124420200529     C           PMDI      ORNE WPMDI                                                         CRE020
124430200529     C           PBRX      ORNE WPBRX                                                         CRE020
124440200529     C           PSMT      ORNE WPSMT                                                         CRE020
124450200529     C           PSEA      ORNE WPSEA                                                         CRE020
124460200529     C           PSEB      ORNE WPSEB                                                         CRE020
124470200529     C           PCHA      ORNE WPCHA                                                         CRE020
124480200529     C           PCAM      ORNE WPCAM                                                         CRE020
124490200529     C           PSAT      ORNE WPSAT2                                                        CRE020
124500200529     C                     ELSE                                                               CRE020
124510200529     C                     GOTO EIDXT                                                         CRE020
124520200529     C                     ENDIF                                                              CRE020
124530200529     C                     ENDIF                                                              CRE020
124540200529      *                                                                                       CRE020
124550200529     C                     MOVE *BLANKS   WREFNO                                              CRE020
124560200529     C                     MOVE PSSH      WSSH                                                CRE020
124570200529     C                     MOVE PCPY      WCPY                                                CRE020
124580200529     C                     MOVE PBCA      WBCA                                                CRE020
124590200529     C                     MOVE PDUD      WDUD                                                CRE020
124600200529     C                     MOVE PEVT      WEVT                                                CRE020
124610200529      *                                                                                       CRE020
124620200529     C                     MOVE *BLANKS   KREFNO                                              CRE020
124630200529     C                     MOVELWREFNO    KREFNO                                              CRE020
124640200529      *                                                                                       CRE020
124650200529     C                     OPEN READVCL3                                                      CRE020
124660200529     C           KADVC     CHAINREADVCL3             69                                       CRE020
124670200529      *                                                                                       CRE020
124680200529     C           *IN69     IFEQ *ON                                                           CRE020
124690200529     C                     MOVE *BLANKS   RREFNO                                              CRE020
124700200529     C                     MOVELWREFNO    RREFNO                                              CRE020
124710200529     C                     MOVE *BLANKS   RPRGMN                                              CRE020
124720200529     C                     MOVEL'SE0170'  RPRGMN                                              CRE020
124730200529     C                     MOVE *BLANKS   RSEQNO                                              CRE020
124740200529     C                     MOVE PEVT      RTRTYP                                              CRE020
124750200529      *                                                                                       CRE020
124760200529     C           CHTP      IFEQ 'Y'                                                           CRE020
124770200529     C                     MOVEL'I'       RCHTYP                                              CRE020
124780200529     C                     ELSE                                                               CRE020
124790200529     C           CHTP      IFEQ 'R'                                                           CRE020
124800200529     C                     MOVEL'D'       RCHTYP                                              CRE020
124810200529     C                     ELSE                                                               CRE020
124820200529     C                     MOVE CHTP      RCHTYP                                              CRE020
124830200529     C                     ENDIF                                                              CRE020
124840200529     C                     ENDIF                                                              CRE020
124850200529      *                                                                                       CRE020
124860200529     C                     MOVE 'Y'       RAUTHI                                              CRE020
124870200529     C                     MOVE 'N'       RSAPIN                                              CRE020
124880200529     C                     MOVELP3OTNL    RENARR                                              CRE020
124890200529     C                     WRITEREADVCD0                                                      CRE020
124900200529      *                                                                                       CRE020
124910200529     C                     ELSE                                                               CRE020
124920200529      *                                                                                       CRE020
124930200529      ** Check first if this is a new record.                                                 CRE020
124940200529      *                                                                                       CRE020
124950200529     C           RCHTYP    IFEQ 'I'                                                           CRE020
124960200529     C           RSAPIN    ANDEQ'N'                                                           CRE020
124970200529      *                                                                                       CRE020
124980200529     C           CHTP      IFEQ 'D'                                                           CRE020
124990200529     C                     MOVE 'D'       RCHTYP                                              CRE020
125000200529     C                     MOVE 'Y'       RAUTHI                                              CRE020
125010200529     C                     MOVE 'Y'       RSAPIN                                              CRE020
125020200529     C                     UPDATREADVCD0                                                      CRE020
125030200529     C                     ENDIF                                                              CRE020
125040200529      *                                                                                       CRE020
125050200529     C           CHTP      IFEQ 'A'                                                           CRE020
125060200529     C                     MOVE 'Y'       RAUTHI                                              CRE020
125070200529     C                     UPDATREADVCD0                                                      CRE020
125080200529     C                     ENDIF                                                              CRE020
125090200529      *                                                                                       CRE020
125100200529     C                     GOTO EIDXT                                                         CRE020
125110200529     C                     ENDIF                                                              CRE020
125120200529      *                                                                                       CRE020
125130200529     C           CHTP      IFEQ 'Y'                                                           CRE020
125140200529     C                     MOVEL'I'       RCHTYP                                              CRE020
125150200529     C                     ELSE                                                               CRE020
125160200529     C           CHTP      IFEQ 'R'                                                           CRE020
125170200529     C                     MOVEL'D'       RCHTYP                                              CRE020
125180200529     C                     ELSE                                                               CRE020
125190200529     C                     MOVE CHTP      RCHTYP                                              CRE020
125200200529     C                     ENDIF                                                              CRE020
125210200529     C                     ENDIF                                                              CRE020
125220200529     C                     MOVE 'Y'       RAUTHI                                              CRE020
125230200529     C                     MOVE 'N'       RSAPIN                                              CRE020
125240200529     C                     UPDATREADVCD0                                                      CRE020
125250200529     C                     ENDIF                                                              CRE020
125260200529      *                                                                                       CRE020
125270200529     C                     CLOSEREADVCL3                                                      CRE020
125280200529     C                     UNLCKREADVCL3                                                      CRE020
125290200529      *                                                                                       CRE020
125300200529     C                     ENDIF                                                              CRE020
125310200529      *                                                                                       CRE020
125320200529     C           EIDXT     ENDSR                                                              CRE020
125330200529     C*****************************************************************
125340200529      /EJECT
125350200529     C*****************************************************************
125360200529     C*                                                               *
125370200529     C*  INFSR  - FILE EXEPTION/ERROR HANDLING SUBROUTINE             *
125380200529     C*                                                               *
125390200529     C*****************************************************************
125400200529     C*
125410200529     C           INFSR     BEGSR
125420200529     C*
125430200529     C**  ROLL BACK CHANGES AND CANCEL PROGRAM
125440200529     C*
125450200529     C                     ROLBK
125460200529     C                     MOVE '*CANCL'  EXTTAG  6
125470200529     C*
125480200529     C                     ENDSREXTTAG
125490200529     C*
125500200529     C*****************************************************************
125510200529      /EJECT                                                              S01117
125520200529     C*****************************************************************   S01117
125530200529     C*                                                               *   S01117
125540200529     C*  D1QRY  - SUBROUTINE TO TEST QUERY SELECTION ON KEY FIELDS    *   S01117
125550200529     C*                                                               *   S01117
125560200529     C*****************************************************************   S01117
125570200529     C*                                                                   S01117
125580200529     C           D1QRY     BEGSR                            ** D1QRY **   S01117
125590200529     C*                                                                   S01117
125600200529     C                     MOVE 'N'       RDSPLY                          S01117
125610200529     C*                                                                   S01117
125620200529     C**  Test query selection on Booking Branch field                    S01117
125630200529     C*                                                                   S01117
125640200529     C                     MOVELSPBCA     QMARK                           S01117
125650200529     C           QMARK     IFEQ '?'                                       S01117
125660200529     C                     MOVE 'Y'       RDSPLY                          S01117
125670200529     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
125680200529     C                     CALL 'AOBRCHR1'                                                    CGL029
125690200529     C                     PARM *BLANKS   @RTCD                           S01117
125700200529     C                     PARM '*KEY   ' @OPTN                           S01117
125710200529     C                     PARM SPBCA     @DSNB                           S01117
125720200529     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01117              CGL029
125730200529     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
125740200529     C*                                                                   S01117
125750200529     C           @RTCD     IFNE *BLANKS                                   S01117
125760200529     C                     MOVEL*BLANKS   SPBCA                           S01117
125770200529     C                     ELSE                                           S01117
125780200529     C                     MOVEL*BLANKS   SPBCA                           S01117
125790200529     C                     MOVELA8BRCD    SPBCA                           S01117
125800200529     C                     END                                            S01117
125810200529     C                     END                                            S01117
125820200529     C/COPY WNCPYSRC,SE0170C012
125830200529      *                                                                   CSE010
125840200529      ** Check Security Shortname and call Securities Selection           CSE010
125850200529      *                                                                   CSE010
125860200529     C           CSE010    IFEQ 'Y'                                       CSE010
125870200529     C                     MOVELSPSSH     @QMK    1                       CSE010
125880200529     C           @QMK      IFEQ '?'                                       CSE010
125890200529     C                     MOVE 'Y'       RDSPLY                          CSE010
125900200529     C                     MOVELSPSSH     @SESN                           CSE010
125910200529     C                     CALL 'SE0043'                                  CSE010
125920200529     C                     PARM           @ACDE   1                       CSE010
125930200529     C                     PARM           @SESN  10                       CSE010
125940200529     C           @SESN     IFNE *BLANKS                                   CSE010
125950200529     C                     MOVE @SESN     SPSSH                           CSE010
125960200529     C                     ELSE                                           CSE010
125970200529     C                     MOVE *BLANKS   SPSSH                           CSE010
125980200529     C                     ENDIF                                          CSE010
125990200529     C                     ENDIF                                          CSE010
126000200529     C                     ENDIF                                          CSE010
126010200529     C*                                                                   S01117
126020200529     C**  Test query selection on Client field                            S01117
126030200529     C*                                                                   S01117
126040200529     C                     MOVELSPCPY     QMARK   1                       S01117
126050200529     C           QMARK     IFEQ '?'                                       S01117
126060200529     C                     MOVELSPCPY     CUSTNO  6                       S01117
126070200529     C                     MOVE 'Y'       RDSPLY  1                       S01117
126080200529     C                     CALL 'AOSECSR0'                                S01117
126090200529     C                     PARM *BLANKS   @RTCD                           S01117
126100200529     C                     PARM '*KEY   ' @OPTN                           S01117
126110200529     C                     PARM CUSTNO    CUST    6                       S01117
126120200529     C           SDSECS    PARM SDSECS    DSSDY                           S01117
126130200529     C*                                                                   S01117
126140200529     C           @RTCD     IFNE *BLANKS                                   S01117
126150200529     C                     MOVEL*BLANKS   SPCPY                           S01117
126160200529     C                     ELSE                                           S01117
126170200529     C                     MOVEL*BLANKS   SPCPY                           S01117
126180200529     C                     MOVELBFCUST    SPCPY                           S01117
126190200529     C                     END                                            S01117
126200200529     C                     END                                            S01117
126210200529     C*                                                                   S01117
126220200529     C                     ENDSR                                          S01117
126230200529     C*****************************************************************   S01117
126240200529      *EJECT*****                                                  051475 082738
126250200529      *****************************************************************   051475
126260200529      ***********                                                  051475 082738
126270200529      ***WNOSTR*- Subroutine to Update Projected Nostro Details.   051475 082738
126280200529      ***********                                                  051475 082738
126290200529      *****************************************************************   051475
126300200529      ***********                                                  051475 082738
126310200529     C***********                                                  051475 082738
126320200529     C***********WNOSTR    BEGSR                                   051475 082738
126330200529     C***********                                                  051475 082738
126340200529     C***Access*nostro details                                     051475 082738
126350200529     C***********                                                  051475 082738
126360200529     C***********          MOVE PSCU      CCY                      051475 082738
126370200529     C***********          MOVELPSEA      NOSN                     051475 082738
126380200529     C***********                                                  051475 082738
126390200529     C****If*it*is an delete action, inverse the position so that i051475 082738
126400200529     C****will*update PRONO with the correct amount.               051475 082738
126410200529     C***********                                                  051475 082738
126420200529     C***********ACTN      IFEQ 'Y'                                051475 082738
126430200529     C***********          Z-ADDPNMP      @WPNMP                   051475 082738
126440200529     C***********          ELSE                                    051475 082738
126450200529     C***********          Z-SUBPNMP      @WPNMP                   051475 082738
126460200529     C***********          END                                     051475 082738
126470200529     C***********                                                  051475 082738
126480200529     C***********          MOVELNOSN      SNOSN   20               051475 082738
126490200529     C***********KLPRON    CHAINPRONOPNF             44            051475 082738
126500200529     C************IN44     IFEQ '1'                                051475 082738
126510200529     C************IN44     OREQ '0'                                051475 082738
126520200529     C***********RECI      ANDEQ'*'                                051475 082738
126530200529     C***********          Z-ADD*ZEROS    NOSN                     051475 082738
126540200529     C***********KLPRON    CHAINPRONOPNF             44            051475 082738
126550200529     C***********          END                                     051475 082738
126560200529     C***********          Z-ADD9         DORC                     051475 082738
126570200529     C***********                                                  051475 082738
126580200529     C***Update*corresponding nostro balances                      051475 082738
126590200529     C***********                                                  051475 082738
126600200529     C************IN44     IFEQ '0'                                051475 082738
126610200529     C***********RECI      ANDNE'*'                                051475 082738
126620200529     C***********          MOVEAPNBA      ANB                      051475 082738
126630200529     C***********          MOVEAPNDA      AND                      051475 082738
126640200529     C***********                                                  051475 082738
126650200529     C***********          Z-ADD1         ZY                       051475 082738
126660200529     C***********          DO   5         ZY                       051475 082738
126670200529     C***********NND,ZY    IFGE PDUD                               051475 082738
126680200529     C***********@WPNMP    IFGE 0                                  051475 082738
126690200529     C***********PEVT      IFEQ 'PP'                               051475 082738
126700200529     C***********          SUB  PSAT      NNB,ZY                   051475 082738
126710200529     C***********          Z-ADD1         DORC                     051475 082738
126720200529     C***********          ELSE                                    051475 082738
126730200529     C***********          ADD  PSAT      NNB,ZY                   051475 082738
126740200529     C***********          Z-ADD0         DORC                     051475 082738
126750200529     C***********          END                                     051475 082738
126760200529     C***********          END                                     051475 082738
126770200529     C***********@WPNMP    IFLT 0                                  051475 082738
126780200529     C***********PEVT      IFNE 'PP'                               051475 082738
126790200529     C***********          SUB  PSAT      NNB,ZY                   051475 082738
126800200529     C***********          Z-ADD1         DORC                     051475 082738
126810200529     C***********          ELSE                                    051475 082738
126820200529     C***********          ADD  PSAT      NNB,ZY                   051475 082738
126830200529     C***********          Z-ADD0         DORC                     051475 082738
126840200529     C***********          END                                     051475 082738
126850200529     C***********          END                                     051475 082738
126860200529     C***********          END                                     051475 082738
126870200529     C***********                                                  051475 082738
126880200529     C***********          MOVEAANB       PNBA                     051475 082738
126890200529     C***********          Z-ADDNATN      TNLU                     051475 082738
126900200529     C***********                                                  051475 082738
126910200529     C*****..*save movement details for PF/RSACMTPD                051475 082738
126920200529     C***********                                                  051475 082738
126930200529     C***********          Z-ADDPSAT      MVAM                     051475 082738
126940200529     C***********          Z-ADDPDUD      MVPDUD  50               051475 082738
126950200529     C***********          MOVE PSCU      MVSETC  3                051475 082738
126960200529     C***********          END                                     051475 082738
126970200529     C***********                                                  051475 082738
126980200529     C***********          UPDATPRONOPNF                           051475 082738
126990200529     C***********                                                  051475 082738
127000200529     C*****..upon update of prono write account movement record    051475 082738
127010200529     C***********                                                  051475 082738
127020200529     C***********DORC      IFLT 9                                  051475 082738
127030200529     C***********                                                  051475 082738
127040200529     C*****..Get*account code and sequence from SDNOSTPD           051475 082738
127050200529     C***********                                                  051475 082738
127060200529     C***********          MOVE '*DBERR ' @RTCD                    051475 082738
127070200529     C***********          MOVELCCY       P@CYCD                   051475 082738
127080200529     C***********          MOVELSNOSN     P@NONB                   051475 082738
127090200529     C***********          EXSR AONOST                             051475 082738
127100200529     C***********          MOVELA7ACCD    ACOD                     051475 082738
127110200529     C***********          MOVELA7BRCD    BRCA                     051475 082738
127120200529     C***********          MOVELA7CUST    CNUM                     051475 082738
127130200529     C***********          MOVELA7ACSN    ACSQ                     051475 082738
127140200529     C***********                                                  051475 082738
127150200529     C***********          EXSR ACCMOV                             051475 082738
127160200529     C***********          END                                     051475 082738
127170200529     C***********                                                  051475 082738
127180200529     C***********                                                  051475 082738
127190200529     C***********          END                                     051475 082738
127200200529     C***********                                                  051475 082738
127210200529     C***********EUPBEF    ENDSR                                   051475 082738
127220200529     C***********                                                  051475 082738
127230200529      *****************************************************************   051475
127240200529      *EJECT******                                                 051475 082738
127250200529      *****************************************************************   051475
127260200529      ***********                                                  051475 082738
127270200529      ***WOLPOS*- Subroutine to Update On-line Positions Details.  051475 082738
127280200529      ***********                                                  051475 082738
127290200529      *****************************************************************   051475
127300200529      ***********                                                  051475 082738
127310200529     C***********WOLPOS    BEGSR                                   051475 082738
127320200529     C***********                                                  051475 082738
127330200529     C***Access OLPOS file for settlement currency                 051475 082738
127340200529     C***********                                                  051475 082738
127350200529     C****...*Insert/Delete                                        051475 082738
127360200529     C***********          MOVE PBCA      BRCA                     051475 082738
127370200529     C***********          MOVE PSCU      CCY                      051475 082738
127380200529     C***********          Z-ADD1         RECN                     051475 082738
127390200529     C***********                                                  051475 082738
127400200529     C***********KLOLPS    CHAINOLPOSOAF             44            051475 082738
127410200529     C************IN44     IFEQ '0'                                051475 082738
127420200529     C***********RECI      ANDNE'*'                                051475 082738
127430200529     C***********          MOVEAODTA      ADT                      051475 082738
127440200529     C***********          MOVEAOFIA      AFI                      051475 082738
127450200529     C***********          MOVEAOFOA      AFO                      051475 082738
127460200529     C***********                                                  051475 082738
127470200529     C***********          DO   16        ZY                       051475 082738
127480200529     C***********PDUD      IFGE NDT,ZY                             051475 082738
127490200529     C***********          Z-ADDZY        ZX                       051475 082738
127500200529     C***********          END                                     051475 082738
127510200529     C***********          END                                     051475 082738
127520200529     C***********                                                  051475 082738
127530200529     C***********PDUD      IFLT NDT,1                              051475 082738
127540200529     C***********          Z-ADD1         ZX                       051475 082738
127550200529     C***********          END                                     051475 082738
127560200529     C***********                                                  051475 082738
127570200529     C***********ACTN      IFEQ 'Y'                                051475 082738
127580200529     C***********                                                  051475 082738
127590200529     C***********PNMP      IFGE 0                                  051475 082738
127600200529     C***********                                                  051475 082738
127610200529     C***********PEVT      IFEQ 'PP'                               051475 082738
127620200529     C***********          ADD  PSAT      NFO,ZX                   051475 082738
127630200529     C***********          ELSE                                    051475 082738
127640200529     C***********          ADD  PSAT      NFI,ZX                   051475 082738
127650200529     C***********          END                                     051475 082738
127660200529     C***********                                                  051475 082738
127670200529     C***********          ELSE                                    051475 082738
127680200529     C***********                                                  051475 082738
127690200529     C***********PEVT      IFEQ 'PP'                               051475 082738
127700200529     C***********          ADD  PSAT      NFI,ZX                   051475 082738
127710200529     C***********          ELSE                                    051475 082738
127720200529     C***********          ADD  PSAT      NFO,ZX                   051475 082738
127730200529     C***********          END                                     051475 082738
127740200529     C***********                                                  051475 082738
127750200529     C***********          END                                     051475 082738
127760200529     C***********                                                  051475 082738
127770200529     C***********          END                                     051475 082738
127780200529     C***********                                                  051475 082738
127790200529     C***********                                                  051475 082738
127800200529     C***********ACTN      IFEQ 'D'                                051475 082738
127810200529     C***********                                                  051475 082738
127820200529     C***********PNMP      IFGE 0                                  051475 082738
127830200529     C***********                                                  051475 082738
127840200529     C***********PEVT      IFEQ 'PP'                               051475 082738
127850200529     C***********          SUB  PSAT      NFO,ZX                   051475 082738
127860200529     C***********          ELSE                                    051475 082738
127870200529     C***********          SUB  PSAT      NFI,ZX                   051475 082738
127880200529     C***********          END                                     051475 082738
127890200529     C***********                                                  051475 082738
127900200529     C***********          ELSE                                    051475 082738
127910200529     C***********                                                  051475 082738
127920200529     C***********PEVT      IFEQ 'PP'                               051475 082738
127930200529     C***********          SUB  PSAT      NFI,ZX                   051475 082738
127940200529     C***********          ELSE                                    051475 082738
127950200529     C***********          SUB  PSAT      NFO,ZX                   051475 082738
127960200529     C***********          END                                     051475 082738
127970200529     C***********                                                  051475 082738
127980200529     C***********          END                                     051475 082738
127990200529     C***********                                                  051475 082738
128000200529     C***********          END                                     051475 082738
128010200529     C***********                                                  051475 082738
128020200529     C***********          MOVEAAFI       OFIA                     051475 082738
128030200529     C***********          MOVEAAFO       OFOA                     051475 082738
128040200529     C***********          Z-ADDNATN      TNLU                     051475 082738
128050200529     C***********                                                  051475 082738
128060200529     C***********          UPDATOLPOSOAF                           051475 082738
128070200529     C***********          END                                     051475 082738
128080200529     C***********                                                  051475 082738
128090200529     C***Access*OLPOS file for nominal currency                    051475 082738
128100200529     C***********                                                  051475 082738
128110200529     C***********          MOVE PBCA      BRCA                     051475 082738
128120200529     C***********          MOVE PNCY      CCY                      051475 082738
128130200529     C***********          Z-ADD1         RECN                     051475 082738
128140200529     C***********KLOLPS    CHAINOLPOSOAF             44            051475 082738
128150200529     C************IN44     IFEQ '0'                                051475 082738
128160200529     C***********RECI      ANDNE'*'                                051475 082738
128170200529     C***********          MOVEAODTA      ADT                      051475 082738
128180200529     C***********          MOVEAOFIA      AFI                      051475 082738
128190200529     C***********          MOVEAOFOA      AFO                      051475 082738
128200200529     C***********                                                  051475 082738
128210200529     C***********          DO   16        ZY                       051475 082738
128220200529     C***********PDUD      IFGE NDT,ZY                             051475 082738
128230200529     C***********          Z-ADDZY        ZX                       051475 082738
128240200529     C***********          END                                     051475 082738
128250200529     C***********          END                                     051475 082738
128260200529     C***********                                                  051475 082738
128270200529     C***********PDUD      IFLT NDT,1                              051475 082738
128280200529     C***********          Z-ADD1         ZX                       051475 082738
128290200529     C***********          END                                     051475 082738
128300200529     C***********                                                  051475 082738
128310200529     C***********ACTN      IFEQ 'Y'                                051475 082738
128320200529     C***********                                                  051475 082738
128330200529     C***********PNMP      IFGE 0                                  051475 082738
128340200529     C***********                                                  051475 082738
128350200529     C***********PEVT      IFEQ 'PP'                               051475 082738
128360200529     C***********          ADD  PSAT      NFO,ZX                   051475 082738
128370200529     C***********          ELSE                                    051475 082738
128380200529     C***********          ADD  PSAT      NFI,ZX                   051475 082738
128390200529     C***********          END                                     051475 082738
128400200529     C***********                                                  051475 082738
128410200529     C***********          ELSE                                    051475 082738
128420200529     C***********                                                  051475 082738
128430200529     C***********PEVT      IFEQ 'PP'                               051475 082738
128440200529     C***********          ADD  PSAT      NFI,ZX                   051475 082738
128450200529     C***********          ELSE                                    051475 082738
128460200529     C***********          ADD  PSAT      NFO,ZX                   051475 082738
128470200529     C***********          END                                     051475 082738
128480200529     C***********                                                  051475 082738
128490200529     C***********          END                                     051475 082738
128500200529     C***********                                                  051475 082738
128510200529     C***********          END                                     051475 082738
128520200529     C***********                                                  051475 082738
128530200529     C***********                                                  051475 082738
128540200529     C***********ACTN      IFEQ 'D'                                051475 082738
128550200529     C***********                                                  051475 082738
128560200529     C***********PNMP      IFGE 0                                  051475 082738
128570200529     C***********                                                  051475 082738
128580200529     C***********PEVT      IFEQ 'PP'                               051475 082738
128590200529     C***********          SUB  PSAT      NFO,ZX                   051475 082738
128600200529     C***********          ELSE                                    051475 082738
128610200529     C***********          SUB  PSAT      NFI,ZX                   051475 082738
128620200529     C***********          END                                     051475 082738
128630200529     C***********                                                  051475 082738
128640200529     C***********          ELSE                                    051475 082738
128650200529     C***********                                                  051475 082738
128660200529     C***********PEVT      IFEQ 'PP'                               051475 082738
128670200529     C***********          SUB  PSAT      NFI,ZX                   051475 082738
128680200529     C***********          ELSE                                    051475 082738
128690200529     C***********          SUB  PSAT      NFO,ZX                   051475 082738
128700200529     C***********          END                                     051475 082738
128710200529     C***********                                                  051475 082738
128720200529     C***********          END                                     051475 082738
128730200529     C***********                                                  051475 082738
128740200529     C***********          END                                     051475 082738
128750200529     C***********                                                  051475 082738
128760200529     C***********                                                  051475 082738
128770200529     C***********          MOVEAAFI       OFIA                     051475 082738
128780200529     C***********          MOVEAAFO       OFOA                     051475 082738
128790200529     C***********          Z-ADDNATN      TNLU                     051475 082738
128800200529     C***********                                                  051475 082738
128810200529     C***********          UPDATOLPOSOAF                           051475 082738
128820200529     C***********          END                                     051475 082738
128830200529     C***********                                                  051475 082738
128840200529     C***********          ENDSR                                   051475 082738
128850200529      ***********                                                  051475 082738
128860200529     C********************************************************************051475
128870200529      *EJECT*****                                                  051475 082738
128880200529      ********************************************************************051475
128890200529     C***********                                                  051475 082738
128900200529     C**AONOST*-*SUBROUTINE TO CALL ACCESS OBJECT : NOSTRO DETAILS 051475 082738
128910200529     C***********                                                  051475 082738
128920200529     C***********AONOST    BEGSR                           ** AONOS051475 082738
128930200529     C***********                                                  051475 082738
128940200529     C***********          CALL 'AONOSTR0'                         051475 082738
128950200529     C***********          PARM           @RTCD   7                051475 082738
128960200529     C***********          PARM '*KEY   ' @OPTN   7                051475 082738
128970200529     C***********          PARM *BLANKS   P@CUST  6          Custom051475 082738
128980200529     C***********          PARM           P@CYCD  3          Curren051475 082738
128990200529     C***********          PARM *BLANKS   P@ACCD  4          A/c Co051475 082738
129000200529     C***********          PARM *BLANKS   P@ACSN  2          A/c Se051475 082738
129010200529     C***********          PARM           P@NONB  2          Nostro051475 082738
129020200529     C***********          PARM *BLANKS   P@BRCD  3          Branch051475 082738
129030200529     C***********          PARM *BLANKS   P@CSSN 10          Cust S051475 082738
129040200529     C***********          PARM *BLANKS   P@PNOI  1          Prime 051475 082738
129050200529     C***********SDNOST    PARM SDNOST    DSFDY                    051475 082738
129060200529     C***********                                                  051475 082738
129070200529     C***********          ENDSR                                   051475 082738
129080200529     C********************************************************************051475
129090200529      /EJECT                                                              S01117
129100200529     C*****************************************************************   S01117
129110200529     C*                                                               *   S01117
129120200529     C*  D2QRY - SUBROUTINE TO TEST QUERY SELECTION ON DETAIL FIELDS  *   S01117
129130200529     C*                                                               *   S01117
129140200529     C*****************************************************************   S01117
129150200529     C*                                                                   S01117
129160200529     C           D2QRY     BEGSR                            ** D2QRY **   S01117
129170200529     C*                                                                   S01117
129180200529     C                     MOVE 'N'       RDSPLY                          S01117
129190200529     C*                                                                   S01117
129200200529     C**  Test query selection on Book Code field                         S01117
129210200529     C*                                                                   S01117
129220200529     C                     MOVELSPBCD     QMARK                           S01117
129230200529     C           QMARK     IFEQ '?'                                       S01117
129240200529     C                     MOVE 'Y'       RDSPLY                          S01117
129250200529     C                     CALL 'AOBOOKR0'                                S01117
129260200529     C                     PARM *BLANKS   @RTCD                           S01117
129270200529     C                     PARM '*KEY   ' @OPTN                           S01117
129280200529     C                     PARM SPBCD     @BKCD                           S01117
129290200529     C           SDBOOK    PARM SDBOOK    DSFDY                           S01117
129300200529     C*                                                                   S01117
129310200529     C           @RTCD     IFNE *BLANKS                                   S01117
129320200529     C                     MOVEL*BLANKS   SPBCD                           S01117
129330200529     C                     ELSE                                           S01117
129340200529     C                     MOVEL*BLANKS   SPBCD                           S01117
129350200529     C                     MOVELBDBKCD    SPBCD                           S01117
129360200529     C                     END                                            S01117
129370200529     C                     END                                            S01117
129380200529     C*                                                                   S01117
129390200529     C**  Test query selection on Profit Centre Field                     S01117
129400200529     C*                                                                   S01117
129410200529     C           *IN83     IFEQ '1'                                       S01117
129420200529     C                     MOVELSPPFC     QMARK                           S01117
129430200529     C           QMARK     IFEQ '?'                                       S01117
129440200529     C                     MOVE 'Y'       RDSPLY                          S01117
129450200529     C                     CALL 'AOPRFCR0'                                S01117
129460200529     C                     PARM *BLANKS   @RTCD                           S01117
129470200529     C                     PARM '*KEY   ' @OPTN                           S01117
129480200529     C                     PARM SPPFC     @PCCD                           S01117
129490200529     C           SDPRFC    PARM SDPRFC    DSFDY                           S01117
129500200529     C*                                                                   S01117
129510200529     C           @RTCD     IFNE *BLANKS                                   S01117
129520200529     C                     MOVEL*BLANKS   SPPFC                           S01117
129530200529     C                     ELSE                                           S01117
129540200529     C                     MOVEL*BLANKS   SPPFC                           S01117
129550200529     C                     MOVELDSPCCD    SPPFC                           S01117
129560200529     C                     END                                            S01117
129570200529     C                     END                                            S01117
129580200529     C                     END                                            S01117
129590200529     C*                                                                   S01117
129600200529     C**  Test query selection on Settlement Currency field               S01117
129610200529     C*                                                                   S01117
129620200529     C                     MOVELSPSCU     QMARK                           S01117
129630200529     C           QMARK     IFEQ '?'                                       S01117
129640200529     C                     MOVE 'Y'       RDSPLY                          S01117
129650200529     C                     CALL 'AOCURRR0'                                S01117
129660200529     C                     PARM *BLANKS   @RTCD                           S01117
129670200529     C                     PARM '*KEY   ' @OPTN                           S01117
129680200529     C                     PARM SPSCU     @AJCD                           S01117
129690200529     C           SDCURR    PARM SDCURR    DSSDY                           S01117
129700200529     C*                                                                   S01117
129710200529     C           @RTCD     IFNE *BLANKS                                   S01117
129720200529     C                     MOVEL*BLANKS   SPSCU                           S01117
129730200529     C                     ELSE                                           S01117
129740200529     C                     MOVEL*BLANKS   SPSCU                           S01117
129750200529     C                     MOVELA6CYCD    SPSCU                           S01117
129760200529     C                     END                                            S01117
129770200529     C                     MOVELSPSCU     XSPSCU                          151506
129780200529     C                     END                                            S01117
129790200529     C*                                                                   S01117
129800200529     C**  Test query selection on Settlement A/c field                    S01117
129810200529     C**  if settlement method is through nostro                          S01117
129820200529     C*                                                                   S01117
129830200529     C                     MOVELSPSEA     QMARK                           S01117
129840200529     C           QMARK     IFEQ '?'                                       S01117
129850200529     C*                                                                   S01117
129860200529     C           SPSMT     IFEQ '01'                                      S01117
129870200529     C           SPSMT     OREQ '02'                                      S01117
129880200529     C           SPSMT     OREQ '07'                                      S01117
129890200529     C           SPSMT     OREQ '08'                                      S01117
129900200529     C           SPSMT     OREQ '12'                                      S01117
129910200529     C                     MOVE 'Y'       RDSPLY                          S01117
129920200529     C                     MOVELSPNCY     NOCUR   3                       S01117
129930200529     C                     MOVELSPSEA     NOS2A   2                       S01117
129940200529     C                     CALL 'AONOSTR0'                                S01117
129950200529     C                     PARM *BLANKS   @RTCD                           S01117
129960200529     C                     PARM '*KEY   ' @OPTN                           S01117
129970200529     C                     PARM *BLANKS   @CUST                           S01117
129980200529     C                     PARM NOCUR     @CCYC                           S01117
129990200529     C                     PARM *BLANKS   @ACCD                           S01117
130000200529     C                     PARM *BLANKS   @ACSQ                           S01117
130010200529     C                     PARM NOS2A     @NOSN                           S01117
130020200529     C                     PARM *BLANKS   @BRCD                           S01117
130030200529     C                     PARM *BLANKS   @CUSN                           S01117
130040200529     C                     PARM *BLANKS   @PRNO                           S01117
130050200529     C           SDNOST    PARM SDNOST    DSFDY                           S01117
130060200529     C*                                                                   S01117
130070200529     C           @RTCD     IFNE *BLANKS                                   S01117
130080200529     C                     MOVEL*BLANKS   SPSEA                           S01117
130090200529     C                     ELSE                                           S01117
130100200529     C                     MOVEL*BLANKS   SPSEA                           S01117
130110200529     C                     MOVELA7NONB    SPSEA                           S01117
130120200529     C                     END                                            S01117
130130200529     C                     END                                            S01117
130140200529     C                     END                                            S01117
130150200529     C*                                                                   S01117
130160200529     C**  Test query selection on Settlement Branch field                 S01117
130170200529     C**  If Multibranching indicator is on                               S01117
130180200529     C*                                                                   S01117
130190200529     C           *IN81     IFEQ '1'                                       S01117
130200200529     C                     MOVELSPSEB     QMARK                           S01117
130210200529     C           QMARK     IFEQ '?'                                       S01117
130220200529     C                     MOVE 'Y'       RDSPLY                          S01117
130230200529     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
130240200529     C                     CALL 'AOBRCHR1'                                                    CGL029
130250200529     C                     PARM *BLANKS   @RTCD                           S01117
130260200529     C                     PARM '*KEY   ' @OPTN                           S01117
130270200529     C                     PARM SPSEB     @DSNB                           S01117
130280200529     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01117              CGL029
130290200529     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
130300200529     C*                                                                   S01117
130310200529     C           @RTCD     IFNE *BLANKS                                   S01117
130320200529     C                     MOVEL*BLANKS   SPSEB                           S01117
130330200529     C                     ELSE                                           S01117
130340200529     C                     MOVEL*BLANKS   SPSEB                           S01117
130350200529     C                     MOVELA8BRCD    SPSEB                           S01117
130360200529     C                     END                                            S01117
130370200529     C                     END                                            S01117
130380200529     C                     END                                            S01117
130390200529     C*                                                                   S01117
130400200529     C**  Test query selection on Counterparty Bank field                 S01117
130410200529     C*                                                                   S01117
130420200529     C                     MOVELSPCPN     QMARK                           S01117
130430200529     C           QMARK     IFEQ '?'                                       S01117
130440200529     C*                                                                   S01117
130450200529     C           SPSMT     IFEQ '01'                                      S01117
130460200529     C           SPSMT     OREQ '07'                                      S01117
130470200529     C           SPSMT     OREQ '08'                                      S01117
130480200529     C                     MOVE 'Y'       RDSPLY                          S01117
130490200529     C                     CALL 'AOCUSTR0'                                S01117
130500200529     C                     PARM *BLANKS   @RTCD                           S01117
130510200529     C                     PARM '*KEY   ' @OPTN                           S01117
130520200529     C                     PARM SPCPN     @KEY1                           S01117
130530200529     C                     PARM *BLANKS   @KYST                           S01117
130540200529     C           SDCUST    PARM SDCUST    DSSDY                           S01117
130550200529     C*                                                                   S01117
130560200529     C           @RTCD     IFEQ *BLANKS                                   S01117
130570200529     C                     MOVEL*BLANKS   SPCPN                           S01117
130580200529     C                     MOVELBBCUST    SPCPN                           S01117
130590200529     C                     ELSE                                           S01117
130600200529     C*                                                                   S01117
130610200529     C**  No selection made, display Counterparty Nostro details          S01117
130620200529     C*                                                                   S01117
130630200529     C           @RTCD     IFEQ '*NOSEL'                                  S01117
130640200529     C                     MOVELSPCPN     CPNST                           S01117
130650200529     C                     CALL 'AOCNSTR0'                                S01117
130660200529     C                     PARM *BLANKS   @RTCD                           S01117
130670200529     C                     PARM '*KEY   ' @OPTN                           S01117
130680200529     C                     PARM CPNST     @CPNC                           S01117
130690200529     C           SDCNST    PARM SDCNST    DSFDY                           S01117
130700200529     C*                                                                   S01117
130710200529     C           @RTCD     IFNE *BLANKS                                   S01117
130720200529     C                     MOVEL*BLANKS   SPCPN                           S01117
130730200529     C                     ELSE                                           S01117
130740200529     C                     MOVEL*BLANKS   SPCPN                           S01117
130750200529     C                     MOVELAWCPNC    SPCPN                           S01117
130760200529     C                     END                                            S01117
130770200529     C                     END                                            S01117
130780200529     C*                                                                   S01117
130790200529     C                     END                                            S01117
130800200529     C                     END                                            S01117
130810200529     C                     END                                            S01117
130820200529     C*                                                                   S01117
130830200529     C**  Test query selection on For A/C of field                        S01117
130840200529     C*                                                                   S01117
130850200529     C                     MOVELSPFAC     QMARK                           S01117
130860200529     C           QMARK     IFEQ '?'                                       S01117
130870200529     C*                                                                   S01117
130880200529     C           SPSMT     IFEQ '01'                                      S01117
130890200529     C           SPSMT     OREQ '07'                                      S01117
130900200529     C           SPSMT     OREQ '08'                                      S01117
130910200529     C           SPPRE     IFEQ 'P'                                       S01117
130920200529     C                     MOVE 'Y'       RDSPLY                          S01117
130930200529     C                     CALL 'AOCUSTR0'                                S01117
130940200529     C                     PARM *BLANKS   @RTCD                           S01117
130950200529     C                     PARM '*KEY   ' @OPTN                           S01117
130960200529     C                     PARM SPFAC     @KEY1                           S01117
130970200529     C                     PARM *BLANKS   @KYST                           S01117
130980200529     C           SDCUST    PARM SDCUST    DSSDY                           S01117
130990200529     C*                                                                   S01117
131000200529     C           @RTCD     IFEQ *BLANKS                                   S01117
131010200529     C                     MOVEL*BLANKS   SPFAC                           S01117
131020200529     C                     MOVELBBCUST    SPFAC                           S01117
131030200529     C                     ELSE                                           S01117
131040200529     C*                                                                   S01117
131050200529     C**  No selection made, display Counterparty Nostro details          S01117
131060200529     C*                                                                   S01117
131070200529     C           @RTCD     IFEQ '*NOSEL'                                  S01117
131080200529     C                     MOVELSPFAC     CPNST                           S01117
131090200529     C                     CALL 'AOCNSTR0'                                S01117
131100200529     C                     PARM *BLANKS   @RTCD                           S01117
131110200529     C                     PARM '*KEY   ' @OPTN                           S01117
131120200529     C                     PARM CPNST     @CPNC                           S01117
131130200529     C           SDCNST    PARM SDCNST    DSFDY                           S01117
131140200529     C*                                                                   S01117
131150200529     C           @RTCD     IFNE *BLANKS                                   S01117
131160200529     C                     MOVEL*BLANKS   SPFAC                           S01117
131170200529     C                     ELSE                                           S01117
131180200529     C                     MOVEL*BLANKS   SPFAC                           S01117
131190200529     C                     MOVELAWCPNC    SPFAC                           S01117
131200200529     C                     END                                            S01117
131210200529     C                     END                                            S01117
131220200529     C*                                                                   S01117
131230200529     C                     END                                            S01117
131240200529     C                     END                                            S01117
131250200529     C                     END                                            S01117
131260200529     C                     END                                            S01117
131270200529     C/COPY WNCPYSRC,SE0170C023
131280200529     C*                                                                   S01117
131290200529     C                     ENDSR                                          S01117
131300200529     C*****************************************************************   S01117
131310200529      /EJECT
131320200529     C*                                                                   S01408
131330200529     C/COPY WNCPYSRC,SE0170CCP4                                           S01408
131340200529     C*                                                                   S01408
131350200529      *****************************************************************   CAC002
131360200529      *                                                               *   CAC002
131370200529      *  Subroutine  :  SRNQDP                                        *   CAC002
131380200529      *  Function    :  Get Normally-Quoted Decimal Places            *   CAC002
131390200529      *                                                               *   CAC002
131400200529      *  Called by   :  D3VALD - Validate Screen 3 Data Entry         *   CAC002
131410200529      *  Calls       :  -                                             *   CAC002
131420200529      *                                                               *   CAC002
131430200529      *****************************************************************   CAC002
131440200529      *                                                                   CAC002
131450200529     C           SRNQDP    BEGSR                           ** SRNQDP **   CAC002
131460200529      *                                                                   CAC002
131470200529      ** --------------------------------------------------------------   CAC002
131480200529      **  If either the nominal or settlement currency is the base        CAC002
131490200529      **  currency obtain the number of normally-quoted decimal places    CAC002
131500200529      **  for the other currency. Otherwise:                              CAC002
131510200529      **      A)  If ZNQDP1 =  ZNQDP2 =  5       :   ZNQDPX = 5           CAC002
131520200529      **      B)  If ZNQDP1 =  ZNQDP2 <> 5  or                            CAC002
131530200529      **             ZNQDP1 <> ZNQDP2                                     CAC002
131540200529      **             1)  If Rate >= 100          :   ZNQDPX = 2           CAC002
131550200529      **             2)  If 100 > Rate >= 20     :   ZNQDPX = 3           CAC002
131560200529      **             3)  If 20  > Rate >= 1      :   ZNQDPX = 4           CAC002
131570200529      **             4)  If 1   > Rate           :   ZNQDPX = 5           CAC002
131580200529      **---------------------------------------------------------------   CAC002
131590200529      *                                                                   CAC002
131600200529     C                     SELEC                                          CAC002
131610200529      *                                                                   CAC002
131620200529     C           NMCY      WHEQ BJCYCD                                    CAC002
131630200529     C                     Z-ADDZNQDP2    ZNQDPX  10                      CAC002
131640200529      *                                                                   CAC002
131650200529     C           SPSCU     WHEQ BJCYCD                                    CAC002
131660200529     C                     Z-ADDZNQDP1    ZNQDPX                          CAC002
131670200529      *                                                                   CAC002
131680200529     C           ZNQDP1    WHEQ ZNQDP2                                    CAC002
131690200529     C           ZNQDP1    ANDEQ5                                         CAC002
131700200529     C                     Z-ADD5         ZNQDPX                          CAC002
131710200529      *                                                                   CAC002
131720200529     C           PSXR      WHEQ 100                                       CAC002
131730200529     C                     Z-ADD2         ZNQDPX                          CAC002
131740200529      *                                                                   CAC002
131750200529     C           PSXR      WHLT 100                                       CAC002
131760200529     C           PSXR      ANDGE20                                        CAC002
131770200529     C                     Z-ADD3         ZNQDPX                          CAC002
131780200529      *                                                                   CAC002
131790200529     C           PSXR      WHLT 20                                        CAC002
131800200529     C           PSXR      ANDGE1                                         CAC002
131810200529     C                     Z-ADD4         ZNQDPX                          CAC002
131820200529      *                                                                   CAC002
131830200529     C           PSXR      WHLT 1                                         CAC002
131840200529     C                     Z-ADD5         ZNQDPX                          CAC002
131850200529      *                                                                   CAC002
131860200529     C                     ENDSL                                          CAC002
131870200529      *                                                                   CAC002
131880200529     C           SRNQD9    ENDSR                           ** SRNQD9 **   CAC002
131890200529      *                                                                   CAC002
131900200529     C*****************************************************************   CAC002
131910200529      /EJECT                                                                                  CSE028
131920200529      *****************************************************************                       CSE028
131930200529      *                                                               *                       CSE028
131940200529      * SRSSIR - Sub-routine to call SESSIR0.                         *                       CSE028
131950200529      *                                                               *                       CSE028
131960200529      * Called by: DEFLTS                                             *                       CSE028
131970200529      *                                                               *                       CSE028
131980200529      * Calls:                                                        *                       CSE028
131990200529      *                                                               *                       CSE028
132000200529      *****************************************************************                       CSE028
132010200529     C           SRSSIR    BEGSR                                                              CSE028
132020200529      *                                                                                       CSE028
132030200529     C                     MOVE 'N'       NOTFND                                              CSE028
132040200529     C                     MOVE PCPY      WCUST   6                                           CSE028
132050200529     C                     CALL 'SESSIR0'                                                     CSE028
132060200529     C                     PARM 'D'       POTYP   1                                           CSE028
132070200529     C                     PARM           PBCA                                                CSE028
132080200529     C                     PARM           WCUST                                               CSE028
132090200529     C                     PARM           WBKCD   2                                           CSE028
132100200529     C                     PARM           CURK                                                CSE028
132110200529     C                     PARM           SMCC                                                CSE034
132120200529     C                     PARM *BLANKS   WSITP   3                                           CSE028
132130200529     C                     PARM *BLANKS   WPTFR   4                                           CSE028
132140200529     C                     PARM           PCBSTD                                              CSE028
132150200529     C                     PARM           PCBSAD                                              CSE028
132160200529     C                     PARM *BLANKS   PRETCD  5                                           CSE028
132170200529      *                                                                                       CSE028
132180200529     C           PRETCD    IFNE '*NCRF'                                                       CSE028
132190200529     C           PRETCD    ANDNE'*NRF '                                                       CSE028
132200200529     C           2         OCUR PCBSTD                                                        CSE028
132210200529     C                     ELSE                                                               CSE028
132220200529     C           PRETCD    IFNE '*NBRF'                                                       CSE028
132230200529     C           PRETCD    ANDNE'*NRF '                                                       CSE028
132240200529     C           1         OCUR PCBSTD                                                        CSE028
132250200529     C                     ELSE                                                               CSE028
132260200529     C                     MOVE 'Y'       NOTFND  1                                           CSE028
132270200529     C                     ENDIF                                                              CSE028
132280200529     C                     ENDIF                                                              CSE028
132290200529      *                                                                                       CSE028
132300200529     C                     ENDSR                                                              CSE028
132310200529      *****************************************************************                       CSE028
132320200529      /EJECT                                                              CAC002
132330200529     C*****************************************************************   S01117
132340200529     C*                                                               *   S01117
132350200529     C* *PSSR - SUBROUTINE TO HANDLE ABNORMAL ERROR CONDITIONS        *   S01117
132360200529     C*                                                               *   S01117
132370200529     C* CALLED FROM : AFTER ABNORMAL OPERATION OCCURS                 *   S01117
132380200529     C*                                                               *   S01117
132390200529     C* CALLS : NOTHING                                               *   S01117
132400200529     C*****************************************************************   S01117
132410200529     C*                                                                   S01117
132420200529     C           *PSSR     BEGSR                           ** *PSSR **    S01117
132430200529     C*                                                                   S01117
132440200529     C           @RUN      IFEQ *BLANKS                                   S01117
132450200529     C                     MOVE 'Y'       @RUN    1                       S01117
132460200529     C                     DUMP                                           S01117
132470200529     C                     END                                            S01117
132480200529     C*                                                                   S01447
132490200529     C                     CALL 'DBERRCTL'                                S01447
132500200529     C*                                                                   S01117
132510200529     C                     ENDSR                                          S01117
132520200529     C********************************************************************S01117
132530200529      /EJECT
132540200529     C/COPY ZSRSRC,ZALIGNZ2
132550200529      /EJECT
132560200529     C/COPY ZSRSRC,ZASIGNZ2
132570200529      /EJECT                                                              S01512
132580200529     C/COPY ZSRSRC,ZCONVZ1                                                S01512
132590200529      /EJECT
132600200529     C/COPY ZSRSRC,ZDATE1Z2
132610200529      /EJECT
132620200529     C/COPY ZSRSRC,ZDATE2Z4
132630200529      /EJECT
132640200529     C*COPY*ZSRSRC,ZDATE6Z2****************                               S01195
132650200529      /EJECT
132660200529     C/COPY ZSRSRC,ZACCH                                                  S01195
132670200529     C/EJECT                                                              S01195
132680200529     C/COPY ZSRSRC,ZCHKH                                                  S01195
132690200529      /EJECT
132700200529     C*COPY*ZSRSRC*ZICD2Z1*************                                   S01117
132710200529      *EJECT*****                                                         S01117
132720200529     C*COPY*ZSRSRC*ZICDSEZ1************                                   S01117
132730200529      *EJECT*****                                                         S01117
132740200529     C/COPY ZSRSRC,ZSEDITZ3
132750200529      /EJECT
132760200529     C*COPY*ZSRSRC*ZSYSTMZ1************                                   S01117
132770200529      *EJECT*****                                                         S01117
132780200529     C/COPY ZSRSRC,ZTNLU1Z2
132790200529      /EJECT
132800200529     C/COPY ZSRSRC,ZXRATEZ1
132810200529      /EJECT                                                                                  191161
132820200529      *****************************************************************                       191161
132830200529      * Subroutine  :  UPDCAF                                         *                       191161
132840200529      * Function    :  Update Transaction Number of Last Update       *                       191161
132850200529      *                in PF/SECOALPD and/or PF/SECODPPD.             *                       191161
132860200529      *                                                               *                       191161
132870200529      * Called by   :  Subroutine UPDFLS                              *                       191161
132880200529      * Calls       :                                                 *                       191161
132890200529      *****************************************************************                       191161
132900200529      *                                                                                       191161
132910200529     C           UPDCAF    BEGSR                                                              191161
132920200529      *                                                                                       191161
132930200529     C           CUSTTP    KLIST                                                              191161
132940200529     C                     KFLD           PBCA                                                191161
132950200529     C                     KFLD           PCPY                                                191161
132960200529     C                     KFLD           PEVT                                                191161
132970200529     C                     KFLD           PTFR                                                191161
132980200529     C                     KFLD           TNLU1                                               191161
132990200529      *                                                                                       191161
133000200529     C           DEPOTP    KLIST                                                              191161
133010200529     C                     KFLD           PBCA                                                191161
133020200529     C                     KFLD           PCPY                                                191161
133030200529     C                     KFLD           PEVT                                                191161
133040200529     C                     KFLD           TNLU1                                               191161
133050200529      *                                                                                       191161
133060200529     C                     MOVE *BLANK    FOUND   1                                           191161
133070200529      *                                                                                       191161
133080200529     C           PCPYTP    IFEQ 'C'                                                           191161
133090200529     C           CUSTTP    SETLLSECOALLA                                                      191161
133100200529     C           CUSTTP    READESECOALLA                 58                                   191161
133110200529     C                     ELSE                                                               191161
133120200529     C           DEPOTP    SETLLSECODPL7                                                      191161
133130200529     C           DEPOTP    READESECODPL7                 58                                   191161
133140200529     C                     ENDIF                                                              191161
133150200529      *                                                                                       191161
133160200529     C           *IN58     DOUEQ'1'                                                           191161
133170200529     C           FOUND     OREQ 'Y'                                                           191161
133180200529      *                                                                                       191161
133190200529     C           PCPYTP    IFEQ 'C'                                                           191161
133200200529     C           MCCORF    CHAINSECORFL0             59                                       191161
133210200529     C                     ELSE                                                               191161
133220200529     C           MBCORF    CHAINSECORFL0             59                                       191161
133230200529     C                     ENDIF                                                              191161
133240200529      *                                                                                       191161
133250200529     C           *IN59     IFEQ '0'                                                           191161
133260200529     C           MASESN    ANDEQPSSH                                                          191161
133270200529     C           MAALEF    ANDEQPDUD                                                          191161
133280200529     C           MACOAT    ANDEQPEVT                                                          191161
133290200529      *                                                                                       191161
133300200529     C                     MOVEL'Y'       FOUND                                               191161
133310200529      *                                                                                       191161
133320200529     C           PCPYTP    IFEQ 'C'                                                           191161
133330200529     C                     Z-ADDTNL1      MCTNL1                                              191161
133340200529     C                     UPDATSECOALD0                                                      191161
133350200529     C                     ELSE                                                               191161
133360200529     C                     Z-ADDTNL1      MBTNL1                                              191161
133370200529     C                     UPDATSECODPD0                                                      191161
133380200529     C                     ENDIF                                                              191161
133390200529     C                     ENDIF                                                              191161
133400200529      *                                                                                       191161
133410200529     C           PCPYTP    IFEQ 'C'                                                           191161
133420200529     C           CUSTTP    READESECOALLA                 58                                   191161
133430200529     C                     ELSE                                                               191161
133440200529     C           DEPOTP    READESECODPL7                 58                                   191161
133450200529     C                     ENDIF                                                              191161
133460200529      *                                                                                       191161
133470200529     C                     END                                                                191161
133480200529     C                     ENDSR                                                              191161
133490200529      *****************************************************************                       191161
133500200529      /EJECT                                                                                  CSD015
133510200529      *****************************************************************                       CSD015
133520200529      * Subroutine  :  SRWTCH                                         *                       CSD015
133530200529      * Function    :  This subroutine will send details to the       *                       CSD015
133540200529      *                Compliance watch engine program.               *                       CSD015
133550200529      *                                                               *                       CSD015
133560200529      * Called by   :  Subroutine UPDFLS                              *                       CSD015
133570200529      * Calls       :  SDCWLCHK                                       *                       CSD015
133580200529      *****************************************************************                       CSD015
133590200529      *                                                                                       CSD015
133600200529     C           SRWTCH    BEGSR                                                              CSD015
133610200529      *                                                                                       CSD015
133620200529     C                     MOVE *BLANKS   RSLT2 216                                           CSD015
133630200529     C                     MOVE *BLANKS   RSLT3 216                                           CSD015
133640200529     C                     MOVE *BLANKS   RSLT4 216                                           CSD015
133650200529     C                     MOVE *BLANKS   RSLT   30                                           CSD015
133660200529     C                     MOVE PDUD      PDUDA   5                                           CSD015
133670200529     C                     MOVE PCPY      PCPYA   6                                           CSD015
133680200529      *                                                                                       CSD015
133690200529     C                     MOVE 'SEPOSS'  W4ITEM                                              CSD015
133700200529      *                                                                                       CSD015
133710200529     C           PBCA      CAT  PSSH:0    RSLTMP                                              CSD015
133720200529     C           RSLTMP    CAT  PCPYA     RSLT                                                CSD015
133730200529     C           RSLT      CAT  PDUDA:0   RSLT                                                CSD015
133740200529     C           RSLT      CAT  PEVT:0    RSLT   30                                           CSD015
133750200529     C                     MOVELRSLT      W4IDEN                                              CSD015
133760200529     C                     MOVELPBCA      W4BRCH                                              CSD015
133770200529     C                     MOVELLIBR      W4SYSM                                              CSD015
133780200529     C                     MOVEL'POSETD'  W4FUNT                                              CSD015
133790200529      *                                                                                       CSD015
133800200529     C                     CALL 'AOCUSTR0'                                                    CSD015
133810200529     C                     PARM *BLANKS   @RTCD                                               CSD015
133820200529     C                     PARM '*KEY   ' @OPTN                                               CSD015
133830200529     C                     PARM PCPYA     @KEY1  10                                           CSD015
133840200529     C                     PARM *BLANKS   @KYST   7                                           CSD015
133850200529     C           SDCUST    PARM SDCUST    DSSDY                                               CSD015
133860200529      *                                                                                       CSD015
133870200529     C           @RTCD     IFNE *BLANKS                                                       CSD015
133880200529     C           @RTCD     ANDNE'*NRF   '                                                     CSD015
133890200529     C                     MOVE 47        DBASE                                               CSD015
133900200529     C                     MOVELPCPY      DBKEY                                               CSD015
133910200529     C                     MOVEL'SDCUSTPD'DBFILE                                              CSD015
133920200529     C                     EXSR *PSSR                                                         CSD015
133930200529     C                     ENDIF                                                              CSD015
133940200529      *                                                                                       CSD015
133950200529     C                     MOVELPCPY      W4CNUM                                              CSD015
133960200529     C           @RTCD     IFEQ *BLANKS                                                       CSD015
133970200529      *                                                                                       CSD015
133980200529     C           BBCRNM    CAT  BBCRTN    W4CUST                                              CSD015
133990200529      *                                                                                       CSD015
134000200529     C           CCF001    IFEQ 'Y'                                                           CSD015
134010200529      *                                                                                       CSD015
134020200529     C           BBCRPC    IFEQ 'Y'                                                           CSD015
134030200529     C                     MOVE 'C'       W4CTYP                                              CSD015
134040200529     C                     ELSE                                                               CSD015
134050200529     C                     MOVE 'I'       W4CTYP                                              CSD015
134060200529     C                     ENDIF                                                              CSD015
134070200529      *                                                                                       CSD015
134080200529     C                     ELSE                                                               CSD015
134090200529      *                                                                                       CSD015
134100200529     C           BBLICD    IFNE *BLANK                                                        CSD015
134110200529     C           BBLICD    ANDNEW1IND1                                                        CSD015
134120200529     C           BBLICD    ANDNEW1IND2                                                        CSD015
134130200529     C           BBLICD    ANDNEW1IND3                                                        CSD015
134140200529     C           BBLICD    ANDNEW1IND4                                                        CSD015
134150200529     C           BBLICD    ANDNEW1IND5                                                        CSD015
134160200529     C                     MOVEL'C'       W4CTYP                                              CSD015
134170200529     C                     ELSE                                                               CSD015
134180200529     C                     MOVEL'I'       W4CTYP                                              CSD015
134190200529     C                     ENDIF                                                              CSD015
134200200529      *                                                                                       CSD015
134210200529     C                     ENDIF                                                              CSD015
134220200529     C                     ENDIF                                                              CSD015
134230200529      *                                                                                       CSD015
134240200529     C                     MOVELPDUD      W4DDAT                                              CSD015
134250200529     C                     MOVELPSVL      W4VDAT                                              CSD015
134260200529     C                     Z-ADD0         W4MDAT                                              CSD015
134270200529     C                     MOVELPSSH      W4DEN1                                              CSD015
134280200529     C                     MOVEL*BLANKS   W4DEN2                                              CSD015
134290200529     C                     Z-ADDPNMP      W4AMT1                                              CSD015
134300200529     C                     Z-ADD0         W4AMT2                                              CSD015
134310200529      *                                                                                       CSD015
134320200529      **  If action code is amend check the current status of the existing transaction.       CSD015
134330200529      *                                                                                       CSD015
134340200529     C           ACTN      IFEQ 'A'                                                           CSD015
134350200529     C           CMPKEY    CHAINSDCWHTL1             76                                       CSD015
134360200529     C                     ENDIF                                                              CSD015
134370200529      *                                                                                       CSD015
134380200529     C           ACTN      IFEQ 'I'                                                           CSD015
134390200529     C           W3UNCF    OREQ 'Y'                                                           CSD015
134400200529     C           ACTN      OREQ 'A'                                                           CSD015
134410200529     C           PSEA      ANDNEXPSEA                                                         CSD015
134420200529     C                     MOVE *BLANKS   FLD1   18                                           CSD015
134430200529     C                     MOVELPSEA      FLD1   18                                           CSD015
134440200529     C                     EXSR CONV                                                          CSD015
134450200529     C                     MOVELOUTFMT    RSLT2 216                                           CSD015
134460200529     C                     ENDIF                                                              CSD015
134470200529      *                                                                                       CSD015
134480200529     C           ACTN      IFEQ 'I'                                                           CSD015
134490200529     C           W3UNCF    OREQ 'Y'                                                           CSD015
134500200529     C           ACTN      OREQ 'A'                                                           CSD015
134510200529     C           PCPN      ANDNEXPCPN                                                         CSD015
134520200529     C                     MOVE *BLANKS   FLD1   18                                           CSD015
134530200529     C                     MOVELPCPN      FLD1   18                                           CSD015
134540200529     C                     EXSR CONV                                                          CSD015
134550200529     C                     MOVELOUTFMT    RSLT3                                               CSD015
134560200529     C                     ENDIF                                                              CSD015
134570200529      *                                                                                       CSD015
134580200529     C           ACTN      IFEQ 'I'                                                           CSD015
134590200529     C           W3UNCF    OREQ 'Y'                                                           CSD015
134600200529     C           ACTN      OREQ 'A'                                                           CSD015
134610200529     C           PFAC      ANDNEXPFAC                                                         CSD015
134620200529     C                     MOVE *BLANKS   FLD1   18                                           CSD015
134630200529     C                     MOVELPCPN      FLD1   18                                           CSD015
134640200529     C                     EXSR CONV                                                          CSD015
134650200529     C                     MOVELOUTFMT    RSLT4 216                                           CSD015
134660200529     C                     ENDIF                                                              CSD015
134670200529      *                                                                                       CSD015
134680200529     C           RSLT2     IFNE *BLANKS                                                       CSD015
134690200529     C           CRW,1     CAT  RSLT2:0   PSTRNG                                              CSD015
134700200529     C           PSTRNG    CAT  CRW,2:0   PSTRNG                                              CSD015
134710200529     C                     ENDIF                                                              CSD015
134720200529      *                                                                                       CSD015
134730200529     C           RSLT2     IFNE *BLANKS                                                       CSD015
134740200529     C           CRW,1     CAT  RSLT2:0   PSTRNG                                              CSD015
134750200529     C           PSTRNG    CAT  CRW,2:0   PSTRNG                                              CSD015
134760200529     C                     ENDIF                                                              CSD015
134770200529      *                                                                                       CSD015
134780200529     C           RSLT3     IFNE *BLANKS                                                       CSD015
134790200529     C           PSTRNG    CAT  CRW,3:0   PSTRNG                                              CSD015
134800200529     C           PSTRNG    CAT  RSLT3:0   PSTRNG                                              CSD015
134810200529     C           PSTRNG    CAT  CRW,4:0   PSTRNG                                              CSD015
134820200529     C                     ENDIF                                                              CSD015
134830200529      *                                                                                       CSD015
134840200529     C           RSLT4     IFNE *BLANKS                                                       CSD015
134850200529     C           PSTRNG    CAT  CRW,5:0   PSTRNG                                              CSD015
134860200529     C           PSTRNG    CAT  RSLT4:0   PSTRNG                                              CSD015
134870200529     C           PSTRNG    CAT  CRW,6:0   PSTRNG                                              CSD015
134880200529     C                     ENDIF                                                              CSD015
134890200529      *                                                                                       CSD015
134900200529      ** Send position settlement and extended settlment details to the engine program.       CSD015
134910200529      *                                                                                       CSD015
134920200529     C           WWEXRC    IFNE *BLANKS                                                       CSD015
134930200529     C           PSTRNG    CAT  WWEXRC:0  PSTRNG                                              CSD015
134940200529     C                     ENDIF                                                              CSD015
134950200529      *                                                                                       CSD015
134960200529     C           PSTRNG    IFNE *BLANKS                                                       CSD015
134970200529     C                     CALL 'SDWLCLOP'                                                    CSD015
134980200529     C                     PARM           PDS1                                                CSD015
134990200529     C                     PARM           PSTRNG                                              CSD015
135000200529     C                     ENDIF                                                              CSD015
135010200529      *                                                                                       CSD015
135020200529     C                     ENDSR                                                              CSD015
135030200529      *****************************************************************                       CSD015
135040200529      /EJECT                                                                                  CSD015
135050200529      *****************************************************************                       CSD015
135060200529      * Subroutine  :  CONV                                           *                       CSD015
135070200529      * Function    :  This subroutine will convert accounts, customer*                       CSD015
135080200529      *                no. to customer name and address.              *                       CSD015
135090200529      *                                                               *                       CSD015
135100200529      * Called by   :  Subroutine UPDFLS                              *                       CSD015
135110200529      * Calls       :  SDCWLCHK                                       *                       CSD015
135120200529      *****************************************************************                       CSD015
135130200529      *                                                                                       CSD015
135140200529     C           CONV      BEGSR                                                              CSD015
135150200529      *                                                                                       CSD015
135160200529     C                     MOVE *BLANKS   OUTFMT216                                           CSD015
135170200529     C                     MOVE *BLANKS   WRTCD  35                                           CSD015
135180200529      *                                                                                       CSD015
135190200529     C           FLD1      IFNE *BLANKS                                                       CSD015
135200200529     C                     CALL 'SDCWLFMT'                                                    CSD015
135210200529     C                     PARM *BLANKS   PRTCD   7                                           CSD015
135220200529     C                     PARM FLD1      WRTC1  35                                           CSD015
135230200529     C                     PARM           WRTC2  35                                           CSD015
135240200529     C                     PARM           WRTC3  35                                           CSD015
135250200529     C                     PARM           WRTC4  35                                           CSD015
135260200529     C                     PARM           WRTC5  35                                           CSD015
135270200529     C                     PARM           WRTC6  35                                           CSD015
135280200529     C                     PARM PNCY      WRTC7   3                                           CSD015
135290200529     C                     PARM           OUTFMT216                                           CSD015
135300200529     C                     PARM           OUTCUS  6                                           CSD015
135310200529     C                     ENDIF                                                              CSD015
135320200529     C                     ENDSR                                                              CSD015
135330200529      *****************************************************************                       CSD015
135340200529      /EJECT                                                                                AR324886
135350200529      *****************************************************************                     AR324886
135360200529     C           PSAUDT    BEGSR                                                            AR324886
135370200529      *                                                                                     AR324886
135380200529     C                     CLEARDSAUTH                                                      AR324886
135390200529     C           PSAUTH    CHAINPSAUT                80                                     AR324886
135400200529      *                                                                                     AR324886
135410200529     C                     MOVE RECI      PARECI                                            AR324886
135420200529     C                     MOVE TNL1      PATNLU                                            AR324886
135430200529      *                                                                                     AR324886
135440200529     C           SACTN     IFEQ 'U'                                                         AR324886
135450200529     C                     MOVE USID      PAUUSR                                            AR324886
135460200529     C                     MOVE RUND      PALUD                                             AR324886
135470200529     C                     ENDIF                                                            AR324886
135480200529      *                                                                                     AR324886
135490200529     C           *IN80     IFEQ *ON                                                         AR324886
135500200529     C                     MOVE PBCA      PAPBCA                                            AR324886
135510200529     C                     MOVE PSSH      PAPSSH                                            AR324886
135520200529     C                     MOVE PCPY      PAPCPY                                            AR324886
135530200529     C                     MOVE PDUD      PAPDUD                                            AR324886
135540200529     C                     MOVE PEVT      PAPEVT                                            AR324886
135550200529     C                     MOVE PTFR      PAPTFR                                            AR324886
135560200529     C                     MOVE TXBS      PATXBS                                            AR324886
135570200529     C                     MOVE BNFO      PABNFO                                            AR324886
135580200529     C                     MOVE EXCD      PAEXCD                                            AR324886
135590200529     C                     MOVE USID      PALUSR                                            AR324886
135600200529     C                     MOVE RUND      PALCD                                             AR324886
135610200529     C                     MOVE SACTN     PALCTP                                            AR324886
135620200529     C                     WRITEPSAUTDF                                                     AR324886
135630200529      *                                                                                     AR324886
135640200529     C                     ELSE                                                             AR324886
135650200529     C           SACTN     IFNE 'A'                                                         AR324886
135660200529     C           SACTN     OREQ 'A'                                                         AR324886
135670200529     C           PALCTP    ANDNE'A'                                                         AR324886
135680200529     C           SACTN     OREQ 'A'                                                         AR324886
135690200529     C           PALCTP    ANDEQ'A'                                                         AR324886
135700200529     C           USID      ANDNEPALUSR                                                      AR324886
135710200529     C                     MOVE PALUSR    PAPUSR                                            AR324886
135720200529     C                     MOVE PALCD     PAPCD                                             AR324886
135730200529     C                     MOVE PALCTP    PAPCTP                                            AR324886
135740200529     C                     ENDIF                                                            AR324886
135750200529     C                     MOVE USID      PALUSR                                            AR324886
135760200529     C                     MOVE RUND      PALCD                                             AR324886
135770200529     C                     MOVE SACTN     PALCTP                                            AR324886
135780200529     C                     UPDATPSAUTDF                                                     AR324886
135790200529      *                                                                                     AR324886
135800200529     C                     ENDIF                                                            AR324886
135810200529      *                                                                                     AR324886
135820200529     C                     ENDSR                                                            AR324886
135830200529      *****************************************************************                     AR324886
135840200529      /EJECT                                                                                  CER049
135850200529      *****************************************************************                       CER049
135860200529      * Subroutine  :  SRSTAX                                         *                       CER049
135870200529      * Function    :  This subroutine will calculate the stamp tax   *                       CER049
135880200529      *                and charge amount.                             *                       CER049
135890200529      *****************************************************************                       CER049
135900200529      *                                                                                       CER049
135910200529     C           SRSTAX    BEGSR                                                              CER049
135920200529      *                                                                                       CER049
135930200529     C           SPTAXL    IFEQ 'N'                                                           CER049
135940200529     C                     MOVEL*BLANKS   SPCHCD                                              CER049
135950200529     C                     MOVEL*BLANKS   SPTAXA                                           AR875302A
135960200529     C                     MOVEL*BLANKS   SPCHAM                                           AR875302A
135970200529     C                     MOVEL*ZEROS    WTAXA                                               CER049
135980200529     C                     MOVELBJLCCY    U#SCCY                                              CER049
135990200529      ** Default Stamp Tax Liable                                                           AR851784
136000200529     C           W1STPS    IFNE 'Y'                                                         AR851784
136010200529     C                     MOVE 'Y'       W1STPS                                            AR851784
136020200529     C                     CALL 'AOBRCHR2'                                                  AR851784
136030200529     C                     PARM *BLANKS   @RTCD                                             AR851784
136040200529     C                     PARM '*KEY   ' @OPTN                                             AR851784
136050200529     C                     PARM SPBCA     @DSNB                                             AR851784
136060200529     C           SDBRCE    PARM SDBRCE    DSSDY                                             AR851784
136070200529     C           @RTCD     IFEQ *BLANKS                                                     AR851784
136080200529     C                     MOVE BXTAX     WSTAX                                             AR851784
136090200529     C                     ENDIF                                                            AR851784
136100200529      *                                                                                     AR851784
136110200529     C                     CALL 'AOCUSTR0'                                                  AR851784
136120200529     C                     PARM *BLANKS   @RTCD                                             AR851784
136130200529     C                     PARM '*KEY   ' @OPTN                                             AR851784
136140200529     C                     PARM SPCPY     @KEY1                                             AR851784
136150200529     C                     PARM *BLANKS   @KYST                                             AR851784
136160200529     C           SDCUST    PARM SDCUST    DSSDY                                             AR851784
136170200529     C           @RTCD     IFEQ *BLANKS                                                     AR851784
136180200529     C                     CALL 'AOBRCHR2'                                                  AR851784
136190200529     C                     PARM *BLANKS   @RTCD                                             AR851784
136200200529     C                     PARM '*KEY   ' @OPTN                                             AR851784
136210200529     C                     PARM BBBRCD    @DSNB                                             AR851784
136220200529     C           SDBRCE    PARM SDBRCE    DSSDY                                             AR851784
136230200529     C           @RTCD     IFEQ *BLANKS                                                     AR851784
136240200529     C                     MOVELSPCPY     SPCPY6                                           AR851784A
136250200529     C           SPCPY6    CHAINSDCUSQL0             99                                    AR851784A
136260200529     C           *IN99     IFEQ '0'                                                        AR851784A
136270200529     C**********           MOVE BXTAX     WCTAX                                   AR851784 AR851784A
136280200529     C                     MOVE CQTAX     WCTAX                                            AR851784A
136290200529     C                     ENDIF                                                           AR851784A
136300200529     C                     ENDIF                                                            AR851784
136310200529     C                     ENDIF                                                            AR851784
136320200529      *                                                                                     AR851784
136330200529      ** Default Stamp Tax Liable                                                           AR851784
136340200529      *                                                                                     AR851784
136350200529     C           WSTAX     IFEQ 'Y'                                                         AR851784
136360200529     C           WCTAX     ANDEQ'Y'                                                         AR851784
136370200529     C           ACTN      ANDEQ'I'                                                         AR880129
136380200529     C                     MOVE 'Y'       SPTAXL                                            AR851784
136390200529     C                     ENDIF                                                            AR851784
136400200529     C                     ENDIF                                                            AR851784
136410200529      *                                                                                     AR851784
136420200529     C                     ELSE                                                               CER049
136430200529     C                     CALL 'SD008141'                                                    CER049
136440200529     C                     PARM BJRDNB    U#DATE  50                                          CER049
136450200529     C                     PARM 'SECURITY'U#ORGN 10                                           CER049
136460200529     C                     PARM           ##TYPE  4                                           CER049
136470200529     C                     PARM           U#CTAX 138                                          CER049
136480200529     C                     PARM           U#MTAX 138                                          CER049
136490200529     C                     PARM           U#CCCY  3                                           CER049
136500200529     C                     PARM           U#MCCY  3                                           CER049
136510200529     C                     PARM           U#CSCC  2                                           CER049
136520200529     C                     PARM           U#MSCC  2                                           CER049
136530200529     C                     PARM           U#TXTY  1                                           CER049
136540200529     C                     PARM           SDSTPD                                              CER049
136550200529      *                                                                                       CER049
136560200529      ** If there is a default for the Module use this tax rate and ccy                       CER049
136570200529      ** otherwise use the ICD Control defaults.                                              CER049
136580200529      *                                                                                       CER049
136590200529     C           U#MTAX    IFNE *ZEROS                                                        CER049
136600200529     C                     Z-ADDU#MTAX    U#TAXR 138                                          CER049
136610200529     C                     MOVE U#MCCY    U#SCCY  3                                           CER049
136620200529     C                     MOVE U#MSCC    SPCHCD                                              CER049
136630200529     C                     ELSE                                                               CER049
136640200529     C                     Z-ADDU#CTAX    U#TAXR                                              CER049
136650200529     C                     MOVE U#CCCY    U#SCCY                                              CER049
136660200529     C                     MOVE U#CSCC    SPCHCD                                              CER049
136670200529     C                     ENDIF                                                              CER049
136680200529      *                                                                                       CER049
136690200529     C                     MOVELPCHA      WTAXA  130                                          CER049
136700200529     C                     ADD  PCAM      WTAXA                                               CER049
136710200529     C                     MULT U#TAXR    WTAXA     H                                         CER049
136720200529     C                     ENDIF                                                              CER049
136730200529      *                                                                                       CER049
136740200529      ** Access stamp tax currency for decimal places                                         CER049
136750200529      *                                                                                       CER049
136760200529     C           WTAXA     IFNE *ZEROS                                                      AR880129
136770200529     C                     CALL 'AOCURRR0'                                                    CER049
136780200529     C                     PARM '*DBERR'  @RTCD                                               CER049
136790200529     C                     PARM '*KEY   ' @OPTN                                               CER049
136800200529     C                     PARM U#SCCY    @AJCD                                               CER049
136810200529     C           SDCURR    PARM SDCURR    DSSDY                                               CER049
136820200529      *                                                                                       CER049
136830200529     C                     Z-ADDA6NBDP    ZDECS                                               CER049
136840200529     C                     MOVE WTAXA     ZFLD15                                              CER049
136850200529     C                     MOVE ' '       ZECODE                                              CER049
136860200529     C                     EXSR ZSEDIT                                                        CER049
136870200529     C                     MOVEL*BLANKS   SPTAXA                                              CER049
136880200529     C                     MOVEL*BLANKS   SPCHAM                                              CER049
136890200529     C                     MOVE ZOUT21    SPTAXA                                              CER049
136900200529     C                     MOVE ZOUT21    SPCHAM                                              CER049
136910200529     C                     ENDIF                                                            AR880129
136920200529     C                     ENDSR                                                              CER049
136930200529      *****************************************************************                       CER049
136940200529      /EJECT                                                                                  CER049
136950200529      *****************************************************************                       CER049
136960200529      * Subroutine  :  SRSTMD                                         *                       CER049
136970200529      * Function    :  This subroutine will write/update records in   *                       CER049
136980200529      *                Stamp Tax Historic/Details (SDSTMDPD)          *                       CER049
136990200529      *****************************************************************                       CER049
137000200529      *                                                                                       CER049
137010200529     C           SRSTMD    BEGSR                                                              CER049
137020200529      *                                                                                       CER049
137030200529     C                     MOVE SPSEB     T2PBRC                                              CER049
137040200529     C                     MOVE SPSSH     T2PSSH                                              CER049
137050200529     C**********           MOVE SPCPY     T2PCPY                                    CER049 AR864714A
137060200529     C**********           MOVE SPDUD     T2PDUD                                    CER049 AR864714A
137070200529     C                     MOVELSPCPY     T2PCPY                                           AR864714A
137080200529     C                     MOVELSPDUD     ZDATE                                            AR864714A
137090200529     C                     EXSR ZDATE1                                                     AR864714A
137100200529     C                     Z-ADDZDAYNO    T2PDUD                                           AR864714A
137110200529     C                     MOVE SPEVT     T2PEVT                                              CER049
137120200529     C                     MOVEL'POSSET'  T2KEY                                               CER049
137130200529      *                                                                                       CER049
137140200529     C           KSTAMD    CHAINSDSTMDL0             85                                       CER049
137150200529      *                                                                                       CER049
137160200529      ** If record not found and taxable then write it                                        CER049
137170200529      *                                                                                       CER049
137180200529     C           *IN85     IFEQ *ON                                                           CER049
137190200529     C           SPTAXL    ANDEQ'Y'                                                           CER049
137200200529      *                                                                                       CER049
137210200529     C                     MOVE 'T'       T2RCTP                                              CER049
137220200529     C                     MOVE U#SCCY    T2SCCY                                              CER049
137230200529     C                     MOVE SPSCU     T2ECCY                                              CER049
137240200529     C                     MOVE 'Y'       T2TCAL                                              CER049
137250200529     C                     MOVE U#TAXR    T2TXRT                                              CER049
137260200529     C                     Z-ADDWTAXA     T2TATC                                              CER049
137270200529     C                     MOVE 'Y'       T2STFF                                              CER049
137280200529     C                     Z-ADDBJRDNB    T2LCD                                               CER049
137290200529     C                     MOVE 'I'       T2TYLC                                              CER049
137300200529     C           PCHA      ADD  PCAM      T2GROS                                           AR864714B
137310200529     C                     WRITE@STMDV0                                                       CER049
137320200529      *                                                                                       CER049
137330200529     C                     ENDIF                                                              CER049
137340200529      *                                                                                       CER049
137350200529      ** If record  found and taxable then update it                                          CER049
137360200529      *                                                                                       CER049
137370200529     C           *IN85     IFEQ *OFF                                                          CER049
137380200529     C           SPTAXL    ANDEQ'Y'                                                           CER049
137390200529      *                                                                                       CER049
137400200529     C                     MOVE 'P'       T2RCTP                                              CER049
137410200529     C                     MOVE U#SCCY    T2SCCY                                              CER049
137420200529     C                     MOVE SPSCU     T2ECCY                                              CER049
137430200529     C                     MOVE 'Y'       T2TCAL                                              CER049
137440200529     C                     MOVE U#TAXR    T2TXRT                                              CER049
137450200529     C                     Z-ADDWTAXA     T2TATC                                              CER049
137460200529     C                     MOVE 'Y'       T2STFF                                              CER049
137470200529     C                     MOVE 'A'       T2TYLC                                              CER049
137480200529     C           PCHA      ADD  PCAM      T2GROS                                           AR864714B
137490200529     C                     UPDAT@STMDV0                                                       CER049
137500200529     C                     ENDIF                                                              CER049
137510200529      *                                                                                       CER049
137520200529      ** If record found and non taxable then delete it                                       CER049
137530200529      *                                                                                       CER049
137540200529     C           *IN85     IFEQ *OFF                                                          CER049
137550200529     C           SPTAXL    ANDEQ'N'                                                           CER049
137560200529     C                     DELETSDSTMDL0                                                      CER049
137570200529     C                     ENDIF                                                              CER049
137580200529      *                                                                                       CER049
137590200529     C                     ENDSR                                                              CER049
137600200529      *****************************************************************                       CER049
137610200529      /EJECT
137620200529     C/COPY WNCPYSRC,SE0170C035
137630200529     C/COPY ZSRSRC,ZSDESCZ3                                               CSE016
137640200529      ***
137650200529      * /104633/ CHANGE
137660200529      *INF,7  DELETION F3:F10 to delete this record:F12:Rollup:Rolldown:Help
137670200529      *INF,10 F10 is required
137680200529      *INF,11 F10 is not required
137690200529      *INF,13 REVERSAL F3:F10 to revert:F12:Help
137700200529      *INF,14 F12 is not possible
137710200529**  CPY@
137720200529(c) Finastra International Limited 2001
137730200529** CRW                                                                                        CSD015
137740200529<Settlement account>                                                                          CSD015
137750200529</Settlement account>                                                                         CSD015
137760200529<Counterparty bank>                                                                           CSD015
137770200529</Counterparty bank>                                                                          CSD015
137780200529<For account of>                                                                              CSD015
137790200529</For account of>                                                                             CSD015
137800200529** INF REMOVED Rollup & Rolldown from Insert, Ammend, Delete , & Auth.    E20237
137810200529 Enter:Action Code I,A,D,E,R,Y and selection:Review from point:F3:Help
137820200529 Enter:Review from point:Action Code A,D,E,R,Y:F3:F12:Rollup:Rolldown:Help
137830200529 INSERTION Enter:F3:F12:Help
137840200529 AMENDMENT Enter:F3:F12:Help
137850200529 AUTHORISATION Enter:F3:F12:Help
137860200529 ENQUIRY Enter:F3:F12:Rollup:Rolldown:Help
137870200529 DELETION F3:F10=Delete record:F12:Help
137880200529 Rollup is not possible
137890200529 Rolldown is not possible
137900200529 F10=Confirm
137910200529
137920200529 Record has been updated by another workstation
137930200529 REVERSAL F3:F10=Revert:F12:Help
137940200529 F12=Not possible
137950200529 UNAUTHORISATION Enter:F3:F12:Help                                                          AR324886
137960200529 Enter:Action Code I,A,D,E,R,Y,U and selection:Review from point:F3:Help                    AR324886
137970200529 Enter:Review from point:Action Code A,D,E,R,Y,U:F3:F12:Rollup:Rolldown:Help                AR324886
137980200529**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
1379902005290366073110961461
138000200529**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
138010200529000031059090120151181212243273304334365
138020200529**   ZMNM - MONTHS SHORT NAMES
138030200529JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
138040200529**   UPA   -  Valid codeword characters                                   S01412
138050200529ABCDEFGHIJKLMNOPQRSTUVWXYZ/
138060200529**   APN   -  Valid uppercase alphabetic characters and numeric digits                        CSW201
138070200529ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789/                                                         CSW201
138080200529**   SWCH  -  Valid SWIFT ISO fromat characters                           S01412
138090200529ABCDEFGHIJKLMNOPQRSTUVWXYZ 1234567890/-?:().,'+
138100200529**  POWER - Array of powers for currency conversion                       055839
1381102005290000001
1381202005290000010
1381302005290000100
1381402005290001000
1381502005290010000
1381602005290100000
1381702005291000000
138180200529** AP - Array of powers of 10.                                            CAC002
1381902005290000000001                                                                CAC002
1382002005290000000010                                                                CAC002
1382102005290000000100                                                                CAC002
1382202005290000001000                                                                CAC002
1382302005290000010000                                                                CAC002
1382402005290000100000                                                                CAC002
1382502005290001000000                                                                CAC002
1382602005290010000000                                                                CAC002
1382702005290100000000                                                                CAC002
1382802005291000000000                                                                CAC002
