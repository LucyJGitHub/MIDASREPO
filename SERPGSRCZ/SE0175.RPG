     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Reverse/authorise position settlements')      *
      *****************************************************************
      *                                                               *
      *  Midas - Securities Trading Module                            *
      *                                                               *
      *  SE0175 - Reverse/Authorize Position Settlements.             *
      *                                                               *
      *  Function:  This program allows to enquire, authorize,        *
      *             reverse or delete Position Settlements in         *
      *             bulk.                                             *
      *  (Input Cycle)                                                *
      *                                                               *
      *  Called By: SEC0175- Midas SE Position Settlements Bulk       *
      *                      Maint Control                            *
      *                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. AR871626           Date 27Nov11               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      *  Prev Amend No. CSD079             Date 05Feb07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 BUG12729           Date 20Nov06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 235466             Date 09Sep05               *
      *                 CSE071             Date 19Jul05               *
      *                 229342             Date 23Oct03               *
      *                 218479             Date 03Jun03               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3122            Date 17Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 CRE020             Date 20Jan04               *
      *                 CAAA03             Date 24Mar04               *
      *                 CGP001             Date 18Dec03               *
      *                 CGL029             Date 01Sep03               *
      *                 222373             Date 23Oct03               *
      *                 CSD015             Date 14Oct02               *
      *                 215481             Date 27Mar03               *
      *                 208241             Date 21Aug02               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 197597             Date 06Sep01               *
      *                 CSE016             Date 10Jan01               *
      *                 CSE025  *CREATE    Date 11Jan01               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  AR871626  - Include stamp tax in position settlement bulk    *
      *              maintenance.                                     *
      *  CSD079 - Enhanced Customer Maintenance (Recompile)           *
      *  BUG12729 - Modified due to the changes in POSET6 keylist.    *
      *             Change in keylist triggered by error in mainte-   *
      *             screen (SE0170).                                  *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  235466 - RAPS not showing EU tax.  Included EU tax field in  *
      *           the display.                                        *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  229342 - ACCESS AOCUSTR1 INSTEAD OF AOCUSTR0                 *
      *  218479 - Not all records are authorised. Fix is to move value*
      *           of hidden field HDTXBS.                             *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3122 - Recompiled due to changes in SDSECSPD.             *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CRE020 - Midas Plus Online Printing of Advices (GE7)         *
      *  CAAA03 - Webfacing changes.  Re-compiled due to changed DSPF *
      *           SE0175DF.                                           *
      *  CGP001 - Global Processing (Recompile)                       *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222373 - Parameter Mismatch                                  *
      *  CSD015 - Midas Compliance Watch Enhancement                  *
      *  215481 - Tax amount not displayed. Fix is to add checking if *
      *           tax amounts should be shown.                        *
      *  208241 - Recompiled over changed /CPY ZSDESCZ3.              *
      *  197597 - Fix for undisplayed Tax Amount Deducted fields      *
      *  CSE016 - Extended Security Descriptions                      *
      *  CSE025 - Reverse/Authorize Position Settlement               *
      *                                                               *
      *****************************************************************
      *
      **  Midas SE Position Settlements Display File.
     FSE0175DFCF  E                    WORKSTN      KINFDS DSPDS
     F                                        SFLRCNKSFILE SE0175S0
     F                                              KINFSR *PSSR
      *
      **  Midas SE Securities.
     FSECTY   IF  E           K        DISK
     F                                              KINFSR *PSSR
      *
      **  Midas SE Position Settlements.
     FINVTP   IF  E           K        DISK
     F                                              KINFSR *PSSR
      *
      **  Midas SE Position Settlements - read only.
     FPOSETDY1IF  E           K        DISK         KCOMIT
     F                                              KINFSR *PSSR
      *
      **  Midas SE Security Withholding Tax Details file.
     FSESWHTL0IF  E           K        DISK                           UC
     F                                              KINFSR *PSSR
     FSDCWHTL1IF  E           K        DISK                                                   CSD015
     F                                              KINFSR *PSSR                              CSD015
     FSDSTPTPDIF  E                    DISK         KINFSR *PSSR                            AR871626
      *
      **  Midas SE Position Settlements - update.
     FPOSET6  UF  E           K        DISK         KCOMIT
     F            POSETDF                           KRENAMEPOSET6DF
     F                                              KINFSR *PSSR
      *
      **  Midas SE Position Settlements - Audit.
     FPOSETA  UF  E                    DISK         KCOMIT
     F                                              KINFSR *PSSR
      *
      ** Withholding tax customer details for retrieve.
     FSDWTCSL1IF  E           K        DISK         KINFSR *PSSR
      *
      ** Tax basket details file for retrieve.
     FSDTXBSL1IF  E           K        DISK         KINFSR *PSSR
      *
      ** Beneficial owners details file for retrieve.
     FSDBNFOL2IF  E           K        DISK         KINFSR *PSSR
      *
      ** Exemption codes details file for retrieve.
     FSDEXEML1IF  E           K        DISK         KINFSR *PSSR
      *
     FREADVCL3UF  E           K        DISK         KCOMIT       A                            CRE020
      **  Midas RE Settled Transaction Index File by Ref No/Pgm Ref                           CRE020
      *                                                                                       CRE020
     FPOSETDY3UF  E           K        DISK         KCOMIT       A                            CRE020
      **  Midas SE Position Settlement Extension file                                         CRE020
      *                                                                                       CRE020
      /EJECT
      *****************************************************************
      *                                                               *
      *          F U N C T I O N   O F   I N D I C A T O R S          *
      *                                                               *
      *  01  -  SFLDSPCTL                                             *
      *  02  -  SFLDSP                                                *
      *  03  -  condition use of ROLLUP key.                          *
      *  05  -  ROLLUP key.                                           *
      *  07  -  SFLNXTCHG.                                            *
      *  08  -  condition FRCDTA of SE0175C0.                         *
      *  09  -  condition FRCDTA of SE0175F3.                         *
      *                                                               *
      *  12  -  Selection for Branch and Security.                    *
      *  13  -  Selection for Branch, Security and Customer.          *
      *  14  -  Selection for Branch, Security, Customer and Due date *
      *  15  -  Selection for Branch, Security, Customer, Due date    *
      *         and Event type.                                       *
      *                                                               *
      *  20  -  Feature CSE023 is active.                             *
      *  21  -  Error Indicator for field SBRCA                       *
      *  22  -  Error Indicator for field SSESH                       *
      *  23  -  Error Indicator for field SCUST                       *
      *  24  -  Error Indicator for field SBKCD                       *
      *  25  -  Error Indicator for field SEVTP                       *
      *  26  -  Error Indicator for field SDUDT                       *
      *  27  -  Error Indicator for field CTSTAT                      *
      *  28  -  Error Indicator for field SFACTN                      *
      *  29  -  Error Indicator for field SNACTN                      *
      *                                                               *
      *  37  -  Error Indicator for field CTSTAT                      *
      *  38  -  Error Indicator for field SFACTN                      *
      *  41  -  Display other details for Position Settlement.        *
      *  42  -  Private Banking and Portfolio Management modules      *
      *         are active.                                           *
      *                                                               *
      *  51  -  Display F6 to confirm action.                         *
      *  57  -  Error Indicator for field STXBS                       *
      *  58  -  Error Indicator for field SBNFO                       *
      *  59  -  Error Indicator for field SEXCD                       *
      *  60  -  Action(s) to confirm.                                 *
      *  61  -  Feature S01512 is active.                             *
      *  62  -  Display field DEPMTR if feature S01496 is active.     *
      *  63  -  Profit Centers used.                                  *
      *  64  -  Feature S01509 is active.                             *
      *  65  -  Analytical accounting is installed.                   *
      *  66  -  Nominal and settlement ccys are equal and action 'E'. *
      *  67  -  Security is not taxable.                              *
      *  68  -  Multibranching indicator = 'Y'.                       *
      *  69  -  READVCL3 Search (CHAIN) Indicator                     *                       CRE020
      *  70  -  Either S01496, CSE007 or CEU017 is active.            *
      *  71  -  Action is Enquire (E).                                *
      *  77  -  Resulting indicator on LOKUP operation.               *
      *                                                               *
      *  81  -  READ, READE access to POSET6 (read only).             *
      *  82  -  CHAIN access to POSET1 (for update).                  *
      *  83  -  CHAIN and READC on subfile record.                    *
      *  84  -  Any access to other files.                            *
      *  85  -  SETLL access to POSET6.                               *
      *                                                               *
      *  98  -  Run date format indicator.                            *
      *  99  -  General error indicator.                              *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  S U B R O U T I N E   I N D E X                              *
      *                                                               *
      *  SRINIT - Subroutine to do Program Initialisation.            *
      *  SRPROC - Subroutine to do Main Processing.                   *
      *  SRQRYS - Subroutine to process query selections.             *
      *  SRVALK - Subroutine to validate initial screen input         *
      *  SRSETC - Subroutine to set up Subfile Control Record fields. *
      *  SRCLRS - Subroutine to clear subfile and position on         *
      *           first available Position Settlement.                *
      *  SRROLL - Fill one page of the subfile.                       *
      *  SRREAD - Read records and write to subfile.                  *
      *  SRVAL1 - Subroutine to do first validation (action input).   *
      *  SRCHKA - Subroutine to check action codes.                   *
      *  SRVAL2 - Subroutine to process Enquiry actions required.     *
      *  DETREC - Subroutine to process SE0175F2 display.             *
      *  SFMENQ - Subroutine to set up fields of SE0175F2 record.     *
      *  SRVAL3 - Subroutine to process Update actions required.      *
      *  SRUPDF - Subroutine to update Position settlements.          *
      *  SRCAMT - Calculate new Settlement Amount.                    *
      *  SRWDOW - Subroutine used to call window processing program   *
      *  *PSSR  - Program exception error routine                     *
      *  ZASNMS - Send message to program message queue.              *
      *  SRCLRM - Clear program message queue.                        *
      *                                                               *
      *****************************************************************
      /TITLE E Specifications.
      *****************************************************************
      *
      **  Array containing Copyright statement.
     E                    CPY@    1   1 80
      *
      **  Array which contains lines to be displayed with available
      **  function keys
     E                    CMD     1  10 78
      *
      **  Array which contains all action codes processed in this program.
     E                    ACTN    4   4  1
      *
      **  Array which contains all record status codes allowed for selection.
     E                    STAT    6   6  1
      *
      **  Array used to store valid action codes.
     E                    CODE        4  1
      *
      **  Array used to store action codes user is authorised to.
     E                    AUTH        4  1
      *
      **  Array used to store error message identifiers (on subfile display).
     E                    ERR        10  7
      *
      **  Array used to format fields resulting from multiple other fields.
     E                    FLD        56  1
      *
      **  Arrays used to convert day number to date format.
     E/COPY ZSRSRC,ZDATE2Z1
      *
      **  Arrays used to insert decimal point and sign into a numeric
      **  field and to blank out leading zeros.
     E/COPY ZSRSRC,ZSEDITZ1
     E/COPY ZSRSRC,ZSDESCZ1                                               CSE016
      *
      /SPACE 3
      *****************************************************************
      /TITLE I Specifications.
      *****************************************************************
      *
      **  Local data area for database error details
      **  *LOCK IN LDA immediately before and OUT LDA immediately
      **  after each database error handling.
      **
      **                                    134 141 DBFILE
      **       Defines:                     142 170 DBKEY
      **                                    171 180 DBPGM
      **                                    181 1830DBASE
     ILDA       E DSLDA                         256
      *
      **  Display format Status data structure.
      *                                                                                       CSD015
     IWWEXRC      DS                           9999                                           CSD015
      ** Work field for compliance watch parameter.                                           CSD015
      *                                                                                       CSD015
     IDSPDS       DS
     I                                      376 377 SFRCNO
      *
      **  Program Status Data Structure.
     IPSDS       SDS
     I                                     *PROGRAM ##PGM
     I                                      244 253 SWSID
     I                                      254 263 SUSER
      *
      **  Data Area giving Installation Control Details.
     IRUNDAT    E DSRUNDAT
      *
      **  Data Area of menu user.
     IZMUSER      DS                             17
     I                                       11  13 WUDBRN
      *
      **  First DS for access programs, short data structure
     IDSFDY     E DSDSFDY
      *
      **  First DS for access programs, long data structure
     IDSSDY     E DSDSSDY
     I*                                                                   229342
     IDSLDY     E DSDSLDY                                                 229342
     I*  THIRD DS FOR ACCESS PROGRAMS, VERY LONG DATA STRUCTURE           229342
      *
      **  Branch Details.
     ISDBRCH    E DSSDBRCHPD
      *
      **  Customer Details.
     ISDCUST    E DSSDCUSTPD
     I              QQDFAC                          DFACQQ                                    CGL029
      *
      **  Security Details.
     ISDSECS    E DSSDSECSPD
      *
      **  Book Details.
     ISDBOOK    E DSSDBOOKPD
      *
      **  Portfolio Customer Details.
     ISDPLCS    E DSSDPLCSPD
      *
      **  General Ledger Details.
     ISDGELR    E DSSDGELRPD
     I              QQACCD                          ACCDQQ                                    CGL029
      *
      **  Currency Details.
     ISDCURR    E DSSDCURRPD
      *
      **  Module Details.
     ISDMMOD    E DSSDMMODPD
      *
      **  Profit Center Accounting I.C.D. Details.
     ISDPCAC    E DSSDPCACPD
      *
      **  Portfolio Management I.C.D. Details.
     ISDPORT    E DSSDPORTPD
      *
      **  Data structure for Position Settlement file record.
     IPOSREC    E DSPOSETD
     ISESDS     E DS
      ** SE Linked Enquiry Data Area
      *
      **  Data structure for the parameters passed to SEZ010.
     ISDSTRD    E DSSDSTRDPD                                              CSE016
      ** Securities Trading Details                                       CSE016
      *                                                                   CSE016
     ISDWLCC    E DSSDWLCCPD                                                                  CSD015
      ** Watch list checking details                                                          CSD015
      *                                                                                       CSD015
     ISDSTAT    E DSSDSTAT                                                                    CSD015
      ** SD data area                                                                         CSD015
      *                                                                                       CSD015
     ISC24X7    E DSSC24X7                                                                    CSD015
      **  24X7 status data area                                                               CSD015
      *                                                                                       CSD015
     ISCSARD    E DSSCSARDPD                                                                  CSD015
     I              LCD                             LCD3                                      CSD015
      *                                                                                       CSD015
     IPDS1      E DSSDWLTOPD                                                                  CSD015
      ** Compliance watch engine program 1st data parameter                                   CSD015
      *                                                                                       CSD015
     I***P@DAT1*     DS                            128                                      AR871626
     IP@DAT1      DS                            141                                         AR871626
     I                                        1   1 P@CLAS
     I                                        2   2 P@PPRE
     I                                        3  150P@PAMD
     I                                       16  280P@PCHA
     I                                       29  410P@PCAM
     I                                       42  540P@TASO
     I                                       55  670P@TAUS
     I                                       68  808P@PSXR
     I                                       81  81 P@PMDI
     I                                       82  84 P@PNCY
     I                                       85  87 P@PSCU
     I                                       88 1000P@PSAT
     I                                      101 1138P@FXMR
     I                                      114 1260P@MAMT
     I                                      127 128 P@TDTP
     I                                      129 141 P@STAM                                  AR871626
      *
      **  External data structure defined for passing data from this
      **  program to SE1817.
     IP@DAT2    E DSSE17DT
      *
      **  Data structure used to attribute a sequence number
      **  to the Position settlement.
     IWUPOSK      DS
     I                                        1   3 SFPBCA
     I                                        4  13 SFPSSH
     I**********                             14  190SFPCPY                                    CSD027
     I                                       14  19 SFPCPY                                    CSD027
     I                                       20  25 SFPDUD
     I                                       26  27 SFPEVT
     I                                       28  31 SFPTFR
      *
      **  Data structure for set up of commit text.
     ICMTTXT      DS
     I                                        1   50NATN
     I                                        6   7 WUMODI
     I                                        8  15 WUPGMN
     I                                       16  18 WUWSID
     I                                       19  240WUTIME
     I                                       25  25 SFACTN
     I                                       26  35 WUUSER
     I                                       36 271 WUPOSR
      *                                                                                       CRE020
     I            DS                                                                          CRE020
     I                                        1  26 WREFNO                                    CRE020
     I                                        1  10 WSSH                                      CRE020
     I                                       11  16 WCPY                                      CRE020
     I                                       17  19 WBCA                                      CRE020
     I                                       20  24 WDUD                                      CRE020
     I                                       25  26 WEVT                                      CRE020
      ** Reference Number Data Structure                                                      CRE020
      *                                                                                       CRE020
     I              'PositionSettlement'  C         WPSET                                     CRE020
      *
      **  Data structure used in subroutine ZSEDIT.
     I/COPY ZSRSRC,ZSEDITZ2
      *
      **  Data structure used in subroutine ZTNLU1.
     I/COPY ZSRSRC,ZTNLU1Z1
      *
      **  Data structure defined from AO Proj. A/C MVTS template file - before.
     IZ#BSTS    E DSZ#BST
      *
      **  Data structure defined from AO Proj. A/C MVTS template file - after.
     IZ#ASTS    E DSZ#AST
      *
      **  Data structure to be passed to WN0010 as parameter.
      /COPY QWINDSRC,SE0175GDTA
     I/COPY ZSRSRC,ZSDESCZ2                                               CSE016
      *
      /SPACE 3
      *****************************************************************
      /TITLE C Specifications - Main processing.
      *****************************************************************
      *================================================================
      *                   P R O G R A M   S T A R T                   *
      *================================================================
      *
      **  Perform Initialisation.
     C                     EXSR SRINIT
      *
      *
      *================================================================
      *  P R O G R A M   E N D                                        *
      *================================================================
      *
      **  End Program and Return.
     C                     SETON                     LR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  INIT   - Subroutine to do Program Initialisation.            *
      *                                                               *
      *  Called By: Main Processing                                   *
      *                                                               *
      *  Calls: - *PSSR                                               *
      *                                                               *
      *****************************************************************
      *
     C           SRINIT    BEGSR                           ***  SRINIT ***
      *
      **  Set up copyright parameter
     C                     MOVEACPY@      CPY2@  80
      *                                                                                     AR871626
      ** Check if CER049 - Stamp Tax is switch on                                           AR871626
      *                                                                                     AR871626
     C                     CALL 'AOSARDR0'                                                  AR871626
     C                     PARM *BLANKS   P@RTCD                                            AR871626
     C                     PARM '*VERIFY' P@OPTN                                            AR871626
     C                     PARM 'CER049'  P@SARD                                            AR871626
      *                                                                                     AR871626
     C           P@RTCD    IFEQ *BLANK                                                      AR871626
     C                     MOVE 'Y'       CER049  1                                         AR871626
     C                     ELSE                                                             AR871626
     C                     MOVE 'N'       CER049                                            AR871626
     C                     ENDIF                                                            AR871626
      *
      **  Check if feature CSE025 (Rev./Aut. Position Settlements) is active.
     C                     MOVE 'N'       CSE025  1
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   P@RTCD  7
     C                     PARM '*VERIFY' P@OPTN  7
     C                     PARM 'CSE025'  P@SARD  6
      *
     C           P@RTCD    IFNE *BLANK
     C           P@RTCD    ANDNE'*NRF   '
     C                     MOVEL'SCSARDPD'DBFILE
     C                     Z-ADD24        DBASE
     C                     MOVEL'CSE025'  DBKEY
     C                     EXSR *PSSR
     C                     ELSE
      *
     C           P@RTCD    IFEQ *BLANK
     C                     MOVE 'Y'       CSE025
     C                     ENDIF
      *
     C                     ENDIF
      *                                                                                       CSD015
     C           *NAMVAR   DEFN           SDSTAT                                              CSD015
     C                     IN   SDSTAT                                                        CSD015
      *                                                                                       CSD015
      ** Check 24 x 7 enhancement is installed.                                               CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM '       ' P@RTCD                                              CSD015
     C                     PARM '*VERIFY' P@OPTN                                              CSD015
     C                     PARM 'CSC011'  P@SARD                                              CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           P@RTCD    IFNE *BLANK                                                        CSD015
     C           P@RTCD    ANDNE'*NRF   '                                                     CSD015
     C                     MOVEL'SCSARDPD'DBFILE           ***************                    CSD015
     C                     MOVEL'CSC011'  DBKEY            * DB ERROR 41 *                    CSD015
     C                     Z-ADD41        DBASE            ***************                    CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       CSC011                                              CSD015
     C           P@RTCD    IFEQ *BLANK                                                        CSD015
     C                     MOVE 'Y'       CSC011  1                                           CSD015
     C           *NAMVAR   DEFN           SC24X7                                              CSD015
     C                     IN   SC24X7                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Check if compliance watch enhancement is switched on.                                CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM '       ' P@RTCD                                              CSD015
     C                     PARM '*VERIFY' P@OPTN                                              CSD015
     C                     PARM 'CSD015'  P@SARD                                              CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           P@RTCD    IFNE *BLANK                                                        CSD015
     C           P@RTCD    ANDNE'*NRF   '                                                     CSD015
     C                     MOVEL'SCSARDPD'DBFILE           ***************                    CSD015
     C                     MOVEL'CSD015'  DBKEY            * DB ERROR 42 *                    CSD015
     C                     Z-ADD42        DBASE            ***************                    CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       CSD015                                              CSD015
      *                                                                                       CSD015
     C           P@RTCD    IFEQ *BLANK                                                        CSD015
      *                                                                                       CSD015
     C                     MOVE 'Y'       CSD015  1                                           CSD015
      *                                                                                       CSD015
      ** Check if function code is being monitored by compliance watch.                       CSD015
      *                                                                                       CSD015
     C                     CALL 'AOWLCCR0'                                                    CSD015
     C                     PARM *BLANKS   P@RTCD                                              CSD015
     C                     PARM '*KEY   ' P@OPTN                                              CSD015
     C                     PARM 'SECTTRAD'PFUNC   8                                           CSD015
     C           SDWLCC    PARM SDWLCC    DSFDY                                               CSD015
      *                                                                                       CSD015
      ** If return code not blank, then issue database error.                                 CSD015
      *                                                                                       CSD015
     C           P@RTCD    IFNE *BLANKS                                                       CSD015
     C           P@RTCD    ANDNE'*NRF   '                                                     CSD015
     C                     MOVE 'SECTTRAD'DBKEY                                               CSD015
     C                     MOVE 'SDWLCCPD'DBFILE                                ************  CSD015
     C                     MOVE 43        DBASE                                 *DBERR 43  *  CSD015
     C                     EXSR *PSSR                                           ************  CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *
      **  Retrieve default Branch code or user profile.
     C           *NAMVAR   DEFN           ZMUSER
     C                     IN   ZMUSER
      *
      **  Retrieve run date.
     C           *NAMVAR   DEFN           RUNDAT
     C                     IN   RUNDAT
      *
      **  Check System Date Format, DDMMYY or MMDDYY.
     C           AGDFF     IFEQ 'M'
     C                     MOVE *ON       *IN98
     C                     ENDIF
      *
      **  Set up run date on display file records.
     C                     MOVE AGMRDT    SRUNA
      *
      **  Set Multibranching Indicator for program.
     C                     MOVE *OFF      *IN68
     C           AGMBIN    IFEQ 'Y'
     C                     MOVE *ON       *IN68
     C                     ENDIF
      *
      **  Local Data Area.
     C           *NAMVAR   DEFN           LDA
      *
      **  Check if feature CSE010 (Transaction Enhancements) is active.
     C                     MOVE 'N'       CSE010
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   P@RTCD  7
     C                     PARM '*VERIFY' P@OPTN  7
     C                     PARM 'CSE010'  P@SARD  6
      *
     C           P@RTCD    IFNE *BLANK
     C           P@RTCD    ANDNE'*NRF   '
     C                     MOVEL'SCSARDPD'DBFILE
     C                     Z-ADD14        DBASE
     C                     MOVEL'CSE010'  DBKEY
     C                     EXSR *PSSR
     C                     ELSE
      *
     C           P@RTCD    IFEQ *BLANK
     C                     MOVE 'Y'       CSE010  1
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  Check if feature CSE003 (Transaction Enhancements) is active.
     C                     MOVE 'N'       CSE003
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   P@RTCD  7
     C                     PARM '*VERIFY' P@OPTN  7
     C                     PARM 'CSE003'  P@SARD  6
      *
     C           P@RTCD    IFNE *BLANK
     C           P@RTCD    ANDNE'*NRF   '
     C                     MOVEL'SCSARDPD'DBFILE
     C                     Z-ADD15        DBASE
     C                     MOVEL'CSE003'  DBKEY
     C                     EXSR *PSSR
     C                     ELSE
      *
     C           P@RTCD    IFEQ *BLANK
     C                     MOVE 'Y'       CSE003  1
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  Check if feature CSE007 (Corporate Action) is active.
     C                     MOVE 'N'       CSE007
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   P@RTCD  7
     C                     PARM '*VERIFY' P@OPTN  7
     C                     PARM 'CSE007'  P@SARD  6
      *
     C           P@RTCD    IFNE *BLANK
     C           P@RTCD    ANDNE'*NRF   '
     C                     MOVEL'SCSARDPD'DBFILE
     C                     Z-ADD16        DBASE
     C                     MOVEL'CSE007'  DBKEY
     C                     EXSR *PSSR
     C                     ELSE
      *
     C           P@RTCD    IFEQ *BLANK
     C                     MOVE 'Y'       CSE007  1
     C                     MOVE *ON       *IN70
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  Check if feature CEU017 (Securities Redomination) is active.
     C                     MOVE 'N'       CEU017
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   P@RTCD  7
     C                     PARM '*VERIFY' P@OPTN  7
     C                     PARM 'CEU017'  P@SARD  6
      *
     C           P@RTCD    IFNE *BLANK
     C           P@RTCD    ANDNE'*NRF   '
     C                     MOVEL'SCSARDPD'DBFILE
     C                     Z-ADD17        DBASE
     C                     MOVEL'CEU017'  DBKEY
     C                     EXSR *PSSR
     C                     ELSE
      *
     C           P@RTCD    IFEQ *BLANK
     C                     MOVE 'Y'       CEU017  1
     C                     MOVE *ON       *IN70
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  Check if feature S01509 is active.
     C                     MOVE 'N'       S01509  1
     C                     MOVE *OFF      *IN64
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   P@RTCD
     C                     PARM '*VERIFY' P@OPTN
     C                     PARM 'S01509'  P@SARD
      *
     C           P@RTCD    IFNE *BLANK
     C           P@RTCD    ANDNE'*NRF   '
     C                     MOVEL'SCSARDPD'DBFILE
     C                     Z-ADD18        DBASE
     C                     MOVEL'S01509'  DBKEY
     C                     EXSR *PSSR
     C                     ELSE
      *
     C           P@RTCD    IFEQ *BLANK
     C                     MOVE 'Y'       S01509
     C                     MOVE *ON       *IN64
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  Check if feature S01512 is active.
     C                     MOVE 'N'       S01512  1
     C                     MOVE *OFF      *IN61
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   P@RTCD
     C                     PARM '*VERIFY' P@OPTN
     C                     PARM 'S01512'  P@SARD
      *
     C           P@RTCD    IFNE *BLANK
     C           P@RTCD    ANDNE'*NRF   '
     C                     MOVEL'SCSARDPD'DBFILE
     C                     Z-ADD19        DBASE
     C                     MOVEL'S01512'  DBKEY
     C                     EXSR *PSSR
     C                     ELSE
      *
     C           P@RTCD    IFEQ *BLANK
     C                     MOVE 'Y'       S01512
     C                     MOVE *ON       *IN61
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  Check if feature S01496 is active.
     C                     MOVE 'N'       S01496  1
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   P@RTCD
     C                     PARM '*VERIFY' P@OPTN
     C                     PARM 'S01496'  P@SARD
      *
     C           P@RTCD    IFNE *BLANK
     C           P@RTCD    ANDNE'*NRF   '
     C                     MOVEL'SCSARDPD'DBFILE
     C                     Z-ADD20        DBASE
     C                     MOVEL'S01496'  DBKEY
     C                     EXSR *PSSR
     C                     ELSE
      *
     C           P@RTCD    IFEQ *BLANK
     C                     MOVE 'Y'       S01496
     C                     MOVE *ON       *IN70
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  Check if feature S01447 is active.
     C                     MOVE 'N'       S01447  1
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   P@RTCD
     C                     PARM '*VERIFY' P@OPTN
     C                     PARM 'S01447'  P@SARD
      *
     C           P@RTCD    IFNE *BLANK
     C           P@RTCD    ANDNE'*NRF   '
     C                     MOVEL'SCSARDPD'DBFILE
     C                     Z-ADD21        DBASE
     C                     MOVEL'S01447'  DBKEY
     C                     EXSR *PSSR
     C                     ELSE
      *
     C           P@RTCD    IFEQ *BLANK
     C                     MOVE 'Y'       S01447
     C                     OPEN SESWHTL0
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  Check if feature S01401 is active.
     C                     MOVE 'N'       S01401  1
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   P@RTCD
     C                     PARM '*VERIFY' P@OPTN
     C                     PARM 'S01401'  P@SARD
      *
     C           P@RTCD    IFNE *BLANK
     C           P@RTCD    ANDNE'*NRF   '
     C                     MOVEL'SCSARDPD'DBFILE
     C                     Z-ADD22        DBASE
     C                     MOVEL'S01401'  DBKEY
     C                     EXSR *PSSR
     C                     ELSE
      *
     C           P@RTCD    IFEQ *BLANK
     C                     MOVE 'Y'       S01401
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  Check if feature CSE023 is active.
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   P@RTCD
     C                     PARM '*VERIFY' P@OPTN
     C                     PARM 'CSE023'  P@SARD
      *
     C           P@RTCD    IFNE *BLANK
     C           P@RTCD    ANDNE'*NRF   '
     C                     MOVEL'SCSARDPD'DBFILE
     C                     Z-ADD23        DBASE
     C                     MOVEL'CSE023'  DBKEY
     C                     EXSR *PSSR
     C                     ELSE
      *
     C           P@RTCD    IFEQ *BLANK
     C                     MOVE 'Y'       CSE023  1
     C                     MOVE *ON       *IN20
     C                     ELSE
     C                     MOVE 'N'       CSE023
     C                     MOVE *OFF      *IN20
     C                     ENDIF
      *
     C                     ENDIF
      *                                                                                       235466
      ** Check if CGL031 (Taxation of savings income) is enabled                              235466
      *                                                                                       235466
     C                     CALL 'AOSARDR0'                                                    235466
     C                     PARM *BLANKS   P@RTCD                                              235466
     C                     PARM '*VERIFY' P@OPTN                                              235466
     C                     PARM 'CGL031'  P@SARD                                              235466
      *                                                                                       235466
     C           P@RTCD    IFNE *BLANK                                                        235466
     C           P@RTCD    ANDNE'*NRF   '                                                     235466
     C                     MOVEL'SCSARDPD'DBFILE                                              235466
     C                     Z-ADD30        DBASE                                               235466
     C                     MOVEL'CGL031'  DBKEY                                               235466
     C                     EXSR *PSSR                                                         235466
     C                     ELSE                                                               235466
      *                                                                                       235466
     C           P@RTCD    IFEQ *BLANK                                                        235466
     C                     MOVE 'Y'       CGL031  1                                           235466
     C                     ENDIF                                                              235466
     C                     ENDIF                                                              235466
      *                                                                                       235466
      *                                                                   CSE016
      ** Access Securities Trading details                                CSE016
      *                                                                   CSE016
     C                     CALL 'AOSTRDR0'                                CSE016
     C                     PARM '*DBERR ' P@RTCD                          CSE016
     C                     PARM '*FIRST ' P@OPTN                          CSE016
     C           SDSTRD    PARM SDSTRD    DSSDY                           CSE016
      *                                                                   CSE016
     C           P@RTCD    IFNE *BLANKS                                   CSE016
     C           *LOCK     IN   LDA                                       CSE016
     C                     MOVEL'SDSTRDPD'DBFILE                          CSE016
     C                     Z-ADD13        DBASE                           CSE016
     C                     OUT  LDA                                       CSE016
     C                     EXSR *PSSR                                     CSE016
     C                     ENDIF                                          CSE016
      *                                                                                       CSD015
      ** Check if CRE020 is enabled.                                                          CRE020
      *                                                                                       CRE020
     C                     CALL 'AOSARDR0'                                                    CRE020
     C                     PARM *BLANKS   PRTCD   7                                           CRE020
     C                     PARM '*VERIFY' POPTN   7                                           CRE020
     C                     PARM 'CRE020'  PSARD   6                                           CRE020
     C           SCSARD    PARM SCSARD    DSFDY                                               CRE020
      *                                                                                       CRE020
     C                     MOVE 'N'       CRE020  1                                           CRE020
     C           PRTCD     IFEQ *BLANKS                                                       CRE020
     C                     MOVE 'Y'       CRE020                                              CRE020
     C                     MOVEL'SE0170'  KPRGMN                                              CRE020
     C                     ELSE                                                               CRE020
     C           PRTCD     IFNE '*NRF   '                                                     CRE020
     C           *LOCK     IN   LDA                                                           CRE020
     C                     MOVEL'SCSARDPD'DBFILE                                              CRE020
     C                     MOVEL'CRE020'  DBKEY                                               CRE020
     C                     Z-ADD46        DBASE                                               CRE020
     C                     OUT  LDA                                                           CRE020
     C                     EXSR *PSSR                                                         CRE020
     C                     ENDIF                                                              CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
      ** Check if a System Value exists for this maintenance.                                 CRE020
      *                                                                                       CRE020
     C           CRE020    IFEQ 'Y'                                                           CRE020
      *                                                                                       CRE020
     C                     CALL 'AOSVALR0'                                                    CRE020
     C                     PARM *BLANKS   PRTCD                                               CRE020
     C                     PARM WPSET     PSV01  20                                           CRE020
     C                     PARM           PCS01 200                                           CRE020
     C                     PARM           PSV02  20                                           CRE020
     C                     PARM           PCS02 200                                           CRE020
     C                     PARM           PSV03  20                                           CRE020
     C                     PARM           PCS03 200                                           CRE020
     C                     PARM           PSV04  20                                           CRE020
     C                     PARM           PCS04 200                                           CRE020
     C                     PARM           PSV05  20                                           CRE020
     C                     PARM           PCS05 200                                           CRE020
     C                     PARM           PSV06  20                                           CRE020
     C                     PARM           PCS06 200                                           CRE020
     C                     PARM           PSV07  20                                           CRE020
     C                     PARM           PCS07 200                                           CRE020
     C                     PARM           PSV08  20                                           CRE020
     C                     PARM           PCS08 200                                           CRE020
     C                     PARM           PSV09  20                                           CRE020
     C                     PARM           PCS09 200                                           CRE020
     C                     PARM           PSV10  20                                           CRE020
     C                     PARM           PCS10 200                                           CRE020
      *                                                                                       CRE020
     C                     MOVE 'N'       WSV01   1                                           CRE020
      *                                                                                       CRE020
     C           PRTCD     IFEQ *BLANKS                                                       CRE020
     C                     MOVELPCS01     WSV01                                               CRE020
     C                     ELSE                                                               CRE020
      *                                                                                       CRE020
     C           PRTCD     IFNE '*NRF'                                                        CRE020
     C           *LOCK     IN   LDA                                                           CRE020
     C                     MOVEL'SDSVALPD'DBFILE                                              CRE020
     C                     MOVELPSV01     DBKEY                                               CRE020
     C                     Z-ADD102       DBASE                                               CRE020
     C                     OUT  LDA                                                           CRE020
     C                     EXSR *PSSR                                                         CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
      ** Midas RE Settled Transaction Index File Key List                                     CRE020
      *                                                                                       CRE020
     C           KADVC     KLIST                                                              CRE020
     C                     KFLD           KREFNO 30                                           CRE020
     C                     KFLD           KPRGMN 10                                           CRE020
     C                     KFLD           KNARR  29                                           CRE020
      *                                                                                       CRE020
      ** Midas SE Position Settlement Extension file                                          CRE020
      *                                                                                       CRE020
     C           KPOST3    KLIST                                                              CRE020
     C                     KFLD           K3PBCA  3                                           CRE020
     C                     KFLD           K3PSSH 10                                           CRE020
     C**********           KFLD           K3PCPY  60                                   CRE020 CSD027
     C                     KFLD           K3PCPY  6                                           CSD027
     C                     KFLD           K3PDUD  50                                          CRE020
     C                     KFLD           K3PEVT  2                                           CRE020
     C                     KFLD           K3TNLU  50                                          CRE020
      *                                                                                       CRE020
     C           CMPKEY    KLIST                                                              CSD015
     C                     KFLD           W4FUNT                                              CSD015
     C                     KFLD           W4IDEN                                              CSD015
     C                     KFLD           W4BRCH                                              CSD015
      *
      ** Key list for withholding tax customer details file.
     C           WTAKEY    KLIST
     C                     KFLD           KYCSNO  6
     C                     KFLD           KYCRTT  2
      *
      ** Key list for tax basket details file.
     C           WTBKEY    KLIST
     C                     KFLD           KYCRTT
     C                     KFLD           KSTXBS  2
      *
      ** Key list for beneficial owners file.
     C           WBOKEY    KLIST
     C                     KFLD           KYCSNO
     C                     KFLD           KYCRTT
     C                     KFLD           KYBNFO 26
      *
      ** Key list for exemption codes file.
     C           WTEKEY    KLIST
     C                     KFLD           KYCRTT
     C                     KFLD           KSEXCD  2
      *
      **  Access General Ledger details.
     C                     MOVE *OFF      *IN63
     C**********           CALL 'AOGELRR0'                                                    CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR ' P@RTCD
     C                     PARM '*FIRST ' P@OPTN
     C********** SDGELR    PARM SDGELR    DSFDY                                               CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
      *
     C           P@RTCD    IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'AOGELRR0'DBFILE           ***************
     C                     MOVEL*BLANKS   DBKEY            * DB ERROR 25 *
     C                     Z-ADD25        DBASE            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      *
      **  If Profit Center used.
     C           BKPRCU    IFEQ 'Y'
     C                     MOVE *ON       *IN63
     C                     ENDIF
      *
      **  Access Midas Module Details.
     C                     CALL 'AOMMODR0'
     C                     PARM '*DBERR ' P@RTCD
     C                     PARM '*FIRST ' P@OPTN
     C           SDMMOD    PARM SDMMOD    DSFDY
      *
     C           P@RTCD    IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'AOCURRR0'DBFILE           ***************
     C                     MOVELSFPNCY    DBKEY            * DB ERROR 01 *
     C                     Z-ADD1         DBASE            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      **  If Portfolio Management is installed, access SDPORTPD for
      **  Portfolio reference for '9997'.
     C           BGPFMG    IFEQ 'Y'
     C                     CALL 'AOPORTR0'
     C                     PARM '*DBERR ' P@RTCD
     C                     PARM '*FIRST ' P@OPTN
     C           SDPORT    PARM SDPORT    DSFDY
      *
     C           P@RTCD    IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'AOPORTR0'DBFILE           ***************
     C                     MOVEL'*FIRST'  DBKEY            * DB ERROR 02 *
     C                     Z-ADD2         DBASE            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  If Analytical Accounting Module is installed, access
      **  the Profit Center Accounting I.C.D. Details File.
     C                     MOVE *OFF      *IN65
     C           BGN0ST    IFEQ 'Y'
     C                     MOVE *ON       *IN65
     C                     CALL 'AOPCACR0'
     C                     PARM '*DBERR ' P@RTCD
     C                     PARM '*FIRST ' P@OPTN
     C           SDPCAC    PARM SDPCAC    DSFDY
      *
     C           P@RTCD    IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'AOCURRR0'DBFILE           ***************
     C                     MOVELSFPNCY    DBKEY            * DB ERROR 03 *
     C                     Z-ADD3         DBASE            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  Initialize work fields used to set up comit text.
     C                     MOVEL'SE'      WUMODI           Module Id.
     C                     MOVEL##PGM     WUPGMN           Program name
     C                     MOVELSWSID     WUWSID           Work station Id.
     C                     MOVELSUSER     WUUSER           User Id.
      *
      **  Load array which has to contain all action codes processed
      **  by this program and
     C                     MOVEA'EYD'     ACTN
     C           *IN70     IFEQ *ON
     C                     MOVEA'ERYD'    ACTN
     C                     ENDIF
      *
      **  Initialize Message file name.
     C                     MOVEL'SEUSRMSG'ZAMSGF
      *
      **  Set up valid action codes array.
     C                     Z-ADD0         A       10
     C                     Z-ADD0         C       10
     C                     MOVE *BLANKS   CODE
     C                     DO   4
     C                     ADD  1         A
      *
      **  If action code 'R' and feature S01496, CSE017 and CEU007 are not active
      **  do not process action
     C           ACTN,A    IFNE 'R'
     C           ACTN,A    OREQ 'R'
     C           *IN70     ANDEQ*ON
      *
     C                     ADD  1         C
     C                     MOVELACTN,A    CODE,C
      *
     C                     ENDIF
      *
     C                     ENDDO
      *
      **  Initialize work field used to process exit of program required
      **  from Position Settlement Enquiry screen or from program SE1817.
     C                     MOVE 'N'       WUEXIT  1
      *
     C                     EXSR SRPROC
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/PROCES
      *****************************************************************
      *                                                               *
      *  PROCES - Subroutine to do Main Processing.                   *
      *                                                               *
      *  Called By: Main Processing                                   *
      *                                                               *
      *  Calls: - SRCLR                                               *
      *         - SRQRYS                                              *
      *         - SRVALK                                              *
      *         - SRSETC                                              *
      *         - SRCLRS                                              *
      *         - SRROLL                                              *
      *         - ZASNMS                                              *
      *         - SRVAL1                                              *
      *         - SRVAL2                                              *
      *         - SRVAL3                                              *
      *                                                               *
      *****************************************************************
      *
     C           SRPROC    BEGSR                           *** SRPROC ***
      *
      *---------------------------------------------------------------*
      **               K E Y   I N P U T   S C R E E N               **
      **                 I N I T I A L I Z A T I O N                 **
      *---------------------------------------------------------------*
      *
      **  Clear screen.
     C                     WRITEASSUMEF
      *
      **  Initialize first display record fields.
     C                     MOVE *BLANKS   SBRCA
     C                     MOVE *BLANKS   SSESH
     C                     MOVE *BLANKS   SCUST
     C                     MOVE *BLANKS   SBKCD
     C                     MOVE *BLANKS   SEVTP
     C                     MOVE *BLANKS   SDUDT
     C                     MOVE *BLANKS   STXBS
     C                     MOVE *BLANKS   SBNFO
     C                     MOVE *BLANKS   SEXCD
     C                     MOVE *OFF      *IN62
     C                     MOVE *OFF      *IN81
      *
     C                     EXSR SRSHOW
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/SRSHOW
      *****************************************************************
      *                                                               *
      *  SRSHOW - Subroutine to display initial screen.               *
      *                                                               *
      *  Called By: Main Processing                                   *
      *                                                               *
      *  Calls: - SRCLRM                                              *
      *         - SRQRYS                                              *
      *         - SRVALK                                              *
      *         - SRSETC                                              *
      *         - SRCLRS                                              *
      *         - SRROLL                                              *
      *         - ZASNMS                                              *
      *         - SRVAL1                                              *
      *         - SRVAL2                                              *
      *         - SRVAL3                                              *
      *         - SRSUBF                                              *
      *         - SRSCRN                                              *
      *                                                               *
      *****************************************************************
      *
     C           SRSHOW    BEGSR                           *** SRSHOW ***
      *
      **  Display initial screen.
      *
     C           CSE010    IFEQ 'Y'
     C           CSE003    OREQ 'Y'
     C                     MOVELCMD,2     CMDLN2
     C                     ELSE
     C                     MOVELCMD,1     CMDLN2
     C                     ENDIF
      *
     C                     MOVE *BLANKS   CMDLN1
     C                     WRITESE0175F0
     C                     WRITE#MSGCTL
     C                     EXFMTSE0175F1
     C                     EXSR SRCLRM
      *
      **  If key <CA03> pressed, go to end subroutine.
     C           *INKC     IFEQ *ON
     C                     RETRN
     C                     ENDIF
      *
      **  If key <ENTER> pressed, check for query selction.
     C                     EXSR SRQRYS
      *
      **  If key <ENTER> pressed, check selection fields.
     C                     EXSR SRVALK
      *
      **  If any error detected, return to KYINPUT record with error messages.
     C           *IN99     IFEQ *ON
     C                     EXSR SRSCRN
     C                     ENDIF
      *
      **  Set up Subfile Control Record fields.
     C                     EXSR SRSETC
      *
      **  Clear Subfile and position on first available Position Settlement.
     C                     EXSR SRCLRS
      *
      **  Fill subfile page.
     C           *IN85     IFEQ *ON
     C                     EXSR SRROLL
     C                     ENDIF
      *
     C                     EXSR SRSUBF
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/SRSUBF
      *****************************************************************
      *                                                               *
      *  SRSUBF - Subroutine to display subfile.                      *
      *                                                               *
      *  Called By: SRSHOW                                            *
      *                                                               *
      *  Calls: - SRCLRM                                              *
      *         - SRPROC                                              *
      *         - SRCLRS                                              *
      *         - SRSETC                                              *
      *         - SRCLRS                                              *
      *         - SRROLL                                              *
      *         - ZASNMS                                              *
      *         - SRSUBC                                              *
      *         - SRWIND                                              *
      *         - SRVAL2                                              *
      *                                                               *
      *****************************************************************
      *
     C           SRSUBF    BEGSR                           *** SRSUBF ***
      *
     C                     MOVE *OFF      *IN62
      *
      **  Position on subfile page.
     C           SFLRCN    COMP 0                    02
     C           *IN02     IFEQ *ON
      *
      **  If particular page to display.
     C           WURCND    IFNE 0
     C                     Z-ADDWURCND    CTRECN
     C                     ENDIF
      *
      **  If no position settlement to display, "No data to display".
     C                     ELSE
     C                     MOVE 'SE08016' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      **  Set up and display command line.
     C           *IN70     IFEQ *ON
     C                     MOVELCMD,3     CMDLN1
     C                     ELSE
     C                     MOVELCMD,4     CMDLN1
     C                     ENDIF
      *
     C           CTPEVT    IFNE *BLANKS
     C           CTPDUD    ANDNE*BLANKS
      *
     C           CTSTAT    IFEQ 'L'
     C           CTSTAT    OREQ 'M'
     C           *IN70     ANDEQ*ON
     C                     MOVELCMD,5     CMDLN2
     C                     ELSE
     C                     MOVELCMD,6     CMDLN2
     C                     ENDIF
      *
     C                     ELSE
     C                     MOVELCMD,6     CMDLN2
     C                     ENDIF
      *
     C                     WRITESE0175F0
      *
      **  Display error messages.
     C                     WRITE#MSGCTL
      *
      **  Display subfile.
     C                     EXFMTSE0175C0
     C                     EXSR SRCLRM
      *
      **  Initialize record page of which is to be displayed.
     C                     Z-ADD0         WURCND
      *
     C                     MOVE *OFF      WUIN99           General error ind.
     C                     MOVEA'00'      *IN,27           DSPATR(RI) on CTSTAT
     C                     MOVEA'00'      *IN,37           DSPATR(PC) ON CTSTAT
      *
      **  Determine next process, depending on the action taken by user.
     C                     SELEC
      *
      **  If key <CA03> pressed, go to end subroutine.
     C           *INKC     WHEQ *ON
     C                     RETRN
      *
      **  If key <CA12> pressed, return to KEYINPUT screen.
     C           *INKL     WHEQ *ON
     C                     EXSR SRPROC
      *
      **  If key <CF05> pressed, re-display subfile.
     C           *INKE     WHEQ *ON
     C                     EXSR SRCLRS
      *
     C                     MOVE CTSTAT    WUSTAT
     C           *IN85     IFEQ *ON
     C                     MOVE 'N'       WNREAD
     C                     EXSR SRROLL
     C                     ENDIF
     C                     EXSR SRSUBC
      *
      **  Check if status selection field contains valid value.
     C           CTSTAT    WHNE WUSTAT
      *
     C           CTSTAT    LOKUPSTAT                     77
      *
     C           *IN77     IFEQ *ON
      *
     C           *IN70     IFEQ *OFF
     C           CTSTAT    ANDEQ'R'
     C                     MOVE 'SE08036' ZAMSID
     C                     EXSR ZASNMS
     C                     EXSR SRVAL1
     C                     MOVE *ON       *IN27
     C                     MOVE *ON       *IN37
     C                     EXSR SRSUBC
     C                     ENDIF
      *
     C                     MOVE CTSTAT    WUSTAT
     C                     ENDIF
      *
     C           *IN77     IFEQ *OFF
      *
     C           *IN70     IFEQ *ON
     C                     MOVE 'SE08017' ZAMSID
     C                     EXSR ZASNMS
     C                     EXSR SRVAL1
     C                     MOVE *ON       *IN27
     C                     MOVE *ON       *IN37
     C                     EXSR SRSUBC
      *
     C                     ELSE
     C                     MOVE 'SE08036' ZAMSID
     C                     EXSR ZASNMS
     C                     EXSR SRVAL1
     C                     MOVE *ON       *IN27
     C                     MOVE *ON       *IN37
     C                     EXSR SRSUBC
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     EXSR SRCLRS
      *
     C           *IN85     IFEQ *ON
     C                     MOVE *OFF      *IN62
     C                     MOVE *OFF      *IN81
     C                     EXSR SRROLL
     C                     ENDIF
      *
     C                     EXSR SRSUBC
      *
      **  If key <CF06> pressed, display confirmation window.
     C           *INKF     WHEQ *ON
      *
     C           WUSTAT    IFEQ CTSTAT
      *
     C                     MOVE CTSTAT    WUSTAT
     C                     MOVE *BLANKS   SNACTN
     C                     MOVE 'N'       WIN06
     C                     MOVE 'Y'       WINKF
      *
      **  If no action to confirm required, user can enter action to
      **  apply on every lines only if previous selection was made
      **  with event type and due date.
     C           CTPEVT    IFEQ *BLANKS
     C           CTPDUD    ANDEQ*BLANKS
     C                     MOVE 'SE08027' ZAMSID
     C                     EXSR ZASNMS
     C                     EXSR SRSUBC
     C                     ELSE
      *
     C           CTSTAT    IFEQ 'L'
     C           CTSTAT    OREQ 'M'
     C           *IN70     ANDEQ*ON
     C                     ADD  1         WRECDS  30
      *
     C           SFLRCN    IFEQ 0
     C                     MOVE *ON       *IN83
     C                     ELSE
     C           SFLRCN    CHAINSE0175S0             83
     C                     ENDIF
      *
     C           *IN83     DOWEQ*OFF
     C           WIN06     ANDEQ'N'
      *
     C                     ADD  1         WRECDS
     C           SFSTAT    IFEQ 'L'
     C           SFSTAT    OREQ 'M'
     C           *IN70     ANDEQ*ON
     C                     MOVE 'Y'       WIN06   1
     C                     ELSE
     C                     MOVE 'N'       WIN06
     C                     ENDIF
     C                     ADD  1         SFLRCN
     C           SFLRCN    CHAINSE0175S0             83
     C                     ENDDO
      *
     C           WRECDS    IFEQ 1
     C           SFLRCN    OREQ 0
     C                     MOVE 'SE08035' ZAMSID
     C                     EXSR ZASNMS
     C                     EXSR SRSUBC
     C                     ENDIF
      *
     C           WIN06     IFEQ 'Y'
     C           SFLRCN    ORNE 0
     C                     EXSR SRCLRM
     C                     EXSR SRWIND
     C                     ELSE
     C                     MOVE 'SE08035' ZAMSID
     C                     EXSR ZASNMS
     C                     EXSR SRSUBC
     C                     ENDIF
      *
     C                     ELSE
      *
     C           *IN70     IFEQ *ON
     C                     MOVE 'SE08038' ZAMSID
     C                     EXSR ZASNMS
     C                     EXSR SRSUBC
     C                     ELSE
     C                     MOVE 'SE08037' ZAMSID
     C                     EXSR ZASNMS
     C                     EXSR SRSUBC
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     EXSR SRCLRS
      *
     C           *IN85     IFEQ *ON
     C                     MOVE *OFF      *IN62
     C                     MOVE *OFF      *IN81
     C                     EXSR SRROLL
     C                     ENDIF
      *
     C                     EXSR SRSUBC
      *
      **  If no position settlement in subfile.
     C           *IN02     WHEQ *OFF
     C                     EXSR SRSUBC
      *
     C                     ENDSL
      *
      **  Initialize "selection to confirm" work field.
     C                     MOVE 'N'       WUSTOC  1
      *
      **  Initialize array used to store error message identifiers so that
      **  they will appear only once.
     C                     MOVE *BLANKS   ERR
     C                     Z-ADD0         E       20
      *
      **  Execute first subfile validation subroutine to check action codes.
     C                     EXSR SRVAL1
      *
      **  If key <ROLLUP> pressed.
     C           *IN05     IFEQ *ON
     C                     EXSR SRROLL
     C                     EXSR SRSUBC
     C                     ENDIF
      *
      **  If at least one invalid action code input, display messages.
     C           WUIN99    IFEQ *ON
     C                     EXSR SRSUBC
     C                     ENDIF
      *
      **  If key <CF06> pressed, display confirmation window.
     C                     MOVE *BLANKS   WINKF   1
     C           *INKF     IFEQ *ON
     C                     MOVE 'Y'       WINKF
     C                     MOVE 'N'       WIN06
      *
      **  If no action to confirm required, user can enter action to
      **  apply on every lines only if previous selection was made
      **  with event type and due date.
     C           CTPEVT    IFEQ *BLANKS
     C           CTPDUD    ANDEQ*BLANKS
     C                     MOVE 'SE08027' ZAMSID
     C                     EXSR ZASNMS
     C                     EXSR SRSUBC
     C                     ELSE
      *
     C           CTSTAT    IFEQ 'L'
     C           CTSTAT    OREQ 'M'
     C           *IN70     ANDEQ*ON
     C                     ADD  1         WRECDS  30
      *
     C           SFLRCN    IFEQ 0
     C                     MOVE *ON       *IN83
     C                     ELSE
     C           SFLRCN    CHAINSE0175S0             83
     C                     ENDIF
      *
     C           *IN83     DOWEQ*OFF
     C           WIN06     ANDEQ'N'
      *
     C                     ADD  1         WRECDS
     C           SFSTAT    IFEQ 'L'
     C           SFSTAT    OREQ 'M'
     C           *IN70     ANDEQ*ON
     C                     MOVE 'Y'       WIN06   1
     C                     ELSE
     C                     MOVE 'N'       WIN06
     C                     ENDIF
      *
     C                     ADD  1         SFLRCN
     C           SFLRCN    CHAINSE0175S0             83
     C                     ENDDO
      *
     C           WRECDS    IFEQ 1
     C           SFLRCN    OREQ 0
     C                     MOVE 'SE08035' ZAMSID
     C                     EXSR ZASNMS
     C                     EXSR SRSUBC
     C                     ENDIF
      *
     C           WIN06     IFEQ 'Y'
     C           SFLRCN    ORNE 0
     C                     EXSR SRCLRM
     C                     EXSR SRWIND
     C                     ELSE
     C                     MOVE 'SE08035' ZAMSID
     C                     EXSR ZASNMS
     C                     EXSR SRSUBC
     C                     ENDIF
      *
     C                     ELSE
      *
     C           *IN70     IFEQ *ON
     C                     MOVE 'SE08038' ZAMSID
     C                     EXSR ZASNMS
     C                     EXSR SRSUBC
     C                     ELSE
     C                     MOVE 'SE08037' ZAMSID
     C                     EXSR ZASNMS
     C                     EXSR SRSUBC
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  Display error messages.
     C                     EXSR SRCLRM
     C                     WRITE#MSGCTL
     C                     WRITESE0175C0
      *
     C                     ENDIF
      *
      **  Execute second subfile validation subroutine to process enquiry action
     C                     EXSR SRVAL2
      *
      **  If exit of program required.
     C           WUEXIT    IFEQ 'Y'
     C                     MOVE *ON       *INLR
     C                     ENDIF
      *
      **  If key <CF05> pressed on Position Settlement extended display,
      **  go to subfile display without keeping next selected Position
      **  settlements still to be processed.
     C           WUINKE    IFEQ *ON
     C                     WRITEASSUMEF
     C                     EXSR SRSUBC
     C                     ENDIF
      *
      **  If at least one record updated by another workstation, return
      **  to subfile selection.
     C           WUIN99    IFEQ *ON
     C                     MOVE 'SE08048' ZAMSID
     C                     EXSR ZASNMS
     C                     EXSR SRSUBC
     C                     ENDIF
      *
      **  If key <CF06> pressed, display confirmation window.
     C                     MOVE *BLANKS   WINKF
     C           *INKF     IFEQ *ON
     C                     MOVE 'Y'       WINKF
     C                     MOVE 'N'       WIN06
      *
      **  If no action to confirm required, user can enter action to
      **  apply on every lines only if previous selection was made
      **  with event type and due date.
     C           CTPEVT    IFEQ *BLANKS
     C           CTPDUD    ANDEQ*BLANKS
     C                     MOVE 'SE08027' ZAMSID
     C                     EXSR ZASNMS
     C                     EXSR SRSUBC
     C                     ELSE
      *
     C           CTSTAT    IFEQ 'L'
     C           CTSTAT    OREQ 'M'
     C           *IN70     ANDEQ*ON
     C                     ADD  1         WRECDS  30
      *
     C           SFLRCN    IFEQ 0
     C                     MOVE *ON       *IN83
     C                     ELSE
     C           SFLRCN    CHAINSE0175S0             83
     C                     ENDIF
      *
     C           *IN83     DOWEQ*OFF
     C           WIN06     ANDEQ'N'
      *
     C                     ADD  1         WRECDS
     C           SFSTAT    IFEQ 'L'
     C           SFSTAT    OREQ 'M'
     C           *IN70     ANDEQ*ON
     C                     MOVE 'Y'       WIN06   1
     C                     ELSE
     C                     MOVE 'N'       WIN06
     C                     ENDIF
      *
     C                     ADD  1         SFLRCN
     C           SFLRCN    CHAINSE0175S0             83
     C                     ENDDO
      *
     C           WRECDS    IFEQ 1
     C           SFLRCN    OREQ 0
     C                     MOVE 'SE08035' ZAMSID
     C                     EXSR ZASNMS
     C                     EXSR SRSUBC
     C                     ENDIF
      *
     C           WIN06     IFEQ 'Y'
     C           SFLRCN    ORNE 0
     C                     EXSR SRCLRM
     C                     EXSR SRWIND
     C                     ELSE
     C                     MOVE 'SE08035' ZAMSID
     C                     EXSR ZASNMS
     C                     EXSR SRSUBC
     C                     ENDIF
      *
     C                     ELSE
      *
     C           *IN70     IFEQ *ON
     C                     MOVE 'SE08038' ZAMSID
     C                     EXSR ZASNMS
     C                     EXSR SRSUBC
     C                     ELSE
     C                     MOVE 'SE08037' ZAMSID
     C                     EXSR ZASNMS
     C                     EXSR SRSUBC
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  Display error messages.
     C                     EXSR SRCLRM
     C                     WRITE#MSGCTL
     C                     WRITESE0175C0
      *
     C                     ENDIF
      *
      **  If no action or only enquiries.
     C           WUSTOC    IFEQ 'N'
     C                     EXSR SRSUBC
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/SRWIND
      *****************************************************************
      *                                                               *
      *  SRWIND - Subroutine to display confirmation window.          *
      *                                                               *
      *  Called By: SRSUBF                                            *
      *                                                               *
      *  Calls: - SRDETL                                              *
      *         - SRCLRM                                              *
      *         - SRSUBC                                              *
      *         - ZASNMS                                              *
      *         - SRWNDC                                              *
      *         - SRVAL3                                              *
      *         - SRCLRS                                              *
      *         - SRROLL                                              *
      *                                                               *
      *****************************************************************
      *
     C           SRWIND    BEGSR                           *** SRWIND ***
      *
      **  Display confirmation window.
     C           WINKF     IFEQ 'Y'
     C                     WRITE#MSGCTL2
     C                     MOVE *OFF      *IN09
     C                     EXFMTSE0175F3
     C                     EXSR SRCLRM
     C                     ELSE
     C                     WRITE#MSGCTL
     C                     EXSR SRDETL
     C                     ENDIF
      *
     C                     MOVE *OFF      *IN29
      *
      **  If key <CA03> pressed, go to end subroutine.
     C           *INKC     IFEQ *ON
     C                     RETRN
     C                     ENDIF
      *
      **  If key <CA12> pressed, return to subfile selection
      **  without loosing previous selection.
     C           *INKL     IFEQ *ON
     C                     EXSR SRCLRM
     C                     EXSR SRSUBC
     C                     ENDIF
      *
      **  Check action code input, only if no selection in subfile.
     C           *IN60     IFEQ *OFF
     C           SNACTN    LOKUPCODE                     77
      *
     C           *IN77     IFEQ *OFF
      *
     C           *IN70     IFEQ *ON
     C                     MOVE 'SE08029' ZAMSID
     C                     ELSE
     C                     MOVE 'SE08030' ZAMSID
     C                     ENDIF
      *
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN09
     C                     MOVE *ON       *IN29
     C                     EXSR SRWNDC
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
     C           *INKF     IFEQ *ON
      *
     C           WINKF     IFEQ 'Y'
      *
     C                     EXSR SRVAL3
      *
     C                     EXSR SRCLRM
     C                     MOVE 'SE08032' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN09
     C                     WRITE#MSGCTL2
     C                     WRITESE0175F3
      *
      **  Temporisation to let user see message on window.
     C                     DO   500
     C                     END
      *
      **  If one or more Position settlements have already been updated
      **  by another workstation, display message.
     C                     EXSR SRCLRM
     C           WURALU    IFEQ 'Y'
     C                     MOVE 'SE08033' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     EXSR SRCLRS
      *
     C           *IN85     IFEQ *ON
     C                     MOVE *OFF      *IN81
     C                     EXSR SRROLL
     C                     ENDIF
      *
     C                     EXSR SRSUBC
      *
     C                     ENDIF
      *
      **  If key <ENTER> pressed, send message to confirm.
     C                     MOVE 'SE08031' ZAMSID
     C                     EXSR ZASNMS
     C                     EXSR SRWNDC
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRQRYS - Subroutine to process query selections.             *
      *                                                               *
      *  Called By: PROCES                                            *
      *                                                               *
      *  Calls:                                                       *
      *                                                               *
      *****************************************************************
      *
     C           SRQRYS    BEGSR                           *** SRQRYS ***
      *
     C                     MOVE 'N'       WUQSLT  1
      *
      **  If Booking Branch remains blanks.
     C           SBRCA     IFEQ *BLANKS
     C                     MOVE WUDBRN    SBRCA
     C                     ENDIF
      *
      **  Test query selection on Booking Branch field.
     C           '?'       SCAN SBRCA                    77
     C           *IN77     IFEQ *ON
     C                     MOVE 'Y'       WUQSLT
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   P@RTCD  7
     C                     PARM '*KEY   ' P@OPTN  7
     C                     PARM SBRCA     P@BRCD  3
     C********** SDBRCH    PARM SDBRCH    DSFDY                                               CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *
     C           P@RTCD    IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'AOBRCHR0'DBFILE           ***************
     C                     MOVELSBRCA     DBKEY            * DB ERROR 26 *
     C                     Z-ADD26        DBASE            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C           P@RTCD    IFNE *BLANKS
     C                     MOVEL*BLANKS   SBRCA
     C                     ELSE
     C                     MOVELA8BRCD    SBRCA
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  Test query selection on Security code field.
     C           CSE010    IFEQ 'Y'
     C                     MOVELSSESH     WQMK    1
     C           WQMK      IFEQ '?'
     C                     MOVE 'Y'       WUQSLT
     C                     CALL 'SE0043'
     C                     PARM *BLANK    P@ACDE  1
     C                     PARM SSESH     P@SESN 10
      *
     C           P@SESN    IFEQ *BLANKS
     C                     MOVE *BLANKS   SSESH
     C                     ELSE
     C                     MOVE P@SESN    SSESH
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
     C           CSE003    IFEQ 'Y'
     C           '?'       SCAN SSESH                    77
     C           *IN77     IFEQ *ON
     C                     MOVE '6'       RTNC
     C                     MOVE *BLANKS   RQSESN
     C                     CALL 'SE0240'
      *
     C           RTNC      IFNE '0'
     C           RTNC      ANDNE'1'
     C                     MOVE RQSESN    SSESH
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
      *
      **  Test query selection on Customer field .
     C           '?'       SCAN SCUST                    77
     C           *IN77     IFEQ *ON
     C                     MOVE 'Y'       WUQSLT  1
     C                     CALL 'AOSECSR0'
     C                     PARM *BLANKS   P@RTCD  7
     C                     PARM '*KEY   ' P@OPTN  7
     C                     PARM SCUST     P@CUST  6
     C           SDSECS    PARM SDSECS    DSSDY
      *
     C           P@RTCD    IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'AOSECSR0'DBFILE           ***************
     C                     MOVELSCUST     DBKEY            * DB ERROR 27 *
     C                     Z-ADD27        DBASE            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C           P@RTCD    IFNE *BLANKS
     C                     MOVEL*BLANKS   SCUST
     C                     ELSE
     C                     MOVELBFCUST    SCUST
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  Test query selection on Book code field .
     C           '?'       SCAN SBKCD                    77
     C           *IN77     IFEQ *ON
     C                     MOVE 'Y'       WUQSLT  1
     C                     CALL 'AOBOOKR0'
     C                     PARM *BLANKS   P@RTCD  7
     C                     PARM '*KEY   ' P@OPTN  7
     C                     PARM SBKCD     P@CUST  6
     C           SDBOOK    PARM SDBOOK    DSSDY
      *
     C           P@RTCD    IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'AOBOOKR0'DBFILE           ***************
     C                     MOVELSBKCD     DBKEY            * DB ERROR 28 *
     C                     Z-ADD28        DBASE            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C           P@RTCD    IFNE *BLANKS
     C                     MOVEL*BLANKS   SBKCD
     C                     ELSE
     C                     MOVELBDBKCD    SBKCD
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRVALK - Subroutine to validate KEYINPUT input               *
      *                                                               *
      *  Called By: PROCES                                            *
      *                                                               *
      *  Calls: - ZASNMS                                              *
      *                                                               *
      *****************************************************************
      *
     C           SRVALK    BEGSR                           *** SRVALK ***
      *
      **  Reset error indicators.
     C                     MOVEA'000000'  *IN,21
     C                     MOVE *OFF      *IN57
     C                     MOVE *OFF      *IN58
     C                     MOVE *OFF      *IN59
     C                     MOVE *OFF      *IN99
      *
      **  Set up File record positionning indicators.
     C                     MOVEA'1000'    *IN,12
      *
     C                     MOVE ' '       WFREEM  1                                           215481
      *                                                                                       215481
      **-------<   C H E C K   B O O K I N G   B R A N C H   >-------**
      *
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   P@RTCD  7
     C                     PARM '*KEY'    P@OPTN  7
     C                     PARM SBRCA     P@BRCD  3
     C********** SDBRCH    PARM SDBRCH    DSFDY                                               CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *
      **  If Invalid Branch.
     C           P@RTCD    IFNE *BLANKS
     C                     MOVE 'SE08001' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN21
     C                     MOVE *ON       *IN99
     C                     ENDIF
      *
      **--------<   C H E C K   S E C U R I T Y   C O D E   >--------**
      *
      **  If Security remains blanks.
     C           SSESH     IFEQ *BLANKS
     C                     MOVE 'SE08002' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN22
     C                     MOVE *ON       *IN99
      *
     C                     ELSE
     C           SSESH     CHAINSECTY                84
      *
      **  If Security doesn't exist.
     C           *IN84     IFEQ *ON
      *
     C           CSE003    IFEQ 'Y'
     C           CSE010    OREQ 'Y'
     C                     MOVE 'SE08003' ZAMSID
     C                     ELSE
     C                     MOVE 'SE08046' ZAMSID
     C                     ENDIF
      *
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN22
     C                     MOVE *ON       *IN99
     C                     ELSE
      *
      **  If Security isn't active
     C           RECI      IFNE 'D'
     C                     MOVE 'SE08004' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN22
     C                     MOVE *ON       *IN99
     C                     ENDIF
      *
     C           CSE023    IFEQ 'Y'                                                           215481
     C           CRTT      ANDNE*BLANKS                                                       215481
     C                     MOVE 'Y'       WFREEM                                              215481
     C                     ELSE                                                               215481
     C                     MOVE ' '       WFREEM                                              215481
     C                     ENDIF                                                              215481
      *                                                                                       215481
     C                     ENDIF
      *
     C                     ENDIF
      *
     C           SEVTP     IFNE *BLANKS
      *
      **  Check if Security Investment Type exists.
     C           KINVTP    KLIST
     C                     KFLD           KNMCY   3
     C                     KFLD           KSITP   3
     C                     MOVE NMCY      KNMCY
     C                     MOVE SITP      KSITP
     C           KINVTP    CHAININVTP                84
      *
     C           *IN84     IFEQ *OFF
     C           RECI      COMP '*'                      84
     C                     ENDIF
      *
     C           *IN84     IFEQ *ON
     C                     MOVE 'SE08005' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN22
     C                     MOVE *ON       *IN99
      *
      **  If Security is OK, check Event type if not blanks.
     C                     ELSE
      *
      **  If Event type = 'CP', security on PF/SECTYD must be interest bearing.
     C           SEVTP     IFEQ 'CP'
      *
     C           PROT      IFNE '1'
     C           PROT      ANDNE'3'
     C           PROT      ANDNE'5'
     C           PROT      ANDNE'6'
     C           PROT      ANDNE'8'
     C           PROT      ANDNE'9'
     C           STBS      ORNE 'P'
     C           STBS      ANDNE'Y'
     C                     MOVE 'SE08006' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN22
     C                     MOVE *ON       *IN99
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  If Event type = 'DV', processing type must be for shares.
     C           SEVTP     IFEQ 'DV'
     C           PROT      ANDNE'4'
     C                     MOVE 'SE08007' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN22
     C                     MOVE *ON       *IN99
     C                     ENDIF
      *
      **  If Event type = 'MT', security must be a discount
      **  or interest security with maturity date not all 9's.
     C           SEVTP     IFEQ 'MT'
      *
     C           STBS      IFNE 'D'
      *
     C           PROT      IFNE '1'
     C           PROT      ANDNE'3'
     C           PROT      ANDNE'5'
     C           PROT      ANDNE'6'
     C           PROT      ANDNE'8'
     C           PROT      ANDNE'9'
     C           STBS      ORNE 'P'
     C           STBS      ANDNE'Y'
     C                     MOVE 'SE08008' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN22
     C                     MOVE *ON       *IN99
      *
     C                     ELSE
      *
     C           MATY      IFEQ 99999
     C                     MOVE 'SE08008' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN22
     C                     MOVE *ON       *IN99
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ELSE
      *
     C           MATY      IFEQ 99999
     C                     MOVE 'SE08008' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN22
     C                     MOVE *ON       *IN99
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
      **--------<   C H E C K   C U S T O M E R   C O D E   >--------**
      *
      **  If Customer is not blanks.
     C           SCUST     IFNE *BLANKS
      *
     C                     MOVEL*BLANKS   P@KEY1
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   P@RTCD  7
     C                     PARM '*KEY'    P@OPTN  7
     C                     PARM SCUST     P@KEY1 10
     C                     PARM *BLANKS   P@KYST  7
     C           SDCUST    PARM SDCUST    DSSDY
      *
      **  If customer doesn't exist.
     C           P@RTCD    IFNE *BLANKS
     C                     MOVE 'SE08009' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN23
     C                     MOVE *ON       *IN99
      *
     C                     ELSE
      *
      **  Check Customer Exists on Securities Customer File.
     C                     CALL 'AOSECSR0'
     C                     PARM *BLANKS   P@RTCD  7
     C                     PARM '*KEY   ' P@OPTN  7
     C                     PARM BBCUST    P@CUST  6
     C           SDSECS    PARM SDSECS    DSSDY
      *
     C           P@RTCD    IFNE *BLANKS
     C                     MOVE 'SE08010' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN23
     C                     MOVE *ON       *IN99
      *
     C                     ELSE
     C                     MOVE *OFF      *IN12
     C                     MOVE *ON       *IN13
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
      **------------<   C H E C K   B O O K   C O D E   >------------**
      *
      **  If Book code isn't blank.
     C           SBKCD     IFNE *BLANK
     C                     CALL 'AOBOOKR0'
     C                     PARM           P@RTCD  7
     C                     PARM '*VERIFY' P@OPTN  7
     C                     PARM SBKCD     P@BKCD  2
     C           SDBOOK    PARM SDBOOK    DSSDY                                               222373
      *
      **  If Book code doesn' exist.
     C           P@RTCD    IFNE *BLANKS
     C                     MOVE 'SE08011' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN24
     C                     MOVE *ON       *IN99
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
      **-------------<   C H E C K   D U E   D A T E   >-------------**
      *
     C           SDUDT     IFNE *BLANKS
     C                     TESTN          SDUDT      77
      *
      **  Date isn't numeric.
     C           *IN77     IFEQ *OFF
     C                     MOVE 'SE08013' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN26
     C                     MOVE *ON       *IN99
      *
     C                     ELSE
     C           *LIKE     DEFN *IN99     WUIN99
     C                     MOVE *IN99     WUIN99
     C                     MOVELSDUDT     ZDATE
     C                     EXSR ZDATE1
      *
      **  Date is invalid.
     C           *IN99     IFEQ *ON
     C                     MOVE 'SE08014' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN26
      *
     C                     ELSE
     C                     MOVE WUIN99    *IN99
      *
     C           ZDAYNO    IFGT AGRDNB
     C                     MOVE 'SE08015' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN26
     C                     MOVE *ON       *IN99
      *
     C                     ELSE
     C           *LIKE     DEFN ZDAYNO    WUPDUD
     C                     Z-ADDZDAYNO    WUPDUD
      *
     C           *IN13     IFEQ *ON
     C                     MOVE *ON       *IN14
     C                     MOVE *OFF      *IN13
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
      **-----------<   C H E C K   E V E N T   T Y P E   >-----------**
      *
     C           SEVTP     IFNE *BLANKS
      *
     C           SEVTP     IFNE 'CP'
     C           SEVTP     ANDNE'DV'
     C           SEVTP     ANDNE'MT'
     C                     MOVE 'SE08012' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN25
     C                     MOVE *ON       *IN99
      *
     C                     ELSE
      *
     C           *IN14     IFEQ *ON
     C                     MOVE *ON       *IN15
     C                     MOVE *OFF      *IN14
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  Do this only if security, customer and event type are ok.
      **  Validate tax basket and beneficial customer/owner number if,
      **  CSE023 - Withholding tax treaty is installed.
      *
     C           CSE023    IFEQ 'Y'
     C           *IN22     ANDEQ*OFF
     C           *IN23     ANDEQ*OFF
     C           *IN25     ANDEQ*OFF
      *
     C           STXBS     IFNE *BLANKS
     C           SEXCD     ORNE *BLANKS
     C           SBNFO     ORNE *BLANKS
      *
      ** Retrieve security details for the country of tax treaty.
     C           SSESH     CHAINSECTY                30
      *
     C           SCUST     IFEQ *BLANKS
      *
     C           SEXCD     IFNE *BLANKS
     C                     MOVE *ON       *IN57
     C                     ENDIF
      *
     C           STXBS     IFNE *BLANKS
     C                     MOVE *ON       *IN58
     C                     ENDIF
      *
     C           SBNFO     IFNE *BLANKS
     C                     MOVE *ON       *IN59
     C                     ENDIF
      *
     C           STXBS     IFNE *BLANKS
     C           SBNFO     ORNE *BLANKS
     C           SEXCD     ORNE *BLANKS
     C                     MOVE *ON       *IN99
     C                     MOVE 'SE08045' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
     C                     ELSE
      *
      ** Tax Basket and Beneficial owner not allowed if event type is
      ** not 'DV' 'CP' or 'MT'.
      *
     C           SEVTP     IFNE 'CP'
     C           SEVTP     ANDNE'DV'
     C           SEVTP     ANDNE'MT'
      *
     C           STXBS     IFNE *BLANKS
     C           SBNFO     ORNE *BLANKS
     C           SEXCD     ORNE *BLANKS
     C                     MOVE *ON       *IN99
     C                     MOVE 'SE08039' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** Highlight fields in error.
     C           SEXCD     IFNE *BLANKS
     C                     MOVE *ON       *IN57
     C                     ENDIF
      *
     C           STXBS     IFNE *BLANKS
     C                     MOVE *ON       *IN58
     C                     ENDIF
      *
     C           SBNFO     IFNE *BLANKS
     C                     MOVE *ON       *IN59
     C                     ENDIF
      *
     C                     ELSE
      *
     C                     MOVE *ON       *IN20
      *
      ** Country of tax treaty defined, validate tax basket and
      ** beneficial owner.
     C                     MOVELSCUST     KYCSNO
     C                     MOVELCRTT      KYCRTT
      *
     C           SBNFO     IFNE *BLANKS
     C                     MOVELSCUST     KYBNFO
     C                     MOVE SBNFO     KYBNFO
     C                     ELSE
     C                     MOVE *BLANKS   KYBNFO
     C                     ENDIF
      *
      ** Perform chaining of necessary data files for validation.
     C           BFCLAS    IFEQ 'S'
     C           BFCLAS    OREQ 'D'
     C           WTAKEY    CHAINSDWTCSL1             31
     C           *IN31     IFEQ *ON
     C                     MOVE *ON       *IN23
     C                     MOVE *ON       *IN99
      *
      ** Make sure error message appears only once on screen.
     C                     MOVE 'SE08040' ZAMSID
     C                     EXSR ZASNMS
      *
     C                     ELSE
      *
      *
     C                     MOVE WHRPCD    RPCD
     C                     ENDIF
     C                     ENDIF
      *
     C           STXBS     IFNE *BLANKS
     C           WTBKEY    CHAINSDTXBSL1             32
     C           *IN32     IFEQ *ON
     C                     MOVE *ON       *IN58
     C                     MOVE *ON       *IN99
      *
      ** Make sure error message appears only once on screen.
     C                     MOVE 'SE08041' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
      *
     C           *IN15     IFEQ *ON
     C                     MOVE *ON       *IN16
     C                     MOVE *OFF      *IN15
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** Beneficial Customer is optional, but if entered must be a
      ** valid record on file.
     C           SBNFO     IFNE *BLANKS
     C           WBOKEY    CHAINSDBNFOL2             33
     C           *IN33     IFEQ *ON
     C                     MOVE *ON       *IN59
     C                     MOVE *ON       *IN99
     C                     MOVE 'SE08042' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
      *
     C           *IN16     IFEQ *ON
     C                     MOVE *ON       *IN17
     C                     MOVE *OFF      *IN16
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** Beneficial Owner not allowed if Intermediary Status is 'QI'.
     C           WHINTS    IFEQ 'QI'
     C           SBNFO     ANDNE*BLANKS
      *
     C                     MOVE *ON       *IN59
     C                     MOVE *ON       *IN99
     C                     MOVE 'SE08044' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
      *
     C           *IN16     IFEQ *ON
     C                     MOVE *ON       *IN17
     C                     MOVE *OFF      *IN16
     C                     ENDIF
      *
     C                     ENDIF
      *
     C           SEXCD     IFNE *BLANKS
     C           WTEKEY    CHAINSDEXEML1             34
      *
     C           *IN34     IFEQ *ON
     C                     MOVE *ON       *IN57
     C                     MOVE *ON       *IN99
     C                     MOVE 'SE08043' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
      *
     C           *IN17     IFEQ *ON
     C                     MOVE *ON       *IN18
     C                     MOVE *OFF      *IN17
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRSETC - Subroutine to set up Subfile Control Record fields. *
      *                                                               *
      *  Called By: PROCES                                            *
      *                                                               *
      *  Calls: - *PSSR                                               *
      *                                                               *
      *****************************************************************
      *
     C           SRSETC    BEGSR                           *** SRSETC ***
      *
      **  Set up Subfile control record fields.
     C                     MOVE SBRCA     CTPBCA
     C                     MOVE SSESH     CTPSSH
      *
     C           CSE023    IFEQ 'Y'
     C                     MOVE SCUST     CTCUST
     C                     MOVE SBNFO     CTBNFO
     C                     MOVE STXBS     CTTXBS
     C                     MOVE SEXCD     CTEXCD
     C                     ENDIF
      *                                                                   CSE016
     C**********           MOVE SRPN      CTSRPN                          CSE016
     C                     MOVE BVRIDF    ZRSFD                           CSE016
     C                     MOVELSRPN      ZSRPN                           CSE016
     C                     EXSR ZSDESC                                    CSE016
     C                     MOVELZRNME     CTSRNM                          CSE016
      *                                                                   CSE016
     C                     MOVE P@CUST    CTPCPY
     C           CTPCPY    IFNE *BLANKS
     C                     MOVE BBCSSN    CTCSSN
      *
     C                     ENDIF
     C                     MOVE SBKCD     CTPBCD
     C                     MOVE SEVTP     CTPEVT
     C                     MOVE SDUDT     CTPDUD
     C                     MOVE *BLANKS   CTSTAT
     C           *LIKE     DEFN CTSTAT    WUSTAT
     C                     MOVE *BLANKS   WUSTAT
      *
      **  If feature S01509 is active, bypass the set-up of
      **  nominal currency decimal places.
     C           S01509    IFEQ 'N'
     C                     CALL 'AOCURRR0'
     C                     PARM '*DBERR'  P@RTCD
     C                     PARM '*KEY   ' P@OPTN
     C                     PARM NMCY      P@CURR  3
     C           SDCURR    PARM SDCURR    DSSDY
      *
     C           P@RTCD    IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'AOCURRR0'DBFILE           ***************
     C                     MOVELNMCY      DBKEY            * DB ERROR 04 *
     C                     Z-ADD4         DBASE            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
      *
     C                     ENDIF
      *
     C           *LIKE     DEFN A6NBDP    WUNMDP
     C                     Z-ADDA6NBDP    WUNMDP
      *
     C                     ENDIF
      *
      **  Determine which action code user is authorised to.
     C                     Z-ADD0         A       10
     C                     Z-ADD0         C       10
     C                     MOVE *BLANKS   AUTH
     C                     DO   4
     C                     ADD  1         A
     C                     MOVELACTN,A    P@ACTN
      *
      **  If Single Branch Environment
     C           AGMBIN    IFNE 'Y'
     C                     CALL 'ZVACTU'
     C                     PARM           P@ACTN  1
     C                     PARM           P@ERR   10
      *
      **  If Multibranching Environment
     C                     ELSE
     C                     CALL 'ZVACTBU'
     C                     PARM           P@ACTN  1
     C                     PARM SBRCA     P@PBCA  3
     C                     PARM           P@ERR   10
      *
     C                     ENDIF
      *
      **  If user authorised to this action.
     C           P@ERR     IFEQ 0
     C                     ADD  1         C
     C                     MOVELACTN,A    AUTH,C
      *
     C                     ENDIF
      *
     C                     ENDDO
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRCLRS - Subroutine to clear subfile and position on         *
      *           first available Position Settlement.                *
      *                                                               *
      *  Called By: PROCES                                            *
      *                                                               *
      *  Calls: None                                                  *
      *                                                               *
      *****************************************************************
      *
     C           SRCLRS    BEGSR                           *** SRCLRS ***
      *
      **  Clear subfile.
     C                     MOVEA'000'     *IN,01
     C                     WRITESE0175C0
     C                     MOVE *ON       *IN01
      *
      **  Initialize subfile record number for subfile read.
     C                     Z-ADD0         SFLRCN  40
      *
      **  Initialize last record number in subfile.
     C                     Z-ADD0         WULRCN  40
      *
      **  Initialize record number page of which must be displayed.
     C                     Z-ADD0         WURCND  40
      *
     C           *LIKE     DEFN PBCA      WUSVBR
     C                     MOVEL*BLANKS   WUSVBR
      *
      **  Position on first record according to selection required.
     C           *LIKE     DEFN PBCA      KPBCA
     C           *LIKE     DEFN PSSH      KPSSH
     C           *LIKE     DEFN PCPY      KPCPY
     C           *LIKE     DEFN PDUD      KPDUD
     C           *LIKE     DEFN PEVT      KPEVT
     C           KPOS22    KLIST
     C                     KFLD           KPBCA
     C                     KFLD           KPSSH
     C           KPOS23    KLIST
     C                     KFLD           KPBCA
     C                     KFLD           KPSSH
     C                     KFLD           KPCPY
     C           KPOS24    KLIST
     C                     KFLD           KPBCA
     C                     KFLD           KPSSH
     C                     KFLD           KPCPY
     C                     KFLD           KPDUD
     C           KPOS25    KLIST
     C                     KFLD           KPBCA
     C                     KFLD           KPSSH
     C                     KFLD           KPCPY
     C                     KFLD           KPDUD
     C                     KFLD           KPEVT
     C           KPOS26    KLIST
     C                     KFLD           KPBCA
     C                     KFLD           KPSSH
     C                     KFLD           KPCPY
     C                     KFLD           KPDUD
     C                     KFLD           KPEVT
     C                     KFLD           KPTFR
     C**********           KFLD           KTNLU                                             BUG12729
     C                     KFLD           KTXBS
     C           KPOS27    KLIST
     C                     KFLD           KPBCA
     C                     KFLD           KPSSH
     C                     KFLD           KPCPY
     C                     KFLD           KPDUD
     C                     KFLD           KPEVT
     C                     KFLD           KPTFR
     C**********           KFLD           KTNLU                                             BUG12729
     C                     KFLD           KTXBS
     C                     KFLD           KBNFO  26
     C           KPOS28    KLIST
     C                     KFLD           KPBCA
     C                     KFLD           KPSSH
     C                     KFLD           KPCPY
     C                     KFLD           KPDUD
     C                     KFLD           KPEVT
     C                     KFLD           KPTFR
     C**********           KFLD           KTNLU                                             BUG12729
     C                     KFLD           KTXBS
     C                     KFLD           KBNFO
     C                     KFLD           KEXCD
      *
     C                     MOVELSBRCA     KPBCA
     C                     MOVELSSESH     KPSSH
      *
      **  If Branch Code is blank.
     C           *IN12     IFEQ *ON
     C           KPOS22    SETLLPOSET6                   85
     C                     ENDIF
      *
      **  If Counterparty selection field is blank.
     C           *IN13     IFEQ *ON
     C                     MOVELSCUST     KPCPY
     C           KPOS23    SETLLPOSET6                   85
     C                     ENDIF
      *
      **  If Event type selection field is blank.
     C           *IN14     IFEQ *ON
     C                     MOVELSCUST     KPCPY
     C                     MOVELWUPDUD    KPDUD
     C           KPOS24    SETLLPOSET6                   85
     C                     ENDIF
      *
      **  If Due date selection field is blank.
     C           *IN15     IFEQ *ON
     C                     MOVELSCUST     KPCPY
     C                     MOVELWUPDUD    KPDUD
     C                     MOVELSEVTP     KPEVT
     C           KPOS25    SETLLPOSET6                   85
     C                     ENDIF
      *
      **  If All selection fields above are different from blanks.
     C           *IN16     IFEQ *ON
     C                     MOVELSCUST     KPCPY
     C                     MOVELWUPDUD    KPDUD
     C                     MOVELSEVTP     KPEVT
     C                     MOVELSTXBS     KTXBS
     C           KPOS26    SETLLPOSET6                   85
     C                     ENDIF
      *
      **  If All selection fields above are different from blanks.
     C           *IN17     IFEQ *ON
     C                     MOVELSCUST     KPCPY
     C                     MOVELSEVTP     KPEVT
     C                     MOVELWUPDUD    KPDUD
     C                     MOVELSTXBS     KTXBS
     C                     MOVELSCUST     KBNFO
     C                     MOVE SBNFO     KBNFO
     C           KPOS27    SETLLPOSET6                   85
     C                     ENDIF
      *
      **  If All selection fields above are different from blanks.
     C           *IN18     IFEQ *ON
     C                     MOVELSCUST     KPCPY
     C                     MOVELSEVTP     KPEVT
     C                     MOVELWUPDUD    KPDUD
     C                     MOVELSTXBS     KTXBS
     C                     MOVELSCUST     KBNFO
     C                     MOVE SBNFO     KBNFO
     C                     MOVE SEXCD     KEXCD
     C           KPOS28    SETLLPOSET6                   85
     C                     ENDIF
      *
      **  If no record equal to the search argumenmt.
     C           *IN85     IFEQ *OFF
     C                     MOVE *ON       *IN03
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRROLL - Fill one page of the subfile.                       *
      *                                                               *
      *  Called By: PROCES                                            *
      *                                                               *
      *  Calls: - ZDATE2                                              *
      *                                                               *
      *****************************************************************
      *
     C           SRROLL    BEGSR                           *** SRROLL ***
      *
      **  Initialize number of Position settlement to be taken in account.
     C                     Z-ADD0         WURCNB  40
      *
      **  Restore last subfile record number.
     C                     Z-ADDWULRCN    SFLRCN
      *
      **  Initialize save of POSET key work field.
     C           *LIKE     DEFN WUPOSK    WUSAVK
     C                     MOVE *BLANKS   WUSAVK
      *
     C           *IN62     IFEQ *OFF
     C                     EXSR SRREAD
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRREAD - Read records and write to subfile.                  *
      *                                                               *
      *  Called By: SRROLL                                            *
      *                                                               *
      *  Calls: - SRENDS                                              *
      *         - ZDATE2                                              *
      *****************************************************************
      *
     C           SRREAD    BEGSR                           *** SRREAD ***
      *
     C           *IN81     DOWEQ*OFF
     C           *IN62     ANDEQ*OFF
     C           WNREAD    OREQ 'N'
      *
     C           *IN12     IFEQ *ON
     C           KPOS22    READEPOSET6                   81
     C                     ENDIF
      *
     C           *IN13     IFEQ *ON
     C           KPOS23    READEPOSET6                   81
     C                     ENDIF
      *
     C           *IN14     IFEQ *ON
     C           KPOS24    READEPOSET6                   81
     C                     ENDIF
      *
     C           *IN15     IFEQ *ON
     C           KPOS25    READEPOSET6                   81
     C                     ENDIF
      *
     C           *IN16     IFEQ *ON
     C           KPOS26    READEPOSET6                   81
     C                     ENDIF
      *
     C           *IN17     IFEQ *ON
     C           KPOS27    READEPOSET6                   81
     C                     ENDIF
      *
     C           *IN18     IFEQ *ON
     C           KPOS28    READEPOSET6                   81
     C                     ENDIF
      *
     C           *IN81     IFEQ *ON
     C                     MOVE *ON       *IN62
     C                     EXSR SRENDS
     C                     ENDIF
      *
     C           *IN62     IFEQ *OFF
      *
      **  If not equal key read, use selection fields values.
     C           SDUDT     IFNE *BLANKS
     C           *IN12     ANDEQ*ON
     C           PDUD      ANDNEWUPDUD
      *
     C           SEVTP     ORNE *BLANKS
     C           *IN12     ANDEQ*ON
     C           PEVT      ANDNESEVTP
      *
     C           SEVTP     ORNE *BLANKS
     C           *IN13     ANDEQ*ON
     C           PEVT      ANDNESEVTP
      *
     C           SEVTP     OREQ *BLANKS
     C           PEVT      ANDNE'CP'
     C           PEVT      ANDNE'DV'
     C           PEVT      ANDNE'MT'
      *
     C           SBKCD     ORNE *BLANKS
     C           PBCD      ANDNESBKCD
      *
      **  If status selection required.
     C           WUSTAT    OREQ 'L'
     C           RECI      ANDNE'D'
     C           WUSTAT    OREQ 'L'
     C           PAUI      ANDEQ'Y'
     C           WUSTAT    OREQ 'A'
     C           RECI      ANDNE'D'
     C           WUSTAT    OREQ 'A'
     C           PAUI      ANDNE'Y'
     C           WUSTAT    OREQ 'D'
     C           RECI      ANDNE'*'
     C           WUSTAT    OREQ 'M'
     C           RECI      ANDNEWUSTAT
     C           WUSTAT    OREQ 'R'
     C           RECI      ANDNEWUSTAT
      *
     C                     MOVE 'Y'       WNREAD  1
      *
     C                     ELSE
      *
      **  Check if user is authorised to branch on position record.
     C           PBCA      IFNE WUSVBR
     C                     Z-ADD0         P@ERR
      *
     C           AGMBIN    IFEQ 'Y'
     C                     CALL 'ZVBBU'
     C                     PARM PBCA      P@BBCA  3
     C                     PARM 0         P@ERR   10
      *
      **  If user not authorized.
     C                     ENDIF
      *
     C                     ENDIF
      *
     C           P@ERR     IFEQ 0
      *
     C                     MOVE PBCA      WUSVBR
      *
      **  If feature S01496 is not installed, ignore matured
      **  position settlements.
     C           *IN70     IFEQ *ON
     C           *IN70     OREQ *OFF
     C           RECI      ANDNE'R'
      *
      **  If record not out of page.
     C           WURCNB    IFLT 9
      *
      **  Initialize subfile record fields.
     C                     CLEARSE0175S0
     C                     MOVE *OFF      *IN07
      *
      ** If record is matured, reversed or deleted, flag it as such on screen.
     C           RECI      IFNE 'D'
      *
     C           RECI      IFEQ '*'
     C                     MOVEL'D'       SFSTAT
      *
     C                     ELSE
     C                     MOVE RECI      SFSTAT
      *
     C                     ENDIF
      *
     C                     ELSE
     C                     MOVE 'L'       SFSTAT
     C           PAUI      IFEQ 'Y'
     C                     MOVE 'A'       SFSTAT
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  Hidden fields.
     C                     MOVELRECI      HDRECI           Record Id.
     C                     Z-ADDPDUD      HDPDUD           Due Date (Midas format)
     C                     Z-ADDTNLU      HDTNLU           Trans. no of last upd
     C                     MOVELTXBS      HDTXBS           Tax Basket
     C                     MOVELBNFO      HDBNFO           Beneficial owner no.
     C                     MOVELEXCD      HDEXCD           Exemption code
      *
      **  Displayed fields.
     C**********           Z-ADDPCPY      SFPCPY           Counterparty                       CSD027
     C                     MOVE PCPY      SFPCPY           Counterparty                       CSD027
      *
      **  Fetch payment currency decimal places, if S01509 is active.
     C           S01509    IFEQ 'Y'
     C                     CALL 'AOCURRR0'
     C                     PARM '*DBERR'  P@RTCD
     C                     PARM '*KEY   ' P@OPTN
     C                     PARM PNCY      P@CURR
     C           SDCURR    PARM SDCURR    DSSDY
      *
     C           P@RTCD    IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'AOCURRR0'DBFILE           ***************
     C                     MOVELPNCY      DBKEY            * DB ERROR 12 *
     C                     Z-ADD12        DBASE            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
      *
     C                     ENDIF
     C                     ENDIF
      *
     C           PAMD      IFNE 0
     C                     MOVE PAMD      ZFLD15
     C                     Z-ADDA6NBDP    ZDECS
     C*
     C                     MOVE ' '       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVEL*BLANKS   SFPAMD
     C                     MOVE ZOUT21    SFPAMD
     C                     ELSE
     C                     MOVEL*BLANKS   SFPAMD
     C                     ENDIF
      *
     C                     Z-ADDPDUD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZDATE     SFPDUD
      *
      **  Set up of Value Date.
     C           S01512    IFEQ 'Y'
      *
     C           PSVL      IFEQ *ZERO
     C                     MOVE '0'       SFPSVL
     C                     ELSE
     C                     Z-ADDPSVL      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZDATE     SFPSVL
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     MOVELPPRE      SFPPRE           Pay/Rec. indicator
     C                     Z-ADDPNMP      SFPNMP           Nominal amount
      *
     C           *IN64     IFEQ *ON
     C                     MOVELPNCY      SFPNCY           Nominal currency
     C                     ENDIF
      *
     C                     MOVELPBCD      SFPBCD           Book code
     C                     MOVELPEVT      SFPEVT           Event type
      *
      **  If Portfolio Management is installed.
     C           BGPFMG    IFEQ 'Y'
     C           BGN4ST    OREQ 'Y'
      *
     C                     MOVE *ON       *IN42
     C           PTFR      IFEQ '9997'
     C                     MOVELFCR997    SFPTFR
      *
     C                     ELSE
     C                     MOVELPTFR      SFPTFR
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     MOVE PAUI      SFAUI            Authorised indicator
      *
     C                     ADD  1         SFLRCN
     C                     ADD  1         WULRCN
     C                     WRITESE0175S0
      *
     C                     ENDIF
     C                     ADD  1         WURCNB
      *
     C                     ENDIF
      *
     C                     MOVE 'Y'       WNREAD
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
     C           WURCNB    IFGE 8
     C                     MOVE *ON       *IN62
     C                     EXSR SRENDS
     C                     ENDIF
     C                     ENDDO
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRENDS - Fill one page of the subfile.                       *
      *                                                               *
      *  Called By: SRROLL                                            *
      *                                                               *
      *  Calls:                                                       *
      *                                                               *
      *****************************************************************
      *
     C           SRENDS    BEGSR                           *** SRENDS ***
      *
      **  If end of file reached, seton SFLEND indicator.
     C           *IN81     IFEQ *ON
     C                     MOVE *ON       *IN03
     C                     ENDIF
      *
      **  Set the subfile record number for page display.
     C           WURCNB    IFNE 0                                                             218479
     C           SFLRCN    SUB  WURCNB    CTRECN
     C                     ADD  1         CTRECN
     C                     ENDIF                                                              218479
      *                                                                                       218479
     C           WURCNB    IFGT 8
      *
     C           *IN12     IFEQ *ON
     C           KPOS22    REDPEPOSET6                   81
     C                     ENDIF
     C           *IN13     IFEQ *ON
     C           KPOS23    REDPEPOSET6                   81
     C                     ENDIF
     C           *IN14     IFEQ *ON
     C           KPOS24    REDPEPOSET6                   81
     C                     ENDIF
     C           *IN15     IFEQ *ON
     C           KPOS25    REDPEPOSET6                   81
     C                     ENDIF
     C           *IN16     IFEQ *ON
     C           KPOS26    REDPEPOSET6                   81
     C                     ENDIF
     C           *IN17     IFEQ *ON
     C           KPOS27    REDPEPOSET6                   81
     C                     ENDIF
     C           *IN18     IFEQ *ON
     C           KPOS28    REDPEPOSET6                   81
     C                     ENDIF
     C                     ADD  1         CTRECN
      *
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRVAL1 - Subroutine to do first validation (action input).   *
      *                                                               *
      *  Called By: PROCES                                            *
      *                                                               *
      *  Calls: - SRCHKA                                              *
      *                                                               *
      *****************************************************************
      *
     C           SRVAL1    BEGSR                           *** SRVAL1 ***
      *
     C                     READCSE0175S0                 83
      *
      **  Do while existing changed records.
     C           *IN83     DOWEQ*OFF
      *
      **  Set off SFLNXTCHG indicator.
     C                     MOVE *OFF      *IN28
     C                     MOVE *OFF      *IN38
     C                     MOVE *OFF      *IN07
      *
      **  Set off selection field error indicator.
      *
      **  If selection field is blank, read next changed record.
     C           SFACTN    IFNE *BLANKS
      *
      **  Check action codes input in subfile.
     C           *LIKE     DEFN SFACTN    WUACTN
     C                     MOVE SFACTN    WUACTN
     C                     MOVE *ON       *IN60            Process error message
     C                     EXSR SRCHKA
      *
      **  If any error on record selection.
     C           *IN99     IFEQ *ON
     C                     MOVE *IN99     WUIN99
      *
     C           WURCND    IFEQ 0
     C                     Z-ADDSFLRCN    WURCND
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  Update subfile record.
     C                     MOVE *ON       *IN07
     C                     UPDATSE0175S0
      *
      **  Read next changed subfile record.
     C                     READCSE0175S0                 83
      *
     C                     ENDDO
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRCHKA - Subroutine to check action codes.                   *
      *                                                               *
      *  Called By: SRVAL1                                            *
      *             SRVAL3                                            *
      *                                                               *
      *  Calls: - ZASNMS                                              *
      *                                                               *
      *****************************************************************
      *
     C           SRCHKA    BEGSR                           *** SRCHKA ***
      *
      **  Initialize general error indicator.
     C                     MOVE *OFF      *IN99
      *
      **  Initialize array used to store error message identifiers so that
      **  they will appear only once.
     C                     MOVE *BLANKS   ERR
     C                     Z-ADD0         E       20
      *
     C           *IN99     IFEQ *OFF
      *
      **  If action code not valid.
     C           WUACTN    LOKUPCODE                     77
     C           *IN77     IFEQ *OFF
      *
     C           *IN60     IFEQ *ON
     C                     MOVE 'SE08019' ZAMSID
     C           *IN70     IFEQ *ON
     C                     MOVE 'SE08018' ZAMSID
      *
     C                     ENDIF
     C           ZAMSID    LOKUPERR                      77
     C           *IN77     IFEQ *OFF
     C                     ADD  1         E
     C                     MOVE ZAMSID    ERR,E
     C                     EXSR ZASNMS
      *
     C                     ENDIF
     C                     MOVE *ON       *IN28
     C                     MOVE *ON       *IN38
      *
     C                     ENDIF
     C                     MOVE *ON       *IN99
      *
     C                     ENDIF
      *
      **  If user not authorised to action code.
     C           WUACTN    LOKUPAUTH                     77
     C           *IN77     IFEQ *OFF
      *
     C           *IN60     IFEQ *ON
     C                     MOVE 'SE08020' ZAMSID
     C           ZAMSID    LOKUPERR                      77
     C           *IN77     IFEQ *OFF
     C                     ADD  1         E
     C                     MOVE ZAMSID    ERR,E
     C                     EXSR ZASNMS
      *
     C                     ENDIF
     C                     MOVE *ON       *IN28
     C                     MOVE *ON       *IN38
      *
     C                     ENDIF
     C                     MOVE *ON       *IN99
      *
     C                     ENDIF
      *
      **  If non-enquiry action on deleted record.
     C           HDRECI    IFEQ '*'
     C           WUACTN    ANDNE'E'
      *
     C                     MOVE 'SE08021' ZAMSID
     C           ZAMSID    LOKUPERR                      77
     C           *IN77     IFEQ *OFF
     C                     ADD  1         E
     C                     MOVE ZAMSID    ERR,E
     C                     EXSR ZASNMS
      *
     C                     ENDIF
     C                     MOVE *ON       *IN28
     C                     MOVE *ON       *IN38
      *
     C                     MOVE *ON       *IN99
      *
     C                     ENDIF
      *
      **  If non-enquiry/non-reversed action on matured record.
     C           HDRECI    IFEQ 'M'
     C           WUACTN    ANDNE'E'
     C           *IN70     ANDEQ*OFF
      *
     C           HDRECI    OREQ 'M'
     C           WUACTN    ANDNE'E'
     C           WUACTN    ANDNE'R'
     C           *IN70     ANDEQ*ON
      *
     C                     MOVE 'SE08022' ZAMSID
     C           *IN70     IFEQ *ON
     C                     MOVE 'SE08023' ZAMSID
      *
     C                     ENDIF
     C           ZAMSID    LOKUPERR                      77
     C           *IN77     IFEQ *OFF
     C                     ADD  1         E
     C                     MOVE ZAMSID    ERR,E
     C                     EXSR ZASNMS
      *
     C                     ENDIF
     C                     MOVE *ON       *IN28
     C                     MOVE *ON       *IN38
     C                     MOVE *ON       *IN99
      *
     C           WINKF     IFEQ 'Y'
     C           *IN99     ANDEQ*ON
     C                     EXSR SRWNDC
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  If non-enquiry action on reversed record.
     C           HDRECI    IFEQ 'R'
     C           WUACTN    ANDNE'E'
     C           *IN70     ANDEQ*ON
      *
     C                     MOVE 'SE08024' ZAMSID
     C           ZAMSID    LOKUPERR                      77
     C           *IN77     IFEQ *OFF
     C                     ADD  1         E
     C                     MOVE ZAMSID    ERR,E
     C                     EXSR ZASNMS
      *
     C                     ENDIF
     C                     MOVE *ON       *IN28
     C                     MOVE *ON       *IN38
     C                     MOVE *ON       *IN99
      *
     C           WINKF     IFEQ 'Y'
     C           *IN99     ANDEQ*ON
     C                     EXSR SRWNDC
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  If Reverse action on non-matured record.
     C           WUACTN    IFEQ 'R'
     C           HDRECI    ANDNE'M'
      *
     C                     MOVE 'SE08025' ZAMSID
     C           ZAMSID    LOKUPERR                      77
     C           *IN77     IFEQ *OFF
     C                     ADD  1         E
     C                     MOVE ZAMSID    ERR,E
     C                     EXSR ZASNMS
     C                     ENDIF
      *
     C                     MOVE *ON       *IN28
     C                     MOVE *ON       *IN38
     C                     MOVE *ON       *IN99
      *
     C           WINKF     IFEQ 'Y'
     C           *IN99     ANDEQ*ON
     C                     EXSR SRWNDC
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  If Delete or authorize action on non-matured record.
     C           WUACTN    IFEQ 'D'
     C           SFAUI     ANDEQ'Y'
     C           WUACTN    OREQ 'Y'
     C           SFAUI     ANDEQ'Y'
     C           WUACTN    IFEQ 'Y'
     C                     MOVE 'SE08026' ZAMSID
     C                     ELSE
     C                     MOVE 'SE08047' ZAMSID
     C                     ENDIF
      *
     C           ZAMSID    LOKUPERR                      77
     C           *IN77     IFEQ *OFF
     C                     ADD  1         E
     C                     MOVE ZAMSID    ERR,E
     C                     EXSR ZASNMS
     C                     ENDIF
      *
     C                     MOVE *ON       *IN28
     C                     MOVE *ON       *IN38
     C                     MOVE *ON       *IN99
      *
     C           WINKF     IFEQ 'Y'
     C           *IN99     ANDEQ*ON
     C                     EXSR SRWNDC
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *                                                                                       CSD015
     C           W1EWLC    IFEQ 'Y'                                                           CSD015
     C           SFACTN    ANDEQ'Y'                                                           CSD015
      *                                                                                       CSD015
     C           CSC011    IFEQ 'N'                                                           CSD015
     C           CSC011    OREQ 'Y'                                                           CSD015
     C           S1MAIN    ANDEQLIBR                                                          CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   RSLT   30                                           CSD015
     C                     MOVE SFPCPY    PCPYA   6                                           CSD015
     C                     MOVE PDUD      SPDUD   5                                           CSD015
      *                                                                                       CSD015
     C           SBRCA     CAT  SSESH:0   RSLTMP 13                                           CSD015
     C           RSLTMP    CAT  PCPYA     RSLT                                                CSD015
     C           RSLT      CAT  SPDUD:0   RSLT                                                CSD015
     C           RSLT      CAT  SFPEVT:0  RSLT                                                CSD015
     C                     MOVELRSLT      W4IDEN                                              CSD015
     C                     MOVEL'POSETD'  W4FUNT                                              CSD015
     C                     MOVELSBRCA     W4BRCH                                              CSD015
      *                                                                                       CSD015
     C           CMPKEY    CHAINSDCWHTL1             75                                       CSD015
      *                                                                                       CSD015
     C           *IN75     IFEQ '0'                                                           CSD015
     C           W3TREL    ANDNE'Y'                                                           CSD015
     C                     MOVE 'SE10039' ZAMSID                                              CSD015
     C           ZAMSID    LOKUPERR                      77                                   CSD015
     C           *IN77     IFEQ *OFF                                                          CSD015
     C                     ADD  1         E                                                   CSD015
     C                     MOVE ZAMSID    ERR,E                                               CSD015
     C                     EXSR ZASNMS                                                        CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVE *ON       *IN28                                               CSD015
     C                     MOVE *ON       *IN38                                               CSD015
     C                     MOVE *ON       *IN99                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRVAL2 - Subroutine to process Enquiry actions required.     *
      *                                                               *
      *  Called By: PROCES                                            *
      *                                                               *
      *  Calls: - DETREC                                              *
      *         - ZASNMS                                              *
      *                                                               *
      *****************************************************************
      *
     C           SRVAL2    BEGSR                           *** SRVAL2 ***
      *
      **  Initialize work fields used to manage keys pressed on window
      **  controller and SE1817 programs.
     C           *LIKE     DEFN *INKL     WUINKL
     C                     MOVE *OFF      WUINKL
     C           *LIKE     DEFN *INKE     WUINKE
     C                     MOVE *OFF      WUINKE
     C                     MOVE 'Y'       WDISP
     C                     MOVE 'N'       WNOUPD  1
      *
     C                     READCSE0175S0                 83
      *
      **  Do while existing changed records.
     C           *IN83     DOWEQ*OFF
      *
      **  Set off selection field error indicator.
     C                     MOVE *OFF      *IN28
     C                     MOVE *OFF      *IN38
      *
      **  Set off SFLNXTCHG indicator.
     C                     MOVE *OFF      *IN07
     C                     MOVE *OFF      *IN50
      *
      **  If key <CA12> pressed on previous enquiry,
      **  don't process next record selections and return
      **  to subfile display without loosing previous selections.
     C           WUINKL    IFEQ *ON
     C                     MOVE *ON       *IN38
     C                     MOVE *ON       *IN07
     C                     MOVE *ON       *IN50
     C                     UPDATSE0175S0
     C                     ENDIF
      *
      **  If key <CF05> pressed on Position Settlement extended display,
      **  return to subfile display, without keeping next record selections.
     C           WUINKE    IFEQ *ON
     C                     MOVE *BLANK    SFACTN
     C                     UPDATSE0175S0
     C                     ENDIF
      *
      **  If position settlement authorization ('Y'), reverse ('R' and S01496)
      **  or deletion ('D').
     C           *IN50     IFEQ *OFF
      *
     C           SFACTN    IFEQ 'Y'
     C           SFACTN    OREQ 'R'
     C           *IN70     ANDEQ*ON
     C           SFACTN    OREQ 'D'
      *
     C           WURCND    IFEQ 0
     C                     Z-ADDSFLRCN    WURCND
      *
     C                     ENDIF
     C                     MOVE 'Y'       WUSTOC  1
     C                     MOVE *ON       *IN07
     C                     EXSR SRWIND
     C           *IN82     IFEQ *ON
     C                     MOVE *ON       *IN28
     C                     MOVE *ON       *IN38
     C                     MOVE *ON       *IN07
     C                     MOVE 'SE08048' ZAMSID
     C                     EXSR ZASNMS
     C                     EXSR SRSUBF
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  If position settlement enquiry required.
     C           SFACTN    IFEQ 'E'
     C                     EXSR SRDETL
      *
      **  If Position Settlement has already been updated by
      **  another workstation.
     C           *IN28     IFEQ *ON
     C           WUIN99    ANDEQ*OFF
     C                     Z-ADDSFLRCN    WURCND
     C                     MOVE 'SE08018' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE *ON       WUIN99
     C                     ENDIF
      *
      **  If key <CA03> pressed on SE0175F2 display or on Position
      **  Settlement extended display (SE1817), exit program.
     C           *INKC     IFEQ *ON
     C                     MOVE 'Y'       WUEXIT
     C                     RETRN
     C                     ENDIF
      *
      **  If key <CF05> pressed on Position Settlement extended display,
      **  return to subfile display, without keeping next record selections.
     C           WUINKE    IFEQ *ON
     C                     Z-ADDSFLRCN    WURCND
     C                     ENDIF
      *
      **  If key <CA12> pressed on SE0175F2 display, return to subfile
      **  selection without loosing selected Position settlements
      **  still to be processed.
     C           WUINKL    IFEQ *ON
     C                     Z-ADDSFLRCN    WURCND
      *
     C                     ENDIF
     C                     MOVE *BLANK    SFACTN
      *
     C                     ENDIF
      *
      **  Update subfile record.
     C           WNOUPD    IFNE 'Y'
     C                     UPDATSE0175S0
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  Read next changed subfile record.
     C                     READCSE0175S0                 83
      *
     C                     ENDDO
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  DETREC - Subroutine to process SE0175F2 display.             *
      *                                                               *
      *  Called By: SRVAL2                                            *
      *                                                               *
      *  Calls: - SFMENQ                                              *
      *         - SRWDOW                                              *
      *                                                               *
      *****************************************************************
      *
     C           SRDETL    BEGSR                           *** SRDETL ***
      *
     C           WDISP     DOWEQ'Y'
     C           *INKL     ANDEQ*OFF
      *
     C                     MOVE *OFF      *IN41
     C                     MOVE 'N'       WUINKX  1
      *
      *
      **  Define Key lists for access to Position Settlement record.
     C           *LIKE     DEFN PTFR      KPTFR
     C           *LIKE     DEFN TNLU      KTNLU
     C           *LIKE     DEFN TXBS      KTXBS
     C           *LIKE     DEFN BNFO      KBNFD
     C           *LIKE     DEFN EXCD      KEXCD
     C           KPOSET    KLIST
     C                     KFLD           KPBCA
     C                     KFLD           KPSSH
     C                     KFLD           KPCPY
     C                     KFLD           KPDUD
     C                     KFLD           KPEVT
     C                     KFLD           KPTFR
     C**********           KFLD           KTNLU                                             BUG12729
     C                     KFLD           KTXBS
     C                     KFLD           KBNFO
     C                     KFLD           KEXCD
     C                     KFLD           KTNLU                                             BUG12729
     C                     MOVE CTPBCA    KPBCA
     C                     MOVE CTPSSH    KPSSH
     C                     MOVE SFPCPY    KPCPY
     C                     MOVE HDPDUD    KPDUD
     C                     MOVE SFPEVT    KPEVT
     C                     MOVE SFPTFR    KPTFR
     C                     MOVE HDTNLU    KTNLU
     C                     MOVE HDTXBS    KTXBS
     C                     MOVE HDBNFO    KBNFO
     C                     MOVE HDEXCD    KEXCD
      *
      *
      **  Access to Position Settlement.
     C           KPOSET    CHAINPOSET6               82
      *
      **  If Position Settlement has already been updated by
      **  another workstation.
     C           *IN82     IFEQ *ON
     C                     MOVE *ON       *IN28
     C                     MOVE *ON       *IN38
     C                     MOVE *ON       *IN07
     C                     MOVE 'SE08048' ZAMSID
     C                     EXSR ZASNMS
     C                     EXSR SRSUBF
     C                     ELSE
      *
      **  Load Enquiry record fields.
     C                     EXSR SFMENQ
      *
      **  Display Position settlement record.
     C           *IN71     IFEQ *ON
      *
     C           *IN41     IFEQ *ON
     C                     MOVELCMD,9     CMDLN2
     C                     ELSE
     C                     MOVELCMD,7     CMDLN2
     C                     ENDIF
      *
     C                     ELSE
      *
     C           *IN41     IFEQ *ON
     C                     MOVELCMD,10    CMDLN2
     C                     ELSE
     C                     MOVELCMD,8     CMDLN2
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     MOVE *BLANKS   CMDLN1
     C                     WRITESE0175F0
     C                     EXFMTSE0175F2
      *
     C                     SELEC
      *
      **  If key <F3> pressed, exit program.
     C           *INKC     WHEQ *ON
     C                     RETRN
      *
      **  If key <F12> pressed, return to subfile display.
     C           *INKL     WHEQ *ON
     C                     MOVE *INKL     WUINKL
      *
     C           SFACTN    IFNE 'E'
     C                     Z-ADDSFLRCN    WURCND
     C                     MOVE *BLANKS   SFACTN
     C                     UPDATSE0175S0
     C                     ENDIF
      *
      **  If key CF06 pressed
     C           *INKF     WHEQ *ON
     C                     EXSR SRVAL3
     C                     MOVE 'Y'       WUINKX
      *
     C                     ENDSL
      *
      **  If key <ENTER> pressed, display window if processing required.
      **  If Window processing required for Coupon or Dividend.
     C           WUINKX    IFNE 'Y'
     C           *INKL     ANDEQ*OFF
      *
     C           BGWDPR    IFEQ 'Y'
     C           PEVT      ANDEQ'CP'
     C           BGWDPR    OREQ 'Y'
     C           PEVT      ANDEQ'DV'
     C                     EXSR SRWDOW
      *
     C                     SELEC
      *
      **  If key <F3> pressed on window, exit program.
     C           *INKC     WHEQ *ON
     C                     RETRN
      *
      **  If key <F12> pressed on window, return to Position settlement
      **  detail record display.
     C           *INKL     WHEQ *ON
     C                     EXSR SRSUBC
      *
     C                     ENDSL
      *
     C                     ELSE
     C           SFACTN    IFNE 'E'
     C                     MOVE 'SE08031' ZAMSID
     C                     EXSR ZASNMS
     C                     EXSR SRWNDC
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  If feature S01401 (MT5xx) is active and either Coupon
      **  or Dividend settlement with a Portfolio Client, call
      **  SE1817 to show position settlement extension fields.
     C           *IN41     IFEQ *ON
     C                     MOVEL'E'       PACTN
     C                     MOVELDEPBCA    PPBCA
     C                     MOVELDEPSSH    PPSSH
     C                     MOVELDEPCPY    PPCPY
     C                     MOVELDEPDUD    PPDUD
     C                     MOVELDEPEVT    PPEVT
     C                     CALL 'SE1817'
     C                     PARM *BLANKS   P@CMD   2
     C                     PARM           P@ERRR  1
     C                     PARM           P@DAT2
     C                     PARM           P@RTCD  7
     C                     PARM           WWEXRC                                              CSD015
      *
      **  Determine next process, depending on the action taken by user.
     C                     SELEC
      *
     C           P@CMD     WHEQ '03'
     C                     MOVE *ON       *INKC
      *
     C           P@CMD     WHEQ '12'
     C                     MOVE *ON       *IN08
     C                     WRITESE0175F2
     C                     MOVE *OFF      *IN08
     C                     MOVE *OFF      *INKL
     C                     MOVE 'Y'       WDISP
      *
     C           P@CMD     WHEQ '05'
     C                     MOVE *ON       WUINKE
      *
     C                     ENDSL
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
     C           SFACTN    IFEQ 'E'
     C                     LEAVE
     C                     ENDIF
      *
     C                     ENDDO
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SFMENQ - Subroutine to set up fields of SE0175F2 record.     *
      *                                                               *
      *  Called By: DETREC                                            *
      *                                                               *
      *  Calls: - *PSSR                                               *
      *         - ZSEDIT                                              *
      *         - ZDATE2                                              *
      *         - SRCAMT                                              *
      *                                                               *
      *****************************************************************
      *
     C           SFMENQ    BEGSR                           *** SFMENQ ***
      *
      *
      **  Set up display record fields.
     C                     MOVE PBCA      DEPBCA           Booking Branch
     C                     MOVE PSSH      DEPSSH           Security
     C**********           MOVE CTSRPN    DESRPN           Security Repor CSE016
     C                     MOVE CTSRNM    DESRNM                          CSE016
     C                     MOVE PCPY      DEPCPY           Counterparty
     C                     MOVE WUACTN    DEACTN           Counterparty
      *
     C           CSE023    IFEQ 'Y'
     C                     MOVE SCUST     DECUST
     C                     MOVE HDTXBS    DETXBS
     C                     MOVELPCPY      DECUST
     C                     MOVE HDBNFO    DEBNFO
     C                     MOVE HDEXCD    DEEXCD
     C                     ENDIF
      *
     C           DEACTN    IFEQ 'E'
     C                     MOVE *ON       *IN71
     C                     ELSE
     C                     MOVE *OFF      *IN71
     C                     ENDIF
      *
      **  Set up of Customer shortname.
     C                     MOVE *BLANKS   DECSSN
     C                     MOVELPCPY      P@KEY1
     C******************** CALL 'AOCUSTR0'                                229342
     C                     CALL 'AOCUSTR1'                                229342
     C                     PARM *BLANKS   P@RTCD  7
     C                     PARM '*KEY'    P@OPTN  7
     C                     PARM           P@KEY1 10
     C                     PARM *BLANKS   P@KYST  7
     C******     SDCUST    PARM SDCUST    DSSDY                           229342
     C           SDCUST    PARM SDCUST    DSLDY                           229342
      *
     C           P@RTCD    IFNE *BLANKS
     C           BBCLST    ANDNE'Y'                                       229342
     C           *LOCK     IN   LDA
     C                     MOVEL'AOCUSTR0'DBFILE           ***************
     C                     MOVELP@KEY1    DBKEY            * DB ERROR 05 *
     C                     Z-ADD5         DBASE            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
      *
     C                     ENDIF
     C                     MOVE BBCSSN    DECSSN
      *
     C                     MOVELSFPDUD    DEPDUD           Due date
     C                     MOVE PEVT      DEPEVT           Event Type
     C                     MOVE PTFR      DEPTFR           Portfolio
      *
      **  Set up of Nominal Position.
     C                     MOVE PNMP      ZFLD15
     C                     Z-ADDNMDP      ZDECS
     C                     MOVE ' '       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DEPNMP
      *
     C                     MOVE PNCY      DENMCY           Nominal Currency
      *
      **  Set up of Position Settlement Record Id. narrative.
     C                     MOVEL*BLANKS   DEDELT
      *
     C                     SELEC
      *
     C           RECI      WHEQ '*'
     C                     MOVEL'DELETED' DEDELT
      *
     C           RECI      WHEQ 'M'
     C                     MOVEL'MATURED' DEDELT
      *
     C           RECI      WHEQ 'D'
     C           PAUI      ANDEQ'Y'
     C                     MOVEL'AUTHORI' DEDELT
     C                     MOVE 'SED'     DEDELT
      *
     C                     ENDSL
      *
      **  Set up of Payment/Value Date.
     C                     MOVEL*BLANKS   DEPSVL
     C           S01512    IFEQ 'Y'
     C                     Z-ADDPSVL      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZDATE     DEPSVL
      *
     C                     ENDIF
      *
     C                     MOVE PBCD      DEPBCD           Book Code
      *
      **  Set up of Profit Center.
     C                     MOVEL*BLANKS   DEPPFC
     C           BKPRCU    IFEQ 'Y'
     C                     MOVELPPFC      DEPPFC
     C                     END
      *
      **  Fetch Payment Currency decimal places, if S01509 is active.
     C           S01509    IFEQ 'Y'
     C                     CALL 'AOCURRR0'
     C                     PARM '*DBERR'  P@RTCD
     C                     PARM '*KEY   ' P@OPTN
     C                     PARM SFPNCY    P@CURR
     C           SDCURR    PARM SDCURR    DSSDY
      *
     C           P@RTCD    IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'AOCURRR0'DBFILE           ***************
     C                     MOVELSFPNCY    DBKEY            * DB ERROR 06 *
     C                     Z-ADD6         DBASE            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C           *LIKE     DEFN A6NBDP    WUPNDP
     C                     Z-ADDA6NBDP    WUPNDP
     C                     ENDIF
      *
      **  Set up of Amount Due.
     C                     MOVE *BLANKS   DEPAMD
     C           PAMD      IFNE 0
     C                     MOVE PAMD      ZFLD15
      *
     C           S01509    IFEQ 'Y'
     C                     Z-ADDWUPNDP    ZDECS
     C                     ELSE
     C                     Z-ADDWUNMDP    ZDECS
     C                     ENDIF
      *
     C                     MOVE ' '       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DEPAMD
     C                     ENDIF
      *
     C                     MOVE PPRE      DEPPRE           Pay/Receive indicator
     C                     MOVE PSCU      DEPSCU           Settlement Currency
      *
      **  Set up of Settlement Exchange Rate.
     C                     MOVE *BLANKS   DEPSXR
     C           PSXR      IFNE 0
      *
      **  Re-calculate exchange rate if Analytical Accounting Module
      **  is installed, so that what would be shown would be the rate
      **  entered.
     C           BGN0ST    IFEQ 'Y'
      *
     C           PPRE      IFEQ 'R'
     C           PMDI      ANDEQ'M'
     C           PPRE      OREQ 'P'
     C           PMDI      ANDEQ'D'
     C                     SUB  FXMR      PSXR
      *
     C                     ELSE
     C                     ADD  FXMR      PSXR
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     MOVE PSXR      ZFLD15
     C                     Z-ADD8         ZDECS
     C                     MOVE ' '       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DEPSXR
      *
     C                     ENDIF
     C                     MOVE PMDI      DEPMDI
      *
      **  Set up of Base Currency Exchange rate.
     C                     MOVE *BLANKS   DEPBRX
     C           PBRX      IFNE 0
     C                     MOVE PBRX      ZFLD15
     C                     Z-ADD8         ZDECS
     C                     MOVE ' '       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DEPBRX
     C                     ENDIF
      *
     C                     MOVE PSMT      DEPSMT           Settlement Method
     C                     MOVE PSEA      DEPSEA           Settlement Account
     C                     MOVE PSEB      DEPSEB           Settlement Branch
     C                     MOVE PCPN      DEPCPN           Counterparty Bank
     C                     MOVE PFAC      DEPFAC           For Account Of
     C                     MOVE PSPI      DEPSPI           Special Instructions
     C                     MOVE PCHC      DEPCHC           Charge Code
      *
      **  Set up of Charge Amount.
     C                     MOVE *BLANKS   DEPCHA
     C           PCHA      IFNE 0
     C                     MOVE PCHA      ZFLD15
      *
     C           S01509    IFEQ 'Y'
     C                     Z-ADDWUPNDP    ZDECS
      *
     C                     ELSE
     C                     Z-ADDWUNMDP    ZDECS
      *
     C                     ENDIF
     C                     MOVE ' '       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DEPCHA
      *
     C                     ENDIF
     C                     MOVE PCCD      DEPCCD           Commission Code
      *
      **  Set up of Commission Amount.
     C                     MOVE *BLANKS   DEPCAM
     C           PCAM      IFNE 0
     C                     MOVE PCAM      ZFLD15
      *
     C           S01509    IFEQ 'Y'
     C                     Z-ADDWUPNDP    ZDECS
     C                     ELSE
     C                     Z-ADDWUNMDP    ZDECS
     C                     ENDIF
      *
     C                     MOVE ' '       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DEPCAM
     C                     ENDIF
      *
      **  Set up of Settlement Amount.
     C                     CALL 'AOCURRR0'
     C                     PARM '*DBERR'  P@RTCD
     C                     PARM '*KEY   ' P@OPTN
     C                     PARM PSCU      P@CURR
     C           SDCURR    PARM SDCURR    DSSDY
      *
     C           P@RTCD    IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'AOCURRR0'DBFILE           ***************
     C                     MOVELPSCU      DBKEY            * DB ERROR 07 *
     C                     Z-ADD7         DBASE            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C           *LIKE     DEFN A6NBDP    WUSCDP
     C                     Z-ADDA6NBDP    WUSCDP
      *
      **  Translate FX Marge Points and Amount if Analytical
      **  Accounting Module is installed.
     C                     MOVE *BLANKS   DEFXMP
     C                     MOVE *BLANKS   DEMAMT
     C           BGN0ST    IFEQ 'Y'
      *
      **  FX Margin points and amount should not be displayed if
      **  nominal ccy = settle ccy and action code is 'E'
     C           PNCY      IFEQ PSCU
     C           SFACTN    ANDEQ'E'
     C                     MOVE *ON       *IN66
      *
     C                     ELSE
     C                     MOVE *OFF      *IN66
      *
      **  Set up FX Margin Points.
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE FXMP      ZFLD15
     C                     Z-ADD2         ZDECS
     C                     MOVE *BLANK    ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DEFXMP
      *
      **  Set up FX Margin Amount.
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE MAMT      ZFLD15
     C                     Z-ADDWUSCDP    ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DEMAMT
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  Retrieve Customer classification.
     C                     CALL 'AOSECSR0'
     C                     PARM *BLANKS   P@RTCD  7
     C                     PARM '*KEY   ' P@OPTN  7
     C                     PARM DEPCPY    P@CUST  6
     C           SDSECS    PARM SDSECS    DSSDY
      *
     C           P@RTCD    IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'AOSECSR0'DBFILE           ***************
     C                     MOVELDEPCPY    DBKEY            * DB ERROR 08 *
     C                     Z-ADD8         DBASE            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
      *
     C                     ENDIF
      *                                                                                       235466
     C                     MOVE '0'       *IN75                                               235466
     C           CGL031    IFEQ 'Y'                                                           235466
     C           SETX      ANDEQ'Y'                                                           235466
     C           BFCLAS    IFEQ 'S'                                                           235466
     C           BFCLAS    OREQ 'D'                                                           235466
     C                     MOVE '1'       *IN75                                               235466
      *                                                                                       235466
     C           TXNM      IFNE *ZERO                                                         235466
     C                     MOVE TXNM      ZFLD15                                              235466
      *                                                                                       235466
     C           S01509    IFEQ 'Y'                                                           235466
     C                     Z-ADDWUPNDP    ZDECS                                               235466
     C                     ELSE                                                               235466
     C                     Z-ADDWUNMDP    ZDECS                                               235466
     C                     ENDIF                                                              235466
      *                                                                                       235466
     C                     MOVE *BLANK    ZECODE                                              235466
     C                     EXSR ZSEDIT                                                        235466
     C                     MOVE *BLANKS   DETXNM                                              235466
     C                     MOVE ZOUT21    DETXNM                                              235466
     C                     ELSE                                                               235466
     C                     MOVE *BLANKS   DETXNM                                              235466
     C                     ENDIF                                                              235466
      *                                                                                       235466
     C                     ENDIF                                                              235466
     C                     ENDIF                                                              235466
      *                                                                                     AR871626
     C                     SETOF                     72                                     AR871626
     C           CER049    IFEQ 'Y'                                                         AR871626
     C                     SETON                     72                                     AR871626
     C                     MOVE *BLANKS   DETAXA                                            AR871626
     C                     MOVE *BLANKS   DECHAM                                            AR871626
     C                     MOVE *BLANKS   DETAXL                                            AR871626
     C                     MOVE *BLANKS   DECHCD                                            AR871626
     C                     MOVE *ZEROS    WTAXA  130                                        AR871626
     C                     MOVELPBCA      K3PBCA                                            AR871626
     C                     MOVELPSSH      K3PSSH                                            AR871626
     C                     MOVE PCPY      K3PCPY                                            AR871626
     C                     MOVE PDUD      K3PDUD                                            AR871626
     C                     MOVELPEVT      K3PEVT                                            AR871626
     C                     MOVE 99999     K3TNLU                                            AR871626
     C           KPOST3    SETGTPOSETDD3                                                    AR871626
     C                     READPPOSETDD3                 78                                 AR871626
     C           *IN78     IFEQ '0'                                                         AR871626
     C           PBCA      ANDEQP3PBCA                                                      AR871626
     C           PSSH      ANDEQP3PSSH                                                      AR871626
     C           PCPY      ANDEQP3PCPY                                                      AR871626
     C           PDUD      ANDEQP3PDUD                                                      AR871626
     C           PEVT      ANDEQP3PEVT                                                      AR871626
     C                     MOVE P3STAF    WTAXA                                             AR871626
     C                     MOVE P3STAF    ZFLD15                                            AR871626
     C                     Z-ADDA6NBDP    ZDECS                                             AR871626
     C                     MOVE *BLANK    ZECODE                                            AR871626
     C                     EXSR ZSEDIT                                                      AR871626
     C                     MOVE ZOUT21    DETAXA                                            AR871626
     C                     MOVE ZOUT21    DECHAM                                            AR871626
     C                     MOVE P3TAX     DETAXL                                            AR871626
     C           1         CHAINSDSTPTPD             78                                     AR871626
     C           *IN78     IFEQ '0'                                                         AR871626
     C                     MOVE A1SECC    DECHCD                                            AR871626
     C                     ENDIF                                                            AR871626
     C                     ENDIF                                                            AR871626
     C                     ENDIF                                                            AR871626
      *
     C                     MOVE *BLANKS   DEPSAT
     C           PSAT      IFNE 0
     C                     MOVE PSAT      ZFLD15
     C                     Z-ADDA6NBDP    ZDECS
     C                     MOVE *BLANK    ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DEPSAT
      *
     C                     ELSE
      *
      **  If amount is 0, it is possible that it hasn't been computed,
      **  therefore, calculate the settlement amount for S01512.
     C           S01512    IFEQ 'Y'
     C                     EXSR SRCAMT
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  Find and display tax deductible fields if S01447 installed.
     C                     MOVE *OFF      *IN67                                               197597
     C           S01447    IFEQ 'Y'                                                           197597
     C           WFREEM    OREQ 'Y'                                                           215481
     C**********           MOVE *ON       *IN67                                               197597
     C                     MOVE *BLANKS   DETASO
     C                     MOVE *BLANKS   DETASR
     C                     MOVE *BLANKS   DETAUS
     C********** S01447    IFEQ 'Y'                                                           197597
      *
     C           PEVT      IFEQ 'CP'
     C           PEVT      OREQ 'DV'
      *
      **  Access Security Withholding Tax Details file.
     C           CTPSSH    CHAINSESWHTL0             84
     C           *IN84     IFEQ *OFF
     C           WFREEM    OREQ 'Y'                                                           215481
     C**********           MOVE *OFF      *IN67                                               197597
     C                     MOVE *ON       *IN67                                               197597
      *
     C                     ENDIF
      *
      **  Set up of Tax deductible at source.
     C                     MOVE TASO      ZFLD15
      *
      **  If S01509 is active, use the decimal places from position ccy.
     C           S01509    IFEQ 'Y'
     C                     Z-ADDWUPNDP    ZDECS
     C                     ELSE
     C                     Z-ADDWUNMDP    ZDECS
     C                     ENDIF
      *
     C                     MOVE ' '       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DETASO
      *
      **  Set up of Tax deductible at source ref.
     C                     MOVE TASR      ZFLD15
      *
      **  If S01509 is active, use the decimal places from position ccy.
     C           S01509    IFEQ 'Y'
     C                     Z-ADDWUPNDP    ZDECS
      *
     C                     ELSE
     C                     Z-ADDWUNMDP    ZDECS
      *
     C                     ENDIF
     C                     MOVE ' '       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DETASR
      *
      **  Set up of Tax deductible by user.
     C                     MOVE TAUS      ZFLD15
      *
      **  If S01509 is active, use the decimal places from position ccy.
     C           S01509    IFEQ 'Y'
     C                     Z-ADDWUPNDP    ZDECS
     C                     ELSE
     C                     Z-ADDWUNMDP    ZDECS
     C                     ENDIF
     C                     MOVE ' '       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DETAUS
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  If S01401 is active, check if record has other details
     C           S01401    IFEQ 'Y'
      *
     C           DEPEVT    IFEQ 'CP'
     C           DEPEVT    OREQ 'DV'
      *
     C           BFCLAS    IFEQ 'S'
     C           BFCLAS    OREQ 'D'
      *
     C           *LIKE     DEFN POPBCA    KXBRC
     C           *LIKE     DEFN POPSSH    KXSSH
     C           *LIKE     DEFN POPCPY    KXCPY
     C           KPOSX     KLIST
     C                     KFLD           KXBRC
     C                     KFLD           KXSSH
     C                     KFLD           KXCPY
     C                     MOVE SBRCA     KXBRC
     C                     MOVE SSESH     KXSSH
     C                     MOVE PCPY      KXCPY
      *
     C           KPOSX     CHAINPOSETDY1             55
     C           *IN55     IFEQ *OFF
     C                     MOVE *ON       *IN41
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRVAL3 - Subroutine to process Update actions required.      *
      *                                                               *
      *  Called By: PROCES                                            *
      *                                                               *
      *  Calls: - SRCHKA                                              *
      *         - SRUPDF                                              *
      *                                                               *
      *****************************************************************
      *
     C           SRVAL3    BEGSR                           *** SRVAL3 ***
      *
      **  Initialize "records already updated" work field.
     C                     MOVE 'N'       WURALU  1
      *
      **  Set up action code used in Files updates subroutine.
     C           WINKF     IFEQ 'Y'
     C                     MOVE SNACTN    WUACTN
     C                     Z-ADD1         SFLRCN
     C                     ELSE
     C                     MOVE SFACTN    WUACTN
     C                     ENDIF
      *
     C           SFLRCN    CHAINSE0175S0             83
      *
      **  Do while existing changed records.
     C                     Z-ADDSFLRCN    WURCND
     C                     MOVE *BLANKS   SFACTN
      *
     C           *IN83     DOWEQ*OFF
     C           *INKF     ANDEQ*ON
      *
     C           *IN83     OREQ *OFF
     C           WINKF     ANDEQ'Y'
      *
      **  Check action code, if one to apply to every lines.
     C           *IN60     IFEQ *OFF
     C                     EXSR SRCHKA
      *
     C           *IN99     IFEQ *ON
     C                     EXSR SRNEXT
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  Before processing any action (authorisation, reverse or deletion),
      **  verify that the record hasn't been updated by another workstation.
     C                     MOVE CTPBCA    KPBCA
     C                     MOVE CTPSSH    KPSSH
     C**********           Z-ADDSFPCPY    KPCPY                                               CSD027
     C                     MOVE SFPCPY    KPCPY                                               CSD027
     C                     Z-ADDHDPDUD    KPDUD
     C                     MOVE SFPEVT    KPEVT
     C                     MOVE SFPTFR    KPTFR
     C                     Z-ADDHDTNLU    KTNLU
     C                     MOVE HDTXBS    KTXBS                                               218479
      *
     C           KPOSET    CHAINPOSET6               82
      *
      **  If Position Settlement has already been updated by
      **  another workstation.
     C           *IN82     IFEQ *ON
     C                     EXSR SRNEXT
      *
     C                     ELSE
      *
      **  Process Files updates.
     C                     EXSR SRUPDF
      *
     C                     ENDIF
      *
     C                     ENDDO
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRNEXT - Subroutine to read next subfile record.             *
      *                                                               *
      *  Called By: SRVAL3                                            *
      *                                                               *
      *  Calls:                                                       *
      *                                                               *
      *****************************************************************
      *
      **  Read next subfile record.
     C           SRNEXT    BEGSR                           *** SRNEXT ***
      *
     C                     UPDATSE0175S0
      *
     C           WINKF     IFEQ 'Y'
     C           *IN99     ANDEQ*OFF
     C                     ADD  1         SFLRCN
     C           SFLRCN    CHAINSE0175S0             83
     C                     ELSE
     C                     READCSE0175S0                 83
      *
     C           *IN83     IFEQ *OFF
     C                     MOVE *OFF      *INKF
     C                     MOVE 'Y'       WDISP   1
     C                     ELSE
     C                     MOVE 'N'       WDISP
     C                     ENDIF
      *
     C                     ENDIF
      *
      *
     C                     ENDSR
      *****************************************************************
      *                                                               *
      *  SRUPDF - Subroutine to update Position settlements.          *
      *                                                               *
      *  Called By: SRVAL3                                            *
      *                                                               *
      *  Calls: - ZTNLU1                                              *
      *         - *PSSR                                               *
      *                                                               *
      *****************************************************************
      *
     C           SRUPDF    BEGSR                           *** SRUPDF ***
      *
      **  If authorisation or deletion processing required.
     C           WUACTN    IFEQ 'Y'
     C           WUACTN    OREQ 'D'
      *
      **  Record before status.
     C                     MOVELPOSREC    Z#BSTS
     C                     ENDIF
      *
      **  If authorisation processing required.
     C           WUACTN    IFEQ 'Y'
     C                     MOVE 'Y'       PAUI             Authorised indicator
     C                     MOVE 'Y'       PSMI             Message indicator
     C                     MOVE 'Y'       CHTP             Type of last change
     C                     ENDIF
      *
      **  If reversal processing required.
     C           WUACTN    IFEQ 'R'
     C                     MOVE 'R'       RECI             Record identifier
     C                     MOVE 'R'       CHTP             Type of last change
     C                     ENDIF
      *
      **  If deletion processing required.
     C           WUACTN    IFEQ 'D'
     C                     MOVE '*'       RECI             Record identifier
     C                     MOVE 'Y'       PSMI             Message indicator
     C                     MOVE 'D'       CHTP             Type of last change
     C                     ENDIF
      *
     C                     MOVE 'S'       PMAR             Market
     C                     Z-ADDAGRDNB    LCD              Last change date
     C                     Z-ADDTNLU      WTNL1   50                                          CRE020
     C                     EXSR ZTNLU1
     C                     Z-ADDNATN      TNLU             Trans. number last up
      *
      **  Update Position Settlement record.
     C                     UPDATPOSET6DF
      *
      **  If authorisation or deletion processing required.
     C           WUACTN    IFEQ 'Y'
     C           WUACTN    OREQ 'D'
      *
      **  Record after status.
     C                     MOVELPOSREC    Z#ASTS
      *
      **  Do online updates by calling access object AOOUPSU0
     C                     CALL 'AOOUPSU0'
     C                     PARM           P@RTCD
     C                     PARM           Z#BSTS
     C                     PARM           Z#ASTS
      *
     C           P@RTCD    IFEQ '*ERROR*'
     C           *LOCK     IN   LDA
     C                     MOVEL'AOOUPSU0'DBFILE           ***************
     C                     MOVELWUPOSK    DBKEY            * DB ERROR 09 *
     C                     Z-ADD09        DBASE            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
      *
     C                     ENDIF
      *
     C                     ENDIF
      *                                                                                       CRE020
      ** Update Original TNLU on Trailer file                                                 CRE020
      *                                                                                       CRE020
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C           WSV01     ANDEQ'Y'                                                           CRE020
     C                     EXSR SRTNLU                                                        CRE020
      *                                                                                       CRE020
      ** After projection, handle the advice index of this transaction if                     CRE020
      ** CRE020 is enabled.                                                                   CRE020
      *                                                                                       CRE020
     C           WUACTN    IFEQ 'Y'                                                           CRE020
     C           WUACTN    OREQ 'D'                                                           CRE020
     C                     EXSR SRIDXT                                                        CRE020
     C                     ENDIF                                                              CRE020
     C                     ENDIF                                                              CRE020
      *
      **  Get Audit record.
     C           1         CHAINPOSETA               84
      *
     C           *IN84     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     MOVEL'POSETA  'DBFILE           ***************
     C                     MOVELWUPOSK    DBKEY            * DB ERROR 10 *
     C                     Z-ADD10        DBASE            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      **  In case of Authorisation.
     C           WUACTN    IFEQ 'Y'
     C                     ADD  1         NOAM             N of accounts amended
     C                     ENDIF
      *
      **  In case of Deletion.
     C           WUACTN    IFEQ 'D'
     C                     ADD  1         NODE             N of deletions.
     C                     SUB  1         NORE             N of records on file
     C                     ENDIF
      *
      **  Update Position Settlement Audit record.
     C                     UPDATPOSETAF
      *
      **  Set up time for comit text.
     C                     TIME           WUTIME
     C                     MOVELPOSREC    WUPOSR
      *
      **  C  O  M  I  T.
     C           CMTTXT    COMIT
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRCAMT - Calculate new Settlement Amount.                    *
      *                                                               *
      *  Called By: SFMENQ                                            *
      *                                                               *
      *  Calls: - *PSSR                                               *
      *         - ZSEDIT                                              *
      *                                                               *
      *****************************************************************
      *
     C           SRCAMT    BEGSR                           *** SRCAMT ***
      *
      ** Set up parameters for call to SEZ010.
     C                     MOVELBFCLAS    P@CLAS
     C                     MOVELPPRE      P@PPRE
     C                     Z-ADDPAMD      P@PAMD
     C                     Z-ADDPCHA      P@PCHA
     C                     Z-ADDPCAM      P@PCAM
     C                     Z-ADDTASO      P@TASO
     C                     Z-ADDTAUS      P@TAUS
     C                     Z-ADDPSXR      P@PSXR
     C                     MOVELPMDI      P@PMDI
     C                     MOVELPNCY      P@PNCY
     C                     MOVELPSCU      P@PSCU
     C                     MOVELWTAXA     P@STAM                                            AR871626
      *                                                                                       235466
     C           *IN75     IFEQ '1'                                                           235466
     C                     ADD  TXNM      P@TASO                                              235466
     C                     ENDIF                                                              235466
      *
     C           BGN0ST    IFEQ 'Y'
     C                     Z-ADDFXMR      P@FXMR
      *
     C           PPRE      IFEQ 'R'
     C                     MOVE 'TS'      P@TDTP
     C                     ELSE
     C                     MOVE 'TP'      P@TDTP
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  Call SEZ010 to calculate the settlement amount.
     C                     CALL 'SEZ010'
     C                     PARM *BLANKS   P@RCDE  7
     C                     PARM           P@DAT1
      *
     C           P@RCDE    IFEQ *BLANKS
     C                     Z-ADDP@PSAT    PSAT
     C                     ELSE
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     Z-ADDWUSCDP    ZDECS
     C                     MOVE P@PSAT    ZFLD15
     C                     MOVE ' '       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVEL*BLANKS   DEPSAT
     C                     MOVE ZOUT21    DEPSAT
      *
      **  Convert marge amount to screen format if Analytical
      **  Accounting Module is installed.
     C           BGN0ST    IFEQ 'Y'
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE MAMT      ZFLD15
     C                     Z-ADDWUSCDP    ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE *BLANKS   DEMAMT
     C                     MOVE ZOUT21    DEMAMT
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRWDOW - Subroutine used to call window processing program   *
      *                                                               *
      * Called by: DETREC                                             *
      *                                                               *
      * Calls: - *PSSR                                                *
      *                                                               *
      *****************************************************************
      *
     C           SRWDOW    BEGSR                           *** SRWDOW ***
      *
      **  Set up parameter fields to pass to window controller program.
     C                     MOVE DEPBCA    #1PBCA
     C                     MOVE DEPSSH    #1PSSH
     C                     MOVE DEPCPY    #1PCPY
     C                     MOVE DEPDUD    #1PDUD
     C                     MOVE DEPEVT    #1PEVT
     C                     MOVE DEPTFR    #1PTFR
      *
      **  If Portfolio Management is present.
     C           BGPFMG    IFEQ 'Y'
      *
     C           DEPTFR    IFEQ FCR997
      *
     C           BGN4ST    IFEQ 'N'
     C                     MOVE '9997'    #1PTFR
     C                     ENDIF
      *
     C                     ELSE
     C                     MOVE DEPTFR    #1PTFR
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     MOVE HDTNLU    #1TNLU
     C                     MOVE BFCLAS    #1CLAS
      *
      **  If feature S01509 is active.
     C           S01509    IFEQ 'Y'
     C                     MOVE DEPNCY    #1CCY
     C                     ELSE
     C                     MOVE NMCY      #1CCY
     C                     ENDIF
      *
     C                     MOVE PCHA      #1PCHA
     C                     MOVE PCAM      #1PCAM
     C                     Z-ADD0         #1VTCH
     C                     Z-ADD0         #1VTCO
     C                     Z-ADD0         #1TNLN
      *
      **  Call Window processing program.
     C                     CALL 'WN0010'
     C                     PARM ##PGM     P@PROG 10
     C                     PARM *BLANKS   P@KEY   2
     C                     PARM SFACTN    P@ACTN  1
     C                     PARM           DATA
     C                     PARM *BLANKS   P@RTCD  7
     C                     PARM *BLANKS   P@SPAR256
      *
      **  Process returned command keys.
     C                     SELEC
      *
      **  When key <F3> pressed on window.
     C           P@RTCD    WHEQ 'Y2U9999'
     C                     MOVE *ON       *INKC
      *
      **  When key <F12> pressed on window.
     C           P@RTCD    WHEQ 'USR0790'
     C                     MOVE *ON       *INKL
      *
      **  When Database error occurred.
     C           P@RTCD    WHEQ 'Y2U0004'
     C           *LOCK     IN   LDA
     C                     MOVEL'WN0010  'DBFILE           ***************
     C                     MOVELDATA      DBKEY            * DB ERROR 11 *
     C                     Z-ADD11        DBASE            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
      *
     C                     ENDSL
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRWNDC - Subroutine used to call confirmation window.        *
      *                                                               *
      * Called by: SRWIND                                             *
      *                                                               *
      * Calls:                                                        *
      *                                                               *
      *****************************************************************
     C           SRWNDC    BEGSR                           *** SRWNDC ***
      *
     C                     EXSR SRWIND
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRSUBC - Subroutine used to call subfile display.            *
      *                                                               *
      * Called by: SRSUBF                                             *
      *                                                               *
      * Calls:                                                        *
      *                                                               *
      *****************************************************************
     C           SRSUBC    BEGSR                           *** SRSUBC ***
      *
     C                     EXSR SRSUBF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRSCRN - Subroutine used to call initial screen display.     *
      *                                                               *
      * Called by: SRSHOW                                             *
      *                                                               *
      * Calls:                                                        *
      *                                                               *
      *****************************************************************
     C           SRSCRN    BEGSR                           *** SRSCRN ***
      *
     C                     EXSR SRSHOW
      *
     C                     ENDSR
      *****************************************************************                       CRE020
      /EJECT                                                                                  CRE020
      *****************************************************************                       CRE020
      *                                                               *                       CRE020
      *  SRTNLU - Store original TNLU field on extension file         *                       CRE020
      *                                                               *                       CRE020
      *****************************************************************                       CRE020
     C           SRTNLU    BEGSR                                                              CRE020
      *                                                                                       CRE020
      ** If Insert, keep record keys and original TNLU on file                                CRE020
      *                                                                                       CRE020
     C                     MOVELPBCA      K3PBCA                                              CRE020
     C                     MOVELPSSH      K3PSSH                                              CRE020
     C                     MOVE PCPY      K3PCPY                                              CRE020
     C                     MOVE PDUD      K3PDUD                                              CRE020
     C                     MOVELPEVT      K3PEVT                                              CRE020
     C                     MOVE WTNL1     K3TNLU                                              CRE020
      *                                                                                       CRE020
     C           KPOST3    CHAINPOSETDD3             78                                       CRE020
     C           *IN78     IFEQ '0'                                                           CRE020
     C                     MOVE TNLU      P3TNLU                                              CRE020
     C                     UPDATPOSETDD3                                                      CRE020
     C                     ELSE                                                               CRE020
     C                     MOVE WTNL1     P3OTNL                                              CRE020
     C                     MOVE TNLU      P3TNLU                                              CRE020
     C                     WRITEPOSETDD3                                                      CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     MOVELP3OTNL    KNARR                                               CRE020
      *                                                                                       CRE020
     C                     ENDSR                                                              CRE020
      *****************************************************************                       CRE020
      /EJECT                                                                                  CRE020
      *****************************************************************                       CRE020
      *                                                               *                       CRE020
      *  SRIDXT - Handles the advice index of the current             *                       CRE020
      *           transaction.                                        *                       CRE020
      *                                                               *                       CRE020
      *****************************************************************                       CRE020
     C           SRIDXT    BEGSR                                                              CRE020
      *                                                                                       CRE020
      ** Only process authorised transactions.                                                CRE020
      *                                                                                       CRE020
     C           PAUI      IFEQ 'Y'                                                           CRE020
      *                                                                                       CRE020
     C                     MOVE *BLANKS   WREFNO                                              CRE020
     C                     MOVE PSSH      WSSH                                                CRE020
     C                     MOVE PCPY      WCPY                                                CRE020
     C                     MOVE PBCA      WBCA                                                CRE020
     C                     MOVE PDUD      WDUD                                                CRE020
     C                     MOVE PEVT      WEVT                                                CRE020
      *                                                                                       CRE020
     C                     MOVE *BLANKS   KREFNO                                              CRE020
     C                     MOVELWREFNO    KREFNO                                              CRE020
      *                                                                                       CRE020
     C           KADVC     CHAINREADVCL3             69                                       CRE020
      *                                                                                       CRE020
     C           *IN69     IFEQ *ON                                                           CRE020
     C                     MOVE *BLANKS   RREFNO                                              CRE020
     C                     MOVELWREFNO    RREFNO                                              CRE020
     C                     MOVE *BLANKS   RPRGMN                                              CRE020
     C                     MOVEL'SE0170'  RPRGMN                                              CRE020
     C                     MOVE *BLANKS   RSEQNO                                              CRE020
     C                     MOVE PEVT      RTRTYP                                              CRE020
      *                                                                                       CRE020
     C           CHTP      IFEQ 'Y'                                                           CRE020
     C                     MOVEL'I'       RCHTYP                                              CRE020
     C                     ELSE                                                               CRE020
     C                     MOVE CHTP      RCHTYP                                              CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     MOVE 'Y'       RAUTHI                                              CRE020
     C                     MOVE 'N'       RSAPIN                                              CRE020
     C                     MOVELP3OTNL    RENARR                                              CRE020
     C                     WRITEREADVCD0                                                      CRE020
      *                                                                                       CRE020
     C                     ELSE                                                               CRE020
      *                                                                                       CRE020
      ** Check first if this is a new record.                                                 CRE020
      *                                                                                       CRE020
     C           RCHTYP    IFEQ 'I'                                                           CRE020
     C           RSAPIN    ANDEQ'N'                                                           CRE020
     C           CHTP      ANDEQ'D'                                                           CRE020
     C                     MOVE 'D'       RCHTYP                                              CRE020
     C                     MOVE 'Y'       RAUTHI                                              CRE020
     C                     MOVE 'Y'       RSAPIN                                              CRE020
     C                     UPDATREADVCD0                                                      CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C           CHTP      IFEQ 'Y'                                                           CRE020
     C                     MOVEL'I'       RCHTYP                                              CRE020
     C                     ELSE                                                               CRE020
     C                     MOVE CHTP      RCHTYP                                              CRE020
     C                     ENDIF                                                              CRE020
     C                     MOVE 'Y'       RAUTHI                                              CRE020
     C                     MOVE 'N'       RSAPIN                                              CRE020
     C                     UPDATREADVCD0                                                      CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C           EIDXT     ENDSR                                                              CRE020
      *****************************************************************                       CRE020
      /EJECT
      *****************************************************************
      *                                                               *
      *  *PSSR  - Program exception error routine                     *
      *           Called automatically if a program error occurs,     *
      *           or directly by the program code using EXSR.         *
      *           This subroutine DUMPs the program just once.        *
      *                                                               *
      *  Called by: SRINIT                                            *
      *             SRSETC                                            *
      *             SFMENQ                                            *
      *             SRUPDF                                            *
      *             SRCAMT                                            *
      *                                                               *
      *  Calls: None                                                  *
      *                                                               *
      *****************************************************************
      *
     C           *PSSR     BEGSR                           ** *PSSR SR **
      *
     C                     ROLBK
      *
     C           @RUN      IFEQ *BLANK
     C                     MOVE 'Y'       @RUN    1
     C                     DUMP
      *
     C                     CALL 'DBERRCTL'
      *
     C                     ENDIF
      *
     C                     MOVE *ON       *INU7
     C                     MOVE *ON       *INU8
     C                     MOVE *ON       *INLR
     C                     RETRN
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      /TITLE SR/ZASNMS
      *****************************************************************
      *                                                               *
      *  ZASNMS - Send message to program message queue.              *
      *                                                               *
      *  Called by:                                                   *
      *                                                               *
      *  Calls: None                                                  *
      *                                                               *
      *****************************************************************
      *
     C           ZASNMS    BEGSR                           *** ZASNMS ***
      *
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     ENDIF
      *
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message Id.
     C                     PARM           ZAMSGF 10        Message file.
     C                     PARM           ZAMSDA132        Message data.
     C                     PARM           ZAMSTP  7        Message type.
      *
     C           ZAEXIT    ENDSR
      *
      /EJECT
      *****************************************************************
      /TITLE SR/SRCLRM
      *****************************************************************
      *                                                               *
      *  SRCLRM - Clear program message queue.                        *
      *                                                               *
      *  Called by:                                                   *
      *                                                               *
      *  Calls: None                                                  *
      *                                                               *
      *****************************************************************
      *
     C           SRCLRM    BEGSR                           *** SRCLRM ***
      *
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
     C/COPY ZSRSRC,ZDATE1Z2
      /EJECT
     C/COPY ZSRSRC,ZDATE2Z2
      /EJECT
     C/COPY ZSRSRC,ZSEDITZ3
      /EJECT
     C/COPY ZSRSRC,ZTNLU1Z2
      /EJECT
     C/COPY ZSRSRC,ZSDESCZ3                                               CSE016
      /EJECT                                                              CSE016
      *****************************************************************
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
**  CMD : Array containing lines to be displayed with available function keys.
 F3=Exit
 F3=Exit  Enter '?' on Security for selection
 Enter E=Enquire/Y=Authorize/R=Reverse/D=Delete for Action Code
 Enter E=Enquire/Y=Authorize/D=Delete for Action Code
 F3=Exit  F5=Refresh  F6=Bulk/Auth/Rev/Del  F12=Cancel
 F3=Exit  F5=Refresh  F12=Cancel
 F3=Exit  F12=Cancel
 F3=Exit  F6=Confirm Action  F12=Cancel
 F3=Exit  F12=Cancel  Enter=Other Details
 F3=Exit  F6=Confirm Action  F12=Cancel  Enter=Other Details
**  ACTN : Array which contains all action codes processed by this program.
ERYD
**  STAT : Array which contains all status codes allowed for selection.
 LADRM
**  ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**  ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**  ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
