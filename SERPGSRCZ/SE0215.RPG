     H        1
     F*****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Customer portfolio valuation enquiry')        *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Securities Trading Module                            *
     F*                                                               *
     F*  SE0215 - CUSTOMER PORTFOLIO VALUATION ENQUIRY                *
     F*                                                               *
     F*  Function:  This program displays the current Position for    *
     F*   (I/C)     each Security for the requested Client on a Trade *
     F*             or Value date basis, decided by the bank on ICD.  *
     F*             Both the Book Price and the Current Market Price  *
     F*             are shown, with the Book and Market Value in the  *
     F*             Security Currency and the Portfolio Currency of   *
     F*             the Customer. In a Multi-branch environment, the  *
     F*             User may also enter a Branch.                     *
     F*             Each option available from this enquiry is held   *
     F*             as a record on PF/SECOND - Linked Enquiry Control *
     F*             file with fields: Calling Program, Option         *
     F*             Selected, Called Program.                         *
     F*                                                               *
     F*  Calls:     F6 may be taken to call SE0270 - Customer         *
     F*             Shortname Enquiry.                                *
     F*             Options may be taken against a Security to call:  *
     F*             1) SE0245 - Security Details Enquiry              *
     F*             2) SE0220 - Customer Portfolio Movements Enquiry  *
     F*             3) SE0205 - Client Holdings Enquiry.              *
     F*             4) SE7572 - Corporate Action - Retrieve General   *   CSE007
     F*                         Block Security Indicators.            *   CSE007
     F*             5) SE7574 - Corporate Action - Retrieve General   *   CSE007
     F*                         Block Customer Indicators.            *   CSE007
     F*             6) SE7576 - Corporate Action - Retrieve Specific  *   CSE007
     F*                         Block Indicators.                     *   CSE007
     F*                                                               *
     F*  Called By: SEC04 - CL Component to Control SE Enquiries      *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. 226449             Date 24Jun15               *
      *  Prev Amend No. MD034776           Date 08Jul15               *
      *                 AR1067108          Date 11Dec12               *
      *                 AR1001183A         Date 20Nov12               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 234300             Date 29Sep06               *
      *                 BUG11745           Date 21Jul06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027A            Date 11May06               *
      *                 CSD027             Date 09Dec05               *
      *                 233736             Date 26Sep05               *
      *                 CSE071             Date 19Jul05               *
      *                 229857             Date 07Oct04               *
      *                 227267             Date 10Jun04               *
      *                 226570             Date 27Jun04               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3122            Date 17Jul04               *
      *                 CGL014             Date 20Oct03               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 208241             Date 21Aug02               *
      *                 207543             Date 17Jul02               *
      *                 194370             Date 12Jul01               *
      *                 180056             Date 18Oct00               *
      *                 CSE035             Date 22Apr02               *
      *                 206316             Date 19Jul02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 17Jun01               *
      *                 CSE031             Date 06Dec01               *
      *                 180707             Date 25Jul00               *
      *                 159599             Date 27Sep01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 177982             Date 21Jun01               *
      *                 162056             Date 30Apr01               *
      *                 127566             Date 09May01               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 140272             Date 20Apr00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CGL011             Date 20Sep99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 130862             Date 18Oct98               *
      *                 151945             Date 06Jan99               *
     F*                 111490             DATE 29Apr98               *
     F*                 CEU017             Date 03Avr98               *
     F*                 CSE007             Date 09Jan98               *
     F*                 099435             DATE 16FEB98               *
     F*                 CSE005             DATE 04FEB97               *
     F*                 103446             DATE 13JAN96               *
     F*                 084704             DATE 01AUG96               *
     F*                 083039             DATE 01AUG96               *
     F*                 059110             DATE 25JUL96               *
     F*                 089937             DATE 03JUL96               *
     F*                 088047             DATE 26JUN96               *
     F*                 100228             DATE 30MAY96               *
     F*                 067645             DATE 30APR96               *
     F*                 099886             DATE 17APR96               *
     F*                 100017             DATE 17APR96               *
     F*                 092199             DATE 24OCT95               *
     F*                 090500             DATE 24OCT95               *
     F*                 090314             DATE 24OCT95               *
     F*                 073603             DATE 24OCT95               *
     F*                 088776             DATE 24OCT95               *
     F*                 092961             DATE 04OCT95               *
     F*                 091254             DATE 20OCT95               *
     F*                 088303             DATE 21JUN95               *
     F*                 086491             DATE 15JUN95               *
     F*                 S01496  JSV        DATE 07OCT94               *
     F*                 064575             DATE 15AUG94               *
     F*                 S01408             DATE 19MAY94               *
     F*                 065301             DATE 05MAY94               *
     F*                 052254             DATE 07JAN94               *
     F*                 S01401             DATE 16JUN93               *
     F*                 E39495             DATE 17FEB93               *
     F*                 E47922             DATE  1FEB93               *
     F*                 S01397             DATE 10SEP92               *
     F*                 E38091             DATE 28APR92               *
     F*                 E38110             DATE 28APR92               *
     F*                 E38908             DATE 28APR92               *
     F*                 E38094             DATE 28APR92               *
     F*                 E37290             DATE 22APR92               *
     F*                 E36865             DATE 16MAR92               *
     F*                 E35920             DATE 13FEB92               *
     F*                 E34849             DATE 29JAN92               *
     F*                 E31795             DATE 28NOV91               *
     F*                 E31789             DATE 28NOV91               *
     F*                 E31776             DATE 27NOV91               *
     F*                 E27934             DATE 22OCT91               *
     F*                 E26473             DATE 05SEP91               *
     F*                 E27092             DATE 04SEP91               *
     F*                 S01117             DATE 28FEB91               *
     F*                 S01195             DATE 28FEB91               *
     F*                 S01220             DATE 28FEB91               *
     F*                 E23955             DATE 24OCT90               *
     F*                 S01269             DATE 18JUL90               *
     F*                 S01271             DATE 19JUN90               *
     F*                 E21668             DATE 01MAY90               *
     F*                 E21616             DATE 03APR90               *
     F*                 E20651             DATE 10JAN90               *
     F*                 S01232             DATE 30NOV89               *
     F*                 E20380             DATE 29NOV89               *
     F*                 E20158             DATE 15NOV89               *
     F*                 E19838             DATE 25OCT89               *
     F*                 S01199             DATE 03AUG89               *
     F*                 E16894             DATE 22/06/89              *
     F*                 E16772             DATE 19/06/89              *
     F*                 E15851             DATE 26/05/89              *
     F*                 E15850             DATE 26/05/89              *
     F*                 E15694             DATE 28/03/89              *
     F*                 E17130             DATE 22/02/89              *
     F*                 S01179             DATE 21/10/88              *
     F*                 S01176             DATE 20/10/88              *
     F*                 S01186             DATE 15/09/88              *
     F*                 E13571             DATE 31/07/88              *
     F*                 E14057             DATE 01/07/88              *
     F*                 S01158             DATE 12/05/88              *
     F*                 S01155             DATE 28/04/88              *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  226449 - Recompiled over changes made in /COPY ZDYYRZ3.      *
      *         - Applied for MD034387.                               *
      *  MD034776 - Reverse AR1001183A to allow negative interest     *
      *             rate. (Recompile)                                 *
      *  AR1067108 - PMC1140 Component failed during Clean COB        *
      *              Applied fix AR1001183A                           *
      *  AR1001183A - Coupon rate was still used in computation of    *
      *              interest instead of using the details in FRN tab *
      *              (Reopen) (Recompile)                             *
      *  234300 - Recompiled over changed in PF/HSTTRD.               *
      *  BUG11745 - Customer defaults to 000000                       *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027A - Conversion Of Customer Number to Alpha             *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  233736 - Included display of the average fiscal price for    *
      *           securities which are subject to EU tax. Used module *
      *           SEETCPRTV to get the average fiscal price of the    *
      *           latest position and had this called when reading    *
      *           CDEPF, in place of CDEPP, to get the average of all *
      *           portfolios.  Also applied core fix 159599 to ensure *
      *           that all client holdings are being displayed.       *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  229857 - Recompiled due to change in ZYLDZ2.                 *
      *  227267 - POSITION BLOCKED ALTHOUGH NO BLOCK FOR ALLOCATION   *
      *  226570 - Recompiled due to change in ZYLDZ2.                 *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3122 - Recompiled due to changes in SDSECSPD.             *
      *  CGL014 - Collaterals Processing                              *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  208241 - Recompiled over changed /CPY ZSDESCZ3.              *
      *  207543 - CEU018 not working on a price basis.                *
      *           Recompiled over changed ZYLDZ2.                     *
      *  194370 - Recompile after change on copy sources ZYLDZ2,      *
      *           For securities with divisor basis = '5' and first   *
      *           coupon date > valuation date (rundate + 1), set     *
      *           event control date to first coupon date before      *
      *           processing SR/ZDYYR. This is to ensure that the     *
      *           correct hypothetical last and next coupon dates are *
      *           used in deriving the price/yield rate.              *
      *  180056 - Recompiled over changed in ZDYYRZ3.                 *
      *  CSE035 - NX/NNX Coupon Payment Processing.                   *
      *           Recompile over changed ZACCRZ1/ZYLDZ2/ZYCEZ1
      *  206316 - Recompiled over changed ZLCDZ1.                     *
      *  CPK015 - Conversion of ZYIELD from PLI to RPG.               *
      *           Recompile over changed ZYLDZ2.                      *
      *  CSE031 - Coupon Fixing for Floating Rate Notes.              *
      *           (recompilation due to change to ZNCD/ZLCD/ZACCR)    *
      *  180707 - No Position Settlements generated. Recompile over   *
      *           changes in /COPY ZNCDZ3.                            *
      *  159599 - Some client holdings are not apprearing in Customer *
      *           Portforlio Valuation Enquiry.                       *
      *  177982 - Average price problem when previous position and    *
      *           actual position are long but has been short         *
      *           i.e. : long 400 sales 1000 purchases 800            *
      *           same for short positions. Complete E34849.          *
      *  162056 - Nominal amount truncated in Customer Portfolio      *
      *           Valuation Enquiry.  Fix is to increase field size of*
      *           SNOML from 12 to 14.                                *
      *  127566 - Recompiled over changed ZSDESCZ3                    *
     F*  140272 - Recompile over changed ZYLDZ2                       *
      *  CGL011 - Collateral Processing for Midas DBA                 *
     F*  130862 - Recompiled over ZLCDZ1 & ZDAYSZ2 changes.           *
     F*  151945 - Recompiled Over changed ZDYYRZ3 .                   *
     F*  111490 - Incorporation of 49112 and 56317 because 090500     *
     F*           wrong. Used *IN85 instead of *IN83 already booked   *
     F*           S01496.                                             *
     F*  CEU017 - Securities Redenomination Euro Changes              *
     F*  CSE007 - Corporate Actions                                   *
     F*  CSE005 - Effect of holidays on FRN Coupon Dates              *
     F*           (recompilation due to change to ZNCD/ZLCD/ZACCR).   *
     F*  099435 - At roll-up, nominal of the first record at the      *
     F*           first page of the subfile is changed to 0.  This is *
     F*           caused by fix 088303.  Move 'N' to field TROLL      *
     F*           before accumulating details for screen display.     *
     F*  103446 - S01496 Not incorporated in the correct place in     *
     F*           subroutine FIRST                                    *
     F*  084704 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
     F*  083039 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
     F*  059110 - Recompiled over changed ZYLDZ2 sub.                 *
     F*  089937 - Make options 1 and 2 work even when customer is     *
     F*           entered as long as customer is not changed          *
     F*  088047 - RECOMPILE over change SR/ZYLDZ2.                    *
     F*  100228 - RECOMPILE OVER CHANGED ZDYYRZ3, ZLCDZ1 & ZNCDZ3.    *
     F*  067645 - Future valued trade not shown if this is the only   *
     F*           trade for this customer.                            *
     F*  099886 - Rounding problem for partly paid securities.        *
     F*           Recompile over amended standard subroutine ZACCZ.   *
     F*  100017 - Position settlement unable to pick up day adj. on   *
     F*           SECTYD. Change subroutine to use DADJN to stop      *
     F*           interest day adjustment being used for amortisation.*
     F*           Recompile over amended subroutine ZDAYS.            *
     F*  092199 - The last security and the totals were not displayed *
     F*           in some cases; remove 2 lines from fix 088303.      *
     F*  090500 - Wrong Market Price shown on screen.  Program is     *
     F*           retrieving the earliest price rather than the       *
     F*           latest price change.                                *
     F*  090314 - Branch should be defaulted to the branch of the     *
     F*           customer and not of the user.                       *
     F*  073603 - Security positions of 0 should not appear on        *
     F*           valuation enquiry.                                  *
     F*  088776 - Always show customer and branch entered/defaulted   *
     F*           rather than having to re-enter them when this enq.  *
     F*           is accessed via EM.                                 *
     F*  092961 - Recompile over ZDAYSZ2 which was amended by 086491  *
     F*           (Wrong number of days calculated for day basis 1    *
     F*           when start or end day is last day of February)      *
     F*  091254 - RECOMPILE OVER CHANGED ZLCDZ1 & ZNCDZ3              *
     F*  088303 - Nominal position shown as double the amount as it   *
     F*           should be.  Wrong subfile management.  Do not       *
     F*           read the last record twice.                         *
     F*  086491 - Wrong nbr of days calculated for day basis 1        *
     F*           when start or end day is last day of February       *
     F*           Recompiled for ZSRSRC/ZDAYSZ2 changes.              *
     F*  S01496 - Incorporation of JYSKE Enhancements (S10978)        *
     F*  064575 - Recompiled over amended ZYLDZ2 subroutine.          *
     F*  S01408 - Core hook SE0215CPSR added                          *
     F*  065301 - Recompiled over changed copy source ZACCR subr.     *
     F*           with ZAMT increased to 15,0.                        *
     F*  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
     F*           to 10,9                                             *
     F*  S01401 - MT5xx SWIFT Messages Feature:                       *
     F*           - Recompiled due to changes to files.               *
     F*  E39495 - New /COPY subroutine ZCALCD added (called from      *
     F*           sr. ZYLD)                                           *
     F*         - /COPY subroutines ZACCZZ1 and ZCNSDZ1 added (called *
     F*           from sr. ZYLD and ZCALCD)                           *
     F*         - Recompiled over changed ZYLDZ2                      *
     F*  E47922 - Recompiled over changed SR/ZYLDZ2                   *
     F*  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
     F*           - Recompiled due to changes to files and SR/ZYLD.   *
     F*  E38091 - Accrued interest line should appear for             *
     F*           Schuldscheins                                       *
     F*  E38110 - Accrued interest line should not appear for         *
     F*           discounted securities                               *
     F*  E38908 - Key fields from SNDEVD should be renamed to same    *
     F*           names as SEDEVD so that the correct date and event  *
     F*           types are used to decide if security event is       *
     F*           between the from and to dates                       *
     F*  E38094 - Accrued interest line should not appear for records *
     F*           with 0% coupon rate                                 *
     F*  E37290 - Rollup not working correctly when a record has been *
     F*           read and the details for the previous record output.*
     F*  E36865 - Accrued interest should use ex-coupon nominal from  *
     F*           CPOSN instead from CDEPP else it is incorrect when  *
     F*           a coupon date is passed.                            *
     F*  E35920 - E15694 not complete in renaming CDEPD fields        *
     F*  E34849 - Average price was not worked out properly           *
     F*  E31795 - If a rollup is required on a particular enquiry to  *
     F*           view all the details the the next complete set of   *
     F*           details will be zero as the information has not     *
     F*           been placed in the relevant fields.                 *
     F*  E31789 - For trades with no market price whose security's    *
     F*           trade basis is yield,a market value of 100 was      *
     F*           output instead of zero.                             *
     F*  E31776 - Interest accrued for Mortgage Backed is 2 d.p. out  *
     F*  E27934 - Recompiled over the changed version of ZACCRZ1      *
     F*  E26473 - When a customer is selected who is not defined as a *
     F*           Securities customer, there is a DB error.           *
     F*  E27092 - Recompiled over changed SR/ZLCD                     *
     F*  S01117 - Multibranching : Screen function changes            *
     F*                            Access Programs                    *
     F*  S01195 - Holiday Processing                                  *
     F*  S01220 - Recompiled for Strategic Risk Management            *
     F*  S01269 - Trade Authorisation - ignore unauthorised trades    *
     F*  S01271 - Recompiled for Pay/Receive in Input Cycle changes   *
     F*           to TRADSD and/or DPTMVD                             *
     F*  E21668 - Recompiled over changed SR/ZYLDZ2                   *
     F*  E21616 - Recompiled over changed SR/ZLCD.                    *
     F*  E20651 - DB Error Numbers used in more than one place.       *
     F*           New Error Numbers as follows:                       *
     F*           DB ERROR 07 -> 13.                                  *
     F*           DB ERROR 07 -> 14.                                  *
     F*           DB ERROR 07 -> 15.                                  *
     F*           DB ERROR 07 -> 16.                                  *
     F*  S01232 - Australian yield modifications.                     *
     F*  E20380 - Recompile for changed ZYLDZ1/2 and include ZLCDZ1.  *
     F*  E20158 - SFLEND not being conditioned properly, resulting    *
     F*           in '+' indicator when there are no more records.    *
     F*  E19838 - Rounding Error producing an incorrect Book Price    *
     F*           and Book Valuation.                                 *
     F*  S01199 - ABS Help System.                                    *
     F*  E16894 - Book Price should be in P/D/Y Format on screen.     *
     F*  E16772 - Recompiled for the Dividend Payment Amount field    *
     F*           changes.                                            *
     F*  E15851 - INCORRECT EDITING FOR ACCRUED INTEREST.             *
     F*           ALSO CHANGED REF F/1 TO F/3 ON SCREEN ERROR MSG.    *
     F*  E15850 - ERROR WITH NEW SECN (ZCUMCP NOT RESET TO ZERO).     *
     F*  E15694 - ERRORS IN THE BUILDING OF THE SUBFILE FOR           *
     F*           SCHULDSHEINS BECAUSE SOME FIELDS FROM FILE          *
     F*           CDEPP ARE OVERRIDDEN WITH SOME FROM FILE CDEPD.     *
     F*  E17130 - ERROR MESSAGE CHANGED FOR LINKED ENQUIRY OPTIONS.   *
     F*  S01179   ****** AS400 CONVERSION ******                      *
     F*    The keyword RTGAID is no longer supported on the AS400     *
     F*    and command keys and indicators have been used to replace  *
     F*    this in the display file. To disrupt the structure of the  *
     F*    program as little as possible a new subroutine - ASCHGS -  *
     F*    has been coded. This moves the values which would have     *
     F*    been passed to the program (via RTGAID) into the AID       *
     F*    field depending on which function key has been pressed.    *
     F*  S01176 - 3.1 (AUSTRALIA)                                     *
     F*  S01186 - ST 3.1 -  BOOK PRICE, BOOK VALUATION, MARKET        *
     F*           PRICE and MARKET VALUATION are being formatted/     *
     F*           calculated incorrectly (no need to used ZPRCO).     *
     F*  E13571 - AMENDED ERROR MESSAGE, AS NO HELP TEXT.             *
     F*  E14057 - USE PRICR NOT PRICS FILE.                           *
     F*  S01158 - POST INCORPORATION DEVELOPMENT FIXES.               *
     F*  S01155 - SE INCORPORATION ERROR FIX.                         *
     F*                                                               *
     F*****************************************************************
      *
     FSE0215DFCF  E                    WORKSTN      KINFDS SCRDS
     F                                        SFLRECKSFILE SE0215S0
      *                                                                                       233736
      ** Use new LF, which includes the portfolio reference                                   233736
      *                                                                                       233736
     F***CDEPP** IF  E           K        DISK                                                233736
     FCDEPF   IF  E           K        DISK                                                   233736
     FSECED   IF  E           K        DISK
     FSECEO   IF  E           K        DISK                               E39495
     F            SEDEVDF                           KRENAMESEDEVDO        E39495
     F            SNDEVDF                           KRENAMESNDEVDO        E39495
     FSECTY   IF  E           K        DISK
     FINVTP   IF  E           K        DISK
     F*CDEPD***IF**E***********K********DISK                              S01496
     FCDEPD   IF  E           K        DISK                           UC  S01496
     F            CDEPPDF                           KRENAMECDEPDDF
     F*********CDEPD1  IF  E           K        DISK                  UC  S01496
     FSECDEPL1IF  E           K        DISK                           UC  S01496
     F            CDEPPDF                           KRENAMECDEPDDF1       S01496
     FSEBLKPL6IF  E           K        DISK                               CGL011
      ** Manually Blocked Positions File                                  CGL011
      *                                                                   CGL011
     FSEBLKPL7IF  E           K        DISK                                                   CGL014
     F            SEBLKPD0                          KRENAMESEBLKPDF                           CGL014
     F***CLINT***IF  E           K        DISK                            S01117
     F*********** CLINTCAF                          KIGNORE               S01117
     F*********** CLINTCCF                          KIGNORE               S01117
     F*********** CLINTC1F                          KIGNORE               S01117
     F***SNAME***IF  E           K        DISK                            S01117
     F*********** CLINTCBF                          KRENAMESNAMECBF       S01117
     FCPOSN   IF  E           K        DISK
     F*RICS***IF**E           K        DISK                               E14057
     FPRICR   IF  E           K        DISK                               E14057
     FPRICT   IF  E           K        DISK
     F            PRICEDF                           KRENAMEPRICETDF
     FCPPRIC  IF  E           K        DISK                               S01176
     FTRDBV   IF  E           K        DISK
     F***NEXTC   IF  E           K        DISK
     F***TABSE***IF  E           K        DISK                            S01117
     F*********** TABLETAF                          KIGNORE               S01117
     F*           TABTB10F                          KIGNORE
     F*           TABTB11F                          KIGNORE
     F*           TABTB36F                          KIGNORE
     F*********** TABTB40F                          KIGNORE               S01117
     F*********** TABTE10F                          KIGNORE               S01117
     F*********** TABTE20F                          KIGNORE               S01117
     F*           TABTG10F                          KIGNORE
     F*********** TABTG20F                          KIGNORE               S01117
     F*********** TABLETHF                          KIGNORE               S01117
     F********    TABLETJF                          KIGNORE               S01232
     F*********** TABLETKF                          KIGNORE               S01117
     F*********** TABLETLF                          KIGNORE               S01117
     F*********** TABLETNF                          KIGNORE               S01117
     F*********** TABLETPF                          KIGNORE               S01117
     F*           TABLETRF                          KIGNORE
     F*********** TABLETXF                          KIGNORE               S01117
     F*********** TABLET2F                          KIGNORE               S01117
     F*********** TABLET3F                          KIGNORE               S01117
     F*********** TABLET5F                          KIGNORE               S01117
     FSECOND  IF  E           K        DISK
     F/COPY WNCPYSRC,SE0215F001
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*  01       RETURN TO PREVIOUS PROGRAM                          *
     F*           OR ERROR ON SECTY READ                              *
     F*  02       CLEAR SUBFILE                                       *
     F*  03       NO DETAILS INDICATOR                                *
     F*  04       DISPLAY MESSAGE - NO DETAILS TO DISPLAY             *
     F*  05       DETAILS COMPLETE FOR THIS CUSTOMER                  *
     F*  06       ROLLUP PAST END OF FILE - DISPLAY MESSAGE           *
     F*  07       ON IN MULTI-BRANCH ENVIRONMENT                      *
     F*  08       CONTROL DISPLAY OF SELECT FIELD IN SFL              *
     F*                                                               *
     F*  10       VLDCMDKY INDICATOR FOR DISPLAY FILE                 *
     F*                                                               *
     F*  20       ROLLUP                                              *   S01179
     F*  21       HELP                                                *   S01179
     F*                                                               *   S01179
     F*  25       GENERAL FILE CHAIN USAGE                            *   S01117
     F*                                                               *   S01117
     F***29*******CUST*SHORTNAME*ENTERED*******************************   S01117
     F***30*******CUST*NO.*ENTERED*************************************   S01117
     F*                                                               *   S01117
     F***35*******CDEPP**RECORD*READ***********************************                       233736
     F*  35       CDEPF RECORD READ                                   *                       233736
     F*  40       END OF FILE ON SUBFILE READ                         *
     F*  41       REVERSE IMAGE CUST NO./SHORTNAME FIELD              *
     F*  42       DISPLAY ERROR MESSAGE                               *
     F*  44       REVERSE IMAGE BRANCH FIELD                          *   S01117
     F*  50       ON IF DETAILS ACCUMULATED FOR PREVIOUS SEC          *
     F*  51       MORE DETAILS TO OUTPUT FOR SECURITY                 *
     F*  52       SECURITY IS TRADED ON AN AUSTRALIAN YIELD BASIS     *   S01232
     F*  55       NOMINAL CURRENCY DEC. PLACES 0                      *
     F*  56       NOMINAL CURRENCY DEC. PLACES 1                      *
     F*  57       NOMINAL CURRENCY DEC. PLACES 2                      *
     F*  58       NOMINAL CURRENCY DEC. PLACES 3                      *
     F*  59       MORE TOTALS TO OUTPUT FOR CUSTOMER                  *
     F*  60       MORE TOTALS TO OUTPUT FOR CUSTOMER                  *
     F*  61       DISPLAY FIELDS FOR S01496                           *   S01496
     F*  62       Display fields for CSE007                           *   CSE007
      *  63       End of File on LF/SEBLKPL6                          *   CGL011
 ******  66       END OF FILE ON NEXTC                                *
     F***70*******BYPASS*RECORD*FROM*CDEPP*IF*OFF**********************                073603 233736
     F*  70       BYPASS RECORD FROM CDEPF IF OFF                     *                       233736
     F***81*******END*OF*FILE*ON*CDEPP*********************************                       233736
     F*  81       END OF FILE ON CDEPF                                *                       233736
     F*  82       NEXT PAGE REQUIRED (CONTROL SFLEND)                 *
     F***83*******END*OF*FILE*ON*CDEPP*********************************                S01496 233736
     F*  83       END OF FILE ON CDEPF                                *                       233736
     F*  88       SUBFILE READ FAIL                                   *
     F***89*******END*OF*FILE*ON*CDEPP*OR*END*OF*SUBFILE*PAGE**********                       233736
     F*  89       END OF FILE ON CDEPF OR END OF SUBFILE PAGE         *                       233736
     F*                                                               *
     F*  90       WORK INDICATOR - STD SUBROUTINES                    *
     F*  98       DATE FORMAT INDICATOR FOR ZSYSTM                    *
     F***99*******ERROR*ON*ICDR*1*READ*-*ZSYSTM*                      *   S01117
     F*                                                               *
     F*  U7       WITH U8 FOR DATABASE ERROR                          *
     F*  U8       WITH U7 FOR DATABASE ERROR                          *
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*  P001    -  CHANGE SCREEN HEADINGS                            *   S01496
     F*  P002    -  CHANGE SCREEN DETAILS                             *   S01496
     F*  ASCHGS  -  MOVES VALUES INTO AID - AS400 CONVERSION          *   S01179
     F*  CHKSEL  -  CHECK FOR "?" SELECTION (KEY INPUT)               *   S01117
     F*  COMMD   -  PROCESS COMMAND KEYS, HELP AND ROLLUP/DOWN        *
     F*  OPTION  -  CHECK VALIDITY OF ENTERED OPTION COMBINATIONS     *
     F*  CUSTIN  -  PROCESS ENTERED CUSTOMER NO./SHORTNAME            *
     F*  SETUP   -  PREPARE OUTPUT SCREEN FOR DISPLAY                 *
     F*  CLEAR   -  CLEAR FIELDS AND INDICATORS ON DISPLAY SCREEN     *
     F*  ROLLUP  -  HANDLE ROLLUP WHEN END OF SUBFILE REACHED         *
     F*  DISP    -  ACCUMULATE SECURITY DETAILS FOR DISPLAY           *
     F*  PROCES  -  PROCESS A SECURITY                                *
     F*  SUBFIL  -  WRITE ACCUMULATED DETAILS TO SUBFILE              *
     F*  TOTAL   -  PROCESS CUSTOMER TOTALS                           *
     F*  TOTFIL  -  WRITE TOTAL DETAILS TO SUBFILE                    *
     F*  ADJUST  -  ADJUST FIELD TO REMOVE DEC PLACES                 *
     F*  CSPRC   -  CALCULATE BOOK PRICE                              *
     F*  OLCAP   -  CALCULATE AVERAGE PRICE                           *
     F*  ZACRCI  -  CALCULATE INTEREST ON A CUSTOMER POSITION IN I/C  *
     F*  LINK    -  PROCESS REQUEST FOR LOWER LEVEL ENQUIRY           *
     F*  RETSR   -  END OF PROGRAM PROCESSING                         *
     F*  FIRST   -  FIRST CYCLE PROCESSING                            *
     F*  *PSSR   -  ERROR HANDLING                                    *   S01117
     F*                                                               *
     F***XDATE***-**CALCULATE*WORKING*DAYS*BACKWARDS.*             *S01232S01195
     F*                                                               *   S01195
     F*  ZACCR   -  CALCULATE INTEREST ACCRUED BETWEEN TWO DATES      *
     F*  ZACCZ   -  Calculate accrued interest between two dates      *   E39495
     F*  ZALIGN  -  VALIDATE AND RIGHT-ALIGN NUMERIC FIELDS           *
     F*  ZCALCD  -  Calculate long term CD price from input yield     *   E39495
     F*  ZCNSD   -  Calculate consideration                           *   E39495
     F*  ZCONV   -  CONVERT AMOUNT FROM ONE CURRENCY TO ANOTHER       *
     F*  ZDAYS   -  CALCULATE NO OF DAYS BETWEEN 2 DATES FOR          *
     F*               INTEREST CALCULATIONS                           *
     F*  ZDATE1  -  FORMAT DATE                                       *
     F*  ZDATE2  -  FORMAT DATE                                       *
     F*  ZDYYR   -  CALCULATE NO OF DAYS IN INTEREST YEAR             *
     F*  ZEVCD   -  CALCULATE EVENT CONTROL DATE                      *
     F*                                                               *   S01117
     F***ZICD2***-**ACCESS*ICDR2*-*TABTB11*                           *   S01117
     F***ZICDSE**-**ACCESS*ICDSE*-*TABTB36*                           *   S01117
     F*                                                               *   S01117
     F*  ZLCD    -  GET PREVIOUS COUPON DATE.                         *   E20380
     F*  ZNCD    -  DETERMINE NEXT COUPON DATE                        *
     F*  ZPRCI   -  OUTPUT PRICE AS % PRICE                           *   S01176
     F*  ZPRCO   -  OUTPUT YIELD AS PRICE                             *
     F*  ZRATE   -  CALCULATE EFFECTIVE RATE                          *
     F*  ZRSTOR  -  RESTORES INDICATORS 90 - 97                       *
     F*  ZSAVE   -  REMEMBER SETTING AND THEN SETOF INDICATORS 90 - 97*   S01158
     F*  ZSDESC  -  FORMAT SECURITY DESCRIPTION                       *
     F*  ZSEDIT  -  EDIT NUMERIC FIELDS FOR OUTPUT                    *
     F*                                                               *   S01117
     F***ZSYSTM**-**ACCESS*ICDR1*-*TABTB10*                           *   S01117
     F*                                                               *   S01117
     F*  ZXRATE  -  CALCULATE CROSS-EXCHANGE RATE                     *
     F*  ZYCE    -  SET CUM/EX PARAMETER FOR AUSTRALIAN YIELD CALCS.  *   S01232
     F*  ZYLDI   -  OUTPUT YIELD AS PERCENTAGE                        *   S01176
     F*  ZYLDO   -  OUTPUT PERCENTAGE PRICE AS YIELD                  *
     F*  ZYMTX   -  CALCULATE YIELD BASED ON DAYS TO MATURITY         *   S01176
     F*                                                               *
     F*****************************************************************
      /EJECT
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY ZSRSRC,ZNCDZ1
     E                    CPY@    1   1 80
     E***********         MSG     1   9 79               Error Messages   S01117
     E***********         MSG     1  10 79               Error MessaS01117E26473
     E                    MSG     1  11 79               Error Messages   E26473
     E/COPY ZSRSRC,ZPOWERZ1
     E/COPY ZSRSRC,ZDAYSZ1
     E/COPY ZSRSRC,ZPOWER8Z1
     E/COPY ZSRSRC,ZSDESCZ1
     E/COPY ZSRSRC,ZSEDITZ1
     E                    ZAD        21  1
     E/COPY ZSRSRC,ZALIGNZ1
     E/COPY ZSRSRC,ZYMTXZ1                                                S01176
     E***/COPY*ZSRSRC,ZDATE6Z1                                      S01232S01195
     E/COPY ZSRSRC,ZHOLE                                                  S01195
      /EJECT
     IHSTTRDF                                                             S01155
     I              RECI                            TRRECI                S01155
     ITRADSDF                                                             S01155
     I              RECI                            TRRECI                S01155
     ICDEPDDF                                                             E15694
     I              CDSN                            CDSN2                 E15694
     I***********   CDBR                            CDBR2           E15694S01117
     I              CDPA                            CDPA2                 S01117
     I              CDCN                            CDCN2                 E15694
     I              DDTE                            DDTE2                 E15694
     I              CDMK                            CDMK2                 E15694
     I              CDPT                            CDPT2                 E37290
     I              CDNV                            CDNV2                 E15694
     I              CNPV                            CNPV2                 E15694
     I              CNSV                            CNSV2                 E15694
     I              CECN                            CECN2                 E15694
     I              SPSV                            SPSV2                 E35920
     I              SAPV                            SAPV2                 E35920
     ICDEPDDF1                                                            S01496
     I              CDSN                            CDSN2                 S01496
     I              CDPA                            CDPA2                 S01496
     I              CDCN                            CDCN2                 S01496
     I              DDTE                            DDTE2                 S01496
     I              CDMK                            CDMK2                 S01496
     I              CDPT                            CDPT2                 S01496
     I              CDNV                            CDNV2                 S01496
     I              CNPV                            CNPV2                 S01496
     I              CNSV                            CNSV2                 S01496
     I              CECN                            CECN2                 S01496
     I              SPSV                            SPSV2                 S01496
     I              SAPV                            SAPV2                 S01496
     I              PTFR                            PTFR2                 S01496
     ISNDEVDF                                                             E38908
     I              SNSN                            SDSN                  E38908
     I              SNDT                            SDED                  E38908
     I              SNET                            SDET                  E38908
      *                                                                                       233736
      ** Rename fields                                                                        233736
      *                                                                                       233736
     IPRICEDF                                                                                 233736
     I              PTFR                            PPTFR1                                    233736
      *                                                                                       233736
     IPRICETDF                                                                                233736
     I              PTFR                            PPTFR2                                    233736
      *                                                                                       233736
     IETCPOS    E DSETCPOSND                                                                  233736
     I              RECI                            ETRECI                                    233736
     I              CSBA                            ETCSBA                                    233736
     I              CSSC                            ETCSSC                                    233736
     I              CSCN                            ETCSCN                                    233736
     I              PTFR                            ETPTFR                                    233736
     I              SAPD                            ETSAPD                                    233736
     I              APDT                            ETAPDT                                    233736
      *                                                                                       233736
      ** Data structure to hold the current key                                               233736
      *                                                                                       233736
     I            DS                                                                          233736
     I                                        1  23 KCPOS                                     233736
     I                                        1   3 SAVBR                                     233736
     I**********                              4   90PCUST2                            233736 CSD027A
     I                                        4   9 PCUST2                                   CSD027A
     I                                       10  19 CDSN                                      233736
     I                                       20  23 PTFR                                      233736
      *                                                                                       233736
      ** Data structure to hold previous values                                               233736
      *                                                                                       233736
     I            DS                                                                          233736
     I                                        1  23 PCPOS                                     233736
     I                                        1   3 WBRCH                                     233736
     I**********                              4   90WCUST                             233736 CSD027A
     I                                        4   9 WCUST                                    CSD027A
     I                                       10  19 WSECT                                     233736
     I                                       20  23 WPTFR                                     233736
     ICPYR@#      DS
     I*                                                                   E15694
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I*                                                                   E15694
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
      *
     I/COPY ZSRSRC,ZNCDZ2
     I/COPY ZSRSRC,ZSDESCZ2
     I*
     I***LDA*****   UDS                            256                    S01117
     I***********                                                         S01117
     I*******Local data area.                                             S01117
     I***********                                                         S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 1770DBASE                 S01117
      *                                                                   S01117
     ILDA         DS                            256                       S01117
      *                                                                   S01117
      ** Local data area for database error details                       S01117
      ** *LOCK IN LDA immediately before and OUT LDA immediately          S01117
      ** after each database error handling.                              S01117
      *                                                                   S01117
     I                                      134 183 DBLOT                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     IJNSTAT     UDS                            200
     I*
     I*   JNSTAT DATA AREA
     I                                    P 103 1050PRUN
     I*
     I            DS
     I*
     I*   DATA STRUCTURES FOR SETTING UP SFL LINES
     I*
     I                                        1  74 POSL1
     I                                        1  41 SDESC
     I                                       44  46 SNMCY
     I                                       48  60 SBVAL
     I                                       48  59 SBVALA
     I                                       62  74 SMVAL
     I                                       62  73 SMVALA
     I                                       37  41 #BLOC1                S01496
     I                                       37  38 GBLOC1                S01496
     I                                       39  39 #BLANC                S01496
     I                                       40  41 SBLOC1                S01496
     I            DS
     I                                        1  74 POSL2
     I**********                              1  12 SNOML                 162056
     I                                        1  14 SNOML                 162056
     I                                       15  27 SBKPR
     I                                       28  28 P1
     I                                       30  30 SBVI
     I                                       32  44 SMKPR
     I                                       45  45 P2
     I                                       48  60 SBVPF
     I                                       48  59 SBVPFA
     I                                       62  74 SMVPF
     I                                       62  73 SMVPFA
      *                                                                                       233736
      ** Added average fiscal price details                                                   233736
      *                                                                                       233736
     I            DS
     I                                        1  74 POSL3
     I                                        2   9 ACIN1
     I                                       10  10 ACIN1A
     I                                       13  16 SINTD
     I                                       17  20 ACIN2
     I                                       23  39 SINTT
     I                                       44  74 DAVFP                                     233736
     I                                       44  50 NAFP1                                     233736
     I                                       51  55 NAFP2                                     233736
     I                                       57  74 SAVFP                                     233736
     I            DS
     I                                        1  74 FUTL1
     I                                        2   9 FL1
     I                                       10  17 FL2
     I                                       18  22 FL3
     I            DS
     I                                        1  74 FUTL2
     I                                        2   2 AST
     I                                        4   5 STDTP
     I                                        7  19 SNOMT
     I                                       21  22 AT
     I                                       24  37 SPRIC
     I                                       38  38 P3
     I                                       40  47 VAL
     I                                       49  55 STDVD
     I            DS
     I                                        1  74 TOTL2
     I                                       48  50 TL4
     I                                       52  57 TL5
     I                                       62  74 STTOT
     I                                       62  73 STTOTA
     I            DS
     I                                        1  74 TOTL1
     I                                       22  29 TL1
     I                                       30  37 TL2
     I                                       38  42 TL3
     I                                       44  46 SNMCYA
     I                                       48  60 STBVP
     I                                       48  59 STBVPA
     I                                       62  74 STMVP
     I                                       62  73 STMVPA
     I            DS
     I**  DS to drop last 3 dps of prices
     I                                        1  21 ZOUT21
     I                                        1  17 Z21L3
     I            DS                                                                          227267
     I                                        1   6 WORK1                                     227267
     I**********                              1   60##CDC1                             227267 CSD027
     I                                        1   6 ##CDC1                                    CSD027
     I**  LINK ENQUIRY DATA AREA
     ISESDS     E DS
     IPSDS       SDS
     I                                        1  10 PROGRM
     I                                      244 246 WSID
     ISCRDS       DS
     I                                      287 288 AID
     I/COPY WNCPYSRC,SE0215I002
0256 I*
0257 I            DS
0256 I**   DATA STRUCTURE FOR IKEY
0258 I                                        1   6 IKEY
0259 I                                        1   3 NMCY
0260 I                                        4   6 SITP
0272 I*
0273 I*********** DS                                                      S01117
0272 I*****DATA*STRUCTURE*FOR*CUSTMR(INPUT*NUMBER*OR*S/NAME)*             S01117
0274 I***********                             1  10 CUSTMR                S01117
0275 I***********                             1   6 SCSNMA                S01117
0276 I***********                             7  10 SCSNMB                S01117
     I**     DATA STRUCTURE FOR ZSEDIT SUBROUTINE
     I/COPY ZSRSRC,ZSEDITZ2
     I            DS
     I                                        1  21 WORKAD
     I                                        1  21 ZAD
     I/COPY ZSRSRC,ZYLDZ1
     I**
AB   I************DS                                                      E39495
AB   I****************************************1  117ZCPNR                 E39495
AB   I***************************************12  12 ZPROT                 E39495
AB   I***************************************13  270ZPPCP                 E39495
AB   I***************************************28  368ZCFCT                 E39495
AB   I***************************************37  510ZSFPP                 E39495
AB   I***************************************52  660ZSINP                 E39495
AB   I***************************************67  67 ZPPDI                 E39495
AB   I****************************************1  117CPNR                  E39495
AB   I***************************************12  12 PROT                  E39495
AB   I***************************************13  270CPDP                  E39495
AB   I***************************************28  368CFCT                  E39495
AB   I***************************************37  510SFPP                  E39495
AB   I***************************************52  660SINP                  E39495
AB   I***************************************67  67 PPDI                  E39495
     I            DS                                                      S01117
      *                                                                   S01195
      ** Data structures for redefining customer number as character      S01195
      *                                                                   S01195
     I**********                              1   60CDCN                               S01117 CSD027
     I                                        1   6 CDCN                                      CSD027
     I                                        1   6 @CDCN                 S01117
     I            DS                                                      S01117
     I**********                              1   60PCUST                              S01117 CSD027
     I                                        1   6 PCUST                                     CSD027
     I                                        1   6 @PCUST                S01117
      *                                                                   S01195
      ** Data structure for holiday processing.                           S01195
      *                                                                   S01195
     I/COPY ZSRSRC,ZHOLI                                                  S01195
      *                                                                   S01117
     IRUNDT       DS                                                      S01117
      *                                                                   S01117
      ** RUNDAT data area                                                 S01117
      *                                                                   S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
      *                                                                   S01117
     I*ZMUSER*****DS                             17                S01117 090314
      ************                                                 S01117 090314
      ***Menu*user data area                                       S01117 090314
      ************                                                 S01117 090314
     I************                           11  13 DFTBRC         S01117 090314
     I************                           17  17 BANKAU         S01117 090314
      *                                                                   S01117
     ISDBANK    E DSSDBANKPD                                              S01117
      *                                                                   S01117
      ** Bank Details                                                     S01117
      *                                                                   S01117
     ISDBOOK    E DSSDBOOKPD                                              S01117
      *                                                                   S01117
      ** Book Details                                                     S01117
      *                                                                   S01117
     ISDBRCH    E DSSDBRCHPD                                              S01117
      *                                                                   S01117
      ** Branch Details                                                   S01117
      *                                                                   S01117
     ISDCURR    E DSSDCURRPD                                              S01117
      *                                                                   S01117
      ** Currency Details                                                 S01117
      *                                                                   S01117
     ISDCUST    E DSSDCUSTPD                                              S01117
     I              QQDFAC                          #DFAC1                                    CGL029
      *                                                                   S01117
      ** Customer Details                                                 S01117
      *                                                                   S01117
     ISDGELR    E DSSDGELRPD                                              S01117
      *                                                                   S01117
      ** General Ledger Details                                           S01117
      *                                                                   S01117
     ISDSECS    E DSSDSECSPD                                              S01117
     I              QQACCD                          QQACD1                                    CGL029
      *                                                                   S01117
      ** Securities Customers                                             S01117
      *                                                                   S01117
     ISDSTRD    E DSSDSTRDPD                                              S01117
      *                                                                   S01117
      ** Securities Trading Data                                          S01117
      *                                                                   S01117
     ISCSARD    E DSSCSARDPD                                              CGL011
      *                                                                   CGL011
      ** External Data Structure for Switchable Features file             CGL011
      *                                                                   CGL011
     IDSFDY     E DSDSFDY                                                 S01117
      *                                                                   S01117
      ** Short data structure for access programs (200 long)              S01117
      *                                                                   S01117
     IDSSDY     E DSDSSDY                                                 S01117
      *                                                                   S01117
      ** Long data structure for access programs (800 long)               S01117
      *                                                                   S01117
     I              'Collateral'          C         COLLA                 CGL011
      *                                                                   CGL011
      ** Constant field for collateral text narrative                     CGL011
      *                                                                   CGL011
     I/COPY WNCPYSRC,SE0215I001
     C/EJECT
      *================================================================
      *  P R O G R A M   S T A R T                                    *
      *================================================================
      *
     C           *NAMVAR   DEFN           SESDS
     C           *NAMVAR   DEFN           LDA
     C           *NAMVAR   DEFN           JNSTAT
     C************LIKE     DEFN APDA      CACD                            S01117
     C           *LIKE     DEFN BKAPDT    CACD                            S01117
     C           *LIKE     DEFN PMKT      SAVM
     C********** *LIKE     DEFN CDMK      NXTMK                    E37290 159599
     C********** *LIKE     DEFN CDPT      NXTDP                    E37290 159599
     C********** *LIKE     DEFN CDSN      NXTSN                    E37290 159599
     C           *LIKE     DEFN PBOK      SAVB
     C           *LIKE     DEFN CDNT      ZZPUR
     C           *LIKE     DEFN CDNT      ZZSAL
     C           *LIKE     DEFN CDNT      ZZAPS
     C           *LIKE     DEFN CDNT      ZZAPP
     C           *LIKE     DEFN CDNT      ZZAPC
     C           *LIKE     DEFN PPRC      ZZAPW
     C           *LIKE     DEFN CDNT      ZNOMP
     C           *LIKE     DEFN CDNT      ZNNOMP
     C           *LIKE     DEFN CDNT      ZZNOML
     C           *LIKE     DEFN CDNT      ZZNOMU
     C           *LIKE     DEFN CDNT      TOTBVP
     C           *LIKE     DEFN CDNT      TOTMVP
     C************LIKE     DEFN ERLC      ZRATE1                          S01117
     C************LIKE     DEFN ERLC      ZRATE2                          S01117
     C************LIKE     DEFN MDIN      ZMDI1                           S01117
     C************LIKE     DEFN MDIN      ZMDI2                           S01117
     C           *LIKE     DEFN A6MDIN    ZMDI1                           S01117
     C           *LIKE     DEFN A6MDIN    ZMDI2                           S01117
     C           *LIKE     DEFN A6ERLC    ZRATE1                          S01117
     C           *LIKE     DEFN A6ERLC    ZRATE2                          S01117
      *
      ** Module use to retrieve the latest position in ETCPOSND                               233736
      *                                                                                       233736
     C                     MOVEL'SEETCPRT'WPGM    9                                           233736
     C                     MOVE 'V'       WPGM                                                233736
      *                                                                                       233736
     C           KEYI      KLIST
     C                     KFLD           NMCY
     C                     KFLD           SITP
      *
     C           KYPR      KLIST                                          S01176
     C                     KFLD           SITP                            S01176
     C                     KFLD           NMCY                            S01176
      *
     C           KEYC      KLIST
     C                     KFLD           SAVBR
     C                     KFLD           PCUST
      *
     C           KEYPT     KLIST
     C                     KFLD           PTYP    2
     C                     KFLD           SAVSEC
     C                     KFLD           PDAT    50
     C**********           KFLD           PCST    60                                          CSD027
     C                     KFLD           PCST    6                                           CSD027
      *
     C           KEYPTP    KLIST
     C                     KFLD           PTYP
     C                     KFLD           SAVSEC
      *
     C           KEYP      KLIST
     C                     KFLD           SAVSEC
     C                     KFLD           SAVBR
     C                     KFLD           SAVM
     C                     KFLD           SAVB
     C                     KFLD           PCUST
     C                     KFLD           PPRT
      *
     C           KEYPD     KLIST
     C                     KFLD           SAVSEC
     C                     KFLD           SAVBR
     C                     KFLD           SAVM
     C                     KFLD           SAVB
     C                     KFLD           PCUST
     C                     KFLD           PPRT
     C                     KFLD           RUND
      *
     C           KEYPP     KLIST
     C                     KFLD           SAVSEC
     C                     KFLD           SAVBR
     C                     KFLD           SAVM
     C                     KFLD           SAVB
     C                     KFLD           PCUST
     C                     KFLD           PPRT
     C                     KFLD           PRUN
      *
     C           KEYCP     KLIST
     C                     KFLD           SAVBR
     C                     KFLD           SAVSEC
     C                     KFLD           PCUST
      *
     C           KEYT      KLIST
     C                     KFLD           SAVBR
     C                     KFLD           PCUST
     C                     KFLD           SAVSEC
     C                     KFLD           RUND
      *
     C           KEYTE     KLIST
     C                     KFLD           SAVBR
     C                     KFLD           PCUST
     C                     KFLD           SAVSEC
     C*                                                                   E37290
     C********** KEYUP     KLIST                                   E37290 159599
     C**********           KFLD           SAVBR                    E37290 159599
     C**********           KFLD           PCUST                    E37290 159599
     C**********           KFLD           NXTSN                    E37290 159599
     C**********           KFLD           NXTDP                    E37290 159599
     C**********           KFLD           NXTMK                    E37290 159599
     C*                                                                   S01496
     C           KEY1      KLIST                                          S01496
     C                     KFLD           W1CDBR                          S01496
     C                     KFLD           W1CDCN                          S01496
     C                     KFLD           W1CDSN                          S01496
     C                     KFLD           W1PTFR                                              233736
     C                     KFLD           W1CDPT                          S01496
     C                     KFLD           W1CDMK                          S01496
     C*                                                                   S01496
     C           KEY2      KLIST                                          S01496
     C                     KFLD           SAVBR                           S01496
     C                     KFLD           PCUST                           S01496
     C                     KFLD           ZSECT                           S01496
      *                                                                   CGL011
     C           KEYVD     KLIST                                          CGL011
     C                     KFLD           SAVBR                           CGL011
     C                     KFLD           SSESN                           CGL011
     C**
     C**  DO FIRST CYCLE PROCESSING
     C**
     C                     MOVEL*BLANKS   HBLOCK                          S01496
     C                     MOVEL*BLANKS   GBLOCK  2                       S01496
     C                     MOVEL*BLANKS   SBLOCK  2                       S01496
     C                     EXSR FIRST
     C**
     C**  MAIN PROCESSING    -    Do until end of job requested
     C**
     C           *IN01     DOWEQ'0'
     C/COPY WNCPYSRC,SE0215C016
     C**
     C**    Display the screen
     C**
     C                     WRITESE0215F0
     C                     EXFMTSE0215C0
     C/COPY WNCPYSRC,SE0215C017
      *                                                                   S01117
      ** Check for Book '?' prompt and skip processing if found           S01117
      *                                                                   S01117
     C                     EXSR CHKSEL                                    S01117
     C           @SEL      IFEQ 0                                         S01117
     C**
     C** Call S/R to move values into AID                                 S01179
     C*                                                                   S01179
     C                     EXSR ASCHGS                                    S01179
     C*                                                                   S01179
     C**    Clear the error messages unless HELP pressed
     C**
     C           AID       IFNE 'HP'
     C                     MOVE *BLANKS   ERMSG  79
     C                     MOVE '0'       *IN41
     C                     MOVE '0'       *IN42
     C                     MOVE '0'       *IN44
     C                     END
     C**
     C******Check*Command*Keys*-*including*HELP                           S01199
     C**    Check Command Keys                                            S01199
     C**
     C                     EXSR COMMD
     C**
     C**    If Enter has been pressed check validity of options
     C**
     C           AID       IFEQ 'RA'
     C**
     C**    Check Validity of Option Combinations
     C**                   Either Cust OR Select must be entered
     C**                   Only one select must be entered
     C**
     C                     EXSR OPTION
     C**
     C           *IN42     IFEQ '0'
     C**
     C**    Check if a new cust number or shortname entered
     C**
     C***********CUSTMR    IFNE *BLANKS                                   089937
     C           CUSTMR    IFNE WSVCUS                                    089937
     C           BRANCH    ORNE WSVBRC                                    089937
     C                     EXSR CUSTIN
     C                     END
     C**
     C**    Lower Level Enquiry Selected - only possible if details
     C**
     C           OPTN      IFNE *BLANK
     C                     EXSR LINK
     C                     END
     C**
     C                     END
     C                     END
     C                     END                                            S01117
     C                     END
      *
      *================================================================
      *  Return to calling program                                    *
      *                                                               *
     C                     EXSR RETSR
      *                                                               *
     ******************************************************************   S01496
     C/EJECT                                                              S01496
     ******************************************************************   S01496
     C* P001   : CHANGE SCREEN HEADINGS                               *   S01496
     C*                                                               *   S01496
     C* Called  By   CUSTIN                                           *   S01496
     ******************************************************************   S01496
     C*                                                                   S01496
     C           P001      BEGSR                                          S01496
     C*                                                                   S01496
     C** PARAMETERS - DEFINITION AND INITIALIZATION                       S01496
     C                     MOVEL*BLANKS   ##CDBR  3                       S01496
     C                     MOVEL*BLANKS   ##CDSN 10                       S01496
     C                     MOVEL*BLANKS   ##CDCN  6                       S01496
     C                     MOVEL*BLANKS   ##PTFR  4                       S01496
     C                     MOVEL*BLANKS   ##CPBI  1                       S01496
     C                     MOVEL*BLANKS   ##CSBI  1                       S01496
     C                     MOVEL*BLANKS   HBLOCK                          S01496
     C*                                                                   S01496
     C** AFTER THE CUSTOMER INFORMATIONS WAS RECEIVED FROM BASIC FILE     S01496
     C** LF/CLINT                                                         S01496
      *                                                                   CSE007
      ***  If Corporate Actions feature is installed.                     CSE007
      ***  or Securities Redenomination is installed.                     CEU017
      *                                                                   CSE007
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
      *                                                                   CSE007
      ***  Search if there is a Corporate Actions General Block           CSE007
      ***  Purchased and/or Sales for Customer by calling RPG/SE7574 with CSE007
      ***  parameters:                                                    CSE007
      ***  - Branch Code (3A): current                       ##CDBR       CSE007
      ***  - Customer    (6A): current                       ##CDCN       CSE007
      ***  - Portfolio   (4A): blank                         ##PTFR       CSE007
      ***  - Customer Purch.Gen.Block Ind. (1A): blank       ##CPBI       CSE007
      ***  - Customer Sales Gen.Block Ind. (1A): blank       ##CSBI       CSE007
      *                                                                   CSE007
     C                     MOVE 'Y'       SE6714                          CSE007
     C                     MOVE SAVBR     ##CDBR                          CSE007
     C                     MOVE SCUST     ##CDCN                          CSE007
     C                     CALL 'SE7574'                                  CSE007
     C                     PARM           ##CDBR                          CSE007
     C                     PARM           ##CDCN                          CSE007
     C                     PARM           ##PTFR                          CSE007
     C                     PARM           ##CPBI                          CSE007
     C                     PARM           ##CSBI                          CSE007
      *                                                                   CSE007
      ***  If 'Customer Purchased General Block Indicator' = 'Y' or       CSE007
      ***  'Customer Sales General Block Indicator' = 'Y', add the new    CSE007
      ***  Block Information either of 'GB', 'GP', 'GS', depending        CSE007
      ***  contens of received indicators.                                CSE007
      *                                                                   CSE007
     C                     SELEC                                          CSE007
     C           ##CPBI    WHEQ 'Y'                                       CSE007
     C           ##CSBI    ANDEQ'Y'                                       CSE007
     C                     MOVEL'GB'      HBLOCK                          CSE007
     C           ##CPBI    WHEQ 'Y'                                       CSE007
     C                     MOVEL'GP'      HBLOCK                          CSE007
     C           ##CSBI    WHEQ 'Y'                                       CSE007
     C                     MOVEL'GS'      HBLOCK                          CSE007
     C                     ENDSL                                          CSE007
      *                                                                   CSE007
      ***  If there is a Corporate Actions General Block Purchased        CSE007
      ***  and/or Sales for Customer, setup work field to not call        CSE007
      ***  RPG/SE6714.                                                    CSE007
      *                                                                   CSE007
     C           HBLOCK    IFNE *BLANKS                                   CSE007
     C                     MOVE 'N'       SE6714                          CSE007
     C                     ELSE                                           CSE007
      *                                                                   CSE007
      ***  Else initialization parameters to call RPG/SE6714.             CSE007
      *                                                                   CSE007
     C                     MOVEL*BLANKS   ##CDBR  3                       CSE007
     C                     MOVEL*BLANKS   ##CDSN 10                       CSE007
     C                     MOVEL*BLANKS   ##CDCN  6                       CSE007
     C                     MOVEL*BLANKS   ##PTFR  4                       CSE007
     C                     MOVEL*BLANKS   ##CPBI  1                       CSE007
     C                     MOVEL*BLANKS   ##CSBI  1                       CSE007
     C                     MOVEL*BLANKS   HBLOCK                          CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
      ***  If there is no Corporate Actions General Block Purchased       CSE007
      ***  and Sales for Customer or if Corporate Actions feature is      CSE007
      ***  switched OFF.                                                  CSE007
      *                                                                   CSE007
     C           SE6714    IFEQ 'Y'                                       CSE007
     C*                                                                   S01496
     C** 1. SEARCH IF THERE IS A GENERAL BLOCK PURCHASED AND/OR SALES FOR S01496
     C**    CUSTOMER BY CALLING RPG/SE6714 WITH PARAMETERS:               S01496
     C**     - BRANCH CODE (3A)  CURRENT                       ##CDBR     S01496
     C**     - CUSTOMER    (6A)  CURRENT                       ##CDCN     S01496
     C**     - PORTFOLIO   (4A)  BLANK                         ##PTFR     S01496
     C**     - CUSTOMER PURCH.GEN.BLOCK IND. (1A)  BLANK       ##CPBI     S01496
     C**     - CUSTOMER SALES GEN.BLOCK IND. (1A)  BLANK       ##CSBI     S01496
     C                     MOVE SAVBR     ##CDBR                          S01496
     C                     MOVE SCUST     ##CDCN                          S01496
     C                     CALL 'SE6714'                                  S01496
     C                     PARM           ##CDBR                          S01496
     C                     PARM           ##CDCN                          S01496
     C                     PARM           ##PTFR                          S01496
     C                     PARM           ##CPBI                          S01496
     C                     PARM           ##CSBI                          S01496
     C*                                                                   S01496
     C** 2. IF 'CUSTOMER PURCH.GEN.BLOCK IND.' = 'Y' OR                   S01496
     C**       'CUSTOMER SALES GEN.BLOCK IND.' = 'Y'                      S01496
     C*                                                                   S01496
     C** 2.1 ADD ON THE HEADER RECORD, AFTER TOWN AND UNDER 'RUN DATE'    S01496
     C**     THE NEW BLOCK INFORMATION EITHER OF 'GB', 'GP', 'GS',        S01496
     C**     DEPENDING CONTENS OF RECEIVED INDICATORS.                    S01496
     C                     SELEC                                          S01496
     C           ##CPBI    WHEQ 'Y'                                       S01496
     C           ##CSBI    ANDEQ'Y'                                       S01496
     C                     MOVEL'GB'      HBLOCK                          S01496
     C           ##CPBI    WHEQ 'Y'                                       S01496
     C                     MOVEL'GP'      HBLOCK                          S01496
     C           ##CSBI    WHEQ 'Y'                                       S01496
     C                     MOVEL'GS'      HBLOCK                          S01496
     C                     ENDSL                                          S01496
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
     C*                                                                   S01496
     C                     ENDSR                                          S01496
     ******************************************************************   S01496
     C/EJECT                                                              S01496
     ******************************************************************   S01496
     C* P002   : CHANGE SCREEN DETAILS                                *   S01496
     C*                                                               *   S01496
     C* Called  By   PROCES                                           *   S01496
     ******************************************************************   S01496
     C*                                                                   S01496
     C           P002      BEGSR                                          S01496
     C*                                                                   S01496
     C** PARAMETERS - INITIALIZATION                                      S01496
     C                     MOVEL*BLANKS   ##CPBI                          S01496
     C                     MOVEL*BLANKS   ##CSBI                          S01496
     C                     MOVEL*BLANKS   GBLOCK                          S01496
     C**********           Z-ADD0         ##CDC1                                       227267 CSD027
     C                     MOVE *BLANKS   ##CDC1                                              CSD027
     C*                                                                   S01496
     C** AFTER THE SECURITY INFORMATIONS WAS RECEIVED FROM BASIC FILE     S01496
     C** LF/SECTY                                                         S01496
      *                                                                   CSE007
      ***  If Corporate Actions feature is installed.                     CSE007
      ***  or Securities Redenomination is installed.                     CEU017
      *                                                                   CSE007
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
      *                                                                   CSE007
      ***  Search if there is a Corporate Actions General Block Purchased CSE007
      ***  and/or Sales for Security by calling RPG/7572 with parameters: CSE007
      ***  - Branch Code (3A):  current                      ##CDBR       CSE007
      ***  - Security    (10A): current                      ##CDSN       CSE007
      ***  - Security Purch.Gen.Block Ind. (1A): blank       ##CPBI       CSE007
      ***  - Security Sales Gen.Block Ind. (1A): blank       ##CSBI       CSE007
      *                                                                   CSE007
     C                     MOVE 'Y'       SE6712                          CSE007
     C                     MOVE SAVBR     ##CDBR                          CSE007
     C                     MOVELSAVSEC    ##CDSN                          CSE007
     C                     MOVELSCUST     WORK1                           227267
     C                     CALL 'SE7572'                                  CSE007
     C                     PARM           ##CDBR                          CSE007
     C                     PARM           ##CDSN                          CSE007
     C                     PARM           ##CDC1                          227267
     C                     PARM           ##CPBI                          CSE007
     C                     PARM           ##CSBI                          CSE007
      *                                                                   CSE007
      ***  If 'Security Purchased General Block Indicator' = 'Y' or       CSE007
      ***  'Security Sales General Block Indicator' = 'Y', add the        CSE007
      ***  Block Information either of 'GB', 'GP', 'GS', depending        CSE007
      ***  contens of received indicators.                                CSE007
      *                                                                   CSE007
     C                     SELEC                                          CSE007
     C           ##CPBI    WHEQ 'Y'                                       CSE007
     C           ##CSBI    ANDEQ'Y'                                       CSE007
     C                     MOVEL'GB'      GBLOCK                          CSE007
     C           ##CPBI    WHEQ 'Y'                                       CSE007
     C                     MOVEL'GP'      GBLOCK                          CSE007
     C           ##CSBI    WHEQ 'Y'                                       CSE007
     C                     MOVEL'GS'      GBLOCK                          CSE007
     C                     ENDSL                                          CSE007
      *                                                                   CSE007
      ***  If there is a Corporate Actions General Block Purchased        CSE007
      ***  and/or Sales for Security, setup work field to not call        CSE007
      ***  RPG/SE6712.                                                    CSE007
      *                                                                   CSE007
     C           GBLOCK    IFNE *BLANKS                                   CSE007
     C                     MOVE 'N'       SE6712                          CSE007
     C                     ELSE                                           CSE007
      *                                                                   CSE007
      ***  Else initialization parameters to call RPG/SE6712.             CSE007
      *                                                                   CSE007
     C                     MOVEL*BLANKS   ##CPBI                          CSE007
     C                     MOVEL*BLANKS   ##CSBI                          CSE007
     C                     MOVEL*BLANKS   GBLOCK                          CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
      ***  If there is no Corporate Actions General Block Purchased       CSE007
      ***  and Sales for Security or if Corporate Actions feature is      CSE007
      ***  switched OFF.                                                  CSE007
      *                                                                   CSE007
     C           SE6712    IFEQ 'Y'                                       CSE007
     C*                                                                   S01496
     C** 1. SEARCH IF THERE IS A GENERAL BLOCK PURCHASED AND/OR SALES FOR S01496
     C**    SECURITY BY CALLING RPG/SE6712 WITH PARAMETERS:               S01496
     C**     - BRANCH CODE (3A)  CURRENT                       ##CDBR     S01496
     C**     - SECURITY    (10A) CURRENT                       ##CDSN     S01496
     C**     - SECURITY PURCH.GEN.BLOCK IND. (1A)  BLANK       ##CPBI     S01496
     C**     - SECURITY SALES GEN.BLOCK IND. (1A)  BLANK       ##CSBI     S01496
     C                     MOVE SAVBR     ##CDBR                          S01496
     C                     MOVELSAVSEC    ##CDSN                          S01496
     C                     CALL 'SE6712'                                  S01496
     C                     PARM           ##CDBR                          S01496
     C                     PARM           ##CDSN                          S01496
     C                     PARM           ##CPBI                          S01496
     C                     PARM           ##CSBI                          S01496
     C*                                                                   S01496
     C** 2. IF 'SECURITY PURCH.GEN.BLOCK IND.' = 'Y' OR                   S01496
     C**       'SECURITY SALES GEN.BLOCK IND.' = 'Y'                      S01496
     C*                                                                   S01496
     C** 2.1 ADD ON THE HEADER RECORD, AFTER SECURITY DESCRIPTION (*)     S01496
     C**     BLOCK INFORMATION EITHER OF 'GB', 'GP', 'GS', DEPENDING      S01496
     C**     CONTENS OF RECEIVED INDICATORS.                              S01496
     C                     SELEC                                          S01496
     C           ##CPBI    WHEQ 'Y'                                       S01496
     C           ##CSBI    ANDEQ'Y'                                       S01496
     C                     MOVEL'GB'      GBLOCK                          S01496
     C           ##CPBI    WHEQ 'Y'                                       S01496
     C                     MOVEL'GP'      GBLOCK                          S01496
     C           ##CSBI    WHEQ 'Y'                                       S01496
     C                     MOVEL'GS'      GBLOCK                          S01496
     C                     ENDSL                                          S01496
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
     C*                                                                   S01496
     C** PARAMETERS - INITIALIZATION                                      S01496
     C                     MOVEL*BLANKS   ##PTFR                          S01496
     C                     MOVEL*BLANKS   ##CPBI                          S01496
     C                     MOVEL*BLANKS   ##CSBI                          S01496
     C                     MOVEL*BLANKS   SBLOCK                          S01496
      *                                                                   CSE007
      ***  If Corporate Actions feature is installed.                     CSE007
      ***  or Securities Redenomination is installed.                     CEU017
      *                                                                   CSE007
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
      *                                                                   CSE007
      ***  Search if there is a Corporate Actions Specific Block          CSE007
      ***  Purchased And/or Sales for Customer/Security by calling        CSE007
      ***  RPG/SE7576 with parameters:                                    CSE007
      ***  - Branch Code (3A):  current                      ##CDBR       CSE007
      ***  - Customer    (6A):  current                      ##CDCN       CSE007
      ***  - Security    (10A): current                      ##CDSN       CSE007
      ***  - Portfolio   (4A):  blank                        ##PTFR       CSE007
      ***  - Purch.Spec.Block Ind. (1A): blank               ##CPBI       CSE007
      ***  - Sales Spec.Block Ind. (1A): blank               ##CSBI       CSE007
      *                                                                   CSE007
     C                     MOVE 'Y'       SE6716                          CSE007
     C                     MOVE SAVBR     ##CDBR                          CSE007
     C                     MOVE SCUST     ##CDCN                          CSE007
     C                     MOVELSAVSEC    ##CDSN                          CSE007
     C                     CALL 'SE7576'                                  CSE007
     C                     PARM           ##CDBR                          CSE007
     C                     PARM           ##CDCN                          CSE007
     C                     PARM           ##CDSN                          CSE007
     C                     PARM           ##PTFR                          CSE007
     C                     PARM           ##CPBI                          CSE007
     C                     PARM           ##CSBI                          CSE007
      *                                                                   CSE007
      ***  If 'Purchased Specific Block Indicator' = 'Y' or               CSE007
      ***  'Sales Specific Block Indicator' = 'Y', add the Block          CSE007
      ***  Information either of 'SB', 'SP', 'SS', depending contens of   CSE007
      ***  received indicators.                                           CSE007
      *                                                                   CSE007
     C                     SELEC                                          CSE007
     C           ##CPBI    WHEQ 'Y'                                       CSE007
     C           ##CSBI    ANDEQ'Y'                                       CSE007
     C                     MOVEL'SB'      SBLOCK                          CSE007
     C           ##CPBI    WHEQ 'Y'                                       CSE007
     C                     MOVEL'SP'      SBLOCK                          CSE007
     C           ##CSBI    WHEQ 'Y'                                       CSE007
     C                     MOVEL'SS'      SBLOCK                          CSE007
     C                     ENDSL                                          CSE007
      *                                                                   CSE007
      ***  If there is a Corporate Actions Specific Block Purchased       CSE007
      ***  and/or Sales for Customer/Security, setup work field to not    CSE007
      ***  call RPG/SE6716.                                               CSE007
      *                                                                   CSE007
     C           SBLOCK    IFNE *BLANKS                                   CSE007
     C                     MOVE 'N'       SE6716                          CSE007
     C                     ELSE                                           CSE007
      *                                                                   CSE007
      ***  Else initialization parameters to call RPG/SE6716.             CSE007
      *                                                                   CSE007
     C                     MOVEL*BLANKS   ##PTFR                          CSE007
     C                     MOVEL*BLANKS   ##CPBI                          CSE007
     C                     MOVEL*BLANKS   ##CSBI                          CSE007
     C                     MOVEL*BLANKS   SBLOCK                          CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
      ***  If there is no Corporate Actions Specific Block Purchased      CSE007
      ***  and Sales for Customer/Security or if Corporate Actions        CSE007
      ***  feature is switched OFF.                                       CSE007
      *                                                                   CSE007
     C           SE6716    IFEQ 'Y'                                       CSE007
     C*                                                                   S01496
     C** 3. SEARCH IF THERE IS A SPECIFIC BLOCK PURCHASED AND/OR SALES    S01496
     C**    FOR CUSTOMER/SECURITY BY CALLING RPG/SE6716 WITH PARAMETERS:  S01496
     C**     - BRANCH CODE (3A)  CURRENT                       ##CDBR     S01496
     C**     - CUSTOMER    (6A)  CURRENT                       ##CDCN     S01496
     C**     - SECURITY    (10A) CURRENT                       ##CDSN     S01496
     C**     - PORTFOLIO   (4A)  BLANK                         ##PTFR     S01496
     C**     - PURCH.SPEC.BLOCK IND. (1A)  BLANK               ##CPBI     S01496
     C**     - SALES SPEC.BLOCK IND. (1A)  BLANK               ##CSBI     S01496
     C                     MOVE SAVBR     ##CDBR                          S01496
     C                     MOVE SCUST     ##CDCN                          S01496
     C                     MOVELSAVSEC    ##CDSN                          S01496
     C                     CALL 'SE6716'                                  S01496
     C                     PARM           ##CDBR                          S01496
     C                     PARM           ##CDCN                          S01496
     C                     PARM           ##CDSN                          S01496
     C                     PARM           ##PTFR                          S01496
     C                     PARM           ##CPBI                          S01496
     C                     PARM           ##CSBI                          S01496
     C*                                                                   S01496
     C** 4. IF 'PURCH.SPECIFIC BLOCK IND.' = 'Y' OR                       S01496
     C**       'SALES SPECIFIC BLOCK IND.' = 'Y'                          S01496
     C*                                                                   S01496
     C** 4.1 ADD ON THE HEADER RECORD, AFTER SECURITY DESCRIPTION (*)     S01496
     C**     BLOCK INFORMATION EITHER OF 'SB', 'SP', 'SS', DEPENDING      S01496
     C**     CONTENS OF RECEIVED INDICATORS.                              S01496
     C                     SELEC                                          S01496
     C           ##CPBI    WHEQ 'Y'                                       S01496
     C           ##CSBI    ANDEQ'Y'                                       S01496
     C                     MOVEL'SB'      SBLOCK                          S01496
     C           ##CPBI    WHEQ 'Y'                                       S01496
     C                     MOVEL'SP'      SBLOCK                          S01496
     C           ##CSBI    WHEQ 'Y'                                       S01496
     C                     MOVEL'SS'      SBLOCK                          S01496
     C                     ENDSL                                          S01496
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
     C*                                                                   S01496
     C                     ENDSR                                          S01496
      *================================================================
      /EJECT
     C*****************************************************************
     C**                                                              *
     C**    COMMD   SR   To process Command Keys                      *
     C*******************and*HELP,*ROLLUP*and*ROLLDOWN***             *
     C**                 ROLLUP and ROLLDOWN                          *
     C**                                                              *
     C**    Called  By   MAIN                                         *
     C**    Calls   SR   ROLLUP, CLEAR, CUSTIN                        *
     C******Calls**PGM***MHELP,*SE0270***                             *
     C**    Calls  PGM   SE0270                                       *
     C**                                                              *
     C*****************************************************************
     C**
     C           COMMD     BEGSR                           ** COMMD **
     C**
     C*****If*HELP*pressed*call*help*screen
     C***********
     C***********AID       IFEQ 'HP'                                      S01199
     C***********          CALL 'MHELP'                                   S01199
     C***********          PARM           PGMNO                           S01199
     C***********          PARM           HERCD 160                       S01199
     C***********          END                                            S01199
     C**
     C**    If Rollup key pressed
     C**
     C           AID       IFEQ 'UP'
     C                     EXSR ROLLUP
     C                     END
     C**
     C**    If F3 then exit to menu - return code 1 and end
     C**
     C           AID       IFEQ '01'
     C                     MOVE '1'       RTNC
     C                     MOVE '1'       *IN01
     C                     END
     C**
     C**    If F12 then return to previous enquiry - return code 2
     C**                  unless there is no previous enquiry
     C**
     C           AID       IFEQ '02'
     C           ORIG      IFNE PGMNO
     C                     MOVE '2'       RTNC
     C                     MOVE '1'       *IN01
     C                     ELSE
     C                     MOVE '1'       *IN42
     C                     MOVE MSG,6     ERMSG
     C                     END
     C                     END
     C**
     C**    If F5 then refresh enquiry screen
     C**
     C           AID       IFEQ '05'
     C                     MOVE *BLANKS   SCUST                           089937
     C                     MOVE *BLANKS   CUSTMR                          089937
     C                     MOVE *BLANKS   BRANCH                          089937
     C                     MOVE *BLANKS   WSVCUS                          089937
     C                     MOVE *BLANKS   WSVBRC                          089937
     C                     EXSR CLEAR
     C                     END
     C**
     C**    If F6 then call Customer Shortname Enquiry
     C**             on return check return code
     C**             if 0 then Database Error and exit required
     C**             if 1 then F3 and exit to menu required
     C**
     C           AID       IFEQ '06'
     C                     MOVE ' '       RTNC
     C                     OUT  SESDS
     C                     OUT  LDA
     C                     CALL 'SE0270'
     C           *LOCK     IN   LDA
     C           *LOCK     IN   SESDS
     C           RTNC      IFEQ '0'
     C           RTNC      OREQ '1'
     C                     MOVE '1'       *IN01
     C                     ELSE
     C                     MOVELRQCUST    CUSTMR
     C                     MOVE *BLANKS   RQCUST
     C           *IN07     IFEQ '0'
     C                     EXSR CUSTIN
     C                     END
     C                     END
     C                     END
     C**
     C**     If F9 then return to initial enquiry - return code 7
     C**                   unless this is the initial program
     C**
     C           AID       IFEQ '07'
     C           ORIG      IFNE PGMNO
     C                     MOVE '7'       RTNC
     C                     MOVE '1'       *IN01
     C                     ELSE
     C                     MOVE '1'       *IN42
     C                     MOVE MSG,6     ERMSG
     C                     END
     C                     END
     C**
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C**           ****** AS400 CONVERSION ******                     *   S01179
     C**                                                              *   S01179
     C** ASCHGS S/R TO MOVE THE APPROPRIATE VALUES INTO FIELD AID,    *   S01179
     C** DEPENDING ON WHICH FUNCTION KEY HAS BEEN PRESSED.            *   S01179
     C** CALLED FROM UPDATE                                           *   S01179
     C**                                                              *   S01179
     C*****************************************************************
     C*                                                                   S01179
     C           ASCHGS    BEGSR                                          S01179
     C*                                                                   S01179
     C* If ENTER pressed, the VLDCMDKEY indicator will be off             S01179
     C*                                                                   S01179
     C           *IN10     IFEQ '0'                                       S01179
     C                     MOVE 'RA'      AID                             S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F3                                                             S01179
     C*                                                                   S01179
     C           *INKC     IFEQ '1'                                       S01179
     C                     MOVE '01'      AID                             S01179
     C                     MOVE '0'       *INKC                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F5                                                             S01179
     C*                                                                   S01179
     C           *INKE     IFEQ '1'                                       S01179
     C                     MOVE '05'      AID                             S01179
     C                     MOVE '0'       *INKE                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F6                                                             S01179
     C*                                                                   S01179
     C           *INKF     IFEQ '1'                                       S01179
     C                     MOVE '06'      AID                             S01179
     C                     MOVE '0'       *INKF                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F9                                                             S01179
     C*                                                                   S01179
     C           *INKI     IFEQ '1'                                       S01179
     C                     MOVE '07'      AID                             S01179
     C                     MOVE '0'       *INKI                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F12                                                            S01179
     C*                                                                   S01179
     C           *INKL     IFEQ '1'                                       S01179
     C                     MOVE '02'      AID                             S01179
     C                     MOVE '0'       *INKL                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If ROLLUP pressed                                                 S01179
     C*                                                                   S01179
     C           *IN20     IFEQ '1'                                       S01179
     C                     MOVE 'UP'      AID                             S01179
     C                     MOVE '0'       *IN20                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C**If*HELP*key*pressed                                        S01179 S01199
     C*                                                                   S01179
     C************IN21     IFEQ '1'                                S01179 S01199
     C***********          MOVE 'HP'      AID                      S01179 S01199
     C***********          MOVE '0'       *IN21                    S01179 S01199
     C***********          END                                     S01179 S01199
     C*                                                                   S01179
     C                     ENDSR                                          S01179
     C*                                                                   S01179
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C**                                                              *
     C**   ROLLUP SR  When Rollup key is pressed load next page unless*
     C**              last page already displayed when error message  *
     C**                                                              *
     C**   Called by  COMMD                                           *
     C**   Calls  SR  DISP                                            *
     C**                                                              *
     C*****************************************************************
     C**
     C           ROLLUP    BEGSR                           ** ROLLUP **
     C**
     C**   If details Complete then Rollup is beyond last record
     C**
     C           *IN05     IFEQ '1'
     C                     MOVE '1'       *IN06
     C**
     C                     ELSE
     C**
     C**   Load next page of subfile
     C**
     C                     Z-ADDTOP       SFLREC
     C*                                                                   E37290
     C** Need to reset file so the last record is read again              E37290
     C*                                                                   E37290
     C********** KEYUP     SETLLCDEPP                              E37290 159599
     C**********           MOVE 'Y'       TROLL   1                088303 159599
     C                     EXSR DISP
     C**
     C                     END
     C**
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C**                                                              *
     C**   OPTION SR  To check validity of option combinations        *
     C**                                                              *
     C**   Called by  MAIN                                            *
     C**   Calls  SR  none                                            *
     C**                                                              *
     C*****************************************************************
     C**
     C           OPTION    BEGSR                            ** OPTION *
     C**
     C                     MOVE *BLANKS   OPTN
     C**
     C**     If no subfile records the only possible entry is cust
     C**
     C           *IN03     IFEQ '1'
     C**
     C           CUSTMR    IFEQ *BLANKS
     C                     MOVE '1'       *IN42
     C                     MOVE MSG,1     ERMSG
     C                     END
     C**
     C                     ELSE
     C**
     C                     READCSE0215S0                 40
     C**
     C**     Check if any entry made
     C**
     C           *IN40     IFEQ '1'
     C           CUSTMR    ANDEQ*BLANKS
     C                     MOVE '1'       *IN42
     C                     MOVE MSG,7     ERMSG
     C                     END
     C**
     C**     Check if both Cust No./Shortname and option entered
     C**
     C           *IN40     IFEQ '0'
     C           CUSTMR    ANDNE*BLANKS
     C           CUSTMR    ANDNEWSVCUS                                    089937
     C                     MOVE '1'       *IN42
     C                     MOVE '1'       *IN41
     C                     MOVE MSG,2     ERMSG
     C                     END
     C**
     C**    Check if more than one option entered
     C**
     C           *IN40     IFEQ '0'
     C                     MOVE SELECT    OPTN
     C                     MOVELSSESN     RQSESN
     C                     MOVE *BLANK    SELECT
     C                     SETOF                     08
     C***********          MOVE SBRCH     RQBRCH                          S01117
     C                     MOVE SBRCH     RQBRCA                          S01117
     C                     MOVE PCUST     RQCUST
     C/COPY WNCPYSRC,SE0215C018
     C                     UPDATSE0215S0
     C**
     C           *IN40     DOUEQ'1'
     C                     READCSE0215S0                 40
     C           *IN40     IFEQ '0'
     C           SELECT    ANDNE*BLANK                                    089937
     C                     MOVE *BLANK    SELECT
     C/COPY WNCPYSRC,SE0215C019
     C                     UPDATSE0215S0
     C           *IN42     IFEQ '0'                                       089937
     C                     MOVE '1'       *IN42
     C                     MOVE MSG,3     ERMSG
     C                     END                                            089937
     C                     END
     C**
     C                     END
     C                     END
     C                     END
     C**
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C**                                                              *
     C**   CUSTIN SR  To process entered CUSTOMER./Shortname          *
     C**                                                              *
     C**   Called by  MAIN, FIRST                                     *
     C**   Calls  SR  SETUP                                           *
     C**              P001                                            *   S01496
     C**                                                              *
     C*****************************************************************
     C**
     C           CUSTIN    BEGSR                            ** CUSTIN *
      ***********
0384 C***********                                                         S01117
0385 C***TO*EVALUATE*WHETHER*NUMBER/SHORTNAME*ENTERED*                    S01117
0386 C***29*ON*IF*SHORTNAME,*30*ON*IF*CUSTNUM*                            S01117
0387 C***********                                                         S01117
     C***********          SETOF                     2930                 S01117
0388 C***********                                                         S01117
0389 C***CHECK*TO*SEE*IF*MORE*THAN*6*CHARS*ENTERED*                       S01117
     C***********                                                         S01117
0390 C***********SCSNMB    IFNE *BLANK                                    S01117
     C***********          MOVE '1'       *IN29                           S01117
     C***********          END                                            S01117
0391 C***********                                                         S01117
0392 C***IF*NOT*MORE*THAN*6*CHARS,*CHECK*FIRST*6*CHARS*NUMERIC*           S01117
     C***********                                                         S01117
0390 C************IN29     IFEQ '0'                                       S01117
     C***********          MOVE *BLANKS   ZFIELD                          S01117
     C***********          MOVELSCSNMA    ZFIELD                          S01117
     C***********          Z-ADD*ZEROS    ZADEC                           S01117
     C***********          Z-ADD6         ZADIG                           S01117
     C***********          EXSR ZALIGN                                    S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          SETON                     29                   S01117
     C***********          ELSE                                           S01117
     C***********          SETON                     30                   S01117
     C***********          END                                            S01117
0390 C***********          END                                            S01117
0396 C***********                                                         S01117
0397 C*****IF*S/NAME*GET*CLINT*REC.*                                      S01117
0398 C***********                                                         S01117
0390 C************IN29     IFEQ '1'                                       S01117
0399 C***********CUSTMR    CHAINSNAME                42                   S01117
     C***********          END                                            S01117
0409 C***********                                                         S01117
0410 C*****IF*CUST*NO.*-*CHECK*IT*EXISTS*ON*CLINT*                        S01117
0411 C***********                                                         S01117
     C***********                                                         S01117
0390 C************IN30     IFEQ '1'                                       S01117
0413 C***********          MOVE SCSNMA    CNUM                            S01117
0414 C***********CNUM      CHAINCLINTCBF             42                   S01117
     C***********          END                                            S01117
0415 C***********                                                         S01117
     C*****If*an*error*reverse*image*the*input*field*and*error*message*   S01117
     C*****but*if*ok*prepare*to*display*the*screen*                       S01117
     C***********                                                         S01117
     C************IN42     IFEQ '1'                                       S01117
      *                                                                   S01117
      ** Access Customer Details file                                     S01117
      *                                                                   S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM CUSTMR    @KEY1  10                       S01117
     C                     PARM           @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
      *
     C           @RTCD     IFNE *BLANKS                                   S01117
0422 C                     MOVELMSG,5     ERMSG
     C                     MOVE '1'       *IN41
     C                     MOVE '1'       *IN42                           S01117
     C                     END
AW   C*
AW   C**If*no*Branch*entered,*use*default*from*TABICD*file*               S01117
     C**If*no*Branch*entered,*use*default*for*user*from*ZMUSER*****S01117 090314
     C* If no Branch entered, use default for customer                    090314
AW   C*
AW   C           BRANCH    IFEQ '   '
AW   C           BRANCH    OREQ '000'
AW   C***********          MOVELDSTB      BRANCH                          S01117
     C***********          MOVELDFTBRC    BRANCH                   S01117 090314
     C                     MOVELBBBRCD    BRANCH                          090314
AW   C                     END
     C**
0410 C*****IF*MULTI-BRANCH*-*CHECK*BRANCH*VALID*IF*ENTERED*               S01117
0411 C***********                                                         S01117
0390 C************IN07     IFEQ '1'                                       S01117
JGW* C***********                                                         S01117
0413 C***********          MOVE *BLANKS   KEY    12                       S01117
0413 C***********          MOVEL'10'      KEY                             S01117
0413 C***********          MOVE BRANCH    KEY                             S01117
     C***********KEY       CHAINTABLETRF             44                   S01117
     C************IN44     IFEQ '0'                                       S01117
0422 C***********RECI      ANDEQ'*'                                       S01117
     C***********          MOVE '1'       *IN44                           S01117
     C***********          END                                            S01117
     C***********          END                                            S01117
0415 C***********                                                         S01117
     C*****If*an*error*reverse*image*the*input*field*and*error*message*   S01117
     C*****but*if*ok*prepare*to*display*the*screen*                       S01117
     C***********                                                         S01117
     C************IN44     IFEQ '1'                                       S01117
      *                                                                   S01117
      ** If multibranching environment, check branch code is valid        S01117
      *                                                                   S01117
     C           *IN07     IFEQ '1'                                       S01117
      *                                                                   S01117
      ** Access branch codes file SDBRCHPD via access object program      S01117
      *                                                                   S01117
     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM BRANCH    @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01117              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANKS                                   S01117
      *                                                                   S01117
      ** If an error reverse image the input field and error message      S01117
      *                                                                   S01117
0422 C                     MOVELMSG,8     ERMSG
     C                     MOVE '1'       *IN42
     C                     MOVE '1'       *IN44                           S01117
     C                     ELSE                                           S01117
      *                                                                   S01117
      ** Check user is authorised to valid branch                         S01117
      *                                                                   S01117
     C                     CALL 'ZVBBU'                                   S01117
     C                     PARM BRANCH    @ZBR    3                       S01117
     C                     PARM           @ERR    10                      S01117
     C           @ERR      IFNE 0                                         S01117
     C                     MOVEA'11'      *IN,42                          S01117
     C                     MOVE MSG,10    ERMSG                           S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     END
      *                                                                   S01117
     C                     END                                            S01117
     C**
     C**   If customer is on file - check it is a portfolio customer
     C**   (ie has discretionary indicator of D or S)
     C**
     C           *IN42     IFEQ '0'
     C**
     C*****ACCESS*CLINTSE*FOR*PORTFOLIO*CUSTOMER*                         S01117
     C***********                                                         S01117
     C***********          MOVE CNUM      PCUST   60                      S01117
     C***********PCUST     CHAINCLINTSEF             25                   S01117
     C**N25******RECI      COMP 'D'                  2525                 S01117
     C***********                                                         S01117
     C*******If*no*record*found*or*deleted*record*                        S01117
     C**********then*it*is*a*database*error*so*return*to*calling*         S01117
     C**********program with a return code of '0'                         S01117
     C***********                                                         S01117
     C************IN25     IFEQ '1'                                       S01117
      *                                                                   S01117
     C                     MOVE BBCUST    @PCUST  6                       S01117
      *                                                                   S01117
      ** Access securities clients details                                S01117
      *                                                                   S01117
     C                     CALL 'AOSECSR0'                                S01117
     C***********          PARM '*DBERR'  @RTCD   7                 S01117E26473
     C                     PARM *BLANKS   @RTCD   7                       E26473
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM @PCUST    @AENB   6                       S01117
     C           SDSECS    PARM SDSECS    DSSDY                           S01117
      ***********                                                         S01117
      ***********                                                         S01117
      ***If*no*record found then it is a database error so return to      S01117
      ***calling*program with a return code of '0'                        S01117
      ***********                                                         S01117
     C***********          MOVELPROGRM    DBPGM                           S01117
     C***********          MOVELPCUST     DBKEY            ***************S01117
     C***********          MOVE 'CLINT'   DBFILE           * DB ERROR 05 *S01117
     C***********          Z-ADD05        DBASE            ***************S01117
     C***********          SETON                       U7U8               S01117
     C***********          MOVE '0'       RTNC                            S01117
     C***********          EXSR RETSR                                     S01117
     C***********          END                                            S01117
     C***********C1DI      IFNE 'D'                                       S01117
     C***********C1DI      ANDNE'S'                                       S01117
      *                                                                   E26473
     C           @RTCD     IFNE *BLANKS                                   E26473
      *                                                                   E26473
     C                     MOVELMSG,11    ERMSG                           E26473
     C                     SETON                     4142                 E26473
     C                     ELSE                                           E26473
     C           BFCLAS    IFNE 'D'                                       S01117
     C           BFCLAS    ANDNE'S'                                       S01117
     C                     MOVELMSG,9     ERMSG
     C                     SETON                     4142
     C                     END
     C                     END                                            E26473
     C                     END
     C**
     C**   If all OK prepare to display the screen
     C**
     C           *IN42     IFEQ '0'
     C                     EXSR SETUP
     C                     MOVELCUSTMR    WSVCUS 10                       089937
     C                     MOVELBRANCH    WSVBRC  3                       089937
     C*                                                                   S01496
     C           S01496    IFEQ 'Y'                                       S01496
     C           CSE007    OREQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C                     EXSR P001                                      S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C                     END
     C**
     C***SINCE*ZPRCOZ1*S/R*HAS*BEEN*COMMENTED*OUT*FOR*A*S01186*ERROR***   E16894
     C***FIX,*THE*PROGRAM*HAS*LOST*ITS*DEFINITION*OF*ZPRICE*SO*IT*IS***   E16894
     C***NOW*DEFINED*WITHIN*THE*PROGRAM*HERE***************************   E16894
     C*                                                                   E16894
     C***********          Z-ADD0         ZPRICE 158                      E16894
     C*                                                            S01186 E16894
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C**                                                              *
     C**   SETUP  SR  To prepare for Screen Display                   *
     C**                                                              *
     C**   Called by  CUSTIN                                          *
     C**   Calls  SR  CLEAR, DISP                                     *
     C**                                                              *
     C*****************************************************************
     C**
     C           SETUP     BEGSR                           ** SETUP **
     C**
     C***********          MOVE *BLANKS   CUSTMR                          088776
     C***********          MOVE CNUM      PCUST   60                      S01117
     C***********          MOVE CNUM      SCUST                           S01117
     C***********          MOVE BRANCH    SAVBR   30                      S01117
     C                     MOVE BBCUST    @PCUST                          S01117
     C                     MOVE BBCUST    SCUST                           S01117
     C                     MOVE BRANCH    SAVBR   3                       S01117
     C**
     C**   Clear the Screen
     C**
     C                     EXSR CLEAR
     C**
     C**   Move CUST  Details to output fields
     C**
     C***********          MOVE CRNM      SCRNM  20                       S01117
     C***********          MOVE CTWN      SCTWN  10                       S01117
     C                     MOVE BBCRNM    SCRNM  20                       S01117
     C                     MOVE BBCRTN    SCRTN  10                       S01117
     C**
     C*****ACCESS*TABTG10*FOR*PORTFOLIO*CURRENCY*                         S01117
     C***********                                                         S01117
     C***********          MOVEL'20      'TKEY   12                       S01117
     C***********          MOVELC1PC      ZWK4    4                       S01117
     C***********          MOVE 1         ZWK4                            S01117
     C***********          MOVE ZWK4      TKEY                            S01117
     C***********TKEY      CHAINTABTG10F             25                   S01117
     C**N25******RECI      COMP 'D'                  2525                 S01117
     C***********                                                         S01117
     C*******If*no record found  or deleted record                        S01117
     C**********then it is a database error so return to calling          S01117
     C**********program with a return code of '0'                         S01117
     C***********                                                         S01117
     C************IN25     IFEQ '1'                                       S01117
      *                                                                   S01117
      ** Access currency file SDCURRPD                                    S01117
      *                                                                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR'  @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM BFPCYC    @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
      ***********                                                         S01117
      ***If*no*record*found*then*it*is*a*database*error*so*return*to*     S01117
      ***calling*program*with*a*return*code*of*'0'*******************     S01117
      ***********                                                         S01117
     C***********          MOVELPROGRM    DBPGM                           S01117
     C***********          MOVELTKEY      DBKEY            ***************S01117
     C***********          MOVE 'TABLE'   DBFILE           * DB ERROR 09 *S01117
     C***********          Z-ADD09        DBASE            ***************S01117
     C***********          SETON                       U7U8               S01117
     C***********          MOVE '0'       RTNC                            S01117
     C***********          EXSR RETSR                                     S01117
     C***********          END                                            S01117
     C***********                                                         S01117
     C***********          MOVE C1PC      SNMCYA                          S01117
     C***********          MOVE CCNM      SC1PC                           S01117
     C***********          Z-ADDCDP       PCCDP   10                      S01117
     C                     MOVE BFPCYC    SNMCYA                          S01117
     C                     MOVE A6CYNM    SPCYC                           S01117
     C                     Z-ADDA6NBDP    PCCDP   10                      S01117
     C**
     C**   Position CEPPP file at start of required customer/branch
     C**
     C***********SAVBR     IFEQ 0                                         S01117
     C***********          MOVE DSTB      SAVBR                           S01117
     C           SAVBR     IFEQ *BLANKS                                   S01117
     C***********          MOVE DFTBRC    SAVBR                    S01117 090314
     C                     MOVE BBBRCD    SAVBR                           090314
     C                     END
     C********** KEYC      SETLLCDEPP                                                         233736
     C           KEYC      SETLLCDEPF                                                         233736
     C                     MOVE SAVBR     SBRCH
     C**
     C**   Reset Accumulators for Screen Details
     C**
     C                     MOVE *BLANKS   SAVSEC 10
     C                     Z-ADD*ZEROS    ZZNOML
     C                     Z-ADD*ZEROS    ZNOMP
     C                     Z-ADD*ZEROS    ZZNOMU
     C                     Z-ADD*ZEROS    ZZPUR
     C                     Z-ADD*ZEROS    ZZSAL
     C                     Z-ADD*ZEROS    ZZAPP
     C                     Z-ADD*ZEROS    ZZAPS
     C                     Z-ADD*ZEROS    ZCUMCP
     C                     Z-ADD*ZEROS    TOTMVP
     C                     Z-ADD*ZEROS    TOTBVP
     C**********           MOVE 'N'       TROLL                    099435 159599
     C**
     C**   Get details for display
     C**
     C                     EXSR DISP
     C**
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C**                                                              *
     C**   CLEAR  SR  Clear the screen display fields and indicators  *
     C**                                                              *
     C**   Called by  COMMD, SETUP                                    *
     C**   Calls  SR  none                                            *
     C**                                                              *
     C*****************************************************************
     C**
     C           CLEAR     BEGSR
     C**
     C** Set up fields and indicators to clear subfile
     C**
     C                     MOVE *BLANKS   SCRNM
     C***********          MOVE *BLANKS   SCTWN                           S01117
     C                     MOVE *BLANKS   SCRTN                           S01117
     C***********          MOVE *BLANKS   CUSTMR                          088776
     C***********          MOVE *BLANKS   BRANCH                          088776
     C***********          MOVE *BLANKS   SC1PC                           S01117
     C                     MOVE *BLANKS   SPCYC                           S01117
     C                     MOVE *BLANKS   SBRCH
     C**
     C                     Z-ADD0         SFLREC  40
     C                     Z-ADD0         TOP     40
     C**
     C                     SETON                       03
     C                     SETOF                       040550
     C                     SETOF                       518189
     C                     SETOF                       5960
     C**  CLEAR SUBFILE
     C                     SETON                       02
     C                     WRITESE0215C0
     C                     SETOF                       02
     C**
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C**                                                              *
     C**   DISP   SR  Accumulate details for screen display           *
     C**                                                              *
     C**   Called by  SETUP, ROLLUP                                   *
     C**   Calls  SR  PROCES                                          *
     C**                                                              *
     C*****************************************************************
     C**
     C           DISP      BEGSR                           *** DISP ***
     C**
     C                     Z-ADD0         OUTREC  20
     C                     MOVE '0'       *IN89
     C                     MOVE *BLANKS   PCPOS                                               233736
     C**
     C**  IF STILL PROCESSING SFL RECS - GOTO S/R
     C**
     C           *IN51     IFEQ '1'
     C                     EXSR PROCES
     C           OUTREC    IFEQ 14
     C                     SETON                     89
     C                     END
     C                     EXSR R0455                                     159599
     C**                                                                  E31795
     C**   Accumulate details for a Security                              E31795
     C**                                                                  E31795
     C**********           ADD  CDNV      ZCUMCP                   E31795 159599
     C**********           ADD  CNPV      ZCUMCP                   E31795 159599
     C**********           ADD  CNSV      ZCUMCP                   E31795 159599
     C***********          SUB  CECN      ZCUMCP                    E31795E36865
     C********** BVTVDV    IFEQ 'T'                                E31795 159599
     C**********           ADD  CDNT      ZNOMP                    E31795 159599
     C**********           ADD  CDNT      ZZNOML                   E31795 159599
     C**********           ADD  SNPT      ZZNOML                   E31795 159599
     C**********           ADD  CDST      ZZNOML                   E31795 159599
     C**********           ADD  CDNV      ZZNOMU                   E31795 159599
     C**********           ADD  CNPV      ZZNOMU                   E31795 159599
     C**********           ADD  CNSV      ZZNOMU                   E31795 159599
     C**********           ADD  SNPT      ZZPUR                    E31795 159599
     C**********           ADD  CDST      ZZSAL                    E31795 159599
     C**********           ADD  SAPP      ZZAPP                    E31795 159599
     C**********           ADD  SAPS      ZZAPS                    E31795 159599
     C**********           ELSE                                    E31795 159599
     C**********           ADD  CDNV      ZNOMP                    E31795 159599
     C**********           ADD  CDNV      ZZNOML                   E31795 159599
     C**********           ADD  CNPV      ZZNOML                   E31795 159599
     C**********           ADD  CNSV      ZZNOML                   E31795 159599
     C**********           ADD  CDNT      ZZNOMU                   E31795 159599
     C**********           ADD  SNPT      ZZNOMU                   E31795 159599
     C**********           ADD  CDST      ZZNOMU                   E31795 159599
     C**********           ADD  CNPV      ZZPUR                    E31795 159599
     C**********           ADD  CNSV      ZZSAL                    E31795 159599
     C**********           ADD  SAPV      ZZAPP                    E31795 159599
     C**********           ADD  SPSV      ZZAPS                    E31795 159599
     C**********           END                                     E31795 159599
     C                     END
     C**
     C**  IF STILL PROCESSING SFL TOTAL RECS - GOTO S/R
     C**
     C           *IN59     IFEQ '1'
     C                     EXSR TOTAL
     C           OUTREC    IFEQ 14
     C                     SETON                     89
     C                     END
     C                     END
     C**
     C           *IN89     DOWEQ'0'
     C           *IN51     ANDEQ'0'
     C           *IN59     ANDEQ'0'
     C**
     C           *IN81     IFEQ '0'
     C                     SETOF                     3536
     C**********           READ CDEPP                    81                                   233736
     C                     READ CDEPF                    81                                   233736
     C**********           MOVE CDMK      NXTMK                    E37290 159599
     C**********           MOVE CDSN      NXTSN                    E37290 159599
     C**********           Z-ADDCDPT      NXTDP                    E37290 159599
     C                     END
     C**
     C**  End of File - If some records accumulated then write last one
     C**
     C           *IN81     IFEQ '1'
     C                     SETON                       89
     C           *IN50     IFEQ '1'
     C                     EXSR PROCES
     C           OUTREC    IFEQ 14
     C                     SETON                     89
     C                     GOTO EDLOOP
     C                     END
     C                     END
     C           *IN60     IFEQ '1'
     C                     EXSR TOTAL
     C           OUTREC    IFEQ 14
     C                     SETON                     89
     C                     GOTO EDLOOP
     C                     END
     C           *IN59     IFEQ '0'
     C                     MOVE '1'       *IN05
     C                     END
     C                     END
     C                     END
     C**
     C**  Successful file read of an active record
     C**
     C           *IN81     IFEQ '0'
     C           RECI      IFEQ 'D'
     C*                                                                   073603
     C**  If trade/value date basis = T AND nomin trade dt basis   = 0    073603
     C**                                AND sum nom purch trade dt = 0    073603
     C**                                AND sum nom sale  trade dt = 0    073603
     C**  or trade/value date basis = V AND nomin value dt basis   = 0    073603
     C**                                AND sum nom purch value dt = 0    073603
     C**                                AND sum nom sale  value dt = 0    073603
     C**    By-pass the record                                            073603
     C*                                                                   073603
     C                     MOVE '0'       *IN70                           073603
     C*                                                                   073603
     C           BVTVDV    IFEQ 'T'                                       073603
     C           CDNT      IFNE *ZEROS                                    073603
     C           SNPT      ORNE *ZEROS                                    073603
     C           CDST      ORNE *ZEROS                                    073603
     C                     MOVE '1'       *IN70                           073603
     C                     END                                            073603
     C                     ELSE                                           073603
     C           CDNV      IFNE *ZEROS                                    073603
     C           CNPV      ORNE *ZEROS                                    073603
     C           CNSV      ORNE *ZEROS                                    073603
     C                     MOVE '1'       *IN70                           073603
     C                     END                                            073603
     C                     END                                            073603
     C**                                                                  073603
     C           *IN70     IFEQ '1'                                       073603
     C**
     C**  Store market if first record
     C**
     C           SAVM      IFEQ *BLANKS
     C                     MOVE CDMK      SAVM
     C                     END
     C**
     C**  If not correct branch/cust & there have been recs for the
     C**  required branch/cust then output the last one
     C**
     C***********SAVBR     IFNE CDBR                                      S01117
     C***********PCUST     ORNE CDCN                                      S01117
     C           SAVBR     IFNE CDPA                                      S01117
     C           @PCUST    ORNE @CDCN                                     S01117
     C                     SETON                     8189
     C**
     C           *IN50     IFEQ '1'
     C***********          ADD  1         OUTREC                   088303 092199
     C***********          ADD  1         SFLREC                   088303 092199
     C                     EXSR PROCES
     C           OUTREC    IFEQ 14
     C                     SETON                     89
     C                     GOTO EDLOOP
     C                     END
     C                     END
     C           *IN60     IFEQ '1'
     C                     EXSR TOTAL
     C           OUTREC    IFEQ 14
     C                     SETON                     89
     C                     GOTO EDLOOP
     C                     END
     C           *IN59     IFEQ '0'
     C                     MOVE '1'       *IN05
     C                     END
     C                     END
     C**
     C                     ELSE
     C**
     C**   If the required Branch/cust and a new Security
     C**   and if not the first Security for this Depot
     C**   then output the previous Security Details
     C**
     C           SAVSEC    IFNE CDSN
     C           SAVSEC    IFNE *BLANKS
     C                     EXSR PROCES
     C           OUTREC    IFEQ 14
     C                     SETON                     89
     C                     GOTO EDLOOP
     C                     END
     C                     END
     C                     END
     C                     EXSR R0455                                     159599
     C**
     C**   Accumulate details for a Security
     C**
     C********** TROLL     IFNE 'Y'                                088303 159599
     C**********           ADD  CDNV      ZCUMCP                          159599
     C**********           ADD  CNPV      ZCUMCP                          159599
     C**********           ADD  CNSV      ZCUMCP                          159599
     C***********          SUB  CECN      ZCUMCP                          E36865
     C***********TVVL      IFEQ 'T'                                       S01117
     C********** BVTVDV    IFEQ 'T'                                S01117 159599
     C**********           ADD  CDNT      ZNOMP                           159599
     C**********           ADD  CDNT      ZZNOML                          159599
     C**********           ADD  SNPT      ZZNOML                          159599
     C**********           ADD  CDST      ZZNOML                          159599
     C**********           ADD  CDNV      ZZNOMU                          159599
     C**********           ADD  CNPV      ZZNOMU                          159599
     C**********           ADD  CNSV      ZZNOMU                          159599
     C**********           ADD  SNPT      ZZPUR                           159599
     C**********           ADD  CDST      ZZSAL                           159599
     C**********           ADD  SAPP      ZZAPP                           159599
     C**********           ADD  SAPS      ZZAPS                           159599
     C**********           ELSE                                           159599
     C**********           ADD  CDNV      ZNOMP                           159599
     C**********           ADD  CDNV      ZZNOML                          159599
     C**********           ADD  CNPV      ZZNOML                          159599
     C**********           ADD  CNSV      ZZNOML                          159599
     C**********           ADD  CDNT      ZZNOMU                          159599
     C**********           ADD  SNPT      ZZNOMU                          159599
     C**********           ADD  CDST      ZZNOMU                          159599
     C**********           ADD  CNPV      ZZPUR                           159599
     C**********           ADD  CNSV      ZZSAL                           159599
     C**********           ADD  SAPV      ZZAPP                           159599
     C**********           ADD  SPSV      ZZAPS                           159599
     C**********           END                                            159599
     C**********           END                                     088303 159599
     C**********           MOVE 'N'       TROLL   1                088303 159599
     C                     MOVE '1'       *IN50
     C           SAVSEC    IFEQ *BLANKS
     C                     MOVE CDSN      SAVSEC
     C                     END
     C**
     C                     END                                            073603
     C**                                                                  073603
     C                     END
     C**
     C                     END
     C                     END
     C                     END
     C**
     C**    Condition Display of message if no details for branch/cust
     C**
     C           EDLOOP    TAG                             ** EDLOOP    **
      *                                                                   E20158
     C           *IN51     IFEQ '0'                                       E20158
     C           *IN60     ANDEQ'0'                                       E20158
     C                     SETON                     05                   E20158
     C                     END                                            E20158
      *                                                                   E20158
     C           SFLREC    IFEQ 0
     C                     MOVE '1'       *IN04
     C                     ELSE
     C                     MOVE '0'       *IN03
     C                     END
     C                     Z-ADDSFLREC    TOP
     C**
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT
0738 C*****************************************************************
     C**                                                              *
     C**   PROCES SR  Process the details for a security              *
     C**                                                              *
     C**   Called by  DISP                                            *
     C**   Calls  SR  RETSR,SUBFIL                                    *
     C**              P002                                            *   S01496
     C**                                                              *
     C*****************************************************************
     C**
     C           PROCES    BEGSR                           ** PROCES **
     C*                                                                   073603
     C**  If position is 0, do not display the security                   073603
     C*                                                                   073603
     C           ZZNOML    IFEQ 0                                         073603
     C           ZZNOMU    ANDEQ0                                         067645
     C                     MOVE CDSN      SAVSEC                          073603
     C                     MOVE CDPA      SAVBR                           073603
     C                     MOVE CDMK      SAVM                            073603
     C                     Z-ADD*ZEROS    ZZNOML                          073603
     C                     Z-ADD*ZEROS    ZZNOMU                          073603
     C                     Z-ADD*ZEROS    ZZPUR                           073603
     C                     Z-ADD*ZEROS    ZZSAL                           073603
     C                     Z-ADD*ZEROS    ZZAPP                           073603
     C                     Z-ADD*ZEROS    ZZAPS                           073603
     C                     Z-ADD*ZEROS    ZNOMP                           073603
     C                     Z-ADD*ZEROS    ZCUMCP                          073603
     C                     GOTO ENDPRO                                    073603
     C                     END                                            073603
     C**
     C**  Determine next type of SFL line required
     C**
     C           *IN51     IFEQ '0'
     C                     Z-ADD1         SFLT    20
     C                     MOVE '0'       *IN50
     C                     MOVE '1'       *IN51
     C                     MOVE '1'       *IN60
     C                     END
     C*                                                                   S01155
     C                     MOVE *BLANKS   TRRECI                          S01155
     C**
     C**  Process required line
     C**
     C           PRTOP     TAG                             *** PRTOP   **
     C**
     C** First line -
     C** Ouput blank line unless 1st for screen
     C**
     C           SFLT      IFEQ 1
     C           OUTREC    ANDEQ0
     C/COPY WNCPYSRC,SE0215C020
     C                     ADD  1         SFLT
     C                     END
     C**
     C** First security line -
     C** Access security & investment type records
     C**
     C           SFLT      IFEQ 2
     C           SAVSEC    CHAINSECTY                25
     C  N25      RECI      COMP '*'                      25
     C**
     C**  If no record found  or deleted record
     C**  then it is a database error so return to calling
     C**  program with a return code of '0'
     C**
     C           *IN25     IFEQ '1'
     C                     MOVELPROGRM    DBPGM
     C                     MOVELSAVSEC    DBKEY            ***************
     C                     MOVE 'SECTY'   DBFILE           * DB ERROR 06 *
     C                     Z-ADD06        DBASE            ***************
     C                     SETON                       U7U8
     C                     EXSR *PSSR                                     S01117
     C                     MOVE '0'       RTNC
     C                     EXSR RETSR
     C                     ELSE                                           S01496
     C*                                                                   S01496
     C           S01496    IFEQ 'Y'                                       S01496
     C           CSE007    OREQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C                     EXSR P002                                      S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C                     END
     C**
     C** If security is traded on an Australian yield basis,              S01232
     C** set indicator                                                    S01232
     C**                                                                  S01232
     C           STBS      IFEQ 'Y'                                       S01232
     C           SYBS      ANDEQ'AU'                                      S01232
     C                     SETON                     52                   S01232
     C                     ELSE                                           S01232
     C                     SETOF                     52                   S01232
     C                     END                                            S01232
     C**
     C           KEYI      CHAININVTP                25
     C  N25      RECI      COMP 'D'                  2525
     C**
     C**  If no record found  or deleted record
     C**  then it is a database error so return to calling
     C**  program with a return code of '0'
     C**
     C           *IN25     IFEQ '1'
     C                     MOVELPROGRM    DBPGM
     C                     MOVELIKEY      DBKEY            ***************
     C                     MOVE 'INVTY'   DBFILE           * DB ERROR 12 *
     C                     Z-ADD12        DBASE            ***************
     C                     SETON                       U7U8
     C                     EXSR *PSSR                                     S01117
     C                     MOVE '0'       RTNC
     C                     EXSR RETSR
     C                     END
     C                     END
     C*                                                                   E39495
     C** Set up input parameters to sr. ZRATE                             E39495
     C*                                                                   E39495
     C                     MOVE PPDI      ZPPDI                           E39495
     C                     Z-ADDSFPP      ZSFPP                           E39495
     C                     Z-ADDCPNR      ZCPNR                           E39495
     C                     Z-ADDCFCT      ZCFCT                           E39495
     C                     Z-ADD*ZEROS    ZPPCP                           E39495
     C                     MOVE CPDP      ZPPCP                           E39495
     C                     MOVE PROT      ZPROT                           E39495
     C**
     C**  Third security line -
     C**  See if this line is required-
     C**
     C           SFLT      IFEQ 4
      *                                                                                       233736
      ** Compute for the average fiscal price of all portfolios:                              233736
      ** total average fiscal price numerator / total nominal position                        233736
      *                                                                                       233736
     C                     Z-ADD0         WAVFP  158                                          233736
     C           WCSNV     IFNE *ZERO                                                         233736
     C           WCSAV     DIV  WCSNV     WAVFP     H                                         233736
     C           SPBS      IFEQ 'P'                                                           233736
     C                     MULT 100       WAVFP                                               233736
     C                     ENDIF                                                              233736
      *                                                                                       233736
     C                     CALL 'AOCURRR0'                                                    233736
     C                     PARM '*DBERR'  @RTCD                                               233736
     C                     PARM '*KEY   ' @OPTN                                               233736
     C                     PARM NMCY      @AJCD                                               233736
     C           SDCURR    PARM SDCURR    DSSDY                                               233736
      *                                                                                       233736
      ** Format calculated average fiscal price                                               233736
      *                                                                                       233736
     C           5         ADD  A6NBDP    DC                                                  233736
     C                     SUB  NMDP      DC                                                  233736
     C           WAVFP     DIV  POWER8,DC WAVFP                                               233736
     C                     ENDIF                                                              233736
      *                                                                                       233736
     C           PROT      IFEQ '1'
     C           PROT      OREQ '5'
     C           PROT      OREQ '6'
     C           PROT      OREQ '8'
     C           PROT      OREQ '9'                                       S01176
     C           SETX      OREQ 'Y'                                                           233736
      *                                                                                       233736
      ** Display only if there is an accrued interest or                                      233736
      ** average fiscal price is not zero for securities                                      233736
      ** which are subject to EU tax                                                          233736
      *                                                                                       233736
     C           DYBS      IFNE '4'
     C           STBS      ANDNE'D'                                       E38110
     C           CPNR      ANDNE0                                         E38094
     C           WAVFP     ORNE 0                                                             233736
     C                     ELSE
     C                     ADD  1         SFLT
     C                     END
     C                     ELSE
     C           PROT      IFEQ '3'
     C           DYBS      ANDNE'4'
     C           STBS      ANDNE'D'                                       E38110
     C           CPNR      ANDNE0
     C           WAVFP     ORNE 0                                                             233736
     C                     ELSE
     C                     ADD  1         SFLT
     C                     END
     C                     END
     C                     END
     C**
     C** If all security lines processed see if future value trades req'd
     C**
     C           SFLT      IFGE 5
     C***********TVVL      IFEQ 'V'                                       S01117
     C           BVTVDV    IFEQ 'V'                                       S01117
     C           ZZNOML    ANDNEZZNOMU
     C                     ELSE
     C                     SETOF                     51
     C                     GOTO PEND
     C                     END
     C                     END
     C**
     C** SETGT on trades file
     C**
     C           SFLT      IFEQ 5
     C           KEYT      SETGTTRADSDF              25
     C           *IN25     IFEQ '1'
     C                     SETOF                     51
     C                     GOTO PEND
     C                     ELSE
     C           KEYTE     READETRADSDF                  25
     C           *IN25     IFEQ '1'
     C                     SETOF                     51
     C                     GOTO PEND
     C                     END
     C                     END
     C                     END
     C**
     C** If trade line req'd  - get next trade record
     C**
     C           SFLT      IFGT 6
     C           KEYTE     READETRADSDF                  25
     C           *IN25     IFEQ '1'
     C                     SETOF                     51
     C                     GOTO PEND
     C                     END
     C                     END
      *                                                                   159599
     C           ZZNOML    IFEQ 0                                         159599
     C           ZZNOMU    ANDEQ0                                         159599
     C                     MOVE '0'       *IN51                           159599
     C                     GOTO PEND                                      159599
     C                     ENDIF                                          159599
     C**
     C** Data accessed - fill SFL line & output to SFL
     C**
     C***********RECI      IFNE '*'                                       S01155
     C***********RECI      ANDNE'C'                                       S01155
     C           SFLT      IFLE 4                                         S01158
     C                     EXSR SUBFIL                                    S01158
     C                     ELSE                                           S01158
     C           TRRECI    IFNE '*'                                       S01155
     C           TRRECI    ANDNE'C'                                       S01155
     C           TRRECI    ANDNE'R'                                       S01269
     C                     EXSR SUBFIL
     C                     END                                            S01158
     C                     END                                            S01158
     C                     ADD  1         SFLT
     C***********          END                                            S01158
     C**
     C           OUTREC    IFLT 14
     C                     GOTO PRTOP
     C                     END
     C**
     C**  If all lines processed - reset indicators & save new field
     C**
     C           PEND      TAG                             ***  PEND  ***
     C/COPY WNCPYSRC,SE0215C006
     C**
     C           *IN51     IFEQ '0'
     C                     MOVE CDSN      SAVSEC
     C***********          MOVE CDBR      SAVBR                           S01117
     C                     MOVE CDPA      SAVBR                           S01117
     C                     MOVE CDMK      SAVM
     C                     Z-ADD*ZEROS    ZZNOML
     C***********          Z-ADD*ZEROS    ZNOMP                           E15850
     C                     Z-ADD*ZEROS    ZZNOMU
     C                     Z-ADD*ZEROS    ZZPUR
     C                     Z-ADD*ZEROS    ZZSAL
     C                     Z-ADD*ZEROS    ZZAPP
     C                     Z-ADD*ZEROS    ZZAPS
     C                     Z-ADD*ZEROS    ZNOMP
     C                     Z-ADD*ZEROS    ZCUMCP                          E15850
     C                     END
     C*                                                                   073603
     C** Tag for non display security                                     073603
     C*                                                                   073603
     C           ENDPRO    TAG                                            073603
     C**
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT
0738 C*****************************************************************
     C**                                                              *
     C**   TOTAL  SR  Process the totals for a customer               *
     C**                                                              *
     C**   Called by  DISP                                            *
     C**   Calls  SR  RETSR,SUBFIL                                    *
     C**                                                              *
     C*****************************************************************
     C**
     C           TOTAL     BEGSR                           ** TOTAL  **
     C**
     C**  Determine next type of SFL line required
     C**
     C           *IN59     IFEQ '0'
     C           *IN60     OREQ '1'                                       159599
     C           *IN81     ANDEQ'1'                                       159599
     C                     Z-ADD1         SFLT    20
     C                     MOVE '0'       *IN50
     C                     MOVE '1'       *IN59
     C                     MOVE '0'       *IN60
     C                     END
     C**
     C**  Process required line
     C**
     C           TTTOP     TAG                             *** TTTOP   **
     C**
     C** First line -
     C** Ouput blank line unless 1st for screen
     C**
     C/COPY WNCPYSRC,SE0215C021
     C           SFLT      IFEQ 1
     C           OUTREC    ANDEQ0
     C                     ADD  1         SFLT
     C                     END
     C/COPY WNCPYSRC,SE0215C022
     C**
     C** Data accessed - fill SFL line & output to SFL
     C**
     C                     EXSR TOTFIL
     C                     ADD  1         SFLT
     C           OUTREC    IFLT 14
     C           SFLT      ANDLT4
     C                     GOTO TTTOP
     C                     END
     C**********           SETOF                     59                   159599
     C           OUTREC    IFEQ 14                                        159599
     C           SFLT      ANDLT4                                         159599
     C                     MOVE '1'       *IN60                           159599
     C                     ELSE                                           159599
     C                     MOVE '0'       *IN59                           159599
     C                     MOVE '0'       *IN60                           159599
     C                     ENDIF                                          159599
     C**
     C**  If all lines processed - reset ACCUMULATORS                  s
     C**
     C           *IN59     IFEQ '0'
     C                     Z-ADD*ZEROS    TOTBVP
     C                     Z-ADD*ZEROS    TOTMVP
     C                     END
     C**
     C                     ENDSR
     C**
0738 C*****************************************************************
      /EJECT
0738 C*****************************************************************
     C**                                                              *
     C**   TOTFIL SR  Write details to Subfile                        *
     C**                                                              *
     C**   Called by  TOTAL                                           *
     C**   Calls  SR  RETSR,ZSEDIT                                    *
     C**                                                              *
     C*****************************************************************
     C**
     C           TOTFIL    BEGSR                           ** TOTFIL **
     C**
     C**  TOTFIL - fills one line of the SFL depending on the setting
     C**           of SFLT
     C**
     C**  SFLT=1 Blank line required
     C**
     C           SFLT      IFEQ 1
     C                     MOVE *BLANKS   SLINE
      *                                                                   CGL011
      ** If CGL011 is installed, check if client holding is blocked.      CGL011
      *                                                                   CGL011
     C           CGL011    IFEQ 'Y'                                       CGL011
     C                     MOVE 'N'       WBLKI   1                       CGL011
     C                     MOVE *OFF      *IN63                           CGL011
      *                                                                                       CGL014
      ** If CGL014 is on, display 'Collateral' narrative to actual blocked                    CGL014
      ** security positions with sequence 00001 or 00002 (SEBLKPL7).                          CGL014
      *                                                                                       CGL014
     C           CGL014    IFEQ 'Y'                                                           CGL014
     C           KEYVD     SETLLSEBLKPL7                                                      CGL014
     C                     ELSE                                                               CGL014
     C           KEYVD     SETLLSEBLKPL6                                  CGL011
     C                     ENDIF                                                              CGL014
      *                                                                                       CGL014
     C           WBLKI     DOWEQ'N'                                       CGL011
     C           *IN63     ANDEQ*OFF                                      CGL011
      *                                                                                       CGL014
     C           CGL014    IFEQ 'Y'                                                           CGL014
     C           KEYVD     READESEBLKPL7                 63                                   CGL014
     C                     ELSE                                                               CGL014
     C           KEYVD     READESEBLKPL6                 63               CGL011
     C                     ENDIF                                                              CGL014
      *                                                                   CGL011
      ** Display Collateral text if block exists, whether General         CGL011
      ** Block on the Security or Specific Block on the Customer.         CGL011
      *                                                                   CGL011
     C           *IN63     IFEQ *OFF                                      CGL011
     C           VDCNUM    ANDEQPCUST                                     CGL011
     C           *IN63     OREQ *OFF                                      CGL011
     C********** VDCNUM    ANDEQ*ZERO                                                  CGL011 CSD027
     C           VDCNUM    ANDEQ*BLANKS                                                       CSD027
     C                     MOVE 'Y'       WBLKI                           CGL011
     C                     MOVELCOLLA     SLINE                           CGL011
     C                     ELSE                                           CGL011
     C                     MOVE *BLANKS   SLINE                           CGL011
     C                     ENDIF                                          CGL011
     C                     ENDDO                                          CGL011
     C                     ENDIF                                          CGL011
      *                                                                   CGL011
      *                                                                                       CGL014
      ** If CGL014 is installed, check if client holding is blocked.                          CGL014
      *                                                                                       CGL014
     C           CGL014    IFEQ 'Y'                                                           CGL014
     C                     MOVE 'N'       WBLKI   1                                           CGL014
     C                     MOVE *OFF      *IN64                                               CGL014
     C           KEYVD     SETLLSEBLKPL7                                                      CGL014
     C           WBLKI     DOWEQ'N'                                                           CGL014
     C           *IN64     ANDEQ*OFF                                                          CGL014
     C           KEYVD     READESEBLKPL7                 64                                   CGL014
      *                                                                                       CGL014
      ** Display Collateral text if block exists, whether General                             CGL014
      ** Block on the Security or Specific Block on the Customer.                             CGL014
      *                                                                                       CGL014
     C           *IN64     IFEQ *OFF                                                          CGL014
     C           VDCNUM    ANDEQPCUST                                                         CGL014
     C           *IN64     OREQ *OFF                                                          CGL014
     C********** VDCNUM    ANDEQ*ZERO                                                  CGL014 CSD027
     C           VDCNUM    ANDEQ*BLANKS                                                       CSD027
     C                     MOVE 'Y'       WBLKI                                               CGL014
     C                     MOVELCOLLA     SLINE                                               CGL014
     C                     ELSE                                                               CGL014
     C                     MOVE *BLANKS   SLINE                                               CGL014
     C                     ENDIF                                                              CGL014
     C                     ENDDO                                                              CGL014
     C                     ENDIF                                                              CGL014
      *                                                                                       CGL014
     C                     SETON                     08
     C                     END
     C**
     C**  SFLT=2 FIRST TOTAL LINE
     C**
     C           SFLT      IFEQ 2
     C                     SETON                     08
     C**
     C**   Format book valuation - portfolio
     C**
     C                     Z-ADDPCCDP     ZDECS   10
     C                     MOVE 'L'       ZECODE
     C                     MOVE TOTBVP    ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    STBVP
     C***********          EXSR ADJUST                                    S01176
     C***********          MOVE WORKAD    STBVPA                          S01176
     C***********STBVPA    IFEQ *BLANKS                                   S01176
     C***********          MOVE *BLANKS   STBVP                           S01176
     C***********          END                                            S01176
     C**
     C**   Format market valuation - portfolio
     C**
     C                     Z-ADDPCCDP     ZDECS   10
     C                     MOVE 'L'       ZECODE
     C                     MOVE TOTMVP    ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    STMVP
     C***********          EXSR ADJUST                                    E16894
     C***********          MOVE WORKAD    STMVPA                          E16894
     C***********STMVPA    IFEQ *BLANKS                                   E16894
     C***********          MOVE *BLANKS   STMVP                           E16894
     C***********          END                                            E16894
     C**
     C                     MOVE TOTL1     SLINE
     C                     END
     C**
     C**  SFLT=3 2ND TOTAL LINE
     C**
     C           SFLT      IFEQ 3
     C                     SETON                     08
     C**
     C**   Format TOTAL
     C**
     C                     Z-ADDPCCDP     ZDECS   10
     C                     MOVE 'L'       ZECODE
     C           TOTMVP    SUB  TOTBVP    TOTMVP
     C                     MOVE TOTMVP    ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    STTOT
     C***********          EXSR ADJUST                                    S01176
     C***********          MOVE WORKAD    STTOTA                          S01176
     C***********STTOTA    IFEQ *BLANKS                                   S01176
     C***********          MOVE *BLANKS   STTOT                           S01176
     C***********          END                                            S01176
     C**
     C**  DETERMINE IF PROFIT OR LOSS
     C**
     C           TOTMVP    IFGE 0
     C                     MOVE 'PROFIT'  TL5
     C                     ELSE
     C                     MOVE 'LOSS  '  TL5
     C                     END
     C**
     C                     MOVE TOTL2     SLINE
     C                     END
     C**
     C**   And output details to subfile
     C**
     C                     ADD  1         SFLREC
     C/COPY WNCPYSRC,SE0215C023
     C                     ADD  1         OUTREC
     C/COPY WNCPYSRC,SE0215C024
     C                     WRITESE0215S0
     C/COPY WNCPYSRC,SE0215C025
     C**
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT
0738 C*****************************************************************
     C**                                                              *
     C**   CSPRC  SR  Calculate book price                            *
     C**                                                              *
     C**   Called by  SUBFIL                                          *
     C**   Calls  SR  OLCAP                                           *
     C**                                                              *
     C*****************************************************************
     C**
     C           CSPRC     BEGSR                           ** CSPRC  **
     C**
     C**  B/V ind is set to BLANK by default
     C**
     C                     MOVE ' '       SBVI
     C                     Z-ADD0         BKPR   158
     C                     Z-ADD0         ZZAPW
     C**
     C** Access 1st price for sec,br,mkt,book,price type
     C**
     C***********TVVL      IFEQ 'T'                                       S01117
     C           BVTVDV    IFEQ 'T'                                       S01117
     C                     MOVE 'CT'      PPRT
     C                     ELSE
     C                     MOVE 'CV'      PPRT
     C                     END
     C***********KEYP      SETLLPRICS                    25               E14057
     C           KEYP      SETLLPRICR                    25               E14057
     C           *IN25     IFEQ '1'
     C***********KEYP      READEPRICS                    25               E14057
     C           KEYP      READEPRICR                    25               E14057
     C           *IN25     IFEQ '0'
     C**
     C** If price found & value date is less than prev. run date
     C**  B/V ind is set to Y
     C**
     C           PVDT      IFLT PRUN
     C                     MOVE 'Y'       SBVI
     C**
     C**  If price found & value date equals prev. run date
     C**    Price will be used to override AP num COB field
     C**
     C                     ELSE
     C           PVDT      IFEQ PRUN
     C                     Z-ADDPPRC      ZZAPW
     C                     END
     C                     END
     C**
     C** If price found & value date = run date
     C**   price becomes the average price
     C**
     C           PVDT      IFEQ RUND
     C                     Z-ADDPPRC      BKPR
     C                     ELSE
     C**
     C**  If price found with value date less than prev run date
     C**  Access price file with date = run date
     C**  If found price becomes the average price
     C**
     C           PVDT      IFLT PRUN
     C***********KEYPD     CHAINPRICS                25                   E14057
     C           KEYPD     CHAINPRICR                25                   E14057
     C           *IN25     IFEQ '0'
     C                     Z-ADDPPRC      BKPR
     C                     ELSE
     C**
     C**  Otherwise -
     C**  Access price file with date = previous run date
     C**  If found price will be used to override AP num COB field
     C**
     C***********KEYPP     CHAINPRICS                25                   E14057
     C           KEYPP     CHAINPRICR                25                   E14057
     C           *IN25     IFEQ '0'
     C                     Z-ADDPPRC      ZZAPW
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C**
     C**  Calculate average price -
     C**    If price found with value date = run date, this is price
     C**
     C           BKPR      IFEQ 0
     C**
     C** Access CPOSND for cust/branch/sec -
     C**   If found & BV ind is Y, screen BV ind is set to Y
     C**
     C           KEYCP     CHAINCPOSN                25
     C           *IN25     IFEQ '0'
     C***********TVVL      IFEQ 'T'                                       S01117
     C           BVTVDV    IFEQ 'T'                                       S01117
     C           CSBT      ANDEQ'Y'
     C                     MOVE 'Y'       SBVI
     C                     ELSE
     C***********TVVL      IFEQ 'V'                                       S01117
     C           BVTVDV    IFEQ 'V'                                       S01117
     C           CSBV      ANDEQ'Y'
     C                     MOVE 'Y'       SBVI
     C                     END
     C                     END
     C**
     C**  If price found , value date = prev run date
     C**    Calculate override for sum of AP num COB +
     C**      price x nom posn COB on CPOSND
     C**
     C           ZZAPW     IFNE 0
     C***********TVVL      IFEQ 'T'                                       S01117
     C           BVTVDV    IFEQ 'T'                                       S01117
     C           CSNT      MULT ZZAPW     ZZAPC
     C                     ELSE
     C           CSNV      MULT ZZAPW     ZZAPC
     C                     END
     C                     ELSE
     C***********TVVL      IFEQ 'T'                                       S01117
     C           BVTVDV    IFEQ 'T'                                       S01117
     C                     Z-ADDCSPT      ZZAPC
     C                     ELSE
     C                     Z-ADDCSPV      ZZAPC
     C                     END
     C                     END
     C                     END
     C**
     C**  Calculate average price from OLCAP
     C**
     C                     EXSR OLCAP
     C                     END
     C**
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT
0738 C*****************************************************************
     C**                                                              *
     C**   OLCAP  SR  Calculate average price                         *
     C**                                                              *
     C**   Called by  CSPRC                                           *
     C**   Calls  SR  none                                            *
     C**                                                              *
     C*****************************************************************
     C**
     C           OLCAP     BEGSR
     C*
     C**  Calculate new NP = NP + sum nom purch - sum nom sales
     C*
     C           ZZPUR     ADD  ZZSAL     ZNNOMP
     C                     ADD  ZNOMP     ZNNOMP
     C**
     C** If NP & new NP both long -
     C**  AP = (AP num COB + AP num purch) / new NP
     C**
     C           ZNOMP     IFGT 0
     C           ZNNOMP    ANDGT0
     C           ZNNOMP    IFEQ 0
     C                     Z-ADD0         BKPR
     C                     ELSE
     C***********ZZAPC     ADD  ZZAPP     WBKPR  150                      E34849
     C***********WBKPR     DIV  ZNNOMP    BKPR      H                     E34849
     C           ZNOMP     ADD  ZZSAL     NBKPR  150                      E34849
     C           NBKPR     IFLT 0                                         177982
     C                     Z-ADDZZPUR     NBKPR                           177982
     C                     Z-ADDZZAPP     WBKPR                           177982
     C                     ELSE                                           177982
     C           ZZAPC     ADD  ZZAPS     WBKPR  150                      E34849
     C                     END                                            177982
     C           WBKPR     DIV  NBKPR     BKPR      H                     E34849
     C                     END
     C                     END
     C**
     C** If NP & new NP both short -
     C**  AP = (AP num COB + AP num sales) / new NP
     C**  (ensure price field is positive)
     C**
     C           ZNOMP     IFLT 0
     C           ZNNOMP    ANDLT0
     C           ZNNOMP    IFEQ 0
     C                     Z-ADD0         BKPR
     C                     ELSE
     C***********ZZAPC     ADD  ZZAPS     WBKPR                           E34849
     C***********WBKPR     DIV  ZNNOMP    BKPR      H                     E34849
     C           ZNOMP     ADD  ZZPUR     NBKPR                           E34849
     C           NBKPR     IFGT 0                                         177982
     C                     Z-ADDZZSAL     NBKPR                           177982
     C                     Z-ADDZZAPS     WBKPR                           177982
     C                     ELSE                                           177982
     C           ZZAPC     ADD  ZZAPP     WBKPR                           E34849
     C                     END                                            177982
     C           WBKPR     DIV  NBKPR     BKPR      H                     E34849
     C           BKPR      IFLT 0
     C           BKPR      MULT -1        BKPR
     C                     END
     C                     END
     C                     END
     C**
     C** If NP long or flat , new NP short -
     C**  AP = AP num sales / sum nom sales
     C**
     C           ZNOMP     IFGE 0
     C           ZNNOMP    ANDLT0
     C           ZZPUR     IFEQ 0
     C                     Z-ADD0         BKPR
     C                     ELSE
     C           ZZAPP     DIV  ZZPUR     BKPR      H
     C                     END
     C                     END
     C**
     C** If NP short or flat , new NP long -
     C**  AP = AP num purch / sum nom purch
     C**
     C           ZNOMP     IFLE 0
     C           ZNNOMP    ANDGT0
     C           ZZSAL     IFEQ 0
     C                     Z-ADD0         BKPR
     C                     ELSE
     C           ZZAPS     DIV  ZZSAL     BKPR      H
     C                     END
     C                     END
     C**
     C** If new NP flat -
     C**  AP = 0
     C**
     C           ZNNOMP    IFEQ 0
     C                     Z-ADD0         BKPR
     C                     END
     C*                                                                   E19838
     C* If price basis 'P', multiply by 100 to fetch true price           E19838
     C*                                                                   E19838
     C           SPBS      IFEQ 'P'                                       E19838
     C                     MULT 100       BKPR                            E19838
     C                     END                                            E19838
     C*
     C* REFORMAT BOOK PRICE FROM NOMINAL CURRENCY DECIMAL PLACES (AS IT
     C*  WAS CALCULATED FROM SUM AP NUMERATOR) TO A STRAIGHT 15/8 PRICE
     C*
     C***********5         ADD  CDP       XY      10                      S01117
     C           5         ADD  A6NBDP    XY      10                      S01117
     C                     SUB  NMDP      XY
     C           BKPR      DIV  POWER8,XY BKPR
     C*
     C**If*price*basis*'P',*multiply*by*100*to*fetch*true*price********   E19838
     C***********                                                         E19838
     C********** SPBS      IFEQ 'P'                                       E19838
     C**********           MULT 100       BKPR                            E19838
     C**********           END                                            E19838
     C**
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*    ZACRCI - STANDARD ROUTINE TO CALCULATE INTEREST            *
     C*             ON A CUSTOMER POSITION DURING INPUT CYCLE         *
     C*                                                               *
     C*  INPUT  - ZFDAT  (5,0)     FROM DATE (MIDAS DAY NO.)          *
     C*           ZTDAT  (5,0)     TO DATE   (MIDAS DAY NO.)          *
     C*********** ZBRCH  (3,0)     BRANCH                             *   S01117
     C*           ZBRCH  (3)       BRANCH                             *   S01117
     C*           ZCUST  (6,0)     CUSTOMER                           *
     C*           ZSECT  (10)      SECURITY                           *
     C*           ZPTFR  (4)       PORTFOLIO REFERENCE                *   S01496
     C*           ZDEPT  (6,0)     DEPOT CUSTOMER                     *   S01496
     C*                                                               *
     C************SAVCDP*(1,0)*****NOMINAL*CURRENCY*DEC.*PLS*(TABTG10)*   S01117
     C*           SAVCDP (1,0)     NOMINAL CURRENCY DEC. PLS(SDCURRPD)*   S01117
     C************NMDP***(1,0)*****NOMINAL*DEC.*PLS.*(SECTY*)**********   E31776
     C*           DATA FROM SECTY  FOR ZRATE ZACCR                    *
     C*           PROT   (1)       PROCESSING TYPE (INVTPD)           *
     C*           ZCUMCP (15,0)    CUM COUP HOLDING(FOR PROT N=6 ONLY)*
     C*                                                               *
     C*  OUTPUT - ZIAMT  (15,0-4)  INTEREST AMOUNT (NOM CCY DEC PLS)  *
     C*           ZACDY  (5,0)     INTEREST DAYS                      *
     C*                                                               *
     C*  REQUIRES CDEPD TO BE INCLUDED IN CALLING PROGRAM             *
     C*  REQUIRES CDEPD1 TO BE INCLUDED IN CALLING PROGRAM            *   S01496
     C*  REQUIRES SECED TO BE INCLUDED IN CALLING PROGRAM             *
     C*  (THUS IF EITHER FILE IS USED IN CALLING PGM -                *
     C*   THE CALLING PGM MUST RESET POSITION AFTER ZACRCI CALLED)    *
     C*                                                               *
     C*  USES INDICATORS 90 & 91                                      *
     C*                                                               *
     C*****************************************************************
     C*
     C           ZACRCI    BEGSR                           **ZACRCI BEGSR*
     C                     GOTO TZACST
     C*
     C*  Define Input fields
     C*
     C                     Z-ADDZFDAT     ZFDAT   50
     C                     Z-ADDZTDAT     ZTDAT   50
     C***********          MOVE ZBRCH     ZBRCH   30                      S01117
     C                     MOVE ZBRCH     ZBRCH   3                       S01117
     C**********           Z-ADDZCUST     ZCUST   60                                          CSD027
     C                     MOVE ZCUST     ZCUST   6                                           CSD027
     C                     MOVE ZSECT     ZSECT  10
     C                     Z-ADDZCUMCP    ZCUMCP 150
     C                     MOVE ZPTFR     ZPTFR   4                       S01496
     C**********           Z-ADDZDEPT     ZDEPT   60                                   S01496 CSD027
     C                     MOVE ZDEPT     ZDEPT   6                                           CSD027
     C*
     C*  Clear Output field
     C*
     C           TZACST    TAG                             *** TZACST  ***
     C                     Z-ADD0         ZIAMT  150
     C                     Z-ADD0         ZACDY   50
     C*
     C*  Define Work fields (based on similar fields where possible)
     C*
     C           *LIKE     DEFN DDTE      ZWDDTE
     C           *LIKE     DEFN DDTE      ZSAVDT
     C*
     C           *LIKE     DEFN SDET      ZWSDET
     C                     MOVE 'CP'      ZWSDET
     C*
     C                     Z-ADD0         ZI      10
     C*
     C*  Set up Key Lists for CDEPD and SECED access
     C*
     C           ZCDEPD    KLIST
     C                     KFLD           ZCUST
     C                     KFLD           ZSECT
     C                     KFLD           ZBRCH
     C                     KFLD           ZWDDTE
     C*
     C           ZCDEPP    KLIST
     C                     KFLD           ZCUST
     C                     KFLD           ZSECT
     C                     KFLD           ZBRCH
     C*
     C           ZSECED    KLIST
     C                     KFLD           ZSECT
     C                     KFLD           ZZSDAT
     C                     KFLD           ZWSDET
     C*
     C           ZSECDP    KLIST
     C                     KFLD           ZSECT
     C*                                                                   S01496
     C*  Set up Key Lists for CDEPD1                                      S01496
     C*                                                                   S01496
     C           YCDEPD    KLIST                                          S01496
     C                     KFLD           ZCUST                           S01496
     C                     KFLD           ZSECT                           S01496
     C                     KFLD           ZPTFR                           S01496
     C                     KFLD           ZBRCH                           S01496
     C                     KFLD           ZDEPT                           S01496
     C                     KFLD           ZWDDTE                          S01496
     C*                                                                   S01496
     C           YCDEPP    KLIST                                          S01496
     C                     KFLD           ZCUST                           S01496
     C                     KFLD           ZSECT                           S01496
     C                     KFLD           ZPTFR                           S01496
     C                     KFLD           ZBRCH                           S01496
     C                     KFLD           ZDEPT                           S01496
     C*
     C*  Differentiate between Schuldshein and others
     C*
     C           PROT      IFNE '6'
     C*
     C*  Non-Schuldshein processing
     C*
     C*  Calculate no. interest days
     C*
     C                     Z-ADDZFDAT     ZSDATE
     C                     Z-ADDZTDAT     ZEDATE
     C                     EXSR ZDAYS
     C                     Z-ADDZDDAYS    ZACDY
     C***********                                                         E31776
     C***Convert*the*amount*on*which*interest*is*to*be*calculated*********E31776
     C*****from*Nominal*Dec*Pls*to*Nominal*Ccy*Dec*Pls*-*unless*zero******E31776
     C***********                                                         E31776
     C                     Z-ADDZCUMCP    ZAMT                            S01158
     C***********ZAMT      IFNE 0                                         E31776
     C***********SAVCDP    SUB  NMDP      ZI                              E31776
     C***********ZI        ADD  5         ZI                              E31776
     C***********ZAMT      MULT POWER8,ZI ZAMT      H                     E31776
     C***********          END                                            E31776
     C                     Z-ADD1         ZZRET   10
     C*
     C*  Calculate interest for the period
     C*
     C                     GOTO ZZINT0
     C*
     C*
     C                     ELSE
     C*
     C*  Schuldshein processing
     C*
     C*  Access the latest position for Branch/Security/Customer
     C*    which is earlier than or on From Date
     C*    If none is found then treat this as a zero position
     C*
     C                     MOVE ZFDAT     ZWDDTE
     C                     Z-ADD0         ZSAVDT
     C*                                                                   S01496
     C           S01496    IFNE 'Y'                        *B1            S01496
     C           CSE007    ANDNE'Y'                                       CSE007
     C           CEU017    ANDNE'Y'                                       CEU017
     C           ZCDEPD    SETGTCDEPD
     C                     READPCDEPD                  9191
     C*
     C           *IN91     IFEQ '1'
     C***********CDBR      ORNE ZBRCH                                     E15694
     C***********CDSN      ORNE ZSECT                                     E15694
     C***********CDCN      ORNE ZCUST                                     E15694
     C***********DDTE      ORGT ZFDAT                                     E15694
     C***********CDBR2     ORNE ZBRCH                               E15694S01117
     C           CDPA2     ORNE ZBRCH                                     S01117
     C           CDSN2     ORNE ZSECT                                     E15694
     C           CDCN2     ORNE ZCUST                                     E15694
     C           DDTE2     ORGT ZFDAT                                     E15694
     C                     Z-ADD0         ZAMT
     C*
     C                     ELSE
     C*
     C*  Convert the amount on which interest is to be calculated
     C*    from Nominal Dec Pls to Nominal Ccy Dec Pls - unless zero
     C*
     C***********CDNV      ADD  CNPV      ZAMT                            E15694
     C***********ZAMT      ADD  CNSV      ZAMT                            E15694
     C***********ZAMT      SUB  CECN      ZAMT                            E15694
     C***********DDTE      IFGE ZFDAT                                     E15694
     C***********          Z-ADDDDTE      ZSAVDT                          E15694
     C***********          ELSE                                           E15694
     C***********          Z-ADDZFDAT     ZSAVDT                          E15694
     C***********          END                                            E15694
     C           CDNV2     ADD  CNPV2     ZAMT                            E15694
     C           ZAMT      ADD  CNSV2     ZAMT                            E15694
     C***********ZAMT      SUB  CECN2     ZAMT                      E15694E36865
     C***********DDTE      IFGE ZFDAT                               E15694E38091
     C           DDTE2     IFGE ZFDAT                                     E38091
     C                     Z-ADDDDTE2     ZSAVDT                          E15694
     C                     ELSE                                           E15694
     C                     Z-ADDZFDAT     ZSAVDT                          E15694
     C                     END                                            E15694
     C                     END
     C*                                                                   S01496
     C                     ELSE                            *X1            S01496
     C           YCDEPD    SETGTSECDEPL1                                  S01496
     C                     READPSECDEPL1               9191               S01496
     C*                                                                   S01496
     C           *IN91     IFEQ '1'                                       S01496
     C           CDPA2     ORNE ZBRCH                                     S01496
     C           CDSN2     ORNE ZSECT                                     S01496
     C           CDCN2     ORNE ZCUST                                     S01496
     C           PTFR2     ORNE ZPTFR                                     S01496
     C           CDPT2     ORNE ZDEPT                                     S01496
     C           DDTE2     ORGT ZFDAT                                     S01496
     C                     Z-ADD0         ZAMT                            S01496
     C*                                                                   S01496
     C                     ELSE                                           S01496
     C*                                                                   S01496
     C*  Convert the amount on which interest is to be calculated         S01496
     C*    from Nominal Dec Pls to Nominal Ccy Dec Pls - unless zero      S01496
     C*                                                                   S01496
     C           CDNV2     ADD  CNPV2     ZAMT                            S01496
     C           ZAMT      ADD  CNSV2     ZAMT                            S01496
     C*                                                                   S01496
     C           DDTE2     IFGE ZFDAT                                     S01496
     C                     Z-ADDDDTE2     ZSAVDT                          S01496
     C                     ELSE                                           S01496
     C                     Z-ADDZFDAT     ZSAVDT                          S01496
     C                     END                                            S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C                     END                             *E1            S01496
     C*
     C           DDTE2     IFGE ZFDAT                                     E38091
     C                     Z-ADDDDTE2     ZSDATE                          E38091
     C                     ELSE                                           E38091
     C                     Z-ADDZFDAT     ZSDATE                          E38091
     C                     END                                            E38091
     C                     EXSR ZDAYS                                     E38091
     C                     Z-ADDZDDAYS    ZACDY                           E38091
     C*                                                                   E38091
     C                     Z-ADDZFDAT     ZSDATE
     C*
     C           S01496    IFNE 'Y'                                       S01496
     C           CSE007    ANDNE'Y'                                       CSE007
     C           CEU017    ANDNE'Y'                                       CEU017
     C           ZCDEPD    SETGTCDEPD
     C                     ELSE                                           S01496
     C           YCDEPD    SETGTSECDEPL1                                  S01496
     C                     END                                            S01496
     C*
     C           ZREAD     TAG                             ** ZREAD **
     C*
     C*  Read next Position  for this Branch/Security/Customer
     C*  or read next Pos.for this Customer/Security/Prtf/Branch/Depot    S01496
     C*    between From and To Dates
     C*
     C           S01496    IFNE 'Y'                                       S01496
     C           CSE007    ANDNE'Y'                                       CSE007
     C           CEU017    ANDNE'Y'                                       CEU017
     C           ZCDEPP    READECDEPD                  9191
     C                     ELSE                                           S01496
     C           YCDEPP    READESECDEPL1               9191               S01496
     C                     END                                            S01496
     C*
     C*  If End of Events
     C*    then calculate interest for remaining period
     C*    (which may be the whole period)
     C*
     C           *IN91     IFEQ '1'
     C***********DDTE      ORGT ZTDAT                                     E15694
     C           DDTE2     ORGT ZTDAT                                     E15694
     C*
     C                     Z-ADDZTDAT     ZEDATE
     C                     ADD  ZCUMCP    ZAMT
     C***********ZAMT      IFNE 0                                         E31776
     C***********SAVCDP    SUB  NMDP      ZI                              E31776
     C***********ZI        ADD  5         ZI                              E31776
     C***********ZAMT      MULT POWER8,ZI ZAMT      H                     E31776
     C***********          END                                            E31776
     C                     Z-ADD1         ZZRET
     C           ZAMT      IFNE 0
     C                     GOTO ZZINT0
     C                     END
     C*
     C                     GOTO ZENDAC
     C*
     C                     END
     C*
     C*  New date
     C*
     C***********DDTE      IFNE ZSAVDT                                    E15694
     C***********DDTE      ANDGTZSAVDT                                    E15694
     C           DDTE2     IFGT ZSAVDT                                    E15694
     C*
     C*    so calculate the interest up to the Event Date
     C*
     C***********          Z-ADDDDTE      ZEDATE                          E38091
     C                     Z-ADDDDTE2     ZEDATE                          E38091
     C           ZAMT      IFNE 0
     C***********SAVCDP    SUB  NMDP      ZI                              E31776
     C***********ZI        ADD  5         ZI                              E31776
     C***********ZAMT      MULT POWER8,ZI ZAMT      H                     E31776
     C                     Z-ADD2         ZZRET
     C                     GOTO ZZINT0
     C           ZZRET2    TAG                             *** ZZRET2  ***
     C                     END
     C*
     C*  Set Start of Next Interest Period = End of this Period
     C*    and save values from Event before reading next one
     C*
     C***********          Z-ADDDDTE      ZSDATE                          E15694
     C                     Z-ADDDDTE2     ZSDATE                          E15694
     C***********          Z-ADDSDNC      CPNR                            E38091
     C***********          Z-ADDSDCP      CFCT                            E38091
     C***********          MOVE SDTP      CPDP                            E38091
     C*
     C*  Convert the amount on which interest is to be calculated
     C*    from Nominal Dec Pls to Nominal Ccy Dec Pls - unless zero
     C*
     C***********CDNV      ADD  CNPV      ZAMT                            E15694
     C***********ZAMT      ADD  CNSV      ZAMT                            E15694
     C***********ZAMT      SUB  CECN      ZAMT                            E15694
     C***********CDNV      ADD  CNPV2     ZAMT                      E15694E38091
     C           CDNV2     ADD  CNPV2     ZAMT                            E38091
     C           ZAMT      ADD  CNSV2     ZAMT                            E15694
     C***********ZAMT      SUB  CECN2     ZAMT                      E15694E36865
     C*
     C*
     C***********          MOVE DDTE      ZSAVDT                          E15694
     C                     MOVE DDTE2     ZSAVDT                          E15694
     C                     ELSE
     C*
     C*    NOT NEW date
     C*
     C***********          MOVE DDTE      ZSAVDT                          E15694
     C                     MOVE DDTE2     ZSAVDT                          E15694
     C*
     C*    Accumulate amount
     C*
     C***********          ADD  CNPV      ZAMT                            E15694
     C***********          ADD  CDNV      ZAMT                            E15694
     C***********ZAMT      ADD  CNSV      ZAMT                            E15694
     C***********ZAMT      SUB  CECN      ZAMT                            E15694
     C                     ADD  CNPV2     ZAMT                            E15694
     C                     ADD  CDNV2     ZAMT                            E15694
     C           ZAMT      ADD  CNSV2     ZAMT                            E15694
     C***********ZAMT      SUB  CECN2     ZAMT                      E15694E36865
     C*
     C                     END
     C*
     C                     GOTO ZREAD
     C                     END
     C*
     C*****************************************************************
     C*
     C           ZZINT0    TAG                             *** ZINT0   ***
     C*
     C*  This is a s/r within ZACRCI
     C*    From/To dates input - ZSDATE/ZEDATE
     C*    These are stores & restored at end
     C*
     C                     Z-ADDZSDATE    ZZSDAT  50
     C                     Z-ADDZEDATE    ZZEDAT  50
     C*
     C*  Access the Coupon Rate Event for From Date
     C*    It should always be found (From Date should be Coupon Date)
     C*    but if not use values from SECTY  record for call to ZRATE
     C*
     C           ZSECED    CHAINSECED                90
     C*
     C*  If no Coupon Rate Event read or End of File
     C*    reset file pointer ready for read of rest of Events
     C*
     C           *IN90     IFEQ '1'
     C           ZSECED    SETLLSECED
     C*
     C                     MOVE '0'       *IN90
     C                     ELSE
     C*
     C*  If Coupon Rate Event read successfully
     C*    then save fields to be used by ZRATE before next Event read
     C*
     C                     Z-ADDSNCR      CPNR
     C                     Z-ADDSNCF      CFCT
     C                     MOVE SNCP      CPDP
     C                     END
     C*
     C                     Z-ADDZZSDAT    ZSDATE
     C*                                                                   E36865
     C** Access CPOSND for ex-coupon                                      E36865
     C*                                                                   E36865
     C           KEYCP     CHAINCPOSN                25                   E36865
     C           *IN25     IFEQ '1'                                       E36865
     C           DDTE      ANDLTZSDATE                                    E36865
     C                     Z-ADDCSEX      CECN                            E36865
     C                     ELSE                                           E36865
     C                     Z-ADD0         CECN                            E36865
     C                     END                                            E36865
     C                     SUB  CECN      ZAMT                            E36865
     C*
     C*  Read all Security Events between From and To Dates
     C*
     C           *IN90     DOUEQ'1'
     C*
     C           ZSECDP    READESECED                    90
     C*
     C           *IN90     IFEQ '0'
     C           SDED      ANDGEZZEDAT
     C                     MOVE '1'       *IN90
     C                     END
     C*
     C*  If End of File or of Events between From and To Dates
     C*    then calculate interest for remaining period
     C*    (which may be the whole period if no required events read)
     C*
     C           *IN90     IFEQ '1'
     C                     Z-ADDZZEDAT    ZEDATE
     C                     EXSR ZRATE
     C                     EXSR ZSAVE                                     S01158
     C                     Z-ADDSAVCDP    ZCDP                            S01117
     C                     EXSR ZACCR
     C/COPY WNCPYSRC,SE0215C011
     C                     EXSR ZRSTOR                                    S01158
     C                     ADD  ZACCRD    ZIAMT
     C*
     C                     ELSE
     C*
     C*  If Event read is within required dates
     C*    check if it is a required event
     C*
     C           SDET      IFEQ 'PP'
     C           SDET      OREQ 'MP'
     C           SDET      OREQ 'IR'
     C*
     C*  A required Event marks the End of This Interest Period
     C*    so calculate the interest up to the Event Date
     C*
     C                     Z-ADDSDED      ZEDATE
     C                     EXSR ZRATE
     C                     EXSR ZSAVE                                     S01158
     C                     Z-ADDSAVCDP    ZCDP                            S01117
     C                     EXSR ZACCR
     C/COPY WNCPYSRC,SE0215C012
     C                     EXSR ZRSTOR                                    S01158
     C                     ADD  ZACCRD    ZIAMT
     C*
     C*  Set Start of Next Interest Period = End of this Period
     C*    and save values from Event before reading next one
     C*
     C                     Z-ADDSDED      ZSDATE
     C                     Z-ADDSDNC      CPNR
     C                     Z-ADDSDCP      CFCT
     C                     MOVE SDTP      CPDP
     C*
     C                     END
     C                     END
     C                     END
     C*
     C                     Z-ADDZZSDAT    ZSDATE
     C                     Z-ADDZZEDAT    ZEDATE
     C           ZZRET     CABEQ2         ZZRET2
     C*
     C           ZENDAC    TAG                             *** ZENDAC ***
     C*
     C                     ENDSR
     C*
0738 C*****************************************************************
      /EJECT
0738 C*****************************************************************
     C**                                                              *
     C**   SUBFIL SR  Write details to Subfile                        *
     C**                                                              *
     C**   Called by  PROCES                                          *
     C**   Calls  SR  RETSR,ZSEDIT,ZSDESC,CSPRC,ZPRCO,ZCONV,ZDAYS,    *
     C**              ZACRCI,YPRICE                                   *
     C**                                                              *
     C*****************************************************************
     C**
     C           SUBFIL    BEGSR                           ** SUBFIL **
     C**
     C**  SUBFIL - fills one line of the SFL depending on the setting
     C**           of SFLT
     C/COPY WNCPYSRC,SE0215C001
     C**
     C**  SFLT=1 Blank line required
     C**
     C           SFLT      IFEQ 1
     C                     MOVE *BLANKS   SLINE
      *                                                                   CGL011
      ** If CGL011 is installed, check if client holding is blocked.      CGL011
      *                                                                   CGL011
     C           CGL011    IFEQ 'Y'                                       CGL011
     C                     MOVE 'N'       WBLKI   1                       CGL011
     C                     MOVE *OFF      *IN63                           CGL011
     C           KEYVD     SETLLSEBLKPL6                                  CGL011
     C           WBLKI     DOWEQ'N'                                       CGL011
     C           *IN63     ANDEQ*OFF                                      CGL011
     C           KEYVD     READESEBLKPL6                 63               CGL011
      *                                                                   CGL011
      ** Display Collateral text if block exists, whether General         CGL011
      ** Block on the Security or Specific Block on the Customer.         CGL011
      *                                                                   CGL011
     C           *IN63     IFEQ *OFF                                      CGL011
     C           VDCNUM    ANDEQPCUST                                     CGL011
     C           *IN63     OREQ *OFF                                      CGL011
     C********** VDCNUM    ANDEQ*ZERO                                                  CGL011 CSD027
     C           VDCNUM    ANDEQ*BLANKS                                                       CSD027
     C                     MOVE 'Y'       WBLKI                           CGL011
     C                     MOVELCOLLA     SLINE                           CGL011
     C                     ELSE                                           CGL011
     C                     MOVE *BLANKS   SLINE                           CGL011
     C                     ENDIF                                          CGL011
     C                     ENDDO                                          CGL011
     C                     ENDIF                                          CGL011
      *                                                                   CGL011
     C                     SETON                     08
     C                     END
     C**
     C**  SFLT=2 FIRST SECURITY/POSITION DETAILS LINE
     C**
     C           SFLT      IFEQ 2
     C                     SETOF                     08
     C**
     C**   Format security short description
     C**
     C                     MOVE SESN      SSESN
     C                     MOVE NMCY      SNMCY
     C                     MOVE SRPN      ZSRPN
     C                     MOVE BVRIDF    ZRSFD                           S01117
     C                     EXSR ZSDESC
     C                     MOVELZRNME     SDESC
     C**
     C*****ACCESS*TABTG10*FOR*nominal*CURRENCY*                           S01117
     C***********                                                         S01117
     C***********          MOVEL'20      'TKEY   12                       S01117
     C***********          MOVELNMCY      ZWK4    4                       S01117
     C***********          MOVE 1         ZWK4                            S01117
     C***********          MOVE ZWK4      TKEY                            S01117
     C***********TKEY      CHAINTABTG10F             25                   S01117
     C**N25******RECI      COMP 'D'                  2525                 S01117
     C***********                                                         S01117
     C*******If*no*record*found**or*deleted*record*                       S01117
     C**********then*it*is*a*database*error*so*return*to*calling*         S01117
     C**********program*with*a*return*code*of*'0'*                        S01117
     C***********                                                         S01117
     C************IN25     IFEQ '1'                                       S01117
      *                                                                   S01117
      ** Access currency file SDCURRPD                                    S01117
      *                                                                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR'  @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM NMCY      @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
      ***********                                                         S01117
      ***If*no*record*found*then*it*is*a*database*error*so*return*to***   S01117
      ***calling*program*with*a*return*code*of*'0'*********************   S01117
      ***********                                                         S01117
     C***********          MOVELPROGRM    DBPGM                           S01117
     C***********          MOVELTKEY      DBKEY            ***************S01117
     C***********          MOVE 'TABLE'   DBFILE           * DB ERROR 10 *S01117
     C***********          Z-ADD10        DBASE            ***************S01117
     C***********          SETON                       U7U8               S01117
     C***********          MOVE '0'       RTNC                            S01117
     C***********          EXSR RETSR                                     S01117
     C***********          END                                            S01117
     C***********          Z-ADDCDP       SAVCDP  10                      S01117
     C***********          Z-ADDCDP       NCDP    10                S01232S01117
     C                     Z-ADDA6NBDP    SAVCDP  10                      S01117
     C                     Z-ADDA6NBDP    NCDP    10                      S01117
     C**
     C**   Format book valuation - sec
     C**
     C                     EXSR CSPRC
     C           BKPR      IFLT *ZEROS
     C                     Z-SUBBKPR      BKPR
     C                     END
     C                     Z-ADD*ZEROS    WBVAL  150
     C                     Z-ADD*ZEROS    WBVAL0 150
     C                     Z-ADD*ZEROS    WBVAL1 151
     C                     Z-ADD*ZEROS    WBVAL2 152
     C                     Z-ADD*ZEROS    WBVAL3 153
     C                     MOVEA'0000'    *IN,55
     C***********55        ADD  CDP       J       20                      S01117
     C           55        ADD  A6NBDP    J       20                      S01117
     C                     MOVEA'1'       *IN,J
     C*
     C*  Book price used in calculation of Book value should be a         S01186
     C*  price (not a yield or discount)                                  S01186
     C*                                                                   S01186
     C***********          Z-ADDRUND      ZFDATE                   S01186 E16894
     C***********          Z-ADDBKPR      ZPRCIN                   S01186 E16894
     C***********          EXSR ZPRCI                              S01186 E16894
     C***********          Z-ADDZPRCOT    WBPRIC 158               S01186 E16894
     C*
     C*  Calculate consideration/reallowance/charges/commission
     C*
     C   55      ZZNOML    MULT BKPR      WBVAL0    H
     C   56      ZZNOML    MULT BKPR      WBVAL1    H
     C   57      ZZNOML    MULT BKPR      WBVAL2    H
     C   58      ZZNOML    MULT BKPR      WBVAL3    H
     C*
     C* Price basis - divide by 100
     C*
     C           SPBS      IFEQ 'P'
     C   55                DIV  100       WBVAL0
     C   56                DIV  100       WBVAL1
     C   57                DIV  100       WBVAL2
     C   58                DIV  100       WBVAL3
     C                     END
     C*
     C   55                MOVE WBVAL0    WBVAL
     C   56                MOVE WBVAL1    WBVAL
     C   57                MOVE WBVAL2    WBVAL
     C   58                MOVE WBVAL3    WBVAL
     C*
     C*   Allow for nominal decimal places
     C*
     C           5         SUB  NMDP      DC      10
     C           WBVAL     MULT POWER8,DC BVAL   150
     C***********          Z-ADDCDP       ZDECS   10                      S01117
     C                     Z-ADDA6NBDP    ZDECS   10                      S01117
     C                     MOVE 'L'       ZECODE
     C                     MOVE BVAL      ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SBVAL
     C***********          EXSR ADJUST                                    S01176
     C***********          MOVE WORKAD    SBVALA                          S01176
     C***********SBVALA    IFEQ *BLANKS                                   S01176
     C***********          MOVE *BLANKS   SBVAL                           S01176
     C***********          END                                            S01176
     C*                                                                   S01176
     C* If processing type 9 & trade basis is 'Yield' use yield as        S01176
     C* Market price                                                      S01176
     C*                                                                   S01176
     C           KYPR      CHAINCPPRIC               25                   S01176
     C*                                                                   S01176
     C           PROT      IFEQ '9'                                       S01176
     C           STBS      ANDEQ'Y'                                       S01176
     C           *IN25     ANDEQ'0'                                       S01176
     C           RECI      ANDEQ'D'                                       S01176
     C*                                                                   S01176
     C                     EXSR YPRICE                                    S01176
     C*                                                                   S01176
     C***********          Z-ADD8         ZDECS   10               S01176 S01186
     C***********          MOVE 'L'       ZECODE                   S01176 S01186
     C*                                                                   S01186
     C* Set up ZFLD15 (for screen editing) and ZPRICIN (for conversion    S01186
     C* to a price which is used in market value calculation)             S01186
     C*                                                                   S01186
     C                     MOVE ZY1       ZFLD15                          S01176
     C*                                                                   S01176
     C***********          EXSR ZSEDIT                             S01176 S01186
     C***********          MOVE Z21L3     SMKPR                    S01176 S01186
     C***********          Z-ADDRUND      ZFDATE                   S01176 S01186
     C*                                                                   S01176
     C                     Z-ADDZY1       ZPRCIN                          S01176
     C*                                                                   S01176
     C***********          EXSR ZPRCI                              S01177 S01186
     C***********          Z-ADDZPRCOT    WMPRIC                   S01176 S01186
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C*
     C* Access Prices file for Security and Type 'V' for Price
     C*    - obtain latest price from Prices file                         090500
     C*    - if not found use Market Price from Security
     C*
     C                     MOVE 'V '      PTYP
     C**********           MOVE *ZEROS    PCST                                                CSD027
     C                     MOVE *BLANKS   PCST                                                CSD027
     C                     Z-ADD0         PDAT
     C                     SETOF                         85               111490
     C***********KEYPT     SETLLPRICT                                     090500
     C***********KEYPTP    READEPRICT                    99               090500
     C***********KEYPT     SETGTPRICT                              090500 111490
     C***********KEYPTP    REDPEPRICT                    99        090500 111490
     C           KEYPT     SETLLPRICT                    99               111490
     C           *IN99     IFEQ '0'                                       111490
     C           KEYPTP    READEPRICT                    99               111490
     C           *IN99     IFEQ '0'                                       111490
     C           RECI      ANDEQ'D'                                       111490
     C                     SETON                     85                   111490
     C                     ELSE                                           111490
     C           RECI      DOWEQ'*'                                       111490
     C           *IN99     ANDNE'1'                                       111490
     C           KEYPTP    READEPRICT                    99               111490
     C           RECI      IFNE '*'                                       111490
     C           *IN99     IFEQ '0'                                       111490
     C                     SETON                     85                   111490
     C                     END                                            111490
     C                     END                                            111490
     C                     END                                            111490
     C                     END                                            111490
     C                     END                                            111490
     C************IN99     IFEQ '1'                                       111490
     C           *IN85     IFEQ '0'                                       111490
     C*                                                                   S01186
     C* Set up ZFLD15 (for screen editing) and ZPRICIN (for conversion    S01186
     C* to a price which is used in market value calculation)             S01186
     C*                                                                   S01186
     C***********          MOVE MKPR      ZPRICE                          S01186
     C                     MOVE MKPR      ZPRCIN                          S01186
     C                     ELSE
     C***********          MOVE PPRC      ZPRICE                          S01186
     C                     MOVE PPRC      ZPRCIN                          S01186
     C                     END
     C                     MOVE ZPRCIN    ZFLD15                          S01186
     C*
     C***********          Z-ADDZPRICE    WMPRIC 158                      S01186
     C***********          Z-ADDRUND      ZFDATE                          S01186
     C                     EXSR ZNCD
     C***********          EXSR ZPRCO                                     S01186
     C***********          Z-ADD8         ZDECS   10                      S01186
     C***********          MOVE 'L'       ZECODE                          S01186
     C***********          MOVE ZPRCOT    ZFLD15                          S01186
     C***********          EXSR ZSEDIT                                    S01186
     C***********          MOVE Z21L3     SMKPR                           S01186
     C*
     C                     END                                            S01176
     C*                                                                   S01186
     C* Price/Yield/Discount should be output to screen as a Price/       S01186
     C* Yield/Discount after editing.                                     S01186
     C*                                                                   S01186
     C                     Z-ADD8         ZDECS   10
     C                     MOVE 'L'       ZECODE
     C***********          MOVE ZPRCOT    ZFLD15                          E16894
     C                     EXSR ZSEDIT
     C                     MOVE Z21L3     SMKPR
     C*                                                                   S01186
     C* Price/Yield/Discount should be converted into price before        S01186
     C* use in Market Value calculation.                                  S01186
     C*                                                                   S01186
     C                     Z-ADDRUND      ZFDATE                          S01186
     C*                                                                   S01232
     C*    If this is a security traded on an Australian yield basis      S01232
     C*    then set up fields required for ZPRCI. (Purch Int =            S01232
     C*    accrued to date/nominal).                                      S01232
     C*                                                                   S01232
     C           *IN52     IFEQ '1'                                       S01232
     C           ZZNOML    ANDNE0                                         S01232
     C                     Z-ADDLCPN      ZSDATE                          S01232
     C                     Z-ADDRUND      ZEDATE                          S01232
     C                     EXSR ZRATE                                     S01232
     C                     Z-ADDZZNOML    ZAMT                            S01232
     C                     Z-ADDNCDP      ZCDP                            S01117
     C                     EXSR ZACCR                                     S01232
     C/COPY WNCPYSRC,SE0215C013
     C           ZACCRD    DIV  ZZNOML    WRKPI                           S01232
     C                     Z-ADDRUND      WRKD    50                      S01232
     C                     EXSR ZYCE                                      S01232
     C*                                                                   S01232
     C*          IF EX-COUPON THEN PI PASSED IS THE REMAINING INTEREST    S01232
     C*          TILL NCD AND IS NEGATIVE                                 S01232
     C*                                                                   S01232
     C           SCUMEX    IFEQ 'X'                                       S01232
     C                     Z-ADDLCPN      ZSDATE                          S01232
     C                     Z-ADDNCD       ZEDATE                          S01232
     C                     Z-ADDNCDP      ZCDP                            S01117
     C                     EXSR ZACCR                                     S01232
     C/COPY WNCPYSRC,SE0215C014
     C           ZACCRD    DIV  ZZNOML    WKWPI  159                      S01232
     C           WRKPI     SUB  WKWPI     WRKPI                           S01232
     C                     END                                            S01232
     C                     ELSE                                           S01232
     C                     Z-ADD0         WRKPI                           S01232
     C                     MOVE 'C'       SCUMEX                          S01232
     C                     END                                            S01232
     C*                                                                   E39495
     C           ZZNOML    IFLT *ZERO                                     E39495
     C                     Z-SUBZZNOML    ZNOML                           E39495
     C                     ELSE                                           E39495
     C                     Z-ADDZZNOML    ZNOML                           E39495
     C                     END                                            E39495
     C*                                                                   S01232
     C           ZPRCIN    IFNE 0                                         E31789
     C                     EXSR ZPRCI                                     S01186
     C/COPY WNCPYSRC,SE0215C009
      *                                                                                       CSE035
      ** ADJUST NUMBER OF DECIMAL PLACES FOR PRICE                                            CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
      ** ADJUST PRICE : PRICE + PUR INT BEFORE ROUNDING                                       CSE035
      *                                                                                       CSE035
     C           NCD       IFGE MATY                                                          CSE035
     C           SYBS      ANDEQ'AU'                                                          CSE035
     C                     Z-ADDZPRCOT    ZPRCOT                                              CSE035
     C                     ELSE                                                               CSE035
     C           SYBS      IFNE 'AU'                                                          CSE035
     C           SYBS      ANDNE'DA'                                                          CSE035
     C           STBS      ANDEQ'Y'                                                           CSE035
     C           ZPRCOT    ADD  ZWAMT     ZPRCOT                                              CSE035
     C                     END                                                                CSE035
     C                     END                                                                CSE035
      *                                                                                       CSE035
     C                     END                                                                CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
     C           NCD       IFGE MATY                                                          CSE035
     C           SYBS      ANDEQ'AU'                                                          CSE035
     C                     ELSE                                                               CSE035
      *                                                                                       CSE035
     C           SYBS      IFNE 'AU'                                                          CSE035
     C           SYBS      ANDNE'DA'                                                          CSE035
     C           STBS      ANDEQ'Y'                                                           CSE035
     C           ZPRCOT    SUB  PURINT    ZPRCOT                                              CSE035
     C                     END                                                                CSE035
     C                     END                                                                CSE035
      *                                                                                       CSE035
     C                     END                                                                CSE035
      *                                                                                       CSE035
     C                     Z-ADDZPRCOT    WMPRIC 158                      S01186
     C                     ELSE                                           E31789
     C                     Z-ADD0         WMPRIC                          E31789
     C                     END                                            E31789
     C*                                                                   E31789
     C           SPBS      IFEQ 'P'
     C                     MOVE '%'       P2
     C                     ELSE
     C                     MOVE ' '       P2
     C                     END
     C**
     C**   Format market valuation - sec
     C**
     C                     Z-ADD*ZEROS    WMVAL  150
     C                     Z-ADD*ZEROS    WMVAL0 150
     C                     Z-ADD*ZEROS    WMVAL1 151
     C                     Z-ADD*ZEROS    WMVAL2 152
     C                     Z-ADD*ZEROS    WMVAL3 153
     C                     MOVEA'0000'    *IN,55
     C***********55        ADD  CDP       J       20                      S01117
     C           55        ADD  A6NBDP    J       20                      S01117
     C                     MOVEA'1'       *IN,J
     C*
     C*  Calculate consideration/reallowance/charges/commission
     C*
     C   55      ZZNOML    MULT WMPRIC    WMVAL0    H
     C   56      ZZNOML    MULT WMPRIC    WMVAL1    H
     C   57      ZZNOML    MULT WMPRIC    WMVAL2    H
     C   58      ZZNOML    MULT WMPRIC    WMVAL3    H
     C*
     C* Price basis - divide by 100
     C*
     C           SPBS      IFEQ 'P'
     C   55                DIV  100       WMVAL0
     C   56                DIV  100       WMVAL1
     C   57                DIV  100       WMVAL2
     C   58                DIV  100       WMVAL3
     C                     END
     C*
     C   55                MOVE WMVAL0    WMVAL
     C   56                MOVE WMVAL1    WMVAL
     C   57                MOVE WMVAL2    WMVAL
     C   58                MOVE WMVAL3    WMVAL
     C*
     C*   Allow for nominal decimal places
     C*
     C           5         SUB  NMDP      DC      10
     C           WMVAL     MULT POWER8,DC MVAL   150
     C*
     C                     Z-ADDMVAL      ZFLD15
     C***********          Z-ADDCDP       ZDECS                     S01176S01117
     C                     Z-ADDA6NBDP    ZDECS                           S01117
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SMVAL
     C***********          EXSR ADJUST                                    S01176
     C***********          MOVE WORKAD    SMVALA                          S01176
     C***********SMVALA    IFEQ *BLANKS                                   S01176
     C***********          MOVE *BLANKS   SMVAL                           S01176
     C***********          END                                            S01176
     C*                                                                   S01496
     C           S01496    IFEQ 'Y'                        *B1            S01496
     C           CSE007    OREQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C*                                                                   S01496
     C           GBLOCK    IFNE *BLANKS                    *B2            S01496
     C           SBLOCK    ORNE *BLANKS                                   S01496
     C           #BLOC1    IFEQ *BLANKS                    *B3            S01496
     C                     MOVELGBLOCK    GBLOC1                          S01496
     C                     MOVELSBLOCK    SBLOC1                          S01496
     C                     ELSE                            *X3            S01496
     C           GBLOCK    IFNE *BLANKS                    *B4            S01496
     C           SBLOCK    ANDNE*BLANKS                                   S01496
     C                     MOVELGBLOCK    GBLOC1                          S01496
     C                     MOVEL*BLANKS   #BLANC                          S01496
     C                     MOVELSBLOCK    SBLOC1                          S01496
     C                     ELSE                            *X4            S01496
     C                     MOVEL*BLANKS   #BLANC                          S01496
     C           GBLOCK    IFNE *BLANKS                    *B5            S01496
     C                     MOVELGBLOCK    SBLOC1                          S01496
     C                     ELSE                            *X5            S01496
     C                     MOVELSBLOCK    SBLOC1                          S01496
     C                     END                             *E5            S01496
     C                     END                             *E4            S01496
     C                     END                             *E3            S01496
     C                     END                             *E2            S01496
     C                     END                             *E1            S01496
     C*                                                                   S01496
     C                     MOVE POSL1     SLINE
     C                     END
     C**
     C**  SFLT=3 SECOND SECURITY/POSITION DETAILS LINE
     C**
     C           SFLT      IFEQ 3
     C                     SETON                     08
     C**
     C**   Edit nominal
     C                     Z-ADDNMDP      ZDECS   10
     C                     MOVE 'L'       ZECODE
     C                     Z-ADDZZNOML    ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SNOML
     C**
     C**   Format book price
     C**
     C***********          MOVE BKPR      ZPRICE                          S01186
     C***********          Z-ADDRUND      ZFDATE                          S01186
     C                     MOVE BKPR      ZPRICE                          E16894
     C                     Z-ADDRUND      ZFDATE                          E16894
     C                     EXSR ZNCD
     C***********          EXSR ZPRCO                                     S01186
     C*                                                                   E39495
     C           ZZNOML    IFLT *ZERO                                     E39495
     C                     Z-SUBZZNOML    ZNOML                           E39495
     C                     ELSE                                           E39495
     C                     Z-ADDZZNOML    ZNOML                           E39495
     C                     END                                            E39495
     C*                                                                   E39495
     C                     EXSR ZPRCO                                     E16894
     C/COPY WNCPYSRC,SE0215C010
     C                     Z-ADD8         ZDECS   10
     C                     MOVE 'L'       ZECODE
     C                     MOVE ZPRCOT    ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE Z21L3     SBKPR
     C           SPBS      IFEQ 'P'
     C                     MOVE '%'       P1
     C                     ELSE
     C                     MOVE ' '       P1
     C                     END
     C**
     C**   Format book valuation - portfolio
     C**
     C*****ACCESS*TABTG10*FOR*NOMINAL*CURRENCY*                           S01117
     C***********                                                         S01117
     C***********          MOVEL'20      'TKEY   12                       S01117
     C***********          MOVELNMCY      ZWK4    4                       S01117
     C***********          MOVE 1         ZWK4                            S01117
     C***********          MOVE ZWK4      TKEY                            S01117
     C***********TKEY      CHAINTABTG10F             25                   S01117
     C**N25******RECI      COMP 'D'                  2525                 S01117
     C***********                                                         S01117
     C*******If*no record found  or deleted record                        S01117
     C**********then it is a database error so return to calling          S01117
     C**********program with a return code of '0'                         S01117
     C***********                                                         S01117
     C************IN25     IFEQ '1'                                       S01117
      *                                                                   S01117
      ** Access currency file SDCURRPD for nominal currency               S01117
      *                                                                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR'  @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM NMCY      @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
      ***********                                                         S01117
      ***If*no*record*found*then*it*is*a*database*error*so*return*to      S01117
      ***calling*program*with*a*return*code*of*'0'******************      S01117
      ***********                                                         S01117
     C***********          MOVELPROGRM    DBPGM                           S01117
     C***********          MOVELTKEY      DBKEY            ***************S01117
     C***********          MOVE 'TABLE'   DBFILE           * DB ERROR 13 *E20651
     C***********          Z-ADD07        DBASE            ***************E20651
     C***********          MOVE 'TABLE'   DBFILE                    E20651S01117
     C***********          Z-ADD13        DBASE                           E20651
     C***********          SETON                       U7U8               S01117
     C***********          MOVE '0'       RTNC                            S01117
     C***********          EXSR RETSR                                     S01117
     C***********          END                                            S01117
      *                                                                   S01117
      ** Get decimal places of ccy being converted from, for ZCONV        S01117
      *                                                                   S01117
     C                     MOVE A6NBDP    ZCDPI                           S01117
      *                                                                   S01117
     C***********          MOVE ERLC      ZRATE1                          S01117
     C***********          MOVE MDIN      ZMDI1                           S01117
     C                     MOVE A6ERLC    ZRATE1                          S01117
     C                     MOVE A6MDIN    ZMDI1                           S01117
     C**
     C*****ACCESS*TABTG10*FOR*PORTFOLIO*CURRENCY*                         S01117
     C***********                                                         S01117
     C***********          MOVEL'20      'TKEY   12                       S01117
     C***********          MOVELC1PC      ZWK4    4                       S01117
     C***********          MOVE 1         ZWK4                            S01117
     C***********          MOVE ZWK4      TKEY                            S01117
     C***********TKEY      CHAINTABTG10F             25                   S01117
     C**N25******RECI      COMP 'D'                  2525                 S01117
     C***********                                                         S01117
     C*******If*no record found  or deleted record                        S01117
     C**********then it is a database error so return to calling          S01117
     C**********program with a return code of '0'                         S01117
     C***********                                                         S01117
     C************IN25     IFEQ '1'                                       S01117
      *                                                                   S01117
      ** Access currency file SDCURRPD for portfolio currency             S01117
      *                                                                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR'  @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM BFPCYC    @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
      ***********                                                         S01117
      ***If*no*record*found*then*it*is*a*database*error*so*return*to      S01117
      ***calling*program*with*a*return*code*of*'0'******************      S01117
      ***********                                                         S01117
     C***********          MOVELPROGRM    DBPGM                           S01117
     C***********          MOVELTKEY      DBKEY            ***************S01117
     C***********          MOVE 'TABLE'   DBFILE           * DB ERROR 14 *E20651
     C***********          Z-ADD07        DBASE            ***************E20651
     C***********          MOVE 'TABLE'   DBFILE                    E20651S01117
     C***********          Z-ADD14        DBASE                           E20651
     C***********          SETON                       U7U8               S01117
     C***********          MOVE '0'       RTNC                            S01117
     C***********          EXSR RETSR                                     S01117
     C***********          END                                            S01117
      *                                                                   S01117
      ** Get decimal places of ccy being converted to, for ZCONV          S01117
      *                                                                   S01117
     C                     MOVE A6NBDP    ZCDPO                           S01117
      *                                                                   S01117
     C***********          MOVE ERLC      ZRATE2                          S01117
     C***********          MOVE MDIN      ZMDI2                           S01117
     C                     MOVE A6ERLC    ZRATE2                          S01117
     C                     MOVE A6MDIN    ZMDI2                           S01117
     C**
     C**  CALL XRATE TO GET EXCH. RATE & MDIN
     C**
     C                     EXSR ZXRATE
     C                     MOVE ZMDIX     ZMDIXC  1
     C           ZMDIX     IFEQ '0'
     C                     MOVE 'D'       ZMDIXC
     C                     ELSE
     C           ZMDIX     IFEQ '1'
     C                     MOVE 'M'       ZMDIXC
     C                     END
     C                     END
     C**
     C**  Convert currency
     C**
     C                     MOVE BVAL      ZAMTCI
     C                     Z-ADDZRATEX    ZEXCH
     C                     MOVE ZMDIXC    ZMD
     C                     MOVE NMCY      ZCCYI
     C***********          MOVE C1PC      ZCCYO                           S01117
     C                     MOVE BFPCYC    ZCCYO                           S01117
     C                     EXSR ZCONV
     C**
     C****If*no*record*found*or*deleted*record*                           S01117
     C****then*it*is*a*database*error*so*return*to*calling*               S01117
     C****program*with*a*return*code*of*'0'*                              S01117
     C***********                                                         S01117
     C************INU7     IFEQ '1'                                       S01117
     C***********          MOVELPROGRM    DBPGM            ************   S01117
     C***********          MOVELTKEY      DBKEY            * DATABASE *   S01117
     C***********          MOVE 'TABLE'   DBFILE           **ERROR*07**   E20651
     C***********          Z-ADD07        DBASE            ************   E20651
     C***********          MOVE 'TABLE'   DBFILE           **ERROR 15**   E20651
     C***********          Z-ADD15        DBASE            ************   E20651
     C***********          SETON                       U7U8               S01117
     C***********          MOVE '0'       RTNC                            S01117
     C***********          EXSR RETSR                                     S01117
     C***********          END                                            S01117
     C*
     C                     Z-ADDPCCDP     ZDECS   10
     C                     MOVE 'L'       ZECODE
     C                     MOVE ZAMTCO    ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SBVPF
     C***********          EXSR ADJUST                                    S01176
     C***********          MOVE WORKAD    SBVPFA                          S01176
     C***********SBVPFA    IFEQ *BLANKS                                   S01176
     C***********          MOVE *BLANKS   SBVPF                           S01176
     C***********          END                                            S01176
     C**
     C**   Accumulate total book valuation - portfolio
     C**
     C                     ADD  ZAMTCO    TOTBVP
     C**
     C**   Format market valuation - portfolio
     C**
     C                     MOVE MVAL      ZAMTCI
     C                     Z-ADDZRATEX    ZEXCH
     C                     MOVE ZMDIXC    ZMD
     C                     MOVE NMCY      ZCCYI
     C***********          MOVE C1PC      ZCCYO                           S01117
     C                     MOVE BFPCYC    ZCCYO                           S01117
     C                     EXSR ZCONV
     C**
     C****If*no*record*found*or*deleted*record*                           S01117
     C****then*it*is*a*database*error*so*return*to*calling*               S01117
     C****program*with*a*return*code*of*'0'*                              S01117
     C***********                                                         S01117
     C************INU7     IFEQ '1'                                       S01117
     C***********          MOVELPROGRM    DBPGM            ************   S01117
     C***********          MOVELTKEY      DBKEY            * DATABASE *   S01117
     C***********          MOVE 'TABLE'   DBFILE           **ERROR*07*E206511117
     C***********          Z-ADD07        DBASE            ***********E206511117
     C***********          MOVE 'TABLE'   DBFILE           * ERROR 16 E206511117
     C***********          Z-ADD16        DBASE            ***********E206511117
     C***********          SETON                       U7U8               S01117
     C***********          MOVE '0'       RTNC                            S01117
     C***********          EXSR RETSR                                     S01117
     C***********          END                                            S01117
     C**
     C                     Z-ADDPCCDP     ZDECS   10
     C                     MOVE 'L'       ZECODE
     C                     MOVE ZAMTCO    ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SMVPF
     C***********          EXSR ADJUST                                    S01176
     C***********          MOVE WORKAD    SMVPFA                          S01176
     C***********SMVPFA    IFEQ *BLANKS                                   S01176
     C***********          MOVE *BLANKS   SMVPF                           S01176
     C***********          END                                            S01176
     C**
     C**   Accumulate total market valuation - portfolio
     C**
     C                     ADD  ZAMTCO    TOTMVP
     C**
     C                     MOVE POSL2     SLINE
     C                     END
     C**
     C**  SFLT=4 THIRD SECURITY/POSITION DETAILS LINE
     C**
     C           SFLT      IFEQ 4
     C                     SETON                     08
     C/COPY WNCPYSRC,SE0215C002
     C**
     C**   Format accrued interest AMOUNT AND DAYS
     C**
     C                     Z-ADDLCPN      ZFDAT
     C           ZFDAT     IFEQ 0
     C                     Z-ADDISSD      ZFDAT
     C                     END
     C                     Z-ADDECD       ZTDAT
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,SE0215CPSR                                           S01408
     C*                                                                   S01408
     C                     MOVE SESN      ZSECT
     C                     MOVE SAVBR     ZBRCH
     C***********          MOVE PCUST     ZCUST                           S01117
     C                     MOVE @PCUST    ZCUST                           S01117
     C*
     C***********PROT      IFEQ '6'                                       E38091
     C***********          Z-ADD0         ZCUMCP                          E38091
     C***********          END                                            E38091
     C*                                                                   S01496
     C           S01496    IFNE 'Y'                        *B1            S01496
     C           CSE007    ANDNE'Y'                                       CSE007
     C           CEU017    ANDNE'Y'                                       CEU017
     C                     EXSR ZACRCI
     C*                                                                   S01496
     C                     ELSE                            *X1            S01496
     C                     MOVE CDPA      W1CDBR  3                       S01496
     C**********           Z-ADDCDCN      W1CDCN  60                                   S01496 CSD027
     C                     MOVE CDCN      W1CDCN  6                                           CSD027
     C                     MOVE CDSN      W1CDSN 10                       S01496
     C                     MOVE PTFR      W1PTFR  4                                           233736
     C**********           Z-ADDCDPT      W1CDPT  60                                   S01496 CSD027
     C                     MOVE CDPT      W1CDPT  6                                           CSD027
     C                     MOVE CDMK      W1CDMK  1                       S01496
     C*                                                                   S01496
     C**  SETLL ON CDEPP WITH BRANCH, CUSTOMER AND SECURITY SHORTNAME     S01496
     C*                                                                   S01496
     C********** KEY2      SETLLCDEPP                                                  S01496 233736
     C**********           READ CDEPP                    83                            S01496 233736
     C           KEY2      SETLLCDEPF                                                         233736
     C                     READ CDEPF                    83                                   233736
     C*                                                                   S01496
     C**  SET TOTAL ACCRUED INTEREST TO ZERO                              S01496
     C*                                                                   S01496
     C                     Z-ADD*ZEROS    WIAMT                           S01496
     C*                                                                   S01496
     C**  DO WHILE NOT END OF FILE AND SAME BRANCH, CUSTOMER AND SECURITY S01496
     C*                                                                   S01496
     C           *IN83     DOWEQ*ZEROS                                    S01496
     C           CDPA      ANDEQSAVBR                                     S01496
     C           CDCN      ANDEQPCUST                                     S01496
     C           CDSN      ANDEQSAVSEC                                    S01496
     C*                                                                   S01496
     C                     Z-ADD0         ZCUMCP                          S01496
     C*                                                                   S01496
     C                     ADD  CDNV      ZCUMCP                          S01496
     C                     ADD  CNPV      ZCUMCP                          S01496
     C                     ADD  CNSV      ZCUMCP                          S01496
     C                     SUB  CECN      ZCUMCP                          S01496
     C*                                                                   S01496
     C           PROT      IFEQ '6'                                       S01496
     C                     Z-ADD0         ZCUMCP                          S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C**********           Z-ADDCDPT      ZDEPT                                        S01496 CSD027
     C                     MOVE CDPT      ZDEPT                                               CSD027
     C                     MOVE PTFR      ZPTFR                           S01496
     C*                                                                   S01496
     C                     EXSR ZACRCI                                    S01496
     C*                                                                   S01496
     C**  ACCUMULATE ACCRUED INTEREST AND IN WORK FIELD                   S01496
     C*                                                                   S01496
     C                     ADD  ZIAMT     WIAMT  150                      S01496
     C*                                                                   S01496
     C**  READ NEXT RECORD                                                S01496
     C*                                                                   S01496
     C**********           READ CDEPP                    83                            S01496 233736
     C                     READ CDEPF                    83                                   233736
     C                     END                                            S01496
     C*                                                                   S01496
     C                     Z-ADDWIAMT     ZIAMT                           S01496
     C*                                                                   S01496
     C********** KEY1      SETLLCDEPP                                                  S01496 233736
     C**********           READ CDEPP                    81                            S01496 233736
     C           KEY1      SETLLCDEPF                                                         233736
     C                     READ CDEPF                    81                                   233736
     C*                                                                   S01496
     C                     END                             *E1            S01496
     C*                                                                   S01496
     C***********SPBS      IFEQ 'P'                                 E15851E31776
     C***********          DIV  100       ZIAMT     H               E15851E31776
     C***********          END                                      E15851E31776
     C                     Z-ADDSAVCDP    ZDECS   10
     C                     MOVE 'L'       ZECODE
     C                     MOVE ZIAMT     ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SINTT
      **
     C***********PROT      IFEQ '6'                                       E38091
     C***********          MOVE *BLANKS   SINTD                           E38091
     C***********          MOVE *BLANKS   ACIN2                           E38091
     C***********          ELSE                                           E38091
     C                     MOVE 'DAYS'    ACIN2
     C                     Z-ADD0         ZDECS   10
     C                     MOVE 'L'       ZECODE
     C                     Z-ADDZACDY     ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SINTD
     C***********          END                                            E38091
     C**
      *                                                                                       233736
      ** Display accrued interest line only if there are values                               233736
      *                                                                                       233736
     C           CPNR      IFEQ *ZERO                                                         233736
     C                     MOVE *BLANKS   ACIN1                                               233736
     C                     MOVE *BLANKS   ACIN1A                                              233736
     C                     MOVE *BLANKS   SINTD                                               233736
     C                     MOVE *BLANKS   ACIN2                                               233736
     C                     MOVE *BLANKS   SINTT                                               233736
     C                     ELSE                                                               233736
     C                     MOVE '+ACC. IN'ACIN1                                               233736
     C                     MOVE 'T'       ACIN1A                                              233736
     C                     ENDIF                                                              233736
      *                                                                                       233736
      ** Display average fiscal price details if not zero                                     233736
      *                                                                                       233736
     C                     MOVE *BLANKS   DAVFP                                               233736
     C           WAVFP     IFNE *ZERO                                                         233736
     C                     MOVE 'FISCAL ' NAFP1                                               233736
     C                     MOVE 'PRICE'   NAFP2                                               233736
     C                     MOVE '0'       *IN15                                               233736
     C                     Z-ADD8         ZDECS                                               233736
     C                     MOVE 'L'       ZECODE                                              233736
     C                     MOVE *BLANKS   ZFLD15                                              233736
     C                     MOVE WAVFP     ZFLD15                                              233736
     C                     EXSR ZSEDIT                                                        233736
     C                     MOVE ZOUT21    SAVFP                                               233736
     C                     Z-ADD0         WCSNV  150                                          233736
     C                     Z-ADD0         WCSAV  150                                          233736
     C                     ENDIF                                                              233736
      *                                                                                       233736
     C                     MOVE POSL3     SLINE
     C                     END
     C**
     C**  SFLT=5 FUTURE VALUE TRADES HEADER LINE
     C**
     C           SFLT      IFEQ 5
     C                     MOVE FUTL1     SLINE
     C                     SETON                     08
     C                     END
     C**
     C**  SFLT>=6 FUTURE VALUE TRADES DETAIL LINE
     C**
     C           SFLT      IFGE 6
     C                     SETON                     08
     C**
     C**   Format trade type
     C**
     C                     MOVE TDTP      STDTP
     C**
     C**   Format nominal
     C**
     C                     Z-ADDNMDP      ZDECS   10
     C                     MOVE 'L'       ZECODE
     C                     Z-ADDNOML      ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SNOMT
     C**
     C**   Format price
     C**
     C                     Z-ADD8         ZDECS   10
     C                     MOVE 'L'       ZECODE
     C                     MOVE PRIC      ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE Z21L3     SPRIC
     C           SPBS      IFEQ 'P'
     C                     MOVE '%'       P3
     C                     ELSE
     C                     MOVE ' '       P3
     C                     END
     C**
     C**   Format value date
     C**
     C                     Z-ADDTDVD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    STDVD
     C                     MOVE FUTL2     SLINE
     C                     END
     C**
     C**   And output details to subfile
     C**
     C/COPY WNCPYSRC,SE0215C003
     C                     ADD  1         SFLREC
     C/COPY WNCPYSRC,SE0215C026
     C                     ADD  1         OUTREC
     C/COPY WNCPYSRC,SE0215C027
     C                     WRITESE0215S0
     C/COPY WNCPYSRC,SE0215C004
     C**
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT
     C*****************************************************************   S01176
     C**                                                              *   S01176
     C**  YPRICE - S/R to set up arrays which are used to calculate   *   S01176
     C**           yield based on days to maturity                    *   S01176
     C**                                                              *   S01176
     C**   Called by  SUBFIL                                          *   S01176
     C**                                                              *   S01176
     C**   Calls  SR  ZYMTX                                           *   S01176
     C**                                                              *   S01176
     C**   Calls PGM  NONE                                            *   S01176
     C**                                                              *   S01176
     C*****************************************************************   S01176
     C**                                                                  S01176
     C           YPRICE    BEGSR                                          S01176
     C*                                                                   S01176
     C** LOAD ARRAY OF NO. OF DAYS TO MATURITY USING VALUES ON            S01176
     C** RECORD READ FROM LF/CPPRIC                                       S01176
     C*                                                                   S01176
     C                     MOVE ND01      ZND,1                           S01176
     C                     MOVE ND02      ZND,2                           S01176
     C                     MOVE ND03      ZND,3                           S01176
     C                     MOVE ND04      ZND,4                           S01176
     C                     MOVE ND05      ZND,5                           S01176
     C                     MOVE ND06      ZND,6                           S01176
     C                     MOVE ND07      ZND,7                           S01176
     C                     MOVE ND08      ZND,8                           S01176
     C                     MOVE ND09      ZND,9                           S01176
     C                     MOVE ND10      ZND,10                          S01176
     C                     MOVE ND11      ZND,11                          S01176
     C                     MOVE ND12      ZND,12                          S01176
     C                     MOVE ND13      ZND,13                          S01176
     C                     MOVE ND14      ZND,14                          S01176
     C                     MOVE ND15      ZND,15                          S01176
     C                     MOVE ND16      ZND,16                          S01176
     C                     MOVE ND17      ZND,17                          S01176
     C                     MOVE ND18      ZND,18                          S01176
     C                     MOVE ND19      ZND,19                          S01176
     C                     MOVE ND20      ZND,20                          S01176
     C                     MOVE ND21      ZND,21                          S01176
     C                     MOVE ND22      ZND,22                          S01176
     C                     MOVE ND23      ZND,23                          S01176
     C                     MOVE ND24      ZND,24                          S01176
     C                     MOVE ND25      ZND,25                          S01176
     C*                                                                   S01176
     C** LOAD ARRAY OF CORRESPONDING YIELD RATES AS DEFINED ON THE        S01176
     C** RECORD READ FROM LF/CPPRIC                                       S01176
     C*                                                                   S01176
     C                     MOVE YR01      ZRT,1                           S01176
     C                     MOVE YR02      ZRT,2                           S01176
     C                     MOVE YR03      ZRT,3                           S01176
     C                     MOVE YR04      ZRT,4                           S01176
     C                     MOVE YR05      ZRT,5                           S01176
     C                     MOVE YR06      ZRT,6                           S01176
     C                     MOVE YR07      ZRT,7                           S01176
     C                     MOVE YR08      ZRT,8                           S01176
     C                     MOVE YR09      ZRT,9                           S01176
     C                     MOVE YR10      ZRT,10                          S01176
     C                     MOVE YR11      ZRT,11                          S01176
     C                     MOVE YR12      ZRT,12                          S01176
     C                     MOVE YR13      ZRT,13                          S01176
     C                     MOVE YR14      ZRT,14                          S01176
     C                     MOVE YR15      ZRT,15                          S01176
     C                     MOVE YR16      ZRT,16                          S01176
     C                     MOVE YR17      ZRT,17                          S01176
     C                     MOVE YR18      ZRT,18                          S01176
     C                     MOVE YR19      ZRT,19                          S01176
     C                     MOVE YR20      ZRT,20                          S01176
     C                     MOVE YR21      ZRT,21                          S01176
     C                     MOVE YR22      ZRT,22                          S01176
     C                     MOVE YR23      ZRT,23                          S01176
     C                     MOVE YR24      ZRT,24                          S01176
     C                     MOVE YR25      ZRT,25                          S01176
     C/COPY WNCPYSRC,SE0215C015
     C*                                                                   S01176
     C                     Z-ADDRUND      ZBASD                           S01176
     C                     Z-ADDMATY      ZMDAT                           S01176
     C                     EXSR ZYMTX                                     S01176
     C*                                                                   S01176
     C                     ENDSR                                          S01176
     C*                                                                   S01176
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C**                                                              *
     C**   ADJUST SR  REMOVE DECIMAL PLACES FROM A FIELD              *
     C**                                                              *
     C**   Called by  SUBFIL TOTFIL                                   *
     C**   Calls  SR  none                                            *
     C**   Calls PGM  NONE                                            *
     C**                                                              *
     C*****************************************************************
     C**
     C           ADJUST    BEGSR                           ** ADJUST *****
     C**
     C** FIRST LOOK BACKWARDS FOR DECIMAL POINT
     C**
     C                     MOVE *BLANKS   WORKAD
     C                     MOVEAZOUT21    ZS2
     C                     Z-ADD21        X
     C                     DO   21
     C           ZS2,X     IFEQ '.'
     C                     GOTO ADDPFD
     C                     END
     C                     SUB  1         X
     C                     END
     C**
     C** MOVE SIGNIFICANT DIGITS TO  OUTPUT FIELD
     C**
     C           ADDPFD    TAG                             ** ADDPFD TAG**
     C           X         IFGT 1
     C                     SUB  1         X
     C                     ELSE
     C                     ADD  20        X
     C                     END
     C                     Z-ADD21        J       20
     C                     Z-ADDX         K       20
     C                     DO   X
     C                     MOVE ZS2,K     ZAD,J
     C                     SUB  1         J
     C                     SUB  1         K
     C                     END
     C**
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C**                                                              *
     C**   LINK   SR  Lower level Enquiry requested                   *
     C**                                                              *
     C**   Called by  MAIN                                            *
     C**   Calls  SR  none                                            *
     C**   Calls PGM  lower level enquiry obtained from SECOND        *
     C**                                                              *
     C*****************************************************************
     C**
0740 C           LINK      BEGSR                           ***  LINK  ***
0741 C**
     C**   Access Linked Enquiry Control File for program and option
     C**
     C           LKEY      KLIST
     C                     KFLD           PGMNO
     C                     KFLD           OPTN
     C**
     C           LKEY      CHAINSECONDF              42
     C**
     C**   If record not found then entered option is invalid
     C**
     C           *IN42     IFEQ '1'
     C                     MOVE MSG,4     ERMSG
     C**
     C                     ELSE
     C**
     C**   For valid option write out LDA and linked enquiry data area
     C**   and call the program name obtained from SECOND
     C**
     C                     OUT  SESDS
     C                     OUT  LDA
     C                     CALL TPGM
     C           *LOCK     IN   LDA
     C           *LOCK     IN   SESDS
     C**
     C**   On return from lower level check return code
     C**
     C**   If 0 (Database Error) or 1 (F9 to return to menu)
     C**      then exit to calling program
     C**
     C           RTNC      IFEQ '0'
     C           RTNC      OREQ '1'
     C                     MOVE '1'       *IN01
     C                     END
     C**
     C**   If Return code is 7 (F9 to return to initial enquiry)
     C**      then check if this is the initial enquiry
     C**      and if not return to calling program
     C**
     C           RTNC      IFEQ '7'
     C           ORIG      ANDNEPGMNO
     C                     MOVE '1'       *IN01
     C                     END
     C**
     C                     END
     C/COPY WNCPYSRC,SE0215C028
     C**
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT
0738 C*****************************************************************
     C**                                                              *
     C**   RETSR  SR  End of Program Processing                       *
     C**              Write out LDA and linked enquiry data area      *
     C**              and return to the calling program               *
     C**                                                              *
     C**   Called by  MAIN, FIRST, DISP                               *
     C**   Calls  SR  none                                            *
     C**                                                              *
     C*****************************************************************
     C**
0740 C           RETSR     BEGSR                           *** RETSR   ***
0741 C**
     C           S01496    IFEQ 'Y'                                       S01496
     C                     CLOSESECDEPL1                                  S01496
     C                     ELSE                                           S01496
     C                     CLOSECDEPD                                     S01496
     C                     END                                            S01496
      *                                                                   S01496
     C/COPY WNCPYSRC,SE0215C007
     C                     OUT  SESDS
     C                     OUT  LDA
     C**
0742 C                     SETON                     LR
0391 C**
0743 C                     RETRN
0744 C*
0745 C                     ENDSR
0744 C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C**                                                              *
     C**   FIRST  SR  First Cycle Processing                          *
     C**                                                              *
     C**   Called by  MAIN                                            *
     C**   Calls  SR  RETSR, CUSTIN, ZSYSTM, ZICD2, ZICDSE,ZEVCD      *
     C**                                                              *
     C*****************************************************************
     C**
     C           FIRST     BEGSR                           ** FIRST **
     C**
     C**     Access the LDA  and  Linked Enquiry Data Area
     C**
     C           *LOCK     IN   LDA
     C           *LOCK     IN   SESDS
     C                     IN   JNSTAT
     C                     UNLCKJNSTAT
     C***********                                                         S01117
     C****READ*INSTALLATION*CONTROL*RECORD*1*FOR*RUNDATE*                 S01117
     C***********                                                         S01117
     C*******Access*File*and*check*if*record*deleted*                     S01117
     C***********                                                         S01117
     C***********          EXSR ZSYSTM                                    S01117
     C***********                                                         S01117
     C*******If*no*record*found**or*deleted*record*                       S01117
     C**********then*it*is*a*database*error*so*return*to*calling*         S01117
     C**********program*with*a*return*code*of*'0'*                        S01117
     C***********                                                         S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          MOVELPROGRM    DBPGM                           S01117
     C***********          MOVEL'ICDR1'   DBKEY            ***************S01117
     C***********          MOVE 'TABLE'   DBFILE           * DB ERROR 01 *S01117
     C***********          Z-ADD01        DBASE            ***************S01117
     C***********          SETON                       U7U8               S01117
     C***********          MOVE '0'       RTNC                            S01117
     C***********          EXSR RETSR                                     S01117
     C***********          END                                            S01117
     C***********                                                         S01117
     C****READ*INSTALLATION*CONTROL*RECORD*2*FOR*mbin*                    S01117
     C***********                                                         S01117
     C*******Access*File*and*check*if*record*deleted*                     S01117
     C***********                                                         S01117
     C***********          EXSR ZICD2                                     S01117
     C***********                                                         S01117
     C*******If*no*record*found**or*deleted*record*                       S01117
     C**********then*it*is*a*database*error*so*return*to*calling*         S01117
     C**********program*with*a*return*code*of*'0'*                        S01117
     C***********                                                         S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          MOVELPROGRM    DBPGM                           S01117
     C***********          MOVEL'ICDR2'   DBKEY            ***************S01117
     C***********          MOVE 'TABLE'   DBFILE           * DB ERROR 02 *S01117
     C***********          Z-ADD02        DBASE            ***************S01117
     C***********          SETON                       U7U8               S01117
     C***********          MOVE '0'       RTNC                            S01117
     C***********          EXSR RETSR                                     S01117
     C***********          END                                            S01117
     C**
      ** Read in RUNDAT data area                                         S01117
      *                                                                   S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C                     IN   RUNDT                                     S01117
      *                                                                   S01117
      ** Check system date format, DDMMYY or MMDDYY.                      S01117
      *                                                                   S01117
     C           DATF      COMP 'M'                      98               S01117
      *                                                                   S01117
      ***Read*in*ZMUSER*data*area**********************************S01117 090314
      ***********                                                  S01117 090314
     C************NAMVAR   DEFN           ZMUSER                   S01117 090314
     C***********          IN   ZMUSER                             S01117 090314
      *                                                                   S01117
      ** Set on indicator 07 for DSPF if multibranching environment       S01117
      *                                                                   S01117
     C           MBIN      IFEQ 'Y'
     C                     MOVE '1'       *IN07
     C                     END
     C                     Z-ADDBJDNWD    ZZDNWD                          S01117
     C                     Z-ADDBKAPDT    ZZAPDT                          S01117
     C                     EXSR ZEVCD
      *                                                                   S01117
      ** Access bank details                                              S01117
      *                                                                   S01117
     C                     CALL 'AOBANKR0'                                S01117
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C           SDBANK    PARM SDBANK    DSFDY                           S01117
      *                                                                   S01117
      ** Access Securities Trading details                                S01117
      *                                                                   S01117
     C                     CALL 'AOSTRDR0'                                S01117
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C           SDSTRD    PARM SDSTRD    DSSDY                           S01117
      *                                                                   S01117
      ** Access General Ledger details                                    S01117
      *                                                                   S01117
     C**********           CALL 'AOGELRR0'                                S01117              CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C********** SDGELR    PARM SDGELR    DSFDY                           S01117              CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C***********                                                         S01117
     C****READ*INSTALLATION*CONTROL*RECORD*SE*                            S01117
     C***********                                                         S01117
     C*******Access*File*and*check*if*record*deleted*                     S01117
     C***********                                                         S01117
     C***********          EXSR ZICDSE                                    S01117
     C***********                                                         S01117
     C*******If*no*record*found**or*deleted*record*                       S01117
     C**********then*it*is*a*database*error*so*return*to*calling*         S01117
     C**********program*with*a*return*code*of*'0'*                        S01117
     C***********                                                         S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          MOVELPROGRM    DBPGM                           S01117
     C***********          MOVEL'ICDSE'   DBKEY            ***************S01117
     C***********          MOVE 'TABLE'   DBFILE           * DB ERROR 03 *S01117
     C***********          Z-ADD03        DBASE            ***************S01117
     C***********          SETON                       U7U8               S01117
     C***********          MOVE '0'       RTNC                            S01117
     C***********          EXSR RETSR                                     S01117
     C***********          END                                            S01117
     C**
     C**     Calculate Accrual Control date
     C**
     C***********APDA      IFLT DNWD                                      S01117
     C***********ACLD      IFEQ 'Y'                                       S01117
     C***********          Z-ADDAPDA      ECD     50                      S01117
     C           BKAPDT    IFLT BJDNWD                                    S01117
     C           BKALDI    IFEQ 'Y'                                       S01117
     C                     Z-ADDBKAPDT    ECD     50                      S01117
     C                     ELSE
     C***********1         ADD  APDA      ECD                             S01117
     C           1         ADD  BKAPDT    ECD                             S01117
     C                     END
     C                     ELSE
     C***********ACLD      IFEQ 'Y'                                       S01117
     C***********APDA      SUB  1         ECD                             S01117
     C           BKALDI    IFEQ 'Y'                                       S01117
     C           BKAPDT    SUB  1         ECD                             S01117
     C                     ELSE
     C***********          Z-ADDDNWD      ECD                             S01117
     C                     Z-ADDBJDNWD    ECD                             S01117
     C                     END
     C                     END
     C/COPY WNCPYSRC,SE0215C008
      *                                                                   CSE007
      ***  Access Switchable features file for Corporate Actions.         CSE007
      *                                                                   CSE007
     C                     MOVE 'N'       CSE007  1                       CSE007
     C                     MOVE *OFF      *IN62                           CSE007
     C                     CALL 'AOSARDR0'                                CSE007
     C                     PARM '       ' @RTCD                           CSE007
     C                     PARM '*VERIFY' @OPTN                           CSE007
     C                     PARM 'CSE007'  WSARD                           CSE007
      *                                                                   CSE007
     C           @RTCD     IFEQ *BLANKS                                   CSE007
      *                                                                   CSE007
      ***  If Corporate Actions feature is installed.                     CSE007
      *                                                                   CSE007
     C                     MOVE 'Y'       CSE007                          CSE007
     C                     MOVE *ON       *IN62                           CSE007
     C                     ELSE                                           CSE007
      *                                                                   CSE007
      ***  Setup work field to call SE6710, SE6712, SE6714 and SE6716.    CSE007
      *                                                                   CSE007
     C                     MOVE 'Y'       SE6710  1                       CSE007
     C                     MOVE 'Y'       SE6712  1                       CSE007
     C                     MOVE 'Y'       SE6714  1                       CSE007
     C                     MOVE 'Y'       SE6716  1                       CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CEU017
      ***  Access Switchable features file for Securities Redenomination  CEU017
      *                                                                   CEU017
     C                     MOVE 'N'       CEU017  1                       CEU017
     C                     CALL 'AOSARDR0'                                CEU017
     C                     PARM '       ' @RTCD                           CEU017
     C                     PARM '*VERIFY' @OPTN                           CEU017
     C                     PARM 'CEU017'  WSARD                           CEU017
      *                                                                   CEU017
     C           @RTCD     IFEQ *BLANKS                                   CEU017
      *                                                                   CEU017
      ***  If Securities Redenomination is installed.                     CEU017
      *                                                                   CEU017
     C                     MOVE 'Y'       CEU017                          CEU017
     C                     MOVE *ON       *IN62                           CEU017
     C                     ELSE                                           CEU017
      *                                                                   CEU017
      ***  Setup work field to call SE6710, SE6712, SE6714 and SE6716.    CEU017
      *                                                                   CEU017
     C                     MOVE 'Y'       SE6710  1                       CEU017
     C                     MOVE 'Y'       SE6712  1                       CEU017
     C                     MOVE 'Y'       SE6714  1                       CEU017
     C                     MOVE 'Y'       SE6716  1                       CEU017
     C                     ENDIF                                          CEU017
      *                                                                   103446
      **  Access SAR details file to see if JYSKE Enhcmts is installed.   103446
      *                                                                   103446
     C                     CALL 'AOSARDR0'                                103446
     C                     PARM '       ' @RTCD                           103446
     C                     PARM '*VERIFY' @OPTN                           103446
     C                     PARM 'S01496'  WSARD   6                       103446
      *                                                                   103446
     C           @RTCD     IFEQ *BLANK                                    103446
     C                     MOVE 'Y'       S01496  1                       103446
     C                     MOVE *ON       *IN61                           103446
     C                     END                                            103446
      *                                                                   CGL011
      ** Access Switchable Features file and check if CGL011              CGL011
      ** is switched on or not.                                           CGL011
      *                                                                   CGL011
     C                     CALL 'AOSARDR0'                                CGL011
     C                     PARM *BLANKS   PRTCD   7                       CGL011
     C                     PARM '*VERIFY' POTPN   7                       CGL011
     C                     PARM 'CGL011'  PSARD   6                       CGL011
     C           SCSARD    PARM SCSARD    DSFDY                           CGL011
      *                                                                   CGL011
     C           PRTCD     IFEQ *BLANKS                                   CGL011
     C                     MOVE 'Y'       CGL011  1                       CGL011
      *                                                                   CGL011
     C                     ELSE                                           CGL011
     C                     MOVE 'N'       CGL011                          CGL011
     C           PRTCD     IFNE '*NRF   '                                 CGL011
     C                     MOVELPROGRM    DBPGM            ***************CGL011
     C                     Z-ADD004       DBASE            * DB ERROR 004*CGL011
     C                     MOVEL'SCSARDPD'DBFILE           ***************CGL011
     C                     MOVEL'CGL011  'DBKEY                           CGL011
     C                     MOVE *ON       *INU7                           CGL011
     C                     MOVE *ON       *INU8                           CGL011
     C                     EXSR *PSSR                                     CGL011
     C                     MOVE '0'       RTNC                            CGL011
     C                     EXSR RETSR                                     CGL011
     C                     ENDIF                                          CGL011
     C                     ENDIF                                          CGL011
      *                                                                                       233736
      ** Check if Switchable feature for EU Savings is on                                     233736
      *                                                                                       233736
     C                     MOVE 'N'       CGL031  1                                           233736
     C                     CALL 'AOSARDR0'                                                    233736
     C                     PARM '       ' @RTCD                                               233736
     C                     PARM '*VERIFY' @OPTN                                               233736
     C                     PARM 'CGL031'  WSARD                                               233736
      *                                                                                       233736
     C           @RTCD     IFEQ *BLANKS                                                       233736
     C                     MOVE 'Y'       CGL031                                              233736
     C                     ENDIF                                                              233736
      *                                                                                       CGL014
      ** Access Switchable Features file and check if CGL014                                  CGL014
      ** is switched on or not.                                                               CGL014
      *                                                                                       CGL014
     C                     CALL 'AOSARDR0'                                                    CGL014
     C                     PARM *BLANKS   PRTCD                                               CGL014
     C                     PARM '*VERIFY' POTPN                                               CGL014
     C                     PARM 'CGL014'  PSARD                                               CGL014
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL014
      *                                                                                       CGL014
     C           PRTCD     IFEQ *BLANKS                                                       CGL014
     C                     MOVE 'Y'       CGL014  1                                           CGL014
      *                                                                                       CGL014
     C                     ELSE                                                               CGL014
     C                     MOVE 'N'       CGL014                                              CGL014
     C           PRTCD     IFNE '*NRF   '                                                     CGL014
     C                     MOVELPROGRM    DBPGM                                               CGL014
     C                     Z-ADD005       DBASE                                               CGL014
     C                     MOVEL'SCSARDPD'DBFILE                                              CGL014
     C                     MOVEL'CGL014  'DBKEY                                               CGL014
     C                     MOVE *ON       *INU7                                               CGL014
     C                     MOVE *ON       *INU8                                               CGL014
     C                     EXSR *PSSR                                                         CGL014
     C                     MOVE '0'       RTNC                                                CGL014
     C                     EXSR RETSR                                                         CGL014
     C                     ENDIF                                                              CGL014
     C                     ENDIF                                                              CGL014
      *                                                                   103446
     C           S01496    IFEQ 'Y'                                       103446
     C           CSE007    OREQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C                     OPEN SECDEPL1                                  103446
     C                     ELSE                                           103446
     C                     OPEN CDEPD                                     103446
     C                     END                                            103446
     C**
     C**     If no cust. number found in request data
     C**        setup a blank screen for display
     C**     else access details for display
     C**
     C                     MOVE '1'       *IN03
     C**
     C********** RQCUST    IFNE *ZEROS                                                        CSD027
     C           RQCUST    IFNE *BLANKS                                                       CSD027
     C           RQCUST    ANDNE*ZEROS                                                      BUG11745
     C                     MOVELRQCUST    CUSTMR 10
     C                     MOVE *BLANKS   RQCUST
     C***********          MOVELRQBRCH    BRANCH                          S01117
     C***********          MOVE *BLANKS   RQBRCH                          S01117
     C                     MOVELRQBRCA    BRANCH                          S01117
     C                     MOVE *BLANKS   RQBRCA                          S01117
     C                     EXSR CUSTIN
     C                     END
     C/COPY WNCPYSRC,SE0215C029
     C**
     C**      Access program name - for help and linked enquiries
     C**
     C                     MOVELPROGRM    PGMNO   8
     C**
     C**     SET UP STANDARD FIELDS FOR SFL LINES
     C                     MOVE '+ACC. IN'ACIN1
     C                     MOVE 'T'       ACIN1A
     C                     MOVE '*'       AST
     C                     MOVE 'AT'      AT
     C                     MOVE 'VALUE ON'VAL
     C                     MOVE '* FUTURE'FL1
     C                     MOVE ' VALUE T'FL2
     C                     MOVE 'RADES'   FL3
     C                     MOVE 'TOTAL PO'TL1
     C                     MOVE 'RTFOLIO 'TL2
     C                     MOVE 'VALUE'   TL3
     C                     MOVE 'NET'     TL4
      ***********                                                  S01496 103446
      ****Access*SAR details f*le to see if JYSKE Enhcmts is instalS01496 103446
      ***********                                                  S01496 103446
     C***********          CALL 'AOSARDR0'                         S01496 103446
     C***********          PARM '       ' @RTCD                    S01496 103446
     C***********          PARM '*VERIFY' @OPTN                    S01496 103446
     C***********          PARM 'S01496'  WSARD   6                S01496 103446
      ***********                                                  S01496 103446
     C***********@RTCD     IFEQ *BLANK                             S01496 103446
     C***********          MOVE 'Y'       S01496  1                S01496 103446
     C***********          MOVE *ON       *IN61                    S01496 103446
     C***********          END                                     S01496 103446
      ***********                                                  S01496 103446
     C***********S01496    IFEQ 'Y'                                S01496 103446
     C***********          OPEN SECDEPL1                           S01496 103446
     C***********          ELSE                                    S01496 103446
     C***********          OPEN CDEPD                              S01496 103446
     C***********          END                                     S01496 103446
     C**
      *                                                                                       CSE035
      ** Access SAR details file to see if CSE035 is installed                                CSE035
      *                                                                                       CSE035
     C                     CALL 'AOSARDR0'                                                    CSE035
     C                     PARM *BLANKS   @RTCD                                               CSE035
     C                     PARM '*VERIFY' @OPTN                                               CSE035
     C                     PARM 'CSE035'  WSARD                                               CSE035
      *                                                                                       CSE035
     C           @RTCD     IFEQ *BLANK                                                        CSE035
     C                     MOVE 'Y'       CSE035  1                                           CSE035
     C                     ELSE                                                               CSE035
     C                     MOVE 'N'       CSE035                                              CSE035
     C                     END                                                                CSE035
      *                                                                                       207543
      ** Access SAR details file to see if CEU018 is installed                                207543
      *                                                                                       207543
     C                     CALL 'AOSARDR0'                                                    207543
     C                     PARM *BLANKS   @RTCD                                               207543
     C                     PARM '*VERIFY' @OPTN                                               207543
     C                     PARM 'CEU018'  WSARD                                               207543
      *                                                                                       207543
     C           @RTCD     IFEQ *BLANK                                                        207543
     C                     MOVE 'Y'       CEU018  1                                           207543
     C                     ELSE                                                               207543
     C                     MOVE 'N'       CEU018                                              207543
     C                     END                                                                207543
      *                                                                                       CSE035
     C/COPY WNCPYSRC,SE0215C005
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT                                                              S01117
      *****************************************************************   S01117
      *                                                               *   S01117
      * CHKSEL - Subroutine to check for question marks.              *   S01117
      *                                                               *   S01117
      * Called by: MAIN                                               *   S01117
      *                                                               *   S01117
      * Calls: None                                                   *   S01117
      *                                                               *   S01117
      *****************************************************************   S01117
      *                                                                   S01117
     C           CHKSEL    BEGSR                                          S01117
      *                                                                   S01117
     C                     Z-ADD0         @SEL    10                      S01117
      *                                                                   S01117
     C                     MOVELCUSTMR    @QMK    1                       S01117
     C           @QMK      IFEQ '?'                                       S01117
     C                     Z-ADD1         @SEL                            S01117
      *                                                                   S01117
      ** Access Securities Clients Details file                           S01117
      *                                                                   S01117
     C                     CALL 'AOSECSR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM '?     '  @AENB   6                       S01117
     C           SDSECS    PARM SDSECS    DSSDY                           S01117
     C           @RTCD     IFEQ '*NOSEL'                                  S01117
     C                     MOVE *BLANK    CUSTMR                          S01117
     C                     ELSE                                           S01117
     C                     MOVE *BLANK    CUSTMR                          S01117
     C                     MOVELBFCUST    CUSTMR                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     MOVELBRANCH    @QMK    1                       S01117
     C           @QMK      IFEQ '?'                                       S01117
     C                     Z-ADD1         @SEL                            S01117
      *                                                                   S01117
      ** Access branch details file SDBRCHPD via access object program    S01117
      *                                                                   S01117
     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM '?  '     @BRCD   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01117              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           @RTCD     IFEQ '*NOSEL'                                  S01117
     C                     MOVE *BLANK    BRANCH                          S01117
     C                     ELSE                                           S01117
     C                     MOVE A8BRCD    BRANCH                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     ENDSR                                          S01117
      *****************************************************************   S01117
      /EJECT                                                              S01117
      *****************************************************************   S01117
      *                                                               *   S01117
      *  *PSSR  - Error control subroutine                            *   S01117
      *                                                               *   S01117
      *****************************************************************   S01117
      *                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR **    S01117
     C**                                                                  S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     ENDSR                                          S01117
      *                                                                   S01117
     C/EJECT                                                              159599
     C*****************************************************************   159599
     C*                                                               *   159599
     C*  R0455  :  Accumulate details for a Security                  *   159599
     C*                                                               *   159599
     C*  Called by :  DISP                                            *   159599
     C*                                                               *   159599
     C*  Calls     :  None                                            *   159599
     C*                                                               *   159599
     C*****************************************************************   159599
     C*                                                                   159599
     C           R0455     BEGSR                                          159599
     C*                                                                   159599
     C** Accumulate details for a Security                                159599
     C*                                                                   159599
     C           SAVBR     IFEQ CDPA                                      159599
     C           PCUST     ANDEQCDCN                                      159599
     C*                                                                   159599
     C                     ADD  CDNV      ZCUMCP                          159599
     C                     ADD  CNPV      ZCUMCP                          159599
     C                     ADD  CNSV      ZCUMCP                          159599
     C                     SUB  CECN      ZCUMCP                          159599
     C           BVTVDV    IFEQ 'T'                                       159599
     C                     ADD  CDNT      ZNOMP                           159599
     C                     ADD  CDNT      ZZNOML                          159599
     C                     ADD  SNPT      ZZNOML                          159599
     C                     ADD  CDST      ZZNOML                          159599
     C                     ADD  CDNV      ZZNOMU                          159599
     C                     ADD  CNPV      ZZNOMU                          159599
     C                     ADD  CNSV      ZZNOMU                          159599
     C*                                                                   159599
     C** REMEMBER: For customer, TP is a sale, TS is a purchase           159599
     C*                                                                   159599
     C                     ADD  SNPT      ZZSAL                           159599
     C                     ADD  CDST      ZZPUR                           159599
     C                     ADD  SAPP      ZZAPS                           159599
     C                     ADD  SAPS      ZZAPP                           159599
     C                     ELSE                                           159599
     C                     ADD  CDNV      ZNOMP                           159599
     C                     ADD  CDNV      ZZNOML                          159599
     C                     ADD  CNPV      ZZNOML                          159599
     C                     ADD  CNSV      ZZNOML                          159599
     C                     ADD  CDNT      ZZNOMU                          159599
     C                     ADD  SNPT      ZZNOMU                          159599
     C                     ADD  CDST      ZZNOMU                          159599
     C*                                                                   159599
     C** REMEMBER: For customer, TP is a sale, TS is a purchase           159599
     C*                                                                   159599
     C                     ADD  CNPV      ZZSAL                           159599
     C                     ADD  CNSV      ZZPUR                           159599
     C                     ADD  SAPV      ZZAPS                           159599
     C                     ADD  SPSV      ZZAPP                           159599
     C                     ENDIF                                          159599
     C                     MOVE '1'       *IN50                           159599
      *                                                                                       233736
      ** Check for security if subject to EU tax -                                            233736
      ** If so, get the latest position and details of the                                    233736
      ** average fiscal price of all portfolios for averaging                                 233736
      *                                                                                       233736
     C           CDSN      CHAINSECTY                15                                       233736
     C           *IN15     IFEQ '0'                                                           233736
     C                     MOVE MKTI      SVMKT   1                                           233736
     C                     ENDIF                                                              233736
     C           CGL031    IFEQ 'Y'                                                           233736
     C           SETX      ANDEQ'Y'                                                           233736
      *                                                                                       233736
     C                     MOVE PCUST     PCUST2                                              233736
     C           KCPOS     IFNE PCPOS                                                         233736
     C                     CALL WPGM                                                          233736
     C                     PARM           WRTCD  10                                           233736
     C                     PARM           SAVBR                                               233736
     C                     PARM           PCUST                                               233736
     C                     PARM           CDSN                                                233736
     C                     PARM           PTFR                                                233736
     C                     PARM           SVMKT                                               233736
     C                     PARM           RUND                                                233736
     C                     PARM           ETCPOS                                              233736
     C                     MOVE KCPOS     PCPOS                                               233736
     C                     ADD  CSNV      WCSNV                                               233736
     C                     ADD  CSAV      WCSAV                                               233736
     C                     ENDIF                                                              233736
      *                                                                                       233736
     C                     ENDIF                                                              233736
     C*                                                                   159599
     C                     ENDIF                                          159599
     C*                                                                   159599
     C                     ENDSR                                          159599
     C*****************************************************************   159599
      ********************************************************************S01117
      ***/EJECT**                                                   S01232S01195
     C***/COPY*ZSRSRC,XDATE3Z1                                      S01232S01195
      /EJECT                                                              S01195
     C/COPY ZSRSRC,ZACCH                                                  S01195
      /EJECT
     C/COPY ZSRSRC,ZACCRZ1
     C/EJECT                                                              E39495
     C/COPY ZSRSRC,ZACCZZ1                                                E39495
      /EJECT
     C/COPY ZSRSRC,ZALIGNZ2
      /EJECT                                                              S01195
     C/COPY ZSRSRC,ZBKDT                                                  S01195
     C/EJECT                                                              E39495
     C/COPY ZSRSRC,ZCALCD                                                 E39495
     C/EJECT                                                              E39495
     C/COPY ZSRSRC,ZCNSDZ1                                                E39495
      /EJECT
     C/COPY ZSRSRC,ZCONVZ1
      /EJECT
     C/COPY ZSRSRC,ZDATE1Z2
      /EJECT
     C/COPY ZSRSRC,ZDATE2Z4
      /EJECT
     C/COPY ZSRSRC,ZDAYSZ2
      /EJECT
     C/COPY ZSRSRC,ZDYYRZ3
      /EJECT
     C/COPY ZSRSRC,ZEVCDZ1
      ***/EJECT**                                                         S01117
     C***/COPY*ZSRSRC,ZICD2Z1                                             S01117
      ***/EJECT**                                                         S01117
     C***/COPY*ZSRSRC,ZICDSEZ1                                            S01117
      /EJECT                                                              E20380
     C/COPY ZSRSRC,ZLCDZ1                                                 E20380
      /EJECT
     C/COPY ZSRSRC,ZNCDZ3
      /EJECT                                                              S01176
     C/COPY ZSRSRC,ZPRCIZ1                                                S01176
      /EJECT
     C***** /COPY ZSRSRC,ZPRCOZ1                                          S01186
     C/COPY ZSRSRC,ZPRCOZ1                                                E16894
      /EJECT
     C/COPY ZSRSRC,ZRATEZ1
      /EJECT                                                              S01232
     C/COPY ZSRSRC,ZRSTORZ1                                               S01232
      /EJECT                                                              S01232
     C/COPY ZSRSRC,ZSAVEZ1                                                S01232
      /EJECT
     C/COPY ZSRSRC,ZSDESCZ3
      /EJECT
     C/COPY ZSRSRC,ZSEDITZ3
      /EJECT
     C***/COPY ZSRSRC,ZSYSTMZ1                                            S01117
      ***/EJECT                                                           S01117
     C/COPY ZSRSRC,ZXRATEZ1
      /EJECT                                                              S01232
     C/COPY ZSRSRC,ZYCEZ1                                                 S01232
      /EJECT                                                              S01176
     C/COPY ZSRSRC,ZYLDIZ1                                                S01176
      /EJECT
     C/COPY ZSRSRC,ZYLDOZ1
      /EJECT
     C/COPY ZSRSRC,ZYLDZ2
      /EJECT                                                              S01176
     C/COPY ZSRSRC,ZYMTXZ2                                                S01176
      /EJECT
      ***
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
**   MSG  - ERROR MESSAGES
ENTER A CUSTOMER NO./SHORTNAME, OR TAKE F/6 FOR SHORTNAME ENQUIRY
INVALID ENTRY - BOTH CUSTOMER NO./SHORTNAME AND OPTION ENTERED
INVALID ENTRY - ONLY ONE OPTION MAY BE SELECTED
INVALID OPTION - ENTER 1(SEC. DETS) 2(PORTFOLIO MOVEMNTS) OR 3(CLIENT HOLDINGS)
INVALID CUSTOMER NO./SHORTNAME - PLEASE RE-ENTER OR TAKE F/6
THIS IS THE INITIAL ENQUIRY - F/3 WILL EXIT TO MENU
ENTER A CUSTOMER NUMBER OR SHORTNAME, OR SELECT AN OPTION
INVALID BRANCH - PLEASE RE-ENTER
CUSTOMER IS NOT A PORTFOLIO CUSTOMER - PLEASE RE-ENTER OR TAKE F/6
USER NOT AUTHORISED TO BRANCH - PLEASE RE-ENTER
CUSTOMER NOT A SECURITIES CUSTOMER - PLEASE RE-ENTER OR TAKE F/6
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
0006001521029820444305904073650882610287117481320914670161311759219053
2051421975234362489726358278192928030741322023366335124365853804639507
40968424294389045351
**  POWER8 - ARRAY OF POWERS FOR NOMINAL DP TO CURRENCY DP CONVERSION
00000001
00000010
00000100
00001000
00010000
00100000
01000000
10000000
