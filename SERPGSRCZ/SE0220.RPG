     H        1
     F*****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Customer portfolio movements enquiry')        *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Security Trading Module                              *
     F*                                                               *
     F*  SE0220 - CUSTOMER PORTFOLIO MOVEMENTS ENQUIRY                *
     F*                                                               *
     F*  Function:  This program displays details of transactions for *
     F*   (I/C)     a particular customer's portfolio.  For each      *
     F*             Security,the following figures are shown:         *
     F*             Brought Forward; Purchases, Sales, Walk-Ins and   *
     F*             walk-outs to date; and a Carry Forward Total.     *
     F*             Figures are shown on either a Trade or Value date *
     F*             basis as determined by the bank on installation.  *
     F*             Selection of Month/Year and Security Shortname is *
     F*             optional. In a Multi-Branch environment, Branch   *
     F*             may also be entered.                              *
     F*             Each option available from this enquiry is held   *
     F*             as a record on PF/SECOND - Linked Enquiry Control *
     F*             file with fields: Calling Program, Option         *
     F*             Selected, Called Program.                         *
     F*                                                               *
     F*  Calls:     F6 may be taken when the Customer or Security has *
     F*             not been entered to call:                         *
     F*             - SE0270 - Customer Shortname Enquiry; or         *
     F*             - SE0240 - Security Report Name Enquiry;          *
     F*             respectively.                                     *
     F*             Additionally, options may be entered against a    *
     F*             transaction to call:                              *
     F*             1) SE0245 - Security Details Enquiry              *
     F*             2) SE0250 - Trade Details Enquiry                 *
     F*             3) SE0205 - Client Holdings Enquiry.              *
     F*             4) SEDPMVSIN - Depot Movements Enquiry            *    CSE041
     F*             5) SEC025 - Movement Status Enquiry               *    CSE039
     F**************NB.Option*2*not*allowed*against*a*depot*movement.**    CSE041
     F*                                                               *
     F*  Called by: SEC04 - CL Component to Control SE Enquiries      *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. MD057247           Date 01Feb21               *
      *  Prev Amend No. MD050604           Date 21Feb20               *
      *                 MD046248           Date 27Oct17               *
      *                 226449             Date 24Jun15               *
      *                 MD034776           Date 08Jul15               *
      *                 AR1067108          Date 11Dec12               *
      *                 AR1001183A         Date 20Nov12               *
      *                 CER059             Date 19Jul10               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 234300             Date 29Sep06               *
      *                 BUG11813           Date 04Aug06               *
      *                 BUG11743           Date 21Jul06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSE071             Date 19Jul05               *
      *                 229857             Date 07Oct04               *
      *                 214953             Date 11Apr03               *
      *                 226570             Date 27Jun04               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3122            Date 17Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 BUG2507            Date 25May04               *
      *                 BUG2271            Date 28Apr04               *
      *                 CGL029             Date 01Sep03               *
      *                 222727             Date 05Nov03               *
      *                 211407             Date 11Nov02               *
      *                 208241             Date 21Aug02               *
      *                 194370             Date 12Jul01               *
      *                 207543             Date 17JUL02               *
      *                 180056             Date 18Oct00               *
      *                 CSE035             Date 22Apr02               *
      *                 CSE039             Date 17Mar03               *
      *                 CSE041             Date 13Mar03               *
      *                 206316             Date 19Jul02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 17Jun01               *
      *                 CSE031             Date 06Dec01               *
      *                 180707             Date 25Jul00               *
      *                 186427             Date 16Nov01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 127566             Date 09May01               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CSD007             Date 28Aug00               *
      * Midas DBA 3.03 -----------------------------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CSE015             Date 06Dec99               *
      *                 CSE017             Date 20Oct99               *
      *                 CSE012             Date 16Aug99               *
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CSE010             Date 21Jun99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 130862             Date 18Oct98               *
      *                 151945             Date 06Jan99               *
     F*                 105586             DATE 24FEB98               *
     F*                 CSE005             DATE 04FEB97               *
     F*                 084704             DATE 01AUG96               *
     F*                 083039             DATE 01AUG96               *
     F*                 059110             DATE 25JUL96               *
     F*                 088047             DATE 26JUN96               *
     F*                 100228             DATE 30MAY96               *
     F*                 102644             DATE 30APR96               *
     F*                 099886             DATE 17APR96               *
     F*                 100017             DATE 17APR96               *
     F*                 090501             DATE 25OCT95               *
     F*                 092961             DATE 04OCT95               *
     F*                 091254             DATE 20OCT95               *
     F*                 086491             DATE 15JUN95               *
     F*                 S01496  JSV        DATE 07OCT94               *
     F*                 065301             DATE 05MAY94               *
     F*                 S01445             DATE 04NOV93               *
     F*                 052254             DATE 07JAN94               *
     F*                 S01401             DATE 16JUN93               *
     F*                 E39495             DATE 17FEB93               *
     F*                 047922             DATE 01FEB93               *
     F*                 S01397             DATE 10SEP92               *
     F*                 E38086             DATE 15JUL92               *
     F*                 E35915             DATE 20FEB92               *
     F*                 E34849             DATE 28JAN92               *
     F*                 E34847             DATE 23JAN92               *
     F*                 E32674             DATE 03DEC91               *
     F*                 E31583             DATE 02DEC91               *
     F*                 E31763             DATE 02DEC91               *
     F*                 E32164             DATE 02DEC91               *
     F*                 E27934             DATE 22OCT91               *
     F*                 E27092             DATE 04SEP91               *
     F*                 S01117             DATE 28FEB91               *
     F*                 S01195             DATE 28FEB91               *
     F*                 S01220             DATE 28FEB91               *
     F*                 S01269             DATE 19JUL90               *
     F*                 S01271             DATE 19JUN90               *
     F*                 E23128             DATE 07AUG90               *
     F*                 E23125             DATE 06AUG90               *
     F*                 E21668             DATE 01MAY90               *
     F*                 E21616             DATE 03APR90               *
     F*                 E21480             DATE 21MAR90               *
     F*                 E21428             DATE 19MAR90               *
     F*                 E21026             DATE 05FEB90               *
     F*                 E21002             DATE 05FEB90               *
     F*                 E20651             DATE 29JAN90               *
     F*                 E20783             DATE 05JAN90               *
     F*                 S01232             DATE 15DEC89               *
     F*                 E20327             DATE 13DEC89               *
     F*                 E20324             DATE 13DEC89               *
     F*                 E20380             DATE 08DEC89               *
     F*                 E19986             DATE 25OCT89               *
     F*                 E19918             DATE 25OCT89               *
     F*                 S01199             DATE 03/08/89              *
     F*                 E18658             DATE 30/06/89              *
     F*                 E16772             DATE 20/06/89              *
     F*                 E17130             DATE 22/02/89              *
     F*                 E16825             DATE 20/02/89              *
     F*                 E16802             DATE 20/02/89              *
     F*                 E15706             DATE 20/02/89              *
     F*                 E15221             DATE 20/02/89              *
     F*                 E15707             DATE 13/02/89              *
     F*                 E16063             DATE 21/10/88              *
     F*                 S01179             DATE 21/10/88              *
     F*                 E14576             DATE 19/10/88              *
     F*                 E15215             DATE 30/09/88              *
     F*                 E15334             DATE 30/09/88              *
     F*                 E15306             DATE 28/09/88              *
     F*                 E15304             DATE 28/09/88              *
     F*                 E13854             DATE 31/07/88              *
     F*                 E13571             DATE 31/07/88              *
     F*                 E13657             DATE 11/07/88              *
     F*                 E14057             DATE 04/07/88              *
     F*                 E13975             DATE 30/06/88              *
     F*                 E13541             DATE 27/06/88              *
     F*                 E13853             DATE 22/06/88              *
     F*                 E13484             DATE 02/06/88              *
     F*                 S01158             DATE 06/05/88              *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  MD057247 - Multiple calls of UTCHOBJEX for several COB com-  *
      *             ponents - Securities module.                      *
      *           - Moved the call of AOSARDR0 from /copy ZLCDZ1.     *
      *  MD050604 - Average price of position changed incorrectly.    *
      *           - Recompiled due to changes in copy source ZCNSDZ1. *
      *  MD046248 - Finastra Rebranding                               *
      *  226449 - Recompiled over changes made in /COPY ZDYYRZ3.      *
      *         - Applied for MD034387.                               *
      *  MD034776 - Reverse AR1001183A to allow negative interest     *
      *             rate. (Recompile)                                 *
      *  AR1067108 - PMC1140 Component failed during Clean COB        *
      *              Applied fix AR1001183A                           *
      *  AR1001183A - Coupon rate was still used in computation of    *
      *              interest instead of using the details in FRN tab *
      *              (Reopen) (Recompile)                             *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  234300 - Recompiled over changed in PF/HSTTRD.               *
      *  BUG11813 - Screen has no validation when status movement     *
      *             enquiry is selected                               *
      *  BUG11743 - Customer number defaults to zero                  *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  229857 - Recompiled due to change in ZYLDZ2.                 *
      *  214953 - Not able to enquire on depot movement details. Fix  *
      *           is to call new pgm SE0071 when option '2' is entered*
      *           against a WI/WO record transaction.                 *
      *  226570 - Recompiled due to change in ZYLDZ2.                 *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3122 - Recompiled due to changes in SDSECSPD.             *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  BUG2507 - Logical File must contain Depot Value Date with    *
      *            CSE015.  Applied fix 210170.                       *
      *  BUG2271 - Changed misleading error message texts by removing *
      *            "OR TAKE F/6" on compile-time array MSG elements   *
      *            5 and 11.                                          *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222727 - Release 5.0 errors  (Recompile)                     *
      *  211407 - Recompile after change on copy sources ZYLDZ2,      *
      *           ZACCRZ1 and ZYCEZ1 for NX/NNX processing.           *
      *           The change was to call subroutine ZLCD1 instead     *
      *           of ZLCD in retrieving the PERIOD for NNX processing *
      *           and ZNCD1 is called instead of ZNCD in retrieving   *
      *           the WBENCD for NNX processing. Also rewrite tests   *
      *           for identifying if position is NX,NNX or CUM.       *
      *  208241 - Recompiled over changed /CPY ZSDESCZ3.              *
      *  194370 - Recompile after change on copy sources ZYLDZ2,      *
      *           For securities with divisor basis = '5' and first   *
      *           coupon date > valuation date (rundate + 1), set     *
      *           event control date to first coupon date before      *
      *           processing SR/ZDYYR. This is to ensure that the     *
      *           correct hypothetical last and next coupon dates are *
      *           used in deriving the price/yield rate.              *
      *  207543 - CEU018 not working on a price basis.                *
      *  180056 - Recompiled over changed in ZDYYRZ3.                 *
      *  CSE035 - NX/NNX Coupon Payment Processing.                   *
      *  CSE039 - Auto-settlement of trades                           *
      *           Add processing for option 4                         *
      *  CSE041 - Include DVP/RVP movements on screen                 *
      *  206316 - Recompiled over changed ZLCDZ1.                     *
      *  CPK015 - Conversion of ZYIELD from PLI to RPG.               *
      *           Recompile over changed ZYLDZ2.                      *
      *  CSE031 - Coupon Fixing for Floating Rate Notes.              *
      *           (recompilation due to change to ZNCD/ZLCD/ZACCR)    *
      *  180707 - No Position Settlements generated. Recompile over   *
      *           changes in /COPY ZNCDZ3.                            *
      *  186427 - DB Err 04 must be skipped for a cancelled security  *
      *           (if still a live position on it, nominal is zero).  *
      *  127566 - Recompiled over changed ZSDESCZ3                    *
      *  CSD007 - Customer Closing                                    *
      *  CSE015 - Forward Valued Depot Movements (Recompile)          *
      *  CSE017 - Cum/Ex Indicator on Depot Movement (Recompile)      *
      *  CSE012 - SE Depot Movement Narratives (Recompiled).          *
      *  CSE010 - SE Transactions Enhancement                         *
     F*  130862 - Recompiled over ZLCDZ1 & ZDAYSZ2 changes.           *
     F*  151945 - Recompiled Over changed ZDYYRZ3 .                   *
     F*  105586 - FOR UNIT PRICE BASIS, REFORMAT BOOK PRICE FOR B/F   *
     F*           FROM NOMINAL CURRENCY DECIMAL PLACES TO A STRAIGTH  *
     F*           15/8 PRICE.
     F*  CSE005 - Effect of holidays on FRN Coupon Dates              *
     F*           (recompilation due to change to ZNCD/ZLCD/ZACCR).   *
     F*  084704 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
     F*  083039 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
     F*  059110 - Recompiled over changed ZYLDZ2 sub.                 *
     F*  088047 - RECOMPILE over change SR/ZYLDZ2.                    *
     F*  100228 - RECOMPILE OVER CHANGED ZDYYRZ3, ZLCDZ1 & ZNCDZ3.    *
     F*  102644 - Increase the array for currency with CDP to zeroes  *
     F*  099886 - Rounding problem for partly paid securities.        *
     F*           Recompile over amended standard subroutine ZACCZ.   *
     F*  100017 - Position settlement unable to pick up day adj. on   *
     F*           SECTYD. Change subroutine to use DADJN to stop      *
     F*           interest day adjustment being used for amortisation.*
     F*           Recompile over amended subroutine ZDAYS.            *
     F*  090501 - Display message if security cancelled, as well as   *
     F*           if it is not on file or deleted.                    *
     F*  092961 - Recompile over ZDAYSZ2 which was amended by 086491  *
     F*           (Wrong number of days calculated for day basis 1    *
     F*           when start or end day is last day of February)      *
     F*  091254 - RECOMPILE OVER CHANGED ZLCDZ1 & ZNCDZ3              *
     F*  086491 - Wrong nbr of days calculated for day basis 1        *
     F*           when start or end day is last day of February       *
     F*           Recompiled for ZSRSRC/ZDAYSZ2 changes.              *
     F*  S01496 - Incorporation of JYSKE Enhancements (S10978)        *
     F*  065301 - Recompiled over changed copy source ZACCR subr.     *
     F*           with ZAMT increased to 15,0.                        *
     F*  S01445 - DEPOT MOVEMENT CHARGES ENHANCEMENT.                 *
     F*           Recompiled due to changes in PF/DPTMVD.             *
     F*  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
     F*           to 10,9                                             *
     F*  S01401 - MT5xx SWIFT Messages Feature:                       *
     F*           - Recompiled due to changes to files.               *
     F*  E39495 - New /COPY subroutine ZCALCD added (called from      *
     F*           sr. ZYLD)                                           *
     F*         - Recompiled over changed ZYLDZ2                      *
     F*  047922 - Recompiled over changed SR/ZYLDZ2                   *
     F*  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
     F*           - Recompiled due to changes to files and SR/ZYLD.   *
     F*  E38086 - Trades Enquiry (option 2) should not be allowed     *
     F*           against the Security. What it does is to enquire on *
     F*           the first Trade Reference under that Security, but  *
     F*           if the first entry is a Depot Movement, it will try *
     F*           to do a Trade Enquiry on the Depot Movement         *
     F*           Reference Number.                                   *
     F*  E35915 - Authorised deleted trades should not be shown       *
     F*  E34849 - Average price was not worked out properly           *
     F*  E34847 - Nominal decimal places are ignore for depot mvts    *
     F*  E32674 - Recompiled due to error in DPTMVD.                  *
     F*  E31583 - Checking authority on the Branch Code obtained from *
     F*           reading records for Brought Forward amount, etc. is *
     F*           wrong. This branch is irrelevant and may not be the *
     F*           same as the correct branch which has been checked   *
     F*           anyway. If blank, it causes serious problems.       *
     F*  E31763 - To reduce rounding errors on the Price shown on the *
     F*           Detail Lines of Trades, (especially for Yields and  *
     F*           Discounts), use the P/D/Y field from the Trade if   *
     F*           the Trade Price is the same as the Contract Price.  *
     F*  E32164 - Errors in Structure of program:                     *
     F*           - Wrong details printed for Depot Movements. This is*
     F*             caused by the save of the 'Trades' record. Most of*
     F*             the Depot Movement fields are redefined to be the *
     F*             same names as the Trades fields, but DPMV and MKTP*
     F*             were not, therefore they got overwritten.         *
     F*           - Although the logicals built over the Trades File  *
     F*             all have different lengths because of odd fields  *
     F*             missing from the file definitions, SRECIN must be *
     F*             the same length as RECIN, (defined from TRADSD).  *
     F*           - SELCRI (Selection Criteria) was incorrect length. *
     F*             It shld be the name of the Data Structure anyway, *
     F*             so changed. Similarly for other Data structures.  *
     F*           - No fields from SDBANK or SDGELR are required, so  *
     F*             there is no need to access either of these files. *
     F*           - Added more comments to aid readability of program.*
     F*  E27934 - Recompiled over the changed version of ZACCRZ1      *
     F*  E27092 - Recompiled over changed SR/ZLCD                     *
     F*  S01117 - Multibranching                                      *
     F*  S01195 - New Holiday Processing                              *
     F*  S01220 - Recompiled for Stragetic Risk Management            *
     F*  S01269 - TRADE AUTHORISATION                                 *
     F*  S01271 - Recompiled for Pay/Receive in Input Cycle changes   *
     F*           to TRADSD and/or DPTMVD                             *
     F*  E23128 - Entered security name should not be blanked out     *
     F*           after a customer shortname enquiry.                 *
     F*  E23125 - Recompiled over changed display file SE0220DF       *
     F*  E21668 - Recompiled over changed SR/ZYLDZ2                   *
     F*  E21616 - Recompiled over changed SR/ZLCD.                    *
     F*  E21480 - Convert Price on Depot Movements to Percentage      *
     F*           Price for the calculation of Book Value.            *
     F*  E21428 - B/F Price should be in the same format as the others*
     F*           (i.e. Price/Discount/Yield).                        *
     F*  E21026 - Change to Data Structures so that all the Nominal   *
     F*           fields line up.                                     *
     F*  E21002 - Price shown should be Contract Price, not Trade     *
     F*           Price.                                              *
     F*  E20651 - DB Error Numbers used in more than one place.       *
     F*           New Error Numbers as follows:                       *
     F*           DB ERROR 05 -> 08.                                  *
     F*           DB ERROR 05 -> 09.                                  *
     F*  E20783 - Non-specific Enquiry into a non-Australian Portfolio*
     F*           Customer does not produce any details.              *
     F*  S01232 - Australian Yields modifications.                    *
     F*  E20327 - Correct editing of CCY d.p's for Book Value.        *
     F*  E20324 - Allow Rollup to display just the C-F Line.          *
     F*  E20380 - ZYLDZ1 and ZYLDZ2 changed. ZLCDZ1 now required.     *
     F*  E19986 - Database Error in PF/TABTG10 at 05 when the Short-  *
     F*           name is input as the Customer.                      *
     F*  E19918 - Booking/Average Price is being shown as a Percentage*
     F*           Price even though the Security was traded on a Yield*
     F*           Basis.                                              *
     F*  S01199 - ABS Help System.                                    *
     F*  E18658 - Print correct Countervalue for first record.        *
     F*           Also, C/F Average Price incorrect Decimal Places,   *
     F*           using wrong Currency.                               *
     F*  E16772 - Recompiled for the Dividend Payment Amount field    *
     F*           changes.                                            *
     F*  E17130 - ERROR MESSAGE CHANGED FOR LINKED ENQUIRY OPTIONS.   *
     F*  E16825 - CURRENCY WITH ZERO DECIMAL PLACES FOR NON-DEPOT     *
     F*           MOVE SHOWS INCORRECT AVERAGE PRICE.                 *
     F*  E16802 - BOOK AVERAGE PRICES AND NOMINAL APPEAR WITH WRONG   *
     F*           AMOUNTS, ALSO % SIGN INCORRECT.                     *
     F*  E15706 - IF ALL MOVEMENTS FILL ONE PAGE WHEN CUSTOMER, DATE, *
     F*           SECURITY ENTERED AND ONLY C/F TO SHOW ON NEXT PAGE, *
     F*           DO NOT SHOW THIS C/F.                               *
     F*  E15221 - ALLOW MOVEMENTS TO BE DISPLAYED FOR A MATURED       *
     F*           SECURITY.                                           *
     F*  E15707 - IF A FIELD IS CLEARED AND DETAILS REQUESTED ON      *
     F*           ANOTHER FIELD SYSTEM SAYS MORE THAN ONE OPTION      *
     F*           SELECTED.                                           *
     F*  E16063 - LINKED ENQUIRY REORGANIZATION.                      *
     F*           PASS A CUSTOMER TO LINKED ENQUIRIES.                *
     F*  S01179 - ****** AS400 CONVERSION ******                      *
     F*     The keyword RTGAID is no longer supported on the AS400    *
     F*     and command keys and indicators have been used to replace *
     F*     this in the display file. To disrupt the structure of the *
     F*     program as little as possible a new subroutine - ASCHGS - *
     F*     has been coded. This moves the values which would have    *
     F*     been passed to the program (via RTGAID) into the AID      *
     F*     field depending on which function key has been pressed.   *
     F*  E14576 - INCORRECT BROUGHT FORWARD POSITION FOR A TRADE      *
     F*           BACKVALUED TO A PRIOR MONTH,WHEN A SUBSEQUENT       *
     F*           MONTH IS SELECTED AS THE START POINT.               *
     F*  E15215 - ALSO OUTPUT RECORDS ON TDPBV/T WITH RECI = S.       *
     F*  E15334 - SUBFILE NOT BEING CLEARED ON RETURN FROM LINKED     *
     F*           ENQUIRY.                                            *
     F*  E15306 - ENQUIRY SHOWS END OF FILE, BUT MORE RECORDS TO      *
     F*           DISPLAY ON ROLLUP.                                  *
     F*  E15304 - PROGRAM ALLOWS ENTRY OF NON-PORTFOLIO CUSTOMERS.    *
     F*  E13854 - DEPOT MOVEMENTS THAT HAVE REACHED THEIR VALUE       *
     F*           DATE ARE INCORRECTLY OMITTED FROM THE ENQUIRY.      *
     F*  E13571 - AMENDED ERROR MESSAGE, AS NO HELP TEXT.             *
     F*  E13657 - ALTHOUGH WALK-INS AND WALK-OUTS ARE OUTPUT WITH     *
     F*           TRADES, OPTION 2 CAUSES AN ERROR BECAUSE IT IS      *
     F*           A TRADES ENQUIRY.THIS OPTION SHOULD BE VALID FOR    *
     F*           TRADES ONLY.                                        *
     F*  E14057 - FILE PRICS CHANGED TO PRICR.                        *
     F*  E13975 - IF SECURITY WAS NOT ENTERED AND F/5 WAS TAKEN       *
     F*           THE PORFOLIO MOVEMENTS WERE NOT DISPLAYED WITHIN    *
     F*           SECURITIES.                                         *
     F*  E13541 - '+' SHOWING TO DENOTE FURTHER PAGES IF 1ST SCREEN   *
     F*           FULL AND NO MORE RECORDS TO SELECT.                 *
     F*  E13853 - PROGRAM WAS LOOPING IF THERE IS A TRADE FOR THE     *
     F*           THE LAST DAY OF THE MONTH PRIOR TO THE MONTH        *
     F*           REQUESTED.                                          *
     F*  E13484 - SETOF/ON INDICATORS CORRECTLY.                      *
     F*  S01158 - POST INCORPORATION DEVELOPMENT FIX.                 *
     F*                                                               *
     F*****************************************************************
      *
     FSE0220DFCF  E                    WORKSTN      KINFDS SCRDS
     F                                        SFLRECKSFILE SE0220S0
     FCDEPP   IF  E           K        DISK
     FCPOSH   IF  E           K        DISK
     F            CPOSNDF                           KRENAMESPOSHDF
     FCPOSN   IF  E           K        DISK
     FSECTY   IF  E           K        DISK
     FINVTP   IF  E           K        DISK                               S01232
     F*CLINT***IF  E           K        DISK                              S01117
     F**********  CLINTCAF                          KIGNORE               S01117
     F**********  CLINTCCF                          KIGNORE               S01117
     F**********  CLINTC1F                          KIGNORE               S01117
     F************CLINTSEF                          KIGNORE               E15304
     F*SNAME***IF  E           K        DISK                              S01117
     F**********  CLINTCBF                          KRENAMESNAMECBF       S01117
     F****PRICS   IF  E           K        DISK                           E14057
     FPRICR   IF  E           K        DISK                               E14057
     FTDPBV   IF  E           K        DISK
     FTDPBT   IF  E           K        DISK
     F            HSTTRDF                           KRENAMEHSTTRDAF
     F            TRADSDF                           KRENAMETRADSDAF
     F            DPTMVDF                           KRENAMEDPTMVDAF
     F            DPTMVTF                           KRENAMEDPTMVTAF
     F            SEDVPRD0                          KRENAMESEDVPRAF       CSE041
     FTDPOV   IF  E           K        DISK                               E14576
     F            TRADSDF                           KRENAMETRADSDVF       E14576
     F            DPTMVDF                           KRENAMEDPTMVDVF       E14576
     F            DPTMVTF                           KRENAMEDPTMVTVF       E14576
     F            SEDVPRD0                          KRENAMESEDVPRVF       CSE041
     FTDPOT   IF  E           K        DISK                               E14576
     F            TRADSDF                           KRENAMETRADSDTF       E14576
     F            DPTMVDF                           KRENAMEDPTMVDTF       E14576
     F            DPTMVTF                           KRENAMEDPTMVTTF       E14576
     F            SEDVPRD0                          KRENAMESEDVPRTF       CSE041
     F*TABSE***IF  E           K        DISK                              S01117
     F**********  TABLETAF                          KIGNORE               S01117
     F*           TABTB10F                          KIGNORE
     F*           TABTB11F                          KIGNORE
     F*           TABTB36F                          KIGNORE
     F**********  TABTB40F                          KIGNORE               S01117
     F**********  TABTE10F                          KIGNORE               S01117
     F**********  TABTE20F                          KIGNORE               S01117
     F*           TABTG10F                          KIGNORE
     F**********  TABTG20F                          KIGNORE               S01117
     F**********  TABLETHF                          KIGNORE               S01117
     F**** HOLS **TABLETJF                          KIGNORE               S01232
     F**********  TABLETKF                          KIGNORE               S01117
     F**********  TABLETLF                          KIGNORE               S01117
     F**********  TABLETNF                          KIGNORE               S01117
     F**********  TABLETPF                          KIGNORE               S01117
     F*           TABLETRF                          KIGNORE
     F**********  TABLETXF                          KIGNORE               S01117
     F**********  TABLET2F                          KIGNORE               S01117
     F**********  TABLET3F                          KIGNORE               S01117
     F**********  TABLET5F                          KIGNORE               S01117
     FSECOND  IF  E           K        DISK
     F*SEDEV**IF**E           K        DISK                               E14576
     FSEDEV   IF  E           K        DISK                               E19918
     FSECEO   IF  E           K        DISK                               S01232
     F            SEDEVDF                           KRENAMESEDEVDO        S01232
     F            SNDEVDF                           KRENAMESNDEVDO        S01232
     FSEERALL2IF  E           K        DISK                           UC  S01496
     FSEERALL5IF  E           K        DISK                           UC  S01496
     FSDCURRL0IF  E           K        DISK                               S01117
     F/COPY WNCPYSRC,SE0220F001
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*   01        RETURN TO PREVIOUS PROGRAM                        *
     F*                OR ERROR ON SECTY READ                         *
     F*   02        CLEAR SUBFILE                                     *
     F*   03        NO DETAILS INDICATOR                              *
     F*   04        DISPLAY MESSAGE - NO DETAILS TO DISPLAY           *
     F*   05        DETAILS COMPLETE FOR THIS CUSTOMER                *
     F*   06        ROLLUP PAST END OF FILE - DISPLAY MESSAGE         *
     F*   07        ON IN MULTI-BRANCH ENVIRONMENT                    *
     F*   08        CONTROL DISPLAY OF SELECT FIELD IN SFL            *
     F*   09        ON IF TRADE DATE VALUATIONS, OFF VOR VALUE        *
     F*                                                               *
     F*   10        VLDCMDKY INDICATOR FOR DISPLAY FILE               *
     F*                                                               *
     F*   20        ROLLUP                                            *   S01179
     F*   21        HELP                                              *   S01179
     F*   25        SECURITY NOT FOUND, OR NOT LIVE                   *   090501
     F*                                                               *   S01179
     F*   29        CUST SHORTNAME ENTERED                            *
     F*   30        CUST NO. ENTERED                                  *
     F*   33        FIRST TIME IND OER CUSTOMER                       *   E16825
     F*   40        END OF FILE ON SUBFILE READ                       *
     F*   41        REVERSE IMAGE CUST NO./SHORTNAME FIELD            *
     F*   42        DISPLAY ERROR MESSAGE                             *
     F*   43        REVERSE IMAGE SECURITY FIELD                      *
     F*   44        REVERSE IMAGE MONTH/YEAR FIELD                    *
     F*   45        REVERSE IMAGE BRANCH FIELD                        *
     F*   50        ON IF DETAIL LINE OUTPUT FOR TRADE                *
     F*   51        MORE DETAILS TO OUTPUT FOR TRADE                  *
     F*   52        ON IF NEW SECURITY                                *
     F*   53        SECURITY IS TRADED ON AN AUSTRALIAN YIELD BASIS   *   S01232
     F*   55        NOMINAL CURRENCY DEC. PLACES 0                    *
     F*   56        NOMINAL CURRENCY DEC. PLACES 1                    *
     F*   57        NOMINAL CURRENCY DEC. PLACES 2                    *
     F*   58        NOMINAL CURRENCY DEC. PLACES 3                    *
     F****61-64*****REC*IDS*FOR*TDPBV/TDPBT****************************   E32164
     F*                                                               *   E32164
     F* Record Identifiers for TDPBV/TDPBT:                           *   E32164
     F*   60        SEDVPRD0 Format read                              *   CSE041
     F*   61        HSTTRDF Format read.                              *   E32164
     F*   62        TRADSDF Format read.                              *   E32164
     F*   63        DPTMVDF Format read.                              *   E32164
     F*   64        DPTMVTF Format read.                              *   E32164
     F*                                                               *   E32164
     F* Record Identifiers for TDPOV/TDPOT:                           *   E32164
     F*   72        TRADSDF Format read.                              *   E32164
     F*   73        DPTMVDF Format read.                              *   E32164
     F*   74        DPTMVTF Format read.                              *   E32164
     F*                                                               *   E32164
     F*   81        END OF FILE ON TRDBV/TRDBT                        *
     F*   82        NEXT PAGE REQUIRED (CONTROL SFLEND)               *
     F*   87        CURRENT TRANSACTION GENERATED BY EARLY REDEMP.    *   S01496
     F*   88        SUBFILE READ FAIL                                 *
     F*   89        END OF FILE ON TRDBV/TRDBT/END OF SUBFILE PAGE    *
     F*                                                               *   E32164
     F****90********WORK*INDICATOR*-*STD*SUBROUTINES*******************   E32164
     F* 90-99       Used in Standard Subroutines                      *   E32164
     F*   98        DATE FORMAT INDICATOR FOR ZSYSTM                  *
     F****99********ERROR*ON*ICDR*1*READ*-*ZSYSTM**********************   S01117
     F*                                                               *   E32164
     F*   U7        WITH U8 FOR DATABASE ERROR                        *
     F*   U8        WITH U7 FOR DATABASE ERROR                        *
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*  ASCHGS  - MOVES VALUES INTO AID - AS400 CONVERSION           *
     F*  COMMD   - PROCESS COMMAND KEYS, HELD AND ROLLUP/DOWN         *
     F*  OPTION  - CHECK VALIDITY OF ENTERED OPTION COMBINATIONS      *
     F*  CUSSEC  - PROCESS ENTERED CUSTOMER NO./SHORTNAME + SECURITY  *
     F*  SETUP   - PREPARE OUTPUT SCREEN FOR DISPLAY                  *
     F*  CLEAR   - CLEAR FIELDS AND INDICATORS ON DISPLAY SCREEN      *
     F*  ROLLUP  - HANDLE ROLLUP WHEN END OF SUBFILE REACHED          *
     F*  DISP    - ACCUMULATE SECURITY DETAILS FOR DISPLAY            *
     F*  PROCES  - PROCESS A SECURITY                                 *
     F*  SUBFIL  - WRITE ACCUMULATED DETAILS TO SUBFILE               *
     F*  CSPRC   - CALCULATE BOOK PRICE                               *
     F*  OLCAP   - CALCULATE AVERAGE PRICE                            *
     F*  LINK    - PROCESS REQUEST FOR LOWER LEVEL ENQUIRY            *
     F*  RETSR   - END OF PROGRAM PROCESSING                          *
     F*  FIRST   - FIRST CYCLE PROCESSOMG                             *
     F*  *PSSR   - SR. TO HANDLE ABNORMAL ERROR CONDITIONS            *   S01117
     F*                                                               *
     F***XDATE3**-*CALCULATE*WORKING*DAYS*BACKWARD******************S01232S01195
     F*  ZBKDT   - CALCULATE WORKING DAYS BACKWARD                    *   S01195
     F*  ZACCH   - ACCESS HOLIDAY STANDARD SUBROUTINE                 *   S01195
     F*  ZACCR   - CALCULATE INTEREST ACCRUED BETWEEN 2 DATES         *   S01232
     F*  ZACCZ   - CALCULATE INTEREST ACCRUED BETWEEN SPECIFIED DATES *   S01232
     F*  ZCALCD  - CALCULATE LONG TERM CD PRICE FROM INPUT YIELD      *   E39495
     F*  ZCNSD   - CALCULATE CONSIDERATION                            *   E21002
     F*  ZCSCTP  - CALCULATE CLIENT'S CONTRACT PRICE                  *
     F*  ZDATE1,2- FORMAT DATES                                       *
     F*  ZDAYS   - CALCULATE NO OF DAYS BETWEEN 2 DATES FOR INTEREST  *   E19918
     F*            CALCULATIONS                                       *   E19918
     F*  ZDYYR   - CALCULATE NO OF DAYS IN INTEREST YEAR              *   E19918
     F*  ZEVCD   - CALCULATE EVENT CONTROL DATE                       *   E14576
     F***ZICD2***-*ACCESS*ICDR2*-*TABTB11******************************   S01117
     F***ZICDSE**-*ACCESS*ICDSE*-*TABTB36******************************   S01117
     F*  ZLCD    - DETERMINE PREVIOUS COUPON DATE                     *   E20380
     F*  ZNCD    - GET NEXT COUPON DATE                               *   E19918
     F*  ZPRCI   - CONVERTS PRICE INTO PERCENTAGE PRICE               *   E21002
     F*  ZPRCO   - OUTPUT YIELD AS PERCENTAGE PRICE                   *   E19918
     F*  ZRATE   - DETERMINE EFFECTIVE RATE                           *   S01232
     F*  ZSDESC  - FORMAT SECURITY DESCRIPTION                        *
     F*  ZSEDIT  - EDIT NUMERIC FIELDS FOR OUTPUT                     *
     F***ZSYSTM**-*ACCESS*ICDR1*-*TABTB10******************************   S01117
     F*  ZYCE    - SET UP CUM/EX PARAMETER FOR AUSTRALIAN YIELDS      *   S01232
     F*  ZYLDI   - CONTAINS PARAMETERS FOR ZYIELD SUBROUTINE          *   E21002
     F*  ZYLDO   - OUTPUT PERCENTAGE PRICE AS YIELD                   *   E19918
     F*  P001    - CHANGE TRANSACTIONS TYPES                          *   S01496
     F*                                                               *
     F*****************************************************************
      /EJECT
     E/COPY ZSRSRC,ZDATE2Z1
     E***/COPY*ZSRSRC,ZDATE6Z1***                                   S01232S01195
     E/COPY ZSRSRC,ZHOLE                                                  S01195
     E***/COPY*ZSRSRC,ZNCDZ1***                                           E14576
     E                    POWER8  1   8  8 4
     E***********         MSG     1  12 79               Error Messages   E13657
     E***********         MSG     1  13 79        Error Messages   E13657 E15304
     E**********          MSG     1  14 79         Error Messages   E15304S01117
     E***********         MSG     1  16 79         Error Messages   S01117E38086
     E*********           MSG     1  17 79               Error Messages   E38086 CSE041
     E*********           MSG     1  18 79               Error Messages   CSE041 CSE039
     E                    MSG     1  19 79               Error Messages   CSE039
     E***********         SRECIN    434  1                          E14576E18658
     E******              SRECIN    500  1                         E18658 S01271
     E***********         SRECIN    503  1                         S01271 E32164
     E                    SRECIN    510  1                                E32164
     E********************ARR        20  3         Error Messages   E16802102644
     E                    ARR        50  3               Error Messages   102644
     E/COPY ZSRSRC,ZPOWERZ1
     E***/COPY*ZSRSRC,ZDAYSZ1***                                          E14576
     E/COPY ZSRSRC,ZDAYSZ1                                                E19918
     E/COPY ZSRSRC,ZSDESCZ1
     E/COPY ZSRSRC,ZSEDITZ1
     E/COPY ZSRSRC,ZNCDZ1                                          E14576 E19918
     E                    CPY@    1   1 80
     E                    ZAD        21  1
      /EJECT
     IHSTTRDF     61
      *                                                                   E32164
     ITRADSDF     62
      *                                                                   E32164
     IDPTMVDF     63
      *                                                                   E32164
      ***  Rename fields used from DPTMVD to their Trade (Value Date)     E32164
      ***  equivalents.                                                   E32164
      *                                                                   E32164
     I**********    DPBC                            TDBR                  S01117
     I              DPBA                            TDBA                  S01117
     I              DPBN                            TCNR
     I              DPSS                            TDSS
     I              DPRN                            TDRF
     I              DPNA                            NOML
     I**********    DPMD                            TDVD                                     BUG2507
     I              DPMV                            TDTP                  E32164
     I              MKTP                            PRIC                  E32164
     I              DPVD                            TDVD                                     BUG2507
     I              DMTD                            TDDT                                     BUG2507
      *                                                                   E32164
     IDPTMVTF     64
     I**********    DPBC                            TDBR                  S01117
     I              DPBA                            TDBA                  S01117
     I              DPBN                            TCNR
     I              DPSS                            TDSS
     I              DPRN                            TDRF
     I              DPNA                            NOML
     I**********    DPDO                            TDVD                                     BUG2507
     I              DPMV                            TDTP                  E32164
     I              MKTP                            PRIC                  E32164
     I              DPVD                            TDVD                                     BUG2507
     I              DMTD                            TDDT                                     BUG2507
      *                                                                   E32164
     ISEDVPRD0    60                                                      CSE041
     I              DVBRCA                          TDBA                  CSE041
     I              DVCNUM                          TCNR                  CSE041
     I              DVSESN                          TDSS                  CSE041
     I              DVREF                           TDRF                  CSE041
     I              DVNOML                          NOML                  CSE041
     I              DVVDAT                          TDVD                  CSE041
     I              DVTYPE                          TDTP                  CSE041
     I              DVPDY                           PRIC                  CSE041
     I              DVSETC                          SETC                  CSE041
      *                                                                   CSE041
     IHSTTRDAF    61
      *                                                                   E32164
     ITRADSDAF    62
      *                                                                   E32164
     IDPTMVDAF    63
      *                                                                   E32164
      ***  Rename fields used from DPTMVD to their Trade (Trade Date)     E32164
      ***  equivalents.                                                   E32164
      *                                                                   E32164
     I**********    DPBC                            TDBR                  S01117
     I              DPBA                            TDBA                  S01117
     I              DPBN                            TCNR
     I              DPSS                            TDSS
     I              DPRN                            TDRF
     I              DPNA                            NOML
     I**********    DPMD                            TDDT                                     BUG2507
     I              DPMV                            TDTP                  E32164
     I              MKTP                            PRIC                  E32164
     I              DPVD                            TDVD                                     BUG2507
     I              DMTD                            TDDT                                     BUG2507
      *                                                                   E32164
     IDPTMVTAF    64
     I**********    DPBC                            TDBR                  S01117
     I              DPBA                            TDBA                  S01117
     I              DPBN                            TCNR
     I              DPSS                            TDSS
     I              DPRN                            TDRF
     I              DPNA                            NOML
     I**********    DPDO                            TDDT                                     BUG2507
     I              DPMV                            TDTP                  E32164
     I              MKTP                            PRIC                  E32164
     I              DPVD                            TDVD                                     BUG2507
     I              DMTD                            TDDT                                     BUG2507
      *                                                                   E32164
     ISEDVPRAF    60                                                      CSE041
     I              DVBRCA                          TDBA                  CSE041
     I              DVCNUM                          TCNR                  CSE041
     I              DVSESN                          TDSS                  CSE041
     I              DVREF                           TDRF                  CSE041
     I              DVNOML                          NOML                  CSE041
     I              DVTDAT                          TDDT                  CSE041
     I              DVTYPE                          TDTP                  CSE041
     I              DVPDY                           PRIC                  CSE041
     I              DVSETC                          SETC                  CSE041
      *                                                                   CSE041
     ITRADSDVF    72                                                      E14576
      *                                                                   E32164
     IDPTMVDVF    73                                                      E14576
      *                                                                   E32164
      ***  Rename fields used from DPTMVD to their Trade (Value Date)     E32164
      ***  equivalents.                                                   E32164
      *                                                                   E32164
     I**********    DPBC                            TDBR           E14576 S01117
     I              DPBA                            TDBA                  S01117
     I              DPBN                            TCNR                  E14576
     I              DPSS                            TDSS                  E14576
     I              DPRN                            TDRF                  E14576
     I              DPNA                            NOML                  E14576
     I**********    DPMD                            TDVD                              E14576 BUG2507
     I              DPMV                            TDTP                  E32164
     I              MKTP                            PRIC                  E32164
     I              DPVD                            TDVD                                     BUG2507
     I              DMTD                            TDDT                                     BUG2507
      *                                                                   E32164
     IDPTMVTVF    74                                                      E14576
     I**********    DPBC                            TDBR            E14576S01117
     I              DPBA                            TDBA                  S01117
     I              DPBN                            TCNR                  E14576
     I              DPSS                            TDSS                  E14576
     I              DPRN                            TDRF                  E14576
     I              DPNA                            NOML                  E14576
     I***********   DPDO                            TDVD                              E14576 BUG2507
     I              DPMV                            TDTP                  E32164
     I              MKTP                            PRIC                  E32164
     I              DPVD                            TDVD                                     BUG2507
     I              DMTD                            TDDT                                     BUG2507
      *                                                                   CSE041
     ISEDVPRVF    71                                                      CSE041
     I              DVBRCA                          TDBA                  CSE041
     I              DVCNUM                          TCNR                  CSE041
     I              DVSESN                          TDSS                  CSE041
     I              DVREF                           TDRF                  CSE041
     I              DVNOML                          NOML                  CSE041
     I              DVVDAT                          TDVD                  CSE041
     I              DVTYPE                          TDTP                  CSE041
     I              DVPDY                           PRIC                  CSE041
     I              DVSETC                          SETC                  CSE041
      *                                                                   E32164
     ITRADSDTF    72                                                      E14576
      *                                                                   E32164
     IDPTMVDTF    73                                                      E14576
      *                                                                   E32164
      ***  Rename fields used from DPTMVD to their Trade (Trade Date)     E32164
      ***  equivalents.                                                   E32164
      *                                                                   E32164
     I**********    DPBC                            TDBR            E14576S01117
     I              DPBA                            TDBA                  S01117
     I              DPBN                            TCNR                  E14576
     I              DPSS                            TDSS                  E14576
     I              DPRN                            TDRF                  E14576
     I              DPNA                            NOML                  E14576
     I**********    DPMD                            TDDT                              E14576 BUG2507
     I              DPMV                            TDTP                  E32164
     I              MKTP                            PRIC                  E32164
     I              DPVD                            TDVD                                     BUG2507
     I              DMTD                            TDDT                                     BUG2507
      *                                                                   E32164
     IDPTMVTTF    74                                                      E14576
     I**********    DPBC                            TDBR            E14576S01117
     I              DPBA                            TDBA                  S01117
     I              DPBN                            TCNR                  E14576
     I              DPSS                            TDSS                  E14576
     I              DPRN                            TDRF                  E14576
     I              DPNA                            NOML                  E14576
     I***********   DPDO                            TDDT                              E14576 BUG2507
     I              DPMV                            TDTP                  E32164
     I              MKTP                            PRIC                  E32164
     I              DPVD                            TDVD                                     BUG2507
     I              DMTD                            TDDT                                     BUG2507
      *                                                                   E32164
     ISEDVPRTF    71                                                      CSE041
     I              DVBRCA                          TDBA                  CSE041
     I              DVCNUM                          TCNR                  CSE041
     I              DVSESN                          TDSS                  CSE041
     I              DVREF                           TDRF                  CSE041
     I              DVNOML                          NOML                  CSE041
     I              DVTDAT                          TDDT                  CSE041
     I              DVTYPE                          TDTP                  CSE041
     I              DVPDY                           PRIC                  CSE041
     I              DVSETC                          SETC                  CSE041
      *                                                                   CSE041
     I*SEDEVDF******                                                      E14576
     I**************NMCY                            NMCYXX                E14576
     ISEDEVDF                                                             E19918
     I              NMCY                            NMCYXX                E19918
     I*                                                                   S01117
     I***/COPY*ZSRSRC,ZNCDZ2***                                           E14576
     I/COPY ZSRSRC,ZNCDZ2                                                 E19918
     I/COPY ZSRSRC,ZSDESCZ2
      *                                                                   E32164
     IRECIN     E DSTRADSD                                                E14576
      *                                                                   E32164
     I            DS                                                      E14576
     I***********                             1 434 SRECIN                E18658
     I***********                             1 500 SRECIN         E18658 S01271
     I***********                             1 503 SRECIN         S01271 E32164
     I                                        1 510 SRECIN                E32164
     I*
     I*LDA********UDS                            256                      S01117
     ILDA         DS                            256                       S01117
     I*
     I***  Local data area.
     I*
     I**********                            134 138 DBFILE                S01117
     I**********                            139 167 DBKEY                 S01117
     I**********                            168 175 DBPGM                 S01117
     I**********                            176 1770DBASE                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     I*
     I*********** DS                                                      E32164
      *                                                                   E32164
      ***  SELCRI field was wrong length. As it is the whole Data         E32164
      ***  Structure, it should be the name of the Data Structure.        E32164
      ***  The same applies to the other Data Structures below.           E32164
      *                                                                   E32164
     ISELCRI      DS                                                      E32164
      *
      ***  Data Structure over selection criteria.                        E32164
     I***********                             1  26 SELCRI                E32164
     I                                        1  10 CUSTMR
     I                                       11  14 MNTHYR
     I                                       15  24 SECSNM
     I                                       25  27 BRANCH
     I*
     I*********** DS                                                      E32164
     IMNWORK      DS                                                      E32164
     I*
     I*   DATA STRUCTURE OVER INPUT MONTH/YEAR
     I***********                             1   4 MNWORK                E32164
     I                                        1   2 MNTH
     I                                        1   20MNTHP
     I                                        3   4 YR
     I                                        3   40YRP
     I*
     I*********** DS                                                      E32164
     IDAYWK       DS                                                      E32164
     I*
     I*   DATA STRUCTURE FOR DATE MANIPULATIONS
     I***********                             1   6 DAYWK                 E32164
     I                                        1   20DD
     I                                        3   40MM
     I                                        5   60YY
     I*
     I*********** DS                                                      E32164
     IZZMNYR      DS                                                      E32164
     I*
     I*   DATA STRUCTURE OVER CALCULATED MONTH/YEAR
     I***********                             1   4 ZZMNYR                E32164
     I                                        1   20ZZMNTH
     I                                        3   40ZZYR
     I*
     I*********** DS                                                      E32164
     IBFLIN       DS                             74                       E32164
     I*
     I*   DATA STRUCTURES FOR SETTING UP SFL LINES
      *                                                                   E32164
      ***  Brought Forward Line.                                          E32164
     I***********                             1  74 BFLIN                 E32164
     I                                        1   7 BFDATE
     I                                        9  15 BFREV                 E14576
     I                                       17  19 BF
     I***********                            20  33 SBFNOM                E21026
     I                                       21  34 SBFNOM                E21026
     I                                       35  48 SBFPR
     I                                       49  49 BFP
     I                                       51  51 BFBVI
     I                                       53  55 BFCUR
     I                                       57  73 BFBVAL
      *                                                                   E32164
     I*********** DS                                                      E32164
     IDETLN       DS                             74                       E32164
      *                                                                   E32164
      ***  Detail Line.                                                   E32164
     I***********                             1  74 DETLN                 E32164
     I                                        1   7 STDDT
     I                                        9  15 STDVD
     I                                       17  19 STYPE
     I                                       20  34 SNOML
     I                                       35  48 SDTPR
     I                                       49  49 DTP
     I                                       53  55 SSETC
     I                                       57  73 STCTR
      *                                                                   E32164
     I*********** DS                                                      E32164
     ICFLIN       DS                             74                       E32164
      *                                                                   E32164
      ***  Carried Forward Line.                                          E32164
     I***********                             1  74 CFLIN                 E32164
     I                                        1   7 SRUNA
     I                                       17  19 CF
     I***********                            20  33 SCFNOM                E21026
     I                                       21  34 SCFNOM                E21026
     I                                       35  48 SCFPR
     I                                       49  49 CFP
     I                                       51  51 CFBVI
     I                                       53  55 SNMCY
     I                                       57  73 CFBVAL
     I            DS
     I*
     I**  DS to drop last 3 dps of prices
     I*
     I                                        1  21 ZOUT21
     I                                        1  18 Z21L3
     I            DS                                                      E13657
     I*
     I**  DS TO TEST DEPOT MOVEMENT OR TRADE                              E13657
     I**  AND SECURITY                                                    E38086
     I*
     I                                        1  74 MOVTP                 E13657
     I                                       17  19 TESTP                 E13657
     I                                       42  74 IFSEC                 E38086
     I*
     IJNSTAT     UDS                            200
     I*
     I*   JNSTAT DATA AREA
     I                                    P 103 1050PRUN
     I*
     I**  LINK ENQUIRY DATA AREA
     ISESDS     E DS
     IPSDS       SDS
     I                                        1  10 PROGRM
     I                                      244 246 WSID
     ISCRDS       DS
     I                                      287 288 AID
     I**     DATA STRUCTURE FOR ZSEDIT SUBROUTINE
     I/COPY ZSRSRC,ZSEDITZ2
     I            DS
     I                                        1  21 WORKAD
     I                                        1  21 ZAD
     I**                                                                  S01117
     IRUNDT       DS                                                      S01117
     I** DATA AREA RUNDAT                                                 S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
     I**                                                                  S01117
     IZMUSER      DS                             17                       S01117
     I** DATA AREA OF MENU USER                                           S01117
     I                                       11  13 USRBCH                S01117
     I**                                                                  S01117
     I***SDBANK****E*DSSDBANKPD***                                 S01117 E32164
     I***Bank*Details********************************************* S01117 E32164
     I**                                                                  S01117
     ISDBRCH    E DSSDBRCHPD                                              S01117
     I** Branch Details                                                   S01117
     I**                                                                  S01117
     ISDCURR    E DSSDCURRPD                                              S01117
     I** Currency Details                                                 S01117
     I**                                                                  S01117
     ISDCUST    E DSSDCUSTPD                                              S01117
     I              QQDFAC                          #DFAC1                                    CGL029
     I** Customer Details                                                 S01117
     I**                                                                  S01117
     I***SDGELR****E*DSSDGELRPD***                                 S01117 E32164
     I***General*Ledger*Details*********************************** S01117 E32164
     I**                                                                  S01117
     ISDSECS    E DSSDSECSPD                                              S01117
     I** Security Customer Details                                        S01117
     I**                                                                  S01117
     ISDSTRD    E DSSDSTRDPD                                              S01117
     I** Security Trading Details                                         S01117
     I**                                                                  S01117
     IDSFDY     E DSDSFDY                                                 S01117
     I** FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE               S01117
     I**                                                                  S01117
     IDSSDY     E DSDSSDY                                                 S01117
     I** SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE               S01117
     I**                                                                  S01117
     IDSLDY     E DSDSLDY                                                 CSD007
      ** Third DS for access programs, very long data structure           CSD007
      *                                                                   CSD007
     ICPYR@#      DS
     I*
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
      *                                                                   CSE041
     I              'SEDPMVSIN'           C         DPPGM                 CSE041
      ** Program to call for Depot Movements                              CSE041
      *                                                                   CSE039
     I              'SEMVTSSIN'           C         MVPGM                 CSE039
      ** Parameter for SEC025 to call Movement Status program             CSE039
     I**
     I***/COPY*ZSRSRC,ZYLDZ1                                              E14576
     I/COPY ZSRSRC,ZYLDZ1                                                 E19918
     I/COPY ZSRSRC,ZHOLI                                                  S01195
     I/COPY WNCPYSRC,SE0220I001
     C/EJECT
      *================================================================
      *  P R O G R A M   S T A R T                                    *
      *================================================================
      *
     C           *NAMVAR   DEFN           SESDS
     C           *NAMVAR   DEFN           LDA
     C           *NAMVAR   DEFN           JNSTAT
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C           *NAMVAR   DEFN           ZMUSER                          S01117
     C********** *LIKE     DEFN CDP       NMCDP                           S01117
     C********** *LIKE     DEFN CDP       PFCDP                      16825S01117
     C********** *LIKE     DEFN CDP       XNMCDP                     16825S01117
     C           *LIKE     DEFN A6NBDP    NMCDP                           S01117
     C           *LIKE     DEFN A6NBDP    PFCDP                      16825S01117
     C           *LIKE     DEFN A6NBDP    XNMCDP                     16825S01117
     C           *LIKE     DEFN TDBK      SVTDBK
     C           *LIKE     DEFN DELT      SVDELT
     C           *LIKE     DEFN CDNT      ZZPUR
     C           *LIKE     DEFN CDNT      ZZSALS                          E14576
     C           *LIKE     DEFN CDNT      ZZPCHS                          E14576
     C           *LIKE     DEFN CDNT      ZZWIS                           E14576
     C           *LIKE     DEFN CDNT      ZZWOS                           E14576
     C           *LIKE     DEFN CDNT      ZZRVS                           CSE041
     C           *LIKE     DEFN CDNT      ZZDPS                           CSE041
     C           *LIKE     DEFN CDNT      ZZTOT                           E14576
     C           *LIKE     DEFN CDNT      ZZSAL
     C           *LIKE     DEFN CDNT      ZZAPS
     C           *LIKE     DEFN CDNT      ZZAPP
     C           *LIKE     DEFN CDNT      ZZAPC
     C           *LIKE     DEFN PPRC      ZZAPW
     C           *LIKE     DEFN CDNT      ZNOMP
     C           *LIKE     DEFN CDNT      ZNNOMP
     C           *LIKE     DEFN CDNT      ZZNOML
     C           *LIKE     DEFN CDNT      ZZNOMB                          E14576
     C           *LIKE     DEFN CDNT      ZZNOMU
     C           *LIKE     DEFN CDNT      WNOML
     C           *LIKE     DEFN DDTE      THEDAT
     C           *LIKE     DEFN DDTE      ORDAT                           E14576
     C************LIKE     DEFN PRIC      ZPRICE                   E14576 E19918
     C           *LIKE     DEFN TDBK      BKBLK
      *
      ***  Key List for LF/CPOSH.                                         E32164
      *                                                                   E32164
     C           KEYH      KLIST
     C                     KFLD           SAVBR
     C                     KFLD           TDSS
     C                     KFLD           PCUST
     C                     KFLD           THEDAT
      *
      ***  Key List for LF/PRICR using TDSS.                              E32164
      *                                                                   E32164
     C           KEYP      KLIST
     C                     KFLD           TDSS
     C                     KFLD           SAVBR
     C                     KFLD           MARKET
     C                     KFLD           BKBLK
     C                     KFLD           PCUST
     C                     KFLD           PPRT
      *
      ***  Key List for LF/PRICR using SAVSEC.                            E32164
      *                                                                   E32164
     C           SKEYP     KLIST
     C                     KFLD           SAVSEC
     C                     KFLD           SAVBR
     C                     KFLD           MARKET
     C                     KFLD           BKBLK
     C                     KFLD           PCUST
     C                     KFLD           PPRT
      *
      ***  Key List for LF/CDEPP.                                         E32164
      *                                                                   E32164
     C           SKEYH     KLIST
     C                     KFLD           SAVBR
     C                     KFLD           PCUST
     C                     KFLD           SAVSEC
      *
      ***  Key List for LF/PRICR using SAVSEC and Previous Run Date.      E32164
      *                                                                   E32164
     C           SKEYPP    KLIST
     C                     KFLD           SAVSEC
     C                     KFLD           SAVBR
     C                     KFLD           MARKET
     C                     KFLD           BKBLK
     C                     KFLD           PCUST
     C                     KFLD           PPRT
     C                     KFLD           PRUN
      *
      ***  Key List for LF/PRICR using SAVSEC and Run Date.               E32164
      *                                                                   E32164
     C           SKEYPD    KLIST
     C                     KFLD           SAVSEC
     C                     KFLD           SAVBR
     C                     KFLD           MARKET
     C                     KFLD           BKBLK
     C                     KFLD           PCUST
     C                     KFLD           PPRT
     C                     KFLD           RUND
      *
      ***  Key List for LF/CPOSN.                                         E32164
      *                                                                   E32164
     C           SKEYCP    KLIST
     C                     KFLD           SAVBR
     C                     KFLD           SAVSEC
     C                     KFLD           PCUST
      *
      ***  Key List for LF/TDPBT, LF/TDPBV with TDSS/THEDAT.              E32164
      *                                                                   E32164
     C           KEYT      KLIST
     C                     KFLD           SAVBR
     C                     KFLD           PCUST
     C                     KFLD           TDSS
     C                     KFLD           THEDAT
      *
      ***  Key List for LF/TDPBT, LF/TDPBV - Partial.                     E32164
      *                                                                   E32164
     C           TDPK1     KLIST                                          E13541
     C                     KFLD           SAVBR                           E13541
     C                     KFLD           PCUST                           E13541
      *
      ***  Key List for LF/TDPBT, LF/TDPBV with CHKSEC.                   E32164
      *                                                                   E32164
     C           TDPK2     KLIST                                          E13541
     C                     KFLD           SAVBR                           E13541
     C                     KFLD           PCUST                           E13541
     C                     KFLD           CHKSEC                          E13541
      *
      ***  Key List for LF/TDPOT, LF/TDPOV.                               E32164
      *                                                                   E32164
     C           KPOSEC    KLIST                                          E14576
     C                     KFLD           SAVBR                           E14576
     C                     KFLD           PCUST                           E14576
     C                     KFLD           TDSS                            E14576
     C                     KFLD           ORDAT                           E14576
     C*                                                                   S01232
     C* Key to access investment types                                    S01232
     C*                                                                   S01232
     C           INVKA     KLIST                                          S01232
     C                     KFLD           NMCY                            S01232
     C                     KFLD           SITP                            S01232
     C**
     C**  DO FIRST CYCLE PROCESSING
     C**
     C                     EXSR FIRST
     C**
     C**  MAIN PROCESSING    -    Do until end of job requested
     C**
     C           *IN01     DOWEQ'0'
     C**
     C**    Display the screen
     C**
     C                     WRITESE0220F0
     C                     EXFMTSE0220C0
     C**
     C** Call S/R to move values into AID                                 S01179
     C*                                                                   S01179
     C                     EXSR ASCHGS                                    S01179
     C*                                                                   S01179
     C**    Clear the error messages unless HELP pressed
     C**
     C           AID       IFNE 'HP'
     C                     MOVE *BLANKS   ERMSG  79
     C                     SETOF                     414243
     C***********          SETOF                     4445                 E16825
     C                     SETOF                     444533               E16825
     C                     END
     C**
     C**    Check Command Keys - including HELP
     C**
     C                     EXSR COMMD
     C**
     C**    If Enter has been pressed check validity of options
     C**
     C           AID       IFEQ 'RA'
     C**
     C**    Check Validity of Option Combinations
     C**                   Either Cust OR Select must be entered
     C**                   Only one select must be entered
     C**
     C                     EXSR OPTION
     C**
     C           *IN42     IFEQ '0'
     C*
     C**If*no*Branch*entered,*use*default*from*TABICD*file*************** S01117
     C* If no Branch entered, use default from ZMUSER                     S01117
     C*
     C           BRANCH    IFEQ '   '
     C********** BRANCH    OREQ '000'                                     S01117
     C**********           MOVELDSTB      BRANCH                          S01117
     C                     MOVELUSRBCH    BRANCH                          S01117
     C                     END
     C**
     C**    Check if a new cust number or shortname entered
     C**
     C           SELCRI    IFNE *BLANKS
     C                     EXSR CHKSEL                                    S01117
     C           @SEL      IFEQ 'N'                                       S01117
     C                     EXSR CUSSEC
     C                     END                                            S01117
     C                     END
     C**
     C**    Lower Level Enquiry Selected - only possible if details
     C**
     C           OPTN      IFNE *BLANK
     C                     EXSR LINK
     C                     SETOF                     41                   E13484
     C                     END
     C**
     C                     END
     C                     END
      ***  End of Do While *IN01 = '0'.                                   E32164
     C                     END
      *                                                                   E32164
     C           EAUDIT    TAG
      *
      *================================================================
      *  Return to calling program                                    *
      *                                                               *
     C                     EXSR RETSR
      *                                                               *
      *================================================================
      /EJECT
     C*****************************************************************
     C**                                                              *
     C**    COMMD   SR   To process Command Keys                      *
     C**                 and HELP, ROLLUP and ROLLDOWN                *
     C**                                                              *
     C**    Called  By   MAIN                                         *
     C**    Calls   SR   ROLLUP, CLEAR, CUSSEC                        *
     C**    Calls  PGM   MHELP, SE0270,  SE0240                       *
     C**                                                              *
     C*****************************************************************
     C**
     C           COMMD     BEGSR                           ** COMMD **
     C**
     C*****If*HELP*pressed*call*help*screen****************************   S01199
     C***********                                                         S01199
     C***********AID       IFEQ 'HP'                                      S01199
     C***********          CALL 'MHELP'                                   S01199
     C***********          PARM           PGMNO                           S01199
     C***********          PARM           HERCD 160                       S01199
     C***********          END                                            S01199
     C**
     C**    If Rollup key pressed
     C**
     C           AID       IFEQ 'UP'
     C***********          EXSR ROLLUP                                    E31752
      *                                                                   E31752
      ***  Check for Rollup beyond last page.                             E31752
      *                                                                   E31752
     C           *IN05     IFEQ '1'                                       E31752
     C                     MOVE '1'       *IN06                           E31752
      *                                                                   E31752
      ***  Else load the next page of the Subfile.                        E31752
      *                                                                   E31752
     C                     ELSE                                           E31752
     C                     Z-ADDTOP       SFLREC                          E31752
     C                     EXSR DISP                                      E31752
     C                     END                                            E31752
      *                                                                   E31752
     C                     END
     C**
     C**    If F3 then exit to menu - return code 1 and end
     C**
     C           AID       IFEQ '01'
     C                     MOVE '1'       RTNC
     C                     MOVE '1'       *IN01
     C                     END
     C**
     C**    If F12 then return to previous enquiry - return code 2
     C**                  unless there is no previous enquiry
     C**
     C           AID       IFEQ '02'
     C           ORIG      IFNE PGMNO
     C                     MOVE '2'       RTNC
     C                     MOVE '1'       *IN01
     C                     ELSE
     C                     MOVE '1'       *IN42
     C                     MOVE MSG,6     ERMSG
     C                     END
     C                     END
     C**
     C**    If F5 then refresh enquiry screen
     C**
     C           AID       IFEQ '05'
     C                     EXSR CLEAR
     C                     END
     C**
     C**    If F6 then call Customer Shortname Enquiry
     C**    or security short name enquiry or report error
     C**    On return check return code
     C**    if 0 then Database Error and exit required
     C**    if 1 then F3 and exit to menu required
     C**    otherwise retrieve customer or security shortname
     C**
     C           AID       IFEQ '06'
     C                     MOVE *BLANKS   ERMSG  79
     C                     SETOF                     404142
     C                     SETOF                     434445
     C           CUSTMR    IFNE *BLANKS
     C           SECSNM    ANDNE*BLANKS
     C                     SETON                     414243
     C                     MOVE MSG,12    ERMSG
     C                     ELSE
     C           CUSTMR    IFEQ *BLANKS
     C                     OUT  SESDS
     C**********           OUT  LDA                                       S01117
     C                     CALL 'SE0270'
     C********** *LOCK     IN   LDA                                       S01117
     C           *LOCK     IN   SESDS
     C           RTNC      IFEQ '0'
     C           RTNC      OREQ '1'
     C                     MOVE '1'       *IN01
     C                     ELSE
     C                     MOVE MNTHYR    MTHYR2  4                       E23128
     C                     MOVE SECSNM    SESNM2 10                       E23128
     C                     MOVE BRANCH    BRNCH2  3                       E23128
     C                     EXSR CLEAR                                     E15334
     C                     MOVE MTHYR2    MNTHYR                          E23128
     C                     MOVE SESNM2    SECSNM                          E23128
     C                     MOVE BRNCH2    BRANCH                          E23128
     C                     MOVELRQCUST    CUSTMR
     C                     MOVE *BLANKS   RQCUST
     C                     END
      *
     C                     ELSE
     C                     MOVE '6'       RTNC
     C                     OUT  SESDS
     C**********           OUT  LDA                                       S01117
     C                     CALL 'SE0240'
     C********** *LOCK     IN   LDA                                       S01117
     C           *LOCK     IN   SESDS
     C           RTNC      IFEQ '0'
     C           RTNC      OREQ '1'
     C                     MOVE '1'       *IN01
     C                     ELSE
     C                     MOVELRQSESN    SECSNM
     C                     MOVE *BLANKS   RQSESN
     C           *IN07     IFEQ '0'
     C                     EXSR CHKSEL                                    S01117
     C           @SEL      IFEQ 'N'                                       S01117
     C                     EXSR CUSSEC
     C                     END                                            S01117
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C**
     C**     If F9 then return to initial enquiry - return code 7
     C**                   unless this is the initial program
     C**
     C           AID       IFEQ '07'
     C           ORIG      IFNE PGMNO
     C                     MOVE '7'       RTNC
     C                     MOVE '1'       *IN01
     C                     ELSE
     C                     MOVE '1'       *IN42
     C                     MOVE MSG,6     ERMSG
     C                     END
     C                     END
     C**
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C**           ****** AS400 CONVERSION ******                     *   S01179
     C**                                                              *   S01179
     C** ASCHGS S/R TO MOVE THE APPROPRIATE VALUES INTO FIELD AID,    *   S01179
     C** DEPENDING ON WHICH FUNCTION KEY HAS BEEN PRESSED.            *   S01179
     C** CALLED FROM UPDATE                                           *   S01179
     C**                                                              *   S01179
     C*****************************************************************   S01179
     C*                                                                   S01179
     C           ASCHGS    BEGSR                                          S01179
     C*                                                                   S01179
     C* If ENTER pressed, the VLDCMDKEY indicator will be off             S01179
     C*                                                                   S01179
     C           *IN10     IFEQ '0'                                       S01179
     C                     MOVE 'RA'      AID                             S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F3                                                             S01179
     C*                                                                   S01179
     C           *INKC     IFEQ '1'                                       S01179
     C                     MOVE '01'      AID                             S01179
     C                     MOVE '0'       *INKC                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F5                                                             S01179
     C*                                                                   S01179
     C           *INKE     IFEQ '1'                                       S01179
     C                     MOVE '05'      AID                             S01179
     C                     MOVE '0'       *INKE                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F6                                                             S01179
     C*                                                                   S01179
     C           *INKF     IFEQ '1'                                       S01179
     C                     MOVE '06'      AID                             S01179
     C                     MOVE '0'       *INKF                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F9                                                             S01179
     C*                                                                   S01179
     C           *INKI     IFEQ '1'                                       S01179
     C                     MOVE '07'      AID                             S01179
     C                     MOVE '0'       *INKI                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F12                                                            S01179
     C*                                                                   S01179
     C           *INKL     IFEQ '1'                                       S01179
     C                     MOVE '02'      AID                             S01179
     C                     MOVE '0'       *INKL                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If ROLLUP pressed                                                 S01179
     C*                                                                   S01179
     C           *IN20     IFEQ '1'                                       S01179
     C                     MOVE 'UP'      AID                             S01179
     C                     MOVE '0'       *IN20                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C**If*HELP*key*pressed*************************************** S01179 S01199
     C***********                                                  S01179 S01199
     C************IN21     IFEQ '1'                                S01179 S01199
     C***********          MOVE 'HP'      AID                      S01179 S01199
     C***********          MOVE '0'       *IN21                    S01179 S01199
     C***********          END                                     S01179 S01199
     C*                                                                   S01179
     C                     ENDSR                                          S01179
     C*                                                                   S01179
     C*****************************************************************
      /EJECT
      *                                                                   E31752
      ***  Moved the simple If/Else statement to where it belongs.        E31752
      *                                                                   E31752
     C*****************************************************************   E31752
     C*****************************************************************   E31752
     C*****ROLLUP*SR**When*Rollup*key*is*pressed*load*next*page*unless*   E31752
     C****************last*page*already*displayed*when*error*message***   E31752
     C*****************************************************************   E31752
     C*****Called*by**COMMD********************************************   E31752
     C*****Calls**SR**DISP*********************************************   E31752
     C*****************************************************************   E31752
     C*****************************************************************   E31752
     C***********                                                         E31752
     C***********ROLLUP    BEGSR                           ** ROLLUP **   E31752
     C***********                                                         E31752
     C*****If*details*Complete*then*Rollup*is*beyond*last*record*******   E31752
     C***********                                                         E31752
     C************IN05     IFEQ '1'                                       E31752
     C***********          MOVE '1'       *IN06                           E31752
     C***********                                                         E31752
     C***********          ELSE                                           E31752
     C***********                                                         E31752
     C*****Load*next*page*of*subfile***********************************   E31752
     C***********                                                         E31752
     C***********          Z-ADDTOP       SFLREC                          E31752
     C***********          EXSR DISP                                      E31752
     C***********                                                         E31752
     C***********          END                                            E31752
     C***********                                                         E31752
     C***********          ENDSR                                          E31752
     C***********                                                         E31752
     C*****************************************************************   E31752
      /EJECT
     C*****************************************************************
     C**                                                              *
     C**   OPTION SR  To check validity of option combinations        *
     C**                                                              *
     C**   Called by  MAIN                                            *
     C**   Calls  SR  none                                            *
     C**                                                              *
     C*****************************************************************
     C**
     C           OPTION    BEGSR                            ** OPTION *
     C**
     C                     MOVE *BLANKS   OPTN
     C**
     C**  If no subfile records the only possible entry is customer
     C**
     C           *IN03     IFEQ '1'
     C**
     C           CUSTMR    IFEQ *BLANKS
     C                     MOVE '1'       *IN42
     C                     MOVE MSG,1     ERMSG
     C                     END
     C**
     C                     ELSE
     C**
     C                     READCSE0220S0                 40
     C**                                                                  E13657
     C                     MOVE SLINE     MOVTP                           E13657
     C**
     C**     Check if any entry made
     C**
     C           *IN40     IFEQ '1'
     C           CUSTMR    ANDEQ*BLANKS
     C                     MOVE '1'       *IN42
     C                     MOVE MSG,7     ERMSG
     C                     END
     C**
     C**     Check if both Cust No./Shortname and option entered
     C**
     C           *IN40     IFEQ '0'
     C           CUSTMR    ANDNE*BLANKS
     C           SELECT    ANDNE*BLANKS                                   E15707
     C                     MOVE '1'       *IN42
     C                     MOVE '1'       *IN41
     C                     MOVE MSG,2     ERMSG
     C                     END
     C**
     C**    Check if more than one option entered
     C**
     C           *IN40     IFEQ '0'
     C           SELECT    ANDNE*BLANKS                                   E15707
     C                     MOVE SELECT    OPTN
     C                     MOVELSSESN     RQSESN
     C                     MOVE *BLANK    SELECT
     C                     MOVE STDRF     RQTDRF
     C                     MOVE STCNR     RQCUST                          E16063
     C                     SETOF                     08
     C                     UPDATSE0220S0
     C**
     C**    Check if Trades enquiry selected for Depot movement           E13657
     C**    And if Trades enquiry selected for Security                   E38086
     C**                                                                  E13657
     C/COPY WNCPYSRC,SE0220C004
     C           *IN40     IFEQ '0'                                       E13657
     C           OPTN      ANDEQ' 2'                                      E13657
     C           *IN40     OREQ '0'                                       CSE039
     C           OPTN      ANDEQ' 4'                                      CSE039
     C           CSE039    ANDEQ'Y'                                       CSE039
     C/COPY WNCPYSRC,SE0220C009
     C           TESTP     IFEQ 'WI '                                     E13657
     C           CSE041    ANDEQ'N'                                       CSE041
     C           CSE039    ANDEQ'N'                                       CSE039
     C           TESTP     OREQ 'WO '                                     E13657
     C           CSE041    ANDEQ'N'                                       CSE041
     C           CSE039    ANDEQ'N'                                       CSE039
     C/COPY WNCPYSRC,SE0220C010
     C**********           MOVE MSG,13    ERMSG                           E13657              214953
     C**********           SETON                     42                   E13657              214953
     C                     MOVEL'22'      OPTN                                                214953
     C/COPY WNCPYSRC,SE0220C001
     C                     END                                            E13657
     C/COPY WNCPYSRC,SE0220C011
     C           IFSEC     IFEQ *BLANK                                    E38086
     C                     MOVE MSG,17    ERMSG                           E38086
     C                     SETON                     42                   E38086
     C                     END                                            E38086
     C                     END                                            E13657
     C**
     C           *IN40     DOUEQ'1'
     C                     READCSE0220S0                 40
     C           *IN40     IFEQ '0'
     C                     MOVE *BLANK    SELECT
     C                     UPDATSE0220S0
     C                     MOVE '1'       *IN42
     C                     MOVE MSG,3     ERMSG
     C                     END
     C**
     C                     END
     C                     END
     C                     END
     C**
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C**                                                              *
     C**   CUSSEC SR  To process entered Selection fields             *
     C**                                                              *
     C**   Called by  MAIN, FIRST                                     *
     C**   Calls  SR  SETUP                                           *
     C**                                                              *
     C*****************************************************************
     C**
     C           CUSSEC    BEGSR                            ** CUSSEC *
     C**
     C                     SETOF                     4142
     C                     SETOF                     434445
     C**
     C***Access*customer*record*-**(SNAME*or*CLINT)********************   S01117
     C*******error*if*not*on*file*or*deleted***************************   S01117
     C********** CUSTMR    CHAINSNAME                25                   S01117
     C********** *IN25     IFEQ '0'                                       S01117
     C********** RECI      IFEQ '*'                                       S01117
     C**********           SETON                     25                   S01117
     C**********           ELSE                                    E19986 S01117
     C**********           MOVE CNUM      CUSTNO                   E19986 S01117
     C**********           END                                            S01117
     C**********           END                                            S01117
     C***********                                                         S01117
     C***********          MOVELCUSTMR    CUSTNO  60               E15304 E19986
     C***25*****           MOVELCUSTMR    CUSTNO  60               E19986 S01117
     C********** *IN25     IFEQ '1'                                       S01117
     C***********          MOVELCUSTMR    CUSTNO  60                      E15304
     C********** CUSTNO    CHAINCLINTCBF             25                   S01117
     C********** *IN25     IFEQ '0'                                       S01117
     C********** RECI      IFEQ '*'                                       S01117
     C**********           SETON                     25                   S01117
     C**********           END                                            S01117
     C**********           END                                            S01117
     C********** *IN25     IFEQ '1'                                       S01117
      *                                                                   S01117
      ***  Access customer record - SDSECSPD AND SDCUSTPD.                S01117
      ***  Error if not on file.                                          S01117
      *                                                                   S01117
     C                     MOVELCUSTMR    @CKEY                           S01117
     C***********          CALL 'AOCUSTR0'                         S01117 CSD007
     C                     CALL 'AOCUSTR2'                                CSD007
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM           @CKEY  10                       S01117
     C                     PARM *BLANKS   @KYST   7                       S01117
     C***********SDCUST    PARM SDCUST    DSSDY                    S01117 CSD007
     C           SDCUST    PARM SDCUST    DSLDY                           CSD007
      *                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C           CSD007    ANDNE'Y'                                       CSD007
      *                                                                   CSD007
     C           @RTCD     ORNE *BLANKS                                   CSD007
     C           @RTCD     ANDEQ'*NRF   '                                 CSD007
     C           BBDTDL    ANDNE*ZEROS                                    CSD007
     C           CSD007    ANDEQ'Y'                                       CSD007
      *                                                                   CSD007
     C           @RTCD     ORNE *BLANKS                                   CSD007
     C           @RTCD     ANDNE'*NRF   '                                 CSD007
     C           CSD007    ANDEQ'Y'                                       CSD007
      *                                                                   CSD007
     C                     SETON                     4142
     C                     MOVE MSG,5     ERMSG
     C                     GOTO ECUSSE
     C                     END
      *                                                                   S01117
     C                     MOVELBBCUST    @SKEY                           S01117
     C**********           END                                            S01117
     C*                                                                   E15304
     C* Check for a Portfolio Client                                      E15304
     C*                                                                   E15304
     C********** CUSTNO    CHAINCLINTSEF             26             E15304S01117
     C                     CALL 'AOSECSR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @SKEY   6                       S01117
     C           SDSECS    PARM SDSECS    DSSDY                           S01117
     C********** *IN26     IFEQ '0'                                 E15304S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C********** C1DI      IFNE 'D'                                 E15304S01117
     C********** C1DI      ANDNE'S'                                 E15304S01117
     C           BFCLAS    IFNE 'D'                                 E15304S01117
     C           BFCLAS    ANDNE'S'                                 E15304S01117
     C                     SETON                     4142                 E15304
     C                     MOVE MSG,14    ERMSG                           E15304
     C                     GOTO ECUSSE                                    E15304
     C                     END                                            E15304
     C                     ELSE                                           E19986
     C                     SETON                     4142                 E19986
     C                     MOVE MSG,14    ERMSG                           E19986
     C                     GOTO ECUSSE                                    E19986
     C                     END                                            E15304
     C**
     C** Month/year if entered -
     C**  month must be 01-12: year must be 00-99
     C**  must not be earlier than date calculated in FIRST
     C**
     C                     MOVE *BLANKS   LSTCLE  7
     C                     Z-ADD0         LSTCDE  50
      *                                                                   E32164
     C           MNTHYR    IFNE *BLANKS
     C                     MOVE MNTHYR    MNWORK
      *                                                                   E32164
     C           MNTH      IFLT '01'
     C           MNTH      ORGT '12'
     C                     SETON                     4244
     C                     MOVE MSG,9     ERMSG
     C                     GOTO ECUSSE
      *                                                                   E32164
     C                     ELSE
     C           YR        IFLT '00'
     C           YR        ORGT '99'
     C                     SETON                     4244
     C                     MOVE MSG,9     ERMSG
     C                     GOTO ECUSSE
      *                                                                   E32164
     C                     ELSE
     C           YRP       IFLT ZZYR
     C/COPY WNCPYSRC,SE0220C012
     C                     SETON                     4244
     C                     MOVE MSG,10    ERMSG
     C                     GOTO ECUSSE
      *                                                                   E32164
     C                     ELSE
     C           YRP       IFEQ ZZYR
     C           MNTHP     ANDLTZZMNTH
     C/COPY WNCPYSRC,SE0220C013
     C                     SETON                     4244
     C                     MOVE MSG,10    ERMSG
     C                     GOTO ECUSSE
      *                                                                   E32164
     C                     ELSE
     C**
     C**  Calculate ddmmmyy date of last calendar day of month prior
     C**  to month/year entered (LSTCLE)
     C**  Set dd to 01, then convert month/year entered to day no
     C**  Subtract 1 from date (=last day in prev month) &
     C**  convert this date to ddmmmyy
     C**
     C                     MOVE YR        YY
     C           *IN98     IFEQ '1'
     C                     MOVE '01'      MM
     C                     MOVE MNTH      DD
     C                     ELSE
     C                     MOVE '01'      DD
     C                     MOVE MNTH      MM
     C                     END
      *                                                                   E32164
     C                     MOVELDAYWK     ZDATE
     C                     EXSR ZDATE1
     C                     SUB  1         ZDAYNO
     C                     Z-ADDZDAYNO    LSTCDE
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    LSTCLE
     C                     END
      *                                                                   E32164
     C                     END
     C                     END
     C                     END
     C                     END
     C**
     C** Access security record if security entered -
     C**     error if not on file or deleted
      *                                                                   E32164
     C           SECSNM    IFNE *BLANKS
     C           SECSNM    CHAINSECTY                25
     C           *IN25     IFEQ '0'
     C           RECI      IFEQ '*'
     C           RECI      OREQ 'C'                                       090501
     C                     SETON                     25
     C                     END
     C                     END
      *                                                                   E32164
     C           *IN25     IFEQ '1'
     C                     SETON                     4342
     C                     MOVE MSG,11    ERMSG
     C                     GOTO ECUSSE
     C                     END
      *                                                                   E32164
     C                     END
     C**
     C** If multibranch environment -
     C** If branch entered - Access Branch table record -
     C**     error if not on file or deleted
      *                                                                   E32164
     C           *IN07     IFEQ '1'
     C**********           MOVE *BLANKS   KEY    12                       S01117
     C**********           MOVEL'10'      KEY                             S01117
     C**********           MOVE BRANCH    KEY                             S01117
     C********** KEY       CHAINTABLETRF             25                   S01117
     C********** *IN25     IFEQ '0'                                       S01117
     C********** RECI      IFEQ '*'                                       S01117
     C**********           SETON                     25                   S01117
     C**********           END                                            S01117
     C**********           END                                            S01117
     C********** *IN25     IFEQ '1'                                       S01117
      *                                                                   S01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM BRANCH    @BKEY   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     SETON                     4245
     C                     MOVE MSG,8     ERMSG
     C                     GOTO ECUSSE
     C                     END
     C                     CALL 'ZVBBU'                                   S01117
     C***********          PARM A8BRCD    ZBRCDX                   S01117 E31583
     C***********          PARM           @ERR                     S01117 E31583
     C                     PARM A8BRCD    ZBRCDX  3                       E31583
     C                     PARM           @ERR    10                      E31583
     C*                                                                   S01117
     C           @ERR      IFEQ 1                                         S01117
     C                     SETON                     4245                 S01117
     C                     MOVE MSG,15    ERMSG                           S01117
     C                     GOTO ECUSSE                                    S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           @ERR      IFEQ 2                                         S01117
     C                     SETON                     4245                 S01117
     C                     MOVE MSG,16    ERMSG                           S01117
     C                     GOTO ECUSSE                                    S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END
     C**
     C** All fields valid - prepare to display details -
     C                     EXSR SETUP
     C**
     C           ECUSSE    TAG                             ** ECUSSE TAG**
     C**
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C**                                                              *
     C**   SETUP  SR  To prepare for Screen Display                   *
     C**                                                              *
     C**   Called by  CUSSEC                                          *
     C**   Calls  SR  CLEAR, DISP                                     *
     C**                                                              *
     C*****************************************************************
     C**
     C           SETUP     BEGSR                           ** SETUP **
     C**
     C**********           MOVE CNUM      PCUST   60                      S01117
     C**********           MOVE BRANCH    SAVBR   30                      S01117
     C**********           MOVE BFCUST    PCUST   60                                   S01117 CSD027
     C                     MOVE BFCUST    PCUST   6                                           CSD027
     C                     MOVE BRANCH    SAVBR   3                       S01117
     C                     MOVE SECSNM    CHKSEC 10
     C**
     C**   Clear the Screen
     C**
     C                     EXSR CLEAR
     C**
     C**   Move CUST  Details to output fields
     C**
     C                     MOVE PCUST     SCUST
     C**********           MOVE CRNM      SCRNM  20                       S01117
     C**********           MOVE CTWN      SCTWN  10                       S01117
     C                     MOVE BBCRNM    SCRNM  20                       S01117
     C                     MOVE BBCRTN    SCTWN  10                       S01117
     C**
     C********** SAVBR     IFEQ 0                                         S01117
     C           SAVBR     IFEQ *BLANKS                                   S01117
     C**********           MOVE DSTB      SAVBR                           S01117
     C                     MOVE USRBCH    SAVBR                           S01117
     C                     END
     C**
     C* Reset Accumulators for Screen Details                             E14576
     C*                                                                   E14576
     C                     Z-ADDRUND      ORDAT                           E14576
     C**
     C**   Posn TDPBV/T file at start of reqd customer/branch/sec/date
     C**                                                                  E14576
     C                     MOVE CHKSEC    TDSS
     C           LSTCDE    IFEQ *ZEROS
     C                     Z-ADDLSTCDR    THEDAT
     C                     ELSE
     C                     Z-ADDLSTCDE    THEDAT
     C                     END
     C***09******KEYT      SETLLTDPBT                                     E13853
     C**N09******KEYT      SETLLTDPBV                                     E13853
     C   09      KEYT      SETGTTDPBT                                     E13853
     C  N09      KEYT      SETGTTDPBV                                     E13853
     C                     MOVE SAVBR     SBRCH
     C**
     C**   Reset Accumulators for Screen Details
     C**
     C                     MOVE *BLANKS   SAVSEC 10
     C                     Z-ADD*ZEROS    ZZNOML
     C                     Z-ADD*ZEROS    ZZNOMB                          E14576
     C                     Z-ADD*ZEROS    ZNOMP
     C                     Z-ADD*ZEROS    ZZNOMU
     C                     Z-ADD*ZEROS    ZZPUR
     C                     Z-ADD*ZEROS    ZZSAL
     C                     Z-ADD*ZEROS    ZZAPP
     C                     Z-ADD*ZEROS    ZZAPS
     C**
     C**   Get details for display
     C**
     C                     EXSR DISP
     C**
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C**                                                              *
     C**   CLEAR  SR  Clear the screen display fields and indicators  *
     C**                                                              *
     C**   Called by  COMMD, SETUP                                    *
     C**   Calls  SR  none                                            *
     C**                                                              *
     C*****************************************************************
     C**
     C           CLEAR     BEGSR
     C**
     C**  Setup fields and indicators to clear subfile
     C**
     C                     MOVE *BLANKS   SCRNM
     C                     MOVE *BLANKS   SCTWN
     C                     MOVE *BLANKS   SCUST
     C                     MOVE *BLANKS   BRANCH
     C                     MOVE *BLANKS   SBRCH
     C                     MOVE *BLANKS   SECSNM
     C                     MOVE *BLANKS   CUSTMR
     C                     MOVE *BLANKS   MNTHYR
     C**
     C                     Z-ADD0         SFLREC  40
     C                     Z-ADD0         TOP     40
     C                     Z-ADD0         SFLT                            E13975
     C                     Z-ADD0         ZZTYPE                          E13975
     C**
     C***********          SETON                       035251             E13975
     C***********          SETOF                       040550             E13975
     C***********          SETOF                         8189             E13975
     C                     SETON                     035251               E13975
     C                     SETOF                     040550               E13975
     C                     SETOF                       8189               E13975
     C**  CLEAR SUBFILE
     C                     SETON                       02
     C                     WRITESE0220C0
     C                     SETOF                       02
     C**
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C**                                                              *
     C**   DISP   SR  Accumulate details for screen display           *
     C**                                                              *
     C**   Called by  SETUP, ROLLUP                                   *
     C**   Calls  SR  PROCES                                          *
     C**                                                              *
     C*****************************************************************
     C**
     C           DISP      BEGSR                           *** DISP ***
     C**
     C                     Z-ADD0         OUTREC  20
     C                     MOVE '0'       *IN89
     C**
     C**  IF STILL PROCESSING SFL RECS - GOTO S/R
     C           *IN51     IFEQ '0'
     C                     EXSR PROCES
     C           OUTREC    IFEQ 14
     C                     SETON                     89
     C                     END
     C                     END
     C**
     C** Do while not end of file and more records exist
     C**
     C           *IN89     DOWEQ'0'
     C           *IN51     ANDEQ'1'
      *                                                                   E32164
     C           NEXTRD    TAG                             *** NEXTRD  ***
      *                                                                   E32164
     C           *IN81     IFEQ '0'
     C                     SETOF                     616263
     C                     SETOF                     64
     C                     SETOF                     60                   CSE041
     C***09******          READ TDPBT                    81               E13541
     C**N09******          READ TDPBV                    81               E13541
      *                                                                   E13541
     C           SECSNM    IFEQ *BLANKS                                   E13541
     C   09      TDPK1     READETDPBT                    81               E13541
     C  N09      TDPK1     READETDPBV                    81               E13541
     C                     ELSE                                           E13541
     C   09      TDPK2     READETDPBT                    81               E13541
     C  N09      TDPK2     READETDPBV                    81               E13541
     C                     END                                            E13541
     C*                                                                   E13541
     C                     END
     C**
     C**  End of File - If some records accumulated then write last one
     C**
     C           *IN81     IFEQ '1'
     C           *IN50     IFEQ '1'
     C                     SETON                     52
     C                     EXSR PROCES
      *                                                                   E32164
     C           OUTREC    IFEQ 14
     C***********          SETON                     89                   E13541
     C***********          SETON                     8905           E13541E15306
     C                     SETON                     89                   E15306
     C                     GOTO EDLOOP
     C                     END
      *                                                                   E32164
     C                     END
     C                     SETON                     0589
     C                     END
     C**
     C**  Successful file read of an active record
     C**
     C           *IN81     IFEQ '0'
     C           RECI      IFNE 'C'                                       E13854
     C           RECI      ANDNE'R'                                       S01269
     C           RECI      IFNE '*'
     C           RECI      OREQ '*'                                       E13854
     C           CHTP      ANDNE'D'                                       E13854
     C           *IN61     ANDEQ'0'                                       E35915
     C           *IN62     ANDEQ'0'                                       E35915
     C***********RECI      ANDNE'C'                                 E13853E13854
     C**
     C**  If not correct branch/cust & there have been recs for the
     C**  required branch/cust then output the last one
     C**
     C********** SAVBR     IFNE TDBR                                      S01117
     C           SAVBR     IFNE TDBA                                      S01117
     C           PCUST     ORNE TCNR
     C                     SETON                     8189
     C**
     C           *IN50     IFEQ '1'
     C                     SETON                     52
     C                     EXSR PROCES
     C           OUTREC    IFEQ 14
     C                     SETON                     89
     C                     GOTO EDLOOP
     C                     END
     C           *IN51     IFEQ '1'
     C                     MOVE '1'       *IN05
     C                     END
     C                     END
     C**
     C                     ELSE
     C**
     C**  If not correct security & there have been recs for the
     C**  required security then output the last one
     C**
     C           CHKSEC    IFNE *BLANKS
     C           CHKSEC    ANDNETDSS
     C                     SETON                     8189
     C**
     C           *IN50     IFEQ '1'
     C                     SETON                     52
     C                     EXSR PROCES
     C           *IN51     IFEQ '1'
     C                     MOVE '1'       *IN05
     C                     END
     C           OUTREC    IFEQ 14
     C                     SETOF                     05                   E15706
     C                     SETON                     89
     C                     GOTO EDLOOP
     C                     END
     C                     END
     C**
     C                     ELSE
     C**
     C**   show new security
     C**
     C           SAVSEC    IFNE *BLANKS
     C           SAVSEC    ANDNETDSS
     C                     SETON                     52
     C                     END
     C**
     C**   If sec not selected - check date after date req'd
     C**
     C           CHKSEC    IFEQ *BLANKS
      *                                                                   E32164
     C           *IN09     IFEQ '1'
     C           TDDT      ANDLETHEDAT
     C***********KEYT      SETLLTDPBT                                     E13853
     C           KEYT      SETGTTDPBT                                     E13853
     C                     GOTO NEXTRD
     C                     END
      *                                                                   E32164
     C           *IN09     IFEQ '0'
     C           TDVD      ANDLETHEDAT
     C***********KEYT      SETLLTDPBV                                     E13853
     C           KEYT      SETGTTDPBV                                     E13853
     C                     GOTO NEXTRD
     C                     END
      *                                                                   E32164
     C                     END
     C**
     C**   output trade details
     C**
     C                     SETOF                     51
     C                     EXSR PROCES
     C**
     C                     END
     C                     END
     C**
     C                     END                                            E13854
     C                     END
     C                     END
     C                     END
     C**
     C**    Condition Display of message if no details for branch/cust
     C**
     C           EDLOOP    TAG                             ** EDLOOP    **
      *                                                                   E32164
     C           SFLREC    IFEQ 0
     C                     MOVE '1'       *IN04
     C                     ELSE
     C**
     C**    If records written - read next to check if there are more
     C**
     C           *IN51     IFEQ '0'
     C                     SETOF                     82
      *                                                                   E32164
     C           OUTREC    IFEQ 14
     C           *IN05     ANDEQ'0'
     C           *IN51     ANDEQ'0'
      *                                                                   E32164
     C***********ZZTYPE    IFNE 0                                         E20324
     C           ZZTYPE    IFLE 3                                         E20324
     C                     SETON                     82
     C                     ELSE
     C**
     C           *IN81     IFEQ '0'
     C                     SETOF                     616263
     C                     SETOF                     64
     C                     SETOF                     60                   CSE041
      *                                                                   E32164
     C           RECI      DOUEQ'D'
     C           RECI      OREQ 'S'                                       E15215
     C           *IN81     OREQ '1'
     C   09                READ TDPBT                    81
     C  N09                READ TDPBV                    81
     C                     END
      *                                                                   E32164
     C           *IN81     IFEQ '0'
     C           RECI      IFEQ 'D'
     C           RECI      OREQ 'S'                                       E15215
     C           TCNR      IFEQ PCUST
     C********** TDBR      ANDEQSAVBR                                     S01117
     C           TDBA      ANDEQSAVBR                                     S01117
     C           CHKSEC    IFNE *BLANKS
     C           CHKSEC    IFEQ TDSS
     C                     SETON                     82
     C                     SETOF                     616263
     C                     SETOF                     64
     C                     SETOF                     60                   CSE041
     C   09                READPTDPBT                    81
     C  N09                READPTDPBV                    81
     C                     ELSE
     C                     SETON                     81
     C                     END
     C                     ELSE
     C                     SETON                     82
     C                     SETOF                     616263
     C                     SETOF                     64
     C                     SETOF                     60                   CSE041
     C   09                READPTDPBT                    81
     C  N09                READPTDPBV                    81
     C                     END
     C                     END
     C                     ELSE
     C                     SETON                     81
     C                     END
     C                     END
     C                     END
     C                     END
      *                                                                   E32164
     C           *IN82     IFEQ '0'
     C                     SETON                     05
     C                     END
      *                                                                   E32164
     C                     END
     C                     END
      *                                                                   E32164
     C                     MOVE '0'       *IN03
     C                     END
     C                     Z-ADDSFLREC    TOP
     C**
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT
0738 C*****************************************************************
     C**                                                              *
     C**   PROCES SR  Process the details for a TRADE                 *
     C**                                                              *
     C**   Called by  DISP                                            *
     C**   Calls  SR  RETSR,SUBFIL                                    *
     C**                                                              *
     C*****************************************************************
     C**
     C           PROCES    BEGSR                           ** PROCES **
     C**
     C           OUTREC    IFGE 14
     C                     GOTO PEND
     C                     END
     C**
     C** C/F line required  -
     C**
     C           *IN50     IFEQ '1'
     C           *IN52     ANDEQ'1'
     C**
     C** Access CDEPP file -
     C**
     C                     Z-ADD0         ZZTYPE  10
     C                     Z-ADD*ZEROS    ZZNOML
     C                     Z-ADD*ZEROS    ZZNOMB                          E14576
     C                     Z-ADD*ZEROS    ZZNOMU
     C                     Z-ADD*ZEROS    ZZPUR
     C                     Z-ADD*ZEROS    ZZSAL
     C                     Z-ADD*ZEROS    ZZAPP
     C                     Z-ADD*ZEROS    ZZAPS
     C                     Z-ADD*ZEROS    ZNOMP
      *                                                                   E32164
     C           SKEYH     SETLLCDEPP                    25
     C           *IN25     IFEQ '1'
     C           SKEYH     READECDEPP                    25
      *                                                                   E32164
     C           *IN25     DOWEQ'0'
      *                                                                   E32164
     C********** TVVL      IFEQ 'T'                                       S01117
     C           BVTVDV    IFEQ 'T'                                       S01117
     C                     ADD  CDNT      ZNOMP
     C                     ADD  CDNT      ZZNOML
     C                     ADD  SNPT      ZZNOML
     C                     ADD  CDST      ZZNOML
     C                     ADD  CDNV      ZZNOMU
     C                     ADD  CNPV      ZZNOMU
     C                     ADD  CNSV      ZZNOMU
     C                     ADD  CDST      ZZSAL
     C                     ADD  SNPT      ZZPUR
     C                     ADD  SAPS      ZZAPS
     C                     ADD  SAPP      ZZAPP
     C                     ELSE
     C                     ADD  CDNV      ZNOMP
     C                     ADD  CDNT      ZZNOMU
     C                     ADD  SNPT      ZZNOMU
     C                     ADD  CDST      ZZNOMU
     C                     ADD  CDNV      ZZNOML
     C                     ADD  CNPV      ZZNOML
     C                     ADD  CNSV      ZZNOML
     C                     ADD  CNSV      ZZSAL
     C                     ADD  CNPV      ZZPUR
     C                     ADD  SPSV      ZZAPS
     C                     ADD  SAPV      ZZAPP
     C                     END
      *                                                                   E32164
     C           SKEYH     READECDEPP                    25
     C                     END
     C                     END
      *                                                                   E31583
      ***  Field CDPA could contain the incorrect Branch or even be       E31583
      ***  blank.  The correct Branch has already been tested anyway.     E31583
     C*                                                                   S01117
     C***CHECK*USER*HAS*AUTHORITY*TO*BRANCH*IF*MULTIBRANCHING***** S01117 E31583
     C***********                                                  S01117 E31583
     C************IN07     IFEQ '1'                                S01117 E31583
     C***********          CALL 'ZVBBU'                            S01117 E31583
     C***********          PARM CDPA      ZBRCDX  3                S01117 E31583
     C***********          PARM           @ERR    10               S01117 E31583
     C***********          ELSE                                    S01117 E31583
     C***********          Z-ADD0         @ERR                     S01117 E31583
     C***********          END                                     S01117 E31583
     C***********@ERR      IFEQ *ZEROS                             S01117 E31583
     C*
     C** Data accessed - fill SFL line & output to SFL
     C*
     C                     EXSR SUBFIL
     C                     SETOF                     5052
     C           OUTREC    IFGE 14
     C                     GOTO PEND
     C                     END
     C*
     C** Output blank line
     C*
     C                     MOVE *BLANKS   SLINE
     C                     SETON                     08
     C                     ADD  1         SFLREC
     C                     ADD  1         OUTREC
     C                     WRITESE0220S0
     C                     SETOF                     5052
      *                                                                   E32164
     C           OUTREC    IFGE 14
     C                     GOTO PEND
     C                     END
      *                                                                   E32164
     C***********          END                                     S01117 E31583
     C                     END
     C**
     C** B/F lines required  -
     C** First line (security details required)
     C** Access security & investment type records
     C**
     C           *IN50     IFEQ '0'
     C           *IN51     ANDEQ'0'
      *                                                                   E32164
     C           SFLT      IFEQ 0
     C           TDSS      IFNE *BLANKS
     C           TDSS      CHAINSECTY                25
     C**N25******RECI      COMP 'D'                  2525                 E15221
      *                                                                   E15221
     C********** *IN25     IFEQ '0'                                E15221 186427
     C********** RECI      IFNE 'D'                                E15221 186427
     C********** RECI      ANDNE'M'                                E15221 186427
     C**********           SETON                     25            E15221 186427
     C/COPY WNCPYSRC,SE0220C018
     C**********           END                                     E15221 186427
     C**********           END                                     E15221 186427
     C*                                                                   E15221
     C**  If no record found or deleted record
     C**  then it is a database error so return to calling
     C**  program with a return code of '0'
     C*                                                                   E15221
     C           *IN25     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVELPROGRM    DBPGM
     C                     MOVELTDSS      DBKEY            ***************
     C                     MOVE 'SECTY'   DBFILE           * DB ERROR 04 *
     C                     Z-ADD04        DBASE            ***************
     C                     SETON                       U7U8
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     MOVE '0'       RTNC
     C                     EXSR RETSR
     C                     END
     C*                                                                   S01232
     C***  Indicate if an Australian Yield Traded security                S01232
     C*                                                                   S01232
     C                     ELSE                                           S01232
     C           STBS      IFEQ 'Y'                                       S01232
     C           SYBS      ANDEQ'AU'                                      S01232
     C                     SETON                     53                   S01232
     C                     ELSE                                           S01232
     C                     SETOF                     53                   S01232
     C                     END                                            S01232
     C*                                                                   S01232
     C           INVKA     CHAININVTPDF              33                   S01232
     C  N33      RECI      COMP '*'                      33               S01232
     C*                                                                   S01232
     C**  If no record found or deleted record                            S01232
     C**  then it is a database error so return to calling                S01232
     C**  program with a return code of '0'                               S01232
     C*                                                                   S01232
     C           *IN33     IFEQ '1'                                       S01232
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVELNMCY      WORK6A  6                       S01232
     C                     MOVE SITP      WORK6A                          S01232
     C                     MOVELWORK6A    DBKEY                           S01232
     C                     MOVELPROGRM    DBPGM            ***************S01232
     C                     MOVE 'INVTP'   DBFILE           * DB ERROR 08 *S01232
     C                     Z-ADD08        DBASE            ***************S01232
     C                     SETON                       U7U8               S01232
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     MOVE '0'       RTNC                            S01232
     C                     EXSR RETSR                                     S01232
     C                     END                                            S01232
     C*                                                                   S01232
     C                     END
     C                     ADD  1         SFLT
     C**
     C** Data accessed - fill SFL line & output to SFL
     C**
     C                     Z-ADD1         ZZTYPE  10
     C                     EXSR SUBFIL
     C           OUTREC    IFGE 14
     C                     GOTO PEND
     C                     END
     C                     END
     C**
     C** B/F line required
     C** Access CPOSH file -
     C           SFLT      IFEQ 1
     C           KEYH      SETGTCPOSH
     C                     READPCPOSH                    25
      *                                                                   E32164
     C           *IN25     IFEQ '0'
     C********** SAVBR     IFEQ CSBR                                      S01117
     C           SAVBR     IFEQ CSBA                                      S01117
     C           TDSS      ANDEQCSSC
     C           PCUST     ANDEQCSCN
      *                                                                   E32164
     C********** TVVL      IFEQ 'T'                                       S01117
     C           BVTVDV    IFEQ 'T'                                       S01117
     C                     Z-ADDCSNT      ZNOMP
     C                     Z-ADDCSNT      ZZNOML
     C                     Z-ADDCSNV      ZZNOMU
     C                     ELSE
     C                     Z-ADDCSNV      ZNOMP
     C                     Z-ADDCSNT      ZZNOMU
     C                     Z-ADDCSNV      ZZNOML
     C                     END
      *                                                                   E32164
     C                     ELSE
     C                     Z-ADD*ZEROS    CSPT
     C                     Z-ADD*ZEROS    CSPV
     C                     Z-ADD*ZEROS    CSDA
     C                     Z-ADD*ZEROS    ZZNOML
     C                     Z-ADD*ZEROS    ZZNOMU
     C                     Z-ADD*ZEROS    ZNOMP
     C                     END
      *                                                                   E32164
     C                     END
     C*                                                                   E14576
     C*  SAVE DETAILS OF CURRENT TRADE BEING PROCESSED (TO RESTORE LATER) E14576
     C*                                                                   E14576
     C                     MOVEARECIN     SRECIN                          E14576
     C*                                                                   E14576
     C* IF BACKVALUED TRADES ENTERED TODAY WITH TRADE/VALUE DATE          E14576
     C* EARLIER THAN START OF MONTH ENQUIRY INCLUDE THEM IN B/F LINE      E14576
     C* AVERAGE PRICE FOR B/F LINE IS NOT CHANGED                         E14576
     C*                                                                   E14576
     C                     Z-ADD0         ZZPCHS                          E14576
     C                     Z-ADD0         ZZSALS                          E14576
     C                     Z-ADD0         ZZWIS                           E14576
     C                     Z-ADD0         ZZWOS                           E14576
     C                     Z-ADD0         ZZRVS                           CSE041
     C                     Z-ADD0         ZZDPS                           CSE041
     C*                                                                   E14576
     C   09      KPOSEC    SETLLTDPOT                                     E14576
     C  N09      KPOSEC    SETLLTDPOV                                     E14576
     C*                                                                   E14576
     C                     SETOF                     7374                 E14576
     C                     SETOF                     71                   CSE041
     C   09      KPOSEC    READETDPOT                    11               E14576
     C  N09      KPOSEC    READETDPOV                    11               E14576
     C*                                                                   E14576
     C           *IN11     DOWEQ'0'                                       E14576
     C*                                                                   E14576
     C           RECI      IFNE '*'                                       E14576
     C           RECI      ANDNE'C'                                       E14576
     C           RECI      ANDNE'R'                                       S01269
     C*                                                                   E14576
     C           *IN09     IFEQ '1'                                       E14576
     C           TDDT      ANDLTTHEDAT                                    E14576
     C           *IN09     OREQ '0'                                       E14576
     C           TDVD      ANDLTTHEDAT                                    E14576
     C*
     C* trades                                                            E14576
     C*
     C           *IN73     IFEQ '0'                                       E14576
     C           *IN74     ANDEQ'0'                                       E14576
     C           TDTP      IFEQ 'TS'                                      E14576
     C                     ADD  NOML      ZZSALS                          E14576
     C                     ELSE                                           E14576
     C                     ADD  NOML      ZZPCHS                          E14576
     C                     END                                            E14576
     C                     END                                            E14576
     C*
     C* depot movements                                                   E14576
     C*
     C           *IN73     IFEQ '1'                                       E14576
     C                     ADD  NOML      ZZWIS                           E14576
     C                     END                                            E14576
     C           *IN74     IFEQ '1'                                       E14576
     C                     ADD  NOML      ZZWOS                           E14576
     C                     END                                            E14576
      *                                                                   CSE041
      * DVP/RVP movements                                                 CSE041
      *                                                                   CSE041
     C           *IN71     IFEQ '1'                                       CSE041
     C           TDTP      IFEQ 'RV'                                      CSE041
     C                     ADD  NOML      ZZRVS                           CSE041
     C                     ELSE                                           CSE041
     C                     ADD  NOML      ZZDPS                           CSE041
     C                     ENDIF                                          CSE041
     C                     ENDIF                                          CSE041
     C*                                                                   E14576
     C                     END                                            E14576
     C*                                                                   E14576
     C                     END                                            E14576
     C                     SETOF                     7374                 E14576
     C                     SETOF                     71                   CSE041
     C   09      KPOSEC    READETDPOT                    11               E14576
     C  N09      KPOSEC    READETDPOV                    11               E14576
     C                     END                                            E14576
     C*                                                                   E14576
     C                     ADD  ZZSALS    ZZNOMB                          E14576
     C                     SUB  ZZPCHS    ZZNOMB                          E14576
     C                     ADD  ZZWIS     ZZNOMB                          E14576
     C                     SUB  ZZWOS     ZZNOMB                          E14576
     C                     ADD  ZZRVS     ZZNOMB                          CSE041
     C                     SUB  ZZDPS     ZZNOMB                          CSE041
     C                     MOVEASRECIN    RECIN                           E14576
      *                                                                   E31583
      ***  Field CSBA could contain the incorrect Branch or even be       E31583
      ***  blank.  The correct Branch has already been tested anyway.     E31583
     C*                                                                   S01117
     C***CHECK*USER*HAS*AUTHORITY*TO*BRANCH*IF*MULTIBRANCHING***** S01117 E31583
     C***********                                                  S01117 E31583
     C************IN07     IFEQ '1'                                S01117 E31583
     C***********          CALL 'ZVBBU'                            S01117 E31583
     C***********          PARM CSBA      ZBRCDX                   S01117 E31583
     C***********          PARM           @ERR                     S01117 E31583
     C***********          ELSE                                    S01117 E31583
     C***********          Z-ADD0         @ERR                     S01117 E31583
     C***********          END                                     S01117 E31583
     C***********@ERR      IFEQ *ZEROS                             S01117 E31583
     C*
     C** Data accessed - fill SFL line & output to SFL
     C*
     C                     Z-ADD2         ZZTYPE  10
     C                     EXSR SUBFIL
     C*
     C** SAVE FIELDS
     C*
     C                     MOVE TDSS      SAVSEC
     C                     MOVE TDBK      SVTDBK
     C                     MOVE DELT      SVDELT
     C                     SETOF                     52
     C**
     C                     ADD  1         SFLT
     C           OUTREC    IFGE 14
     C                     GOTO PEND
     C                     END
     C***********          END                                     S01117 E31583
     C                     END
     C                     END
     C**                                                                  E32164
     C** Detail line required  -
     C** Data accessed - fill SFL line & output to SFL
     C**
     C           ZZTYPE    IFEQ 2
     C           ZZTYPE    OREQ 3
     C                     Z-ADD0         SFLT    10
     C                     Z-ADD3         ZZTYPE  10
      *                                                                   E31583
      ***  Field CSBA could contain the incorrect Branch or even be       E31583
      ***  blank.  The correct Branch has already been tested anyway.     E31583
     C*                                                                   S01117
     C***CHECK*USER*HAS*AUTHORITY*TO*BRANCH*IF*MULTIBRANCHING***** S01117 E31583
     C***********                                                  S01117 E31583
     C************IN07     IFEQ '1'                                S01117 E31583
     C***********          CALL 'ZVBBU'                            S01117 E31583
     C***********          PARM CSBA      ZBRCDX                   S01117 E31583
     C***********          PARM           @ERR                     S01117 E31583
     C***********          ELSE                                    S01117 E31583
     C***********          Z-ADD0         @ERR                     S01117 E31583
     C***********          END                                     S01117 E31583
     C***********@ERR      IFEQ *ZEROS                             S01117 E31583
      *                                                                   E31583
     C                     EXSR SUBFIL
     C                     SETON                     5051
     C***********          END                                     S01117 E31583
     C                     END
     C**
     C**  If all lines processed - reset indicators & save new fields
     C**
     C           PEND      TAG
     C                     Z-ADD*ZEROS    ZZNOML
     C                     Z-ADD*ZEROS    ZZNOMB                          E14576
     C                     Z-ADD*ZEROS    ZNOMP
     C                     Z-ADD*ZEROS    ZZNOMU
     C                     Z-ADD*ZEROS    ZZPUR
     C                     Z-ADD*ZEROS    ZZSAL
     C                     Z-ADD*ZEROS    ZZAPP
     C                     Z-ADD*ZEROS    ZZAPS
     C**
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT
0738 C*****************************************************************
     C**                                                              *
     C**   CSPRC  SR  Calculate book price                            *
     C**                                                              *
     C**   Called by  SUBFIL                                          *
     C**   Calls  SR  OLCAP                                           *
     C**                                                              *
     C*****************************************************************
     C**
     C           CSPRC     BEGSR                           ** CSPRC  **
     C**
     C**  B/V ind is set to BLANK by default
     C**
     C                     MOVE ' '       SBVI    1
     C                     Z-ADD0         BKPR   158
     C                     Z-ADD0         ZZAPW
     C**
     C** Access 1st price for sec,br,mkt=S,book,price type
     C**
     C********** TVVL      IFEQ 'T'                                       S01117
     C           BVTVDV    IFEQ 'T'                                       S01117
     C                     MOVE 'CT'      PPRT
     C                     ELSE
     C                     MOVE 'CV'      PPRT
     C                     END
      *                                                                   E32164
     C***********SKEYP     SETLLPRICS                    25               E14057
     C           SKEYP     SETLLPRICR                    25               E14057
     C           *IN25     IFEQ '1'
     C***********SKEYP     READEPRICS                    25               E14057
     C           SKEYP     READEPRICR                    25               E14057
     C           *IN25     IFEQ '0'
     C**
     C** If price found & value date is less than prev. run date
     C**  B/V ind is set to Y
     C**
     C           PVDT      IFLT PRUN
     C                     MOVE 'Y'       SBVI
     C**
     C**  If price found & value date equals prev. run date
     C**    Price will be used to override AP num COB field
     C**
     C                     ELSE
     C           PVDT      IFEQ PRUN
     C                     Z-ADDPPRC      ZZAPW
     C                     END
     C                     END
     C**
     C** If price found & value date = run date
     C**   price Becomes the average price
     C**
     C           PVDT      IFEQ RUND
     C                     Z-ADDPPRC      BKPR
     C                     ELSE
     C**
     C** If price found with value date less than prev run date
     C**   Access price file with date = run date
     C**     if found price becomes the average price
     C**
     C           PVDT      IFLT PRUN
     C***********SKEYPD    CHAINPRICS                25                   E14057
     C           SKEYPD    CHAINPRICR                25                   E14057
     C           *IN25     IFEQ '0'
     C                     Z-ADDPPRC      BKPR
     C                     ELSE
     C*
     C**     otherwise -                                               ld
     C**   Access price file with date = previous run date
     C**     if found  price will be used to override AP num COB fie   ld
     C*
     C***********SKEYPP    CHAINPRICS                25                   E14057
     C           SKEYPP    CHAINPRICR                25                   E14057
     C           *IN25     IFEQ '0'
     C                     Z-ADDPPRC      ZZAPW
     C                     END
      *                                                                   E32164
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C**
     C**  Calculate average price -
     C**    If price found with value date = run date this is it
     C**
     C           BKPR      IFEQ 0
     C**
     C** Access CPOSND for cust/branch/sec -
     C**   If found & BV ind is Y screen BV ind is set to Y
     C**
     C           SKEYCP    CHAINCPOSN                25
     C           *IN25     IFEQ '0'
      *                                                                   E32164
     C********** TVVL      IFEQ 'T'                                       S01117
     C           BVTVDV    IFEQ 'T'                                       S01117
     C           CSBT      ANDEQ'Y'
     C                     MOVE 'Y'       SBVI
      *                                                                   E32164
     C                     ELSE
     C********** TVVL      IFEQ 'V'                                       S01117
     C           BVTVDV    IFEQ 'V'                                       S01117
     C           CSBV      ANDEQ'Y'
     C                     MOVE 'Y'       SBVI
     C                     END
      *                                                                   E32164
     C                     END
     C**
     C**  If price found , value date = prev run date
     C**    Calculate override for sum of AP num COB +
     C**      price x nom posn COB on CPOSND
     C**
     C           ZZAPW     IFNE 0
      *                                                                   E32164
     C********** TVVL      IFEQ 'T'                                       S01117
     C           BVTVDV    IFEQ 'T'                                       S01117
     C           CSNT      MULT ZZAPW     ZZAPC
     C                     ELSE
     C           CSNV      MULT ZZAPW     ZZAPC
     C                     END
      *                                                                   E32164
     C                     ELSE
     C********** TVVL      IFEQ 'T'                                       S01117
     C           BVTVDV    IFEQ 'T'                                       S01117
     C                     Z-ADDCSPT      ZZAPC
     C                     ELSE
     C                     Z-ADDCSPV      ZZAPC
     C                     END
     C                     END
      *                                                                   E32164
     C                     END
     C**
     C**  Calculate average price from OLCAP
     C**
     C                     EXSR OLCAP
     C                     END
     C**
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT
0738 C*****************************************************************
     C**                                                              *
     C**   OLCAP  SR  Calculate average price                         *
     C**                                                              *
     C**   Called by  CSPRC                                           *
     C**   Calls  SR  none                                            *
     C**                                                              *
     C*****************************************************************
     C**
     C           OLCAP     BEGSR                           ** OLCAP  **
     C**
     C**  Calculate new NP = NP + sum nom purch - sum nom sales
     C**
     C           ZZPUR     ADD  ZZSAL     ZNNOMP
     C                     ADD  ZNOMP     ZNNOMP
     C**
     C** If NP & new NP both long -
     C**  AP = (AP num COB + AP num purch) / new NP
     C**
     C           ZNOMP     IFGT 0
     C           ZNNOMP    ANDGT0
      *                                                                   E32164
     C           ZNNOMP    IFEQ 0
     C                     Z-ADD0         BKPR
     C                     ELSE
     C***********ZZAPC     ADD  ZZAPP     WBKPR  150                      E34849
     C***********WBKPR     DIV  ZNNOMP    BKPR      H                     E34849
     C           ZNOMP     ADD  ZZSAL     NBKPR  150                      E34849
     C           ZZAPC     ADD  ZZAPS     WBKPR  150                      E34849
     C           WBKPR     DIV  NBKPR     BKPR      H                     E34849
     C                     END
      *                                                                   E32164
     C                     END
     C**
     C** If NP & new NP both short -
     C**  AP = (AP num COB + AP num sales) / new NP
     C**  (ensure price field is positive)
     C**
     C           ZNOMP     IFLT 0
     C           ZNNOMP    ANDLT0
      *                                                                   E32164
     C           ZNNOMP    IFEQ 0
     C                     Z-ADD0         BKPR
     C                     ELSE
     C***********ZZAPC     ADD  ZZAPS     WBKPR                           E34849
     C***********WBKPR     DIV  ZNNOMP    BKPR      H                     E34849
     C           ZNOMP     ADD  ZZPUR     NBKPR                           E34849
     C           ZZAPC     ADD  ZZAPP     WBKPR                           E34849
     C           WBKPR     DIV  NBKPR     BKPR      H                     E34849
     C           BKPR      IFLT 0
     C           BKPR      MULT -1        BKPR
     C                     END
     C                     END
      *                                                                   E32164
     C                     END
     C**
     C** If NP long or flat , new NP short -
     C**  AP = AP num sales / sum nom sales
     C**
     C           ZNOMP     IFGE 0
     C           ZNNOMP    ANDLT0
      *                                                                   E32164
     C           ZZPUR     IFEQ 0
     C                     Z-ADD0         BKPR
     C                     ELSE
     C           ZZAPP     DIV  ZZPUR     BKPR      H
     C                     END
      *                                                                   E32164
     C                     END
     C**
     C** If NP short or flat , new NP long -
     C**  AP = AP num purch / sum nom purch
     C**
     C           ZNOMP     IFLE 0
     C           ZNNOMP    ANDGT0
      *                                                                   E32164
     C           ZZSAL     IFEQ 0
     C                     Z-ADD0         BKPR
     C                     ELSE
     C           ZZAPS     DIV  ZZSAL     BKPR      H
     C                     END
      *                                                                   E32164
     C                     END
     C**
     C** If new NP flat -
     C**  AP = 0
     C**
     C           ZNNOMP    IFEQ 0
     C                     Z-ADD0         BKPR
     C                     END
     C*
     C* If price basis 'P', multiply by 100 to fetch true price           E19918
     C*                                                                   E19918
     C           SPBS      IFEQ 'P'                                       E19918
     C                     MULT 100       BKPR                            E19918
     C                     END                                            E19918
     C*
     C*
     C* REFORMAT BOOK PRICE FROM NOMINAL CURRENCY DECIMAL PLACES (AS IT
     C*  WAS CALCULATED FROM SUM AP NUMERATOR) TO A STRAIGHT 15/8 PRICE
     C*
     C***********5         ADD  CDP       XY      10                      E16825
     C***********5         ADD  XNMCDP    XY      10               E16825 E20327
     C           5         ADD  NMCDP     XY      10                      E20327
     C                     SUB  NMDP      XY
     C           BKPR      DIV  POWER8,XY BKPR
     C*
     C**If*price*basis*'P',*multiply*by*100*to*fetch*true*price********   E19918
     C***********                                                         E19918
     C***********SPBS      IFEQ 'P'                                       E19918
     C***********          MULT 100       BKPR                            E19918
     C***********          END                                            E19918
     C**
     C                     MOVE NMCDP     XNMCDP                          E16825
     C**
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT
0738 C*****************************************************************
     C**                                                              *
     C**   SUBFIL SR  Write details to Subfile                        *
     C**         - fills one line of the SFL depending on the setting *   E32164
     C**           of ZZTYPE                                          *   E32164
     C**                                                              *
     C**   Called by  PROCES                                          *
     C**   Calls  SR  RETSR,ZSEDIT,ZSDESC,CSPRC,ZPRCO,ZCONV,ZDAYS,    *
     C**              P001                                            *   S01496
     C**                                                              *
     C*****************************************************************
     C**
     C           SUBFIL    BEGSR                           ** SUBFIL **
     C**
     C*****ACCESS*TABTG10*FOR*nominal*CURRENCY                            E18658
     C*****ACCESS*TABTG10*FOR*PORTFOLIO*CURRENCY********************E18658S01117
     C***********                                                         S01117
     C**********           MOVEL'20      'TKEY   12                       S01117
     C***********          MOVELNMCY      ZWK4    4                       E18658
     C**********           MOVELC1PC      ZWK4    4                 E18658S01117
     C**********           MOVE 1         ZWK4                            S01117
     C**********           MOVE ZWK4      TKEY                            S01117
     C********** TKEY      CHAINTABTG10F             25                   S01117
     C**N25***** RECI      COMP 'D'                  2525                 S01117
     C********** *IN25     IFEQ '1'                                       S01117
      *                                                                   S01117
      ***  ACCESS SDCURRPD FOR PORTFOLIO CURRENCY                         S01117
      *                                                                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM BFPCYC    @KEYC   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C*
     C**  If no record found  or deleted record
     C**  then it is a database error so return to calling
     C**  program with a return code of '0'
     C*
     C           @RTCD     IFNE *BLANKS                                   S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVELPROGRM    DBPGM            ************
     C**********           MOVELTKEY      DBKEY            **DATABASE**   S01117
     C***********          MOVE 'TABLE'   DBFILE           **ERROR*05**   E20651
     C***********          Z-ADD05        DBASE            ************   E20651
     C**********           MOVE 'TABLE'   DBFILE        * ERROR 08 *E20651S01117
     C                     MOVELBFPCYC    DBKEY            ***************S01117
     C                     MOVEL'SDCURRPD'DBFILE           * DB ERROR 08 *S01117
     C                     Z-ADD08        DBASE            ***************E20651
     C                     SETON                       U7U8
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     MOVE '0'       RTNC
     C                     EXSR RETSR
     C                     END
     C**
     C***********          Z-ADDCDP       NMCDP                           E16825
     C**********           Z-ADDCDP       PFCDP                     E16825S01117
     C                     Z-ADDA6NBDP    PFCDP                           S01117
     C*
     C*****ACCESS*TABTG10*FOR*NOMINAL*CURRENCY********************* E16825S01117
     C***********                                                   E16825S01117
     C**********           MOVEL'20      'TKEY   12                 E16825S01117
     C**********           MOVELNMCY      ZWK4    4                 E16825S01117
     C**********           MOVE 1         ZWK4                      E16825S01117
     C**********           MOVE ZWK4      TKEY                      E16825S01117
     C********** TKEY      CHAINTABTG10F             25             E16825S01117
     C**N25******RECI      COMP 'D'                  2525           E16825S01117
     C********** *IN25     IFEQ '1'                                 E16825S01117
      *                                                                   S01117
      ***  ACCESS SDCURRPD FOR NOMINAL CURRENCY                           S01117
      *                                                                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM NMCY      @KEYC                           S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C*
     C**  IF NO RECORD FOUND OR DELETED RECORD                            E16825
     C**  THEN IT IS A DATABASE ERROR SO RETURN TO CALLING                E16825
     C**  PROGRAM WITH A RETURN CODE OF '0'                               E16825
     C*                                                                   E16825
     C           @RTCD     IFNE *BLANKS                                   S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVELPROGRM    DBPGM            ************   E16825
     C**********           MOVELTKEY      DBKEY         * DATABASE *E16825S01117
     C***********          MOVE 'TABLE'   DBFILE     **ERROR*05** E16825  E20651
     C***********          Z-ADD05        DBASE      ************ E16825  E20651
     C**********           MOVE 'TABLE'   DBFILE        * ERROR 09 *E20651S01117
     C                     MOVELNMCY      DBKEY            ***************S01117
     C                     MOVEL'SDCURRPD'DBFILE           * DB ERROR 09 *S01117
     C                     Z-ADD09        DBASE            ***************E20651
     C                     SETON                     U7U8                 E16825
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     MOVE '0'       RTNC                            E16825
     C                     EXSR RETSR                                     E16825
     C                     END                                            E16825
     C**                                                                  E16825
     C**********           Z-ADDCDP       NMCDP                     E16825S01117
     C**********           Z-ADDCDP       NCDP                      S01232S01117
     C                     Z-ADDA6NBDP    NMCDP                           S01117
     C                     Z-ADDA6NBDP    NCDP                            S01117
     C           *IN33     IFEQ '0'                                       E16825
     C                     MOVE NMCDP     XNMCDP                          E16825
     C                     SETON                     33                   E16825
     C                     END                                            E16825
      *                                                                   E32164
      *---------------------------------------------------------------*   E32164
      ***  ZZTYPE = 0 : Carried Forward Line.                         *   E32164
      *---------------------------------------------------------------*   E32164
      *                                                                   E32164
     C           ZZTYPE    IFEQ 0
     C                     SETON                     08
     C**                                                                  E16802
     C***84*****           Z-ADD0         CDP                       E16802S01117
     C   84                Z-ADD0         A6NBDP                          S01117
     C                     SETOF                     84                   E16802
     C           RECTYP    IFEQ 'D'                                       E34847
     C                     Z-ADDSVNMDP    NMDP                            E34847
     C                     ELSE                                           E34847
     C                     Z-ADDSNMDP     NMDP                            E16802
     C                     END                                            E34847
     C                     MOVE SSPBS     SPBS                            E16802
     C**
     C**   Format date,currency
     C**
     C                     MOVE RUNA      SRUNA
     C                     MOVE NMCY      SNMCY
     C**
     C**   Edit nominal
     C**
     C                     Z-ADDNMDP      ZDECS   10
     C                     MOVE 'L'       ZECODE
     C                     Z-ADDZZNOML    ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SCFNOM
     C**
     C**   Format price
     C**
     C                     EXSR CSPRC
     C           BKPR      IFLT *ZEROS
     C                     Z-SUBBKPR      BKPR
     C                     END
     C***********          MOVE BKPR      ZPRICE                          E14576
     C***********          Z-ADDRUND      ZFDATE                          E14576
     C***********          EXSR ZNCD                                      E14576
     C***********          EXSR ZPRCO                                     E14576
     C                     MOVE BKPR      ZPRICE                          E19918
     C                     Z-ADDRUND      ZFDATE                          E19918
     C                     Z-ADDRUND      ECD                             E19918
     C                     EXSR ZNCD                                      E19918
     C*                                                                   S01232
     C***    Set up data for Australian yield formula                     S01232
     C*                                                                   S01232
     C********** *IN52     IFEQ '1'                                S01232 E20783
     C           *IN53     IFEQ '1'                                       E20783
     C           ZZNOML    ANDNE0                                         S01232
     C                     Z-ADDLCPN      ZDCSDT                          S01232
     C                     Z-ADDRUND      ZDCEDT                          S01232
     C                     Z-ADDZZNOML    ZAMT                            S01232
     C                     Z-ADDNCDP      ZCDP                            S01117
AB   C                     EXSR ZACCZ                                     S01232
AB   C           ZDCINT    DIV  ZZNOML    WRKPI                           S01232
AB   C                     Z-ADDRUND      WRKD    50                      S01232
AB   C                     EXSR ZYCE                                      S01232
     C*                                                                   S01232
     C*  IF EX-COUPON THEN PI PASSED IS THE REMAINING INTEREST            S01232
     C*  TILL NCD AND IS NEGATIVE                                         S01232
     C*                                                                   S01232
     C           SCUMEX    IFEQ 'X'                                       S01232
     C                     Z-ADDLCPN      ZDCSDT                          S01232
     C                     Z-ADDNCD       ZDCEDT                          S01232
     C                     Z-ADDNCDP      ZCDP                            S01117
     C                     EXSR ZACCZ                                     S01232
     C           ZDCINT    DIV  ZZNOML    WKWPI  159                      S01232
     C           WRKPI     SUB  WKWPI     WRKPI                           S01232
     C                     END                                            S01232
      *                                                                   S01232
     C                     ELSE                                           S01232
     C                     Z-ADD0         WRKPI                           S01232
     C                     MOVE 'C'       SCUMEX                          S01232
     C                     END                                            S01232
     C                     Z-ADDZZNOML    ZNOML                           E39495
     C*                                                                   S01232
     C                     EXSR ZPRCO                                     E19918
     C/COPY WNCPYSRC,SE0220C005
     C                     Z-ADD8         ZDECS   10
     C                     MOVE 'L'       ZECODE
     C***********          MOVE BKPR      ZFLD15                          E19918
     C                     MOVE ZPRCOT    ZFLD15                          E19918
     C                     EXSR ZSEDIT
     C                     MOVE Z21L3     SCFPR
     C                     MOVE SBVI      CFBVI
      *
     C           SPBS      IFEQ 'P'
     C                     MOVE '%'       CFP
     C                     ELSE
     C                     MOVE ' '       CFP
     C                     END
     C**
     C**   Format book value
     C**
     C                     Z-ADD*ZEROS    WBVAL  150
     C                     Z-ADD*ZEROS    WBVAL0 150
     C                     Z-ADD*ZEROS    WBVAL1 151
     C                     Z-ADD*ZEROS    WBVAL2 152
     C                     Z-ADD*ZEROS    WBVAL3 153
     C                     MOVEA'0000'    *IN,55
     C           55        ADD  NMCDP     J       20
     C                     MOVEA'1'       *IN,J
     C*
     C*  Calculate consideration/reallowance/charges/commission
     C*
     C   55      ZZNOML    MULT BKPR      WBVAL0    H
     C   56      ZZNOML    MULT BKPR      WBVAL1    H
     C   57      ZZNOML    MULT BKPR      WBVAL2    H
     C   58      ZZNOML    MULT BKPR      WBVAL3    H
     C*
     C**Price*basis*-*divide*by*100************************************   E19918
     C***********                                                         E19918
     C***********SPBS      IFEQ 'P'                                       E19918
     C***55******          DIV  100       WBVAL0                          E19918
     C***56******          DIV  100       WBVAL1                          E19918
     C***57******          DIV  100       WBVAL2                          E19918
     C***58******          DIV  100       WBVAL3                          E19918
     C***********          END                                            E19918
     C*
     C   55                MOVE WBVAL0    WBVAL
     C   56                MOVE WBVAL1    WBVAL
     C   57                MOVE WBVAL2    WBVAL
     C   58                MOVE WBVAL3    WBVAL
     C*
     C*   Allow for nominal decimal places
     C*
     C           5         SUB  NMDP      DC      10
     C           WBVAL     MULT POWER8,DC BVAL   150                      E19918
     C*
     C           SPBS      IFEQ 'P'                                       E19918
     C           BVAL      DIV  100       BVAL      H                     E19918
     C                     END                                            E19918
     C                     Z-ADDNMCDP     ZDECS   10
     C                     MOVE 'L'       ZECODE
     C                     MOVE BVAL      ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    CFBVAL
     C**
     C                     MOVE CFLIN     SLINE
     C                     END
      *                                                                   E32164
      *---------------------------------------------------------------*   E32164
      ***  ZZTYPE = 1 : Security Details Line.                        *   E32164
      *---------------------------------------------------------------*   E32164
      *                                                                   E32164
     C           ZZTYPE    IFEQ 1
     C                     SETOF                     08
     C**
     C**   Format security short description
     C**
     C                     MOVE SESN      SSESN
     C                     MOVE NMCY      SNMCY
     C                     MOVE SRPN      ZSRPN
     C                     MOVE BVRIDF    ZRSFD                           S01117
     C                     EXSR ZSDESC
     C**
     C                     MOVE *BLANKS   SLINE
     C                     MOVELZRNME     SLINE
     C                     MOVE TDSS      SSESN
     C                     MOVE TDRF      STDRF
     C                     MOVE TCNR      STCNR                           E16063
     C/COPY WNCPYSRC,SE0220C017
     C                     END
      *                                                                   E32164
      *---------------------------------------------------------------*   E32164
      ***  ZZTYPE = 2 : Brought Forward Line.                         *   E32164
      *---------------------------------------------------------------*   E32164
      *                                                                   E32164
     C           ZZTYPE    IFEQ 2
     C                     SETON                     08
     C**
     C**   Format date,currency
     C**
     C           LSTCLE    IFNE *BLANKS
     C                     MOVE LSTCLE    BFDATE
     C                     ELSE
     C                     MOVE LSTCLR    BFDATE
     C                     END
     C                     MOVE NMCY      BFCUR
     C**
     C**   Edit nominal
     C**
     C***********          Z-ADDTNMD      ZDECS   10                      E14576
     C                     Z-ADDNMDP      ZDECS   10                      E14576
     C                     MOVE 'L'       ZECODE
     C***********          Z-ADDZZNOML    ZFLD15                          E14576
     C           ZZNOMB    ADD  ZZNOML    ZFLD15                          E14576
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SBFNOM
     C**
     C**   Format price
     C**
     C           ZZNOML    IFEQ 0
     C                     Z-ADD0         ZPRICE
     C                     Z-ADD0         ZPRCOT                          E21428
     C                     ELSE
      *                                                                   E32164
     C********** TVVL      IFEQ 'T'                                       S01117
     C           BVTVDV    IFEQ 'T'                                       S01117
     C           CSPT      DIV  ZZNOML    ZPRICE    H
     C                     ELSE
     C           CSPV      DIV  ZZNOML    ZPRICE    H
     C                     END
      *                                                                   E32164
     C                     END
     C                     ADD  ZZNOMB    ZZNOML                          E14576
     C*                                                                   E21428
     C           ZPRICE    IFNE 0                                         E21428
     C           SPBS      IFEQ 'U'                                       105586
     C           5         ADD  NMCDP     XY      10                      105586
     C                     SUB  NMDP      XY                              105586
     C           ZPRICE    DIV  POWER8,XY ZPRICE                          105586
     C                     END                                            105586
     C*                                                                   E21428
     C***    Set up data for Australian yield formula                     E21428
     C*                                                                   E21428
     C           *IN53     IFEQ '1'                                       E21428
     C           ZZNOML    ANDNE0                                         E21428
     C                     Z-ADDLCPN      ZDCSDT                          E21428
     C                     Z-ADDRUND      ZDCEDT                          E21428
     C                     Z-ADDZZNOML    ZAMT                            E21428
     C                     Z-ADDNCDP      ZCDP                            S01117
AB   C                     EXSR ZACCZ                                     E21428
AB   C           ZDCINT    DIV  ZZNOML    WRKPI                           E21428
AB   C                     Z-ADDRUND      WRKD    50                      E21428
AB   C                     EXSR ZYCE                                      E21428
     C*                                                                   E21428
     C*  IF EX-COUPON THEN PI PASSED IS THE REMAINING INTEREST            E21428
     C*  TILL NCD AND IS NEGATIVE                                         E21428
     C*                                                                   E21428
     C           SCUMEX    IFEQ 'X'                                       E21428
     C                     Z-ADDLCPN      ZDCSDT                          E21428
     C                     Z-ADDNCD       ZDCEDT                          E21428
     C                     Z-ADDNCDP      ZCDP                            S01117
     C                     EXSR ZACCZ                                     E21428
     C           ZDCINT    DIV  ZZNOML    WKWPI  159                      E21428
     C           WRKPI     SUB  WKWPI     WRKPI                           E21428
     C                     END                                            E21428
      *                                                                   E21428
     C                     ELSE                                           E21428
     C                     Z-ADD0         WRKPI                           E21428
     C                     MOVE 'C'       SCUMEX                          E21428
     C                     END                                            E21428
      *                                                                   E21428
     C***********          Z-ADDCSDA      ZFDATE                          E14576
     C***********          EXSR ZPRCO                                     E14576
     C                     Z-ADDCSDA      ZFDATE                          E21428
     C                     Z-ADDZZNOML    ZNOML                           E39495
     C                     EXSR ZPRCO                                     E21428
     C/COPY WNCPYSRC,SE0220C006
     C                     END                                            E21428
      *                                                                   E21428
     C                     Z-ADD8         ZDECS   10
     C                     MOVE 'L'       ZECODE
     C***********          MOVE ZPRCOT    ZFLD15                          E14576
     C***********          MOVE ZPRICE    ZFLD15                   E14576 E21428
     C                     MOVE ZPRCOT    ZFLD15                          E21428
     C                     EXSR ZSEDIT
     C                     MOVE Z21L3     SBFPR
      *                                                                   E32164
     C           SPBS      IFEQ 'P'
     C                     MOVE '%'       BFP
     C                     ELSE
     C                     MOVE ' '       BFP
     C                     END
     C**
     C**   Format B/V
     C** Access 1st price for sec,br,mkt=S,book,price type
     C**
     C                     MOVE ' '       SBVI
     C********** TVVL      IFEQ 'T'                                       S01117
     C           BVTVDV    IFEQ 'T'                                       S01117
     C                     MOVE 'CT'      PPRT
     C                     ELSE
     C                     MOVE 'CV'      PPRT
     C                     END
      *                                                                   E32164
     C***********KEYP      SETLLPRICS                    25               E14057
     C           KEYP      SETLLPRICR                    25               E14057
     C           *IN25     IFEQ '1'
     C***********KEYP      READEPRICS                    25               E14057
     C           KEYP      READEPRICR                    25               E14057
     C           *IN25     IFEQ '0'
     C*
     C** If price found & value date is less than CPOSH date
     C**  B/V ind is set to Y
     C*
     C           PVDT      IFLT CSDA
     C                     MOVE 'Y'       BFBVI
     C                     END
      *                                                                   E32164
     C                     END
     C                     END
     C**
     C**   Format book value
     C**
     C                     Z-ADD*ZEROS    WBVAL  150
     C                     Z-ADD*ZEROS    WBVAL0 150
     C                     Z-ADD*ZEROS    WBVAL1 151
     C                     Z-ADD*ZEROS    WBVAL2 152
     C                     Z-ADD*ZEROS    WBVAL3 153
     C                     MOVEA'0000'    *IN,55
     C           55        ADD  NMCDP     J       20
     C                     MOVEA'1'       *IN,J
     C*
     C*  Calculate consideration/reallowance/charges/commission
     C*
     C   55      ZZNOML    MULT ZPRICE    WBVAL0    H
     C   56      ZZNOML    MULT ZPRICE    WBVAL1    H
     C   57      ZZNOML    MULT ZPRICE    WBVAL2    H
     C   58      ZZNOML    MULT ZPRICE    WBVAL3    H
     C*
     C* Price basis - divide by 100
     C*
     C           SPBS      IFEQ 'P'
     C   55                DIV  100       WBVAL0
     C   56                DIV  100       WBVAL1
     C   57                DIV  100       WBVAL2
     C   58                DIV  100       WBVAL3
     C                     END
     C*
     C   55                MOVE WBVAL0    WBVAL
     C   56                MOVE WBVAL1    WBVAL
     C   57                MOVE WBVAL2    WBVAL
     C   58                MOVE WBVAL3    WBVAL
     C*
     C*   Allow for nominal decimal places
     C*
     C           5         SUB  NMDP      DC      10
     C           WBVAL     MULT POWER8,DC BVAL   150                      E19918
     C*
     C                     Z-ADDNMCDP     ZDECS   10
     C                     MOVE 'L'       ZECODE
     C                     MOVE BVAL      ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    BFBVAL
     C**
     C                     MOVE BFLIN     SLINE
     C                     END
      *                                                                   E32164
      *---------------------------------------------------------------*   E32164
      ***  ZZTYPE = 3 : Detail Line.                                  *   E32164
      *---------------------------------------------------------------*   E32164
      *                                                                   E32164
     C           ZZTYPE    IFEQ 3
     C                     SETOF                     08
     C**
     C**   Edit nominal
     C**
     C***********          Z-ADDTNMD      ZDECS   10                      E14576
     C                     Z-ADDNMDP      ZDECS   10                      E14576
     C                     MOVE 'L'       ZECODE
     C                     Z-ADDNOML      ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SNOML
     C**
     C**   Format value date
     C**   Format trade date
     C**   Format type
     C**   Format currency
     C**
     C                     MOVE *BLANKS   STYPE
      *                                                                   E32164
     C           *IN61     IFEQ '1'
     C           RECI      ANDNE'*'
     C           RECI      ANDNE'R'                                       S01269
     C           RECI      ANDNE'C'
      *                                                                   E32164
     C           *IN62     OREQ '1'
     C           RECI      ANDNE'*'
     C           RECI      ANDNE'R'                                       S01269
     C           RECI      ANDNE'C'
      *                                                                   CSE041
     C           *IN60     OREQ '1'                                       CSE041
      *                                                                   E32164
     C                     Z-ADDTDVD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    STDVD
     C                     Z-ADDTDDT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    STDDT
     C                     MOVE SETC      SSETC
      *                                                                   E32164
     C           TDTP      IFEQ 'TP'
     C                     MOVE 'PUR'     STYPE
     C                     ELSE
     C           TDTP      IFEQ 'TS'
     C                     MOVE 'SAL'     STYPE
     C                     ELSE                                           CSE041
     C           TDTP      IFEQ 'RV'                                      CSE041
     C           TDTP      OREQ 'DP'                                      CSE041
     C                     MOVELTDTP      STYPE                           CSE041
     C                     ENDIF                                          CSE041
     C                     END
      *                                                                   E32164
     C                     END
      *                                                                   E32164
     C                     ELSE
     C                     MOVE NMCY      SSETC
     C***********          MOVELDPMV      STYPE                           E32164
     C                     MOVELTDTP      STYPE                           E32164
      *                                                                   E32164
     C           *IN09     IFEQ '1'
     C                     Z-ADDTDDT      ZDAYNO
     C                     EXSR ZDATE2
     C**********           MOVE ZADATE    STDVD                                              BUG2507
     C                     MOVE ZADATE    STDDT
     C                     Z-ADDTDVD      ZDAYNO                                             BUG2507
     C                     EXSR ZDATE2                                                       BUG2507
     C                     MOVE ZADATE    STDVD                                              BUG2507
     C                     ELSE
     C                     Z-ADDTDDT      ZDAYNO                                             BUG2507
     C                     EXSR ZDATE2                                                       BUG2507
     C                     MOVE ZADATE    STDDT                                              BUG2507
     C                     Z-ADDTDVD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    STDVD
     C**********           MOVE ZADATE    STDDT                                              BUG2507
     C                     END
      *                                                                   E32164
     C                     END
     C**                                                                  S01496
     C           S01496    IFEQ 'Y'                                       S01496
     C                     EXSR P001                                      S01496
     C                     END                                            S01496
     C**
     C**   Format price
      *                                                                   E32164
     C           *IN61     IFEQ '1'
     C           RECI      ANDNE'*'
     C           RECI      ANDNE'C'
     C           RECI      ANDNE'R'                                       S01269
      *                                                                   E32164
     C           *IN62     OREQ '1'
     C           RECI      ANDNE'*'
     C           RECI      ANDNE'C'
     C           RECI      ANDNE'R'                                       S01269
     C*
     C**OBTAIN*DECIMAL*PLACES*FOR*CURRENCY*INPUT***********************   E21002
     C***********                                                         E21002
     C***********          MOVEL'20      'TKEY   12                       E21002
     C***********                                                         E21002
     C**USE*TRADE*FILE*TRADE*NOMINAL*CURRENCY*FIELD*TNMC***************   E21002
     C***********                                                         E21002
     C***********          MOVELTNMC      ZWK4    4                       E21002
     C***********          MOVE 1         ZWK4                            E21002
     C***********          MOVE ZWK4      TKEY                            E21002
     C***********TKEY      CHAINTABTG10F             90                   E21002
     C**N90******RECI      COMP 'D'                  9090                 E21002
     C************IN90     IFEQ '1'                                       E21002
     C***********          MOVELPROGRM    DBPGM            ************   E21002
     C***********          MOVELTKEY      DBKEY            * DATABASE *   E21002
     C***********          MOVE 'TABLE'   DBFILE           * ERROR 06 *   E21002
     C***********          Z-ADD06        DBASE            ************   E21002
     C***********          SETON                       U7U8               E21002
     C***********          GOTO EAUDIT                                    E21002
     C***********          END                                            E21002
     C***********          Z-ADDCDP       ZCDP                            E21002
     C***********                                                         E21002
     C**DECIMAL*PLACES*-*Z-ADD*TO*ZCDP*FOR*ZCONPR*SUBROUTINE***********   E21002
     C***********                                                         E21002
     C***********          EXSR ZCONPR                                    E21002
     C***********          MOVE ZCONP     ZPRICE                          E21002
     C***********          Z-ADDTDVD      ZFDATE                          E21002
     C***********          EXSR ZNCD                                      E21002
     C***********          EXSR ZPRCO                                     E21002
     C***********                                                         E21002
     C**OBTAIN*DECIMAL*PLACES*FOR*CURRENCY*INPUT****************** E21002 S01117
     C***********                                                  E21002 S01117
     C**********           MOVEL'20      'TKEY   12                E21002 S01117
     C***********                                                  E21002 S01117
     C**USE*TRADE*FILE*TRADE*NOMINAL*CURRENCY*FIELD*TNMC********** E21002 S01117
     C***********                                                  E21002 S01117
     C**********           MOVELTNMC      ZWK4    4                E21002 S01117
     C**********           MOVE 1         ZWK4                     E21002 S01117
     C**********           MOVE ZWK4      TKEY                     E21002 S01117
     C********** TKEY      CHAINTABTG10F             90            E21002 S01117
      *                                                                   S01117
      ***  Obtain Decimal Places for Currency Input.                      S01117
      *                                                                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM TNMC      @KEYC                           S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C**N90***** RECI      COMP 'D'                  9090           E21002S01117
     C********** *IN90     IFEQ '1'                                 E21002S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVELPROGRM    DBPGM                           E21002
     C**********           MOVELTKEY      DBKEY      ***************E21002S01117
     C**********           MOVE 'TABLE'   DBFILE     * DB ERROR 06 *E21002S01117
     C                     MOVELTNMC      DBKEY            ***************S01117
     C                     MOVEL'SDCURRPD'DBFILE           * DB ERROR 06 *S01117
     C                     Z-ADD06        DBASE            ***************E21002
     C                     SETON                       U7U8               E21002
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO EAUDIT                                    E21002
     C                     END                                            E21002
     C*                                                                   E21002
     C*  Calculate contract price
     C*
     C                     Z-ADDA6NBDP    ZCDP                            S01117
     C                     EXSR ZCSCTP                                    E21002
      *                                                                   E31763
      ***  If the Contract Price returned from SR/ZCSCTP is the same as   E31763
      ***  the Trade Price then use the Price/Discount/Yield from the     E31763
      ***  Trade, rather than converting the Price back to its original   E31763
      ***  form, which may introduce rounding errors.                     E31763
      *                                                                   E31763
     C           ZCONP     IFEQ PRIC                                      E31763
     C                     Z-ADDTPDY      ZPRCOT                          E31763
     C                     ELSE                                           E31763
     C                     Z-ADDZCONP     ZPRICE                          E21002
     C                     Z-ADDTDVD      ZFDATE                          E21002
     C                     Z-ADDTDVD      ECD                             E21002
     C                     Z-ADDNOML      ZNOML                           E39495
     C                     EXSR ZPRCO                                     E21002
     C/COPY WNCPYSRC,SE0220C007
     C                     END                                            E31763
      *                                                                   E31763
     C                     Z-ADD8         ZDECS   10
     C                     MOVE 'L'       ZECODE
     C***********          MOVE PRIC      ZFLD15                          E19918
     C*************        MOVE TPDY      ZFLD15                   E19918 E21002
     C                     MOVE ZPRCOT    ZFLD15                          E21002
     C                     EXSR ZSEDIT
     C                     MOVE Z21L3     SDTPR
     C                     ELSE
     C                     Z-ADD8         ZDECS   10
     C                     MOVE 'L'       ZECODE
     C***********          MOVE MKTP      ZFLD15                          E32164
     C                     MOVE PRIC      ZFLD15                          E32164
     C                     EXSR ZSEDIT
     C                     MOVE Z21L3     SDTPR
     C                     END
      *                                                                   E32164
     C           SPBS      IFEQ 'P'
     C                     MOVE '%'       DTP
     C                     ELSE
     C                     MOVE ' '       DTP
     C                     END
     C**                                                                  E16802
     C** MOVE DETAIL FIELDS INTO WORK FIELDS TO EDIT C/F                  E16802
     C** BALANCE                                                          E16802
     C**                                                                  E16802
     C   63                                                               E16802
     COR 62                                                               E16825
     COR 64      NMCY      LOKUPARR                      84               E16802
     C                     Z-ADDTNMD      SNMDP   10                      E16802
     C                     Z-ADDNMDP      SVNMDP  10                      E34847
     C           *IN63     IFEQ '1'                                       E34847
     C           *IN64     OREQ '1'                                       E34847
     C                     MOVEL'D'       RECTYP  1                       E34847
     C                     END                                            E34847
     C                     MOVE SPBS      SSPBS   1                       E16802
     C**
     C**   Format countervalue
     C**
     C           *IN61     IFEQ '1'
     C           RECI      ANDNE'*'
     C           RECI      ANDNE'C'
     C           RECI      ANDNE'R'                                       S01269
      *                                                                   E32164
     C           *IN62     OREQ '1'
     C           RECI      ANDNE'*'
     C           RECI      ANDNE'C'
     C           RECI      ANDNE'R'                                       S01269
      *                                                                   CSE041
     C           *IN60     OREQ '1'                                       CSE041
      *                                                                   CSE041
     C           *IN60     IFEQ '0'                                       CSE041
      *                                                                   E32164
     C                     MOVE TCTR      ZAMTCI
     C                     Z-ADDTDER      ZEXCH
     C                     MOVE TMDI      ZMD
     C                     MOVE TNMC      ZCCYI
     C                     MOVE SETC      ZCCYO
     C                     MOVELA6NBDP    ZCDPI                           S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR ' @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SETC      @KEYC                           S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C                     MOVELA6NBDP    ZCDPO                           S01117
     C                     EXSR ZCONV
      *                                                                   E32164
     C           *INU7     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVELPROGRM    DBPGM
     C**********           MOVELTKEY      DBKEY            ***************S01117
     C**********           MOVE 'TABLE'   DBFILE           * DB ERROR 07 *S01117
     C                     MOVELTNMC      DBKEY            ***************S01117
     C                     MOVE SETC      DBKEY            ***************S01117
     C                     MOVEL'SDCURRPD'DBFILE           * DB ERROR 07 *S01117
     C                     Z-ADD07        DBASE            ***************
     C                     SETON                       U7U8
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     MOVE '0'       RTNC
     C                     EXSR RETSR
     C                     END
      *                                                                   E32164
     C**********           Z-ADDCDP       ZDECS   10                      S01117
     C                     Z-ADDA6NBDP    ZDECS   10                      S01117
     C                     MOVE 'L'       ZECODE
     C                     MOVE ZAMTCO    ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    STCTR
      *                                                                   CSE041
      ** DVP/RVP movements                                                CSE041
     C                     ELSE                                           CSE041
     C                     CALL 'AOCURRR0'                                CSE041
     C                     PARM '*DBERR ' @RTCD                           CSE041
     C                     PARM '*KEY   ' @OPTN                           CSE041
     C                     PARM SETC      @KEYC                           CSE041
     C           SDCURR    PARM SDCURR    DSSDY                           CSE041
      *                                                                   CSE041
     C           @RTCD     IFNE *BLANKS                                   CSE041
     C           *LOCK     IN   LDA                                       CSE041
     C                     MOVELPROGRM    DBPGM                           CSE041
     C                     MOVELSETC      DBKEY            ***************CSE041
     C                     MOVEL'SDCURRPD'DBFILE           * DB ERROR 13 *CSE041
     C                     Z-ADD13        DBASE            ***************CSE041
     C                     SETON                       U7U8               CSE041
     C                     OUT  LDA                                       CSE041
     C                     EXSR *PSSR                                     CSE041
     C                     MOVE '0'       RTNC                            CSE041
     C                     EXSR RETSR                                     CSE041
     C                     ENDIF                                          CSE041
      *                                                                   CSE041
     C                     Z-ADDA6NBDP    ZDECS   10                      CSE041
     C                     MOVE 'L'       ZECODE                          CSE041
     C                     MOVE DVSCVL    ZFLD15                          CSE041
     C                     EXSR ZSEDIT                                    CSE041
     C                     MOVE ZOUT21    STCTR                           CSE041
     C                     ENDIF                                          CSE041
     C                     ELSE
     C*
     C***********          Z-ADD*ZEROS    WBVAL  150                      E21480
     C***********          Z-ADD*ZEROS    WBVAL0 150                      E21480
     C***********          Z-ADD*ZEROS    WBVAL1 151                      E21480
     C***********          Z-ADD*ZEROS    WBVAL2 152                      E21480
     C***********          Z-ADD*ZEROS    WBVAL3 153                      E21480
     C***********          MOVEA'0000'    *IN,55                          E21480
     C***********55        ADD  NMCDP     J       20                      E21480
     C***********          MOVEA'1'       *IN,J                           E21480
     C***********                                                         S01158
     C***Calculate*consideration/reallowance/charges/commission********   S01158
     C***********                                                         S01158
     C***********MKTP      IFEQ *ZEROS                                    S01158
     C***55******          Z-ADDNOML      WBVAL0                          S01158
     C***56******          Z-ADDNOML      WBVAL1                          S01158
     C***57******          Z-ADDNOML      WBVAL2                          S01158
     C***58******          Z-ADDNOML      WBVAL3                          S01158
     C***********          ELSE                                           S01158
     C***55******NOML      MULT MKTP      WBVAL0    H                     E21480
     C***56******NOML      MULT MKTP      WBVAL1    H                     E21480
     C***57******NOML      MULT MKTP      WBVAL2    H                     E21480
     C***58******NOML      MULT MKTP      WBVAL3    H                     E21480
     C***********                                                         E21480
     C**Price*basis*-*divide*by*100************************************   E21480
     C***********                                                         E21480
     C***********SPBS      IFEQ 'P'                                       E21480
     C***55******          DIV  100       WBVAL0                          E21480
     C***56******          DIV  100       WBVAL1                          E21480
     C***57******          DIV  100       WBVAL2                          E21480
     C***58******          DIV  100       WBVAL3                          E21480
     C***********          END                                            E21480
     C***********                                                         S01158
     C***********          END                                            S01158
     C***********                                                         S01158
     C***55******          MOVE WBVAL0    WNOML                           E21480
     C***56******          MOVE WBVAL1    WNOML                           E21480
     C***57******          MOVE WBVAL2    WNOML                           E21480
     C***58******          MOVE WBVAL3    WNOML                           E21480
     C***********                                                         E21480
     C****Allow*for*nominal*decimal*places*****************************   E21480
     C***********                                                         E21480
     C***********5         SUB  NMDP      DC                              E21480
     C***********WNOML     MULT POWER8,DC WNOML                           E21480
      *                                                                   E21480
     C***********          Z-ADDMKTP      ZPRCIN                   E21480 E32164
     C                     Z-ADDPRIC      ZPRCIN                          E32164
     C                     Z-ADDTDVD      ZFDATE                          E21480
     C                     Z-ADDNOML      ZNOML                           E21480
     C*                                                                   E21480
     C***   Set up parameters for Australian Yields mod                   E21480
     C*                                                                   E21480
     C           STBS      IFEQ 'Y'                                       E21480
     C           SYBS      ANDEQ'AU'                                      E21480
     C                     Z-ADDTDVD      ZECD                            E21480
     C                     EXSR ZLCD                                      E21480
     C                     Z-ADDTDVD      ECD                             E21480
     C                     EXSR ZNCD                                      E21480
     C                     Z-ADDZZLCD     ZDCSDT                          E21480
     C                     Z-ADDTDVD      ZDCEDT                          E21480
     C                     Z-ADDZNOML     ZAMT                            E21480
     C                     Z-ADDNCDP      ZCDP                            S01117
     C                     EXSR ZACCZ                                     E21480
     C                     Z-ADDTDVD      WRKD    50                      E21480
     C           ZDCINT    DIV  ZNOML     WRKPI                           E21480
     C                     EXSR ZYCE                                      E21480
     C*                                                                   E21480
     C*  IF EX-COUPON THEN PI PASSED IS THE REMAINING INTEREST            E21480
     C*  TILL NCD AND IS NEGATIVE                                         E21480
     C*                                                                   E21480
     C           SCUMEX    IFEQ 'X'                                       E21480
     C                     Z-ADDZZLCD     ZDCSDT                          E21480
     C                     Z-ADDNCD       ZDCEDT                          E21480
     C                     Z-ADDNCDP      ZCDP                            S01117
     C                     EXSR ZACCZ                                     E21480
     C           ZDCINT    DIV  ZNOML     WKWPI  159                      E21480
     C           WRKPI     SUB  WKWPI     WRKPI                           E21480
     C                     END                                            E21480
      *                                                                   E21480
     C                     ELSE                                           E21480
     C                     MOVE 'C'       SCUMEX  1                       E21480
     C                     Z-ADD0         WRKPI                           E21480
     C                     END                                            E21480
     C*                                                                   E21480
     C                     EXSR ZPRCI                                     E21480
     C/COPY WNCPYSRC,SE0220C008
      *
      ** ADJUST NUMBER OF DECIMAL PLACES FOR PRICE                                            CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
      ** ADJUST PRICE : PRICE + PUR INT BEFORE ROUNDING                                       CSE035
      *                                                                                       CSE035
     C           NCD       IFGE MATY                                                          CSE035
     C           SYBS      ANDEQ'AU'                                                          CSE035
     C                     Z-ADDZPRCOT    ZPRCOT                                              CSE035
     C                     ELSE                                                               CSE035
     C           SYBS      IFNE 'AU'                                                          CSE035
     C           SYBS      ANDNE'DA'                                                          CSE035
     C           STBS      ANDEQ'Y'                                                           CSE035
     C           ZPRCOT    ADD  ZWAMT     ZPRCOT                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
     C           NCD       IFGE MATY                                                          CSE035
     C           SYBS      ANDEQ'AU'                                                          CSE035
     C                     ELSE                                                               CSE035
      *                                                                                       CSE035
     C           SYBS      IFNE 'AU'                                                          CSE035
     C           SYBS      ANDNE'DA'                                                          CSE035
     C           STBS      ANDEQ'Y'                                                           CSE035
     C           ZPRCOT    SUB  PURINT    ZPRCOT                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
      *
     C                     Z-ADDZPRCOT    ZPRC                            E21480
     C                     Z-ADDNCDP      ZCDP                            S01117
     C                     EXSR ZCNSD                                     E21480
     C                     Z-ADDZCONS     WNOML                           E21480
     C                     Z-ADDNMCDP     ZDECS   10
     C                     MOVE 'L'       ZECODE
     C                     MOVE WNOML     ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    STCTR
     C                     END
     C**
     C                     MOVE DETLN     SLINE
     C                     MOVE TDSS      SSESN
     C                     MOVE TDRF      STDRF
     C                     MOVE TCNR      STCNR                           E16063
     C                     END
      *                                                                   E32164
      *---------------------------------------------------------------*   E32164
     C**
     C**   And output details to subfile
     C**
     C                     ADD  1         SFLREC
     C                     ADD  1         OUTREC
     C                     WRITESE0220S0
     C**
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C**                                                              *
     C**   LINK   SR  Lower level Enquiry requested                   *
     C**                                                              *
     C**   Called by  MAIN                                            *
     C**   Calls  SR  none                                            *
     C**   Calls PGM  lower level enquiry obtained from SECOND        *
     C**                                                              *
     C*****************************************************************
     C**
0740 C           LINK      BEGSR                           *** LINK ******
0741 C**
     C**   Access Linked Enquiry Control File for program and option
     C**
     C           LKEY      KLIST
     C                     KFLD           PGMNO
     C                     KFLD           OPTN
     C**
     C           LKEY      CHAINSECONDF              42
     C**
     C**   If record not found then entered option is invalid
     C**
     C           *IN42     IFEQ '1'
     C           OPTN      ANDNE' 4'                                      CSE039
     C           CSE041    IFEQ 'N'                                       CSE041
     C           CSE039    ANDEQ'N'                                       CSE039
     C                     MOVE MSG,4     ERMSG
     C                     ELSE                                           CSE041
     C           CSE039    IFEQ 'Y'                                       CSE039
     C                     MOVE MSG,19    ERMSG                           CSE039
     C                     ELSE                                           CSE039
     C                     MOVE MSG,18    ERMSG                           CSE041
     C                     ENDIF                                          CSE039
     C                     ENDIF                                          CSE041
     C**
     C                     ELSE
     C**
     C**   For valid option write out LDA and linked enquiry data area
     C**   and call the program name obtained from SECOND
     C**
     C                     OUT  SESDS
     C**********           OUT  LDA                                       S01117
      *                                                                   CSE041
      ** If option 2 and it is a Depot or DVP/RVP movement, call its      CSE041
      ** respective APIs.                                                 CSE041
      *                                                                   CSE041
     C           OPTN      IFEQ ' 2'                                      CSE041
     C           TESTP     ANDEQ'WI'                                      CSE041
     C           OPTN      OREQ ' 2'                                      CSE041
     C           TESTP     ANDEQ'WO'                                      CSE041
     C           OPTN      OREQ ' 2'                                      CSE041
     C           TESTP     ANDEQ'RV'                                      CSE041
     C           OPTN      OREQ ' 2'                                      CSE041
     C           TESTP     ANDEQ'DP'                                      CSE041
      *                                                                   CSE041
     C           TESTP     IFEQ 'WI'                                      CSE041
     C           TESTP     OREQ 'WO'                                      CSE041
     C                     MOVE *BLANKS   INTRNO                          CSE041
     C                     MOVE STDRF     INTRNO  6                       CSE041
     C                     CALL DPPGM                                     CSE041
     C                     PARM TESTP     @TYPE   2                       CSE041
     C                     PARM           @SETY  10                       CSE041
     C                     PARM INTRNO    @TRNO   6                       CSE041
     C                     PARM           @RTCD   7                       CSE041
     C                     PARM 'SE0220'  @CALL  10                       CSE041
     C           @RTCD     IFEQ 'Y2U9999'                                 CSE041
     C                     MOVE *ON       *IN01                           CSE041
     C                     ENDIF                                          CSE041
     C                     ELSE                                           CSE041
     C           TESTP     IFEQ 'RV'                                      CSE041
     C           TESTP     OREQ 'DP'                                      CSE041
     C                     ENDIF                                          CSE041
     C                     ENDIF                                          CSE041
      *                                                                   CSE041
     C                     ELSE                                           CSE041
      *                                                                   CSE039
     C           OPTN      IFEQ ' 4'                                      CSE039
      *                                                                   CSE039
     C           CSE039    IFEQ 'Y'                                                         BUG11813
     C                     MOVE *OFF      *IN42                           CSE039
     C                     SELEC                                          CSE039
     C           TESTP     WHEQ 'WI'                                      CSE039
     C           TESTP     OREQ 'WO'                                      CSE039
     C                     MOVEL'W'       OPTYPE  1                       CSE039
     C           TESTP     WHEQ 'RV'                                      CSE039
     C           TESTP     OREQ 'DP'                                      CSE039
     C                     MOVEL'D'       OPTYPE                          CSE039
     C                     OTHER                                          CSE039
     C                     MOVEL'T'       OPTYPE                          CSE039
     C                     ENDSL                                          CSE039
     C                     MOVE *BLANKS   INTRNO                          CSE039
     C                     MOVE STDRF     INTRNO                          CSE039
     C                     CALL 'SEC025'                                  CSE039
     C                     PARM MVPGM     PPROG  10                       CSE039
     C                     PARM INTRNO    PTRNO   6                       CSE039
     C                     PARM OPTYPE    PTTYP   1                       CSE039
     C                     PARM 'E'       PMODE   1                       CSE039
     C                     PARM           PEXIT   1                       CSE039
     C                     PARM           PPREV   1                       CSE039
     C           PEXIT     IFEQ '1'                                       CSE039
     C                     MOVE *ON       *IN01                           CSE039
     C                     ENDIF                                          CSE039
     C                     ELSE                                                             BUG11813
     C                     MOVE MSG,18    ERMSG                                             BUG11813
     C                     ENDIF                                                            BUG11813
     C                     ELSE                                           CSE039
      *                                                                   CSE039
     C                     CALL TPGM
     C                     ENDIF                                          CSE039
     C                     ENDIF                                          CSE041
      *                                                                   CSE041
     C********** *LOCK     IN   LDA                                       S01117
     C           *LOCK     IN   SESDS
     C**
     C**   On return from lower level check return code
     C**
     C**   If 0 (Database Error) or 1 (F3 to return to menu)
     C**      then exit to calling program
     C**
     C           RTNC      IFEQ '0'
     C           RTNC      OREQ '1'
     C                     MOVE '1'       *IN01
     C                     END
     C**
     C**   If Return code is 7 (F9 to return to inital enquiry)
     C**      then check if this is the inital enquiry
     C**      and if not return to calling program
     C**
     C           RTNC      IFEQ '7'
     C           ORIG      ANDNEPGMNO
     C                     MOVE '1'       *IN01
     C                     END
     C**
     C                     END
     C**
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT
0738 C*****************************************************************
     C**                                                              *
     C**   RETSR  SR  End of Program Processing                       *
     C**              Write out LDA and linked enquiry data area      *
     C**              and return to the calling program               *
     C**                                                              *
     C**   Called by  MAIN, FIRST, DISP                               *
     C**   Calls  SR  none                                            *
     C**                                                              *
     C*****************************************************************
     C**
0740 C           RETSR     BEGSR                           *** RETSR   ***
0741 C**
     C                     OUT  SESDS
     C**********           OUT  LDA                                       S01117
     C**
0742 C                     SETON                     LR
0743 C                     RETRN
0744 C*
0745 C                     ENDSR
0744 C*
     C*****************************************************************
      /EJECT
     C********************************************************************S01117
     C*                                                                   S01117
     C* *PSSR - SUBROUTINE TO HANDLE ABNORMAL ERROR CONDITIONS            S01117
     C*                                                                   S01117
     C* CALLED FROM : AFTER ABNORMAL OPERATION OCCURS                     S01117
     C*                                                                   S01117
     C* CALLS : NOTHING                                                   S01117
     C*                                                                   S01117
     C*****************************************************************   S01117
     C*                                                                   S01117
     C           *PSSR     BEGSR                                          S01117
     C*                                                                   S01117
     C           @RUN      IFEQ *BLANK                                    S01117
     C                     MOVEL'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
      *                                                                   S01117
     C                     ELSE                                           S01117
0742 C                     SETON                     U7U8LR               S01117
0743 C                     RETRN                                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C*                                                                   S01117
     C*****************************************************************   S01117
      /EJECT                                                              S01117
     C*****************************************************************
     C**                                                              *
     C**   FIRST  SR  First Cycle Processing                          *
     C**                                                              *
     C**   Called by  MAIN                                            *
     C**   Calls  SR  RETSR, CUSSEC, ZSYSTM, ZICD2, ZICDSE, ZEVCD     *
     C**                                                              *
     C*****************************************************************
     C**
     C           FIRST     BEGSR                           ** FIRST **
     C**
     C**     Access the LDA  and  Linked Enquiry Data Area
     C**
     C********** *LOCK     IN   LDA                                       S01117
     C           *LOCK     IN   SESDS
     C                     IN   JNSTAT
     C                     IN   RUNDT                                     S01117
     C                     IN   ZMUSER                                    S01117
     C                     UNLCKJNSTAT
     C                     SETON                     51
     C*
     C****READ*INSTALLATION*CONTROL*RECORD*1*FOR*RUNDATE***************   S01117
     C***********                                                         S01117
     C***********          EXSR ZSYSTM                                    S01117
     C**********                                                          S01117
     C*****If*no*record*found**or*deleted*record***********************   S01117
     C*****then*it*is*a*database*error*so*return*to*calling************   S01117
     C*****program*with*a*return*code*of*'0'***************************   S01117
     C**********                                                          S01117
     C********** *IN99     IFEQ '1'                                       S01117
     C**********           MOVELPROGRM    DBPGM                           S01117
     C**********           MOVEL'ICDR1'   DBKEY            ***************S01117
     C**********           MOVE 'TABLE'   DBFILE           * DB ERROR 01 *S01117
     C**********           Z-ADD01        DBASE            ***************S01117
     C**********           SETON                       U7U8               S01117
     C**********           MOVE '0'       RTNC                            S01117
     C**********           EXSR RETSR                                     S01117
     C**********           END                                            S01117
      *                                                                   E32164
      ***  None of the fields from the Bank Details are required.         E32164
      *                                                                   E32164
      ***********                                                  S01117 E32164
      ***Access*Bank*Details*for*Date*of*Next*Working*day*for*ZEVCDS01117 E32164
      ***********                                                  S01117 E32164
     C***********          CALL 'AOBANKR0'                         S01117 E32164
     C***********          PARM '*DBERR ' @RTCD                    S01117 E32164
     C***********          PARM '*FIRST ' @OPTN                    S01117 E32164
     C***********SDBANK    PARM SDBANK    DSFDY                    S01117 E32164
     C***********                                                         E32164
     C****READ*INSTALLATION*CONTROL*RECORD*2*FOR*mbin******************   S01117
     C***********                                                         S01117
     C**********           EXSR ZICD2                                     S01117
     C**********                                                          S01117
     C****If*no*record*found**or*deleted*record************************   S01117
     C****then*it*is*a*database*error*so*return*to*calling*************   S01117
     C****program*with*a*return*code*of*'0'****************************   S01117
     C**********                                                          S01117
     C********** *IN99     IFEQ '1'                                       S01117
     C**********           MOVELPROGRM    DBPGM                           S01117
     C**********           MOVEL'ICDR2'   DBKEY            ***************S01117
     C**********           MOVE 'TABLE'   DBFILE           * DB ERROR 02 *S01117
     C**********           Z-ADD02        DBASE            ***************S01117
     C**********           SETON                       U7U8               S01117
     C**********           MOVE '0'       RTNC                            S01117
     C**********           EXSR RETSR                                     S01117
     C**********           END                                            S01117
     C***********                                                  S01117 E32164
      *                                                                   E32164
      ***  None of the fields from the General Ledger are required.       E32164
      *                                                                   E32164
     C***ACCESS*GENERAL*LEDGER*DETAILS**************************** S01117 E32164
     C***FOR*ACCRUALS/PROFIT*DATE*FOR*SUBROUTINE*ZEVCD************ S01117 E32164
      ***********                                                  S01117 E32164
     C***********          CALL 'AOGELRR0'                         S01117 E32164
     C***********          PARM '*DBERR ' @RTCD                    S01117 E32164
     C***********          PARM '*FIRST ' @OPTN                    S01117 E32164
     C***********SDGELR    PARM SDGELR    DSFDY                    S01117 E32164
      *                                                                   E32164
      ***  Note: DATF and MBIN actually come from RUNDAT.                 E32164
      *                                                                   E32164
     C           DATF      COMP 'M'                      98               S01117
     C**
     C           MBIN      IFEQ 'Y'
     C                     MOVE '1'       *IN07
     C                     END
     C**
     C****CALL*ZEVCD*-*TO*GET*EVENT*CONTROL*DATE*FOR*ZNCD**************   E14576
     C***********                                                         E14576
     C***********          EXSR ZEVCD                                     E14576
     C***********                                                         S01117
     C****READ*INSTALLATION*CONTROL*RECORD*SE**************************   S01117
     C***********                                                         S01117
     C***********          EXSR ZICDSE                                    S01117
     C**********                                                          S01117
     C****If*no*record*found**or*deleted*record************************   S01117
     C****then*it*is*a*database*error*so*return*to*calling*************   S01117
     C****program*with*a*return*code*of*'0'****************************   S01117
     C**********                                                          S01117
     C********** *IN99     IFEQ '1'                                       S01117
     C**********           MOVELPROGRM    DBPGM                           S01117
     C**********           MOVEL'ICDSE'   DBKEY            ***************S01117
     C**********           MOVE 'TABLE'   DBFILE           * DB ERROR 03 *S01117
     C**********           Z-ADD03        DBASE            ***************S01117
     C**********           SETON                       U7U8               S01117
     C**********           MOVE '0'       RTNC                            S01117
     C**********           EXSR RETSR                                     S01117
     C**********           END                                            S01117
      *                                                                   S01117
      ***  Access Securities Trading Detail File.                         S01117
      *                                                                   S01117
     C                     CALL 'AOSTRDR0'                                S01117
     C                     PARM '*DBERR ' @RTCD                           S01117
     C                     PARM '*FIRST ' @OPTN                           S01117
     C***********SDSTRD    PARM SDSTRD    DSFDY                     S01117S01496
     C           SDSTRD    PARM SDSTRD    DSSDY                           S01496
      *                                                                   E32164
      ***  Set indicator to show whether Trade or Value Valuations.       E32164
      *                                                                   E32164
     C                     SETOF                     09
     C********** TVVL      IFEQ 'T'                                       S01117
     C           BVTVDV    IFEQ 'T'                                       S01117
     C                     SETON                     09
     C                     END
     C**
     C**     Calculate month/year - no. months prior to rundate
     C**     - convert rundate to ddmmyy then add on no. months
     C**
     C                     Z-ADDRUND      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DAYWK
      *                                                                   E32164
     C           *IN98     IFEQ '1'
     C                     MOVE DD        MM
     C                     END
      *                                                                   E32164
     C********** MM        SUB  RTST      MMWK    20                      S01117
     C           MM        SUB  BVROST    MMWK    20                      S01117
      *                                                                   E32164
     C           MMWK      IFLE 0
     C           YY        SUB  1         ZZYR
     C           MMWK      ADD  12        ZZMNTH
     C                     ELSE
     C                     Z-ADDMMWK      ZZMNTH
     C                     Z-ADDYY        ZZYR
     C                     END
     C**
     C**     Calculate ddmmmyy date of last calendar day of month prior
     C***    to run date (LSTCLR)
     C**     Convert run date to ddmmyy or equivalent
     C**     Set dd to 01, then convert to day no
     C**     Subtract 1 from date (=last day in prev month) &
     C**     convert this date to ddmmmyy
     C**
     C/COPY WNCPYSRC,SE0220C014
     C                     Z-ADDRUND      ZDAYNO
     C/COPY WNCPYSRC,SE0220C015
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DAYWK
      *                                                                   E32164
     C           *IN98     IFEQ '1'
     C                     Z-ADD1         MM
     C                     ELSE
     C                     Z-ADD1         DD
     C                     END
      *                                                                   E32164
     C                     MOVELDAYWK     ZDATE
     C                     EXSR ZDATE1
     C                     SUB  1         ZDAYNO
     C                     Z-ADDZDAYNO    LSTCDR  50
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    LSTCLR  7
     C**
     C**     If no cust. number etc found in request data
     C**        setup a blank screen for display
     C**     else access details for display
     C**
     C                     MOVE '1'       *IN03
     C**
     C********** RQCUST    IFNE *ZEROS                                                        CSD027
     C           RQCUST    IFNE *BLANKS                                                       CSD027
     C           RQCUST    ANDNE*ZEROS                                                      BUG11743
     C           RQSESN    ORNE *BLANKS
     C********** RQBRCH    ORNE *ZEROS                                    S01117
     C           RQBRCA    ORNE *BLANKS                                   S01117
      *                                                                   E32164
     C                     MOVELRQCUST    CUSTMR
     C                     MOVE *BLANKS   RQCUST
     C**********           MOVELRQBRCH    BRANCH                          S01117
     C**********           MOVE *BLANKS   RQBRCH                          S01117
     C                     MOVELRQBRCA    BRANCH                          S01117
     C                     MOVE *BLANKS   RQBRCA                          S01117
     C                     MOVELRQSESN    SECSNM
     C                     MOVE *BLANKS   RQSESN
     C/COPY WNCPYSRC,SE0220C016
     C                     EXSR CUSSEC
     C                     END
     C**
     C**      Access program name - for help and linked enquiries
     C**
     C                     MOVELPROGRM    PGMNO   8
     C**
     C**     SET UP STANDARD FIELDS FOR SFL LINES
     C**
     C                     MOVE 'B/F'     BF
     C                     MOVE 'C/F'     CF
     C                     MOVE 'S'       MARKET  1
     C                     Z-ADD1         Z       20                      E16802
     C**********           READ TABTG10F                 83         E16802S01117
     C                     READ SDCURRL0                 83               S01117
      *                                                                   E32164
     C           *IN83     DOWEQ'0'                                       E16802
     C********** CDP       IFEQ 0                                   E16802S01117
     C**********           MOVE CCYS      ARR,Z                     E16802S01117
     C           A6NBDP    IFEQ 0                                         S01117
     C                     MOVE A6SWCY    ARR,Z                           S01117
     C                     ADD  1         Z                               E16802
     C                     END                                            E16802
     C**********           READ TABTG10F                 83         E16802S01117
     C                     READ SDCURRL0                 83               S01117
     C                     END                                            E16802
      *                                                                   S01496
      **  Access SAR details file to see if JYSKE Enhcmts is installed.   S01496
      *                                                                   S01496
     C                     CALL 'AOSARDR0'                                S01496
     C                     PARM '       ' @RTCD                           S01496
     C                     PARM '*VERIFY' @OPTN                           S01496
     C                     PARM 'S01496'  WSARD   6                       S01496
      *                                                                   S01496
     C           @RTCD     IFEQ *BLANK                                    S01496
     C                     MOVE 'Y'       S01496  1                       S01496
     C                     END                                            S01496
     C/COPY WNCPYSRC,SE0220C002
      *
      ** Access SAR details file to see if CSE035 is installed                                CSE035
      *                                                                                       CSE035
     C                     CALL 'AOSARDR0'                                                    CSE035
     C                     PARM *BLANKS   @RTCD                                               CSE035
     C                     PARM '*VERIFY' @OPTN                                               CSE035
     C                     PARM 'CSE035'  WSARD                                               CSE035
      *                                                                                       CSE035
     C           @RTCD     IFEQ *BLANK                                                        CSE035
     C                     MOVE 'Y'       CSE035  1                                           CSE035
     C                     ELSE                                                               CSE035
     C                     MOVE 'N'       CSE035                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       207543
      ** Access SAR details file to see if CEU018 is installed                                207543
      *                                                                                       207543
     C                     CALL 'AOSARDR0'                                                    207543
     C                     PARM *BLANKS   @RTCD                                               207543
     C                     PARM '*VERIFY' @OPTN                                               207543
     C                     PARM 'CEU018'  WSARD                                               207543
      *                                                                                       207543
     C           @RTCD     IFEQ *BLANK                                                        207543
     C                     MOVE 'Y'       CEU018  1                                           207543
     C                     ELSE                                                               207543
     C                     MOVE 'N'       CEU018                                              207543
     C                     ENDIF                                                              207543
      *                                                                   CSE010
      ** Check is CSE010 is installed                                     CSE010
      *                                                                   CSE010
     C                     MOVE 'N'       CSE010  1                       CSE010
     C                     CALL 'AOSARDR0'                                CSE010
     C                     PARM *BLANKS   PRTCD   7                       CSE010
     C                     PARM '*VERIFY' POPTN   7                       CSE010
     C                     PARM 'CSE010'  PSARD   6                       CSE010
      *                                                                   CSE010
     C           PRTCD     IFEQ *BLANK                                    CSE010
     C                     MOVE 'Y'       CSE010                          CSE010
     C                     ELSE                                           CSE010
      *                                                                   CSE010
      ** Database Error (return code other than *NRF)                     CSE010
      *                                                                   CSE010
     C           PRTCD     IFNE '*NRF   '                                 CSE010
     C           *LOCK     IN   LDA                                       CSE010
     C                     MOVEL'SCSARDPD'DBFILE           ************   CSE010
     C                     MOVEL'*VERIFY' DBKEY            * DBERR 10 *   CSE010
     C                     Z-ADD10        DBASE            ************   CSE010
     C                     OUT  LDA                                       CSE010
     C                     MOVE *ON       *INU7                           CSE010
     C                     MOVE *ON       *INU8                           CSE010
     C                     MOVE *ON       *INLR                           CSE010
     C                     EXSR *PSSR                                     CSE010
     C                     ENDIF                                          CSE010
     C                     ENDIF                                          CSE010
      *                                                                   CSD007
      ** Access SAR details file to see if 'Customer closing' is          CSD007
      ** installed.                                                       CSD007
      *                                                                   CSD007
     C                     CALL 'AOSARDR0'                                CSD007
     C                     PARM *BLANKS   @RTCD                           CSD007
     C                     PARM '*VERIFY' @OPTN                           CSD007
     C                     PARM 'CSD007'  @SARD   6                       CSD007
      *                                                                   CSD007
     C           @RTCD     IFNE *BLANKS                                   CSD007
     C           @RTCD     ANDNE'*NRF   '                                 CSD007
     C                     MOVEL'SCSARDPD'DBFILE                          CSD007
     C                     MOVEL'CSD007'  DBKEY                           CSD007
     C                     Z-ADD11        DBASE                           CSD007
     C                     EXSR *PSSR                                     CSD007
     C                     ENDIF                                          CSD007
      *                                                                   CSD007
     C           @RTCD     IFEQ *BLANKS                                   CSD007
     C                     MOVE 'Y'       CSD007  1                       CSD007
     C                     ELSE                                           CSD007
     C                     MOVE 'N'       CSD007                          CSD007
     C                     ENDIF                                          CSD007
      *                                                                   CSE041
      ** Check if CSE041 is installed                                     CSE041
      *                                                                   CSE041
     C                     CALL 'AOSARDR0'                                CSE041
     C                     PARM *BLANKS   PRTCD                           CSE041
     C                     PARM '*VERIFY' POPTN                           CSE041
     C                     PARM 'CSE041'  PSARD                           CSE041
      *                                                                   CSE041
     C           PRTCD     IFEQ *BLANK                                    CSE041
     C                     MOVE 'Y'       CSE041  1                       CSE041
     C                     ELSE                                           CSE041
     C                     MOVE 'N'       CSE041                          CSE041
     C                     ENDIF                                          CSE041
      *                                                                   CSE039
      ** Check if CSE039 is installed                                     CSE039
      *                                                                   CSE039
     C                     CALL 'AOSARDR0'                                CSE039
     C                     PARM *BLANKS   PRTCD                           CSE039
     C                     PARM '*VERIFY' POPTN                           CSE039
     C                     PARM 'CSE039'  PSARD                           CSE039
      *                                                                   CSE039
     C           PRTCD     IFEQ *BLANK                                    CSE039
     C                     MOVE 'Y'       CSE039  1                       CSE039
     C                     ELSE                                           CSE039
     C                     MOVE 'N'       CSE039                          CSE039
     C                     ENDIF                                          CSE039
      *                                                                                     MD057247
      ** Access Switchable Features file to determine if CSE031 is                          MD057247
      ** installed in the system.                                                           MD057247
      *                                                                                     MD057247
     C                     CALL 'AOSARDR0'                                                  MD057247
     C                     PARM           URTNCD  7                                         MD057247
     C                     PARM '*VERIFY' UOPTN   7                                         MD057247
     C                     PARM 'CSE031'  UUKEY   6                                         MD057247
     C                     PARM           UDSFDY 76                                         MD057247
      *                                                                                     MD057247
     C                     MOVE 'N'       CSE031  1                                         MD057247
     C           URTNCD    IFEQ *BLANKS                                                     MD057247
     C                     MOVE 'Y'       CSE031                                            MD057247
     C                     ENDIF                                                            MD057247
      *                                                                                     MD057247
      ** Access Switchable Features file to determine if CSE071 is                          MD057247
      ** installed in the system.                                                           MD057247
      *                                                                                     MD057247
     C                     CALL 'AOSARDR0'                                                  MD057247
     C                     PARM           URTNCD                                            MD057247
     C                     PARM '*VERIFY' UOPTN                                             MD057247
     C                     PARM 'CSE071'  UUKEY                                             MD057247
     C                     PARM           UDSFDY                                            MD057247
      *                                                                                     MD057247
     C                     MOVE 'N'       CSE071  1                                         MD057247
     C           URTNCD    IFEQ *BLANKS                                                     MD057247
     C                     MOVE 'Y'       CSE071                                            MD057247
     C                     ENDIF                                                            MD057247
      *                                                                   E32164
     C                     ENDSR
     C*                                                                   E32164
     C*****************************************************************
      /EJECT                                                              S01117
     C*****************************************************************   S01117
     C*                                                               *   S01117
     C* CHKSEL - SUBROUTINE TO CHECK FOR SELECTION ON KEY FIELDS      *   S01117
     C*                                                               *   S01117
     C* CALLED FROM : MAIN,COMMD                                      *   S01117
     C*                                                               *   S01117
     C* CALLS : NOTHING                                               *   S01117
     C*                                                               *   S01117
     C*****************************************************************   S01117
     C*                                                                   S01117
     C           CHKSEL    BEGSR                                          S01117
     C*                                                                   S01117
     C                     MOVEL'N'       @SEL    1                       S01117
     C                     MOVELCUSTMR    @STP    1                       S01117
     C*                                                                   S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVEL'Y'       @SEL                            S01117
     C                     MOVELCUSTMR    @SKEY                           S01117
     C*                                                                   S01117
     C                     CALL 'AOSECSR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @SKEY                           S01117
     C           SDSECS    PARM SDSECS    DSSDY                           S01117
     C*                                                                   S01117
     C                     SETOF                     41                   S01117
     C                     MOVEL*BLANKS   CUSTMR                          S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVELBFCUST    CUSTMR                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           *IN07     IFEQ '1'                                       S01117
     C*                                                                   S01117
     C/COPY WNCPYSRC,SE0220C003
      *                                                                   CSE010
      ** If CSE010 is installed, and a '?' is found anywhere in the       CSE010
      ** Security Shortname field                                         CSE010
      *                                                                   CSE010
     C           CSE010    IFEQ 'Y'                                       CSE010
     C                     MOVELSECSNM    WQMK    1                       CSE010
     C           WQMK      IFEQ '?'                                       CSE010
     C                     MOVE '1'       @SEL                            CSE010
     C                     MOVE SECSNM    @SESN                           CSE010
     C                     CALL 'SE0043'                                  CSE010
     C                     PARM           @ACTN   1                       CSE010
     C                     PARM           @SESN  10                       CSE010
      *                                                                   CSE010
     C           @SESN     IFNE *BLANKS                                   CSE010
     C                     MOVE @SESN     SECSNM                          CSE010
     C                     ELSE                                           CSE010
     C                     MOVE *BLANKS   SECSNM                          CSE010
     C                     ENDIF                                          CSE010
     C                     ENDIF                                          CSE010
     C                     ENDIF                                          CSE010
     C                     MOVELBRANCH    @STP    1                       S01117
     C*                                                                   S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVEL'Y'       @SEL                            S01117
     C                     MOVELBRANCH    @BKEY                           S01117
     C*                                                                   S01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @BKEY                           S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01117
     C                     SETOF                     45                   S01117
     C                     MOVEL*BLANKS   BRANCH                          S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVELA8BRCD    BRANCH                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C*                                                                   S01117
     C*****************************************************************   S01117
      /EJECT                                                              S01496
     C*****************************************************************   S01496
     C*                                                                   S01496
     C**   P001 SR - CHANGE TRANSACTIONS TYPES                            S01496
     C**                                                                  S01496
     C**   Called by  SUBFIL                                              S01496
     C**                                                                  S01496
     C**   Calls                                                          S01496
     C*                                                                   S01496
     C*****************************************************************   S01496
     C           P001      BEGSR                                          S01496
     C*                                                                   S01496
     C           STYPE     IFEQ 'PUR'                      *B1            S01496
     C           STYPE     OREQ 'SAL'                                     S01496
     C                     OPEN SEERALL2                                  S01496
     C           TDRF      SETLLSEERALL2                 87               S01496
     C*                                                                   S01496
     C           *IN87     IFEQ '1'                        *B2            S01496
     C*                                                                   S01496
     C           STYPE     IFEQ 'PUR'                                     S01496
     C                     MOVEL'TRI'     STYPE                           S01496
     C                     END                                            S01496
     C           STYPE     IFEQ 'SAL'                                     S01496
     C                     MOVEL'TRO'     STYPE                           S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C                     END                             *E2            S01496
     C*                                                                   S01496
     C                     CLOSESEERALL2                                  S01496
     C                     END                             *E1            S01496
     C*                                                                   S01496
     C           STYPE     IFEQ 'WI '                                     S01496
     C           STYPE     OREQ 'WO '                                     S01496
     C*                                                                   S01496
     C           KEY1      KLIST                                          S01496
     C                     KFLD           TDSS                            S01496
     C                     KFLD           TDRF                            S01496
     C*                                                                   S01496
     C                     OPEN SEERALL5                                  S01496
     C           KEY1      SETLLSEERALL5                 87               S01496
     C*                                                                   S01496
     C           *IN87     IFEQ '1'                        *B2            S01496
     C*                                                                   S01496
     C           STYPE     IFEQ 'WI '                                     S01496
     C                     MOVEL'DRI'     STYPE                           S01496
     C                     END                                            S01496
     C           STYPE     IFEQ 'WO '                                     S01496
     C                     MOVEL'DRO'     STYPE                           S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C                     END                             *E2            S01496
     C*                                                                   S01496
     C                     CLOSESEERALL5                                  S01496
     C*                                                                   S01496
     C                     END                             *E1            S01496
     C*                                                                   S01496
     C                     ENDSR                                          S01496
     C*****************************************************************   S01496
      ***/EJECT******************                                  S01232 S01195
     C***/COPY*ZSRSRC,XDATE3Z1***                                  S01232 S01195
      /EJECT                                                              S01232
     C/COPY ZSRSRC,ZBKDT                                                  S01195
      /EJECT                                                              S01195
     C/COPY ZSRSRC,ZACCH                                                  S01195
      /EJECT                                                              S01232
     C/COPY ZSRSRC,ZACCRZ1                                                S01232
      /EJECT                                                              S01232
     C/COPY ZSRSRC,ZACCZZ1                                                S01232
     C/EJECT                                                              E39495
     C/COPY ZSRSRC,ZCALCD                                                 E39495
      /EJECT                                                              E21002
     C/COPY ZSRSRC,ZCNSDZ1                                                E21002
      /EJECT
     C/COPY ZSRSRC,ZCONVZ1
      /EJECT                                                              E21002
     C/COPY ZSRSRC,ZCSCTPZ1                                               E21002
      /EJECT
     C/COPY ZSRSRC,ZDATE1Z2
      /EJECT
     C/COPY ZSRSRC,ZDATE2Z4
      ***/EJECT*****************                                          E14576
     C***/COPY*ZSRSRC,ZDAYSZ2***                                          E14576
      /EJECT                                                              E19918
     C/COPY ZSRSRC,ZDAYSZ2                                                E19918
      ***/EJECT*****************                                          E14576
     C***/COPY*ZSRSRC,ZDYYRZ3***                                          E14576
      /EJECT                                                              E19918
     C/COPY ZSRSRC,ZDYYRZ3                                                E19918
      ***/EJECT*****************                                          E14576
     C***/COPY*ZSRSRC,ZEVCDZ1***                                          E14576
      /EJECT                                                              E19918
     C/COPY ZSRSRC,ZEVCDZ1                                                E19918
      ***/EJECT*****************                                          S01117
     C***/COPY*ZSRSRC,ZICD2Z1***                                          S01117
      ***/EJECT******************                                         S01117
     C***/COPY*ZSRSRC,ZICDSEZ1***                                         S01117
      /EJECT                                                              E20380
     C/COPY ZSRSRC,ZLCDZ1                                                            E20380 MD057247
      ***/EJECT****************                                           E14576
     C***/COPY*ZSRSRC,ZNCDZ3***                                           E14576
      /EJECT                                                              E19918
     C/COPY ZSRSRC,ZNCDZ3                                                 E19918
      /EJECT                                                              E21002
     C/COPY ZSRSRC,ZPRCIZ1                                                E21002
      ***/EJECT*****************                                          E14576
     C***/COPY*ZSRSRC,ZPRCOZ1***                                          E14576
      /EJECT                                                              E19918
     C/COPY ZSRSRC,ZPRCOZ1                                                E19918
      /EJECT                                                              S01232
     C/COPY ZSRSRC,ZRATEZ1                                                S01232
      /EJECT
     C/COPY ZSRSRC,ZSDESCZ3
      /EJECT
     C/COPY ZSRSRC,ZSEDITZ3
      ***/EJECT******************                                         S01117
     C***/COPY*ZSRSRC,ZSYSTMZ1***                                         S01117
      /EJECT                                                              S01232
     C/COPY ZSRSRC,ZYCEZ1                                                 S01232
      /EJECT                                                              E21002
     C/COPY ZSRSRC,ZYLDIZ1                                                E21002
      ***/EJECT*****************                                          E14576
     C***/COPY*ZSRSRC,ZYLDOZ1***                                          E14576
      /EJECT                                                              E19918
     C/COPY ZSRSRC,ZYLDOZ1                                                E19918
      ***/EJECT****************                                           E14576
     C***/COPY*ZSRSRC,ZYLDZ2***                                           E14576
      /EJECT                                                              E19918
     C/COPY ZSRSRC,ZYLDZ2                                                 E19918
      /EJECT
      ***
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  POWER8 - ARRAY OF POWERS FOR NOMINAL DP TO CURRENCY DP CONVERSION
00000001
00000010
00000100
00001000
00010000
00100000
01000000
10000000
**   MSG  - ERROR MESSAGES  - S01117 ADDED ERROR MESSGES 15 AND 16        S01117
ENTER A CUSTOMER NO./SHORTNAME, OR TAKE F/6 FOR SHORTNAME ENQUIRY
INVALID ENTRY - BOTH CUSTOMER NO./SHORTNAME AND OPTION ENTERED
INVALID ENTRY - ONLY ONE OPTION MAY BE SELECTED
INVALID OPTION - ENTER 1(SECURITY DETAILS) 2(TRADE DETS) OR 3(CLIENT HOLDINGS)
INVALID CUSTOMER NO./SHORTNAME - PLEASE RE-ENTER                                             BUG2271
THIS IS THE INITIAL ENQUIRY - F/3 WILL EXIT TO MENU
ENTER A CUSTOMER NUMBER OR SHORTNAME, OR SELECT AN OPTION
INVALID BRANCH - PLEASE RE-ENTER
INVALID MONTH/YEAR - PLEASE RE-ENTER
MONTH/YEAR IS BEFORE THE TRADE RETENTION PERIOD - PLEASE RE-ENTER
INVALID SECURITY SHORTNAME - PLEASE RE-ENTER                                                 BUG2271
F/6 INVALID AS NEITHER CUSTOMER OR SECURITY IS BLANK
OPTION NOT VALID FOR DEPOT MOVEMENT
CUSTOMER ENTERED IS NOT A PORTFOLIO CUSTOMER - PLEASE RE-ENTER
USER IS NOT AUTHORISED TO ANY BOOKING BRANCHES
USER IS NOT AUTHORISED TO THE BOOKING BRANCH
OPTION IS NOT VALID FOR SECURITY
INVALID OPTION - ENTER 1(SECURITY DETAILS) 2(MOVEM DETS) OR 3(CLIENT HOLDINGS)
VALID OPTIONS - 1(SE DETAILS) 2(MOVEM DETS) 3(CLIENT HOLDGS) OR 4(MOVEM STATUS)
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
0006001521029820444305904073650882610287117481320914670161311759219053
2051421975234362489726358278192928030741322023366335124365853804639507
40968424294389045351
**  CPY@
(c) Finastra International Limited 2001
