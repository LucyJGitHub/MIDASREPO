000100200610     H        1
000200200610     F*****************************************************************
000300200610/*STD *  RPGBASE                                                      *
000400200610/*EXI *  TEXT('Midas SE Customer portfolio movements enquiry')        *
000500200610     F*****************************************************************
000600200610     F*                                                               *
000700200610     F*  Midas - Security Trading Module                              *
000800200610     F*                                                               *
000900200610     F*  SE0220 - CUSTOMER PORTFOLIO MOVEMENTS ENQUIRY                *
001000200610     F*                                                               *
001100200610     F*  Function:  This program displays details of transactions for *
001200200610     F*   (I/C)     a particular customer's portfolio.  For each      *
001300200610     F*             Security,the following figures are shown:         *
001400200610     F*             Brought Forward; Purchases, Sales, Walk-Ins and   *
001500200610     F*             walk-outs to date; and a Carry Forward Total.     *
001600200610     F*             Figures are shown on either a Trade or Value date *
001700200610     F*             basis as determined by the bank on installation.  *
001800200610     F*             Selection of Month/Year and Security Shortname is *
001900200610     F*             optional. In a Multi-Branch environment, Branch   *
002000200610     F*             may also be entered.                              *
002100200610     F*             Each option available from this enquiry is held   *
002200200610     F*             as a record on PF/SECOND - Linked Enquiry Control *
002300200610     F*             file with fields: Calling Program, Option         *
002400200610     F*             Selected, Called Program.                         *
002500200610     F*                                                               *
002600200610     F*  Calls:     F6 may be taken when the Customer or Security has *
002700200610     F*             not been entered to call:                         *
002800200610     F*             - SE0270 - Customer Shortname Enquiry; or         *
002900200610     F*             - SE0240 - Security Report Name Enquiry;          *
003000200610     F*             respectively.                                     *
003100200610     F*             Additionally, options may be entered against a    *
003200200610     F*             transaction to call:                              *
003300200610     F*             1) SE0245 - Security Details Enquiry              *
003400200610     F*             2) SE0250 - Trade Details Enquiry                 *
003500200610     F*             3) SE0205 - Client Holdings Enquiry.              *
003600200610     F*             4) SEDPMVSIN - Depot Movements Enquiry            *    CSE041
003700200610     F*             5) SEC025 - Movement Status Enquiry               *    CSE039
003800200610     F**************NB.Option*2*not*allowed*against*a*depot*movement.**    CSE041
003900200610     F*                                                               *
004000200610     F*  Called by: SEC04 - CL Component to Control SE Enquiries      *
004100200610     F*                                                               *
004200200610      *  (c) Finastra International Limited 2001                      *
004300200610     F*                                                               *
004400200610      *  Last Amend No. 248698             Date 01Jun20               *
004500200610      *  Prev Amend No. 261507             Date 22May20               *
004600200610      *                 MD046248           Date 27Oct17               *
004700200610      *                 226449             Date 24Jun15               *
004800200610      *                 MD034776           Date 08Jul15               *
004900200610      *                 AR1067108          Date 11Dec12               *
005000200610      *                 AR1001183A         Date 20Nov12               *
005100200610      *                 CER059             Date 19Jul10               *
005200200610      *                 CER043             Date 19May08               *
005300200610      * Bank Fusion Midas 1.4 Base -----------------------------------*
005400200610      * Midas Plus 1.4 Base 04 ---------------------------------------*
005500200610      * Midas Plus 1.4 Base ------------------------------------------*
005600200610      * Midas Plus 1.3 ----------- Base ------------------------------*
005700200610      *                 234300             Date 29Sep06               *
005800200610      *                 BUG11813           Date 04Aug06               *
005900200610      *                 BUG11743           Date 21Jul06               *
006000200610      *                 CSD031             Date 10Apr06               *
006100200610      *                 CSD027             Date 09Dec05               *
006200200610      *                 CSE071             Date 19Jul05               *
006300200610      *                 229857             Date 07Oct04               *
006400200610      *                 214953             Date 11Apr03               *
006500200610      *                 226570             Date 27Jun04               *
006600200610      *                 CSW037A            Date 02May05               *
006700200610      *                 CSD025             Date 11Jan05               *
006800200610      *                 CSW037             Date 15Dec04               *
006900200610      *                 CSW036             Date 15Dec04               *
007000200610      *                 BUG3122            Date 17Jul04               *
007100200610      *                 CLE025             Date 20Oct03               *
007200200610      *                 BUG2507            Date 25May04               *
007300200610      *                 BUG2271            Date 28Apr04               *
007400200610      *                 CGL029             Date 01Sep03               *
007500200610      *                 222727             Date 05Nov03               *
007600200610      *                 211407             Date 11Nov02               *
007700200610      *                 208241             Date 21Aug02               *
007800200610      *                 194370             Date 12Jul01               *
007900200610      *                 207543             Date 17JUL02               *
008000200610      *                 180056             Date 18Oct00               *
008100200610      *                 CSE035             Date 22Apr02               *
008200200610      *                 CSE039             Date 17Mar03               *
008300200610      *                 CSE041             Date 13Mar03               *
008400200610      *                 206316             Date 19Jul02               *
008500200610      * Midas Release 4.01 -------------------------------------------*
008600200610      *                 CPK015             Date 17Jun01               *
008700200610      *                 CSE031             Date 06Dec01               *
008800200610      *                 180707             Date 25Jul00               *
008900200610      *                 186427             Date 16Nov01               *
009000200610      * Midas Release 4 --------------- Base -------------------------*
009100200610      *                 127566             Date 09May01               *
009200200610      * Midas DBA 3.04 -----------------------------------------------*
009300200610      *                 CSD007             Date 28Aug00               *
009400200610      * Midas DBA 3.03 -----------------------------------------------*
009500200610      * Midas DBA 3.02 -----------------------------------------------*
009600200610      *                 CSE015             Date 06Dec99               *
009700200610      *                 CSE017             Date 20Oct99               *
009800200610      *                 CSE012             Date 16Aug99               *
009900200610      * Midas DBA 3.01 -----------------------------------------------*
010000200610      *                 CSE010             Date 21Jun99               *
010100200610      * Midas DBA 3.00 ---------------- Base -------------------------*
010200200610      *                 130862             Date 18Oct98               *
010300200610      *                 151945             Date 06Jan99               *
010400200610     F*                 105586             DATE 24FEB98               *
010500200610     F*                 CSE005             DATE 04FEB97               *
010600200610     F*                 084704             DATE 01AUG96               *
010700200610     F*                 083039             DATE 01AUG96               *
010800200610     F*                 059110             DATE 25JUL96               *
010900200610     F*                 088047             DATE 26JUN96               *
011000200610     F*                 100228             DATE 30MAY96               *
011100200610     F*                 102644             DATE 30APR96               *
011200200610     F*                 099886             DATE 17APR96               *
011300200610     F*                 100017             DATE 17APR96               *
011400200610     F*                 090501             DATE 25OCT95               *
011500200610     F*                 092961             DATE 04OCT95               *
011600200610     F*                 091254             DATE 20OCT95               *
011700200610     F*                 086491             DATE 15JUN95               *
011800200610     F*                 S01496  JSV        DATE 07OCT94               *
011900200610     F*                 065301             DATE 05MAY94               *
012000200610     F*                 S01445             DATE 04NOV93               *
012100200610     F*                 052254             DATE 07JAN94               *
012200200610     F*                 S01401             DATE 16JUN93               *
012300200610     F*                 E39495             DATE 17FEB93               *
012400200610     F*                 047922             DATE 01FEB93               *
012500200610     F*                 S01397             DATE 10SEP92               *
012600200610     F*                 E38086             DATE 15JUL92               *
012700200610     F*                 E35915             DATE 20FEB92               *
012800200610     F*                 E34849             DATE 28JAN92               *
012900200610     F*                 E34847             DATE 23JAN92               *
013000200610     F*                 E32674             DATE 03DEC91               *
013100200610     F*                 E31583             DATE 02DEC91               *
013200200610     F*                 E31763             DATE 02DEC91               *
013300200610     F*                 E32164             DATE 02DEC91               *
013400200610     F*                 E27934             DATE 22OCT91               *
013500200610     F*                 E27092             DATE 04SEP91               *
013600200610     F*                 S01117             DATE 28FEB91               *
013700200610     F*                 S01195             DATE 28FEB91               *
013800200610     F*                 S01220             DATE 28FEB91               *
013900200610     F*                 S01269             DATE 19JUL90               *
014000200610     F*                 S01271             DATE 19JUN90               *
014100200610     F*                 E23128             DATE 07AUG90               *
014200200610     F*                 E23125             DATE 06AUG90               *
014300200610     F*                 E21668             DATE 01MAY90               *
014400200610     F*                 E21616             DATE 03APR90               *
014500200610     F*                 E21480             DATE 21MAR90               *
014600200610     F*                 E21428             DATE 19MAR90               *
014700200610     F*                 E21026             DATE 05FEB90               *
014800200610     F*                 E21002             DATE 05FEB90               *
014900200610     F*                 E20651             DATE 29JAN90               *
015000200610     F*                 E20783             DATE 05JAN90               *
015100200610     F*                 S01232             DATE 15DEC89               *
015200200610     F*                 E20327             DATE 13DEC89               *
015300200610     F*                 E20324             DATE 13DEC89               *
015400200610     F*                 E20380             DATE 08DEC89               *
015500200610     F*                 E19986             DATE 25OCT89               *
015600200610     F*                 E19918             DATE 25OCT89               *
015700200610     F*                 S01199             DATE 03/08/89              *
015800200610     F*                 E18658             DATE 30/06/89              *
015900200610     F*                 E16772             DATE 20/06/89              *
016000200610     F*                 E17130             DATE 22/02/89              *
016100200610     F*                 E16825             DATE 20/02/89              *
016200200610     F*                 E16802             DATE 20/02/89              *
016300200610     F*                 E15706             DATE 20/02/89              *
016400200610     F*                 E15221             DATE 20/02/89              *
016500200610     F*                 E15707             DATE 13/02/89              *
016600200610     F*                 E16063             DATE 21/10/88              *
016700200610     F*                 S01179             DATE 21/10/88              *
016800200610     F*                 E14576             DATE 19/10/88              *
016900200610     F*                 E15215             DATE 30/09/88              *
017000200610     F*                 E15334             DATE 30/09/88              *
017100200610     F*                 E15306             DATE 28/09/88              *
017200200610     F*                 E15304             DATE 28/09/88              *
017300200610     F*                 E13854             DATE 31/07/88              *
017400200610     F*                 E13571             DATE 31/07/88              *
017500200610     F*                 E13657             DATE 11/07/88              *
017600200610     F*                 E14057             DATE 04/07/88              *
017700200610     F*                 E13975             DATE 30/06/88              *
017800200610     F*                 E13541             DATE 27/06/88              *
017900200610     F*                 E13853             DATE 22/06/88              *
018000200610     F*                 E13484             DATE 02/06/88              *
018100200610     F*                 S01158             DATE 06/05/88              *
018200200610     F*                                                               *
018300200610     F*---------------------------------------------------------------*
018400200610     F*                                                               *
018500200610      *  248698 - Rounding discrepancies on some SE reports. Applied  *
018600200610      *           fix 228682.                                         *
018700200610      *  228682 - Recompiled due to ZCNSDZ1 changes. Applied 176594.  *
018800200610      *  261507 - Truncation of Average Price in display screen.      *
018900200610      *           Introduced new field BKPRR with length 23 with 8    *
019000200610      *           decimal places to be used as a result field when    *
019100200610      *           computing the average price to avoid truncation of  *
019200200610      *           the value.                                          *
019300200610      *  MD046248 - Finastra Rebranding                               *
019400200610      *  226449 - Recompiled over changes made in /COPY ZDYYRZ3.      *
019500200610      *         - Applied for MD034387.                               *
019600200610      *  MD034776 - Reverse AR1001183A to allow negative interest     *
019700200610      *             rate. (Recompile)                                 *
019800200610      *  AR1067108 - PMC1140 Component failed during Clean COB        *
019900200610      *              Applied fix AR1001183A                           *
020000200610      *  AR1001183A - Coupon rate was still used in computation of    *
020100200610      *              interest instead of using the details in FRN tab *
020200200610      *              (Reopen) (Recompile)                             *
020300200610      *  CER059 - German Feature Upgrade to Delhi                     *
020400200610      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
020500200610      *           (Recompile)                                         *
020600200610      *  234300 - Recompiled over changed in PF/HSTTRD.               *
020700200610      *  BUG11813 - Screen has no validation when status movement     *
020800200610      *             enquiry is selected                               *
020900200610      *  BUG11743 - Customer number defaults to zero                  *
021000200610      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
021100200610      *  CSD027 - Conversion Of Customer Number to Alpha              *
021200200610      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
021300200610      *  229857 - Recompiled due to change in ZYLDZ2.                 *
021400200610      *  214953 - Not able to enquire on depot movement details. Fix  *
021500200610      *           is to call new pgm SE0071 when option '2' is entered*
021600200610      *           against a WI/WO record transaction.                 *
021700200610      *  226570 - Recompiled due to change in ZYLDZ2.                 *
021800200610      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
021900200610      *  CSD025 - Customer De-Activation                              *
022000200610      *  CSW037 - Additional Field Data on MT300/MT320                *
022100200610      *  CSW036 - Dual SWIFT BIC held on Client Details               *
022200200610      *  BUG3122 - Recompiled due to changes in SDSECSPD.             *
022300200610      *  CLE025 - Credit Lines (Recompile)                            *
022400200610      *  BUG2507 - Logical File must contain Depot Value Date with    *
022500200610      *            CSE015.  Applied fix 210170.                       *
022600200610      *  BUG2271 - Changed misleading error message texts by removing *
022700200610      *            "OR TAKE F/6" on compile-time array MSG elements   *
022800200610      *            5 and 11.                                          *
022900200610      *  CGL029 - Increase Account Code to 10 digits                  *
023000200610      *  222727 - Release 5.0 errors  (Recompile)                     *
023100200610      *  211407 - Recompile after change on copy sources ZYLDZ2,      *
023200200610      *           ZACCRZ1 and ZYCEZ1 for NX/NNX processing.           *
023300200610      *           The change was to call subroutine ZLCD1 instead     *
023400200610      *           of ZLCD in retrieving the PERIOD for NNX processing *
023500200610      *           and ZNCD1 is called instead of ZNCD in retrieving   *
023600200610      *           the WBENCD for NNX processing. Also rewrite tests   *
023700200610      *           for identifying if position is NX,NNX or CUM.       *
023800200610      *  208241 - Recompiled over changed /CPY ZSDESCZ3.              *
023900200610      *  194370 - Recompile after change on copy sources ZYLDZ2,      *
024000200610      *           For securities with divisor basis = '5' and first   *
024100200610      *           coupon date > valuation date (rundate + 1), set     *
024200200610      *           event control date to first coupon date before      *
024300200610      *           processing SR/ZDYYR. This is to ensure that the     *
024400200610      *           correct hypothetical last and next coupon dates are *
024500200610      *           used in deriving the price/yield rate.              *
024600200610      *  207543 - CEU018 not working on a price basis.                *
024700200610      *  180056 - Recompiled over changed in ZDYYRZ3.                 *
024800200610      *  CSE035 - NX/NNX Coupon Payment Processing.                   *
024900200610      *  CSE039 - Auto-settlement of trades                           *
025000200610      *           Add processing for option 4                         *
025100200610      *  CSE041 - Include DVP/RVP movements on screen                 *
025200200610      *  206316 - Recompiled over changed ZLCDZ1.                     *
025300200610      *  CPK015 - Conversion of ZYIELD from PLI to RPG.               *
025400200610      *           Recompile over changed ZYLDZ2.                      *
025500200610      *  CSE031 - Coupon Fixing for Floating Rate Notes.              *
025600200610      *           (recompilation due to change to ZNCD/ZLCD/ZACCR)    *
025700200610      *  180707 - No Position Settlements generated. Recompile over   *
025800200610      *           changes in /COPY ZNCDZ3.                            *
025900200610      *  186427 - DB Err 04 must be skipped for a cancelled security  *
026000200610      *           (if still a live position on it, nominal is zero).  *
026100200610      *  127566 - Recompiled over changed ZSDESCZ3                    *
026200200610      *  CSD007 - Customer Closing                                    *
026300200610      *  CSE015 - Forward Valued Depot Movements (Recompile)          *
026400200610      *  CSE017 - Cum/Ex Indicator on Depot Movement (Recompile)      *
026500200610      *  CSE012 - SE Depot Movement Narratives (Recompiled).          *
026600200610      *  CSE010 - SE Transactions Enhancement                         *
026700200610     F*  130862 - Recompiled over ZLCDZ1 & ZDAYSZ2 changes.           *
026800200610     F*  151945 - Recompiled Over changed ZDYYRZ3 .                   *
026900200610     F*  105586 - FOR UNIT PRICE BASIS, REFORMAT BOOK PRICE FOR B/F   *
027000200610     F*           FROM NOMINAL CURRENCY DECIMAL PLACES TO A STRAIGTH  *
027100200610     F*           15/8 PRICE.
027200200610     F*  CSE005 - Effect of holidays on FRN Coupon Dates              *
027300200610     F*           (recompilation due to change to ZNCD/ZLCD/ZACCR).   *
027400200610     F*  084704 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
027500200610     F*  083039 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
027600200610     F*  059110 - Recompiled over changed ZYLDZ2 sub.                 *
027700200610     F*  088047 - RECOMPILE over change SR/ZYLDZ2.                    *
027800200610     F*  100228 - RECOMPILE OVER CHANGED ZDYYRZ3, ZLCDZ1 & ZNCDZ3.    *
027900200610     F*  102644 - Increase the array for currency with CDP to zeroes  *
028000200610     F*  099886 - Rounding problem for partly paid securities.        *
028100200610     F*           Recompile over amended standard subroutine ZACCZ.   *
028200200610     F*  100017 - Position settlement unable to pick up day adj. on   *
028300200610     F*           SECTYD. Change subroutine to use DADJN to stop      *
028400200610     F*           interest day adjustment being used for amortisation.*
028500200610     F*           Recompile over amended subroutine ZDAYS.            *
028600200610     F*  090501 - Display message if security cancelled, as well as   *
028700200610     F*           if it is not on file or deleted.                    *
028800200610     F*  092961 - Recompile over ZDAYSZ2 which was amended by 086491  *
028900200610     F*           (Wrong number of days calculated for day basis 1    *
029000200610     F*           when start or end day is last day of February)      *
029100200610     F*  091254 - RECOMPILE OVER CHANGED ZLCDZ1 & ZNCDZ3              *
029200200610     F*  086491 - Wrong nbr of days calculated for day basis 1        *
029300200610     F*           when start or end day is last day of February       *
029400200610     F*           Recompiled for ZSRSRC/ZDAYSZ2 changes.              *
029500200610     F*  S01496 - Incorporation of JYSKE Enhancements (S10978)        *
029600200610     F*  065301 - Recompiled over changed copy source ZACCR subr.     *
029700200610     F*           with ZAMT increased to 15,0.                        *
029800200610     F*  S01445 - DEPOT MOVEMENT CHARGES ENHANCEMENT.                 *
029900200610     F*           Recompiled due to changes in PF/DPTMVD.             *
030000200610     F*  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
030100200610     F*           to 10,9                                             *
030200200610     F*  S01401 - MT5xx SWIFT Messages Feature:                       *
030300200610     F*           - Recompiled due to changes to files.               *
030400200610     F*  E39495 - New /COPY subroutine ZCALCD added (called from      *
030500200610     F*           sr. ZYLD)                                           *
030600200610     F*         - Recompiled over changed ZYLDZ2                      *
030700200610     F*  047922 - Recompiled over changed SR/ZYLDZ2                   *
030800200610     F*  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
030900200610     F*           - Recompiled due to changes to files and SR/ZYLD.   *
031000200610     F*  E38086 - Trades Enquiry (option 2) should not be allowed     *
031100200610     F*           against the Security. What it does is to enquire on *
031200200610     F*           the first Trade Reference under that Security, but  *
031300200610     F*           if the first entry is a Depot Movement, it will try *
031400200610     F*           to do a Trade Enquiry on the Depot Movement         *
031500200610     F*           Reference Number.                                   *
031600200610     F*  E35915 - Authorised deleted trades should not be shown       *
031700200610     F*  E34849 - Average price was not worked out properly           *
031800200610     F*  E34847 - Nominal decimal places are ignore for depot mvts    *
031900200610     F*  E32674 - Recompiled due to error in DPTMVD.                  *
032000200610     F*  E31583 - Checking authority on the Branch Code obtained from *
032100200610     F*           reading records for Brought Forward amount, etc. is *
032200200610     F*           wrong. This branch is irrelevant and may not be the *
032300200610     F*           same as the correct branch which has been checked   *
032400200610     F*           anyway. If blank, it causes serious problems.       *
032500200610     F*  E31763 - To reduce rounding errors on the Price shown on the *
032600200610     F*           Detail Lines of Trades, (especially for Yields and  *
032700200610     F*           Discounts), use the P/D/Y field from the Trade if   *
032800200610     F*           the Trade Price is the same as the Contract Price.  *
032900200610     F*  E32164 - Errors in Structure of program:                     *
033000200610     F*           - Wrong details printed for Depot Movements. This is*
033100200610     F*             caused by the save of the 'Trades' record. Most of*
033200200610     F*             the Depot Movement fields are redefined to be the *
033300200610     F*             same names as the Trades fields, but DPMV and MKTP*
033400200610     F*             were not, therefore they got overwritten.         *
033500200610     F*           - Although the logicals built over the Trades File  *
033600200610     F*             all have different lengths because of odd fields  *
033700200610     F*             missing from the file definitions, SRECIN must be *
033800200610     F*             the same length as RECIN, (defined from TRADSD).  *
033900200610     F*           - SELCRI (Selection Criteria) was incorrect length. *
034000200610     F*             It shld be the name of the Data Structure anyway, *
034100200610     F*             so changed. Similarly for other Data structures.  *
034200200610     F*           - No fields from SDBANK or SDGELR are required, so  *
034300200610     F*             there is no need to access either of these files. *
034400200610     F*           - Added more comments to aid readability of program.*
034500200610     F*  E27934 - Recompiled over the changed version of ZACCRZ1      *
034600200610     F*  E27092 - Recompiled over changed SR/ZLCD                     *
034700200610     F*  S01117 - Multibranching                                      *
034800200610     F*  S01195 - New Holiday Processing                              *
034900200610     F*  S01220 - Recompiled for Stragetic Risk Management            *
035000200610     F*  S01269 - TRADE AUTHORISATION                                 *
035100200610     F*  S01271 - Recompiled for Pay/Receive in Input Cycle changes   *
035200200610     F*           to TRADSD and/or DPTMVD                             *
035300200610     F*  E23128 - Entered security name should not be blanked out     *
035400200610     F*           after a customer shortname enquiry.                 *
035500200610     F*  E23125 - Recompiled over changed display file SE0220DF       *
035600200610     F*  E21668 - Recompiled over changed SR/ZYLDZ2                   *
035700200610     F*  E21616 - Recompiled over changed SR/ZLCD.                    *
035800200610     F*  E21480 - Convert Price on Depot Movements to Percentage      *
035900200610     F*           Price for the calculation of Book Value.            *
036000200610     F*  E21428 - B/F Price should be in the same format as the others*
036100200610     F*           (i.e. Price/Discount/Yield).                        *
036200200610     F*  E21026 - Change to Data Structures so that all the Nominal   *
036300200610     F*           fields line up.                                     *
036400200610     F*  E21002 - Price shown should be Contract Price, not Trade     *
036500200610     F*           Price.                                              *
036600200610     F*  E20651 - DB Error Numbers used in more than one place.       *
036700200610     F*           New Error Numbers as follows:                       *
036800200610     F*           DB ERROR 05 -> 08.                                  *
036900200610     F*           DB ERROR 05 -> 09.                                  *
037000200610     F*  E20783 - Non-specific Enquiry into a non-Australian Portfolio*
037100200610     F*           Customer does not produce any details.              *
037200200610     F*  S01232 - Australian Yields modifications.                    *
037300200610     F*  E20327 - Correct editing of CCY d.p's for Book Value.        *
037400200610     F*  E20324 - Allow Rollup to display just the C-F Line.          *
037500200610     F*  E20380 - ZYLDZ1 and ZYLDZ2 changed. ZLCDZ1 now required.     *
037600200610     F*  E19986 - Database Error in PF/TABTG10 at 05 when the Short-  *
037700200610     F*           name is input as the Customer.                      *
037800200610     F*  E19918 - Booking/Average Price is being shown as a Percentage*
037900200610     F*           Price even though the Security was traded on a Yield*
038000200610     F*           Basis.                                              *
038100200610     F*  S01199 - ABS Help System.                                    *
038200200610     F*  E18658 - Print correct Countervalue for first record.        *
038300200610     F*           Also, C/F Average Price incorrect Decimal Places,   *
038400200610     F*           using wrong Currency.                               *
038500200610     F*  E16772 - Recompiled for the Dividend Payment Amount field    *
038600200610     F*           changes.                                            *
038700200610     F*  E17130 - ERROR MESSAGE CHANGED FOR LINKED ENQUIRY OPTIONS.   *
038800200610     F*  E16825 - CURRENCY WITH ZERO DECIMAL PLACES FOR NON-DEPOT     *
038900200610     F*           MOVE SHOWS INCORRECT AVERAGE PRICE.                 *
039000200610     F*  E16802 - BOOK AVERAGE PRICES AND NOMINAL APPEAR WITH WRONG   *
039100200610     F*           AMOUNTS, ALSO % SIGN INCORRECT.                     *
039200200610     F*  E15706 - IF ALL MOVEMENTS FILL ONE PAGE WHEN CUSTOMER, DATE, *
039300200610     F*           SECURITY ENTERED AND ONLY C/F TO SHOW ON NEXT PAGE, *
039400200610     F*           DO NOT SHOW THIS C/F.                               *
039500200610     F*  E15221 - ALLOW MOVEMENTS TO BE DISPLAYED FOR A MATURED       *
039600200610     F*           SECURITY.                                           *
039700200610     F*  E15707 - IF A FIELD IS CLEARED AND DETAILS REQUESTED ON      *
039800200610     F*           ANOTHER FIELD SYSTEM SAYS MORE THAN ONE OPTION      *
039900200610     F*           SELECTED.                                           *
040000200610     F*  E16063 - LINKED ENQUIRY REORGANIZATION.                      *
040100200610     F*           PASS A CUSTOMER TO LINKED ENQUIRIES.                *
040200200610     F*  S01179 - ****** AS400 CONVERSION ******                      *
040300200610     F*     The keyword RTGAID is no longer supported on the AS400    *
040400200610     F*     and command keys and indicators have been used to replace *
040500200610     F*     this in the display file. To disrupt the structure of the *
040600200610     F*     program as little as possible a new subroutine - ASCHGS - *
040700200610     F*     has been coded. This moves the values which would have    *
040800200610     F*     been passed to the program (via RTGAID) into the AID      *
040900200610     F*     field depending on which function key has been pressed.   *
041000200610     F*  E14576 - INCORRECT BROUGHT FORWARD POSITION FOR A TRADE      *
041100200610     F*           BACKVALUED TO A PRIOR MONTH,WHEN A SUBSEQUENT       *
041200200610     F*           MONTH IS SELECTED AS THE START POINT.               *
041300200610     F*  E15215 - ALSO OUTPUT RECORDS ON TDPBV/T WITH RECI = S.       *
041400200610     F*  E15334 - SUBFILE NOT BEING CLEARED ON RETURN FROM LINKED     *
041500200610     F*           ENQUIRY.                                            *
041600200610     F*  E15306 - ENQUIRY SHOWS END OF FILE, BUT MORE RECORDS TO      *
041700200610     F*           DISPLAY ON ROLLUP.                                  *
041800200610     F*  E15304 - PROGRAM ALLOWS ENTRY OF NON-PORTFOLIO CUSTOMERS.    *
041900200610     F*  E13854 - DEPOT MOVEMENTS THAT HAVE REACHED THEIR VALUE       *
042000200610     F*           DATE ARE INCORRECTLY OMITTED FROM THE ENQUIRY.      *
042100200610     F*  E13571 - AMENDED ERROR MESSAGE, AS NO HELP TEXT.             *
042200200610     F*  E13657 - ALTHOUGH WALK-INS AND WALK-OUTS ARE OUTPUT WITH     *
042300200610     F*           TRADES, OPTION 2 CAUSES AN ERROR BECAUSE IT IS      *
042400200610     F*           A TRADES ENQUIRY.THIS OPTION SHOULD BE VALID FOR    *
042500200610     F*           TRADES ONLY.                                        *
042600200610     F*  E14057 - FILE PRICS CHANGED TO PRICR.                        *
042700200610     F*  E13975 - IF SECURITY WAS NOT ENTERED AND F/5 WAS TAKEN       *
042800200610     F*           THE PORFOLIO MOVEMENTS WERE NOT DISPLAYED WITHIN    *
042900200610     F*           SECURITIES.                                         *
043000200610     F*  E13541 - '+' SHOWING TO DENOTE FURTHER PAGES IF 1ST SCREEN   *
043100200610     F*           FULL AND NO MORE RECORDS TO SELECT.                 *
043200200610     F*  E13853 - PROGRAM WAS LOOPING IF THERE IS A TRADE FOR THE     *
043300200610     F*           THE LAST DAY OF THE MONTH PRIOR TO THE MONTH        *
043400200610     F*           REQUESTED.                                          *
043500200610     F*  E13484 - SETOF/ON INDICATORS CORRECTLY.                      *
043600200610     F*  S01158 - POST INCORPORATION DEVELOPMENT FIX.                 *
043700200610     F*                                                               *
043800200610     F*****************************************************************
043900200610      *
044000200610     FSE0220DFCF  E                    WORKSTN      KINFDS SCRDS
044100200610     F                                        SFLRECKSFILE SE0220S0
044200200610     FCDEPP   IF  E           K        DISK
044300200610     FCPOSH   IF  E           K        DISK
044400200610     F            CPOSNDF                           KRENAMESPOSHDF
044500200610     FCPOSN   IF  E           K        DISK
044600200610     FSECTY   IF  E           K        DISK
044700200610     FINVTP   IF  E           K        DISK                               S01232
044800200610     F*CLINT***IF  E           K        DISK                              S01117
044900200610     F**********  CLINTCAF                          KIGNORE               S01117
045000200610     F**********  CLINTCCF                          KIGNORE               S01117
045100200610     F**********  CLINTC1F                          KIGNORE               S01117
045200200610     F************CLINTSEF                          KIGNORE               E15304
045300200610     F*SNAME***IF  E           K        DISK                              S01117
045400200610     F**********  CLINTCBF                          KRENAMESNAMECBF       S01117
045500200610     F****PRICS   IF  E           K        DISK                           E14057
045600200610     FPRICR   IF  E           K        DISK                               E14057
045700200610     FTDPBV   IF  E           K        DISK
045800200610     FTDPBT   IF  E           K        DISK
045900200610     F            HSTTRDF                           KRENAMEHSTTRDAF
046000200610     F            TRADSDF                           KRENAMETRADSDAF
046100200610     F            DPTMVDF                           KRENAMEDPTMVDAF
046200200610     F            DPTMVTF                           KRENAMEDPTMVTAF
046300200610     F            SEDVPRD0                          KRENAMESEDVPRAF       CSE041
046400200610     FTDPOV   IF  E           K        DISK                               E14576
046500200610     F            TRADSDF                           KRENAMETRADSDVF       E14576
046600200610     F            DPTMVDF                           KRENAMEDPTMVDVF       E14576
046700200610     F            DPTMVTF                           KRENAMEDPTMVTVF       E14576
046800200610     F            SEDVPRD0                          KRENAMESEDVPRVF       CSE041
046900200610     FTDPOT   IF  E           K        DISK                               E14576
047000200610     F            TRADSDF                           KRENAMETRADSDTF       E14576
047100200610     F            DPTMVDF                           KRENAMEDPTMVDTF       E14576
047200200610     F            DPTMVTF                           KRENAMEDPTMVTTF       E14576
047300200610     F            SEDVPRD0                          KRENAMESEDVPRTF       CSE041
047400200610     F*TABSE***IF  E           K        DISK                              S01117
047500200610     F**********  TABLETAF                          KIGNORE               S01117
047600200610     F*           TABTB10F                          KIGNORE
047700200610     F*           TABTB11F                          KIGNORE
047800200610     F*           TABTB36F                          KIGNORE
047900200610     F**********  TABTB40F                          KIGNORE               S01117
048000200610     F**********  TABTE10F                          KIGNORE               S01117
048100200610     F**********  TABTE20F                          KIGNORE               S01117
048200200610     F*           TABTG10F                          KIGNORE
048300200610     F**********  TABTG20F                          KIGNORE               S01117
048400200610     F**********  TABLETHF                          KIGNORE               S01117
048500200610     F**** HOLS **TABLETJF                          KIGNORE               S01232
048600200610     F**********  TABLETKF                          KIGNORE               S01117
048700200610     F**********  TABLETLF                          KIGNORE               S01117
048800200610     F**********  TABLETNF                          KIGNORE               S01117
048900200610     F**********  TABLETPF                          KIGNORE               S01117
049000200610     F*           TABLETRF                          KIGNORE
049100200610     F**********  TABLETXF                          KIGNORE               S01117
049200200610     F**********  TABLET2F                          KIGNORE               S01117
049300200610     F**********  TABLET3F                          KIGNORE               S01117
049400200610     F**********  TABLET5F                          KIGNORE               S01117
049500200610     FSECOND  IF  E           K        DISK
049600200610     F*SEDEV**IF**E           K        DISK                               E14576
049700200610     FSEDEV   IF  E           K        DISK                               E19918
049800200610     FSECEO   IF  E           K        DISK                               S01232
049900200610     F            SEDEVDF                           KRENAMESEDEVDO        S01232
050000200610     F            SNDEVDF                           KRENAMESNDEVDO        S01232
050100200610     FSEERALL2IF  E           K        DISK                           UC  S01496
050200200610     FSEERALL5IF  E           K        DISK                           UC  S01496
050300200610     FSDCURRL0IF  E           K        DISK                               S01117
050400200610     F/COPY WNCPYSRC,SE0220F001
050500200610      /EJECT
050600200610     F*****************************************************************
050700200610     F*                                                               *
050800200610     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
050900200610     F*                                                               *
051000200610     F*   01        RETURN TO PREVIOUS PROGRAM                        *
051100200610     F*                OR ERROR ON SECTY READ                         *
051200200610     F*   02        CLEAR SUBFILE                                     *
051300200610     F*   03        NO DETAILS INDICATOR                              *
051400200610     F*   04        DISPLAY MESSAGE - NO DETAILS TO DISPLAY           *
051500200610     F*   05        DETAILS COMPLETE FOR THIS CUSTOMER                *
051600200610     F*   06        ROLLUP PAST END OF FILE - DISPLAY MESSAGE         *
051700200610     F*   07        ON IN MULTI-BRANCH ENVIRONMENT                    *
051800200610     F*   08        CONTROL DISPLAY OF SELECT FIELD IN SFL            *
051900200610     F*   09        ON IF TRADE DATE VALUATIONS, OFF VOR VALUE        *
052000200610     F*                                                               *
052100200610     F*   10        VLDCMDKY INDICATOR FOR DISPLAY FILE               *
052200200610     F*                                                               *
052300200610     F*   20        ROLLUP                                            *   S01179
052400200610     F*   21        HELP                                              *   S01179
052500200610     F*   25        SECURITY NOT FOUND, OR NOT LIVE                   *   090501
052600200610     F*                                                               *   S01179
052700200610     F*   29        CUST SHORTNAME ENTERED                            *
052800200610     F*   30        CUST NO. ENTERED                                  *
052900200610     F*   33        FIRST TIME IND OER CUSTOMER                       *   E16825
053000200610     F*   40        END OF FILE ON SUBFILE READ                       *
053100200610     F*   41        REVERSE IMAGE CUST NO./SHORTNAME FIELD            *
053200200610     F*   42        DISPLAY ERROR MESSAGE                             *
053300200610     F*   43        REVERSE IMAGE SECURITY FIELD                      *
053400200610     F*   44        REVERSE IMAGE MONTH/YEAR FIELD                    *
053500200610     F*   45        REVERSE IMAGE BRANCH FIELD                        *
053600200610     F*   50        ON IF DETAIL LINE OUTPUT FOR TRADE                *
053700200610     F*   51        MORE DETAILS TO OUTPUT FOR TRADE                  *
053800200610     F*   52        ON IF NEW SECURITY                                *
053900200610     F*   53        SECURITY IS TRADED ON AN AUSTRALIAN YIELD BASIS   *   S01232
054000200610     F*   55        NOMINAL CURRENCY DEC. PLACES 0                    *
054100200610     F*   56        NOMINAL CURRENCY DEC. PLACES 1                    *
054200200610     F*   57        NOMINAL CURRENCY DEC. PLACES 2                    *
054300200610     F*   58        NOMINAL CURRENCY DEC. PLACES 3                    *
054400200610     F****61-64*****REC*IDS*FOR*TDPBV/TDPBT****************************   E32164
054500200610     F*                                                               *   E32164
054600200610     F* Record Identifiers for TDPBV/TDPBT:                           *   E32164
054700200610     F*   60        SEDVPRD0 Format read                              *   CSE041
054800200610     F*   61        HSTTRDF Format read.                              *   E32164
054900200610     F*   62        TRADSDF Format read.                              *   E32164
055000200610     F*   63        DPTMVDF Format read.                              *   E32164
055100200610     F*   64        DPTMVTF Format read.                              *   E32164
055200200610     F*                                                               *   E32164
055300200610     F* Record Identifiers for TDPOV/TDPOT:                           *   E32164
055400200610     F*   72        TRADSDF Format read.                              *   E32164
055500200610     F*   73        DPTMVDF Format read.                              *   E32164
055600200610     F*   74        DPTMVTF Format read.                              *   E32164
055700200610     F*                                                               *   E32164
055800200610     F*   81        END OF FILE ON TRDBV/TRDBT                        *
055900200610     F*   82        NEXT PAGE REQUIRED (CONTROL SFLEND)               *
056000200610     F*   87        CURRENT TRANSACTION GENERATED BY EARLY REDEMP.    *   S01496
056100200610     F*   88        SUBFILE READ FAIL                                 *
056200200610     F*   89        END OF FILE ON TRDBV/TRDBT/END OF SUBFILE PAGE    *
056300200610     F*                                                               *   E32164
056400200610     F****90********WORK*INDICATOR*-*STD*SUBROUTINES*******************   E32164
056500200610     F* 90-99       Used in Standard Subroutines                      *   E32164
056600200610     F*   98        DATE FORMAT INDICATOR FOR ZSYSTM                  *
056700200610     F****99********ERROR*ON*ICDR*1*READ*-*ZSYSTM**********************   S01117
056800200610     F*                                                               *   E32164
056900200610     F*   U7        WITH U8 FOR DATABASE ERROR                        *
057000200610     F*   U8        WITH U7 FOR DATABASE ERROR                        *
057100200610     F*                                                               *
057200200610     F*****************************************************************
057300200610      /EJECT
057400200610     F*****************************************************************
057500200610     F*                                                               *
057600200610     F*  S U B R O U T I N E   I N D E X                              *
057700200610     F*                                                               *
057800200610     F*  ASCHGS  - MOVES VALUES INTO AID - AS400 CONVERSION           *
057900200610     F*  COMMD   - PROCESS COMMAND KEYS, HELD AND ROLLUP/DOWN         *
058000200610     F*  OPTION  - CHECK VALIDITY OF ENTERED OPTION COMBINATIONS      *
058100200610     F*  CUSSEC  - PROCESS ENTERED CUSTOMER NO./SHORTNAME + SECURITY  *
058200200610     F*  SETUP   - PREPARE OUTPUT SCREEN FOR DISPLAY                  *
058300200610     F*  CLEAR   - CLEAR FIELDS AND INDICATORS ON DISPLAY SCREEN      *
058400200610     F*  ROLLUP  - HANDLE ROLLUP WHEN END OF SUBFILE REACHED          *
058500200610     F*  DISP    - ACCUMULATE SECURITY DETAILS FOR DISPLAY            *
058600200610     F*  PROCES  - PROCESS A SECURITY                                 *
058700200610     F*  SUBFIL  - WRITE ACCUMULATED DETAILS TO SUBFILE               *
058800200610     F*  CSPRC   - CALCULATE BOOK PRICE                               *
058900200610     F*  OLCAP   - CALCULATE AVERAGE PRICE                            *
059000200610     F*  LINK    - PROCESS REQUEST FOR LOWER LEVEL ENQUIRY            *
059100200610     F*  RETSR   - END OF PROGRAM PROCESSING                          *
059200200610     F*  FIRST   - FIRST CYCLE PROCESSOMG                             *
059300200610     F*  *PSSR   - SR. TO HANDLE ABNORMAL ERROR CONDITIONS            *   S01117
059400200610     F*                                                               *
059500200610     F***XDATE3**-*CALCULATE*WORKING*DAYS*BACKWARD******************S01232S01195
059600200610     F*  ZBKDT   - CALCULATE WORKING DAYS BACKWARD                    *   S01195
059700200610     F*  ZACCH   - ACCESS HOLIDAY STANDARD SUBROUTINE                 *   S01195
059800200610     F*  ZACCR   - CALCULATE INTEREST ACCRUED BETWEEN 2 DATES         *   S01232
059900200610     F*  ZACCZ   - CALCULATE INTEREST ACCRUED BETWEEN SPECIFIED DATES *   S01232
060000200610     F*  ZCALCD  - CALCULATE LONG TERM CD PRICE FROM INPUT YIELD      *   E39495
060100200610     F*  ZCNSD   - CALCULATE CONSIDERATION                            *   E21002
060200200610     F*  ZCSCTP  - CALCULATE CLIENT'S CONTRACT PRICE                  *
060300200610     F*  ZDATE1,2- FORMAT DATES                                       *
060400200610     F*  ZDAYS   - CALCULATE NO OF DAYS BETWEEN 2 DATES FOR INTEREST  *   E19918
060500200610     F*            CALCULATIONS                                       *   E19918
060600200610     F*  ZDYYR   - CALCULATE NO OF DAYS IN INTEREST YEAR              *   E19918
060700200610     F*  ZEVCD   - CALCULATE EVENT CONTROL DATE                       *   E14576
060800200610     F***ZICD2***-*ACCESS*ICDR2*-*TABTB11******************************   S01117
060900200610     F***ZICDSE**-*ACCESS*ICDSE*-*TABTB36******************************   S01117
061000200610     F*  ZLCD    - DETERMINE PREVIOUS COUPON DATE                     *   E20380
061100200610     F*  ZNCD    - GET NEXT COUPON DATE                               *   E19918
061200200610     F*  ZPRCI   - CONVERTS PRICE INTO PERCENTAGE PRICE               *   E21002
061300200610     F*  ZPRCO   - OUTPUT YIELD AS PERCENTAGE PRICE                   *   E19918
061400200610     F*  ZRATE   - DETERMINE EFFECTIVE RATE                           *   S01232
061500200610     F*  ZSDESC  - FORMAT SECURITY DESCRIPTION                        *
061600200610     F*  ZSEDIT  - EDIT NUMERIC FIELDS FOR OUTPUT                     *
061700200610     F***ZSYSTM**-*ACCESS*ICDR1*-*TABTB10******************************   S01117
061800200610     F*  ZYCE    - SET UP CUM/EX PARAMETER FOR AUSTRALIAN YIELDS      *   S01232
061900200610     F*  ZYLDI   - CONTAINS PARAMETERS FOR ZYIELD SUBROUTINE          *   E21002
062000200610     F*  ZYLDO   - OUTPUT PERCENTAGE PRICE AS YIELD                   *   E19918
062100200610     F*  P001    - CHANGE TRANSACTIONS TYPES                          *   S01496
062200200610     F*                                                               *
062300200610     F*****************************************************************
062400200610      /EJECT
062500200610     E/COPY ZSRSRC,ZDATE2Z1
062600200610     E***/COPY*ZSRSRC,ZDATE6Z1***                                   S01232S01195
062700200610     E/COPY ZSRSRC,ZHOLE                                                  S01195
062800200610     E***/COPY*ZSRSRC,ZNCDZ1***                                           E14576
062900200610     E                    POWER8  1   8  8 4
063000200610     E***********         MSG     1  12 79               Error Messages   E13657
063100200610     E***********         MSG     1  13 79        Error Messages   E13657 E15304
063200200610     E**********          MSG     1  14 79         Error Messages   E15304S01117
063300200610     E***********         MSG     1  16 79         Error Messages   S01117E38086
063400200610     E*********           MSG     1  17 79               Error Messages   E38086 CSE041
063500200610     E*********           MSG     1  18 79               Error Messages   CSE041 CSE039
063600200610     E                    MSG     1  19 79               Error Messages   CSE039
063700200610     E***********         SRECIN    434  1                          E14576E18658
063800200610     E******              SRECIN    500  1                         E18658 S01271
063900200610     E***********         SRECIN    503  1                         S01271 E32164
064000200610     E                    SRECIN    510  1                                E32164
064100200610     E********************ARR        20  3         Error Messages   E16802102644
064200200610     E                    ARR        50  3               Error Messages   102644
064300200610     E/COPY ZSRSRC,ZPOWERZ1
064400200610     E***/COPY*ZSRSRC,ZDAYSZ1***                                          E14576
064500200610     E/COPY ZSRSRC,ZDAYSZ1                                                E19918
064600200610     E/COPY ZSRSRC,ZSDESCZ1
064700200610     E/COPY ZSRSRC,ZSEDITZ1
064800200610     E/COPY ZSRSRC,ZNCDZ1                                          E14576 E19918
064900200610     E                    CPY@    1   1 80
065000200610     E                    ZAD        21  1
065100200610      /EJECT
065200200610     IHSTTRDF     61
065300200610      *                                                                   E32164
065400200610     ITRADSDF     62
065500200610      *                                                                   E32164
065600200610     IDPTMVDF     63
065700200610      *                                                                   E32164
065800200610      ***  Rename fields used from DPTMVD to their Trade (Value Date)     E32164
065900200610      ***  equivalents.                                                   E32164
066000200610      *                                                                   E32164
066100200610     I**********    DPBC                            TDBR                  S01117
066200200610     I              DPBA                            TDBA                  S01117
066300200610     I              DPBN                            TCNR
066400200610     I              DPSS                            TDSS
066500200610     I              DPRN                            TDRF
066600200610     I              DPNA                            NOML
066700200610     I**********    DPMD                            TDVD                                     BUG2507
066800200610     I              DPMV                            TDTP                  E32164
066900200610     I              MKTP                            PRIC                  E32164
067000200610     I              DPVD                            TDVD                                     BUG2507
067100200610     I              DMTD                            TDDT                                     BUG2507
067200200610      *                                                                   E32164
067300200610     IDPTMVTF     64
067400200610     I**********    DPBC                            TDBR                  S01117
067500200610     I              DPBA                            TDBA                  S01117
067600200610     I              DPBN                            TCNR
067700200610     I              DPSS                            TDSS
067800200610     I              DPRN                            TDRF
067900200610     I              DPNA                            NOML
068000200610     I**********    DPDO                            TDVD                                     BUG2507
068100200610     I              DPMV                            TDTP                  E32164
068200200610     I              MKTP                            PRIC                  E32164
068300200610     I              DPVD                            TDVD                                     BUG2507
068400200610     I              DMTD                            TDDT                                     BUG2507
068500200610      *                                                                   E32164
068600200610     ISEDVPRD0    60                                                      CSE041
068700200610     I              DVBRCA                          TDBA                  CSE041
068800200610     I              DVCNUM                          TCNR                  CSE041
068900200610     I              DVSESN                          TDSS                  CSE041
069000200610     I              DVREF                           TDRF                  CSE041
069100200610     I              DVNOML                          NOML                  CSE041
069200200610     I              DVVDAT                          TDVD                  CSE041
069300200610     I              DVTYPE                          TDTP                  CSE041
069400200610     I              DVPDY                           PRIC                  CSE041
069500200610     I              DVSETC                          SETC                  CSE041
069600200610      *                                                                   CSE041
069700200610     IHSTTRDAF    61
069800200610      *                                                                   E32164
069900200610     ITRADSDAF    62
070000200610      *                                                                   E32164
070100200610     IDPTMVDAF    63
070200200610      *                                                                   E32164
070300200610      ***  Rename fields used from DPTMVD to their Trade (Trade Date)     E32164
070400200610      ***  equivalents.                                                   E32164
070500200610      *                                                                   E32164
070600200610     I**********    DPBC                            TDBR                  S01117
070700200610     I              DPBA                            TDBA                  S01117
070800200610     I              DPBN                            TCNR
070900200610     I              DPSS                            TDSS
071000200610     I              DPRN                            TDRF
071100200610     I              DPNA                            NOML
071200200610     I**********    DPMD                            TDDT                                     BUG2507
071300200610     I              DPMV                            TDTP                  E32164
071400200610     I              MKTP                            PRIC                  E32164
071500200610     I              DPVD                            TDVD                                     BUG2507
071600200610     I              DMTD                            TDDT                                     BUG2507
071700200610      *                                                                   E32164
071800200610     IDPTMVTAF    64
071900200610     I**********    DPBC                            TDBR                  S01117
072000200610     I              DPBA                            TDBA                  S01117
072100200610     I              DPBN                            TCNR
072200200610     I              DPSS                            TDSS
072300200610     I              DPRN                            TDRF
072400200610     I              DPNA                            NOML
072500200610     I**********    DPDO                            TDDT                                     BUG2507
072600200610     I              DPMV                            TDTP                  E32164
072700200610     I              MKTP                            PRIC                  E32164
072800200610     I              DPVD                            TDVD                                     BUG2507
072900200610     I              DMTD                            TDDT                                     BUG2507
073000200610      *                                                                   E32164
073100200610     ISEDVPRAF    60                                                      CSE041
073200200610     I              DVBRCA                          TDBA                  CSE041
073300200610     I              DVCNUM                          TCNR                  CSE041
073400200610     I              DVSESN                          TDSS                  CSE041
073500200610     I              DVREF                           TDRF                  CSE041
073600200610     I              DVNOML                          NOML                  CSE041
073700200610     I              DVTDAT                          TDDT                  CSE041
073800200610     I              DVTYPE                          TDTP                  CSE041
073900200610     I              DVPDY                           PRIC                  CSE041
074000200610     I              DVSETC                          SETC                  CSE041
074100200610      *                                                                   CSE041
074200200610     ITRADSDVF    72                                                      E14576
074300200610      *                                                                   E32164
074400200610     IDPTMVDVF    73                                                      E14576
074500200610      *                                                                   E32164
074600200610      ***  Rename fields used from DPTMVD to their Trade (Value Date)     E32164
074700200610      ***  equivalents.                                                   E32164
074800200610      *                                                                   E32164
074900200610     I**********    DPBC                            TDBR           E14576 S01117
075000200610     I              DPBA                            TDBA                  S01117
075100200610     I              DPBN                            TCNR                  E14576
075200200610     I              DPSS                            TDSS                  E14576
075300200610     I              DPRN                            TDRF                  E14576
075400200610     I              DPNA                            NOML                  E14576
075500200610     I**********    DPMD                            TDVD                              E14576 BUG2507
075600200610     I              DPMV                            TDTP                  E32164
075700200610     I              MKTP                            PRIC                  E32164
075800200610     I              DPVD                            TDVD                                     BUG2507
075900200610     I              DMTD                            TDDT                                     BUG2507
076000200610      *                                                                   E32164
076100200610     IDPTMVTVF    74                                                      E14576
076200200610     I**********    DPBC                            TDBR            E14576S01117
076300200610     I              DPBA                            TDBA                  S01117
076400200610     I              DPBN                            TCNR                  E14576
076500200610     I              DPSS                            TDSS                  E14576
076600200610     I              DPRN                            TDRF                  E14576
076700200610     I              DPNA                            NOML                  E14576
076800200610     I***********   DPDO                            TDVD                              E14576 BUG2507
076900200610     I              DPMV                            TDTP                  E32164
077000200610     I              MKTP                            PRIC                  E32164
077100200610     I              DPVD                            TDVD                                     BUG2507
077200200610     I              DMTD                            TDDT                                     BUG2507
077300200610      *                                                                   CSE041
077400200610     ISEDVPRVF    71                                                      CSE041
077500200610     I              DVBRCA                          TDBA                  CSE041
077600200610     I              DVCNUM                          TCNR                  CSE041
077700200610     I              DVSESN                          TDSS                  CSE041
077800200610     I              DVREF                           TDRF                  CSE041
077900200610     I              DVNOML                          NOML                  CSE041
078000200610     I              DVVDAT                          TDVD                  CSE041
078100200610     I              DVTYPE                          TDTP                  CSE041
078200200610     I              DVPDY                           PRIC                  CSE041
078300200610     I              DVSETC                          SETC                  CSE041
078400200610      *                                                                   E32164
078500200610     ITRADSDTF    72                                                      E14576
078600200610      *                                                                   E32164
078700200610     IDPTMVDTF    73                                                      E14576
078800200610      *                                                                   E32164
078900200610      ***  Rename fields used from DPTMVD to their Trade (Trade Date)     E32164
079000200610      ***  equivalents.                                                   E32164
079100200610      *                                                                   E32164
079200200610     I**********    DPBC                            TDBR            E14576S01117
079300200610     I              DPBA                            TDBA                  S01117
079400200610     I              DPBN                            TCNR                  E14576
079500200610     I              DPSS                            TDSS                  E14576
079600200610     I              DPRN                            TDRF                  E14576
079700200610     I              DPNA                            NOML                  E14576
079800200610     I**********    DPMD                            TDDT                              E14576 BUG2507
079900200610     I              DPMV                            TDTP                  E32164
080000200610     I              MKTP                            PRIC                  E32164
080100200610     I              DPVD                            TDVD                                     BUG2507
080200200610     I              DMTD                            TDDT                                     BUG2507
080300200610      *                                                                   E32164
080400200610     IDPTMVTTF    74                                                      E14576
080500200610     I**********    DPBC                            TDBR            E14576S01117
080600200610     I              DPBA                            TDBA                  S01117
080700200610     I              DPBN                            TCNR                  E14576
080800200610     I              DPSS                            TDSS                  E14576
080900200610     I              DPRN                            TDRF                  E14576
081000200610     I              DPNA                            NOML                  E14576
081100200610     I***********   DPDO                            TDDT                              E14576 BUG2507
081200200610     I              DPMV                            TDTP                  E32164
081300200610     I              MKTP                            PRIC                  E32164
081400200610     I              DPVD                            TDVD                                     BUG2507
081500200610     I              DMTD                            TDDT                                     BUG2507
081600200610      *                                                                   E32164
081700200610     ISEDVPRTF    71                                                      CSE041
081800200610     I              DVBRCA                          TDBA                  CSE041
081900200610     I              DVCNUM                          TCNR                  CSE041
082000200610     I              DVSESN                          TDSS                  CSE041
082100200610     I              DVREF                           TDRF                  CSE041
082200200610     I              DVNOML                          NOML                  CSE041
082300200610     I              DVTDAT                          TDDT                  CSE041
082400200610     I              DVTYPE                          TDTP                  CSE041
082500200610     I              DVPDY                           PRIC                  CSE041
082600200610     I              DVSETC                          SETC                  CSE041
082700200610      *                                                                   CSE041
082800200610     I*SEDEVDF******                                                      E14576
082900200610     I**************NMCY                            NMCYXX                E14576
083000200610     ISEDEVDF                                                             E19918
083100200610     I              NMCY                            NMCYXX                E19918
083200200610     I*                                                                   S01117
083300200610     I***/COPY*ZSRSRC,ZNCDZ2***                                           E14576
083400200610     I/COPY ZSRSRC,ZNCDZ2                                                 E19918
083500200610     I/COPY ZSRSRC,ZSDESCZ2
083600200610      *                                                                   E32164
083700200610     IRECIN     E DSTRADSD                                                E14576
083800200610      *                                                                   E32164
083900200610     I            DS                                                      E14576
084000200610     I***********                             1 434 SRECIN                E18658
084100200610     I***********                             1 500 SRECIN         E18658 S01271
084200200610     I***********                             1 503 SRECIN         S01271 E32164
084300200610     I                                        1 510 SRECIN                E32164
084400200610     I*
084500200610     I*LDA********UDS                            256                      S01117
084600200610     ILDA         DS                            256                       S01117
084700200610     I*
084800200610     I***  Local data area.
084900200610     I*
085000200610     I**********                            134 138 DBFILE                S01117
085100200610     I**********                            139 167 DBKEY                 S01117
085200200610     I**********                            168 175 DBPGM                 S01117
085300200610     I**********                            176 1770DBASE                 S01117
085400200610     I                                      134 141 DBFILE                S01117
085500200610     I                                      142 170 DBKEY                 S01117
085600200610     I                                      171 180 DBPGM                 S01117
085700200610     I                                      181 1830DBASE                 S01117
085800200610     I*
085900200610     I*********** DS                                                      E32164
086000200610      *                                                                   E32164
086100200610      ***  SELCRI field was wrong length. As it is the whole Data         E32164
086200200610      ***  Structure, it should be the name of the Data Structure.        E32164
086300200610      ***  The same applies to the other Data Structures below.           E32164
086400200610      *                                                                   E32164
086500200610     ISELCRI      DS                                                      E32164
086600200610      *
086700200610      ***  Data Structure over selection criteria.                        E32164
086800200610     I***********                             1  26 SELCRI                E32164
086900200610     I                                        1  10 CUSTMR
087000200610     I                                       11  14 MNTHYR
087100200610     I                                       15  24 SECSNM
087200200610     I                                       25  27 BRANCH
087300200610     I*
087400200610     I*********** DS                                                      E32164
087500200610     IMNWORK      DS                                                      E32164
087600200610     I*
087700200610     I*   DATA STRUCTURE OVER INPUT MONTH/YEAR
087800200610     I***********                             1   4 MNWORK                E32164
087900200610     I                                        1   2 MNTH
088000200610     I                                        1   20MNTHP
088100200610     I                                        3   4 YR
088200200610     I                                        3   40YRP
088300200610     I*
088400200610     I*********** DS                                                      E32164
088500200610     IDAYWK       DS                                                      E32164
088600200610     I*
088700200610     I*   DATA STRUCTURE FOR DATE MANIPULATIONS
088800200610     I***********                             1   6 DAYWK                 E32164
088900200610     I                                        1   20DD
089000200610     I                                        3   40MM
089100200610     I                                        5   60YY
089200200610     I*
089300200610     I*********** DS                                                      E32164
089400200610     IZZMNYR      DS                                                      E32164
089500200610     I*
089600200610     I*   DATA STRUCTURE OVER CALCULATED MONTH/YEAR
089700200610     I***********                             1   4 ZZMNYR                E32164
089800200610     I                                        1   20ZZMNTH
089900200610     I                                        3   40ZZYR
090000200610     I*
090100200610     I*********** DS                                                      E32164
090200200610     IBFLIN       DS                             74                       E32164
090300200610     I*
090400200610     I*   DATA STRUCTURES FOR SETTING UP SFL LINES
090500200610      *                                                                   E32164
090600200610      ***  Brought Forward Line.                                          E32164
090700200610     I***********                             1  74 BFLIN                 E32164
090800200610     I                                        1   7 BFDATE
090900200610     I                                        9  15 BFREV                 E14576
091000200610     I                                       17  19 BF
091100200610     I***********                            20  33 SBFNOM                E21026
091200200610     I                                       21  34 SBFNOM                E21026
091300200610     I                                       35  48 SBFPR
091400200610     I                                       49  49 BFP
091500200610     I                                       51  51 BFBVI
091600200610     I                                       53  55 BFCUR
091700200610     I                                       57  73 BFBVAL
091800200610      *                                                                   E32164
091900200610     I*********** DS                                                      E32164
092000200610     IDETLN       DS                             74                       E32164
092100200610      *                                                                   E32164
092200200610      ***  Detail Line.                                                   E32164
092300200610     I***********                             1  74 DETLN                 E32164
092400200610     I                                        1   7 STDDT
092500200610     I                                        9  15 STDVD
092600200610     I                                       17  19 STYPE
092700200610     I                                       20  34 SNOML
092800200610     I                                       35  48 SDTPR
092900200610     I                                       49  49 DTP
093000200610     I                                       53  55 SSETC
093100200610     I                                       57  73 STCTR
093200200610      *                                                                   E32164
093300200610     I*********** DS                                                      E32164
093400200610     ICFLIN       DS                             74                       E32164
093500200610      *                                                                   E32164
093600200610      ***  Carried Forward Line.                                          E32164
093700200610     I***********                             1  74 CFLIN                 E32164
093800200610     I                                        1   7 SRUNA
093900200610     I                                       17  19 CF
094000200610     I***********                            20  33 SCFNOM                E21026
094100200610     I                                       21  34 SCFNOM                E21026
094200200610     I                                       35  48 SCFPR
094300200610     I                                       49  49 CFP
094400200610     I                                       51  51 CFBVI
094500200610     I                                       53  55 SNMCY
094600200610     I                                       57  73 CFBVAL
094700200610     I            DS
094800200610     I*
094900200610     I**  DS to drop last 3 dps of prices
095000200610     I*
095100200610     I                                        1  21 ZOUT21
095200200610     I                                        1  18 Z21L3
095300200610     I            DS                                                      E13657
095400200610     I*
095500200610     I**  DS TO TEST DEPOT MOVEMENT OR TRADE                              E13657
095600200610     I**  AND SECURITY                                                    E38086
095700200610     I*
095800200610     I                                        1  74 MOVTP                 E13657
095900200610     I                                       17  19 TESTP                 E13657
096000200610     I                                       42  74 IFSEC                 E38086
096100200610     I*
096200200610     IJNSTAT     UDS                            200
096300200610     I*
096400200610     I*   JNSTAT DATA AREA
096500200610     I                                    P 103 1050PRUN
096600200610     I*
096700200610     I**  LINK ENQUIRY DATA AREA
096800200610     ISESDS     E DS
096900200610     IPSDS       SDS
097000200610     I                                        1  10 PROGRM
097100200610     I                                      244 246 WSID
097200200610     ISCRDS       DS
097300200610     I                                      287 288 AID
097400200610     I**     DATA STRUCTURE FOR ZSEDIT SUBROUTINE
097500200610     I/COPY ZSRSRC,ZSEDITZ2
097600200610     I            DS
097700200610     I                                        1  21 WORKAD
097800200610     I                                        1  21 ZAD
097900200610     I**                                                                  S01117
098000200610     IRUNDT       DS                                                      S01117
098100200610     I** DATA AREA RUNDAT                                                 S01117
098200200610     I                                        1   7 RUNA                  S01117
098300200610     I                                    P   8  100RUND                  S01117
098400200610     I                                       11  11 SSF                   S01117
098500200610     I                                       12  12 DATF                  S01117
098600200610     I                                       13  13 MBIN                  S01117
098700200610     I**                                                                  S01117
098800200610     IZMUSER      DS                             17                       S01117
098900200610     I** DATA AREA OF MENU USER                                           S01117
099000200610     I                                       11  13 USRBCH                S01117
099100200610     I**                                                                  S01117
099200200610     I***SDBANK****E*DSSDBANKPD***                                 S01117 E32164
099300200610     I***Bank*Details********************************************* S01117 E32164
099400200610     I**                                                                  S01117
099500200610     ISDBRCH    E DSSDBRCHPD                                              S01117
099600200610     I** Branch Details                                                   S01117
099700200610     I**                                                                  S01117
099800200610     ISDCURR    E DSSDCURRPD                                              S01117
099900200610     I** Currency Details                                                 S01117
100000200610     I**                                                                  S01117
100100200610     ISDCUST    E DSSDCUSTPD                                              S01117
100200200610     I              QQDFAC                          #DFAC1                                    CGL029
100300200610     I** Customer Details                                                 S01117
100400200610     I**                                                                  S01117
100500200610     I***SDGELR****E*DSSDGELRPD***                                 S01117 E32164
100600200610     I***General*Ledger*Details*********************************** S01117 E32164
100700200610     I**                                                                  S01117
100800200610     ISDSECS    E DSSDSECSPD                                              S01117
100900200610     I** Security Customer Details                                        S01117
101000200610     I**                                                                  S01117
101100200610     ISDSTRD    E DSSDSTRDPD                                              S01117
101200200610     I** Security Trading Details                                         S01117
101300200610     I**                                                                  S01117
101400200610     IDSFDY     E DSDSFDY                                                 S01117
101500200610     I** FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE               S01117
101600200610     I**                                                                  S01117
101700200610     IDSSDY     E DSDSSDY                                                 S01117
101800200610     I** SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE               S01117
101900200610     I**                                                                  S01117
102000200610     IDSLDY     E DSDSLDY                                                 CSD007
102100200610      ** Third DS for access programs, very long data structure           CSD007
102200200610      *                                                                   CSD007
102300200610     ICPYR@#      DS
102400200610     I*
102500200610     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
102600200610     I                                        1  80 CPY@
102700200610     I                                        1  20 CPY@##
102800200610      *                                                                   CSE041
102900200610     I              'SEDPMVSIN'           C         DPPGM                 CSE041
103000200610      ** Program to call for Depot Movements                              CSE041
103100200610      *                                                                   CSE039
103200200610     I              'SEMVTSSIN'           C         MVPGM                 CSE039
103300200610      ** Parameter for SEC025 to call Movement Status program             CSE039
103400200610     I**
103500200610     I***/COPY*ZSRSRC,ZYLDZ1                                              E14576
103600200610     I/COPY ZSRSRC,ZYLDZ1                                                 E19918
103700200610     I/COPY ZSRSRC,ZHOLI                                                  S01195
103800200610     I/COPY WNCPYSRC,SE0220I001
103900200610     C/EJECT
104000200610      *================================================================
104100200610      *  P R O G R A M   S T A R T                                    *
104200200610      *================================================================
104300200610      *
104400200610     C           *NAMVAR   DEFN           SESDS
104500200610     C           *NAMVAR   DEFN           LDA
104600200610     C           *NAMVAR   DEFN           JNSTAT
104700200610     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
104800200610     C           *NAMVAR   DEFN           ZMUSER                          S01117
104900200610     C********** *LIKE     DEFN CDP       NMCDP                           S01117
105000200610     C********** *LIKE     DEFN CDP       PFCDP                      16825S01117
105100200610     C********** *LIKE     DEFN CDP       XNMCDP                     16825S01117
105200200610     C           *LIKE     DEFN A6NBDP    NMCDP                           S01117
105300200610     C           *LIKE     DEFN A6NBDP    PFCDP                      16825S01117
105400200610     C           *LIKE     DEFN A6NBDP    XNMCDP                     16825S01117
105500200610     C           *LIKE     DEFN TDBK      SVTDBK
105600200610     C           *LIKE     DEFN DELT      SVDELT
105700200610     C           *LIKE     DEFN CDNT      ZZPUR
105800200610     C           *LIKE     DEFN CDNT      ZZSALS                          E14576
105900200610     C           *LIKE     DEFN CDNT      ZZPCHS                          E14576
106000200610     C           *LIKE     DEFN CDNT      ZZWIS                           E14576
106100200610     C           *LIKE     DEFN CDNT      ZZWOS                           E14576
106200200610     C           *LIKE     DEFN CDNT      ZZRVS                           CSE041
106300200610     C           *LIKE     DEFN CDNT      ZZDPS                           CSE041
106400200610     C           *LIKE     DEFN CDNT      ZZTOT                           E14576
106500200610     C           *LIKE     DEFN CDNT      ZZSAL
106600200610     C           *LIKE     DEFN CDNT      ZZAPS
106700200610     C           *LIKE     DEFN CDNT      ZZAPP
106800200610     C           *LIKE     DEFN CDNT      ZZAPC
106900200610     C           *LIKE     DEFN PPRC      ZZAPW
107000200610     C           *LIKE     DEFN CDNT      ZNOMP
107100200610     C           *LIKE     DEFN CDNT      ZNNOMP
107200200610     C           *LIKE     DEFN CDNT      ZZNOML
107300200610     C           *LIKE     DEFN CDNT      ZZNOMB                          E14576
107400200610     C           *LIKE     DEFN CDNT      ZZNOMU
107500200610     C           *LIKE     DEFN CDNT      WNOML
107600200610     C           *LIKE     DEFN DDTE      THEDAT
107700200610     C           *LIKE     DEFN DDTE      ORDAT                           E14576
107800200610     C************LIKE     DEFN PRIC      ZPRICE                   E14576 E19918
107900200610     C           *LIKE     DEFN TDBK      BKBLK
108000200610      *
108100200610      ***  Key List for LF/CPOSH.                                         E32164
108200200610      *                                                                   E32164
108300200610     C           KEYH      KLIST
108400200610     C                     KFLD           SAVBR
108500200610     C                     KFLD           TDSS
108600200610     C                     KFLD           PCUST
108700200610     C                     KFLD           THEDAT
108800200610      *
108900200610      ***  Key List for LF/PRICR using TDSS.                              E32164
109000200610      *                                                                   E32164
109100200610     C           KEYP      KLIST
109200200610     C                     KFLD           TDSS
109300200610     C                     KFLD           SAVBR
109400200610     C                     KFLD           MARKET
109500200610     C                     KFLD           BKBLK
109600200610     C                     KFLD           PCUST
109700200610     C                     KFLD           PPRT
109800200610      *
109900200610      ***  Key List for LF/PRICR using SAVSEC.                            E32164
110000200610      *                                                                   E32164
110100200610     C           SKEYP     KLIST
110200200610     C                     KFLD           SAVSEC
110300200610     C                     KFLD           SAVBR
110400200610     C                     KFLD           MARKET
110500200610     C                     KFLD           BKBLK
110600200610     C                     KFLD           PCUST
110700200610     C                     KFLD           PPRT
110800200610      *
110900200610      ***  Key List for LF/CDEPP.                                         E32164
111000200610      *                                                                   E32164
111100200610     C           SKEYH     KLIST
111200200610     C                     KFLD           SAVBR
111300200610     C                     KFLD           PCUST
111400200610     C                     KFLD           SAVSEC
111500200610      *
111600200610      ***  Key List for LF/PRICR using SAVSEC and Previous Run Date.      E32164
111700200610      *                                                                   E32164
111800200610     C           SKEYPP    KLIST
111900200610     C                     KFLD           SAVSEC
112000200610     C                     KFLD           SAVBR
112100200610     C                     KFLD           MARKET
112200200610     C                     KFLD           BKBLK
112300200610     C                     KFLD           PCUST
112400200610     C                     KFLD           PPRT
112500200610     C                     KFLD           PRUN
112600200610      *
112700200610      ***  Key List for LF/PRICR using SAVSEC and Run Date.               E32164
112800200610      *                                                                   E32164
112900200610     C           SKEYPD    KLIST
113000200610     C                     KFLD           SAVSEC
113100200610     C                     KFLD           SAVBR
113200200610     C                     KFLD           MARKET
113300200610     C                     KFLD           BKBLK
113400200610     C                     KFLD           PCUST
113500200610     C                     KFLD           PPRT
113600200610     C                     KFLD           RUND
113700200610      *
113800200610      ***  Key List for LF/CPOSN.                                         E32164
113900200610      *                                                                   E32164
114000200610     C           SKEYCP    KLIST
114100200610     C                     KFLD           SAVBR
114200200610     C                     KFLD           SAVSEC
114300200610     C                     KFLD           PCUST
114400200610      *
114500200610      ***  Key List for LF/TDPBT, LF/TDPBV with TDSS/THEDAT.              E32164
114600200610      *                                                                   E32164
114700200610     C           KEYT      KLIST
114800200610     C                     KFLD           SAVBR
114900200610     C                     KFLD           PCUST
115000200610     C                     KFLD           TDSS
115100200610     C                     KFLD           THEDAT
115200200610      *
115300200610      ***  Key List for LF/TDPBT, LF/TDPBV - Partial.                     E32164
115400200610      *                                                                   E32164
115500200610     C           TDPK1     KLIST                                          E13541
115600200610     C                     KFLD           SAVBR                           E13541
115700200610     C                     KFLD           PCUST                           E13541
115800200610      *
115900200610      ***  Key List for LF/TDPBT, LF/TDPBV with CHKSEC.                   E32164
116000200610      *                                                                   E32164
116100200610     C           TDPK2     KLIST                                          E13541
116200200610     C                     KFLD           SAVBR                           E13541
116300200610     C                     KFLD           PCUST                           E13541
116400200610     C                     KFLD           CHKSEC                          E13541
116500200610      *
116600200610      ***  Key List for LF/TDPOT, LF/TDPOV.                               E32164
116700200610      *                                                                   E32164
116800200610     C           KPOSEC    KLIST                                          E14576
116900200610     C                     KFLD           SAVBR                           E14576
117000200610     C                     KFLD           PCUST                           E14576
117100200610     C                     KFLD           TDSS                            E14576
117200200610     C                     KFLD           ORDAT                           E14576
117300200610     C*                                                                   S01232
117400200610     C* Key to access investment types                                    S01232
117500200610     C*                                                                   S01232
117600200610     C           INVKA     KLIST                                          S01232
117700200610     C                     KFLD           NMCY                            S01232
117800200610     C                     KFLD           SITP                            S01232
117900200610     C**
118000200610     C**  DO FIRST CYCLE PROCESSING
118100200610     C**
118200200610     C                     EXSR FIRST
118300200610     C**
118400200610     C**  MAIN PROCESSING    -    Do until end of job requested
118500200610     C**
118600200610     C           *IN01     DOWEQ'0'
118700200610     C**
118800200610     C**    Display the screen
118900200610     C**
119000200610     C                     WRITESE0220F0
119100200610     C                     EXFMTSE0220C0
119200200610     C**
119300200610     C** Call S/R to move values into AID                                 S01179
119400200610     C*                                                                   S01179
119500200610     C                     EXSR ASCHGS                                    S01179
119600200610     C*                                                                   S01179
119700200610     C**    Clear the error messages unless HELP pressed
119800200610     C**
119900200610     C           AID       IFNE 'HP'
120000200610     C                     MOVE *BLANKS   ERMSG  79
120100200610     C                     SETOF                     414243
120200200610     C***********          SETOF                     4445                 E16825
120300200610     C                     SETOF                     444533               E16825
120400200610     C                     END
120500200610     C**
120600200610     C**    Check Command Keys - including HELP
120700200610     C**
120800200610     C                     EXSR COMMD
120900200610     C**
121000200610     C**    If Enter has been pressed check validity of options
121100200610     C**
121200200610     C           AID       IFEQ 'RA'
121300200610     C**
121400200610     C**    Check Validity of Option Combinations
121500200610     C**                   Either Cust OR Select must be entered
121600200610     C**                   Only one select must be entered
121700200610     C**
121800200610     C                     EXSR OPTION
121900200610     C**
122000200610     C           *IN42     IFEQ '0'
122100200610     C*
122200200610     C**If*no*Branch*entered,*use*default*from*TABICD*file*************** S01117
122300200610     C* If no Branch entered, use default from ZMUSER                     S01117
122400200610     C*
122500200610     C           BRANCH    IFEQ '   '
122600200610     C********** BRANCH    OREQ '000'                                     S01117
122700200610     C**********           MOVELDSTB      BRANCH                          S01117
122800200610     C                     MOVELUSRBCH    BRANCH                          S01117
122900200610     C                     END
123000200610     C**
123100200610     C**    Check if a new cust number or shortname entered
123200200610     C**
123300200610     C           SELCRI    IFNE *BLANKS
123400200610     C                     EXSR CHKSEL                                    S01117
123500200610     C           @SEL      IFEQ 'N'                                       S01117
123600200610     C                     EXSR CUSSEC
123700200610     C                     END                                            S01117
123800200610     C                     END
123900200610     C**
124000200610     C**    Lower Level Enquiry Selected - only possible if details
124100200610     C**
124200200610     C           OPTN      IFNE *BLANK
124300200610     C                     EXSR LINK
124400200610     C                     SETOF                     41                   E13484
124500200610     C                     END
124600200610     C**
124700200610     C                     END
124800200610     C                     END
124900200610      ***  End of Do While *IN01 = '0'.                                   E32164
125000200610     C                     END
125100200610      *                                                                   E32164
125200200610     C           EAUDIT    TAG
125300200610      *
125400200610      *================================================================
125500200610      *  Return to calling program                                    *
125600200610      *                                                               *
125700200610     C                     EXSR RETSR
125800200610      *                                                               *
125900200610      *================================================================
126000200610      /EJECT
126100200610     C*****************************************************************
126200200610     C**                                                              *
126300200610     C**    COMMD   SR   To process Command Keys                      *
126400200610     C**                 and HELP, ROLLUP and ROLLDOWN                *
126500200610     C**                                                              *
126600200610     C**    Called  By   MAIN                                         *
126700200610     C**    Calls   SR   ROLLUP, CLEAR, CUSSEC                        *
126800200610     C**    Calls  PGM   MHELP, SE0270,  SE0240                       *
126900200610     C**                                                              *
127000200610     C*****************************************************************
127100200610     C**
127200200610     C           COMMD     BEGSR                           ** COMMD **
127300200610     C**
127400200610     C*****If*HELP*pressed*call*help*screen****************************   S01199
127500200610     C***********                                                         S01199
127600200610     C***********AID       IFEQ 'HP'                                      S01199
127700200610     C***********          CALL 'MHELP'                                   S01199
127800200610     C***********          PARM           PGMNO                           S01199
127900200610     C***********          PARM           HERCD 160                       S01199
128000200610     C***********          END                                            S01199
128100200610     C**
128200200610     C**    If Rollup key pressed
128300200610     C**
128400200610     C           AID       IFEQ 'UP'
128500200610     C***********          EXSR ROLLUP                                    E31752
128600200610      *                                                                   E31752
128700200610      ***  Check for Rollup beyond last page.                             E31752
128800200610      *                                                                   E31752
128900200610     C           *IN05     IFEQ '1'                                       E31752
129000200610     C                     MOVE '1'       *IN06                           E31752
129100200610      *                                                                   E31752
129200200610      ***  Else load the next page of the Subfile.                        E31752
129300200610      *                                                                   E31752
129400200610     C                     ELSE                                           E31752
129500200610     C                     Z-ADDTOP       SFLREC                          E31752
129600200610     C                     EXSR DISP                                      E31752
129700200610     C                     END                                            E31752
129800200610      *                                                                   E31752
129900200610     C                     END
130000200610     C**
130100200610     C**    If F3 then exit to menu - return code 1 and end
130200200610     C**
130300200610     C           AID       IFEQ '01'
130400200610     C                     MOVE '1'       RTNC
130500200610     C                     MOVE '1'       *IN01
130600200610     C                     END
130700200610     C**
130800200610     C**    If F12 then return to previous enquiry - return code 2
130900200610     C**                  unless there is no previous enquiry
131000200610     C**
131100200610     C           AID       IFEQ '02'
131200200610     C           ORIG      IFNE PGMNO
131300200610     C                     MOVE '2'       RTNC
131400200610     C                     MOVE '1'       *IN01
131500200610     C                     ELSE
131600200610     C                     MOVE '1'       *IN42
131700200610     C                     MOVE MSG,6     ERMSG
131800200610     C                     END
131900200610     C                     END
132000200610     C**
132100200610     C**    If F5 then refresh enquiry screen
132200200610     C**
132300200610     C           AID       IFEQ '05'
132400200610     C                     EXSR CLEAR
132500200610     C                     END
132600200610     C**
132700200610     C**    If F6 then call Customer Shortname Enquiry
132800200610     C**    or security short name enquiry or report error
132900200610     C**    On return check return code
133000200610     C**    if 0 then Database Error and exit required
133100200610     C**    if 1 then F3 and exit to menu required
133200200610     C**    otherwise retrieve customer or security shortname
133300200610     C**
133400200610     C           AID       IFEQ '06'
133500200610     C                     MOVE *BLANKS   ERMSG  79
133600200610     C                     SETOF                     404142
133700200610     C                     SETOF                     434445
133800200610     C           CUSTMR    IFNE *BLANKS
133900200610     C           SECSNM    ANDNE*BLANKS
134000200610     C                     SETON                     414243
134100200610     C                     MOVE MSG,12    ERMSG
134200200610     C                     ELSE
134300200610     C           CUSTMR    IFEQ *BLANKS
134400200610     C                     OUT  SESDS
134500200610     C**********           OUT  LDA                                       S01117
134600200610     C                     CALL 'SE0270'
134700200610     C********** *LOCK     IN   LDA                                       S01117
134800200610     C           *LOCK     IN   SESDS
134900200610     C           RTNC      IFEQ '0'
135000200610     C           RTNC      OREQ '1'
135100200610     C                     MOVE '1'       *IN01
135200200610     C                     ELSE
135300200610     C                     MOVE MNTHYR    MTHYR2  4                       E23128
135400200610     C                     MOVE SECSNM    SESNM2 10                       E23128
135500200610     C                     MOVE BRANCH    BRNCH2  3                       E23128
135600200610     C                     EXSR CLEAR                                     E15334
135700200610     C                     MOVE MTHYR2    MNTHYR                          E23128
135800200610     C                     MOVE SESNM2    SECSNM                          E23128
135900200610     C                     MOVE BRNCH2    BRANCH                          E23128
136000200610     C                     MOVELRQCUST    CUSTMR
136100200610     C                     MOVE *BLANKS   RQCUST
136200200610     C                     END
136300200610      *
136400200610     C                     ELSE
136500200610     C                     MOVE '6'       RTNC
136600200610     C                     OUT  SESDS
136700200610     C**********           OUT  LDA                                       S01117
136800200610     C                     CALL 'SE0240'
136900200610     C********** *LOCK     IN   LDA                                       S01117
137000200610     C           *LOCK     IN   SESDS
137100200610     C           RTNC      IFEQ '0'
137200200610     C           RTNC      OREQ '1'
137300200610     C                     MOVE '1'       *IN01
137400200610     C                     ELSE
137500200610     C                     MOVELRQSESN    SECSNM
137600200610     C                     MOVE *BLANKS   RQSESN
137700200610     C           *IN07     IFEQ '0'
137800200610     C                     EXSR CHKSEL                                    S01117
137900200610     C           @SEL      IFEQ 'N'                                       S01117
138000200610     C                     EXSR CUSSEC
138100200610     C                     END                                            S01117
138200200610     C                     END
138300200610     C                     END
138400200610     C                     END
138500200610     C                     END
138600200610     C                     END
138700200610     C**
138800200610     C**     If F9 then return to initial enquiry - return code 7
138900200610     C**                   unless this is the initial program
139000200610     C**
139100200610     C           AID       IFEQ '07'
139200200610     C           ORIG      IFNE PGMNO
139300200610     C                     MOVE '7'       RTNC
139400200610     C                     MOVE '1'       *IN01
139500200610     C                     ELSE
139600200610     C                     MOVE '1'       *IN42
139700200610     C                     MOVE MSG,6     ERMSG
139800200610     C                     END
139900200610     C                     END
140000200610     C**
140100200610     C                     ENDSR
140200200610     C**
140300200610     C*****************************************************************
140400200610      /EJECT
140500200610     C*****************************************************************
140600200610     C**           ****** AS400 CONVERSION ******                     *   S01179
140700200610     C**                                                              *   S01179
140800200610     C** ASCHGS S/R TO MOVE THE APPROPRIATE VALUES INTO FIELD AID,    *   S01179
140900200610     C** DEPENDING ON WHICH FUNCTION KEY HAS BEEN PRESSED.            *   S01179
141000200610     C** CALLED FROM UPDATE                                           *   S01179
141100200610     C**                                                              *   S01179
141200200610     C*****************************************************************   S01179
141300200610     C*                                                                   S01179
141400200610     C           ASCHGS    BEGSR                                          S01179
141500200610     C*                                                                   S01179
141600200610     C* If ENTER pressed, the VLDCMDKEY indicator will be off             S01179
141700200610     C*                                                                   S01179
141800200610     C           *IN10     IFEQ '0'                                       S01179
141900200610     C                     MOVE 'RA'      AID                             S01179
142000200610     C                     END                                            S01179
142100200610     C*                                                                   S01179
142200200610     C* If F3                                                             S01179
142300200610     C*                                                                   S01179
142400200610     C           *INKC     IFEQ '1'                                       S01179
142500200610     C                     MOVE '01'      AID                             S01179
142600200610     C                     MOVE '0'       *INKC                           S01179
142700200610     C                     END                                            S01179
142800200610     C*                                                                   S01179
142900200610     C* If F5                                                             S01179
143000200610     C*                                                                   S01179
143100200610     C           *INKE     IFEQ '1'                                       S01179
143200200610     C                     MOVE '05'      AID                             S01179
143300200610     C                     MOVE '0'       *INKE                           S01179
143400200610     C                     END                                            S01179
143500200610     C*                                                                   S01179
143600200610     C* If F6                                                             S01179
143700200610     C*                                                                   S01179
143800200610     C           *INKF     IFEQ '1'                                       S01179
143900200610     C                     MOVE '06'      AID                             S01179
144000200610     C                     MOVE '0'       *INKF                           S01179
144100200610     C                     END                                            S01179
144200200610     C*                                                                   S01179
144300200610     C* If F9                                                             S01179
144400200610     C*                                                                   S01179
144500200610     C           *INKI     IFEQ '1'                                       S01179
144600200610     C                     MOVE '07'      AID                             S01179
144700200610     C                     MOVE '0'       *INKI                           S01179
144800200610     C                     END                                            S01179
144900200610     C*                                                                   S01179
145000200610     C* If F12                                                            S01179
145100200610     C*                                                                   S01179
145200200610     C           *INKL     IFEQ '1'                                       S01179
145300200610     C                     MOVE '02'      AID                             S01179
145400200610     C                     MOVE '0'       *INKL                           S01179
145500200610     C                     END                                            S01179
145600200610     C*                                                                   S01179
145700200610     C* If ROLLUP pressed                                                 S01179
145800200610     C*                                                                   S01179
145900200610     C           *IN20     IFEQ '1'                                       S01179
146000200610     C                     MOVE 'UP'      AID                             S01179
146100200610     C                     MOVE '0'       *IN20                           S01179
146200200610     C                     END                                            S01179
146300200610     C*                                                                   S01179
146400200610     C**If*HELP*key*pressed*************************************** S01179 S01199
146500200610     C***********                                                  S01179 S01199
146600200610     C************IN21     IFEQ '1'                                S01179 S01199
146700200610     C***********          MOVE 'HP'      AID                      S01179 S01199
146800200610     C***********          MOVE '0'       *IN21                    S01179 S01199
146900200610     C***********          END                                     S01179 S01199
147000200610     C*                                                                   S01179
147100200610     C                     ENDSR                                          S01179
147200200610     C*                                                                   S01179
147300200610     C*****************************************************************
147400200610      /EJECT
147500200610      *                                                                   E31752
147600200610      ***  Moved the simple If/Else statement to where it belongs.        E31752
147700200610      *                                                                   E31752
147800200610     C*****************************************************************   E31752
147900200610     C*****************************************************************   E31752
148000200610     C*****ROLLUP*SR**When*Rollup*key*is*pressed*load*next*page*unless*   E31752
148100200610     C****************last*page*already*displayed*when*error*message***   E31752
148200200610     C*****************************************************************   E31752
148300200610     C*****Called*by**COMMD********************************************   E31752
148400200610     C*****Calls**SR**DISP*********************************************   E31752
148500200610     C*****************************************************************   E31752
148600200610     C*****************************************************************   E31752
148700200610     C***********                                                         E31752
148800200610     C***********ROLLUP    BEGSR                           ** ROLLUP **   E31752
148900200610     C***********                                                         E31752
149000200610     C*****If*details*Complete*then*Rollup*is*beyond*last*record*******   E31752
149100200610     C***********                                                         E31752
149200200610     C************IN05     IFEQ '1'                                       E31752
149300200610     C***********          MOVE '1'       *IN06                           E31752
149400200610     C***********                                                         E31752
149500200610     C***********          ELSE                                           E31752
149600200610     C***********                                                         E31752
149700200610     C*****Load*next*page*of*subfile***********************************   E31752
149800200610     C***********                                                         E31752
149900200610     C***********          Z-ADDTOP       SFLREC                          E31752
150000200610     C***********          EXSR DISP                                      E31752
150100200610     C***********                                                         E31752
150200200610     C***********          END                                            E31752
150300200610     C***********                                                         E31752
150400200610     C***********          ENDSR                                          E31752
150500200610     C***********                                                         E31752
150600200610     C*****************************************************************   E31752
150700200610      /EJECT
150800200610     C*****************************************************************
150900200610     C**                                                              *
151000200610     C**   OPTION SR  To check validity of option combinations        *
151100200610     C**                                                              *
151200200610     C**   Called by  MAIN                                            *
151300200610     C**   Calls  SR  none                                            *
151400200610     C**                                                              *
151500200610     C*****************************************************************
151600200610     C**
151700200610     C           OPTION    BEGSR                            ** OPTION *
151800200610     C**
151900200610     C                     MOVE *BLANKS   OPTN
152000200610     C**
152100200610     C**  If no subfile records the only possible entry is customer
152200200610     C**
152300200610     C           *IN03     IFEQ '1'
152400200610     C**
152500200610     C           CUSTMR    IFEQ *BLANKS
152600200610     C                     MOVE '1'       *IN42
152700200610     C                     MOVE MSG,1     ERMSG
152800200610     C                     END
152900200610     C**
153000200610     C                     ELSE
153100200610     C**
153200200610     C                     READCSE0220S0                 40
153300200610     C**                                                                  E13657
153400200610     C                     MOVE SLINE     MOVTP                           E13657
153500200610     C**
153600200610     C**     Check if any entry made
153700200610     C**
153800200610     C           *IN40     IFEQ '1'
153900200610     C           CUSTMR    ANDEQ*BLANKS
154000200610     C                     MOVE '1'       *IN42
154100200610     C                     MOVE MSG,7     ERMSG
154200200610     C                     END
154300200610     C**
154400200610     C**     Check if both Cust No./Shortname and option entered
154500200610     C**
154600200610     C           *IN40     IFEQ '0'
154700200610     C           CUSTMR    ANDNE*BLANKS
154800200610     C           SELECT    ANDNE*BLANKS                                   E15707
154900200610     C                     MOVE '1'       *IN42
155000200610     C                     MOVE '1'       *IN41
155100200610     C                     MOVE MSG,2     ERMSG
155200200610     C                     END
155300200610     C**
155400200610     C**    Check if more than one option entered
155500200610     C**
155600200610     C           *IN40     IFEQ '0'
155700200610     C           SELECT    ANDNE*BLANKS                                   E15707
155800200610     C                     MOVE SELECT    OPTN
155900200610     C                     MOVELSSESN     RQSESN
156000200610     C                     MOVE *BLANK    SELECT
156100200610     C                     MOVE STDRF     RQTDRF
156200200610     C                     MOVE STCNR     RQCUST                          E16063
156300200610     C                     SETOF                     08
156400200610     C                     UPDATSE0220S0
156500200610     C**
156600200610     C**    Check if Trades enquiry selected for Depot movement           E13657
156700200610     C**    And if Trades enquiry selected for Security                   E38086
156800200610     C**                                                                  E13657
156900200610     C/COPY WNCPYSRC,SE0220C004
157000200610     C           *IN40     IFEQ '0'                                       E13657
157100200610     C           OPTN      ANDEQ' 2'                                      E13657
157200200610     C           *IN40     OREQ '0'                                       CSE039
157300200610     C           OPTN      ANDEQ' 4'                                      CSE039
157400200610     C           CSE039    ANDEQ'Y'                                       CSE039
157500200610     C/COPY WNCPYSRC,SE0220C009
157600200610     C           TESTP     IFEQ 'WI '                                     E13657
157700200610     C           CSE041    ANDEQ'N'                                       CSE041
157800200610     C           CSE039    ANDEQ'N'                                       CSE039
157900200610     C           TESTP     OREQ 'WO '                                     E13657
158000200610     C           CSE041    ANDEQ'N'                                       CSE041
158100200610     C           CSE039    ANDEQ'N'                                       CSE039
158200200610     C/COPY WNCPYSRC,SE0220C010
158300200610     C**********           MOVE MSG,13    ERMSG                           E13657              214953
158400200610     C**********           SETON                     42                   E13657              214953
158500200610     C                     MOVEL'22'      OPTN                                                214953
158600200610     C/COPY WNCPYSRC,SE0220C001
158700200610     C                     END                                            E13657
158800200610     C/COPY WNCPYSRC,SE0220C011
158900200610     C           IFSEC     IFEQ *BLANK                                    E38086
159000200610     C                     MOVE MSG,17    ERMSG                           E38086
159100200610     C                     SETON                     42                   E38086
159200200610     C                     END                                            E38086
159300200610     C                     END                                            E13657
159400200610     C**
159500200610     C           *IN40     DOUEQ'1'
159600200610     C                     READCSE0220S0                 40
159700200610     C           *IN40     IFEQ '0'
159800200610     C                     MOVE *BLANK    SELECT
159900200610     C                     UPDATSE0220S0
160000200610     C                     MOVE '1'       *IN42
160100200610     C                     MOVE MSG,3     ERMSG
160200200610     C                     END
160300200610     C**
160400200610     C                     END
160500200610     C                     END
160600200610     C                     END
160700200610     C**
160800200610     C                     ENDSR
160900200610     C**
161000200610     C*****************************************************************
161100200610      /EJECT
161200200610     C*****************************************************************
161300200610     C**                                                              *
161400200610     C**   CUSSEC SR  To process entered Selection fields             *
161500200610     C**                                                              *
161600200610     C**   Called by  MAIN, FIRST                                     *
161700200610     C**   Calls  SR  SETUP                                           *
161800200610     C**                                                              *
161900200610     C*****************************************************************
162000200610     C**
162100200610     C           CUSSEC    BEGSR                            ** CUSSEC *
162200200610     C**
162300200610     C                     SETOF                     4142
162400200610     C                     SETOF                     434445
162500200610     C**
162600200610     C***Access*customer*record*-**(SNAME*or*CLINT)********************   S01117
162700200610     C*******error*if*not*on*file*or*deleted***************************   S01117
162800200610     C********** CUSTMR    CHAINSNAME                25                   S01117
162900200610     C********** *IN25     IFEQ '0'                                       S01117
163000200610     C********** RECI      IFEQ '*'                                       S01117
163100200610     C**********           SETON                     25                   S01117
163200200610     C**********           ELSE                                    E19986 S01117
163300200610     C**********           MOVE CNUM      CUSTNO                   E19986 S01117
163400200610     C**********           END                                            S01117
163500200610     C**********           END                                            S01117
163600200610     C***********                                                         S01117
163700200610     C***********          MOVELCUSTMR    CUSTNO  60               E15304 E19986
163800200610     C***25*****           MOVELCUSTMR    CUSTNO  60               E19986 S01117
163900200610     C********** *IN25     IFEQ '1'                                       S01117
164000200610     C***********          MOVELCUSTMR    CUSTNO  60                      E15304
164100200610     C********** CUSTNO    CHAINCLINTCBF             25                   S01117
164200200610     C********** *IN25     IFEQ '0'                                       S01117
164300200610     C********** RECI      IFEQ '*'                                       S01117
164400200610     C**********           SETON                     25                   S01117
164500200610     C**********           END                                            S01117
164600200610     C**********           END                                            S01117
164700200610     C********** *IN25     IFEQ '1'                                       S01117
164800200610      *                                                                   S01117
164900200610      ***  Access customer record - SDSECSPD AND SDCUSTPD.                S01117
165000200610      ***  Error if not on file.                                          S01117
165100200610      *                                                                   S01117
165200200610     C                     MOVELCUSTMR    @CKEY                           S01117
165300200610     C***********          CALL 'AOCUSTR0'                         S01117 CSD007
165400200610     C                     CALL 'AOCUSTR2'                                CSD007
165500200610     C                     PARM *BLANKS   @RTCD   7                       S01117
165600200610     C                     PARM '*KEY   ' @OPTN   7                       S01117
165700200610     C                     PARM           @CKEY  10                       S01117
165800200610     C                     PARM *BLANKS   @KYST   7                       S01117
165900200610     C***********SDCUST    PARM SDCUST    DSSDY                    S01117 CSD007
166000200610     C           SDCUST    PARM SDCUST    DSLDY                           CSD007
166100200610      *                                                                   S01117
166200200610     C           @RTCD     IFNE *BLANKS                                   S01117
166300200610     C           CSD007    ANDNE'Y'                                       CSD007
166400200610      *                                                                   CSD007
166500200610     C           @RTCD     ORNE *BLANKS                                   CSD007
166600200610     C           @RTCD     ANDEQ'*NRF   '                                 CSD007
166700200610     C           BBDTDL    ANDNE*ZEROS                                    CSD007
166800200610     C           CSD007    ANDEQ'Y'                                       CSD007
166900200610      *                                                                   CSD007
167000200610     C           @RTCD     ORNE *BLANKS                                   CSD007
167100200610     C           @RTCD     ANDNE'*NRF   '                                 CSD007
167200200610     C           CSD007    ANDEQ'Y'                                       CSD007
167300200610      *                                                                   CSD007
167400200610     C                     SETON                     4142
167500200610     C                     MOVE MSG,5     ERMSG
167600200610     C                     GOTO ECUSSE
167700200610     C                     END
167800200610      *                                                                   S01117
167900200610     C                     MOVELBBCUST    @SKEY                           S01117
168000200610     C**********           END                                            S01117
168100200610     C*                                                                   E15304
168200200610     C* Check for a Portfolio Client                                      E15304
168300200610     C*                                                                   E15304
168400200610     C********** CUSTNO    CHAINCLINTSEF             26             E15304S01117
168500200610     C                     CALL 'AOSECSR0'                                S01117
168600200610     C                     PARM *BLANKS   @RTCD                           S01117
168700200610     C                     PARM '*KEY   ' @OPTN                           S01117
168800200610     C                     PARM           @SKEY   6                       S01117
168900200610     C           SDSECS    PARM SDSECS    DSSDY                           S01117
169000200610     C********** *IN26     IFEQ '0'                                 E15304S01117
169100200610     C           @RTCD     IFEQ *BLANKS                                   S01117
169200200610     C********** C1DI      IFNE 'D'                                 E15304S01117
169300200610     C********** C1DI      ANDNE'S'                                 E15304S01117
169400200610     C           BFCLAS    IFNE 'D'                                 E15304S01117
169500200610     C           BFCLAS    ANDNE'S'                                 E15304S01117
169600200610     C                     SETON                     4142                 E15304
169700200610     C                     MOVE MSG,14    ERMSG                           E15304
169800200610     C                     GOTO ECUSSE                                    E15304
169900200610     C                     END                                            E15304
170000200610     C                     ELSE                                           E19986
170100200610     C                     SETON                     4142                 E19986
170200200610     C                     MOVE MSG,14    ERMSG                           E19986
170300200610     C                     GOTO ECUSSE                                    E19986
170400200610     C                     END                                            E15304
170500200610     C**
170600200610     C** Month/year if entered -
170700200610     C**  month must be 01-12: year must be 00-99
170800200610     C**  must not be earlier than date calculated in FIRST
170900200610     C**
171000200610     C                     MOVE *BLANKS   LSTCLE  7
171100200610     C                     Z-ADD0         LSTCDE  50
171200200610      *                                                                   E32164
171300200610     C           MNTHYR    IFNE *BLANKS
171400200610     C                     MOVE MNTHYR    MNWORK
171500200610      *                                                                   E32164
171600200610     C           MNTH      IFLT '01'
171700200610     C           MNTH      ORGT '12'
171800200610     C                     SETON                     4244
171900200610     C                     MOVE MSG,9     ERMSG
172000200610     C                     GOTO ECUSSE
172100200610      *                                                                   E32164
172200200610     C                     ELSE
172300200610     C           YR        IFLT '00'
172400200610     C           YR        ORGT '99'
172500200610     C                     SETON                     4244
172600200610     C                     MOVE MSG,9     ERMSG
172700200610     C                     GOTO ECUSSE
172800200610      *                                                                   E32164
172900200610     C                     ELSE
173000200610     C           YRP       IFLT ZZYR
173100200610     C/COPY WNCPYSRC,SE0220C012
173200200610     C                     SETON                     4244
173300200610     C                     MOVE MSG,10    ERMSG
173400200610     C                     GOTO ECUSSE
173500200610      *                                                                   E32164
173600200610     C                     ELSE
173700200610     C           YRP       IFEQ ZZYR
173800200610     C           MNTHP     ANDLTZZMNTH
173900200610     C/COPY WNCPYSRC,SE0220C013
174000200610     C                     SETON                     4244
174100200610     C                     MOVE MSG,10    ERMSG
174200200610     C                     GOTO ECUSSE
174300200610      *                                                                   E32164
174400200610     C                     ELSE
174500200610     C**
174600200610     C**  Calculate ddmmmyy date of last calendar day of month prior
174700200610     C**  to month/year entered (LSTCLE)
174800200610     C**  Set dd to 01, then convert month/year entered to day no
174900200610     C**  Subtract 1 from date (=last day in prev month) &
175000200610     C**  convert this date to ddmmmyy
175100200610     C**
175200200610     C                     MOVE YR        YY
175300200610     C           *IN98     IFEQ '1'
175400200610     C                     MOVE '01'      MM
175500200610     C                     MOVE MNTH      DD
175600200610     C                     ELSE
175700200610     C                     MOVE '01'      DD
175800200610     C                     MOVE MNTH      MM
175900200610     C                     END
176000200610      *                                                                   E32164
176100200610     C                     MOVELDAYWK     ZDATE
176200200610     C                     EXSR ZDATE1
176300200610     C                     SUB  1         ZDAYNO
176400200610     C                     Z-ADDZDAYNO    LSTCDE
176500200610     C                     EXSR ZDATE2
176600200610     C                     MOVE ZADATE    LSTCLE
176700200610     C                     END
176800200610      *                                                                   E32164
176900200610     C                     END
177000200610     C                     END
177100200610     C                     END
177200200610     C                     END
177300200610     C**
177400200610     C** Access security record if security entered -
177500200610     C**     error if not on file or deleted
177600200610      *                                                                   E32164
177700200610     C           SECSNM    IFNE *BLANKS
177800200610     C           SECSNM    CHAINSECTY                25
177900200610     C           *IN25     IFEQ '0'
178000200610     C           RECI      IFEQ '*'
178100200610     C           RECI      OREQ 'C'                                       090501
178200200610     C                     SETON                     25
178300200610     C                     END
178400200610     C                     END
178500200610      *                                                                   E32164
178600200610     C           *IN25     IFEQ '1'
178700200610     C                     SETON                     4342
178800200610     C                     MOVE MSG,11    ERMSG
178900200610     C                     GOTO ECUSSE
179000200610     C                     END
179100200610      *                                                                   E32164
179200200610     C                     END
179300200610     C**
179400200610     C** If multibranch environment -
179500200610     C** If branch entered - Access Branch table record -
179600200610     C**     error if not on file or deleted
179700200610      *                                                                   E32164
179800200610     C           *IN07     IFEQ '1'
179900200610     C**********           MOVE *BLANKS   KEY    12                       S01117
180000200610     C**********           MOVEL'10'      KEY                             S01117
180100200610     C**********           MOVE BRANCH    KEY                             S01117
180200200610     C********** KEY       CHAINTABLETRF             25                   S01117
180300200610     C********** *IN25     IFEQ '0'                                       S01117
180400200610     C********** RECI      IFEQ '*'                                       S01117
180500200610     C**********           SETON                     25                   S01117
180600200610     C**********           END                                            S01117
180700200610     C**********           END                                            S01117
180800200610     C********** *IN25     IFEQ '1'                                       S01117
180900200610      *                                                                   S01117
181000200610     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
181100200610     C                     CALL 'AOBRCHR1'                                                    CGL029
181200200610     C                     PARM *BLANKS   @RTCD                           S01117
181300200610     C                     PARM '*KEY   ' @OPTN                           S01117
181400200610     C                     PARM BRANCH    @BKEY   3                       S01117
181500200610     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
181600200610     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
181700200610     C           @RTCD     IFNE *BLANKS                                   S01117
181800200610     C                     SETON                     4245
181900200610     C                     MOVE MSG,8     ERMSG
182000200610     C                     GOTO ECUSSE
182100200610     C                     END
182200200610     C                     CALL 'ZVBBU'                                   S01117
182300200610     C***********          PARM A8BRCD    ZBRCDX                   S01117 E31583
182400200610     C***********          PARM           @ERR                     S01117 E31583
182500200610     C                     PARM A8BRCD    ZBRCDX  3                       E31583
182600200610     C                     PARM           @ERR    10                      E31583
182700200610     C*                                                                   S01117
182800200610     C           @ERR      IFEQ 1                                         S01117
182900200610     C                     SETON                     4245                 S01117
183000200610     C                     MOVE MSG,15    ERMSG                           S01117
183100200610     C                     GOTO ECUSSE                                    S01117
183200200610     C                     END                                            S01117
183300200610     C*                                                                   S01117
183400200610     C           @ERR      IFEQ 2                                         S01117
183500200610     C                     SETON                     4245                 S01117
183600200610     C                     MOVE MSG,16    ERMSG                           S01117
183700200610     C                     GOTO ECUSSE                                    S01117
183800200610     C                     END                                            S01117
183900200610     C*                                                                   S01117
184000200610     C                     END
184100200610     C**
184200200610     C** All fields valid - prepare to display details -
184300200610     C                     EXSR SETUP
184400200610     C**
184500200610     C           ECUSSE    TAG                             ** ECUSSE TAG**
184600200610     C**
184700200610     C                     ENDSR
184800200610     C**
184900200610     C*****************************************************************
185000200610      /EJECT
185100200610     C*****************************************************************
185200200610     C**                                                              *
185300200610     C**   SETUP  SR  To prepare for Screen Display                   *
185400200610     C**                                                              *
185500200610     C**   Called by  CUSSEC                                          *
185600200610     C**   Calls  SR  CLEAR, DISP                                     *
185700200610     C**                                                              *
185800200610     C*****************************************************************
185900200610     C**
186000200610     C           SETUP     BEGSR                           ** SETUP **
186100200610     C**
186200200610     C**********           MOVE CNUM      PCUST   60                      S01117
186300200610     C**********           MOVE BRANCH    SAVBR   30                      S01117
186400200610     C**********           MOVE BFCUST    PCUST   60                                   S01117 CSD027
186500200610     C                     MOVE BFCUST    PCUST   6                                           CSD027
186600200610     C                     MOVE BRANCH    SAVBR   3                       S01117
186700200610     C                     MOVE SECSNM    CHKSEC 10
186800200610     C**
186900200610     C**   Clear the Screen
187000200610     C**
187100200610     C                     EXSR CLEAR
187200200610     C**
187300200610     C**   Move CUST  Details to output fields
187400200610     C**
187500200610     C                     MOVE PCUST     SCUST
187600200610     C**********           MOVE CRNM      SCRNM  20                       S01117
187700200610     C**********           MOVE CTWN      SCTWN  10                       S01117
187800200610     C                     MOVE BBCRNM    SCRNM  20                       S01117
187900200610     C                     MOVE BBCRTN    SCTWN  10                       S01117
188000200610     C**
188100200610     C********** SAVBR     IFEQ 0                                         S01117
188200200610     C           SAVBR     IFEQ *BLANKS                                   S01117
188300200610     C**********           MOVE DSTB      SAVBR                           S01117
188400200610     C                     MOVE USRBCH    SAVBR                           S01117
188500200610     C                     END
188600200610     C**
188700200610     C* Reset Accumulators for Screen Details                             E14576
188800200610     C*                                                                   E14576
188900200610     C                     Z-ADDRUND      ORDAT                           E14576
189000200610     C**
189100200610     C**   Posn TDPBV/T file at start of reqd customer/branch/sec/date
189200200610     C**                                                                  E14576
189300200610     C                     MOVE CHKSEC    TDSS
189400200610     C           LSTCDE    IFEQ *ZEROS
189500200610     C                     Z-ADDLSTCDR    THEDAT
189600200610     C                     ELSE
189700200610     C                     Z-ADDLSTCDE    THEDAT
189800200610     C                     END
189900200610     C***09******KEYT      SETLLTDPBT                                     E13853
190000200610     C**N09******KEYT      SETLLTDPBV                                     E13853
190100200610     C   09      KEYT      SETGTTDPBT                                     E13853
190200200610     C  N09      KEYT      SETGTTDPBV                                     E13853
190300200610     C                     MOVE SAVBR     SBRCH
190400200610     C**
190500200610     C**   Reset Accumulators for Screen Details
190600200610     C**
190700200610     C                     MOVE *BLANKS   SAVSEC 10
190800200610     C                     Z-ADD*ZEROS    ZZNOML
190900200610     C                     Z-ADD*ZEROS    ZZNOMB                          E14576
191000200610     C                     Z-ADD*ZEROS    ZNOMP
191100200610     C                     Z-ADD*ZEROS    ZZNOMU
191200200610     C                     Z-ADD*ZEROS    ZZPUR
191300200610     C                     Z-ADD*ZEROS    ZZSAL
191400200610     C                     Z-ADD*ZEROS    ZZAPP
191500200610     C                     Z-ADD*ZEROS    ZZAPS
191600200610     C**
191700200610     C**   Get details for display
191800200610     C**
191900200610     C                     EXSR DISP
192000200610     C**
192100200610     C                     ENDSR
192200200610     C**
192300200610     C*****************************************************************
192400200610      /EJECT
192500200610     C*****************************************************************
192600200610     C**                                                              *
192700200610     C**   CLEAR  SR  Clear the screen display fields and indicators  *
192800200610     C**                                                              *
192900200610     C**   Called by  COMMD, SETUP                                    *
193000200610     C**   Calls  SR  none                                            *
193100200610     C**                                                              *
193200200610     C*****************************************************************
193300200610     C**
193400200610     C           CLEAR     BEGSR
193500200610     C**
193600200610     C**  Setup fields and indicators to clear subfile
193700200610     C**
193800200610     C                     MOVE *BLANKS   SCRNM
193900200610     C                     MOVE *BLANKS   SCTWN
194000200610     C                     MOVE *BLANKS   SCUST
194100200610     C                     MOVE *BLANKS   BRANCH
194200200610     C                     MOVE *BLANKS   SBRCH
194300200610     C                     MOVE *BLANKS   SECSNM
194400200610     C                     MOVE *BLANKS   CUSTMR
194500200610     C                     MOVE *BLANKS   MNTHYR
194600200610     C**
194700200610     C                     Z-ADD0         SFLREC  40
194800200610     C                     Z-ADD0         TOP     40
194900200610     C                     Z-ADD0         SFLT                            E13975
195000200610     C                     Z-ADD0         ZZTYPE                          E13975
195100200610     C**
195200200610     C***********          SETON                       035251             E13975
195300200610     C***********          SETOF                       040550             E13975
195400200610     C***********          SETOF                         8189             E13975
195500200610     C                     SETON                     035251               E13975
195600200610     C                     SETOF                     040550               E13975
195700200610     C                     SETOF                       8189               E13975
195800200610     C**  CLEAR SUBFILE
195900200610     C                     SETON                       02
196000200610     C                     WRITESE0220C0
196100200610     C                     SETOF                       02
196200200610     C**
196300200610     C                     ENDSR
196400200610     C**
196500200610     C*****************************************************************
196600200610      /EJECT
196700200610     C*****************************************************************
196800200610     C**                                                              *
196900200610     C**   DISP   SR  Accumulate details for screen display           *
197000200610     C**                                                              *
197100200610     C**   Called by  SETUP, ROLLUP                                   *
197200200610     C**   Calls  SR  PROCES                                          *
197300200610     C**                                                              *
197400200610     C*****************************************************************
197500200610     C**
197600200610     C           DISP      BEGSR                           *** DISP ***
197700200610     C**
197800200610     C                     Z-ADD0         OUTREC  20
197900200610     C                     MOVE '0'       *IN89
198000200610     C**
198100200610     C**  IF STILL PROCESSING SFL RECS - GOTO S/R
198200200610     C           *IN51     IFEQ '0'
198300200610     C                     EXSR PROCES
198400200610     C           OUTREC    IFEQ 14
198500200610     C                     SETON                     89
198600200610     C                     END
198700200610     C                     END
198800200610     C**
198900200610     C** Do while not end of file and more records exist
199000200610     C**
199100200610     C           *IN89     DOWEQ'0'
199200200610     C           *IN51     ANDEQ'1'
199300200610      *                                                                   E32164
199400200610     C           NEXTRD    TAG                             *** NEXTRD  ***
199500200610      *                                                                   E32164
199600200610     C           *IN81     IFEQ '0'
199700200610     C                     SETOF                     616263
199800200610     C                     SETOF                     64
199900200610     C                     SETOF                     60                   CSE041
200000200610     C***09******          READ TDPBT                    81               E13541
200100200610     C**N09******          READ TDPBV                    81               E13541
200200200610      *                                                                   E13541
200300200610     C           SECSNM    IFEQ *BLANKS                                   E13541
200400200610     C   09      TDPK1     READETDPBT                    81               E13541
200500200610     C  N09      TDPK1     READETDPBV                    81               E13541
200600200610     C                     ELSE                                           E13541
200700200610     C   09      TDPK2     READETDPBT                    81               E13541
200800200610     C  N09      TDPK2     READETDPBV                    81               E13541
200900200610     C                     END                                            E13541
201000200610     C*                                                                   E13541
201100200610     C                     END
201200200610     C**
201300200610     C**  End of File - If some records accumulated then write last one
201400200610     C**
201500200610     C           *IN81     IFEQ '1'
201600200610     C           *IN50     IFEQ '1'
201700200610     C                     SETON                     52
201800200610     C                     EXSR PROCES
201900200610      *                                                                   E32164
202000200610     C           OUTREC    IFEQ 14
202100200610     C***********          SETON                     89                   E13541
202200200610     C***********          SETON                     8905           E13541E15306
202300200610     C                     SETON                     89                   E15306
202400200610     C                     GOTO EDLOOP
202500200610     C                     END
202600200610      *                                                                   E32164
202700200610     C                     END
202800200610     C                     SETON                     0589
202900200610     C                     END
203000200610     C**
203100200610     C**  Successful file read of an active record
203200200610     C**
203300200610     C           *IN81     IFEQ '0'
203400200610     C           RECI      IFNE 'C'                                       E13854
203500200610     C           RECI      ANDNE'R'                                       S01269
203600200610     C           RECI      IFNE '*'
203700200610     C           RECI      OREQ '*'                                       E13854
203800200610     C           CHTP      ANDNE'D'                                       E13854
203900200610     C           *IN61     ANDEQ'0'                                       E35915
204000200610     C           *IN62     ANDEQ'0'                                       E35915
204100200610     C***********RECI      ANDNE'C'                                 E13853E13854
204200200610     C**
204300200610     C**  If not correct branch/cust & there have been recs for the
204400200610     C**  required branch/cust then output the last one
204500200610     C**
204600200610     C********** SAVBR     IFNE TDBR                                      S01117
204700200610     C           SAVBR     IFNE TDBA                                      S01117
204800200610     C           PCUST     ORNE TCNR
204900200610     C                     SETON                     8189
205000200610     C**
205100200610     C           *IN50     IFEQ '1'
205200200610     C                     SETON                     52
205300200610     C                     EXSR PROCES
205400200610     C           OUTREC    IFEQ 14
205500200610     C                     SETON                     89
205600200610     C                     GOTO EDLOOP
205700200610     C                     END
205800200610     C           *IN51     IFEQ '1'
205900200610     C                     MOVE '1'       *IN05
206000200610     C                     END
206100200610     C                     END
206200200610     C**
206300200610     C                     ELSE
206400200610     C**
206500200610     C**  If not correct security & there have been recs for the
206600200610     C**  required security then output the last one
206700200610     C**
206800200610     C           CHKSEC    IFNE *BLANKS
206900200610     C           CHKSEC    ANDNETDSS
207000200610     C                     SETON                     8189
207100200610     C**
207200200610     C           *IN50     IFEQ '1'
207300200610     C                     SETON                     52
207400200610     C                     EXSR PROCES
207500200610     C           *IN51     IFEQ '1'
207600200610     C                     MOVE '1'       *IN05
207700200610     C                     END
207800200610     C           OUTREC    IFEQ 14
207900200610     C                     SETOF                     05                   E15706
208000200610     C                     SETON                     89
208100200610     C                     GOTO EDLOOP
208200200610     C                     END
208300200610     C                     END
208400200610     C**
208500200610     C                     ELSE
208600200610     C**
208700200610     C**   show new security
208800200610     C**
208900200610     C           SAVSEC    IFNE *BLANKS
209000200610     C           SAVSEC    ANDNETDSS
209100200610     C                     SETON                     52
209200200610     C                     END
209300200610     C**
209400200610     C**   If sec not selected - check date after date req'd
209500200610     C**
209600200610     C           CHKSEC    IFEQ *BLANKS
209700200610      *                                                                   E32164
209800200610     C           *IN09     IFEQ '1'
209900200610     C           TDDT      ANDLETHEDAT
210000200610     C***********KEYT      SETLLTDPBT                                     E13853
210100200610     C           KEYT      SETGTTDPBT                                     E13853
210200200610     C                     GOTO NEXTRD
210300200610     C                     END
210400200610      *                                                                   E32164
210500200610     C           *IN09     IFEQ '0'
210600200610     C           TDVD      ANDLETHEDAT
210700200610     C***********KEYT      SETLLTDPBV                                     E13853
210800200610     C           KEYT      SETGTTDPBV                                     E13853
210900200610     C                     GOTO NEXTRD
211000200610     C                     END
211100200610      *                                                                   E32164
211200200610     C                     END
211300200610     C**
211400200610     C**   output trade details
211500200610     C**
211600200610     C                     SETOF                     51
211700200610     C                     EXSR PROCES
211800200610     C**
211900200610     C                     END
212000200610     C                     END
212100200610     C**
212200200610     C                     END                                            E13854
212300200610     C                     END
212400200610     C                     END
212500200610     C                     END
212600200610     C**
212700200610     C**    Condition Display of message if no details for branch/cust
212800200610     C**
212900200610     C           EDLOOP    TAG                             ** EDLOOP    **
213000200610      *                                                                   E32164
213100200610     C           SFLREC    IFEQ 0
213200200610     C                     MOVE '1'       *IN04
213300200610     C                     ELSE
213400200610     C**
213500200610     C**    If records written - read next to check if there are more
213600200610     C**
213700200610     C           *IN51     IFEQ '0'
213800200610     C                     SETOF                     82
213900200610      *                                                                   E32164
214000200610     C           OUTREC    IFEQ 14
214100200610     C           *IN05     ANDEQ'0'
214200200610     C           *IN51     ANDEQ'0'
214300200610      *                                                                   E32164
214400200610     C***********ZZTYPE    IFNE 0                                         E20324
214500200610     C           ZZTYPE    IFLE 3                                         E20324
214600200610     C                     SETON                     82
214700200610     C                     ELSE
214800200610     C**
214900200610     C           *IN81     IFEQ '0'
215000200610     C                     SETOF                     616263
215100200610     C                     SETOF                     64
215200200610     C                     SETOF                     60                   CSE041
215300200610      *                                                                   E32164
215400200610     C           RECI      DOUEQ'D'
215500200610     C           RECI      OREQ 'S'                                       E15215
215600200610     C           *IN81     OREQ '1'
215700200610     C   09                READ TDPBT                    81
215800200610     C  N09                READ TDPBV                    81
215900200610     C                     END
216000200610      *                                                                   E32164
216100200610     C           *IN81     IFEQ '0'
216200200610     C           RECI      IFEQ 'D'
216300200610     C           RECI      OREQ 'S'                                       E15215
216400200610     C           TCNR      IFEQ PCUST
216500200610     C********** TDBR      ANDEQSAVBR                                     S01117
216600200610     C           TDBA      ANDEQSAVBR                                     S01117
216700200610     C           CHKSEC    IFNE *BLANKS
216800200610     C           CHKSEC    IFEQ TDSS
216900200610     C                     SETON                     82
217000200610     C                     SETOF                     616263
217100200610     C                     SETOF                     64
217200200610     C                     SETOF                     60                   CSE041
217300200610     C   09                READPTDPBT                    81
217400200610     C  N09                READPTDPBV                    81
217500200610     C                     ELSE
217600200610     C                     SETON                     81
217700200610     C                     END
217800200610     C                     ELSE
217900200610     C                     SETON                     82
218000200610     C                     SETOF                     616263
218100200610     C                     SETOF                     64
218200200610     C                     SETOF                     60                   CSE041
218300200610     C   09                READPTDPBT                    81
218400200610     C  N09                READPTDPBV                    81
218500200610     C                     END
218600200610     C                     END
218700200610     C                     ELSE
218800200610     C                     SETON                     81
218900200610     C                     END
219000200610     C                     END
219100200610     C                     END
219200200610     C                     END
219300200610      *                                                                   E32164
219400200610     C           *IN82     IFEQ '0'
219500200610     C                     SETON                     05
219600200610     C                     END
219700200610      *                                                                   E32164
219800200610     C                     END
219900200610     C                     END
220000200610      *                                                                   E32164
220100200610     C                     MOVE '0'       *IN03
220200200610     C                     END
220300200610     C                     Z-ADDSFLREC    TOP
220400200610     C**
220500200610     C                     ENDSR
220600200610     C**
220700200610     C*****************************************************************
220800200610      /EJECT
2209002006100738 C*****************************************************************
221000200610     C**                                                              *
221100200610     C**   PROCES SR  Process the details for a TRADE                 *
221200200610     C**                                                              *
221300200610     C**   Called by  DISP                                            *
221400200610     C**   Calls  SR  RETSR,SUBFIL                                    *
221500200610     C**                                                              *
221600200610     C*****************************************************************
221700200610     C**
221800200610     C           PROCES    BEGSR                           ** PROCES **
221900200610     C**
222000200610     C           OUTREC    IFGE 14
222100200610     C                     GOTO PEND
222200200610     C                     END
222300200610     C**
222400200610     C** C/F line required  -
222500200610     C**
222600200610     C           *IN50     IFEQ '1'
222700200610     C           *IN52     ANDEQ'1'
222800200610     C**
222900200610     C** Access CDEPP file -
223000200610     C**
223100200610     C                     Z-ADD0         ZZTYPE  10
223200200610     C                     Z-ADD*ZEROS    ZZNOML
223300200610     C                     Z-ADD*ZEROS    ZZNOMB                          E14576
223400200610     C                     Z-ADD*ZEROS    ZZNOMU
223500200610     C                     Z-ADD*ZEROS    ZZPUR
223600200610     C                     Z-ADD*ZEROS    ZZSAL
223700200610     C                     Z-ADD*ZEROS    ZZAPP
223800200610     C                     Z-ADD*ZEROS    ZZAPS
223900200610     C                     Z-ADD*ZEROS    ZNOMP
224000200610      *                                                                   E32164
224100200610     C           SKEYH     SETLLCDEPP                    25
224200200610     C           *IN25     IFEQ '1'
224300200610     C           SKEYH     READECDEPP                    25
224400200610      *                                                                   E32164
224500200610     C           *IN25     DOWEQ'0'
224600200610      *                                                                   E32164
224700200610     C********** TVVL      IFEQ 'T'                                       S01117
224800200610     C           BVTVDV    IFEQ 'T'                                       S01117
224900200610     C                     ADD  CDNT      ZNOMP
225000200610     C                     ADD  CDNT      ZZNOML
225100200610     C                     ADD  SNPT      ZZNOML
225200200610     C                     ADD  CDST      ZZNOML
225300200610     C                     ADD  CDNV      ZZNOMU
225400200610     C                     ADD  CNPV      ZZNOMU
225500200610     C                     ADD  CNSV      ZZNOMU
225600200610     C                     ADD  CDST      ZZSAL
225700200610     C                     ADD  SNPT      ZZPUR
225800200610     C                     ADD  SAPS      ZZAPS
225900200610     C                     ADD  SAPP      ZZAPP
226000200610     C                     ELSE
226100200610     C                     ADD  CDNV      ZNOMP
226200200610     C                     ADD  CDNT      ZZNOMU
226300200610     C                     ADD  SNPT      ZZNOMU
226400200610     C                     ADD  CDST      ZZNOMU
226500200610     C                     ADD  CDNV      ZZNOML
226600200610     C                     ADD  CNPV      ZZNOML
226700200610     C                     ADD  CNSV      ZZNOML
226800200610     C                     ADD  CNSV      ZZSAL
226900200610     C                     ADD  CNPV      ZZPUR
227000200610     C                     ADD  SPSV      ZZAPS
227100200610     C                     ADD  SAPV      ZZAPP
227200200610     C                     END
227300200610      *                                                                   E32164
227400200610     C           SKEYH     READECDEPP                    25
227500200610     C                     END
227600200610     C                     END
227700200610      *                                                                   E31583
227800200610      ***  Field CDPA could contain the incorrect Branch or even be       E31583
227900200610      ***  blank.  The correct Branch has already been tested anyway.     E31583
228000200610     C*                                                                   S01117
228100200610     C***CHECK*USER*HAS*AUTHORITY*TO*BRANCH*IF*MULTIBRANCHING***** S01117 E31583
228200200610     C***********                                                  S01117 E31583
228300200610     C************IN07     IFEQ '1'                                S01117 E31583
228400200610     C***********          CALL 'ZVBBU'                            S01117 E31583
228500200610     C***********          PARM CDPA      ZBRCDX  3                S01117 E31583
228600200610     C***********          PARM           @ERR    10               S01117 E31583
228700200610     C***********          ELSE                                    S01117 E31583
228800200610     C***********          Z-ADD0         @ERR                     S01117 E31583
228900200610     C***********          END                                     S01117 E31583
229000200610     C***********@ERR      IFEQ *ZEROS                             S01117 E31583
229100200610     C*
229200200610     C** Data accessed - fill SFL line & output to SFL
229300200610     C*
229400200610     C                     EXSR SUBFIL
229500200610     C                     SETOF                     5052
229600200610     C           OUTREC    IFGE 14
229700200610     C                     GOTO PEND
229800200610     C                     END
229900200610     C*
230000200610     C** Output blank line
230100200610     C*
230200200610     C                     MOVE *BLANKS   SLINE
230300200610     C                     SETON                     08
230400200610     C                     ADD  1         SFLREC
230500200610     C                     ADD  1         OUTREC
230600200610     C                     WRITESE0220S0
230700200610     C                     SETOF                     5052
230800200610      *                                                                   E32164
230900200610     C           OUTREC    IFGE 14
231000200610     C                     GOTO PEND
231100200610     C                     END
231200200610      *                                                                   E32164
231300200610     C***********          END                                     S01117 E31583
231400200610     C                     END
231500200610     C**
231600200610     C** B/F lines required  -
231700200610     C** First line (security details required)
231800200610     C** Access security & investment type records
231900200610     C**
232000200610     C           *IN50     IFEQ '0'
232100200610     C           *IN51     ANDEQ'0'
232200200610      *                                                                   E32164
232300200610     C           SFLT      IFEQ 0
232400200610     C           TDSS      IFNE *BLANKS
232500200610     C           TDSS      CHAINSECTY                25
232600200610     C**N25******RECI      COMP 'D'                  2525                 E15221
232700200610      *                                                                   E15221
232800200610     C********** *IN25     IFEQ '0'                                E15221 186427
232900200610     C********** RECI      IFNE 'D'                                E15221 186427
233000200610     C********** RECI      ANDNE'M'                                E15221 186427
233100200610     C**********           SETON                     25            E15221 186427
233200200610     C/COPY WNCPYSRC,SE0220C018
233300200610     C**********           END                                     E15221 186427
233400200610     C**********           END                                     E15221 186427
233500200610     C*                                                                   E15221
233600200610     C**  If no record found or deleted record
233700200610     C**  then it is a database error so return to calling
233800200610     C**  program with a return code of '0'
233900200610     C*                                                                   E15221
234000200610     C           *IN25     IFEQ '1'
234100200610     C           *LOCK     IN   LDA                                       S01117
234200200610     C                     MOVELPROGRM    DBPGM
234300200610     C                     MOVELTDSS      DBKEY            ***************
234400200610     C                     MOVE 'SECTY'   DBFILE           * DB ERROR 04 *
234500200610     C                     Z-ADD04        DBASE            ***************
234600200610     C                     SETON                       U7U8
234700200610     C                     OUT  LDA                                       S01117
234800200610     C                     EXSR *PSSR                                     S01117
234900200610     C                     MOVE '0'       RTNC
235000200610     C                     EXSR RETSR
235100200610     C                     END
235200200610     C*                                                                   S01232
235300200610     C***  Indicate if an Australian Yield Traded security                S01232
235400200610     C*                                                                   S01232
235500200610     C                     ELSE                                           S01232
235600200610     C           STBS      IFEQ 'Y'                                       S01232
235700200610     C           SYBS      ANDEQ'AU'                                      S01232
235800200610     C                     SETON                     53                   S01232
235900200610     C                     ELSE                                           S01232
236000200610     C                     SETOF                     53                   S01232
236100200610     C                     END                                            S01232
236200200610     C*                                                                   S01232
236300200610     C           INVKA     CHAININVTPDF              33                   S01232
236400200610     C  N33      RECI      COMP '*'                      33               S01232
236500200610     C*                                                                   S01232
236600200610     C**  If no record found or deleted record                            S01232
236700200610     C**  then it is a database error so return to calling                S01232
236800200610     C**  program with a return code of '0'                               S01232
236900200610     C*                                                                   S01232
237000200610     C           *IN33     IFEQ '1'                                       S01232
237100200610     C           *LOCK     IN   LDA                                       S01117
237200200610     C                     MOVELNMCY      WORK6A  6                       S01232
237300200610     C                     MOVE SITP      WORK6A                          S01232
237400200610     C                     MOVELWORK6A    DBKEY                           S01232
237500200610     C                     MOVELPROGRM    DBPGM            ***************S01232
237600200610     C                     MOVE 'INVTP'   DBFILE           * DB ERROR 08 *S01232
237700200610     C                     Z-ADD08        DBASE            ***************S01232
237800200610     C                     SETON                       U7U8               S01232
237900200610     C                     OUT  LDA                                       S01117
238000200610     C                     EXSR *PSSR                                     S01117
238100200610     C                     MOVE '0'       RTNC                            S01232
238200200610     C                     EXSR RETSR                                     S01232
238300200610     C                     END                                            S01232
238400200610     C*                                                                   S01232
238500200610     C                     END
238600200610     C                     ADD  1         SFLT
238700200610     C**
238800200610     C** Data accessed - fill SFL line & output to SFL
238900200610     C**
239000200610     C                     Z-ADD1         ZZTYPE  10
239100200610     C                     EXSR SUBFIL
239200200610     C           OUTREC    IFGE 14
239300200610     C                     GOTO PEND
239400200610     C                     END
239500200610     C                     END
239600200610     C**
239700200610     C** B/F line required
239800200610     C** Access CPOSH file -
239900200610     C           SFLT      IFEQ 1
240000200610     C           KEYH      SETGTCPOSH
240100200610     C                     READPCPOSH                    25
240200200610      *                                                                   E32164
240300200610     C           *IN25     IFEQ '0'
240400200610     C********** SAVBR     IFEQ CSBR                                      S01117
240500200610     C           SAVBR     IFEQ CSBA                                      S01117
240600200610     C           TDSS      ANDEQCSSC
240700200610     C           PCUST     ANDEQCSCN
240800200610      *                                                                   E32164
240900200610     C********** TVVL      IFEQ 'T'                                       S01117
241000200610     C           BVTVDV    IFEQ 'T'                                       S01117
241100200610     C                     Z-ADDCSNT      ZNOMP
241200200610     C                     Z-ADDCSNT      ZZNOML
241300200610     C                     Z-ADDCSNV      ZZNOMU
241400200610     C                     ELSE
241500200610     C                     Z-ADDCSNV      ZNOMP
241600200610     C                     Z-ADDCSNT      ZZNOMU
241700200610     C                     Z-ADDCSNV      ZZNOML
241800200610     C                     END
241900200610      *                                                                   E32164
242000200610     C                     ELSE
242100200610     C                     Z-ADD*ZEROS    CSPT
242200200610     C                     Z-ADD*ZEROS    CSPV
242300200610     C                     Z-ADD*ZEROS    CSDA
242400200610     C                     Z-ADD*ZEROS    ZZNOML
242500200610     C                     Z-ADD*ZEROS    ZZNOMU
242600200610     C                     Z-ADD*ZEROS    ZNOMP
242700200610     C                     END
242800200610      *                                                                   E32164
242900200610     C                     END
243000200610     C*                                                                   E14576
243100200610     C*  SAVE DETAILS OF CURRENT TRADE BEING PROCESSED (TO RESTORE LATER) E14576
243200200610     C*                                                                   E14576
243300200610     C                     MOVEARECIN     SRECIN                          E14576
243400200610     C*                                                                   E14576
243500200610     C* IF BACKVALUED TRADES ENTERED TODAY WITH TRADE/VALUE DATE          E14576
243600200610     C* EARLIER THAN START OF MONTH ENQUIRY INCLUDE THEM IN B/F LINE      E14576
243700200610     C* AVERAGE PRICE FOR B/F LINE IS NOT CHANGED                         E14576
243800200610     C*                                                                   E14576
243900200610     C                     Z-ADD0         ZZPCHS                          E14576
244000200610     C                     Z-ADD0         ZZSALS                          E14576
244100200610     C                     Z-ADD0         ZZWIS                           E14576
244200200610     C                     Z-ADD0         ZZWOS                           E14576
244300200610     C                     Z-ADD0         ZZRVS                           CSE041
244400200610     C                     Z-ADD0         ZZDPS                           CSE041
244500200610     C*                                                                   E14576
244600200610     C   09      KPOSEC    SETLLTDPOT                                     E14576
244700200610     C  N09      KPOSEC    SETLLTDPOV                                     E14576
244800200610     C*                                                                   E14576
244900200610     C                     SETOF                     7374                 E14576
245000200610     C                     SETOF                     71                   CSE041
245100200610     C   09      KPOSEC    READETDPOT                    11               E14576
245200200610     C  N09      KPOSEC    READETDPOV                    11               E14576
245300200610     C*                                                                   E14576
245400200610     C           *IN11     DOWEQ'0'                                       E14576
245500200610     C*                                                                   E14576
245600200610     C           RECI      IFNE '*'                                       E14576
245700200610     C           RECI      ANDNE'C'                                       E14576
245800200610     C           RECI      ANDNE'R'                                       S01269
245900200610     C*                                                                   E14576
246000200610     C           *IN09     IFEQ '1'                                       E14576
246100200610     C           TDDT      ANDLTTHEDAT                                    E14576
246200200610     C           *IN09     OREQ '0'                                       E14576
246300200610     C           TDVD      ANDLTTHEDAT                                    E14576
246400200610     C*
246500200610     C* trades                                                            E14576
246600200610     C*
246700200610     C           *IN73     IFEQ '0'                                       E14576
246800200610     C           *IN74     ANDEQ'0'                                       E14576
246900200610     C           TDTP      IFEQ 'TS'                                      E14576
247000200610     C                     ADD  NOML      ZZSALS                          E14576
247100200610     C                     ELSE                                           E14576
247200200610     C                     ADD  NOML      ZZPCHS                          E14576
247300200610     C                     END                                            E14576
247400200610     C                     END                                            E14576
247500200610     C*
247600200610     C* depot movements                                                   E14576
247700200610     C*
247800200610     C           *IN73     IFEQ '1'                                       E14576
247900200610     C                     ADD  NOML      ZZWIS                           E14576
248000200610     C                     END                                            E14576
248100200610     C           *IN74     IFEQ '1'                                       E14576
248200200610     C                     ADD  NOML      ZZWOS                           E14576
248300200610     C                     END                                            E14576
248400200610      *                                                                   CSE041
248500200610      * DVP/RVP movements                                                 CSE041
248600200610      *                                                                   CSE041
248700200610     C           *IN71     IFEQ '1'                                       CSE041
248800200610     C           TDTP      IFEQ 'RV'                                      CSE041
248900200610     C                     ADD  NOML      ZZRVS                           CSE041
249000200610     C                     ELSE                                           CSE041
249100200610     C                     ADD  NOML      ZZDPS                           CSE041
249200200610     C                     ENDIF                                          CSE041
249300200610     C                     ENDIF                                          CSE041
249400200610     C*                                                                   E14576
249500200610     C                     END                                            E14576
249600200610     C*                                                                   E14576
249700200610     C                     END                                            E14576
249800200610     C                     SETOF                     7374                 E14576
249900200610     C                     SETOF                     71                   CSE041
250000200610     C   09      KPOSEC    READETDPOT                    11               E14576
250100200610     C  N09      KPOSEC    READETDPOV                    11               E14576
250200200610     C                     END                                            E14576
250300200610     C*                                                                   E14576
250400200610     C                     ADD  ZZSALS    ZZNOMB                          E14576
250500200610     C                     SUB  ZZPCHS    ZZNOMB                          E14576
250600200610     C                     ADD  ZZWIS     ZZNOMB                          E14576
250700200610     C                     SUB  ZZWOS     ZZNOMB                          E14576
250800200610     C                     ADD  ZZRVS     ZZNOMB                          CSE041
250900200610     C                     SUB  ZZDPS     ZZNOMB                          CSE041
251000200610     C                     MOVEASRECIN    RECIN                           E14576
251100200610      *                                                                   E31583
251200200610      ***  Field CSBA could contain the incorrect Branch or even be       E31583
251300200610      ***  blank.  The correct Branch has already been tested anyway.     E31583
251400200610     C*                                                                   S01117
251500200610     C***CHECK*USER*HAS*AUTHORITY*TO*BRANCH*IF*MULTIBRANCHING***** S01117 E31583
251600200610     C***********                                                  S01117 E31583
251700200610     C************IN07     IFEQ '1'                                S01117 E31583
251800200610     C***********          CALL 'ZVBBU'                            S01117 E31583
251900200610     C***********          PARM CSBA      ZBRCDX                   S01117 E31583
252000200610     C***********          PARM           @ERR                     S01117 E31583
252100200610     C***********          ELSE                                    S01117 E31583
252200200610     C***********          Z-ADD0         @ERR                     S01117 E31583
252300200610     C***********          END                                     S01117 E31583
252400200610     C***********@ERR      IFEQ *ZEROS                             S01117 E31583
252500200610     C*
252600200610     C** Data accessed - fill SFL line & output to SFL
252700200610     C*
252800200610     C                     Z-ADD2         ZZTYPE  10
252900200610     C                     EXSR SUBFIL
253000200610     C*
253100200610     C** SAVE FIELDS
253200200610     C*
253300200610     C                     MOVE TDSS      SAVSEC
253400200610     C                     MOVE TDBK      SVTDBK
253500200610     C                     MOVE DELT      SVDELT
253600200610     C                     SETOF                     52
253700200610     C**
253800200610     C                     ADD  1         SFLT
253900200610     C           OUTREC    IFGE 14
254000200610     C                     GOTO PEND
254100200610     C                     END
254200200610     C***********          END                                     S01117 E31583
254300200610     C                     END
254400200610     C                     END
254500200610     C**                                                                  E32164
254600200610     C** Detail line required  -
254700200610     C** Data accessed - fill SFL line & output to SFL
254800200610     C**
254900200610     C           ZZTYPE    IFEQ 2
255000200610     C           ZZTYPE    OREQ 3
255100200610     C                     Z-ADD0         SFLT    10
255200200610     C                     Z-ADD3         ZZTYPE  10
255300200610      *                                                                   E31583
255400200610      ***  Field CSBA could contain the incorrect Branch or even be       E31583
255500200610      ***  blank.  The correct Branch has already been tested anyway.     E31583
255600200610     C*                                                                   S01117
255700200610     C***CHECK*USER*HAS*AUTHORITY*TO*BRANCH*IF*MULTIBRANCHING***** S01117 E31583
255800200610     C***********                                                  S01117 E31583
255900200610     C************IN07     IFEQ '1'                                S01117 E31583
256000200610     C***********          CALL 'ZVBBU'                            S01117 E31583
256100200610     C***********          PARM CSBA      ZBRCDX                   S01117 E31583
256200200610     C***********          PARM           @ERR                     S01117 E31583
256300200610     C***********          ELSE                                    S01117 E31583
256400200610     C***********          Z-ADD0         @ERR                     S01117 E31583
256500200610     C***********          END                                     S01117 E31583
256600200610     C***********@ERR      IFEQ *ZEROS                             S01117 E31583
256700200610      *                                                                   E31583
256800200610     C                     EXSR SUBFIL
256900200610     C                     SETON                     5051
257000200610     C***********          END                                     S01117 E31583
257100200610     C                     END
257200200610     C**
257300200610     C**  If all lines processed - reset indicators & save new fields
257400200610     C**
257500200610     C           PEND      TAG
257600200610     C                     Z-ADD*ZEROS    ZZNOML
257700200610     C                     Z-ADD*ZEROS    ZZNOMB                          E14576
257800200610     C                     Z-ADD*ZEROS    ZNOMP
257900200610     C                     Z-ADD*ZEROS    ZZNOMU
258000200610     C                     Z-ADD*ZEROS    ZZPUR
258100200610     C                     Z-ADD*ZEROS    ZZSAL
258200200610     C                     Z-ADD*ZEROS    ZZAPP
258300200610     C                     Z-ADD*ZEROS    ZZAPS
258400200610     C**
258500200610     C                     ENDSR
258600200610     C**
258700200610     C*****************************************************************
258800200610      /EJECT
2589002006100738 C*****************************************************************
259000200610     C**                                                              *
259100200610     C**   CSPRC  SR  Calculate book price                            *
259200200610     C**                                                              *
259300200610     C**   Called by  SUBFIL                                          *
259400200610     C**   Calls  SR  OLCAP                                           *
259500200610     C**                                                              *
259600200610     C*****************************************************************
259700200610     C**
259800200610     C           CSPRC     BEGSR                           ** CSPRC  **
259900200610     C**
260000200610     C**  B/V ind is set to BLANK by default
260100200610     C**
260200200610     C                     MOVE ' '       SBVI    1
260300200610     C                     Z-ADD0         BKPR   158
260400200610     C                     Z-ADD0         ZZAPW
260500200610     C**
260600200610     C** Access 1st price for sec,br,mkt=S,book,price type
260700200610     C**
260800200610     C********** TVVL      IFEQ 'T'                                       S01117
260900200610     C           BVTVDV    IFEQ 'T'                                       S01117
261000200610     C                     MOVE 'CT'      PPRT
261100200610     C                     ELSE
261200200610     C                     MOVE 'CV'      PPRT
261300200610     C                     END
261400200610      *                                                                   E32164
261500200610     C***********SKEYP     SETLLPRICS                    25               E14057
261600200610     C           SKEYP     SETLLPRICR                    25               E14057
261700200610     C           *IN25     IFEQ '1'
261800200610     C***********SKEYP     READEPRICS                    25               E14057
261900200610     C           SKEYP     READEPRICR                    25               E14057
262000200610     C           *IN25     IFEQ '0'
262100200610     C**
262200200610     C** If price found & value date is less than prev. run date
262300200610     C**  B/V ind is set to Y
262400200610     C**
262500200610     C           PVDT      IFLT PRUN
262600200610     C                     MOVE 'Y'       SBVI
262700200610     C**
262800200610     C**  If price found & value date equals prev. run date
262900200610     C**    Price will be used to override AP num COB field
263000200610     C**
263100200610     C                     ELSE
263200200610     C           PVDT      IFEQ PRUN
263300200610     C                     Z-ADDPPRC      ZZAPW
263400200610     C                     END
263500200610     C                     END
263600200610     C**
263700200610     C** If price found & value date = run date
263800200610     C**   price Becomes the average price
263900200610     C**
264000200610     C           PVDT      IFEQ RUND
264100200610     C                     Z-ADDPPRC      BKPR
264200200610     C                     ELSE
264300200610     C**
264400200610     C** If price found with value date less than prev run date
264500200610     C**   Access price file with date = run date
264600200610     C**     if found price becomes the average price
264700200610     C**
264800200610     C           PVDT      IFLT PRUN
264900200610     C***********SKEYPD    CHAINPRICS                25                   E14057
265000200610     C           SKEYPD    CHAINPRICR                25                   E14057
265100200610     C           *IN25     IFEQ '0'
265200200610     C                     Z-ADDPPRC      BKPR
265300200610     C                     ELSE
265400200610     C*
265500200610     C**     otherwise -                                               ld
265600200610     C**   Access price file with date = previous run date
265700200610     C**     if found  price will be used to override AP num COB fie   ld
265800200610     C*
265900200610     C***********SKEYPP    CHAINPRICS                25                   E14057
266000200610     C           SKEYPP    CHAINPRICR                25                   E14057
266100200610     C           *IN25     IFEQ '0'
266200200610     C                     Z-ADDPPRC      ZZAPW
266300200610     C                     END
266400200610      *                                                                   E32164
266500200610     C                     END
266600200610     C                     END
266700200610     C                     END
266800200610     C                     END
266900200610     C                     END
267000200610     C**
267100200610     C**  Calculate average price -
267200200610     C**    If price found with value date = run date this is it
267300200610     C**
267400200610     C           BKPR      IFEQ 0
267500200610     C**
267600200610     C** Access CPOSND for cust/branch/sec -
267700200610     C**   If found & BV ind is Y screen BV ind is set to Y
267800200610     C**
267900200610     C           SKEYCP    CHAINCPOSN                25
268000200610     C           *IN25     IFEQ '0'
268100200610      *                                                                   E32164
268200200610     C********** TVVL      IFEQ 'T'                                       S01117
268300200610     C           BVTVDV    IFEQ 'T'                                       S01117
268400200610     C           CSBT      ANDEQ'Y'
268500200610     C                     MOVE 'Y'       SBVI
268600200610      *                                                                   E32164
268700200610     C                     ELSE
268800200610     C********** TVVL      IFEQ 'V'                                       S01117
268900200610     C           BVTVDV    IFEQ 'V'                                       S01117
269000200610     C           CSBV      ANDEQ'Y'
269100200610     C                     MOVE 'Y'       SBVI
269200200610     C                     END
269300200610      *                                                                   E32164
269400200610     C                     END
269500200610     C**
269600200610     C**  If price found , value date = prev run date
269700200610     C**    Calculate override for sum of AP num COB +
269800200610     C**      price x nom posn COB on CPOSND
269900200610     C**
270000200610     C           ZZAPW     IFNE 0
270100200610      *                                                                   E32164
270200200610     C********** TVVL      IFEQ 'T'                                       S01117
270300200610     C           BVTVDV    IFEQ 'T'                                       S01117
270400200610     C           CSNT      MULT ZZAPW     ZZAPC
270500200610     C                     ELSE
270600200610     C           CSNV      MULT ZZAPW     ZZAPC
270700200610     C                     END
270800200610      *                                                                   E32164
270900200610     C                     ELSE
271000200610     C********** TVVL      IFEQ 'T'                                       S01117
271100200610     C           BVTVDV    IFEQ 'T'                                       S01117
271200200610     C                     Z-ADDCSPT      ZZAPC
271300200610     C                     ELSE
271400200610     C                     Z-ADDCSPV      ZZAPC
271500200610     C                     END
271600200610     C                     END
271700200610      *                                                                   E32164
271800200610     C                     END
271900200610     C**
272000200610     C**  Calculate average price from OLCAP
272100200610     C**
272200200610     C                     EXSR OLCAP
272300200610     C                     END
272400200610     C**
272500200610     C                     ENDSR
272600200610     C**
272700200610     C*****************************************************************
272800200610      /EJECT
2729002006100738 C*****************************************************************
273000200610     C**                                                              *
273100200610     C**   OLCAP  SR  Calculate average price                         *
273200200610     C**                                                              *
273300200610     C**   Called by  CSPRC                                           *
273400200610     C**   Calls  SR  none                                            *
273500200610     C**                                                              *
273600200610     C*****************************************************************
273700200610     C**
273800200610     C           OLCAP     BEGSR                           ** OLCAP  **
273900200610     C**
274000200610     C**  Calculate new NP = NP + sum nom purch - sum nom sales
274100200610     C**
274200200610     C           ZZPUR     ADD  ZZSAL     ZNNOMP
274300200610     C                     ADD  ZNOMP     ZNNOMP
274400200610     C**
274500200610     C** If NP & new NP both long -
274600200610     C**  AP = (AP num COB + AP num purch) / new NP
274700200610     C**
274800200610     C           ZNOMP     IFGT 0
274900200610     C           ZNNOMP    ANDGT0
275000200610      *                                                                   E32164
275100200610     C           ZNNOMP    IFEQ 0
275200200610     C**********           Z-ADD0         BKPR                                                261507
275300200610     C                     Z-ADD0         BKPRR  238H                                         261507
275400200610     C                     ELSE
275500200610     C***********ZZAPC     ADD  ZZAPP     WBKPR  150                      E34849
275600200610     C***********WBKPR     DIV  ZNNOMP    BKPR      H                     E34849
275700200610     C           ZNOMP     ADD  ZZSAL     NBKPR  150                      E34849
275800200610     C           ZZAPC     ADD  ZZAPS     WBKPR  150                      E34849
275900200610     C********** WBKPR     DIV  NBKPR     BKPR      H                                  E34849 261507
276000200610     C           WBKPR     DIV  NBKPR     BKPRR     H                                         261507
276100200610     C                     END
276200200610      *                                                                   E32164
276300200610     C                     END
276400200610     C**
276500200610     C** If NP & new NP both short -
276600200610     C**  AP = (AP num COB + AP num sales) / new NP
276700200610     C**  (ensure price field is positive)
276800200610     C**
276900200610     C           ZNOMP     IFLT 0
277000200610     C           ZNNOMP    ANDLT0
277100200610      *                                                                   E32164
277200200610     C           ZNNOMP    IFEQ 0
277300200610     C**********           Z-ADD0         BKPR                                                261507
277400200610     C                     Z-ADD0         BKPRR                                               261507
277500200610     C                     ELSE
277600200610     C***********ZZAPC     ADD  ZZAPS     WBKPR                           E34849
277700200610     C***********WBKPR     DIV  ZNNOMP    BKPR      H                     E34849
277800200610     C           ZNOMP     ADD  ZZPUR     NBKPR                           E34849
277900200610     C           ZZAPC     ADD  ZZAPP     WBKPR                           E34849
278000200610     C********** WBKPR     DIV  NBKPR     BKPR      H                                  E34849 261507
278100200610     C********** BKPR      IFLT 0                                                             261507
278200200610     C********** BKPR      MULT -1        BKPR                                                261507
278300200610     C           WBKPR     DIV  NBKPR     BKPRR     H                                         261507
278400200610     C           BKPRR     IFLT 0                                                             261507
278500200610     C           BKPRR     MULT -1        BKPRR                                               261507
278600200610     C                     END
278700200610     C                     END
278800200610      *                                                                   E32164
278900200610     C                     END
279000200610     C**
279100200610     C** If NP long or flat , new NP short -
279200200610     C**  AP = AP num sales / sum nom sales
279300200610     C**
279400200610     C           ZNOMP     IFGE 0
279500200610     C           ZNNOMP    ANDLT0
279600200610      *                                                                   E32164
279700200610     C           ZZPUR     IFEQ 0
279800200610     C**********           Z-ADD0         BKPR                                                261507
279900200610     C                     Z-ADD0         BKPRR                                               261507
280000200610     C                     ELSE
280100200610     C********** ZZAPP     DIV  ZZPUR     BKPR      H                                         261507
280200200610     C           ZZAPP     DIV  ZZPUR     BKPRR     H                                         261507
280300200610     C                     END
280400200610      *                                                                   E32164
280500200610     C                     END
280600200610     C**
280700200610     C** If NP short or flat , new NP long -
280800200610     C**  AP = AP num purch / sum nom purch
280900200610     C**
281000200610     C           ZNOMP     IFLE 0
281100200610     C           ZNNOMP    ANDGT0
281200200610      *                                                                   E32164
281300200610     C           ZZSAL     IFEQ 0
281400200610     C**********           Z-ADD0         BKPR                                                261507
281500200610     C                     Z-ADD0         BKPRR                                               261507
281600200610     C                     ELSE
281700200610     C********** ZZAPS     DIV  ZZSAL     BKPR      H                                         261507
281800200610     C           ZZAPS     DIV  ZZSAL     BKPRR     H                                         261507
281900200610     C                     END
282000200610      *                                                                   E32164
282100200610     C                     END
282200200610     C**
282300200610     C** If new NP flat -
282400200610     C**  AP = 0
282500200610     C**
282600200610     C           ZNNOMP    IFEQ 0
282700200610     C**********           Z-ADD0         BKPR                                                261507
282800200610     C                     Z-ADD0         BKPRR                                               261507
282900200610     C                     END
283000200610     C*
283100200610     C* If price basis 'P', multiply by 100 to fetch true price           E19918
283200200610     C*                                                                   E19918
283300200610     C           SPBS      IFEQ 'P'                                       E19918
283400200610     C**********           MULT 100       BKPR                                         E19918 261507
283500200610     C                     MULT 100       BKPRR                                               261507
283600200610     C                     END                                            E19918
283700200610     C*
283800200610     C*
283900200610     C* REFORMAT BOOK PRICE FROM NOMINAL CURRENCY DECIMAL PLACES (AS IT
284000200610     C*  WAS CALCULATED FROM SUM AP NUMERATOR) TO A STRAIGHT 15/8 PRICE
284100200610     C*
284200200610     C***********5         ADD  CDP       XY      10                      E16825
284300200610     C***********5         ADD  XNMCDP    XY      10               E16825 E20327
284400200610     C           5         ADD  NMCDP     XY      10                      E20327
284500200610     C                     SUB  NMDP      XY
284600200610     C********** BKPR      DIV  POWER8,XY BKPR                                                261507
284700200610     C           BKPRR     DIV  POWER8,XY BKPR                                                261507
284800200610     C*
284900200610     C**If*price*basis*'P',*multiply*by*100*to*fetch*true*price********   E19918
285000200610     C***********                                                         E19918
285100200610     C***********SPBS      IFEQ 'P'                                       E19918
285200200610     C***********          MULT 100       BKPR                            E19918
285300200610     C***********          END                                            E19918
285400200610     C**
285500200610     C                     MOVE NMCDP     XNMCDP                          E16825
285600200610     C**
285700200610     C                     ENDSR
285800200610     C**
285900200610     C*****************************************************************
286000200610      /EJECT
2861002006100738 C*****************************************************************
286200200610     C**                                                              *
286300200610     C**   SUBFIL SR  Write details to Subfile                        *
286400200610     C**         - fills one line of the SFL depending on the setting *   E32164
286500200610     C**           of ZZTYPE                                          *   E32164
286600200610     C**                                                              *
286700200610     C**   Called by  PROCES                                          *
286800200610     C**   Calls  SR  RETSR,ZSEDIT,ZSDESC,CSPRC,ZPRCO,ZCONV,ZDAYS,    *
286900200610     C**              P001                                            *   S01496
287000200610     C**                                                              *
287100200610     C*****************************************************************
287200200610     C**
287300200610     C           SUBFIL    BEGSR                           ** SUBFIL **
287400200610     C**
287500200610     C*****ACCESS*TABTG10*FOR*nominal*CURRENCY                            E18658
287600200610     C*****ACCESS*TABTG10*FOR*PORTFOLIO*CURRENCY********************E18658S01117
287700200610     C***********                                                         S01117
287800200610     C**********           MOVEL'20      'TKEY   12                       S01117
287900200610     C***********          MOVELNMCY      ZWK4    4                       E18658
288000200610     C**********           MOVELC1PC      ZWK4    4                 E18658S01117
288100200610     C**********           MOVE 1         ZWK4                            S01117
288200200610     C**********           MOVE ZWK4      TKEY                            S01117
288300200610     C********** TKEY      CHAINTABTG10F             25                   S01117
288400200610     C**N25***** RECI      COMP 'D'                  2525                 S01117
288500200610     C********** *IN25     IFEQ '1'                                       S01117
288600200610      *                                                                   S01117
288700200610      ***  ACCESS SDCURRPD FOR PORTFOLIO CURRENCY                         S01117
288800200610      *                                                                   S01117
288900200610     C                     CALL 'AOCURRR0'                                S01117
289000200610     C                     PARM *BLANKS   @RTCD                           S01117
289100200610     C                     PARM '*KEY   ' @OPTN                           S01117
289200200610     C                     PARM BFPCYC    @KEYC   3                       S01117
289300200610     C           SDCURR    PARM SDCURR    DSSDY                           S01117
289400200610     C*
289500200610     C**  If no record found  or deleted record
289600200610     C**  then it is a database error so return to calling
289700200610     C**  program with a return code of '0'
289800200610     C*
289900200610     C           @RTCD     IFNE *BLANKS                                   S01117
290000200610     C           *LOCK     IN   LDA                                       S01117
290100200610     C                     MOVELPROGRM    DBPGM            ************
290200200610     C**********           MOVELTKEY      DBKEY            **DATABASE**   S01117
290300200610     C***********          MOVE 'TABLE'   DBFILE           **ERROR*05**   E20651
290400200610     C***********          Z-ADD05        DBASE            ************   E20651
290500200610     C**********           MOVE 'TABLE'   DBFILE        * ERROR 08 *E20651S01117
290600200610     C                     MOVELBFPCYC    DBKEY            ***************S01117
290700200610     C                     MOVEL'SDCURRPD'DBFILE           * DB ERROR 08 *S01117
290800200610     C                     Z-ADD08        DBASE            ***************E20651
290900200610     C                     SETON                       U7U8
291000200610     C                     OUT  LDA                                       S01117
291100200610     C                     EXSR *PSSR                                     S01117
291200200610     C                     MOVE '0'       RTNC
291300200610     C                     EXSR RETSR
291400200610     C                     END
291500200610     C**
291600200610     C***********          Z-ADDCDP       NMCDP                           E16825
291700200610     C**********           Z-ADDCDP       PFCDP                     E16825S01117
291800200610     C                     Z-ADDA6NBDP    PFCDP                           S01117
291900200610     C*
292000200610     C*****ACCESS*TABTG10*FOR*NOMINAL*CURRENCY********************* E16825S01117
292100200610     C***********                                                   E16825S01117
292200200610     C**********           MOVEL'20      'TKEY   12                 E16825S01117
292300200610     C**********           MOVELNMCY      ZWK4    4                 E16825S01117
292400200610     C**********           MOVE 1         ZWK4                      E16825S01117
292500200610     C**********           MOVE ZWK4      TKEY                      E16825S01117
292600200610     C********** TKEY      CHAINTABTG10F             25             E16825S01117
292700200610     C**N25******RECI      COMP 'D'                  2525           E16825S01117
292800200610     C********** *IN25     IFEQ '1'                                 E16825S01117
292900200610      *                                                                   S01117
293000200610      ***  ACCESS SDCURRPD FOR NOMINAL CURRENCY                           S01117
293100200610      *                                                                   S01117
293200200610     C                     CALL 'AOCURRR0'                                S01117
293300200610     C                     PARM *BLANKS   @RTCD                           S01117
293400200610     C                     PARM '*KEY   ' @OPTN                           S01117
293500200610     C                     PARM NMCY      @KEYC                           S01117
293600200610     C           SDCURR    PARM SDCURR    DSSDY                           S01117
293700200610     C*
293800200610     C**  IF NO RECORD FOUND OR DELETED RECORD                            E16825
293900200610     C**  THEN IT IS A DATABASE ERROR SO RETURN TO CALLING                E16825
294000200610     C**  PROGRAM WITH A RETURN CODE OF '0'                               E16825
294100200610     C*                                                                   E16825
294200200610     C           @RTCD     IFNE *BLANKS                                   S01117
294300200610     C           *LOCK     IN   LDA                                       S01117
294400200610     C                     MOVELPROGRM    DBPGM            ************   E16825
294500200610     C**********           MOVELTKEY      DBKEY         * DATABASE *E16825S01117
294600200610     C***********          MOVE 'TABLE'   DBFILE     **ERROR*05** E16825  E20651
294700200610     C***********          Z-ADD05        DBASE      ************ E16825  E20651
294800200610     C**********           MOVE 'TABLE'   DBFILE        * ERROR 09 *E20651S01117
294900200610     C                     MOVELNMCY      DBKEY            ***************S01117
295000200610     C                     MOVEL'SDCURRPD'DBFILE           * DB ERROR 09 *S01117
295100200610     C                     Z-ADD09        DBASE            ***************E20651
295200200610     C                     SETON                     U7U8                 E16825
295300200610     C                     OUT  LDA                                       S01117
295400200610     C                     EXSR *PSSR                                     S01117
295500200610     C                     MOVE '0'       RTNC                            E16825
295600200610     C                     EXSR RETSR                                     E16825
295700200610     C                     END                                            E16825
295800200610     C**                                                                  E16825
295900200610     C**********           Z-ADDCDP       NMCDP                     E16825S01117
296000200610     C**********           Z-ADDCDP       NCDP                      S01232S01117
296100200610     C                     Z-ADDA6NBDP    NMCDP                           S01117
296200200610     C                     Z-ADDA6NBDP    NCDP                            S01117
296300200610     C           *IN33     IFEQ '0'                                       E16825
296400200610     C                     MOVE NMCDP     XNMCDP                          E16825
296500200610     C                     SETON                     33                   E16825
296600200610     C                     END                                            E16825
296700200610      *                                                                   E32164
296800200610      *---------------------------------------------------------------*   E32164
296900200610      ***  ZZTYPE = 0 : Carried Forward Line.                         *   E32164
297000200610      *---------------------------------------------------------------*   E32164
297100200610      *                                                                   E32164
297200200610     C           ZZTYPE    IFEQ 0
297300200610     C                     SETON                     08
297400200610     C**                                                                  E16802
297500200610     C***84*****           Z-ADD0         CDP                       E16802S01117
297600200610     C   84                Z-ADD0         A6NBDP                          S01117
297700200610     C                     SETOF                     84                   E16802
297800200610     C           RECTYP    IFEQ 'D'                                       E34847
297900200610     C                     Z-ADDSVNMDP    NMDP                            E34847
298000200610     C                     ELSE                                           E34847
298100200610     C                     Z-ADDSNMDP     NMDP                            E16802
298200200610     C                     END                                            E34847
298300200610     C                     MOVE SSPBS     SPBS                            E16802
298400200610     C**
298500200610     C**   Format date,currency
298600200610     C**
298700200610     C                     MOVE RUNA      SRUNA
298800200610     C                     MOVE NMCY      SNMCY
298900200610     C**
299000200610     C**   Edit nominal
299100200610     C**
299200200610     C                     Z-ADDNMDP      ZDECS   10
299300200610     C                     MOVE 'L'       ZECODE
299400200610     C                     Z-ADDZZNOML    ZFLD15
299500200610     C                     EXSR ZSEDIT
299600200610     C                     MOVE ZOUT21    SCFNOM
299700200610     C**
299800200610     C**   Format price
299900200610     C**
300000200610     C                     EXSR CSPRC
300100200610     C           BKPR      IFLT *ZEROS
300200200610     C                     Z-SUBBKPR      BKPR
300300200610     C                     END
300400200610     C***********          MOVE BKPR      ZPRICE                          E14576
300500200610     C***********          Z-ADDRUND      ZFDATE                          E14576
300600200610     C***********          EXSR ZNCD                                      E14576
300700200610     C***********          EXSR ZPRCO                                     E14576
300800200610     C                     MOVE BKPR      ZPRICE                          E19918
300900200610     C                     Z-ADDRUND      ZFDATE                          E19918
301000200610     C                     Z-ADDRUND      ECD                             E19918
301100200610     C                     EXSR ZNCD                                      E19918
301200200610     C*                                                                   S01232
301300200610     C***    Set up data for Australian yield formula                     S01232
301400200610     C*                                                                   S01232
301500200610     C********** *IN52     IFEQ '1'                                S01232 E20783
301600200610     C           *IN53     IFEQ '1'                                       E20783
301700200610     C           ZZNOML    ANDNE0                                         S01232
301800200610     C                     Z-ADDLCPN      ZDCSDT                          S01232
301900200610     C                     Z-ADDRUND      ZDCEDT                          S01232
302000200610     C                     Z-ADDZZNOML    ZAMT                            S01232
302100200610     C                     Z-ADDNCDP      ZCDP                            S01117
302200200610AB   C                     EXSR ZACCZ                                     S01232
302300200610AB   C           ZDCINT    DIV  ZZNOML    WRKPI                           S01232
302400200610AB   C                     Z-ADDRUND      WRKD    50                      S01232
302500200610AB   C                     EXSR ZYCE                                      S01232
302600200610     C*                                                                   S01232
302700200610     C*  IF EX-COUPON THEN PI PASSED IS THE REMAINING INTEREST            S01232
302800200610     C*  TILL NCD AND IS NEGATIVE                                         S01232
302900200610     C*                                                                   S01232
303000200610     C           SCUMEX    IFEQ 'X'                                       S01232
303100200610     C                     Z-ADDLCPN      ZDCSDT                          S01232
303200200610     C                     Z-ADDNCD       ZDCEDT                          S01232
303300200610     C                     Z-ADDNCDP      ZCDP                            S01117
303400200610     C                     EXSR ZACCZ                                     S01232
303500200610     C           ZDCINT    DIV  ZZNOML    WKWPI  159                      S01232
303600200610     C           WRKPI     SUB  WKWPI     WRKPI                           S01232
303700200610     C                     END                                            S01232
303800200610      *                                                                   S01232
303900200610     C                     ELSE                                           S01232
304000200610     C                     Z-ADD0         WRKPI                           S01232
304100200610     C                     MOVE 'C'       SCUMEX                          S01232
304200200610     C                     END                                            S01232
304300200610     C                     Z-ADDZZNOML    ZNOML                           E39495
304400200610     C*                                                                   S01232
304500200610     C                     EXSR ZPRCO                                     E19918
304600200610     C/COPY WNCPYSRC,SE0220C005
304700200610     C                     Z-ADD8         ZDECS   10
304800200610     C                     MOVE 'L'       ZECODE
304900200610     C***********          MOVE BKPR      ZFLD15                          E19918
305000200610     C                     MOVE ZPRCOT    ZFLD15                          E19918
305100200610     C                     EXSR ZSEDIT
305200200610     C                     MOVE Z21L3     SCFPR
305300200610     C                     MOVE SBVI      CFBVI
305400200610      *
305500200610     C           SPBS      IFEQ 'P'
305600200610     C                     MOVE '%'       CFP
305700200610     C                     ELSE
305800200610     C                     MOVE ' '       CFP
305900200610     C                     END
306000200610     C**
306100200610     C**   Format book value
306200200610     C**
306300200610     C                     Z-ADD*ZEROS    WBVAL  150
306400200610     C                     Z-ADD*ZEROS    WBVAL0 150
306500200610     C                     Z-ADD*ZEROS    WBVAL1 151
306600200610     C                     Z-ADD*ZEROS    WBVAL2 152
306700200610     C                     Z-ADD*ZEROS    WBVAL3 153
306800200610     C                     MOVEA'0000'    *IN,55
306900200610     C           55        ADD  NMCDP     J       20
307000200610     C                     MOVEA'1'       *IN,J
307100200610     C*
307200200610     C*  Calculate consideration/reallowance/charges/commission
307300200610     C*
307400200610     C   55      ZZNOML    MULT BKPR      WBVAL0    H
307500200610     C   56      ZZNOML    MULT BKPR      WBVAL1    H
307600200610     C   57      ZZNOML    MULT BKPR      WBVAL2    H
307700200610     C   58      ZZNOML    MULT BKPR      WBVAL3    H
307800200610     C*
307900200610     C**Price*basis*-*divide*by*100************************************   E19918
308000200610     C***********                                                         E19918
308100200610     C***********SPBS      IFEQ 'P'                                       E19918
308200200610     C***55******          DIV  100       WBVAL0                          E19918
308300200610     C***56******          DIV  100       WBVAL1                          E19918
308400200610     C***57******          DIV  100       WBVAL2                          E19918
308500200610     C***58******          DIV  100       WBVAL3                          E19918
308600200610     C***********          END                                            E19918
308700200610     C*
308800200610     C   55                MOVE WBVAL0    WBVAL
308900200610     C   56                MOVE WBVAL1    WBVAL
309000200610     C   57                MOVE WBVAL2    WBVAL
309100200610     C   58                MOVE WBVAL3    WBVAL
309200200610     C*
309300200610     C*   Allow for nominal decimal places
309400200610     C*
309500200610     C           5         SUB  NMDP      DC      10
309600200610     C           WBVAL     MULT POWER8,DC BVAL   150                      E19918
309700200610     C*
309800200610     C           SPBS      IFEQ 'P'                                       E19918
309900200610     C           BVAL      DIV  100       BVAL      H                     E19918
310000200610     C                     END                                            E19918
310100200610     C                     Z-ADDNMCDP     ZDECS   10
310200200610     C                     MOVE 'L'       ZECODE
310300200610     C                     MOVE BVAL      ZFLD15
310400200610     C                     EXSR ZSEDIT
310500200610     C                     MOVE ZOUT21    CFBVAL
310600200610     C**
310700200610     C                     MOVE CFLIN     SLINE
310800200610     C                     END
310900200610      *                                                                   E32164
311000200610      *---------------------------------------------------------------*   E32164
311100200610      ***  ZZTYPE = 1 : Security Details Line.                        *   E32164
311200200610      *---------------------------------------------------------------*   E32164
311300200610      *                                                                   E32164
311400200610     C           ZZTYPE    IFEQ 1
311500200610     C                     SETOF                     08
311600200610     C**
311700200610     C**   Format security short description
311800200610     C**
311900200610     C                     MOVE SESN      SSESN
312000200610     C                     MOVE NMCY      SNMCY
312100200610     C                     MOVE SRPN      ZSRPN
312200200610     C                     MOVE BVRIDF    ZRSFD                           S01117
312300200610     C                     EXSR ZSDESC
312400200610     C**
312500200610     C                     MOVE *BLANKS   SLINE
312600200610     C                     MOVELZRNME     SLINE
312700200610     C                     MOVE TDSS      SSESN
312800200610     C                     MOVE TDRF      STDRF
312900200610     C                     MOVE TCNR      STCNR                           E16063
313000200610     C/COPY WNCPYSRC,SE0220C017
313100200610     C                     END
313200200610      *                                                                   E32164
313300200610      *---------------------------------------------------------------*   E32164
313400200610      ***  ZZTYPE = 2 : Brought Forward Line.                         *   E32164
313500200610      *---------------------------------------------------------------*   E32164
313600200610      *                                                                   E32164
313700200610     C           ZZTYPE    IFEQ 2
313800200610     C                     SETON                     08
313900200610     C**
314000200610     C**   Format date,currency
314100200610     C**
314200200610     C           LSTCLE    IFNE *BLANKS
314300200610     C                     MOVE LSTCLE    BFDATE
314400200610     C                     ELSE
314500200610     C                     MOVE LSTCLR    BFDATE
314600200610     C                     END
314700200610     C                     MOVE NMCY      BFCUR
314800200610     C**
314900200610     C**   Edit nominal
315000200610     C**
315100200610     C***********          Z-ADDTNMD      ZDECS   10                      E14576
315200200610     C                     Z-ADDNMDP      ZDECS   10                      E14576
315300200610     C                     MOVE 'L'       ZECODE
315400200610     C***********          Z-ADDZZNOML    ZFLD15                          E14576
315500200610     C           ZZNOMB    ADD  ZZNOML    ZFLD15                          E14576
315600200610     C                     EXSR ZSEDIT
315700200610     C                     MOVE ZOUT21    SBFNOM
315800200610     C**
315900200610     C**   Format price
316000200610     C**
316100200610     C           ZZNOML    IFEQ 0
316200200610     C                     Z-ADD0         ZPRICE
316300200610     C                     Z-ADD0         ZPRCOT                          E21428
316400200610     C                     ELSE
316500200610      *                                                                   E32164
316600200610     C********** TVVL      IFEQ 'T'                                       S01117
316700200610     C           BVTVDV    IFEQ 'T'                                       S01117
316800200610     C           CSPT      DIV  ZZNOML    ZPRICE    H
316900200610     C                     ELSE
317000200610     C           CSPV      DIV  ZZNOML    ZPRICE    H
317100200610     C                     END
317200200610      *                                                                   E32164
317300200610     C                     END
317400200610     C                     ADD  ZZNOMB    ZZNOML                          E14576
317500200610     C*                                                                   E21428
317600200610     C           ZPRICE    IFNE 0                                         E21428
317700200610     C           SPBS      IFEQ 'U'                                       105586
317800200610     C           5         ADD  NMCDP     XY      10                      105586
317900200610     C                     SUB  NMDP      XY                              105586
318000200610     C           ZPRICE    DIV  POWER8,XY ZPRICE                          105586
318100200610     C                     END                                            105586
318200200610     C*                                                                   E21428
318300200610     C***    Set up data for Australian yield formula                     E21428
318400200610     C*                                                                   E21428
318500200610     C           *IN53     IFEQ '1'                                       E21428
318600200610     C           ZZNOML    ANDNE0                                         E21428
318700200610     C                     Z-ADDLCPN      ZDCSDT                          E21428
318800200610     C                     Z-ADDRUND      ZDCEDT                          E21428
318900200610     C                     Z-ADDZZNOML    ZAMT                            E21428
319000200610     C                     Z-ADDNCDP      ZCDP                            S01117
319100200610AB   C                     EXSR ZACCZ                                     E21428
319200200610AB   C           ZDCINT    DIV  ZZNOML    WRKPI                           E21428
319300200610AB   C                     Z-ADDRUND      WRKD    50                      E21428
319400200610AB   C                     EXSR ZYCE                                      E21428
319500200610     C*                                                                   E21428
319600200610     C*  IF EX-COUPON THEN PI PASSED IS THE REMAINING INTEREST            E21428
319700200610     C*  TILL NCD AND IS NEGATIVE                                         E21428
319800200610     C*                                                                   E21428
319900200610     C           SCUMEX    IFEQ 'X'                                       E21428
320000200610     C                     Z-ADDLCPN      ZDCSDT                          E21428
320100200610     C                     Z-ADDNCD       ZDCEDT                          E21428
320200200610     C                     Z-ADDNCDP      ZCDP                            S01117
320300200610     C                     EXSR ZACCZ                                     E21428
320400200610     C           ZDCINT    DIV  ZZNOML    WKWPI  159                      E21428
320500200610     C           WRKPI     SUB  WKWPI     WRKPI                           E21428
320600200610     C                     END                                            E21428
320700200610      *                                                                   E21428
320800200610     C                     ELSE                                           E21428
320900200610     C                     Z-ADD0         WRKPI                           E21428
321000200610     C                     MOVE 'C'       SCUMEX                          E21428
321100200610     C                     END                                            E21428
321200200610      *                                                                   E21428
321300200610     C***********          Z-ADDCSDA      ZFDATE                          E14576
321400200610     C***********          EXSR ZPRCO                                     E14576
321500200610     C                     Z-ADDCSDA      ZFDATE                          E21428
321600200610     C                     Z-ADDZZNOML    ZNOML                           E39495
321700200610     C                     EXSR ZPRCO                                     E21428
321800200610     C/COPY WNCPYSRC,SE0220C006
321900200610     C                     END                                            E21428
322000200610      *                                                                   E21428
322100200610     C                     Z-ADD8         ZDECS   10
322200200610     C                     MOVE 'L'       ZECODE
322300200610     C***********          MOVE ZPRCOT    ZFLD15                          E14576
322400200610     C***********          MOVE ZPRICE    ZFLD15                   E14576 E21428
322500200610     C                     MOVE ZPRCOT    ZFLD15                          E21428
322600200610     C                     EXSR ZSEDIT
322700200610     C                     MOVE Z21L3     SBFPR
322800200610      *                                                                   E32164
322900200610     C           SPBS      IFEQ 'P'
323000200610     C                     MOVE '%'       BFP
323100200610     C                     ELSE
323200200610     C                     MOVE ' '       BFP
323300200610     C                     END
323400200610     C**
323500200610     C**   Format B/V
323600200610     C** Access 1st price for sec,br,mkt=S,book,price type
323700200610     C**
323800200610     C                     MOVE ' '       SBVI
323900200610     C********** TVVL      IFEQ 'T'                                       S01117
324000200610     C           BVTVDV    IFEQ 'T'                                       S01117
324100200610     C                     MOVE 'CT'      PPRT
324200200610     C                     ELSE
324300200610     C                     MOVE 'CV'      PPRT
324400200610     C                     END
324500200610      *                                                                   E32164
324600200610     C***********KEYP      SETLLPRICS                    25               E14057
324700200610     C           KEYP      SETLLPRICR                    25               E14057
324800200610     C           *IN25     IFEQ '1'
324900200610     C***********KEYP      READEPRICS                    25               E14057
325000200610     C           KEYP      READEPRICR                    25               E14057
325100200610     C           *IN25     IFEQ '0'
325200200610     C*
325300200610     C** If price found & value date is less than CPOSH date
325400200610     C**  B/V ind is set to Y
325500200610     C*
325600200610     C           PVDT      IFLT CSDA
325700200610     C                     MOVE 'Y'       BFBVI
325800200610     C                     END
325900200610      *                                                                   E32164
326000200610     C                     END
326100200610     C                     END
326200200610     C**
326300200610     C**   Format book value
326400200610     C**
326500200610     C                     Z-ADD*ZEROS    WBVAL  150
326600200610     C                     Z-ADD*ZEROS    WBVAL0 150
326700200610     C                     Z-ADD*ZEROS    WBVAL1 151
326800200610     C                     Z-ADD*ZEROS    WBVAL2 152
326900200610     C                     Z-ADD*ZEROS    WBVAL3 153
327000200610     C                     MOVEA'0000'    *IN,55
327100200610     C           55        ADD  NMCDP     J       20
327200200610     C                     MOVEA'1'       *IN,J
327300200610     C*
327400200610     C*  Calculate consideration/reallowance/charges/commission
327500200610     C*
327600200610     C   55      ZZNOML    MULT ZPRICE    WBVAL0    H
327700200610     C   56      ZZNOML    MULT ZPRICE    WBVAL1    H
327800200610     C   57      ZZNOML    MULT ZPRICE    WBVAL2    H
327900200610     C   58      ZZNOML    MULT ZPRICE    WBVAL3    H
328000200610     C*
328100200610     C* Price basis - divide by 100
328200200610     C*
328300200610     C           SPBS      IFEQ 'P'
328400200610     C   55                DIV  100       WBVAL0
328500200610     C   56                DIV  100       WBVAL1
328600200610     C   57                DIV  100       WBVAL2
328700200610     C   58                DIV  100       WBVAL3
328800200610     C                     END
328900200610     C*
329000200610     C   55                MOVE WBVAL0    WBVAL
329100200610     C   56                MOVE WBVAL1    WBVAL
329200200610     C   57                MOVE WBVAL2    WBVAL
329300200610     C   58                MOVE WBVAL3    WBVAL
329400200610     C*
329500200610     C*   Allow for nominal decimal places
329600200610     C*
329700200610     C           5         SUB  NMDP      DC      10
329800200610     C           WBVAL     MULT POWER8,DC BVAL   150                      E19918
329900200610     C*
330000200610     C                     Z-ADDNMCDP     ZDECS   10
330100200610     C                     MOVE 'L'       ZECODE
330200200610     C                     MOVE BVAL      ZFLD15
330300200610     C                     EXSR ZSEDIT
330400200610     C                     MOVE ZOUT21    BFBVAL
330500200610     C**
330600200610     C                     MOVE BFLIN     SLINE
330700200610     C                     END
330800200610      *                                                                   E32164
330900200610      *---------------------------------------------------------------*   E32164
331000200610      ***  ZZTYPE = 3 : Detail Line.                                  *   E32164
331100200610      *---------------------------------------------------------------*   E32164
331200200610      *                                                                   E32164
331300200610     C           ZZTYPE    IFEQ 3
331400200610     C                     SETOF                     08
331500200610     C**
331600200610     C**   Edit nominal
331700200610     C**
331800200610     C***********          Z-ADDTNMD      ZDECS   10                      E14576
331900200610     C                     Z-ADDNMDP      ZDECS   10                      E14576
332000200610     C                     MOVE 'L'       ZECODE
332100200610     C                     Z-ADDNOML      ZFLD15
332200200610     C                     EXSR ZSEDIT
332300200610     C                     MOVE ZOUT21    SNOML
332400200610     C**
332500200610     C**   Format value date
332600200610     C**   Format trade date
332700200610     C**   Format type
332800200610     C**   Format currency
332900200610     C**
333000200610     C                     MOVE *BLANKS   STYPE
333100200610      *                                                                   E32164
333200200610     C           *IN61     IFEQ '1'
333300200610     C           RECI      ANDNE'*'
333400200610     C           RECI      ANDNE'R'                                       S01269
333500200610     C           RECI      ANDNE'C'
333600200610      *                                                                   E32164
333700200610     C           *IN62     OREQ '1'
333800200610     C           RECI      ANDNE'*'
333900200610     C           RECI      ANDNE'R'                                       S01269
334000200610     C           RECI      ANDNE'C'
334100200610      *                                                                   CSE041
334200200610     C           *IN60     OREQ '1'                                       CSE041
334300200610      *                                                                   E32164
334400200610     C                     Z-ADDTDVD      ZDAYNO
334500200610     C                     EXSR ZDATE2
334600200610     C                     MOVE ZADATE    STDVD
334700200610     C                     Z-ADDTDDT      ZDAYNO
334800200610     C                     EXSR ZDATE2
334900200610     C                     MOVE ZADATE    STDDT
335000200610     C                     MOVE SETC      SSETC
335100200610      *                                                                   E32164
335200200610     C           TDTP      IFEQ 'TP'
335300200610     C                     MOVE 'PUR'     STYPE
335400200610     C                     ELSE
335500200610     C           TDTP      IFEQ 'TS'
335600200610     C                     MOVE 'SAL'     STYPE
335700200610     C                     ELSE                                           CSE041
335800200610     C           TDTP      IFEQ 'RV'                                      CSE041
335900200610     C           TDTP      OREQ 'DP'                                      CSE041
336000200610     C                     MOVELTDTP      STYPE                           CSE041
336100200610     C                     ENDIF                                          CSE041
336200200610     C                     END
336300200610      *                                                                   E32164
336400200610     C                     END
336500200610      *                                                                   E32164
336600200610     C                     ELSE
336700200610     C                     MOVE NMCY      SSETC
336800200610     C***********          MOVELDPMV      STYPE                           E32164
336900200610     C                     MOVELTDTP      STYPE                           E32164
337000200610      *                                                                   E32164
337100200610     C           *IN09     IFEQ '1'
337200200610     C                     Z-ADDTDDT      ZDAYNO
337300200610     C                     EXSR ZDATE2
337400200610     C**********           MOVE ZADATE    STDVD                                              BUG2507
337500200610     C                     MOVE ZADATE    STDDT
337600200610     C                     Z-ADDTDVD      ZDAYNO                                             BUG2507
337700200610     C                     EXSR ZDATE2                                                       BUG2507
337800200610     C                     MOVE ZADATE    STDVD                                              BUG2507
337900200610     C                     ELSE
338000200610     C                     Z-ADDTDDT      ZDAYNO                                             BUG2507
338100200610     C                     EXSR ZDATE2                                                       BUG2507
338200200610     C                     MOVE ZADATE    STDDT                                              BUG2507
338300200610     C                     Z-ADDTDVD      ZDAYNO
338400200610     C                     EXSR ZDATE2
338500200610     C                     MOVE ZADATE    STDVD
338600200610     C**********           MOVE ZADATE    STDDT                                              BUG2507
338700200610     C                     END
338800200610      *                                                                   E32164
338900200610     C                     END
339000200610     C**                                                                  S01496
339100200610     C           S01496    IFEQ 'Y'                                       S01496
339200200610     C                     EXSR P001                                      S01496
339300200610     C                     END                                            S01496
339400200610     C**
339500200610     C**   Format price
339600200610      *                                                                   E32164
339700200610     C           *IN61     IFEQ '1'
339800200610     C           RECI      ANDNE'*'
339900200610     C           RECI      ANDNE'C'
340000200610     C           RECI      ANDNE'R'                                       S01269
340100200610      *                                                                   E32164
340200200610     C           *IN62     OREQ '1'
340300200610     C           RECI      ANDNE'*'
340400200610     C           RECI      ANDNE'C'
340500200610     C           RECI      ANDNE'R'                                       S01269
340600200610     C*
340700200610     C**OBTAIN*DECIMAL*PLACES*FOR*CURRENCY*INPUT***********************   E21002
340800200610     C***********                                                         E21002
340900200610     C***********          MOVEL'20      'TKEY   12                       E21002
341000200610     C***********                                                         E21002
341100200610     C**USE*TRADE*FILE*TRADE*NOMINAL*CURRENCY*FIELD*TNMC***************   E21002
341200200610     C***********                                                         E21002
341300200610     C***********          MOVELTNMC      ZWK4    4                       E21002
341400200610     C***********          MOVE 1         ZWK4                            E21002
341500200610     C***********          MOVE ZWK4      TKEY                            E21002
341600200610     C***********TKEY      CHAINTABTG10F             90                   E21002
341700200610     C**N90******RECI      COMP 'D'                  9090                 E21002
341800200610     C************IN90     IFEQ '1'                                       E21002
341900200610     C***********          MOVELPROGRM    DBPGM            ************   E21002
342000200610     C***********          MOVELTKEY      DBKEY            * DATABASE *   E21002
342100200610     C***********          MOVE 'TABLE'   DBFILE           * ERROR 06 *   E21002
342200200610     C***********          Z-ADD06        DBASE            ************   E21002
342300200610     C***********          SETON                       U7U8               E21002
342400200610     C***********          GOTO EAUDIT                                    E21002
342500200610     C***********          END                                            E21002
342600200610     C***********          Z-ADDCDP       ZCDP                            E21002
342700200610     C***********                                                         E21002
342800200610     C**DECIMAL*PLACES*-*Z-ADD*TO*ZCDP*FOR*ZCONPR*SUBROUTINE***********   E21002
342900200610     C***********                                                         E21002
343000200610     C***********          EXSR ZCONPR                                    E21002
343100200610     C***********          MOVE ZCONP     ZPRICE                          E21002
343200200610     C***********          Z-ADDTDVD      ZFDATE                          E21002
343300200610     C***********          EXSR ZNCD                                      E21002
343400200610     C***********          EXSR ZPRCO                                     E21002
343500200610     C***********                                                         E21002
343600200610     C**OBTAIN*DECIMAL*PLACES*FOR*CURRENCY*INPUT****************** E21002 S01117
343700200610     C***********                                                  E21002 S01117
343800200610     C**********           MOVEL'20      'TKEY   12                E21002 S01117
343900200610     C***********                                                  E21002 S01117
344000200610     C**USE*TRADE*FILE*TRADE*NOMINAL*CURRENCY*FIELD*TNMC********** E21002 S01117
344100200610     C***********                                                  E21002 S01117
344200200610     C**********           MOVELTNMC      ZWK4    4                E21002 S01117
344300200610     C**********           MOVE 1         ZWK4                     E21002 S01117
344400200610     C**********           MOVE ZWK4      TKEY                     E21002 S01117
344500200610     C********** TKEY      CHAINTABTG10F             90            E21002 S01117
344600200610      *                                                                   S01117
344700200610      ***  Obtain Decimal Places for Currency Input.                      S01117
344800200610      *                                                                   S01117
344900200610     C                     CALL 'AOCURRR0'                                S01117
345000200610     C                     PARM *BLANKS   @RTCD                           S01117
345100200610     C                     PARM '*KEY   ' @OPTN                           S01117
345200200610     C                     PARM TNMC      @KEYC                           S01117
345300200610     C           SDCURR    PARM SDCURR    DSSDY                           S01117
345400200610     C**N90***** RECI      COMP 'D'                  9090           E21002S01117
345500200610     C********** *IN90     IFEQ '1'                                 E21002S01117
345600200610     C           @RTCD     IFNE *BLANKS                                   S01117
345700200610     C           *LOCK     IN   LDA                                       S01117
345800200610     C                     MOVELPROGRM    DBPGM                           E21002
345900200610     C**********           MOVELTKEY      DBKEY      ***************E21002S01117
346000200610     C**********           MOVE 'TABLE'   DBFILE     * DB ERROR 06 *E21002S01117
346100200610     C                     MOVELTNMC      DBKEY            ***************S01117
346200200610     C                     MOVEL'SDCURRPD'DBFILE           * DB ERROR 06 *S01117
346300200610     C                     Z-ADD06        DBASE            ***************E21002
346400200610     C                     SETON                       U7U8               E21002
346500200610     C                     OUT  LDA                                       S01117
346600200610     C                     EXSR *PSSR                                     S01117
346700200610     C                     GOTO EAUDIT                                    E21002
346800200610     C                     END                                            E21002
346900200610     C*                                                                   E21002
347000200610     C*  Calculate contract price
347100200610     C*
347200200610     C                     Z-ADDA6NBDP    ZCDP                            S01117
347300200610     C                     EXSR ZCSCTP                                    E21002
347400200610      *                                                                   E31763
347500200610      ***  If the Contract Price returned from SR/ZCSCTP is the same as   E31763
347600200610      ***  the Trade Price then use the Price/Discount/Yield from the     E31763
347700200610      ***  Trade, rather than converting the Price back to its original   E31763
347800200610      ***  form, which may introduce rounding errors.                     E31763
347900200610      *                                                                   E31763
348000200610     C           ZCONP     IFEQ PRIC                                      E31763
348100200610     C                     Z-ADDTPDY      ZPRCOT                          E31763
348200200610     C                     ELSE                                           E31763
348300200610     C                     Z-ADDZCONP     ZPRICE                          E21002
348400200610     C                     Z-ADDTDVD      ZFDATE                          E21002
348500200610     C                     Z-ADDTDVD      ECD                             E21002
348600200610     C                     Z-ADDNOML      ZNOML                           E39495
348700200610     C                     EXSR ZPRCO                                     E21002
348800200610     C/COPY WNCPYSRC,SE0220C007
348900200610     C                     END                                            E31763
349000200610      *                                                                   E31763
349100200610     C                     Z-ADD8         ZDECS   10
349200200610     C                     MOVE 'L'       ZECODE
349300200610     C***********          MOVE PRIC      ZFLD15                          E19918
349400200610     C*************        MOVE TPDY      ZFLD15                   E19918 E21002
349500200610     C                     MOVE ZPRCOT    ZFLD15                          E21002
349600200610     C                     EXSR ZSEDIT
349700200610     C                     MOVE Z21L3     SDTPR
349800200610     C                     ELSE
349900200610     C                     Z-ADD8         ZDECS   10
350000200610     C                     MOVE 'L'       ZECODE
350100200610     C***********          MOVE MKTP      ZFLD15                          E32164
350200200610     C                     MOVE PRIC      ZFLD15                          E32164
350300200610     C                     EXSR ZSEDIT
350400200610     C                     MOVE Z21L3     SDTPR
350500200610     C                     END
350600200610      *                                                                   E32164
350700200610     C           SPBS      IFEQ 'P'
350800200610     C                     MOVE '%'       DTP
350900200610     C                     ELSE
351000200610     C                     MOVE ' '       DTP
351100200610     C                     END
351200200610     C**                                                                  E16802
351300200610     C** MOVE DETAIL FIELDS INTO WORK FIELDS TO EDIT C/F                  E16802
351400200610     C** BALANCE                                                          E16802
351500200610     C**                                                                  E16802
351600200610     C   63                                                               E16802
351700200610     COR 62                                                               E16825
351800200610     COR 64      NMCY      LOKUPARR                      84               E16802
351900200610     C                     Z-ADDTNMD      SNMDP   10                      E16802
352000200610     C                     Z-ADDNMDP      SVNMDP  10                      E34847
352100200610     C           *IN63     IFEQ '1'                                       E34847
352200200610     C           *IN64     OREQ '1'                                       E34847
352300200610     C                     MOVEL'D'       RECTYP  1                       E34847
352400200610     C                     END                                            E34847
352500200610     C                     MOVE SPBS      SSPBS   1                       E16802
352600200610     C**
352700200610     C**   Format countervalue
352800200610     C**
352900200610     C           *IN61     IFEQ '1'
353000200610     C           RECI      ANDNE'*'
353100200610     C           RECI      ANDNE'C'
353200200610     C           RECI      ANDNE'R'                                       S01269
353300200610      *                                                                   E32164
353400200610     C           *IN62     OREQ '1'
353500200610     C           RECI      ANDNE'*'
353600200610     C           RECI      ANDNE'C'
353700200610     C           RECI      ANDNE'R'                                       S01269
353800200610      *                                                                   CSE041
353900200610     C           *IN60     OREQ '1'                                       CSE041
354000200610      *                                                                   CSE041
354100200610     C           *IN60     IFEQ '0'                                       CSE041
354200200610      *                                                                   E32164
354300200610     C                     MOVE TCTR      ZAMTCI
354400200610     C                     Z-ADDTDER      ZEXCH
354500200610     C                     MOVE TMDI      ZMD
354600200610     C                     MOVE TNMC      ZCCYI
354700200610     C                     MOVE SETC      ZCCYO
354800200610     C                     MOVELA6NBDP    ZCDPI                           S01117
354900200610     C                     CALL 'AOCURRR0'                                S01117
355000200610     C                     PARM '*DBERR ' @RTCD                           S01117
355100200610     C                     PARM '*KEY   ' @OPTN                           S01117
355200200610     C                     PARM SETC      @KEYC                           S01117
355300200610     C           SDCURR    PARM SDCURR    DSSDY                           S01117
355400200610     C                     MOVELA6NBDP    ZCDPO                           S01117
355500200610     C                     EXSR ZCONV
355600200610      *                                                                   E32164
355700200610     C           *INU7     IFEQ '1'
355800200610     C           *LOCK     IN   LDA                                       S01117
355900200610     C                     MOVELPROGRM    DBPGM
356000200610     C**********           MOVELTKEY      DBKEY            ***************S01117
356100200610     C**********           MOVE 'TABLE'   DBFILE           * DB ERROR 07 *S01117
356200200610     C                     MOVELTNMC      DBKEY            ***************S01117
356300200610     C                     MOVE SETC      DBKEY            ***************S01117
356400200610     C                     MOVEL'SDCURRPD'DBFILE           * DB ERROR 07 *S01117
356500200610     C                     Z-ADD07        DBASE            ***************
356600200610     C                     SETON                       U7U8
356700200610     C                     OUT  LDA                                       S01117
356800200610     C                     EXSR *PSSR                                     S01117
356900200610     C                     MOVE '0'       RTNC
357000200610     C                     EXSR RETSR
357100200610     C                     END
357200200610      *                                                                   E32164
357300200610     C**********           Z-ADDCDP       ZDECS   10                      S01117
357400200610     C                     Z-ADDA6NBDP    ZDECS   10                      S01117
357500200610     C                     MOVE 'L'       ZECODE
357600200610     C                     MOVE ZAMTCO    ZFLD15
357700200610     C                     EXSR ZSEDIT
357800200610     C                     MOVE ZOUT21    STCTR
357900200610      *                                                                   CSE041
358000200610      ** DVP/RVP movements                                                CSE041
358100200610     C                     ELSE                                           CSE041
358200200610     C                     CALL 'AOCURRR0'                                CSE041
358300200610     C                     PARM '*DBERR ' @RTCD                           CSE041
358400200610     C                     PARM '*KEY   ' @OPTN                           CSE041
358500200610     C                     PARM SETC      @KEYC                           CSE041
358600200610     C           SDCURR    PARM SDCURR    DSSDY                           CSE041
358700200610      *                                                                   CSE041
358800200610     C           @RTCD     IFNE *BLANKS                                   CSE041
358900200610     C           *LOCK     IN   LDA                                       CSE041
359000200610     C                     MOVELPROGRM    DBPGM                           CSE041
359100200610     C                     MOVELSETC      DBKEY            ***************CSE041
359200200610     C                     MOVEL'SDCURRPD'DBFILE           * DB ERROR 13 *CSE041
359300200610     C                     Z-ADD13        DBASE            ***************CSE041
359400200610     C                     SETON                       U7U8               CSE041
359500200610     C                     OUT  LDA                                       CSE041
359600200610     C                     EXSR *PSSR                                     CSE041
359700200610     C                     MOVE '0'       RTNC                            CSE041
359800200610     C                     EXSR RETSR                                     CSE041
359900200610     C                     ENDIF                                          CSE041
360000200610      *                                                                   CSE041
360100200610     C                     Z-ADDA6NBDP    ZDECS   10                      CSE041
360200200610     C                     MOVE 'L'       ZECODE                          CSE041
360300200610     C                     MOVE DVSCVL    ZFLD15                          CSE041
360400200610     C                     EXSR ZSEDIT                                    CSE041
360500200610     C                     MOVE ZOUT21    STCTR                           CSE041
360600200610     C                     ENDIF                                          CSE041
360700200610     C                     ELSE
360800200610     C*
360900200610     C***********          Z-ADD*ZEROS    WBVAL  150                      E21480
361000200610     C***********          Z-ADD*ZEROS    WBVAL0 150                      E21480
361100200610     C***********          Z-ADD*ZEROS    WBVAL1 151                      E21480
361200200610     C***********          Z-ADD*ZEROS    WBVAL2 152                      E21480
361300200610     C***********          Z-ADD*ZEROS    WBVAL3 153                      E21480
361400200610     C***********          MOVEA'0000'    *IN,55                          E21480
361500200610     C***********55        ADD  NMCDP     J       20                      E21480
361600200610     C***********          MOVEA'1'       *IN,J                           E21480
361700200610     C***********                                                         S01158
361800200610     C***Calculate*consideration/reallowance/charges/commission********   S01158
361900200610     C***********                                                         S01158
362000200610     C***********MKTP      IFEQ *ZEROS                                    S01158
362100200610     C***55******          Z-ADDNOML      WBVAL0                          S01158
362200200610     C***56******          Z-ADDNOML      WBVAL1                          S01158
362300200610     C***57******          Z-ADDNOML      WBVAL2                          S01158
362400200610     C***58******          Z-ADDNOML      WBVAL3                          S01158
362500200610     C***********          ELSE                                           S01158
362600200610     C***55******NOML      MULT MKTP      WBVAL0    H                     E21480
362700200610     C***56******NOML      MULT MKTP      WBVAL1    H                     E21480
362800200610     C***57******NOML      MULT MKTP      WBVAL2    H                     E21480
362900200610     C***58******NOML      MULT MKTP      WBVAL3    H                     E21480
363000200610     C***********                                                         E21480
363100200610     C**Price*basis*-*divide*by*100************************************   E21480
363200200610     C***********                                                         E21480
363300200610     C***********SPBS      IFEQ 'P'                                       E21480
363400200610     C***55******          DIV  100       WBVAL0                          E21480
363500200610     C***56******          DIV  100       WBVAL1                          E21480
363600200610     C***57******          DIV  100       WBVAL2                          E21480
363700200610     C***58******          DIV  100       WBVAL3                          E21480
363800200610     C***********          END                                            E21480
363900200610     C***********                                                         S01158
364000200610     C***********          END                                            S01158
364100200610     C***********                                                         S01158
364200200610     C***55******          MOVE WBVAL0    WNOML                           E21480
364300200610     C***56******          MOVE WBVAL1    WNOML                           E21480
364400200610     C***57******          MOVE WBVAL2    WNOML                           E21480
364500200610     C***58******          MOVE WBVAL3    WNOML                           E21480
364600200610     C***********                                                         E21480
364700200610     C****Allow*for*nominal*decimal*places*****************************   E21480
364800200610     C***********                                                         E21480
364900200610     C***********5         SUB  NMDP      DC                              E21480
365000200610     C***********WNOML     MULT POWER8,DC WNOML                           E21480
365100200610      *                                                                   E21480
365200200610     C***********          Z-ADDMKTP      ZPRCIN                   E21480 E32164
365300200610     C                     Z-ADDPRIC      ZPRCIN                          E32164
365400200610     C                     Z-ADDTDVD      ZFDATE                          E21480
365500200610     C                     Z-ADDNOML      ZNOML                           E21480
365600200610     C*                                                                   E21480
365700200610     C***   Set up parameters for Australian Yields mod                   E21480
365800200610     C*                                                                   E21480
365900200610     C           STBS      IFEQ 'Y'                                       E21480
366000200610     C           SYBS      ANDEQ'AU'                                      E21480
366100200610     C                     Z-ADDTDVD      ZECD                            E21480
366200200610     C                     EXSR ZLCD                                      E21480
366300200610     C                     Z-ADDTDVD      ECD                             E21480
366400200610     C                     EXSR ZNCD                                      E21480
366500200610     C                     Z-ADDZZLCD     ZDCSDT                          E21480
366600200610     C                     Z-ADDTDVD      ZDCEDT                          E21480
366700200610     C                     Z-ADDZNOML     ZAMT                            E21480
366800200610     C                     Z-ADDNCDP      ZCDP                            S01117
366900200610     C                     EXSR ZACCZ                                     E21480
367000200610     C                     Z-ADDTDVD      WRKD    50                      E21480
367100200610     C           ZDCINT    DIV  ZNOML     WRKPI                           E21480
367200200610     C                     EXSR ZYCE                                      E21480
367300200610     C*                                                                   E21480
367400200610     C*  IF EX-COUPON THEN PI PASSED IS THE REMAINING INTEREST            E21480
367500200610     C*  TILL NCD AND IS NEGATIVE                                         E21480
367600200610     C*                                                                   E21480
367700200610     C           SCUMEX    IFEQ 'X'                                       E21480
367800200610     C                     Z-ADDZZLCD     ZDCSDT                          E21480
367900200610     C                     Z-ADDNCD       ZDCEDT                          E21480
368000200610     C                     Z-ADDNCDP      ZCDP                            S01117
368100200610     C                     EXSR ZACCZ                                     E21480
368200200610     C           ZDCINT    DIV  ZNOML     WKWPI  159                      E21480
368300200610     C           WRKPI     SUB  WKWPI     WRKPI                           E21480
368400200610     C                     END                                            E21480
368500200610      *                                                                   E21480
368600200610     C                     ELSE                                           E21480
368700200610     C                     MOVE 'C'       SCUMEX  1                       E21480
368800200610     C                     Z-ADD0         WRKPI                           E21480
368900200610     C                     END                                            E21480
369000200610     C*                                                                   E21480
369100200610     C                     EXSR ZPRCI                                     E21480
369200200610     C/COPY WNCPYSRC,SE0220C008
369300200610      *
369400200610      ** ADJUST NUMBER OF DECIMAL PLACES FOR PRICE                                            CSE035
369500200610      *                                                                                       CSE035
369600200610     C           CSE035    IFEQ 'Y'                                                           CSE035
369700200610      *                                                                                       CSE035
369800200610      ** ADJUST PRICE : PRICE + PUR INT BEFORE ROUNDING                                       CSE035
369900200610      *                                                                                       CSE035
370000200610     C           NCD       IFGE MATY                                                          CSE035
370100200610     C           SYBS      ANDEQ'AU'                                                          CSE035
370200200610     C                     Z-ADDZPRCOT    ZPRCOT                                              CSE035
370300200610     C                     ELSE                                                               CSE035
370400200610     C           SYBS      IFNE 'AU'                                                          CSE035
370500200610     C           SYBS      ANDNE'DA'                                                          CSE035
370600200610     C           STBS      ANDEQ'Y'                                                           CSE035
370700200610     C           ZPRCOT    ADD  ZWAMT     ZPRCOT                                              CSE035
370800200610     C                     ENDIF                                                              CSE035
370900200610     C                     ENDIF                                                              CSE035
371000200610      *                                                                                       CSE035
371100200610     C                     ENDIF                                                              CSE035
371200200610      *                                                                                       CSE035
371300200610     C           CSE035    IFEQ 'Y'                                                           CSE035
371400200610     C           NCD       IFGE MATY                                                          CSE035
371500200610     C           SYBS      ANDEQ'AU'                                                          CSE035
371600200610     C                     ELSE                                                               CSE035
371700200610      *                                                                                       CSE035
371800200610     C           SYBS      IFNE 'AU'                                                          CSE035
371900200610     C           SYBS      ANDNE'DA'                                                          CSE035
372000200610     C           STBS      ANDEQ'Y'                                                           CSE035
372100200610     C           ZPRCOT    SUB  PURINT    ZPRCOT                                              CSE035
372200200610     C                     ENDIF                                                              CSE035
372300200610     C                     ENDIF                                                              CSE035
372400200610      *                                                                                       CSE035
372500200610     C                     ENDIF                                                              CSE035
372600200610      *
372700200610     C                     Z-ADDZPRCOT    ZPRC                            E21480
372800200610     C                     Z-ADDNCDP      ZCDP                            S01117
372900200610     C                     EXSR ZCNSD                                     E21480
373000200610     C                     Z-ADDZCONS     WNOML                           E21480
373100200610     C                     Z-ADDNMCDP     ZDECS   10
373200200610     C                     MOVE 'L'       ZECODE
373300200610     C                     MOVE WNOML     ZFLD15
373400200610     C                     EXSR ZSEDIT
373500200610     C                     MOVE ZOUT21    STCTR
373600200610     C                     END
373700200610     C**
373800200610     C                     MOVE DETLN     SLINE
373900200610     C                     MOVE TDSS      SSESN
374000200610     C                     MOVE TDRF      STDRF
374100200610     C                     MOVE TCNR      STCNR                           E16063
374200200610     C                     END
374300200610      *                                                                   E32164
374400200610      *---------------------------------------------------------------*   E32164
374500200610     C**
374600200610     C**   And output details to subfile
374700200610     C**
374800200610     C                     ADD  1         SFLREC
374900200610     C                     ADD  1         OUTREC
375000200610     C                     WRITESE0220S0
375100200610     C**
375200200610     C                     ENDSR
375300200610     C**
375400200610     C*****************************************************************
375500200610      /EJECT
375600200610     C*****************************************************************
375700200610     C**                                                              *
375800200610     C**   LINK   SR  Lower level Enquiry requested                   *
375900200610     C**                                                              *
376000200610     C**   Called by  MAIN                                            *
376100200610     C**   Calls  SR  none                                            *
376200200610     C**   Calls PGM  lower level enquiry obtained from SECOND        *
376300200610     C**                                                              *
376400200610     C*****************************************************************
376500200610     C**
3766002006100740 C           LINK      BEGSR                           *** LINK ******
3767002006100741 C**
376800200610     C**   Access Linked Enquiry Control File for program and option
376900200610     C**
377000200610     C           LKEY      KLIST
377100200610     C                     KFLD           PGMNO
377200200610     C                     KFLD           OPTN
377300200610     C**
377400200610     C           LKEY      CHAINSECONDF              42
377500200610     C**
377600200610     C**   If record not found then entered option is invalid
377700200610     C**
377800200610     C           *IN42     IFEQ '1'
377900200610     C           OPTN      ANDNE' 4'                                      CSE039
378000200610     C           CSE041    IFEQ 'N'                                       CSE041
378100200610     C           CSE039    ANDEQ'N'                                       CSE039
378200200610     C                     MOVE MSG,4     ERMSG
378300200610     C                     ELSE                                           CSE041
378400200610     C           CSE039    IFEQ 'Y'                                       CSE039
378500200610     C                     MOVE MSG,19    ERMSG                           CSE039
378600200610     C                     ELSE                                           CSE039
378700200610     C                     MOVE MSG,18    ERMSG                           CSE041
378800200610     C                     ENDIF                                          CSE039
378900200610     C                     ENDIF                                          CSE041
379000200610     C**
379100200610     C                     ELSE
379200200610     C**
379300200610     C**   For valid option write out LDA and linked enquiry data area
379400200610     C**   and call the program name obtained from SECOND
379500200610     C**
379600200610     C                     OUT  SESDS
379700200610     C**********           OUT  LDA                                       S01117
379800200610      *                                                                   CSE041
379900200610      ** If option 2 and it is a Depot or DVP/RVP movement, call its      CSE041
380000200610      ** respective APIs.                                                 CSE041
380100200610      *                                                                   CSE041
380200200610     C           OPTN      IFEQ ' 2'                                      CSE041
380300200610     C           TESTP     ANDEQ'WI'                                      CSE041
380400200610     C           OPTN      OREQ ' 2'                                      CSE041
380500200610     C           TESTP     ANDEQ'WO'                                      CSE041
380600200610     C           OPTN      OREQ ' 2'                                      CSE041
380700200610     C           TESTP     ANDEQ'RV'                                      CSE041
380800200610     C           OPTN      OREQ ' 2'                                      CSE041
380900200610     C           TESTP     ANDEQ'DP'                                      CSE041
381000200610      *                                                                   CSE041
381100200610     C           TESTP     IFEQ 'WI'                                      CSE041
381200200610     C           TESTP     OREQ 'WO'                                      CSE041
381300200610     C                     MOVE *BLANKS   INTRNO                          CSE041
381400200610     C                     MOVE STDRF     INTRNO  6                       CSE041
381500200610     C                     CALL DPPGM                                     CSE041
381600200610     C                     PARM TESTP     @TYPE   2                       CSE041
381700200610     C                     PARM           @SETY  10                       CSE041
381800200610     C                     PARM INTRNO    @TRNO   6                       CSE041
381900200610     C                     PARM           @RTCD   7                       CSE041
382000200610     C                     PARM 'SE0220'  @CALL  10                       CSE041
382100200610     C           @RTCD     IFEQ 'Y2U9999'                                 CSE041
382200200610     C                     MOVE *ON       *IN01                           CSE041
382300200610     C                     ENDIF                                          CSE041
382400200610     C                     ELSE                                           CSE041
382500200610     C           TESTP     IFEQ 'RV'                                      CSE041
382600200610     C           TESTP     OREQ 'DP'                                      CSE041
382700200610     C                     ENDIF                                          CSE041
382800200610     C                     ENDIF                                          CSE041
382900200610      *                                                                   CSE041
383000200610     C                     ELSE                                           CSE041
383100200610      *                                                                   CSE039
383200200610     C           OPTN      IFEQ ' 4'                                      CSE039
383300200610      *                                                                   CSE039
383400200610     C           CSE039    IFEQ 'Y'                                                         BUG11813
383500200610     C                     MOVE *OFF      *IN42                           CSE039
383600200610     C                     SELEC                                          CSE039
383700200610     C           TESTP     WHEQ 'WI'                                      CSE039
383800200610     C           TESTP     OREQ 'WO'                                      CSE039
383900200610     C                     MOVEL'W'       OPTYPE  1                       CSE039
384000200610     C           TESTP     WHEQ 'RV'                                      CSE039
384100200610     C           TESTP     OREQ 'DP'                                      CSE039
384200200610     C                     MOVEL'D'       OPTYPE                          CSE039
384300200610     C                     OTHER                                          CSE039
384400200610     C                     MOVEL'T'       OPTYPE                          CSE039
384500200610     C                     ENDSL                                          CSE039
384600200610     C                     MOVE *BLANKS   INTRNO                          CSE039
384700200610     C                     MOVE STDRF     INTRNO                          CSE039
384800200610     C                     CALL 'SEC025'                                  CSE039
384900200610     C                     PARM MVPGM     PPROG  10                       CSE039
385000200610     C                     PARM INTRNO    PTRNO   6                       CSE039
385100200610     C                     PARM OPTYPE    PTTYP   1                       CSE039
385200200610     C                     PARM 'E'       PMODE   1                       CSE039
385300200610     C                     PARM           PEXIT   1                       CSE039
385400200610     C                     PARM           PPREV   1                       CSE039
385500200610     C           PEXIT     IFEQ '1'                                       CSE039
385600200610     C                     MOVE *ON       *IN01                           CSE039
385700200610     C                     ENDIF                                          CSE039
385800200610     C                     ELSE                                                             BUG11813
385900200610     C                     MOVE MSG,18    ERMSG                                             BUG11813
386000200610     C                     ENDIF                                                            BUG11813
386100200610     C                     ELSE                                           CSE039
386200200610      *                                                                   CSE039
386300200610     C                     CALL TPGM
386400200610     C                     ENDIF                                          CSE039
386500200610     C                     ENDIF                                          CSE041
386600200610      *                                                                   CSE041
386700200610     C********** *LOCK     IN   LDA                                       S01117
386800200610     C           *LOCK     IN   SESDS
386900200610     C**
387000200610     C**   On return from lower level check return code
387100200610     C**
387200200610     C**   If 0 (Database Error) or 1 (F3 to return to menu)
387300200610     C**      then exit to calling program
387400200610     C**
387500200610     C           RTNC      IFEQ '0'
387600200610     C           RTNC      OREQ '1'
387700200610     C                     MOVE '1'       *IN01
387800200610     C                     END
387900200610     C**
388000200610     C**   If Return code is 7 (F9 to return to inital enquiry)
388100200610     C**      then check if this is the inital enquiry
388200200610     C**      and if not return to calling program
388300200610     C**
388400200610     C           RTNC      IFEQ '7'
388500200610     C           ORIG      ANDNEPGMNO
388600200610     C                     MOVE '1'       *IN01
388700200610     C                     END
388800200610     C**
388900200610     C                     END
389000200610     C**
389100200610     C                     ENDSR
389200200610     C**
389300200610     C*****************************************************************
389400200610      /EJECT
3895002006100738 C*****************************************************************
389600200610     C**                                                              *
389700200610     C**   RETSR  SR  End of Program Processing                       *
389800200610     C**              Write out LDA and linked enquiry data area      *
389900200610     C**              and return to the calling program               *
390000200610     C**                                                              *
390100200610     C**   Called by  MAIN, FIRST, DISP                               *
390200200610     C**   Calls  SR  none                                            *
390300200610     C**                                                              *
390400200610     C*****************************************************************
390500200610     C**
3906002006100740 C           RETSR     BEGSR                           *** RETSR   ***
3907002006100741 C**
390800200610     C                     OUT  SESDS
390900200610     C**********           OUT  LDA                                       S01117
391000200610     C**
3911002006100742 C                     SETON                     LR
3912002006100743 C                     RETRN
3913002006100744 C*
3914002006100745 C                     ENDSR
3915002006100744 C*
391600200610     C*****************************************************************
391700200610      /EJECT
391800200610     C********************************************************************S01117
391900200610     C*                                                                   S01117
392000200610     C* *PSSR - SUBROUTINE TO HANDLE ABNORMAL ERROR CONDITIONS            S01117
392100200610     C*                                                                   S01117
392200200610     C* CALLED FROM : AFTER ABNORMAL OPERATION OCCURS                     S01117
392300200610     C*                                                                   S01117
392400200610     C* CALLS : NOTHING                                                   S01117
392500200610     C*                                                                   S01117
392600200610     C*****************************************************************   S01117
392700200610     C*                                                                   S01117
392800200610     C           *PSSR     BEGSR                                          S01117
392900200610     C*                                                                   S01117
393000200610     C           @RUN      IFEQ *BLANK                                    S01117
393100200610     C                     MOVEL'Y'       @RUN    1                       S01117
393200200610     C                     DUMP                                           S01117
393300200610      *                                                                   S01117
393400200610     C                     ELSE                                           S01117
3935002006100742 C                     SETON                     U7U8LR               S01117
3936002006100743 C                     RETRN                                          S01117
393700200610     C                     END                                            S01117
393800200610     C*                                                                   S01117
393900200610     C                     ENDSR                                          S01117
394000200610     C*                                                                   S01117
394100200610     C*****************************************************************   S01117
394200200610      /EJECT                                                              S01117
394300200610     C*****************************************************************
394400200610     C**                                                              *
394500200610     C**   FIRST  SR  First Cycle Processing                          *
394600200610     C**                                                              *
394700200610     C**   Called by  MAIN                                            *
394800200610     C**   Calls  SR  RETSR, CUSSEC, ZSYSTM, ZICD2, ZICDSE, ZEVCD     *
394900200610     C**                                                              *
395000200610     C*****************************************************************
395100200610     C**
395200200610     C           FIRST     BEGSR                           ** FIRST **
395300200610     C**
395400200610     C**     Access the LDA  and  Linked Enquiry Data Area
395500200610     C**
395600200610     C********** *LOCK     IN   LDA                                       S01117
395700200610     C           *LOCK     IN   SESDS
395800200610     C                     IN   JNSTAT
395900200610     C                     IN   RUNDT                                     S01117
396000200610     C                     IN   ZMUSER                                    S01117
396100200610     C                     UNLCKJNSTAT
396200200610     C                     SETON                     51
396300200610     C*
396400200610     C****READ*INSTALLATION*CONTROL*RECORD*1*FOR*RUNDATE***************   S01117
396500200610     C***********                                                         S01117
396600200610     C***********          EXSR ZSYSTM                                    S01117
396700200610     C**********                                                          S01117
396800200610     C*****If*no*record*found**or*deleted*record***********************   S01117
396900200610     C*****then*it*is*a*database*error*so*return*to*calling************   S01117
397000200610     C*****program*with*a*return*code*of*'0'***************************   S01117
397100200610     C**********                                                          S01117
397200200610     C********** *IN99     IFEQ '1'                                       S01117
397300200610     C**********           MOVELPROGRM    DBPGM                           S01117
397400200610     C**********           MOVEL'ICDR1'   DBKEY            ***************S01117
397500200610     C**********           MOVE 'TABLE'   DBFILE           * DB ERROR 01 *S01117
397600200610     C**********           Z-ADD01        DBASE            ***************S01117
397700200610     C**********           SETON                       U7U8               S01117
397800200610     C**********           MOVE '0'       RTNC                            S01117
397900200610     C**********           EXSR RETSR                                     S01117
398000200610     C**********           END                                            S01117
398100200610      *                                                                   E32164
398200200610      ***  None of the fields from the Bank Details are required.         E32164
398300200610      *                                                                   E32164
398400200610      ***********                                                  S01117 E32164
398500200610      ***Access*Bank*Details*for*Date*of*Next*Working*day*for*ZEVCDS01117 E32164
398600200610      ***********                                                  S01117 E32164
398700200610     C***********          CALL 'AOBANKR0'                         S01117 E32164
398800200610     C***********          PARM '*DBERR ' @RTCD                    S01117 E32164
398900200610     C***********          PARM '*FIRST ' @OPTN                    S01117 E32164
399000200610     C***********SDBANK    PARM SDBANK    DSFDY                    S01117 E32164
399100200610     C***********                                                         E32164
399200200610     C****READ*INSTALLATION*CONTROL*RECORD*2*FOR*mbin******************   S01117
399300200610     C***********                                                         S01117
399400200610     C**********           EXSR ZICD2                                     S01117
399500200610     C**********                                                          S01117
399600200610     C****If*no*record*found**or*deleted*record************************   S01117
399700200610     C****then*it*is*a*database*error*so*return*to*calling*************   S01117
399800200610     C****program*with*a*return*code*of*'0'****************************   S01117
399900200610     C**********                                                          S01117
400000200610     C********** *IN99     IFEQ '1'                                       S01117
400100200610     C**********           MOVELPROGRM    DBPGM                           S01117
400200200610     C**********           MOVEL'ICDR2'   DBKEY            ***************S01117
400300200610     C**********           MOVE 'TABLE'   DBFILE           * DB ERROR 02 *S01117
400400200610     C**********           Z-ADD02        DBASE            ***************S01117
400500200610     C**********           SETON                       U7U8               S01117
400600200610     C**********           MOVE '0'       RTNC                            S01117
400700200610     C**********           EXSR RETSR                                     S01117
400800200610     C**********           END                                            S01117
400900200610     C***********                                                  S01117 E32164
401000200610      *                                                                   E32164
401100200610      ***  None of the fields from the General Ledger are required.       E32164
401200200610      *                                                                   E32164
401300200610     C***ACCESS*GENERAL*LEDGER*DETAILS**************************** S01117 E32164
401400200610     C***FOR*ACCRUALS/PROFIT*DATE*FOR*SUBROUTINE*ZEVCD************ S01117 E32164
401500200610      ***********                                                  S01117 E32164
401600200610     C***********          CALL 'AOGELRR0'                         S01117 E32164
401700200610     C***********          PARM '*DBERR ' @RTCD                    S01117 E32164
401800200610     C***********          PARM '*FIRST ' @OPTN                    S01117 E32164
401900200610     C***********SDGELR    PARM SDGELR    DSFDY                    S01117 E32164
402000200610      *                                                                   E32164
402100200610      ***  Note: DATF and MBIN actually come from RUNDAT.                 E32164
402200200610      *                                                                   E32164
402300200610     C           DATF      COMP 'M'                      98               S01117
402400200610     C**
402500200610     C           MBIN      IFEQ 'Y'
402600200610     C                     MOVE '1'       *IN07
402700200610     C                     END
402800200610     C**
402900200610     C****CALL*ZEVCD*-*TO*GET*EVENT*CONTROL*DATE*FOR*ZNCD**************   E14576
403000200610     C***********                                                         E14576
403100200610     C***********          EXSR ZEVCD                                     E14576
403200200610     C***********                                                         S01117
403300200610     C****READ*INSTALLATION*CONTROL*RECORD*SE**************************   S01117
403400200610     C***********                                                         S01117
403500200610     C***********          EXSR ZICDSE                                    S01117
403600200610     C**********                                                          S01117
403700200610     C****If*no*record*found**or*deleted*record************************   S01117
403800200610     C****then*it*is*a*database*error*so*return*to*calling*************   S01117
403900200610     C****program*with*a*return*code*of*'0'****************************   S01117
404000200610     C**********                                                          S01117
404100200610     C********** *IN99     IFEQ '1'                                       S01117
404200200610     C**********           MOVELPROGRM    DBPGM                           S01117
404300200610     C**********           MOVEL'ICDSE'   DBKEY            ***************S01117
404400200610     C**********           MOVE 'TABLE'   DBFILE           * DB ERROR 03 *S01117
404500200610     C**********           Z-ADD03        DBASE            ***************S01117
404600200610     C**********           SETON                       U7U8               S01117
404700200610     C**********           MOVE '0'       RTNC                            S01117
404800200610     C**********           EXSR RETSR                                     S01117
404900200610     C**********           END                                            S01117
405000200610      *                                                                   S01117
405100200610      ***  Access Securities Trading Detail File.                         S01117
405200200610      *                                                                   S01117
405300200610     C                     CALL 'AOSTRDR0'                                S01117
405400200610     C                     PARM '*DBERR ' @RTCD                           S01117
405500200610     C                     PARM '*FIRST ' @OPTN                           S01117
405600200610     C***********SDSTRD    PARM SDSTRD    DSFDY                     S01117S01496
405700200610     C           SDSTRD    PARM SDSTRD    DSSDY                           S01496
405800200610      *                                                                   E32164
405900200610      ***  Set indicator to show whether Trade or Value Valuations.       E32164
406000200610      *                                                                   E32164
406100200610     C                     SETOF                     09
406200200610     C********** TVVL      IFEQ 'T'                                       S01117
406300200610     C           BVTVDV    IFEQ 'T'                                       S01117
406400200610     C                     SETON                     09
406500200610     C                     END
406600200610     C**
406700200610     C**     Calculate month/year - no. months prior to rundate
406800200610     C**     - convert rundate to ddmmyy then add on no. months
406900200610     C**
407000200610     C                     Z-ADDRUND      ZDAYNO
407100200610     C                     EXSR ZDATE2
407200200610     C                     MOVE ZDATE     DAYWK
407300200610      *                                                                   E32164
407400200610     C           *IN98     IFEQ '1'
407500200610     C                     MOVE DD        MM
407600200610     C                     END
407700200610      *                                                                   E32164
407800200610     C********** MM        SUB  RTST      MMWK    20                      S01117
407900200610     C           MM        SUB  BVROST    MMWK    20                      S01117
408000200610      *                                                                   E32164
408100200610     C           MMWK      IFLE 0
408200200610     C           YY        SUB  1         ZZYR
408300200610     C           MMWK      ADD  12        ZZMNTH
408400200610     C                     ELSE
408500200610     C                     Z-ADDMMWK      ZZMNTH
408600200610     C                     Z-ADDYY        ZZYR
408700200610     C                     END
408800200610     C**
408900200610     C**     Calculate ddmmmyy date of last calendar day of month prior
409000200610     C***    to run date (LSTCLR)
409100200610     C**     Convert run date to ddmmyy or equivalent
409200200610     C**     Set dd to 01, then convert to day no
409300200610     C**     Subtract 1 from date (=last day in prev month) &
409400200610     C**     convert this date to ddmmmyy
409500200610     C**
409600200610     C/COPY WNCPYSRC,SE0220C014
409700200610     C                     Z-ADDRUND      ZDAYNO
409800200610     C/COPY WNCPYSRC,SE0220C015
409900200610     C                     EXSR ZDATE2
410000200610     C                     MOVE ZDATE     DAYWK
410100200610      *                                                                   E32164
410200200610     C           *IN98     IFEQ '1'
410300200610     C                     Z-ADD1         MM
410400200610     C                     ELSE
410500200610     C                     Z-ADD1         DD
410600200610     C                     END
410700200610      *                                                                   E32164
410800200610     C                     MOVELDAYWK     ZDATE
410900200610     C                     EXSR ZDATE1
411000200610     C                     SUB  1         ZDAYNO
411100200610     C                     Z-ADDZDAYNO    LSTCDR  50
411200200610     C                     EXSR ZDATE2
411300200610     C                     MOVE ZADATE    LSTCLR  7
411400200610     C**
411500200610     C**     If no cust. number etc found in request data
411600200610     C**        setup a blank screen for display
411700200610     C**     else access details for display
411800200610     C**
411900200610     C                     MOVE '1'       *IN03
412000200610     C**
412100200610     C********** RQCUST    IFNE *ZEROS                                                        CSD027
412200200610     C           RQCUST    IFNE *BLANKS                                                       CSD027
412300200610     C           RQCUST    ANDNE*ZEROS                                                      BUG11743
412400200610     C           RQSESN    ORNE *BLANKS
412500200610     C********** RQBRCH    ORNE *ZEROS                                    S01117
412600200610     C           RQBRCA    ORNE *BLANKS                                   S01117
412700200610      *                                                                   E32164
412800200610     C                     MOVELRQCUST    CUSTMR
412900200610     C                     MOVE *BLANKS   RQCUST
413000200610     C**********           MOVELRQBRCH    BRANCH                          S01117
413100200610     C**********           MOVE *BLANKS   RQBRCH                          S01117
413200200610     C                     MOVELRQBRCA    BRANCH                          S01117
413300200610     C                     MOVE *BLANKS   RQBRCA                          S01117
413400200610     C                     MOVELRQSESN    SECSNM
413500200610     C                     MOVE *BLANKS   RQSESN
413600200610     C/COPY WNCPYSRC,SE0220C016
413700200610     C                     EXSR CUSSEC
413800200610     C                     END
413900200610     C**
414000200610     C**      Access program name - for help and linked enquiries
414100200610     C**
414200200610     C                     MOVELPROGRM    PGMNO   8
414300200610     C**
414400200610     C**     SET UP STANDARD FIELDS FOR SFL LINES
414500200610     C**
414600200610     C                     MOVE 'B/F'     BF
414700200610     C                     MOVE 'C/F'     CF
414800200610     C                     MOVE 'S'       MARKET  1
414900200610     C                     Z-ADD1         Z       20                      E16802
415000200610     C**********           READ TABTG10F                 83         E16802S01117
415100200610     C                     READ SDCURRL0                 83               S01117
415200200610      *                                                                   E32164
415300200610     C           *IN83     DOWEQ'0'                                       E16802
415400200610     C********** CDP       IFEQ 0                                   E16802S01117
415500200610     C**********           MOVE CCYS      ARR,Z                     E16802S01117
415600200610     C           A6NBDP    IFEQ 0                                         S01117
415700200610     C                     MOVE A6SWCY    ARR,Z                           S01117
415800200610     C                     ADD  1         Z                               E16802
415900200610     C                     END                                            E16802
416000200610     C**********           READ TABTG10F                 83         E16802S01117
416100200610     C                     READ SDCURRL0                 83               S01117
416200200610     C                     END                                            E16802
416300200610      *                                                                   S01496
416400200610      **  Access SAR details file to see if JYSKE Enhcmts is installed.   S01496
416500200610      *                                                                   S01496
416600200610     C                     CALL 'AOSARDR0'                                S01496
416700200610     C                     PARM '       ' @RTCD                           S01496
416800200610     C                     PARM '*VERIFY' @OPTN                           S01496
416900200610     C                     PARM 'S01496'  WSARD   6                       S01496
417000200610      *                                                                   S01496
417100200610     C           @RTCD     IFEQ *BLANK                                    S01496
417200200610     C                     MOVE 'Y'       S01496  1                       S01496
417300200610     C                     END                                            S01496
417400200610     C/COPY WNCPYSRC,SE0220C002
417500200610      *
417600200610      ** Access SAR details file to see if CSE035 is installed                                CSE035
417700200610      *                                                                                       CSE035
417800200610     C                     CALL 'AOSARDR0'                                                    CSE035
417900200610     C                     PARM *BLANKS   @RTCD                                               CSE035
418000200610     C                     PARM '*VERIFY' @OPTN                                               CSE035
418100200610     C                     PARM 'CSE035'  WSARD                                               CSE035
418200200610      *                                                                                       CSE035
418300200610     C           @RTCD     IFEQ *BLANK                                                        CSE035
418400200610     C                     MOVE 'Y'       CSE035  1                                           CSE035
418500200610     C                     ELSE                                                               CSE035
418600200610     C                     MOVE 'N'       CSE035                                              CSE035
418700200610     C                     ENDIF                                                              CSE035
418800200610      *                                                                                       207543
418900200610      ** Access SAR details file to see if CEU018 is installed                                207543
419000200610      *                                                                                       207543
419100200610     C                     CALL 'AOSARDR0'                                                    207543
419200200610     C                     PARM *BLANKS   @RTCD                                               207543
419300200610     C                     PARM '*VERIFY' @OPTN                                               207543
419400200610     C                     PARM 'CEU018'  WSARD                                               207543
419500200610      *                                                                                       207543
419600200610     C           @RTCD     IFEQ *BLANK                                                        207543
419700200610     C                     MOVE 'Y'       CEU018  1                                           207543
419800200610     C                     ELSE                                                               207543
419900200610     C                     MOVE 'N'       CEU018                                              207543
420000200610     C                     ENDIF                                                              207543
420100200610      *                                                                   CSE010
420200200610      ** Check is CSE010 is installed                                     CSE010
420300200610      *                                                                   CSE010
420400200610     C                     MOVE 'N'       CSE010  1                       CSE010
420500200610     C                     CALL 'AOSARDR0'                                CSE010
420600200610     C                     PARM *BLANKS   PRTCD   7                       CSE010
420700200610     C                     PARM '*VERIFY' POPTN   7                       CSE010
420800200610     C                     PARM 'CSE010'  PSARD   6                       CSE010
420900200610      *                                                                   CSE010
421000200610     C           PRTCD     IFEQ *BLANK                                    CSE010
421100200610     C                     MOVE 'Y'       CSE010                          CSE010
421200200610     C                     ELSE                                           CSE010
421300200610      *                                                                   CSE010
421400200610      ** Database Error (return code other than *NRF)                     CSE010
421500200610      *                                                                   CSE010
421600200610     C           PRTCD     IFNE '*NRF   '                                 CSE010
421700200610     C           *LOCK     IN   LDA                                       CSE010
421800200610     C                     MOVEL'SCSARDPD'DBFILE           ************   CSE010
421900200610     C                     MOVEL'*VERIFY' DBKEY            * DBERR 10 *   CSE010
422000200610     C                     Z-ADD10        DBASE            ************   CSE010
422100200610     C                     OUT  LDA                                       CSE010
422200200610     C                     MOVE *ON       *INU7                           CSE010
422300200610     C                     MOVE *ON       *INU8                           CSE010
422400200610     C                     MOVE *ON       *INLR                           CSE010
422500200610     C                     EXSR *PSSR                                     CSE010
422600200610     C                     ENDIF                                          CSE010
422700200610     C                     ENDIF                                          CSE010
422800200610      *                                                                   CSD007
422900200610      ** Access SAR details file to see if 'Customer closing' is          CSD007
423000200610      ** installed.                                                       CSD007
423100200610      *                                                                   CSD007
423200200610     C                     CALL 'AOSARDR0'                                CSD007
423300200610     C                     PARM *BLANKS   @RTCD                           CSD007
423400200610     C                     PARM '*VERIFY' @OPTN                           CSD007
423500200610     C                     PARM 'CSD007'  @SARD   6                       CSD007
423600200610      *                                                                   CSD007
423700200610     C           @RTCD     IFNE *BLANKS                                   CSD007
423800200610     C           @RTCD     ANDNE'*NRF   '                                 CSD007
423900200610     C                     MOVEL'SCSARDPD'DBFILE                          CSD007
424000200610     C                     MOVEL'CSD007'  DBKEY                           CSD007
424100200610     C                     Z-ADD11        DBASE                           CSD007
424200200610     C                     EXSR *PSSR                                     CSD007
424300200610     C                     ENDIF                                          CSD007
424400200610      *                                                                   CSD007
424500200610     C           @RTCD     IFEQ *BLANKS                                   CSD007
424600200610     C                     MOVE 'Y'       CSD007  1                       CSD007
424700200610     C                     ELSE                                           CSD007
424800200610     C                     MOVE 'N'       CSD007                          CSD007
424900200610     C                     ENDIF                                          CSD007
425000200610      *                                                                   CSE041
425100200610      ** Check if CSE041 is installed                                     CSE041
425200200610      *                                                                   CSE041
425300200610     C                     CALL 'AOSARDR0'                                CSE041
425400200610     C                     PARM *BLANKS   PRTCD                           CSE041
425500200610     C                     PARM '*VERIFY' POPTN                           CSE041
425600200610     C                     PARM 'CSE041'  PSARD                           CSE041
425700200610      *                                                                   CSE041
425800200610     C           PRTCD     IFEQ *BLANK                                    CSE041
425900200610     C                     MOVE 'Y'       CSE041  1                       CSE041
426000200610     C                     ELSE                                           CSE041
426100200610     C                     MOVE 'N'       CSE041                          CSE041
426200200610     C                     ENDIF                                          CSE041
426300200610      *                                                                   CSE039
426400200610      ** Check if CSE039 is installed                                     CSE039
426500200610      *                                                                   CSE039
426600200610     C                     CALL 'AOSARDR0'                                CSE039
426700200610     C                     PARM *BLANKS   PRTCD                           CSE039
426800200610     C                     PARM '*VERIFY' POPTN                           CSE039
426900200610     C                     PARM 'CSE039'  PSARD                           CSE039
427000200610      *                                                                   CSE039
427100200610     C           PRTCD     IFEQ *BLANK                                    CSE039
427200200610     C                     MOVE 'Y'       CSE039  1                       CSE039
427300200610     C                     ELSE                                           CSE039
427400200610     C                     MOVE 'N'       CSE039                          CSE039
427500200610     C                     ENDIF                                          CSE039
427600200610      *                                                                   E32164
427700200610     C                     ENDSR
427800200610     C*                                                                   E32164
427900200610     C*****************************************************************
428000200610      /EJECT                                                              S01117
428100200610     C*****************************************************************   S01117
428200200610     C*                                                               *   S01117
428300200610     C* CHKSEL - SUBROUTINE TO CHECK FOR SELECTION ON KEY FIELDS      *   S01117
428400200610     C*                                                               *   S01117
428500200610     C* CALLED FROM : MAIN,COMMD                                      *   S01117
428600200610     C*                                                               *   S01117
428700200610     C* CALLS : NOTHING                                               *   S01117
428800200610     C*                                                               *   S01117
428900200610     C*****************************************************************   S01117
429000200610     C*                                                                   S01117
429100200610     C           CHKSEL    BEGSR                                          S01117
429200200610     C*                                                                   S01117
429300200610     C                     MOVEL'N'       @SEL    1                       S01117
429400200610     C                     MOVELCUSTMR    @STP    1                       S01117
429500200610     C*                                                                   S01117
429600200610     C           @STP      IFEQ '?'                                       S01117
429700200610     C                     MOVEL'Y'       @SEL                            S01117
429800200610     C                     MOVELCUSTMR    @SKEY                           S01117
429900200610     C*                                                                   S01117
430000200610     C                     CALL 'AOSECSR0'                                S01117
430100200610     C                     PARM *BLANKS   @RTCD                           S01117
430200200610     C                     PARM '*KEY   ' @OPTN                           S01117
430300200610     C                     PARM           @SKEY                           S01117
430400200610     C           SDSECS    PARM SDSECS    DSSDY                           S01117
430500200610     C*                                                                   S01117
430600200610     C                     SETOF                     41                   S01117
430700200610     C                     MOVEL*BLANKS   CUSTMR                          S01117
430800200610     C           @RTCD     IFEQ *BLANKS                                   S01117
430900200610     C                     MOVELBFCUST    CUSTMR                          S01117
431000200610     C                     END                                            S01117
431100200610     C                     END                                            S01117
431200200610     C*                                                                   S01117
431300200610     C           *IN07     IFEQ '1'                                       S01117
431400200610     C*                                                                   S01117
431500200610     C/COPY WNCPYSRC,SE0220C003
431600200610      *                                                                   CSE010
431700200610      ** If CSE010 is installed, and a '?' is found anywhere in the       CSE010
431800200610      ** Security Shortname field                                         CSE010
431900200610      *                                                                   CSE010
432000200610     C           CSE010    IFEQ 'Y'                                       CSE010
432100200610     C                     MOVELSECSNM    WQMK    1                       CSE010
432200200610     C           WQMK      IFEQ '?'                                       CSE010
432300200610     C                     MOVE '1'       @SEL                            CSE010
432400200610     C                     MOVE SECSNM    @SESN                           CSE010
432500200610     C                     CALL 'SE0043'                                  CSE010
432600200610     C                     PARM           @ACTN   1                       CSE010
432700200610     C                     PARM           @SESN  10                       CSE010
432800200610      *                                                                   CSE010
432900200610     C           @SESN     IFNE *BLANKS                                   CSE010
433000200610     C                     MOVE @SESN     SECSNM                          CSE010
433100200610     C                     ELSE                                           CSE010
433200200610     C                     MOVE *BLANKS   SECSNM                          CSE010
433300200610     C                     ENDIF                                          CSE010
433400200610     C                     ENDIF                                          CSE010
433500200610     C                     ENDIF                                          CSE010
433600200610     C                     MOVELBRANCH    @STP    1                       S01117
433700200610     C*                                                                   S01117
433800200610     C           @STP      IFEQ '?'                                       S01117
433900200610     C                     MOVEL'Y'       @SEL                            S01117
434000200610     C                     MOVELBRANCH    @BKEY                           S01117
434100200610     C*                                                                   S01117
434200200610     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
434300200610     C                     CALL 'AOBRCHR1'                                                    CGL029
434400200610     C                     PARM *BLANKS   @RTCD                           S01117
434500200610     C                     PARM '*KEY   ' @OPTN                           S01117
434600200610     C                     PARM           @BKEY                           S01117
434700200610     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
434800200610     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
434900200610     C*                                                                   S01117
435000200610     C                     SETOF                     45                   S01117
435100200610     C                     MOVEL*BLANKS   BRANCH                          S01117
435200200610     C           @RTCD     IFEQ *BLANKS                                   S01117
435300200610     C                     MOVELA8BRCD    BRANCH                          S01117
435400200610     C                     END                                            S01117
435500200610     C                     END                                            S01117
435600200610      *                                                                   S01117
435700200610     C                     END                                            S01117
435800200610     C*                                                                   S01117
435900200610     C                     ENDSR                                          S01117
436000200610     C*                                                                   S01117
436100200610     C*****************************************************************   S01117
436200200610      /EJECT                                                              S01496
436300200610     C*****************************************************************   S01496
436400200610     C*                                                                   S01496
436500200610     C**   P001 SR - CHANGE TRANSACTIONS TYPES                            S01496
436600200610     C**                                                                  S01496
436700200610     C**   Called by  SUBFIL                                              S01496
436800200610     C**                                                                  S01496
436900200610     C**   Calls                                                          S01496
437000200610     C*                                                                   S01496
437100200610     C*****************************************************************   S01496
437200200610     C           P001      BEGSR                                          S01496
437300200610     C*                                                                   S01496
437400200610     C           STYPE     IFEQ 'PUR'                      *B1            S01496
437500200610     C           STYPE     OREQ 'SAL'                                     S01496
437600200610     C                     OPEN SEERALL2                                  S01496
437700200610     C           TDRF      SETLLSEERALL2                 87               S01496
437800200610     C*                                                                   S01496
437900200610     C           *IN87     IFEQ '1'                        *B2            S01496
438000200610     C*                                                                   S01496
438100200610     C           STYPE     IFEQ 'PUR'                                     S01496
438200200610     C                     MOVEL'TRI'     STYPE                           S01496
438300200610     C                     END                                            S01496
438400200610     C           STYPE     IFEQ 'SAL'                                     S01496
438500200610     C                     MOVEL'TRO'     STYPE                           S01496
438600200610     C                     END                                            S01496
438700200610     C*                                                                   S01496
438800200610     C                     END                             *E2            S01496
438900200610     C*                                                                   S01496
439000200610     C                     CLOSESEERALL2                                  S01496
439100200610     C                     END                             *E1            S01496
439200200610     C*                                                                   S01496
439300200610     C           STYPE     IFEQ 'WI '                                     S01496
439400200610     C           STYPE     OREQ 'WO '                                     S01496
439500200610     C*                                                                   S01496
439600200610     C           KEY1      KLIST                                          S01496
439700200610     C                     KFLD           TDSS                            S01496
439800200610     C                     KFLD           TDRF                            S01496
439900200610     C*                                                                   S01496
440000200610     C                     OPEN SEERALL5                                  S01496
440100200610     C           KEY1      SETLLSEERALL5                 87               S01496
440200200610     C*                                                                   S01496
440300200610     C           *IN87     IFEQ '1'                        *B2            S01496
440400200610     C*                                                                   S01496
440500200610     C           STYPE     IFEQ 'WI '                                     S01496
440600200610     C                     MOVEL'DRI'     STYPE                           S01496
440700200610     C                     END                                            S01496
440800200610     C           STYPE     IFEQ 'WO '                                     S01496
440900200610     C                     MOVEL'DRO'     STYPE                           S01496
441000200610     C                     END                                            S01496
441100200610     C*                                                                   S01496
441200200610     C                     END                             *E2            S01496
441300200610     C*                                                                   S01496
441400200610     C                     CLOSESEERALL5                                  S01496
441500200610     C*                                                                   S01496
441600200610     C                     END                             *E1            S01496
441700200610     C*                                                                   S01496
441800200610     C                     ENDSR                                          S01496
441900200610     C*****************************************************************   S01496
442000200610      ***/EJECT******************                                  S01232 S01195
442100200610     C***/COPY*ZSRSRC,XDATE3Z1***                                  S01232 S01195
442200200610      /EJECT                                                              S01232
442300200610     C/COPY ZSRSRC,ZBKDT                                                  S01195
442400200610      /EJECT                                                              S01195
442500200610     C/COPY ZSRSRC,ZACCH                                                  S01195
442600200610      /EJECT                                                              S01232
442700200610     C/COPY ZSRSRC,ZACCRZ1                                                S01232
442800200610      /EJECT                                                              S01232
442900200610     C/COPY ZSRSRC,ZACCZZ1                                                S01232
443000200610     C/EJECT                                                              E39495
443100200610     C/COPY ZSRSRC,ZCALCD                                                 E39495
443200200610      /EJECT                                                              E21002
443300200610     C/COPY ZSRSRC,ZCNSDZ1                                                E21002
443400200610      /EJECT
443500200610     C/COPY ZSRSRC,ZCONVZ1
443600200610      /EJECT                                                              E21002
443700200610     C/COPY ZSRSRC,ZCSCTPZ1                                               E21002
443800200610      /EJECT
443900200610     C/COPY ZSRSRC,ZDATE1Z2
444000200610      /EJECT
444100200610     C/COPY ZSRSRC,ZDATE2Z4
444200200610      ***/EJECT*****************                                          E14576
444300200610     C***/COPY*ZSRSRC,ZDAYSZ2***                                          E14576
444400200610      /EJECT                                                              E19918
444500200610     C/COPY ZSRSRC,ZDAYSZ2                                                E19918
444600200610      ***/EJECT*****************                                          E14576
444700200610     C***/COPY*ZSRSRC,ZDYYRZ3***                                          E14576
444800200610      /EJECT                                                              E19918
444900200610     C/COPY ZSRSRC,ZDYYRZ3                                                E19918
445000200610      ***/EJECT*****************                                          E14576
445100200610     C***/COPY*ZSRSRC,ZEVCDZ1***                                          E14576
445200200610      /EJECT                                                              E19918
445300200610     C/COPY ZSRSRC,ZEVCDZ1                                                E19918
445400200610      ***/EJECT*****************                                          S01117
445500200610     C***/COPY*ZSRSRC,ZICD2Z1***                                          S01117
445600200610      ***/EJECT******************                                         S01117
445700200610     C***/COPY*ZSRSRC,ZICDSEZ1***                                         S01117
445800200610      /EJECT                                                              E20380
445900200610     C/COPY ZSRSRC,ZLCDZ1                                                 E20380
446000200610      ***/EJECT****************                                           E14576
446100200610     C***/COPY*ZSRSRC,ZNCDZ3***                                           E14576
446200200610      /EJECT                                                              E19918
446300200610     C/COPY ZSRSRC,ZNCDZ3                                                 E19918
446400200610      /EJECT                                                              E21002
446500200610     C/COPY ZSRSRC,ZPRCIZ1                                                E21002
446600200610      ***/EJECT*****************                                          E14576
446700200610     C***/COPY*ZSRSRC,ZPRCOZ1***                                          E14576
446800200610      /EJECT                                                              E19918
446900200610     C/COPY ZSRSRC,ZPRCOZ1                                                E19918
447000200610      /EJECT                                                              S01232
447100200610     C/COPY ZSRSRC,ZRATEZ1                                                S01232
447200200610      /EJECT
447300200610     C/COPY ZSRSRC,ZSDESCZ3
447400200610      /EJECT
447500200610     C/COPY ZSRSRC,ZSEDITZ3
447600200610      ***/EJECT******************                                         S01117
447700200610     C***/COPY*ZSRSRC,ZSYSTMZ1***                                         S01117
447800200610      /EJECT                                                              S01232
447900200610     C/COPY ZSRSRC,ZYCEZ1                                                 S01232
448000200610      /EJECT                                                              E21002
448100200610     C/COPY ZSRSRC,ZYLDIZ1                                                E21002
448200200610      ***/EJECT*****************                                          E14576
448300200610     C***/COPY*ZSRSRC,ZYLDOZ1***                                          E14576
448400200610      /EJECT                                                              E19918
448500200610     C/COPY ZSRSRC,ZYLDOZ1                                                E19918
448600200610      ***/EJECT****************                                           E14576
448700200610     C***/COPY*ZSRSRC,ZYLDZ2***                                           E14576
448800200610      /EJECT                                                              E19918
448900200610     C/COPY ZSRSRC,ZYLDZ2                                                 E19918
449000200610      /EJECT
449100200610      ***
449200200610**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
4493002006100366073110961461
449400200610**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
449500200610000031059090120151181212243273304334365
449600200610**   ZMNM - MONTHS SHORT NAMES
449700200610JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
449800200610**  POWER8 - ARRAY OF POWERS FOR NOMINAL DP TO CURRENCY DP CONVERSION
44990020061000000001
45000020061000000010
45010020061000000100
45020020061000001000
45030020061000010000
45040020061000100000
45050020061001000000
45060020061010000000
450700200610**   MSG  - ERROR MESSAGES  - S01117 ADDED ERROR MESSGES 15 AND 16        S01117
450800200610ENTER A CUSTOMER NO./SHORTNAME, OR TAKE F/6 FOR SHORTNAME ENQUIRY
450900200610INVALID ENTRY - BOTH CUSTOMER NO./SHORTNAME AND OPTION ENTERED
451000200610INVALID ENTRY - ONLY ONE OPTION MAY BE SELECTED
451100200610INVALID OPTION - ENTER 1(SECURITY DETAILS) 2(TRADE DETS) OR 3(CLIENT HOLDINGS)
451200200610INVALID CUSTOMER NO./SHORTNAME - PLEASE RE-ENTER                                             BUG2271
451300200610THIS IS THE INITIAL ENQUIRY - F/3 WILL EXIT TO MENU
451400200610ENTER A CUSTOMER NUMBER OR SHORTNAME, OR SELECT AN OPTION
451500200610INVALID BRANCH - PLEASE RE-ENTER
451600200610INVALID MONTH/YEAR - PLEASE RE-ENTER
451700200610MONTH/YEAR IS BEFORE THE TRADE RETENTION PERIOD - PLEASE RE-ENTER
451800200610INVALID SECURITY SHORTNAME - PLEASE RE-ENTER                                                 BUG2271
451900200610F/6 INVALID AS NEITHER CUSTOMER OR SECURITY IS BLANK
452000200610OPTION NOT VALID FOR DEPOT MOVEMENT
452100200610CUSTOMER ENTERED IS NOT A PORTFOLIO CUSTOMER - PLEASE RE-ENTER
452200200610USER IS NOT AUTHORISED TO ANY BOOKING BRANCHES
452300200610USER IS NOT AUTHORISED TO THE BOOKING BRANCH
452400200610OPTION IS NOT VALID FOR SECURITY
452500200610INVALID OPTION - ENTER 1(SECURITY DETAILS) 2(MOVEM DETS) OR 3(CLIENT HOLDINGS)
452600200610VALID OPTIONS - 1(SE DETAILS) 2(MOVEM DETS) 3(CLIENT HOLDGS) OR 4(MOVEM STATUS)
452700200610**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
4528002006100000001
4529002006100000010
4530002006100000100
4531002006100001000
4532002006100010000
4533002006100100000
4534002006101000000
453500200610**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
4536002006100006001521029820444305904073650882610287117481320914670161311759219053
4537002006102051421975234362489726358278192928030741322023366335124365853804639507
45380020061040968424294389045351
453900200610**  CPY@
454000200610(c) Finastra International Limited 2001
