     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Own holdings enquiry')                        *
      *****************************************************************
      *                                                               *
      *  Midas - Securities Trading Module                            *
      *                                                               *
      *  SE0230 - OWN HOLDINGS ENQUIRY                                *
      *                                                               *
      *  Function:  This program displays, for all holdings held on   *
      *   (I/C)     behalf of the bank, the total Nominal Position    *
      *             for each Security.  Details shown include Book    *
      *             and Market Price and Book and Market Value in the *
      *             Currency of the Security.                         *
      *             Optional selections are:                          *
      *             - Figures for Trade or Value Date positions       *
      *               (Default Value Date);                           *
      *             - Market (If none is selected all Markets shown); *
      *             - Security Shortname (If none selected, the first *
      *                       Security alphabetically is displayed);  *
      *             - Branch (If Multi-branching environment)         *
      *             Entry of the Book selected is mandatory.          *
      *             Each option available from this enquiry is held   *
      *             as a record on PF/SECOND - Linked Enquiry Control *
      *             file with fields: Calling Program, Option         *
      *             Selected, Called Program.                         *
      *                                                               *
      *  Calls:     Options may be entered against a security to call:*
      *             1) SE0245 - Security Details Enquiry              *
      *             2) SE0225 - Trades by Security Enquiry.           *
      *                                                               *
      *  Called By: SEC04 - CL Component to Control SE Enquiries      *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. 248698             Date 01Jun20               *
      *  Prev Amend No. MD053052           Date 25Jul19               *
      *                 MD046248           Date 05Feb18               *
      *                 MD048351           Date 16Nov17               *
      *                 CSE109             Date 06Oct17               *
      *                 226449             Date 24Jun15               *
      *                 MD034776           Date 08Jul15               *
      *                 AR1067108          Date 11Dec12               *
      *                 AR1001183A         Date 20Nov12               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      *                 245887             Date 27Feb07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 234713             Date 16Oct06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSE075             Date 17Nov05               *
      *                 CSE071             Date 19Jul05               *
      *                 229857             Date 07Oct04               *
      *                 219779             Date 24Jul03               *
      *                 226570             Date 27Jun04               *
      *                 CGL029             Date 01Sep03               *
      *                 CAS006             Date 21Jan03               *
      *                 211407             Date 11Nov02               *
      *                 194370             Date 12Jul01               *
      *                 207543             Date 17JUL02               *
      *                 180056             Date 18Oct00               *
      *                 CSE035             Date 22Apr02               *
      *                 206316             Date 19Jul02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 17Jun01               *
      *                 CSE031             Date 06Dec01               *
      *                 180707             Date 25Jul00               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 185786             Date 29Mar01               *
      *                 152925             Date 29Mar01               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 140272             Date 20Apr00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CSE006             Date 25Jun99               *
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CSE010             Date 21Jun99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CAC005             Date 14Jan99               *
      *                 130862             Date 18Oct98               *
      *                 151945             Date 06Jan99               *
      *                 CSE005             Date 04Feb97               *
      *                 084704             Date 01Aug96               *
      *                 083039             DATE 01AUG96               *
      *                 059110             DATE 25JUL96               *
      *                 S01408             DATE 27JUN96               *
      *                 088047             DATE 26JUN96               *
      *                 100228             DATE 30MAY96               *
      *                 075330             DATE 14MAY96               *
      *                 099886             DATE 18APR96               *
      *                 100017             DATE 18APR96               *
      *                 S01408             DATE 04FEB96               *
      *                 092961             DATE 04OCT95               *
      *                 091254             DATE 20OCT95               *
      *                 081694             DATE 10OCT95               *
      *                 086491             DATE 15JUN95               *
      *                 064575             DATE 15AUG94               *
      *                 065301             DATE 05MAY94               *
      *                 055190             DATE 11JAN94               *
      *                 054259             DATE 19NOV93               *
      *                 052254             DATE 19NOV93               *
      *                 055184             DATE 18AUG93               *
      *                 S01401             DATE 16JUN93               *
      *                 E39495             DATE 17FEB93               *
      *                 E47922             DATE 01FEB93               *
      *                 S01397             DATE 10SEP92               *
      *                 E37285             DATE 16APR92               *
      *                 E36743             DATE 05MAR92               *
      *                 E32653             DATE 29NOV91               *
      *                 E32243             DATE 25NOV91               *
      *                 E01890             DATE 12NOV91               *
      *                 E27934             DATE 22OCT91               *
      *                 E28170             DATE 21OCT91               *
      *                 E27092             DATE 04SEP91               *
      *                 E23941             DATE 13MAR91               *
      *                 S01117             DATE 01MAR91               *
      *                 S01195             DATE 01MAR91               *
      *                 S01220             DATE 01MAR91               *
      *                 S01269             DATE 31JUL90               *
      *                 E23340             DATE 14AUG90               *
      *                 E22564             DATE 14AUG90               *
      *                 E22542             DATE 21JUN90               *
      *                 E21668             DATE 01MAY90               *
      *                 E21616             DATE 03APR90               *
      *                 E21314             DATE 06MAR90               *
      *                 E21243             DATE 26FEB90               *
      *                 S01232             DATE 17NOV89               *
      *                 E20380             DATE 29NOV89               *
      *                 E20084             DATE 03NOV89               *
      *                 E19615             DATE 02NOV89               *
      *                 E19917             DATE 20OCT89               *
      *                 S01199             DATE 03/08/89              *
      *                 E16818             DATE 13/02/89              *
      *                 E16149             DATE 13/02/89              *
      *                 S01176             DATE 08/11/88              *
      *                 E15690             DATE 26/10/88              *
      *                 S01179             DATE 21/10/88              *
      *                 E13571             DATE 05/08/88              *
      *                 E14050             DATE 26/07/88              *
      *                 E14057             DATE 01/07/88              *
      *                 E13852             DATE 22/06/88              *
      *                 E13851             DATE 22/06/88              *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  248698 - Rounding discrepancies on some SE reports. Applied  *
      *           fix 228682.                                         *
      *  228682 - Recompiled due to ZCNSDZ1 changes. Applied 176594.  *
      *  MD053052 - H/A Default Value in Own Holdings Enquiry.        *
      *             Relocate the defaulting in SR/FIRST right after   *
      *             checking CSE109 feature.                          *
      *  MD046248 - Finastra Rebranding                               *
      *  MD048351 - [MIDAS-QA][FB2.1][SP16][MA][Sprint 1][CSE109] -   *
      *             Field names Market and Security are shortened in  *
      *             Own Holdings Enquiry. Amend program to complete   *
      *             the spelling for Market and Security. Recompile   *
      *             due to changes in SE0230DF.                       *
      *  CSE109 - Own holding enquriry enhancements                   *
      *           Add Unrealised P&L to enquiry.                      *
      *  226449 - Recompiled over changes made in /COPY ZDYYRZ3.      *
      *         - Applied for MD034387.                               *
      *  MD034776 - Reverse AR1001183A to allow negative interest     *
      *             rate. (Recompile)                                 *
      *  AR1067108 - PMC1140 Component failed during Clean COB        *
      *              Applied fix AR1001183A                           *
      *  AR1001183A - Coupon rate was still used in computation of    *
      *              interest instead of using the details in FRN tab *
      *              (Reopen) (Recompile)                             *
      *  245887 - Incorrect description retrieved for Security when   *
      *           previously read Security has a Nominal of Zero.     *
      *           (Applied fix from 232576.)                          *
      *  234713 - MAIN%2FENQY%2FTRAN%2FOHLD does not run correctly    *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSE075 - US Enhanced Treasury Upgrade to MidasPlus           *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  229857 - Recompiled due to change in ZYLDZ2.                 *
      *  219779 - SECURITY POSITIONS OF 0 SHOULD NOT APPEAR
      *  226570 - Recompiled due to change in ZYLDZ2.                 *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  211407 - Recompile after change on copy sources ZYLDZ2,      *
      *           ZACCRZ1 and ZYCEZ1 for NX/NNX processing.           *
      *           The change was to call subroutine ZLCD1 instead     *
      *           of ZLCD in retrieving the PERIOD for NNX processing *
      *           and ZNCD1 is called instead of ZNCD in retrieving   *
      *           the WBENCD for NNX processing. Also rewrite tests   *
      *           for identifying if position is NX,NNX or CUM.       *
      *  194370 - Recompile after change on copy sources ZYLDZ2,      *
      *           For securities with divisor basis = '5' and first   *
      *           coupon date > valuation date (rundate + 1), set     *
      *           event control date to first coupon date before      *
      *           processing SR/ZDYYR. This is to ensure that the     *
      *           correct hypothetical last and next coupon dates are *
      *           used in deriving the price/yield rate.              *
      *  207543 - CEU018 not working on a price basis.                *
      *           Recompiled over changed ZYLDZ2.                     *
      *  180056 - Recompiled over changed in ZDYYRZ3.                 *
      *  CSE035 - NX/NNX Coupon Payment Processing.                   *
      *           Recompile over changed ZACCRZ1/ZYLDZ2/ZYCEZ1
      *  206316 - Recompiled over changed ZLCDZ1.                     *
      *  CPK015 - Conversion of ZYIELD from PLI to RPG.               *
      *           Recompile over changed ZYLDZ2.                      *
      *  CSE031 - Coupon Fixing for Floating Rate Notes.              *
      *           (recompilation due to change to ZNCD/ZLCD/ZACCR).   *
      *  180707 - No Position Settlements generated. Recompile over   *
      *           changes in /COPY ZNCDZ3.                            *
      *  185786 - addition to 152925                                  *
      *  152925 - Incorrect Book Price (error in CAC005)              *
      *  140272 - Recompile over changed ZYLDZ2                       *
      *  CSE006 - Repurchase Agreements (REPOs) enhancement           *
      *           Buy-Sell Books are no longer processed              *
      *  CSE010 - SE Transactions Enhancement                         *
      *  CAC005 - PCA-SE Enhancement.                                 *
      *  130862 - Recompiled over ZLCDZ1 & ZDAYSZ2 changes.           *
      *  151945 - Recompiled Over changed ZDYYRZ3 .                   *
      *  CSE005 - Effect of holidays on FRN Coupon Dates              *
      *           (recompilation due to change to ZNCD/ZLCD/ZACCR).   *
      *  084704 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
      *  083039 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
      *  059110 - Recompiled over changed ZYLDZ2 sub.                 *
      *  S01408 - Addition of core hook SE0230CP11
      *           Addition of core hook SE0230CP10
      *  088047 - RECOMPILE over change SR/ZYLDZ2.                    *
      *  100228 - RECOMPILE OVER CHANGED ZDYYRZ3, ZLCDZ1 & ZNCDZ3.    *
      *  075330 - Book price and book value incorrect after value date*
      *           because CDP not considered during calculation.      *
      *           Use SR/ZCNSDZ1.                                     *
      *  099886 - Rounding problem for partly paid securities.        *
      *           Recompile over amended standard subroutine ZACCZ.   *
      *  100017 - Position settlement unable to pick up day adj. on   *
      *           SECTYD. Change subroutine to use DADJN to stop      *
      *           interest day adjustment being used for amortisation.*
      *           Recompile over amended subroutine ZDAYS.            *
      *  S01408 - Addition of core hook SE0230FFP1
      *           Addition of core hook SE0230CCP1
      *           Addition of core hook SE0230CCP2
      *           Addition of core hook SE0230CCP3
      *           Addition of core hook SE0230CCP4
      *           Addition of core hook SE0230CCP5
      *           Addition of core hook SE0230CCP6
      *           Addition of core hook SE0230CCP7
      *           Addition of core hook SE0230CCP8
      *           Addition of core hook SE0230CCP9
      *           Addition of core hook SE0230FFP1
      *  092961 - Recompile over ZDAYSZ2 which was amended by 086491  *
      *           (Wrong number of days calculated for day basis 1    *
      *           when start or end day is last day of February)      *
      *  091254 - RECOMPILE OVER CHANGED ZLCDZ1 & ZNCDZ3              *
      *  081694 - Interest shown with leading zeros                   *
      *  086491 - Wrong nbr of days calculated for day basis 1        *
      *           when start or end day is last day of February       *
      *           Recompiled for ZSRSRC/ZDAYSZ2 changes.              *
      *  064575 - Recompiled over amended ZYLDZ2 subroutine.          *
      *  065301 - Recompiled over changed copy source ZACCR subr.     *
      *           with ZAMT increased to 15,0.                        *
      *  055190 - Security shown although trade is in wrong book      *
      *  054259 - EXPOSURE MUST BE EQUAL TO NOMINAL X PRICE X CURRENT *
      *           FACTOR FOR PROT = 8.                                *
      *  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
      *           to 10,9                                             *
      *  055184 - Ensure last page of subfile is displayed            *
      *           (Applied fix 054202)                                *
      *         - When display in subfile has only one extra record   *
      *           to display for roll up; subfile page has previous   *
      *           SFLRCDNBR; hence page did not go forward            *
      *           (Applied fix 044297 - needed by 054202)             *
      *  S01401 - MT5xx SWIFT Messages Feature:                       *
      *           - Recompiled due to changes to files.               *
      *  E39495 - New /COPY subroutine ZCALCD added (called from      *
      *           sr. ZYLD)                                           *
      *         - Recompiled over changed ZYLDZ2                      *
      *  047922 - Recompiled over changed SR/ZYLDZ2                   *
      *  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
      *           - Recompiled due to changes to files and SR/ZYLD.   *
      *  E37285 - Market was abbreviated unnecessarily                *
      *  E36743 - Use Average Price from BKPHDD, not BKPOSD as new    *
      *           Mark-to-Market processing does not update the AP    *
      *           Numerator on PF/BKPOSD.                             *
      *  E32653 - In SR/DISP, the accumulations of Nominal Positions  *
      *           for Value Date include field "UDPT". This is the    *
      *           Depot. The correct field is "UDTP".                 *
      *  E32243 - When SR/ZAVPR is executed, ZCDP may not have been   *
      *           initialised with the correct value. This should be  *
      *           done at the same time as NCDP, after Currency File  *
      *           access.                                             *
      *  E01890 - 'Not Available' should only be shown for yield or   *
      *           discount prices on trade date selection             *
      *  E28170 - Book price, book value, and market value being      *
      *           displayed for zero positions  (E22564 is wrong)     *
      *  E27092 - Recompiled over changed SR/ZLCD                     *
      *  E23941 - Incorrect narrative on screen                       *
      *  S01117 - Multibranching : Access Object changes              *
      *  S01195 - Holiday Processing                                  *
      *  S01220 - Recompiled for Strategic Risk Management            *
      *  S01269 - TRADE AUTHORISTION: Recompiled for change to file   *
      *           TABSE                                               *
      *  E23340 - Enquiry should not show Disc/Yield price on Trade   *
      *           Date Positions                                      *
      *  E22564 - Book Price for mort-backed Securities out by a      *
      *           Factor of 100                                       *
      *  E22542 - RQBOOK reset to blank in DTAARA SESDS so that       *
      *           initial screen comes up blank and not with details  *
      *           from a previous enquiry.                            *
      *  E21668 - Recompiled over changed SR/ZYLDZ2                   *
      *  E21616 - Recompiled over changed SR/ZLCD.                    *
      *  E21314 - Further modifications to Price conversions.         *
      *  E21243 - Make Price conversions consistent and show Prices   *
      *           in Price/Discount/Yield format on screen.           *
      *  S01232 - Australian Yields modifications.                    *
      *  E20380 - New version of ZYLD for Div Basis 5.                *
      *  E20084 - Output Market Price as held - do not attempt to     *
      *           convert into a P/D/Y field - it already is.         *
      *  E19615 - Database Error in File INVTP at 06 - strange Key    *
      *           due to the fact that it gets fields incorrectly.    *
      *  E19917 - Ensure RQSESN is used in CHAIN to SECTY so that the *
      *           selected Security (from SESDS) is top of the list.  *
      *  S01199 - Help System.                                        *
      *  E16818 - Adjust Average Price for Currency Decimal Places    *
      *           and allow for Percentage Price Basis.               *
      *  E16149 - Use Average Price from BKPHDD, not BKPOSD as new    *
      *           Mark-to-Market processing does not update the AP    *
      *           Numerator on PF/BKPOSD.                             *
      *  S01179 - ****** AS400 CONVERSION ******                      *
      *     The keyword RTGAID is no longer supported on the AS400    *
      *     and command keys and indicators have been used to replace *
      *     this in the display file. To disrupt the structure of the *
      *     program as little as possible a new subroutine - ASCHGS - *
      *     has been coded. This moves the values which would have    *
      *     been passed to the program (via RTGAID) into the AID      *
      *     field depending on which function key has been pressed.   *
      *  S01176 - SECURITIES TRADING 3.1                              *
      *  E15690 - FOR NON-INTEREST BEARING SECURITIES THE ENQUIRY     *
      *           SHOWS A RATE OF 0.0000000. SHOW BLANKS INSTEAD.     *
      *  E13571 - AMENDED ERROR MESSAGE, AS NO HELP TEXT              *
      *  E14050 - NEXT RECORD DETAILS NOT BEING FETCHED ON ROLLUP.    *
      *  E14057 - USE PRICR NOT PRICS FILE.                           *
      *  E13852 - PRICE IS BEING CONVERTED TO YIELD USING ZPRCO. THIS *
      *           UNNECESSARY.                                        *
      *  E13851 - ZERO PRICE BEING PASSED TO ZYIELD.                  *
      *                                                               *
      *****************************************************************
      *
     FSE0230DFCF  E                    WORKSTN      KINFDS SCRDS
     F                                        SFLRECKSFILE SE0230S0
     F                                        SFLRECKSFILE SE0230S1                           CSE109
     FSECTY   IF  E           K        DISK
     FUDEPB   IF  E           K        DISK
     F***TABSE***IF  E           K        DISK                            S01117
     F*********** TABLETAF                          KIGNORE               S01117
     F*           TABTB10F                          KIGNORE
     F*           TABTB11F                          KIGNORE
     F*           TABTB36F                          KIGNORE
     F*********** TABTB40F                          KIGNORE               S01117
     F*********** TABTE10F                          KIGNORE               S01117
     F*********** TABTE20F                          KIGNORE               S01117
     F*           TABTG10F                          KIGNORE
     F*********** TABTG20F                          KIGNORE               S01117
     F*********** TABLETHF                          KIGNORE               S01117
     F*********** TABLETJF                          KIGNORE               S01232
     F*********** TABLETKF                          KIGNORE               S01117
     F*********** TABLETLF                          KIGNORE               S01117
     F*********** TABLETNF                          KIGNORE               S01117
     F*********** TABLETPF                          KIGNORE               S01117
     F*           TABLETRF                          KIGNORE
     F*********** TABLETXF                          KIGNORE               S01117
     F*********** TABLET2F                          KIGNORE               S01117
     F*********** TABLET3F                          KIGNORE               S01117
     F*********** TABLET5F                          KIGNORE               S01117
     F***BOOKD***IF  E           K        DISK                            S01117
     F*RICS***IF**E           K        DISK                               E14057
     FPRICR   IF  E           K        DISK                               E14057
     FPRICT   IF  E           K        DISK
     F            PRICEDF                           KRENAMEPRICETDF
     FBKPOS   IF  E           K        DISK
     F**NEXTO   IF  E           K        DISK
     FBKPHD   IF  E           K        DISK
     FSECOND  IF  E           K        DISK
     FINVTP   IF  E           K        DISK                               S01176
     FCPPRIC  IF  E           K        DISK                               S01176
     F***SEDEV   IF  E           K        DISK                            E13852
     FSEDEV   IF  E           K        DISK                               S01176
     FSECEO   IF  E           K        DISK                               S01232
     F            SEDEVDF                           KRENAMESEDEVDO        S01232
     F            SNDEVDF                           KRENAMESNDEVDO        S01232
     FSEBKPCJ1IF  E           K        DISK                               CAC005
     FSEBKPCJ2IF  E           K        DISK                               CAC005
     F*                                                                   S01408
     F/COPY WNCPYSRC,SE0230FFP1                                           S01408
     F*                                                                   S01408
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*   01         RETURN TO PREVIOUS PROGRAM                       *
     F*****************OR*ERROR*ON*TABTB10*READ************************   S01117
     F*   02         CLEAR SUBFILE                                    *
     F*   03         NO DETAILS INDICATOR                             *
     F*   04         DISPLAY MESSAGE - NO DETAILS TO DISPLAY          *
     F*   05         DETAILS COMPLETE FOR THIS SECURITY               *
     F*   06         ROLLUP PAST END OF FILE - DISPLAY MESSAGE        *
     F*   07         IN MULTIBRANCH MODE                              *
     F*                                                               *
     F*   10         VLDCMDKY INDICATOR FOR DISPLAY FILE              *
     F*                                                               *
     F*   20         ROLLUP                                           *   S01179
     F*   21         HELP                                             *   S01179
     F*                                                               *   S01179
     F*   25         CHAIN FAIL ON ANY FILE                           *
      *   30         CAC005 ON                                        *   CAC005
     F*   40         END OF FILE ON SUBFILE READ                      *
     F*   41         REVERSE IMAGE BRANCH FIELD                       *
     F*   42         DISPLAY ERROR MESSAGE                            *
     F*   43         REVERSE IMAGE TR/VAL FIELD                       *
     F*   44         REVERSE IMAGE BOOK FIELD                         *
     F*   45         REVERSE IMAGE MARKET FIELD                       *
      *   48         Reverse image Profit Centre field                *   CAC005
     F*   50         ON IF DETAILS ACCUMULATED FOR PREVIOUS SEC       *
     F*   51         MORE DETAILS TO OUTPUT FOR SECURITY              *
     F*   52         AUSTRALIAN YIELD TRADED SECURITY                 *   S01232
     F*   55         NOMINAL CURRENCY DEC. PLACES 0                   *
     F*   56         NOMINAL CURRENCY DEC. PLACES 1                   *
     F*   57         NOMINAL CURRENCY DEC. PLACES 2                   *
     F*   58         NOMINAL CURRENCY DEC. PLACES 3                   *
*******   66         END OF MATCHES ON NEXT DAY TRADES                *
     F*   81         END OF FILE ON UDEPB  OR END OF SUBFILE PAGE     *
     F*   82         WORK INDICATOR FOR SETTING SFLEND                *
     F*   88         SUBFILE READ FAIL                                *
     F*   89         END OF FILE ON UDEPB  OR END OF SUBFILE PAGE     *
     F*                                                               *
     F*   90 - 99    WORK INDICATOR - STD SUBROUTINES                 *
     F*                                                               *
     F*   U7         WITH U8 FOR DATABASE ERROR                       *
     F*   U8         WITH U7 FOR DATABASE ERROR                       *
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*  ASCHGS  -  MOVES VALUES INTO AID - AS400 CONVERSION          *
     F*  CHKSEL  -  CHECK FOR "?" SELECTION (KEY INPUT)               *   S01117
     F*  COMMD   -  PROCESS COMMAND KEYS, HELP AND ROLLUP/DOWN        *
     F*  OPTION  -  CHECK VALIDITY OF ENTERED OPTION COMBINATIONS     *
     F*  SECIN   -  PROCESS ENTERED SELECTION FIELDS                  *
     F*  CLEAR   -  CLEAR FIELDS AND INDICATORS ON DISPLAY SCREEN     *
     F*  ROLLUP  -  HANDLE ROLLUP                                     *
     F*  DISP    -  ACCUMULATE DETAILS FOR DISPLAY                    *
     F*  SETUP   -  PREPARE SCREEN FOR DISPLAY                        *
     F*  PROCES  -  DETERMINE LINE TYPE                               *
     F*  SUBFIL  -  WRITE ACCUMULATED DETAILS TO SUBFILE              *
     F*  BKPRC   -  DETERMINE BOOK PRICE                              *
     F*  OLBAP   -  CALCULATE ON-LINE BOOK POSN AVERAGE PRICE         *
     F*  LINK    -  PROCESS REQUEST FOR LOWER LEVEL ENQUIRY           *
     F*  RETSR   -  END OF PROGRAM PROCESSING                         *
     F*  FIRST   -  FIRST CYCLE PROCESSING                            *
      *  SRPBVL  -  Book - Profit Centre Combination Validation       *   CAC005
      *  SRREAD  -  Read file SEBKPCJ1 and SEBKPCJ2                   *   CAC005
      *  SRSKIP  -  Skips the record whenever a change in branch      *   CAC005
      *             occurred.                                         *   CAC005
     F*                                                               *
     F*  *PSSR   -  ERROR HANDLING                                    *   S01117
     F*                                                               *
     F***XDATE3**-**TO*CALCULATE*ANY*NUMBER*OF*WORKING*DAYS*BACK.*  S01232S01195
     F*  ZACCR   -  CALCULATE INTEREST ACCRUED TO A SPECIFIC DATE     *   S01232
     F*  ZACCZ   -  CALCULATE ACCRUED INTERESR BETWEEN 2 DATES        *   S01232
     F*  ZCALCD  -  CALCULATE LONG TERM CD PRICE FROM INPUT YIELD     *   E39495
     F*  ZCONV   -  CONVERT AMOUNT FROM ONE CURRENCY TO ANOTHER       *
     F*  ZDATE2  -  DATE FORMATTER                                    *
     F*  ZEVCD   -  CALCULATE EVENT CONTROL DATE                      *
     F***ZICD2***-**ACCESS*ICDR2***************************************   S01117
     F***ZICDSE**-**ACCESS*ICDSE***************************************   S01117
     F*  ZLCD    -  GET PREVIOUS COUPON DATE.                         *   S01232
     F*  ZNCD    -  DETERMINE NEXT COUPON DATE                        *   S01176
     F*  ZPRCO   -  OUTPUT YIELD AS PRICE                             *   S01176
     F*  ZRATE   -  TO WORK OUT EFFECTIVE INTEREST RATE OVER A PERIOD *   S01232
     F*  ZSEDIT  -  EDIT FIELDS FOR OUTPUT                            *
     F***ZSYSTM**-**ACCESS*ICDR1***************************************   S01117
     F*  ZYCE    -  SET UP CUM/EX PARAMETER FOR AUSTRALIAN YIELDS     *   S01232
     F*  ZYLDO   -  OUTPUT PERCENTAGE PRICE AS YIELD                  *   S01176
     F*  ZYMTX   -  CAL. YIELD RATE BASED ON NO. OF DAYS TO MATURITY  *   S01176
     F*                                                               *
     F*****************************************************************
      /EJECT
     E/COPY ZSRSRC,ZDATE2Z1                                               S01232
     E***/COPY*ZSRSRC,ZDATE6Z1                                      S01232S01195
     E***********         MSG     1  13 79               Error Messages   S01117
     E***********         MSG     1  14 79               Error MessS01117 CAC005
     E***********         MSG     1  23 79               Error MessCAC005 CSE006
     E**********          MSG     1  24 79               Error Messages                CSE006 CSE109
     E                    MSG     1  25 79               Error Messages                       CSE109
     E/COPY ZSRSRC,ZDAYSZ1
     E/COPY ZSRSRC,ZPOWERZ1
     E/COPY ZSRSRC,ZSEDITZ1
     E****/COPY ZSRSRC,ZNCDZ1                                             E13852
     E/COPY ZSRSRC,ZNCDZ1                                                 S01176
     E/COPY ZSRSRC,ZPOWER8Z1
     E                    CPY@    1   1 80
     E/COPY ZSRSRC,ZYMTXZ1                                                S01176
     E/COPY ZSRSRC,ZHOLE                                                  S01195
      /EJECT
      *
     I**TRDACDF
     I***           CPNR                            NXTNR
     I***           SDCP                            NXTCP
     I***           SDTP                            NXTTP
      *
     I****/COPY ZSRSRC,ZNCDZ2                                             E13852
     I/COPY ZSRSRC,ZNCDZ2                                                 S01176
     I/COPY ZSRSRC,ZSEDITZ2
     I/COPY ZSRSRC,ZHOLI                                                  S01195
     I***LDA*****   UDS                            256                    S01117
     I***********                                                         S01117
     I*******Local data area.                                             S01117
     I***********                                                         S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 1770DBASE                 S01117
      *                                                                   S01117
     ILDA         DS                            256                       S01117
      *                                                                   S01117
      ** Local data area for database error details                       S01117
      ** *LOCK IN LDA immediately before and OUT LDA immediately          S01117
      ** after each database error handling.                              S01117
      *                                                                   S01117
     I                                      134 183 DBLOT                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     I**  LINK ENQUIRY DATA AREA
     ISESDS     E DS
     IPSDS       SDS
     I                                        1  10 PROGRM
     I                                      244 246 WSID
     ISCRDS       DS
     I                                      287 288 AID
     I*
     I*   JNSTAT DATA AREA
     IJNSTAT     UDS                            200
     I                                    P 103 1050PRUN
     I*
     I            DS
     I*
     I*   DATA STRUCTURES FOR SETTING UP SFL LINES
     I*
     I                                        1  74 LIN1
     I                                        1  20 SDESC
     I                                       22  24 SNMCY
     I                                       29  32 SPCTR                 152925
     I                                       36  53 SBKPR
     I                                       54  54 SP1
     I                                       56  56 SBVI
     I                                       58  74 SBVAL
     I            DS
     I                                        1  74 LIN2
     I                                        1  13 SCPNR
     I                                       14  20 SMATY
     I                                       22  34 SNOML
     I                                       36  53 SMKPR
     I                                       54  54 SP2
     I                                       58  74 SMVAL
     I            DS
     I                                        1  74 LIN3
     I                                       21  21 SB1
     I                                       22  34 SRNOM
     I                                       35  35 SB2
      *                                                                                       CSE109
     I            DS                                                                          CSE109
     I                                        1  77 LIN4                                      CSE109
     I                                        1  20 SDESC4                                    CSE109
     I                                       22  24 SNMCY4                                    CSE109
     I                                       28  32 SPCTR4                                    CSE109
     I                                       34  45 SBKPR4                                    CSE109
     I                                       46  46 SP14                                      CSE109
     I                                       47  63 SBVAL4                                    CSE109
     I                                       64  77 SUNRL4                                    CSE109
     I            DS                                                                          CSE109
     I                                        1  77 LIN5                                      CSE109
     I                                        1  13 SCPNR5                                    CSE109
     I                                       14  20 SMATY5                                    CSE109
     I                                       21  33 SNOML5                                    CSE109
     I                                       34  45 SMKPR5                                    CSE109
     I                                       46  46 SP25                                      CSE109
     I                                       47  63 SMVAL5                                    CSE109
     I            DS                                                                          CSE109
     I                                        1  77 LIN6                                      CSE109
      *
     I*
     I            DS
     I*
     I*   DATA STRUCTURES OVER SELECTION CRITERIA
     I*
     I***********                             1   7 SELCRI                CAC005
     I                                        1  11 SELCRI                CAC005
     I                                        1   3 BRANCH
     I                                        4   5 BOOK
     I***********                             6   6 TRDVAL                CAC005
     I***********                             7   7 MARKET                CAC005
     I                                        6   9 PROCEN                CAC005
     I                                       10  10 TRDVAL                CAC005
     I                                       11  11 MARKET                CAC005
     I*
     ICPYR@#      DS
     I*
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I*
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*                                                                   S01176
     IIKEYDS      DS                                                      S01176
     I*                                                                   S01176
     I** DATA STRUCTURE  USED TO DISPLAY KEY TO LF/INVTP                  S01176
     I** IF A DATABASE ERROR OCCURS                                       S01176
     I*                                                                   S01176
     I************                            4   6 NMCY           S01176 E19615
     I************                            1   3 SITP           S01176 E19615
     I                                        1   3 NMCY                  E19615
     I                                        4   6 SITP                  E19615
     I****/COPY ZSRSRC,ZYLDZ1                                             E13852
     I/COPY ZSRSRC,ZYLDZ1                                                 S01176
      *
     IRUNDT       DS                                                      S01117
      *                                                                   S01117
      ** RUNDAT data area                                                 S01117
      *                                                                   S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
      *                                                                   S01117
     IZMUSER      DS                             17                       S01117
      *                                                                   S01117
      ** Menu user data area                                              S01117
      *                                                                   S01117
     I                                       11  13 DFTBRC                S01117
     I                                       17  17 BANKAU                S01117
      *                                                                   S01117
     ISDBANK    E DSSDBANKPD                                              S01117
      *                                                                   S01117
      ** Bank Details                                                     S01117
      *                                                                   S01117
     ISDBOOK    E DSSDBOOKPD                                              S01117
      *                                                                   S01117
      ** Book Details                                                     S01117
      *                                                                   S01117
     ISDBRCH    E DSSDBRCHPD                                              S01117
      *                                                                   S01117
      ** Branch Details                                                   S01117
      *                                                                   S01117
     ISDCURR    E DSSDCURRPD                                              S01117
      *                                                                   S01117
      ** Currency Details                                                 S01117
      *                                                                   S01117
     ISDGELR    E DSSDGELRPD                                              S01117
      *                                                                   S01117
      ** Currency Details                                                 S01117
      *                                                                   S01117
     ISDSTRD    E DSSDSTRDPD                                              S01117
      *                                                                   S01117
      ** Securities Trading Data                                          S01117
      *                                                                   S01117
     ISDPRFC    E DSSDPRFCPD                                              CAC005
      ** Profit Centre Details                                            CAC005
      *                                                                   CAC005
     IDSFDY     E DSDSFDY                                                 S01117
      *                                                                   S01117
      ** Short data structure for access programs (200 long)              S01117
      *                                                                   S01117
     IDSSDY     E DSDSSDY                                                 S01117
      *                                                                   S01117
      ** Long data structure for access programs (800 long)               S01117
      *                                                                   S01117
     I/COPY WNCPYSRC,SE0230I001
      *                                                                                       CSE075
     ISCSARD    E DSSCSARDPD                                                                  CSE075
      *                                                                                       CSE075
      ** External DS for Switchable feature details                                           CSE075
      *                                                                                       CSE075
     C/EJECT
      *================================================================
      *  P R O G R A M   S T A R T                                    *
      *================================================================
      *
     C           *NAMVAR   DEFN           SESDS
     C           *NAMVAR   DEFN           LDA
     C           *NAMVAR   DEFN           JNSTAT
     C**
     C**  DEFINE OTHER LIKE FIELDS
     C**
     C           *LIKE     DEFN BOOK      BOKCHK
     C************LIKE     DEFN UDBR      BRCCHK                          S01117
     C           *LIKE     DEFN UDBA      BRCCHK                          S01117
     C           *LIKE     DEFN MARKET    MKTCHK
     C           *LIKE     DEFN TRDVAL    TRDCHK
     C           *LIKE     DEFN UDNT      ZZAPC
     C           *LIKE     DEFN PPRC      ZZAPW
     C           *LIKE     DEFN UDNT      ZNNOMP
     C           *LIKE     DEFN SESN      SAVSS
     C           *LIKE     DEFN UDBK      SAVBK
     C           *LIKE     DEFN CFCT      CURF                            054259
     C************LIKE     DEFN UDBR      SAVBR                           S01117
     C           *LIKE     DEFN UDBA      SAVBR                           S01117
     C           *LIKE     DEFN UDMK      SAVMK
     C           *LIKE     DEFN NAME      NMCHK                           S01176
     C           *LIKE     DEFN PSPRFC    PRFCHK                          CAC005
     C**********           Z-ADD0         SAVCN   60                                          CSD027
     C                     MOVE *BLANKS   SAVCN   6                                           CSD027
     C*********  CSE109    IFEQ 'Y'                                                  CSE109 MD053052
     C*********            MOVE 'A'       HISACT                                     CSE109 MD053052
     C*********            MOVE '1'       *IN49                                      CSE109 MD053052
     C*********            ENDIF                                                     CSE109 MD053052
      *                                                                                       CSE109
     C           UKEY      KLIST
     C                     KFLD           BRCCHK
     C                     KFLD           BOKCHK
     C                     KFLD           NMCHK                           S01176
     C*                                                                   S01176
     C           KEYPT     KLIST
     C                     KFLD           PTYP    2
     C                     KFLD           SAVSS
     C                     KFLD           PDAT    50
     C**********           KFLD           PCST    60                                          CSD027
     C                     KFLD           PCST    6                                           CSD027
      *
     C           KEYPTP    KLIST
     C                     KFLD           PTYP
     C                     KFLD           SAVSS
      *
     C           KEYP      KLIST
     C                     KFLD           SAVSS
     C                     KFLD           BRCCHK
     C                     KFLD           SAVMK
     C                     KFLD           BOKCHK
     C                     KFLD           SAVCN
     C                     KFLD           PPRT
      *
     C           KEY1      KLIST                                          152925
     C                     KFLD           SAVSS                           152925
     C                     KFLD           BRCCHK                          152925
     C                     KFLD           SAVMK                           152925
     C                     KFLD           XPSBK                           152925
     C                     KFLD           SAVCN                           152925
     C                     KFLD           PPRT                            152925
      *                                                                   152925
     C           KEYPD     KLIST
     C                     KFLD           SAVSS
     C                     KFLD           BRCCHK
     C                     KFLD           SAVMK
     C                     KFLD           BOKCHK
     C                     KFLD           SAVCN
     C                     KFLD           PPRT
     C                     KFLD           RUND
      *
     C           KEY2      KLIST                                          152925
     C                     KFLD           SAVSS                           152925
     C                     KFLD           BRCCHK                          152925
     C                     KFLD           SAVMK                           152925
     C                     KFLD           XPSBK                           152925
     C                     KFLD           SAVCN                           152925
     C                     KFLD           PPRT                            152925
     C                     KFLD           RUND                            152925
      *                                                                   152925
     C           KEYPP     KLIST
     C                     KFLD           SAVSS
     C                     KFLD           BRCCHK
     C                     KFLD           SAVMK
     C                     KFLD           BOKCHK
     C                     KFLD           SAVCN
     C                     KFLD           PPRT
     C                     KFLD           PRUN
      *
     C           KEY3      KLIST                                          152925
     C                     KFLD           SAVSS                           152925
     C                     KFLD           BRCCHK                          152925
     C                     KFLD           SAVMK                           152925
     C                     KFLD           XPSBK                           152925
     C                     KFLD           SAVCN                           152925
     C                     KFLD           PPRT                            152925
     C                     KFLD           PRUN                            152925
      *                                                                   152925
     C           KEYBH     KLIST
     C                     KFLD           SAVSS
     C                     KFLD           BRCCHK
     C                     KFLD           BOKCHK
     C                     KFLD           SAVMK
     C                     KFLD           TRDCHK
      *
     C           KEY4      KLIST                                          152925
     C                     KFLD           SAVSS                           152925
     C                     KFLD           BRCCHK                          152925
     C                     KFLD           XPSBK                           152925
     C                     KFLD           SAVMK                           152925
     C                     KFLD           TRDCHK                          152925
      *                                                                   152925
     C           KEYBP     KLIST
     C                     KFLD           SAVSS
     C                     KFLD           BRCCHK
     C                     KFLD           BOKCHK
     C                     KFLD           SAVMK
     C                     KFLD           TRDCHK
     C                     KFLD           LPSD
     C*                                                                   S01176
     C           IKEY      KLIST                                          S01176
     C                     KFLD           NMCY                            S01176
     C                     KFLD           SITP                            S01176
     C*                                                                   S01176
     C           KEY5      KLIST                                          152925
     C                     KFLD           SAVSS                           152925
     C                     KFLD           BRCCHK                          152925
     C                     KFLD           XPSBK                           152925
     C                     KFLD           SAVMK                           152925
     C                     KFLD           TRDCHK                          152925
     C                     KFLD           LPSD                            152925
     C*                                                                   152925
     C           PRKEY     KLIST                                          S01176
     C                     KFLD           SITP                            S01176
     C                     KFLD           NMCY                            S01176
     C*                                                                   054259
     C** Key to access SECURITY EVENTS DIARY                              054259
     C*                                                                   054259
     C           KEYSED    KLIST                                          054259
     C                     KFLD           SDSN                            054259
     C                     KFLD           SDET                            054259
     C                     KFLD           SDED                            054259
     C**
     C**  DO FIRST CYCLE PROCESSING
     C**
     C                     EXSR FIRST
     C**
     C**  MAIN PROCESSING    -    Do until end of job requested
     C**
     C           *IN01     DOWEQ'0'
     C**
     C**    Display the screen
     C**
     C           CSE109    IFEQ 'Y'                                                           CSE109
     C                     WRITESE0230F1                                                      CSE109
     C                     EXFMTSE0230C1                                                      CSE109
     C                     ELSE                                                               CSE109
     C                     WRITESE0230F0
     C                     EXFMTSE0230C0
     C                     ENDIF                                                              CSE109
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0230CP10                                           S01408
     C*                                                                   S01408
      *                                                                   S01117
      ** Check for Book '?' prompt and skip processing if found           S01117
      *                                                                   S01117
     C                     EXSR CHKSEL                                    S01117
     C           @SEL      IFEQ 0                                         S01117
     C**
     C** Call S/R to move values into AID                                 S01179
     C*                                                                   S01179
     C                     EXSR ASCHGS                                    S01179
     C*                                                                   S01179
     C**    Clear the error messages unless HELP pressed
     C**
     C           AID       IFNE 'HP'
     C                     MOVE *BLANKS   ERMSG  79
     C                     SETOF                     414243
     C                     SETOF                     4445
      *                                                                                       CSE109
     C           CSE109    IFEQ 'Y'                                                           CSE109
     C                     MOVE '1'       *IN70                                               CSE109
     C                     ENDIF                                                              CSE109
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVE *OFF      *IN48                           CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C                     END
     C**
     C**    Check Command Keys - including HELP
     C**
     C                     EXSR COMMD
     C**
     C**    If Enter has been pressed check validity of options
     C**
     C           AID       IFEQ 'RA'
     C**
     C**    Check Validity of Option Combinations
     C**
     C                     EXSR OPTION
     C**
     C           *IN42     IFEQ '0'
     C**
     C**    Check if no lower level option selected
     C**
     C           SELCRI    IFNE *BLANKS
     C                     EXSR SECIN
     C                     END
     C**
     C**    Lower Level Enquiry Selected
     C**
     C           OPTN      IFNE *BLANK
     C                     EXSR LINK
     C                     END
     C**
     C                     END
     C                     END
     C                     END                                            S01117
     C                     END
      *
      *================================================================
      *  Return to calling program                                    *
      *                                                               *
     C                     EXSR RETSR
      *                                                               *
      *================================================================
      /EJECT
     C*****************************************************************
     C**                                                              *
     C**    COMMD   SR   To process Command Keys                      *
     C*******************and*HELP,*ROLLUP*and*ROLLDOWN*****************   S01199
     C**                 ROLLUP and ROLLDOWN                          *   S01199
     C**                                                              *
     C**    Called  By   MAIN                                         *
     C**    Calls   SR   ROLLUP, CLEAR, SECIN                         *
     C******Calls**PGM***MHELP*****************************************   S01199
     C**    Calls  PGM   MHELP                                        *   S01199
     C**                                                              *
     C*****************************************************************
     C**
     C           COMMD     BEGSR                           ** COMMD **
     C**
     C*****If*HELP*pressed*call*help*screen****************************   S01199
     C***********                                                         S01199
     C***********AID       IFEQ 'HP'                                      S01199
     C***********          CALL 'MHELP'                                   S01199
     C***********          PARM           PGMNO                           S01199
     C***********          PARM           HERCD 160                       S01199
     C***********          END                                            S01199
     C**
     C**    If Rollup key pressed
     C**
     C           AID       IFEQ 'UP'
     C                     EXSR ROLLUP
     C                     END
     C**
     C**    If F3 then exit to menu - return code 1 and end
     C**
     C           AID       IFEQ '01'
     C                     MOVE '1'       RTNC
     C                     MOVE '1'       *IN01
     C                     END
     C**
     C**    If F12 then return to previous enquiry - return code 2
     C**                  unless there is no previous enquiry
     C**
     C           AID       IFEQ '02'
     C           ORIG      IFNE PGMNO
     C                     MOVE '2'       RTNC
     C                     MOVE '1'       *IN01
     C                     ELSE
     C                     MOVE '1'       *IN42
     C                     MOVE MSG,6     ERMSG
     C                     END
     C                     END
     C**
     C**    If F5 then refresh enquiry screen
     C**
     C           AID       IFEQ '05'
     C                     EXSR CLEAR
     C                     END
     C**
     C**     If F9 then return to initial enquiry - return code 7
     C**                   unless this is the initial program
     C**
     C           AID       IFEQ '07'
     C           ORIG      IFNE PGMNO
     C                     MOVE '7'       RTNC
     C                     MOVE '1'       *IN01
     C                     ELSE
     C                     MOVE '1'       *IN42
     C                     MOVE MSG,6     ERMSG
     C                     END
     C                     END
     C**
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C**           ****** AS400 CONVERSION ******                     *   S01179
     C**                                                              *   S01179
     C** ASCHGS S/R TO MOVE THE APPROPRIATE VALUES INTO FIELD AID,    *   S01179
     C** DEPENDING ON WHICH FUNCTION KEY HAS BEEN PRESSED.            *   S01179
     C** CALLED FROM UPDATE                                           *   S01179
     C**                                                              *   S01179
     C*****************************************************************   S01179
     C*                                                                   S01179
     C           ASCHGS    BEGSR                                          S01179
     C*                                                                   S01179
     C* If ENTER pressed, the VLDCMDKEY indicator will be off             S01179
     C*                                                                   S01179
     C           *IN10     IFEQ '0'                                       S01179
     C                     MOVE 'RA'      AID                             S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F3                                                             S01179
     C*                                                                   S01179
     C           *INKC     IFEQ '1'                                       S01179
     C                     MOVE '01'      AID                             S01179
     C                     MOVE '0'       *INKC                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F5                                                             S01179
     C*                                                                   S01179
     C           *INKE     IFEQ '1'                                       S01179
     C                     MOVE '05'      AID                             S01179
     C                     MOVE '0'       *INKE                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F6                                                             S01179
     C*                                                                   S01179
     C           *INKF     IFEQ '1'                                       S01179
     C                     MOVE '06'      AID                             S01179
     C                     MOVE '0'       *INKF                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F9                                                             S01179
     C*                                                                   S01179
     C           *INKI     IFEQ '1'                                       S01179
     C                     MOVE '07'      AID                             S01179
     C                     MOVE '0'       *INKI                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F12                                                            S01179
     C*                                                                   S01179
     C           *INKL     IFEQ '1'                                       S01179
     C                     MOVE '02'      AID                             S01179
     C                     MOVE '0'       *INKL                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If ROLLUP pressed                                                 S01179
     C*                                                                   S01179
     C           *IN20     IFEQ '1'                                       S01179
     C                     MOVE 'UP'      AID                             S01179
     C                     MOVE '0'       *IN20                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C**If*HELP*key*pressed                                               S01179
     C*                                                                   S01179
     C************IN21     IFEQ '1'                                S01179 S01199
     C***********          MOVE 'HP'      AID                      S01179 S01199
     C***********          MOVE '0'       *IN21                    S01179 S01199
     C***********          END                                     S01179 S01199
     C*                                                                   S01179
     C                     ENDSR                                          S01179
     C*                                                                   S01179
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C**                                                              *
     C**   ROLLUP SR  When Rollup key is pressed load next page for   *
     C**              BRANCH/BOOK                                     *
     C**                                                              *
     C**   Called by  COMMD                                           *
     C**   Calls  SR  DISP                                            *
     C**                                                              *
     C*****************************************************************
     C**
     C           ROLLUP    BEGSR                           ** ROLLUP **
     C**
     C** If details complete then Rollup is beyond last record.
     C**
     C           *IN05     IFEQ '1'
     C           *IN81     ANDEQ'1'
     C                     MOVE '1'       *IN06
     C                     ELSE
     C**
     C** Otherwise load next page
     C**
     C                     Z-ADDTOP       SFLREC
     C                     EXSR DISP
     C                     END
     C**
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C**                                                              *
     C**   OPTION SR  To check validity of option combinations        *
     C**                                                              *
     C**   Called by  MAIN                                            *
     C**   Calls  SR  none                                            *
     C**                                                              *
     C*****************************************************************
     C**
     C           OPTION    BEGSR                            ** OPTION *
     C**
     C                     MOVE *BLANKS   OPTN
     C**
     C** If no subfile records the only possible entry is branch/book
     C**
     C           *IN03     IFEQ '1'
     C**
     C           SELCRI    IFEQ *BLANKS
     C                     MOVE '1'       *IN42
     C           *IN07     IFEQ '1'
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVE MSG,15    ERMSG                           CAC005
     C                     ELSE                                           CAC005
     C                     MOVE MSG,1     ERMSG
     C                     ENDIF                                          CAC005
     C                     ELSE
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVE MSG,16    ERMSG                           CAC005
     C                     ELSE                                           CAC005
     C                     MOVE MSG,13    ERMSG
     C                     ENDIF                                          CAC005
     C                     END
     C                     END
     C**
     C                     ELSE
     C**
     C           CSE109    IFEQ 'Y'                                                           CSE109
     C                     READCSE0230S1                 40                                   CSE109
     C                     ELSE                                                               CSE109
     C                     READCSE0230S0                 40
     C                     ENDIF                                                              CSE109
     C**
     C**     Check if any entry made
     C**
     C           *IN40     IFEQ '1'
     C           SELCRI    ANDEQ*BLANKS
     C                     MOVE '1'       *IN42
     C           *IN07     IFEQ '1'
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVE MSG,17    ERMSG                           CAC005
     C                     ELSE                                           CAC005
     C                     MOVE MSG,7     ERMSG
     C                     ENDIF                                          CAC005
     C                     ELSE
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVE MSG,18    ERMSG                           CAC005
     C                     ELSE                                           CAC005
     C                     MOVE MSG,5     ERMSG
     C                     ENDIF                                          CAC005
     C                     END
     C                     END
     C**
     C**     Check if both br/book  and option entered
     C**
     C           *IN40     IFEQ '0'
     C           SELCRI    ANDNE*BLANKS
     C                     MOVE '1'       *IN42
     C                     MOVE '1'       *IN41
     C           *IN07     IFEQ '1'
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVE MSG,19    ERMSG                           CAC005
     C                     ELSE                                           CAC005
     C                     MOVE MSG,2     ERMSG
     C                     ENDIF                                          CAC005
     C                     ELSE
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVE MSG,20    ERMSG                           CAC005
     C                     ELSE                                           CAC005
     C                     MOVE MSG,8     ERMSG
     C                     ENDIF                                          CAC005
     C                     END
     C                     END
     C**
     C**    Check if more than one option entered
     C**
     C           *IN40     IFEQ '0'
     C                     MOVE SELECT    OPTN
     C                     MOVE BOKCHK    RQBOOK
     C***********          MOVE BRCCHK    RQBRCH                          S01117
     C                     MOVE BRCCHK    RQBRCA                          S01117
     C                     MOVE SSESN     RQSESN
     C                     MOVE *BLANK    SELECT
     C                     MOVE '0'       *IN08
     C           CSE109    IFEQ 'Y'                                                           CSE109
     C                     UPDATSE0230S1                                                      CSE109
     C                     ELSE                                                               CSE109
     C                     UPDATSE0230S0
     C                     ENDIF                                                              CSE109
     C**
     C           *IN40     DOUEQ'1'
     C           CSE109    IFEQ 'Y'                                                           CSE109
     C                     READCSE0230S1                 40                                   CSE109
     C                     ELSE                                                               CSE109
     C                     READCSE0230S0                 40
     C                     ENDIF                                                              CSE109
     C           *IN40     IFEQ '0'
     C                     MOVE *BLANK    SELECT
     C                     MOVE '0'       *IN08
     C           CSE109    IFEQ 'Y'                                                           CSE109
     C                     UPDATSE0230S1                                                      CSE109
     C                     ELSE                                                               CSE109
     C                     UPDATSE0230S0
     C                     ENDIF                                                              CSE109
     C                     MOVE '1'       *IN42
     C                     MOVE MSG,3     ERMSG
     C                     END
     C**
     C                     END
     C                     END
     C                     END
     C**
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C**                                                              *
     C**   SECIN  SR  To process entered Selection fields             *
     C**                                                              *
     C**   Called by  MAIN, FIRST                                     *
     C**   Calls  SR  SETUP                                           *
     C**                                                              *
     C*****************************************************************
     C**
     C           SECIN     BEGSR                            ** SECIN  *
     C**
     C                     SETOF                     414243
     C                     SETOF                     4445
     C           CSE109    IFEQ 'Y'                                                           CSE109
     C                     MOVE '0'       *IN70                                               CSE109
      *                                                                                       CSE109
      ** If HISTORIC/ACTIVE - Check it is A or H                                              CSE109
      ** ERROR if not                                                                         CSE109
      *                                                                                       CSE109
     C           HISACT    IFNE ' '                                                           CSE109
     C           HISACT    ANDNE'A'                                                           CSE109
     C           HISACT    ANDNE'H'                                                           CSE109
     C                     SETON                     4270                                     CSE109
     C                     MOVE MSG,25    ERMSG                                               CSE109
     C                     GOTO ESECE                                                         CSE109
     C                     ENDIF                                                              CSE109
      *                                                                                       CSE109
      ** If HISTORIC/ACTIVE - Default to A if blank                                           CSE109
      *                                                                                       CSE109
     C           HISACT    IFEQ ' '                                                           CSE109
     C                     MOVE 'A'       HISACT                                              CSE109
     C                     ENDIF                                                              CSE109
     C                     ENDIF                                                              CSE109
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVE *OFF      *IN48                           CAC005
     C                     ENDIF                                          CAC005
      *                                                                   S01117
      ** Set defaults -                                                   S01117
      *                                                                   S01117
     C           *IN07     IFEQ '0'                                       S01117
     C           BRANCH    OREQ *BLANK                                    S01117
     C                     MOVE DFTBRC    BRANCH                          S01117
     C                     END                                            S01117
     C**
     C** If multibranch environment -
     C** If branch entered - Access Branch table record -
     C**     error if not on file or deleted
     C**
     C           *IN07     IFEQ '1'
     C***********          MOVE *BLANKS   KEY    12                       S01117
     C***********          MOVEL'10'      KEY                             S01117
     C***********          MOVE BRANCH    KEY                             S01117
     C***********KEY       CHAINTABLETRF             25                   S01117
     C************IN25     IFEQ '0'                                       S01117
     C***********RECI      IFEQ '*'                                       S01117
     C***********          SETON                     25                   S01117
     C***********          END                                            S01117
     C***********          END                                            S01117
     C************IN25     IFEQ '1'                                       S01117
      *                                                                   S01117
      ** Access branch codes file SDBRCHPD via access object program      S01117
      *                                                                   S01117
     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM BRANCH    @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01117              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     SETON                     4241
     C                     MOVE MSG,9     ERMSG
     C                     GOTO ESECE
     C                     END
      *                                                                   S01117
      ** Check user is authorised to valid branch                         S01117
      *                                                                   S01117
     C                     CALL 'ZVBBU'                                   S01117
     C                     PARM BRANCH    @ZBR    3                       S01117
     C                     PARM           @ERR    10                      S01117
     C           @ERR      IFNE 0                                         S01117
     C                     SETON                     4241                 S01117
     C                     MOVE MSG,14    ERMSG                           S01117
     C                     GOTO ESECE                                     S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     END
     C**
     C** If book   entered - Access Book file record -
     C**     error if not on file or deleted
     C**
     C***********BOOK      CHAINBOOKD                25                   S01117
     C************IN25     IFEQ '0'                                       S01117
     C***********RECI      IFEQ '*'                                       S01117
     C***********          SETON                     25                   S01117
     C***********          END                                            S01117
     C***********          END                                            S01117
     C************IN25     IFEQ '1'                                       S01117
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
      *                                                                   CAC005
      ** Call SRPBVL to check for validity of the profit centre - book    CAC005
      ** combination                                                      CAC005
      *                                                                   CAC005
     C                     EXSR SRPBVL                                    CAC005
      *                                                                   CAC005
      ** If error encountered(*IN42 is ON), then skip the rest of the     CAC005
      ** processing and display the error message                         CAC005
      *                                                                   CAC005
     C           *IN42     IFEQ *ON                                       CAC005
     C                     GOTO ESECE                                     CAC005
     C                     ENDIF                                          CAC005
     C                     ENDIF                                          CAC005
      *                                                                   S01117
      ** Access book details file SDBOOKPD via access object program      S01117
      *                                                                   S01117
     C           CAC005    IFNE 'Y'                                       CAC005
     C                     CALL 'AOBOOKR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM BOOK      @BKCD   2                       S01117
     C           SDBOOK    PARM SDBOOK    DSFDY                           S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     SETON                     4244
     C                     MOVE MSG,10    ERMSG
     C                     GOTO ESECE
     C                     ELSE                                           CSE006
     C           CSE006    IFEQ 'Y'                                       CSE006
     C           BDBYSL    ANDEQ'Y'                                       CSE006
     C                     MOVE *ON       *IN42                           CSE006
     C                     MOVE *ON       *IN44                           CSE006
     C                     MOVE MSG,24    ERMSG                           CSE006
     C                     GOTO ESECE                                     CSE006
     C                     ENDIF                                          CSE006
     C                     END
     C                     ENDIF                                          CAC005
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0230CCP2                                           S01408
     C*                                                                   S01408
     C**
     C** If trade/value entered - check it is T or V
     C**     error if not
     C**
     C           TRDVAL    IFNE *BLANKS
     C           TRDVAL    IFNE 'T'
     C           TRDVAL    ANDNE'V'
     C                     SETON                     4243
     C                     MOVE MSG,11    ERMSG
     C                     GOTO ESECE
     C                     END
     C                     ELSE
     C***********          MOVE TVVL      TRDVAL                          S01117
     C                     MOVE BVTVDV    TRDVAL                          S01117
     C                     END
     C**
     C** If Market entered - check it is g p or s
     C**     error if not
     C**
     C           MARKET    IFNE *BLANKS
     C           MARKET    ANDNE'G'
     C           MARKET    IFNE 'P'
     C           MARKET    ANDNE'S'
     C                     SETON                     4245
     C                     MOVE MSG,12    ERMSG
     C                     GOTO ESECE
     C                     END
     C                     END
     C**
     C** All fields valid - prepare to display details -
     C**
     C                     EXSR SETUP
     C**
     C           ESECE     TAG                             ** ESECE  TAG**
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C**                                                              *
     C**   DISP   SR  Accumulate details for screen display           *
     C**                                                              *
     C**   Called by  SETUP, ROLLUP                                   *
     C**   Calls  SR  PROCES                                          *
     C**                                                              *
     C*****************************************************************
     C**
     C           DISP      BEGSR                           *** DISP ***
     C**
     C**
     C                     Z-ADD0         OUTREC  20
     C                     MOVE '0'       *IN89
     C**
     C**  IF STILL PROCESSING SFL RECS - GOTO S/R
     C**
     C           *IN51     IFEQ '1'
     C                     EXSR PROCES
     C           OUTREC    IFEQ 14
     C                     SETON                     89
     C                     END
     C**                                                                  E14050
     C**   Accumulate details for the security bypassed due to subfile    E14050
     C**   overflow                                                       E14050
     C**                                                                  E14050
     C           TRDCHK    IFEQ 'T'                                       E14050
     C                     ADD  UDNT      ZZNOML                          E14050
     C                     ADD  UDTP      ZZNOML                          E14050
     C                     ADD  UDTS      ZZNOML                          E14050
     C                     ADD  UDNV      ZZNOMU                          E14050
     C                     ADD  UDPV      ZZNOMU                          E14050
     C                     ADD  UDSV      ZZNOMU                          E14050
     C                     ADD  UNRT      ZRNOML                          E14050
     C                     ADD  USNT      ZRNOML                          E14050
     C                     ADD  USNR      ZRNOML                          E14050
     C                     ELSE                                           E14050
     C                     ADD  UDNV      ZZNOML                          E14050
     C                     ADD  UDPV      ZZNOML                          E14050
     C                     ADD  UDSV      ZZNOML                          E14050
     C                     ADD  UDNT      ZZNOMU                          E14050
     C***********          ADD  UDPT      ZZNOMU                   E14050 E32653
     C                     ADD  UDTP      ZZNOMU                          E32653
     C                     ADD  UDTS      ZZNOMU                          E14050
     C                     ADD  UNRV      ZRNOML                          E14050
     C                     ADD  USNV      ZRNOML                          E14050
     C                     ADD  USRV      ZRNOML                          E14050
     C                     END                                            E14050
     C                     END
     C**
     C           *IN89     DOWEQ'0'
     C           *IN51     ANDEQ'0'
     C**
     C           *IN81     IFEQ '0'
      *                                                                   CAC005
      ** If CAC005 is ON, read the join file instead.                     CAC005
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVE PSPRFC    ZPRFC   4                       185786
     C                     MOVE UDBK      ZPSBK   2                       185786
     C                     EXSR SRREAD                                    CAC005
     C                     EXSR SRSKIP                                    CAC005
     C                     ELSE                                           CAC005
     C                     READ UDEPB                    81
     C                     ENDIF                                          CAC005
     C                     END
     C**
     C**  End of File - If some records accumulated then write last one
     C**
     C           *IN81     IFEQ '1'
     C                     SETON                     0589
     C           *IN50     IFEQ '1'
     C                     EXSR PROCES
     C           OUTREC    IFEQ 14
     C                     SETON                     89
     C                     GOTO EDLOOP
     C                     END
     C                     END
     C                     END
     C**
     C**  Successful file read of an active record
     C**
     C           *IN81     IFEQ '0'
     C           RECI      IFEQ 'D'
     C**
     C**  Check record for market selected
     C**
     C           MKTCHK    IFEQ *BLANKS
     C           MKTCHK    OREQ UDMK
     C**
     C**  If not correct branch/BOOK & there have been recs for the
     C**  required branch/BOOK then output the last one
     C**
     C***********BRCCHK    IFNE UDBR                                      S01117
     C           BRCCHK    IFNE UDBA                                      S01117
     C           BOKCHK    ORNE UDBK
     C           CAC005    ANDNE'Y'                                       CAC005
     C           BOKCHK    ORNE UDBK                                      CAC005
     C           CAC005    ANDEQ'Y'                                       CAC005
     C           BOKCHK    ANDNE*BLANKS                                   CAC005
     C           PRFCHK    ANDNE*BLANKS                                   CAC005
     C           CAC005    OREQ 'Y'                                       CAC005
     C           PRFCHK    ANDNEPSPRFC                                    CAC005
     C           BOKCHK    ANDEQ*BLANKS                                   CAC005
     C           CAC005    OREQ 'Y'                                       CAC005
     C           BOKCHK    ANDNEPSBKCD                                    CAC005
     C           PRFCHK    ANDEQ*BLANKS                                   CAC005
     C                     SETON                     8189
     C**
     C           *IN50     IFEQ '1'
     C                     EXSR PROCES
     C************IN51     IFEQ '0'                                       055190
     C                     MOVE '1'       *IN05
     C***********          END                                            055190
     C           OUTREC    IFEQ 14
     C                     SETON                     89
     C                     GOTO EDLOOP
     C                     END
     C                     END
     C**
     C                     ELSE
     C**
     C**   If the required Branch/BOOK and a new Security
     C**   and if not the first Security
     C**   then output the previous Security Details
     C**
     C           SAVSS     IFNE UDSN
     C           SAVSS     IFNE *BLANKS
      *                                                                   219779
     C           ZZNOML    IFNE 0                                         219779
     C           CSE109    ANDEQ'N'                                                           CSE109
     C           ZZNOML    ORNE 0                                                             CSE109
     C           CSE109    ANDEQ'Y'                                                           CSE109
     C           HISACT    ANDEQ'A'                                                           CSE109
     C           CSE109    OREQ 'Y'                                                           CSE109
     C           HISACT    ANDEQ'H'                                                           CSE109
     C                     EXSR PROCES
      *                                                                                       245887
     C                     ELSE                                                               245887
      *    Set to Blanks so that the next time SR:PROCES is called                            245887
      *    the correct Security details are retrieved & Displayed.                            245887
     C                     MOVE *BLANKS   SAVSS                                               245887
      *                                                                                       245887
     C                     END                                            219779
      *                                                                   219779
     C           OUTREC    IFEQ 14
     C                     SETON                     89
     C                     GOTO EDLOOP
     C                     END
     C                     END
     C                     END
     C**
     C**   Accumulate details for a Security
     C**
     C           TRDCHK    IFEQ 'T'
     C                     ADD  UDNT      ZZNOML
     C                     ADD  UDTP      ZZNOML
     C                     ADD  UDTS      ZZNOML
     C                     ADD  UDNV      ZZNOMU
     C                     ADD  UDPV      ZZNOMU
     C                     ADD  UDSV      ZZNOMU
     C                     ADD  UNRT      ZRNOML
     C                     ADD  USNT      ZRNOML
     C                     ADD  USNR      ZRNOML
     C                     ELSE
     C                     ADD  UDNV      ZZNOML
     C                     ADD  UDPV      ZZNOML
     C                     ADD  UDSV      ZZNOML
     C                     ADD  UDNT      ZZNOMU
     C***********          ADD  UDPT      ZZNOMU                          E32653
     C                     ADD  UDTP      ZZNOMU                          E32653
     C                     ADD  UDTS      ZZNOMU
     C                     ADD  UNRV      ZRNOML
     C                     ADD  USNV      ZRNOML
     C                     ADD  USRV      ZRNOML
      *
     C                     END
     C                     MOVE UDMK      SAVMK
     C                     MOVE '1'       *IN50
     C           SAVSS     IFEQ *BLANKS
     C           ZZNOML    ORNE 0                                                             234713
     C                     MOVE UDSN      SAVSS
     C                     END
     C**
     C                     END
     C                     END
     C**
     C                     END
     C                     END
     C                     END
     C**
     C**    Condition Display of message if no details for branch/BOOK
     C**
     C           EDLOOP    TAG                             ** EDLOOP    **
     C           SFLREC    IFEQ 0
     C                     MOVE '1'       *IN04
     C                     ELSE
     C**
     C**    If records written - read next to check there are more
     C**
     C           *IN51     IFEQ '0'
     C                     SETOF                     82
     C           OUTREC    IFEQ 14
     C           *IN05     ANDEQ'0'
     C**
     C           *IN81     IFEQ '0'
     C           READN     TAG                             ** READN     **
      *                                                                   CAC005
      ** If CAC005 is ON, read the join file instead.                     CAC005
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     EXSR SRREAD                                    CAC005
     C                     EXSR SRSKIP                                    CAC005
     C                     ELSE                                           CAC005
     C                     READ UDEPB                    81
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C           *IN81     IFEQ '0'
     C           RECI      IFEQ 'D'
     C           UDBK      IFEQ BOKCHK
     C***********UDBR      ANDEQBRCCHK                                    S01117
     C           UDBA      ANDEQBRCCHK                                    S01117
     C           CAC005    ANDNE'Y'                                       CAC005
     C           UDBK      OREQ BOKCHK                                    CAC005
     C           UDBA      ANDEQBRCCHK                                    CAC005
     C           CAC005    ANDEQ'Y'                                       CAC005
     C           BOKCHK    ANDNE*BLANKS                                   CAC005
     C           PRFCHK    ANDNE*BLANKS                                   CAC005
     C           CAC005    OREQ 'Y'                                       CAC005
     C           UDBA      ANDEQBRCCHK                                    CAC005
     C           PSPRFC    ANDNEPRFCHK                                    CAC005
     C           BOKCHK    ANDEQ*BLANKS                                   CAC005
     C           CAC005    OREQ 'Y'                                       CAC005
     C           UDBA      ANDEQBRCCHK                                    CAC005
     C           PSBKCD    ANDNEBOKCHK                                    CAC005
     C           PRFCHK    ANDEQ*BLANKS                                   CAC005
     C           MKTCHK    IFEQ *BLANKS
     C           MKTCHK    OREQ UDMK
     C                     SETON                     82
      *                                                                   CAC005
      ** If CAC005 is ON, read the join file instead.                     CAC005
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C           BOKCHK    IFNE *BLANKS                                   CAC005
     C           PRFCHK    ANDNE*BLANKS                                   CAC005
     C                     READPUDEPB                    81               CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C           BOKCHK    IFNE *BLANKS                                   CAC005
     C           PRFCHK    ANDEQ*BLANKS                                   CAC005
     C                     READPSEBKPCJ1                 81               CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C           BOKCHK    IFEQ *BLANKS                                   CAC005
     C           PRFCHK    ANDNE*BLANKS                                   CAC005
     C                     READPSEBKPCJ2                 81               CAC005
     C                     ENDIF                                          CAC005
     C                     ELSE                                           CAC005
     C                     READPUDEPB                    81
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C                     ELSE
     C                     GOTO READN
     C                     END
     C                     END
     C                     ELSE
     C                     SETON                     81
     C                     END
     C                     END
     C                     END
     C                     END
     C**
     C           *IN82     IFEQ '0'
     C                     SETON                     05
     C                     END
     C                     END
     C                     MOVE '0'       *IN03
     C                     END
     C                     Z-ADDSFLREC    TOP
     C**
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT
0738 C*****************************************************************
     C**                                                              *
     C**   PROCES SR  Process the details for a security              *
     C**                                                              *
     C**   Called by  DISP                                            *
     C**   Calls  SR  RETSR,SUBFIL                                    *
     C**                                                              *
     C*****************************************************************
     C**
     C           PROCES    BEGSR                           ** PROCES **
     C**
     C**  Determine next type of SFL line required
     C**
     C           *IN51     IFEQ '0'
     C                     Z-ADD1         SFLT    20
     C*                                                                   055184
     C** Make sure that *IN50 is set on only if more than one more        055184
     C** record is available                                              055184
     C*                                                                   055184
      *                                                                   CAC005
      ** If CAC005 is ON, read the join file instead.                     CAC005
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C           BOKCHK    IFNE *BLANKS                                   CAC005
     C           PRFCHK    ANDNE*BLANKS                                   CAC005
     C                     READ UDEPB                    23               CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C           BOKCHK    IFNE *BLANKS                                   CAC005
     C           PRFCHK    ANDEQ*BLANKS                                   CAC005
     C                     READ SEBKPCJ1                 23               CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C           BOKCHK    IFEQ *BLANKS                                   CAC005
     C           PRFCHK    ANDNE*BLANKS                                   CAC005
     C                     READ SEBKPCJ2                 23               CAC005
     C                     ENDIF                                          CAC005
     C                     ELSE                                           CAC005
     C                     READ UDEPB                    23               055184
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C           *IN23     IFNE '1'                                       055184
     C           RECI      IFEQ 'D'                                       055184
     C           UDBK      IFEQ BOKCHK                                    055184
     C           UDBA      ANDEQBRCCHK                                    055184
     C           CAC005    ANDNE'Y'                                       CAC005
     C           UDBK      OREQ BOKCHK                                    CAC005
     C           UDBA      ANDEQBRCCHK                                    CAC005
     C           CAC005    ANDEQ'Y'                                       CAC005
     C           BOKCHK    ANDNE*BLANKS                                   CAC005
     C           PRFCHK    ANDNE*BLANKS                                   CAC005
     C           CAC005    OREQ 'Y'                                       CAC005
     C           UDBA      ANDEQBRCCHK                                    CAC005
     C           PSPRFC    ANDNEPRFCHK                                    CAC005
     C           BOKCHK    ANDEQ*BLANKS                                   CAC005
     C           CAC005    OREQ 'Y'                                       CAC005
     C           UDBA      ANDEQBRCCHK                                    CAC005
     C           PSBKCD    ANDNEBOKCHK                                    CAC005
     C           PRFCHK    ANDEQ*BLANKS                                   CAC005
     C           MKTCHK    IFEQ *BLANKS                                   055184
     C           MKTCHK    OREQ UDMK                                      055184
     C                     MOVE '0'       *IN50
     C                     ENDIF                                          055184
     C                     ENDIF                                          055184
     C                     ENDIF                                          055184
      *                                                                   CAC005
      ** If CAC005 is ON, read the join file instead.                     CAC005
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C           BOKCHK    IFNE *BLANKS                                   CAC005
     C           PRFCHK    ANDNE*BLANKS                                   CAC005
     C                     READPUDEPB                    23               CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C           BOKCHK    IFNE *BLANKS                                   CAC005
     C           PRFCHK    ANDEQ*BLANKS                                   CAC005
     C                     READPSEBKPCJ1                 23               CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C           BOKCHK    IFEQ *BLANKS                                   CAC005
     C           PRFCHK    ANDNE*BLANKS                                   CAC005
     C                     READPSEBKPCJ2                 23               CAC005
     C                     ENDIF                                          CAC005
     C                     ELSE                                           CAC005
     C                     READPUDEPB                    23               055184
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C                     END                                            055184
     C                     MOVE '1'       *IN51
     C                     END
     C**
     C**  Process required line
     C**
     C           PRTOP     TAG                             *** PRTOP   **
     C**
     C**  Third security line -
     C**  See if this line is required-
     C**
     C           SFLT      IFEQ 3
     C           ZRNOML    ANDEQ0
     C                     SETOF                     51
     C                     GOTO PEND
     C                     END
     C**
     C** Data accessed - fill SFL line & output to SFL
     C**
     C                     EXSR SUBFIL
     C                     ADD  1         SFLT
     C           SFLT      IFGT 3
     C                     SETOF                     51
     C                     GOTO PEND
     C                     END
     C           OUTREC    IFLT 14
     C                     GOTO PRTOP
     C                     END
     C**
     C**  If all lines processed - reset indicators & save new field   s
     C**
     C           PEND      TAG
     C           *IN51     IFEQ '0'
     C                     MOVE UDSN      SAVSS
     C                     MOVE UDMK      SAVMK
     C                     Z-ADD*ZEROS    ZZNOML
     C                     Z-ADD*ZEROS    ZZNOMU
     C                     Z-ADD*ZEROS    ZRNOML
     C                     END
     C**
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT
0738 C*****************************************************************
     C**                                                              *
     C**   BKPRC  SR  Calculate book price                            *
     C**                                                              *
     C**   Called by  SUBFIL                                          *
     C**   Calls  SR  OLBAP                                           *
     C**                                                              *
     C*****************************************************************
     C**
     C           BKPRC     BEGSR                           ** BKPRC  **
     C**
     C**  B/V ind is set to BLANK by default
     C**
     C           CSE109    IFEQ 'N'                                                           CSE109
     C                     MOVE ' '       SBVI
     C                     ENDIF                                                              CSE109
     C                     Z-ADD0         BKPR   158
     C                     Z-ADD0         ZZAPW
     C**
     C** Access 1st price for sec,br,mkt,book,price type
     C**
     C           TRDCHK    IFEQ 'T'
     C                     MOVE 'DT'      PPRT
     C                     ELSE
     C                     MOVE 'DV'      PPRT
     C                     END
     C***********KEYP      SETLLPRICS                    25               E14057
     C           CAC005    IFEQ 'Y'                                       152925
     C           KEY1      SETLLPRICR                    25               152925
     C                     ELSE                                           152925
     C           KEYP      SETLLPRICR                    25               E14057
     C                     END                                            152925
     C           *IN25     IFEQ '1'
     C***********KEYP      READEPRICS                    25               E14057
     C           CAC005    IFEQ 'Y'                                       152925
     C           KEY1      READEPRICR                    25               152925
     C                     ELSE                                           152925
     C           KEYP      READEPRICR                    25               E14057
     C                     END                                            152925
     C           *IN25     IFEQ '0'
     C**
     C** If price found & value date is less than prev. run date
     C**  B/V ind is set to Y
     C**
     C           PVDT      IFLT PRUN
     C           CSE109    IFEQ 'N'                                                           CSE109
     C                     MOVE 'Y'       SBVI
     C                     ENDIF                                                              CSE109
     C**
     C**  If price found & value date equals prev. run date
     C**    Price will be used to override AP num COB field
     C**
     C                     ELSE
     C           PVDT      IFEQ PRUN
     C                     Z-ADDPPRC      ZZAPW
     C                     END
     C                     END
     C**
     C** If price found & value date = run date
     C**   price Becomes the average price
     C**
     C           PVDT      IFEQ RUND
     C                     Z-ADDPPRC      BKPR
     C                     ELSE
     C**
     C** If price found with value date less than prev run date
     C**   Access price file with date = run date
     C**     if found price becomes the average price
     C**
     C           PVDT      IFLT PRUN
     C***********KEYPD     CHAINPRICS                25                   E14057
     C           CAC005    IFEQ 'Y'                                       152925
     C           KEY2      CHAINPRICR                25                   152925
     C                     ELSE                                           152925
     C           KEYPD     CHAINPRICR                25                   E14057
     C                     END                                            152925
     C           *IN25     IFEQ '0'
     C                     Z-ADDPPRC      BKPR
     C                     ELSE
     C**
     C**     otherwise -                                               ld
     C**   Access price file with date = previous run date
     C**     if found  price will be used to override AP num COB fie   ld
     C**
     C***********KEYPP     CHAINPRICS                25                   E14057
     C           CAC005    IFEQ 'Y'                                       152925
     C           KEY3      CHAINPRICR                25                   152925
     C                     ELSE                                           152925
     C           KEYPP     CHAINPRICR                25                   E14057
     C                     END                                            152925
     C           *IN25     IFEQ '0'
     C                     Z-ADDPPRC      ZZAPW
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C**                                                                  E21243
     C***Price*from*prices*file*is*price/disc./yield*so*must*be*converted*E21314
     C****If*price*found*from*prices*file,*convert*into*%*price*format*forE21314
     C******average*price/book*value*calculations***************** E21243 E21314
     C***********                                                  E21243 E21314
     C***********BKPR      IFGT 0                                  E21243 E21314
     C***********ZZAPW     ORGT 0                                  E21243 E21314
     C***********                                                  E21243 E21314
     C***********BKPR      IFGT 0                                  E21243 E21314
     C***********          Z-ADDBKPR      ZPRCIN                   E21243 E21314
     C***********          ELSE                                    E21243 E21314
     C***********          Z-ADDZZAPW     ZPRCIN                   E21243 E21314
     C***********          END                                     E21243 E21314
     C***********                                                  E21243 E21314
     C*****Handle*Australian*yield*security*parameters************ E21243 E21314
     C***********                                                  E21243 E21314
     C************IN52     IFEQ '1'                                E21243 E21314
     C***********ZZNOML    ANDNE0                                  E21243 E21314
     C***********          Z-ADDLCPN      ZDCSDT                   E21243 E21314
     C***********          Z-ADDRUND      ZDCEDT                   E21243 E21314
     C***********          Z-ADDZZNOML    ZAMT                     E21243 E21314
     C***********          EXSR ZACCZ                              E21243 E21314
     C***********ZDCINT    DIV  ZZNOML    WRKPI                    E21243 E21314
     C***********          Z-ADDRUND      WRKD    50               E21243 E21314
     C***********          EXSR ZYCE                               E21243 E21314
     C***********                                                  E21243 E21314
     C***********IF*EX-COUPON*THEN*PI*PASSED*IS*THE*REMAINING*INTEREST*43 E21314
     C***********TILL*NCD*AND*IS*NEGATIVE**************************E21243 E21314
     C***********                                                  E21243 E21314
     C***********SCUMEX    IFEQ 'X'                                E21243 E21314
     C***********          Z-ADDLCPN      ZDCSDT                   E21243 E21314
     C***********          Z-ADDNCD       ZDCEDT                   E21243 E21314
     C***********          EXSR ZACCZ                              E21243 E21314
     C***********ZDCINT    DIV  ZZNOML    WKWPI  159               E21243 E21314
     C***********WRKPI     SUB  WKWPI     WRKPI                    E21243 E21314
     C***********          END                                     E21243 E21314
     C***********          ELSE                                    E21243 E21314
     C***********          Z-ADD0         WRKPI                    E21243 E21314
     C***********          MOVE 'C'       SCUMEX                   E21243 E21314
     C***********          END                                     E21243 E21314
     C***********                                                  E21243 E21314
     C***********          EXSR ZPRCI                              E21243 E21314
     C***********BKPR      IFGT 0                                  E21243 E21314
     C***********          Z-ADDZPRCOT    BKPR                     E21243 E21314
     C***********          ELSE                                    E21243 E21314
     C***********          Z-ADDZPRCOT    ZZAPW                    E21243 E21314
     C***********          END                                     E21243 E21314
     C***********                                                  E21243 E21314
     C***********          END                                     E21243 E21314
     C**
     C**  Calculate average price -
     C**    If price found with value date = run date this is it
     C**
     C           BKPR      IFEQ 0
     C**
     C** Access BKPHDD
     C**
     C           CAC005    IFEQ 'Y'                                       152925
     C           KEY4      CHAINBKPHD                25                   152925
     C                     ELSE                                           152925
     C           KEYBH     CHAINBKPHD                25
     C                     END                                            152925
     C           *IN25     IFEQ '0'
     C**
     C** Access BKPOSD
     C**
     C           CAC005    IFEQ 'Y'                                       152925
     C           KEY5      CHAINBKPOS                25                   152925
     C                     ELSE                                           152925
     C           KEYBP     CHAINBKPOS                25
     C                     END                                            152925
     C                     END
     C**
     C**  If price found , value date = prev run date
     C**    Calculate override for sum of AP num COB +
     C**      price x nom posn COB on BKPOSD
     C**
     C           ZZAPW     IFNE 0
     C***********NPSN      MULT ZZAPW     ZZAPC                           075330
     C                     Z-ADDZZAPW     ZPRC                            075330
     C                     Z-ADDNPSN      ZNOML                           075330
     C                     EXSR ZCNSD                                     075330
     C                     Z-ADDZCONS     ZZAPC                           075330
     C                     ELSE
     C***********          Z-ADDAPNC      ZZAPC                           E16149
     C***********APNC      ADD  DPAP      ZZAPC                     E22564E36743
     C                     Z-ADDLAVP      ZPRC                            E36743
     C                     Z-ADDNPSN      ZNOML                           E36743
     C                     EXSR ZCNSD                                     E36743
     C                     Z-ADDZCONS     ZZAPC                           E36743
     C***********NPSN      MULT LAVP      ZZAPC                    E16149 E22564
     C***********5         ADD  CDP       XY      10               E16818 E22564
     C***********          MULT POWER8,XY ZZAPC                    E16818 E22564
     C***********                                                  E16818 E22564
     C***********SPBS      IFEQ 'P'                                E16818 E22564
     C***********          DIV  100       ZZAPC                    E16818 E22564
     C***********          END                                     E16818 E22564
     C***********                                                  E16818 E22564
     C                     END
     C**
     C**  Calculate average price from OLBAP
     C**
     C           *IN25     IFEQ '0'
     C                     EXSR OLBAP
     C                     END
     C                     END
     C**
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT
0738 C*****************************************************************
     C**                                                              *
     C**   OLBAP  SR  Calculate average price                         *
     C**                                                              *
     C**   Called by  BKPRC                                           *
     C**   Calls  SR  none                                            *
     C**                                                              *
     C*****************************************************************
     C**
     C           OLBAP     BEGSR                           ** OLBAP  **
     C**
     C**  Calculate new NP = NP + sum nom purch + sum nom sales
     C**
     C           SNPI      ADD  SNSI      ZNNOMP
     C                     ADD  NPSN      ZNNOMP
     C**
     C** If NP & new NP both long -
     C**  AP = (AP num COB + AP num purch) / new NP
     C**
     C           NPSN      IFGT 0
     C           ZNNOMP    ANDGT0
     C           ZNNOMP    IFEQ 0
     C                     Z-ADD0         BKPR
     C                     ELSE
     C***********ZZAPC     ADD  SANP      WBKPR  150                      E22564
     C***********          SUB  SANS      WBKPR                           E21243
     C***********          ADD  SANS      WBKPR                    E21243 E22564
     C***********WBKPR     DIV  ZNNOMP    BKPR      H                     E22564
     C           ZZAPC     ADD  SANP      ZAPNC                           E22564
     C           NPSN      ADD  SNPI      ZNOML                           E22564
     C                     EXSR ZAVPR                                     E22564
     C                     Z-ADDZPRC      BKPR                            E22564
     C                     END
     C                     END
     C**
     C** If NP & new NP both short -
     C**  AP = (AP num COB + AP num sales) / new NP
     C**  (ensure price field is positive)
     C**
     C           NPSN      IFLT 0
     C           ZNNOMP    ANDLT0
     C           ZNNOMP    IFEQ 0
     C                     Z-ADD0         BKPR
     C                     ELSE
     C***********ZZAPC     ADD  SANS      WBKPR                           E22564
     C***********          SUB  SANP      WBKPR                           E21243
     C***********          ADD  SANP      WBKPR                    E21243 E22564
     C***********WBKPR     DIV  ZNNOMP    BKPR      H              E21243 E22564
     C           ZZAPC     ADD  SANS      ZAPNC                           E22564
     C           NPSN      ADD  SNSI      ZNOML                           E22564
     C                     EXSR ZAVPR                                     E22564
     C                     Z-ADDZPRC      BKPR                            E22564
     C***********BKPR      IFLT 0                                         E22564
     C***********BKPR      MULT -1        BKPR                            E22564
     C***********          END                                            E22564
     C                     END
     C                     END
     C**
     C** If NP long or flat , new NP short -
     C**  AP = AP num sales / sum nom sales
     C**
     C           NPSN      IFGE 0
     C           ZNNOMP    ANDLT0
     C           SNSI      IFEQ 0
     C                     Z-ADD0         BKPR
     C                     ELSE
     C***********SANS      DIV  SNSI      BKPR      H                     E22564
     C                     Z-ADDSANS      ZAPNC                           E22564
     C                     Z-ADDSNSI      ZNOML                           E22564
     C                     EXSR ZAVPR                                     E22564
     C                     Z-ADDZPRC      BKPR                            E22564
     C                     END
     C                     END
     C**
     C** If NP short or flat , new NP long -
     C**  AP = AP num purch / sum nom purch
     C**
     C           NPSN      IFLE 0
     C           ZNNOMP    ANDGT0
     C           SNPI      IFEQ 0
     C                     Z-ADD0         BKPR
     C                     ELSE
     C***********SANP      DIV  SNPI      BKPR      H                     E22564
     C                     Z-ADDSANP      ZAPNC                           E22564
     C                     Z-ADDSNPI      ZNOML                           E22564
     C                     EXSR ZAVPR                                     E22564
     C                     Z-ADDZPRC      BKPR                            E22564
     C                     END
     C                     END
     C**
     C** If new NP flat -
     C**  AP = 0
     C**
     C           ZNNOMP    IFEQ 0
     C                     Z-ADD0         BKPR
     C                     END
     C**
     C**If*price*basis*'P',*multiply*by*100*to*fetch*true*price********   E22564
     C***********SPBS      IFEQ 'P'                                       E22564
     C***********          MULT 100       BKPR                            E22564
     C***********          END                                            E22564
     C***********                                                         E22564
     C**REFORMAT*BOOK*PRICE*FROM*NOMINAL*CURRENCY*DECIMAL*PLACES*(AS*IT   E22564
     C***WAS*CALCULATED*FROM*SUM*AP*NUMERATOR)*TO*A*STRAIGHT*15/8*PRICE   E22564
     C***********                                                         E22564
     C***********5         ADD  CDP       XY      10                      E22564
     C***********          SUB  NMDP      XY                              E22564
     C***********BKPR      DIV  POWER8,XY BKPR                            E22564
     C**
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C**                                                              *
     C**   CLEAR  SR  Clear the screen display fields and indicators  *
     C**                                                              *
     C**   Called by  COMMD, SECIN                                    *
     C**   Calls  SR  none                                            *
     C**                                                              *
     C*****************************************************************
     C**
     C           CLEAR     BEGSR
     C**
     C                     MOVE *BLANKS   BRANCH
     C                     MOVE *BLANKS   BOOK
     C                     MOVE *BLANKS   TRDVAL
     C                     MOVE *BLANKS   MARKET
     C                     MOVE *BLANKS   NAME                            S01176
     C                     MOVE *BLANKS   SBRCH
     C                     MOVE *BLANKS   SBOOK
     C                     MOVE *BLANKS   SCNAM
     C                     MOVE *BLANKS   SMRKT
     C                     MOVE *BLANKS   SAVSS
     C                     MOVE *BLANKS   PROCEN                          CAC005
     C                     MOVE *BLANKS   SPRFC                           CAC005
     C**
     C                     Z-ADD0         SFLREC  40
     C                     Z-ADD0         TOP     40
     C**
     C                     SETON                       03
     C                     SETOF                     800405
     C                     SETOF                     818789
     C                     SETOF                     434445
     C                     SETOF                     464750
     C                     SETOF                     51
     C                     MOVE *OFF      *IN48                           CAC005
     C           CSE109    IFEQ 'Y'                                                           CSE109
     C                     MOVE '0'       *IN70                                               CSE109
     C                     ENDIF                                                              CSE109
     C**  CLEAR SUBFILE
     C                     SETON                       02
     C           CSE109    IFEQ 'Y'                                                           CSE109
     C                     WRITESE0230C1                                                      CSE109
     C                     ELSE                                                               CSE109
     C                     WRITESE0230C0
     C                     ENDIF                                                              CSE109
     C                     SETOF                       02
     C**
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C**                                                              *
     C**   SETUP  SR  To prepare for Screen Display                   *
     C**                                                              *
     C**   Called by  SECIN                                           *
     C**   Calls  SR  CLEAR, DISP                                     *
     C**                                                              *
     C*****************************************************************
     C**
     C           SETUP     BEGSR                           ** SETUP **
     C**
     C                     MOVE BRANCH    BRCCHK
     C                     MOVE BOOK      BOKCHK
     C                     MOVE TRDVAL    TRDCHK
     C                     MOVE MARKET    MKTCHK
     C                     MOVE NAME      NMCHK                           S01176
     C                     MOVE PROCEN    PRFCHK                          CAC005
     C                     MOVE NMCHK     WNAME  10                       CAC005
      *                                                                   CAC005
      ** Move the pseudo book to BOKCHK to be use as keyfield in sear-    CAC005
      ** ching for book records if both book and profit centre entered.   CAC005
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C           BOOK      IFNE *BLANKS                                   CAC005
     C           PROCEN    ANDNE*BLANKS                                   CAC005
     C                     MOVE PMPSBK    BOKCHK                          CAC005
     C                     MOVE BOOK      WBKCD   2                       CAC005
     C                     ENDIF                                          CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C**                                                                  E19917
     C**   If a Security was selected on a higher level                   E19917
     C**   then ensure it is at the top of the list.                      E19917
     C**                                                                  E19917
     C           NAME      IFEQ *BLANKS                                   E19917
     C           RQSESN    IFNE *BLANKS                                   E19917
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0230CP11                                           S01408
     C*                                                                   S01408
     C                     MOVE RQSESN    NMCHK                           E19917
     C                     END                                            E19917
     C                     END                                            E19917
     C**
     C**   Clear the Screen
     C**
     C                     EXSR CLEAR
     C**
     C**   Move  selection criteria to top of screen
     C**
     C                     MOVE BRCCHK    SBRCH
     C                     MOVE BOKCHK    SBOOK
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVE PRFCHK    SPRFC                           CAC005
      *                                                                   CAC005
     C           BOKCHK    IFNE *BLANKS                                   CAC005
     C           PRFCHK    ANDNE*BLANKS                                   CAC005
     C                     MOVE WBKCD     SBOOK                           CAC005
     C                     ENDIF                                          CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C           TRDCHK    IFEQ 'T'
     C                     MOVE 'TRADE'   SCNAM
     C                     ELSE
     C                     MOVE 'VALUE'   SCNAM
     C                     END
     C           MKTCHK    IFEQ 'G'
     C***********          MOVE 'GREY'    SMRKT                           E37285
     C                     MOVEL'GREY'    SMRKT                           E37285
     C                     ELSE
     C           MKTCHK    IFEQ 'P'
     C***********          MOVE 'PRIM'    SMRKT                           E37285
     C                     MOVEL'PRIMARY' SMRKT                           E37285
     C                     ELSE
     C           MKTCHK    IFEQ 'S'
     C***********          MOVE 'SEC '    SMRKT                           E37285
     C                     MOVEL'SECONDAR'SMRKT                           E37285
     C                     MOVE 'Y'       SMRKT                           E37285
     C                     ELSE
     C***********          MOVE 'ALL '    SMRKT                           E37285
     C                     MOVEL'ALL '    SMRKT                           E37285
     C                     END
     C                     END
     C                     END
     C***********                                                         S01117
     C*****Set*defaults-***********************************************   S01117
     C***********                                                         S01117
     C************IN07     IFEQ '0'                                       S01117
     C***********BRANCH    OREQ *BLANK                                    S01117
     C***********          MOVE DSTB      BRCCHK                          S01117
     C***********          END                                            S01117
     C**
     C**   Position UDEPB at start
     C**
     C           CAC005    IFEQ 'Y'                                       CAC005
     C           BOKCHK    IFNE *BLANKS                                   CAC005
     C           PRFCHK    ANDNE*BLANKS                                   CAC005
     C           UKEY      SETLLUDEPB                                     CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C           BOKCHK    IFNE *BLANKS                                   CAC005
     C           PRFCHK    ANDEQ*BLANKS                                   CAC005
     C           BOKCHK    SETLLSEBKPCJ1                                  CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C           BOKCHK    IFEQ *BLANKS                                   CAC005
     C           PRFCHK    ANDNE*BLANKS                                   CAC005
     C           PRFCHK    SETLLSEBKPCJ2                                  CAC005
     C                     ENDIF                                          CAC005
     C                     ELSE                                           CAC005
     C           UKEY      SETLLUDEPB
     C                     ENDIF                                          CAC005
     C**
     C**   Clear accumulator fields
     C**
     C                     Z-ADD0         ZZNOMU 150
     C                     Z-ADD0         ZZNOML 150
     C                     Z-ADD0         ZRNOML 150
     C**
     C**   Get details for display
     C**
     C                     EXSR DISP
     C**
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT
0738 C*****************************************************************
     C**                                                              *
     C**   SUBFIL SR  Write details to Subfile                        *
     C**                                                              *
     C**   Called by  DISP                                            *
     C*****Calls**SR**RETSR,*ZSEDIT,*BKPRC,*ZPRCO******************   *   E13852
     C**   Calls  SR  RETSR, ZSEDIT, BKPRC                            *   E13852
     C**              ZPRCO                                           *   S01176
     C**                                                              *
     C*****************************************************************
     C**
     C           SUBFIL    BEGSR                           ** SUBFIL **
     C**
     C**  SUBFIL - fills one line of the SFL depending on the setting
     C**           of SFLT
     C**
     C**  SFLT=1 FIRST SECURITY LINE
     C**
     C           SFLT      IFEQ 1
     C                     SETOF                     08
     C           CAC005    IFEQ 'Y'                                       152925
     C                     MOVE ZPRFC     SPCTR                           152925
     C                     MOVE ZPSBK     XPSBK   2                       152925
     C                     END                                            152925
      *                                                                                       CSE109
     C           CSE109    IFEQ 'Y'                                                           CSE109
     C                     MOVE SPCTR     SPCTR4                                              CSE109
     C                     ENDIF                                                              CSE109
     C**
     C**   ACCESS SECURITY DETAILS
     C**
     C           SAVSS     CHAINSECTY                25
     C           *IN25     IFEQ '0'
     C           RECI      IFEQ '*'
     C                     SETON                     25
     C                     END
     C                     END
     C           *IN25     IFEQ '1'
     C                     MOVELPROGRM    DBPGM
     C                     MOVELSAVSS     DBKEY            ***************
     C                     MOVE 'SECTY'   DBFILE           * DB ERROR 05 *
     C                     Z-ADD05        DBASE            ***************
     C                     SETON                       U7U8
     C                     EXSR *PSSR                                     S01117
     C                     MOVE '0'       RTNC
     C                     EXSR RETSR
     C                     END
     C*                                                                   054259
     C** DETERMINE PROCESSING TYPE AND TRADE BASIS FOR THE THE COMBINATION054259
     C** OF NOMINAL CURRENCY AND INVESTMENT TYPE                          054259
     C*                                                                   054259
     C           IKEY      CHAININVTPDF              25                   054259
     C           *IN25     IFEQ '1'                                       054259
     C                     MOVELPROGRM    DBPGM                           054259
     C                     MOVELIKEYDS    DBKEY            ***************054259
     C                     MOVE 'INVTP'   DBFILE           * DB ERROR 06 *054259
     C                     Z-ADD06        DBASE            ***************054259
     C                     SETON                       U7U8               054259
     C                     EXSR *PSSR                                     054259
     C                     MOVE '0'       RTNC                            054259
     C                     EXSR RETSR                                     054259
     C                     END                                            054259
     C*                                                                   054259
     C*                                                                   S01232
     C*   INDICATE IF AUSTRALIAN YIELD TRADED SECURITY                    S01232
     C*                                                                   S01232
     C           STBS      IFEQ 'Y'                                       S01232
     C           SYBS      ANDEQ'AU'                                      S01232
     C                     SETON                     52                   S01232
     C                     ELSE                                           S01232
     C                     SETOF                     52                   S01232
     C                     END                                            S01232
     C**
     C**   Format security
     C**
     C                     MOVE SAVSS     SSESN
     C                     MOVE SRPN      SDESC
     C                     MOVE NMCY      SNMCY
     C           CSE109    IFEQ 'Y'                                                           CSE109
     C                     MOVE SDESC     SDESC4                                              CSE109
     C                     MOVE SNMCY     SNMCY4                                              CSE109
     C                     ENDIF                                                              CSE109
     C**
     C***********          MOVEL'20      'TKEY   12                       S01117
     C***********          MOVELNMCY      ZWK4    4                       S01117
     C***********          MOVE 1         ZWK4                            S01117
     C***********          MOVE ZWK4      TKEY                            S01117
     C***********TKEY      CHAINTABTG10F             25                   S01117
     C************IN25     IFEQ '0'                                       S01117
     C***********RECI      IFEQ '*'                                       S01117
     C***********          SETON                     25                   S01117
     C***********          END                                            S01117
     C***********          END                                            S01117
     C************IN25     IFEQ '1'                                       S01117
     C***********          MOVELPROGRM    DBPGM                           S01117
     C***********          MOVELTKEY      DBKEY            ***************S01117
     C***********          MOVE 'TABLE'   DBFILE           * DB ERROR 04 *S01117
     C***********          Z-ADD04        DBASE            ***************S01117
     C***********          SETON                       U7U8               S01117
     C***********          MOVE '0'       RTNC                            S01117
     C***********          EXSR RETSR                                     S01117
     C***********          END                                            S01117
      *                                                                   S01117
      ** Access currency file SDCURRPD                                    S01117
      *                                                                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR'  @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM NMCY      @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C***********          Z-ADDCDP       NCDP                      S01232S01117
     C                     Z-ADDA6NBDP    NCDP                            S01117
      *                                                                   E32243
      ***  Ensure that CDP for Standard Subroutines is initialised.       E32243
      *                                                                   E32243
     C                     Z-ADDA6NBDP    ZCDP                            E32243
     C**
     C**   Format book price & B/V indicator
     C**
     C                     EXSR BKPRC
     C           BKPR      IFLT *ZEROS
     C                     Z-SUBBKPR      BKPR
     C                     END
     C***********          EXSR ZNCD                                      E13852
     C***********          MOVE BKPR      ZPRICE                          E13852
     C***********          Z-ADDRUND      ZFDATE                          E13852
     C***********                                                 E13851  E13852
     C***********ZPRICE    IFNE *ZEROS                            E13851  E13852
     C***********          EXSR ZPRCO                                     E13852
     C***********          ELSE                                   E13851  E13852
     C***********          Z-ADD*ZEROS    ZPRCOT                  E13851  E13852
     C***********          END                                    E13851  E13852
     C*                                                           E13851  E13852
     C                     EXSR ZNCD                                      S01176
     C                     MOVE BKPR      ZPRICE                          S01176
     C                     Z-ADDRUND      ZFDATE                          S01176
     C           ZPRICE    IFNE *ZEROS                                    S01176
     C*                                                                   S01232
     C*    Handle Australian yield security parameters                    S01232
     C*                                                                   S01232
     C           *IN52     IFEQ '1'                                       S01232
     C           ZZNOML    ANDNE0                                         S01232
     C                     Z-ADDLCPN      ZDCSDT                          S01232
     C                     Z-ADDRUND      ZDCEDT                          S01232
     C                     Z-ADDZZNOML    ZAMT                            S01232
     C                     Z-ADDNCDP      ZCDP                            S01117
     C                     EXSR ZACCZ                                     S01232
     C           ZDCINT    DIV  ZZNOML    WRKPI                           S01232
     C/COPY WNCPYSRC,SE0230C006
     C                     Z-ADDRUND      WRKD    50                      S01232
     C                     EXSR ZYCE                                      S01232
     C*                                                                   S01232
     C***        IF EX-COUPON THEN PI PASSED IS THE REMAINING INTEREST    S01232
     C***        TILL NCD AND IS NEGATIVE                                 S01232
     C*                                                                   S01232
     C           SCUMEX    IFEQ 'X'                                       S01232
     C                     Z-ADDLCPN      ZDCSDT                          S01232
     C                     Z-ADDNCD       ZDCEDT                          S01232
     C                     Z-ADDNCDP      ZCDP                            S01117
     C                     EXSR ZACCZ                                     S01232
     C           ZDCINT    DIV  ZZNOML    WKWPI  159                      S01232
     C           WRKPI     SUB  WKWPI     WRKPI                           S01232
     C                     END                                            S01232
     C                     ELSE                                           S01232
     C                     Z-ADD0         WRKPI                           S01232
     C                     MOVE 'C'       SCUMEX                          S01232
     C                     END                                            S01232
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0230CCP3                                           S01408
     C*                                                                   S01408
     C*                                                                   S01232
     C           ZZNOML    IFLT *ZERO                                     E39495
     C                     Z-SUBZZNOML    ZNOML                           E39495
     C                     ELSE                                           E39495
     C                     Z-ADDZZNOML    ZNOML                           E39495
     C                     END                                            E39495
     C*                                                                   E39495
     C                     EXSR ZPRCO                                     S01176
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0230CCP4                                           S01408
     C*                                                                   S01408
     C                     ELSE                                           S01176
     C                     Z-ADD*ZEROS    ZPRCOT                          S01176
     C                     END                                            S01176
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0230CCP5                                           S01408
     C*                                                                   S01408
     C*                                                                   S01176
      ** If Enhanced Treasury is switched on:                                                 CSE075
      *                                                                                       CSE075
     C           CSE075    IFEQ 'Y'                                                           CSE075
      *                                                                                       CSE075
      ** For Mortgage-backeds, get latest factor and adjust output price.                     CSE075
      *                                                                                       CSE075
     C           PROT      IFEQ '8'                                                           CSE075
     C                     MOVE 'MP'      SDET                                                CSE075
     C                     Z-ADDRUND      ZDCSDT                                              CSE075
     C           KZSEDO    SETLLSEDEVDO                                                       CSE075
     C                     READ SEDEVDO                  25                                   CSE075
     C           *IN25     IFEQ *OFF                                                          CSE075
     C           SDSN      ANDEQSESN                                                          CSE075
     C           SDET      ANDEQ'MP'                                                          CSE075
     C                     Z-ADDSDCP      CFCT                                                CSE075
     C                     ENDIF                                                              CSE075
     C                     ENDIF                                                              CSE075
     C                     ENDIF                                                              CSE075
      *                                                                                       CSE109
     C           CSE109    IFEQ 'Y'                                                           CSE109
     C                     Z-ADD5         ZDECS   10                                          CSE109
     C                     MOVE 'L'       ZECODE                                              CSE109
     C                     Z-ADDZPRCOT    WRK5DC 115                                          CSE109
     C                     MOVE WRK5DC    ZFLD15                                              CSE109
     C                     ELSE                                                               CSE109
     C                     Z-ADD8         ZDECS   10
     C                     MOVE 'L'       ZECODE
     C***********          MOVE ZPRCOT    ZFLD15
     C***********          MOVE BKPR      ZFLD15                          S01176
     C                     MOVE ZPRCOT    ZFLD15                          S01176
     C                     ENDIF                                                              CSE109
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SBKPR
     C           CSE109    IFEQ 'Y'                                                           CSE109
     C                     MOVE SBKPR     SBKPR4                                              CSE109
     C                     ENDIF                                                              CSE109
     C*                                                                   E23340
     C* Do Not show Yield on Trade Date Positions                         E23340
     C*                                                                   E23340
     C********** TRDCHK    IFEQ 'T'                                                    E23340 CSE109
     C********** STBS      IFEQ 'Y'                                                    E01890 CSE109
     C********** STBS      OREQ 'D'                                                    E01890 CSE109
     C           TRDCHK    IFEQ 'T'                                                           CSE109
     C           STBS      ANDEQ'Y'                                                           CSE109
     C           TRDCHK    OREQ 'T'                                                           CSE109
     C           STBS      ANDEQ'D'                                                           CSE109
     C           CSE109    ANDEQ'N'                                                           CSE109
     C***********          MOVE '-- NOT A'NAR    16                E23340 E23941
     C***********          MOVEL'VAILABLE'NAR                      E23340 E23941
     C                     MOVEL'-- NOT A'NAR    16                E23340 E23941
     C                     MOVE 'VAILABLE'NAR                      E23340 E23941
     C                     MOVELNAR       SBKPR                           E23340
     C                     MOVE ' -'      SBKPR                           E23340
     C                     END                                            E01890
     C**********           END                                                         E23340 CSE109
     C*                                                                   E23340
     C           SPBS      IFEQ 'P'
     C                     MOVE '%'       SP1
     C                     ELSE
     C                     MOVE ' '       SP1
     C                     END
     C           CSE109    IFEQ 'Y'                                                           CSE109
     C                     MOVE SBKPR     SBKPR4                                              CSE109
     C                     MOVE SP1       SP14                                                CSE109
     C                     ENDIF                                                              CSE109
     C*                                                                   054259
     C           PROT      IFEQ '8'                                       054259
     C*                                                                   054259
     C                     MOVE SESN      SDSN                            054259
     C                     MOVE 'MP'      SDET                            054259
     C                     Z-ADDRUND      SDED                            054259
     C*                                                                   054259
     C           KEYSED    SETLLSEDEVDO                                   054259
     C                     READ SEDEVDO                  65               054259
     C*                                                                   054259
     C           *IN65     IFEQ '0'                                       054259
     C           SDSN      ANDEQSESN                                      054259
     C           SDET      ANDEQ'MP'                                      054259
     C                     Z-ADDSDCP      CURF                            054259
     C                     ELSE                                           054259
     C                     Z-ADDCFCT      CURF                            054259
     C                     END                                            054259
     C*                                                                   054259
     C                     END                                            054259
     C/COPY WNCPYSRC,SE0230C003
     C**
     C*****Format*book*value*******************************************   E22564
     C***********          Z-ADD*ZEROS    WBVAL  150                      E22564
     C***********          Z-ADD*ZEROS    WBVAL0 150                      E22564
     C***********          Z-ADD*ZEROS    WBVAL1 151                      E22564
     C***********          Z-ADD*ZEROS    WBVAL2 152                      E22564
     C***********          Z-ADD*ZEROS    WBVAL3 153                      E22564
     C***********          MOVEA'0000'    *IN,55                          E22564
     C***********55        ADD  CDP       J       20                      E22564
     C***********          MOVEA'1'       *IN,J                           E22564
     C***********                                                         E22564
     C***Calculate*consideration/reallowance/charges/commission********   E22564
     C***55******ZZNOML    MULT BKPR      WBVAL0    H                     E22564
     C***56******ZZNOML    MULT BKPR      WBVAL1    H                     E22564
     C***57******ZZNOML    MULT BKPR      WBVAL2    H                     E22564
     C***58******ZZNOML    MULT BKPR      WBVAL3    H                     E22564
     C***********                                                         E22564
     C**Price*basis*-*divide*by*100************************************   E22564
     C***********SPBS      IFEQ 'P'                                       E22564
     C***55******          DIV  100       WBVAL0                          E22564
     C***56******          DIV  100       WBVAL1                          E22564
     C***57******          DIV  100       WBVAL2                          E22564
     C***58******          DIV  100       WBVAL3                          E22564
     C***********          END                                            E22564
     C***********                                                         E22564
     C***55******          MOVE WBVAL0    WBVAL                           E22564
     C***56******          MOVE WBVAL1    WBVAL                           E22564
     C***57******          MOVE WBVAL2    WBVAL                           E22564
     C***58******          MOVE WBVAL3    WBVAL                           E22564
     C***********                                                         E22564
     C****Allow*for*nominal*decimal*places*****************************   E22564
     C***********5         SUB  NMDP      DC      10                      E22564
     C***********WBVAL     MULT POWER8,DC BVAL   150                      E22564
     C***********ZZNOML    MULT BKPR      BVAL   152                      E22564
     C***********SPBS      IFEQ 'P'                                       E22564
     C***********BVAL      DIV  100       BVAL      H                     E22564
     C***********          END                                            E22564
     C**                                                                  E22564
     C**  Calculate and Format Book Value                                 E22564
     C**                                                                  E22564
     C***********          Z-ADDZNNOMP    ZNOML                    E22564 E28170
     C                     Z-ADDZZNOML    ZNOML                           E28170
     C                     Z-ADDBKPR      ZPRC                            E22564
     C                     Z-ADDNCDP      ZCDP                            S01117
     C                     EXSR ZCNSD                                     E22564
     C*                                                                   054259
     C           PROT      IFEQ '8'                                       054259
     C/COPY WNCPYSRC,SE0230C007
     C                     MULT CURF      ZCONS     H                     054259
     C                     END                                            054259
     C           CSE109    IFEQ 'Y'                                                           CSE109
     C                     Z-ADDZCONS     BKPRSV 150                                          CSE109
     C                     ENDIF                                                              CSE109
     C/COPY WNCPYSRC,SE0230C004
     C*                                                                   054259
     C                     Z-ADDZCONS     ZFLD15                          E22564
     C***********          Z-ADDCDP       ZDECS   10                      S01117
     C                     Z-ADDA6NBDP    ZDECS   10                      S01117
     C                     MOVE 'L'       ZECODE
     C***********          MOVE BVAL      ZFLD15                          E22564
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SBVAL
     C           CSE109    IFEQ 'Y'                                                           CSE109
     C                     MOVE SBVAL     SBVAL4                                              CSE109
     C                     ENDIF                                                              CSE109
     C**
     C           CSE109    IFEQ 'Y'                                                           CSE109
     C                     MOVE LIN4      SLINX                                               CSE109
     C                     ELSE                                                               CSE109
     C                     MOVE LIN1      SLINE
     C                     ENDIF                                                              CSE109
     C                     END
     C**
     C**  SFLT=2 SECOND SECURITY DETAILS LINE
     C**
     C           SFLT      IFEQ 2
     C           SFLT      OREQ 1                                                             CSE109
     C           CSE109    ANDEQ'Y'                                                           CSE109
      *                                                                                       CSE109
     C           SFLT      IFEQ 2                                                             CSE109
     C                     SETON                     08
     C**
     C**   Edit coupon rate & maturity date
     C**
     C           CPNR      IFNE 0                                         E15690
     C                     Z-ADD7         ZDECS   10
     C                     MOVE 'L'       ZECODE
     C                     Z-ADD*ZEROS    ZFLD15                          081694
     C                     MOVE CPNR      ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SCPNR
     C                     ELSE                                           E15690
     C                     MOVE *BLANKS   SCPNR                           E15690
     C                     END                                            E15690
     C           CSE109    IFEQ 'Y'                                                           CSE109
     C                     MOVE SCPNR     SCPNR5                                              CSE109
     C                     ENDIF                                                              CSE109
     C**
     C           MATY      IFEQ 00000
     C           MATY      OREQ 99999
     C                     MOVE *BLANKS   SMATY
     C                     ELSE
     C                     Z-ADDMATY      ZDAYNO  50
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    SMATY
     C                     END
     C**
     C**   Edit nominal
     C**
     C                     Z-ADDNMDP      ZDECS   10
     C                     MOVE 'L'       ZECODE
     C                     Z-ADDZZNOML    ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SNOML
      *                                                                                       CSE109
     C           CSE109    IFEQ 'Y'                                                           CSE109
     C                     MOVE SMATY     SMATY5                                              CSE109
     C                     MOVE SNOML     SNOML5                                              CSE109
     C                     ENDIF                                                              CSE109
      *                                                                                       CSE109
      ** SFLT = 1                                                                             CSE109
      *                                                                                       CSE109
     C                     ELSE                                                               CSE109
     C***********                                                         S01176
     C*****Format*market*price*****************************************   S01176
     C***********          MOVE MKPR      ZPRICE                          S01176
     C***********                                                         S01176
     C**Access*Price*file*for*Security*and*Type*'V'*for*Price**********   S01176
     C***-*if*not*found,*use*Market*Price*from*Security****************   S01176
     C***********                                                         S01176
     C***********          MOVE 'V '      PTYP                            S01176
     C***********          MOVE *ZEROS    PCST                            S01176
     C***********          Z-ADD0         PDAT                            S01176
     C***********KEYPT     SETLLPRICT                                     S01176
     C***********KEYPTP    READEPRICT                    99               S01176
     C************IN99     IFEQ '1'                                       S01176
     C***********          MOVE MKPR      ZPRICE                          S01176
     C***********          ELSE                                           S01176
     C***********          MOVE PPRC      ZPRICE 158                      S01176
     C***********          END                                            S01176
     C***********          Z-ADDZPRICE    WMPRIC 158                      S01176
     C***********                                                         S01176
     C***********          Z-ADDRUND      ZFDATE                   E13852 S01176
     C***********ZPRICE    IFNE *ZEROS                      E13851 E13852 S01176
     C***********          EXSR ZPRCO                              E13852 S01176
     C***********          ELSE                             E13851 E13852 S01176
     C***********          Z-ADD*ZEROS    ZPRCOT            E13851 E13852 S01176
     C***********          END                              E13851 E13852 S01176
     C***********                                           E13851 E13852 S01176
     C***********                                                         S01176
     C***********          END                                            S01176
     C***********          Z-ADD8         ZDECS   10                      S01176
     C***********          MOVE 'L'       ZECODE                          S01176
     C***********          MOVE ZPRCOT    ZFLD15                   E13852 S01176
     C***********          MOVE ZPRICE    ZFLD15                   E13852 S01176
     C***********          EXSR ZSEDIT                                    S01176
     C***********          MOVE ZOUT21    SMKPR                           S01176
     C***********SPBS      IFEQ 'P'                                       S01176
     C***********          MOVE '%'       SP2                             S01176
     C***********          ELSE                                           S01176
     C***********          MOVE ' '       SP2                             S01176
     C***********          END                                            S01176
     C*                                                                   S01176
     C**   FORMAT MARKET PRICE                                            S01176
     C*                                                                   S01176
     C***DETERMINE*PROCESSING*TYPE*AND*TRADE*BASIS*FOR*THE*THE*COMBS01176 054259
     C***OF*NOMINAL*CURRENCY*AND*INVESTMENT*TYPE*******************S01176 054259
     C*                                                            S01176 054259
     C***********IKEY      CHAININVTPDF              25            S01176 054259
     C************IN25     IFEQ '1'                                S01176 054259
     C***********          MOVELPROGRM    DBPGM                    S01176 054259
     C***********          MOVELIKEYDS    DBKEY            ********S01176*054259
     C***********          MOVED'INVTP'   DBFILE           **DB*ERRS01176*054259
     C***********          Z-ADD06        DBASE            ********S01176*054259
     C***********          SETON                       U7U8        S01176 054259
     C***********          EXSR *PSSR                              S01117 054259
     C***********          MOVE '0'       RTNC                     S01176 054259
     C***********          EXSR RETSR                              S01176 054259
     C***********          END                                     S01176 054259
     C*                                                                   S01176
     C** DETERMINE IF A PRICE RECORD EXISTS ON LF/CPPRIC FOR THE          S01176
     C** CURRENT COMBINATION OF NOMINAL CURRENCY AND INVESTMENT TYPE      S01176
     C*                                                                   S01176
     C           PRKEY     CHAINCPPRIDF              25                   S01176
     C*                                                                   S01176
     C** IF THE PROCESSING TYPE IS EQUAL TO 9 ,THE TRADE BASIS ON         S01176
     C** LF/SECTY IS 'Y' (FOR YIELD) AND A LIVE PRICE RECORD EXISTS ON    S01176
     C** LF/CPPRIC THEN SET THE MARKET PRICE TO THE YIELD CALCULATED      S01176
     C** BY THE STANDARD SUBROUTINE ZYMTX                                 S01176
     C*                                                                   S01176
     C           PROT      IFEQ '9'                                       S01176
     C           STBS      ANDEQ'Y'                                       S01176
     C           *IN25     ANDEQ'0'                                       S01176
     C           RECI      ANDEQ'D'                                       S01176
     C*                                                                   S01176
     C** OUTPUT FIELD IS YPROP                                            S01176
     C*                                                                   S01176
     C                     EXSR YPRICE                                    S01176
     C                     Z-ADDYPROP     MKPRSV 158                      S01176
     C*                                                                   S01176
     C** CONVERT MARKET PRICE IN YIELD FORMAT TO PRICE FORMAT VIA         S01176
     C** STD SR ZPRCI IN ORDER TO CALCULATE MARKET VALUE                  S01176
     C*                                                                   S01176
     C                     Z-ADDYPROP     ZPRCIN                          S01176
     C                     Z-ADDRUND      ZFDATE                          S01176
     C           ZPRCIN    IFNE *ZEROS                                    S01176
     C*                                                                   S01232
     C**  (NB Australian yield security parameters already set-up.)       S01232
     C*                                                                   S01232
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0230CCP6                                           S01408
     C*                                                                   S01408
     C*                                                                   E39495
     C**  SET UP INPUT PARAMETER TO ZCALCD                                E39495
     C**                                                                  E39495
     C                     Z-ADDZNOML     ZNOMLS 150                      E39495
     C           ZNOML     IFLT 0                                         E39495
     C                     Z-SUBZNOML     ZNOML                           E39495
     C                     END                                            E39495
     C                     EXSR ZPRCI                                     S01176
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0230CCP7                                           S01408
     C*                                                                   S01408
      *                                                                                       CSE035
      ** ADJUST PRICE : PRICE + PUR INT BEFORE ROUNDING                                       CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
     C           NCD       IFGE MATY                                                          CSE035
     C           SYBS      ANDEQ'AU'                                                          CSE035
     C                     Z-ADDZPRCOT    ZPRCOT                                              CSE035
     C                     ELSE                                                               CSE035
     C           SYBS      IFNE 'AU'                                                          CSE035
     C           SYBS      ANDNE'DA'                                                          CSE035
     C           STBS      ANDEQ'Y'                                                           CSE035
     C           ZPRCOT    ADD  ZWAMT     ZPRCOT                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
     C           NCD       IFGE MATY                                                          CSE035
     C           SYBS      ANDEQ'AU'                                                          CSE035
     C                     ELSE                                                               CSE035
      *                                                                                       CSE035
     C           SYBS      IFNE 'AU'                                                          CSE035
     C           SYBS      ANDNE'DA'                                                          CSE035
     C           STBS      ANDEQ'Y'                                                           CSE035
     C           ZPRCOT    SUB  PURINT    ZPRCOT                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     Z-ADDZNOMLS    ZNOML                           E39495
     C*                                                                   E39495
     C                     ELSE                                           S01176
     C                     Z-ADD*ZEROS    ZPRCOT                          S01176
     C                     END                                            S01176
     C                     Z-ADDZPRCOT    WMPRIC 158                      S01176
     C* ** ELSE **                                                        S01176
     C                     ELSE                                           S01176
     C*                                                                   S01176
     C* Access Price file for Security and Type 'V' for Price             S01176
     C*  - if not found, use Market Price from Security                   S01176
     C*                                                                   S01176
     C                     MOVE 'V '      PTYP                            S01176
     C**********           MOVE *ZEROS    PCST                                         S01176 CSD027
     C                     MOVE *BLANKS   PCST                                                CSD027
     C                     Z-ADD0         PDAT                            S01176
     C           KEYPT     SETLLPRICT                                     S01176
     C           KEYPTP    READEPRICT                    99               S01176
     C           *IN99     IFEQ '1'                                       S01176
     C           RECI      ORNE 'D'                                       S01176
     C***********          MOVE MKPR      ZPRICE                   S01176 E21243
     C                     Z-ADDMKPR      MKPRSV                          E21243
     C                     Z-ADDMKPR      ZPRCIN                          E21243
     C                     ELSE                                           S01176
     C***********          MOVE PPRC      ZPRICE 158               S01176 E21243
     C                     Z-ADDPPRC      ZPRCIN                          E21243
     C                     Z-ADDPPRC      MKPRSV                          E21243
     C                     END                                            S01176
     C*                                                                   S01176
     C                     Z-ADDRUND      ZFDATE                          S01176
     C***********ZPRICE    IFNE *ZEROS                             S01176 E21243
     C           ZPRCIN    IFNE *ZEROS                                    E21243
     C***********          EXSR ZPRCO                              S01176 E21243
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0230CCP8                                           S01408
     C*                                                                   S01408
      *                                                                                       CSE035
      ** ADJUST PRICE : PRICE + PUR INT BEFORE ROUNDING                                       CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
     C                     EXSR ZPRCI                                                         CSE035
      *                                                                                       CSE035
     C           NCD       IFGE MATY                                                          CSE035
     C           SYBS      ANDEQ'AU'                                                          CSE035
     C                     Z-ADDZPRCOT    ZPRCOT                                              CSE035
     C                     ELSE                                                               CSE035
     C           SYBS      IFNE 'AU'                                                          CSE035
     C           SYBS      ANDNE'DA'                                                          CSE035
     C           STBS      ANDEQ'Y'                                                           CSE035
     C           ZPRCOT    ADD  ZWAMT     ZPRCOT                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
     C           NCD       IFGE MATY                                                          CSE035
     C           SYBS      ANDEQ'AU'                                                          CSE035
     C                     ELSE                                                               CSE035
      *                                                                                       CSE035
     C           SYBS      IFNE 'AU'                                                          CSE035
     C           SYBS      ANDNE'DA'                                                          CSE035
     C           STBS      ANDEQ'Y'                                                           CSE035
     C           ZPRCOT    SUB  PURINT    ZPRCOT                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C*                                                                   E39495
     C**  SET UP INPUT PARAMETER TO ZCALCD                                E39495
     C**                                                                  E39495
     C                     Z-ADDZNOML     ZNOMLS 150                      E39495
     C           ZNOML     IFLT 0                                         E39495
     C                     Z-SUBZNOML     ZNOML                           E39495
     C                     END                                            E39495
     C                     EXSR ZPRCI                                     E21243
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0230CCP9                                           S01408
     C*                                                                   S01408
     C                     Z-ADDZNOMLS    ZNOML                           E39495
     C*                                                                   E39495
     C                     ELSE                                           S01176
     C                     Z-ADD*ZEROS    ZPRCOT                          S01176
     C                     END                                            S01176
     C***********          Z-ADDZPRCOT    MKPRSV                   S01176 E20084
     C***********          Z-ADDZPRCOT    MKPRSV                   E20084 E21243
     C*                                                                   S01176
     C** SAVE PRICE FOR MARKET VALUE  CALCULATION                         S01176
     C*                                                                   S01176
     C                     Z-ADDZPRCOT    WMPRIC                          S01176
     C*                                                                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C           CSE109    IFEQ 'N'                                                           CSE109
     C                     Z-ADD8         ZDECS   10                      S01176
     C                     MOVE 'L'       ZECODE                          S01176
     C                     MOVE MKPRSV    ZFLD15                          S01176
     C                     ELSE                                                               CSE109
     C                     Z-ADD5         ZDECS   10                                          CSE109
     C                     MOVE 'L'       ZECODE                                              CSE109
     C                     Z-ADDMKPRSV    WRK5DC 115                                          CSE109
     C                     MOVE WRK5DC    ZFLD15                                              CSE109
     C                     ENDIF                                                              CSE109
      *                                                                                       CSE109
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT21    SMKPR                           S01176
     C           SPBS      IFEQ 'P'                                       S01176
     C                     MOVE '%'       SP2                             S01176
     C                     ELSE                                           S01176
     C                     MOVE ' '       SP2                             S01176
     C                     END                                            S01176
      *                                                                                       CSE109
     C           CSE109    IFEQ 'Y'                                                           CSE109
     C                     MOVE SMKPR     SMKPR5                                              CSE109
     C                     MOVE SP2       SP25                                                CSE109
     C                     ENDIF                                                              CSE109
     C**
     C*****Format*market*value*****************************************   E22564
     C***********          Z-ADD*ZEROS    WMVAL  150                      E22564
     C***********          Z-ADD*ZEROS    WMVAL0 150                      E22564
     C***********          Z-ADD*ZEROS    WMVAL1 151                      E22564
     C***********          Z-ADD*ZEROS    WMVAL2 152                      E22564
     C***********          Z-ADD*ZEROS    WMVAL3 153                      E22564
     C***********          MOVEA'0000'    *IN,55                          E22564
     C***********55        ADD  CDP       J       20                      E22564
     C***********          MOVEA'1'       *IN,J                           E22564
     C***********                                                         E22564
     C***Calculate*consideration/reallowance/charges/commission********   E22564
     C***55******ZZNOML    MULT WMPRIC    WMVAL0    H                     E22564
     C***56******ZZNOML    MULT WMPRIC    WMVAL1    H                     E22564
     C***57******ZZNOML    MULT WMPRIC    WMVAL2    H                     E22564
     C***58******ZZNOML    MULT WMPRIC    WMVAL3    H                     E22564
     C***********                                                         E22564
     C**Price*basis*-*divide*by*100************************************   E22564
     C***********SPBS      IFEQ 'P'                                       E22564
     C***55******          DIV  100       WMVAL0                          E22564
     C***56******          DIV  100       WMVAL1                          E22564
     C***57******          DIV  100       WMVAL2                          E22564
     C***58******          DIV  100       WMVAL3                          E22564
     C***********          END                                            E22564
     C***********                                                         E22564
     C***55******          MOVE WMVAL0    WMVAL                           E22564
     C***56******          MOVE WMVAL1    WMVAL                           E22564
     C***57******          MOVE WMVAL2    WMVAL                           E22564
     C***58******          MOVE WMVAL3    WMVAL                           E22564
     C***********                                                         E22564
     C****Allow*for*nominal*decimal*places*****************************   E22564
     C***********5         SUB  NMDP      DC      10                      E22564
     C***********WMVAL     MULT POWER8,DC MVAL   150                      E22564
     C***********                                                         E22564
     C***********ZZNOML    MULT MKPR      MVAL   152                      E22564
     C**CONVERT*MARKET*VALUE*TO*NOMINAL*CURRENCY*DECIMAL**PLACES*******   E22564
     C***********CDP       SUB  NMDP      XLI     10                      E22564
     C***********XLI       ADD  5         XLI                             E22564
     C***********MVAL      MULT POWER8,XLIMVAL      H                     E22564
     C***********                                                         E22564
     C***********SPBS      IFEQ 'P'                                       E22564
     C***********MVAL      DIV  100       MVAL      H                     E22564
     C***********          END                                            E22564
     C**                                                                  E22564
     C** Calculate and format market value                                E22564
     C**                                                                  E22564
     C***********          Z-ADDZNNOMP    ZNOML                    E22564 E28170
     C                     Z-ADDZZNOML    ZNOML                           E28170
     C                     Z-ADDWMPRIC    ZPRC                            E22564
     C                     Z-ADDNCDP      ZCDP                            S01117
     C                     EXSR ZCNSD                                     E22564
     C*                                                                   054259
     C           PROT      IFEQ '8'                                       054259
     C/COPY WNCPYSRC,SE0230C008
     C                     MULT CURF      ZCONS     H                     054259
     C                     END                                            054259
     C/COPY WNCPYSRC,SE0230C005
     C*                                                                   054259
     C                     Z-ADDZCONS     ZFLD15                          E22564
     C***********          Z-ADDCDP       ZDECS   10                      S01117
     C                     Z-ADDA6NBDP    ZDECS   10                      S01117
     C                     MOVE 'L'       ZECODE
     C***********          Z-ADDMVAL      ZFLD15                          E22564
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SMVAL
     C           CSE109    IFEQ 'Y'                                                           CSE109
     C                     MOVE SMVAL     SMVAL5                                              CSE109
     C                     ENDIF                                                              CSE109
      ** End for Else SFLT = 1                                                                CSE109
     C                     ENDIF                                                              CSE109
     C**
     C           MKPRSV    IFNE 0                                                             CSE109
     C           CSE109    IFEQ 'Y'                                                           CSE109
     C           ZCONS     SUB  BKPRSV    ZFLD15                                              CSE109
     C                     EXSR ZSEDIT                                                        CSE109
     C                     MOVE ZOUT21    SUNRL4                                              CSE109
     C                     ELSE                                                               CSE109
     C                     MOVE *BLANKS   SUNRL4                                              CSE109
     C                     END                                                                CSE109
      *                                                                                       CSE109
     C                     END                                                                CSE109
     C           SFLT      IFEQ 1
     C           CSE109    ANDEQ'Y'                                                           CSE109
     C                     MOVE LIN4      SLINX                                               CSE109
     C                     ELSE                                                               CSE109
      *                                                                                       CSE109
     C           CSE109    IFEQ 'Y'                                                           CSE109
     C                     MOVE LIN5      SLINX                                               CSE109
     C                     ELSE                                                               CSE109
     C                     MOVE LIN2      SLINE
     C                     ENDIF                                                              CSE109
     C                     END
     C                     ENDIF                                                              CSE109
     C**
     C**  SFLT=3 REPOS LINE
     C**
     C           SFLT      IFEQ 3
     C                     SETON                     08
     C**
     C**   Edit nominal
     C**
     C                     Z-ADDNMDP      ZDECS   10
     C                     MOVE 'L'       ZECODE
     C                     Z-ADDZRNOML    ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SRNOM
     C                     MOVE '('       SB1
     C                     MOVE ')'       SB2
     C**
     C                     MOVE LIN3      SLINE
     C                     END
      *                                                                                       CSE109
      ** If Historic Data requested only output records with                                  CSE109
      ** NOMINAL POSITION EQUAL ZERO                                                          CSE109
      *                                                                                       CSE109
     C           CSE109    IFEQ 'Y'                                                           CSE109
     C           HISACT    IFEQ 'H'                                                           CSE109
     C           ZZNOML    ANDNE*ZEROS                                                        CSE109
     C                     GOTO ENDTAG                                                        CSE109
     C                     ENDIF                                                              CSE109
      *                                                                                       CSE109
      ** If Active Data requested only output records with                                    CSE109
      **   NOMINAL POSITION NOT EQUAL ZERO                                                    CSE109
      *                                                                                       CSE109
     C           HISACT    IFEQ 'A'                                                           CSE109
     C           ZZNOML    ANDEQ*ZEROS                                                        CSE109
     C                     GOTO ENDTAG                                                        CSE109
     C                     ENDIF                                                              CSE109
     C                     ENDIF                                                              CSE109
     C**
     C**   And output details to subfile
     C**
     C                     ADD  1         SFLREC
     C                     ADD  1         OUTREC  20
     C           CSE109    IFEQ 'Y'                                                           CSE109
     C                     WRITESE0230S1                                                      CSE109
     C                     ELSE                                                               CSE109
     C                     WRITESE0230S0
     C                     ENDIF                                                              CSE109
     C**
     C**********           ENDSR                                                              CSE109
     C           ENDTAG    ENDSR                                                              CSE109
     C**
     C****************************************************************    S01176
      /EJECT                                                              S01176
     C****************************************************************    S01176
     C**                                                             *    S01176
     C**   SUBROUTINE - YPRICE                                       *    S01176
     C**   FUNCTION   - CALCULATES YIELD PRICE                       *    S01176
     C**                                                             *    S01176
     C**   CALLED BY  - SUBFIL                                       *    S01176
     C**   CALLS      - ZYMTX                                        *    S01176
     C**                                                             *    S01176
     C****************************************************************    S01176
     C**                                                                  S01176
     C           YPRICE    BEGSR                                          S01176
     C*                                                                   S01176
     C** LOAD ARRAY OF NO. OF DAYS TO MATURITY USING VALUES ON            S01176
     C** RECORD READ FROM LF/CPPRIC                                       S01176
     C*                                                                   S01176
     C                     MOVE ND01      ZND,1                           S01176
     C                     MOVE ND02      ZND,2                           S01176
     C                     MOVE ND03      ZND,3                           S01176
     C                     MOVE ND04      ZND,4                           S01176
     C                     MOVE ND05      ZND,5                           S01176
     C                     MOVE ND06      ZND,6                           S01176
     C                     MOVE ND07      ZND,7                           S01176
     C                     MOVE ND08      ZND,8                           S01176
     C                     MOVE ND09      ZND,9                           S01176
     C                     MOVE ND10      ZND,10                          S01176
     C                     MOVE ND11      ZND,11                          S01176
     C                     MOVE ND12      ZND,12                          S01176
     C                     MOVE ND13      ZND,13                          S01176
     C                     MOVE ND14      ZND,14                          S01176
     C                     MOVE ND15      ZND,15                          S01176
     C                     MOVE ND16      ZND,16                          S01176
     C                     MOVE ND17      ZND,17                          S01176
     C                     MOVE ND18      ZND,18                          S01176
     C                     MOVE ND19      ZND,19                          S01176
     C                     MOVE ND20      ZND,20                          S01176
     C                     MOVE ND21      ZND,21                          S01176
     C                     MOVE ND22      ZND,22                          S01176
     C                     MOVE ND23      ZND,23                          S01176
     C                     MOVE ND24      ZND,24                          S01176
     C                     MOVE ND25      ZND,25                          S01176
     C*                                                                   S01176
     C** LOAD ARRAY OF CORRESPONDING YIELD RATES AS DEFINED ON THE        S01176
     C** RECORD READ FROM LF/CPPRIC                                       S01176
     C*                                                                   S01176
     C                     MOVE YR01      ZRT,1                           S01176
     C                     MOVE YR02      ZRT,2                           S01176
     C                     MOVE YR03      ZRT,3                           S01176
     C                     MOVE YR04      ZRT,4                           S01176
     C                     MOVE YR05      ZRT,5                           S01176
     C                     MOVE YR06      ZRT,6                           S01176
     C                     MOVE YR07      ZRT,7                           S01176
     C                     MOVE YR08      ZRT,8                           S01176
     C                     MOVE YR09      ZRT,9                           S01176
     C                     MOVE YR10      ZRT,10                          S01176
     C                     MOVE YR11      ZRT,11                          S01176
     C                     MOVE YR12      ZRT,12                          S01176
     C                     MOVE YR13      ZRT,13                          S01176
     C                     MOVE YR14      ZRT,14                          S01176
     C                     MOVE YR15      ZRT,15                          S01176
     C                     MOVE YR16      ZRT,16                          S01176
     C                     MOVE YR17      ZRT,17                          S01176
     C                     MOVE YR18      ZRT,18                          S01176
     C                     MOVE YR19      ZRT,19                          S01176
     C                     MOVE YR20      ZRT,20                          S01176
     C                     MOVE YR21      ZRT,21                          S01176
     C                     MOVE YR22      ZRT,22                          S01176
     C                     MOVE YR23      ZRT,23                          S01176
     C                     MOVE YR24      ZRT,24                          S01176
     C                     MOVE YR25      ZRT,25                          S01176
     C/COPY WNCPYSRC,SE0230C009
     C*                                                                   S01176
     C                     Z-ADDRUND      ZBASD                           S01176
     C                     Z-ADDMATY      ZMDAT                           S01176
     C                     EXSR ZYMTX                                     S01176
     C                     Z-ADDZY1       YPROP  158                      S01176
     C*                                                                   S01176
     C                     ENDSR                                          S01176
     C*                                                                   S01176
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C**                                                              *
     C**   LINK   SR  Lower level Enquiry requested                   *
     C**                                                              *
     C**   Called by  MAIN                                            *
     C**   Calls  SR  none                                            *
     C**   Calls PGM  lower level enquiry obtained from SECOND        *
     C**                                                              *
     C*****************************************************************
     C**
     C           LINK      BEGSR                           *** LINK ******
     C**
     C**   Access Linked Enquiry Control File for program and option
     C**
     C           LKEY      KLIST
     C                     KFLD           PGMNO
     C                     KFLD           OPTN
     C**
     C           LKEY      CHAINSECONDF              42
     C**
     C**   If record not found then entered option is invalid
     C**
     C           *IN42     IFEQ '1'
     C                     MOVE MSG,4     ERMSG
     C**
     C                     ELSE
     C**
     C**   For valid option write out LDA and linked enquiry data area
     C**   and call the program name obtained from SECOND
     C**
     C                     OUT  SESDS
     C                     OUT  LDA
     C                     CALL TPGM
     C           *LOCK     IN   LDA
     C           *LOCK     IN   SESDS
     C**
     C**   On return from lower level check return code
     C**
     C**   If 0 (Database Error) or 1 (F3 to return to menu)
     C**      then exit to calling program
     C**
     C           RTNC      IFEQ '0'
     C           RTNC      OREQ '1'
     C                     MOVE '1'       *IN01
     C                     END
     C**
     C**   If Return code is 7 (F9 to return to inital enquiry)
     C**      then check if this is the inital enquiry
     C**      and if not return to calling program
     C**
     C           RTNC      IFEQ '7'
     C           ORIG      ANDNEPGMNO
     C                     MOVE '1'       *IN01
     C                     END
     C**
     C                     END
     C**
     C                     ENDSR
     C**
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C**                                                              *
     C**   RETSR  SR  End of Program Processing                       *
     C**              Write out LDA and linked enquiry data area      *
     C**              and return to the calling program               *
     C**                                                              *
     C**   Called by  MAIN, FIRST, DISP                               *
     C**   Calls  SR  none                                            *
     C**                                                              *
     C*****************************************************************
     C**
     C           RETSR     BEGSR                           *** RETSR   ***
     C**
     C                     MOVE '  '      RQBOOK                          E22542
     C                     OUT  SESDS
     C                     OUT  LDA
     C**
     C                     SETON                     LR
     C**
     C                     RETRN
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C**                                                              *
     C**   FIRST  SR  First Cycle Processing                          *
     C**                                                              *
     C**   Called by  MAIN                                            *
     C*****Calls**SR**RETSR,*CUSTIN,*ZSYSTM,*ZICD2,*ZICDSE*           *   S01117
     C**   Calls  SR  RETSR, CUSTIN                                   *   S01117
     C**                                                              *
     C*****************************************************************
     C**
     C           FIRST     BEGSR                           ** FIRST **
     C**
     C**     Access the LDA  and  Linked Enquiry Data Area
     C**
     C           *LOCK     IN   LDA
     C           *LOCK     IN   SESDS
     C           *LOCK     IN   JNSTAT
     C                     UNLCKJNSTAT
     C***********                                                         S01117
     C*******Access*the*ICD*record*1*for*run*date*&*date*format********   S01117
     C***********                                                         S01117
     C***********          EXSR ZSYSTM                                    S01117
     C***********                                                         S01117
     C**Error*in*ZSYSTM************************************************   S01117
     C***********                                                         S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          MOVELPROGRM    DBPGM                           S01117
     C***********          MOVEL'ICDR1'   DBKEY            ***************S01117
     C***********          MOVE 'TABLE'   DBFILE           * DB ERROR 01 *S01117
     C***********          Z-ADD01        DBASE            ***************S01117
     C***********          SETON                       U7U8               S01117
     C***********          MOVE '0'       RTNC                            S01117
     C***********          EXSR RETSR                                     S01117
     C***********          END                                            S01117
     C***********          MOVE *BLANKS   RTNC                            S01117
     C***********                                                         S01117
     C*******Access*the*ICD*record*2***********************************   S01117
     C***********                                                         S01117
     C***********          EXSR ZICD2                                     S01117
     C***********                                                         S01117
     C**Error*in*ZICD2*************************************************   S01117
     C***********                                                         S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          MOVELPROGRM    DBPGM                           S01117
     C***********          MOVEL'ICDR2'   DBKEY            ***************S01117
     C***********          MOVE 'TABLE'   DBFILE           * DB ERROR 02 *S01117
     C***********          Z-ADD02        DBASE            ***************S01117
     C***********          SETON                       U7U8               S01117
     C***********          MOVE '0'       RTNC                            S01117
     C***********          EXSR RETSR                                     S01117
     C***********          END                                            S01117
      *                                                                   S01117
      ** Read in RUNDAT data area                                         S01117
      *                                                                   S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C                     IN   RUNDT                                     S01117
      *                                                                   S01117
      ** Check system date format, DDMMYY or MMDDYY.                      S01117
      *                                                                   S01117
     C           DATF      COMP 'M'                      98               S01117
      *                                                                   S01117
      ** Read in ZMUSER data area                                         S01117
      *                                                                   S01117
     C           *NAMVAR   DEFN           ZMUSER                          S01117
     C                     IN   ZMUSER                                    S01117
     C/COPY WNCPYSRC,SE0230C001
      *                                                                   S01117
      ** Access bank details                                              S01117
      *                                                                   S01117
     C                     CALL 'AOBANKR0'                                S01117
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C           SDBANK    PARM SDBANK    DSFDY                           S01117
      *                                                                   S01117
      ** Access General Ledger details                                    S01117
      *                                                                   S01117
     C**********           CALL 'AOGELRR0'                                S01117              CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C********** SDGELR    PARM SDGELR    DSFDY                           S01117              CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
      *                                                                   S01117
      ** Access Securities Trading details                                S01117
      *                                                                   S01117
     C                     CALL 'AOSTRDR0'                                S01117
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C           SDSTRD    PARM SDSTRD    DSSDY                           S01117
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0230CCP1                                           S01408
     C*                                                                   S01408
      *                                                                                       CSE075
      ** Access SAR details file to see if Enhanced Treasury switchable                       CSE075
      ** feature is installed.                                                                CSE075
      *                                                                                       CSE075
     C                     CALL 'AOSARDR0'                                                    CSE075
     C                     PARM '       ' PRTCD                                               CSE075
     C                     PARM '*VERIFY' POPTN                                               CSE075
     C                     PARM 'CSE075'  PSARD                                               CSE075
     C           SCSARD    PARM SCSARD    DSFDY                                               CSE075
      *                                                                                       CSE075
     C           PRTCD     IFEQ *BLANK                                                        CSE075
     C                     MOVE 'Y'       CSE075  1                                           CSE075
     C                     ENDIF                                                              CSE075
      *                                                                                       CSE075
     C**
     C**     Determine if Multibranch (set *in07 on if so)
     C**
     C           MBIN      IFEQ 'Y'
     C                     SETON                     07
     C                     ELSE
     C                     SETOF                     07
     C                     END
      *                                                                                       CSE035
      ** Access SAR details file to see if CSE035 is installed                                CSE035
      *                                                                                       CSE035
     C                     CALL 'AOSARDR0'                                                    CSE035
     C                     PARM *BLANKS   @RTCD                                               CSE035
     C                     PARM '*VERIFY' @OPTN                                               CSE035
     C                     PARM 'CSE035'  WSARD   6                                           CSE035
      *                                                                                       CSE035
     C           @RTCD     IFEQ *BLANK                                                        CSE035
     C                     MOVE 'Y'       CSE035  1                                           CSE035
     C                     ELSE                                                               CSE035
     C                     MOVE 'N'       CSE035                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       207543
      ** Access SAR details file to see if CEU018 is installed                                207543
      *                                                                                       207543
     C                     CALL 'AOSARDR0'                                                    207543
     C                     PARM *BLANKS   @RTCD                                               207543
     C                     PARM '*VERIFY' @OPTN                                               207543
     C                     PARM 'CEU018'  WSARD                                               207543
      *                                                                                       207543
     C           @RTCD     IFEQ *BLANK                                                        207543
     C                     MOVE 'Y'       CEU018  1                                           207543
     C                     ELSE                                                               207543
     C                     MOVE 'N'       CEU018                                              207543
     C                     ENDIF                                                              207543
      *                                                                   CAC005
      ** Check if CAC005 - PCA-SE Enhancement is on.                      CAC005
      *                                                                   CAC005
     C                     MOVE 'N'       CAC005  1                       CAC005
     C                     MOVE *OFF      *IN30                           CAC005
     C                     CALL 'AOSARDR0'                                CAC005
     C                     PARM *BLANKS   @RTCD   7                       CAC005
     C                     PARM '*VERIFY' @OPTN   7                       CAC005
     C                     PARM 'CAC005'  @SARD   6                       CAC005
      *                                                                   CAC005
     C           @RTCD     IFEQ *BLANK                                    CAC005
     C                     MOVE 'Y'       CAC005                          CAC005
     C                     MOVE *ON       *IN30                           CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CSE010
      ** Check is CSE010 is installed                                     CSE010
      *                                                                   CSE010
     C                     MOVE 'N'       CSE010  1                       CSE010
     C                     CALL 'AOSARDR0'                                CSE010
     C                     PARM *BLANKS   PRTCD   7                       CSE010
     C                     PARM '*VERIFY' POPTN   7                       CSE010
     C                     PARM 'CSE010'  PSARD   6                       CSE010
      *                                                                   CSE010
     C           PRTCD     IFEQ *BLANK                                    CSE010
     C                     MOVE 'Y'       CSE010                          CSE010
     C                     ELSE                                           CSE010
      *                                                                   CSE010
      ** Database Error (return code other than *NRF)                     CSE010
      *                                                                   CSE010
     C           PRTCD     IFNE '*NRF   '                                 CSE010
     C           *LOCK     IN   LDA                                       CSE010
     C                     MOVEL'SCSARDPD'DBFILE           ************   CSE010
     C                     MOVEL'*VERIFY' DBKEY            * DBERR  7 *   CSE010
     C                     Z-ADD7         DBASE            ************   CSE010
     C                     OUT  LDA                                       CSE010
     C                     MOVE *ON       *INU7                           CSE010
     C                     MOVE *ON       *INU8                           CSE010
     C                     MOVE *ON       *INLR                           CSE010
     C                     EXSR *PSSR                                     CSE010
     C                     ENDIF                                          CSE010
     C                     ENDIF                                          CSE010
      *                                                                   CSE006
      ** Check if CSE006 is on                                            CSE006
      *                                                                   CSE006
     C                     MOVE 'N'       CSE006  1                       CSE006
     C                     CALL 'AOSARDR0'                                CSE006
     C                     PARM *BLANKS   @RTCD   7                       CSE006
     C                     PARM '*VERIFY' @OPTN   7                       CSE006
     C                     PARM 'CSE006'  @SARD   6                       CSE006
      *                                                                   CSE006
     C           @RTCD     IFEQ *BLANK                                    CSE006
     C                     MOVE 'Y'       CSE006                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                                       CSE109
      ** Check if CSE109 is on                                                                CSE109
      *                                                                                       CSE109
     C                     MOVE 'N'       CSE109  1                                           CSE109
     C                     MOVE '0'       *IN26   1                                           CSE109
     C                     CALL 'AOSARDR0'                                                    CSE109
     C                     PARM *BLANKS   @RTCD                                               CSE109
     C                     PARM '*VERIFY' @OPTN                                               CSE109
     C                     PARM 'CSE109'  @SARD                                               CSE109
      *                                                                                       CSE109
     C           @RTCD     IFEQ *BLANK                                                        CSE109
     C                     MOVE 'Y'       CSE109                                              CSE109
     C                     MOVE '1'       *IN26                                               CSE109
     C                     ENDIF                                                              CSE109
      *                                                                                     MD053052
     C           CSE109    IFEQ 'Y'                                                         MD053052
     C                     MOVE 'A'       HISACT                                            MD053052
     C                     MOVE '1'       *IN49                                             MD053052
     C                     ENDIF                                                            MD053052
     C**
     C**     CALCULATE EVENT CONTROL DATE
     C**
     C                     Z-ADDBJDNWD    ZZDNWD                          S01117
     C                     Z-ADDBKAPDT    ZZAPDT                          S01117
     C                     EXSR ZEVCD
     C***********                                                         S01117
     C*******Access*the*ICD*record*SE*for*default*branch***************   S01117
     C***********                                                         S01117
     C***********          EXSR ZICDSE                                    S01117
     C***********                                                         S01117
     C**Error*in*ZICDSE************************************************   S01117
     C***********                                                         S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          MOVELPROGRM    DBPGM                           S01117
     C***********          MOVEL'ICDSE'   DBKEY            ***************S01117
     C***********          MOVE 'TABLE'   DBFILE           * DB ERROR 03 *S01117
     C***********          Z-ADD03        DBASE            ***************S01117
     C***********          SETON                       U7U8               S01117
     C***********          MOVE '0'       RTNC                            S01117
     C***********          EXSR RETSR                                     S01117
     C***********          END                                            S01117
     C**
     C**      Access program name - for help and linked enquiries
     C**
     C                     MOVELPROGRM    PGMNO   8
     C                     MOVELPROGRM    DBPGM
     C**
     C**     If no branch/book found in request data
     C**        clear screen fields
     C**        else - process from this data
     C**
     C                     EXSR CLEAR
     C           RQBOOK    IFNE *BLANKS
     C**
     C                     MOVELRQBOOK    BOOK
     C                     MOVE *BLANKS   RQBOOK
     C***********          MOVELRQBRCH    BRANCH                          S01117
     C***********          MOVE *BLANKS   RQBRCH                          S01117
     C                     MOVELRQBRCA    BRANCH                          S01117
     C                     MOVE *BLANKS   RQBRCA                          S01117
     C**
     C                     EXSR SECIN
     C                     END
     C**
     C/COPY WNCPYSRC,SE0230C010
     C                     ENDSR
     C*
      /EJECT                                                              S01117
      *****************************************************************   S01117
      *                                                               *   S01117
      * CHKSEL - Subroutine to check for question marks.              *   S01117
      *                                                               *   S01117
      * Called by: MAIN                                               *   S01117
      *                                                               *   S01117
      * Calls: None                                                   *   S01117
      *                                                               *   S01117
      *****************************************************************   S01117
      *                                                                   S01117
     C           CHKSEL    BEGSR                                          S01117
      *                                                                   S01117
     C                     Z-ADD0         @SEL    10                      S01117
      *                                                                   S01117
     C                     MOVELBRANCH    @QMK    1                       S01117
     C           @QMK      IFEQ '?'                                       S01117
     C                     Z-ADD1         @SEL                            S01117
      *                                                                   S01117
      ** Access branch details file SDBRCHPD via access object program    S01117
      *                                                                   S01117
     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM '?  '     @BRCD   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01117              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           @RTCD     IFEQ '*NOSEL'                                  S01117
     C                     MOVE *BLANK    BRANCH                          S01117
     C                     ELSE                                           S01117
     C                     MOVE A8BRCD    BRANCH                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     MOVELBOOK      @QMK    1                       S01117
     C           @QMK      IFEQ '?'                                       S01117
     C                     Z-ADD1         @SEL                            S01117
      *                                                                   S01117
      ** Access book details file SDBOOKPD via access object program      S01117
      *                                                                   S01117
     C                     CALL 'AOBOOKR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM '? '      @BKCD   2                       S01117
     C           SDBOOK    PARM SDBOOK    DSFDY                           S01117
     C           @RTCD     IFEQ '*NOSEL'                                  S01117
     C                     MOVE *BLANK    BOOK                            S01117
     C                     ELSE                                           S01117
     C                     MOVE BDBKCD    BOOK                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C/COPY WNCPYSRC,SE0230C002
      *                                                                   CSE010
      ** If CSE010 is installed, and a '?' is found anywhere in the       CSE010
      ** Security Shortname field                                         CSE010
      *                                                                   CSE010
     C           CSE010    IFEQ 'Y'                                       CSE010
     C                     MOVELNAME      WQMK    1                       CSE010
     C           WQMK      IFEQ '?'                                       CSE010
     C                     MOVE '1'       @SEL                            CSE010
     C                     MOVE NAME      @SESN                           CSE010
     C                     CALL 'SE0043'                                  CSE010
     C                     PARM           @ACTN   1                       CSE010
     C                     PARM           @SESN  10                       CSE010
      *                                                                   CSE010
     C           @SESN     IFNE *BLANKS                                   CSE010
     C                     MOVE @SESN     NAME                            CSE010
     C                     ELSE                                           CSE010
     C                     MOVE *BLANKS   NAME                            CSE010
     C                     ENDIF                                          CSE010
     C                     ENDIF                                          CSE010
     C                     ENDIF                                          CSE010
      *                                                                   S01117
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVELPROCEN    @QMK                            CAC005
      *                                                                   CAC005
      ** If PROCEN is '?' Access SDPRFCPD via AOPRFCR0 for Profit         CAC005
      ** Centre selection                                                 CAC005
      *                                                                   CAC005
     C           @QMK      IFEQ '?'                                       CAC005
     C                     Z-ADD1         @SEL                            CAC005
     C                     CALL 'AOPRFCR0'                                CAC005
     C                     PARM *BLANKS   @RTCD   7                       CAC005
     C                     PARM '*KEY   ' @OPTN   7                       CAC005
     C                     PARM '?'       @PCCD   4                       CAC005
     C           SDPRFC    PARM SDPRFC    DSFDY                           CAC005
      *                                                                   CAC005
     C           @RTCD     IFEQ '*NOSEL'                                  CAC005
     C                     MOVE *BLANKS   PROCEN                          CAC005
     C                     ELSE                                           CAC005
     C                     MOVE DSPCCD    PROCEN                          CAC005
     C                     ENDIF                                          CAC005
     C                     ENDIF                                          CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C                     ENDSR                                          S01117
      *                                                                   CAC005
      *****************************************************************   CAC005
      *                                                               *   CAC005
      * SRPBVL  - Book and Profit Centre Validation Subroutine        *   CAC005
      *                                                               *   CAC005
      * Called by: SECIN subroutine                                   *   CAC005
      *                                                               *   CAC005
      * Calls:                                                        *   CAC005
      * AOBOOKR0 - Access Program for book details                    *   CAC005
      * AOPRFCR0 - Access Program for profit centre details           *   CAC005
      * AOBKPCR0 - Access Program for book-profit centre combination  *   CAC005
      *                                                               *   CAC005
      *****************************************************************   CAC005
      *                                                                   CAC005
     C           SRPBVL    BEGSR                                          CAC005
      *                                                                   CAC005
     C           BOOK      IFEQ *BLANKS                                   CAC005
     C           PROCEN    ANDEQ*BLANKS                                   CAC005
     C                     MOVE *ON       *IN42                           CAC005
     C                     MOVE *ON       *IN44                           CAC005
     C                     MOVE MSG,21    ERMSG                           CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
      ** Check if combination of book and profit centre exists.           CAC005
      *                                                                   CAC005
     C           BOOK      IFNE *BLANKS                                   CAC005
     C           PROCEN    ANDNE*BLANKS                                   CAC005
     C                     CALL 'AOBKPCR0'                                CAC005
     C                     PARM           PRTCD   7                       CAC005
     C                     PARM '*PSEUDO' POPTN   7                       CAC005
     C           PMBKCD    PARM BOOK      PMBKCD  2                       CAC005
     C           PMPRFC    PARM PROCEN    PMPRFC  4                       CAC005
     C                     PARM *BLANKS   PMPSBK  2                       CAC005
      *                                                                   CAC005
     C           PRTCD     IFNE *BLANKS                                   CAC005
     C                     MOVE *ON       *IN42                           CAC005
     C                     MOVE *ON       *IN44                           CAC005
     C                     MOVE *ON       *IN48                           CAC005
     C                     MOVE MSG,22    ERMSG                           CAC005
     C                     ENDIF                                          CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C           BOOK      IFNE *BLANKS                                   CAC005
     C                     CALL 'AOBOOKR0'                                CAC005
     C                     PARM *BLANKS   @RTCD   7                       CAC005
     C                     PARM '*KEY   ' @OPTN   7                       CAC005
     C                     PARM BOOK      @BKCD   2                       CAC005
     C           SDBOOK    PARM SDBOOK    DSFDY                           CAC005
      *                                                                   CAC005
     C           @RTCD     IFNE *BLANKS                                   CAC005
     C                     MOVE *ON       *IN42                           CAC005
     C                     MOVE *ON       *IN44                           CAC005
     C                     MOVE MSG,10    ERMSG                           CAC005
     C                     ELSE                                           CSE006
     C           CSE006    IFEQ 'Y'                                       CSE006
     C           BDBYSL    ANDEQ'Y'                                       CSE006
     C                     MOVE *ON       *IN42                           CSE006
     C                     MOVE *ON       *IN44                           CSE006
     C                     MOVE MSG,24    ERMSG                           CSE006
     C                     ENDIF                                          CSE006
     C                     ENDIF                                          CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C           PROCEN    IFNE *BLANKS                                   CAC005
      *                                                                   CAC005
      ** Check If Profit Centre exists via access program AOPRFCR0        CAC005
      *                                                                   CAC005
     C                     CALL 'AOPRFCR0'                                CAC005
     C                     PARM *BLANKS   @RTCD   7                       CAC005
     C                     PARM '*KEY   ' @OPTN   7                       CAC005
     C                     PARM PROCEN    @PCCD   4                       CAC005
     C           SDPRFC    PARM SDPRFC    DSFDY                           CAC005
      *                                                                   CAC005
     C           @RTCD     IFNE *BLANKS                                   CAC005
     C                     MOVE *OFF      *IN44                           CAC005
     C                     MOVE *ON       *IN42                           CAC005
     C                     MOVE *ON       *IN48                           CAC005
     C                     MOVE MSG,23    ERMSG                           CAC005
     C                     ENDIF                                          CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C                     ENDSR                                          CAC005
      *                                                                   CAC005
      *****************************************************************   CAC005
      *                                                               *   CAC005
      * SRREAD  - Read files SEBKPCJ1 and SEBKPCJ2                    *   CAC005
      *                                                               *   CAC005
      * Called by: DISP Subroutine                                    *   CAC005
      *                                                               *   CAC005
      * Calls: None                                                   *   CAC005
      *                                                               *   CAC005
      *****************************************************************   CAC005
      *                                                                   CAC005
     C           SRREAD    BEGSR                                          CAC005
      *                                                                   CAC005
     C           BOKCHK    IFNE *BLANKS                                   CAC005
     C           PRFCHK    ANDNE*BLANKS                                   CAC005
     C                     READ UDEPB                    81               CAC005
     C                     MOVE PRFCHK    PSPRFC                          185786
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C           BOKCHK    IFNE *BLANKS                                   CAC005
     C           PRFCHK    ANDEQ*BLANKS                                   CAC005
     C                     READ SEBKPCJ1                 81               CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C           BOKCHK    IFEQ *BLANKS                                   CAC005
     C           PRFCHK    ANDNE*BLANKS                                   CAC005
     C                     READ SEBKPCJ2                 81               CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C                     ENDSR                                          CAC005
      *                                                                   CAC005
      *****************************************************************   CAC005
      *                                                               *   CAC005
      * SRSKIP  - Skips the record if change in branch encountered.   *   CAC005
      *                                                               *   CAC005
      * Called by: DISP Subroutine                                    *   CAC005
      *                                                               *   CAC005
      * Calls: None                                                   *   CAC005
      *                                                               *   CAC005
      *****************************************************************   CAC005
      *                                                                   CAC005
     C           SRSKIP    BEGSR                                          CAC005
      *                                                                   CAC005
     C           BRCCHK    IFNE UDBA                                      CAC005
     C           WNAME     ANDEQ*BLANKS                                   CAC005
     C           BRCCHK    DOWNEUDBA                                      CAC005
     C           *IN81     ANDEQ*OFF                                      CAC005
     C                     EXSR SRREAD                                    CAC005
     C                     ENDDO                                          CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C           WNAME     IFNE *BLANKS                                   CAC005
     C           WNAME     DOWNEUDSN                                      CAC005
     C           *IN81     ANDEQ*OFF                                      CAC005
     C                     EXSR SRREAD                                    CAC005
     C                     ENDDO                                          CAC005
      *                                                                   CAC005
     C           WNAME     IFEQ UDSN                                      CAC005
     C                     MOVE *BLANKS   WNAME                           CAC005
     C                     ENDIF                                          CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C                     ENDSR                                          CAC005
      *                                                                   CAC005
      *****************************************************************   S01117
      /EJECT                                                              S01117
      *****************************************************************   S01117
      *                                                               *   S01117
      *  *PSSR  - Error control subroutine                            *   S01117
      *                                                               *   S01117
      *****************************************************************   S01117
      *                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR **    S01117
     C**                                                                  S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     ENDSR                                          S01117
      *                                                                   S01117
      ********************************************************************S01117
      ***/EJECT**                                                   S01232S01195
     C***/COPY*ZSRSRC,XDATE3Z1                                      S01232S01195
      /EJECT                                                              S01195
     C/COPY ZSRSRC,ZACCH                                                  S01195
      /EJECT                                                              S01232
     C/COPY ZSRSRC,ZACCRZ1                                                S01232
      /EJECT                                                              S01232
     C/COPY ZSRSRC,ZACCZZ1                                                S01232
      /EJECT                                                              E22564
     C/COPY ZSRSRC,ZAVPRZ1                                                E22564
      /EJECT                                                              S01195
     C/COPY ZSRSRC,ZBKDT                                                  S01195
     C/EJECT                                                              E39495
     C/COPY ZSRSRC,ZCALCD                                                 E39495
      /EJECT                                                              E22564
     C/COPY ZSRSRC,ZCNSDZ1                                                E22564
      /EJECT
     C/COPY ZSRSRC,ZCONVZ1
      /EJECT
     C/COPY ZSRSRC,ZDATE1Z2
      /EJECT
     C/COPY ZSRSRC,ZDATE2Z4
      /EJECT
     C/COPY ZSRSRC,ZDAYSZ2
      /EJECT
     C***/COPY*ZSRSRC,ZDYYRZ3***                                          E13852
     C/COPY ZSRSRC,ZDYYRZ3                                                S01176
      /EJECT
     C/COPY ZSRSRC,ZEVCDZ1
      ***/EJECT**                                                         S01117
     C***/COPY*ZSRSRC,ZICD2Z1                                             S01117
      ***/EJECT**                                                         S01117
     C***/COPY*ZSRSRC,ZICDSEZ1                                            S01117
      /EJECT                                                              E20380
     C/COPY ZSRSRC,ZLCDZ1                                                 E20380
      /EJECT
     C***/COPY*ZSRSRC,ZNCDZ3***                                           E13852
     C/COPY ZSRSRC,ZNCDZ3                                                 S01176
      /EJECT                                                              S01176
     C/COPY ZSRSRC,ZPRCIZ1                                                S01176
      /EJECT
     C***/COPY*ZSRSRC,ZPRCOZ1***                                          E13852
     C/COPY ZSRSRC,ZPRCOZ1                                                S01176
      /EJECT                                                              S01232
     C/COPY ZSRSRC,ZRATEZ1                                                S01232
      /EJECT
     C/COPY ZSRSRC,ZSEDITZ3
      ***/EJECT**                                                         S01117
     C***/COPY*ZSRSRC,ZSYSTMZ1                                            S01117
      /EJECT                                                              S01232
     C/COPY ZSRSRC,ZYCEZ1                                                 S01232
      /EJECT                                                              S01176
     C/COPY ZSRSRC,ZYLDIZ1                                                S01176
      /EJECT
     C***/COPY*ZSRSRC,ZYLDOZ1***                                          E13852
     C/COPY ZSRSRC,ZYLDOZ1                                                S01176
      /EJECT
     C***/COPY ZSRSRC,ZYLDZ2***                                           E13852
     C/COPY ZSRSRC,ZYLDZ2                                                 S01176
      /EJECT                                                              S01176
     C/COPY ZSRSRC,ZYMTXZ2                                                S01176
      /EJECT
      ***
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   MSG  - ERROR MESSAGES
ENTER BOTH BRANCH AND BOOK
INVALID ENTRY - BOTH BRANCH, BOOK AND OPTION ENTERED
INVALID ENTRY - ONLY ONE OPTION MAY BE SELECTED
INVALID OPTION - TAKE OPTION 1(SECURITY DETAILS) OR 2(TRADES BY SECURITY)
ENTER A BOOK, OR SELECT AN OPTION
THIS IS THE INITIAL ENQUIRY - F/3 WILL EXIT TO MENU
ENTER A BRANCH AND BOOK, OR SELECT AN OPTION
INVALID ENTRY - BOTH BOOK AND OPTION ENTERED
INVALID BRANCH - PLEASE RE-ENTER
INVALID BOOK - PLEASE RE-ENTER
INVALID TRADE/VALUE POSITION - PLEASE RE-ENTER
INVALID MARKET - PLEASE RE-ENTER
ENTER A BOOK
USER NOT AUTHORISED TO BRANCH - PLEASE RE-ENTER
ENTER BOTH BRANCH/BOOK, BRANCH/PROF-CTR OR BRANCH/BOOK/PROF-CTR
ENTER A BOOK OR A PROFIT CENTRE
ENTER BRCH/BK, BRCH/PROF-CTR, BRCH/BK/PROF-CTR OR SELECT AN OPTION
ENTER A BOOK OR A PROFIT CENTRE OR SELECT AN OPTION
INVALID ENTRY - BOTH BRANCH, BOOK, PROFIT CENTRE AND OPTION ENTRED
INVALID ENTRY - BOTH BOOK, PROFIT CENTRE AND OPTION ENTRED
BOOK OR PROFIT CENTRE MUST NOT BE BLANK
BOOK AND PROFIT CENTRE COMBINATION DOES NOT EXISTS - PLEASE RE-ENTER
INVALID PROFIT CENTRE - PLEASE RE-ENTER
BUY-SELL BOOKS NOT PROCESSED BY THIS PROGRAM                                        CSE006
INVALID ENTRY - ENTER EITHER 'H', 'A', OR LEAVE BLANK                                         CSE109
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
0006001521029820444305904073650882610287117481320914670161311759219053
2051421975234362489726358278192928030741322023366335124365853804639507
40968424294389045351
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**  POWER8 - ARRAY OF POWERS FOR CURRENCY CONVERSION
00000001
00000010
00000100
00001000
00010000
00100000
01000000
10000000
**  CPY@
(c) Finastra International Limited 2001
