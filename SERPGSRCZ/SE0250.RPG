     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Trade details enquiry')                       *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Securities Trading Module                            *
     F*                                                               *
     F*  SE0250 - TRADES DETAILS ENQUIRY                              *
     F*                                                               *
     F*  Function:  This program displays full details of a selected  *
     F*   (I/C)     trade.                                            *
     F*                                                               *
     F*  Called By: SEC04 - CL Component to Control SE Enquiries      *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD058079           Date 11May21               *
      *  Prev Amend No. MD058285           Date 22Jun21               *
      *                 MD056812           Date 20Sep20               *
      *                 MD046248           Date 27Oct17               *
      *                 CSW210             Date 04May10               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 234300             Date 29Sep06               *
      *                 CSD031             Date 10Apr06               *
      *                 235184             Date 04Aug05               *
      *                 233964             Date 22Jun05               *
      *                 233776             Date 29May05               *
      *                 232543             Date 04Apr05               *
      *                 CGL031             Date 05Jul04               *
      *                 CSE071             Date 19Jul05               *
      *                 228105             Date 23Jun04               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3122            Date 17Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 222373             Date 23Oct03               *
      *                 CSE039             Date 14Mar03               *
      *                 CAS006             Date 21Jan03               *
      * Midas Release 4.01.03 ----------------------------------------*
      *                 211705             Date 07Jan03               *
      * Midas Release 4.01 -------------------------------------------*
      *                 195230             Date 10Jan02               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CSE028             Date 06Jun01               *
      *                 CSE022             Date 29Mar01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CPB002             Date 05Jan01               *
      *                 187888             Date 19Dec99               *
      * Midas DBA 3.02 -----------------------------------------------*
     F*                 CPB001             DATE 18Jun99               *
      *                 169456             Date 20Oct99               *
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CSE010             Date 22Jun99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CAC005             Date 10Nov98               *
      *                 CEU017             Date 11May98               *
      *                 CSE007             Date 09Feb98               *
     F*                 CEU005             DATE 03Feb98               *
     F*                 088336             Date 24Feb98               *
     F*                 CAC002             DATE 15SEP96               *
     F*                 105036             DATE 02AUG96               *
     F*                 101628             DATE 18JUL96               *
     F*                 084735             DATE 23MAY95               *
     F*                 S01486  MD         DATE 26OCT94               *
     F*                 S01496  JSV        DATE 07OCT94               *
     F*                 S01408             DATE 18MAY94               *
     F*                 052254             DATE 10JAN94               *
     F*                 S01401             DATE 16JUN93               *
     F*                 S01393             DATE 16SEP92               *
     F*                 S01397             DATE 10SEP92               *
     F*                 E43208             DATE 10SEP92               *
     F*                 E36244             DATE 24FEB92               *
     F*                 E32527             DATE 27NOV91               *
     F*                 S01117             DATE 30APR91               *
     F*                 E24773             DATE 30APR91               *
     F*                 E24561             DATE 12MAR91               *
     F*                 S01269             DATE 31OCT90               *
     F*                 S01271             DATE 31OCT90               *
     F*                 E21523             DATE 06APR90               *
     F*                 E20471             DATE 05DEC89               *
     F*                 E20088             DATE 03NOV89               *
     F*                 S01199             DATE 03/08/89              *
     F*                 E17428             DATE 17/04/89              *
     F*                 E16096             DATE 23/03/89              *
     F*                 S01179             DATE 21/10/88              *
     F*                 E14249             DATE 29/07/88              *
     F*                 S01176             DATE 25/07/88              *
     F*                 S01175             DATE 01/07/88              *
     F*                 E13543             DATE 08/06/88              *
     F*                 E13547             DATE 08/06/88              *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  MD058079 - Deliverable Data Split for sundry files           *
      *  MD058285 - Change base rate code to alphanumeric (Recompile) *
      *  MD056812  - Deliverable Data Split for SDSCODPD              *
      *  MD046248 - Finastra Rebranding                               *
      *  CSW210 - SWIFT 2010 Changes (Recompile)                      *
      *  234300 - Recompiled over changed in PF/HSTTRD.               *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  235184 - Dbase error due to file TRADSDZ3 does not exist. Fix*
      *           is to issue OVRDBF on TRADSDZ3.                     *
      *  233964 - EU tax decimal places problem.                      *
      *  233776 - Wrong fiscal price shown on enquiry screen and      *
      *           report                                              *
      *  232543 - Fix for CGL031                                      *
      *  CGL031 - Taxation of Savings Income                          *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  228105 - Trade credit risk and liquidity premium field was   *
      *           initilised with coupon credit risk and liquidity    *
      *           premium causing incorrect info in the enquiry.      *
      *           Initialise trade rate fields correctly.             *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3122 - Recompiled due to changes in SDSECSPD.             *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222373 - Parameter Mismatch                                  *
      *  CSE039 - Auto-Settlement of Trades                           *
      *           Add function key to access Movement Status Enquiry  *
      *  CAS006 - Hedge Accounting Phase B                            *
      *  211705 - Decimal Data Error occured in SETRADEDSP due to     *
      *           wrong value of TDVD.                                *
      *  195230 - Program recompiled over changes to display file.    *
      *  CSE028 - Standing Settlement Instructions Enhancement        *
      *  CSE022 - Depository Definition Enhancement                   *
     F*  CPB002 - Meridian DBA Middleware Replication Customization.  *
      *  187888 - Show Withholding Tax in Trades Confirmation and     *
      *           Trade Details Enquiry                               *
     F*  CPB001 - 'Private Banking' Module                            *
     F*  169456 - Recompile over changed file SE0250DF.               *
      *  CSE010 - SE Transactions Enhancements                        *
      *  CAC005 - PCA-SE Enhancement.                                 *
     F*  CEU017 - Securities Redenomination Euro Changes              *
     F*  CSE007 - Corporate Actions                                   *
     F*  CEU005 - EMU SE Settlement Ccy Conversion - insertion        *
     F*           of 'In' Ccy in field 72                             *
     F*  088336 - Do necessary file overrides before calling SE1805   *
     F*  CAC002 - Profit Centre Accounting Development - Phase 2      *
     F*           If Analytical Accounting is installed, replace      *
     F*           Profit Centre field with 2 new fields 'Book Profit  *
     F*           Centre' and 'Transaction Profit Centre'.  A new     *
     F*           'Margin' field will also be added.                  *
     F*  105036 - SHOW TRADE AS AUTHORISED EVEN WHEN SETTLED          *
     F*  101628 - When a trade is cancelled without being authorised, *
     F*           the trade doesn't show as cancelled the next day.   *
     F*           Should show as cancelled if RECI is 'L' or 'P' and  *
     F*           last change type is 'D' (deletion).                 *
     F*  084735 - Recompile over changed file SE50DT.                 *
     F*  S01486 - PORTOFOLIO MANAGEMENT AMENDMENT                     *
     F*  S01496 - Incorporation of JYSKE Enhancements (S10978)        *
     F*  S01408 - Core hook SE0250CVKS added                          *
     F*  052254 - CURRENT FACTOR amended from 9,8 to 10,9             *   S01393
     F*  S01401 - Produce SWIFT Messages MT5xxs, if option available. *
     F*  S01393 - When called as a restricted linked enquiry the      *
     F*           Trade Reference input is supressed together with    *
     F*           F5 and F9. Original functionality is fully          *
     F*           maintained for SE Enquiries.                        *
     F*  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
     F*          - Recompiled due to changes to files.                *
     F*  E43208 - Recompilaton needed due to changes in Display       *
     F*           File SE0250DF. (AIBD changed to ISMA).              *
     F*  E36244 - Status field needs to get blanked out in TRADIN     *
     F*  E32527 - Narrative 'SETTLED' does not appear on enquiry for  *
     F*           settled trades                                      *
     F*  S01117 - Multibranching                                      *
     F*  E24773 - Charges and commission amounts are being formatted  *
     F*           using settlement currency decimal places instead of *
     F*           nominal currency d p.                               *
     F*  E24561 - Recompiled over changed display file. If Autocharge *
     F*           is not licensed only charges 1 to 5 should be shown *
     F*  S01269 - Trades Authorisation - Recompiled to show           *
     F*           Authorisation message                               *
     F*  S01271 - Recompiled for Pay/Receive in Input Cycle changes   *
     F*           to TRADSD and/or DPTMVD                             *
     F*  E21523 - Problem with E16096 is that if record is on both    *   E21523
     F*           TRADSD and HSTTRD, it just reads the Trade on TRADS *   E21523
     F*           with RECI of '*' and lists it as cancelled. Should  *   E21523
     F*           check Historic Trades File before reading TRADSD.   *   E21523
     F*  E20471 - The Program did not terminate at DB Error 02.       *   E20471
     F*  E20088 - The Nominal Settled is wrong. The Decimal Position  *   E20088
     F*           of the Currency is used instead of the Nominal one. *   E20088
     F*  S01199 - Help System.                                        *   S01199
     F*  E17428 - Make Rolldown work.                                 *   E17428
     F*  E16096 - Access TRADHS instead of TRADS to include Historic  *   E16096
     F*           records.                                            *   E16096
     F*  S01179 - ****** AS400 CONVERSION ******                      *   S01179
     F*     The keyword RTGAID is no longer supported on the AS400    *   S01179
     F*     and command keys and indicators have been used to replace *   S01179
     F*     this in the display file. To disrupt the structure of the *   S01179
     F*     program as little as possible a new subroutine - ASCHGS - *   S01179
     F*     has been coded. This moves the values which would have    *   S01179
     F*     been passed to the program (via RTGAID) into the AID      *   S01179
     F*     field depending on which function key has been pressed.   *   S01179
     F*  E14249 - Display status as 'SETTLED'.                        *   E14249
     F*  S01176 - SECURITIES TRADING 3.1 (AUSTRALIA)                  *   S01176
     F*  S01175 - EUCLID                                              *   E13543
     F*  E13543 - Enquiries to be allowed on Cancelled Trades.        *   E13543
     F*  E13547 - Commission to be displayed edited according to CDP. *   E13547
     F*                                                               *
     F*****************************************************************
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
      *
     FSE0250DFCF  E                    WORKSTN      KINFDS SCRDS
     F***TRADS***IF**E***        K        DISK                            E16096
     F***TRADHS**IF**E***        K        DISK                     E16096 E21523
     FTRADS   IF  E           K        DISK                               E21523
     FHSTTTR  IF  E           K        DISK                               E21523
     FSECTY   IF  E           K        DISK
     F/COPY WNCPYSRC,SE0250F001
     F*TABSE***IF**E**         K        DISK                              S01117
     F************TABLETAF                          KIGNORE               S01117
     F************TABLETHF                          KIGNORE               S01117
     F*********** TABLETJF                          KIGNORE               S01117
     F************TABLETLF                          KIGNORE               S01117
     F************TABLETLF                          KIGNORE               S01117
     F************TABLETKF                          KIGNORE               S01117
     F************TABLETNF                          KIGNORE               S01117
     F************TABLETPF                          KIGNORE               S01117
     F************TABLETRF                          KIGNORE               S01117
     F************TABLETXF                          KIGNORE               S01117
     F**ICD*1*****TABTB10F                          KIGNORE
     F************TABTB10F                          KIGNORE               S01117
     F************TABTB11F                          KIGNORE               S01117
     F************TABTB36F                          KIGNORE               S01176
     F* ICD SE    TABTB36F                          KIGNORE               S01176
     F************TABTB36F                          KIGNORE               S01117
     F************TABTB40F                          KIGNORE               S01117
     F************TABTE10F                          KIGNORE               S01117
     F************TABTE20F                          KIGNORE               S01117
     F***CCY***   TABTG10F                          KIGNORE
     F************TABTG10F                          KIGNORE               S01117
     F************TABTG20F                          KIGNORE               S01117
     F************TABLET2F                          KIGNORE               S01117
     F************TABLET3F                          KIGNORE               S01117
     F************TABLET5F                          KIGNORE               S01117
     F*CLINT***IF**E***        K        DISK                              S01117
     F************CLINTCAF                          KIGNORE               S01117
     F************CLINTCCF                          KIGNORE               S01117
     F************CLINTC1F                          KIGNORE               S01117
     F************CLINTSEF                          KIGNORE               S01117
     FINVTO   IF  E           K        DISK
     F*SECOND**IF  E           K        DISK                                                MD058079
     FSEERALL2IF  E           K        DISK                           UC  S01496
     FSEDEVL8 IF  E           K        DISK                                                   CAS006
     FSEMVTSL2IF  E           K        DISK                                                   CSE039
      ** SE Movement Status File                                                              CSE039
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*   01         RETURN TO PREVIOUS PROGRAM                       *
     F****************OR*ERROR*ON*TABTB10*READ*************************   S01117
     F*   02         ROLLUP ENABLED                                   *
     F*   03         ROLLDOWN ENABLED                                 *
     F*   04         F/12 ENABLED                                     *
     F*   06         F/7  ENABLED                                     *
     F****11*********PROCESS*TYPE-1,3,5,6,8*&*TRADE*BASIS-P,Y******   *   S01176
     F*   11         PROCESS TYPE-1,3,5,6,8,9 & TRADE BASIS-P,Y       *   S01176
     F*   12         TRADE BASIS - Y                                  *
     F*   14         PROCESS TYPE - 4 OR 7                            *
     F*   15         PROCESS TYPE - 8                                 *
     F*   16         AUTOCHARGE OPTION IND.ON TABTB36 IS ON.          *   S01176
     F*   20         MT5xx SWITCHABLE FEATURES PRESENT - S01401       *   S01401
     F****25*********CHAIN*FAIL*ON*TRADS***************************   *   E16096
     F****25*********CHAIN*FAIL*ON*TRADHS**********************    E16096 E21523
     F*   25         CHAIN FAIL ON TRADS OR HSTTTR                    *   E21523
     F*   26         CHAIN FAIL ON OTHER FILES                        *
     F*   27         Read on SEMVTSL2                                 *   CSE039
     F*   28         PROFIT CENTRE USED                               *   S01117
     F*   29         ORIGINATING BRANCH USED                          *   S01117
     F*   30         MULTIBRANCHING INDICATOR                         *   S01117
     F*   31         CANCELLED TRADE                                  *   E13543
     F*   32         SETTLED TRADE                                    *   E14249
     F*   34         IF PB PRESENT SETS ON                            *   CPB001
     F*   35         DISPLAY PORTFOLIO MANAGEMENT FIELDS              *   S01486
     F*   36         IF PM PRESENT SETS ON                            *   S01486
     F*   37         DISPLAY 'IN' CCY IN FIELD 72 FIELD               *   CEU005
     F*   38         DISPLAY/NON DISPLAY CORPORATE ACTIONS FLAG       *   CSE007
     F*   40         REVERSE IMAGE OPTION FIELD                       *
     F*   41         REVERSE IMAGE TRADE REFERENCE FIELD              *
     F*   42         DISPLAY ERROR MESSAGE                            *
     F*   43         F22 Enabled                                      *   CSE039
     F*   44         ON if CSE039 is ON                               *   CSE039
     F*                                                               *
     F*   50         ROLLUP                                           *   S01179
     F*   51         ROLLDOWN                                         *   S01179
     F*   52         HELP                                             *   S01179
     F*                                                               *
     F*   55         VLDCMDKY INDICATOR FOR DISPLAY FILE              *
     F*                                                               *   CAC002
     F*   65         Analytical Accounting Module is Installed        *   CAC002
     F*   66         Display Transaction Profit Centre                *   CAC002
     F*   67         Display Margin Points and Amount                 *   CAC002
      *   73         Dispay field for Taxations on Savings Income     *                       CGL031
     F*                                                               *
     F* 79             Restricted functionality indicator used when       S01393
     F*                program is called as a restricted linked enquiry   S01393
     F*   80         CHAIN FAIL ON TABTB36                            *   S01176
     F*   86         CURRENT TRANSACTION GENERATED BY EARLY REDEMP.   *   S01496
     F*   90 - 99    WORK INDICATOR - STD SUBROUTINES                 *
     F*   U7         WITH U8 FOR DATABASE ERROR                       *
     F*   U8         WITH U7 FOR DATABASE ERROR                       *
     F*   LR         TERMINATE PROGRAM                                *
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  I N D E X   T O   S U B R O U T I N E S                      *
     F*                                                               *
     F*  MT500   -  PROCESS MT5xx SWITCHABLE FEATURE                  *   S01401
     F*  ASCHGS  -  MOVES VALUES INTO AID - AS400 CONVERSION          *
     F*  COMMD   -  PROCESS COMMAND KEYS, HELP AND ROLLUP/DOWN        *
     F*  OPTION  -  CHECK VALIDITY OF ENTERED OPTION COMBINATIONS     *
     F*  TRADIN  -  PROCESS ENTERED TRADE REFERENCE                   *
     F*  CLEAR   -  CLEAR FIELDS AND INDICATORS ON DISPLAY SCREEN     *
     F*  DISP    -  ACCUMULATE SECURITY DETAILS FOR DISPLAY           *
     F*  FILL1   -  FILL FIRST SCREEN OF DETAILS                      *
     F*  FILL2   -  FILL SECOND SCREEN OF DETAILS                     *
     F*  LINK    -  PROCESS REQUEST FOR LOWER LEVEL ENQUIRY           *
     F*  RETSR   -  END OF PROGRAM PROCESSING                         *
     F*  FIRST   -  FIRST CYCLE PROCESSING                            *
     F*  *PSSR   -  ERROR HANDLING                                    *   S01117
     F*                                                               *
     F*  ZCONV   -  CONVERT AMOUNTS FROM ONE CURRENCY TO ANOTHER      *   S01176
     F*  ZDATE2  -  DATE FORMATTER                                    *
     F*  ZSEDIT  -  EDIT AMOUNTS                                      *
     F***ZSYSTM**-**ACCESS*ICDR1***************************************   S01117
     F*  P001    -  CHANGE TRANSACTIONS TYPES                         *   S01496
     F*                                                               *
     F*****************************************************************
      /EJECT
     E                    CPY@    1   1 80
     E***********         MSG     1   6 79               Error Messages   S01117
     E                    MSG     1   8 79               Error Messages   S01117
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY ZSRSRC,ZSEDITZ1
     E/COPY ZSRSRC,ZPOWERZ1                                               S01176
     E**********          CMD     1   8 80                                             088336 235184
     E                    CMD     1  10 80                                                    235184
      /EJECT
     ICPYR@#      DS
     I*
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I*
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I/COPY ZSRSRC,ZSEDITZ2
     I*TABKEY******DS                                                     S01117
     I***********                             1  12 KEY                   S01117
     I***********                             1   2 TYPE                  S01117
     I***********                             9  11 KCCY                  S01117
     ISDGELR    E DSSDGELRPD                                              S01117
     I*                                                                   S01117
     I** General Ledger Details                                           S01117
     I*                                                                   S01117
     ISDSTRD    E DSSDSTRDPD                                              S01117
     I*                                                                   S01117
     I** Securities Trading ICD                                           S01117
     I*                                                                   S01117
     ISDCUST    E DSSDCUSTPD                                              S01117
     I*                                                                   S01117
     I** Customer details                                                 S01117
     I*                                                                   S01117
     ISDCURR    E DSSDCURRPD                                              S01117
     I*                                                                   S01117
     I** Currency details                                                 S01117
     I*                                                                   S01401
     ISDSECS    E DSSDSECSPD                                              S01401
     I              QQACCD                          ACCDQQ                                    CGL029
     I*                                                                   S01401
     I** Securities Customer Details                                      S01401
     I*                                                                   S01117
     IDSFDY     E DSDSFDY                                                 S01117
     I*                                                                   S01117
     I** DS for access programs, short data structure                     S01117
     I*                                                                   S01117
     IDSSDY     E DSDSSDY                                                 S01117
     I*                                                                   S01486
     I** Portfolio Definition Via Access Program                          S01486
     I*                                                                   S01486
     ISDPORT    E DSSDPORTPD                                              S01486
     I*                                                                   S01486
     I**  EXTERNAL DS FOR MMOD acces object                               S01486
     I*                                                                   S01486
     ISDMMOD    E DSSDMMODPD                                              S01486
     I*                                                                   S01117
     I** DS for access programs, long data structure                      S01117
      *                                                                   CSE039
     I*SDSCOD*** E DSSDSCODPD                                             CSE039            MD056812
     ISDSCOD    E DSSDSCOJW0                                                                MD056812
      ** SD Swift Codes File                                              CSE039
     I*                                                                   S01117
     ISECOND    E DSSECONJW0                                                                MD058079
     I/COPY WNCPYSRC,SE0250I006
     I*LDA*******UDS                            256                       S01117
     ILDA         DS                            256                       S01117
     I*
     I*      Local data area.
     I** *LOCK IN LDA immediately before and OUT LDA immediately          S01117
     I** after each database error handling.                              S01117
     I*
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 1770DBASE                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     I*                                                                   S01117
     IRUNDT       DS                                                      S01117
     I** DATA AREA RUNDAT                                                 S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
     I**  LINK ENQUIRY DATA AREA
     ISESDS     E DS
     IPSDS       SDS
     I                                        1  10 PROGRM
     I                                      244 246 WSID
     ISCRDS       DS
     I                                      287 288 AID
     I*
     ISCRFM1      DS
     I*
     I* DATA STRUCTURES OVER SCREEN FIELDS FOR CLEARING
     I*
     I                                        1   1 SACTN
     I                                        2   7 STDRF
     I                                        8  17 STDSS
     I                                       18  37 SSRPN
     I                                       38  47 SCNUM
     I                                       48  67 SCRNM
     I                                       68  68 STINC
     I                                       69  70 STDTP
     I                                       71  83 SNOML
     I                                       84 100 STPDY
     I                                      101 107 STDVD
     I***********                           108 110 STDBR                 S01117
     I                                      108 110 STDBA                 S01117
     I                                      111 112 STDBK
     I                                      113 115 STDID
     I                                      116 122 STDDT
     I                                      123 124 STSUB
     I                                      125 130 SLKRF
     I                                      131 131 STDMI
     I                                      132 166 STDNR
     I                                      167 167 SACIN
     I                                      168 180 STDCR
     I                                      181 197 SPRIC
     I                                      198 198 SAIIP
     I                                      199 203 SDADJ
     I                                      204 218 SITRA
     I                                      219 229 SRALL
     I                                      230 230 SEXDV
     I***********                           231 241 STCFC                 052254
     I                                      231 241 ZZ010                 052254
     I                                      242 243 STMKC
     I                                      244 244 STCAP
     I                                      245 245 SADIN
     I                                      246 248 SORBR                 S01117
     I                                      249 252 SPRFC                 S01117
     I                                      252 263 STCFC                 052254
     I                                      264 267 SBPRC                 CAC002
     I                                      268 271 STPRC                 CAC002
     I                                      272 274 SSCCY                 CAC002
     I                                      275 280 SORDE                 CPB002
     I/COPY WNCPYSRC,SE0250I002
     ISCRFM2      DS
     I                                        1   3 SSETC
     I                                        4  18 STDER
     I                                       19  33 STBCR
     I                                       34  35 SSMTH
     I**********                             36  47 SPYFM                                     CGL029
     I                                       36  47 QQYFM                                     CGL029
     I***********                            48  50 SPYFB                 S01117
     I                                       48  50 SPYFA                 S01117
     I**********                             51  62 SPAYT                                     CGL029
     I                                       51  62 QQAYT                                     CGL029
     I***********                            63  65 SPYTB                 S01117
     I                                       63  65 SPYTA                 S01117
     I                                       66  73 STDFA
     I                                       74  75 SASNM
     I                                       76  85 SDELF
     I                                       86  93 SDFFA                 S01175
     I                                       94 103 SDELT                 S01175
     I/COPY WNCPYSRC,SE0250I003
     I                                      104 138 STDSI                 S01175
     I/COPY WNCPYSRC,SE0250I004
     I**************************************139 140 STBCC          S01175 S01486
     I**************************************141 142 STCCC          S01175 S01486
     I**************************************143 144 STCC1          S01175 S01486
     I**************************************145 146 STCC2          S01175 S01486
     I**************************************147 148 STCC3          S01175 S01486
     I**************************************149 150 STOCC          S01175 S01486
     I**************************************151 152 STLTC          S01175 S01486
     I**************************************153 153 SPCOD          S01175 S01486
     I**************************************154 154 STMDI          S01175 S01486
     I**************************************155 169 STBCA          S01175 S01486
     I**************************************170 184 STCCA          S01175 S01486
     I**************************************185 199 STCA1          S01175 S01486
     I**************************************200 214 STCA2          S01175 S01486
     I**************************************215 229 STCA3          S01175 S01486
     I**************************************230 244 STOCA          S01175 S01486
     I**************************************245 259 STLTA          S01175 S01486
     I**************************************260 267 SDTFA          S01175 S01486
     I**************************************268 268 SCLTY          S01175 S01486
     I                                      139 142 SPTFR                 S01486
     I                                      143 156 SSPXR                 S01486
     I                                      157 157 SSPMD                 S01486
     I                                      158 159 STBCC                 S01486
     I                                      160 161 STCCC                 S01486
     I                                      162 163 STCC1                 S01486
     I                                      164 165 STCC2                 S01486
     I                                      166 167 STCC3                 S01486
     I                                      168 169 STOCC                 S01486
     I                                      170 171 STLTC                 S01486
     I                                      172 172 SPCOD                 S01486
     I                                      173 173 STMDI                 S01486
     I                                      174 188 STBCA                 S01486
     I                                      189 203 STCCA                 S01486
     I                                      204 218 STCA1                 S01486
     I                                      219 233 STCA2                 S01486
     I                                      234 248 STCA3                 S01486
     I                                      249 263 STOCA                 S01486
     I                                      264 278 STLTA                 S01486
     I                                      279 286 SDTFA                 S01486
     I                                      287 287 SCLTY                 S01486
     I***********                           269 269 SCLRH          S01175 S01176
     I***********                           270 270 SPRYC          S01175 S01176
     I**************************************269 269 SPRYC          S01176 S01486
     I                                      288 288 SPRYC                 S01486
     I                                      289 297 SFXMP                 CAC002
     I                                      298 314 SMAMT                 CAC002
     I                                      315 317 SICCY                 CEU005
     I                                      318 335 SPYFM                                     CGL029
     I                                      336 353 SPAYT                                     CGL029
     I/COPY WNCPYSRC,SE0250I005
     I*                                                                   S01401
     ISCRFM3      DS                                                                          CAS006
     I                                        1  16 #3CCRK                                    CAS006
     I                                       17  32 #3CLQP                                    CAS006
     I                                       33  47 #3ITRN                                    CAS006
     I                                       48  60 #3NTCR                                    CAS006
     I                                       61  77 #3PRCN                                    CAS006
     IPDATA     E DSSE50DT                                                S01401
      ***  Data structure to pass parameters to SE1805 for MT5xxs         S01401
     IEXTFIL    E DSTRADSDX1                                                                  222373
     IEXTSET    E DSTRADSDX2                                                                  222373
      ** Data structure to pass parameters to SE001805                                        222373
     I/COPY WNCPYSRC,SE0250I001
      *
     I              'SEMVTSSIN'           C         MVPGM                 CSE039
      ** Program name for Movement Status Display                         CSE039
      *                                                                   CSE039
     C/EJECT
     C           *NAMVAR   DEFN           SESDS
     C           *NAMVAR   DEFN           LDA
     C**
     C**  DEFINE LIKE WORK FIELDS
     C**
     C           *LIKE     DEFN STDRF     LSTDRF
     C           *LIKE     DEFN STDRF     ZSTDRF
     C/COPY WNCPYSRC,SE0250C004
     C**
     C**  DO FIRST CYCLE PROCESSING
     C**
     C                     EXSR FIRST
     C**
     C**  MAIN PROCESSING    -    Do until end of job requested
     C**
     C           *IN01     DOWEQ'0'
     C**
     C**    Display the screen
     C**     - enable Function Keys 2 & 7 only on initial & screen
     C/COPY WNCPYSRC,SE0250C001
     C**
     C                     SETOF                     0406
     C                     WRITESE0250F0
     C********** SCNNO     IFEQ 0                                                             CAS006
     C                     SELEC                                                              CAS006
     C           SCNNO     WHEQ 0                                                             CAS006
     C                     SETON                     0406
     C                     MOVE *OFF      *IN43                           CSE039
     C                     WRITESE0250FT
     C                     EXFMTSE0250FI
     C**********           ELSE                                                               CAS006
     C********** SCNNO     IFEQ 1                                                             CAS006
     C           SCNNO     WHEQ 1                                                             CAS006
     C                     SETON                     0406
     C                     MOVE *ON       *IN43                           CSE039
     C                     WRITESE0250F1
     C                     WRITESE0250FC                                  E13543
     C                     EXFMTSE0250FI
     C/COPY WNCPYSRC,SE0250C042
     C**********           ELSE                                                               CAS006
     C           SCNNO     WHEQ 2                                                             CAS006
     C           CAS006    ANDEQ'Y'                                                           CAS006
     C                     MOVE *OFF      *IN43                           CSE039
     C                     EXFMTSE0250F3                                                      CAS006
     C/COPY WNCPYSRC,SE0250C002
     C                     OTHER                                                              CAS006
     C                     MOVE *OFF      *IN43                           CSE039
     C                     EXFMTSE0250F2
     C/COPY WNCPYSRC,SE0250C050
     C**********           END                                                                CAS006
     C                     ENDSL                                                              CAS006
     C**********           END                                                                CAS006
     C**
     C** Call S/R to move values into AID                                 S01179
     C*                                                                   S01179
     C                     EXSR ASCHGS                                    S01179
     C*                                                                   S01179
     C/COPY WNCPYSRC,SE0250C043
     C**    Clear the error messages unless HELP pressed
     C**
     C           AID       IFNE 'HP'
     C                     MOVE *BLANKS   ERMSG  79
     C                     SETOF                     404142
     C                     END
     C**
     C******Check*Command*Keys*-*including*HELP******
     C**    Check Command Keys
     C**
     C                     EXSR COMMD
      *                                                                   S01401
     C/COPY WNCPYSRC,SE0250C045
      ***  If Rollup has been taken from the second format (only          S01401
      ***  possible if S01401 present) then handle MT5xxs.                S01401
      *                                                                   S01401
     C           AID       IFEQ 'MT'                                      S01401
     C                     EXSR MT500                                     S01401
     C                     END                                            S01401
     C**
     C**    If Enter has been pressed check validity of options
     C**
     C           AID       IFEQ 'RA'
     C**
     C**    Check Validity of Option Combinations
     C**
     C                     EXSR OPTION
     C**
     C           *IN42     IFEQ '0'
     C**
     C**
     C**    Check if no lower level option selected
     C**
     C           SACTN     IFEQ *BLANKS
     C                     EXSR TRADIN
     C                     ELSE
     C**
     C**    Lower Level Enquiry Selected
     C**
     C                     EXSR LINK
     C**
     C                     END
     C                     END
     C                     END
     C                     END
      *                                                                   CSE039
      ** F22 processing                                                   CSE039
      *                                                                   CSE039
     C           *IN22     IFEQ *ON                                       CSE039
     C           *IN43     ANDEQ*ON                                       CSE039
      *                                                                   CSE039
     C                     MOVE *BLANKS   INTRNO  6                       CSE039
     C                     MOVE LSTDRF    INTRNO                          CSE039
     C                     CALL 'SEC025'                                  CSE039
     C                     PARM MVPGM     PPROG  10                       CSE039
     C                     PARM INTRNO    PTRNO   6                       CSE039
     C                     PARM 'T'       PTTYP   1                       CSE039
     C                     PARM 'E'       PMODE   1                       CSE039
     C                     PARM           PEXIT   1                       CSE039
     C                     PARM           PPREV   1                       CSE039
      *                                                                   CSE039
     C           PEXIT     IFEQ '1'                                       CSE039
     C                     MOVE *ON       *IN01                           CSE039
     C                     ENDIF                                          CSE039
      *                                                                   CSE039
     C                     MOVE *OFF      *IN22                           CSE039
     C                     ENDIF                                          CSE039
     C**
     C**   Return to calling program
     C**
     C                     EXSR RETSR
      *
      *****************************************************************
      /EJECT                                                              S01401
      *****************************************************************   S01401
      *                                                               *   S01401
      *  MT500  - Subroutine to process MT5xx Switchable Feature      *   S01401
      *                                                               *   S01401
      *  Called By: Main Processing.                                  *   S01401
      *                                                               *   S01401
      *****************************************************************   S01401
      *                                                                   S01401
     C           MT500     BEGSR                           *** MT500  *** S01401
      *                                                                   S01401
      ***  Access Securities Customer Details.                            S01401
      *                                                                   S01401
     C                     MOVE TCNR      ATCNR                           S01401
     C                     CALL 'AOSECSR0'                                S01401
     C                     PARM *BLANKS   @RTCD   7                       S01401
     C                     PARM '*KEY   ' @OPTN   7                       S01401
     C                     PARM           ATCNR   6                       S01401
     C           SDSECS    PARM SDSECS    DSSDY                           S01401
      *                                                                                       CSE022
      ** BFDRF1 needs to be updated by the 1st 6 characters of BFNDR1.                        CSE022
      ** BFDRF2 needs to be updated by the 1st 6 characters of BFNDR2.                        CSE022
      *                                                                                       CSE022
     C                     MOVELBFNDR1    BFDRF1                                              CSE022
     C                     MOVELBFNDR2    BFDRF2                                              CSE022
      *                                                                   S01401
      ***  Set Action Code to Enquiry.                                    S01401
      *                                                                   S01401
     C                     MOVE 'E'       PACTN                           S01401
      *                                                                   S01401
      ***  Move Trade Reference fields into PDATA.                        S01401
      *                                                                   S01401
     C                     MOVE STDVD     PTDVD                                               211705
     C                     MOVE STDRF     PTDRF                           S01401
     C                     MOVE SCNUM     PTCNR                           S01401
     C                     MOVE STDSS     PSESN                           S01401
     C                     MOVE STDTP     PTDTP                           S01401
     C                     MOVE NOML      PNOML                           S01401
     C                     MOVELDELT      PDELT                           S01401
     C                     MOVE *BLANKS   PTDSI                           S01401
     C                     MOVELSTDSI     PTDSI                           S01401
     C                     MOVE TNMC      PTNMC                           S01401
     C                     MOVE STDBA     PTDBR                           S01401
     C                     MOVE DELF      PDELF                           S01401
     C                     MOVE BVDR2     PDC02                           S01401
     C                     MOVE TNMD      PNOMD                           S01401
     C                     MOVE SCLTY     PCLTY                           S01401
     C                     MOVE SPCOD     PPCOD                           S01401
     C                     MOVE SSMTH     PSMTH                           S01401
     C                     MOVE BFDRF1    PC101                           S01401
     C                     MOVE BFDRF2    PC102                           S01401
     C                     MOVE SAIIP     PAIIP                           S01401
     C                     MOVE PROT      PPROT                           S01401
     C                     MOVE STINC     PINCS                           S01401
     C                     MOVE *BLANKS   PTRTT                           S01401
      *                                                                   S01401
      * OVERRIDE FILES USED IN SE1805 AND SE1806                          088336
     C                     CALL 'QCAEXEC'                                 088336
     C                     PARM CMD,1     QCCMD  80                       088336
     C                     PARM 80        QCLEN  155                      088336
     C                     CALL 'QCAEXEC'                                 088336
     C                     PARM CMD,2     QCCMD                           088336
     C                     PARM 80        QCLEN                           088336
     C                     CALL 'QCAEXEC'                                 088336
     C                     PARM CMD,3     QCCMD                           088336
     C                     PARM 80        QCLEN                           088336
     C                     CALL 'QCAEXEC'                                 088336
     C                     PARM CMD,4     QCCMD                           088336
     C                     PARM 80        QCLEN                           088336
     C                     CALL 'QCAEXEC'                                                     235184
     C                     PARM CMD,5     QCCMD                                               235184
     C                     PARM 80        QCLEN                                               235184
     C*                                                                   088336
     C**********           CALL 'SE1805'                                  S01401              CSE028
     C                     CALL 'SE001805'                                                    CSE028
     C                     PARM '00'      PCMD    2                       S01401
     C                     PARM 'N'       PERR    1                       S01401
     C                     PARM           PDATA                           S01401
     C                     PARM           EXTFIL                                              222373
     C                     PARM           EXTSET                                              222373
      *                                                                   S01401
      * DELETE OVERRIDES USED IN SE1805                                   088336
     C**********           CALL 'QCAEXEC'                                              088336 235184
     C**********           PARM CMD,5     QCCMD                                        088336 235184
     C**********           PARM 80        QCLEN                                        088336 235184
     C                     CALL 'QCAEXEC'                                 088336
     C                     PARM CMD,6     QCCMD                           088336
     C                     PARM 80        QCLEN                           088336
     C                     CALL 'QCAEXEC'                                 088336
     C                     PARM CMD,7     QCCMD                           088336
     C                     PARM 80        QCLEN                           088336
     C                     CALL 'QCAEXEC'                                 088336
     C                     PARM CMD,8     QCCMD                           088336
     C                     PARM 80        QCLEN                           088336
     C                     CALL 'QCAEXEC'                                                     235184
     C                     PARM CMD,9     QCCMD                                               235184
     C                     PARM 80        QCLEN                                               235184
     C                     CALL 'QCAEXEC'                                                     235184
     C                     PARM CMD,10    QCCMD                                               235184
     C                     PARM 80        QCLEN                                               235184
     C**********           CALL 'SE1805'                                  S01401              CSE028
     C                     CALL 'SE001805'                                                    CSE028
     C                     PARM '00'      PCMD    2                       S01401
     C                     PARM 'N'       PERR    1                       S01401
     C                     PARM           PDATA                           S01401
     C                     PARM           EXTFIL                                              222373
     C                     PARM           EXTSET                                              222373
      *                                                                   S01401
      ***  On exit from MT5xx screens, if Rolldown taken then display     S01401
      ***  second format; else, if F3 taken then return to menu;          S01401
      ***  else process as though enter was taken.                        S01401
      *                                                                   S01401
     C           PCMD      IFEQ '12'                                      S01401
      *                                                                                       CAS006
      ** Adjust Screen Number when CAS006 is on to accomodate new screen                      CAS006
      *                                                                                       CAS006
     C           CAS006    IFEQ 'N'                                                           CAS006
     C                     Z-ADD2         SCNNO                           S01401
     C                     ELSE                                                               CAS006
     C                     Z-ADD3         SCNNO                                               CAS006
     C                     ENDIF                                                              CAS006
     C                     EXSR DISP                                      S01401
     C                     ELSE                                           S01401
      *                                                                   S01401
     C           PCMD      IFEQ '03'                                      S01401
     C                     MOVE '1'       *IN01                           S01401
     C                     ELSE                                           S01401
     C                     MOVE 'RA'      AID                             S01401
     C                     END                                            S01401
      *                                                                   S01401
     C                     END                                            S01401
      *                                                                   S01401
     C                     ENDSR                                          S01401
      *                                                                   S01401
      *****************************************************************   S01401
      /EJECT
      *****************************************************************
      *                                                               *
      *  COMMD  - Subroutine to process Command Keys                  *
      ************and*HELP,*ROLLUP*and*ROLLDOWN****                   *   S01199
      *           and HELP, ROLLUP and ROLLDOWN                       *   S01199
      *                                                               *
      *  Called By: Main Processing.                                  *
      *  Calls: CLEAR, TRADIN, DISP,                                  *
      **********MHELP*Program****                                     *   S01199
      *                                                               *
      *****************************************************************
      *
     C           COMMD     BEGSR                           ** COMMD **
     C***********                                                         S01199
     C*****If*HELP*pressed*call*help*screen****************************   S01199
     C***********                                                         S01199
     C***********AID       IFEQ 'HP'                                      S01199
     C***********          CALL 'MHELP'                                   S01199
     C***********          PARM           PGMNO                           S01199
     C***********          PARM           HERCD 160                       S01199
     C***********          END                                            S01199
     C**
     C**    If Rollup key pressed
     C**       Use DISP to fill screen if not done already
     C**
     C           AID       IFEQ 'UP'
     C                     MOVE LSTDRF    STDRF
     C                     MOVE *BLANKS   SACTN
     C           SCNNO     IFLT TOPNO
     C                     ADD  1         SCNNO
     C**
     C**    If Rollup no longer available - disenable
     C**    If Rolldown now available - enable
     C**
      ** Set Rollup off only when last screen is already reached                              CAS006
      *                                                                                       CAS006
     C           SCNNO     IFEQ TOPNO                                                         CAS006
     C                     SETOF                     02
     C                     ENDIF                                                              CAS006
     C                     SETON                     03
      *                                                                   S01401
      ***  If the MT5xx switchable feature is present then enable         S01401
      ***  Rollup from the second screen.                                 S01401
      *                                                                   S01401
     C           S01401    IFEQ 'Y'                                       S01401
     C/COPY WNCPYSRC,SE0250C046
     C                     SETON                     02                   S01401
     C                     END                                            S01401
      *                                                                   S01401
     C                     ELSE
     C                     EXSR DISP
     C                     END
     C                     END
     C**
     C**    If Rolldown key pressed
     C**
     C           AID       IFEQ 'DN'
     C                     MOVE LSTDRF    STDRF
     C                     MOVE *BLANKS   SACTN
     C                     SUB  1         SCNNO
     C**
     C**    If Rolldown no longer available - disenable
     C**    If Rollup now available - enable
     C**
     C           SCNNO     IFEQ 1
     C                     SETOF                     03
     C                     SETON                     02
     C                     END
     C                     END
     C**
     C**    If F3 then exit to menu - return code 1 and end
     C**
     C           AID       IFEQ '01'
     C                     MOVE '1'       RTNC
     C                     MOVE '1'       *IN01
     C                     END
     C**
     C**    If F12 then return to previous enquiry - return code 2
     C**                  unless there is no previous enquiry
     C**
     C           AID       IFEQ '02'
     C           ORIG      IFNE PGMNO
     C                     MOVE '2'       RTNC
     C                     MOVE '1'       *IN01
     C                     ELSE
     C                     MOVE '1'       *IN42
     C                     MOVE MSG,4     ERMSG
     C                     END
     C                     END
     C**
     C**    If F5 then refresh enquiry screen
     C**
     C           AID       IFEQ '05'
     C                     EXSR CLEAR
     C                     END
     C**
     C**     If F9 then return to initial enquiry - return code 7
     C**                   unless this is the initial program
     C**
     C           AID       IFEQ '07'
     C           ORIG      IFNE PGMNO
     C                     MOVE '7'       RTNC
     C                     MOVE '1'       *IN01
     C                     ELSE
     C                     MOVE '1'       *IN42
     C                     MOVE MSG,4     ERMSG
     C                     END
     C                     END
     C**
     C                     ENDSR
      *
      *****************************************************************
      /EJECT                                                              S01179
      *****************************************************************   S01179
      *                                                               *   S01179
      *            ****** AS400 CONVERSION ******                     *   S01179
      *                                                               *   S01179
      *  ASCHGS S/R TO MOVE THE APPROPRIATE VALUES INTO FIELD AID,    *   S01179
      *  DEPENDING ON WHICH FUNCTION KEY HAS BEEN PRESSED.            *   S01179
      *  CALLED FROM UPDATE                                           *   S01179
      *                                                               *   S01179
      *****************************************************************   S01179
      *                                                                   S01179
     C           ASCHGS    BEGSR                                          S01179
     C*                                                                   S01179
     C* If ENTER pressed, the VLDCMDKEY indicator will be off             S01179
     C*                                                                   S01179
     C           *IN55     IFEQ '0'                                       S01179
     C                     MOVE 'RA'      AID                             S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F3                                                             S01179
     C*                                                                   S01179
     C           *INKC     IFEQ '1'                                       S01179
     C                     MOVE '01'      AID                             S01179
     C                     MOVE '0'       *INKC                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F5                                                             S01179
     C*                                                                   S01179
     C           *INKE     IFEQ '1'                                       S01179
     C                     MOVE '05'      AID                             S01179
     C                     MOVE '0'       *INKE                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F9                                                             S01179
     C*                                                                   S01179
     C           *INKI     IFEQ '1'                                       S01179
     C                     MOVE '07'      AID                             S01179
     C                     MOVE '0'       *INKI                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F12                                                            S01179
     C*                                                                   S01179
     C           *INKL     IFEQ '1'                                       S01179
     C                     MOVE '02'      AID                             S01179
     C                     MOVE '0'       *INKL                           S01179
     C                     END                                            S01179
      *                                                                   S01401
     C/COPY WNCPYSRC,SE0250C047
      ***  If Rollup has been taken from the second format (only          S01401
      ***  possible if S01401 present).                                   S01401
      *                                                                   S01401
     C           *IN50     IFEQ '1'                                       S01401
     C           SCNNO     ANDEQ2                                         S01401
     C           CAS006    ANDEQ'N'                                                           CAS006
     C           *IN50     OREQ '1'                                                           CAS006
     C           CAS006    ANDEQ'Y'                                                           CAS006
     C           SCNNO     ANDEQ3                                                             CAS006
     C/COPY WNCPYSRC,SE0250C048
     C                     MOVE 'MT'      AID                             S01401
     C                     MOVE '0'       *IN50                           S01401
     C                     END                                            S01401
     C*                                                                   S01179
     C* If ROLLUP pressed                                                 S01179
     C*                                                                   S01179
     C           *IN50     IFEQ '1'                                       S01179
     C                     MOVE 'UP'      AID                             S01179
     C                     MOVE '0'       *IN50                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If ROLLDOWN pressed                                               S01179
     C*                                                                   S01179
     C           *IN51     IFEQ '1'                                       S01179
     C***********          MOVE 'UP'      AID                       S01179E17428
     C                     MOVE 'DN'      AID                       S01179E14728
     C                     MOVE '0'       *IN51                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C**If*HELP*key*pressed***********                                    S01179
     C*                                                                   S01179
     C************IN52     IFEQ '1'                                S01179 S01199
     C***********          MOVE 'HP'      AID                      S01179 S01199
     C***********          MOVE '0'       *IN52                    S01179 S01199
     C***********          END                                     S01179 S01199
     C*                                                                   S01179
     C                     ENDSR                                          S01179
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  OPTION - Subroutine to check validity of option combinations *
      *                                                               *
      *  Called by: Main Processing.                                  *
      *  Calls: None.                                                 *
      *                                                               *
      *****************************************************************
      *
     C           OPTION    BEGSR                            ** OPTION *
     C**
     C**     If no details on screen - error if option entered
     C**                             - error if no trade ref entered
     C**                             - error if both entered
     C**
     C           LSTDRF    IFEQ *BLANKS
     C           SACTN     IFNE *BLANKS
     C                     SETON                     404142
     C                     MOVE MSG,6     ERMSG
     C                     ELSE
     C           STDRF     IFEQ *BLANKS
     C                     SETON                     404142
     C                     MOVE MSG,6     ERMSG
     C                     END
     C                     END
     C                     ELSE
     C**
     C**     If details on screen - error if neither or both entered
     C**
     C           SACTN     IFEQ *BLANKS
     C           STDRF     ANDEQ*BLANKS
     C                     SETON                     404142
     C                     MOVE MSG,2     ERMSG
     C                     ELSE
     C           SACTN     IFNE *BLANKS
     C           STDRF     ANDNE*BLANKS
     C           STDRF     ANDNELSTDRF
     C                     SETON                     404142
     C                     MOVE MSG,1     ERMSG
     C                     END
     C                     END
     C                     END
     C**
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  TRADIN - Subroutine to Process entered Trade Reference       *
      *                                                               *
      *  Called by: Main Processing, FIRST, COMMD                     *
      *  Calls: CLEAR, DISP                                           *
      *                                                               *
      *****************************************************************
      *
     C           TRADIN    BEGSR                            ** TRADIN *
     C**
     C** Check if valid trade reference entered
      ***  If not on TRADS, check HSTTTR                                  E21523
     C**     Error if no active record
     C**     Otherwise prepare to display the details
     C**
     C***********          SETOF                     31                   E14249
     C                     SETOF                     3132                 E14249
     C                     MOVE *BLANKS   SLTRL                           E36244
      *                                                                   CSE010
      ** If CSE010 is installed, and a '?' is found in the trade          CSE010
      ** reference field                                                  CSE010
      *                                                                   CSE010
     C           CSE010    IFEQ 'Y'                                       CSE010
     C                     MOVELSTDRF     WQMK    1                       CSE010
      *                                                                   CSE010
     C                     MOVEL'SETRAD'  PGMQRY  9                       CSE010
     C                     MOVE 'QRY'     PGMQRY                          CSE010
     C           WQMK      IFEQ '?'                                       CSE010
     C                     MOVELSTDRF     @TRAD                           CSE010
      *                                                                   CSE010
     C                     CALL PGMQRY                                    CSE010
     C                     PARM 'E'       @ACDE   1                       CSE010
     C                     PARM           @TRAD   6                       CSE010
      *                                                                   CSE010
     C           @TRAD     IFNE *BLANKS                                   CSE010
     C                     MOVE @TRAD     STDRF                           CSE010
     C                     ELSE                                           CSE010
     C                     MOVE *BLANKS   STDRF                           CSE010
     C                     ENDIF                                          CSE010
      *                                                                   CSE010
     C                     ENDIF                                          CSE010
     C                     ENDIF                                          CSE010
      *                                                                   CSE010
     C/COPY WNCPYSRC,SE0250C040
      *                                                                   E21523
      ***  Read Historic Trades File first to avoid showing Trades as     E21523
      ***  Cancelled when they're not.                                    E21523
      *                                                                   E21523
     C           STDRF     CHAINHSTTTR               25                   E21523
      *                                                                   E21523
     C           *IN25     IFEQ '1'                                       E21523
     C***********STDRF     CHAINTRADS                25                   E16096
     C***********STDRF     CHAINTRADHS               25            E16096 E21523
     C           STDRF     CHAINTRADS                25                   E21523
     C                     END                                            E21523
      *                                                                   E21523
     C           *IN25     IFEQ '0'
      *                                                                   CSE007
      **  Display Corporate Action Flag if trade has been generated       CSE007
      **  from a Corporate Action                                         CSE007
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C                     MOVE *OFF      *IN38                           CSE007
     C           COAF      IFEQ 'Y'                                       CSE007
     C                     MOVE *ON       *IN38                           CSE007
     C                     ENDIF                                          CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C           RECI      IFEQ '*'
     C           RECI      OREQ 'C'
     C***********          SETON                     25                   E13543
     C                     SETON                     31                   E13543
     C***********          MOVEL'CANCELLE'SLTRL                           S01269
     C***********          MOVE 'D'       SLTRL                           S01269
     C                     MOVEL'CANCELLE'SLTRL9  9                       S01269
     C                     MOVE 'D'       SLTRL9                          S01269
     C***********          MOVE *BLANK    SLTRL                    S01269 E32527
     C***********          MOVELSLTRL9    SLTRL                    S01269 E32527
     C                     MOVE SLTRL9    SLTRL                           E32527
     C***********          END                                            E14249
     C                     ELSE                                           E14249
     C           RECI      IFEQ 'S'                                       E14249
     C           TDFS      OREQ RUND                                      E14249
     C           RECI      OREQ 'D'                                       E32527
     C           AUTS      ANDEQ'Y'                                       E32527
     C           TDVD      ANDLERUND                                      E32527
     C           RECI      OREQ 'A'                                       E32527
     C           AUTS      ANDEQ'Y'                                       E32527
     C           TDVD      ANDLERUND                                      E32527
     C                     SETON                     32                   E14249
     C***********          MOVE *BLANK    SLTRL                    S01269 E32527
     C***********          MOVEL'SETTLED 'SLTRL                    E14249 E32527
     C                     MOVE *BLANK    SLTRL9                          E32527
     C                     MOVEL'SETTLED 'SLTRL9                          E32527
     C                     MOVE SLTRL9    SLTRL                           E32527
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,SE0250CVKS                                           S01408
     C*                                                                   S01408
     C***********          MOVE ' '       SLTRL                 E14249    S01269
     C                     END                                            S01269
     C                     END                                            S01269
     C***********AUTT      IFNE '00'                               S01269 S01117
     C           BVAUTH    IFNE '00'                                      S01117
     C           RECI      IFEQ 'D'                                       S01269
     C           RECI      OREQ 'A'                                       S01269
     C           RECI      OREQ 'S'                                       105036
     C                     SETON                     32                   S01269
     C                     MOVEL'AUTHORIS'SLTR10 10                       S01269
     C                     MOVE 'ED'      SLTR10                          S01269
     C***********          MOVE *BLANK    SLTRL                    S01269 E32527
     C***********          MOVELSLTR10    SLTRL                    S01269 E32527
     C                     MOVE *BLANK    SLTR22 22                       E32527
     C                     MOVELSLTR10    SLTR22                          E32527
     C                     MOVELSLTR22    SLTRL                           E32527
     C                     ELSE                                           S01269
     C           RECI      IFEQ 'L'                                       S01269
     C           CHTP      ANDNE'D'                                       101628
     C           RECI      OREQ 'P'                                       S01269
     C           CHTP      ANDNE'D'                                       101628
     C                     SETON                     32                   S01269
     C                     MOVE *BLANK    SLTR16 16                       S01269
     C                     MOVEL'AWAITING'SLTR16                          S01269
     C                     MOVE ' AUTHORI'SLTR16                          S01269
     C                     MOVELSLTR16    SLTR22 22                       S01269
     C                     MOVE 'SATION'  SLTR22                          S01269
     C                     MOVE *BLANK    SLTRL                           S01269
     C                     MOVELSLTR22    SLTRL                           S01269
     C                     ELSE                                           S01269
     C           RECI      IFEQ 'C'                                       S01269
     C           RECI      OREQ '*'                                       S01269
     C                     SETON                     32                   S01269
     C                     MOVE *BLANK    SLTR16 16                       S01269
     C                     MOVEL'CANCELLE'SLTR16                          S01269
     C                     MOVE 'D-AUTHOR'SLTR16                          S01269
     C                     MOVELSLTR16    SLTR20 20                       S01269
     C                     MOVE 'ISED'    SLTR20                          S01269
     C                     MOVE *BLANK    SLTRL                           S01269
     C                     MOVELSLTR20    SLTRL                           S01269
     C                     ELSE                                           S01269
     C           RECI      IFEQ 'R'                                       S01269
     C           RECI      OREQ 'L'                                       101628
     C           CHTP      ANDEQ'D'                                       101628
     C           RECI      OREQ 'P'                                       101628
     C           CHTP      ANDEQ'D'                                       101628
     C                     SETON                     32                   S01269
     C                     MOVE *BLANK    SLTR16 16                       S01269
     C                     MOVEL'CANCELLE'SLTR16                          S01269
     C                     MOVE 'D-AWAITI'SLTR16                          S01269
     C                     MOVELSLTR16    SLTR24 24                       S01269
     C                     MOVE 'NG AUTHO'SLTR24                          S01269
     C                     MOVE *BLANK    SLTRL                           S01269
     C                     MOVELSLTR24    SLTRL                           S01269
     C                     MOVE 'RISATION'SLTRL                           S01269
     C                     END                                            S01269
     C                     END                                            S01269
     C                     END                                            S01269
     C                     END                                            S01269
     C                     END                                            S01269
     C                     END                                            S01269
     C*                                                                   CEU005
     C           CEU005    IFEQ 'Y'                                       CEU005
     C           TDTP      ANDEQ'TP'                                      CEU005
     C           SETC      ANDEQBKEURO                                    CEU005
     C                     SETON                     37                   CEU005
     C                     ELSE                                           CEU005
     C                     SETOF                     37                   CEU005
     C                     ENDIF                                          CEU005
     C**
     C           *IN25     IFEQ '1'
     C                     MOVE '1'       *IN42
     C                     MOVE MSG,5     ERMSG
     C**
     C                     ELSE
     C**                                                                  S01117
     C** Check whether the user is authorised to the branch of the trade  S01117
     C** if multibranching environment                                    S01117
     C**                                                                  S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     CALL 'ZVBBU'                                   S01117
     C                     PARM TDBA      @ZBCD   3                       S01117
     C                     PARM           @ERR    10                      S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           @ERR      IFEQ 1                                         S01117
     C                     MOVE '1'       *IN42                           S01117
     C                     MOVE MSG,7     ERMSG                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           @ERR      IFEQ 2                                         S01117
     C                     MOVE '1'       *IN42                           S01117
     C                     MOVE MSG,8     ERMSG                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           @ERR      IFEQ *ZERO                                     S01117
     C*                                                                   S01117
     C                     MOVE STDRF     ZSTDRF
     C                     EXSR CLEAR
     C                     MOVE ZSTDRF    STDRF
     C                     MOVE STDRF     LSTDRF
     C                     EXSR DISP
     C                     END                                            S01117
     C**                                                                  S01117
     C                     END
     C**
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  CLEAR  - Subroutine to Clear the Screen display fields and   *
      *           Indicators.                                         *
      *                                                               *
      *  Called by: COMMD, TRADIN                                     *
      *  Calls: None.                                                 *
      *                                                               *
      *****************************************************************
      *
     C           CLEAR     BEGSR
     C**
     C                     MOVE *BLANKS   SCRFM1
     C                     MOVE *BLANKS   SCRFM2
     C                     MOVE *BLANKS   SCRFM3                                              CAS006
     C                     MOVE *BLANKS   LSTDRF
     C                     SETOF                     101112
     C                     SETOF                     1415
     C                     SETON                     02
     C                     SETOF                     03
     C                     Z-ADD0         SCNNO   10
     C                     Z-ADD0         TOPNO   10
     C**
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  DISP   - Subroutine to format details for Output.            *
      *                                                               *
      *  Called by: COMMD, TRADIN                                     *
      *  Calls: FILL1, FILL2                                          *
      *                                                               *
      *****************************************************************
      *
     C           DISP      BEGSR                           ** DISP   **
     C**
     C**   Format details for correct screen
     C**
     C********** SCNNO     CASEQ0         FILL1                                               CAS006
     C**********           CAS            FILL2                                               CAS006
     C**********           END                                                                CAS006
     C                     SELEC                                                              CAS006
     C           SCNNO     WHEQ 0                                                             CAS006
     C                     EXSR FILL1                                                         CAS006
     C           SCNNO     WHEQ 1                                                             CAS006
     C           CAS006    ANDEQ'Y'                                                           CAS006
     C                     EXSR FILL3                                                         CAS006
     C                     OTHER                                                              CAS006
     C                     EXSR FILL2                                                         CAS006
     C                     ENDSL                                                              CAS006
     **
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  FILL1  - Subroutine to fill First Screen fields.             *
      *                                                               *
      *  Called by: DISP                                              *
      *  Calls: ZSEDIT, ZDATE2                                        *
      *         P001                                                  *   S01496
      *                                                               *
      *****************************************************************
      *
     C           FILL1     BEGSR                           *** FILL1 *****
     C**
     C**   Show first screen is filled
     C**
     C                     Z-ADD1         TOPNO
     C                     Z-ADD1         SCNNO
     C**
     C**   Enable ROLLUP but not ROLLDOWN
     C**
     C                     SETOF                     03
     C                     SETON                     02
     C**
     C** Access client record for report name
     C**
     C                     MOVE TCNR      SCNUM
     C***********TCNR      CHAINCLINTCBF             26                   S01117
     C************IN26     IFEQ '0'                                       S01117
     C***********RECI      ANDNE'*'                                       S01117
     C***********          MOVELCRNM      SCRNM                           S01117
     C                     MOVELTCNR      WCSNM  10                       S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM WCSNM     @KEY1  10                       S01117
     C                     PARM           @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVELBBCRNM    SCRNM                           S01117
     C*                                                                   S01117
     C                     ELSE
     C                     MOVELTCNR      SCRNM
     C                     END
     C**
     C** Access security record for report name
     C**
     C                     MOVE TDSS      STDSS
     C           TDSS      CHAINSECTYDF              26
     C           *IN26     IFEQ '0'
     C           RECI      IFEQ '*'
     C                     SETON                     26
     C                     END
     C                     END
     C           *IN26     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVELPROGRM    DBPGM
     C                     MOVE *BLANKS   DBKEY            ************
     C                     MOVELTDSS      DBKEY            * DATABASE *
     C                     MOVE 'SECTY'   DBFILE           * ERROR 03 *
     C                     Z-ADD03        DBASE            ************
     C                     SETON                       U7U8
     C                     MOVE '0'       RTNC
     C                     EXSR RETSR
     C                     ELSE
     C                     MOVELSRPN      SSRPN
     C                     END
     C**
     C** Access investment type record for processing type
     C**
     C           SITP      CHAININVTO                26
     C           *IN26     IFEQ '0'
     C           RECI      IFEQ '*'
     C                     SETON                     26
     C                     END
     C                     END
     C           *IN26     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVELPROGRM    DBPGM
     C                     MOVE *BLANKS   DBKEY            ************
     C                     MOVELSITP      DBKEY            * DATABASE *
     C                     MOVE 'INVTP'   DBFILE           * ERROR 04 *
     C                     Z-ADD04        DBASE            ************
     C                     SETON                       U7U8
     C                     MOVE '0'       RTNC
     C                     EXSR RETSR
     C                     END
     C**
     C**  Get nominal currency decimal places.                            E13547
     C**
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR'  @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM TNMC      @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C                     Z-ADDA6NBDP    NCDP    10                      S01117
     C**                                                                  S01117
     C***********          MOVEL*BLANKS   KEY12  12                E13547 S01117
     C***********          MOVEL'20'      KEY12                    E13547 S01117
     C***********          MOVE '1'       WFLD4   4                E13547 S01117
     C***********          MOVELTNMC      WFLD4                    E13547 S01117
     C***********          MOVE WFLD4     KEY12                    E13547 S01117
     C***********KEY12     CHAINTABTG10F             26            E13547 S01117
     C************IN26     IFEQ '1'                                E13547 S01117
     C************IN26     OREQ '0'                                E13547 S01117
     C***********RECI      ANDEQ'*'                                E13547 S01117
     C***********          MOVELPROGRM    DBPGM                    E13547 S01117
     C***********          Z-ADD05        DBASE            ********E13547 S01117
     C***********          MOVELKEY12     DBKEY            * DATABASE3547 S01117
     C***********          MOVE 'TABLE'   DBFILE           * ERROR 05 547 S01117
     C***********          SETON                       U7U8********E13547 S01117
     C***********          MOVE '0'       RTNC                     E13547 S01117
     C***********          EXSR RETSR                              E13547 S01117
     C***********          END                                     E13547 S01117
     C***********          Z-ADDCDP       NCDP    10               E24773 S01117
     C**                                                                  E13547
     C**  Format nominal
     C**                                                                  E13547
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE NOML      ZFLD15
     C                     MOVE 'L'       ZECODE
     C                     Z-ADDTNMD      ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SNOML
     C**
     C**  Format price/discount/yield
     C**
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE TPDY      ZFLD15
     C                     MOVE 'L'       ZECODE
     C                     Z-ADD8         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    STPDY
     C**
     C** Format value date
     C**
     C                     Z-ADDTDVD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    STDVD
     C**
     C**  Format reallowance/sign
     C**
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE RALL      ZFLD15
     C                     MOVE 'L'       ZECODE
     C                     Z-ADD5         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SRALL
     C**
     C** Format trade date
     C**
     C                     Z-ADDTDDT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    STDDT
     C**
     C** Move other fields to screen
     C**
     C                     MOVE TINC      STINC
     C                     MOVE TDTP      STDTP
     C***********          MOVE TDBR      STDBR                           S01117
     C                     MOVE TDBA      STDBA                           S01117
     C                     MOVE TDBK      STDBK
     C                     MOVE ORBR      SORBR                           S01117
     C                     MOVE PRFC      SPRFC                           S01117
     C                     MOVE TMKC      STMKC
     C                     MOVE TCAP      STCAP
     C                     MOVE TDID      STDID
     C                     MOVE TSUB      STSUB
     C                     MOVE LKRF      SLKRF
     C                     MOVE TDMI      STDMI
     C                     MOVE AIIP      SAIIP
     C                     MOVE TDNR      STDNR
     C**                                                                  CPB002
     C           BGN4ST    IFEQ 'Y'                                       CPB002
     C           ORDE      ANDNE*HIVAL                                    CPB002
     C                     MOVE ORDE      SORDE                           CPB002
     C                     ELSE                                           CPB002
     C                     MOVE *BLANKS   SORDE                           CPB002
     C                     ENDIF                                          CPB002
     C**                                                                  S01496
     C           S01496    IFEQ 'Y'                                       S01496
     C                     EXSR P001                                      S01496
     C                     END                                            S01496
     C**
     C**  TRADE BASIS IS 'Y'
     C**
     C           STBS      IFEQ 'Y'
     C           STBS      OREQ 'D'
     C**
     C                     SETON                     12
     C**
     C**  Format price
     C**
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE PRIC      ZFLD15
     C                     MOVE 'L'       ZECODE
     C                     Z-ADD8         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SPRIC
     C                     END
      *                                                                                       CGL031
      **  Format Fiscal Price                                                                 CGL031
      *                                                                                       CGL031
     C           CGL031    IFEQ 'Y'                                                           CGL031
     C                     MOVE *BLANKS   ZFLD15                                              CGL031
     C**********           MOVE FSPP      ZFLD15                                       CGL031 233776
     C                     MOVE FSPR      ZFLD15                                              233776
     C                     MOVE 'L'       ZECODE                                              CGL031
     C                     Z-ADD8         ZDECS                                               CGL031
     C                     EXSR ZSEDIT                                                        CGL031
     C                     MOVE ZOUT21    SFSPP                                               CGL031
     C                     ENDIF                                                              CGL031
     C**
     C**  PROCESSING TYPE IS 4 OR 7
     C**
     C           PROT      IFEQ '4'
     C           PROT      OREQ '7'
     C**
     C                     SETON                     14
     C**
     C**  Format ex-dividend
     C**
     C                     MOVE EXDV      SEXDV
     C                     END
     C**
     C**  PROCESSING TYPE IS 8
     C**
     C           PROT      IFEQ '8'
     C**
     C                     SETON                     15
     C**
     C**  Format current factor
     C**
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE TCFC      ZFLD15
     C                     MOVE 'L'       ZECODE
     C**********           Z-ADD8         ZDECS                           052254
     C                     Z-ADD9         ZDECS                           052254
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    STCFC
     C                     END
     C/COPY WNCPYSRC,SE0250C044
     C**
     C****PROCESSING*TYPE*IS*1,3,5,6,8*&*TRADE*BASIS*IS*P,Y************   S01176
     C**  PROCESSING TYPE IS 1,3,5,6,8,9 & TRADE BASIS IS P,Y             S01176
     C**
     C           PROT      IFEQ '1'
     C           PROT      OREQ '3'
     C           PROT      OREQ '5'
     C           PROT      OREQ '6'
     C           PROT      OREQ '8'
     C           PROT      OREQ '9'                                       S01176
     C           STBS      IFEQ 'P'
     C           STBS      OREQ 'Y'
     C**
     C                     SETON                     11
     C**
     C**  Format days adjustment/ sign
     C**
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE DADJ      ZFLD15
     C                     MOVE 'L'       ZECODE
     C                     Z-ADD0         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SDADJ
     C**
     C**  Format interest amount / sign
     C**
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE ITRA      ZFLD15
     C                     MOVE 'L'       ZECODE
     C***********          Z-ADDCDP       ZDECS                           S01117
     C                     Z-ADDA6NBDP    ZDECS                           S01117
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SITRA
     C**
     C**  Format coupon rate
     C**
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE TDCR      ZFLD15
     C                     MOVE 'L'       ZECODE
     C                     Z-ADD7         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    STDCR
     C**
     C**  Format other fields
     C**
     C                     MOVE ACIN      SACIN
     C                     MOVE ADIN      SADIN
     C                     END
     C                     END
      *                                                                   CAC002
      **  If Analytical Accounting module is installed...                 CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
      *                                                                   CAC002
      **  Access Securities Customer Details                              CAC002
      *                                                                   CAC002
     C                     MOVE TCNR      ATCNR                           CAC002
     C                     CALL 'AOSECSR0'                                CAC002
     C                     PARM *BLANKS   @RTCD   7                       CAC002
     C                     PARM '*KEY   ' @OPTN   7                       CAC002
     C                     PARM           ATCNR   6                       CAC002
     C           SDSECS    PARM SDSECS    DSSDY                           CAC002
      *                                                                   CAC002
      **  Database error if not found                                     CAC002
      *                                                                   CAC002
     C           @RTCD     IFNE *BLANKS                                   CAC002
     C           *LOCK     IN   LDA                                       CAC002
     C                     MOVELPROGRM    DBPGM                           CAC002
     C                     MOVE *BLANKS   DBKEY                           CAC002
     C                     MOVELTCNR      DBKEY            ************   CAC002
     C                     MOVE 'SDSECSPD'DBFILE           * DBERR 09 *   CAC002
     C                     Z-ADD9         DBASE            ************   CAC002
     C                     SETON                       U7U8               CAC002
     C                     MOVE '0'       RTNC                            CAC002
     C                     EXSR RETSR                                     CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
      **  Format Settlement Ccy, Book and Transaction Profit Centres      CAC002
      *                                                                   CAC002
     C                     MOVE SETC      SSCCY                           CAC002
     C                     MOVE BPRC      SBPRC                           CAC002
     C           BFCLAS    IFEQ 'S'                                       CAC002
     C           BFCLAS    OREQ 'D'                                       CAC002
     C                     MOVE TPRC      STPRC                           CAC002
     C                     SETON                     66                   CAC002
     C                     ELSE                                           CAC002
     C                     SETOF                     66                   CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C                     ENDIF                                          CAC002
     C/COPY WNCPYSRC,SE0250C005
      *                                                                   CAC005
      ** If CAC005 is on, retrieve user book from AOBKPCR0.               CAC005
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     CALL 'AOBKPCR0'                                CAC005
     C                     PARM           PRTCD   7                       CAC005
     C                     PARM '*USER  ' POPTN   7                       CAC005
     C           PMBKCD    PARM *BLANKS   PMBKCD  2                       CAC005
     C           PMPRFC    PARM *BLANKS   PMPRFC  4                       CAC005
     C                     PARM TDBK      PMPSBK  2                       CAC005
     C           PRTCD     IFEQ *BLANKS                                   CAC005
     C                     MOVELPMBKCD    STDBK                           CAC005
     C                     ENDIF                                          CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CSE039
      ** Format SWIFT status code & narrative if CSE039 is ON             CSE039
      *                                                                   CSE039
     C                     MOVE *BLANKS   KTDRF                           CSE039
     C                     MOVE STDRF     KTDRF                           CSE039
     C                     MOVE 'T'       KTTYP                           CSE039
      *                                                                   CSE039
     C           KSMVTS    CHAINSEMVTSL2             27                   CSE039
      *                                                                   CSE039
     C           *IN27     IFEQ *OFF                                      CSE039
     C           STDRF     ANDEQTMTRRF                                    CSE039
     C                     MOVELTMSWSC    SSSRC                           CSE039
      *                                                                   CSE039
     C                     CALL 'AOSCODR0'                                CSE039
     C                     PARM           PRTCD                           CSE039
     C                     PARM '*KEY   ' POPTN                           CSE039
     C                     PARM TMSWSC    PCODE   4                       CSE039
     C                     PARM 'S'       PCDTP   1                       CSE039
     C                     PARM           PCDDP   4                       CSE039
     C           SDSCOD    PARM SDSCOD    DSSDY                           CSE039
      *                                                                   CSE039
     C           PRTCD     IFEQ *BLANKS                                   CSE039
     C                     MOVELSRCDNR    SSRNA                           CSE039
     C                     ELSE                                           CSE039
     C                     MOVEL*BLANKS   SSRNA                           CSE039
     C                     ENDIF                                          CSE039
      *                                                                   CSE039
     C                     ELSE                                           CSE039
     C                     MOVEL*BLANKS   SSSRC                           CSE039
     C                     MOVEL*BLANKS   SSRNA                           CSE039
     C                     ENDIF                                          CSE039
     C**
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  FILL2  - Subroutine to fill Second Screen fields.            *
      *                                                               *
      *  Called by: DISP                                              *
      *  Calls: ZSEDIT                                                *
      *                                                               *
      *****************************************************************
      *
     C           FILL2     BEGSR                           *** FILL2 *****
     C**
     C**   Enable ROLLDOWN  , Disenable ROLLUP
     C**
     C                     SETOF                     02
     C                     SETON                     03
      *                                                                   S01401
      ***  If the MT5xx switchable feature is present then enable         S01401
      ***  Rollup from the second screen.                                 S01401
      *                                                                   S01401
     C           S01401    IFEQ 'Y'                                       S01401
     C/COPY WNCPYSRC,SE0250C049
     C                     SETON                     02                   S01401
     C                     END                                            S01401
     C**
     C**   Show second screen is filled
     C**
      ** Adjust Screen Number when CAS006 is installed to accomodate new screen               CAS006
      *                                                                                       CAS006
     C           CAS006    IFEQ 'N'                                                           CAS006
     C                     Z-ADD2         TOPNO
     C                     Z-ADD2         SCNNO
     C                     ELSE                                                               CAS006
     C                     Z-ADD3         TOPNO                                               CAS006
     C                     Z-ADD3         SCNNO                                               CAS006
     C                     ENDIF                                                              CAS006
     C**                                                                  S01176
     C**   Retrieve Settlement Currency Dec places                        S01176
     C**                                                                  S01176
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR'  @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SETC      @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C***********          MOVEL*BLANKS   KEY12  12                S01176 S01117
     C***********          MOVEL'20'      KEY12                    S01176 S01117
     C***********          MOVE '1'       WFLD4   4                S01176 S01117
     C***********          MOVELSETC      WFLD4                    S01176 S01117
     C***********          MOVE WFLD4     KEY12                    S01176 S01117
     C***********KEY12     CHAINTABTG10F             26            S01176 S01117
     C************IN26     IFEQ '1'                                S01176 S01117
     C************IN26     OREQ '0'                                S01176 S01117
     C***********RECI      ANDEQ'*'                                S01176 S01117
     C***********          MOVE '06'      DBASE             *******S01176 S01117
     C***********          MOVEL'TABLE'   DBFILE            * DATABASE176 S01117
     C***********          MOVELKEY12     DBKEY             * ERROR 06 76 S01117
     C***********          SETON                     U7U8   *******S01176 S01117
     C***********          MOVE '0'       RTNC                     S01176 S01117
     C***********          EXSR RETSR                              S01176 S01117
     C***********          END                                     S01176 S01117
     C***********          MOVE CDP       SDP     10               S01176 S01117
     C                     Z-ADDA6NBDP    SDP     10                      S01117
     C**
     C**  Format exchange rate
     C**
     C                     MOVE *BLANKS   ZFLD15
      *                                                                   CAC002
     C           BGN0ST    IFNE 'Y'                                       CAC002
     C           SETC      OREQ TNMC                                      CAC002
     C                     MOVE TDER      ZFLD15
     C                     ELSE                                           CAC002
     C           TDTP      IFEQ 'TP'                                      CAC002
     C           TMDI      ANDEQ'M'                                       CAC002
     C           TDTP      OREQ 'TS'                                      CAC002
     C           TMDI      ANDEQ'D'                                       CAC002
     C           TDER      ADD  FXMR      WTDER  138                      CAC002
     C                     ELSE                                           CAC002
     C           TDER      SUB  FXMR      WTDER                           CAC002
     C                     ENDIF                                          CAC002
     C                     MOVE WTDER     ZFLD15                          CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C                     MOVE 'L'       ZECODE
     C                     Z-ADD8         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    STDER
     C**
     C**  Format base currency rate
     C**
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE TBCR      ZFLD15
     C                     MOVE 'L'       ZECODE
     C                     Z-ADD8         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    STBCR
     C**
     C**  Format broker commission amount
     C**
     C                     MOVE *BLANKS   ZFLD15
     C/COPY WNCPYSRC,SE0250C006
     C                     MOVE TBCA      ZFLD15
     C                     MOVE 'L'       ZECODE
     C***********          Z-ADDCDP       ZDECS                    E13547 E24773
     C/COPY WNCPYSRC,SE0250C007
     C                     Z-ADDNCDP      ZDECS                           E24773
     C/COPY WNCPYSRC,SE0250C008
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    STBCA
     C**
     C**  Format customer commission amount
     C**
     C/COPY WNCPYSRC,SE0250C009
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE TCCA      ZFLD15
     C                     MOVE 'L'       ZECODE
     C***********          Z-ADDCDP       ZDECS                    E13547 E24773
     C/COPY WNCPYSRC,SE0250C010
     C                     Z-ADDNCDP      ZDECS                           E24773
     C/COPY WNCPYSRC,SE0250C011
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    STCCA
     C**
     C**  Format charges 1 amount
     C**
     C/COPY WNCPYSRC,SE0250C012
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE TCA1      ZFLD15
     C                     MOVE 'L'       ZECODE
     C***********          Z-ADDCDP       ZDECS                    E13547 E24773
     C/COPY WNCPYSRC,SE0250C013
     C                     Z-ADDNCDP      ZDECS                           E24773
     C/COPY WNCPYSRC,SE0250C014
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    STCA1
     C**
     C**  Format charges 2 amount
     C**
     C/COPY WNCPYSRC,SE0250C015
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE TCA2      ZFLD15
     C                     MOVE 'L'       ZECODE
     C***********          Z-ADDCDP       ZDECS                    E13547 E24773
     C/COPY WNCPYSRC,SE0250C016
     C                     Z-ADDNCDP      ZDECS                           E24773
     C/COPY WNCPYSRC,SE0250C017
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    STCA2
     C**
     C**  Format charges 3 amount
     C**
     C/COPY WNCPYSRC,SE0250C018
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE TCA3      ZFLD15
     C                     MOVE 'L'       ZECODE
     C***********          Z-ADDCDP       ZDECS                    E13547 E24773
     C/COPY WNCPYSRC,SE0250C019
     C                     Z-ADDNCDP      ZDECS                           E24773
     C/COPY WNCPYSRC,SE0250C020
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    STCA3
     C**                                                                  S01176
     C**  Format charges 5 amount                                         S01176
     C**                                                                  S01176
     C/COPY WNCPYSRC,SE0250C021
     C                     MOVE *BLANKS   ZFLD15                          S01176
     C                     MOVE TCA5      ZFLD15                          S01176
     C                     MOVE 'L'       ZECODE                          S01176
     C***********          Z-ADDCDP       ZDECS                    E13547 E24773
     C/COPY WNCPYSRC,SE0250C022
     C                     Z-ADDNCDP      ZDECS                           E24773
     C/COPY WNCPYSRC,SE0250C023
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT21    STCA5                           S01176
     C**                                                                  S01176
     C**  Format charges 6 amount                                         S01176
     C**                                                                  S01176
     C/COPY WNCPYSRC,SE0250C024
     C                     MOVE *BLANKS   ZFLD15                          S01176
     C                     MOVE TCA6      ZFLD15                          S01176
     C                     MOVE 'L'       ZECODE                          S01176
     C***********          Z-ADDCDP       ZDECS                    E13547 E24773
     C/COPY WNCPYSRC,SE0250C025
     C                     Z-ADDNCDP      ZDECS                           E24773
     C/COPY WNCPYSRC,SE0250C026
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT21    STCA6                           S01176
     C**                                                                  S01176
     C**  Format charges 7 amount                                         S01176
     C**                                                                  S01176
     C/COPY WNCPYSRC,SE0250C027
     C                     MOVE *BLANKS   ZFLD15                          S01176
     C                     MOVE TCA7      ZFLD15                          S01176
     C                     MOVE 'L'       ZECODE                          S01176
     C***********          Z-ADDCDP       ZDECS                    E13547 E24773
     C/COPY WNCPYSRC,SE0250C028
     C                     Z-ADDNCDP      ZDECS                           E24773
     C/COPY WNCPYSRC,SE0250C029
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT21    STCA7                           S01176
     C**
     C****Format*charges*other*amount***********                          S01176
     C**  Format charges 4 amount                                         S01176
     C/COPY WNCPYSRC,SE0250C030
     C**
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE TCA4      ZFLD15                          S01176
     C                     MOVE 'L'       ZECODE
     C***********          Z-ADDCDP       ZDECS                    E13547 E24773
     C/COPY WNCPYSRC,SE0250C031
     C                     Z-ADDNCDP      ZDECS                           E24773
     C/COPY WNCPYSRC,SE0250C032
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    STCA4                           S01176
     C**
     C****Format*local*tax*amount*****************************************S01176
     C**  Format tax amount                                               S01176
     C**
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE TAXA      ZFLD15                          S01176
     C                     MOVE 'L'       ZECODE
     C***********          Z-ADDCDP       ZDECS                    E13547 E24773
     C                     Z-ADDNCDP      ZDECS                           E24773
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    STAXA                           S01176
      *                                                                                       CGL031
      ** Format EU Tax Amount in Nominal Currency                                             CGL031
      *                                                                                       CGL031
     C           CGL031    IFEQ 'Y'                                                           CGL031
     C                     MOVE *BLANKS   ZFLD15                                              CGL031
     C                     MOVE EUTX      ZFLD15                                              CGL031
     C                     MOVE 'L'       ZECODE                                              CGL031
     C**********           Z-ADD0         ZDECS                                        CGL031 233964
     C                     Z-ADDA6NBDP    ZDECS                                               233964
     C                     EXSR ZSEDIT                                                        CGL031
     C                     MOVE ZOUT21    SEUTX                                               CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C**                                                                  S01176
     C**  Format Broker Commission rebate                                 S01176
     C**                                                                  S01176
     C                     MOVE *BLANKS   ZFLD15                          S01176
     C                     MOVE BCMR      ZFLD15                          S01176
     C                     MOVE 'L'       ZECODE                          S01176
     C***********          Z-ADDCDP       ZDECS                    E13547 E24773
     C                     Z-ADDNCDP      ZDECS                           E24773
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT21    SBCMR                           S01176
     C**                                                                  S01176
     C**  Format Customer Commission Rebate                               S01176
     C**                                                                  S01176
     C                     MOVE *BLANKS   ZFLD15                          S01176
     C                     MOVE CCMR      ZFLD15                          S01176
     C                     MOVE 'L'       ZECODE                          S01176
     C***********          Z-ADDCDP       ZDECS                    E13547 E24773
     C                     Z-ADDNCDP      ZDECS                           E24773
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT21    SCCMR                           S01176
     C**                                                                  S01176
     C**  Format Tax Rebate                                               S01176
     C**                                                                  S01176
     C                     MOVE *BLANKS   ZFLD15                          S01176
     C                     MOVE TXRB      ZFLD15                          S01176
     C                     MOVE 'L'       ZECODE                          S01176
     C***********          Z-ADDCDP       ZDECS                    E13547 E24773
     C                     Z-ADDNCDP      ZDECS                           E24773
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT21    STXRB                           S01176
     C/COPY WNCPYSRC,SE0250C033
     C**                                                                  S01176
     C**  Add and format Countervalue Settled                             S01176
     C**                                                                  S01176
     C                     Z-ADD*ZEROS    TVSA   150                      S01176
     C           TVSN      ADD  TVSP      TVSA                            S01176
     C                     MOVE TVSA      ZFLD15                          S01176
     C                     MOVE 'L'       ZECODE                          S01176
     C                     Z-ADDSDP       ZDECS                           S01176
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT21    STVSA                           S01176
     C**                                                                  S01176
     C**  Add and format Nominal Settled                                  S01176
     C**                                                                  S01176
     C                     Z-ADD*ZEROS    TNSA   150                      S01176
     C           TNSN      ADD  TNSP      TNSA                            S01176
     C                     MOVE TNSA      ZFLD15                          S01176
     C                     MOVE 'L'       ZECODE                          S01176
     C**********           Z-ADDCDP       ZDECS                    E13547 E20088
     C                     Z-ADDTNMD      ZDECS                           E20088
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT21    STNSA                           S01176
     C**                                                                  S01176
     C**  Convert and format Countervalue                                 S01176
     C**                                                                  S01176
     C                     MOVE *BLANKS   ZAMTCI                          S01176
     C                     MOVE *BLANKS   ZEXCH                           S01176
     C                     MOVE *BLANKS   ZCCYI                           S01176
     C                     MOVE *BLANKS   ZCCYO                           S01176
     C                     MOVE *BLANKS   ZFLD15                          S01176
     C                     MOVE TCTR      ZAMTCI                          S01176
     C                     MOVE TDER      ZEXCH                           S01176
     C                     MOVE TMDI      ZMD                             S01176
     C                     MOVE TNMC      ZCCYI                           S01176
     C                     MOVE SETC      ZCCYO                           S01176
     C                     Z-ADDNCDP      ZCDPI                           S01117
     C                     Z-ADDSDP       ZCDPO                           S01117
     C                     EXSR ZCONV                                     S01176
     C                     MOVE ZAMTCO    ZFLD15                          S01176
     C                     MOVE 'L'       ZECODE                          S01176
     C                     Z-ADDSDP       ZDECS                           S01176
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT21    STCTR                           S01176
     C/COPY WNCPYSRC,SE0250C034
     C**
     C** Access client record for deliver from name
     C**
     C***********DELF      CHAINCLINTCBF             26                   S01117
     C************IN26     IFEQ '0'                                       S01117
     C***********RECI      ANDNE'*'                                       S01117
     C***********          MOVELCSNM      SDELF                           S01117
     C                     MOVELDELF      WCSNM  10                       S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM WCSNM     @KEY1  10                       S01117
     C                     PARM           @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVELBBCSSN    SDELF                           S01117
     C                     ELSE
     C                     MOVELDELF      SDELF
     C                     END
     C**
     C** Access client record for deliver to name
     C**
     C***********DELT      CHAINCLINTCBF             26                   S01117
     C************IN26     IFEQ '0'                                       S01117
     C***********RECI      ANDNE'*'                                       S01117
     C***********          MOVELCSNM      SDELT                           S01117
     C                     MOVELDELT      WCSNM  10                       S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM WCSNM     @KEY1  10                       S01117
     C                     PARM           @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVELBBCSSN    SDELT                           S01117
     C                     ELSE
     C                     MOVELDELT      SDELT
     C                     END
     C**
     C**  Format other fields
     C**
     C                     MOVE SETC      SSETC
     C                     MOVE PCOD      SPCOD
     C                     MOVE TMDI      STMDI
     C                     MOVE SMTH      SSMTH
     C                     MOVE PYFM      SPYFM
     C***********          MOVE PYFB      SPYFB                           S01117
     C                     MOVE PYFA      SPYFA                           S01117
     C                     MOVE PAYT      SPAYT
     C***********          MOVE PYTB      SPYTB                           S01117
     C                     MOVE PYTA      SPYTA                           S01117
     C                     MOVE TDFA      STDFA
     C                     MOVE ASNM      SASNM
     C                     MOVE DTFA      SDTFA
     C                     MOVE DFFA      SDFFA                           S01175
     C                     MOVE TDSI      STDSI
     C*                                                                   S01486
     C** Format portfolio reference for output to screen                  S01486
     C           PTFR      IFEQ '9997'                                    S01486
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C                     MOVE FCR997    SPTFR                           S01486
     C                     ELSE                                           S01486
     C                     MOVE PTFR      SPTFR                           S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C**                                                                  S01486
     C**  Format FX rate to portfolio currency for output                 S01486
     C           SPXR      IFNE 0                                         S01486
     C                     MOVE *BLANKS   ZFLD15                          S01486
     C                     MOVE SPXR      ZFLD15                          S01486
     C                     MOVE 'L'       ZECODE                          S01486
     C                     Z-ADD8         ZDECS                           S01486
     C                     EXSR ZSEDIT                                    S01486
     C                     MOVE ZOUT21    SSPXR                           S01486
     C                     MOVE SPMD      SSPMD                           S01486
     C                     ELSE                                           S01486
     C                     MOVE *BLANKS   SSPXR                           S01486
     C                     MOVE *BLANKS   SSPMD                           S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C                     MOVE CLTY      SCLTY
     C                     MOVE PRYC      SPRYC
     C                     MOVE TBCC      STBCC
     C                     MOVE TCCC      STCCC
     C                     MOVE TCC1      STCC1
     C                     MOVE TCC2      STCC2
     C                     MOVE TCC3      STCC3
     C                     MOVE AUTS      SAUTS                           S01176
     C                     MOVE TCC4      STCC4                           S01176
     C                     MOVE TCC5      STCC5                           S01176
     C                     MOVE TCC6      STCC6                           S01176
     C                     MOVE TCC7      STCC7                           S01176
      *                                                                   187888
      ** Withholding Tax                                                  187888
      *                                                                   187888
     C           CSE023    IFEQ 'Y'                                       187888
     C           WHTX      ANDNE*ZERO                                     187888
     C                     MOVE *BLANKS   ZFLD15                          187888
     C                     MOVE WHTX      ZFLD15                          187888
     C                     Z-ADDNCDP      ZDECS                           187888
     C                     MOVE 'J'       ZECODE                          187888
     C                     EXSR ZSEDIT                                    187888
     C                     MOVE ZOUT21    SWHTX                           187888
     C                     ELSE                                           187888
     C                     MOVE *BLANKS   SWHTX                           187888
     C                     ENDIF                                          187888
      *                                                                   187888
     C/COPY WNCPYSRC,SE0250C035
      *                                                                   CAC002
      **  If Analytical Accounting is installed and nominal currency      CAC002
      **  is not the same as the settlement currency...                   CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C           SETC      ANDNETNMC                                      CAC002
      *                                                                   CAC002
      **  Format Margin Points                                            CAC002
      *                                                                   CAC002
     C                     MOVE *BLANKS   ZFLD15                          CAC002
     C                     MOVE FXMP      ZFLD15                          CAC002
     C                     MOVE 'L'       ZECODE                          CAC002
     C                     Z-ADD2         ZDECS                           CAC002
     C                     EXSR ZSEDIT                                    CAC002
     C                     MOVE ZOUT21    SFXMP                           CAC002
      *                                                                   CAC002
      **  Format Margin Amount                                            CAC002
      *                                                                   CAC002
     C                     MOVE *BLANKS   ZFLD15                          CAC002
     C                     MOVE MAMT      ZFLD15                          CAC002
     C                     MOVE 'J'       ZECODE                          CAC002
     C                     Z-ADDSDP       ZDECS                           CAC002
     C                     EXSR ZSEDIT                                    CAC002
     C                     MOVE ZOUT21    SMAMT                           CAC002
     C                     SETON                     67                   CAC002
      *                                                                   CAC002
     C                     ELSE                                           CAC002
     C                     SETOF                     67                   CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CEU005
     C           CEU005    IFEQ 'Y'                                       CEU005
     C                     MOVE ICCY      SICCY                           CEU005
     C                     ENDIF                                          CEU005
     C**
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************                       CAS006
      *                                                               *                       CAS006
      *  FILL3  - Subroutine to fill CAS006's Screen                  *                       CAS006
      *                                                               *                       CAS006
      *****************************************************************                       CAS006
      *                                                                                       CAS006
     C           FILL3     BEGSR                                                              CAS006
      *                                                                                       CAS006
      ** Show this screen is filled                                                           CAS006
      *                                                                                       CAS006
     C                     Z-ADD2         TOPNO                                               CAS006
     C                     Z-ADD2         SCNNO                                               CAS006
      *                                                                                       CAS006
      ** Enable ROLLUP and ROLLDOWN                                                           CAS006
      *                                                                                       CAS006
     C                     MOVE '1'       *IN03                                               CAS006
     C                     MOVE '1'       *IN02                                               CAS006
      *                                                                                       CAS006
      ** Access client record for report name                                                 CAS006
      *                                                                                       CAS006
     C                     MOVE TCNR      SCNUM                                               CAS006
     C                     MOVELTCNR      WCSNM                                               CAS006
     C                     CALL 'AOCUSTR0'                                                    CAS006
     C                     PARM *BLANKS   @RTCD                                               CAS006
     C                     PARM '*KEY   ' @OPTN                                               CAS006
     C                     PARM WCSNM     @KEY1                                               CAS006
     C                     PARM           @KYST                                               CAS006
     C           SDCUST    PARM SDCUST    DSSDY                                               CAS006
     C           @RTCD     IFEQ *BLANKS                                                       CAS006
     C                     MOVELBBCRNM    SCRNM                                               CAS006
     C                     ELSE                                                               CAS006
     C                     MOVELTCNR      SCRNM                                               CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
      ** Access security record for report name                                               CAS006
      *                                                                                       CAS006
     C                     MOVE TDSS      STDSS                                               CAS006
     C           TDSS      CHAINSECTYDF              26                                       CAS006
     C           *IN26     IFEQ '0'                                                           CAS006
     C           RECI      ANDEQ'*'                                                           CAS006
     C                     MOVE '1'       *IN26                                               CAS006
     C                     ENDIF                                                              CAS006
     C           *IN26     IFEQ '1'                                                           CAS006
     C           *LOCK     IN   LDA                                                           CAS006
     C                     MOVELPROGRM    DBPGM                                               CAS006
     C                     MOVE *BLANKS   DBKEY                                               CAS006
     C                     MOVELTDSS      DBKEY                                               CAS006
     C                     MOVE 'SECTY'   DBFILE                                              CAS006
     C                     Z-ADD12        DBASE                                               CAS006
     C                     MOVE '1'       *INU7                                               CAS006
     C                     MOVE '1'       *INU8                                               CAS006
     C                     MOVE '0'       RTNC                                                CAS006
     C                     EXSR RETSR                                                         CAS006
     C                     ELSE                                                               CAS006
     C                     MOVELSRPN      SSRPN                                               CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
      ** Format interest amount / sign                                                        CAS006
      *                                                                                       CAS006
     C                     MOVE *BLANKS   ZFLD15                                              CAS006
     C                     MOVE ITRN      ZFLD15                                              CAS006
     C                     MOVE 'L'       ZECODE                                              CAS006
     C                     Z-ADD2         ZDECS                                               CAS006
     C                     EXSR ZSEDIT                                                        CAS006
     C                     MOVE ZOUT21    #3ITRN                                              CAS006
      *                                                                                       CAS006
      ** Format coupon rate                                                                   CAS006
      *                                                                                       CAS006
     C                     MOVE *BLANKS   ZFLD15                                              CAS006
      *                                                                                       CAS006
     C                     MOVE 'IR'      WSDET   2                                           CAS006
     C           KSEDE     KLIST                                                              CAS006
     C                     KFLD           TDSS                                                CAS006
     C                     KFLD           WSDET                                               CAS006
      *                                                                                       CAS006
     C           KSEDE     CHAINSEDEVDF              26                                       CAS006
     C           *IN26     IFEQ '0'                                                           CAS006
     C                     MOVE SDNN      ZFLD15                                              CAS006
     C                     ELSE                                                               CAS006
     C                     MOVE CPNN      ZFLD15                                              CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     MOVE 'L'       ZECODE                                              CAS006
     C                     Z-ADD7         ZDECS                                               CAS006
     C                     EXSR ZSEDIT                                                        CAS006
     C                     MOVE ZOUT21    #3NTCR                                              CAS006
      *                                                                                       CAS006
     C**********           MOVE CCRK      WZCCRK 117                                   CAS006 228106
     C**********           MOVE CLQP      WZCLQP 117                                   CAS006 228106
     C                     MOVE CRSK      WZCCRK 158                                          228105
     C                     MOVE LQPR      WZCLQP 158                                          228105
     C                     MOVE PRICN     WPRICN 158                                          CAS006
      *                                                                                       CAS006
      ** Format Field with correct number of decimal places                                   CAS006
      *                                                                                       CAS006
     C                     MOVE *BLANKS   ZFLD15                                              CAS006
     C                     MOVE WZCCRK    ZFLD15                                              CAS006
     C                     MOVE *BLANKS   ZECODE                                              CAS006
     C**********           Z-ADD7         ZDECS                                        CAS006 228105
     C                     Z-ADD8         ZDECS                                               228105
     C                     EXSR ZSEDIT                                                        CAS006
     C                     MOVE ZOUT21    #3CCRK                                              CAS006
      *                                                                                       CAS006
     C                     MOVE *BLANKS   ZFLD15                                              CAS006
     C                     MOVE WZCLQP    ZFLD15                                              CAS006
     C                     MOVE *BLANKS   ZECODE                                              CAS006
     C**********           Z-ADD7         ZDECS                                        CAS006 228105
     C                     Z-ADD8         ZDECS                                               228105
     C                     EXSR ZSEDIT                                                        CAS006
     C                     MOVE ZOUT21    #3CLQP                                              CAS006
      *                                                                                       CAS006
     C                     MOVE *BLANKS   ZFLD15                                              CAS006
     C                     MOVE WPRICN    ZFLD15                                              CAS006
     C                     MOVE *BLANKS   ZECODE                                              CAS006
     C                     Z-ADD8         ZDECS                                               CAS006
     C                     EXSR ZSEDIT                                                        CAS006
     C                     MOVE ZOUT21    #3PRCN                                              CAS006
      *                                                                                       CAS006
     C                     ENDSR                                                              CAS006
      *                                                                                       CAS006
      *****************************************************************                       CAS006
      /EJECT                                                                                  CAS006
      *****************************************************************
      *                                                               *
      *  LINK   - Subroutine to process lower level Enquiry.          *
      *                                                               *
      *  Called by: Main Processing.                                  *
      *  Calls: Program obtained from SECOND                          *
      *                                                               *
      *****************************************************************
      *
0740 C           LINK      BEGSR                           *** LINK ******
0741 C**
     C**   Access Linked Enquiry Control File for program and option
     C**
     C           LKEY      KLIST
     C                     KFLD           PGMNO
     C                     KFLD           OPTN
     C**
     C                     MOVE *BLANKS   OPTN
     C                     MOVE SACTN     OPTN
     C********** LKEY      CHAINSECONDF              42                                     MD058079
     C                     CALL 'AOSECOR0'             90                                   MD058079
     C                     PARM *BLANKS   @RTCD   7                                         MD058079
     C                     PARM '*KEY'    @OPTN   7                                         MD058079
     C                     PARM PGMNO     @XPGM   8                                         MD058079
     C                     PARM OPTN      @XOPT   2                                         MD058079
     C           SECOND    PARM SECOND    DSFDY                                             MD058079
     C                     SETOF                     42                                     MD058079
     C           @RTCD     IFNE *BLANKS                                                     MD058079
     C                     SETON                     42                                     MD058079
     C                     ENDIF                                                            MD058079
     C**
     C**   If record not found then entered option is invalid
     C**
     C           *IN42     IFEQ '1'
     C                     SETON                     4042
     C                     MOVE MSG,3     ERMSG
     C**
     C                     ELSE
     C**
     C**   For valid option write out LDA and linked enquiry data area
     C**   and call the program name obtained from SECOND
     C**
     C                     MOVE LSTDRF    RQTDRF
     C                     OUT  SESDS
     C***********          OUT  LDA                                       S01117
     C                     CALL TPGM
     C************LOCK     IN   LDA                                       S01117
     C           *LOCK     IN   SESDS
     C**
     C**   On return from lower level check return code
     C**
     C**   If 0 (Database Error) or 1 (F1 to return to menu)
     C**      then exit to calling program
     C**
     C           RTNC      IFEQ '0'
     C           RTNC      OREQ '1'
     C                     MOVE '1'       *IN01
     C                     END
     C**
     C**   If Return code is 7 (F9 to return to inital enquiry)
     C**      then check if this is the inital enquiry
     C**      and if not return to calling program
     C**
     C           RTNC      IFEQ '7'
     C           ORIG      ANDNEPGMNO
     C                     MOVE '1'       *IN01
     C                     END
     C**
     C                     END
     C**
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  RETSR  - End of Program processing.                          *
      *           Write out LDA and linked enquiry data area and      *
      *           return to the calling program.                      *
      *                                                               *
      *  Called by: Main Processing, FIRST                            *
      *  Calls: None.                                                 *
      *                                                               *
      *****************************************************************
      *
     C           RETSR     BEGSR                           *** RETSR   ***
     C**
     C                     OUT  SESDS
     C           *INU7     IFEQ '1'                                       S01117
     C           *LOCK     IN   LDA                                       CSE010
     C                     OUT  LDA
     C                     EXSR *PSSR                                     S01117
     C                     END                                            S01117
     C**
     C                     SETON                     LR
     C**
     C                     RETRN
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  FIRST  - First Cycle Processing.                             *
      *                                                               *
      *  Called by: Main Processing.                                  *
      *  Calls: RETSR, TRADIN, ZSYSTM                                 *
      *                                                               *
      *****************************************************************
      *
     C           FIRST     BEGSR                           ** FIRST **
     C**
     C**     Access the LDA  and  Linked Enquiry Data Area
     C**
     C************LOCK     IN   LDA
     C           *LOCK     IN   SESDS
      *                                                                                       232543
      ** Check if CGL031 - Taxation on Savings Income is installed                            232543
      *                                                                                       232543
     C                     CALL 'AOSARDR0'                                                    232543
     C                     PARM *BLANKS   PRTCD                                               232543
     C                     PARM '*VERIFY' POPTN                                               232543
     C                     PARM 'CGL031'  PSARD   6                                           232543
      *                                                                                       232543
     C           PRTCD     IFEQ *BLANK                                                        232543
     C                     MOVE 'Y'       CGL031  1                                           232543
     C                     MOVE *ON       *IN73                                               232543
     C                     ELSE                                                               232543
     C                     MOVE 'N'       CGL031                                              232543
     C                     MOVE *OFF      *IN73                                               232543
     C                     ENDIF                                                              232543
      *                                                                                       232543
      ** Database Error (return code other than *NRF and Blanks)                              232543
      *                                                                                       232543
     C           PRTCD     IFNE '*NRF   '                                                     232543
     C           PRTCD     ANDNE*BLANKS                                                       232543
     C           *LOCK     IN   LDA                                                           232543
     C                     MOVEL'SCSARDPD'DBFILE                                              232543
     C                     MOVEL'CGL031'  DBKEY                                               232543
     C                     Z-ADD01        DBASE                                               232543
     C                     OUT  LDA                                                           232543
     C                     MOVE *ON       *INU7                                               232543
     C                     MOVE *ON       *INU8                                               232543
     C                     MOVE *ON       *INLR                                               232543
     C                     EXSR *PSSR                                                         232543
     C                     ENDIF                                                              232543
     C*                                                                   S01393
     C** If called as a restricted linked enquiry set on indicator 79     S01393
     C** for conditioned screen display.                                  S01393
     C*                                                                   S01393
     C           ENQFLG    IFEQ 'Y'                                       S01393
     C                     SETON                     79                   S01393
     C                     END                                            S01393
     C**
     C*******Access*the*ICD*record*1*for*run*date*&*date*format***********S01117
     C***********                                                         S01117
     C***********          EXSR ZSYSTM                                    S01117
     C***********                                                         S01117
     C* Error in ZSYSTM                                                   S01117
     C***********                                                         S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          MOVELPROGRM    DBPGM                           S01117
     C***********          MOVE *BLANKS   DBKEY            ************   S01117
     C***********          MOVEL'ICDR1'   DBKEY            * DATABASE *   S01117
     C***********          MOVE 'TABLE'   DBFILE           * ERROR 01 *   S01117
     C***********          Z-ADD01        DBASE            ************   S01117
     C***********          SETON                       U7U8               S01117
     C***********          MOVE '0'       RTNC                            S01117
     C***********          EXSR RETSR                                     S01117
     C***********          END                                            S01117
     C*                                                                   S01117
     C** read in RUNDAT                                                   S01117
     C*                                                                   S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C                     IN   RUNDT                                     S01117
     C**                                                                  S01117
     C**   Check system date format, DDMMYY or MMDDYY.                    S01117
     C**                                                                  S01117
     C           DATF      COMP 'M'                      98               S01117
     C**                                                                  S01117
     C**   Check Multibranching indicator                                 S01117
     C**                                                                  S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     MOVE '1'       *IN30                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**   Get General Ledger Details                                     S01117
     C*                                                                   S01117
     C**********           CALL 'AOGELRR0'                                             S01117 CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR'  @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C********** SDGELR    PARM SDGELR    DSFDY                                        S01117 CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C**                                                                  S01117
     C**   Check if Profit Centre used                                    S01117
     C**                                                                  S01117
     C           BKPRCU    IFEQ 'Y'                                       S01117
     C                     MOVE '1'       *IN28                           S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C**   Check if Originating Branch is used                            S01117
     C**                                                                  S01117
     C           BKOBRU    IFEQ 'Y'                                       S01117
     C                     MOVE '1'       *IN29                           S01117
     C                     END                                            S01117
     C**
     C** GET INSTALLATION CONTROL DATA RECORD FOR SECURITIES TRADING      S01176
     C*                                                                   S01176
     C                     CALL 'AOSTRDR0'                                S01117
     C                     PARM '*DBERR'  @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C           SDSTRD    PARM SDSTRD    DSSDY                           S01117
     C*                                                                   S01176
     C***********          MOVEL'01      'ZTABKY 12                       S01176
     C***********          MOVE '  36'    ZTABKY                          S01176
     C**                                                                  S01176
     C***********ZTABKY    CHAINTABTB36F             80                   S01176
     C**                                                                  S01176
     C**ERROR*IF*NO*RECORD*FOUND*OR*IF*IT*IS*DELETED***************S01176 S01117
     C***********                                                  S01176 S01117
     C************IN80     IFEQ '1'                                S01176 S01117
     C***********RECI      ORNE 'D'                                S01176 S01117
     C***********          MOVE '02'      DBASE                    S01176 S01117
     C***********          MOVELPROGRM    DBPGM            ********E20471 S01117
     C***********          MOVEL'TABSE'   DBFILE           **DB ERROR 0276S01117
     C***********          MOVELZTABKY    DBKEY            ********S01176 S01117
     C***********          SETON                     U7U8          S01176 S01117
     C***********          MOVE '0'       RTNC                     E20471 S01117
     C***********          EXSR RETSR                              E20471 S01117
     C***********          END                                     S01176 S01117
      *                                                                   S01401
      ***  Access Switchable features file for MT5xx processing.          S01401
      *                                                                   S01401
     C                     MOVE 'N'       S01401                          S01401
     C                     CALL 'AOSARDR0'                                S01401
     C                     PARM '       ' @RTCD                           S01401
     C                     PARM '*VERIFY' @OPTN                           S01401
     C                     PARM 'S01401'  @SARD   6                       S01401
      *                                                                   S01401
     C           @RTCD     IFEQ *BLANK                                    S01401
     C                     MOVE 'Y'       S01401  1                       S01401
     C                     SETON                     20                   S01401
     C                     END                                            S01401
      *                                                                   CSE007
      **  Access SAR details file for Corporate Action Installation       CSE007
     C                     MOVE 'N'       CSE007  1                       CSE007
     C                     CALL 'AOSARDR0'                                CSE007
     C                     PARM '       ' @RTCD                           CSE007
     C                     PARM '*VERIFY' @OPTN                           CSE007
     C                     PARM 'CSE007'  WSARD                           CSE007
      *                                                                   CSE007
     C           @RTCD     IFEQ *BLANK                                    CSE007
     C                     MOVE 'Y'       CSE007                          CSE007
     C                     END                                            CSE007
      *                                                                   CSE007
      **  Access SAR details file for Securities Redenomintation          CEU017
     C                     MOVE 'N'       CEU017  1                       CEU017
     C                     CALL 'AOSARDR0'                                CEU017
     C                     PARM '       ' @RTCD                           CEU017
     C                     PARM '*VERIFY' @OPTN                           CEU017
     C                     PARM 'CEU017'  WSARD                           CEU017
      *                                                                   CEU017
     C           @RTCD     IFEQ *BLANK                                    CEU017
     C                     MOVE 'Y'       CEU017                          CEU017
     C                     END                                            CEU017
      *                                                                   CEU017
      ** Check if CSE010 (Transaction Enhancements) is active             CSE010
      *                                                                   CSE010
     C                     MOVE 'N'       CSE010  1                       CSE010
     C                     CALL 'AOSARDR0'                                CSE010
     C                     PARM *BLANKS   @RTCD                           CSE010
     C                     PARM '*VERIFY' @OPTN                           CSE010
     C                     PARM 'CSE010'  @SARD   6                       CSE010
      *                                                                   CSE010
     C           @RTCD     IFEQ *BLANK                                    CSE010
     C                     MOVE 'Y'       CSE010                          CSE010
     C                     ELSE                                           CSE010
      *                                                                   CSE010
     C           @RTCD     IFNE '*NRF   '                  ************   CSE010
     C                     Z-ADD10        DBASE            * DBERR 10 *   CSE010
     C                     MOVEL'SDSARDPD'DBPGM            ************   CSE010
     C                     MOVEL'CSE010'  DBKEY                           CSE010
     C                     MOVE *ON       *INU7                           CSE010
     C                     MOVE *ON       *INU8                           CSE010
     C                     MOVE '0'       RTNC                            CSE010
     C                     EXSR RETSR                                     CSE010
     C                     ENDIF                                          CSE010
      *                                                                   CSE010
     C                     ENDIF                                          CSE010
      *                                                                   CSE039
      **  Access SAR details file for AUTO-SETTLEMENT OF TRADES           CSE039
     C                     CALL 'AOSARDR0'                                CSE039
     C                     PARM '       ' @RTCD                           CSE039
     C                     PARM '*VERIFY' @OPTN                           CSE039
     C                     PARM 'CSE039'  WSARD                           CSE039
      *                                                                   CSE039
     C           @RTCD     IFEQ *BLANK                                    CSE039
     C                     MOVE 'Y'       CSE039  1                       CSE039
     C                     MOVE *ON       *IN44                           CSE039
     C                     ELSE                                           CSE039
     C                     MOVE 'N'       CSE039                          CSE039
     C                     MOVE *OFF      *IN44                           CSE039
     C                     ENDIF                                          CSE039
      *                                                                   CSE039
     C/COPY WNCPYSRC,SE0250C041
     C*                                                                   S01486
     C** IF PM PRESENT SET IN36 ON                                        S01486
     C*                                                                   S01486
     C                     CALL 'AOMMODR0'                                S01486
     C                     PARM *BLANKS   @RTCD   7                       S01486
     C                     PARM '*FIRST ' @OPTN   7                       S01486
     C           SDMMOD    PARM SDMMOD    DSFDY                           S01486
     C*                                                                   S01486
     C           @RTCD     IFNE *BLANK                     ************** S01486
     C                     Z-ADD08        DBASE            **DB ERR 08 ** S01486
     C                     MOVELPROGRM    DBPGM            ************** S01486
     C                     MOVEL'SDMMOD'  DBFILE                          S01486
     C                     MOVE *BLANKS   DBKEY                           S01486
     C                     SETON                       U7U8               S01486
     C                     MOVE '0'       RTNC                            S01486
     C                     EXSR RETSR                                     S01486
     C                     END                                            S01486
      *                                                                   CAC002
      **  Check if Analytical Accounting module is installed              CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE *ON       *IN65                           CAC002
     C                     ELSE                                           CAC002
     C                     MOVE *OFF      *IN65                           CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   S01486
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C                     MOVE *ON       *IN36                           S01486
     C                     ELSE                                           S01486
     C                     MOVE *OFF      *IN36                           S01486
     C                     ENDIF                                          S01486
     C*                                                                   CPB001
     C**  Check if Private Banking module is installed                    CPB001
     C*                                                                   CPB001
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     MOVE *ON       *IN34                           CPB001
     C                     ELSE                                           CPB001
     C                     MOVE *OFF      *IN34                           CPB001
     C                     ENDIF                                          CPB001
      *                                                                   S01486
      * OBTAIN PORTFOLIO MANAGEMENT ICD                                   S01486
      *                                                                   S01486
     C           *IN36     IFEQ '1'                                       S01486
     C                     CALL 'AOPORTR0'                                S01486
     C                     PARM *BLANKS   @RTCD   7                       S01486
     C                     PARM '*FIRST ' @OPTN   7                       S01486
     C           SDPORT    PARM SDPORT    DSFDY                           S01486
     C           @RTCD     IFNE *BLANKS                    ************** S01486
     C                     Z-ADD07        DBASE            **DB ERR 07 ** S01486
     C                     MOVELPROGRM    DBPGM            ************** S01486
     C                     MOVEL'PORTP'   DBFILE                          S01486
     C                     MOVE *BLANKS   DBKEY                           S01486
     C                     SETON                       U7U8               S01486
     C                     MOVE '0'       RTNC                            S01486
     C                     EXSR RETSR                                     S01486
     C                     END                                            S01486
     C                     MOVE '1'       *IN35                           S01486
     C                     ELSE                                           S01486
     C                     MOVE '0'       *IN35                           S01486
     C                     END                                            S01486
     C*                                                                   S01176
     C** IF AUTOCHARGE OPTION INDICATOR EQUALS 'Y'                        S01176
     C*                                                                   S01176
     C***********AUMO      IFEQ 'Y'                                S01176 S01117
     C           BVACOP    IFEQ 'Y'                                       S01117
     C                     SETON                     16                   S01176
     C***********          ELSE                                    S01176 S01117
     C***********          SETOF                     16            S01176 S01117
     C                     END                                            S01176
     C**                                                                  S01176
     C**     If no trade reference found in request data
     C**        ensure first screen fields will be blank
     C**     else process via TRADIN
     C**
     C           RQTDRF    IFEQ *BLANKS
     C                     MOVE *BLANKS   SACTN
     C                     MOVE *BLANKS   STDRF
     C                     ELSE
     C                     MOVELRQTDRF    STDRF
     C                     MOVE *BLANKS   RQTDRF
     C                     EXSR TRADIN
     C                     END
     C**
     C**      Access program name - for help and linked enquiries
     C**
     C                     MOVELPROGRM    PGMNO   8
      *                                                                   S01496
      **  Access SAR details file to see if JYSKE Enhcmts is installed.   S01496
      *                                                                   S01496
     C                     CALL 'AOSARDR0'                                S01496
     C                     PARM '       ' @RTCD                           S01496
     C                     PARM '*VERIFY' @OPTN                           S01496
     C                     PARM 'S01496'  WSARD   6                       S01496
      *                                                                   S01496
     C           @RTCD     IFEQ *BLANK                                    S01496
     C                     MOVE 'Y'       S01496  1                       S01496
     C                     END                                            S01496
     C/COPY WNCPYSRC,SE0250C036
      *                                                                   CEU005
      **  Access SAR details file to see if EMU Switchable feature        CEU005
      **  installed.                                                      CEU005
      *                                                                   CEU005
     C                     CALL 'AOSARDR0'                                CEU005
     C                     PARM '       ' @RTCD                           CEU005
     C                     PARM '*VERIFY' @OPTN                           CEU005
     C                     PARM 'CEU005'  WSARD   6                       CEU005
      *                                                                   CEU005
     C           @RTCD     IFEQ *BLANK                                    CEU005
     C                     MOVE 'Y'       CEU005  1                       CEU005
     C                     ELSE                                           CEU005
     C                     MOVE 'N'       CEU005                          CEU005
     C                     END                                            CEU005
      *                                                                   CAC005
      ***  Check if CAC005 - PCA-SE Enhancement is on.                    CAC005
      *                                                                   CAC005
     C                     MOVE 'N'       CAC005  1                       CAC005
     C                     CALL 'AOSARDR0'                                CAC005
     C                     PARM *BLANKS   @RTCD   7                       CAC005
     C                     PARM '*VERIFY' @OPTN   7                       CAC005
     C                     PARM 'CAC005'  @SARD   6                       CAC005
      *                                                                   CAC005
     C           @RTCD     IFEQ *BLANK                                    CAC005
     C                     MOVE 'Y'       CAC005                          CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
      ** Check if CSE023 - Withholding Tax - is installed                 187888
      *                                                                   187888
     C                     CALL 'AOSARDR0'                                187888
     C                     PARM *BLANKS   @RTCD                           187888
     C                     PARM '*VERIFY' @OPTN                           187888
     C                     PARM 'CSE023'  @SARD                           187888
      *                                                                   187888
     C           @RTCD     IFEQ *BLANK                                    187888
     C                     MOVE 'Y'       CSE023  1                       187888
     C                     MOVE *OFF      *IN72                           187888
     C                     ELSE                                           187888
     C                     MOVE 'N'       CSE023                          187888
     C                     MOVE *ON       *IN72                           187888
     C                     ENDIF                                          187888
      *                                                                                       CAS006
      **  Check if CAS006 Enhancement is on.                                                  CAS006
      *                                                                                       CAS006
     C                     MOVE 'N'       CAS006  1                                           CAS006
     C                     CALL 'AOSARDR0'                                                    CAS006
     C                     PARM *BLANKS   @RTCD                                               CAS006
     C                     PARM '*VERIFY' @OPTN                                               CAS006
     C                     PARM 'CAS006'  @SARD                                               CAS006
      *                                                                                       CAS006
     C           @RTCD     IFEQ *BLANK                                                        CAS006
     C                     MOVE 'Y'       CAS006                                              CAS006
     C                     ELSE                                                               CAS006
     C           @RTCD     IFNE '*NRF   '                                                     CAS006
     C                     IN   LDA                                                           CAS006
     C                     Z-ADD11        DBASE                                               CAS006
     C                     MOVELPROGRM    DBPGM                                               CAS006
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS006
     C                     MOVE '*VERIFY' DBKEY                                               CAS006
     C                     OUT  LDA                                                           CAS006
     C                     MOVE '1'       *INU7                                               CAS006
     C                     MOVE '1'       *INU8                                               CAS006
     C                     MOVE '0'       RTNC                                                CAS006
     C                     EXSR RETSR                                                         CAS006
     C                     ENDIF                                                              CAS006
     C                     ENDIF                                                              CAS006
      **********                                                                       CGL031 232543
      ***Check*if CGL031 - Taxation on Savings Income is installed                     CGL031 232543
      **********                                                                       CGL031 232543
     C**********           CALL 'AOSARDR0'                                             CGL031 232543
     C**********           PARM *BLANKS   PRTCD                                        CGL031 232543
     C**********           PARM '*VERIFY' POPTN                                        CGL031 232543
     C**********           PARM 'CGL031'  PSARD   6                                    CGL031 232543
      **********                                                                       CGL031 232543
     C********** PRTCD     IFEQ *BLANK                                                 CGL031 232543
     C**********           MOVE 'Y'       CGL031  1                                    CGL031 232543
     C**********           MOVE *ON       *IN73                                        CGL031 232543
     C**********           ELSE                                                        CGL031 232543
     C**********           MOVE 'N'       CGL031                                       CGL031 232543
     C**********           MOVE *OFF      *IN73                                        CGL031 232543
     C**********           ENDIF                                                       CGL031 232543
      **********                                                                       CGL031 232543
      ***Database Error (return code other than *NRF and Blanks)                       CGL031 232543
      **********                                                                       CGL031 232543
     C********** PRTCD     IFNE '*NRF   '                                              CGL031 232543
     C********** PRTCD     ANDNE*BLANKS                                                CGL031 232543
     C********** *LOCK     IN   LDA                                                    CGL031 232543
     C**********           MOVEL'SCSARDPD'DBFILE                                       CGL031 232543
     C**********           MOVEL'CGL031'  DBKEY                                        CGL031 232543
     C**********           Z-ADD01        DBASE                                        CGL031 232543
     C**********           OUT  LDA                                                    CGL031 232543
     C**********           MOVE *ON       *INU7                                        CGL031 232543
     C**********           MOVE *ON       *INU8                                        CGL031 232543
     C**********           MOVE *ON       *INLR                                        CGL031 232543
     C**********           EXSR *PSSR                                                  CGL031 232543
     C**********           ENDIF                                                       CGL031 232543
      *                                                                   CSE039
      ** Key List                                                         CSE039
      *                                                                   CSE039
     C           KSMVTS    KLIST                                          CSE039
     C                     KFLD           KTDRF   6                       CSE039
     C                     KFLD           KTTYP   1                       CSE039
     C**
     C                     ENDSR
      *
      *****************************************************************   S01117
      /EJECT                                                              S01496
     C*****************************************************************   S01496
     C*                                                                   S01496
     C**   P001 SR - CHANGE TRANSACTIONS TYPES                            S01496
     C**                                                                  S01496
     C**   Called by  FILL1                                               S01496
     C**                                                                  S01496
     C**   Calls                                                          S01496
     C*                                                                   S01496
     C*****************************************************************   S01496
     C           P001      BEGSR                                          S01496
     C*                                                                   S01496
     C           STDTP     IFEQ 'TP'                       *B1            S01496
     C           STDTP     OREQ 'TS'                                      S01496
     C                     OPEN SEERALL2                                  S01496
     C           STDRF     SETLLSEERALL2                 86               S01496
     C*                                                                   S01496
     C           *IN86     IFEQ '1'                        *B2            S01496
     C*                                                                   S01496
     C           STDTP     IFEQ 'TP'                                      S01496
     C                     MOVEL'RI'      STDTP                           S01496
     C                     END                                            S01496
     C           STDTP     IFEQ 'TS'                                      S01496
     C                     MOVEL'RO'      STDTP                           S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C                     END                             *E2            S01496
     C*                                                                   S01496
     C                     CLOSESEERALL2                                  S01496
     C                     END                             *E1            S01496
     C*                                                                   S01496
     C                     ENDSR                                          S01496
     C********************************************************************S01496
      /EJECT                                                              S01117
     C/COPY WNCPYSRC,SE0250C051
      *****************************************************************   S01117
      *                                                               *   S01117
      *  *PSSR  - Error control subroutine                            *   S01117
      *                                                               *   S01117
      *  Called by: RETSR + any error                                 *   S01117
      *  Calls:                                                       *   S01117
      *                                                               *   S01117
      *****************************************************************   S01117
      *                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR **    S01117
     C**                                                                  S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     ENDSR                                          S01117
      *                                                                   S01117
      *****************************************************************
     C/COPY WNCPYSRC,SE0250C037
      /EJECT                                                              S01176
     C/COPY ZSRSRC,ZCONVZ1                                                S01176
      /EJECT
     C/COPY ZSRSRC,ZDATE2Z2
      /EJECT
     C/COPY WNCPYSRC,SE0250C038
     C/COPY ZSRSRC,ZSEDITZ3
     C/COPY WNCPYSRC,SE0250C039
      /EJECT
     C/COPY WNCPYSRC,SE0250C003
     C*/COPY*ZSRSRC,ZSYSTMZ1***                                           S01117
     C*/EJECT******************                                           S01117
      ***
**  CPY@
(c) Finastra International Limited 2001
**   MSG  - ERROR MESSAGES
INVALID ENTRY - BOTH TRADE REFERENCE AND OPTION ENTERED
ENTER A TRADE REFERENCE OR AN OPTION
OPTION NOT VALID,PRESS 'HELP' FOR AVAILABLE OPTIONS
THIS IS THE INITIAL ENQUIRY - F/3 WILL EXIT TO MENU
INVALID TRADE REFERENCE - PLEASE REENTER
ENTER A TRADE REFERENCE
USER IS NOT AUTHORISED TO ANY BOOKING BRANCHES
USER IS NOT AUTHORISED TO THE BOOKING BRANCH OF THE TRADE
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**  QCAEXEC COMMANDS                                                      088336
OVRDBF  FILE(TRADSDZ1) TOFILE(TRADSDY1)
OVRDBF  FILE(TRADSDZ2) TOFILE(TRADSDY2)
OVRDBF  FILE(TRADSDY1) SHARE(*NO)
OVRDBF  FILE(TRADSDY2) SHARE(*NO)
DLTOVR  FILE(TRADSDZ1)
DLTOVR  FILE(TRADSDZ2)
DLTOVR  FILE(TRADSDY1)
DLTOVR  FILE(TRADSDY2)
