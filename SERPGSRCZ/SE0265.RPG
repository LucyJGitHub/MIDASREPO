000100200610     H        1
000200200610      *****************************************************************
000300200610/*STD *  RPGBASE                                                      *
000400200610/*EXI *  TEXT('Midas SE Positions by issuer enquiry')                 *
000500200610      *****************************************************************
000600200610      *                                                               *
000700200610      *  Midas - Securities Trading Module                            *
000800200610      *                                                               *
000900200610      *  SE0265 - POSITIONS BY ISSUER ENQUIRY                         *
001000200610      *                                                               *
001100200610      *  Function:  This program shows the exposure in all the        *
001200200610      *   (I/C)     Securities for a selected Issuer or group of      *
001300200610      *             Issuers.  Trade Date positions are shown, either  *
001400200610      *             for a selected Portfolio Customer; selected Branch*
001500200610      *             where relevant; Book; or for all holdings.        *
001600200610      *             Details are Security; Customer; Book; Nominal;    *
001700200610      *             Value in Currency of Security; Value in either the*
001800200610      *             currency selected (converted at prevailing spot   *
001900200610      *             rate) or in bank's limit currency (if no currency *
002000200610      *             selected), and rounded to nearest thousand.  If   *
002100200610      *             the Factored Option is chosen, the conversion     *
002200200610      *             will also take into account the factor entered on *
002300200610      *             the Investment Type of the Security in order to   *
002400200610      *             represent the degree of risk attached to the      *
002500200610      *             security.  A total calculated exposure is shown   *
002600200610      *             at the end of the Enquiry.                        *
002700200610      *             Each option available from this enquiry is held   *
002800200610      *             as a record on PF/SECOND - Linked Enquiry Control *
002900200610      *             file with fields: Calling Program, Option         *
003000200610      *             Selected, Called Program.                         *
003100200610      *                                                               *
003200200610      *  Calls:     F6 may be taken when either the Issuer or         *
003300200610      *             Customer has not been entered to call:            *
003400200610      *             - SE0275 - Customer Shortname Enquiry             *
003500200610      *             - SE0270 - Security Customer Shortname Enquiry    *
003600200610      *             Additionally, options may be entered against a    *
003700200610      *             user position to call:                            *
003800200610      *             1) SE0245 - Security Details Enquiry              *
003900200610      *             3) SE0230 - Own Holdings Enquiry                  *
004000200610      *             and, against a customer position:                 *
004100200610      *             1) SE0245 - Security Details Enquiry              *
004200200610      *             2) SE0205 - Client Holdings Enquiry.              *
004300200610      *                                                               *
004400200610      *  Called By: SEC04 - CL Component to Control SE Enquiries      *
004500200610      *                                                               *
004600200610      *  (c) Finastra International Limited 2001                      *
004700200610      *                                                               *
004800200610      *  Last Amend No. 248698             Date 01Jun20               *
004900200610      *  Prev Amend No. 261507             Date 22May20               *
005000200610      *                 MD046248           Date 27Oct17               *
005100200610      *                 226449             Date 24Jun15               *
005200200610      *                 MD034776           Date 08Jul15               *
005300200610      *                 AR1067108          Date 11Dec12               *
005400200610      *                 AR1001183A         Date 20Nov12               *
005500200610      * Bank Fusion Midas 1.4 Base -----------------------------------*
005600200610      * Midas Plus 1.4 Base 04 ---------------------------------------*
005700200610      * Midas Plus 1.4 Base ------------------------------------------*
005800200610      * Midas Plus 1.3 ----------- Base ------------------------------*
005900200610      *                 BUG11747           Date 21Jul06               *
006000200610      *                 CSD031             Date 10Apr06               *
006100200610      *                 CSD027             Date 09Dec05               *
006200200610      *                 235150             Date 27Jul05               *
006300200610      *                 CSE071             Date 19Jul05               *
006400200610      *                 CSW037A            Date 02May05               *
006500200610      *                 BUG6198            Date 04Apr05               *
006600200610      *                 229857             Date 07Oct04               *
006700200610      *                 226570             Date 27Jun04               *
006800200610      *                 CSD025             Date 11Jan05               *
006900200610      *                 CSW037             Date 15Dec04               *
007000200610      *                 CSW036             Date 15Dec04               *
007100200610      *                 BUG3122            Date 17Jul04               *
007200200610      *                 CGL014             Date 20Oct03               *
007300200610      *                 CLE025             Date 20Oct03               *
007400200610      *                 CGL029             Date 01Sep03               *
007500200610      *                 211407             Date 07Jan03               *
007600200610      *                 208241             Date 21Aug02               *
007700200610      *                 194370             Date 12Jul01               *
007800200610      *                 207543             Date 17JUL02               *
007900200610      *                 180056             Date 18Oct00               *
008000200610      *                 CSE035             Date 22Apr02               *
008100200610      *                 CAS006             Date 21Jan03               *
008200200610      *                 206316             Date 19Jul02               *
008300200610      * Midas Release 4.01 -------------------------------------------*
008400200610      *                 CPK015             Date 17Jun01               *
008500200610      *                 CSE031             Date 09Nov01               *
008600200610      *                 180707             Date 25Jul00               *
008700200610      * Midas Release 4 --------------- Base -------------------------*
008800200610      *                 127566             Date 09May01               *
008900200610      * Midas DBA 3.05 -----------------------------------------------*
009000200610      *                 178731             Date 05Feb01               *
009100200610      * Midas DBA 3.03 -----------------------------------------------*
009200200610      *                 140272             Date 20Apr00               *
009300200610      * Midas DBA 3.02 -----------------------------------------------*
009400200610      *                 CGL011             Date 20Sep99               *
009500200610      * Midas DBA 3.00 ---------------- Base -------------------------*
009600200610      *                 CAC005             Date 23Nov98               *
009700200610      *                 130862             Date 18Oct98               *
009800200610      *                 151945             DATE 06Jan99               *
009900200610      *                 CSE005             Date 04Feb97               *
010000200610      *                 084704             Date 01Aug96               *
010100200610      *                 083039             DATE 01AUG96               *
010200200610      *                 059110             DATE 25JUL96               *
010300200610      *                 088047             DATE 26JUN96               *
010400200610      *                 100228             DATE 30MAY96               *
010500200610      *                 099886             DATE 18APR96               *
010600200610      *                 100017             DATE 18APR96               *
010700200610      *                 092961             DATE 04OCT95               *
010800200610      *                 091254             DATE 20OCT95               *
010900200610      *                 086491             DATE 15JUN95               *
011000200610      *                 082129             DATE 25JAN95               *
011100200610      *                 064575             DATE 15AUG94               *
011200200610      *                 065301             DATE 05MAY94               *
011300200610      *                 054258             DATE 24NOV93               *
011400200610      *                 054259             DATE 24NOV93               *
011500200610      *                 052254             DATE 24NOV93               *
011600200610      *                 S01401             DATE 16JUN93               *
011700200610      *                 E39495             DATE 17FEB93               *
011800200610      *                 047922             DATE 01FEB93               *
011900200610      *                 S01397             DATE 10SEP92               *
012000200610      *                 E37221             DATE 18MAR92               *
012100200610      *                 E32503             DATE 03DEC91               *
012200200610      *                 E27934             DATE 22OCT91               *
012300200610      *                 E25598             DATE 11SEP91               *
012400200610      *                 E27092             DATE 04SEP91               *
012500200610      *                 E28729             DATE 29OCT90               *
012600200610      *                 S01195             DATE 29OCT90               *
012700200610      *                 S01117             DATE 29OCT90               *
012800200610      *                 S01269             DATE 18OCT90               *
012900200610      *                 E23190             DATE 10AUG90               *
013000200610      *                 E23188             DATE 10AUG90               *
013100200610      *                 E23189             DATE 06AUG90               *
013200200610      *                 E22909             DATE 02AUG90               *
013300200610      *                 E21668             DATE 01MAY90               *
013400200610      *                 E21616             DATE 03APR90               *
013500200610      *                 E20651             DATE 04JAN90               *
013600200610      *                 S01232             DATE 30NOV89               *
013700200610      *                 E19964             DATE 30NOV89               *
013800200610      *                 E20380             DATE 30NOV89               *
013900200610      *                 S01199             DATE 03/08/89              *
014000200610      *                 E17303             DATE 21/04/89              *
014100200610      *                 S01179             DATE 21/10/88              *
014200200610      *                 E16063             DATE 09/10/88              *
014300200610      *                 E13571             DATE 31/07/88              *
014400200610      *                 S01176             DATE 21/08/88              *
014500200610      *                 E14057             DATE 01/07/88              *
014600200610      *                                                               *
014700200610      *---------------------------------------------------------------*
014800200610      *                                                               *
014900200610      *  248698 - Rounding discrepancies on some SE reports. Applied  *
015000200610      *           fix 228682.                                         *
015100200610      *  228682 - Recompiled due to ZCNSDZ1 changes. Applied 176594.  *
015200200610      *  261507 - Truncation of Average Price in display screen.      *
015300200610      *           Introduced new field BKPRR with length 23 with 8    *
015400200610      *           decimal places to be used as a result field when    *
015500200610      *           computing the average price to avoid truncation of  *
015600200610      *           the value.                                          *
015700200610      *  MD046248 - Finastra Rebranding                               *
015800200610      *  226449 - Recompiled over changes made in /COPY ZDYYRZ3.      *
015900200610      *         - Applied for MD034387.                               *
016000200610      *  MD034776 - Reverse AR1001183A to allow negative interest     *
016100200610      *             rate. (Recompile)                                 *
016200200610      *  AR1067108 - PMC1140 Component failed during Clean COB        *
016300200610      *              Applied fix AR1001183A                           *
016400200610      *  AR1001183A - Coupon rate was still used in computation of    *
016500200610      *              interest instead of using the details in FRN tab *
016600200610      *              (Reopen) (Recompile)                             *
016700200610      *  BUG11747 - Issuer defaults to zero                           *
016800200610      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
016900200610      *  CSD027 - Conversion Of Customer Number to Alpha              *
017000200610      *  235150 - ENQY/POSI - DATABASE ERROR. Customer is flagged     *
017100200610      *           for closure.                                        *
017200200610      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
017300200610      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
017400200610      *  BUG6198- Cannot save new Details for CUSD (Recompile)        *
017500200610      *  229857 - Recompiled due to change in ZYLDZ2.                 *
017600200610      *  226570 - Recompiled due to change in ZYLDZ2.                 *
017700200610      *  CSD025 - Customer De-Activation                              *
017800200610      *  CSW037 - Additional Field Data on MT300/MT320                *
017900200610      *  CSW036 - Dual SWIFT BIC held on Client Details               *
018000200610      *  BUG3122 - Recompiled due to changes in SDSECSPD.             *
018100200610      *  CGL014 - Collaterals Processing                              *
018200200610      *  CLE025 - Credit Lines (Recompile)                            *
018300200610      *  CGL029 - Increase Account Code to 10 digits (Recompile)      *
018400200610      *  211407 - Recompile after change on copy sources ZYLDZ2,      *
018500200610      *           ZACCRZ1 and ZYCEZ1 for NX/NNX processing.           *
018600200610      *           The change was to call subroutine ZLCD1 instead     *
018700200610      *           of ZLCD in retrieving the PERIOD for NNX processing *
018800200610      *           and ZNCD1 is called instead of ZNCD in retrieving   *
018900200610      *           the WBENCD for NNX processing. Also rewrite tests   *
019000200610      *           for identifying if position is NX,NNX or CUM.       *
019100200610      *  208241 - Recompiled over changed /CPY ZSDESCZ3.              *
019200200610      *  194370 - Recompile after change on copy sources ZYLDZ2,      *
019300200610      *           For securities with divisor basis = '5' and first   *
019400200610      *           coupon date > valuation date (rundate + 1), set     *
019500200610      *           event control date to first coupon date before      *
019600200610      *           processing SR/ZDYYR. This is to ensure that the     *
019700200610      *           correct hypothetical last and next coupon dates are *
019800200610      *           used in deriving the price/yield rate.              *
019900200610      *  207543 - CEU018 NOT WORKING ON A PRICE BASIS, MISSING A PART *
020000200610      *           OF AUS047. CHECK FOR CEU017, RECOMPILE OVER ZYLDZ2. *
020100200610      *  180056 - Recompiled over changed in ZDYYRZ3.                 *
020200200610      *  CSE035 - NX/NNX Coupon Payment Processing.                   *
020300200610      *           Recompile over changed ZACCRZ1/ZYLDZ2/ZYCEZ1
020400200610      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
020500200610      *  206316 - Recompiled over changed ZLCDZ1.                     *
020600200610      *  CPK015 - Conversion of ZYIELD from PLI to RPG.               *
020700200610      *           Recompile over changed ZYLDZ2.                      *
020800200610      *  CSE031 - Coupon Fixing for Floating Rate Notes.              *
020900200610      *           (recompilation due to change to ZNCD/ZLCD)          *
021000200610      *  180707 - No Position Settlements generated. Recompile over   *
021100200610      *           changes in /COPY ZNCDZ3.                            *
021200200610      *  127566 - Recompiled over changed ZSDESCZ3                    *
021300200610      *  178731 - While calling SE0230, it should pass the user-book  *
021400200610      *           code instead of pseudo-book code.                   *
021500200610      *  140272 - Recompile over changed ZYLDZ2                       *
021600200610      *  CGL011 - Collateral Processing for Midas                     *
021700200610      *  CAC005 - Profit Centre Accounting - SE Enhancement           *
021800200610      *  130862 - Recompiled over ZLCDZ1 & ZDAYSZ2 changes.           *
021900200610      *  151945 - Recompiled Over changed ZDYYRZ3 .                   *
022000200610      *  CSE005 - Effect of holidays on FRN Coupon Dates              *
022100200610      *           (recompilation due to change to ZNCD/ZLCD)          *
022200200610      *  084704 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
022300200610      *  083039 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
022400200610      *  059110 - Recompiled over changed ZYLDZ2 sub.                 *
022500200610      *  088047 - RECOMPILE over change SR/ZYLDZ2.                    *
022600200610      *  100228 - RECOMPILE OVER CHANGED ZDYYRZ3, ZLCDZ1 & ZNCDZ3.    *
022700200610      *  099886 - Rounding problem for partly paid securities.        *
022800200610      *           Recompile over amended standard subroutine ZACCZ.   *
022900200610      *  100017 - Position settlement unable to pick up day adj. on   *
023000200610      *           SECTYD. Change subroutine to use DADJN to stop      *
023100200610      *           interest day adjustment being used for amortisation.*
023200200610      *           Recompile over amended subroutine ZDAYS.            *
023300200610      *  092961 - Recompile over ZDAYSZ2 which was amended by 086491  *
023400200610      *           (Wrong number of days calculated for day basis 1    *
023500200610      *           when start or end day is last day of February)      *
023600200610      *  091254 - RECOMPILE OVER CHANGED ZLCDZ1 & ZNCDZ3              *
023700200610      *  086491 - Wrong nbr of days calculated for day basis 1        *
023800200610      *           when start or end day is last day of February       *
023900200610      *           Recompiled for ZSRSRC/ZDAYSZ2 changes.              *
024000200610      *  082129 - It is not an error if user enters an option and     *
024100200610      *           the issuer field is not blank, as long as the       *
024200200610      *           issuer field has not been changed.                  *
024300200610      *  064575 - Recompiled over amended ZYLDZ2 subroutine.          *
024400200610      *  065301 - Recompiled over changed copy source ZACCR subr.     *
024500200610      *           with ZAMT increased to 15,0.                        *
024600200610      *  054258 - SELECTION DETAIL'ALL'FOR BRANCH MUST BE RECOGNISED. *
024700200610      *  054259 - EXPOSURE MUST BE EQUAL TO NOMINAL X PRICE X CURRENT *
024800200610      *           FACTOR FOR PROT = 8.                                *
024900200610      *  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
025000200610      *           to 10,9                                             *
025100200610      *  S01401 - MT5xx SWIFT Messages Feature:                       *
025200200610      *           - Recompiled due to changes to files.               *
025300200610      *  E39495 - New /COPY subroutine ZCALCD added (called from      *
025400200610      *           sr. ZYLD)                                           *
025500200610      *         - /COPY subroutine ZCNSDZ1 added (called from sr.     *
025600200610      *           ZYLD)                                               *
025700200610      *         - Recompiled over changed ZYLDZ2                      *
025800200610      *  047922 - Recompiled over changed SR/ZYLDZ2                   *
025900200610      *  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
026000200610      *           - Recompiled due to changes to files and SR/ZYLD.   *
026100200610      *  E37221 - Must not check Branch Authority in Single Branc Mode*
026200200610      *  E32503 - Security value is often zero                        *
026300200610      *  E27934 - Recompiled over the changed version of ZACCRZ1      *
026400200610      *  E25598 - Total exposure should show TOTAL figure and not just*
026500200610      *           that for the last trade. ZZTOTE should not be zeroed*
026600200610      *           every time.                                         *
026700200610      *  E27092 - Recompiled over changed SR/ZLCD                     *
026800200610      *  E28729 - If an option is entered and then erased,            *
026900200610      *           the program does not recognise the erasure.         *
027000200610      *           Therefore ensure the option is not blank            *
027100200610      *           before checking is done.                            *
027200200610      *  S01195 - Holiday Processing.                                 *
027300200610      *  S01117 - Multi-Branching.                                    *
027400200610      *  S01269 - Trade authorisation: recompiled over changed        *
027500200610      *           file TABSE                                          *
027600200610      *  E23190 - Customer field should accept clients with           *
027700200610      *           classifications of 'S' or 'D'only.                  *
027800200610      *  E23188 - Recompiled over changed display file SE0265DF       *
027900200610      *  E23189 - Recompiled over changed display file SE0265DF       *
028000200610      *  E22909 - Exposure currency value due to a short position     *
028100200610      *           should be shown as negative, not positive.          *
028200200610      *  E21668 - Recompiled over changed SR/ZYLDZ2                   *
028300200610      *  E21616 - Recompiled over changed SR/ZLCD.                    *
028400200610      *  E20651 - DB Error Numbers used in more than one place.       *
028500200610      *           New Error Numbers as follows:                       *
028600200610      *           DB ERROR 09  ->  10                                 *
028700200610      *           DB ERROR 09  ->  11                                 *
028800200610      *  S01232 - Australian Yields modifications.                    *
028900200610      *  E19964 - Selection by Book or Customer does not work. Rollup/*
029000200610      *           Rolldown are in error. Command 6 produces the wrong *
029100200610      *           Customer Shortname Enquiry for the Issuer.          *
029200200610      *  E20380 - ZLCD added for ZYLD - recompile.                    *
029300200610      *  S01199 - Help System.                                        *
029400200610      *  E17303 - Recompile program over changed ZDYYRZ3, ZYLDZ1,     *
029500200610      *           ZYLDZ2                                              *
029600200610      *  S01179 - ****** AS400 CONVERSION ******                      *
029700200610      *     The keyword RTGAID is no longer supported on the AS400    *
029800200610      *     and command keys and indicators have been used to replace *
029900200610      *     this in the display file. To disrupt the structure of the *
030000200610      *     program as little as possible a new subroutine - ASCHGS - *
030100200610      *     has been coded. This moves the values which would have    *
030200200610      *     been passed to the program (via RTGAID) into the AID      *
030300200610      *     field depending on which function key has been pressed.   *
030400200610      *  E16063 - LINKED ENQUIRY REORGANISATION:                      *
030500200610      *           - Open CLINT Consistent eith SE0205.                *
030600200610      *  E13571 - AMENDED ERROR MESSAGE, AS NO HELP TEXT              *
030700200610      *  S01176 - RELEASE 3.1 MODIFICATIONS                           *
030800200610      *  E14057 - USE PRICR NOT PRICS FILE.                           *
030900200610      *                                                               *
031000200610      *****************************************************************
031100200610      *
031200200610     FSE0265DFCF  E                    WORKSTN      KINFDS SCRDS
031300200610     F                                        SFLRECKSFILE SE0265S0
031400200610     FSECTI   IF  E           K        DISK
031500200610     F            SECTYDF                           KRENAMESECTIDF
031600200610     F*CLINT**IF**E           K        DISK                               S01117
031700200610     F*********** CLINTCAF                          KIGNORE               S01117
031800200610     F*********** CLINTCCF                          KIGNORE               S01117
031900200610     F*********** CLINTC1F                          KIGNORE               S01117
032000200610     F************CLINTSEF                          KIGNORE               E16063
032100200610     F*PACUS***IF**E***        K        DISK
032200200610     F*********** CLINTCBF                          KRENAMEPACUSF
032300200610     FSDCUSTL4IF  E           K        DISK                               S01117
032400200610     F*SNAME***I***E***        K        DISK                              S01117
032500200610     F*********** CLINTCBF                          KRENAMESNAMEF         S01117
032600200610     F*TABSE***IF**E***        K        DISK                              S01117
032700200610     F*********** TABLETAF                          KIGNORE               S01117
032800200610     F*********** TABTB10F                          KIGNORE               S01117
032900200610     F*********** TABTB11F                          KIGNORE               S01117
033000200610     F*********** TABTB36F                          KIGNORE               S01117
033100200610     F*********** TABTB40F                          KIGNORE               S01117
033200200610     F*********** TABTE10F                          KIGNORE               S01117
033300200610     F*********** TABTE20F                          KIGNORE               S01117
033400200610     F*********** TABTG10F                          KIGNORE               S01117
033500200610     F*********** TABTG20F                          KIGNORE               S01117
033600200610     F*********** TABLETHF                          KIGNORE               S01117
033700200610     F*********** TABLETJF                          KIGNORE               S01232
033800200610     F*********** TABLETKF                          KIGNORE               S01117
033900200610     F*********** TABLETLF                          KIGNORE               S01117
034000200610     F*********** TABLETNF                          KIGNORE               S01117
034100200610     F*********** TABLETPF                          KIGNORE               S01117
034200200610     F*********** TABLETRF                          KIGNORE               S01117
034300200610     F*********** TABLETXF                          KIGNORE               S01117
034400200610     F*********** TABLET2F                          KIGNORE               S01117
034500200610     F*********** TABLET3F                          KIGNORE               S01117
034600200610     F*********** TABLET5F                          KIGNORE               S01117
034700200610     FCDEPS   IF  E           K        DISK
034800200610     FUDEPS   IF  E           K        DISK
034900200610     FINVTP   IF  E           K        DISK
035000200610     F*BOOKD***IF**E***        K        DISK                              S01117
035100200610     F*RICS***IF**E           K        DISK                               E14057
035200200610     FPRICR   IF  E           K        DISK                               E14057
035300200610     FPRICT   IF  E           K        DISK
035400200610     F            PRICEDF                           KRENAMEPRICETDF
035500200610     FBKPOS   IF  E           K        DISK
035600200610     FBKPHD   IF  E           K        DISK
035700200610     FSECOND  IF  E           K        DISK
035800200610     FCPPRIC  IF  E           K        DISK                               S01176
035900200610     F**SECET***IF**E           K        DISK                       S01176S01232
036000200610     FSEDEV   IF  E           K        DISK                               S01232
036100200610     FSECEO   IF  E           K        DISK                               S01232
036200200610     F            SEDEVDF                           KRENAMESEDEVDO        S01232
036300200610     F            SNDEVDF                           KRENAMESNDEVDO        S01232
036400200610     FSEBLKPL6IF  E           K        DISK                               CGL011
036500200610      ** Manually Blocked Positions File                                  CGL011
036600200610      *                                                                   CGL011
036700200610     FSEBLKPL7IF  E           K        DISK                                                   CGL014
036800200610     F            SEBLKPD0                          KRENAMESEBLKPDF                           CGL014
036900200610     F/COPY WNCPYSRC,SE0265F001
037000200610      /EJECT
037100200610     F*****************************************************************
037200200610     F*                                                               *
037300200610     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
037400200610     F*                                                               *
037500200610     F*   01      RETURN TO PREVIOUS PROGRAM                          *
037600200610     F*************OR*ERROR*ON*TABTB10*READ****************************   S01117
037700200610     F*   02      CLEAR SUBFILE                                       *
037800200610     F*   03      NO DETAILS INDICATOR                                *
037900200610     F*   04      DISPLAY MESSAGE - NO DETAILS TO DISPLAY             *
038000200610     F*   05      DETAILS COMPLETE FOR THIS SECURITY                  *
038100200610     F*   06                                                          *
038200200610     F*   07      IN MULTIBRANCH MODE                                 *
038300200610     F*   08      PROTECT SELECT FIELD OR NOT                         *
038400200610     F*   10      VLDCMDKY INDICATOR FOR DISPLAY FILE                 *
038500200610     F*   20      ROLLUP                                              *   S01179
038600200610     F*   21      ROLLDOWN                                            *   S01179
038700200610     F*   22      HELP                                                *   S01179
038800200610     F*   25      CHAIN FAIL ON ANY FILE                              *
038900200610     F*   40      END OF FILE ON SUBFILE READ                         *
039000200610     F*   41      REVERSE IMAGE ISSUER FIELD                          *
039100200610     F*   42      DISPLAY ERROR MESSAGE                               *
039200200610     F*   43      REVERSE IMAGE BRANCH FIELD                          *
039300200610     F*   44      REVERSE IMAGE CUSTOMER FIELD                        *
039400200610     F*   45      REVERSE IMAGE BOOK FIELD                            *
039500200610     F*   46      REVERSE IMAGE CURRENCY FIELD                        *
039600200610     F*   47      REVERSE IMAGE FACTORED FIELD                        *
039700200610     F*   50      ON IF DETAILS ACCUMULATED FOR PREVIOUS SEC          *
039800200610     F*   51      MORE DETAILS TO OUTPUT FOR SECURITY                 *
039900200610     F*   52      AUSTRAIAN YIELD TRADED SECURITY                     *   S01232
040000200610     F*   55      NOMINAL CURRENCY DEC. PLACES 0                      *
040100200610     F*   56      NOMINAL CURRENCY DEC. PLACES 1                      *
040200200610     F*   57      NOMINAL CURRENCY DEC. PLACES 2                      *
040300200610     F*   58      NOMINAL CURRENCY DEC. PLACES 3                      *
040400200610     F*   60      DISPLAY GROUP PARENT                                *
040500200610      *   61      No Display for Profit Centre                        *   CAC005
040600200610      *   62      Error in Profit Centre                              *   CAC005
040700200610      ****63****  End of File on LF/SEBLKPL6                          *                CGL011 CGL014
040800200610      *   63      End of File on LF/SEBLKPL6 and LF/SEBLKPL7          *                       CGL014
040900200610     F*   70      ON IF TOTAL REQUIRED FOR SECURITY                   *
041000200610     F*   71      DONT DO FIRST READ IF 2ND+ PAGE                     *
041100200610     F*   81      END OF FILE ON SECTI  OR END OF SUBFILE PAGE        *
041200200610     F*   82      WORK INDICATOR FOR SETTING SFLEND                   *
041300200610     F*   85      RECORDS TO BE READ FROM CDEPS                       *
041400200610     F*   86      RECORDS TO BE READ FROM UDEPS                       *
041500200610     F*   87      END OF FILE ON UDEPS/CDEPS                          *
041600200610     F*   88      SUBFILE READ FAIL                                   *
041700200610     F*   89      END OF FILE ON SECTI  OR END OF SUBFILE PAGE        *
041800200610     F*   90 - 99 WORK INDICATOR - STD SUBROUTINES                    *
041900200610     F*   U7      WITH U8 FOR DATABASE ERROR                          *
042000200610     F*   U8      WITH U7 FOR DATABASE ERROR                          *
042100200610     F*   LR      TERMINATE PROGRAM                                   *
042200200610     F*                                                               *
042300200610     F*****************************************************************
042400200610      /EJECT
042500200610     F*****************************************************************
042600200610     F*                                                               *
042700200610     F*  I N D E X   T O   S U B R O U T I N E S                      *
042800200610     F*                                                               *
042900200610     F*  ASCHGS  -  MOVES VALUES INTO AID - AS400 CONVERSION          *
043000200610     F*  COMMD   -  PROCESS COMMAND KEYS, HELP AND ROLLUP/DOWN        *
043100200610     F*  OPTION  -  CHECK VALIDITY OF ENTERED OPTION COMBINATIONS     *
043200200610     F*  CUSTIN  -  PROCESS ENTERED SELECTION FIELDS                  *
043300200610     F*  CLEAR   -  CLEAR FIELDS AND INDICATORS ON DISPLAY SCREEN     *
043400200610     F*  ROLLUP  -  HANDLE ROLLUP                                     *
043500200610     F*  ROLLDN  -  HANDLE ROLLDOWN                                   *
043600200610     F*  DISP    -  ACCUMULATE DETAILS FOR DISPLAY                    *
043700200610     F*  SETUP   -  PREPARE SCREEN FOR DISPLAY                        *
043800200610     F*  PROCES  -  DETERMINE LINE TYPE                               *
043900200610     F*  SUBFIL  -  WRITE ACCUMULATED DETAILS TO SUBFILE              *
044000200610     F*  BKPRC   -  DETERMINE BOOK PRICE                              *
044100200610     F*  OLBAP   -  CALCULATE ON-LINE BOOK POSN AVERAGE PRICE         *
044200200610     F*  LINK    -  PROCESS REQUEST FOR LOWER LEVEL ENQUIRY           *
044300200610     F*  RETSR   -  END OF PROGRAM PROCESSING                         *
044400200610     F*  FIRST   -  FIRST CYCLE PROCESSING                            *
044500200610     F***XDATE3**-**CALCULATE*BUSINESS*DAYS*BACKWARDS***************S01232S01195
044600200610     F*  ZBKDT   -  CALCULATE BUSINESS DAYS BACKWARDS                 *   S01195
044700200610     F*  ZACCR   -  CALCULATE ACCRUED INTEREST BETWEEN DATES          *   S01232
044800200610     F*  ZACCZ   -  CALCULATE ACCRUED INTEREST                        *   S01232
044900200610     F*  ZCALCD  -  CALCULATE LONG TERM CD PRICE FROM INPUT YIELD     *   E39495
045000200610     F*  ZCNSD   -  CALCULATE CONSIDERATION                           *   E39495
045100200610     F*  ZSDESC  -  FORMAT SECURITY REPORT DESCRIPTION FOR DISPLAY    *
045200200610     F*  ZSEDIT  -  EDIT FIELDS FOR OUTPUT                            *
045300200610     F*  ZXRATE  -  EXCHGE RATE AND M/D IND. BETWEEN 2 CURRENCIES     *
045400200610     F***ZALIGN**-**VALIDATE*AND*RIGHT-ALIGN*NUMERIC*FIELDS************   S01117
045500200610     F*  ZCONV   -  CONVERT AMOUNT FROM ONE CURRENCY TO ANOTHER       *
045600200610     F*  ZDATE2  -  DATE FORMATTER                                    *
045700200610     F***ZSYSTM**-**ACCESS*ICDR1***************************************   S01117
045800200610     F***ZICD2***-**ACCESS*ICDR2***************************************   S01117
045900200610     F***ZICDSE**-**ACCESS*ICDSE***************************************   S01117
046000200610     F*  ZPRCI   -  CALCULATE PRICE                                   *   S01176
046100200610     F*  ZRATE   -  DETERMINE EFFECTIVE INTEREST RATE                 *   S01232
046200200610     F*  ZYCE    -  DETERMINE AUSTRALIAN YIELD CUM/EX PARAMETER       *   S01232
046300200610     F*  ZYMTX   -  CALCULATE YIELD                                   *   S01176
046400200610     F*  *PSSR   -  HANDLE DATABASE ERRORS                            *   S01117
046500200610     F*                                                               *
046600200610     F*****************************************************************
046700200610      /EJECT
046800200610     E/COPY ZSRSRC,ZDATE2Z1
046900200610     E/COPY ZSRSRC,ZDATE6Z1                                               S01232
047000200610     E********************MSG     1  15 79               Error Messages   E23190
047100200610     E***********         MSG     1  16 79               Error Messages   E23190
047200200610     E***********         MSG     1  18 79               Error MessS01117 054258
047300200610     E***********         MSG     1  19 79               Error Mess054258 CAC005
047400200610     E                    MSG     1  23 79               Error Messages   CAC005
047500200610     E/COPY ZSRSRC,ZDAYSZ1                                                S01176
047600200610     E/COPY ZSRSRC,ZPOWERZ1
047700200610     E/COPY ZSRSRC,ZPOWER8Z1
047800200610     E/COPY ZSRSRC,ZSEDITZ1
047900200610     E*/COPY*ZSRSRC,ZALIGNZ1***                                           S01117
048000200610      /COPY ZSRSRC,ZSDESCZ1
048100200610     E                    CPY@    1   1 80
048200200610     E/COPY ZSRSRC,ZNCDZ1                                                 S01176
048300200610     E/COPY ZSRSRC,ZYMTXZ1                                                S01176
048400200610     E/COPY ZSRSRC,ZHOLE                                                  S01195
048500200610      /EJECT
048600200610     I@CUSTFR                                                             S01117
048700200610     I              BBCUST                          CNUM                  S01117
048800200610     I*
048900200610     IUDEPPDF
049000200610     I*
049100200610     I*   RENAME FIELDS USED ON UDEPS SO LOOK LIKE CDEPS
049200200610     I*
049300200610     I***********   UDBR                            CDBR                  S01117
049400200610     I              UDBA                            CDPA                  S01117
049500200610     I              UDBK                            CDBK
049600200610     I              UDMK                            CDMK
049700200610     I              UDNT                            CDNT
049800200610     I              UDNV                            CDNV
049900200610     I              UDTP                            SNPT
050000200610     I              UDTS                            CDST
050100200610     I              UDPV                            CNPV
050200200610     I              UDSV                            CNSV
050300200610     I/COPY ZSRSRC,ZNCDZ2
0504002006100273 I            DS
0505002006100274 I                                        1  10 CUSTWK
0506002006100275 I                                        1   6 SCSNMA
0507002006100276 I                                        7  10 SCSNMB
050800200610     I/COPY ZSRSRC,ZSEDITZ2
050900200610     I            DS
051000200610     I**********                              1   60CUSTNO                                    CSD027
051100200610     I                                        1   6 CUSTNO                                    CSD027
051200200610     I                                        1   6 CUSTIP
051300200610     I            DS
051400200610     I                                        1   6 SPAREN
051500200610     I                                        1   60PARENT
051600200610     I*LDA*******UDS                            256                       S01117
051700200610     ILDA         DS                            256                       S01117
051800200610     I*
051900200610     I*      Local data area.
052000200610     I*
052100200610     I***********                           134 138 DBFILE                S01117
052200200610     I***********                           139 167 DBKEY                 S01117
052300200610     I***********                           168 175 DBPGM                 S01117
052400200610     I***********                           176 1770DBASE                 S01117
052500200610     I                                      134 183 DBLOT                 S01117
052600200610     I                                      134 141 DBFILE                S01117
052700200610     I                                      142 170 DBKEY                 S01117
052800200610     I                                      171 180 DBPGM                 S01117
052900200610     I                                      181 1830DBASE                 S01117
053000200610     I*                                                                   S01117
053100200610     I**  EXTERNAL DS FOR SD CUSTOMER DETAILS                             S01117
053200200610     ISDCUST    E DSSDCUSTPD                                              S01117
053300200610     I*                                                                   S01117
053400200610     I**  EXTERNAL DS FOR BANK DETAILS                                    S01117
053500200610     ISDBANK    E DSSDBANKPD                                              S01117
053600200610     I*                                                                   S01117
053700200610     I**  EXTERNAL DS FOR DEALING DATA                                    S01117
053800200610     ISDDEAL    E DSSDDEALPD                                              S01117
053900200610     I*                                                                   S01117
054000200610     I**  EXTERNAL DS FOR SD CURRENCY DETAILS                             S01117
054100200610     ISDCURR    E DSSDCURRPD                                              S01117
054200200610     I*                                                                   S01117
054300200610     I**  EXTERNAL DS FOR SECURITIES TRADING DETAILS                      S01117
054400200610     ISDSTRD    E DSSDSTRDPD                                              S01117
054500200610     I*                                                                   S01117
054600200610     I**  EXTERNAL DS FOR GENERAL LEDGER ICD DETAILS                      S01117
054700200610     ISDGELR    E DSSDGELRPD                                              S01117
054800200610     I              QQACCD                          QQACD1                                    CGL029
054900200610     I*                                                                   S01117
055000200610     I**  EXTERNAL DS FOR SD BRANCH DETAILS                               S01117
055100200610     ISDBRCH    E DSSDBRCHPD                                              S01117
055200200610     I              QQDFAC                          #DFAC1                                    CGL029
055300200610     I*                                                                   S01117
055400200610     I**  EXTERNAL DS FOR SE CLIENTS DETAILS                              S01117
055500200610     ISDSECS    E DSSDSECSPD                                              S01117
055600200610     I              QQACCD                          QQACD2                                    CGL029
055700200610     I*                                                                   S01117
055800200610     I**  EXTERNAL DS FOR BOOK DETAILS                                    S01117
055900200610     ISDBOOK    E DSSDBOOKPD                                              S01117
056000200610     I*                                                                   CAC005
056100200610     I**  External DS for Profit Centre Details                           CAC005
056200200610     ISDPRFC    E DSSDPRFCPD                                              CAC005
056300200610     I*                                                                   S01117
056400200610      **  External Data Structure for Switchable Features file            CGL011
056500200610     ISCSARD    E DSSCSARDPD                                              CGL011
056600200610      *                                                                   CGL011
056700200610     I**  DATA STRUCTURE FOR RUN DATE DETAILS                             S01117
056800200610     IRUNDT       DS                                                      S01117
056900200610     I                                        1   7 RUNA                  S01117
057000200610     I                                    P   8  100RUND                  S01117
057100200610     I                                       11  11 SSF                   S01117
057200200610     I                                       12  12 DATF                  S01117
057300200610     I                                       13  13 MBIN                  S01117
057400200610     I**                                                                  S01117
057500200610     I**  DATA STRUCTURE FOR ZMUSER                                       S01117
057600200610     IZMUSER      DS                             17                       S01117
057700200610     I                                       11  13 USRBCH                S01117
057800200610     I                                       17  17 BKLAUT                054258
057900200610     I**                                                                  S01117
058000200610     I** DATA STRUCTURE FOR ACCESS OBJECTS, SHORT DATA STRUCTURE          S01117
058100200610     IDSFDY     E DSDSFDY                                                 S01117
058200200610     I*                                                                   S01117
058300200610     I** LONG STRUCTURE FOR ACCESS OBJECTS, LONG DATA STRUCTURE           S01117
058400200610     IDSSDY     E DSDSSDY                                                 S01117
058500200610     I*                                                                   S01117
058600200610     I*                                                                   235150
058700200610     I*  THIRD DS FOR ACCESS PROGRAMS, VERY LONG DATA STRUCTURE           235150
058800200610     IDSLDY     E DSDSLDY                                                 235150
058900200610     I*                                                                   235150
059000200610     I**  LINK ENQUIRY DATA AREA
059100200610     ISESDS     E DS
059200200610     IPSDS       SDS
059300200610     I                                        1  10 PROGRM
059400200610     I                                      244 246 WSID
059500200610     ISCRDS       DS
059600200610     I                                      287 288 AID
059700200610      /COPY ZSRSRC,ZSDESCZ2
059800200610     I*
059900200610     I*   JNSTAT DATA AREA
060000200610     IJNSTAT     UDS                            200
060100200610     I                                    P 103 1050PRUN
060200200610     I*
060300200610     I            DS
060400200610     I*
060500200610     I*   DATA STRUCTURES FOR SETTING UP SFL LINES
060600200610     I*
060700200610     I                                        1  77 SPLIN1
060800200610     I                                        1  10 SSESN
060900200610     I                                       12  21 SSCUS
061000200610     I***********                            16  17 SBOOK                 CAC005
061100200610     I                                       14  15 SBOOK                 CAC005
061200200610     I                                       17  20 SPRFC                 CAC005
061300200610     I                                       23  25 SCURR
061400200610     I                                       27  42 STNOM
061500200610     I                                       44  59 SSVAL
061600200610     I                                       61  61 SBVI
061700200610     I                                       65  77 SEXPV
061800200610     I            DS
061900200610     I                                        1  77 SPLIN2
062000200610     I                                        2   4 SBR
062100200610     I                                        7   7 SMK
062200200610     I                                       10  50 SDESC
062300200610     I            DS
062400200610     I                                        1  77 TOTLIN
062500200610     I                                       46  59 STOT
062600200610     I                                       46  52 STOT1
062700200610     I                                       53  59 STOT2
062800200610     I                                       64  77 STOTE
0629002006100257 I            DS
0630002006100258 I                                        1   6 IKEY
0631002006100259 I                                        1   3 NMCY
0632002006100260 I                                        4   6 SITP
063300200610     I*
063400200610     I            DS
063500200610     I*
063600200610     I*   DATA STRUCTURES OVER SELECTION CRITERIA
063700200610     I*
063800200610     I                                        1  10 ISSUER
063900200610     I                                       11  20 CUSTMR
064000200610     I                                       21  23 BRANCH
064100200610     I                                       24  25 BOOKIN
064200200610     I                                       26  28 EXPCCY
064300200610     I                                       29  29 FACTRD
064400200610     I***********                             1  29 SELCRI                CAC005
064500200610     I                                        1  33 SELCRI                CAC005
064600200610     I                                       30  33 PRFC                  CAC005
064700200610     I            DS
064800200610     I                                        1  10 FACT
064900200610     I                                        1   5 FAC1
065000200610     I                                        6  10 FAC2
065100200610     I                                       11  20 UNFACT
065200200610     I                                       11  15 UFAC1
065300200610     I                                       16  20 UFAC2
065400200610     I            DS
065500200610     I                                        1  150ZZNOML
065600200610     I                                        1  120ZZNOMT
065700200610     I                                       13  130ZZHUND
065800200610     I*
065900200610     ICPYR@#      DS
066000200610     I*
066100200610     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
066200200610     I*
066300200610     I                                        1  80 CPY@
066400200610     I                                        1  20 CPY@##
066500200610     I/COPY ZSRSRC,ZYLDZ1
066600200610     I/COPY ZSRSRC,ZHOLI                                                  S01195
066700200610     I/COPY WNCPYSRC,SE0265I001
066800200610      *                                                                   CGL011
066900200610     I              'Collateral'          C         COLLA                 CGL011
067000200610      ** Constant field for collateral text narrative                     CGL011
067100200610      *                                                                   CGL011
067200200610      /EJECT
067300200610     C**
067400200610     C           *NAMVAR   DEFN           SESDS
067500200610     C           *NAMVAR   DEFN           LDA
067600200610     C           *NAMVAR   DEFN           JNSTAT
067700200610     C**
067800200610     C**  DEFINE OTHER LIKE FIELDS
067900200610     C**
068000200610     C************LIKE     DEFN SPOT      ZRATE1                          S01117
068100200610     C************LIKE     DEFN SPOT      ZRATE2                          S01117
068200200610     C           *LIKE     DEFN A6SPRT    ZRATE1                          S01117
068300200610     C           *LIKE     DEFN A6SPRT    ZRATE2                          S01117
068400200610     C           *LIKE     DEFN CNUM      ISSCHK
068500200610     C           *LIKE     DEFN CNUM      CUSCHK
068600200610     C           *LIKE     DEFN EXPCCY    CURCHK
068700200610     C           *LIKE     DEFN FACTRD    FACCHK
068800200610     C           *LIKE     DEFN BOOKIN    BOKCHK
068900200610     C************LIKE     DEFN CDBR      BRCCHK                          S01117
069000200610     C           *LIKE     DEFN CDPA      BRCCHK                          S01117
069100200610     C           *LIKE     DEFN CDNT      ZZAPC
069200200610     C           *LIKE     DEFN PPRC      ZZAPW
069300200610     C           *LIKE     DEFN CDNT      ZNNOMP
069400200610     C************LIKE     DEFN CTWN      ITOWN                           S01117
069500200610     C           *LIKE     DEFN BBCRTN    ITOWN                           S01117
069600200610     C           *LIKE     DEFN CDBK      SAVBK
069700200610     C************LIKE     DEFN CDBR      SAVBR                           S01117
069800200610     C           *LIKE     DEFN CDPA      SAVBR                           S01117
069900200610     C           *LIKE     DEFN CDMK      SAVMK
070000200610     C           *LIKE     DEFN CDCN      SAVCN
070100200610     C************LIKE     DEFN CRNM      ISNAME                          S01117
070200200610     C           *LIKE     DEFN BBCRNM    ISNAME                          S01117
070300200610     C           *LIKE     DEFN ISSR      LTISS
070400200610     C           KEYI      KLIST
070500200610     C                     KFLD           NMCY
070600200610     C                     KFLD           SITP
070700200610     C           KEYPT     KLIST
070800200610     C                     KFLD           PTYP    2
070900200610     C                     KFLD           SESN
071000200610     C                     KFLD           PDAT    50
071100200610     C**********           KFLD           PCST    60                                          CSD027
071200200610     C                     KFLD           PCST    6                                           CSD027
071300200610     C           KEYPTP    KLIST
071400200610     C                     KFLD           PTYP
071500200610     C                     KFLD           SESN
071600200610     C           KEYP      KLIST
071700200610     C                     KFLD           SESN
071800200610     C                     KFLD           SAVBR
071900200610     C                     KFLD           SAVMK
072000200610     C                     KFLD           SAVBK
072100200610     C                     KFLD           SAVCN
072200200610     C                     KFLD           PPRT
072300200610     C           KEYPD     KLIST
072400200610     C                     KFLD           SESN
072500200610     C                     KFLD           SAVBR
072600200610     C                     KFLD           SAVMK
072700200610     C                     KFLD           SAVBK
072800200610     C                     KFLD           SAVCN
072900200610     C                     KFLD           PPRT
073000200610     C                     KFLD           RUND
073100200610     C           KEYPP     KLIST
073200200610     C                     KFLD           SESN
073300200610     C                     KFLD           SAVBR
073400200610     C                     KFLD           SAVMK
073500200610     C                     KFLD           SAVBK
073600200610     C                     KFLD           SAVCN
073700200610     C                     KFLD           PPRT
073800200610     C                     KFLD           PRUN
073900200610     C           KEYBH     KLIST
074000200610     C                     KFLD           SESN
074100200610     C                     KFLD           SAVBR
074200200610     C                     KFLD           SAVBK
074300200610     C                     KFLD           SAVMK
074400200610     C***********          KFLD           TVVL                            S01117
074500200610     C                     KFLD           BVTVDV                          S01117
074600200610     C           KEYBP     KLIST
074700200610     C                     KFLD           SESN
074800200610     C                     KFLD           SAVBR
074900200610     C                     KFLD           SAVBK
075000200610     C                     KFLD           SAVMK
075100200610     C***********          KFLD           TVVL                            S01117
075200200610     C                     KFLD           BVTVDV                          S01117
075300200610     C                     KFLD           LPSD
075400200610      *                                                                   CGL011
075500200610     C           KEYVD     KLIST                                          CGL011
075600200610     C                     KFLD           SAVBR                           CGL011
075700200610     C                     KFLD           SESN                            CGL011
075800200610     C*                                                                   S01176
075900200610     C* Key to access Commercial Paper Prices                             S01176
076000200610     C*                                                                   S01176
076100200610     C           CPPKA     KLIST                                          S01176
076200200610     C                     KFLD           KINVT   3                       S01176
076300200610     C                     KFLD           KCCY    3                       S01176
076400200610     C*                                                                   054259
076500200610     C** Key to access SECURITY EVENTS DIARY                              054259
076600200610     C*                                                                   054259
076700200610     C           KEYSED    KLIST                                          054259
076800200610     C                     KFLD           SDSN                            054259
076900200610     C                     KFLD           SDET                            054259
077000200610     C                     KFLD           SDED                            054259
077100200610     C/COPY WNCPYSRC,SE0265C010
077200200610     C*                                                                   S01117
077300200610     C**  INITIALISE DATA AREA LDA                                        S01117
077400200610     C*                                                                   S01117
077500200610     C           *LOCK     IN   LDA                                       S01117
077600200610     C                     MOVEL*BLANK    DBLOT                           S01117
077700200610     C                     MOVELPROGRM    DBPGM                           S01117
077800200610     C                     OUT  LDA                                       S01117
077900200610     C*                                                                   S01117
078000200610     C**Key*to*access*Securities*customer*file*********************E23190 S01117
078100200610     C***********                                                  E23190 S01117
078200200610     C***********SECNM     KLIST                                   E23190 S01117
078300200610     C***********          KFLD           CNUM                     E23190 S01117
078400200610     C***********          KFLD           RCDA    1                E23190 S01117
078500200610     C**
078600200610     C**  DO FIRST CYCLE PROCESSING
078700200610     C**
078800200610     C                     EXSR FIRST
078900200610     C**
079000200610     C**  MAIN PROCESSING    -    Do until end of job requested
079100200610     C**
079200200610     C           *IN01     DOWEQ'0'
079300200610     C**
079400200610     C**    Display the screen
079500200610     C**
079600200610     C           *LIKE     DEFN ISSUER    ISSSV                           082129
079700200610     C                     MOVELISSUER    ISSSV                           082129
079800200610     C                     WRITESE0265F0
079900200610     C                     EXFMTSE0265C0
080000200610     C**
080100200610     C** Call S/R to move values into AID                                 S01179
080200200610     C*                                                                   S01179
080300200610     C                     EXSR ASCHGS                                    S01179
080400200610     C**
080500200610     C**    Clear the error messages unless HELP pressed
080600200610     C**
080700200610     C           AID       IFNE 'HP'
080800200610     C                     MOVE *BLANKS   ERMSG  79
080900200610     C                     SETOF                     414243
081000200610     C                     SETOF                     444546
081100200610     C                     SETOF                     47
081200200610     C                     MOVE *OFF      *IN62                           CAC005
081300200610     C                     END
081400200610     C**
081500200610     C**    Check Command Keys - including HELP
081600200610     C**
081700200610     C                     EXSR COMMD
081800200610     C**
081900200610     C**    If Enter has been pressed check validity of options
082000200610     C**
082100200610     C           AID       IFEQ 'RA'
082200200610     C**
082300200610     C**    Check Validity of Option Combinations
082400200610     C**
082500200610     C**  Check if selection is requested by user                         S01117
082600200610     C**  If so, process selection.                                       S01117
082700200610     C*                                                                   S01117
082800200610     C                     EXSR CHKSEL                                    S01117
082900200610     C*                                                                   S01117
083000200610     C**  If selection is requested, re-display all the input items.      S01117
083100200610     C**  Do NOT process enquiry until user confirm what is selected      S01117
083200200610     C**  is CORRECT by hitting 'ENTER' again.                            S01117
083300200610     C*                                                                   S01117
083400200610     C           @SEL      IFEQ 'N'                                       S01117
083500200610     C*                                                                   S01117
083600200610     C                     EXSR OPTION
083700200610     C                     SETOF                     51
083800200610     C**
083900200610     C           *IN42     IFEQ '0'
084000200610     C**
084100200610     C**    Check if no lower level option selected
084200200610     C**
084300200610     C           SELCRI    IFNE *BLANKS
084400200610     C                     EXSR CUSTIN
084500200610     C                     END
084600200610     C**
084700200610     C**    Lower Level Enquiry Selected
084800200610     C**
084900200610     C           OPTN      IFNE *BLANK
085000200610     C                     EXSR LINK
085100200610     C                     END
085200200610     C**
085300200610     C                     END
085400200610     C                     END
085500200610     C*                                                                   S01117
085600200610     C                     END                                            S01117
085700200610     C                     END
085800200610     C**
085900200610     C**   Return to calling program
086000200610     C**
086100200610     C                     EXSR RETSR
086200200610     C**
086300200610     C*****************************************************************
086400200610     C/EJECT
086500200610     C*****************************************************************
086600200610     C**                                                              *
086700200610     C**    COMMD   SR   To process Command Keys                      *
086800200610     C**                 and HELP, ROLLUP and ROLLDOWN                *
086900200610     C**                                                              *
087000200610     C**    Called  By   MAIN                                         *
087100200610     C**                                                              *
087200200610     C**    Calls   SR   ROLLUP, CLEAR, CUSSEC                        *
087300200610     C**                                                              *
087400200610     C**    Calls  PGM   MHELP                                        *
087500200610     C**                                                              *
087600200610     C*****************************************************************
087700200610     C**
087800200610     C           COMMD     BEGSR                           ** COMMD **
087900200610     C**
088000200610     C*****If*HELP*pressed*call*help*screen****
088100200610     C**
088200200610     C********** AID       IFEQ 'HP'                                      S01199
088300200610     C**********           CALL 'MHELP'                                   S01199
088400200610     C**********           PARM           PGMNO                           S01199
088500200610     C**********           PARM           HERCD 160                       S01199
088600200610     C**********           END                                            S01199
088700200610     C**
088800200610     C**    If Rollup key pressed
088900200610     C**
089000200610     C           AID       IFEQ 'UP'
089100200610     C                     EXSR ROLLUP
089200200610     C                     END
089300200610     C**
089400200610     C**    If Rolldown key pressed
089500200610     C**
089600200610     C           AID       IFEQ 'DN'
089700200610     C                     EXSR ROLLDN
089800200610     C                     END
089900200610     C**
090000200610     C**    If F3 then exit to menu - return code 1 and end
090100200610     C**
090200200610     C           AID       IFEQ '01'
090300200610     C                     MOVE '1'       RTNC
090400200610     C                     MOVE '1'       *IN01
090500200610     C                     END
090600200610     C**
090700200610     C**    If F12 then return to previous enquiry - return code 2
090800200610     C**                  unless there is no previous enquiry
090900200610     C**
091000200610     C           AID       IFEQ '02'
091100200610     C           ORIG      IFNE PGMNO
091200200610     C                     MOVE '2'       RTNC
091300200610     C                     MOVE '1'       *IN01
091400200610     C                     ELSE
091500200610     C                     MOVE '1'       *IN42
091600200610     C                     MOVE MSG,6     ERMSG
091700200610     C                     END
091800200610     C                     END
091900200610     C**
092000200610     C**    If F5 then refresh enquiry screen
092100200610     C**
092200200610     C           AID       IFEQ '05'
092300200610     C                     EXSR CLEAR
092400200610     C                     END
092500200610     C**
092600200610     C**    If F6 then call Customer Shortname Enquiry
092700200610     C**             On return check return code
092800200610     C**             if 0 then Database Error and exit required
092900200610     C**             if 1 then F3 and exit to menu required
093000200610     C**             otherwise retrieve customer or security shortname
093100200610     C**
093200200610     C           AID       IFEQ '06'
093300200610     C                     MOVE *BLANKS   ERMSG  79
093400200610     C                     SETOF                     404142
093500200610     C                     SETOF                     434445
093600200610     C                     SETOF                     4647
093700200610     C                     MOVE *OFF      *IN62                           CAC005
093800200610     C           CUSTMR    IFNE *BLANKS
093900200610     C           ISSUER    ANDNE*BLANKS
094000200610     C                     SETON                     414244
094100200610     C                     MOVE MSG,13    ERMSG
094200200610     C                     ELSE
094300200610     C           ISSUER    IFEQ *BLANKS
094400200610     C                     OUT  SESDS
094500200610     C                     OUT  LDA
094600200610     C*******************  CALL 'SE0270'                                  E19964
094700200610     C                     CALL 'SE0275'                                  E19964
094800200610     C           *LOCK     IN   LDA
094900200610     C           *LOCK     IN   SESDS
095000200610     C           RTNC      IFEQ '0'
095100200610     C           RTNC      OREQ '1'
095200200610     C                     MOVE '1'       *IN01
095300200610     C                     ELSE
095400200610     C                     MOVELRQCUST    ISSUER
095500200610     C                     MOVE *BLANKS   RQCUST
095600200610     C                     END
095700200610      *
095800200610     C                     ELSE
095900200610     C                     OUT  SESDS
096000200610     C                     OUT  LDA
096100200610     C                     CALL 'SE0270'
096200200610     C           *LOCK     IN   LDA
096300200610     C           *LOCK     IN   SESDS
096400200610     C           RTNC      IFEQ '0'
096500200610     C           RTNC      OREQ '1'
096600200610     C                     MOVE '1'       *IN01
096700200610     C                     ELSE
096800200610     C                     MOVELRQCUST    CUSTMR
096900200610     C                     MOVE *BLANKS   RQSESN
097000200610     C                     END
097100200610     C                     END
097200200610     C                     END
097300200610     C                     END
097400200610     C**
097500200610     C**     If F9 then return to initial enquiry - return code 7
097600200610     C**                   unless this is the initial program
097700200610     C**
097800200610     C           AID       IFEQ '07'
097900200610     C           ORIG      IFNE PGMNO
098000200610     C                     MOVE '7'       RTNC
098100200610     C                     MOVE '1'       *IN01
098200200610     C                     ELSE
098300200610     C                     MOVE '1'       *IN42
098400200610     C                     MOVE MSG,6     ERMSG
098500200610     C                     END
098600200610     C                     END
098700200610     C**
098800200610     C                     ENDSR
098900200610     C**
099000200610     C*****************************************************************
099100200610     C/EJECT
099200200610     C*****************************************************************
099300200610      **           ****** AS400 CONVERSION ******                     *   S01179
099400200610      **                                                              *   S01179
099500200610      ** ASCHGS S/R TO MOVE THE APPROPRIATE VALUES INTO FIELD AID,    *   S01179
099600200610      ** DEPENDING ON WHICH FUNCTION KEY HAS BEEN PRESSED.            *   S01179
099700200610      ** CALLED FROM UPDATE                                           *   S01179
099800200610      **                                                              *   S01179
099900200610     C*****************************************************************   S01179
100000200610     C*                                                                   S01179
100100200610     C           ASCHGS    BEGSR                                          S01179
100200200610     C*                                                                   S01179
100300200610     C* If ENTER pressed, the VLDCMDKEY indicator will be off             S01179
100400200610     C*                                                                   S01179
100500200610     C           *IN10     IFEQ '0'                                       S01179
100600200610     C                     MOVE 'RA'      AID                             S01179
100700200610     C                     END                                            S01179
100800200610     C*                                                                   S01179
100900200610     C* If F3                                                             S01179
101000200610     C*                                                                   S01179
101100200610     C           *INKC     IFEQ '1'                                       S01179
101200200610     C                     MOVE '01'      AID                             S01179
101300200610     C                     MOVE '0'       *INKC                           S01179
101400200610     C                     END                                            S01179
101500200610     C*                                                                   S01179
101600200610     C* If F5                                                             S01179
101700200610     C*                                                                   S01179
101800200610     C           *INKE     IFEQ '1'                                       S01179
101900200610     C                     MOVE '05'      AID                             S01179
102000200610     C                     MOVE '0'       *INKE                           S01179
102100200610     C                     END                                            S01179
102200200610     C*                                                                   S01179
102300200610     C* If F6                                                             S01179
102400200610     C*                                                                   S01179
102500200610     C           *INKF     IFEQ '1'                                       S01179
102600200610     C                     MOVE '06'      AID                             S01179
102700200610     C                     MOVE '0'       *INKF                           S01179
102800200610     C                     END                                            S01179
102900200610     C*                                                                   S01179
103000200610     C* If F9                                                             S01179
103100200610     C*                                                                   S01179
103200200610     C           *INKI     IFEQ '1'                                       S01179
103300200610     C                     MOVE '07'      AID                             S01179
103400200610     C                     MOVE '0'       *INKI                           S01179
103500200610     C                     END                                            S01179
103600200610     C*                                                                   S01179
103700200610     C* If F12                                                            S01179
103800200610     C*                                                                   S01179
103900200610     C           *INKL     IFEQ '1'                                       S01179
104000200610     C                     MOVE '02'      AID                             S01179
104100200610     C                     MOVE '0'       *INKL                           S01179
104200200610     C                     END                                            S01179
104300200610     C*                                                                   S01179
104400200610     C* If ROLLUP pressed                                                 S01179
104500200610     C*                                                                   S01179
104600200610     C           *IN20     IFEQ '1'                                       S01179
104700200610     C                     MOVE 'UP'      AID                             S01179
104800200610     C                     MOVE '0'       *IN20                           S01179
104900200610     C                     END                                            S01179
105000200610     C*                                                                   S01179
105100200610     C* If ROLLDOWN pressed                                               S01179
105200200610     C*                                                                   S01179
105300200610     C           *IN21     IFEQ '1'                                       S01179
105400200610     C******************** MOVE 'UP'      AID                     S01179  E19964
105500200610     C                     MOVE 'DN'      AID                     S01179  E19964
105600200610     C                     MOVE '0'       *IN21                           S01179
105700200610     C                     END                                            S01179
105800200610     C*                                                                   S01179
105900200610     C**If*HELP*key*pressed****                                           S01179
106000200610     C*                                                                   S01179
106100200610     C********** *IN22     IFEQ '1'                                S01179 S01199
106200200610     C**********           MOVE 'HP'      AID                      S01179 S01199
106300200610     C**********           MOVE '0'       *IN22                    S01179 S01199
106400200610     C**********           END                                     S01179 S01199
106500200610     C*                                                                   S01179
106600200610     C                     ENDSR                                          S01179
106700200610     C*****************************************************************
106800200610     C/EJECT
106900200610     C*****************************************************************
107000200610     C**   ROLLUP SR  When Rollup key is pressed load next page for   *
107100200610     C**              issuer or 1st page for next issuer if group sel *
107200200610     C**              If end of issuer/group display error message.   *
107300200610     C**                                                              *
107400200610     C**   Called by  COMMD                                           *
107500200610     C**                                                              *
107600200610     C**   Calls  SR  DISP                                            *
107700200610     C**                                                              *
107800200610     C*****************************************************************
107900200610     C**
108000200610     C           ROLLUP    BEGSR                           ** ROLLUP **
108100200610     C**
108200200610     C** If details complete then Rollup is beyond last record.
108300200610     C**
108400200610     C           *IN05     IFEQ '1'
108500200610     C           *IN60     ANDEQ'0'
108600200610     C                     MOVE '1'       *IN06
108700200610     C                     ELSE
108800200610     C**
108900200610     C** If details complete for issuer & group selected -
109000200610     C** clear SFL and load 1st page for next issuer
109100200610     C**
109200200610     C           *IN60     IFEQ '1'
109300200610     C           *IN05     ANDEQ'1'
109400200610     C***********          Z-ADDISSCHK    LTISS                           S01117
109500200610     C                     MOVE ISSCHK    LTISS                           S01117
109600200610     C                     SETON                     03
109700200610     C           PACUSR    TAG                             *** PACUSR  ***
109800200610     C***********          READ PACUS                    25               S01117
109900200610     C                     READ SDCUSTL4                 25               S01117
110000200610     C           *IN25     IFEQ '0'
110100200610     C***********CPAR      ANDEQPARENT                                    S01117
110200200610     C***********CNUM      CABEQCPAR      PACUSR                          S01117
110300200610     C           BBPCNB    ANDEQSPAREN                                    S01117
110400200610     C           CNUM      CABEQBBPCNB    PACUSR                          S01117
110500200610     C***********          Z-ADDCNUM      CUSTNO  60                      S01117
110600200610     C**********           MOVE CNUM      CUSTNO  60                                   S01117 CSD027
110700200610     C                     MOVE CNUM      CUSTNO  6                                           CSD027
110800200610     C**
110900200610     C***Get*Clintcb*for*new*issuer************************************   S01117
111000200610     C***********                                                         S01117
111100200610     C***********CUSTNO    CHAINCLINTCBF             25                   S01117
111200200610     C************IN25     IFEQ '0'                                       S01117
111300200610     C***********RECI      IFEQ '*'                                       S01117
111400200610     C***********          SETON                     25                   S01117
111500200610     C***********          END                                            S01117
111600200610     C***********          END                                            S01117
111700200610     C************IN25     IFEQ '1'                                       S01117
111800200610     C**                                                                  S01117
111900200610     C** Get SDCUSTPD for new issuer                                      S01117
112000200610     C**                                                                  S01117
112100200610     C                     MOVELCUSTNO    KEY1   10                       S01117
112200200610     C*                                                                   S01117
112300200610     C                     CALL 'AOCUSTR0'                                S01117
112400200610     C                     PARM '*DBERR ' @RTCD   7                       S01117
112500200610     C                     PARM '*KEY   ' @KEY    7                       S01117
112600200610     C                     PARM KEY1      @KEY1  10                       S01117
112700200610     C                     PARM           @KYST   7                       S01117
112800200610     C           SDCUST    PARM SDCUST    DSSDY                           S01117
112900200610     C*                                                                   S01117
113000200610     C***********          MOVELPROGRM    DBPGM            ************   S01117
113100200610     C***********          MOVELCUSTNO    DBKEY            * DATABASE *   S01117
113200200610     C***********          MOVE 'CLINT'   DBFILE           **ERROR*09**   E20651
113300200610     C***********          Z-ADD09        DBASE            ************   E20651
113400200610     C***********          MOVE 'CLINT'   DBFILE           **ERR   E20651 S01117
113500200610     C***********          Z-ADD10        DBASE            *****   E20651 S01117
113600200610     C***********          SETON                       U7U8               S01117
113700200610     C***********          MOVE '0'       RTNC                            S01117
113800200610     C***********          EXSR RETSR                                     S01117
113900200610     C***********          ELSE                                           S01117
114000200610     C                     MOVE BBCUST    CNUM                            S01117
114100200610     C***********          Z-ADDCNUM      ISSCHK                          S01117
114200200610     C                     MOVE CNUM      ISSCHK                          S01117
114300200610     C***********          MOVE CRNM      ISNAME                          S01117
114400200610     C***********          MOVE CTWN      ITOWN                           S01117
114500200610     C                     MOVE BBCRNM    ISNAME                          S01117
114600200610     C                     MOVE BBCRTN    ITOWN                           S01117
114700200610     C                     MOVE ISSCHK    SISNO
114800200610     C***********          MOVE CRNM      SIRNM                           S01117
114900200610     C***********          MOVE CTWN      SIRTN                           S01117
115000200610     C                     MOVE BBCRNM    SIRNM                           S01117
115100200610     C                     MOVE BBCRTN    SIRTN                           S01117
115200200610     C***********          END                                            S01117
115300200610     C                     SETON                     02
115400200610     C                     WRITESE0265C0
115500200610     C                     SETOF                     020405
115600200610     C                     SETOF                     81
115700200610     C                     Z-ADD0         SFLREC
115800200610     C                     Z-ADD0         TOP
115900200610     C**
116000200610     C**   Position SECTY at start of required ISSUER
116100200610     C**
116200200610     C***********ISSCHK    SETLLSECTI                                     S01117
116300200610     C**********           MOVE ISSCHK    @TCHK   60                                   S01117 CSD027
116400200610     C                     MOVE ISSCHK    @TCHK   6                                           CSD027
116500200610     C           @TCHK     SETLLSECTI                                     S01117
116600200610     C**
116700200610     C                     EXSR DISP
116800200610     C                     ELSE
116900200610     C                     SETON                     0506
117000200610     C                     SETOF                     03
117100200610     C                     Z-ADD1         SFLREC
117200200610     C                     END
117300200610     C                     ELSE
117400200610     C**
117500200610     C** Otherwise load next page for same issuer
117600200610     C**
117700200610     C                     Z-ADDTOP       SFLREC
117800200610     C                     EXSR DISP
117900200610     C                     END
118000200610     C                     END
118100200610     C**
118200200610     C                     ENDSR
118300200610     C/EJECT
118400200610     C**
118500200610     C*****************************************************************
118600200610      /EJECT
118700200610     C*****************************************************************
118800200610     C**                                                              *
118900200610     C**   ROLLDN   SUBROUTINE                                        *
119000200610     C**                                                              *
119100200610     C**   Called by  COMMD                                           *
119200200610     C**                                                              *
119300200610     C**   Calls  SR  SUBFIL                                          *
119400200610     C**                                                              *
119500200610     C*****************************************************************
119600200610     C**
119700200610     C           ROLLDN    BEGSR                              ** ROLLDN
119800200610     C**
119900200610     C**  IF NO PREVIOUS KEY ROLLDOWN IS BEYOND last record
120000200610     C**
120100200610     C********** LTISS     IFEQ 0                                                             CSD027
120200200610     C           LTISS     IFEQ *BLANKS                                                       CSD027
120300200610     C******************** SETON                     0506                 E19964
120400200610     C                     SETON                     06                   E19964
120500200610     C                     Z-ADD1         SFLREC
120600200610     C                     ELSE
120700200610     C**
120800200610     C**  Else reset file to previous set & refill SFL
120900200610     C**
121000200610     C                     SETON                     02
121100200610     C                     WRITESE0265C0
121200200610     C                     SETOF                     0281
121300200610     C                     SETOF                     0405
121400200610     C                     SETON                     03
121500200610     C                     Z-ADD0         SFLREC
121600200610     C                     Z-ADD0         TOP
121700200610     C           LTISS     SETLLSECTI
121800200610     C***********          Z-ADDLTISS     ISSCHK                          S01117
121900200610     C                     MOVE LTISS     ISSCHK                          S01117
122000200610     C**
122100200610     C** Get previous issuer if roll down again
122200200610     C** (NB if parent in middle will give diff order from rollup)
122300200610     C**
122400200610     C***********          READPPACUS                    25               S01117
122500200610     C***********          READPPACUS                    25               S01117
122600200610     C                     READPSDCUSTL4                 25               S01117
122700200610     C                     READPSDCUSTL4                 25               S01117
122800200610     C           *IN25     IFEQ '1'
122900200610     C***********PARENT    SETLLPACUS                                     S01117
123000200610     C           SPAREN    SETLLSDCUSTL4                                  S01117
123100200610     C**********           Z-ADD0         LTISS                                               CSD027
123200200610     C                     MOVE *BLANKS   LTISS                                               CSD027
123300200610     C                     END
123400200610     C           *IN25     IFEQ '0'
123500200610     C***********CPAR      ANDEQPARENT                                    S01117
123600200610     C           BBPCNB    ANDEQSPAREN                                    S01117
123700200610     C***********          Z-ADDCNUM      LTISS                           S01117
123800200610     C                     MOVE CNUM      LTISS                           S01117
123900200610     C                     ELSE
124000200610     C**********           Z-ADD0         LTISS                                               CSD027
124100200610     C                     MOVE *BLANKS   LTISS                                               CSD027
124200200610     C                     END
124300200610     C***********          READ PACUS                    25               S01117
124400200610     C                     READ SDCUSTL4                 25               S01117
124500200610     C*
124600200610     C***Get*Clintcb*for*new*issuer***************************************S01117
124700200610     C***********                                                         S01117
124800200610     C***********ISSCHK    CHAINCLINTCBF             25                   S01117
124900200610     C************IN25     IFEQ '0'                                       S01117
125000200610     C***********RECI      IFEQ '*'                                       S01117
125100200610     C***********          SETON                     25                   S01117
125200200610     C***********          END                                            S01117
125300200610     C***********          END                                            S01117
125400200610     C************IN25     IFEQ '1'                                       S01117
125500200610     C**                                                                  S01117
125600200610     C** Get SDCUSTPD for new issuer                                      S01117
125700200610     C*                                                                   S01117
125800200610     C                     MOVELISSCHK    KEY1   10                       S01117
125900200610     C*                                                                   S01117
126000200610     C                     CALL 'AOCUSTR0'                                S01117
126100200610     C                     PARM '*DBERR ' @RTCD   7                       S01117
126200200610     C                     PARM '*KEY   ' @KEY    7                       S01117
126300200610     C                     PARM KEY1      @KEY1  10                       S01117
126400200610     C                     PARM           @KYST   7                       S01117
126500200610     C           SDCUST    PARM SDCUST    DSSDY                           S01117
126600200610     C*                                                                   S01117
126700200610     C***********          MOVELPROGRM    DBPGM            ************   S01117
126800200610     C***********          MOVELISSCHK    DBKEY            * DATABASE *   S01117
126900200610     C**********           MOVE 'CLINT'   DBFILE           **ERROR*09**   E20651
127000200610     C**********           Z-ADD09        DBASE            ************   E20651
127100200610     C***********          MOVE 'CLINT'   DBFILE           * ERROR 1E20651S01117
127200200610     C***********          Z-ADD11        DBASE            *********E20651S01117
127300200610     C***********          SETON                       U7U8               S01117
127400200610     C***********          MOVE '0'       RTNC                            S01117
127500200610     C***********          EXSR RETSR                                     S01117
127600200610     C***********          ELSE                                           S01117
127700200610     C                     MOVE BBCUST    CNUM                            S01117
127800200610     C***********          MOVE CRNM      ISNAME                          S01117
127900200610     C***********          MOVE CTWN      ITOWN                           S01117
128000200610     C                     MOVE BBCRNM    ISNAME                          S01117
128100200610     C                     MOVE BBCRTN    ITOWN                           S01117
128200200610     C                     MOVE ISSCHK    SISNO
128300200610     C***********          MOVE CRNM      SIRNM                           S01117
128400200610     C***********          MOVE CTWN      SIRTN                           S01117
128500200610     C                     MOVE BBCRNM    SIRNM                           S01117
128600200610     C                     MOVE BBCRTN    SIRTN                           S01117
128700200610     C**
128800200610     C                     EXSR DISP
128900200610     C***********          END                                            S01117
129000200610     C                     END
129100200610     C**
129200200610     C                     ENDSR                                        **
129300200610     C**
129400200610     C*****************************************************************
129500200610     C/EJECT
129600200610     C*****************************************************************
129700200610     C**   OPTION SR  To check validity of option combinations        *
129800200610     C**                                                              *
129900200610     C**   Called by  MAIN                                            *
130000200610     C**                                                              *
130100200610     C**   Calls  SR  none                                            *
130200200610     C**                                                              *
130300200610     C*****************************************************************
130400200610     C**
130500200610     C           OPTION    BEGSR                            ** OPTION *
130600200610     C**
130700200610     C                     MOVE *BLANKS   OPTN
130800200610     C**
130900200610     C**     If no subfile records the only possible entry is issuer
131000200610     C**
131100200610     C           *IN03     IFEQ '1'
131200200610     C**
131300200610     C           ISSUER    IFEQ *BLANKS
131400200610     C                     MOVE '1'       *IN42
131500200610     C                     MOVE MSG,1     ERMSG
131600200610     C                     END
131700200610     C**
131800200610     C                     ELSE
131900200610     C**
132000200610     C                     READCSE0265S0                 40
132100200610     C**
132200200610     C** Ensure that changed Subfile Record is not blank before processingE28729
132300200610     C**                                                                  E28729
132400200610     C           *IN40     DOWEQ'0'                                       E28729
132500200610     C           SELECT    ANDEQ*BLANK                                    E28729
132600200610     C                     READCSE0265S0                 40               E28729
132700200610     C                     END                                            E28729
132800200610     C**                                                                  E28729
132900200610     C**     Check if any entry made
133000200610     C**
133100200610     C           *IN40     IFEQ '1'
133200200610     C           SELCRI    ANDEQ*BLANKS
133300200610     C                     MOVE '1'       *IN42
133400200610     C                     MOVE MSG,7     ERMSG
133500200610     C                     END
133600200610     C**
133700200610     C           SELECT    IFEQ '2'
133800200610     C           STDBK     ANDNE*BLANKS
133900200610     C                     MOVE '1'       *IN42
134000200610     C                     MOVE MSG,14    ERMSG
134100200610     C                     END
134200200610     C           SELECT    IFEQ '3'
134300200610     C********** SPCTN     ANDNE*ZEROS                                                        CSD027
134400200610     C           SPCTN     ANDNE*BLANKS                                                       CSD027
134500200610     C                     MOVE '1'       *IN42
134600200610     C                     MOVE MSG,15    ERMSG
134700200610     C                     END
134800200610     C**
134900200610     C**     Check if both issuer and option entered
135000200610     C**     Note - it is not an error unless issuer has been changed     082129
135100200610     C**
135200200610     C           *IN40     IFEQ '0'
135300200610     C           ISSUER    ANDNE*BLANKS
135400200610     C           ISSUER    ANDNEISSSV                                     082129
135500200610     C                     MOVE '1'       *IN42
135600200610     C                     MOVE '1'       *IN41
135700200610     C                     MOVE MSG,2     ERMSG
135800200610     C                     END
135900200610     C**
136000200610     C**    Check if more than one option entered
136100200610     C**
136200200610     C           *IN40     IFEQ '0'
136300200610     C                     MOVE SELECT    OPTN
136400200610     C                     MOVE STDBK     RQBOOK
136500200610     C                     MOVELSPCTN     RQCUST
136600200610     C***********          MOVE STDBR     RQBRCH                          S01117
136700200610     C                     MOVE STDBR     RQBRCA                          S01117
136800200610     C                     MOVE SSESN     RQSESN
136900200610     C                     MOVE *BLANK    SELECT
137000200610     C                     MOVE '0'       *IN08
137100200610     C                     UPDATSE0265S0
137200200610     C**
137300200610     C           *IN40     DOUEQ'1'
137400200610     C                     READCSE0265S0                 40
137500200610     C           *IN40     IFEQ '0'
137600200610     C           SELECT    ANDNE*BLANK                                    E28729
137700200610     C                     MOVE *BLANK    SELECT
137800200610     C                     MOVE '0'       *IN08
137900200610     C                     UPDATSE0265S0
138000200610     C                     MOVE '1'       *IN42
138100200610     C                     MOVE MSG,3     ERMSG
138200200610     C                     END
138300200610     C**
138400200610     C                     END
138500200610     C                     END
138600200610     C                     END
138700200610     C**
138800200610     C                     ENDSR
138900200610     C**
139000200610     C*****************************************************************
139100200610     C/EJECT
139200200610     C*****************************************************************
139300200610     C**   CUSTIN SR  To process entered Selection fields             *
139400200610     C**                                                              *
139500200610     C**   Called by  MAIN, FIRST                                     *
139600200610     C**                                                              *
139700200610     C**   Calls  SR  SETUP                                           *
139800200610     C**                                                              *
139900200610     C*****************************************************************
140000200610     C**
140100200610     C           CUSTIN    BEGSR                            ** CUSTIN *
140200200610     C**
140300200610     C                     SETOF                     414243
140400200610     C                     SETOF                     444546
140500200610     C                     SETOF                     47
140600200610     C                     MOVE *OFF      *IN62                           CAC005
140700200610     C                     MOVE *BLANKS   CURCHK
140800200610     C                     MOVE *BLANKS   FACCHK
140900200610     C                     MOVE *BLANKS   BOKCHK
141000200610     C***********          Z-ADD0         BRCCHK                          S01117
141100200610     C                     MOVE *BLANKS   BRCCHK                          S01117
141200200610     C***********          Z-ADD0         CUSCHK                          S01117
141300200610     C**********           MOVE *ZERO     CUSCHK                                       S01117 CSD027
141400200610     C                     MOVE *BLANKS   CUSCHK                                              CSD027
141500200610     C**
141600200610     C***Access*issuer*record*-**(SNAME*or*CLINT)*************************S01117
141700200610     C*******error*if*not*on*file*or*deleted******************************S01117
141800200610     C***********                                                         S01117
141900200610     C***********          MOVE ISSUER    CUSTWK                          S01117
142000200610     C***********          SETOF                     2930                 S01117
142100200610     C***********                                                         S01117
1422002006100389 C***CHECK*TO*SEE*IF*MORE*THAN*6*CHARS*ENTERED************************S01117
142300200610     C***********                                                         S01117
1424002006100390 C***********SCSNMB    IFNE *BLANK                                    S01117
142500200610     C***********          MOVE '1'       *IN29                           S01117
142600200610     C***********          END                                            S01117
142700200610     C***********                                                         S01117
1428002006100392 C***IF*NOT*MORE*THAN*6*CHARS,*CHECK*FIRST*6*CHARS*NUMERIC************S01117
142900200610     C***********                                                         S01117
1430002006100390 C************IN29     IFEQ '0'                                       S01117
143100200610     C***********          MOVE *BLANKS   ZFIELD                          S01117
143200200610     C***********          MOVELSCSNMA    ZFIELD                          S01117
143300200610     C***********          Z-ADD*ZEROS    ZADEC                           S01117
143400200610     C***********          Z-ADD6         ZADIG                           S01117
143500200610     C***********          EXSR ZALIGN                                    S01117
143600200610     C************IN99     IFEQ '1'                                       S01117
143700200610     C***********          SETON                     29                   S01117
143800200610     C***********          ELSE                                           S01117
143900200610     C***********          SETON                     30                   S01117
144000200610     C***********          END                                            S01117
1441002006100390 C***********          END                                            S01117
144200200610     C***********                                                         S01117
1443002006100397 C*****IF*S/NAME*GET*CLINT*REC.***************************************S01117
144400200610     C***********                                                         S01117
1445002006100390 C************IN29     IFEQ '1'                                       S01117
1446002006100399 C***********ISSUER    CHAINSNAME                42                   S01117
144700200610     C**N42******RECI      COMP 'D'                  4242                 S01117
144800200610     C***********          END                                            S01117
144900200610     C***********                                                         S01117
1450002006100410 C*****IF*CUST*NO.*-*CHECK*IT*EXISTS*ON*CLINT*************************S01117
145100200610     C***********                                                         S01117
1452002006100390 C************IN30     IFEQ '1'                                       S01117
1453002006100413 C***********          MOVE SCSNMA    CNUM                            S01117
1454002006100414 C***********CNUM      CHAINCLINT                42                   S01117
145500200610     C**N42******RECI      COMP 'D'                  4242                 S01117
145600200610     C***********          END                                            S01117
145700200610     C*                                                                   S01117
145800200610     C** Access Issuer record                                             S01117
145900200610     C*                                                                   S01117
146000200610     C                     CALL 'AOCUSTR0'                                S01117
146100200610     C                     PARM *BLANK    @RTCD   7                       S01117
146200200610     C                     PARM '*KEY   ' @OPTN   7                       S01117
146300200610     C                     PARM ISSUER    @KEY1  10                       S01117
146400200610     C                     PARM           @KYST   7                       S01117
146500200610     C           SDCUST    PARM SDCUST    DSSDY                           S01117
146600200610     C*                                                                   S01117
146700200610     C************IN42     IFEQ '1'                                       S01117
146800200610     C           @RTCD     IFNE *BLANK                                    S01117
146900200610     C                     SETON                     4142
147000200610     C                     MOVE MSG,5     ERMSG
147100200610     C                     GOTO ECUSSE
147200200610     C                     ELSE
147300200610     C                     MOVE BBCUST    CNUM                            S01117
147400200610     C***********          Z-ADDCNUM      ISSCHK                          S01117
147500200610     C                     MOVE CNUM      ISSCHK                          S01117
147600200610     C***********          MOVE CRNM      ISNAME                          S01117
147700200610     C***********          MOVE CTWN      ITOWN                           S01117
147800200610     C                     MOVE BBCRNM    ISNAME                          S01117
147900200610     C                     MOVE BBCRTN    ITOWN                           S01117
148000200610     C                     END
148100200610     C**
148200200610     C***Access*customer*record*-**(SNAME*or*CLINT)***********************S01117
148300200610     C*******error*if*not*on*file*or*deleted******************************S01117
148400200610     C***********                                                         S01117
148500200610     C***********CUSTMR    IFNE *BLANKS                                   S01117
148600200610     C***********          MOVE CUSTMR    CUSTWK                          S01117
148700200610     C***********          SETOF                     2930                 S01117
148800200610     C***********          SETOF                     29                   S01117
148900200610     C***********                                                         S01117
1490002006100389 C***CHECK*TO*SEE*IF*MORE*THAN*6*CHARS*ENTERED*********************   S01117
149100200610     C***********                                                         S01117
1492002006100390 C***********SCSNMB    IFNE *BLANK                                    S01117
149300200610     C***********          MOVE '1'       *IN29                           S01117
149400200610     C***********          END                                            S01117
149500200610     C*****************************************************************   S01117
1496002006100392 C***IF*NOT*MORE*THAN*6*CHARS,*CHECK*FIRST*6*CHARS*NUMERIC************S01117
149700200610     C***********                                                         S01117
1498002006100390 C************IN29     IFEQ '0'                                       S01117
149900200610     C***********          MOVE *BLANKS   ZFIELD                          S01117
150000200610     C***********          MOVELSCSNMA    ZFIELD                          S01117
150100200610     C***********          Z-ADD*ZEROS    ZADEC                           S01117
150200200610     C***********          Z-ADD6         ZADIG                           S01117
150300200610     C***********          EXSR ZALIGN                                    S01117
150400200610     C************IN99     IFEQ '1'                                       S01117
150500200610     C***********          SETON                     29                   S01117
150600200610     C***********          ELSE                                           S01117
150700200610     C***********          SETON                     30                   S01117
150800200610     C***********          END                                            S01117
1509002006100390 C***********          END                                            S01117
151000200610     C*****************************************************************   S01117
1511002006100397 C*****IF*S/NAME*GET*CLINT*REC.************************************   S01117
151200200610     C**
1513002006100390 C************IN29     IFEQ '1'                                       S01117
1514002006100399 C***********CUSTMR    CHAINSNAME                42                   S01117
151500200610     C**N42******RECI      COMP 'D'                  4242                 S01117
151600200610     C***********          MOVE '1'       RCDA                      E23190S01117
151700200610     C***********          END                                            S01117
151800200610     C**
1519002006100410 C*****IF*CUST*NO.*-*CHECK*IT*EXISTS*ON*CLINT*************************S01117
152000200610     C***********                                                         S01117
1521002006100390 C************IN30     IFEQ '1'                                       S01117
1522002006100413 C***********          MOVE SCSNMA    CNUM                            S01117
152300200610     C***********          MOVE '1'       RCDA                      E23190S01117
152400200610     C***********          END                                      E23190S01117
152500200610     C**Must*obtain*classification*details*from*security*customer***E23190S01117
152600200610     C**record*to*find*out*whether*portfolio*customer*or*not.*******E23190S01117
1527002006100414 C***********SECNM     CHAINCLINT                42             E23190S01117
152800200610     C**N42******RECI      COMP 'D'                  4242                 S01117
152900200610     C*********************END                                      E23190S01117
153000200610     C*                                                                   S01117
153100200610     C**  ACCESS CUSTOMER INFORMATION IF IT IS ENTERED                    S01117
153200200610     C*                                                                   S01117
153300200610     C           CUSTMR    IFNE *BLANKS                                   S01117
153400200610     C                     CALL 'AOCUSTR0'                                S01117
153500200610     C                     PARM *BLANK    @RTCD   7                       S01117
153600200610     C                     PARM '*KEY   ' @OPTN   7                       S01117
153700200610     C                     PARM CUSTMR    @KEY1  10                       S01117
153800200610     C                     PARM           @KYST   7                       S01117
153900200610     C           SDCUST    PARM SDCUST    DSSDY                           S01117
154000200610     C*                                                                   S01117
154100200610     C                     MOVE *BLANKS   AENB    6                       S01117
154200200610     C           @RTCD     IFEQ *BLANKS                                   S01117
154300200610     C                     MOVE BBCUST    AENB                            S01117
154400200610     C                     END                                            S01117
154500200610     C*                                                                   S01117
154600200610     C** IF CUSTOMER IS NOT A SECURITIES CUSTOMER, DO NOT OBTAIN DETAILS  S01117
154700200610     C*                                                                   S01117
154800200610     C                     CALL 'AOSECSR0'                                S01117
154900200610     C                     PARM *BLANK    @RTCD   7                       S01117
155000200610     C                     PARM '*KEY   ' @KEY    7                       S01117
155100200610     C                     PARM AENB      @AENB   6                       S01117
155200200610     C           SDSECS    PARM SDSECS    DSFDY                           S01117
155300200610     C*                                                                   S01117
155400200610     C************IN42     IFEQ '1'                                       S01117
155500200610     C           @RTCD     IFNE *BLANK                                    S01117
155600200610     C                     SETON                     4442
155700200610     C                     MOVE MSG,9     ERMSG
155800200610     C                     GOTO ECUSSE
155900200610     C                     ELSE
156000200610     C*                                                                   S01117
156100200610     C                     MOVE BFCUST    CNUM                            S01117
156200200610     C*                                                                   S01117
156300200610     C** IF CUSTOMER NOT A PORTFOLIO CUSTOMER, DO NOT OBTAIN DETAILS      E23190
156400200610     C*                                                                   S01117
156500200610     C***********C1DI      IFEQ 'S'                                 E23190S01117
156600200610     C***********C1DI      OREQ 'D'                                 E23190S01117
156700200610     C           BFCLAS    IFEQ 'S'                                       S01117
156800200610     C           BFCLAS    OREQ 'D'                                       S01117
156900200610     C***********          Z-ADDCNUM      CUSCHK                          S01117
157000200610     C                     MOVE CNUM      CUSCHK                          S01117
157100200610     C                     ELSE                                           E23190
157200200610     C                     SETON                     4442                 E23190
157300200610     C                     MOVE MSG,16    ERMSG                           E23190
157400200610     C                     GOTO ECUSSE                                    E23190
157500200610     C                     END                                            E23190
157600200610     C*                                                                   E23190
157700200610     C                     END
157800200610     C                     END
157900200610     C*
158000200610     C**If*no*Branch*entered,*use*default*from*TABICD*file****************S01117
158100200610     C* If no Branch entered, use default from ZMUSER Data Area           S01117
158200200610     C*
158300200610     C           BRANCH    IFEQ '   '
158400200610     C***********BRANCH    OREQ '000'                                     S01117
158500200610     C***********          MOVELDSTB      BRANCH                          S01117
158600200610     C                     MOVELUSRBCH    BRANCH                          S01117
158700200610     C                     END
158800200610     C*                                                                   054258
158900200610     C           BRANCH    IFEQ 'ALL'                                     054258
159000200610     C           BKLAUT    ANDNE'Y'                                       054258
159100200610     C                     SETON                     4243                 054258
159200200610     C                     MOVE MSG,19    ERMSG                           054258
159300200610     C                     GOTO ECUSSE                                    054258
159400200610     C                     END                                            054258
159500200610     C**
159600200610     C** If multibranch environment -
159700200610     C** If branch entered - Access Branch Details file thru A.O.         S01117
159800200610     C**   - error if not on file or no branch code selected.             S01117
159900200610     C***If*branch*entered*-*Access*Branch*table*record*-*****************S01117
160000200610     C*******error*if*not*on*file*or*deleted******************************S01117
160100200610     C**
160200200610     C           *IN07     IFEQ '1'
160300200610     C           BRANCH    ANDNE'ALL'                                     054258
160400200610     C*          BRANCH    ANDNE*BLANKS
160500200610     C***********          MOVE *BLANKS   KEY    12                       S01117
160600200610     C***********          MOVEL'10'      KEY                             S01117
160700200610     C***********          MOVE BRANCH    KEY                             S01117
160800200610     C***********KEY       CHAINTABLETRF             25                   S01117
160900200610     C************IN25     IFEQ '0'                                       S01117
161000200610     C***********RECI      IFEQ '*'                                       S01117
161100200610     C***********          SETON                     25                   S01117
161200200610     C***********          END                                            S01117
161300200610     C***********          END                                            S01117
161400200610     C************IN25     IFEQ '1'                                       S01117
161500200610     C*                                                                   S01117
161600200610     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
161700200610     C                     CALL 'AOBRCHR1'                                                    CGL029
161800200610     C                     PARM *BLANK    @RTCD   7                       S01117
161900200610     C                     PARM '*KEY   ' @OPTN   7                       S01117
162000200610     C                     PARM BRANCH    @DSNB   3                       S01117
162100200610     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01117              CGL029
162200200610     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
162300200610     C*                                                                   S01117
162400200610     C** IF ERROR, CHECK WHICH TYPE OF ERROR                              S01117
162500200610     C           @RTCD     IFNE *BLANK                                    S01117
162600200610     C                     SETON                     4243
162700200610     C                     MOVE MSG,8     ERMSG
162800200610     C                     GOTO ECUSSE
162900200610     C                     ELSE                                           S01117
163000200610     C                     MOVE A8BRCD    BRANCH                          S01117
163100200610     C                     END
163200200610     C***********          END                                            E37221
163300200610     C*                                                                   S01117
163400200610     C** CHECK WHETHER THE USER IS AUTHORISED TO THE BRANCH               S01117
163500200610      ***  (Only if Multibranch environment).                             E37221
163600200610     C*                                                                   S01117
163700200610     C                     CALL 'ZVBBU'                                   S01117
163800200610     C                     PARM BRANCH    @ZBRCA  3                       S01117
163900200610     C                     PARM           @ERR    10                      S01117
164000200610     C           @ERR      IFEQ 1                                         S01117
164100200610     C                     SETON                     4243                 S01117
164200200610     C                     MOVE MSG,18    ERMSG                           S01117
164300200610     C                     GOTO ECUSSE                                    S01117
164400200610     C                     END                                            S01117
164500200610     C           @ERR      IFEQ 2                                         S01117
164600200610     C                     SETON                     4243                 S01117
164700200610     C                     MOVE MSG,17    ERMSG                           S01117
164800200610     C                     GOTO ECUSSE                                    S01117
164900200610     C                     END                                            S01117
165000200610      *                                                                   E37221
165100200610     C                     END                                            E37221
165200200610     C**
165300200610     C** If book   entered - Access Book file record -
165400200610     C**     error if not on file or deleted
165500200610     C**
165600200610     C           BOOKIN    IFNE *BLANKS
165700200610     C***********BOOKIN    CHAINBOOKD                25                   S01117
165800200610     C************IN25     IFEQ '0'                                       S01117
165900200610     C***********RECI      IFEQ '*'                                       S01117
166000200610     C***********          SETON                     25                   S01117
166100200610     C***********          END                                            S01117
166200200610     C***********          END                                            S01117
166300200610     C************IN25     IFEQ '1'                                       S01117
166400200610     C                     CALL 'AOBOOKR0'                                S01117
166500200610     C                     PARM *BLANK    @RTCD   7                       S01117
166600200610     C                     PARM '*KEY   ' @OPTN   7                       S01117
166700200610     C                     PARM BOOKIN    @BKCD   3                       S01117
166800200610     C           SDBOOK    PARM SDBOOK    DSFDY                           S01117
166900200610     C*                                                                   S01117
167000200610     C           @RTCD     IFNE *BLANKS                                   S01117
167100200610     C                     SETON                     4245
167200200610     C                     MOVE MSG,10    ERMSG
167300200610     C                     GOTO ECUSSE
167400200610     C                     END
167500200610     C                     END
167600200610      *                                                                   CAC005
167700200610      ** Validate Profit Centre                                           CAC005
167800200610      *                                                                   CAC005
167900200610     C           CAC005    IFEQ 'Y'                                       CAC005
168000200610      *                                                                   CAC005
168100200610      ** If Screen-criteria-book code is blank and screen-criteria        CAC005
168200200610      ** profit centre is not blank                                       CAC005
168300200610      *                                                                   CAC005
168400200610     C           BOOKIN    IFEQ *BLANKS                                   CAC005
168500200610     C           PRFC      ANDNE*BLANKS                                   CAC005
168600200610     C                     MOVE *ON       *IN42                           CAC005
168700200610     C                     MOVE *ON       *IN62                           CAC005
168800200610     C                     MOVE MSG,20    ERMSG                           CAC005
168900200610     C                     GOTO ECUSSE                                    CAC005
169000200610     C                     ENDIF                                          CAC005
169100200610      *                                                                   CAC005
169200200610      ** If screen-criteria-book code is non-blank and screen-criteria    CAC005
169300200610      ** profit centre is blank                                           CAC005
169400200610      *                                                                   CAC005
169500200610     C           BOOKIN    IFNE *BLANKS                                   CAC005
169600200610     C           PRFC      ANDEQ*BLANKS                                   CAC005
169700200610     C                     MOVE *ON       *IN42                           CAC005
169800200610     C                     MOVE *ON       *IN62                           CAC005
169900200610     C                     MOVE MSG,21    ERMSG                           CAC005
170000200610     C                     GOTO ECUSSE                                    CAC005
170100200610     C                     ENDIF                                          CAC005
170200200610      *                                                                   CAC005
170300200610      ** If screen-criteria-profit centre si non-blank                    CAC005
170400200610      *                                                                   CAC005
170500200610     C           PRFC      IFNE *BLANKS                                   CAC005
170600200610     C                     CALL 'AOPRFCR0'                                CAC005
170700200610     C                     PARM *BLANKS   PRTCD                           CAC005
170800200610     C                     PARM '*VERIFY' POPTN                           CAC005
170900200610     C                     PARM PRFC      PPCCD   4                       CAC005
171000200610     C           SDPRFC    PARM SDPRFC    DSFDY                           CAC005
171100200610      *                                                                   CAC005
171200200610     C           PRTCD     IFNE *BLANKS                                   CAC005
171300200610     C                     MOVE *ON       *IN42                           CAC005
171400200610     C                     MOVE *ON       *IN62                           CAC005
171500200610     C                     MOVE MSG,22    ERMSG                           CAC005
171600200610     C                     GOTO ECUSSE                                    CAC005
171700200610     C                     ENDIF                                          CAC005
171800200610     C                     ENDIF                                          CAC005
171900200610      *                                                                   CAC005
172000200610      ** If both screen-criteria-book code and screen-criteria-profit     CAC005
172100200610      ** centre are non-blank                                             CAC005
172200200610      *                                                                   CAC005
172300200610     C           BOOKIN    IFNE *BLANKS                                   CAC005
172400200610     C           PRFC      ANDNE*BLANKS                                   CAC005
172500200610     C                     CALL 'AOBKPCR0'                                CAC005
172600200610     C                     PARM *BLANKS   PRTCD                           CAC005
172700200610     C                     PARM '*PSEUDO' POPTN                           CAC005
172800200610     C                     PARM BOOKIN    PBKCD   2                       CAC005
172900200610     C                     PARM PRFC      PPRFC   4                       CAC005
173000200610     C                     PARM           PPSBK   2                       CAC005
173100200610      *                                                                   CAC005
173200200610     C           PRTCD     IFNE *BLANKS                                   CAC005
173300200610     C                     MOVE *ON       *IN42                           CAC005
173400200610     C                     MOVE *ON       *IN62                           CAC005
173500200610     C                     MOVE MSG,23    ERMSG                           CAC005
173600200610     C                     GOTO ECUSSE                                    CAC005
173700200610     C                     ENDIF                                          CAC005
173800200610     C                     ENDIF                                          CAC005
173900200610     C                     ENDIF                                          CAC005
174000200610     C**
174100200610     C***If*currency*entered*-*Access*currency*table*record*-*************S01117
174200200610     C*******error*if*not*on*file*or*deleted******************************S01117
174300200610     C** If currency entered - Access currency thru Access Object         S01117
174400200610     C**     error if no currency selected or invalid currency            S01117
174500200610     C**
174600200610     C           EXPCCY    IFNE *BLANKS
174700200610     C***********          MOVEL'20      'TKEY   12                       S01117
174800200610     C***********          MOVELEXPCCY    ZWK4    4                       S01117
174900200610     C***********          MOVE 1         ZWK4                            S01117
175000200610     C***********          MOVE ZWK4      TKEY                            S01117
175100200610     C***********TKEY      CHAINTABTG10F             25                   S01117
175200200610     C************IN25     IFEQ '0'                                       S01117
175300200610     C***********RECI      IFEQ '*'                                       S01117
175400200610     C***********          SETON                     25                   S01117
175500200610     C***********          END                                            S01117
175600200610     C***********          END                                            S01117
175700200610     C************IN25     IFEQ '1'                                       S01117
175800200610     C*                                                                   S01117
175900200610     C                     CALL 'AOCURRR0'                                S01117
176000200610     C                     PARM *BLANK    @RTCD   7                       S01117
176100200610     C                     PARM '*KEY   ' @OPTN   7                       S01117
176200200610     C                     PARM EXPCCY    @AJCD   3                       S01117
176300200610     C           SDCURR    PARM SDCURR    DSSDY                           S01117
176400200610     C*                                                                   S01117
176500200610     C           @RTCD     IFNE *BLANK                                    S01117
176600200610     C                     SETON                     4246
176700200610     C                     MOVE MSG,11    ERMSG
176800200610     C                     GOTO ECUSSE
176900200610     C                     ELSE
177000200610     C***********          Z-ADDSPOT      ZRATE2                          S01117
177100200610     C                     Z-ADDA6SPRT    ZRATE2                          S01117
177200200610     C***********MDIN      IFEQ 0                                         S01117
177300200610     C           A6MDIN    IFEQ 'D'                                       S01117
177400200610     C                     MOVE 'D'       ZMDI2   1
177500200610     C                     ELSE
177600200610     C                     MOVE 'M'       ZMDI2
177700200610     C                     END
177800200610     C                     END
177900200610     C                     END
178000200610     C**
178100200610     C** If factored entered - check it is F or U
178200200610     C**     error if not
178300200610     C**
178400200610     C           FACTRD    IFNE *BLANKS
178500200610     C           FACTRD    IFNE 'U'
178600200610     C           FACTRD    ANDNE'F'
178700200610     C                     SETON                     4247
178800200610     C                     MOVE MSG,12    ERMSG
178900200610     C                     GOTO ECUSSE
179000200610     C                     END
179100200610     C                     END
179200200610     C**
179300200610     C** All fields valid - prepare to display details -
179400200610     C**
179500200610     C                     EXSR SETUP
179600200610     C**
179700200610     C           ECUSSE    TAG                             ** ECUSSE TAG**
179800200610     C                     ENDSR
179900200610     C*****************************************************************
180000200610     C/EJECT                                                              S01117
180100200610     C*****************************************************************   S01117
180200200610     C**   CHKSEL SR  To check and process all the fields that are    *   S01117
180300200610     C**              requested to provide a selection list           *   S01117
180400200610     C**                                                              *   S01117
180500200610     C**   Called by  CUSTIN                                          *   S01117
180600200610     C**                                                              *   S01117
180700200610     C*****************************************************************   S01117
180800200610     C**                                                                  S01117
180900200610     C           CHKSEL    BEGSR                                          S01117
181000200610     C*                                                                   S01117
181100200610     C                     MOVE 'N'       @SEL    1                       S01117
181200200610     C*                                                                   S01117
181300200610     C** If the first character of the Issuer input field = '?'           S01117
181400200610     C** call selection for Midas customer.                               S01117
181500200610     C*                                                                   S01117
181600200610     C                     MOVELISSUER    @FCHR   1                       S01117
181700200610     C           @FCHR     IFEQ '?'                                       S01117
181800200610     C                     MOVE 'Y'       @SEL                            S01117
181900200610     C                     CALL 'AOCUSTR0'                                S01117
182000200610     C                     PARM *BLANK    @RTCD   7                       S01117
182100200610     C                     PARM '*KEY   ' @OPTN   7                       S01117
182200200610     C                     PARM ISSUER    @KEY1  10                       S01117
182300200610     C                     PARM           @KYST   7                       S01117
182400200610     C           SDCUST    PARM SDCUST    DSSDY                           S01117
182500200610     C*                                                                   S01117
182600200610     C                     MOVE *BLANKS   ISSUER                          S01117
182700200610     C           @RTCD     IFEQ *BLANKS                                   S01117
182800200610     C                     MOVELBBCUST    ISSUER                          S01117
182900200610     C                     END                                            S01117
183000200610     C*                                                                   S01117
183100200610     C                     END                                            S01117
183200200610     C*                                                                   S01117
183300200610     C** If the first character of the Customer input field = '?'         S01117
183400200610     C** call selection for securities customer only.                     S01117
183500200610     C*                                                                   S01117
183600200610     C                     MOVELCUSTMR    @FCHR   1                       S01117
183700200610     C           @FCHR     IFEQ '?'                                       S01117
183800200610     C                     MOVE 'Y'       @SEL                            S01117
183900200610     C                     MOVELCUSTMR    AENB    6                       S01117
184000200610     C                     CALL 'AOSECSR0'                                S01117
184100200610     C                     PARM *BLANK    @RTCD   7                       S01117
184200200610     C                     PARM '*KEY   ' @KEY    7                       S01117
184300200610     C                     PARM AENB      @AENB   6                       S01117
184400200610     C           SDSECS    PARM SDSECS    DSFDY                           S01117
184500200610     C*                                                                   S01117
184600200610     C                     MOVE *BLANKS   CUSTMR                          S01117
184700200610     C           @RTCD     IFEQ *BLANKS                                   S01117
184800200610     C                     MOVELBFCUST    CUSTMR                          S01117
184900200610     C                     END                                            S01117
185000200610     C*                                                                   S01117
185100200610     C                     END                                            S01117
185200200610     C*                                                                   S01117
185300200610     C** If the first character of the Branch input field = '?'           S01117
185400200610     C** call selection for Branch.                                       S01117
185500200610     C*                                                                   S01117
185600200610     C                     MOVELBRANCH    @FCHR   1                       S01117
185700200610     C           @FCHR     IFEQ '?'                                       S01117
185800200610     C                     MOVE 'Y'       @SEL                            S01117
185900200610     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
186000200610     C                     CALL 'AOBRCHR1'                                                    CGL029
186100200610     C                     PARM *BLANK    @RTCD   7                       S01117
186200200610     C                     PARM '*KEY   ' @OPTN   7                       S01117
186300200610     C                     PARM BRANCH    @DSNB   3                       S01117
186400200610     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01117              CGL029
186500200610     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
186600200610     C*                                                                   S01117
186700200610     C                     MOVEL*BLANKS   BRANCH                          S01117
186800200610     C           @RTCD     IFEQ *BLANKS                                   S01117
186900200610     C                     MOVE A8BRCD    BRANCH                          S01117
187000200610     C                     END                                            S01117
187100200610     C*                                                                   S01117
187200200610     C                     END                                            S01117
187300200610     C*                                                                   S01117
187400200610     C** If the first character of the Book input field = '?'             S01117
187500200610     C** call selection for Book records.                                 S01117
187600200610     C*                                                                   S01117
187700200610     C                     MOVELBOOKIN    @FCHR   1                       S01117
187800200610     C           @FCHR     IFEQ '?'                                       S01117
187900200610     C                     MOVE 'Y'       @SEL                            S01117
188000200610     C                     CALL 'AOBOOKR0'                                S01117
188100200610     C                     PARM *BLANK    @RTCD   7                       S01117
188200200610     C                     PARM '*KEY   ' @OPTN   7                       S01117
188300200610     C                     PARM BOOKIN    @BKCD   3                       S01117
188400200610     C           SDBOOK    PARM SDBOOK    DSFDY                           S01117
188500200610     C*                                                                   S01117
188600200610     C                     MOVEL*BLANKS   BOOKIN                          S01117
188700200610     C           @RTCD     IFEQ *BLANKS                                   S01117
188800200610     C                     MOVE BDBKCD    BOOKIN                          S01117
188900200610     C                     END                                            S01117
189000200610     C*                                                                   S01117
189100200610     C                     END                                            S01117
189200200610      *                                                                   CAC005
189300200610      ** If the firtst character of the profit centre input field is      CAC005
189400200610      ** '?' call selection for profit centre                             CAC005
189500200610      *                                                                   CAC005
189600200610     C                     MOVELPRFC      @FCHR                           CAC005
189700200610     C           @FCHR     IFEQ '?'                                       CAC005
189800200610     C                     MOVE 'Y'       @SEL                            CAC005
189900200610     C                     CALL 'AOPRFCR0'                                CAC005
190000200610     C                     PARM *BLANK    PRTCD                           CAC005
190100200610     C                     PARM '*KEY   ' POPTN                           CAC005
190200200610     C                     PARM PRFC      PPCCD                           CAC005
190300200610     C           SDPRFC    PARM SDPRFC    DSFDY                           CAC005
190400200610     C*                                                                   CAC005
190500200610     C                     MOVEL*BLANKS   PRFC                            CAC005
190600200610     C           PRTCD     IFEQ *BLANKS                                   CAC005
190700200610     C                     MOVE DSPCCD    PRFC                            CAC005
190800200610     C                     END                                            CAC005
190900200610     C                     END                                            CAC005
191000200610     C*                                                                   S01117
191100200610     C** If the first character of the Currency input field = '?'         S01117
191200200610     C** call selection for Currency Code.                                S01117
191300200610     C*                                                                   S01117
191400200610     C                     MOVELEXPCCY    @FCHR   1                       S01117
191500200610     C           @FCHR     IFEQ '?'                                       S01117
191600200610     C                     MOVE 'Y'       @SEL                            S01117
191700200610     C                     CALL 'AOCURRR0'                                S01117
191800200610     C                     PARM *BLANK    @RTCD   7                       S01117
191900200610     C                     PARM '*KEY   ' @OPTN   7                       S01117
192000200610     C                     PARM EXPCCY    @AJCD   3                       S01117
192100200610     C           SDCURR    PARM SDCURR    DSSDY                           S01117
192200200610     C*                                                                   S01117
192300200610     C                     MOVE *BLANKS   EXPCCY                          S01117
192400200610     C           @RTCD     IFEQ *BLANKS                                   S01117
192500200610     C                     MOVE A6CYCD    EXPCCY                          S01117
192600200610     C                     END                                            S01117
192700200610     C*                                                                   S01117
192800200610     C                     END                                            S01117
192900200610     C*                                                                   S01117
193000200610     C                     ENDSR                                          S01117
193100200610     C*****************************************************************   S01117
193200200610     C/EJECT
193300200610     C*****************************************************************
193400200610     C**                                                              *
193500200610     C**   DISP   SR  Accumulate details for screen display           *
193600200610     C**                                                              *
193700200610     C**   Called by  SETUP, ROLLUP                                   *
193800200610     C**                                                              *
193900200610     C**   Calls  SR  SUBFIL , SECFIL                                 *
194000200610     C**                                                              *
194100200610     C*****************************************************************
194200200610     C**
194300200610     C           DISP      BEGSR                           *** DISP ***
194400200610     C**
194500200610     C                     Z-ADD0         OUTREC  20
194600200610     C                     MOVE '0'       *IN89
194700200610     C**
194800200610     C**  IF STILL PROCESSING SFL RECS - GOTO S/R
194900200610     C**
195000200610     C           *IN51     IFEQ '1'
195100200610     C                     EXSR PROCES
195200200610     C           OUTREC    IFEQ 14
195300200610     C                     SETON                     89
195400200610     C                     END
195500200610     C                     END
195600200610     C**
195700200610     C           *IN89     DOWEQ'0'
195800200610     C           *IN51     ANDEQ'0'
195900200610     C**
196000200610     C           *IN81     IFEQ '0'
196100200610     C                     READ SECTI                    81
196200200610     C                     END
196300200610     C**
196400200610     C**  End of File -
196500200610     C**
196600200610     C           *IN81     IFEQ '1'
196700200610     C                     SETON                     0589
196800200610     C                     END
196900200610     C**
197000200610     C**  Successful file read of an active record
197100200610     C**
197200200610     C           *IN81     IFEQ '0'
197300200610     C           RECI      IFEQ 'D'
197400200610     C**
197500200610     C**  If not correct issuer STOP
197600200610     C**
197700200610     C**********           MOVE ISSCHK    @TCHK   60                                   S01117 CSD027
197800200610     C                     MOVE ISSCHK    @TCHK   6                                           CSD027
197900200610     C***********ISSCHK    IFNE ISSR                                      S01117
198000200610     C           @TCHK     IFNE ISSR                                      S01117
198100200610     C                     SETON                     818905
198200200610     C**
198300200610     C                     ELSE
198400200610     C**                                                                  S01232
198500200610     C**  Indicate whether an Australian Yield traded security.           S01232
198600200610     C**                                                                  S01232
198700200610     C           STBS      IFEQ 'Y'                                       S01232
198800200610     C           SYBS      ANDEQ'AU'                                      S01232
198900200610     C                     SETON                     52                   S01232
199000200610     C**                                                                  S01232
199100200610     C**     Nominal ccy decimal places                                   S01232
199200200610     C***********                                                  S01232 S01117
199300200610     C***********          MOVEL'20      'TKEY   12                S01232 S01117
199400200610     C***********          MOVELNMCY      ZWK4    4                S01232 S01117
199500200610     C***********          MOVE 1         ZWK4                     S01232 S01117
199600200610     C***********          MOVE ZWK4      TKEY                     S01232 S01117
199700200610     C***********TKEY      CHAINTABTG10F             25            S01232 S01117
199800200610     C************IN25     IFEQ '0'                                S01232 S01117
199900200610     C***********RECI      IFEQ '*'                                S01232 S01117
200000200610     C***********          SETON                     25            S01232 S01117
200100200610     C***********          END                                     S01232 S01117
200200200610     C***********          END                                     S01232 S01117
200300200610     C*                                                                   S01117
200400200610     C                     CALL 'AOCURRR0'                                S01117
200500200610     C                     PARM '*DBERR ' @RTCD   7                       S01117
200600200610     C                     PARM '*KEY   ' @OPTN   7                       S01117
200700200610     C                     PARM NMCY      @AJCD   3                       S01117
200800200610     C           SDCURR    PARM SDCURR    DSSDY                           S01117
200900200610     C*                                                                   S01117
201000200610     C************IN25     IFEQ '1'                                S01232 S01117
201100200610     C***********          MOVELPROGRM    DBPGM            ********S01232 S01117
201200200610     C***********          MOVELTKEY      DBKEY            **DATAB*S01232 S01117
201300200610     C***********          MOVE 'TG10 '   DBFILE           **ERROR*S01232 S01117
201400200610     C***********          Z-ADD12        DBASE            ********S01232 S01117
201500200610     C***********          SETON                       U7U8        S01232 S01117
201600200610     C***********          MOVE '0'       RTNC                     S01232 S01117
201700200610     C***********          EXSR RETSR                              S01232 S01117
201800200610     C***********          ELSE                                    S01232 S01117
201900200610     C***********          Z-ADDCDP       NCDP                     S01232 S01117
202000200610     C                     Z-ADDA6NBDP    NCDP                            S01117
202100200610     C***********          END                                            S01232
202200200610     C                     ELSE                                           S01232
202300200610     C                     SETOF                     52                   S01232
202400200610     C                     END                                            S01232
202500200610     C**
202600200610     C**  SETLL on C/UDEPS files to see if there are any recs-
202700200610     C**
202800200610     C                     SETOF                     858670
202900200610     C           BOKCHK    IFNE *BLANKS
203000200610     C           SESN      SETLLUDEPS                    86
203100200610     C                     END
203200200610     C********** CUSCHK    IFNE *ZERO                                                         CSD027
203300200610     C           CUSCHK    IFNE *BLANKS                                                       CSD027
203400200610     C           SESN      SETLLCDEPS                    85
203500200610     C                     END
203600200610     C           BOKCHK    IFEQ *BLANKS
203700200610     C********** CUSCHK    ANDEQ*ZERO                                                         CSD027
203800200610     C           CUSCHK    ANDEQ*BLANKS                                                       CSD027
203900200610     C           SESN      SETLLUDEPS                    86
204000200610     C           SESN      SETLLCDEPS                    85
204100200610     C                     END
204200200610     C**
204300200610     C**  If recs found go & fill SFL
204400200610     C**
204500200610     C           *IN86     IFEQ '1'
204600200610     C           *IN85     OREQ '1'
204700200610     C                     EXSR PROCES
204800200610     C                     MOVE '1'       *IN50
204900200610     C                     END
205000200610     C**
205100200610     C                     END
205200200610     C**
205300200610     C                     END
205400200610     C                     END
205500200610     C                     END
205600200610     C**
205700200610     C**    Condition Display of message if no details for issuer
205800200610     C**
205900200610     C           EDLOOP    TAG                             ** EDLOOP    **
206000200610     C           SFLREC    IFEQ 0
206100200610     C                     MOVE '1'       *IN04
206200200610     C                     ELSE
206300200610     C**
206400200610     C**    If records written - read next to check there are more
206500200610     C**
206600200610     C           *IN51     IFEQ '0'
206700200610     C                     SETOF                     82
206800200610     C           OUTREC    IFEQ 14
206900200610     C           *IN05     ANDEQ'0'
207000200610     C**
207100200610     C           *IN81     IFEQ '0'
207200200610     C           READN     TAG                             ** READN     **
207300200610     C                     READ SECTI                    81
207400200610     C           *IN81     IFEQ '0'
207500200610     C           RECI      IFEQ 'D'
207600200610     C**********           MOVE ISSCHK    @TCHK   60                                   S01117 CSD027
207700200610     C                     MOVE ISSCHK    @TCHK   6                                           CSD027
207800200610     C***********ISSR      IFEQ ISSCHK                                    S01117
207900200610     C           ISSR      IFEQ @TCHK                                     S01117
208000200610     C                     SETON                     82
208100200610     C                     READPSECTI                    81
208200200610     C                     END
208300200610     C                     ELSE
208400200610     C                     GOTO READN
208500200610     C                     END
208600200610     C                     END
208700200610     C                     END
208800200610     C                     END
208900200610     C**
209000200610     C**
209100200610     C           *IN82     IFEQ '0'
209200200610     C                     SETON                     05
209300200610     C                     END
209400200610     C                     END
209500200610     C                     MOVE '0'       *IN03
209600200610     C                     END
209700200610     C                     Z-ADDSFLREC    TOP
209800200610     C**
209900200610     C                     ENDSR
210000200610     C*****************************************************************
210100200610     C/EJECT
2102002006100738 C*****************************************************************
210300200610     C**                                                              *
210400200610     C**   PROCES SR  Process the details for a security              *
210500200610     C**                                                              *
210600200610     C**   Called by  DISP                                            *
210700200610     C**                                                              *
210800200610     C**   Calls  SR  RETSR,SUBFIL                                    *
210900200610     C**                                                              *
211000200610     C*****************************************************************
211100200610     C**
211200200610     C           PROCES    BEGSR                           ** PROCES **
211300200610     C**
211400200610     C**  Determine next type of SFL line required
211500200610     C**
211600200610     C                     MOVE '1'       *IN71
211700200610     C**
211800200610     C**  New sec - initialise & read first position record
211900200610     C**
212000200610     C           *IN51     IFEQ '0'
212100200610     C           SFLT      ANDLT2
212200200610     C                     Z-ADD1         SFLT    20
212300200610     C                     Z-ADD0         ZZTOTE 150
212400200610     C                     SETOF                     5071
212500200610     C                     MOVE '1'       *IN51
212600200610     C**
212700200610     C**  New sec - access INVTP record
212800200610     C**
212900200610     C           KEYI      CHAININVTP                25
213000200610     C  N25      RECI      COMP 'D'                  2525
213100200610     C**
213200200610     C**     If no record found  or deleted record
213300200610     C**        then it is a database error so return to calling
213400200610     C**        program with a return code of '0'
213500200610     C**
213600200610     C           *IN25     IFEQ '1'
213700200610     C           *LOCK     IN   LDA                                       S01117
213800200610     C                     MOVELPROGRM    DBPGM            ************
213900200610     C                     MOVELIKEY      DBKEY            * DATABASE *
214000200610     C                     MOVE 'INVTY'   DBFILE           * ERROR 04 *
214100200610     C                     Z-ADD4         DBASE            ************
214200200610     C                     SETON                       U7U8
214300200610     C                     EXSR *PSSR                                     S01117
214400200610     C                     MOVE '0'       RTNC
214500200610     C                     EXSR RETSR
214600200610     C                     END
214700200610     C                     END
214800200610     C**
214900200610     C           TOPSR     TAG                             *** TOPSR   ***
215000200610      *                                                                   CGL011
215100200610     C           CGL011    IFEQ 'Y'                                       CGL011
215200200610     C           SFLT      CABEQ4         ADONE                           CGL011
215300200610     C                     ELSE                                           CGL011
215400200610     C           SFLT      CABEQ3         ADONE
215500200610     C                     ENDIF                                          CGL011
215600200610      *                                                                   CGL011
215700200610     C           SFLT      IFEQ 1
215800200610     C           *IN71     ANDEQ'0'
215900200610     C           *IN86     IFEQ '1'
216000200610     C           NEXTU1    TAG                             *** NEXTU1  ***
216100200610     C           SESN      READEUDEPS                    87
216200200610     C***********          Z-ADD0         SAVBR                           S01117
216300200610     C                     MOVEL*BLANKS   SAVBR                           S01117
216400200610     C**********           Z-ADD0         SAVCN                                               CSD027
216500200610     C                     MOVE *BLANKS   SAVCN                                               CSD027
216600200610     C**
216700200610     C**  Check record meets selection criteria                        s
216800200610     C**
216900200610     C           *IN87     IFEQ '0'
217000200610     C***********BRCCHK    IFNE *ZEROS                                    S01117
217100200610     C***********BRCCHK    ANDNECDBR                                      S01117
217200200610     C           BRCCHK    IFNE *BLANKS                                   S01117
217300200610     C           BRCCHK    ANDNECDPA                                      S01117
217400200610     C                     GOTO NEXTU1
217500200610     C                     END
217600200610     C           BOKCHK    IFNE *BLANKS
217700200610     C           BOKCHK    ANDNECDBK
217800200610     C                     GOTO NEXTU1
217900200610     C                     END
218000200610     C                     END
218100200610     C                     END
218200200610     C                     END
218300200610     C**
218400200610     C**  Do until no more recs for security on UDEPS                  s
218500200610     C**
218600200610     C           *IN86     DOWEQ'1'
218700200610     C**
218800200610     C**  Check record meets selection criteria                        s
218900200610     C**
219000200610     C           *IN87     IFEQ '0'
219100200610     C***********BRCCHK    IFNE *ZEROS                                    S01117
219200200610     C***********BRCCHK    ANDNECDBR                                      S01117
219300200610     C           BRCCHK    IFNE *BLANKS                                   S01117
219400200610     C           BRCCHK    ANDNECDPA                                      S01117
219500200610     C                     GOTO NEXTU
219600200610     C                     END
219700200610     C           BOKCHK    IFNE *BLANKS
219800200610     C           BOKCHK    ANDNECDBK
219900200610     C                     GOTO NEXTU
220000200610     C                     END
220100200610     C                     END
220200200610     C**
220300200610     C**  If new branch/book/mkt - output SFL record                   s
220400200610     C**
220500200610     C***********SAVBR     IFNE 0                                         S01117
220600200610     C           SAVBR     IFNE *BLANKS                                   S01117
220700200610     C***********SAVBR     IFNE CDBR                                      S01117
220800200610     C           SAVBR     IFNE CDPA                                      S01117
220900200610     C           SAVBK     ORNE CDBK
221000200610     C           SAVMK     ORNE CDMK
221100200610     C           *IN87     OREQ '1'
221200200610     C**
221300200610     C** Data accessed - fill SFL line & output to SFL
221400200610     C**
221500200610     C           OUTREC    IFGE 14
221600200610     C                     GOTO PEND
221700200610     C                     END
221800200610     C                     EXSR SUBFIL
221900200610     C                     SETON                     70
222000200610     C           SFLT      IFEQ 1
222100200610     C                     Z-ADD2         SFLT
222200200610     C**
222300200610     C**  If room in SFl -                                             s
222400200610     C**
222500200610     C           OUTREC    IFGE 14
222600200610     C                     GOTO PEND
222700200610     C                     END
222800200610     C                     EXSR SUBFIL
222900200610     C                     END
223000200610     C                     Z-ADD1         SFLT
223100200610     C                     Z-ADD*ZEROS    ZZNOML
223200200610     C***********          MOVE CDBR      SAVBR                           S01117
223300200610     C                     MOVE CDPA      SAVBR                           S01117
223400200610     C                     MOVE CDBK      SAVBK
223500200610     C                     MOVE CDMK      SAVMK
223600200610     C           *IN87     IFEQ '1'
223700200610     C                     SETOF                     8671
223800200610     C                     END
223900200610     C                     END
224000200610     C                     END
224100200610     C**
224200200610     C**  Accumulate values from UDEPS                                 s
224300200610     C**
224400200610     C           *IN87     IFEQ '0'
224500200610     C***********SAVBR     IFEQ 0                                         S01117
224600200610     C           SAVBR     IFEQ *BLANKS                                   S01117
224700200610     C                     MOVE CDBK      SAVBK
224800200610     C***********          MOVE CDBR      SAVBR                           S01117
224900200610     C                     MOVE CDPA      SAVBR                           S01117
225000200610     C                     MOVE CDMK      SAVMK
225100200610     C                     END
225200200610     C                     ADD  CDNT      ZZNOML
225300200610     C                     ADD  SNPT      ZZNOML
225400200610     C                     ADD  CDST      ZZNOML
225500200610     C                     END
225600200610     C           *IN87     IFEQ '1'
225700200610     C***********SAVBR     ANDEQ0                                         S01117
225800200610     C           SAVBR     ANDEQ*BLANKS                                   S01117
225900200610     C                     SETOF                     86
226000200610     C                     END
226100200610     C**
226200200610     C           NEXTU     TAG                             *** NEXTU   ***
226300200610     C           SESN      READEUDEPS                    87
226400200610     C                     END
226500200610     C**
226600200610     C**  Now do CDEPS file if req'd                                   s
226700200610     C**
226800200610     C           *IN85     CABEQ'0'       ADONE
226900200610     C           SFLT      IFEQ 1
227000200610     C           *IN71     ANDEQ'0'
227100200610     C           NEXTC1    TAG                             *** NEXTC1  ***
227200200610     C           SESN      READECDEPS                    87
227300200610     C**********           Z-ADD0         SAVCN                                               CSD027
227400200610     C                     MOVE *BLANKS   SAVCN                                               CSD027
227500200610     C                     MOVE *BLANKS   SAVBK
227600200610     C**
227700200610     C**  Check record meets selection criteria                        s
227800200610     C**
227900200610     C           *IN87     IFEQ '0'
228000200610     C***********BRCCHK    IFNE *ZEROS                                    S01117
228100200610     C***********BRCCHK    ANDNECDBR                                      S01117
228200200610     C           BRCCHK    IFNE *BLANKS                                   S01117
228300200610     C           BRCCHK    ANDNECDPA                                      S01117
228400200610     C                     GOTO NEXTC1
228500200610     C                     END
228600200610     C                     MOVE CDCN      @CDCN   6                       S01117
228700200610     C********** CUSCHK    IFNE *ZERO                                                         CSD027
228800200610     C           CUSCHK    IFNE *BLANKS                                                       CSD027
228900200610     C***********CUSCHK    ANDNECDCN                                      S01117
229000200610     C           CUSCHK    ANDNE@CDCN                                     S01117
229100200610     C                     GOTO NEXTC1
229200200610     C                     END
229300200610     C                     END
229400200610     C                     END
229500200610     C**
229600200610     C**  Do until no more recs for security on CDEPS                  s
229700200610     C**
229800200610     C           *IN85     DOWEQ'1'
229900200610     C**
230000200610     C**  Check record meets selection criteria                        s
230100200610     C**
230200200610     C           *IN87     IFEQ '0'
230300200610     C***********BRCCHK    IFNE *ZEROS                                    S01117
230400200610     C***********BRCCHK    ANDNECDBR                                      S01117
230500200610     C           BRCCHK    IFNE *BLANKS                                   S01117
230600200610     C           BRCCHK    ANDNECDPA                                      S01117
230700200610     C                     GOTO NEXTC
230800200610     C                     END
230900200610     C                     MOVE CDCN      @CDCN   6                       S01117
231000200610     C********** CUSCHK    IFNE *ZERO                                                         CSD027
231100200610     C           CUSCHK    IFNE *BLANKS                                                       CSD027
231200200610     C***********CUSCHK    ANDNECDCN                                      S01117
231300200610     C           CUSCHK    ANDNE@CDCN                                     S01117
231400200610     C                     GOTO NEXTC
231500200610     C                     END
231600200610     C                     END
231700200610     C**
231800200610     C**  If new branch/cust/mkt - output SFL record                   s
231900200610     C**
232000200610     C********** SAVCN     IFNE 0                                                             CSD027
232100200610     C           SAVCN     IFNE *BLANKS                                                       CSD027
232200200610     C***********SAVBR     IFNE CDBR                                      S01117
232300200610     C           SAVBR     IFNE CDPA                                      S01117
232400200610     C           SAVCN     ORNE CDCN
232500200610     C           SAVMK     ORNE CDMK
232600200610     C           *IN87     OREQ '1'
232700200610     C**
232800200610     C** Data accessed - fill SFL line & output to SFL
232900200610     C**
233000200610     C           OUTREC    IFGE 14
233100200610     C                     GOTO PEND
233200200610     C                     END
233300200610     C                     SETON                     70
233400200610     C                     EXSR SUBFIL
233500200610     C           SFLT      IFEQ 1
233600200610     C                     Z-ADD2         SFLT
233700200610     C**
233800200610     C**  If room in SFl -                                             s
233900200610     C**
234000200610     C           OUTREC    IFGE 14
234100200610     C                     GOTO PEND
234200200610     C                     END
234300200610     C                     EXSR SUBFIL
234400200610     C                     END
234500200610      *                                                                   CGL011
234600200610      ** If CGL011 is installed, check if position is blocked.            CGL011
234700200610      *                                                                   CGL011
234800200610     C           CGL011    IFEQ 'Y'                                       CGL011
234900200610     C           SFLT      IFEQ 2                                         CGL011
235000200610     C                     MOVE 'N'       WBLKI   1                       CGL011
235100200610     C                     MOVE *OFF      *IN63                           CGL011
235200200610      *                                                                                       CGL014
235300200610      ** If CGL014 is on, display 'Collateral' narrative to actual blocked                    CGL014
235400200610      ** security positions with sequence 00001 or 00002 (SEBLKPL7).                          CGL014
235500200610      *                                                                                       CGL014
235600200610     C           CGL014    IFEQ 'Y'                                                           CGL014
235700200610     C           KEYVD     SETLLSEBLKPL7                                                      CGL014
235800200610     C                     ELSE                                                               CGL014
235900200610     C           KEYVD     SETLLSEBLKPL6                                  CGL011
236000200610     C                     ENDIF                                                              CGL014
236100200610      *                                                                                       CGL014
236200200610     C           WBLKI     DOWEQ'N'                                       CGL011
236300200610     C           *IN63     ANDEQ*OFF                                      CGL011
236400200610      *                                                                                       CGL014
236500200610     C           CGL014    IFEQ 'Y'                                                           CGL014
236600200610     C           KEYVD     READESEBLKPL7                 63                                   CGL014
236700200610     C                     ELSE                                                               CGL014
236800200610     C           KEYVD     READESEBLKPL6                 63               CGL011
236900200610     C                     ENDIF                                                              CGL014
237000200610      *                                                                   CGL011
237100200610      ** If block exists, whether General Block on Security or            CGL011
237200200610      ** Specific Block on the Customer, add one more subfile line        CGL011
237300200610      ** for Collateral text narrative.                                   CGL011
237400200610      *                                                                   CGL011
237500200610     C           *IN63     IFEQ *OFF                                      CGL011
237600200610     C           VDCNUM    ANDEQSAVCN                                     CGL011
237700200610     C           *IN63     OREQ *OFF                                      CGL011
237800200610     C********** VDCNUM    ANDEQ*ZERO                                                  CGL011 CSD027
237900200610     C           VDCNUM    ANDEQ*BLANKS                                                       CSD027
238000200610     C                     MOVE 'Y'       WBLKI                           CGL011
238100200610     C                     Z-ADD3         SFLT                            CGL011
238200200610     C           OUTREC    IFGE 14                                        CGL011
238300200610     C                     GOTO PEND                                      CGL011
238400200610     C                     ENDIF                                          CGL011
238500200610     C                     EXSR SUBFIL                                    CGL011
238600200610     C                     ENDIF                                          CGL011
238700200610     C                     ENDDO                                          CGL011
238800200610     C                     ENDIF                                          CGL011
238900200610     C                     ENDIF                                          CGL011
239000200610      *                                                                   CGL011
239100200610     C                     Z-ADD1         SFLT
239200200610     C                     Z-ADD*ZEROS    ZZNOML
239300200610     C***********          MOVE CDBR      SAVBR                           S01117
239400200610     C                     MOVE CDPA      SAVBR                           S01117
239500200610     C                     MOVE CDCN      SAVCN
239600200610     C                     MOVE CDMK      SAVMK
239700200610     C           *IN87     IFEQ '1'
239800200610     C                     SETOF                     85
239900200610     C                     END
240000200610     C                     END
240100200610     C                     END
240200200610     C**
240300200610     C**  Accumulate values from CDEPS                                 s
240400200610     C**
240500200610     C           *IN87     IFEQ '0'
240600200610     C********** SAVCN     IFEQ 0                                                             CSD027
240700200610     C           SAVCN     IFEQ *BLANKS                                                       CSD027
240800200610     C                     MOVE CDCN      SAVCN
240900200610     C***********          MOVE CDBR      SAVBR                           S01117
241000200610     C                     MOVE CDPA      SAVBR                           S01117
241100200610     C                     MOVE CDMK      SAVMK
241200200610     C                     END
241300200610     C                     ADD  CDNT      ZZNOML
241400200610     C                     ADD  SNPT      ZZNOML
241500200610     C                     ADD  CDST      ZZNOML
241600200610     C                     END
241700200610     C           *IN87     IFEQ '1'
241800200610     C********** SAVCN     ANDEQ0                                                             CSD027
241900200610     C           SAVCN     ANDEQ*BLANKS                                                       CSD027
242000200610     C                     SETOF                     85
242100200610     C                     END
242200200610     C**
242300200610     C           NEXTC     TAG                             *** NEXTC   ***
242400200610     C           SESN      READECDEPS                    87
242500200610     C                     END
242600200610     C**                                                               s
242700200610     C**
242800200610     C           ADONE     TAG                             *** ADONE   ***
242900200610     C**
243000200610     C** DO TOTAL LINE
243100200610     C**
243200200610     C******************** Z-ADD3         SFLT                            E19964
243300200610     C           OUTREC    IFLT 14
243400200610     C           *IN51     ANDEQ'1'
243500200610     C           *IN70     IFEQ '1'
243600200610      *                                                                   CGL011
243700200610      ** If CGL011 is installed, initialise SFLT to 4;                    CGL011
243800200610      ** otherwise, retain current processing of 3.                       CGL011
243900200610      *                                                                   CGL011
244000200610     C           CGL011    IFEQ 'Y'                                       CGL011
244100200610     C                     Z-ADD4         SFLT                            CGL011
244200200610     C                     ELSE                                           CGL011
244300200610     C                     Z-ADD3         SFLT                            E19964
244400200610     C                     ENDIF                                          CGL011
244500200610      *                                                                   CGL011
244600200610     C                     EXSR SUBFIL
244700200610     C                     Z-ADD1         SFLT
244800200610     C                     END
244900200610     C                     SETOF                     51
245000200610     C                     END
245100200610     C**                                                               s
245200200610     C           PEND      TAG                             *** PEND    ***
245300200610     C**
245400200610     C                     ENDSR
245500200610     C*****************************************************************
245600200610     C/EJECT
2457002006100738 C*****************************************************************
245800200610     C**                                                              *
245900200610     C**   BKPRC  SR  Calculate book price                            *
246000200610     C**                                                              *
246100200610     C**   Called by  SUBFIL                                          *
246200200610     C**                                                              *
246300200610     C**   Calls  SR  OLBAP                                           *
246400200610     C**                                                              *
246500200610     C*****************************************************************
246600200610     C**
246700200610     C           BKPRC     BEGSR                           ** BKPRC  **
246800200610     C**
246900200610     C**  B/V ind is set to BLANK by default
247000200610     C**
247100200610     C                     MOVE ' '       SBVI
247200200610     C                     Z-ADD0         BKPR   158
247300200610     C                     Z-ADD0         ZZAPW
247400200610     C**
247500200610     C** Access 1st price for sec,br,mkt,book,price type
247600200610     C**
247700200610     C***********TVVL      IFEQ 'T'                                       S01117
247800200610     C           BVTVDV    IFEQ 'T'                                       S01117
247900200610     C                     MOVE 'DT'      PPRT
248000200610     C                     ELSE
248100200610     C                     MOVE 'DV'      PPRT
248200200610     C                     END
248300200610     C***********KEYP      SETLLPRICS                    25               E14057
248400200610     C           KEYP      SETLLPRICR                    25               E14057
248500200610     C           *IN25     IFEQ '1'
248600200610     C***********KEYP      READEPRICS                    25               E14057
248700200610     C           KEYP      READEPRICR                    25               E14057
248800200610     C           *IN25     IFEQ '0'
248900200610     C**
249000200610     C** If price found & value date is less than prev. run date
249100200610     C**  B/V ind is set to Y
249200200610     C**
249300200610     C           PVDT      IFLT PRUN
249400200610     C                     MOVE 'Y'       SBVI
249500200610     C**
249600200610     C**  If price found & value date equals prev. run date
249700200610     C**    Price will be used to override AP num COB field
249800200610     C**
249900200610     C                     ELSE
250000200610     C           PVDT      IFEQ PRUN
250100200610     C                     Z-ADDPPRC      ZZAPW
250200200610     C                     END
250300200610     C                     END
250400200610     C**
250500200610     C** If price found & value date = run date
250600200610     C**   price Becomes the average price
250700200610     C**
250800200610     C           PVDT      IFEQ RUND
250900200610     C                     Z-ADDPPRC      BKPR
251000200610     C                     ELSE
251100200610     C**
251200200610     C** If price found with value date less than prev run date
251300200610     C**   Access price file with date = run date
251400200610     C**     if found price becomes the average price
251500200610     C**
251600200610     C           PVDT      IFLT PRUN
251700200610     C***********KEYPD     CHAINPRICS                25                   E14057
251800200610     C           KEYPD     CHAINPRICR                25                   E14057
251900200610     C           *IN25     IFEQ '0'
252000200610     C                     Z-ADDPPRC      BKPR
252100200610     C                     ELSE
252200200610     C**
252300200610     C**     otherwise -                                               ld
252400200610     C**   Access price file with date = previous run date
252500200610     C**     if found  price will be used to override AP num COB fie   ld
252600200610     C**
252700200610     C***********KEYPP     CHAINPRICS                25                   E14057
252800200610     C           KEYPP     CHAINPRICR                25                   E14057
252900200610     C           *IN25     IFEQ '0'
253000200610     C                     Z-ADDPPRC      ZZAPW
253100200610     C                     END
253200200610     C                     END
253300200610     C                     END
253400200610     C                     END
253500200610     C                     END
253600200610     C                     END
253700200610     C**
253800200610     C**  Calculate average price -
253900200610     C**    If price found with value date = run date this is it
254000200610     C**
254100200610     C           BKPR      IFEQ 0
254200200610     C**
254300200610     C** Access BKPHDD
254400200610     C**
254500200610     C           KEYBH     CHAINBKPHD                25
254600200610     C           *IN25     IFEQ '0'
254700200610     C**
254800200610     C** Access BKPOSD
254900200610     C**
255000200610     C           KEYBP     CHAINBKPOS                25
255100200610     C                     END
255200200610     C**
255300200610     C**  If price found , value date = prev run date
255400200610     C**    Calculate override for sum of AP num COB +
255500200610     C**      price x nom posn COB on BKPOSD
255600200610     C**
255700200610     C           ZZAPW     IFNE 0
255800200610     C/COPY WNCPYSRC,SE0265C007
255900200610     C           NPSN      MULT ZZAPW     ZZAPC
256000200610     C                     ELSE
256100200610     C*******************  Z-ADDNPSN      ZZAPC
256200200610     C                     Z-ADDAPNC      ZZAPC
256300200610     C/COPY WNCPYSRC,SE0265C001
256400200610     C                     END
256500200610     C**
256600200610     C**  Calculate average price from OLBAP
256700200610     C**
256800200610     C           *IN25     IFEQ '0'
256900200610     C                     EXSR OLBAP
257000200610     C                     END
257100200610     C                     END
257200200610     C**
257300200610     C                     ENDSR
257400200610     C*****************************************************************
257500200610     C/EJECT
2576002006100738 C*****************************************************************
257700200610     C**                                                              *
257800200610     C**   OLBAP  SR  Calculate average price                         *
257900200610     C**                                                              *
258000200610     C**   Called by  BKPRC                                           *
258100200610     C**                                                              *
258200200610     C**   Calls  SR  none                                            *
258300200610     C**                                                              *
258400200610     C*****************************************************************
258500200610     C**
258600200610     C           OLBAP     BEGSR                           ** OLBAP  **
258700200610     C**
258800200610     C**  Calculate new NP = NP + sum nom purch + sum nom sales
258900200610     C**
259000200610     C           SNPI      ADD  SNSI      ZNNOMP
259100200610     C                     ADD  NPSN      ZNNOMP
259200200610     C**
259300200610     C** If NP & new NP both long -
259400200610     C**  AP = (AP num COB + AP num purch) / new NP
259500200610     C**
259600200610     C           NPSN      IFGT 0
259700200610     C           ZNNOMP    ANDGT0
259800200610     C           ZNNOMP    IFEQ 0
259900200610     C**********           Z-ADD0         BKPR                                                261507
260000200610     C                     Z-ADD0         BKPRR  238H                                         261507
260100200610     C                     ELSE
260200200610     C********** ZZAPC     ADD  SANP      BKPR
260300200610     C********** BKPR      DIV  ZNNOMP    BKPR      H
260400200610     C           ZZAPC     ADD  SANP      WBKPR  150
260500200610     C                     SUB  SANS      WBKPR
260600200610     C********** 5         SUB  CDP       XY      10
260700200610     C********** WBKPR     MULT POWER8,XY WBKPR
260800200610     C********** WBKPR     DIV  ZNNOMP    BKPR      H                                         261507
260900200610     C           WBKPR     DIV  ZNNOMP    BKPRR     H                                         261507
261000200610      *                                                                   207543
261100200610     C           CEU018    IFEQ 'Y'                                       207543
261200200610      *                                                                   207543
261300200610     C           SPBS      IFEQ 'P'                                       207543
261400200610     C           STBS      ANDEQ'Y'                                       207543
261500200610     C                     DIV  100       ZZAPC                           207543
261600200610     C                     END                                            207543
261700200610      *                                                                   207543
261800200610     C                     END                                            207543
261900200610      *
262000200610     C/COPY WNCPYSRC,SE0265C002
262100200610     C                     END
262200200610     C                     END
262300200610     C**
262400200610     C** If NP & new NP both short -
262500200610     C**  AP = (AP num COB + AP num sales) / new NP
262600200610     C**  (ensure price field is positive)
262700200610     C**
262800200610     C           NPSN      IFLT 0
262900200610     C           ZNNOMP    ANDLT0
263000200610     C           ZNNOMP    IFEQ 0
263100200610     C**********           Z-ADD0         BKPR                                                261507
263200200610     C                     Z-ADD0         BKPRR                                               261507
263300200610     C                     ELSE
263400200610     C*********  ZZAPC     ADD  SANS      BKPR
263500200610     C*********  BKPR      DIV  ZNNOMP    BKPR      H
263600200610     C           ZZAPC     ADD  SANS      WBKPR
263700200610     C                     SUB  SANP      WBKPR
263800200610     C*********  5         SUB  CDP       XY      10
263900200610     C*********  WBKPR     MULT POWER8,XY WBKPR
264000200610    C********** WBKPR     DIV  ZNNOMP    BKPR      H                                         261507
264100200610     C********** BKPR      IFLT 0                                                             261507
264200200610     C********** BKPR      MULT -1        BKPR                                                261507
264300200610     C           WBKPR     DIV  ZNNOMP    BKPRR     H                                         261507
264400200610     C           BKPRR     IFLT 0                                                             261507
264500200610     C           BKPRR     MULT -1        BKPRR                                               261507
264600200610     C                     END
264700200610     C                     END
264800200610     C                     END
264900200610     C**
265000200610     C** If NP long or flat , new NP short -
265100200610     C**  AP = AP num sales / sum nom sales
265200200610     C**
265300200610     C           NPSN      IFGE 0
265400200610     C           ZNNOMP    ANDLT0
265500200610     C           SNSI      IFEQ 0
265600200610     C**********           Z-ADD0         BKPR                                                261507
265700200610     C                     Z-ADD0         BKPRR                                               261507
265800200610     C                     ELSE
265900200610     C***********SANP      DIV  SNSI      BKPR      H                     E32503
266000200610     C********** SANS      DIV  SNSI      BKPR      H                                  E32503 261507
266100200610     C           SANS      DIV  SNSI      BKPRR     H                                         261507
266200200610     C                     END
266300200610     C                     END
266400200610     C**
266500200610     C** If NP short or flat , new NP long -
266600200610     C**  AP = AP num purch / sum nom purch
266700200610     C**
266800200610     C           NPSN      IFLE 0
266900200610     C           ZNNOMP    ANDGT0
267000200610     C           SNPI      IFEQ 0
267100200610     C**********           Z-ADD0         BKPR                                                261507
267200200610     C                     Z-ADD0         BKPRR                                               261507
267300200610     C                     ELSE
267400200610     C********** SANP      DIV  SNPI      BKPR      H                                         261507
267500200610     C           SANP      DIV  SNPI      BKPRR     H                                         261507
267600200610     C                     END
267700200610     C                     END
267800200610     C**
267900200610     C** If new NP flat -
268000200610     C**  AP = 0
268100200610     C**
268200200610     C           ZNNOMP    IFEQ 0
268300200610     C**********           Z-ADD0         BKPR                                                261507
268400200610     C                     Z-ADD0         BKPRR                                               261507
268500200610     C                     END
268600200610     C*
268700200610     C* If price basis 'P', multiply by 100 to fetch true price
268800200610     C*
268900200610     C           SPBS      IFEQ 'P'
269000200610      *                                                                   207543
269100200610     C           CEU018    OREQ 'Y'                                       207543
269200200610     C           SPBS      ANDEQ'P'                                       207543
269300200610     C           STBS      ANDNE'Y'                                       207543
269400200610      *                                                                   207543
269500200610     C/COPY WNCPYSRC,SE0265C003
269600200610     C**********           MULT 100       BKPR                                                261507
269700200610     C                     MULT 100       BKPRR                                               261507
269800200610     C                     END
269900200610     C**
270000200610     C***********5         ADD  CDP       XY      10                      S01117
270100200610     C           5         ADD  A6NBDP    XY      10                      S01117
270200200610     C                     SUB  NMDP      XY
270300200610     C********** BKPR      DIV  POWER8,XY BKPR                                                261507
270400200610     C           BKPRR     DIV  POWER8,XY BKPR                                                261507
270500200610     C**
270600200610     C                     ENDSR
270700200610     C**
270800200610     C*****************************************************************
270900200610     C/EJECT
271000200610     C*****************************************************************
271100200610     C**   CLEAR  SR  Clear the screen display fields and indicators  *
271200200610     C**                                                              *
271300200610     C**   Called by  COMMD, CUSTIN                                   *
271400200610     C**                                                              *
271500200610     C**   Calls  SR  none                                            *
271600200610     C**                                                              *
271700200610     C*****************************************************************
271800200610     C**
271900200610     C           CLEAR     BEGSR
272000200610     C**
272100200610     C                     MOVE *BLANKS   CUSTMR
272200200610     C                     MOVE *BLANKS   ISSUER
272300200610     C                     MOVE *BLANKS   BRANCH
272400200610     C                     MOVE *BLANKS   BOOKIN
272500200610     C                     MOVE *BLANKS   PRFC                            CAC005
272600200610     C                     MOVE *BLANKS   EXPCCY
272700200610     C                     MOVE *BLANKS   FACTRD
272800200610     C                     MOVE *BLANKS   SISNO
272900200610     C                     MOVE *BLANKS   SIRNM
273000200610     C                     MOVE *BLANKS   SIRTN
273100200610     C                     MOVE *BLANKS   SPAREN
273200200610     C                     MOVE *BLANKS   SFACT
273300200610     C                     MOVE *BLANKS   SECCY
273400200610     C**********           MOVE *ZEROS    LTISS                                               CSD027
273500200610     C                     MOVE *BLANKS   LTISS                                               CSD027
273600200610     C                     Z-ADD*ZEROS    ZZNOML
273700200610     C**
273800200610     C                     Z-ADD0         SFLT
273900200610     C                     Z-ADD0         SFLREC  40
274000200610     C                     Z-ADD0         TOP     40
274100200610     C**
274200200610     C                     SETON                       03
274300200610     C                     SETOF                     800405
274400200610     C                     SETOF                     818789
274500200610     C                     SETOF                     434445
274600200610     C                     SETOF                     464750
274700200610     C                     SETOF                     5160
274800200610     C                     MOVE *OFF      *IN62                           CAC005
274900200610     C**  CLEAR SUBFILE
275000200610     C                     SETON                       02
275100200610     C                     WRITESE0265C0
275200200610     C                     SETOF                       02
275300200610     C**
275400200610     C                     ENDSR
275500200610     C*****************************************************************
275600200610     C/EJECT
275700200610     C*****************************************************************
275800200610     C**   SETUP  SR  To prepare for Screen Display                   *
275900200610     C**                                                              *
276000200610     C**   Called by  CUSSEC                                          *
276100200610     C**                                                              *
276200200610     C**   Calls  SR  CLEAR, DISP, SECFIL                             *
276300200610     C**                                                              *
276400200610     C*****************************************************************
276500200610     C**
276600200610     C           SETUP     BEGSR                           ** SETUP **
276700200610     C**
276800200610     C           BRANCH    IFEQ 'ALL'                                     054258
276900200610     C                     MOVE BRANCH    BRCHXX  3                       054258
277000200610     C                     MOVE *BLANKS   BRCCHK                          054258
277100200610     C                     ELSE                                           054258
277200200610     C                     MOVE BRANCH    BRCCHK
277300200610     C                     END                                            054258
277400200610     C                     MOVE EXPCCY    CURCHK
277500200610     C                     MOVE FACTRD    FACCHK
277600200610     C                     MOVE BOOKIN    BOKCHK
277700200610      *                                                                   CAC005
277800200610      ** Convert screen-criteria-book code and screen-criteria-profit     CAC005
277900200610      ** centre into pseudo book                                          CAC005
278000200610      *                                                                   CAC005
278100200610     C           CAC005    IFEQ 'Y'                                       CAC005
278200200610     C           BOOKIN    ANDNE*BLANKS                                   CAC005
278300200610     C           PRFC      ANDNE*BLANKS                                   CAC005
278400200610     C                     CALL 'AOBKPCR0'                                CAC005
278500200610     C                     PARM *BLANKS   PRTCD                           CAC005
278600200610     C                     PARM '*PSEUDO' POPTN                           CAC005
278700200610     C                     PARM BOOKIN    PBKCD   2                       CAC005
278800200610     C                     PARM PRFC      PPRFC   4                       CAC005
278900200610     C                     PARM           PPSBK   2                       CAC005
279000200610      *                                                                   CAC005
279100200610     C           PRTCD     IFEQ *BLANKS                                   CAC005
279200200610     C                     MOVELPPSBK     BOKCHK                          CAC005
279300200610     C                     ENDIF                                          CAC005
279400200610     C                     ENDIF                                          CAC005
279500200610     C**
279600200610     C**   Clear the Screen
279700200610     C**
279800200610     C                     EXSR CLEAR
279900200610     C*
280000200610     C                     MOVE ISSCHK    ISSUER                          054258
280100200610     C********** CUSCHK    IFNE '000000'                                               054258 CSD027
280200200610     C           CUSCHK    IFNE *BLANKS                                                       CSD027
280300200610     C           CUSCHK    ANDNE*BLANKS                                   054258
280400200610     C                     MOVE CUSCHK    CUSTMR                          054258
280500200610     C                     END                                            054258
280600200610     C           BRCCHK    IFEQ *BLANKS                                   054258
280700200610     C                     MOVE BRCHXX    BRANCH                          054258
280800200610     C                     ELSE                                           054258
280900200610     C                     MOVE BRCCHK    BRANCH                          054258
281000200610     C                     END                                            054258
281100200610     C                     MOVE CURCHK    EXPCCY                          054258
281200200610     C                     MOVE FACCHK    FACTRD                          054258
281300200610     C                     MOVE BOKCHK    BOOKIN                          054258
281400200610      *                                                                   CAC005
281500200610      ** Retrieve user book and profit centre                             CAC005
281600200610      *                                                                   CAC005
281700200610     C                     MOVE *BLANKS   PRFC                            CAC005
281800200610     C           CAC005    IFEQ 'Y'                                       CAC005
281900200610     C           BOKCHK    ANDNE*BLANK                                    CAC005
282000200610     C                     CALL 'AOBKPCR0'                                CAC005
282100200610     C                     PARM *BLANKS   PRTCD                           CAC005
282200200610     C                     PARM '*USER  ' POPTN                           CAC005
282300200610     C                     PARM           PBKCD                           CAC005
282400200610     C                     PARM           PPRFC                           CAC005
282500200610     C                     PARM BOKCHK    PPSBK                           CAC005
282600200610      *                                                                   CAC005
282700200610     C           PRTCD     IFEQ *BLANKS                                   CAC005
282800200610     C                     MOVE PBKCD     BOOKIN                          CAC005
282900200610     C                     MOVE PPRFC     PRFC                            CAC005
283000200610     C                     ENDIF                                          CAC005
283100200610     C                     ENDIF                                          CAC005
283200200610     C*
283300200610     C**
283400200610     C** Issuer valid - see if it is a parent
283500200610     C***Access*issuer*record*-**(PACUS)******************************    S01117
283600200610     C** Access issuer record -  (SDCUSTL4)                               S01117
283700200610     C**
283800200610     C***********ISSCHK    CHAINPACUS                25                   S01117
283900200610     C           ISSCHK    CHAINSDCUSTL4             25                   S01117
284000200610     C************IN25     IFEQ '0'                                       S01117
284100200610     C***********RECI      IFEQ '*'                                       S01117
284200200610     C***********          SETON                     25                   S01117
284300200610     C***********          END                                            S01117
284400200610     C***********          END                                            S01117
284500200610     C           *IN25     IFEQ '1'
284600200610     C                     SETOF                     60
284700200610     C                     ELSE
284800200610     C                     SETON                     60
284900200610     C                     END
285000200610     C**
285100200610     C**   Move  selection criteria to top of screen
285200200610     C**
285300200610     C           *IN60     IFEQ '1'
285400200610     C                     MOVE ISSCHK    SPAREN
285500200610     C                     END
285600200610     C                     MOVE ISSCHK    SISNO
285700200610     C                     MOVE ISNAME    SIRNM
285800200610     C                     MOVE ITOWN     SIRTN
285900200610     C           FACCHK    IFEQ 'F'
286000200610     C                     MOVE FACT      SFACT
286100200610     C                     ELSE
286200200610     C           FACCHK    IFEQ 'U'
286300200610     C                     MOVE UNFACT    SFACT
286400200610     C                     END
286500200610     C                     END
286600200610     C                     MOVE CURCHK    SECCY
286700200610     C**
286800200610     C**   Set defaults-
286900200610     C**
287000200610     C           *IN07     IFEQ '0'
287100200610     C***********          MOVE DSTB      BRCCHK                          S01117
287200200610     C                     MOVELUSRBCH    BRCCHK                          S01117
287300200610     C                     END
287400200610     C           CURCHK    IFEQ *BLANKS
287500200610     C***********          MOVEL'20      'TKEY   12                       S01117
287600200610     C***********          MOVE BCYL      CURCHK                          S01117
287700200610     C***********          MOVELBCYL      ZWK4                            S01117
287800200610     C***********          MOVE 1         ZWK4                            S01117
287900200610     C***********          MOVE ZWK4      TKEY                            S01117
288000200610     C***********TKEY      CHAINTABTG10F             25                   S01117
288100200610     C*                                                                   S01117
288200200610     C                     CALL 'AOCURRR0'                                S01117
288300200610     C                     PARM '*DBERR ' @RTCD   7                       S01117
288400200610     C                     PARM '*KEY   ' @OPTN   7                       S01117
288500200610     C                     PARM BNCYCD    @AJCD   3                       S01117
288600200610     C           SDCURR    PARM SDCURR    DSSDY                           S01117
288700200610     C*                                                                   S01117
288800200610     C**N25******RECI      COMP 'D'                  2525                 S01117
288900200610     C**
289000200610     C**     If no record found  or deleted record
289100200610     C**        then it is a database error so return to calling
289200200610     C**        program with a return code of '0'
289300200610     C**
289400200610     C************IN25     IFEQ '1'                                       S01117
289500200610     C***********          MOVELPROGRM    DBPGM            ************   S01117
289600200610     C***********          MOVELTKEY      DBKEY            **DATABASE*****S01117
289700200610     C***********          MOVE 'TABLE'   DBFILE           **ERROR*07*****S01117
289800200610     C***********          Z-ADD07        DBASE            ************   S01117
289900200610     C***********          SETON                       U7U8               S01117
290000200610     C***********          MOVE '0'       RTNC                            S01117
290100200610     C***********          EXSR RETSR                                     S01117
290200200610     C***********          ELSE                                           S01117
290300200610     C***********          Z-ADDSPOT      ZRATE2                          S01117
290400200610     C                     MOVE BNCYCD    CURCHK                          S01117
290500200610     C                     Z-ADDA6SPRT    ZRATE2                          S01117
290600200610     C***********MDIN      IFEQ 0                                         S01117
290700200610     C           A6MDIN    IFEQ 'D'                                       S01117
290800200610     C                     MOVE 'D'       ZMDI2   1
290900200610     C                     ELSE
291000200610     C                     MOVE 'M'       ZMDI2
291100200610     C                     END
291200200610     C***********          END                                            S01117
291300200610     C                     END
291400200610     C**
291500200610     C**   Position SECTY at start of required ISSUER
291600200610     C**
291700200610     C***********ISSCHK    SETLLSECTI                                     S01117
291800200610     C**********           MOVE ISSCHK    @TCHK   60                                   S01117 CSD027
291900200610     C                     MOVE ISSCHK    @TCHK   6                                           CSD027
292000200610     C           @TCHK     SETLLSECTI                                     S01117
292100200610     C**
292200200610     C**   Get details for display
292300200610     C**
292400200610     C                     EXSR DISP
292500200610     C**
292600200610     C                     ENDSR
292700200610     C*****************************************************************
292800200610     C/EJECT
2929002006100738 C*****************************************************************
293000200610     C**                                                              *
293100200610     C**   SUBFIL SR  Write details to Subfile                        *
293200200610     C**                                                              *
293300200610     C**   Called by  DISP                                            *
293400200610     C**                                                              *
293500200610     C**   Calls  SR  RETSR, ZSEDIT, BKPRC, ZSDESC, ZXRATE, ZCONV     *
293600200610     C**                                                              *
293700200610     C*****************************************************************
293800200610     C**
293900200610     C           SUBFIL    BEGSR                           ** SUBFIL **
294000200610     C**
294100200610     C**  SUBFIL - fills one line of the SFL depending on the setting
294200200610     C**           of SFLT
294300200610     C**
294400200610     C**  SFLT=1 FIRST SECURITY/POSITION DETAILS LINE
294500200610     C**
294600200610     C           SFLT      IFEQ 1
294700200610     C                     SETOF                     08
294800200610     C/COPY WNCPYSRC,SE0265C009
294900200610     C**
295000200610     C*****ACCESS*CLINTCB*for*positions*client****************************S01117
295100200610     C**   ACCESS SDCUSTPD for positions client                           S01117
295200200610     C**
295300200610     C           *IN85     IFEQ '1'
295400200610     C********** SAVCN     ANDNE0                                                             CSD027
295500200610     C           SAVCN     ANDNE*BLANKS                                                       CSD027
295600200610     C***********SAVCN     CHAINCLINTCBF             25                   S01117
295700200610     C**N25******RECI      COMP 'D'                  2525                 S01117
295800200610     C**
295900200610     C*******If*no*record*found**or*deleted*record************************S01117
296000200610     C**********then*it*is*a*database*error*so*return*to*calling**********S01117
296100200610     C**********program*with*a*return*code*of*'0'*************************S01117
296200200610     C**
296300200610     C************IN25     IFEQ '1'                                       S01117
296400200610     C*                                                                   S01117
296500200610     C                     MOVELSAVCN     KEY1   10                       S01117
296600200610     C*                                                                   S01117
296700200610     C**********           CALL 'AOCUSTR0'                                             S01117 235150
296800200610     C                     CALL 'AOCUSTR1'                                                    235150
296900200610     C                     PARM '*DBERR ' @RTCD   7                       S01117
297000200610     C                     PARM '*KEY   ' @KEY    7                       S01117
297100200610     C                     PARM KEY1      @KEY1  10                       S01117
297200200610     C                     PARM           @KYST   7                       S01117
297300200610     C********** SDCUST    PARM SDCUST    DSSDY                                        S01117 235150
297400200610     C           SDCUST    PARM SDCUST    DSLDY                                               235150
297500200610     C*                                                                   S01117
297600200610     C***********          MOVELPROGRM    DBPGM            ************   S01117
297700200610     C***********          MOVELSAVCN     DBKEY            * DATABASE *   S01117
297800200610     C***********          MOVE 'CLINT'   DBFILE           **ERROR*05**   S01117
297900200610     C***********          Z-ADD05        DBASE            ************   S01117
298000200610     C***********          SETON                       U7U8               S01117
298100200610     C***********          MOVE '0'       RTNC                            S01117
298200200610     C***********          EXSR RETSR                                     S01117
298300200610     C***********          ELSE                                           S01117
298400200610     C           @RTCD     IFEQ *BLANKS                                                       235150
298500200610     C           @RTCD     ORNE *BLANKS                                                       235150
298600200610     C           BBCLST    ANDEQ'Y'                                                           235150
298700200610     C                     MOVE BBCUST    CNUM                            S01117
298800200610     C                     ENDIF                                                              235150
298900200610     C***********          END                                            S01117
299000200610     C                     END
299100200610     C**
299200200610     C**   ACCESS TABTG10 FOR nominal CURRENCY
299300200610     C**
299400200610     C                     MOVEL'20      'TKEY   12
299500200610     C                     MOVELNMCY      ZWK4    4
299600200610     C                     MOVE 1         ZWK4
299700200610     C***********          MOVE ZWK4      TKEY                            S01117
299800200610     C***********TKEY      CHAINTABTG10F             25                   S01117
299900200610     C*                                                                   S01117
300000200610     C                     CALL 'AOCURRR0'                                S01117
300100200610     C                     PARM '*DBERR ' @RTCD   7                       S01117
300200200610     C                     PARM '*KEY   ' @OPTN   7                       S01117
300300200610     C                     PARM NMCY      @AJCD   3                       S01117
300400200610     C           SDCURR    PARM SDCURR    DSSDY                           S01117
300500200610     C*                                                                   S01117
300600200610     C*  SAVE CURRENCY DECIMAL PLACES FOR FROM CCY FOR SR ZCONV           S01117
300700200610     C*                                                                   S01117
300800200610     C                     Z-ADDA6NBDP    ZCDPI                           S01117
300900200610     C*                                                                   S01117
301000200610     C*  SAVE CURRENCY DECIMAL PLACES FOR SR ZACCZ, WHICH IN TURN         S01117
301100200610     C*    CALLS ZACCRZ, WHICH NEEDS THE NOM DEC. PLACES                  S01117
301200200610     C*                                                                   S01117
301300200610     C                     Z-ADDA6NBDP    ZCDP                            S01117
301400200610     C*                                                                   S01117
301500200610     C**N25******RECI      COMP 'D'                  2525                 S01117
301600200610     C**
301700200610     C**     If no record found  or deleted record
301800200610     C**        then it is a database error so return to calling
301900200610     C**        program with a return code of '0'
302000200610     C**
302100200610     C************IN25     IFEQ '1'                                       S01117
302200200610     C***********          MOVELPROGRM    DBPGM            ************   S01117
302300200610     C***********          MOVELTKEY      DBKEY            **DATABASE*****S01117
302400200610     C***********          MOVE 'TABLE'   DBFILE           **ERROR*06*****S01117
302500200610     C***********          Z-ADD06        DBASE            ************   S01117
302600200610     C***********          SETON                       U7U8               S01117
302700200610     C***********          MOVE '0'       RTNC                            S01117
302800200610     C***********          EXSR RETSR                                     S01117
302900200610     C***********          ELSE                                           S01117
303000200610     C***********          Z-ADDCDP       ZZCDP   10                      S01117
303100200610     C                     Z-ADDA6NBDP    ZZCDP   10                      S01117
303200200610     C***********          Z-ADDSPOT      ZRATE1                          S01117
303300200610     C                     Z-ADDA6SPRT    ZRATE1                          S01117
303400200610     C***********MDIN      IFEQ 0                                         S01117
303500200610     C           A6MDIN    IFEQ 'D'                                       S01117
303600200610     C                     MOVE 'D'       ZMDI1   1
303700200610     C                     ELSE
303800200610     C                     MOVE 'M'       ZMDI1
303900200610     C                     END
304000200610     C***********          END                                            S01117
304100200610     C**
304200200610     C**   Format security,cust,book,currency,branch,market,portf cust
304300200610     C**
304400200610     C                     MOVE SESN      SSESN
304500200610     C                     MOVE SAVBR     STDBR
304600200610     C           MBIN      IFEQ 'Y'                                       S01117
304700200610     C                     MOVE SAVBR     SBR
304800200610     C                     ELSE                                           S01117
304900200610     C                     MOVE *BLANK    SBR                             S01117
305000200610     C                     END                                            S01117
305100200610     C                     MOVE SAVMK     SMK
305200200610     C                     MOVE NMCY      SCURR
305300200610     C           *IN86     IFEQ '1'
305400200610     C**********           MOVE *ZEROS    SPCTN                                               CSD027
305500200610     C                     MOVE *BLANKS   SPCTN                                               CSD027
305600200610     C                     MOVE *BLANKS   SSCUS
305700200610     C                     MOVE SAVBK     SBOOK
305800200610     C                     MOVE SAVBK     STDBK
305900200610      *                                                                   CAC005
306000200610      ** If CAC005 is installed, retrieve the corresponding user book     CAC005
306100200610      ** and profit centre                                                CAC005
306200200610      *                                                                   CAC005
306300200610     C                     MOVE *BLANKS   SPRFC                           CAC005
306400200610     C           CAC005    IFEQ 'Y'                                       CAC005
306500200610     C           SAVBK     ANDNE*BLANK                                    CAC005
306600200610     C                     CALL 'AOBKPCR0'                                CAC005
306700200610     C                     PARM *BLANKS   PRTCD                           CAC005
306800200610     C                     PARM '*USER  ' POPTN                           CAC005
306900200610     C                     PARM           PBKCD                           CAC005
307000200610     C                     PARM           PPRFC                           CAC005
307100200610     C                     PARM SAVBK     PPSBK                           CAC005
307200200610      *                                                                   CAC005
307300200610     C           PRTCD     IFEQ *BLANKS                                   CAC005
307400200610     C                     MOVE PBKCD     SBOOK                           CAC005
307500200610     C                     MOVE PPRFC     SPRFC                           CAC005
307600200610     C                     ENDIF                                          CAC005
307700200610     C                     ENDIF                                          CAC005
307800200610     C                     ELSE
307900200610     C                     MOVE *BLANKS   STDBK
308000200610     C                     MOVE BBCSSN    SSCUS                           S01117
308100200610     C                     MOVE SAVCN     SPCTN
308200200610     C                     MOVE *BLANKS   STDBK
308300200610     C                     END
308400200610     C**
308500200610     C**   Edit nominal
308600200610     C**
308700200610     C                     Z-ADDNMDP      ZDECS   10
308800200610     C                     MOVE 'L'       ZECODE
308900200610     C                     Z-ADDZZNOML    ZFLD15
309000200610     C                     EXSR ZSEDIT
309100200610     C                     MOVE ZOUT21    STNOM
309200200610     C**
309300200610     C**   Format security ccy value & b/v ind
309400200610     C*  Convert Nominal to Nominal Currency Decimal Places
309500200610     C**
309600200610     C**********           MOVE *BLANKS   SBVI
309700200610     C********** ZZCDP     SUB  NMDP      ZI      10
309800200610     C********** ZI        ADD  5         ZI
309900200610     C********** ZZNOML    MULT POWER8,ZI ZZNOML    H
310000200610     C                     Z-ADD*ZEROS    WBVAL  150
310100200610     C                     Z-ADD*ZEROS    WBVAL0 150
310200200610     C                     Z-ADD*ZEROS    WBVAL1 151
310300200610     C                     Z-ADD*ZEROS    WBVAL2 152
310400200610     C                     Z-ADD*ZEROS    WBVAL3 153
310500200610     C                     MOVEA'0000'    *IN,55
310600200610     C           55        ADD  ZZCDP     J       20
310700200610     C                     MOVEA'1'       *IN,J
310800200610     C*
310900200610     C*  Multiply nominal by book/market price as applicable
311000200610     C*
311100200610     C***********MBEX      IFEQ 'B'                                       S01117
311200200610     C           BVMBEX    IFEQ 'B'                                       S01117
311300200610     C                     EXSR BKPRC
311400200610     C           BKPR      IFLT *ZEROS
311500200610     C                     Z-SUBBKPR      BKPR
311600200610     C                     END
311700200610     C********** BKPR      MULT ZZNOML    ZZNOML
311800200610     C   55      ZZNOML    MULT BKPR      WBVAL0    H
311900200610     C   56      ZZNOML    MULT BKPR      WBVAL1    H
312000200610     C   57      ZZNOML    MULT BKPR      WBVAL2    H
312100200610     C   58      ZZNOML    MULT BKPR      WBVAL3    H
312200200610     C*
312300200610     C                     ELSE
312400200610     C*                                                                   S01176
312500200610     C* Access Commercial Paper Price file for live record                S01176
312600200610     C*                                                                   S01176
312700200610     C                     MOVE SITP      KINVT                           S01176
312800200610     C                     MOVE NMCY      KCCY                            S01176
312900200610     C*                                                                   S01176
313000200610     C           CPPKA     CHAINCPPRIDF              25                   S01176
313100200610     C*                                                                   S01176
313200200610     C           *IN25     IFEQ '0'                                       S01176
313300200610     C           RECI      ANDEQ'*'                                       S01176
313400200610     C                     MOVE '1'       *IN25                           S01176
313500200610     C                     END                                            S01176
313600200610     C*                                                                   S01176
313700200610     C* If processing type is 9                                           S01176
313800200610     C* AND the trade basis is 'Y'                                        S01176
313900200610     C* AND a live record exists on LF/CPPRIC                             S01176
314000200610     C*                                                                   S01176
314100200610     C           PROT      IFEQ '9'                                       S01176
314200200610     C           TRBS      ANDEQ'Y'                                       S01176
314300200610     C           *IN25     ANDEQ'0'                                       S01176
314400200610     C*                                                                   S01176
314500200610     C* Calculate Yield using standard subroutine ZYMTX                   S01176
314600200610     C*                                                                   S01176
314700200610     C                     Z-ADDMATY      ZMDAT                           S01176
314800200610     C                     Z-ADDRUND      ZBASD                           S01176
314900200610     C*                                                                   S01176
315000200610     C                     Z-ADDND01      ZND,1                           S01176
315100200610     C                     Z-ADDND02      ZND,2                           S01176
315200200610     C                     Z-ADDND03      ZND,3                           S01176
315300200610     C                     Z-ADDND04      ZND,4                           S01176
315400200610     C                     Z-ADDND05      ZND,5                           S01176
315500200610     C                     Z-ADDND06      ZND,6                           S01176
315600200610     C                     Z-ADDND07      ZND,7                           S01176
315700200610     C                     Z-ADDND08      ZND,8                           S01176
315800200610     C                     Z-ADDND09      ZND,9                           S01176
315900200610     C                     Z-ADDND10      ZND,10                          S01176
316000200610     C                     Z-ADDND11      ZND,11                          S01176
316100200610     C                     Z-ADDND12      ZND,12                          S01176
316200200610     C                     Z-ADDND13      ZND,13                          S01176
316300200610     C                     Z-ADDND14      ZND,14                          S01176
316400200610     C                     Z-ADDND15      ZND,15                          S01176
316500200610     C                     Z-ADDND16      ZND,16                          S01176
316600200610     C                     Z-ADDND17      ZND,17                          S01176
316700200610     C                     Z-ADDND18      ZND,18                          S01176
316800200610     C                     Z-ADDND19      ZND,19                          S01176
316900200610     C                     Z-ADDND20      ZND,20                          S01176
317000200610     C                     Z-ADDND21      ZND,21                          S01176
317100200610     C                     Z-ADDND22      ZND,22                          S01176
317200200610     C                     Z-ADDND23      ZND,23                          S01176
317300200610     C                     Z-ADDND24      ZND,24                          S01176
317400200610     C                     Z-ADDND25      ZND,25                          S01176
317500200610     C*                                                                   S01176
317600200610     C                     Z-ADDYR01      ZRT,1                           S01176
317700200610     C                     Z-ADDYR02      ZRT,2                           S01176
317800200610     C                     Z-ADDYR03      ZRT,3                           S01176
317900200610     C                     Z-ADDYR04      ZRT,4                           S01176
318000200610     C                     Z-ADDYR05      ZRT,5                           S01176
318100200610     C                     Z-ADDYR06      ZRT,6                           S01176
318200200610     C                     Z-ADDYR07      ZRT,7                           S01176
318300200610     C                     Z-ADDYR08      ZRT,8                           S01176
318400200610     C                     Z-ADDYR09      ZRT,9                           S01176
318500200610     C                     Z-ADDYR10      ZRT,10                          S01176
318600200610     C                     Z-ADDYR11      ZRT,11                          S01176
318700200610     C                     Z-ADDYR12      ZRT,12                          S01176
318800200610     C                     Z-ADDYR13      ZRT,13                          S01176
318900200610     C                     Z-ADDYR14      ZRT,14                          S01176
319000200610     C                     Z-ADDYR15      ZRT,15                          S01176
319100200610     C                     Z-ADDYR16      ZRT,16                          S01176
319200200610     C                     Z-ADDYR17      ZRT,17                          S01176
319300200610     C                     Z-ADDYR18      ZRT,18                          S01176
319400200610     C                     Z-ADDYR19      ZRT,19                          S01176
319500200610     C                     Z-ADDYR20      ZRT,20                          S01176
319600200610     C                     Z-ADDYR21      ZRT,21                          S01176
319700200610     C                     Z-ADDYR22      ZRT,22                          S01176
319800200610     C                     Z-ADDYR23      ZRT,23                          S01176
319900200610     C                     Z-ADDYR24      ZRT,24                          S01176
320000200610     C                     Z-ADDYR25      ZRT,25                          S01176
320100200610     C/COPY WNCPYSRC,SE0265C011
320200200610     C*                                                                   S01176
320300200610     C                     EXSR ZYMTX                                     S01176
320400200610     C*                                                                   S01176
320500200610     C* Calculate Price using standard subroutine ZPRCI                   S01176
320600200610     C*                                                                   S01176
320700200610     C                     Z-ADDZY1       ZPRCIN                          S01176
320800200610     C                     Z-ADDRUND      ZFDATE                          S01176
320900200610     C*                                                                   S01232
321000200610     C* If necessary then set up Australian yield parameters              S01232
321100200610     C*                                                                   S01232
321200200610     C           *IN52     IFEQ '1'                                       S01232
321300200610     C           ZZNOML    ANDNE0                                         S01232
321400200610     C                     Z-ADDLCPN      ZDCSDT                          S01176
321500200610     C                     Z-ADDRUND      ZDCEDT                          S01176
321600200610     C                     Z-ADDZZNOML    ZAMT                            S01176
321700200610     C                     EXSR ZACCZ                                     S01176
321800200610     C           ZDCINT    DIV  ZZNOML    WRKPI                           S01176
321900200610     C                     Z-ADDRUND      WRKD    50                      S01176
322000200610     C                     EXSR ZYCE                                      S01176
322100200610     C*                                                                   S01232
322200200610     C*          IF EX-COUPON THEN PI PASSED IS THE REMAINING INTEREST    S01232
322300200610     C*          TILL NCD AND IS NEGATIVE                                 S01232
322400200610     C*                                                                   S01232
322500200610     C           SCUMEX    IFEQ 'X'                                       S01232
322600200610     C                     Z-ADDLCPN      ZDCSDT                          S01232
322700200610     C                     Z-ADDNCD       ZDCEDT                          S01232
322800200610     C                     EXSR ZACCZ                                     S01232
322900200610     C           ZDCINT    DIV  ZZNOML    WKWPI  159                      S01232
323000200610     C           WRKPI     SUB  WKWPI     WRKPI                           S01232
323100200610     C                     END                                            S01232
323200200610     C                     ELSE                                           S01232
323300200610     C                     MOVE 'C'       SCUMEX                          S01232
323400200610     C                     Z-ADD0         WRKPI                           S01232
323500200610     C                     END                                            S01232
323600200610     C*                                                                   E39495
323700200610     C           ZZNOML    IFLT *ZERO                                     E39495
323800200610     C                     Z-SUBZZNOML    ZNOML                           E39495
323900200610     C                     ELSE                                           E39495
324000200610     C                     Z-ADDZZNOML    ZNOML                           E39495
324100200610     C                     END                                            E39495
324200200610     C*                                                                   S01232
324300200610     C                     EXSR ZPRCI                                     S01176
324400200610      *                                                                                       CSE035
324500200610      ** ADJUST PRICE : PRICE + PUR INT BEFORE ROUNDING                                       CSE035
324600200610      *                                                                                       CSE035
324700200610     C           CSE035    IFEQ 'Y'                                                           CSE035
324800200610      *                                                                                       CSE035
324900200610     C           NCD       IFGE MATY                                                          CSE035
325000200610     C           SYBS      ANDEQ'AU'                                                          CSE035
325100200610     C                     Z-ADDZPRCOT    ZPRCOT                                              CSE035
325200200610     C                     ELSE                                                               CSE035
325300200610     C           SYBS      IFNE 'AU'                                                          CSE035
325400200610     C           SYBS      ANDNE'DA'                                                          CSE035
325500200610     C           STBS      ANDEQ'Y'                                                           CSE035
325600200610     C           ZPRCOT    ADD  ZWAMT     ZPRCOT                                              CSE035
325700200610     C                     END                                                                CSE035
325800200610     C                     END                                                                CSE035
325900200610      *                                                                                       CSE035
326000200610     C                     END                                                                CSE035
326100200610      *                                                                                       CSE035
326200200610     C           CSE035    IFEQ 'Y'                                                           CSE035
326300200610      *                                                                                       CSE035
326400200610     C           NCD       IFGE MATY                                                          CSE035
326500200610     C           SYBS      ANDEQ'AU'                                                          CSE035
326600200610     C                     ELSE                                                               CSE035
326700200610      *                                                                                       CSE035
326800200610     C           SYBS      IFNE 'AU'                                                          CSE035
326900200610     C           SYBS      ANDNE'DA'                                                          CSE035
327000200610     C           STBS      ANDEQ'Y'                                                           CSE035
327100200610     C           ZPRCOT    SUB  PURINT    ZPRCOT                                              CSE035
327200200610     C                     END                                                                CSE035
327300200610     C                     END                                                                CSE035
327400200610      *                                                                                       CSE035
327500200610     C                     END                                                                CSE035
327600200610      *                                                                                       CSE035
327700200610     C/COPY WNCPYSRC,SE0265C004
327800200610     C*                                                                   S01176
327900200610     C* Use calculated price                                              S01176
328000200610     C*                                                                   S01176
328100200610     C                     Z-ADDZPRCOT    WPRICE                          S01176
328200200610     C*                                                                   S01176
328300200610     C                     ELSE                                           S01176
328400200610     C*
328500200610     C* Access Price File for Security and Type 'V' for Price
328600200610     C*    - if not found use Market Price from Security
328700200610     C*
328800200610     C                     MOVE 'V '      PTYP
328900200610     C**********           MOVE *ZEROS    PCST                                                CSD027
329000200610     C                     MOVE *BLANKS   PCST                                                CSD027
329100200610     C                     Z-ADD0         PDAT
329200200610     C           KEYPT     SETLLPRICT
329300200610     C           KEYPTP    READEPRICT                    99
329400200610     C           *IN99     IFEQ '1'
329500200610     C                     Z-ADDMKPR      WPRICE 158
329600200610     C                     ELSE
329700200610     C                     Z-ADDPPRC      WPRICE
329800200610     C                     END
329900200610     C                     END                                            S01176
330000200610     C*
330100200610     C********** MKPR      MULT ZZNOML    ZZNOML
330200200610     C   55      ZZNOML    MULT WPRICE    WBVAL0    H
330300200610     C   56      ZZNOML    MULT WPRICE    WBVAL1    H
330400200610     C   57      ZZNOML    MULT WPRICE    WBVAL2    H
330500200610     C   58      ZZNOML    MULT WPRICE    WBVAL3    H
330600200610     C                     END
330700200610     C*                                                                   054259
330800200610     C           PROT      IFEQ '8'                                       054259
330900200610     C/COPY WNCPYSRC,SE0265C008
331000200610     C*                                                                   054259
331100200610     C                     MOVE SESN      SDSN                            054259
331200200610     C                     MOVE 'MP'      SDET                            054259
331300200610     C                     Z-ADDRUND      SDED                            054259
331400200610     C*                                                                   054259
331500200610     C           KEYSED    SETLLSEDEVDO                                   054259
331600200610     C                     READ SEDEVDO                  65               054259
331700200610     C*                                                                   054259
331800200610     C           *IN65     IFEQ '0'                                       054259
331900200610     C           SDSN      ANDEQSESN                                      054259
332000200610     C           SDET      ANDEQ'MP'                                      054259
332100200610     C   55                MULT SDCP      WBVAL0    H                     054259
332200200610     C   56                MULT SDCP      WBVAL1    H                     054259
332300200610     C   57                MULT SDCP      WBVAL2    H                     054259
332400200610     C   58                MULT SDCP      WBVAL3    H                     054259
332500200610     C                     ELSE                                           054259
332600200610     C   55                MULT CFCT      WBVAL0    H                     054259
332700200610     C   56                MULT CFCT      WBVAL1    H                     054259
332800200610     C   57                MULT CFCT      WBVAL2    H                     054259
332900200610     C   58                MULT CFCT      WBVAL3    H                     054259
333000200610     C                     END                                            054259
333100200610     C*                                                                   054259
333200200610     C                     END                                            054259
333300200610     C/COPY WNCPYSRC,SE0265C006
333400200610     C*
333500200610     C*  Divide by 100 if price basis is P
333600200610     C*
333700200610     C           SPBS      IFEQ 'P'
333800200610     C********** ZZNOML    DIV  100       ZZNOML    H
333900200610     C   55                DIV  100       WBVAL0
334000200610     C   56                DIV  100       WBVAL1
334100200610     C   57                DIV  100       WBVAL2
334200200610     C   58                DIV  100       WBVAL3
334300200610     C                     END
334400200610     C*
334500200610     C   55                MOVE WBVAL0    WBVAL
334600200610     C   56                MOVE WBVAL1    WBVAL
334700200610     C   57                MOVE WBVAL2    WBVAL
334800200610     C   58                MOVE WBVAL3    WBVAL
334900200610     C*
335000200610     C*   Allow for nominal decimal places
335100200610     C*
335200200610     C           5         SUB  NMDP      DC      10
335300200610     C           WBVAL     MULT POWER8,DC BVAL   150
335400200610     C*
335500200610     C                     Z-ADDZZCDP     ZDECS   10
335600200610     C                     MOVE 'L'       ZECODE
335700200610     C**********           Z-ADDZZNOML    ZFLD15
335800200610     C                     MOVE BVAL      ZFLD15
335900200610     C                     EXSR ZSEDIT
336000200610     C                     MOVE ZOUT21    SSVAL
336100200610     C**
336200200610     C**   Format exposure ccy value
336300200610     C*  Obtain the Cross-Exchange Rate between the two currencies
336400200610     C**
336500200610     C                     EXSR ZXRATE
336600200610     C**
336700200610     C*  Convert from Nominal to SELECTED Currency
336800200610     C**
336900200610     C                     Z-ADDZRATEX    ZEXCH
337000200610     C                     MOVE ZMDIX     ZMD
337100200610     C*                    Z-ADDZZNOML    ZAMTCI
337200200610     C                     MOVE BVAL      ZAMTCI
337300200610     C                     MOVE NMCY      ZCCYI
337400200610     C                     MOVE CURCHK    ZCCYO
337500200610     C*                                                                   S01117
337600200610     C** FIND DECIMAL PLACES FOR (TO) CURRENCY                            S01117
337700200610     C*                                                                   S01117
337800200610     C                     CALL 'AOCURRR0'                                S01117
337900200610     C                     PARM '*DBERR ' @RTCD   7                       S01117
338000200610     C                     PARM '*KEY   ' @OPTN   7                       S01117
338100200610     C                     PARM ZCCYO     @AJCD   3                       S01117
338200200610     C           SDCURR    PARM SDCURR    DSSDY                           S01117
338300200610     C                     Z-ADDA6NBDP    ZCDPO                           S01117
338400200610     C*                                                                   S01117
338500200610     C*
338600200610     C                     EXSR ZCONV
338700200610     C************INU7     IFEQ '1'                                       S01117
338800200610     C***********          MOVELPROGRM    DBPGM            ************   S01117
338900200610     C***********          MOVELTKEY      DBKEY            * DATABASE *   S01117
339000200610     C***********          MOVE 'TABLE'   DBFILE           * ERROR 08 *   S01117
339100200610     C***********          Z-ADD08        DBASE            ************   S01117
339200200610     C***********          SETON                       U7U8               S01117
339300200610     C***********          MOVE '0'       RTNC                            S01117
339400200610     C***********          EXSR RETSR                                     S01117
339500200610     C***********          END                                            S01117
339600200610     C                     MOVE ZAMTCO    ZZNOML
339700200610     C**
339800200610     C**  If factored - multiply by exposure %
339900200610     C**
340000200610     C           FACCHK    IFEQ 'F'
340100200610     C           ZZNOML    MULT EXPC      ZZNOML
340200200610     C           ZZNOML    DIV  100       ZZNOML    H
340300200610     C                     END
340400200610     C**
340500200610     C**  Round to nearest 1000 - add to total - edit for output
340600200610     C**
340700200610     C***********4         SUB  CDP       ZI      10                      S01117
340800200610     C           4         SUB  A6NBDP    ZI      10                      S01117
340900200610     C           ZZNOML    MULT POWER,ZI  ZZNOML    H
341000200610     C           ZZHUND    IFGE 5
341100200610     C                     ADD  1         ZZNOMT
341200200610     C                     END
341300200610     C*********************ADD  ZZNOMT    ZZTOTE                          E22909
341400200610     C                     MOVE 'L'       ZECODE
341500200610     C                     Z-ADD0         ZDECS
341600200610     C*********************Z-ADDZZNOMT    ZFLD15                          E22909
341700200610     C           ZZNOML    IFLT 0                                         E22909
341800200610     C                     Z-ADD0         ZFLD15                          E22909
341900200610     C                     Z-SUBZZNOMT    ZFLD15                          E22909
342000200610     C                     ELSE                                           E22909
342100200610     C                     Z-ADDZZNOMT    ZFLD15                          E22909
342200200610     C                     END                                            E22909
342300200610     C***********          Z-ADDZFLD15    ZZTOTE                    E22909E25598
342400200610     C                     ADD  ZFLD15    ZZTOTE                          E25598
342500200610     C**                                                                  E22909
342600200610     C                     EXSR ZSEDIT
342700200610     C                     MOVE ZOUT21    SEXPV
342800200610     C**
342900200610     C                     MOVE SPLIN1    SLINE
343000200610     C                     END
343100200610     C**
343200200610     C**  SFLT=2 SECOND SECURITY/POSITION DETAILS LINE
343300200610     C**
343400200610     C           SFLT      IFEQ 2
343500200610     C                     SETON                     08
343600200610     C**
343700200610     C**   Format security short description
343800200610     C**
343900200610     C                     MOVE SESN      SSESN
344000200610     C                     MOVE NMCY      SNMCY   3
344100200610     C                     MOVE SRPN      ZSRPN
344200200610     C                     MOVE BVRIDF    ZRSFD                           S01117
344300200610     C                     EXSR ZSDESC
344400200610     C                     MOVE ZRNME     SDESC
344500200610     C**
344600200610     C                     MOVE SPLIN2    SLINE
344700200610     C                     END
344800200610      *                                                                   CGL011
344900200610      ** Check if CGL011 is installed                                     CGL011
345000200610      *                                                                   CGL011
345100200610     C           CGL011    IFEQ 'Y'                                       CGL011
345200200610     C           SFLT      IFEQ 3                                         CGL011
345300200610     C                     MOVE *BLANKS   SLINE                           CGL011
345400200610     C                     MOVELCOLLA     SLINE                           CGL011
345500200610     C                     ENDIF                                          CGL011
345600200610     C           SFLT      IFEQ 4                                         CGL011
345700200610     C                     Z-ADD0         ZDECS   10                      CGL011
345800200610     C                     MOVE 'L'       ZECODE                          CGL011
345900200610     C                     Z-ADDZZTOTE    ZFLD15                          CGL011
346000200610     C                     EXSR ZSEDIT                                    CGL011
346100200610     C                     MOVE ZOUT21    STOTE                           CGL011
346200200610     C                     MOVE TOTLIN    SLINE                           CGL011
346300200610     C           OUTREC    IFLT 13                                        CGL011
346400200610     C                     ADD  1         SFLREC                          CGL011
346500200610     C                     ADD  1         OUTREC  20                      CGL011
346600200610     C                     WRITESE0265S0                                  CGL011
346700200610     C                     MOVE *BLANKS   SLINE                           CGL011
346800200610     C                     ENDIF                                          CGL011
346900200610     C                     ENDIF                                          CGL011
347000200610      *                                                                   CGL011
347100200610      ** CGL011 is not installed                                          CGL011
347200200610      *                                                                   CGL011
347300200610     C                     ELSE                                           CGL011
347400200610     C**
347500200610     C**  SFLT=3 TOTAL LINE
347600200610     C**
347700200610     C           SFLT      IFEQ 3
347800200610     C                     SETON                     08
347900200610     C**
348000200610     C**   Edit total exposure
348100200610     C**
348200200610     C                     Z-ADD0         ZDECS   10
348300200610     C                     MOVE 'L'       ZECODE
348400200610     C                     Z-ADDZZTOTE    ZFLD15
348500200610     C                     EXSR ZSEDIT
348600200610     C                     MOVE ZOUT21    STOTE
348700200610     C**
348800200610     C                     MOVE TOTLIN    SLINE
348900200610     C**
349000200610     C**   And output details to subfile
349100200610     C**   Output blank line if not end of sfl page
349200200610     C**
349300200610     C           OUTREC    IFLT 13
349400200610     C                     ADD  1         SFLREC
349500200610     C                     ADD  1         OUTREC  20
349600200610     C                     WRITESE0265S0
349700200610     C                     MOVE *BLANKS   SLINE
349800200610     C                     END
349900200610     C                     END
350000200610     C                     ENDIF                                          CGL011
350100200610     C**
350200200610     C**   And output details to subfile
350300200610     C**
350400200610     C                     ADD  1         SFLREC
350500200610     C                     ADD  1         OUTREC  20
350600200610     C                     WRITESE0265S0
350700200610     C**
350800200610     C                     ENDSR
350900200610     C*****************************************************************
351000200610     C/EJECT
351100200610     C*****************************************************************
351200200610     C**                                                              *
351300200610     C**   LINK   SR  Lower level Enquiry requested                   *
351400200610     C**                                                              *
351500200610     C**   Called by  MAIN                                            *
351600200610     C**                                                              *
351700200610     C**   Calls  SR  none                                            *
351800200610     C**                                                              *
351900200610     C**   Calls PGM  lower level enquiry obtained from SECOND        *
352000200610     C**                                                              *
352100200610     C*****************************************************************
352200200610     C**
3523002006100740 C           LINK      BEGSR                           *** LINK ******
3524002006100741 C**
352500200610     C**   Access Linked Enquiry Control File for program and option
352600200610     C**
352700200610     C           LKEY      KLIST
352800200610     C                     KFLD           PGMNO
352900200610     C                     KFLD           OPTN
353000200610     C**
353100200610     C           LKEY      CHAINSECONDF              42
353200200610     C**
353300200610     C**   If record not found then entered option is invalid
353400200610     C**
353500200610     C           *IN42     IFEQ '1'
353600200610     C                     MOVE MSG,4     ERMSG
353700200610     C**
353800200610     C                     ELSE
353900200610     C**
354000200610     C*****For*valid*option*write*out*LDA*and*linked*enquiry*data*area****S01117
354100200610     C**   For valid option write out linked enquiry data area            S01117
354200200610     C**   and call the program name obtained from SECOND
354300200610     C**
354400200610      ** If CAC005 is on, retrieve user book from AOBKPCR0.               178731
354500200610      *                                                                   178731
354600200610     C           CAC005    IFEQ 'Y'                                       178731
354700200610     C                     CALL 'AOBKPCR0'                                178731
354800200610     C                     PARM *BLANKS   PRTCD                           178731
354900200610     C                     PARM '*USER  ' POPTN                           178731
355000200610     C                     PARM *BLANKS   PBKCD                           178731
355100200610     C                     PARM *BLANKS   PPRFC                           178731
355200200610     C                     PARM RQBOOK    PPSBK                           178731
355300200610     C           PRTCD     IFEQ *BLANKS                                   178731
355400200610     C                     MOVE PBKCD     RQBOOK                          178731
355500200610     C                     ENDIF                                          178731
355600200610     C                     ENDIF                                          178731
355700200610      *                                                                   178731
355800200610     C                     OUT  SESDS
355900200610     C                     OUT  LDA
356000200610     C                     CALL TPGM
356100200610     C           *LOCK     IN   LDA
356200200610     C           *LOCK     IN   SESDS
356300200610     C**
356400200610     C**   On return from lower level check return code
356500200610     C**
356600200610     C**   If 0 (Database Error) or 1 (F3 to return to menu)
356700200610     C**      then exit to calling program
356800200610     C**
356900200610     C           RTNC      IFEQ '0'
357000200610     C           RTNC      OREQ '1'
357100200610     C                     MOVE '1'       *IN01
357200200610     C                     END
357300200610     C**
357400200610     C**   If Return code is 7 (F9 to return to inital enquiry)
357500200610     C**      then check if this is the inital enquiry
357600200610     C**      and if not return to calling program
357700200610     C**
357800200610     C           RTNC      IFEQ '7'
357900200610     C           ORIG      ANDNEPGMNO
358000200610     C                     MOVE '1'       *IN01
358100200610     C                     END
358200200610     C**
358300200610     C                     END
358400200610     C**
358500200610     C**
358600200610     C                     ENDSR
358700200610     C*****************************************************************
358800200610     C/EJECT
358900200610     C*****************************************************************
359000200610     C**                                                              *
359100200610     C**   RETSR  SR  End of Program Processing                       *
359200200610     C****************Write*out*LDA*and*linked*enquiry*data*area**********S01117
359300200610     C**              Write out linked enquiry data area                  S01117
359400200610     C**              and return to the calling program               *
359500200610     C**                                                              *
359600200610     C**   Called by  MAIN, FIRST, DISP                               *
359700200610     C**                                                              *
359800200610     C**   Calls  SR  none                                            *
359900200610     C**                                                              *
360000200610     C*****************************************************************
360100200610     C**
360200200610     C           RETSR     BEGSR                           *** RETSR   ***
360300200610     C**
360400200610     C                     OUT  SESDS
360500200610     C                     OUT  LDA
360600200610     C**
360700200610     C                     SETON                     LR
360800200610     C**
360900200610     C                     RETRN
361000200610     C*
361100200610     C                     ENDSR
361200200610     C*****************************************************************
361300200610     C/EJECT
361400200610     C*****************************************************************
361500200610     C**                                                              *
361600200610     C**   FIRST  SR  First Cycle Processing                          *
361700200610     C**                                                              *
361800200610     C**   Called by  MAIN                                            *
361900200610     C**                                                              *
362000200610     C*****Calls**SR**RETSR,*CUSTIN,*ZSYSTM,*ZICD2,*ZICDSE****************S01117
362100200610     C**   Calls  SR  RETSR, CUSTIN                                   *   S01117
362200200610     C**                                                              *
362300200610     C*****************************************************************
362400200610     C**
362500200610     C**
362600200610     C           FIRST     BEGSR                           ** FIRST **
362700200610     C**
362800200610     C*******Access*the*LDA**and**Linked*Enquiry*Data*Area****************S01117
362900200610     C**     Access the Linked Enquiry Data Area                          S01117
363000200610     C**
363100200610     C           *LOCK     IN   LDA
363200200610     C           *LOCK     IN   SESDS
363300200610     C           *LOCK     IN   JNSTAT
363400200610     C                     UNLCKJNSTAT
363500200610     C**
363600200610     C*******Access*the*ICD*record*1*for*run*date*&*date*format***********S01117
363700200610     C***********                                                         S01117
363800200610     C***********          EXSR ZSYSTM                                    S01117
363900200610     C**Error*in*ZSYSTM***************************************************S01117
364000200610     C***********                                                         S01117
364100200610     C                     CALL 'AOBANKR0'                                S01117
364200200610     C                     PARM '*DBERR ' @RTCD   7                       S01117
364300200610     C                     PARM '*FIRST ' @OPTN   7                       S01117
364400200610     C           SDBANK    PARM SDBANK    DSFDY                           S01117
364500200610      *                                                                   S01117
364600200610     C************IN99     IFEQ '1'                                       S01117
364700200610     C***********          MOVELPROGRM    DBPGM            ************   S01117
364800200610     C***********          MOVEL'ICDR1'   DBKEY            **DATABASE*****S01117
364900200610     C***********          MOVE 'TABLE'   DBFILE           **ERROR*01*****S01117
365000200610     C***********          Z-ADD01        DBASE            ************   S01117
365100200610     C***********          SETON                       U7U8               S01117
365200200610     C***********          MOVE '0'       RTNC                            S01117
365300200610     C***********          EXSR RETSR                                     S01117
365400200610     C***********          END                                            S01117
365500200610     C                     MOVE *BLANKS   RTNC
365600200610     C*****************************************************************   S01117
365700200610     C*******Access*the*ICD*record*2***********************************   S01117
365800200610     C***********                                                         S01117
365900200610     C***********          EXSR ZICD2                                     S01117
366000200610     C**********           CALL 'AOGELRR0'                                S01117              CGL029
366100200610     C                     CALL 'AOGELRR1'                                                    CGL029
366200200610     C                     PARM '*DBERR ' @RTCD   7                       S01117
366300200610     C                     PARM '*FIRST ' @OPTN   7                       S01117
366400200610     C********** SDGELR    PARM SDGELR    DSFDY                           S01117              CGL029
366500200610     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
366600200610     C*                                                                   S01117
366700200610     C***********                                                         S01117
366800200610     C**Error*in*ZICD2*************************************************   S01117
366900200610     C*
367000200610     C************IN99     IFEQ '1'                                       S01117
367100200610     C***********          MOVELPROGRM    DBPGM            ************   S01117
367200200610     C***********          MOVEL'ICDR2'   DBKEY            **DATABASE*****S01117
367300200610     C***********          MOVE 'TABLE'   DBFILE           **ERROR*02*****S01117
367400200610     C***********          Z-ADD02        DBASE            ************   S01117
367500200610     C***********          SETON                       U7U8               S01117
367600200610     C***********          MOVE '0'       RTNC                            S01117
367700200610     C***********          EXSR RETSR                                     S01117
367800200610     C***********          END                                            S01117
367900200610     C*                                                                   S01117
368000200610     C**********           CALL 'AODEALR0'                                S01117              CGL029
368100200610     C                     CALL 'AODEALR1'                                                    CGL029
368200200610     C                     PARM '*DBERR ' @RTCD   7                       S01117
368300200610     C                     PARM '*FIRST ' @OPTN   7                       S01117
368400200610     C********** SDDEAL    PARM SDDEAL    DSFDY                           S01117              CGL029
368500200610     C           SDDEAL    PARM SDDEAL    DSSDY                                               CGL029
368600200610     C*                                                                   S01117
368700200610     C**
368800200610     C**  ACCESS DATA AREA RUNDAT                                         S01117
368900200610     C**                                                                  S01117
369000200610     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
369100200610     C                     IN   RUNDT                                     S01117
369200200610     C*                                                                   S01117
369300200610     C**   CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.                    S01117
369400200610     C*                                                                   S01117
369500200610     C           DATF      COMP 'M'                      98               S01117
369600200610     C**                                                                  S01117
369700200610     C**     Determine if Multibranch (set *in07 on if so)
369800200610     C**
369900200610     C           MBIN      IFEQ 'Y'
370000200610     C                     SETON                     07
370100200610     C                     ELSE
370200200610     C                     SETOF                     07
370300200610     C                     END
370400200610     C**
370500200610     C*******Access*the*ICD*record*SE*for*default*branch******************S01117
370600200610     C*****************************************************************   S01117
370700200610     C***********          EXSR ZICDSE                                    S01117
370800200610     C*                                                                   S01117
370900200610     C**   ACCESS SECURITIES TRADING DETAIL                               S01117
371000200610     C                     CALL 'AOSTRDR0'                                S01117
371100200610     C                     PARM '*DBERR ' @RTCD   7                       S01117
371200200610     C                     PARM '*FIRST ' @OPTN   7                       S01117
371300200610     C           SDSTRD    PARM SDSTRD    DSSDY                           S01117
371400200610      *                                                                   CAC005
371500200610      ** Check if CAC005 is installed                                     CAC005
371600200610      *                                                                   CAC005
371700200610     C                     CALL 'AOSARDR0'                                CAC005
371800200610     C                     PARM *BLANKS   PRTCD   7                       CAC005
371900200610     C                     PARM '*VERIFY' POPTN   7                       CAC005
372000200610     C                     PARM 'CAC005'  PSARD   6                       CAC005
372100200610      *                                                                   CAC005
372200200610     C           PRTCD     IFEQ *BLANKS                                   CAC005
372300200610     C                     MOVE 'Y'       CAC005  1                       CAC005
372400200610     C                     MOVE *ON       *IN61                           CAC005
372500200610     C                     ELSE                                           CAC005
372600200610     C                     MOVE 'N'       CAC005                          CAC005
372700200610     C                     MOVE *OFF      *IN61                           CAC005
372800200610     C                     ENDIF                                          CAC005
372900200610      *                                                                   CGL011
373000200610      ** Check of CGL011 is installed                                     CGL011
373100200610      *                                                                   CGL011
373200200610     C                     CALL 'AOSARDR0'                                CGL011
373300200610     C                     PARM *BLANKS   PRTCD   7                       CGL011
373400200610     C                     PARM '*VERIFY' POTPN   7                       CGL011
373500200610     C                     PARM 'CGL011'  PSARD   6                       CGL011
373600200610     C           SCSARD    PARM SCSARD    DSFDY                           CGL011
373700200610      *                                                                   CGL011
373800200610     C           PRTCD     IFEQ *BLANKS                                   CGL011
373900200610     C                     MOVE 'Y'       CGL011  1                       CGL011
374000200610      *                                                                   CGL011
374100200610     C                     ELSE                                           CGL011
374200200610     C                     MOVE 'N'       CGL011                          CGL011
374300200610     C           PRTCD     IFNE '*NRF   '                                 CGL011
374400200610     C           *LOCK     IN   LDA                                       CGL011
374500200610     C                     MOVELPROGRM    DBPGM            ***************CGL011
374600200610     C                     Z-ADD013       DBASE            * DB ERROR 013*CGL011
374700200610     C                     MOVEL'SCSARDPD'DBFILE           ***************CGL011
374800200610     C                     MOVEL'CGL011  'DBKEY                           CGL011
374900200610     C                     MOVE *ON       *INU7                           CGL011
375000200610     C                     MOVE *ON       *INU8                           CGL011
375100200610     C                     EXSR *PSSR                                     CGL011
375200200610     C                     MOVE '0'       RTNC                            CGL011
375300200610     C                     EXSR RETSR                                     CGL011
375400200610     C                     ENDIF                                          CGL011
375500200610     C                     ENDIF                                          CGL011
375600200610      *                                                                                       CGL014
375700200610      ** Check of CGL014 is installed                                                         CGL014
375800200610      *                                                                                       CGL014
375900200610     C                     CALL 'AOSARDR0'                                                    CGL014
376000200610     C                     PARM *BLANKS   PRTCD                                               CGL014
376100200610     C                     PARM '*VERIFY' POTPN                                               CGL014
376200200610     C                     PARM 'CGL014'  PSARD                                               CGL014
376300200610     C           SCSARD    PARM SCSARD    DSFDY                                               CGL014
376400200610      *                                                                                       CGL014
376500200610     C           PRTCD     IFEQ *BLANKS                                                       CGL014
376600200610     C                     MOVE 'Y'       CGL014  1                                           CGL014
376700200610      *                                                                                       CGL014
376800200610     C                     ELSE                                                               CGL014
376900200610     C                     MOVE 'N'       CGL014                                              CGL014
377000200610     C           PRTCD     IFNE '*NRF   '                                                     CGL014
377100200610     C           *LOCK     IN   LDA                                                           CGL014
377200200610     C                     MOVELPROGRM    DBPGM                                               CGL014
377300200610     C                     Z-ADD014       DBASE                                               CGL014
377400200610     C                     MOVEL'SCSARDPD'DBFILE                                              CGL014
377500200610     C                     MOVEL'CGL014  'DBKEY                                               CGL014
377600200610     C                     MOVE *ON       *INU7                                               CGL014
377700200610     C                     MOVE *ON       *INU8                                               CGL014
377800200610     C                     EXSR *PSSR                                                         CGL014
377900200610     C                     MOVE '0'       RTNC                                                CGL014
378000200610     C                     EXSR RETSR                                                         CGL014
378100200610     C                     ENDIF                                                              CGL014
378200200610     C                     ENDIF                                                              CGL014
378300200610     C*                                                                   S01117
378400200610     C*
378500200610     C**Error*in*ZICDSE************************************************   S01117
378600200610     C*
378700200610     C************IN99     IFEQ '1'                                       S01117
378800200610     C***********          MOVELPROGRM    DBPGM            ************   S01117
378900200610     C***********          MOVEL'ICDSE'   DBKEY            **DATABASE*****S01117
379000200610     C***********          MOVE 'TABLE'   DBFILE           **ERROR*03*****S01117
379100200610     C***********          Z-ADD03        DBASE            ************   S01117
379200200610     C***********          SETON                       U7U8               S01117
379300200610     C***********          MOVE '0'       RTNC                            S01117
379400200610     C***********          EXSR RETSR                                     S01117
379500200610     C***********          END                                            S01117
379600200610     C**
379700200610     C**  ACCESS ZMUSER FOR DEFAULT BRANCH CODE                           S01117
379800200610     C**                                                                  S01117
379900200610     C           *NAMVAR   DEFN           ZMUSER                          S01117
380000200610     C                     IN   ZMUSER                                    S01117
380100200610     C**                                                                  S01117
380200200610     C**      Access program name - for help and linked enquiries
380300200610     C**
380400200610     C                     MOVELPROGRM    PGMNO   8
380500200610     C                     MOVELPROGRM    DBPGM
380600200610     C                     MOVE 'TOTAL E' STOT1
380700200610     C                     MOVE 'XPOSURE' STOT2
380800200610     C                     MOVE 'FACTO'   FAC1
380900200610     C                     MOVE 'RED  '   FAC2
381000200610     C                     MOVE 'UNFAC'   UFAC1
381100200610     C                     MOVE 'TORED'   UFAC2
381200200610      *                                                                                       CSE035
381300200610      ** Access SAR details file to see if CSE035 is installed                                CSE035
381400200610      *                                                                                       CSE035
381500200610     C                     CALL 'AOSARDR0'                                                    CSE035
381600200610     C                     PARM *BLANKS   @RTCD                                               CSE035
381700200610     C                     PARM '*VERIFY' @OPTN                                               CSE035
381800200610     C                     PARM 'CSE035'  WSARD   6                                           CSE035
381900200610      *                                                                                       CSE035
382000200610     C           @RTCD     IFEQ *BLANK                                                        CSE035
382100200610     C                     MOVE 'Y'       CSE035  1                                           CSE035
382200200610     C                     ELSE                                                               CSE035
382300200610     C                     MOVE 'N'       CSE035                                              CSE035
382400200610     C                     END                                                                CSE035
382500200610      *                                                                                       CSE035
382600200610      ** Access SAR details file to see if CUE018 is installed                                207543
382700200610      *                                                                                       207543
382800200610     C                     CALL 'AOSARDR0'                                                    207543
382900200610     C                     PARM *BLANKS   @RTCD                                               207543
383000200610     C                     PARM '*VERIFY' @OPTN                                               207543
383100200610     C                     PARM 'CEU018'  WSARD   6                                           207543
383200200610      *                                                                                       207543
383300200610     C           @RTCD     IFEQ *BLANK                                                        207543
383400200610     C                     MOVE 'Y'       CEU018  1                                           207543
383500200610     C                     ELSE                                                               207543
383600200610     C                     MOVE 'N'       CEU018                                              207543
383700200610     C                     END                                                                207543
383800200610     C/COPY WNCPYSRC,SE0265C005
383900200610     C**
384000200610     C**     If no issuer shortname found in request data
384100200610     C**        clear screen fields
384200200610     C***       else - process from this data
384300200610     C**
384400200610     C                     EXSR CLEAR
384500200610     C********** RQCUST    IFNE *ZEROS                                                        CSD027
384600200610     C           RQCUST    IFNE *BLANKS                                                       CSD027
384700200610     C           RQCUST    ANDNE*ZEROS                                                      BUG11747
384800200610     C**
384900200610     C                     MOVELRQCUST    ISSUER
385000200610     C                     MOVE *BLANKS   RQCUST
385100200610     C**
385200200610     C                     EXSR CUSTIN
385300200610     C                     END
385400200610     C**
385500200610     C/COPY WNCPYSRC,SE0265C012
385600200610     C                     ENDSR
385700200610     C**
385800200610     C/EJECT                                                              S01117
385900200610     C********************************************************************S01117
386000200610     C**                                                                  S01117
386100200610     C**   *PSSR SR.- DATABASE ERROR SUBROUTINE                           S01117
386200200610     C**                                                                  S01117
386300200610     C********************************************************************S01117
386400200610     C*                                                                   S01117
386500200610     C           *PSSR     BEGSR                           ** *PSSR SR ** S01117
386600200610     C**                                                                  S01117
386700200610     C           @RUN      IFEQ *BLANK                                    S01117
386800200610     C                     MOVE 'Y'       @RUN    1                       S01117
386900200610     C                     DUMP                                           S01117
387000200610     C                     END                                            S01117
387100200610     C**                                                                  S01117
387200200610     C                     ENDSR                                          S01117
387300200610     C**                                                                  S01117
387400200610     C********************************************************************S01117
387500200610      /EJECT                                                              S01232
387600200610     C/COPY ZSRSRC,ZACCH                                                  S01195
387700200610      /EJECT                                                              S01195
387800200610     C*/COPY*ZSRSRC,XDATE3Z1***                                     S01232S01195
387900200610     C/COPY ZSRSRC,ZBKDT                                                  S01195
388000200610      /EJECT                                                              S0S012
388100200610     C/COPY ZSRSRC,ZACCRZ1                                                S0S012
388200200610      /EJECT                                                              S01232
388300200610     C/COPY ZSRSRC,ZACCZZ1                                                S01232
388400200610     C/EJECT                                                              E39495
388500200610     C/COPY ZSRSRC,ZCALCD                                                 E39495
388600200610     C/EJECT                                                              E39495
388700200610     C/COPY ZSRSRC,ZCNSDZ1                                                E39495
388800200610      /EJECT
388900200610     C*/COPY*ZSRSRC,ZALIGNZ2***                                           S01117
389000200610     C*/EJECT******************                                           S01117
389100200610     C/COPY ZSRSRC,ZCONVZ1
389200200610      /EJECT
389300200610     C/COPY ZSRSRC,ZDATE1Z2
389400200610      /EJECT
389500200610     C/COPY ZSRSRC,ZDATE2Z4
389600200610      /EJECT
389700200610AB   C/COPY ZSRSRC,ZDAYSZ2
389800200610      /EJECT
389900200610AB   C/COPY ZSRSRC,ZDYYRZ3
390000200610      /EJECT
390100200610AB   C/COPY ZSRSRC,ZEVCDZ1
390200200610     C*EJECT*****************                                             S01117
390300200610     C*COPY*ZSRSRC,ZICD2Z1***                                             S01117
390400200610     C*EJECT*****************                                             S01117
390500200610     C*COPY*ZSRSRC,ZICDSEZ1**                                             S01117
390600200610      /EJECT                                                              E20380
390700200610     C/COPY ZSRSRC,ZLCDZ1                                                 E20380
390800200610      /EJECT
390900200610AB   C/COPY ZSRSRC,ZNCDZ3
391000200610      /EJECT                                                              S01176
391100200610     C/COPY ZSRSRC,ZPRCIZ1                                                S01176
391200200610      /EJECT
391300200610AB   C/COPY ZSRSRC,ZPRCOZ1
391400200610      /EJECT                                                              S01232
391500200610     C/COPY ZSRSRC,ZRATEZ1                                                S01232
391600200610      /EJECT
391700200610     C/COPY ZSRSRC,ZSDESCZ3
391800200610      /EJECT
391900200610     C/COPY ZSRSRC,ZSEDITZ3
392000200610      /EJECT
392100200610     C*/COPY*ZSRSRC,ZSYSTMZ1***                                           S01117
392200200610     C*/EJECT******************                                           S01117
392300200610     C/COPY ZSRSRC,ZXRATEZ1
392400200610      /EJECT                                                              S01232
392500200610     C/COPY ZSRSRC,ZYCEZ1                                                 S01232
392600200610      /EJECT                                                              S01176
392700200610     C/COPY ZSRSRC,ZYLDIZ1                                                S01176
392800200610      /EJECT
392900200610     C/COPY ZSRSRC,ZYLDOZ1
393000200610      /EJECT
393100200610     C/COPY ZSRSRC,ZYLDZ2
393200200610      /EJECT                                                              S01176
393300200610     C/COPY ZSRSRC,ZYMTXZ2                                                S01176
393400200610      /EJECT
393500200610      ***
393600200610      ***  Extra element added to MSG Array.                              E23190
393700200610**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
3938002006100366073110961461
393900200610**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
394000200610000031059090120151181212243273304334365
394100200610**   ZMNM - MONTHS SHORT NAMES
394200200610JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
394300200610**   MSG  - ERROR MESSAGES
394400200610ENTER AN ISSUER NO./SHORTNAME OR TAKE F/6 FOR SHORTNAME ENQUIRY
394500200610INVALID ENTRY - BOTH ISSUER NO./SHORTNAME AND OPTION ENTERED
394600200610INVALID ENTRY - ONLY ONE OPTION MAY BE SELECTED
394700200610INVALID OPTION - VALID OPTIONS ARE 1, 2 OR 3
394800200610INVALID ISSUER NO./SHORTNAME - PLEASE RE-ENTER OR TAKE F/6
394900200610THIS IS THE INITIAL ENQUIRY - F/3 WILL EXIT TO MENU
395000200610ENTER AN ISSUER NUMBER OR SHORTNAME, OR SELECT AN OPTION
395100200610INVALID BRANCH - PLEASE RE-ENTER
395200200610INVALID CUSTOMER NO./SHORTNAME - PLEASE RE-ENTER OR TAKE F/6
395300200610INVALID BOOK - PLEASE RE-ENTER
395400200610INVALID CURRENCY - PLEASE RE-ENTER
395500200610INVALID FACTORED/UNFACTORED - PLEASE RE-ENTER
395600200610F/6 INVALID AS NEITHER ISSUER OR SECURITY IS BLANK
395700200610OPTION NOT ALLOWED FOR USER POSITION
395800200610OPTION NOT ALLOWED FOR CUSTOMER POSITION
395900200610NOT A SAFE CUSTODY OR DISCRETIONARY CUSTOMER
396000200610USER IS NOT AUTHORISED TO ENQUIRE ON THIS BRANCH
396100200610USER IS NOT AUTHORISED TO ANY BRANCH
396200200610USER NOT AUTHORISED TO BANK LEVEL AUTHORITY - 'ALL' NOT ALLOWED
396300200610PROFIT CENTRE SHOULD NOT BE ENTERED IF BOOK IS NOT ENTERED
396400200610PROFIT CENTRE SHOULD BE ENTERED IF BOOK IS ENTERED
396500200610PROFIT CENTRE NOT VALID
396600200610PROFIT CENTRE IS NOT AUTHORISED TO USE THE BOOK
396700200610**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)                      S01176
3968002006100006001521029820444305904073650882610287117481320914670161311759219053    S01176
3969002006102051421975234362489726358278192928030741322023366335124365853804639507    S01176
39700020061040968424294389045351                                                      S01176
397100200610**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
3972002006100000001
3973002006100000010
3974002006100000100
3975002006100001000
3976002006100010000
3977002006100100000
3978002006101000000
397900200610**  POWER8 - ARRAY OF POWERS FOR NOMINAL DP TO CURRENCY DP CONVERSION
39800020061000000001
39810020061000000010
39820020061000000100
39830020061000001000
39840020061000010000
39850020061000100000
39860020061001000000
39870020061010000000
398800200610**  CPY@
398900200610(c) Finastra International Limited 2001
