     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Positions by issuer enquiry')                 *
      *****************************************************************
      *                                                               *
      *  Midas - Securities Trading Module                            *
      *                                                               *
      *  SE0265 - POSITIONS BY ISSUER ENQUIRY                         *
      *                                                               *
      *  Function:  This program shows the exposure in all the        *
      *   (I/C)     Securities for a selected Issuer or group of      *
      *             Issuers.  Trade Date positions are shown, either  *
      *             for a selected Portfolio Customer; selected Branch*
      *             where relevant; Book; or for all holdings.        *
      *             Details are Security; Customer; Book; Nominal;    *
      *             Value in Currency of Security; Value in either the*
      *             currency selected (converted at prevailing spot   *
      *             rate) or in bank's limit currency (if no currency *
      *             selected), and rounded to nearest thousand.  If   *
      *             the Factored Option is chosen, the conversion     *
      *             will also take into account the factor entered on *
      *             the Investment Type of the Security in order to   *
      *             represent the degree of risk attached to the      *
      *             security.  A total calculated exposure is shown   *
      *             at the end of the Enquiry.                        *
      *             Each option available from this enquiry is held   *
      *             as a record on PF/SECOND - Linked Enquiry Control *
      *             file with fields: Calling Program, Option         *
      *             Selected, Called Program.                         *
      *                                                               *
      *  Calls:     F6 may be taken when either the Issuer or         *
      *             Customer has not been entered to call:            *
      *             - SE0275 - Customer Shortname Enquiry             *
      *             - SE0270 - Security Customer Shortname Enquiry    *
      *             Additionally, options may be entered against a    *
      *             user position to call:                            *
      *             1) SE0245 - Security Details Enquiry              *
      *             3) SE0230 - Own Holdings Enquiry                  *
      *             and, against a customer position:                 *
      *             1) SE0245 - Security Details Enquiry              *
      *             2) SE0205 - Client Holdings Enquiry.              *
      *                                                               *
      *  Called By: SEC04 - CL Component to Control SE Enquiries      *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD058079           Date 11May21               *
      *  Prev Amend No. MD058285           Date 22Jun21               *
      *                 MD046998A          Date 15Apr21               *
      *                 248698             Date 01Jun20               *
      *                 261507             Date 22May20               *
      *                 MD057247           Date 01Feb21               *
      *                 MD050604           Date 21Feb20               *
      *                 MD046248           Date 27Oct17               *
      *                 226449             Date 24Jun15               *
      *                 MD034776           Date 08Jul15               *
      *                 AR1067108          Date 11Dec12               *
      *                 AR1001183A         Date 20Nov12               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 BUG11747           Date 21Jul06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 235150             Date 27Jul05               *
      *                 CSE071             Date 19Jul05               *
      *                 CSW037A            Date 02May05               *
      *                 BUG6198            Date 04Apr05               *
      *                 229857             Date 07Oct04               *
      *                 226570             Date 27Jun04               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3122            Date 17Jul04               *
      *                 CGL014             Date 20Oct03               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 211407             Date 07Jan03               *
      *                 208241             Date 21Aug02               *
      *                 194370             Date 12Jul01               *
      *                 207543             Date 17JUL02               *
      *                 180056             Date 18Oct00               *
      *                 CSE035             Date 22Apr02               *
      *                 CAS006             Date 21Jan03               *
      *                 206316             Date 19Jul02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 17Jun01               *
      *                 CSE031             Date 09Nov01               *
      *                 180707             Date 25Jul00               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 127566             Date 09May01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 178731             Date 05Feb01               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 140272             Date 20Apr00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CGL011             Date 20Sep99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CAC005             Date 23Nov98               *
      *                 130862             Date 18Oct98               *
      *                 151945             DATE 06Jan99               *
      *                 CSE005             Date 04Feb97               *
      *                 084704             Date 01Aug96               *
      *                 083039             DATE 01AUG96               *
      *                 059110             DATE 25JUL96               *
      *                 088047             DATE 26JUN96               *
      *                 100228             DATE 30MAY96               *
      *                 099886             DATE 18APR96               *
      *                 100017             DATE 18APR96               *
      *                 092961             DATE 04OCT95               *
      *                 091254             DATE 20OCT95               *
      *                 086491             DATE 15JUN95               *
      *                 082129             DATE 25JAN95               *
      *                 064575             DATE 15AUG94               *
      *                 065301             DATE 05MAY94               *
      *                 054258             DATE 24NOV93               *
      *                 054259             DATE 24NOV93               *
      *                 052254             DATE 24NOV93               *
      *                 S01401             DATE 16JUN93               *
      *                 E39495             DATE 17FEB93               *
      *                 047922             DATE 01FEB93               *
      *                 S01397             DATE 10SEP92               *
      *                 E37221             DATE 18MAR92               *
      *                 E32503             DATE 03DEC91               *
      *                 E27934             DATE 22OCT91               *
      *                 E25598             DATE 11SEP91               *
      *                 E27092             DATE 04SEP91               *
      *                 E28729             DATE 29OCT90               *
      *                 S01195             DATE 29OCT90               *
      *                 S01117             DATE 29OCT90               *
      *                 S01269             DATE 18OCT90               *
      *                 E23190             DATE 10AUG90               *
      *                 E23188             DATE 10AUG90               *
      *                 E23189             DATE 06AUG90               *
      *                 E22909             DATE 02AUG90               *
      *                 E21668             DATE 01MAY90               *
      *                 E21616             DATE 03APR90               *
      *                 E20651             DATE 04JAN90               *
      *                 S01232             DATE 30NOV89               *
      *                 E19964             DATE 30NOV89               *
      *                 E20380             DATE 30NOV89               *
      *                 S01199             DATE 03/08/89              *
      *                 E17303             DATE 21/04/89              *
      *                 S01179             DATE 21/10/88              *
      *                 E16063             DATE 09/10/88              *
      *                 E13571             DATE 31/07/88              *
      *                 S01176             DATE 21/08/88              *
      *                 E14057             DATE 01/07/88              *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  MD058079 - Deliverable Data Split for sundry files           *
      *  MD058285 - Change base rate code to alphanumeric (Recompile) *
      *  MD046998A - Recompiled due to changes in /COPY ZDYYRZ3       *
      *            - Applied fix for MD057480                         *
      *  248698 - Rounding discrepancies on some SE reports. Applied  *
      *           fix 228682.                                         *
      *  228682 - Recompiled due to ZCNSDZ1 changes. Applied 176594.  *
      *  261507 - Truncation of Average Price in display screen.      *
      *           Introduced new field BKPRR with length 23 with 8    *
      *           decimal places to be used as a result field when    *
      *           computing the average price to avoid truncation of  *
      *           the value.                                          *
      *  MD057247 - Multiple calls of UTCHOBJEX for several COB com-  *
      *             ponents - Securities module.                      *
      *           - Moved the call of AOSARDR0 from /copy ZLCDZ1.     *
      *  MD050604 - Average price of position changed incorrectly.    *
      *           - Recompiled due to changes in copy source ZCNSDZ1. *
      *  MD046248 - Finastra Rebranding                               *
      *  226449 - Recompiled over changes made in /COPY ZDYYRZ3.      *
      *         - Applied for MD034387.                               *
      *  MD034776 - Reverse AR1001183A to allow negative interest     *
      *             rate. (Recompile)                                 *
      *  AR1067108 - PMC1140 Component failed during Clean COB        *
      *              Applied fix AR1001183A                           *
      *  AR1001183A - Coupon rate was still used in computation of    *
      *              interest instead of using the details in FRN tab *
      *              (Reopen) (Recompile)                             *
      *  BUG11747 - Issuer defaults to zero                           *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  235150 - ENQY/POSI - DATABASE ERROR. Customer is flagged     *
      *           for closure.                                        *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  BUG6198- Cannot save new Details for CUSD (Recompile)        *
      *  229857 - Recompiled due to change in ZYLDZ2.                 *
      *  226570 - Recompiled due to change in ZYLDZ2.                 *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3122 - Recompiled due to changes in SDSECSPD.             *
      *  CGL014 - Collaterals Processing                              *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits (Recompile)      *
      *  211407 - Recompile after change on copy sources ZYLDZ2,      *
      *           ZACCRZ1 and ZYCEZ1 for NX/NNX processing.           *
      *           The change was to call subroutine ZLCD1 instead     *
      *           of ZLCD in retrieving the PERIOD for NNX processing *
      *           and ZNCD1 is called instead of ZNCD in retrieving   *
      *           the WBENCD for NNX processing. Also rewrite tests   *
      *           for identifying if position is NX,NNX or CUM.       *
      *  208241 - Recompiled over changed /CPY ZSDESCZ3.              *
      *  194370 - Recompile after change on copy sources ZYLDZ2,      *
      *           For securities with divisor basis = '5' and first   *
      *           coupon date > valuation date (rundate + 1), set     *
      *           event control date to first coupon date before      *
      *           processing SR/ZDYYR. This is to ensure that the     *
      *           correct hypothetical last and next coupon dates are *
      *           used in deriving the price/yield rate.              *
      *  207543 - CEU018 NOT WORKING ON A PRICE BASIS, MISSING A PART *
      *           OF AUS047. CHECK FOR CEU017, RECOMPILE OVER ZYLDZ2. *
      *  180056 - Recompiled over changed in ZDYYRZ3.                 *
      *  CSE035 - NX/NNX Coupon Payment Processing.                   *
      *           Recompile over changed ZACCRZ1/ZYLDZ2/ZYCEZ1
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  206316 - Recompiled over changed ZLCDZ1.                     *
      *  CPK015 - Conversion of ZYIELD from PLI to RPG.               *
      *           Recompile over changed ZYLDZ2.                      *
      *  CSE031 - Coupon Fixing for Floating Rate Notes.              *
      *           (recompilation due to change to ZNCD/ZLCD)          *
      *  180707 - No Position Settlements generated. Recompile over   *
      *           changes in /COPY ZNCDZ3.                            *
      *  127566 - Recompiled over changed ZSDESCZ3                    *
      *  178731 - While calling SE0230, it should pass the user-book  *
      *           code instead of pseudo-book code.                   *
      *  140272 - Recompile over changed ZYLDZ2                       *
      *  CGL011 - Collateral Processing for Midas                     *
      *  CAC005 - Profit Centre Accounting - SE Enhancement           *
      *  130862 - Recompiled over ZLCDZ1 & ZDAYSZ2 changes.           *
      *  151945 - Recompiled Over changed ZDYYRZ3 .                   *
      *  CSE005 - Effect of holidays on FRN Coupon Dates              *
      *           (recompilation due to change to ZNCD/ZLCD)          *
      *  084704 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
      *  083039 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
      *  059110 - Recompiled over changed ZYLDZ2 sub.                 *
      *  088047 - RECOMPILE over change SR/ZYLDZ2.                    *
      *  100228 - RECOMPILE OVER CHANGED ZDYYRZ3, ZLCDZ1 & ZNCDZ3.    *
      *  099886 - Rounding problem for partly paid securities.        *
      *           Recompile over amended standard subroutine ZACCZ.   *
      *  100017 - Position settlement unable to pick up day adj. on   *
      *           SECTYD. Change subroutine to use DADJN to stop      *
      *           interest day adjustment being used for amortisation.*
      *           Recompile over amended subroutine ZDAYS.            *
      *  092961 - Recompile over ZDAYSZ2 which was amended by 086491  *
      *           (Wrong number of days calculated for day basis 1    *
      *           when start or end day is last day of February)      *
      *  091254 - RECOMPILE OVER CHANGED ZLCDZ1 & ZNCDZ3              *
      *  086491 - Wrong nbr of days calculated for day basis 1        *
      *           when start or end day is last day of February       *
      *           Recompiled for ZSRSRC/ZDAYSZ2 changes.              *
      *  082129 - It is not an error if user enters an option and     *
      *           the issuer field is not blank, as long as the       *
      *           issuer field has not been changed.                  *
      *  064575 - Recompiled over amended ZYLDZ2 subroutine.          *
      *  065301 - Recompiled over changed copy source ZACCR subr.     *
      *           with ZAMT increased to 15,0.                        *
      *  054258 - SELECTION DETAIL'ALL'FOR BRANCH MUST BE RECOGNISED. *
      *  054259 - EXPOSURE MUST BE EQUAL TO NOMINAL X PRICE X CURRENT *
      *           FACTOR FOR PROT = 8.                                *
      *  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
      *           to 10,9                                             *
      *  S01401 - MT5xx SWIFT Messages Feature:                       *
      *           - Recompiled due to changes to files.               *
      *  E39495 - New /COPY subroutine ZCALCD added (called from      *
      *           sr. ZYLD)                                           *
      *         - /COPY subroutine ZCNSDZ1 added (called from sr.     *
      *           ZYLD)                                               *
      *         - Recompiled over changed ZYLDZ2                      *
      *  047922 - Recompiled over changed SR/ZYLDZ2                   *
      *  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
      *           - Recompiled due to changes to files and SR/ZYLD.   *
      *  E37221 - Must not check Branch Authority in Single Branc Mode*
      *  E32503 - Security value is often zero                        *
      *  E27934 - Recompiled over the changed version of ZACCRZ1      *
      *  E25598 - Total exposure should show TOTAL figure and not just*
      *           that for the last trade. ZZTOTE should not be zeroed*
      *           every time.                                         *
      *  E27092 - Recompiled over changed SR/ZLCD                     *
      *  E28729 - If an option is entered and then erased,            *
      *           the program does not recognise the erasure.         *
      *           Therefore ensure the option is not blank            *
      *           before checking is done.                            *
      *  S01195 - Holiday Processing.                                 *
      *  S01117 - Multi-Branching.                                    *
      *  S01269 - Trade authorisation: recompiled over changed        *
      *           file TABSE                                          *
      *  E23190 - Customer field should accept clients with           *
      *           classifications of 'S' or 'D'only.                  *
      *  E23188 - Recompiled over changed display file SE0265DF       *
      *  E23189 - Recompiled over changed display file SE0265DF       *
      *  E22909 - Exposure currency value due to a short position     *
      *           should be shown as negative, not positive.          *
      *  E21668 - Recompiled over changed SR/ZYLDZ2                   *
      *  E21616 - Recompiled over changed SR/ZLCD.                    *
      *  E20651 - DB Error Numbers used in more than one place.       *
      *           New Error Numbers as follows:                       *
      *           DB ERROR 09  ->  10                                 *
      *           DB ERROR 09  ->  11                                 *
      *  S01232 - Australian Yields modifications.                    *
      *  E19964 - Selection by Book or Customer does not work. Rollup/*
      *           Rolldown are in error. Command 6 produces the wrong *
      *           Customer Shortname Enquiry for the Issuer.          *
      *  E20380 - ZLCD added for ZYLD - recompile.                    *
      *  S01199 - Help System.                                        *
      *  E17303 - Recompile program over changed ZDYYRZ3, ZYLDZ1,     *
      *           ZYLDZ2                                              *
      *  S01179 - ****** AS400 CONVERSION ******                      *
      *     The keyword RTGAID is no longer supported on the AS400    *
      *     and command keys and indicators have been used to replace *
      *     this in the display file. To disrupt the structure of the *
      *     program as little as possible a new subroutine - ASCHGS - *
      *     has been coded. This moves the values which would have    *
      *     been passed to the program (via RTGAID) into the AID      *
      *     field depending on which function key has been pressed.   *
      *  E16063 - LINKED ENQUIRY REORGANISATION:                      *
      *           - Open CLINT Consistent eith SE0205.                *
      *  E13571 - AMENDED ERROR MESSAGE, AS NO HELP TEXT              *
      *  S01176 - RELEASE 3.1 MODIFICATIONS                           *
      *  E14057 - USE PRICR NOT PRICS FILE.                           *
      *                                                               *
      *****************************************************************
      *
     FSE0265DFCF  E                    WORKSTN      KINFDS SCRDS
     F                                        SFLRECKSFILE SE0265S0
     FSECTI   IF  E           K        DISK
     F            SECTYDF                           KRENAMESECTIDF
     F*CLINT**IF**E           K        DISK                               S01117
     F*********** CLINTCAF                          KIGNORE               S01117
     F*********** CLINTCCF                          KIGNORE               S01117
     F*********** CLINTC1F                          KIGNORE               S01117
     F************CLINTSEF                          KIGNORE               E16063
     F*PACUS***IF**E***        K        DISK
     F*********** CLINTCBF                          KRENAMEPACUSF
     FSDCUSTL4IF  E           K        DISK                               S01117
     F*SNAME***I***E***        K        DISK                              S01117
     F*********** CLINTCBF                          KRENAMESNAMEF         S01117
     F*TABSE***IF**E***        K        DISK                              S01117
     F*********** TABLETAF                          KIGNORE               S01117
     F*********** TABTB10F                          KIGNORE               S01117
     F*********** TABTB11F                          KIGNORE               S01117
     F*********** TABTB36F                          KIGNORE               S01117
     F*********** TABTB40F                          KIGNORE               S01117
     F*********** TABTE10F                          KIGNORE               S01117
     F*********** TABTE20F                          KIGNORE               S01117
     F*********** TABTG10F                          KIGNORE               S01117
     F*********** TABTG20F                          KIGNORE               S01117
     F*********** TABLETHF                          KIGNORE               S01117
     F*********** TABLETJF                          KIGNORE               S01232
     F*********** TABLETKF                          KIGNORE               S01117
     F*********** TABLETLF                          KIGNORE               S01117
     F*********** TABLETNF                          KIGNORE               S01117
     F*********** TABLETPF                          KIGNORE               S01117
     F*********** TABLETRF                          KIGNORE               S01117
     F*********** TABLETXF                          KIGNORE               S01117
     F*********** TABLET2F                          KIGNORE               S01117
     F*********** TABLET3F                          KIGNORE               S01117
     F*********** TABLET5F                          KIGNORE               S01117
     FCDEPS   IF  E           K        DISK
     FUDEPS   IF  E           K        DISK
     FINVTP   IF  E           K        DISK
     F*BOOKD***IF**E***        K        DISK                              S01117
     F*RICS***IF**E           K        DISK                               E14057
     FPRICR   IF  E           K        DISK                               E14057
     FPRICT   IF  E           K        DISK
     F            PRICEDF                           KRENAMEPRICETDF
     FBKPOS   IF  E           K        DISK
     FBKPHD   IF  E           K        DISK
     F*SECOND**IF  E           K        DISK                                                MD058079
     FCPPRIC  IF  E           K        DISK                               S01176
     F**SECET***IF**E           K        DISK                       S01176S01232
     FSEDEV   IF  E           K        DISK                               S01232
     FSECEO   IF  E           K        DISK                               S01232
     F            SEDEVDF                           KRENAMESEDEVDO        S01232
     F            SNDEVDF                           KRENAMESNDEVDO        S01232
     FSEBLKPL6IF  E           K        DISK                               CGL011
      ** Manually Blocked Positions File                                  CGL011
      *                                                                   CGL011
     FSEBLKPL7IF  E           K        DISK                                                   CGL014
     F            SEBLKPD0                          KRENAMESEBLKPDF                           CGL014
     F/COPY WNCPYSRC,SE0265F001
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*   01      RETURN TO PREVIOUS PROGRAM                          *
     F*************OR*ERROR*ON*TABTB10*READ****************************   S01117
     F*   02      CLEAR SUBFILE                                       *
     F*   03      NO DETAILS INDICATOR                                *
     F*   04      DISPLAY MESSAGE - NO DETAILS TO DISPLAY             *
     F*   05      DETAILS COMPLETE FOR THIS SECURITY                  *
     F*   06                                                          *
     F*   07      IN MULTIBRANCH MODE                                 *
     F*   08      PROTECT SELECT FIELD OR NOT                         *
     F*   10      VLDCMDKY INDICATOR FOR DISPLAY FILE                 *
     F*   20      ROLLUP                                              *   S01179
     F*   21      ROLLDOWN                                            *   S01179
     F*   22      HELP                                                *   S01179
     F*   25      CHAIN FAIL ON ANY FILE                              *
     F*   40      END OF FILE ON SUBFILE READ                         *
     F*   41      REVERSE IMAGE ISSUER FIELD                          *
     F*   42      DISPLAY ERROR MESSAGE                               *
     F*   43      REVERSE IMAGE BRANCH FIELD                          *
     F*   44      REVERSE IMAGE CUSTOMER FIELD                        *
     F*   45      REVERSE IMAGE BOOK FIELD                            *
     F*   46      REVERSE IMAGE CURRENCY FIELD                        *
     F*   47      REVERSE IMAGE FACTORED FIELD                        *
     F*   50      ON IF DETAILS ACCUMULATED FOR PREVIOUS SEC          *
     F*   51      MORE DETAILS TO OUTPUT FOR SECURITY                 *
     F*   52      AUSTRAIAN YIELD TRADED SECURITY                     *   S01232
     F*   55      NOMINAL CURRENCY DEC. PLACES 0                      *
     F*   56      NOMINAL CURRENCY DEC. PLACES 1                      *
     F*   57      NOMINAL CURRENCY DEC. PLACES 2                      *
     F*   58      NOMINAL CURRENCY DEC. PLACES 3                      *
     F*   60      DISPLAY GROUP PARENT                                *
      *   61      No Display for Profit Centre                        *   CAC005
      *   62      Error in Profit Centre                              *   CAC005
      ****63****  End of File on LF/SEBLKPL6                          *                CGL011 CGL014
      *   63      End of File on LF/SEBLKPL6 and LF/SEBLKPL7          *                       CGL014
     F*   70      ON IF TOTAL REQUIRED FOR SECURITY                   *
     F*   71      DONT DO FIRST READ IF 2ND+ PAGE                     *
     F*   81      END OF FILE ON SECTI  OR END OF SUBFILE PAGE        *
     F*   82      WORK INDICATOR FOR SETTING SFLEND                   *
     F*   85      RECORDS TO BE READ FROM CDEPS                       *
     F*   86      RECORDS TO BE READ FROM UDEPS                       *
     F*   87      END OF FILE ON UDEPS/CDEPS                          *
     F*   88      SUBFILE READ FAIL                                   *
     F*   89      END OF FILE ON SECTI  OR END OF SUBFILE PAGE        *
     F*   90 - 99 WORK INDICATOR - STD SUBROUTINES                    *
     F*   U7      WITH U8 FOR DATABASE ERROR                          *
     F*   U8      WITH U7 FOR DATABASE ERROR                          *
     F*   LR      TERMINATE PROGRAM                                   *
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  I N D E X   T O   S U B R O U T I N E S                      *
     F*                                                               *
     F*  ASCHGS  -  MOVES VALUES INTO AID - AS400 CONVERSION          *
     F*  COMMD   -  PROCESS COMMAND KEYS, HELP AND ROLLUP/DOWN        *
     F*  OPTION  -  CHECK VALIDITY OF ENTERED OPTION COMBINATIONS     *
     F*  CUSTIN  -  PROCESS ENTERED SELECTION FIELDS                  *
     F*  CLEAR   -  CLEAR FIELDS AND INDICATORS ON DISPLAY SCREEN     *
     F*  ROLLUP  -  HANDLE ROLLUP                                     *
     F*  ROLLDN  -  HANDLE ROLLDOWN                                   *
     F*  DISP    -  ACCUMULATE DETAILS FOR DISPLAY                    *
     F*  SETUP   -  PREPARE SCREEN FOR DISPLAY                        *
     F*  PROCES  -  DETERMINE LINE TYPE                               *
     F*  SUBFIL  -  WRITE ACCUMULATED DETAILS TO SUBFILE              *
     F*  BKPRC   -  DETERMINE BOOK PRICE                              *
     F*  OLBAP   -  CALCULATE ON-LINE BOOK POSN AVERAGE PRICE         *
     F*  LINK    -  PROCESS REQUEST FOR LOWER LEVEL ENQUIRY           *
     F*  RETSR   -  END OF PROGRAM PROCESSING                         *
     F*  FIRST   -  FIRST CYCLE PROCESSING                            *
     F***XDATE3**-**CALCULATE*BUSINESS*DAYS*BACKWARDS***************S01232S01195
     F*  ZBKDT   -  CALCULATE BUSINESS DAYS BACKWARDS                 *   S01195
     F*  ZACCR   -  CALCULATE ACCRUED INTEREST BETWEEN DATES          *   S01232
     F*  ZACCZ   -  CALCULATE ACCRUED INTEREST                        *   S01232
     F*  ZCALCD  -  CALCULATE LONG TERM CD PRICE FROM INPUT YIELD     *   E39495
     F*  ZCNSD   -  CALCULATE CONSIDERATION                           *   E39495
     F*  ZSDESC  -  FORMAT SECURITY REPORT DESCRIPTION FOR DISPLAY    *
     F*  ZSEDIT  -  EDIT FIELDS FOR OUTPUT                            *
     F*  ZXRATE  -  EXCHGE RATE AND M/D IND. BETWEEN 2 CURRENCIES     *
     F***ZALIGN**-**VALIDATE*AND*RIGHT-ALIGN*NUMERIC*FIELDS************   S01117
     F*  ZCONV   -  CONVERT AMOUNT FROM ONE CURRENCY TO ANOTHER       *
     F*  ZDATE2  -  DATE FORMATTER                                    *
     F***ZSYSTM**-**ACCESS*ICDR1***************************************   S01117
     F***ZICD2***-**ACCESS*ICDR2***************************************   S01117
     F***ZICDSE**-**ACCESS*ICDSE***************************************   S01117
     F*  ZPRCI   -  CALCULATE PRICE                                   *   S01176
     F*  ZRATE   -  DETERMINE EFFECTIVE INTEREST RATE                 *   S01232
     F*  ZYCE    -  DETERMINE AUSTRALIAN YIELD CUM/EX PARAMETER       *   S01232
     F*  ZYMTX   -  CALCULATE YIELD                                   *   S01176
     F*  *PSSR   -  HANDLE DATABASE ERRORS                            *   S01117
     F*                                                               *
     F*****************************************************************
      /EJECT
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY ZSRSRC,ZDATE6Z1                                               S01232
     E********************MSG     1  15 79               Error Messages   E23190
     E***********         MSG     1  16 79               Error Messages   E23190
     E***********         MSG     1  18 79               Error MessS01117 054258
     E***********         MSG     1  19 79               Error Mess054258 CAC005
     E                    MSG     1  23 79               Error Messages   CAC005
     E/COPY ZSRSRC,ZDAYSZ1                                                S01176
     E/COPY ZSRSRC,ZPOWERZ1
     E/COPY ZSRSRC,ZPOWER8Z1
     E/COPY ZSRSRC,ZSEDITZ1
     E*/COPY*ZSRSRC,ZALIGNZ1***                                           S01117
      /COPY ZSRSRC,ZSDESCZ1
     E                    CPY@    1   1 80
     E/COPY ZSRSRC,ZNCDZ1                                                 S01176
     E/COPY ZSRSRC,ZYMTXZ1                                                S01176
     E/COPY ZSRSRC,ZHOLE                                                  S01195
      /EJECT
     I@CUSTFR                                                             S01117
     I              BBCUST                          CNUM                  S01117
     I*
     IUDEPPDF
     I*
     I*   RENAME FIELDS USED ON UDEPS SO LOOK LIKE CDEPS
     I*
     I***********   UDBR                            CDBR                  S01117
     I              UDBA                            CDPA                  S01117
     I              UDBK                            CDBK
     I              UDMK                            CDMK
     I              UDNT                            CDNT
     I              UDNV                            CDNV
     I              UDTP                            SNPT
     I              UDTS                            CDST
     I              UDPV                            CNPV
     I              UDSV                            CNSV
     I/COPY ZSRSRC,ZNCDZ2
0273 I            DS
0274 I                                        1  10 CUSTWK
0275 I                                        1   6 SCSNMA
0276 I                                        7  10 SCSNMB
     I/COPY ZSRSRC,ZSEDITZ2
     I            DS
     I**********                              1   60CUSTNO                                    CSD027
     I                                        1   6 CUSTNO                                    CSD027
     I                                        1   6 CUSTIP
     I            DS
     I                                        1   6 SPAREN
     I                                        1   60PARENT
     I*LDA*******UDS                            256                       S01117
     ILDA         DS                            256                       S01117
     I*
     I*      Local data area.
     I*
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 1770DBASE                 S01117
     I                                      134 183 DBLOT                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     I*                                                                   S01117
     I**  EXTERNAL DS FOR SD CUSTOMER DETAILS                             S01117
     ISDCUST    E DSSDCUSTPD                                              S01117
     I*                                                                   S01117
     I**  EXTERNAL DS FOR BANK DETAILS                                    S01117
     ISDBANK    E DSSDBANKPD                                              S01117
     I*                                                                   S01117
     I**  EXTERNAL DS FOR DEALING DATA                                    S01117
     ISDDEAL    E DSSDDEALPD                                              S01117
     I*                                                                   S01117
     I**  EXTERNAL DS FOR SD CURRENCY DETAILS                             S01117
     ISDCURR    E DSSDCURRPD                                              S01117
     I*                                                                   S01117
     I**  EXTERNAL DS FOR SECURITIES TRADING DETAILS                      S01117
     ISDSTRD    E DSSDSTRDPD                                              S01117
     I*                                                                   S01117
     I**  EXTERNAL DS FOR GENERAL LEDGER ICD DETAILS                      S01117
     ISDGELR    E DSSDGELRPD                                              S01117
     I              QQACCD                          QQACD1                                    CGL029
     I*                                                                   S01117
     I**  EXTERNAL DS FOR SD BRANCH DETAILS                               S01117
     ISDBRCH    E DSSDBRCHPD                                              S01117
     I              QQDFAC                          #DFAC1                                    CGL029
     I*                                                                   S01117
     I**  EXTERNAL DS FOR SE CLIENTS DETAILS                              S01117
     ISDSECS    E DSSDSECSPD                                              S01117
     I              QQACCD                          QQACD2                                    CGL029
     I*                                                                   S01117
     I**  EXTERNAL DS FOR BOOK DETAILS                                    S01117
     ISDBOOK    E DSSDBOOKPD                                              S01117
     I*                                                                   CAC005
     I**  External DS for Profit Centre Details                           CAC005
     ISDPRFC    E DSSDPRFCPD                                              CAC005
     I*                                                                   S01117
      **  External Data Structure for Switchable Features file            CGL011
     ISCSARD    E DSSCSARDPD                                              CGL011
      *                                                                   CGL011
     I**  DATA STRUCTURE FOR RUN DATE DETAILS                             S01117
     IRUNDT       DS                                                      S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
     I**                                                                  S01117
     I**  DATA STRUCTURE FOR ZMUSER                                       S01117
     IZMUSER      DS                             17                       S01117
     I                                       11  13 USRBCH                S01117
     I                                       17  17 BKLAUT                054258
     I**                                                                  S01117
     I** DATA STRUCTURE FOR ACCESS OBJECTS, SHORT DATA STRUCTURE          S01117
     IDSFDY     E DSDSFDY                                                 S01117
     I*                                                                   S01117
     I** LONG STRUCTURE FOR ACCESS OBJECTS, LONG DATA STRUCTURE           S01117
     IDSSDY     E DSDSSDY                                                 S01117
     I*                                                                   S01117
     I*                                                                   235150
     I*  THIRD DS FOR ACCESS PROGRAMS, VERY LONG DATA STRUCTURE           235150
     IDSLDY     E DSDSLDY                                                 235150
     I*                                                                   235150
     ISECOND    E DSSECONJW0                                                                MD058079
     I**  LINK ENQUIRY DATA AREA
     ISESDS     E DS
     IPSDS       SDS
     I                                        1  10 PROGRM
     I                                      244 246 WSID
     ISCRDS       DS
     I                                      287 288 AID
      /COPY ZSRSRC,ZSDESCZ2
     I*
     I*   JNSTAT DATA AREA
     IJNSTAT     UDS                            200
     I                                    P 103 1050PRUN
     I*
     I            DS
     I*
     I*   DATA STRUCTURES FOR SETTING UP SFL LINES
     I*
     I                                        1  77 SPLIN1
     I                                        1  10 SSESN
     I                                       12  21 SSCUS
     I***********                            16  17 SBOOK                 CAC005
     I                                       14  15 SBOOK                 CAC005
     I                                       17  20 SPRFC                 CAC005
     I                                       23  25 SCURR
     I                                       27  42 STNOM
     I                                       44  59 SSVAL
     I                                       61  61 SBVI
     I                                       65  77 SEXPV
     I            DS
     I                                        1  77 SPLIN2
     I                                        2   4 SBR
     I                                        7   7 SMK
     I                                       10  50 SDESC
     I            DS
     I                                        1  77 TOTLIN
     I                                       46  59 STOT
     I                                       46  52 STOT1
     I                                       53  59 STOT2
     I                                       64  77 STOTE
0257 I            DS
0258 I                                        1   6 IKEY
0259 I                                        1   3 NMCY
0260 I                                        4   6 SITP
     I*
     I            DS
     I*
     I*   DATA STRUCTURES OVER SELECTION CRITERIA
     I*
     I                                        1  10 ISSUER
     I                                       11  20 CUSTMR
     I                                       21  23 BRANCH
     I                                       24  25 BOOKIN
     I                                       26  28 EXPCCY
     I                                       29  29 FACTRD
     I***********                             1  29 SELCRI                CAC005
     I                                        1  33 SELCRI                CAC005
     I                                       30  33 PRFC                  CAC005
     I            DS
     I                                        1  10 FACT
     I                                        1   5 FAC1
     I                                        6  10 FAC2
     I                                       11  20 UNFACT
     I                                       11  15 UFAC1
     I                                       16  20 UFAC2
     I            DS
     I                                        1  150ZZNOML
     I                                        1  120ZZNOMT
     I                                       13  130ZZHUND
     I*
     ICPYR@#      DS
     I*
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I*
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I/COPY ZSRSRC,ZYLDZ1
     I/COPY ZSRSRC,ZHOLI                                                  S01195
     I/COPY WNCPYSRC,SE0265I001
      *                                                                   CGL011
     I              'Collateral'          C         COLLA                 CGL011
      ** Constant field for collateral text narrative                     CGL011
      *                                                                   CGL011
      /EJECT
     C**
     C           *NAMVAR   DEFN           SESDS
     C           *NAMVAR   DEFN           LDA
     C           *NAMVAR   DEFN           JNSTAT
     C**
     C**  DEFINE OTHER LIKE FIELDS
     C**
     C************LIKE     DEFN SPOT      ZRATE1                          S01117
     C************LIKE     DEFN SPOT      ZRATE2                          S01117
     C           *LIKE     DEFN A6SPRT    ZRATE1                          S01117
     C           *LIKE     DEFN A6SPRT    ZRATE2                          S01117
     C           *LIKE     DEFN CNUM      ISSCHK
     C           *LIKE     DEFN CNUM      CUSCHK
     C           *LIKE     DEFN EXPCCY    CURCHK
     C           *LIKE     DEFN FACTRD    FACCHK
     C           *LIKE     DEFN BOOKIN    BOKCHK
     C************LIKE     DEFN CDBR      BRCCHK                          S01117
     C           *LIKE     DEFN CDPA      BRCCHK                          S01117
     C           *LIKE     DEFN CDNT      ZZAPC
     C           *LIKE     DEFN PPRC      ZZAPW
     C           *LIKE     DEFN CDNT      ZNNOMP
     C************LIKE     DEFN CTWN      ITOWN                           S01117
     C           *LIKE     DEFN BBCRTN    ITOWN                           S01117
     C           *LIKE     DEFN CDBK      SAVBK
     C************LIKE     DEFN CDBR      SAVBR                           S01117
     C           *LIKE     DEFN CDPA      SAVBR                           S01117
     C           *LIKE     DEFN CDMK      SAVMK
     C           *LIKE     DEFN CDCN      SAVCN
     C************LIKE     DEFN CRNM      ISNAME                          S01117
     C           *LIKE     DEFN BBCRNM    ISNAME                          S01117
     C           *LIKE     DEFN ISSR      LTISS
     C           KEYI      KLIST
     C                     KFLD           NMCY
     C                     KFLD           SITP
     C           KEYPT     KLIST
     C                     KFLD           PTYP    2
     C                     KFLD           SESN
     C                     KFLD           PDAT    50
     C**********           KFLD           PCST    60                                          CSD027
     C                     KFLD           PCST    6                                           CSD027
     C           KEYPTP    KLIST
     C                     KFLD           PTYP
     C                     KFLD           SESN
     C           KEYP      KLIST
     C                     KFLD           SESN
     C                     KFLD           SAVBR
     C                     KFLD           SAVMK
     C                     KFLD           SAVBK
     C                     KFLD           SAVCN
     C                     KFLD           PPRT
     C           KEYPD     KLIST
     C                     KFLD           SESN
     C                     KFLD           SAVBR
     C                     KFLD           SAVMK
     C                     KFLD           SAVBK
     C                     KFLD           SAVCN
     C                     KFLD           PPRT
     C                     KFLD           RUND
     C           KEYPP     KLIST
     C                     KFLD           SESN
     C                     KFLD           SAVBR
     C                     KFLD           SAVMK
     C                     KFLD           SAVBK
     C                     KFLD           SAVCN
     C                     KFLD           PPRT
     C                     KFLD           PRUN
     C           KEYBH     KLIST
     C                     KFLD           SESN
     C                     KFLD           SAVBR
     C                     KFLD           SAVBK
     C                     KFLD           SAVMK
     C***********          KFLD           TVVL                            S01117
     C                     KFLD           BVTVDV                          S01117
     C           KEYBP     KLIST
     C                     KFLD           SESN
     C                     KFLD           SAVBR
     C                     KFLD           SAVBK
     C                     KFLD           SAVMK
     C***********          KFLD           TVVL                            S01117
     C                     KFLD           BVTVDV                          S01117
     C                     KFLD           LPSD
      *                                                                   CGL011
     C           KEYVD     KLIST                                          CGL011
     C                     KFLD           SAVBR                           CGL011
     C                     KFLD           SESN                            CGL011
     C*                                                                   S01176
     C* Key to access Commercial Paper Prices                             S01176
     C*                                                                   S01176
     C           CPPKA     KLIST                                          S01176
     C                     KFLD           KINVT   3                       S01176
     C                     KFLD           KCCY    3                       S01176
     C*                                                                   054259
     C** Key to access SECURITY EVENTS DIARY                              054259
     C*                                                                   054259
     C           KEYSED    KLIST                                          054259
     C                     KFLD           SDSN                            054259
     C                     KFLD           SDET                            054259
     C                     KFLD           SDED                            054259
     C/COPY WNCPYSRC,SE0265C010
     C*                                                                   S01117
     C**  INITIALISE DATA AREA LDA                                        S01117
     C*                                                                   S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL*BLANK    DBLOT                           S01117
     C                     MOVELPROGRM    DBPGM                           S01117
     C                     OUT  LDA                                       S01117
     C*                                                                   S01117
     C**Key*to*access*Securities*customer*file*********************E23190 S01117
     C***********                                                  E23190 S01117
     C***********SECNM     KLIST                                   E23190 S01117
     C***********          KFLD           CNUM                     E23190 S01117
     C***********          KFLD           RCDA    1                E23190 S01117
     C**
     C**  DO FIRST CYCLE PROCESSING
     C**
     C                     EXSR FIRST
     C**
     C**  MAIN PROCESSING    -    Do until end of job requested
     C**
     C           *IN01     DOWEQ'0'
     C**
     C**    Display the screen
     C**
     C           *LIKE     DEFN ISSUER    ISSSV                           082129
     C                     MOVELISSUER    ISSSV                           082129
     C                     WRITESE0265F0
     C                     EXFMTSE0265C0
     C**
     C** Call S/R to move values into AID                                 S01179
     C*                                                                   S01179
     C                     EXSR ASCHGS                                    S01179
     C**
     C**    Clear the error messages unless HELP pressed
     C**
     C           AID       IFNE 'HP'
     C                     MOVE *BLANKS   ERMSG  79
     C                     SETOF                     414243
     C                     SETOF                     444546
     C                     SETOF                     47
     C                     MOVE *OFF      *IN62                           CAC005
     C                     END
     C**
     C**    Check Command Keys - including HELP
     C**
     C                     EXSR COMMD
     C**
     C**    If Enter has been pressed check validity of options
     C**
     C           AID       IFEQ 'RA'
     C**
     C**    Check Validity of Option Combinations
     C**
     C**  Check if selection is requested by user                         S01117
     C**  If so, process selection.                                       S01117
     C*                                                                   S01117
     C                     EXSR CHKSEL                                    S01117
     C*                                                                   S01117
     C**  If selection is requested, re-display all the input items.      S01117
     C**  Do NOT process enquiry until user confirm what is selected      S01117
     C**  is CORRECT by hitting 'ENTER' again.                            S01117
     C*                                                                   S01117
     C           @SEL      IFEQ 'N'                                       S01117
     C*                                                                   S01117
     C                     EXSR OPTION
     C                     SETOF                     51
     C**
     C           *IN42     IFEQ '0'
     C**
     C**    Check if no lower level option selected
     C**
     C           SELCRI    IFNE *BLANKS
     C                     EXSR CUSTIN
     C                     END
     C**
     C**    Lower Level Enquiry Selected
     C**
     C           OPTN      IFNE *BLANK
     C                     EXSR LINK
     C                     END
     C**
     C                     END
     C                     END
     C*                                                                   S01117
     C                     END                                            S01117
     C                     END
     C**
     C**   Return to calling program
     C**
     C                     EXSR RETSR
     C**
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**    COMMD   SR   To process Command Keys                      *
     C**                 and HELP, ROLLUP and ROLLDOWN                *
     C**                                                              *
     C**    Called  By   MAIN                                         *
     C**                                                              *
     C**    Calls   SR   ROLLUP, CLEAR, CUSSEC                        *
     C**                                                              *
     C**    Calls  PGM   MHELP                                        *
     C**                                                              *
     C*****************************************************************
     C**
     C           COMMD     BEGSR                           ** COMMD **
     C**
     C*****If*HELP*pressed*call*help*screen****
     C**
     C********** AID       IFEQ 'HP'                                      S01199
     C**********           CALL 'MHELP'                                   S01199
     C**********           PARM           PGMNO                           S01199
     C**********           PARM           HERCD 160                       S01199
     C**********           END                                            S01199
     C**
     C**    If Rollup key pressed
     C**
     C           AID       IFEQ 'UP'
     C                     EXSR ROLLUP
     C                     END
     C**
     C**    If Rolldown key pressed
     C**
     C           AID       IFEQ 'DN'
     C                     EXSR ROLLDN
     C                     END
     C**
     C**    If F3 then exit to menu - return code 1 and end
     C**
     C           AID       IFEQ '01'
     C                     MOVE '1'       RTNC
     C                     MOVE '1'       *IN01
     C                     END
     C**
     C**    If F12 then return to previous enquiry - return code 2
     C**                  unless there is no previous enquiry
     C**
     C           AID       IFEQ '02'
     C           ORIG      IFNE PGMNO
     C                     MOVE '2'       RTNC
     C                     MOVE '1'       *IN01
     C                     ELSE
     C                     MOVE '1'       *IN42
     C                     MOVE MSG,6     ERMSG
     C                     END
     C                     END
     C**
     C**    If F5 then refresh enquiry screen
     C**
     C           AID       IFEQ '05'
     C                     EXSR CLEAR
     C                     END
     C**
     C**    If F6 then call Customer Shortname Enquiry
     C**             On return check return code
     C**             if 0 then Database Error and exit required
     C**             if 1 then F3 and exit to menu required
     C**             otherwise retrieve customer or security shortname
     C**
     C           AID       IFEQ '06'
     C                     MOVE *BLANKS   ERMSG  79
     C                     SETOF                     404142
     C                     SETOF                     434445
     C                     SETOF                     4647
     C                     MOVE *OFF      *IN62                           CAC005
     C           CUSTMR    IFNE *BLANKS
     C           ISSUER    ANDNE*BLANKS
     C                     SETON                     414244
     C                     MOVE MSG,13    ERMSG
     C                     ELSE
     C           ISSUER    IFEQ *BLANKS
     C                     OUT  SESDS
     C                     OUT  LDA
     C*******************  CALL 'SE0270'                                  E19964
     C                     CALL 'SE0275'                                  E19964
     C           *LOCK     IN   LDA
     C           *LOCK     IN   SESDS
     C           RTNC      IFEQ '0'
     C           RTNC      OREQ '1'
     C                     MOVE '1'       *IN01
     C                     ELSE
     C                     MOVELRQCUST    ISSUER
     C                     MOVE *BLANKS   RQCUST
     C                     END
      *
     C                     ELSE
     C                     OUT  SESDS
     C                     OUT  LDA
     C                     CALL 'SE0270'
     C           *LOCK     IN   LDA
     C           *LOCK     IN   SESDS
     C           RTNC      IFEQ '0'
     C           RTNC      OREQ '1'
     C                     MOVE '1'       *IN01
     C                     ELSE
     C                     MOVELRQCUST    CUSTMR
     C                     MOVE *BLANKS   RQSESN
     C                     END
     C                     END
     C                     END
     C                     END
     C**
     C**     If F9 then return to initial enquiry - return code 7
     C**                   unless this is the initial program
     C**
     C           AID       IFEQ '07'
     C           ORIG      IFNE PGMNO
     C                     MOVE '7'       RTNC
     C                     MOVE '1'       *IN01
     C                     ELSE
     C                     MOVE '1'       *IN42
     C                     MOVE MSG,6     ERMSG
     C                     END
     C                     END
     C**
     C                     ENDSR
     C**
     C*****************************************************************
     C/EJECT
     C*****************************************************************
      **           ****** AS400 CONVERSION ******                     *   S01179
      **                                                              *   S01179
      ** ASCHGS S/R TO MOVE THE APPROPRIATE VALUES INTO FIELD AID,    *   S01179
      ** DEPENDING ON WHICH FUNCTION KEY HAS BEEN PRESSED.            *   S01179
      ** CALLED FROM UPDATE                                           *   S01179
      **                                                              *   S01179
     C*****************************************************************   S01179
     C*                                                                   S01179
     C           ASCHGS    BEGSR                                          S01179
     C*                                                                   S01179
     C* If ENTER pressed, the VLDCMDKEY indicator will be off             S01179
     C*                                                                   S01179
     C           *IN10     IFEQ '0'                                       S01179
     C                     MOVE 'RA'      AID                             S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F3                                                             S01179
     C*                                                                   S01179
     C           *INKC     IFEQ '1'                                       S01179
     C                     MOVE '01'      AID                             S01179
     C                     MOVE '0'       *INKC                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F5                                                             S01179
     C*                                                                   S01179
     C           *INKE     IFEQ '1'                                       S01179
     C                     MOVE '05'      AID                             S01179
     C                     MOVE '0'       *INKE                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F6                                                             S01179
     C*                                                                   S01179
     C           *INKF     IFEQ '1'                                       S01179
     C                     MOVE '06'      AID                             S01179
     C                     MOVE '0'       *INKF                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F9                                                             S01179
     C*                                                                   S01179
     C           *INKI     IFEQ '1'                                       S01179
     C                     MOVE '07'      AID                             S01179
     C                     MOVE '0'       *INKI                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F12                                                            S01179
     C*                                                                   S01179
     C           *INKL     IFEQ '1'                                       S01179
     C                     MOVE '02'      AID                             S01179
     C                     MOVE '0'       *INKL                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If ROLLUP pressed                                                 S01179
     C*                                                                   S01179
     C           *IN20     IFEQ '1'                                       S01179
     C                     MOVE 'UP'      AID                             S01179
     C                     MOVE '0'       *IN20                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If ROLLDOWN pressed                                               S01179
     C*                                                                   S01179
     C           *IN21     IFEQ '1'                                       S01179
     C******************** MOVE 'UP'      AID                     S01179  E19964
     C                     MOVE 'DN'      AID                     S01179  E19964
     C                     MOVE '0'       *IN21                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C**If*HELP*key*pressed****                                           S01179
     C*                                                                   S01179
     C********** *IN22     IFEQ '1'                                S01179 S01199
     C**********           MOVE 'HP'      AID                      S01179 S01199
     C**********           MOVE '0'       *IN22                    S01179 S01199
     C**********           END                                     S01179 S01199
     C*                                                                   S01179
     C                     ENDSR                                          S01179
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**   ROLLUP SR  When Rollup key is pressed load next page for   *
     C**              issuer or 1st page for next issuer if group sel *
     C**              If end of issuer/group display error message.   *
     C**                                                              *
     C**   Called by  COMMD                                           *
     C**                                                              *
     C**   Calls  SR  DISP                                            *
     C**                                                              *
     C*****************************************************************
     C**
     C           ROLLUP    BEGSR                           ** ROLLUP **
     C**
     C** If details complete then Rollup is beyond last record.
     C**
     C           *IN05     IFEQ '1'
     C           *IN60     ANDEQ'0'
     C                     MOVE '1'       *IN06
     C                     ELSE
     C**
     C** If details complete for issuer & group selected -
     C** clear SFL and load 1st page for next issuer
     C**
     C           *IN60     IFEQ '1'
     C           *IN05     ANDEQ'1'
     C***********          Z-ADDISSCHK    LTISS                           S01117
     C                     MOVE ISSCHK    LTISS                           S01117
     C                     SETON                     03
     C           PACUSR    TAG                             *** PACUSR  ***
     C***********          READ PACUS                    25               S01117
     C                     READ SDCUSTL4                 25               S01117
     C           *IN25     IFEQ '0'
     C***********CPAR      ANDEQPARENT                                    S01117
     C***********CNUM      CABEQCPAR      PACUSR                          S01117
     C           BBPCNB    ANDEQSPAREN                                    S01117
     C           CNUM      CABEQBBPCNB    PACUSR                          S01117
     C***********          Z-ADDCNUM      CUSTNO  60                      S01117
     C**********           MOVE CNUM      CUSTNO  60                                   S01117 CSD027
     C                     MOVE CNUM      CUSTNO  6                                           CSD027
     C**
     C***Get*Clintcb*for*new*issuer************************************   S01117
     C***********                                                         S01117
     C***********CUSTNO    CHAINCLINTCBF             25                   S01117
     C************IN25     IFEQ '0'                                       S01117
     C***********RECI      IFEQ '*'                                       S01117
     C***********          SETON                     25                   S01117
     C***********          END                                            S01117
     C***********          END                                            S01117
     C************IN25     IFEQ '1'                                       S01117
     C**                                                                  S01117
     C** Get SDCUSTPD for new issuer                                      S01117
     C**                                                                  S01117
     C                     MOVELCUSTNO    KEY1   10                       S01117
     C*                                                                   S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @KEY    7                       S01117
     C                     PARM KEY1      @KEY1  10                       S01117
     C                     PARM           @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C*                                                                   S01117
     C***********          MOVELPROGRM    DBPGM            ************   S01117
     C***********          MOVELCUSTNO    DBKEY            * DATABASE *   S01117
     C***********          MOVE 'CLINT'   DBFILE           **ERROR*09**   E20651
     C***********          Z-ADD09        DBASE            ************   E20651
     C***********          MOVE 'CLINT'   DBFILE           **ERR   E20651 S01117
     C***********          Z-ADD10        DBASE            *****   E20651 S01117
     C***********          SETON                       U7U8               S01117
     C***********          MOVE '0'       RTNC                            S01117
     C***********          EXSR RETSR                                     S01117
     C***********          ELSE                                           S01117
     C                     MOVE BBCUST    CNUM                            S01117
     C***********          Z-ADDCNUM      ISSCHK                          S01117
     C                     MOVE CNUM      ISSCHK                          S01117
     C***********          MOVE CRNM      ISNAME                          S01117
     C***********          MOVE CTWN      ITOWN                           S01117
     C                     MOVE BBCRNM    ISNAME                          S01117
     C                     MOVE BBCRTN    ITOWN                           S01117
     C                     MOVE ISSCHK    SISNO
     C***********          MOVE CRNM      SIRNM                           S01117
     C***********          MOVE CTWN      SIRTN                           S01117
     C                     MOVE BBCRNM    SIRNM                           S01117
     C                     MOVE BBCRTN    SIRTN                           S01117
     C***********          END                                            S01117
     C                     SETON                     02
     C                     WRITESE0265C0
     C                     SETOF                     020405
     C                     SETOF                     81
     C                     Z-ADD0         SFLREC
     C                     Z-ADD0         TOP
     C**
     C**   Position SECTY at start of required ISSUER
     C**
     C***********ISSCHK    SETLLSECTI                                     S01117
     C**********           MOVE ISSCHK    @TCHK   60                                   S01117 CSD027
     C                     MOVE ISSCHK    @TCHK   6                                           CSD027
     C           @TCHK     SETLLSECTI                                     S01117
     C**
     C                     EXSR DISP
     C                     ELSE
     C                     SETON                     0506
     C                     SETOF                     03
     C                     Z-ADD1         SFLREC
     C                     END
     C                     ELSE
     C**
     C** Otherwise load next page for same issuer
     C**
     C                     Z-ADDTOP       SFLREC
     C                     EXSR DISP
     C                     END
     C                     END
     C**
     C                     ENDSR
     C/EJECT
     C**
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C**                                                              *
     C**   ROLLDN   SUBROUTINE                                        *
     C**                                                              *
     C**   Called by  COMMD                                           *
     C**                                                              *
     C**   Calls  SR  SUBFIL                                          *
     C**                                                              *
     C*****************************************************************
     C**
     C           ROLLDN    BEGSR                              ** ROLLDN
     C**
     C**  IF NO PREVIOUS KEY ROLLDOWN IS BEYOND last record
     C**
     C********** LTISS     IFEQ 0                                                             CSD027
     C           LTISS     IFEQ *BLANKS                                                       CSD027
     C******************** SETON                     0506                 E19964
     C                     SETON                     06                   E19964
     C                     Z-ADD1         SFLREC
     C                     ELSE
     C**
     C**  Else reset file to previous set & refill SFL
     C**
     C                     SETON                     02
     C                     WRITESE0265C0
     C                     SETOF                     0281
     C                     SETOF                     0405
     C                     SETON                     03
     C                     Z-ADD0         SFLREC
     C                     Z-ADD0         TOP
     C           LTISS     SETLLSECTI
     C***********          Z-ADDLTISS     ISSCHK                          S01117
     C                     MOVE LTISS     ISSCHK                          S01117
     C**
     C** Get previous issuer if roll down again
     C** (NB if parent in middle will give diff order from rollup)
     C**
     C***********          READPPACUS                    25               S01117
     C***********          READPPACUS                    25               S01117
     C                     READPSDCUSTL4                 25               S01117
     C                     READPSDCUSTL4                 25               S01117
     C           *IN25     IFEQ '1'
     C***********PARENT    SETLLPACUS                                     S01117
     C           SPAREN    SETLLSDCUSTL4                                  S01117
     C**********           Z-ADD0         LTISS                                               CSD027
     C                     MOVE *BLANKS   LTISS                                               CSD027
     C                     END
     C           *IN25     IFEQ '0'
     C***********CPAR      ANDEQPARENT                                    S01117
     C           BBPCNB    ANDEQSPAREN                                    S01117
     C***********          Z-ADDCNUM      LTISS                           S01117
     C                     MOVE CNUM      LTISS                           S01117
     C                     ELSE
     C**********           Z-ADD0         LTISS                                               CSD027
     C                     MOVE *BLANKS   LTISS                                               CSD027
     C                     END
     C***********          READ PACUS                    25               S01117
     C                     READ SDCUSTL4                 25               S01117
     C*
     C***Get*Clintcb*for*new*issuer***************************************S01117
     C***********                                                         S01117
     C***********ISSCHK    CHAINCLINTCBF             25                   S01117
     C************IN25     IFEQ '0'                                       S01117
     C***********RECI      IFEQ '*'                                       S01117
     C***********          SETON                     25                   S01117
     C***********          END                                            S01117
     C***********          END                                            S01117
     C************IN25     IFEQ '1'                                       S01117
     C**                                                                  S01117
     C** Get SDCUSTPD for new issuer                                      S01117
     C*                                                                   S01117
     C                     MOVELISSCHK    KEY1   10                       S01117
     C*                                                                   S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @KEY    7                       S01117
     C                     PARM KEY1      @KEY1  10                       S01117
     C                     PARM           @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C*                                                                   S01117
     C***********          MOVELPROGRM    DBPGM            ************   S01117
     C***********          MOVELISSCHK    DBKEY            * DATABASE *   S01117
     C**********           MOVE 'CLINT'   DBFILE           **ERROR*09**   E20651
     C**********           Z-ADD09        DBASE            ************   E20651
     C***********          MOVE 'CLINT'   DBFILE           * ERROR 1E20651S01117
     C***********          Z-ADD11        DBASE            *********E20651S01117
     C***********          SETON                       U7U8               S01117
     C***********          MOVE '0'       RTNC                            S01117
     C***********          EXSR RETSR                                     S01117
     C***********          ELSE                                           S01117
     C                     MOVE BBCUST    CNUM                            S01117
     C***********          MOVE CRNM      ISNAME                          S01117
     C***********          MOVE CTWN      ITOWN                           S01117
     C                     MOVE BBCRNM    ISNAME                          S01117
     C                     MOVE BBCRTN    ITOWN                           S01117
     C                     MOVE ISSCHK    SISNO
     C***********          MOVE CRNM      SIRNM                           S01117
     C***********          MOVE CTWN      SIRTN                           S01117
     C                     MOVE BBCRNM    SIRNM                           S01117
     C                     MOVE BBCRTN    SIRTN                           S01117
     C**
     C                     EXSR DISP
     C***********          END                                            S01117
     C                     END
     C**
     C                     ENDSR                                        **
     C**
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**   OPTION SR  To check validity of option combinations        *
     C**                                                              *
     C**   Called by  MAIN                                            *
     C**                                                              *
     C**   Calls  SR  none                                            *
     C**                                                              *
     C*****************************************************************
     C**
     C           OPTION    BEGSR                            ** OPTION *
     C**
     C                     MOVE *BLANKS   OPTN
     C**
     C**     If no subfile records the only possible entry is issuer
     C**
     C           *IN03     IFEQ '1'
     C**
     C           ISSUER    IFEQ *BLANKS
     C                     MOVE '1'       *IN42
     C                     MOVE MSG,1     ERMSG
     C                     END
     C**
     C                     ELSE
     C**
     C                     READCSE0265S0                 40
     C**
     C** Ensure that changed Subfile Record is not blank before processingE28729
     C**                                                                  E28729
     C           *IN40     DOWEQ'0'                                       E28729
     C           SELECT    ANDEQ*BLANK                                    E28729
     C                     READCSE0265S0                 40               E28729
     C                     END                                            E28729
     C**                                                                  E28729
     C**     Check if any entry made
     C**
     C           *IN40     IFEQ '1'
     C           SELCRI    ANDEQ*BLANKS
     C                     MOVE '1'       *IN42
     C                     MOVE MSG,7     ERMSG
     C                     END
     C**
     C           SELECT    IFEQ '2'
     C           STDBK     ANDNE*BLANKS
     C                     MOVE '1'       *IN42
     C                     MOVE MSG,14    ERMSG
     C                     END
     C           SELECT    IFEQ '3'
     C********** SPCTN     ANDNE*ZEROS                                                        CSD027
     C           SPCTN     ANDNE*BLANKS                                                       CSD027
     C                     MOVE '1'       *IN42
     C                     MOVE MSG,15    ERMSG
     C                     END
     C**
     C**     Check if both issuer and option entered
     C**     Note - it is not an error unless issuer has been changed     082129
     C**
     C           *IN40     IFEQ '0'
     C           ISSUER    ANDNE*BLANKS
     C           ISSUER    ANDNEISSSV                                     082129
     C                     MOVE '1'       *IN42
     C                     MOVE '1'       *IN41
     C                     MOVE MSG,2     ERMSG
     C                     END
     C**
     C**    Check if more than one option entered
     C**
     C           *IN40     IFEQ '0'
     C                     MOVE SELECT    OPTN
     C                     MOVE STDBK     RQBOOK
     C                     MOVELSPCTN     RQCUST
     C***********          MOVE STDBR     RQBRCH                          S01117
     C                     MOVE STDBR     RQBRCA                          S01117
     C                     MOVE SSESN     RQSESN
     C                     MOVE *BLANK    SELECT
     C                     MOVE '0'       *IN08
     C                     UPDATSE0265S0
     C**
     C           *IN40     DOUEQ'1'
     C                     READCSE0265S0                 40
     C           *IN40     IFEQ '0'
     C           SELECT    ANDNE*BLANK                                    E28729
     C                     MOVE *BLANK    SELECT
     C                     MOVE '0'       *IN08
     C                     UPDATSE0265S0
     C                     MOVE '1'       *IN42
     C                     MOVE MSG,3     ERMSG
     C                     END
     C**
     C                     END
     C                     END
     C                     END
     C**
     C                     ENDSR
     C**
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**   CUSTIN SR  To process entered Selection fields             *
     C**                                                              *
     C**   Called by  MAIN, FIRST                                     *
     C**                                                              *
     C**   Calls  SR  SETUP                                           *
     C**                                                              *
     C*****************************************************************
     C**
     C           CUSTIN    BEGSR                            ** CUSTIN *
     C**
     C                     SETOF                     414243
     C                     SETOF                     444546
     C                     SETOF                     47
     C                     MOVE *OFF      *IN62                           CAC005
     C                     MOVE *BLANKS   CURCHK
     C                     MOVE *BLANKS   FACCHK
     C                     MOVE *BLANKS   BOKCHK
     C***********          Z-ADD0         BRCCHK                          S01117
     C                     MOVE *BLANKS   BRCCHK                          S01117
     C***********          Z-ADD0         CUSCHK                          S01117
     C**********           MOVE *ZERO     CUSCHK                                       S01117 CSD027
     C                     MOVE *BLANKS   CUSCHK                                              CSD027
     C**
     C***Access*issuer*record*-**(SNAME*or*CLINT)*************************S01117
     C*******error*if*not*on*file*or*deleted******************************S01117
     C***********                                                         S01117
     C***********          MOVE ISSUER    CUSTWK                          S01117
     C***********          SETOF                     2930                 S01117
     C***********                                                         S01117
0389 C***CHECK*TO*SEE*IF*MORE*THAN*6*CHARS*ENTERED************************S01117
     C***********                                                         S01117
0390 C***********SCSNMB    IFNE *BLANK                                    S01117
     C***********          MOVE '1'       *IN29                           S01117
     C***********          END                                            S01117
     C***********                                                         S01117
0392 C***IF*NOT*MORE*THAN*6*CHARS,*CHECK*FIRST*6*CHARS*NUMERIC************S01117
     C***********                                                         S01117
0390 C************IN29     IFEQ '0'                                       S01117
     C***********          MOVE *BLANKS   ZFIELD                          S01117
     C***********          MOVELSCSNMA    ZFIELD                          S01117
     C***********          Z-ADD*ZEROS    ZADEC                           S01117
     C***********          Z-ADD6         ZADIG                           S01117
     C***********          EXSR ZALIGN                                    S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          SETON                     29                   S01117
     C***********          ELSE                                           S01117
     C***********          SETON                     30                   S01117
     C***********          END                                            S01117
0390 C***********          END                                            S01117
     C***********                                                         S01117
0397 C*****IF*S/NAME*GET*CLINT*REC.***************************************S01117
     C***********                                                         S01117
0390 C************IN29     IFEQ '1'                                       S01117
0399 C***********ISSUER    CHAINSNAME                42                   S01117
     C**N42******RECI      COMP 'D'                  4242                 S01117
     C***********          END                                            S01117
     C***********                                                         S01117
0410 C*****IF*CUST*NO.*-*CHECK*IT*EXISTS*ON*CLINT*************************S01117
     C***********                                                         S01117
0390 C************IN30     IFEQ '1'                                       S01117
0413 C***********          MOVE SCSNMA    CNUM                            S01117
0414 C***********CNUM      CHAINCLINT                42                   S01117
     C**N42******RECI      COMP 'D'                  4242                 S01117
     C***********          END                                            S01117
     C*                                                                   S01117
     C** Access Issuer record                                             S01117
     C*                                                                   S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANK    @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM ISSUER    @KEY1  10                       S01117
     C                     PARM           @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C*                                                                   S01117
     C************IN42     IFEQ '1'                                       S01117
     C           @RTCD     IFNE *BLANK                                    S01117
     C                     SETON                     4142
     C                     MOVE MSG,5     ERMSG
     C                     GOTO ECUSSE
     C                     ELSE
     C                     MOVE BBCUST    CNUM                            S01117
     C***********          Z-ADDCNUM      ISSCHK                          S01117
     C                     MOVE CNUM      ISSCHK                          S01117
     C***********          MOVE CRNM      ISNAME                          S01117
     C***********          MOVE CTWN      ITOWN                           S01117
     C                     MOVE BBCRNM    ISNAME                          S01117
     C                     MOVE BBCRTN    ITOWN                           S01117
     C                     END
     C**
     C***Access*customer*record*-**(SNAME*or*CLINT)***********************S01117
     C*******error*if*not*on*file*or*deleted******************************S01117
     C***********                                                         S01117
     C***********CUSTMR    IFNE *BLANKS                                   S01117
     C***********          MOVE CUSTMR    CUSTWK                          S01117
     C***********          SETOF                     2930                 S01117
     C***********          SETOF                     29                   S01117
     C***********                                                         S01117
0389 C***CHECK*TO*SEE*IF*MORE*THAN*6*CHARS*ENTERED*********************   S01117
     C***********                                                         S01117
0390 C***********SCSNMB    IFNE *BLANK                                    S01117
     C***********          MOVE '1'       *IN29                           S01117
     C***********          END                                            S01117
     C*****************************************************************   S01117
0392 C***IF*NOT*MORE*THAN*6*CHARS,*CHECK*FIRST*6*CHARS*NUMERIC************S01117
     C***********                                                         S01117
0390 C************IN29     IFEQ '0'                                       S01117
     C***********          MOVE *BLANKS   ZFIELD                          S01117
     C***********          MOVELSCSNMA    ZFIELD                          S01117
     C***********          Z-ADD*ZEROS    ZADEC                           S01117
     C***********          Z-ADD6         ZADIG                           S01117
     C***********          EXSR ZALIGN                                    S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          SETON                     29                   S01117
     C***********          ELSE                                           S01117
     C***********          SETON                     30                   S01117
     C***********          END                                            S01117
0390 C***********          END                                            S01117
     C*****************************************************************   S01117
0397 C*****IF*S/NAME*GET*CLINT*REC.************************************   S01117
     C**
0390 C************IN29     IFEQ '1'                                       S01117
0399 C***********CUSTMR    CHAINSNAME                42                   S01117
     C**N42******RECI      COMP 'D'                  4242                 S01117
     C***********          MOVE '1'       RCDA                      E23190S01117
     C***********          END                                            S01117
     C**
0410 C*****IF*CUST*NO.*-*CHECK*IT*EXISTS*ON*CLINT*************************S01117
     C***********                                                         S01117
0390 C************IN30     IFEQ '1'                                       S01117
0413 C***********          MOVE SCSNMA    CNUM                            S01117
     C***********          MOVE '1'       RCDA                      E23190S01117
     C***********          END                                      E23190S01117
     C**Must*obtain*classification*details*from*security*customer***E23190S01117
     C**record*to*find*out*whether*portfolio*customer*or*not.*******E23190S01117
0414 C***********SECNM     CHAINCLINT                42             E23190S01117
     C**N42******RECI      COMP 'D'                  4242                 S01117
     C*********************END                                      E23190S01117
     C*                                                                   S01117
     C**  ACCESS CUSTOMER INFORMATION IF IT IS ENTERED                    S01117
     C*                                                                   S01117
     C           CUSTMR    IFNE *BLANKS                                   S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANK    @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM CUSTMR    @KEY1  10                       S01117
     C                     PARM           @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   AENB    6                       S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVE BBCUST    AENB                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** IF CUSTOMER IS NOT A SECURITIES CUSTOMER, DO NOT OBTAIN DETAILS  S01117
     C*                                                                   S01117
     C                     CALL 'AOSECSR0'                                S01117
     C                     PARM *BLANK    @RTCD   7                       S01117
     C                     PARM '*KEY   ' @KEY    7                       S01117
     C                     PARM AENB      @AENB   6                       S01117
     C           SDSECS    PARM SDSECS    DSFDY                           S01117
     C*                                                                   S01117
     C************IN42     IFEQ '1'                                       S01117
     C           @RTCD     IFNE *BLANK                                    S01117
     C                     SETON                     4442
     C                     MOVE MSG,9     ERMSG
     C                     GOTO ECUSSE
     C                     ELSE
     C*                                                                   S01117
     C                     MOVE BFCUST    CNUM                            S01117
     C*                                                                   S01117
     C** IF CUSTOMER NOT A PORTFOLIO CUSTOMER, DO NOT OBTAIN DETAILS      E23190
     C*                                                                   S01117
     C***********C1DI      IFEQ 'S'                                 E23190S01117
     C***********C1DI      OREQ 'D'                                 E23190S01117
     C           BFCLAS    IFEQ 'S'                                       S01117
     C           BFCLAS    OREQ 'D'                                       S01117
     C***********          Z-ADDCNUM      CUSCHK                          S01117
     C                     MOVE CNUM      CUSCHK                          S01117
     C                     ELSE                                           E23190
     C                     SETON                     4442                 E23190
     C                     MOVE MSG,16    ERMSG                           E23190
     C                     GOTO ECUSSE                                    E23190
     C                     END                                            E23190
     C*                                                                   E23190
     C                     END
     C                     END
     C*
     C**If*no*Branch*entered,*use*default*from*TABICD*file****************S01117
     C* If no Branch entered, use default from ZMUSER Data Area           S01117
     C*
     C           BRANCH    IFEQ '   '
     C***********BRANCH    OREQ '000'                                     S01117
     C***********          MOVELDSTB      BRANCH                          S01117
     C                     MOVELUSRBCH    BRANCH                          S01117
     C                     END
     C*                                                                   054258
     C           BRANCH    IFEQ 'ALL'                                     054258
     C           BKLAUT    ANDNE'Y'                                       054258
     C                     SETON                     4243                 054258
     C                     MOVE MSG,19    ERMSG                           054258
     C                     GOTO ECUSSE                                    054258
     C                     END                                            054258
     C**
     C** If multibranch environment -
     C** If branch entered - Access Branch Details file thru A.O.         S01117
     C**   - error if not on file or no branch code selected.             S01117
     C***If*branch*entered*-*Access*Branch*table*record*-*****************S01117
     C*******error*if*not*on*file*or*deleted******************************S01117
     C**
     C           *IN07     IFEQ '1'
     C           BRANCH    ANDNE'ALL'                                     054258
     C*          BRANCH    ANDNE*BLANKS
     C***********          MOVE *BLANKS   KEY    12                       S01117
     C***********          MOVEL'10'      KEY                             S01117
     C***********          MOVE BRANCH    KEY                             S01117
     C***********KEY       CHAINTABLETRF             25                   S01117
     C************IN25     IFEQ '0'                                       S01117
     C***********RECI      IFEQ '*'                                       S01117
     C***********          SETON                     25                   S01117
     C***********          END                                            S01117
     C***********          END                                            S01117
     C************IN25     IFEQ '1'                                       S01117
     C*                                                                   S01117
     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANK    @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM BRANCH    @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01117              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01117
     C** IF ERROR, CHECK WHICH TYPE OF ERROR                              S01117
     C           @RTCD     IFNE *BLANK                                    S01117
     C                     SETON                     4243
     C                     MOVE MSG,8     ERMSG
     C                     GOTO ECUSSE
     C                     ELSE                                           S01117
     C                     MOVE A8BRCD    BRANCH                          S01117
     C                     END
     C***********          END                                            E37221
     C*                                                                   S01117
     C** CHECK WHETHER THE USER IS AUTHORISED TO THE BRANCH               S01117
      ***  (Only if Multibranch environment).                             E37221
     C*                                                                   S01117
     C                     CALL 'ZVBBU'                                   S01117
     C                     PARM BRANCH    @ZBRCA  3                       S01117
     C                     PARM           @ERR    10                      S01117
     C           @ERR      IFEQ 1                                         S01117
     C                     SETON                     4243                 S01117
     C                     MOVE MSG,18    ERMSG                           S01117
     C                     GOTO ECUSSE                                    S01117
     C                     END                                            S01117
     C           @ERR      IFEQ 2                                         S01117
     C                     SETON                     4243                 S01117
     C                     MOVE MSG,17    ERMSG                           S01117
     C                     GOTO ECUSSE                                    S01117
     C                     END                                            S01117
      *                                                                   E37221
     C                     END                                            E37221
     C**
     C** If book   entered - Access Book file record -
     C**     error if not on file or deleted
     C**
     C           BOOKIN    IFNE *BLANKS
     C***********BOOKIN    CHAINBOOKD                25                   S01117
     C************IN25     IFEQ '0'                                       S01117
     C***********RECI      IFEQ '*'                                       S01117
     C***********          SETON                     25                   S01117
     C***********          END                                            S01117
     C***********          END                                            S01117
     C************IN25     IFEQ '1'                                       S01117
     C                     CALL 'AOBOOKR0'                                S01117
     C                     PARM *BLANK    @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM BOOKIN    @BKCD   3                       S01117
     C           SDBOOK    PARM SDBOOK    DSFDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     SETON                     4245
     C                     MOVE MSG,10    ERMSG
     C                     GOTO ECUSSE
     C                     END
     C                     END
      *                                                                   CAC005
      ** Validate Profit Centre                                           CAC005
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
      *                                                                   CAC005
      ** If Screen-criteria-book code is blank and screen-criteria        CAC005
      ** profit centre is not blank                                       CAC005
      *                                                                   CAC005
     C           BOOKIN    IFEQ *BLANKS                                   CAC005
     C           PRFC      ANDNE*BLANKS                                   CAC005
     C                     MOVE *ON       *IN42                           CAC005
     C                     MOVE *ON       *IN62                           CAC005
     C                     MOVE MSG,20    ERMSG                           CAC005
     C                     GOTO ECUSSE                                    CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
      ** If screen-criteria-book code is non-blank and screen-criteria    CAC005
      ** profit centre is blank                                           CAC005
      *                                                                   CAC005
     C           BOOKIN    IFNE *BLANKS                                   CAC005
     C           PRFC      ANDEQ*BLANKS                                   CAC005
     C                     MOVE *ON       *IN42                           CAC005
     C                     MOVE *ON       *IN62                           CAC005
     C                     MOVE MSG,21    ERMSG                           CAC005
     C                     GOTO ECUSSE                                    CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
      ** If screen-criteria-profit centre si non-blank                    CAC005
      *                                                                   CAC005
     C           PRFC      IFNE *BLANKS                                   CAC005
     C                     CALL 'AOPRFCR0'                                CAC005
     C                     PARM *BLANKS   PRTCD                           CAC005
     C                     PARM '*VERIFY' POPTN                           CAC005
     C                     PARM PRFC      PPCCD   4                       CAC005
     C           SDPRFC    PARM SDPRFC    DSFDY                           CAC005
      *                                                                   CAC005
     C           PRTCD     IFNE *BLANKS                                   CAC005
     C                     MOVE *ON       *IN42                           CAC005
     C                     MOVE *ON       *IN62                           CAC005
     C                     MOVE MSG,22    ERMSG                           CAC005
     C                     GOTO ECUSSE                                    CAC005
     C                     ENDIF                                          CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
      ** If both screen-criteria-book code and screen-criteria-profit     CAC005
      ** centre are non-blank                                             CAC005
      *                                                                   CAC005
     C           BOOKIN    IFNE *BLANKS                                   CAC005
     C           PRFC      ANDNE*BLANKS                                   CAC005
     C                     CALL 'AOBKPCR0'                                CAC005
     C                     PARM *BLANKS   PRTCD                           CAC005
     C                     PARM '*PSEUDO' POPTN                           CAC005
     C                     PARM BOOKIN    PBKCD   2                       CAC005
     C                     PARM PRFC      PPRFC   4                       CAC005
     C                     PARM           PPSBK   2                       CAC005
      *                                                                   CAC005
     C           PRTCD     IFNE *BLANKS                                   CAC005
     C                     MOVE *ON       *IN42                           CAC005
     C                     MOVE *ON       *IN62                           CAC005
     C                     MOVE MSG,23    ERMSG                           CAC005
     C                     GOTO ECUSSE                                    CAC005
     C                     ENDIF                                          CAC005
     C                     ENDIF                                          CAC005
     C                     ENDIF                                          CAC005
     C**
     C***If*currency*entered*-*Access*currency*table*record*-*************S01117
     C*******error*if*not*on*file*or*deleted******************************S01117
     C** If currency entered - Access currency thru Access Object         S01117
     C**     error if no currency selected or invalid currency            S01117
     C**
     C           EXPCCY    IFNE *BLANKS
     C***********          MOVEL'20      'TKEY   12                       S01117
     C***********          MOVELEXPCCY    ZWK4    4                       S01117
     C***********          MOVE 1         ZWK4                            S01117
     C***********          MOVE ZWK4      TKEY                            S01117
     C***********TKEY      CHAINTABTG10F             25                   S01117
     C************IN25     IFEQ '0'                                       S01117
     C***********RECI      IFEQ '*'                                       S01117
     C***********          SETON                     25                   S01117
     C***********          END                                            S01117
     C***********          END                                            S01117
     C************IN25     IFEQ '1'                                       S01117
     C*                                                                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM *BLANK    @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM EXPCCY    @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANK                                    S01117
     C                     SETON                     4246
     C                     MOVE MSG,11    ERMSG
     C                     GOTO ECUSSE
     C                     ELSE
     C***********          Z-ADDSPOT      ZRATE2                          S01117
     C                     Z-ADDA6SPRT    ZRATE2                          S01117
     C***********MDIN      IFEQ 0                                         S01117
     C           A6MDIN    IFEQ 'D'                                       S01117
     C                     MOVE 'D'       ZMDI2   1
     C                     ELSE
     C                     MOVE 'M'       ZMDI2
     C                     END
     C                     END
     C                     END
     C**
     C** If factored entered - check it is F or U
     C**     error if not
     C**
     C           FACTRD    IFNE *BLANKS
     C           FACTRD    IFNE 'U'
     C           FACTRD    ANDNE'F'
     C                     SETON                     4247
     C                     MOVE MSG,12    ERMSG
     C                     GOTO ECUSSE
     C                     END
     C                     END
     C**
     C** All fields valid - prepare to display details -
     C**
     C                     EXSR SETUP
     C**
     C           ECUSSE    TAG                             ** ECUSSE TAG**
     C                     ENDSR
     C*****************************************************************
     C/EJECT                                                              S01117
     C*****************************************************************   S01117
     C**   CHKSEL SR  To check and process all the fields that are    *   S01117
     C**              requested to provide a selection list           *   S01117
     C**                                                              *   S01117
     C**   Called by  CUSTIN                                          *   S01117
     C**                                                              *   S01117
     C*****************************************************************   S01117
     C**                                                                  S01117
     C           CHKSEL    BEGSR                                          S01117
     C*                                                                   S01117
     C                     MOVE 'N'       @SEL    1                       S01117
     C*                                                                   S01117
     C** If the first character of the Issuer input field = '?'           S01117
     C** call selection for Midas customer.                               S01117
     C*                                                                   S01117
     C                     MOVELISSUER    @FCHR   1                       S01117
     C           @FCHR     IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANK    @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM ISSUER    @KEY1  10                       S01117
     C                     PARM           @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   ISSUER                          S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVELBBCUST    ISSUER                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** If the first character of the Customer input field = '?'         S01117
     C** call selection for securities customer only.                     S01117
     C*                                                                   S01117
     C                     MOVELCUSTMR    @FCHR   1                       S01117
     C           @FCHR     IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     MOVELCUSTMR    AENB    6                       S01117
     C                     CALL 'AOSECSR0'                                S01117
     C                     PARM *BLANK    @RTCD   7                       S01117
     C                     PARM '*KEY   ' @KEY    7                       S01117
     C                     PARM AENB      @AENB   6                       S01117
     C           SDSECS    PARM SDSECS    DSFDY                           S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   CUSTMR                          S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVELBFCUST    CUSTMR                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** If the first character of the Branch input field = '?'           S01117
     C** call selection for Branch.                                       S01117
     C*                                                                   S01117
     C                     MOVELBRANCH    @FCHR   1                       S01117
     C           @FCHR     IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANK    @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM BRANCH    @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01117              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01117
     C                     MOVEL*BLANKS   BRANCH                          S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVE A8BRCD    BRANCH                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** If the first character of the Book input field = '?'             S01117
     C** call selection for Book records.                                 S01117
     C*                                                                   S01117
     C                     MOVELBOOKIN    @FCHR   1                       S01117
     C           @FCHR     IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     CALL 'AOBOOKR0'                                S01117
     C                     PARM *BLANK    @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM BOOKIN    @BKCD   3                       S01117
     C           SDBOOK    PARM SDBOOK    DSFDY                           S01117
     C*                                                                   S01117
     C                     MOVEL*BLANKS   BOOKIN                          S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVE BDBKCD    BOOKIN                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                                            S01117
      *                                                                   CAC005
      ** If the firtst character of the profit centre input field is      CAC005
      ** '?' call selection for profit centre                             CAC005
      *                                                                   CAC005
     C                     MOVELPRFC      @FCHR                           CAC005
     C           @FCHR     IFEQ '?'                                       CAC005
     C                     MOVE 'Y'       @SEL                            CAC005
     C                     CALL 'AOPRFCR0'                                CAC005
     C                     PARM *BLANK    PRTCD                           CAC005
     C                     PARM '*KEY   ' POPTN                           CAC005
     C                     PARM PRFC      PPCCD                           CAC005
     C           SDPRFC    PARM SDPRFC    DSFDY                           CAC005
     C*                                                                   CAC005
     C                     MOVEL*BLANKS   PRFC                            CAC005
     C           PRTCD     IFEQ *BLANKS                                   CAC005
     C                     MOVE DSPCCD    PRFC                            CAC005
     C                     END                                            CAC005
     C                     END                                            CAC005
     C*                                                                   S01117
     C** If the first character of the Currency input field = '?'         S01117
     C** call selection for Currency Code.                                S01117
     C*                                                                   S01117
     C                     MOVELEXPCCY    @FCHR   1                       S01117
     C           @FCHR     IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM *BLANK    @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM EXPCCY    @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   EXPCCY                          S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVE A6CYCD    EXPCCY                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C*****************************************************************   S01117
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**   DISP   SR  Accumulate details for screen display           *
     C**                                                              *
     C**   Called by  SETUP, ROLLUP                                   *
     C**                                                              *
     C**   Calls  SR  SUBFIL , SECFIL                                 *
     C**                                                              *
     C*****************************************************************
     C**
     C           DISP      BEGSR                           *** DISP ***
     C**
     C                     Z-ADD0         OUTREC  20
     C                     MOVE '0'       *IN89
     C**
     C**  IF STILL PROCESSING SFL RECS - GOTO S/R
     C**
     C           *IN51     IFEQ '1'
     C                     EXSR PROCES
     C           OUTREC    IFEQ 14
     C                     SETON                     89
     C                     END
     C                     END
     C**
     C           *IN89     DOWEQ'0'
     C           *IN51     ANDEQ'0'
     C**
     C           *IN81     IFEQ '0'
     C                     READ SECTI                    81
     C                     END
     C**
     C**  End of File -
     C**
     C           *IN81     IFEQ '1'
     C                     SETON                     0589
     C                     END
     C**
     C**  Successful file read of an active record
     C**
     C           *IN81     IFEQ '0'
     C           RECI      IFEQ 'D'
     C**
     C**  If not correct issuer STOP
     C**
     C**********           MOVE ISSCHK    @TCHK   60                                   S01117 CSD027
     C                     MOVE ISSCHK    @TCHK   6                                           CSD027
     C***********ISSCHK    IFNE ISSR                                      S01117
     C           @TCHK     IFNE ISSR                                      S01117
     C                     SETON                     818905
     C**
     C                     ELSE
     C**                                                                  S01232
     C**  Indicate whether an Australian Yield traded security.           S01232
     C**                                                                  S01232
     C           STBS      IFEQ 'Y'                                       S01232
     C           SYBS      ANDEQ'AU'                                      S01232
     C                     SETON                     52                   S01232
     C**                                                                  S01232
     C**     Nominal ccy decimal places                                   S01232
     C***********                                                  S01232 S01117
     C***********          MOVEL'20      'TKEY   12                S01232 S01117
     C***********          MOVELNMCY      ZWK4    4                S01232 S01117
     C***********          MOVE 1         ZWK4                     S01232 S01117
     C***********          MOVE ZWK4      TKEY                     S01232 S01117
     C***********TKEY      CHAINTABTG10F             25            S01232 S01117
     C************IN25     IFEQ '0'                                S01232 S01117
     C***********RECI      IFEQ '*'                                S01232 S01117
     C***********          SETON                     25            S01232 S01117
     C***********          END                                     S01232 S01117
     C***********          END                                     S01232 S01117
     C*                                                                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM NMCY      @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C*                                                                   S01117
     C************IN25     IFEQ '1'                                S01232 S01117
     C***********          MOVELPROGRM    DBPGM            ********S01232 S01117
     C***********          MOVELTKEY      DBKEY            **DATAB*S01232 S01117
     C***********          MOVE 'TG10 '   DBFILE           **ERROR*S01232 S01117
     C***********          Z-ADD12        DBASE            ********S01232 S01117
     C***********          SETON                       U7U8        S01232 S01117
     C***********          MOVE '0'       RTNC                     S01232 S01117
     C***********          EXSR RETSR                              S01232 S01117
     C***********          ELSE                                    S01232 S01117
     C***********          Z-ADDCDP       NCDP                     S01232 S01117
     C                     Z-ADDA6NBDP    NCDP                            S01117
     C***********          END                                            S01232
     C                     ELSE                                           S01232
     C                     SETOF                     52                   S01232
     C                     END                                            S01232
     C**
     C**  SETLL on C/UDEPS files to see if there are any recs-
     C**
     C                     SETOF                     858670
     C           BOKCHK    IFNE *BLANKS
     C           SESN      SETLLUDEPS                    86
     C                     END
     C********** CUSCHK    IFNE *ZERO                                                         CSD027
     C           CUSCHK    IFNE *BLANKS                                                       CSD027
     C           SESN      SETLLCDEPS                    85
     C                     END
     C           BOKCHK    IFEQ *BLANKS
     C********** CUSCHK    ANDEQ*ZERO                                                         CSD027
     C           CUSCHK    ANDEQ*BLANKS                                                       CSD027
     C           SESN      SETLLUDEPS                    86
     C           SESN      SETLLCDEPS                    85
     C                     END
     C**
     C**  If recs found go & fill SFL
     C**
     C           *IN86     IFEQ '1'
     C           *IN85     OREQ '1'
     C                     EXSR PROCES
     C                     MOVE '1'       *IN50
     C                     END
     C**
     C                     END
     C**
     C                     END
     C                     END
     C                     END
     C**
     C**    Condition Display of message if no details for issuer
     C**
     C           EDLOOP    TAG                             ** EDLOOP    **
     C           SFLREC    IFEQ 0
     C                     MOVE '1'       *IN04
     C                     ELSE
     C**
     C**    If records written - read next to check there are more
     C**
     C           *IN51     IFEQ '0'
     C                     SETOF                     82
     C           OUTREC    IFEQ 14
     C           *IN05     ANDEQ'0'
     C**
     C           *IN81     IFEQ '0'
     C           READN     TAG                             ** READN     **
     C                     READ SECTI                    81
     C           *IN81     IFEQ '0'
     C           RECI      IFEQ 'D'
     C**********           MOVE ISSCHK    @TCHK   60                                   S01117 CSD027
     C                     MOVE ISSCHK    @TCHK   6                                           CSD027
     C***********ISSR      IFEQ ISSCHK                                    S01117
     C           ISSR      IFEQ @TCHK                                     S01117
     C                     SETON                     82
     C                     READPSECTI                    81
     C                     END
     C                     ELSE
     C                     GOTO READN
     C                     END
     C                     END
     C                     END
     C                     END
     C**
     C**
     C           *IN82     IFEQ '0'
     C                     SETON                     05
     C                     END
     C                     END
     C                     MOVE '0'       *IN03
     C                     END
     C                     Z-ADDSFLREC    TOP
     C**
     C                     ENDSR
     C*****************************************************************
     C/EJECT
0738 C*****************************************************************
     C**                                                              *
     C**   PROCES SR  Process the details for a security              *
     C**                                                              *
     C**   Called by  DISP                                            *
     C**                                                              *
     C**   Calls  SR  RETSR,SUBFIL                                    *
     C**                                                              *
     C*****************************************************************
     C**
     C           PROCES    BEGSR                           ** PROCES **
     C**
     C**  Determine next type of SFL line required
     C**
     C                     MOVE '1'       *IN71
     C**
     C**  New sec - initialise & read first position record
     C**
     C           *IN51     IFEQ '0'
     C           SFLT      ANDLT2
     C                     Z-ADD1         SFLT    20
     C                     Z-ADD0         ZZTOTE 150
     C                     SETOF                     5071
     C                     MOVE '1'       *IN51
     C**
     C**  New sec - access INVTP record
     C**
     C           KEYI      CHAININVTP                25
     C  N25      RECI      COMP 'D'                  2525
     C**
     C**     If no record found  or deleted record
     C**        then it is a database error so return to calling
     C**        program with a return code of '0'
     C**
     C           *IN25     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVELPROGRM    DBPGM            ************
     C                     MOVELIKEY      DBKEY            * DATABASE *
     C                     MOVE 'INVTY'   DBFILE           * ERROR 04 *
     C                     Z-ADD4         DBASE            ************
     C                     SETON                       U7U8
     C                     EXSR *PSSR                                     S01117
     C                     MOVE '0'       RTNC
     C                     EXSR RETSR
     C                     END
     C                     END
     C**
     C           TOPSR     TAG                             *** TOPSR   ***
      *                                                                   CGL011
     C           CGL011    IFEQ 'Y'                                       CGL011
     C           SFLT      CABEQ4         ADONE                           CGL011
     C                     ELSE                                           CGL011
     C           SFLT      CABEQ3         ADONE
     C                     ENDIF                                          CGL011
      *                                                                   CGL011
     C           SFLT      IFEQ 1
     C           *IN71     ANDEQ'0'
     C           *IN86     IFEQ '1'
     C           NEXTU1    TAG                             *** NEXTU1  ***
     C           SESN      READEUDEPS                    87
     C***********          Z-ADD0         SAVBR                           S01117
     C                     MOVEL*BLANKS   SAVBR                           S01117
     C**********           Z-ADD0         SAVCN                                               CSD027
     C                     MOVE *BLANKS   SAVCN                                               CSD027
     C**
     C**  Check record meets selection criteria                        s
     C**
     C           *IN87     IFEQ '0'
     C***********BRCCHK    IFNE *ZEROS                                    S01117
     C***********BRCCHK    ANDNECDBR                                      S01117
     C           BRCCHK    IFNE *BLANKS                                   S01117
     C           BRCCHK    ANDNECDPA                                      S01117
     C                     GOTO NEXTU1
     C                     END
     C           BOKCHK    IFNE *BLANKS
     C           BOKCHK    ANDNECDBK
     C                     GOTO NEXTU1
     C                     END
     C                     END
     C                     END
     C                     END
     C**
     C**  Do until no more recs for security on UDEPS                  s
     C**
     C           *IN86     DOWEQ'1'
     C**
     C**  Check record meets selection criteria                        s
     C**
     C           *IN87     IFEQ '0'
     C***********BRCCHK    IFNE *ZEROS                                    S01117
     C***********BRCCHK    ANDNECDBR                                      S01117
     C           BRCCHK    IFNE *BLANKS                                   S01117
     C           BRCCHK    ANDNECDPA                                      S01117
     C                     GOTO NEXTU
     C                     END
     C           BOKCHK    IFNE *BLANKS
     C           BOKCHK    ANDNECDBK
     C                     GOTO NEXTU
     C                     END
     C                     END
     C**
     C**  If new branch/book/mkt - output SFL record                   s
     C**
     C***********SAVBR     IFNE 0                                         S01117
     C           SAVBR     IFNE *BLANKS                                   S01117
     C***********SAVBR     IFNE CDBR                                      S01117
     C           SAVBR     IFNE CDPA                                      S01117
     C           SAVBK     ORNE CDBK
     C           SAVMK     ORNE CDMK
     C           *IN87     OREQ '1'
     C**
     C** Data accessed - fill SFL line & output to SFL
     C**
     C           OUTREC    IFGE 14
     C                     GOTO PEND
     C                     END
     C                     EXSR SUBFIL
     C                     SETON                     70
     C           SFLT      IFEQ 1
     C                     Z-ADD2         SFLT
     C**
     C**  If room in SFl -                                             s
     C**
     C           OUTREC    IFGE 14
     C                     GOTO PEND
     C                     END
     C                     EXSR SUBFIL
     C                     END
     C                     Z-ADD1         SFLT
     C                     Z-ADD*ZEROS    ZZNOML
     C***********          MOVE CDBR      SAVBR                           S01117
     C                     MOVE CDPA      SAVBR                           S01117
     C                     MOVE CDBK      SAVBK
     C                     MOVE CDMK      SAVMK
     C           *IN87     IFEQ '1'
     C                     SETOF                     8671
     C                     END
     C                     END
     C                     END
     C**
     C**  Accumulate values from UDEPS                                 s
     C**
     C           *IN87     IFEQ '0'
     C***********SAVBR     IFEQ 0                                         S01117
     C           SAVBR     IFEQ *BLANKS                                   S01117
     C                     MOVE CDBK      SAVBK
     C***********          MOVE CDBR      SAVBR                           S01117
     C                     MOVE CDPA      SAVBR                           S01117
     C                     MOVE CDMK      SAVMK
     C                     END
     C                     ADD  CDNT      ZZNOML
     C                     ADD  SNPT      ZZNOML
     C                     ADD  CDST      ZZNOML
     C                     END
     C           *IN87     IFEQ '1'
     C***********SAVBR     ANDEQ0                                         S01117
     C           SAVBR     ANDEQ*BLANKS                                   S01117
     C                     SETOF                     86
     C                     END
     C**
     C           NEXTU     TAG                             *** NEXTU   ***
     C           SESN      READEUDEPS                    87
     C                     END
     C**
     C**  Now do CDEPS file if req'd                                   s
     C**
     C           *IN85     CABEQ'0'       ADONE
     C           SFLT      IFEQ 1
     C           *IN71     ANDEQ'0'
     C           NEXTC1    TAG                             *** NEXTC1  ***
     C           SESN      READECDEPS                    87
     C**********           Z-ADD0         SAVCN                                               CSD027
     C                     MOVE *BLANKS   SAVCN                                               CSD027
     C                     MOVE *BLANKS   SAVBK
     C**
     C**  Check record meets selection criteria                        s
     C**
     C           *IN87     IFEQ '0'
     C***********BRCCHK    IFNE *ZEROS                                    S01117
     C***********BRCCHK    ANDNECDBR                                      S01117
     C           BRCCHK    IFNE *BLANKS                                   S01117
     C           BRCCHK    ANDNECDPA                                      S01117
     C                     GOTO NEXTC1
     C                     END
     C                     MOVE CDCN      @CDCN   6                       S01117
     C********** CUSCHK    IFNE *ZERO                                                         CSD027
     C           CUSCHK    IFNE *BLANKS                                                       CSD027
     C***********CUSCHK    ANDNECDCN                                      S01117
     C           CUSCHK    ANDNE@CDCN                                     S01117
     C                     GOTO NEXTC1
     C                     END
     C                     END
     C                     END
     C**
     C**  Do until no more recs for security on CDEPS                  s
     C**
     C           *IN85     DOWEQ'1'
     C**
     C**  Check record meets selection criteria                        s
     C**
     C           *IN87     IFEQ '0'
     C***********BRCCHK    IFNE *ZEROS                                    S01117
     C***********BRCCHK    ANDNECDBR                                      S01117
     C           BRCCHK    IFNE *BLANKS                                   S01117
     C           BRCCHK    ANDNECDPA                                      S01117
     C                     GOTO NEXTC
     C                     END
     C                     MOVE CDCN      @CDCN   6                       S01117
     C********** CUSCHK    IFNE *ZERO                                                         CSD027
     C           CUSCHK    IFNE *BLANKS                                                       CSD027
     C***********CUSCHK    ANDNECDCN                                      S01117
     C           CUSCHK    ANDNE@CDCN                                     S01117
     C                     GOTO NEXTC
     C                     END
     C                     END
     C**
     C**  If new branch/cust/mkt - output SFL record                   s
     C**
     C********** SAVCN     IFNE 0                                                             CSD027
     C           SAVCN     IFNE *BLANKS                                                       CSD027
     C***********SAVBR     IFNE CDBR                                      S01117
     C           SAVBR     IFNE CDPA                                      S01117
     C           SAVCN     ORNE CDCN
     C           SAVMK     ORNE CDMK
     C           *IN87     OREQ '1'
     C**
     C** Data accessed - fill SFL line & output to SFL
     C**
     C           OUTREC    IFGE 14
     C                     GOTO PEND
     C                     END
     C                     SETON                     70
     C                     EXSR SUBFIL
     C           SFLT      IFEQ 1
     C                     Z-ADD2         SFLT
     C**
     C**  If room in SFl -                                             s
     C**
     C           OUTREC    IFGE 14
     C                     GOTO PEND
     C                     END
     C                     EXSR SUBFIL
     C                     END
      *                                                                   CGL011
      ** If CGL011 is installed, check if position is blocked.            CGL011
      *                                                                   CGL011
     C           CGL011    IFEQ 'Y'                                       CGL011
     C           SFLT      IFEQ 2                                         CGL011
     C                     MOVE 'N'       WBLKI   1                       CGL011
     C                     MOVE *OFF      *IN63                           CGL011
      *                                                                                       CGL014
      ** If CGL014 is on, display 'Collateral' narrative to actual blocked                    CGL014
      ** security positions with sequence 00001 or 00002 (SEBLKPL7).                          CGL014
      *                                                                                       CGL014
     C           CGL014    IFEQ 'Y'                                                           CGL014
     C           KEYVD     SETLLSEBLKPL7                                                      CGL014
     C                     ELSE                                                               CGL014
     C           KEYVD     SETLLSEBLKPL6                                  CGL011
     C                     ENDIF                                                              CGL014
      *                                                                                       CGL014
     C           WBLKI     DOWEQ'N'                                       CGL011
     C           *IN63     ANDEQ*OFF                                      CGL011
      *                                                                                       CGL014
     C           CGL014    IFEQ 'Y'                                                           CGL014
     C           KEYVD     READESEBLKPL7                 63                                   CGL014
     C                     ELSE                                                               CGL014
     C           KEYVD     READESEBLKPL6                 63               CGL011
     C                     ENDIF                                                              CGL014
      *                                                                   CGL011
      ** If block exists, whether General Block on Security or            CGL011
      ** Specific Block on the Customer, add one more subfile line        CGL011
      ** for Collateral text narrative.                                   CGL011
      *                                                                   CGL011
     C           *IN63     IFEQ *OFF                                      CGL011
     C           VDCNUM    ANDEQSAVCN                                     CGL011
     C           *IN63     OREQ *OFF                                      CGL011
     C********** VDCNUM    ANDEQ*ZERO                                                  CGL011 CSD027
     C           VDCNUM    ANDEQ*BLANKS                                                       CSD027
     C                     MOVE 'Y'       WBLKI                           CGL011
     C                     Z-ADD3         SFLT                            CGL011
     C           OUTREC    IFGE 14                                        CGL011
     C                     GOTO PEND                                      CGL011
     C                     ENDIF                                          CGL011
     C                     EXSR SUBFIL                                    CGL011
     C                     ENDIF                                          CGL011
     C                     ENDDO                                          CGL011
     C                     ENDIF                                          CGL011
     C                     ENDIF                                          CGL011
      *                                                                   CGL011
     C                     Z-ADD1         SFLT
     C                     Z-ADD*ZEROS    ZZNOML
     C***********          MOVE CDBR      SAVBR                           S01117
     C                     MOVE CDPA      SAVBR                           S01117
     C                     MOVE CDCN      SAVCN
     C                     MOVE CDMK      SAVMK
     C           *IN87     IFEQ '1'
     C                     SETOF                     85
     C                     END
     C                     END
     C                     END
     C**
     C**  Accumulate values from CDEPS                                 s
     C**
     C           *IN87     IFEQ '0'
     C********** SAVCN     IFEQ 0                                                             CSD027
     C           SAVCN     IFEQ *BLANKS                                                       CSD027
     C                     MOVE CDCN      SAVCN
     C***********          MOVE CDBR      SAVBR                           S01117
     C                     MOVE CDPA      SAVBR                           S01117
     C                     MOVE CDMK      SAVMK
     C                     END
     C                     ADD  CDNT      ZZNOML
     C                     ADD  SNPT      ZZNOML
     C                     ADD  CDST      ZZNOML
     C                     END
     C           *IN87     IFEQ '1'
     C********** SAVCN     ANDEQ0                                                             CSD027
     C           SAVCN     ANDEQ*BLANKS                                                       CSD027
     C                     SETOF                     85
     C                     END
     C**
     C           NEXTC     TAG                             *** NEXTC   ***
     C           SESN      READECDEPS                    87
     C                     END
     C**                                                               s
     C**
     C           ADONE     TAG                             *** ADONE   ***
     C**
     C** DO TOTAL LINE
     C**
     C******************** Z-ADD3         SFLT                            E19964
     C           OUTREC    IFLT 14
     C           *IN51     ANDEQ'1'
     C           *IN70     IFEQ '1'
      *                                                                   CGL011
      ** If CGL011 is installed, initialise SFLT to 4;                    CGL011
      ** otherwise, retain current processing of 3.                       CGL011
      *                                                                   CGL011
     C           CGL011    IFEQ 'Y'                                       CGL011
     C                     Z-ADD4         SFLT                            CGL011
     C                     ELSE                                           CGL011
     C                     Z-ADD3         SFLT                            E19964
     C                     ENDIF                                          CGL011
      *                                                                   CGL011
     C                     EXSR SUBFIL
     C                     Z-ADD1         SFLT
     C                     END
     C                     SETOF                     51
     C                     END
     C**                                                               s
     C           PEND      TAG                             *** PEND    ***
     C**
     C                     ENDSR
     C*****************************************************************
     C/EJECT
0738 C*****************************************************************
     C**                                                              *
     C**   BKPRC  SR  Calculate book price                            *
     C**                                                              *
     C**   Called by  SUBFIL                                          *
     C**                                                              *
     C**   Calls  SR  OLBAP                                           *
     C**                                                              *
     C*****************************************************************
     C**
     C           BKPRC     BEGSR                           ** BKPRC  **
     C**
     C**  B/V ind is set to BLANK by default
     C**
     C                     MOVE ' '       SBVI
     C                     Z-ADD0         BKPR   158
     C                     Z-ADD0         ZZAPW
     C**
     C** Access 1st price for sec,br,mkt,book,price type
     C**
     C***********TVVL      IFEQ 'T'                                       S01117
     C           BVTVDV    IFEQ 'T'                                       S01117
     C                     MOVE 'DT'      PPRT
     C                     ELSE
     C                     MOVE 'DV'      PPRT
     C                     END
     C***********KEYP      SETLLPRICS                    25               E14057
     C           KEYP      SETLLPRICR                    25               E14057
     C           *IN25     IFEQ '1'
     C***********KEYP      READEPRICS                    25               E14057
     C           KEYP      READEPRICR                    25               E14057
     C           *IN25     IFEQ '0'
     C**
     C** If price found & value date is less than prev. run date
     C**  B/V ind is set to Y
     C**
     C           PVDT      IFLT PRUN
     C                     MOVE 'Y'       SBVI
     C**
     C**  If price found & value date equals prev. run date
     C**    Price will be used to override AP num COB field
     C**
     C                     ELSE
     C           PVDT      IFEQ PRUN
     C                     Z-ADDPPRC      ZZAPW
     C                     END
     C                     END
     C**
     C** If price found & value date = run date
     C**   price Becomes the average price
     C**
     C           PVDT      IFEQ RUND
     C                     Z-ADDPPRC      BKPR
     C                     ELSE
     C**
     C** If price found with value date less than prev run date
     C**   Access price file with date = run date
     C**     if found price becomes the average price
     C**
     C           PVDT      IFLT PRUN
     C***********KEYPD     CHAINPRICS                25                   E14057
     C           KEYPD     CHAINPRICR                25                   E14057
     C           *IN25     IFEQ '0'
     C                     Z-ADDPPRC      BKPR
     C                     ELSE
     C**
     C**     otherwise -                                               ld
     C**   Access price file with date = previous run date
     C**     if found  price will be used to override AP num COB fie   ld
     C**
     C***********KEYPP     CHAINPRICS                25                   E14057
     C           KEYPP     CHAINPRICR                25                   E14057
     C           *IN25     IFEQ '0'
     C                     Z-ADDPPRC      ZZAPW
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C**
     C**  Calculate average price -
     C**    If price found with value date = run date this is it
     C**
     C           BKPR      IFEQ 0
     C**
     C** Access BKPHDD
     C**
     C           KEYBH     CHAINBKPHD                25
     C           *IN25     IFEQ '0'
     C**
     C** Access BKPOSD
     C**
     C           KEYBP     CHAINBKPOS                25
     C                     END
     C**
     C**  If price found , value date = prev run date
     C**    Calculate override for sum of AP num COB +
     C**      price x nom posn COB on BKPOSD
     C**
     C           ZZAPW     IFNE 0
     C/COPY WNCPYSRC,SE0265C007
     C           NPSN      MULT ZZAPW     ZZAPC
     C                     ELSE
     C*******************  Z-ADDNPSN      ZZAPC
     C                     Z-ADDAPNC      ZZAPC
     C/COPY WNCPYSRC,SE0265C001
     C                     END
     C**
     C**  Calculate average price from OLBAP
     C**
     C           *IN25     IFEQ '0'
     C                     EXSR OLBAP
     C                     END
     C                     END
     C**
     C                     ENDSR
     C*****************************************************************
     C/EJECT
0738 C*****************************************************************
     C**                                                              *
     C**   OLBAP  SR  Calculate average price                         *
     C**                                                              *
     C**   Called by  BKPRC                                           *
     C**                                                              *
     C**   Calls  SR  none                                            *
     C**                                                              *
     C*****************************************************************
     C**
     C           OLBAP     BEGSR                           ** OLBAP  **
     C**
     C**  Calculate new NP = NP + sum nom purch + sum nom sales
     C**
     C           SNPI      ADD  SNSI      ZNNOMP
     C                     ADD  NPSN      ZNNOMP
     C**
     C** If NP & new NP both long -
     C**  AP = (AP num COB + AP num purch) / new NP
     C**
     C           NPSN      IFGT 0
     C           ZNNOMP    ANDGT0
     C           ZNNOMP    IFEQ 0
     C**********           Z-ADD0         BKPR                                                261507
     C                     Z-ADD0         BKPRR  238H                                         261507
     C                     ELSE
     C********** ZZAPC     ADD  SANP      BKPR
     C********** BKPR      DIV  ZNNOMP    BKPR      H
     C           ZZAPC     ADD  SANP      WBKPR  150
     C                     SUB  SANS      WBKPR
     C********** 5         SUB  CDP       XY      10
     C********** WBKPR     MULT POWER8,XY WBKPR
     C********** WBKPR     DIV  ZNNOMP    BKPR      H                                         261507
     C           WBKPR     DIV  ZNNOMP    BKPRR     H                                         261507
      *                                                                   207543
     C           CEU018    IFEQ 'Y'                                       207543
      *                                                                   207543
     C           SPBS      IFEQ 'P'                                       207543
     C           STBS      ANDEQ'Y'                                       207543
     C                     DIV  100       ZZAPC                           207543
     C                     END                                            207543
      *                                                                   207543
     C                     END                                            207543
      *
     C/COPY WNCPYSRC,SE0265C002
     C                     END
     C                     END
     C**
     C** If NP & new NP both short -
     C**  AP = (AP num COB + AP num sales) / new NP
     C**  (ensure price field is positive)
     C**
     C           NPSN      IFLT 0
     C           ZNNOMP    ANDLT0
     C           ZNNOMP    IFEQ 0
     C**********           Z-ADD0         BKPR                                                261507
     C                     Z-ADD0         BKPRR                                               261507
     C                     ELSE
     C*********  ZZAPC     ADD  SANS      BKPR
     C*********  BKPR      DIV  ZNNOMP    BKPR      H
     C           ZZAPC     ADD  SANS      WBKPR
     C                     SUB  SANP      WBKPR
     C*********  5         SUB  CDP       XY      10
     C*********  WBKPR     MULT POWER8,XY WBKPR
    C********** WBKPR     DIV  ZNNOMP    BKPR      H                                         261507
     C********** BKPR      IFLT 0                                                             261507
     C********** BKPR      MULT -1        BKPR                                                261507
     C           WBKPR     DIV  ZNNOMP    BKPRR     H                                         261507
     C           BKPRR     IFLT 0                                                             261507
     C           BKPRR     MULT -1        BKPRR                                               261507
     C                     END
     C                     END
     C                     END
     C**
     C** If NP long or flat , new NP short -
     C**  AP = AP num sales / sum nom sales
     C**
     C           NPSN      IFGE 0
     C           ZNNOMP    ANDLT0
     C           SNSI      IFEQ 0
     C**********           Z-ADD0         BKPR                                                261507
     C                     Z-ADD0         BKPRR                                               261507
     C                     ELSE
     C***********SANP      DIV  SNSI      BKPR      H                     E32503
     C********** SANS      DIV  SNSI      BKPR      H                                  E32503 261507
     C           SANS      DIV  SNSI      BKPRR     H                                         261507
     C                     END
     C                     END
     C**
     C** If NP short or flat , new NP long -
     C**  AP = AP num purch / sum nom purch
     C**
     C           NPSN      IFLE 0
     C           ZNNOMP    ANDGT0
     C           SNPI      IFEQ 0
     C**********           Z-ADD0         BKPR                                                261507
     C                     Z-ADD0         BKPRR                                               261507
     C                     ELSE
     C********** SANP      DIV  SNPI      BKPR      H                                         261507
     C           SANP      DIV  SNPI      BKPRR     H                                         261507
     C                     END
     C                     END
     C**
     C** If new NP flat -
     C**  AP = 0
     C**
     C           ZNNOMP    IFEQ 0
     C**********           Z-ADD0         BKPR                                                261507
     C                     Z-ADD0         BKPRR                                               261507
     C                     END
     C*
     C* If price basis 'P', multiply by 100 to fetch true price
     C*
     C           SPBS      IFEQ 'P'
      *                                                                   207543
     C           CEU018    OREQ 'Y'                                       207543
     C           SPBS      ANDEQ'P'                                       207543
     C           STBS      ANDNE'Y'                                       207543
      *                                                                   207543
     C/COPY WNCPYSRC,SE0265C003
     C**********           MULT 100       BKPR                                                261507
     C                     MULT 100       BKPRR                                               261507
     C                     END
     C**
     C***********5         ADD  CDP       XY      10                      S01117
     C           5         ADD  A6NBDP    XY      10                      S01117
     C                     SUB  NMDP      XY
     C********** BKPR      DIV  POWER8,XY BKPR                                                261507
     C           BKPRR     DIV  POWER8,XY BKPR                                                261507
     C**
     C                     ENDSR
     C**
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**   CLEAR  SR  Clear the screen display fields and indicators  *
     C**                                                              *
     C**   Called by  COMMD, CUSTIN                                   *
     C**                                                              *
     C**   Calls  SR  none                                            *
     C**                                                              *
     C*****************************************************************
     C**
     C           CLEAR     BEGSR
     C**
     C                     MOVE *BLANKS   CUSTMR
     C                     MOVE *BLANKS   ISSUER
     C                     MOVE *BLANKS   BRANCH
     C                     MOVE *BLANKS   BOOKIN
     C                     MOVE *BLANKS   PRFC                            CAC005
     C                     MOVE *BLANKS   EXPCCY
     C                     MOVE *BLANKS   FACTRD
     C                     MOVE *BLANKS   SISNO
     C                     MOVE *BLANKS   SIRNM
     C                     MOVE *BLANKS   SIRTN
     C                     MOVE *BLANKS   SPAREN
     C                     MOVE *BLANKS   SFACT
     C                     MOVE *BLANKS   SECCY
     C**********           MOVE *ZEROS    LTISS                                               CSD027
     C                     MOVE *BLANKS   LTISS                                               CSD027
     C                     Z-ADD*ZEROS    ZZNOML
     C**
     C                     Z-ADD0         SFLT
     C                     Z-ADD0         SFLREC  40
     C                     Z-ADD0         TOP     40
     C**
     C                     SETON                       03
     C                     SETOF                     800405
     C                     SETOF                     818789
     C                     SETOF                     434445
     C                     SETOF                     464750
     C                     SETOF                     5160
     C                     MOVE *OFF      *IN62                           CAC005
     C**  CLEAR SUBFILE
     C                     SETON                       02
     C                     WRITESE0265C0
     C                     SETOF                       02
     C**
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**   SETUP  SR  To prepare for Screen Display                   *
     C**                                                              *
     C**   Called by  CUSSEC                                          *
     C**                                                              *
     C**   Calls  SR  CLEAR, DISP, SECFIL                             *
     C**                                                              *
     C*****************************************************************
     C**
     C           SETUP     BEGSR                           ** SETUP **
     C**
     C           BRANCH    IFEQ 'ALL'                                     054258
     C                     MOVE BRANCH    BRCHXX  3                       054258
     C                     MOVE *BLANKS   BRCCHK                          054258
     C                     ELSE                                           054258
     C                     MOVE BRANCH    BRCCHK
     C                     END                                            054258
     C                     MOVE EXPCCY    CURCHK
     C                     MOVE FACTRD    FACCHK
     C                     MOVE BOOKIN    BOKCHK
      *                                                                   CAC005
      ** Convert screen-criteria-book code and screen-criteria-profit     CAC005
      ** centre into pseudo book                                          CAC005
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C           BOOKIN    ANDNE*BLANKS                                   CAC005
     C           PRFC      ANDNE*BLANKS                                   CAC005
     C                     CALL 'AOBKPCR0'                                CAC005
     C                     PARM *BLANKS   PRTCD                           CAC005
     C                     PARM '*PSEUDO' POPTN                           CAC005
     C                     PARM BOOKIN    PBKCD   2                       CAC005
     C                     PARM PRFC      PPRFC   4                       CAC005
     C                     PARM           PPSBK   2                       CAC005
      *                                                                   CAC005
     C           PRTCD     IFEQ *BLANKS                                   CAC005
     C                     MOVELPPSBK     BOKCHK                          CAC005
     C                     ENDIF                                          CAC005
     C                     ENDIF                                          CAC005
     C**
     C**   Clear the Screen
     C**
     C                     EXSR CLEAR
     C*
     C                     MOVE ISSCHK    ISSUER                          054258
     C********** CUSCHK    IFNE '000000'                                               054258 CSD027
     C           CUSCHK    IFNE *BLANKS                                                       CSD027
     C           CUSCHK    ANDNE*BLANKS                                   054258
     C                     MOVE CUSCHK    CUSTMR                          054258
     C                     END                                            054258
     C           BRCCHK    IFEQ *BLANKS                                   054258
     C                     MOVE BRCHXX    BRANCH                          054258
     C                     ELSE                                           054258
     C                     MOVE BRCCHK    BRANCH                          054258
     C                     END                                            054258
     C                     MOVE CURCHK    EXPCCY                          054258
     C                     MOVE FACCHK    FACTRD                          054258
     C                     MOVE BOKCHK    BOOKIN                          054258
      *                                                                   CAC005
      ** Retrieve user book and profit centre                             CAC005
      *                                                                   CAC005
     C                     MOVE *BLANKS   PRFC                            CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C           BOKCHK    ANDNE*BLANK                                    CAC005
     C                     CALL 'AOBKPCR0'                                CAC005
     C                     PARM *BLANKS   PRTCD                           CAC005
     C                     PARM '*USER  ' POPTN                           CAC005
     C                     PARM           PBKCD                           CAC005
     C                     PARM           PPRFC                           CAC005
     C                     PARM BOKCHK    PPSBK                           CAC005
      *                                                                   CAC005
     C           PRTCD     IFEQ *BLANKS                                   CAC005
     C                     MOVE PBKCD     BOOKIN                          CAC005
     C                     MOVE PPRFC     PRFC                            CAC005
     C                     ENDIF                                          CAC005
     C                     ENDIF                                          CAC005
     C*
     C**
     C** Issuer valid - see if it is a parent
     C***Access*issuer*record*-**(PACUS)******************************    S01117
     C** Access issuer record -  (SDCUSTL4)                               S01117
     C**
     C***********ISSCHK    CHAINPACUS                25                   S01117
     C           ISSCHK    CHAINSDCUSTL4             25                   S01117
     C************IN25     IFEQ '0'                                       S01117
     C***********RECI      IFEQ '*'                                       S01117
     C***********          SETON                     25                   S01117
     C***********          END                                            S01117
     C***********          END                                            S01117
     C           *IN25     IFEQ '1'
     C                     SETOF                     60
     C                     ELSE
     C                     SETON                     60
     C                     END
     C**
     C**   Move  selection criteria to top of screen
     C**
     C           *IN60     IFEQ '1'
     C                     MOVE ISSCHK    SPAREN
     C                     END
     C                     MOVE ISSCHK    SISNO
     C                     MOVE ISNAME    SIRNM
     C                     MOVE ITOWN     SIRTN
     C           FACCHK    IFEQ 'F'
     C                     MOVE FACT      SFACT
     C                     ELSE
     C           FACCHK    IFEQ 'U'
     C                     MOVE UNFACT    SFACT
     C                     END
     C                     END
     C                     MOVE CURCHK    SECCY
     C**
     C**   Set defaults-
     C**
     C           *IN07     IFEQ '0'
     C***********          MOVE DSTB      BRCCHK                          S01117
     C                     MOVELUSRBCH    BRCCHK                          S01117
     C                     END
     C           CURCHK    IFEQ *BLANKS
     C***********          MOVEL'20      'TKEY   12                       S01117
     C***********          MOVE BCYL      CURCHK                          S01117
     C***********          MOVELBCYL      ZWK4                            S01117
     C***********          MOVE 1         ZWK4                            S01117
     C***********          MOVE ZWK4      TKEY                            S01117
     C***********TKEY      CHAINTABTG10F             25                   S01117
     C*                                                                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM BNCYCD    @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C*                                                                   S01117
     C**N25******RECI      COMP 'D'                  2525                 S01117
     C**
     C**     If no record found  or deleted record
     C**        then it is a database error so return to calling
     C**        program with a return code of '0'
     C**
     C************IN25     IFEQ '1'                                       S01117
     C***********          MOVELPROGRM    DBPGM            ************   S01117
     C***********          MOVELTKEY      DBKEY            **DATABASE*****S01117
     C***********          MOVE 'TABLE'   DBFILE           **ERROR*07*****S01117
     C***********          Z-ADD07        DBASE            ************   S01117
     C***********          SETON                       U7U8               S01117
     C***********          MOVE '0'       RTNC                            S01117
     C***********          EXSR RETSR                                     S01117
     C***********          ELSE                                           S01117
     C***********          Z-ADDSPOT      ZRATE2                          S01117
     C                     MOVE BNCYCD    CURCHK                          S01117
     C                     Z-ADDA6SPRT    ZRATE2                          S01117
     C***********MDIN      IFEQ 0                                         S01117
     C           A6MDIN    IFEQ 'D'                                       S01117
     C                     MOVE 'D'       ZMDI2   1
     C                     ELSE
     C                     MOVE 'M'       ZMDI2
     C                     END
     C***********          END                                            S01117
     C                     END
     C**
     C**   Position SECTY at start of required ISSUER
     C**
     C***********ISSCHK    SETLLSECTI                                     S01117
     C**********           MOVE ISSCHK    @TCHK   60                                   S01117 CSD027
     C                     MOVE ISSCHK    @TCHK   6                                           CSD027
     C           @TCHK     SETLLSECTI                                     S01117
     C**
     C**   Get details for display
     C**
     C                     EXSR DISP
     C**
     C                     ENDSR
     C*****************************************************************
     C/EJECT
0738 C*****************************************************************
     C**                                                              *
     C**   SUBFIL SR  Write details to Subfile                        *
     C**                                                              *
     C**   Called by  DISP                                            *
     C**                                                              *
     C**   Calls  SR  RETSR, ZSEDIT, BKPRC, ZSDESC, ZXRATE, ZCONV     *
     C**                                                              *
     C*****************************************************************
     C**
     C           SUBFIL    BEGSR                           ** SUBFIL **
     C**
     C**  SUBFIL - fills one line of the SFL depending on the setting
     C**           of SFLT
     C**
     C**  SFLT=1 FIRST SECURITY/POSITION DETAILS LINE
     C**
     C           SFLT      IFEQ 1
     C                     SETOF                     08
     C/COPY WNCPYSRC,SE0265C009
     C**
     C*****ACCESS*CLINTCB*for*positions*client****************************S01117
     C**   ACCESS SDCUSTPD for positions client                           S01117
     C**
     C           *IN85     IFEQ '1'
     C********** SAVCN     ANDNE0                                                             CSD027
     C           SAVCN     ANDNE*BLANKS                                                       CSD027
     C***********SAVCN     CHAINCLINTCBF             25                   S01117
     C**N25******RECI      COMP 'D'                  2525                 S01117
     C**
     C*******If*no*record*found**or*deleted*record************************S01117
     C**********then*it*is*a*database*error*so*return*to*calling**********S01117
     C**********program*with*a*return*code*of*'0'*************************S01117
     C**
     C************IN25     IFEQ '1'                                       S01117
     C*                                                                   S01117
     C                     MOVELSAVCN     KEY1   10                       S01117
     C*                                                                   S01117
     C**********           CALL 'AOCUSTR0'                                             S01117 235150
     C                     CALL 'AOCUSTR1'                                                    235150
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @KEY    7                       S01117
     C                     PARM KEY1      @KEY1  10                       S01117
     C                     PARM           @KYST   7                       S01117
     C********** SDCUST    PARM SDCUST    DSSDY                                        S01117 235150
     C           SDCUST    PARM SDCUST    DSLDY                                               235150
     C*                                                                   S01117
     C***********          MOVELPROGRM    DBPGM            ************   S01117
     C***********          MOVELSAVCN     DBKEY            * DATABASE *   S01117
     C***********          MOVE 'CLINT'   DBFILE           **ERROR*05**   S01117
     C***********          Z-ADD05        DBASE            ************   S01117
     C***********          SETON                       U7U8               S01117
     C***********          MOVE '0'       RTNC                            S01117
     C***********          EXSR RETSR                                     S01117
     C***********          ELSE                                           S01117
     C           @RTCD     IFEQ *BLANKS                                                       235150
     C           @RTCD     ORNE *BLANKS                                                       235150
     C           BBCLST    ANDEQ'Y'                                                           235150
     C                     MOVE BBCUST    CNUM                            S01117
     C                     ENDIF                                                              235150
     C***********          END                                            S01117
     C                     END
     C**
     C**   ACCESS TABTG10 FOR nominal CURRENCY
     C**
     C                     MOVEL'20      'TKEY   12
     C                     MOVELNMCY      ZWK4    4
     C                     MOVE 1         ZWK4
     C***********          MOVE ZWK4      TKEY                            S01117
     C***********TKEY      CHAINTABTG10F             25                   S01117
     C*                                                                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM NMCY      @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C*                                                                   S01117
     C*  SAVE CURRENCY DECIMAL PLACES FOR FROM CCY FOR SR ZCONV           S01117
     C*                                                                   S01117
     C                     Z-ADDA6NBDP    ZCDPI                           S01117
     C*                                                                   S01117
     C*  SAVE CURRENCY DECIMAL PLACES FOR SR ZACCZ, WHICH IN TURN         S01117
     C*    CALLS ZACCRZ, WHICH NEEDS THE NOM DEC. PLACES                  S01117
     C*                                                                   S01117
     C                     Z-ADDA6NBDP    ZCDP                            S01117
     C*                                                                   S01117
     C**N25******RECI      COMP 'D'                  2525                 S01117
     C**
     C**     If no record found  or deleted record
     C**        then it is a database error so return to calling
     C**        program with a return code of '0'
     C**
     C************IN25     IFEQ '1'                                       S01117
     C***********          MOVELPROGRM    DBPGM            ************   S01117
     C***********          MOVELTKEY      DBKEY            **DATABASE*****S01117
     C***********          MOVE 'TABLE'   DBFILE           **ERROR*06*****S01117
     C***********          Z-ADD06        DBASE            ************   S01117
     C***********          SETON                       U7U8               S01117
     C***********          MOVE '0'       RTNC                            S01117
     C***********          EXSR RETSR                                     S01117
     C***********          ELSE                                           S01117
     C***********          Z-ADDCDP       ZZCDP   10                      S01117
     C                     Z-ADDA6NBDP    ZZCDP   10                      S01117
     C***********          Z-ADDSPOT      ZRATE1                          S01117
     C                     Z-ADDA6SPRT    ZRATE1                          S01117
     C***********MDIN      IFEQ 0                                         S01117
     C           A6MDIN    IFEQ 'D'                                       S01117
     C                     MOVE 'D'       ZMDI1   1
     C                     ELSE
     C                     MOVE 'M'       ZMDI1
     C                     END
     C***********          END                                            S01117
     C**
     C**   Format security,cust,book,currency,branch,market,portf cust
     C**
     C                     MOVE SESN      SSESN
     C                     MOVE SAVBR     STDBR
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     MOVE SAVBR     SBR
     C                     ELSE                                           S01117
     C                     MOVE *BLANK    SBR                             S01117
     C                     END                                            S01117
     C                     MOVE SAVMK     SMK
     C                     MOVE NMCY      SCURR
     C           *IN86     IFEQ '1'
     C**********           MOVE *ZEROS    SPCTN                                               CSD027
     C                     MOVE *BLANKS   SPCTN                                               CSD027
     C                     MOVE *BLANKS   SSCUS
     C                     MOVE SAVBK     SBOOK
     C                     MOVE SAVBK     STDBK
      *                                                                   CAC005
      ** If CAC005 is installed, retrieve the corresponding user book     CAC005
      ** and profit centre                                                CAC005
      *                                                                   CAC005
     C                     MOVE *BLANKS   SPRFC                           CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C           SAVBK     ANDNE*BLANK                                    CAC005
     C                     CALL 'AOBKPCR0'                                CAC005
     C                     PARM *BLANKS   PRTCD                           CAC005
     C                     PARM '*USER  ' POPTN                           CAC005
     C                     PARM           PBKCD                           CAC005
     C                     PARM           PPRFC                           CAC005
     C                     PARM SAVBK     PPSBK                           CAC005
      *                                                                   CAC005
     C           PRTCD     IFEQ *BLANKS                                   CAC005
     C                     MOVE PBKCD     SBOOK                           CAC005
     C                     MOVE PPRFC     SPRFC                           CAC005
     C                     ENDIF                                          CAC005
     C                     ENDIF                                          CAC005
     C                     ELSE
     C                     MOVE *BLANKS   STDBK
     C                     MOVE BBCSSN    SSCUS                           S01117
     C                     MOVE SAVCN     SPCTN
     C                     MOVE *BLANKS   STDBK
     C                     END
     C**
     C**   Edit nominal
     C**
     C                     Z-ADDNMDP      ZDECS   10
     C                     MOVE 'L'       ZECODE
     C                     Z-ADDZZNOML    ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    STNOM
     C**
     C**   Format security ccy value & b/v ind
     C*  Convert Nominal to Nominal Currency Decimal Places
     C**
     C**********           MOVE *BLANKS   SBVI
     C********** ZZCDP     SUB  NMDP      ZI      10
     C********** ZI        ADD  5         ZI
     C********** ZZNOML    MULT POWER8,ZI ZZNOML    H
     C                     Z-ADD*ZEROS    WBVAL  150
     C                     Z-ADD*ZEROS    WBVAL0 150
     C                     Z-ADD*ZEROS    WBVAL1 151
     C                     Z-ADD*ZEROS    WBVAL2 152
     C                     Z-ADD*ZEROS    WBVAL3 153
     C                     MOVEA'0000'    *IN,55
     C           55        ADD  ZZCDP     J       20
     C                     MOVEA'1'       *IN,J
     C*
     C*  Multiply nominal by book/market price as applicable
     C*
     C***********MBEX      IFEQ 'B'                                       S01117
     C           BVMBEX    IFEQ 'B'                                       S01117
     C                     EXSR BKPRC
     C           BKPR      IFLT *ZEROS
     C                     Z-SUBBKPR      BKPR
     C                     END
     C********** BKPR      MULT ZZNOML    ZZNOML
     C   55      ZZNOML    MULT BKPR      WBVAL0    H
     C   56      ZZNOML    MULT BKPR      WBVAL1    H
     C   57      ZZNOML    MULT BKPR      WBVAL2    H
     C   58      ZZNOML    MULT BKPR      WBVAL3    H
     C*
     C                     ELSE
     C*                                                                   S01176
     C* Access Commercial Paper Price file for live record                S01176
     C*                                                                   S01176
     C                     MOVE SITP      KINVT                           S01176
     C                     MOVE NMCY      KCCY                            S01176
     C*                                                                   S01176
     C           CPPKA     CHAINCPPRIDF              25                   S01176
     C*                                                                   S01176
     C           *IN25     IFEQ '0'                                       S01176
     C           RECI      ANDEQ'*'                                       S01176
     C                     MOVE '1'       *IN25                           S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C* If processing type is 9                                           S01176
     C* AND the trade basis is 'Y'                                        S01176
     C* AND a live record exists on LF/CPPRIC                             S01176
     C*                                                                   S01176
     C           PROT      IFEQ '9'                                       S01176
     C           TRBS      ANDEQ'Y'                                       S01176
     C           *IN25     ANDEQ'0'                                       S01176
     C*                                                                   S01176
     C* Calculate Yield using standard subroutine ZYMTX                   S01176
     C*                                                                   S01176
     C                     Z-ADDMATY      ZMDAT                           S01176
     C                     Z-ADDRUND      ZBASD                           S01176
     C*                                                                   S01176
     C                     Z-ADDND01      ZND,1                           S01176
     C                     Z-ADDND02      ZND,2                           S01176
     C                     Z-ADDND03      ZND,3                           S01176
     C                     Z-ADDND04      ZND,4                           S01176
     C                     Z-ADDND05      ZND,5                           S01176
     C                     Z-ADDND06      ZND,6                           S01176
     C                     Z-ADDND07      ZND,7                           S01176
     C                     Z-ADDND08      ZND,8                           S01176
     C                     Z-ADDND09      ZND,9                           S01176
     C                     Z-ADDND10      ZND,10                          S01176
     C                     Z-ADDND11      ZND,11                          S01176
     C                     Z-ADDND12      ZND,12                          S01176
     C                     Z-ADDND13      ZND,13                          S01176
     C                     Z-ADDND14      ZND,14                          S01176
     C                     Z-ADDND15      ZND,15                          S01176
     C                     Z-ADDND16      ZND,16                          S01176
     C                     Z-ADDND17      ZND,17                          S01176
     C                     Z-ADDND18      ZND,18                          S01176
     C                     Z-ADDND19      ZND,19                          S01176
     C                     Z-ADDND20      ZND,20                          S01176
     C                     Z-ADDND21      ZND,21                          S01176
     C                     Z-ADDND22      ZND,22                          S01176
     C                     Z-ADDND23      ZND,23                          S01176
     C                     Z-ADDND24      ZND,24                          S01176
     C                     Z-ADDND25      ZND,25                          S01176
     C*                                                                   S01176
     C                     Z-ADDYR01      ZRT,1                           S01176
     C                     Z-ADDYR02      ZRT,2                           S01176
     C                     Z-ADDYR03      ZRT,3                           S01176
     C                     Z-ADDYR04      ZRT,4                           S01176
     C                     Z-ADDYR05      ZRT,5                           S01176
     C                     Z-ADDYR06      ZRT,6                           S01176
     C                     Z-ADDYR07      ZRT,7                           S01176
     C                     Z-ADDYR08      ZRT,8                           S01176
     C                     Z-ADDYR09      ZRT,9                           S01176
     C                     Z-ADDYR10      ZRT,10                          S01176
     C                     Z-ADDYR11      ZRT,11                          S01176
     C                     Z-ADDYR12      ZRT,12                          S01176
     C                     Z-ADDYR13      ZRT,13                          S01176
     C                     Z-ADDYR14      ZRT,14                          S01176
     C                     Z-ADDYR15      ZRT,15                          S01176
     C                     Z-ADDYR16      ZRT,16                          S01176
     C                     Z-ADDYR17      ZRT,17                          S01176
     C                     Z-ADDYR18      ZRT,18                          S01176
     C                     Z-ADDYR19      ZRT,19                          S01176
     C                     Z-ADDYR20      ZRT,20                          S01176
     C                     Z-ADDYR21      ZRT,21                          S01176
     C                     Z-ADDYR22      ZRT,22                          S01176
     C                     Z-ADDYR23      ZRT,23                          S01176
     C                     Z-ADDYR24      ZRT,24                          S01176
     C                     Z-ADDYR25      ZRT,25                          S01176
     C/COPY WNCPYSRC,SE0265C011
     C*                                                                   S01176
     C                     EXSR ZYMTX                                     S01176
     C*                                                                   S01176
     C* Calculate Price using standard subroutine ZPRCI                   S01176
     C*                                                                   S01176
     C                     Z-ADDZY1       ZPRCIN                          S01176
     C                     Z-ADDRUND      ZFDATE                          S01176
     C*                                                                   S01232
     C* If necessary then set up Australian yield parameters              S01232
     C*                                                                   S01232
     C           *IN52     IFEQ '1'                                       S01232
     C           ZZNOML    ANDNE0                                         S01232
     C                     Z-ADDLCPN      ZDCSDT                          S01176
     C                     Z-ADDRUND      ZDCEDT                          S01176
     C                     Z-ADDZZNOML    ZAMT                            S01176
     C                     EXSR ZACCZ                                     S01176
     C           ZDCINT    DIV  ZZNOML    WRKPI                           S01176
     C                     Z-ADDRUND      WRKD    50                      S01176
     C                     EXSR ZYCE                                      S01176
     C*                                                                   S01232
     C*          IF EX-COUPON THEN PI PASSED IS THE REMAINING INTEREST    S01232
     C*          TILL NCD AND IS NEGATIVE                                 S01232
     C*                                                                   S01232
     C           SCUMEX    IFEQ 'X'                                       S01232
     C                     Z-ADDLCPN      ZDCSDT                          S01232
     C                     Z-ADDNCD       ZDCEDT                          S01232
     C                     EXSR ZACCZ                                     S01232
     C           ZDCINT    DIV  ZZNOML    WKWPI  159                      S01232
     C           WRKPI     SUB  WKWPI     WRKPI                           S01232
     C                     END                                            S01232
     C                     ELSE                                           S01232
     C                     MOVE 'C'       SCUMEX                          S01232
     C                     Z-ADD0         WRKPI                           S01232
     C                     END                                            S01232
     C*                                                                   E39495
     C           ZZNOML    IFLT *ZERO                                     E39495
     C                     Z-SUBZZNOML    ZNOML                           E39495
     C                     ELSE                                           E39495
     C                     Z-ADDZZNOML    ZNOML                           E39495
     C                     END                                            E39495
     C*                                                                   S01232
     C                     EXSR ZPRCI                                     S01176
      *                                                                                       CSE035
      ** ADJUST PRICE : PRICE + PUR INT BEFORE ROUNDING                                       CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
     C           NCD       IFGE MATY                                                          CSE035
     C           SYBS      ANDEQ'AU'                                                          CSE035
     C                     Z-ADDZPRCOT    ZPRCOT                                              CSE035
     C                     ELSE                                                               CSE035
     C           SYBS      IFNE 'AU'                                                          CSE035
     C           SYBS      ANDNE'DA'                                                          CSE035
     C           STBS      ANDEQ'Y'                                                           CSE035
     C           ZPRCOT    ADD  ZWAMT     ZPRCOT                                              CSE035
     C                     END                                                                CSE035
     C                     END                                                                CSE035
      *                                                                                       CSE035
     C                     END                                                                CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
     C           NCD       IFGE MATY                                                          CSE035
     C           SYBS      ANDEQ'AU'                                                          CSE035
     C                     ELSE                                                               CSE035
      *                                                                                       CSE035
     C           SYBS      IFNE 'AU'                                                          CSE035
     C           SYBS      ANDNE'DA'                                                          CSE035
     C           STBS      ANDEQ'Y'                                                           CSE035
     C           ZPRCOT    SUB  PURINT    ZPRCOT                                              CSE035
     C                     END                                                                CSE035
     C                     END                                                                CSE035
      *                                                                                       CSE035
     C                     END                                                                CSE035
      *                                                                                       CSE035
     C/COPY WNCPYSRC,SE0265C004
     C*                                                                   S01176
     C* Use calculated price                                              S01176
     C*                                                                   S01176
     C                     Z-ADDZPRCOT    WPRICE                          S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C*
     C* Access Price File for Security and Type 'V' for Price
     C*    - if not found use Market Price from Security
     C*
     C                     MOVE 'V '      PTYP
     C**********           MOVE *ZEROS    PCST                                                CSD027
     C                     MOVE *BLANKS   PCST                                                CSD027
     C                     Z-ADD0         PDAT
     C           KEYPT     SETLLPRICT
     C           KEYPTP    READEPRICT                    99
     C           *IN99     IFEQ '1'
     C                     Z-ADDMKPR      WPRICE 158
     C                     ELSE
     C                     Z-ADDPPRC      WPRICE
     C                     END
     C                     END                                            S01176
     C*
     C********** MKPR      MULT ZZNOML    ZZNOML
     C   55      ZZNOML    MULT WPRICE    WBVAL0    H
     C   56      ZZNOML    MULT WPRICE    WBVAL1    H
     C   57      ZZNOML    MULT WPRICE    WBVAL2    H
     C   58      ZZNOML    MULT WPRICE    WBVAL3    H
     C                     END
     C*                                                                   054259
     C           PROT      IFEQ '8'                                       054259
     C/COPY WNCPYSRC,SE0265C008
     C*                                                                   054259
     C                     MOVE SESN      SDSN                            054259
     C                     MOVE 'MP'      SDET                            054259
     C                     Z-ADDRUND      SDED                            054259
     C*                                                                   054259
     C           KEYSED    SETLLSEDEVDO                                   054259
     C                     READ SEDEVDO                  65               054259
     C*                                                                   054259
     C           *IN65     IFEQ '0'                                       054259
     C           SDSN      ANDEQSESN                                      054259
     C           SDET      ANDEQ'MP'                                      054259
     C   55                MULT SDCP      WBVAL0    H                     054259
     C   56                MULT SDCP      WBVAL1    H                     054259
     C   57                MULT SDCP      WBVAL2    H                     054259
     C   58                MULT SDCP      WBVAL3    H                     054259
     C                     ELSE                                           054259
     C   55                MULT CFCT      WBVAL0    H                     054259
     C   56                MULT CFCT      WBVAL1    H                     054259
     C   57                MULT CFCT      WBVAL2    H                     054259
     C   58                MULT CFCT      WBVAL3    H                     054259
     C                     END                                            054259
     C*                                                                   054259
     C                     END                                            054259
     C/COPY WNCPYSRC,SE0265C006
     C*
     C*  Divide by 100 if price basis is P
     C*
     C           SPBS      IFEQ 'P'
     C********** ZZNOML    DIV  100       ZZNOML    H
     C   55                DIV  100       WBVAL0
     C   56                DIV  100       WBVAL1
     C   57                DIV  100       WBVAL2
     C   58                DIV  100       WBVAL3
     C                     END
     C*
     C   55                MOVE WBVAL0    WBVAL
     C   56                MOVE WBVAL1    WBVAL
     C   57                MOVE WBVAL2    WBVAL
     C   58                MOVE WBVAL3    WBVAL
     C*
     C*   Allow for nominal decimal places
     C*
     C           5         SUB  NMDP      DC      10
     C           WBVAL     MULT POWER8,DC BVAL   150
     C*
     C                     Z-ADDZZCDP     ZDECS   10
     C                     MOVE 'L'       ZECODE
     C**********           Z-ADDZZNOML    ZFLD15
     C                     MOVE BVAL      ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SSVAL
     C**
     C**   Format exposure ccy value
     C*  Obtain the Cross-Exchange Rate between the two currencies
     C**
     C                     EXSR ZXRATE
     C**
     C*  Convert from Nominal to SELECTED Currency
     C**
     C                     Z-ADDZRATEX    ZEXCH
     C                     MOVE ZMDIX     ZMD
     C*                    Z-ADDZZNOML    ZAMTCI
     C                     MOVE BVAL      ZAMTCI
     C                     MOVE NMCY      ZCCYI
     C                     MOVE CURCHK    ZCCYO
     C*                                                                   S01117
     C** FIND DECIMAL PLACES FOR (TO) CURRENCY                            S01117
     C*                                                                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM ZCCYO     @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C                     Z-ADDA6NBDP    ZCDPO                           S01117
     C*                                                                   S01117
     C*
     C                     EXSR ZCONV
     C************INU7     IFEQ '1'                                       S01117
     C***********          MOVELPROGRM    DBPGM            ************   S01117
     C***********          MOVELTKEY      DBKEY            * DATABASE *   S01117
     C***********          MOVE 'TABLE'   DBFILE           * ERROR 08 *   S01117
     C***********          Z-ADD08        DBASE            ************   S01117
     C***********          SETON                       U7U8               S01117
     C***********          MOVE '0'       RTNC                            S01117
     C***********          EXSR RETSR                                     S01117
     C***********          END                                            S01117
     C                     MOVE ZAMTCO    ZZNOML
     C**
     C**  If factored - multiply by exposure %
     C**
     C           FACCHK    IFEQ 'F'
     C           ZZNOML    MULT EXPC      ZZNOML
     C           ZZNOML    DIV  100       ZZNOML    H
     C                     END
     C**
     C**  Round to nearest 1000 - add to total - edit for output
     C**
     C***********4         SUB  CDP       ZI      10                      S01117
     C           4         SUB  A6NBDP    ZI      10                      S01117
     C           ZZNOML    MULT POWER,ZI  ZZNOML    H
     C           ZZHUND    IFGE 5
     C                     ADD  1         ZZNOMT
     C                     END
     C*********************ADD  ZZNOMT    ZZTOTE                          E22909
     C                     MOVE 'L'       ZECODE
     C                     Z-ADD0         ZDECS
     C*********************Z-ADDZZNOMT    ZFLD15                          E22909
     C           ZZNOML    IFLT 0                                         E22909
     C                     Z-ADD0         ZFLD15                          E22909
     C                     Z-SUBZZNOMT    ZFLD15                          E22909
     C                     ELSE                                           E22909
     C                     Z-ADDZZNOMT    ZFLD15                          E22909
     C                     END                                            E22909
     C***********          Z-ADDZFLD15    ZZTOTE                    E22909E25598
     C                     ADD  ZFLD15    ZZTOTE                          E25598
     C**                                                                  E22909
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SEXPV
     C**
     C                     MOVE SPLIN1    SLINE
     C                     END
     C**
     C**  SFLT=2 SECOND SECURITY/POSITION DETAILS LINE
     C**
     C           SFLT      IFEQ 2
     C                     SETON                     08
     C**
     C**   Format security short description
     C**
     C                     MOVE SESN      SSESN
     C                     MOVE NMCY      SNMCY   3
     C                     MOVE SRPN      ZSRPN
     C                     MOVE BVRIDF    ZRSFD                           S01117
     C                     EXSR ZSDESC
     C                     MOVE ZRNME     SDESC
     C**
     C                     MOVE SPLIN2    SLINE
     C                     END
      *                                                                   CGL011
      ** Check if CGL011 is installed                                     CGL011
      *                                                                   CGL011
     C           CGL011    IFEQ 'Y'                                       CGL011
     C           SFLT      IFEQ 3                                         CGL011
     C                     MOVE *BLANKS   SLINE                           CGL011
     C                     MOVELCOLLA     SLINE                           CGL011
     C                     ENDIF                                          CGL011
     C           SFLT      IFEQ 4                                         CGL011
     C                     Z-ADD0         ZDECS   10                      CGL011
     C                     MOVE 'L'       ZECODE                          CGL011
     C                     Z-ADDZZTOTE    ZFLD15                          CGL011
     C                     EXSR ZSEDIT                                    CGL011
     C                     MOVE ZOUT21    STOTE                           CGL011
     C                     MOVE TOTLIN    SLINE                           CGL011
     C           OUTREC    IFLT 13                                        CGL011
     C                     ADD  1         SFLREC                          CGL011
     C                     ADD  1         OUTREC  20                      CGL011
     C                     WRITESE0265S0                                  CGL011
     C                     MOVE *BLANKS   SLINE                           CGL011
     C                     ENDIF                                          CGL011
     C                     ENDIF                                          CGL011
      *                                                                   CGL011
      ** CGL011 is not installed                                          CGL011
      *                                                                   CGL011
     C                     ELSE                                           CGL011
     C**
     C**  SFLT=3 TOTAL LINE
     C**
     C           SFLT      IFEQ 3
     C                     SETON                     08
     C**
     C**   Edit total exposure
     C**
     C                     Z-ADD0         ZDECS   10
     C                     MOVE 'L'       ZECODE
     C                     Z-ADDZZTOTE    ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    STOTE
     C**
     C                     MOVE TOTLIN    SLINE
     C**
     C**   And output details to subfile
     C**   Output blank line if not end of sfl page
     C**
     C           OUTREC    IFLT 13
     C                     ADD  1         SFLREC
     C                     ADD  1         OUTREC  20
     C                     WRITESE0265S0
     C                     MOVE *BLANKS   SLINE
     C                     END
     C                     END
     C                     ENDIF                                          CGL011
     C**
     C**   And output details to subfile
     C**
     C                     ADD  1         SFLREC
     C                     ADD  1         OUTREC  20
     C                     WRITESE0265S0
     C**
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**   LINK   SR  Lower level Enquiry requested                   *
     C**                                                              *
     C**   Called by  MAIN                                            *
     C**                                                              *
     C**   Calls  SR  none                                            *
     C**                                                              *
     C**   Calls PGM  lower level enquiry obtained from SECOND        *
     C**                                                              *
     C*****************************************************************
     C**
0740 C           LINK      BEGSR                           *** LINK ******
0741 C**
     C**   Access Linked Enquiry Control File for program and option
     C**
     C           LKEY      KLIST
     C                     KFLD           PGMNO
     C                     KFLD           OPTN
     C**
     C********** LKEY      CHAINSECONDF              42                                     MD058079
     C                     CALL 'AOSECOR0'             90                                   MD058079
     C                     PARM *BLANKS   @RTCD   7                                         MD058079
     C                     PARM '*KEY'    @OPTN   7                                         MD058079
     C                     PARM PGMNO     @XPGM   8                                         MD058079
     C                     PARM OPTN      @XOPT   2                                         MD058079
     C           SECOND    PARM SECOND    DSFDY                                             MD058079
     C                     SETOF                     42                                     MD058079
     C           @RTCD     IFNE *BLANKS                                                     MD058079
     C                     SETON                     42                                     MD058079
     C                     ENDIF                                                            MD058079
     C**
     C**   If record not found then entered option is invalid
     C**
     C           *IN42     IFEQ '1'
     C                     MOVE MSG,4     ERMSG
     C**
     C                     ELSE
     C**
     C*****For*valid*option*write*out*LDA*and*linked*enquiry*data*area****S01117
     C**   For valid option write out linked enquiry data area            S01117
     C**   and call the program name obtained from SECOND
     C**
      ** If CAC005 is on, retrieve user book from AOBKPCR0.               178731
      *                                                                   178731
     C           CAC005    IFEQ 'Y'                                       178731
     C                     CALL 'AOBKPCR0'                                178731
     C                     PARM *BLANKS   PRTCD                           178731
     C                     PARM '*USER  ' POPTN                           178731
     C                     PARM *BLANKS   PBKCD                           178731
     C                     PARM *BLANKS   PPRFC                           178731
     C                     PARM RQBOOK    PPSBK                           178731
     C           PRTCD     IFEQ *BLANKS                                   178731
     C                     MOVE PBKCD     RQBOOK                          178731
     C                     ENDIF                                          178731
     C                     ENDIF                                          178731
      *                                                                   178731
     C                     OUT  SESDS
     C                     OUT  LDA
     C                     CALL TPGM
     C           *LOCK     IN   LDA
     C           *LOCK     IN   SESDS
     C**
     C**   On return from lower level check return code
     C**
     C**   If 0 (Database Error) or 1 (F3 to return to menu)
     C**      then exit to calling program
     C**
     C           RTNC      IFEQ '0'
     C           RTNC      OREQ '1'
     C                     MOVE '1'       *IN01
     C                     END
     C**
     C**   If Return code is 7 (F9 to return to inital enquiry)
     C**      then check if this is the inital enquiry
     C**      and if not return to calling program
     C**
     C           RTNC      IFEQ '7'
     C           ORIG      ANDNEPGMNO
     C                     MOVE '1'       *IN01
     C                     END
     C**
     C                     END
     C**
     C**
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**   RETSR  SR  End of Program Processing                       *
     C****************Write*out*LDA*and*linked*enquiry*data*area**********S01117
     C**              Write out linked enquiry data area                  S01117
     C**              and return to the calling program               *
     C**                                                              *
     C**   Called by  MAIN, FIRST, DISP                               *
     C**                                                              *
     C**   Calls  SR  none                                            *
     C**                                                              *
     C*****************************************************************
     C**
     C           RETSR     BEGSR                           *** RETSR   ***
     C**
     C                     OUT  SESDS
     C                     OUT  LDA
     C**
     C                     SETON                     LR
     C**
     C                     RETRN
     C*
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**   FIRST  SR  First Cycle Processing                          *
     C**                                                              *
     C**   Called by  MAIN                                            *
     C**                                                              *
     C*****Calls**SR**RETSR,*CUSTIN,*ZSYSTM,*ZICD2,*ZICDSE****************S01117
     C**   Calls  SR  RETSR, CUSTIN                                   *   S01117
     C**                                                              *
     C*****************************************************************
     C**
     C**
     C           FIRST     BEGSR                           ** FIRST **
     C**
     C*******Access*the*LDA**and**Linked*Enquiry*Data*Area****************S01117
     C**     Access the Linked Enquiry Data Area                          S01117
     C**
     C           *LOCK     IN   LDA
     C           *LOCK     IN   SESDS
     C           *LOCK     IN   JNSTAT
     C                     UNLCKJNSTAT
     C**
     C*******Access*the*ICD*record*1*for*run*date*&*date*format***********S01117
     C***********                                                         S01117
     C***********          EXSR ZSYSTM                                    S01117
     C**Error*in*ZSYSTM***************************************************S01117
     C***********                                                         S01117
     C                     CALL 'AOBANKR0'                                S01117
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C           SDBANK    PARM SDBANK    DSFDY                           S01117
      *                                                                   S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          MOVELPROGRM    DBPGM            ************   S01117
     C***********          MOVEL'ICDR1'   DBKEY            **DATABASE*****S01117
     C***********          MOVE 'TABLE'   DBFILE           **ERROR*01*****S01117
     C***********          Z-ADD01        DBASE            ************   S01117
     C***********          SETON                       U7U8               S01117
     C***********          MOVE '0'       RTNC                            S01117
     C***********          EXSR RETSR                                     S01117
     C***********          END                                            S01117
     C                     MOVE *BLANKS   RTNC
     C*****************************************************************   S01117
     C*******Access*the*ICD*record*2***********************************   S01117
     C***********                                                         S01117
     C***********          EXSR ZICD2                                     S01117
     C**********           CALL 'AOGELRR0'                                S01117              CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C********** SDGELR    PARM SDGELR    DSFDY                           S01117              CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C*                                                                   S01117
     C***********                                                         S01117
     C**Error*in*ZICD2*************************************************   S01117
     C*
     C************IN99     IFEQ '1'                                       S01117
     C***********          MOVELPROGRM    DBPGM            ************   S01117
     C***********          MOVEL'ICDR2'   DBKEY            **DATABASE*****S01117
     C***********          MOVE 'TABLE'   DBFILE           **ERROR*02*****S01117
     C***********          Z-ADD02        DBASE            ************   S01117
     C***********          SETON                       U7U8               S01117
     C***********          MOVE '0'       RTNC                            S01117
     C***********          EXSR RETSR                                     S01117
     C***********          END                                            S01117
     C*                                                                   S01117
     C**********           CALL 'AODEALR0'                                S01117              CGL029
     C                     CALL 'AODEALR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C********** SDDEAL    PARM SDDEAL    DSFDY                           S01117              CGL029
     C           SDDEAL    PARM SDDEAL    DSSDY                                               CGL029
     C*                                                                   S01117
     C**
     C**  ACCESS DATA AREA RUNDAT                                         S01117
     C**                                                                  S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C                     IN   RUNDT                                     S01117
     C*                                                                   S01117
     C**   CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.                    S01117
     C*                                                                   S01117
     C           DATF      COMP 'M'                      98               S01117
     C**                                                                  S01117
     C**     Determine if Multibranch (set *in07 on if so)
     C**
     C           MBIN      IFEQ 'Y'
     C                     SETON                     07
     C                     ELSE
     C                     SETOF                     07
     C                     END
     C**
     C*******Access*the*ICD*record*SE*for*default*branch******************S01117
     C*****************************************************************   S01117
     C***********          EXSR ZICDSE                                    S01117
     C*                                                                   S01117
     C**   ACCESS SECURITIES TRADING DETAIL                               S01117
     C                     CALL 'AOSTRDR0'                                S01117
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C           SDSTRD    PARM SDSTRD    DSSDY                           S01117
      *                                                                   CAC005
      ** Check if CAC005 is installed                                     CAC005
      *                                                                   CAC005
     C                     CALL 'AOSARDR0'                                CAC005
     C                     PARM *BLANKS   PRTCD   7                       CAC005
     C                     PARM '*VERIFY' POPTN   7                       CAC005
     C                     PARM 'CAC005'  PSARD   6                       CAC005
      *                                                                   CAC005
     C           PRTCD     IFEQ *BLANKS                                   CAC005
     C                     MOVE 'Y'       CAC005  1                       CAC005
     C                     MOVE *ON       *IN61                           CAC005
     C                     ELSE                                           CAC005
     C                     MOVE 'N'       CAC005                          CAC005
     C                     MOVE *OFF      *IN61                           CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CGL011
      ** Check of CGL011 is installed                                     CGL011
      *                                                                   CGL011
     C                     CALL 'AOSARDR0'                                CGL011
     C                     PARM *BLANKS   PRTCD   7                       CGL011
     C                     PARM '*VERIFY' POTPN   7                       CGL011
     C                     PARM 'CGL011'  PSARD   6                       CGL011
     C           SCSARD    PARM SCSARD    DSFDY                           CGL011
      *                                                                   CGL011
     C           PRTCD     IFEQ *BLANKS                                   CGL011
     C                     MOVE 'Y'       CGL011  1                       CGL011
      *                                                                   CGL011
     C                     ELSE                                           CGL011
     C                     MOVE 'N'       CGL011                          CGL011
     C           PRTCD     IFNE '*NRF   '                                 CGL011
     C           *LOCK     IN   LDA                                       CGL011
     C                     MOVELPROGRM    DBPGM            ***************CGL011
     C                     Z-ADD013       DBASE            * DB ERROR 013*CGL011
     C                     MOVEL'SCSARDPD'DBFILE           ***************CGL011
     C                     MOVEL'CGL011  'DBKEY                           CGL011
     C                     MOVE *ON       *INU7                           CGL011
     C                     MOVE *ON       *INU8                           CGL011
     C                     EXSR *PSSR                                     CGL011
     C                     MOVE '0'       RTNC                            CGL011
     C                     EXSR RETSR                                     CGL011
     C                     ENDIF                                          CGL011
     C                     ENDIF                                          CGL011
      *                                                                                       CGL014
      ** Check of CGL014 is installed                                                         CGL014
      *                                                                                       CGL014
     C                     CALL 'AOSARDR0'                                                    CGL014
     C                     PARM *BLANKS   PRTCD                                               CGL014
     C                     PARM '*VERIFY' POTPN                                               CGL014
     C                     PARM 'CGL014'  PSARD                                               CGL014
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL014
      *                                                                                       CGL014
     C           PRTCD     IFEQ *BLANKS                                                       CGL014
     C                     MOVE 'Y'       CGL014  1                                           CGL014
      *                                                                                       CGL014
     C                     ELSE                                                               CGL014
     C                     MOVE 'N'       CGL014                                              CGL014
     C           PRTCD     IFNE '*NRF   '                                                     CGL014
     C           *LOCK     IN   LDA                                                           CGL014
     C                     MOVELPROGRM    DBPGM                                               CGL014
     C                     Z-ADD014       DBASE                                               CGL014
     C                     MOVEL'SCSARDPD'DBFILE                                              CGL014
     C                     MOVEL'CGL014  'DBKEY                                               CGL014
     C                     MOVE *ON       *INU7                                               CGL014
     C                     MOVE *ON       *INU8                                               CGL014
     C                     EXSR *PSSR                                                         CGL014
     C                     MOVE '0'       RTNC                                                CGL014
     C                     EXSR RETSR                                                         CGL014
     C                     ENDIF                                                              CGL014
     C                     ENDIF                                                              CGL014
     C*                                                                   S01117
     C*
     C**Error*in*ZICDSE************************************************   S01117
     C*
     C************IN99     IFEQ '1'                                       S01117
     C***********          MOVELPROGRM    DBPGM            ************   S01117
     C***********          MOVEL'ICDSE'   DBKEY            **DATABASE*****S01117
     C***********          MOVE 'TABLE'   DBFILE           **ERROR*03*****S01117
     C***********          Z-ADD03        DBASE            ************   S01117
     C***********          SETON                       U7U8               S01117
     C***********          MOVE '0'       RTNC                            S01117
     C***********          EXSR RETSR                                     S01117
     C***********          END                                            S01117
     C**
     C**  ACCESS ZMUSER FOR DEFAULT BRANCH CODE                           S01117
     C**                                                                  S01117
     C           *NAMVAR   DEFN           ZMUSER                          S01117
     C                     IN   ZMUSER                                    S01117
     C**                                                                  S01117
     C**      Access program name - for help and linked enquiries
     C**
     C                     MOVELPROGRM    PGMNO   8
     C                     MOVELPROGRM    DBPGM
     C                     MOVE 'TOTAL E' STOT1
     C                     MOVE 'XPOSURE' STOT2
     C                     MOVE 'FACTO'   FAC1
     C                     MOVE 'RED  '   FAC2
     C                     MOVE 'UNFAC'   UFAC1
     C                     MOVE 'TORED'   UFAC2
      *                                                                                       CSE035
      ** Access SAR details file to see if CSE035 is installed                                CSE035
      *                                                                                       CSE035
     C                     CALL 'AOSARDR0'                                                    CSE035
     C                     PARM *BLANKS   @RTCD                                               CSE035
     C                     PARM '*VERIFY' @OPTN                                               CSE035
     C                     PARM 'CSE035'  WSARD   6                                           CSE035
      *                                                                                       CSE035
     C           @RTCD     IFEQ *BLANK                                                        CSE035
     C                     MOVE 'Y'       CSE035  1                                           CSE035
     C                     ELSE                                                               CSE035
     C                     MOVE 'N'       CSE035                                              CSE035
     C                     END                                                                CSE035
      *                                                                                       CSE035
      ** Access SAR details file to see if CUE018 is installed                                207543
      *                                                                                       207543
     C                     CALL 'AOSARDR0'                                                    207543
     C                     PARM *BLANKS   @RTCD                                               207543
     C                     PARM '*VERIFY' @OPTN                                               207543
     C                     PARM 'CEU018'  WSARD   6                                           207543
      *                                                                                       207543
     C           @RTCD     IFEQ *BLANK                                                        207543
     C                     MOVE 'Y'       CEU018  1                                           207543
     C                     ELSE                                                               207543
     C                     MOVE 'N'       CEU018                                              207543
     C                     END                                                                207543
      *                                                                                     MD057247
      ** Access Switchable Features file to determine if CSE031 is                          MD057247
      ** installed in the system.                                                           MD057247
      *                                                                                     MD057247
     C                     CALL 'AOSARDR0'                                                  MD057247
     C                     PARM           URTNCD  7                                         MD057247
     C                     PARM '*VERIFY' UOPTN   7                                         MD057247
     C                     PARM 'CSE031'  UUKEY   6                                         MD057247
     C                     PARM           UDSFDY 76                                         MD057247
      *                                                                                     MD057247
     C                     MOVE 'N'       CSE031  1                                         MD057247
     C           URTNCD    IFEQ *BLANKS                                                     MD057247
     C                     MOVE 'Y'       CSE031                                            MD057247
     C                     ENDIF                                                            MD057247
      *                                                                                     MD057247
      ** Access Switchable Features file to determine if CSE071 is                          MD057247
      ** installed in the system.                                                           MD057247
      *                                                                                     MD057247
     C                     CALL 'AOSARDR0'                                                  MD057247
     C                     PARM           URTNCD                                            MD057247
     C                     PARM '*VERIFY' UOPTN                                             MD057247
     C                     PARM 'CSE071'  UUKEY                                             MD057247
     C                     PARM           UDSFDY                                            MD057247
      *                                                                                     MD057247
     C                     MOVE 'N'       CSE071  1                                         MD057247
     C           URTNCD    IFEQ *BLANKS                                                     MD057247
     C                     MOVE 'Y'       CSE071                                            MD057247
     C                     ENDIF                                                            MD057247
      *                                                                                     MD057247
     C/COPY WNCPYSRC,SE0265C005
     C**
     C**     If no issuer shortname found in request data
     C**        clear screen fields
     C***       else - process from this data
     C**
     C                     EXSR CLEAR
     C********** RQCUST    IFNE *ZEROS                                                        CSD027
     C           RQCUST    IFNE *BLANKS                                                       CSD027
     C           RQCUST    ANDNE*ZEROS                                                      BUG11747
     C**
     C                     MOVELRQCUST    ISSUER
     C                     MOVE *BLANKS   RQCUST
     C**
     C                     EXSR CUSTIN
     C                     END
     C**
     C/COPY WNCPYSRC,SE0265C012
     C                     ENDSR
     C**
     C/EJECT                                                              S01117
     C********************************************************************S01117
     C**                                                                  S01117
     C**   *PSSR SR.- DATABASE ERROR SUBROUTINE                           S01117
     C**                                                                  S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR SR ** S01117
     C**                                                                  S01117
     C           @RUN      IFEQ *BLANK                                    S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     ENDSR                                          S01117
     C**                                                                  S01117
     C********************************************************************S01117
      /EJECT                                                              S01232
     C/COPY ZSRSRC,ZACCH                                                  S01195
      /EJECT                                                              S01195
     C*/COPY*ZSRSRC,XDATE3Z1***                                     S01232S01195
     C/COPY ZSRSRC,ZBKDT                                                  S01195
      /EJECT                                                              S0S012
     C/COPY ZSRSRC,ZACCRZ1                                                S0S012
      /EJECT                                                              S01232
     C/COPY ZSRSRC,ZACCZZ1                                                S01232
     C/EJECT                                                              E39495
     C/COPY ZSRSRC,ZCALCD                                                 E39495
     C/EJECT                                                              E39495
     C/COPY ZSRSRC,ZCNSDZ1                                                E39495
      /EJECT
     C*/COPY*ZSRSRC,ZALIGNZ2***                                           S01117
     C*/EJECT******************                                           S01117
     C/COPY ZSRSRC,ZCONVZ1
      /EJECT
     C/COPY ZSRSRC,ZDATE1Z2
      /EJECT
     C/COPY ZSRSRC,ZDATE2Z4
      /EJECT
AB   C/COPY ZSRSRC,ZDAYSZ2
      /EJECT
AB   C/COPY ZSRSRC,ZDYYRZ3
      /EJECT
AB   C/COPY ZSRSRC,ZEVCDZ1
     C*EJECT*****************                                             S01117
     C*COPY*ZSRSRC,ZICD2Z1***                                             S01117
     C*EJECT*****************                                             S01117
     C*COPY*ZSRSRC,ZICDSEZ1**                                             S01117
      /EJECT                                                              E20380
     C/COPY ZSRSRC,ZLCDZ1                                                            E20380 MD057247
      /EJECT
AB   C/COPY ZSRSRC,ZNCDZ3
      /EJECT                                                              S01176
     C/COPY ZSRSRC,ZPRCIZ1                                                S01176
      /EJECT
AB   C/COPY ZSRSRC,ZPRCOZ1
      /EJECT                                                              S01232
     C/COPY ZSRSRC,ZRATEZ1                                                S01232
      /EJECT
     C/COPY ZSRSRC,ZSDESCZ3
      /EJECT
     C/COPY ZSRSRC,ZSEDITZ3
      /EJECT
     C*/COPY*ZSRSRC,ZSYSTMZ1***                                           S01117
     C*/EJECT******************                                           S01117
     C/COPY ZSRSRC,ZXRATEZ1
      /EJECT                                                              S01232
     C/COPY ZSRSRC,ZYCEZ1                                                 S01232
      /EJECT                                                              S01176
     C/COPY ZSRSRC,ZYLDIZ1                                                S01176
      /EJECT
     C/COPY ZSRSRC,ZYLDOZ1
      /EJECT
     C/COPY ZSRSRC,ZYLDZ2
      /EJECT                                                              S01176
     C/COPY ZSRSRC,ZYMTXZ2                                                S01176
      /EJECT
      ***
      ***  Extra element added to MSG Array.                              E23190
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   MSG  - ERROR MESSAGES
ENTER AN ISSUER NO./SHORTNAME OR TAKE F/6 FOR SHORTNAME ENQUIRY
INVALID ENTRY - BOTH ISSUER NO./SHORTNAME AND OPTION ENTERED
INVALID ENTRY - ONLY ONE OPTION MAY BE SELECTED
INVALID OPTION - VALID OPTIONS ARE 1, 2 OR 3
INVALID ISSUER NO./SHORTNAME - PLEASE RE-ENTER OR TAKE F/6
THIS IS THE INITIAL ENQUIRY - F/3 WILL EXIT TO MENU
ENTER AN ISSUER NUMBER OR SHORTNAME, OR SELECT AN OPTION
INVALID BRANCH - PLEASE RE-ENTER
INVALID CUSTOMER NO./SHORTNAME - PLEASE RE-ENTER OR TAKE F/6
INVALID BOOK - PLEASE RE-ENTER
INVALID CURRENCY - PLEASE RE-ENTER
INVALID FACTORED/UNFACTORED - PLEASE RE-ENTER
F/6 INVALID AS NEITHER ISSUER OR SECURITY IS BLANK
OPTION NOT ALLOWED FOR USER POSITION
OPTION NOT ALLOWED FOR CUSTOMER POSITION
NOT A SAFE CUSTODY OR DISCRETIONARY CUSTOMER
USER IS NOT AUTHORISED TO ENQUIRE ON THIS BRANCH
USER IS NOT AUTHORISED TO ANY BRANCH
USER NOT AUTHORISED TO BANK LEVEL AUTHORITY - 'ALL' NOT ALLOWED
PROFIT CENTRE SHOULD NOT BE ENTERED IF BOOK IS NOT ENTERED
PROFIT CENTRE SHOULD BE ENTERED IF BOOK IS ENTERED
PROFIT CENTRE NOT VALID
PROFIT CENTRE IS NOT AUTHORISED TO USE THE BOOK
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)                      S01176
0006001521029820444305904073650882610287117481320914670161311759219053    S01176
2051421975234362489726358278192928030741322023366335124365853804639507    S01176
40968424294389045351                                                      S01176
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**  POWER8 - ARRAY OF POWERS FOR NOMINAL DP TO CURRENCY DP CONVERSION
00000001
00000010
00000100
00001000
00010000
00100000
01000000
10000000
**  CPY@
(c) Finastra International Limited 2001
