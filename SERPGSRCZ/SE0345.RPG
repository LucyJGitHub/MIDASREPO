     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Average Prices List')
     F*****************************************************************
     F*                                                               *
     F*  Midas - Securities Trading Module
     F*                                                               *
     F***SE0345*-*PRICES*LIST******************************************   E38656
     F*  SE0345 - AVERAGE PRICES LIST                                 *   E38656
     F*                                                               *
     F*  Function:  This program produces a report, for audit         *
     F****(I/C)*****purposes,*of*all*prices*defined*to*the*system.*****   E38656
     F*   (I/C)     purposes, of all average prices defined to the    *   E38656
     F*             system.                                           *   E38656
     F*   (COB)     The sequence of the report is branch, price type, *
     F*             security, value date, customer number.            *
     F*             The report is available in 3 modes (I,A,L):       *
     F*                                                               *
     F*  Called By: 1) SEC0301 - Audit Reports - Input Cycle          *
     F*             2) SEC0601 - Audit Reports - Close of Business    *
     F*             3) SEC0302 - Full Lists - On Request              *
     F*                                                               *
     F*             Frequency:                                        *
     F*             1) On request during I/C; an interim report       *
     F*                showing the latest status of prices inserted,  *
     F*                amended or deleted during the day.             *
     F*             2) During COB; a report of all prices inserted,   *
     F*                amended or deleted during the day.             *
     F*             3) On request; a report of all live prices in the *
     F*                system (ie. deleted items are not included).   *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                               *
      *  Last Amend No. 226449             Date 24Jun15               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Prev Amend No. CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSE071             Date 19Jul05               *
      *                 CGL029             Date 01Sep03               *
      *                 194370             Date 12Jul01               *
      *                 CSE035             Date 22Apr02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CSE031             Date 09Nov01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CPB001             DATE 18Jun99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CAC005             Date 12Nov98               *
      *                 CSE005             Date 04Feb97               *
      *                 084704             Date 01Aug96               *
     F*                 083039             DATE 01AUG96               *
     F*                 059110             DATE 01AUG96               *
     F*                 088047             DATE 26JUN96               *
     F*                 S01408             DATE 29APR96               *
     F*                 091254             DATE 20OCT95               *
     F*                 086491             DATE 15JUN95               *
     F*                 S01486             DATE 27OCT94               *
     F*                 052927             DATE 27JAN94               *
     F*                 052254             DATE 10JAN94               *
     F*                 054729             DATE 15SEP93               *
     F*                 S01401             DATE 16JUN93               *
     F*                 S01397             DATE 10SEP92               *
     F*                 E38656             DATE 22APR92               *
     F*                 E35515             DATE 10FEB92               *
     F*                 E29170             DATE 08NOV91               *
     F*                 E28989             DATE 30SEP91               *
     F*                 E28705             DATE 24SEP91               *
     F*                 S01220             DATE 12NOV90               *
     F*                 S01117             DATE 31OCT90               *
     F*                 S01269             DATE 18OCT90               *
     F*                 E16772             DATE 19JUN89               *
     F*                 S01169             DATE 11NOV88               *
     F*                 E15434             DATE 06OCT88               *
     F*                 E15278             DATE 05/10/88              *
     F*                 S01176             DATE 14/09/88              *
     F*                 E13489             DATE 02/06/88              *
     F*                 S01158             DATE 12/05/88              *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  226449 - Recompiled over changes made in /COPY ZDYYRZ3.      *
      *         - Applied for MD034387.                               *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  194370 - Recompile after change on copy sources ZYLDZ2,      *
      *           For securities with divisor basis = '5' and first   *
      *           coupon date > valuation date (rundate + 1), set     *
      *           event control date to first coupon date before      *
      *           processing SR/ZDYYR. This is to ensure that the     *
      *           correct hypothetical last and next coupon dates are *
      *           used in deriving the price/yield rate.              *
      *  CSE035 - NX/NNX Coupon Payment Processing.                   *
      *           Recompile over changed ZYLDZ2
     F*  CSE031 - Coupon Fixing for Floating Rate Notes.              *
     F*           (recompilation due to change to ZNCD/ZLCD)          *
     F*  CPB001 - 'Private Banking' Module                            *
      *  CAC005 - PCA-SE Enhancement.                                 *
     F*  CSE005 - Effect of holidays on FRN Coupon Dates              *
     F*           (recompilation due to change to ZNCD/ZLCD)          *
     F*  084704 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
     F*  083039 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
     F*  059110 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
     F*  088047 - RECOMPILE over change SR/ZYLDZ2.                    *
     F*  S01408 - Addition of core hooks: SE0345CCP1                  *
     F*                                   SE0345CCP2                  *
     F*                                   SE0345CCP3                  *
     F*                                   SE0345CCP4                  *
     F*                                   SE0345CCP5                  *
     F*                                   SE0345CCP6                  *
     F*                                   SE0345CCP7                  *
     F*                                   SE0345CCP8                  *
     F*                                   SE0345CCP9                  *
     F*                                   SE0345CP10                  *
     F*                                   SE0345CP11                  *
     F*                                   SE0345CP12                  *
     F*                                   SE0345CP13                  *
     F*                                   SE0345CP14                  *
     F*  091254 - RECOMPILE OVER CHANGED ZLCDZ1 & ZNCDZ3              *
     F*  086491 - Wrong nbr of days calculated for day basis 1        *
     F*           when start or end day is last day of February       *
     F*           Recompiled for ZSRSRC/ZDAYSZ2 changes.              *
     F*  S01486  -  PORTFOLIO MANAGEMENT ENHANCEMENT                  *
     F*  052927 - Trying to write to closed printer file still -      *
     F*           fix 054729 was inadequate.                          *
     F*  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
     F*           to 10,9                                             *
     F*  054729 - Trying to write to closed printer file              *
     F*  S01401 - MT5xx SWIFT Messages Feature:                       *
     F*          - Recompiled due to changes to files.                *
     F*  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
     F*          - Recompiled due to changes to files.                *
     F*  E38656 - Market and average prices are now produced on       *
     F*           separate reports (Market prices produced in SE0344) *
     F*  E35515 - Recompiled over changed PRTF                        *
     F*  E29170 - Report Control                                      *
     F*  E28989 - U8 set on incorrectly which causes file controls out*
     F*           of balance.                                         *
     F*  E28705 - Recompiled over changed PRTF                        *
     F*  S01220 - STRATEGIC RISK MANAGEMENT                           *
     F*           Recompiled over changed PF/SECTYD                   *
     F*  S01117 - Multibranching                                      *
     F*  S01269 - Trade authorisation: recompiled over changed file   *
     F*           TABSE.                                              *
     F*  E16772 - Recompiled for the Dividend Payment Amount field    *
     F*           changes.                                            *
     F*  S01169 - JULIUS BAER INCORPORATION CHANGES                   *
     F*  E15434 - RECOMPILE PROGRAM OVER PRINTER FILE CHANGES         *
     F*  E15278 - PRICE FIELD IS ALREADY IN P/D/Y FORMAT              *
     F*  S01176 - SECURITIES TRADING 3.1                              *
     F*  E13489 - Audit file not reset for cancellations              *
     F*  S01158 - POST INCORPORATION DEVELOPMENT FIXES                *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
      *
     FPRICBLCDIF  E           K        DISK                           UC
     FPRICB   IF  E           K        DISK                           UC
     F            PRICEDF                           KRENAMEPRICEDFX
     FTABSE   IF  E           K        DISK
     F            TABTB10F                          KIGNORE               S01117
     F            TABTB11F                          KIGNORE               S01117
     F            TABLETAF                          KIGNORE
     F*********** TABTB36F                          KIGNORE        S01176 S01117
     F            TABTE10F                          KIGNORE
     F            TABTE20F                          KIGNORE
     F            TABTG10F                          KIGNORE
     F            TABTG20F                          KIGNORE
     F            TABLETHF                          KIGNORE
     F*********** TABLETJF                          KIGNORE               S01117
     F            TABLETKF                          KIGNORE
     F            TABLETLF                          KIGNORE
     F            TABLETRF                          KIGNORE               S01117
     F            TABLETNF                          KIGNORE
     F            TABLETPF                          KIGNORE
     F            TABLETXF                          KIGNORE
     F            TABLET2F                          KIGNORE
     F            TABLET3F                          KIGNORE
     F            TABLET5F                          KIGNORE
     FCLINT   IF  E           K        DISK
     F            CLINTCAF                          KIGNORE
     F            CLINTCCF                          KIGNORE
     F            CLINTC1F                          KIGNORE
     F            CLINTSEF                          KIGNORE
     FSECTY   IF  E           K        DISK
     F***SEDEV   IF  E           K        DISK                            S01176
     FPRICEA  UF  E           K        DISK
     FSE0345P1O   E                    PRINTER                        UC
     F                                              KINFDS SPOOL          S01117
     FSE0345AUO   E                    PRINTER
     F                                              KINFDS SPOOLU         S01117
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*   32       PRIVATE BANKING MODULE PRESENT                     *   CPB001
     F*   35       MULTIBRANCHING                                     *   S01117
     F*   36       'NO DETAILS TO REPORT'                             *   S01117
     F*   37       PORTFOLIOMANAGEMENT MODULE PRESENT                 *   S01486
     F*   40       INPUT PARAMETER IS I (INPUT CYCLE MODE)            *
     F*   41       INPUT PARAMETER IS A (AUDIT MODE)                  *
     F*   42       INPUT PARAMETER IS L (FULL LIST MODE)              *
     F*   45       BRANCH IS NOT 0/NOT BANK WIDE PRICE                *
     F*   46-49    PRINT MARKET LEGEND                                *
     F*   50       END OF INPUT FILE / FILE READ ERROR                *
     F*   51-53    PRINT AMD/INS/DEL LEGEND                           *
     F*   54       PRINT 'DIFFERENCE' LEGEND                          *
     F*   55       DETAIL REPORT OPEN                                 *
     F*   56       NO CLINTCB RECORD                                  *
     F****57*******NO*TABLETR*RECORD*******************************   *   S01117
     F*   58       NO SECTY RECORD                                    *
     F*   60       OPEN/CLOSE PRINTER FILE SE0345P1                   *
     F*   70       BOUNDARY WARNING INDICATOR ON ON PF/PRICED.        *   S01169
      *  65 - CAC005 is on, display profit centre in the printer file *   CAC005
     F*   71       PERCENTAGE WARNING INDICATOR ON ON PF/PRICED.      *   S01169
     F*   72       EXTEL OPTION INDICATOR IS 'Y'                      *   S01169
     F*   90-99    USED IN STANDARD SUB-ROUTINES                      *
     F*   U7       DATABASE ERROR                                     *
     F*   U8       DATABASE / CONTROL ERROR                           *
     F*                                                               *
     F*****************************************************************
     F/SPACE 3
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F****ZSYSTM*-*ACCESS*ICD*RECORD**************************************S01117
     F*  ACCBR  - ACCESS BRANCH DETAILS                               *   S01117
     F*  DBERR  - DATABASE ERROR CONTROL                              *   S01117
     F*  RCFAU  - RCF PROCESSING FOR AUDIT REPORT                     *   S01117
     F*  RCFP1  - RCF PROCESSING FOR P1 REPORT                        *   S01117
     F*  *PSSR  - ERROR HANDLING                                      *   S01117
     F*   ZDATE2 - DAYNO - DATE CONVERSION                            *
     F*   ZICDSE - ACCESS SE ICD                                      *   S01117
     F****ZPRCO**-*OUTPUT*PRICE*AS*PRICE/DISCOUNT/YIELD****************   S01176
     F****ZDAYS**-*CALCS NUMBER OF DAYS BETWEEN TWO DATES**************   E15278
     F****ZDYYR**-*CALCS NUMBER OF DAYS IN INTEREST YEAR***************   E15278
     F****ZYLDO**-*OUTPUT*PRICE*AS*PRICE/DISCOUNT/YIELD****************   S01176
     F****ZNCD***-*DETERMINE NEXT COUPON RATE**************************   E15278
     F****ZDATE1*-*VALIDATE/CONVERT TO DAYS SUBMITTED DATE*************   E15278
     F****ZEVCD**-*DETERMINE EVENT CONTROL DATE************************   E15278
     F****ZICD2**-*ACCESS*ICD*RECORD**************************************S01117
     F*   ZSEDIT - INSERT DECIMAL POINTS/SIGN NUMERIC FIELD           *
     F*                                                               *
     F*****************************************************************
      /EJECT
     E                    CPY@    1   1 80
     E*COPY*ZSRSRC,ZDAYSZ1****                                            E15278
     E/COPY ZSRSRC,ZDATE2Z1
     E*
     E*COPY*ZSRSRC,ZNCDZ1*****                                            E15278
     E*
     E/COPY ZSRSRC,ZSEDITZ1
      /EJECT
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*
     I*DA********UDS                            256                       S01117
     I***********                           134 177 DBLOT                 S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 177 DBASE                 S01117
     ILDA         DS                            256                       S01117
     I                                      134 183 DBLOT                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     I**                                                                  S01117
     I**  EXTERNAL DS FOR BANK DETAILS                                    S01117
     ISDBANK    E DSSDBANKPD                                              S01117
     I              BJURPT                          TITL                  S01117
     I**                                                                  S01117
     I**  EXTERNAL DS FOR BRANCH CODE DETAILS                             S01117
     ISDBRCH    E DSSDBRCHPD                                              S01117
     I              A8BRNM                          BRNM                  S01117
     I**                                                                  S01117
     I**  DATA STRUCTURE FOR RUN DATE DETAILS                             S01117
     IRUNDT       DS                                                      S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
     I*  DS FOR LINE NO. TO HANDLE OVERFLOW                               S01117
     ISPOOL       DS                                                      S01117
     I                                       83  92 SFILE                 S01117
     I                                    B 123 1240SFNUM                 S01117
     I**                                                                  S01117
     ISPOOLU      DS                                                      S01117
     I                                       83  92 SFILEU                S01117
     I                                    B 123 1240SFNUMU                S01117
     I**                                                                  S01117
     I** DATA STRUCTURE FOR ACCESS OBJECTS, SHORT DATA STRUCTURE          S01117
     IDSFDY     E DSDSFDY                                                 S01117
     I*                                                                   S01486
     I** Portfolio Definition Via Access Program                          S01486
     I*                                                                   S01486
     ISDPORT    E DSSDPORTPD                                              S01486
     I*                                                                   S01486
     I**  EXTERNAL DS FOR MMOD acces object                               S01486
     I*                                                                   S01486
     ISDMMOD    E DSSDMMODPD                                              S01486
     I**                                                                  S01117
     I*
     I           SDS
     I                                      244 246 WSID
     I                                      254 263 USID
     I*COPY*ZSRSRC,ZNCDZ2*****                                            E15278
     I/COPY ZSRSRC,ZSEDITZ2
     I* DATA STRUCTURE FOR FILE KEYS
     I*
     I            DS
     I                                        1  12 TRKEY
     I                                        1   2 TRRECT
     I                                        3   9 TRZZ7
     I***********                            10  12 TRPBRC                S01117
     I                                       10  12 TRPBRA                S01117
      *                                                                                       CGL029
     IDSSDY     E DSDSSDY                                                                     CGL029
      *                                                                                       CGL029
     I***/COPY ZSRSRC,ZYLDZ1                                              S01176
     I*
     C/EJECT
     C*================================================================
     C*  P R O G R A M     S T A R T
     C*================================================================
     C*
      **DEFINE*KEYLIST*FOR*CHAINING*TO*TABSE*FILE*************************S01117
     C*
     C***********TABTRK    KLIST                                          S01117
     C***********          KFLD           TRKEY                           S01117
      *
      * DEFINE KEYLIST FOR CHAINING TO CLINT FILE
      *
     C           CLINTK    KLIST
     C**********           KFLD           CBPCNM  60                                          CSD027
     C                     KFLD           CBPCNM  6                                           CSD027
     C                     KFLD           CBRCDT  1
      * PREPARE LDA
      *
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL*BLANK    DBLOT
     C                     MOVEL'SE0345'  DBPGM
     C                     OUT  LDA                                       S01117
     C**                                                                  S01117
     C** REGISTER SPOOL ENTRY FOR AU                                      S01117
     C                     EXSR RCFAU                                     S01117
     C**                                                                  S01117
     C** IN THE DATAAREA RUNDAT                                           S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C                     IN   RUNDT                                     S01117
     C**                                                                  S01117
     C**  TEST FOR MULTIBRANCHING                                         S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     SETON                     35                   S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C** CHECK SYSTEM FORMAT DATE, DDMMYY OR MMDDYY(98 ON)                S01117
     C           DATF      IFEQ 'M'                                       S01117
     C                     SETON                     98                   S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C** INITIALISE VARIABLE                                              S01117
     C                     MOVE *BLANKS   ZBRNM                           S01117
     C**                                                                  S01117
      *
      * INPUT PARAMETER :
      *
     C           *ENTRY    PLIST
     C                     PARM           MODE    1
     C                     PARM           SEQ     5                       S01117
     C                     PARM           ENT     3                       S01117
      * DEFINE WORK FIELDS
      *
     C           *LIKE     DEFN LCD       ZLCD
     C           *LIKE     DEFN CHTP      ZCHTP
     C           *LIKE     DEFN TNLU      ZTNLU
     C           *LIKE     DEFN SINS      ZINS
     C           *LIKE     DEFN SAMD      ZAMD
     C           *LIKE     DEFN SDEL      ZDEL
     C/EJECT
      *================================================================
      *  FIRST TIME PROCESSING
      *================================================================
      *
      * SET INDICATORS FOR REPORT HEADING & OPEN INPUT FILE
     C           MODE      IFEQ 'I'
     C                     SETON                     40
     C                     ELSE
     C           MODE      IFEQ 'A'
     C                     SETON                     41
     C                     ELSE
     C                     SETON                     42
     C                     END
     C                     END
      *
     C**                                                                  S01117
     C** INITIALISE OUTPUT ENTITY FIELDS BY INPUT PARAMETER               S01117
     C                     MOVE ENT       PBRA                            S01117
     C                     MOVE ENT       ZPBRA                           S01117
     C**                                                                  S01117
     C**   ACCESS BANK DETAILS, FOR TITLE                                 S01117
     C                     CALL 'AOBANKR0'                                S01117
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C           SDBANK    PARM SDBANK    DSFDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANK                                    S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'SDBANKPD'DBFILE                          S01117
     C                     MOVEL@OPTN     DBKEY            ***************S01117
     C                     MOVEL@OPTN     DBOPTN  7        * DBERROR 001 *S01117
     C                     Z-ADD1         DBASE            ***************S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR DBERR                                     S01117
     C                     END                                            S01117
      *                                                                                       CSE035
      ** Access SAR details file to see if CSE035 is installed                                CSE035
      *                                                                                       CSE035
     C                     CALL 'AOSARDR0'                                                    CSE035
     C                     PARM *BLANKS   @RTCD                                               CSE035
     C                     PARM '*VERIFY' @OPTN                                               CSE035
     C                     PARM 'CSE035'  WSARD   6                                           CSE035
      *                                                                                       CSE035
     C           @RTCD     IFEQ *BLANK                                                        CSE035
     C                     MOVE 'Y'       CSE035  1                                           CSE035
     C                     ELSE                                                               CSE035
     C                     MOVE 'N'       CSE035                                              CSE035
     C                     END                                                                CSE035
      *                                                                                       CSE035
     C/COPY WNCPYSRC,SE0345C001
      *
      **GET*INSTALLATION*CONTROL*DATA*RECORD*1****************************S01117
      *
     C***********          EXSR ZSYSTM                                    S01117
      *
      **ERROR*IN*ZSYSTM                                                   S01117
      *
     C************IN,99    IFEQ '1'                                       S01117
     C***********          MOVEL'1'       *INU8                           S01117
     C***********          MOVEL'1'       *INU7                           S01117
     C***********          MOVEL'01'      DBASE            **DB ERROR 01**S01117
     C***********          MOVEL'TABLE'   DBFILE                          S01117
     C***********          MOVELZTABKY    DBKEY                           S01117
     C***********          WRITEHEADAU                                    S01117
     C***********          WRITEERROR                                     S01117
     C***********          WRITETRAILAU                                   S01117
     C***********          GOTO ENDPGM                                    S01117
     C***********          END                                            S01117
      *
      **GET*TABTB11*I*C*D*RECORD*1****************************************S01117
      *
     C***********          EXSR ZICD2                                     S01117
      *
      **ERROR*IN*ZICD2****************************************************S01117
      *
     C************IN,99    IFEQ '1'                                       S01117
     C***********          MOVEL'1'       *INU8                           S01117
     C***********          MOVEL'1'       *INU7                           S01117
     C***********          MOVEL'03'      DBASE            **DB ERROR 03**S01117
     C***********          MOVEL'TABLE'   DBFILE                          S01117
     C***********          MOVELZTABKY    DBKEY                           S01117
     C***********          WRITEHEADAU                                    S01117
     C***********          WRITEERROR                                     S01117
     C***********          WRITETRAILAU                                   S01117
     C***********          GOTO ENDPGM                                    S01117
     C***********          END                                            S01117
     C*                                                                   S01169
     C*  ACCESS SE ICD RECORD                                             S01169
     C*                                                                   S01169
     C                     EXSR ZICDSE                                    S01169
     C*                                                                   S01169
     C*  ERROR IN ZICDSE                                                  S01169
     C*                                                                   S01169
     C           *INU7     IFEQ '1'                                       S01169
     C***********          MOVEL'05'      DBASE            *******S01169**S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     Z-ADD5         DBASE            ***************S01117
     C                     MOVEL'TABLE'   DBFILE           * DB ERROR 05 *S01169
     C                     MOVELZTABKY    DBKEY            ***************S01169
     C                     OUT  LDA                                       S01117
     C                     EXSR DBERR                                     S01117
     C***********          WRITEHEADAU                            S01169  S01117
     C***********          WRITEERROR                             S01169  S01117
     C***********          WRITETRAILAU                           S01169  S01117
     C***********          GOTO ENDPGM                            S01169  S01117
     C                     END                                            S01169
      *                                                                   S01169
     C*                                                                   S01486
     C** IF PM PRESENT SET IN37 ON                                        S01486
     C*                                                                   S01486
     C                     CALL 'AOMMODR0'                                S01486
     C                     PARM *BLANKS   @RTCD   7                       S01486
     C                     PARM '*FIRST ' @OPTN   7                       S01486
     C           SDMMOD    PARM SDMMOD    DSFDY                           S01486
     C           @RTCD     IFNE *BLANK                                    S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD10        DBASE            ***************S01486
     C                     MOVEL'SDMMOD'  DBFILE           * DB ERROR 10 *S01486
     C                     MOVE *BLANKS   DBKEY            ***************S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR DBERR                                     S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C                     MOVE *ON       *IN37                           S01486
     C                     ELSE                                           S01486
     C                     MOVE *OFF      *IN37                           S01486
     C                     ENDIF                                          S01486
     C*                                                                   CPB001
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     MOVE *ON       *IN32                           CPB001
     C                     ELSE                                           CPB001
     C                     MOVE *OFF      *IN32                           CPB001
     C                     ENDIF                                          CPB001
      *                                                                   S01486
      * OBTAIN PORTFOLIO MANAGEMENT ICD                                   S01486
      *                                                                   S01486
     C           *IN37     IFEQ '1'                                       S01486
     C                     CALL 'AOPORTR0'                                S01486
     C                     PARM *BLANKS   @RTCD   7                       S01486
     C                     PARM '*FIRST ' @OPTN   7                       S01486
     C           SDPORT    PARM SDPORT    DSFDY                           S01486
     C           @RTCD     IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD11        DBASE            ***************S01486
     C                     MOVEL'SDMMOD'  DBFILE           * DB ERROR 11 *S01486
     C                     MOVE *BLANKS   DBKEY            ***************S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR DBERR                                     S01486
     C                     END                                            S01486
     C                     END                                            S01486
      *                                                                   CAC005
      ***  Check if CAC005 - PCA-SE Enhancement is on.                    CAC005
      *                                                                   CAC005
     C                     MOVE 'N'       CAC005  1                       CAC005
     C                     MOVE *OFF      *IN65                           CAC005
     C                     CALL 'AOSARDR0'                                CAC005
     C                     PARM *BLANKS   @RTCD   7                       CAC005
     C                     PARM '*VERIFY' @OPTN   7                       CAC005
     C                     PARM 'CAC005'  @SARD   6                       CAC005
      *                                                                   CAC005
     C           @RTCD     IFEQ *BLANK                                    CAC005
     C                     MOVE 'Y'       CAC005                          CAC005
     C                     MOVE *ON       *IN65                           CAC005
     C                     ENDIF                                          CAC005
      *
     C   40                OPEN PRICBLCD
     C  N40                OPEN PRICB
     C                     Z-ADD40        MAXCNT  20
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0345CCP1                                           S01408
     C*                                                                   S01408
     C/SPACE 3
      *================================================================
      *  M A I N   P R O C E S S I N G
      *================================================================
      *
      *
     C   40                READ PRICBLCD                 50
     C  N40                READ PRICB                    50
     C*
     C** CHECK FOR REQUESTED BRANCH FOR MULTIBRANCHING                    S01117
     C*
     C           MBIN      IFEQ 'Y'                                       S01117
     C           ENT       IFNE 'ALL'                                     S01117
     C           ENT       ANDNEPBRA                                      S01117
     C                     MOVE '1'       *IN50                           S01117
     C                     MOVE '1'       *IN60                           S01117
     C                     GOTO ENDSEL                                    S01117
     C                     END                                            S01117
     C                     END                                            S01117
      *
     C           *IN50     DOWNE'1'
      *
     C*                                                                   S01169
     C*  If Extel Option Indicator is 'Y', set on indicator to output     S01169
     C*  the following fields                                             S01169
     C*                                                                   S01169
     C                     MOVE '0'       *IN72                           S01169
     C*                                                                   S01169
     C           EXMO      IFEQ 'Y'                                       S01169
     C                     MOVE '1'       *IN72                           S01169
      *                                                                   S01169
      ** If warning indicators are on on PF/PRICED, seton program         S01169
      **   indicators for output to report.                               S01169
      *                                                                   S01169
     C                     SETOF                     7071                 S01169
      *                                                                   S01169
      ** Boundary warning indicator.                                      S01169
      *                                                                   S01169
     C           PBWN      IFEQ 'Y'                                       S01169
     C                     MOVE '1'       *IN70                           S01169
     C                     END                                            S01169
      *                                                                   S01169
      ** Percentage warning indicator.                                    S01169
      *                                                                   S01169
     C           PPWN      IFEQ 'Y'                                       S01169
     C                     MOVE '1'       *IN71                           S01169
     C                     END                                            S01169
     C*                                                                   S01169
     C                     END                                            S01169
      * A RECORD HAS BEEN READ :-
      *
      * MOVE DATA INTO UNIQUE FIELDS
      *
     C                     Z-ADDLCD       ZLCD
     C                     MOVE CHTP      ZCHTP
     C                     Z-ADDTNLU      ZTNLU
      *
      * IF PARM=I & LAST CHANGE DATE NOT = RUN DATE - IGNORE
     C           MODE      IFEQ 'I'
     C           ZLCD      IFNE RUND
     C                     GOTO NEXT
     C                     END
     C                     END
      *
      * MAINTAIN COUNTS AS NECESSARY
     C           MODE      IFEQ 'I'
     C           MODE      OREQ 'A'
      *
      **  IF FOR RUN DATE
      *
     C           ZLCD      IFEQ RUND
      *
      * I OR A MODES - INCLUDE DELETED RECORDS
     C           ZCHTP     IFEQ 'I'
     C                     ADD  1         ZINS
     C                     ELSE
     C           ZCHTP     IFEQ 'A'
     C                     ADD  1         ZAMD
     C                     ELSE
     C           ZCHTP     IFEQ 'D'
     C                     ADD  1         ZDEL
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
      * I MODE - COUNT OF RECORDS CHANGED TODAY
     C           MODE      IFEQ 'I'
     C           ZLCD      IFEQ RUND
     C                     ADD  1         ZCHG
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0345CCP2                                           S01408
     C*                                                                   S01408
     C                     ADD  1         ZCHGP1
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0345CCP3                                           S01408
     C*                                                                   S01408
     C                     END
     C                     ELSE
      * A MODE -
     C           MODE      IFEQ 'A'
     C           RECI      IFNE '*'
     C                     ADD  1         ZLIVE
     C                     END
     C           ZLCD      IFEQ RUND
      * A MODE - COUNT OF RECORDS READ + LIVE RECORDS
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0345CCP4                                           S01408
     C*                                                                   S01408
     C                     ADD  1         ZCOUNT
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0345CCP5                                           S01408
     C*                                                                   S01408
     C                     ELSE
      *        - IGNORE IF LCD NOT EQUAL RUN DATE
     C                     GOTO NEXT
     C                     END
      *
     C                     ELSE
      * L MODE - COUNT OF LIVE RECORDS
     C           RECI      IFNE '*'
     C                     ADD  1         ZLIVE
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0345CCP6                                           S01408
     C*                                                                   S01408
     C                     ADD  1         ZLIVP1
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0345CCP7                                           S01408
     C*                                                                   S01408
     C                     ELSE
      * L MODE - IGNORE IF DELETED RECORD
     C                     GOTO NEXT
     C                     END
     C                     END
     C                     END
     C*                                                                   E38656
     C** Only process those records for average prices                    E38656
     C*                                                                   E38656
     C           PPRT      IFNE 'V '                                      E38656
      *
      * RECORD TO BE PRINTED -
      *  OPEN OUTPUT FILE IF REQUIRED FIRST TIME ONLY
     C           *IN55     IFEQ '0'
     C                     SETON                     55
     C                     Z-ADD70        LINCNT  20
     C                     OPEN SE0345P1
     C                     EXSR RCFP1                                     S01117
     C                     SETOF                     60
     C                     MOVE PBRA      ZPBRA                           S01117
     C*
     C**  FORMAT OUTPUT PRINT FORMAT
     C*
     C           MBIN      IFEQ 'Y'                                       S01117
     C           PBRA      IFEQ *BLANKS                                   S01117
     C                     SETOF                     45                   S01117
     C                     ELSE                                           S01117
     C                     SETON                     45                   S01117
     C                     MOVE PBRA      PENT    3                       S01117
     C                     EXSR ACCBRH                                    S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     ELSE
      *  OPEN OUTPUT FILE IF REQUIRED NEW BRANCH
     C           *IN60     IFEQ '1'
     C                     Z-ADD70        LINCNT
     C                     Z-ADD0         PAGE
     C                     OPEN SE0345P1
     C                     EXSR RCFP1                                     S01117
     C                     SETOF                     60
     C                     MOVE PBRA      ZPBRA                           S01117
     C**  FORMAT OUTPUT PRINT FORMAT
     C           MBIN      IFEQ 'Y'                                       S01117
     C           PBRA      IFEQ *BLANKS                                   S01117
     C                     SETOF                     45                   S01117
     C                     ELSE                                           S01117
     C                     SETON                     45                   S01117
     C                     MOVE PBRA      PENT                            S01117
     C                     EXSR ACCBRH                                    S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C**
     C                     END
     C                     END
      *
      **FORMAT*OUTPUT*FOR*PRINT*******************************************S01117
      *
     C***********          SETOF                     45                   S01117
      *
      **DETERMINE*BRANCH*LEVEL*FOR*OPTIONAL*DETAIL*PRINT******************S01117
      *
     C***********PBRC      IFEQ 0                                         S01117
     C***********          ELSE                                           S01117
     C***********          SETON                     45                   S01117
     C***********          END                                            S01117
      *
      **FORMAT*BRANCH HEADING*-*TABLETR*FILE*USING*KEY********************S01117
      *********IF*NO*RECORD/RECORD*DELETED*-*PRINT*BLANK******************S01117
      *
     C************IN45     IFEQ '1'                                       S01117
     C***********          MOVEL'10      'TRKEY                           S01117
     C***********          MOVE PBRC      TRPBRC                          S01117
     C***********TABTRK    CHAINTABLETRF             57                   S01117
     C************IN57     IFEQ '1'                                       S01117
     C***********          MOVE *BLANK    ZBRNM                           S01117
     C***********          ELSE                                           S01117
     C***********RECI      IFNE '*'                                       S01117
     C***********          MOVE BRNM      ZBRNM                           S01117
     C***********          ELSE                                           S01117
     C***********          MOVE *BLANK    ZBRNM                           S01117
     C***********          END                                            S01117
     C***********          END                                            S01117
     C***********          END                                            S01117
      *
      *  PRINT PAGE HEADINGS
     C           LINCNT    IFGT MAXCNT
     C                     Z-ADD0         LINCNT
     C                     WRITEHEADP1
     C                     END
      *
      * FORMAT OUTPUT & PRINT FOR CUSTOMER NAME/TOWN
      *    READ CLINTCB FILE USING KEY
      *    IF NO RECORD/RECORD DELETED/CUSTOMER NO.ZERO - PRINT BLANK
      *
     C********** PCNM      IFEQ 0                                                             CSD027
     C           PCNM      IFEQ *BLANKS                                                       CSD027
     C                     MOVE *BLANK    ZCRNM
     C                     MOVE *BLANK    ZCTWN
      *
     C                     ELSE
     C**********           Z-ADDPCNM      CBPCNM                                              CSD027
     C                     MOVE PCNM      CBPCNM                                              CSD027
     C                     MOVE 'A'       CBRCDT
     C           CLINTK    CHAINCLINTCBF             56
     C           *IN56     IFEQ '1'
     C                     MOVE *BLANK    ZCRNM
     C                     MOVE *BLANK    ZCTWN
     C                     ELSE
     C           RECI      IFNE '*'
     C                     MOVE CRNM      ZCRNM
     C                     MOVE CTWN      ZCTWN
     C                     ELSE
     C                     MOVE *BLANK    ZCRNM
     C                     MOVE *BLANK    ZCTWN
     C                     END
     C                     END
     C                     END
     C*
     C* FORMAT OUTPUT PRINT
     C*    MARKET LEGEND
     C                     SETOF                     464748
     C                     SETOF                     49
     C           PMKT      IFEQ 'G'
     C                     SETON                     46
     C                     ELSE
     C           PMKT      IFEQ 'P'
     C                     SETON                     47
     C                     ELSE
     C           PMKT      IFEQ 'S'
     C                     SETON                     48
     C                     ELSE
     C                     SETON                     49
     C                     END
     C                     END
     C                     END
      *
      * FORMAT OUTPUT & PRINT
      *    NOMINAL CURRENCY-READ SECTY FILE USING KEY
     C           PSSN      CHAINSECTYDF              58
     C           *IN,58    IFEQ '1'
     C***********          MOVEL'1'       *INU8                           S01117
     C***********          MOVEL'1'       *INU7                           S01117
     C***********          MOVEL'04'      DBASE            **DB ERROR 04**S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     Z-ADD4         DBASE            **DB ERROR 04**S01117
     C                     MOVEL'SECTY'   DBFILE
     C                     MOVELPSSN      DBKEY
     C                     OUT  LDA                                       S01117
     C                     EXSR DBERR                                     S01117
     C***********          WRITEHEADAU                                    S01117
     C***********          WRITEERROR                                     S01117
     C***********          WRITETRAILAU                                   S01117
     C***********          GOTO ENDPGM                                    S01117
     C                     END
      *
      * FORMAT PRICE FOR PRINT OUTPUT
      *
     C***********          MOVE PPRC      ZPRICE                          S01176
     C***********          Z-ADDPVDT      ZFDATE                          S01176
     C***********          EXSR ZEVCD                                     S01176
     C***********          EXSR ZNCD                                      S01176
     C***********          EXSR ZPRCO                                     S01176
     C***********          MOVE ZPRCOT    ZFLD15                          S01176
     C                     MOVE PPRC      ZFLD15                          S01176
     C                     Z-ADD8         ZDECS
     C                     MOVE 'L'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    ZOUT17 17
      *                                                                   S01486
      * FORMAT PORTFOLIO REFERENCE FOR OUTPUT                             S01486
     C           PTFR      IFEQ '9997'                                    S01486
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C                     MOVE FCR997    PTFR                            S01486
     C                     END                                            S01486
      *                                                                   S01486
      * FORMAT FX RATE FOR PRINT OUTPUT                                   S01486
      *                                                                   S01486
     C           NPXR      IFNE 0                                         S01486
     C                     MOVE *BLANKS   ZFLD15                          S01486
     C                     MOVE NPXR      ZFLD15                          S01486
     C                     Z-ADD8         ZDECS                           S01486
     C                     MOVE 'J'       ZECODE                          S01486
     C                     EXSR ZSEDIT                                    S01486
     C                     MOVE ZOUT21    ZNPXR  15                       S01486
     C                     ELSE                                           S01486
     C                     MOVE *BLANKS   ZNPXR                           S01486
     C                     END                                            S01486
      *
      * FORMAT DETAILS FOR PRINT OUTPUT
     C                     SETOF                     515253
     C           ZCHTP     IFEQ 'A'
     C                     SETON                     51
     C                     ELSE
     C           ZCHTP     IFEQ 'I'
     C                     SETON                     52
     C                     ELSE
     C           ZCHTP     IFEQ 'D'
     C                     SETON                     53
     C                     END
     C                     END
     C                     END
      *
      * FORMAT DATES FOR PRINT OUTPUT
      *
      * VALUE DATE
     C                     Z-ADDPVDT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    ZVDATE
      *
      * LAST DATE
     C                     Z-ADDZLCD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    ZLDATE
      *
     C                     ADD  2         LINCNT
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0345CCP8                                           S01408
      *                                                                   CAC005
      ** If CAC005 is on, retrieve user book & profit centre from AOBKPCR0CAC005
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
      *                                                                   CAC005
     C                     MOVE *BLANKS   PRFC                            CAC005
     C           PBOK      IFNE *BLANKS                                   CAC005
     C                     CALL 'AOBKPCR0'                                CAC005
     C                     PARM           PRTCD   7                       CAC005
     C                     PARM '*USER  ' POPTN   7                       CAC005
     C           PMBKCD    PARM *BLANKS   PMBKCD  2                       CAC005
     C           PMPRFC    PARM *BLANKS   PMPRFC  4                       CAC005
     C                     PARM PBOK      PMPSBK  2                       CAC005
     C           PRTCD     IFEQ *BLANKS                                   CAC005
     C                     MOVELPMBKCD    PBOK                            CAC005
     C                     MOVELPMPRFC    PRFC                            CAC005
     C                     ENDIF                                          CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C                     ENDIF                                          CAC005
     C*                                                                   S01408
     C                     WRITEDETAIL
      *
      * HOLD DATA UNTIL NEXT PRICED READ
     C***********          MOVE PBRC      ZPBRC                           S01117
     C                     MOVE PBRA      ZPBRA                           S01117
     C                     END                                            E38656
      *
     C*
     C* NEXT
     C           NEXT      TAG                             ** NEXT TAG  **
     C   40                READ PRICBLCD                 50
     C  N40                READ PRICB                    50
     C*
     C** CHECK FOR REQUESTED BRANCH FOR MULTIBRANCHING                    S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C           ENT       IFNE 'ALL'                                     S01117
     C           ENT       ANDNEPBRA                                      S01117
     C                     MOVE '1'       *IN50                           S01117
     C                     MOVE '1'       *IN60                           S01117
     C                     GOTO ENDSEL                                    S01117
     C                     END                                            S01117
     C                     END                                            S01117
      *
      * DETERMINE NEED TO CLOSE PRINTER FILE
      *
      * EOF OR 'L' MODE - DELETED RECORD OR 'I' MODE LCD NOT EQUAL
     C           *IN50     IFNE '1'
     C           MODE      IFEQ 'L'
     C           RECI      ANDEQ'*'
     C                     ELSE
     C           MODE      IFEQ 'I'
     C           LCD       ANDNERUND
     C                     ELSE
     C           PPRT      IFEQ 'V '                                      E38656
     C                     ELSE                                           E38656
      *
      * BRANCH CHANGE
     C***********ZPBRC     IFNE PBRC                                      S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C           ZPBRA     IFNE PBRA                                      S01117
     C                     SETON                     60
     C                     END
     C                     END                                            S01117
      *
      * TOTAL OUTPUT - CLOSE SE0345P1-IF DETAIL RECORDS WRITTEN
      * LEVEL/BRANCH CHANGE
      *
     C           ENDSEL    TAG                             * ENDSEL *     S01117
     C**                                                                  S01117
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0345CCP9                                           S01408
     C*                                                                   S01408
     C           ZCOUNT    IFEQ 0
     C           ZLIVP1    ANDEQ0
     C           ZCHGP1    ANDEQ0
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0345CP10                                           S01408
     C*                                                                   S01408
     C                     ELSE
      *
     C           *IN60     IFEQ '1'
      *                                                                   052927
      * Check if P1 needs to be opened - may do if no detail recs         052927
      * processed so far                                                  052927
     C           *IN55     IFNE '1'                                       052927
     C                     SETON                     55                   052927
     C                     Z-ADD70        LINCNT  20                      052927
     C                     OPEN SE0345P1                                  052927
     C                     EXSR RCFP1                                     052927
     C                     MOVE PBRA      ZPBRA                           052927
     C                     END                                            052927
     C                     ADD  6         LINCNT
     C           LINCNT    IFGT MAXCNT
     C                     Z-ADD0         LINCNT
     C                     WRITEHEADP1
     C                     END
     C                     WRITETOTAL
     C                     WRITETRAILP1
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0345CP11                                           S01408
     C*                                                                   S01408
     C                     Z-ADD0         ZCOUNT
     C                     Z-ADD0         ZLIVP1
     C                     Z-ADD0         ZCHGP1
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0345CP12                                           S01408
     C*                                                                   S01408
     C                     CLOSESE0345P1
     C                     END
     C                     END
     C                     END                                            E38656
     C                     END
     C                     END
     C                     END
     C                     END
     C/SPACE 3
      *
      * END OF FILE - IF DETAIL RECORDS WRITTEN - WRITE TOTAL LINE
      *
     C           TOTALS    TAG                             ** TOTALS TAG**
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0345CP13                                           S01408
     C*                                                                   S01408
      *
     C           ZCOUNT    IFEQ 0
     C           ZLIVP1    ANDEQ0
     C           ZCHGP1    ANDEQ0
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0345CP14                                           S01408
     C*                                                                   S01408
     C                     ELSE
      *
     C           *IN60     IFEQ '0'                                       054729
     C           *IN55     IFEQ '1'
     C                     ADD  6         LINCNT
     C           LINCNT    IFGT MAXCNT
     C                     Z-ADD0         LINCNT
     C                     WRITEHEADP1
     C                     END
     C                     WRITETOTAL
     C***********          WRITETRAILP1                                   S01117
     C                     END
     C                     END                                            054729
     C                     END
     C**                                                                  S01117
     C** WRITE '*** NO DETAILS TO REPORT ***' LINE                        S01117
     C           *IN55     IFEQ '0'                                       S01117
     C***********          MOVE '1'       *IN55                     S01117E29170
     C***********          MOVE '0'       *IN60                     S01117E29170
     C                     MOVE '1'       *IN36                           S01117
     C***********          MOVE ENT       PBRA                      S01117E29170
     C***********          MOVE ENT       ZPBRA                     S01117E29170
     C***********ENT       IFNE *BLANKS                             S01117E29170
     C***********          SETON                     45             S01117E29170
     C***********          END                                      S01117E29170
     C***********          OPEN SE0345P1                            S01117E29170
     C***********          EXSR RCFP1                               S01117E29170
     C***********MBIN      IFEQ 'Y'                                 S01117E29170
     C***********ENT       ANDNE'ALL'                               S01117E29170
     C***********ENT       ANDNE*BLANKS                             S01117E29170
     C***********          MOVE ENT       PENT                      S01117E29170
     C***********          EXSR ACCBRH                              S01117E29170
     C***********          END                                      S01117E29170
     C***********          WRITEHEADP1                              S01117E29170
     C***********          WRITENONEP1                              S01117E29170
     C                     END                                            S01117
      *
     C/SPACE 3
      *================================================================
      *  RUN CONTROL PROCESS
      *================================================================
      *
      *
      **WRITE*CONTROL*REPORT*HEADINGS*************************************S01117
     C***********          WRITEHEADAU                                    S01117
      *
      * READ AUDIT RECORD
     C                     READ PRICEA                   50
     C           *IN,50    IFEQ '1'
     C***********          MOVEL'1'       *INU8                           S01117
     C***********          MOVEL'1'       *INU7                           S01117
     C***********          MOVEL'02'      DBASE            **DB ERROR 02**S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     Z-ADD2         DBASE            **DB ERROR 02**S01117
     C                     MOVEL'PRICEA'  DBFILE
     C                     MOVE *BLANK    DBKEY
     C                     OUT  LDA                                       S01117
     C                     EXSR DBERR                                     S01117
     C***********          WRITEERROR                                     S01117
     C***********          WRITETRAILAU                                   S01117
     C***********          GOTO ENDPGM                                    S01117
     C                     END
      *
      * 'I' MODE - PRINT REPORT
     C           MODE      IFEQ 'I'
     C*
     C* DIFFERENCE MSG FOR   LIVE RECORDS CALCULATED AND AUDIT TOTAL
     C*
     C           SLRB      ADD  SINS      ZWORK
     C           ZWORK     SUB  SDEL      ZWORK
     C****       ZWORK     IFNE NORE                                      S01158
     C           ZWORK     IFNE ZLIVE                                     S01158
     C           MBIN      IFEQ 'N'                                       S01117
     C                     SETON                     U854
     C                     ELSE                                           S01117
     C           ENT       IFEQ 'ALL'                                     S01117
     C                     SETON                     U854                 S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END
     C                     WRITEHEADAU                                    S01117
     C                     WRITECONTROLI
      *
      *
      * 'A'/'L' MODE -
     C                     ELSE
      *
      *
      * 'A' MODE - DO RUN CONTROLS
     C           MODE      IFEQ 'A'
     C           SLRB      ADD  SINS      ZWORK
     C           ZWORK     SUB  SDEL      ZWORK
     C           ZWORK     IFNE ZLIVE
     C           MBIN      IFEQ 'N'                                       E28989
     C***********SLRB      ADD  SINS      ZWORK                     S01117E28989
     C                     SETON                     U854
     C                     ELSE                                           S01117
     C           ENT       IFEQ 'ALL'                                     S01117
     C                     SETON                     U854                 S01117
     C                     END                                            E28989
     C                     END                                            S01117
     C                     END
      *
      * - PRINT REPORT
     C                     WRITEHEADAU                                    S01117
     C                     WRITECONTROLA
      *
      * - UPDATE AUDIT RECORD
     C           *INU8     IFEQ '0'
     C                     Z-ADD0         SINS
     C                     Z-ADD0         SAMD
     C                     Z-ADD0         SDEL
     C*********************Z-ADDNORE      SLRB                            E13489
     C                     Z-ADDZWORK     SLRB                            E13489
     C                     UPDATPRICEAF
     C                     END
      *
      * 'L' MODE - DO RUN CONTROLS
     C                     ELSE
     C           NORE      IFNE ZLIVE
     C           MBIN      IFEQ 'N'                                       S01117
     C                     SETON                     U854
     C                     ELSE                                           S01117
     C           ENT       IFEQ 'ALL'                                     S01117
     C                     SETON                     U881                 S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END
      *
      * - PRINT REPORT
     C                     WRITEHEADAU                                    S01117
     C                     WRITECONTROLL
     C                     END
     C                     END
      *
      *  IF NO OUTPUT - WRITE MESSAGE TO THIS EFFECT
     C************IN55     IFEQ '0'                                       S01117
     C           *IN36     IFEQ '1'                                       S01117
     C                     WRITENONE
     C***********          WRITETRAILP1                             S01117E29170
     C                     ELSE                                           S01117
     C** WRITE P1 '*** END OF REPORT ***' LINE IF P1 OPENED               S01117
     C           *IN55     IFNE '1'                        ***************S01117
     C           *IN55     OREQ '1'                        * P1 NOT OPEN *S01117
     C           *IN60     ANDEQ'1'                        ***************S01117
     C                     ELSE                                           S01117
     C                     WRITETRAILP1                                   S01117
     C                     END                                            S01117
     C                     END
      *
     C***********          WRITETRAILAU                                   S01117
     C/SPACE 3
      *================================================================
      *  END OF PROGRAM
      *================================================================
      *
     C           ENDPGM    TAG                             ** ENDPGM TAG**
     C                     SETON                     LR
     C                     RETRN
     C*
     C********************************************************************S01117
     C/EJECT                                                              S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C*   ACCBRH SR. - SR. TO ACCESS BRANCH DETAILS                       S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C           ACCBRH    BEGSR                           * A C C B R H *S01117
     C*                                                                   S01117
     C                     MOVE *BLANK    ZBRNM                           S01117
     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM PENT      @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01117              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01117
     C**  CHECK FOR DATABASE ERROR                                        S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANK                                    S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'SDBRCHPD'DBFILE                          S01117
     C                     MOVELPENT      DBKEY                           S01117
     C                     MOVEL@OPTN     DBOPTN           ***************S01117
     C                     Z-ADD3         DBASE            * DB ERROR 03 *S01117
     C                     OUT  LDA                        ***************S01117
     C                     EXSR DBERR                                     S01117
     C                     END                                            S01117
     C                     MOVE BRNM      ZBRNM                           S01117
     C**                                                                  S01117
     C                     ENDSR                                          S01117
     C**                                                                  S01117
     C********************************************************************S01117
     C/EJECT                                                              S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C*    DBERR SR.- DATABASE ERROR SUBROUTINE                           S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C           DBERR     BEGSR                           ** DBERR SR ** S01117
     C*                                                                   S01117
     C**   DATABASE ERROR HANDLING , REPORT ETC.                          S01117
     C*                                                                   S01117
     C** WRITE DB ERROR DETAILS TO P1                                     S01117
     C*                                                                   S01117
     C           *IN55     IFNE '1'                        ***************S01117
     C           *IN55     OREQ '1'                        * P1 NOT OPEN *S01117
     C           *IN60     ANDEQ'1'                        ***************S01117
     C                     ELSE                            * P1 OPENED    S01117
     C                     ADD  9         LINCNT                          S01117
     C           LINCNT    IFGT MAXCNT                                    S01117
     C                     WRITEHEADP1                                    S01117
     C                     END                                            S01117
     C                     WRITEERRORP1                                   S01117
     C                     WRITETRAILP1                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** OUTPUT RUN CONTROL DETAILS FOR AU                                S01117
     C*                                                                   S01117
     C                     WRITEHEADAU                                    S01117
     C           MODE      IFEQ 'I'                                       S01117
     C                     WRITECONTROLI                                  S01117
     C                     ELSE                                           S01117
     C           MODE      IFEQ 'A'                                       S01117
     C                     WRITECONTROLA                                  S01117
     C                     ELSE                                           S01117
     C                     WRITECONTROLL                                  S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** OUTPUT DB ERROR DETAILS FOR AU                                   S01117
     C*                                                                   S01117
     C                     WRITEERROR                                     S01117
     C**                                                                  S01117
     C                     SETON                     U7U8LR               S01117
     C                     EXSR *PSSR                                     S01117
     C**                                                                  S01117
     C                     RETRN                                          S01117
     C**                                                                  S01117
     C                     ENDSR                                          S01117
     C**                                                                  S01117
     C********************************************************************S01117
     C/EJECT                                                              S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C*  RCFP1 -- SUBROUTINE TO REGISTER P1 PRINTER FILE VIA RCF          S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C           RCFP1     BEGSR                            ** RCFP1 **   S01117
     C*                                                                   S01117
     C**      ENSURE REPORT SPOOL FILE RECORDED BY RCF                    S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   PPBRA   3                       S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C           ENT       IFEQ 'ALL'                                     S01117
     C           *IN36     IFEQ '0'                                       S01117
     C                     MOVE PBRA      PPBRA                           S01117
     C                     END                                            S01117
     C                     ELSE                                           S01117
     C                     MOVE ENT       PPBRA                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     Z-ADDSFNUM     ZSNUM   60                      S01117
     C**                                                                  S01117
     C                     CALL 'ZSFILE'                                  S01117
     C                     PARM           SEQ     5                       S01117
     C                     PARM PPBRA     SENTY   3                       S01117
     C                     PARM           SFILE                           S01117
     C                     PARM           ZSNUM                           S01117
     C                     PARM           ZSERR   1                       S01117
     C*                                                                   S01117
     C           ZSERR     IFEQ 'Y'                                       S01117
     C*                                                                   S01117
     C**  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       S01117
     C*                                                                   S01117
     C                     SETON                     U7U8LR               S01117
     C                     RETRN                                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C/EJECT                                                              S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C*  RCFAU -- SUBROUTINE TO REGISTER AU PRINTER FILE VIA RCF          S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C           RCFAU     BEGSR                            ** RCFAU **   S01117
     C*                                                                   S01117
     C**      ENSURE AUDIT SPOOL FILE RECORDED BY RCF                     S01117
     C*                                                                   S01117
     C                     Z-ADDSFNUMU    ZSNUMU  60                      S01117
     C**                                                                  S01117
     C                     CALL 'ZSFILE'                                  S01117
     C                     PARM           SEQ     5                       S01117
     C                     PARM *BLANK    SENTY   3                       S01117
     C                     PARM           SFILEU                          S01117
     C                     PARM           ZSNUMU                          S01117
     C                     PARM           ZSERR   1                       S01117
     C*                                                                   S01117
     C           ZSERR     IFEQ 'Y'                                       S01117
     C*                                                                   S01117
     C**  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       S01117
     C*                                                                   S01117
     C                     SETON                     U7U8LR               S01117
     C                     RETRN                                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C*                                                                   S01117
      *****************************************************************   S01117
      /EJECT                                                              S01117
      *****************************************************************   S01117
      *                                                               *   S01117
      *  *PSSR  - Error control subroutine                            *   S01117
      *                                                               *   S01117
      *****************************************************************   S01117
      *                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR **    S01117
     C**                                                                  S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     ENDSR                                          S01117
      *                                                                   S01117
     C*****************************************************************
      ***/EJECT******************                                         E15278
     C***/COPY*ZSRSRC,ZDATE1Z2***                                         E15278
      /EJECT
     C/COPY ZSRSRC,ZDATE2Z4
      ***/EJECT******************                                         E15278
     C***/COPY*ZSRSRC,ZDAYSZ2***                                          E15278
      ***/EJECT******************                                         E15278
     C***/COPY*ZSRSRC,ZDYYRZ3***                                          E15278
      ***/EJECT******************                                         E15278
     C***/COPY*ZSRSRC,ZEVCDZ1***                                          E15278
      /EJECT
     C*COPY*ZSRSRC,ZICD2Z1**                                              S01117
      /EJECT                                                              S01169
     C/COPY ZSRSRC,ZICDSEZ1                                               S01169
      ***/EJECT******************                                         E15278
     C***/COPY*ZSRSRC,ZNCDZ3***                                           E15278
      ***/EJECT******************                                         S01176
     C***/COPY*ZSRSRC,ZPRCOZ1***                                          S01176
      /EJECT
     C/COPY ZSRSRC,ZSEDITZ3
      /EJECT
     C*COPY*ZSRSRC,ZSYSTMZ1**                                             S01117
      ***/EJECT******************                                         S01176
     C***/COPY*ZSRSRC,ZYLDOZ1***                                          S01176
      ***/EJECT******************                                         S01176
     C***/COPY*ZSRSRC,ZYLDZ2***                                           S01176
      ***
*******   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)                 E15278
********001521029820444305904073650882610287117481320914670161311759219053E15278
********421975234362489726358278192928030741322023366335124365853804639507E15278
********8424294389045351                                                  E15278
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN                       #DATE
0366073110961461                                                           #DATE
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR                         #DATE
000031059090120151181212243273304334365                                    #DATE
**   ZMNM - MONTHS SHORT NAMES                                             #DATE
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC                                       #DATE
