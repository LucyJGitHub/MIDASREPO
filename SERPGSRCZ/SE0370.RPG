     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Account Key List')
     F*****************************************************************
     F*                                                               *
     F*  Midas - Securities Trading Module
     F*                                                               *
     F*  SE0370 - ACCOUNT KEY LIST                                    *
     F*                                                               *
     F*  Function:  This program produces a report, for audit         *
     F*   (I/C)     purposes, of all account keys defined to the      *
     F*   (COB)     system.  The sequence of the report is account    *
     F*             key.                                              *
     F*                                                               *
     F*  Called By: 1) SEC0301 - Audit Reports - Input Cycle          *
     F*             2) SEC0601 - Audit Reports - Close of Business    *
     F*             3) SEC0302 - Full Lists - On Request              *
     F*                                                               *
     F*             Frequency:                                        *
     F*             The report is available in 3 modes (I,A,L):       *
     F*             1) On request during I/C; an interim report       *
     F*                showing the latest status of account keys      *
     F*                inserted, amended or deleted during the day.   *
     F*             2) During COB; a report of all account keys       *
     F*                inserted, amended or deleted during the day.   *
     F*             3) On request; a report of all live account keys  *
     F*                in the system (ie. deleted items are not       *
     F*                included).                                     *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Prev Amend No. BUG12646           Date 14Nov06               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 052254             Date 10Jan94               *
      *                 E51839             Date 29Mar93               *
     F*                 E40424             DATE 21MAY92               *
     F*                 E32829             DATE 04DEC91               *
     F*                 E29170             DATE 08NOV91               *
     F*                 E28705             DATE 24SEP91               *
     F*                 S01117             DATE 29OCT90               *
     F*                 E22236             DATE 05JUN90               *
     F*                 E13651             DATE 07/09/88              *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  MD046248 - Finastra Rebranding                               *
      *  BUG12646 - Cater for SEACKA file control length increase     *
      *  CGL029 - Increase Account Code to 10 digits                  *
     F*  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
     F*           to 10,9                                             *
     F*  E51839 - Narratives not printing because narrative codes are *
     F*           now NCDA1, NCDA2... NCDA6.                          *
     F*  E40424 - Narratives not printing because Narrative Codes are *
     F*           now alpha, not numeric.                             *
     F*  E32829 - Tried to write to closed P1 printer file            *
     F*  E29170 - RCF changes                                         *
     F*  E28705 - Recompiled over changed PRTF                        *
     F*  S01117 - MULTI-BRANCHING                                     *
     F*  E22236 - CORRECT LINE COUNT TO PREVENT PRINTER OVERFLOW      *   E22236
     F*  E13651 - UPDATE NUMBER OF RECORDS ON FILE CORRECTLY.         *   E13651
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
      *
     FSEACKLCDIF  E           K        DISK                           UC
     FSEACKD  IF  E           K        DISK                           UC
     F            SEACKDF                           KRENAMESEACKDFX
     F***TABSE***IF  E           K        DISK
     F*********** TABLETAF                          KIGNORE               S01117
     F*********** TABLETHF                          KIGNORE               S01117
     F*********** TABLETJF                          KIGNORE               S01117
     F*********** TABLETLF                          KIGNORE               S01117
     F*********** TABLETKF                          KIGNORE               S01117
     F*********** TABLETNF                          KIGNORE               S01117
     F*********** TABLETPF                          KIGNORE               S01117
     F*********** TABLETRF                          KIGNORE               S01117
     F*********** TABLETXF                          KIGNORE               S01117
     F**ICD*1*****TABTB10F                          KIGNORE
     F*********** TABTB11F                          KIGNORE               S01117
     F*********** TABTB36F                          KIGNORE               S01117
     F*********** TABTB40F                          KIGNORE               S01117
     F*********** TABTE10F                          KIGNORE               S01117
     F*********** TABTE20F                          KIGNORE               S01117
     F*********** TABTG10F                          KIGNORE               S01117
     F*********** TABTG20F                          KIGNORE               S01117
     F*********** TABLET2F                          KIGNORE               S01117
     F*********** TABLET3F                          KIGNORE               S01117
     F*********** TABLET5F                          KIGNORE               S01117
     FSEACKA  UF  E           K        DISK
     F***********SE0370P1O   E             PRINTER                    UC  E22236
     FSE0370P1O   E             01     PRINTER      KINFDS PIDS       UC  E22236
     FSE0370AUO   E                    PRINTER
     F                                              KINFDS SPOOLU         S01117
     F/COPY WNCPYSRC,SE0370F001
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*   01       OVERFLOW INDICATOR                                 *   E22236
     F*   40       INPUT PARAMETER IS I (INPUT CYCLE MODE)            *
     F*   41       INPUT PARAMETER IS A (AUDIT MODE)                  *
     F*   42       INPUT PARAMETER IS L (FULL LIST MODE)              *
     F*   49       DETAIL PRINTED                                     *   S01117
     F*   50       END OF INPUT FILE / FILE READ ERROR                *
     F*   51-53    PRINT AMD/INS/DEL LEGEND                           *
     F*   54       PRINT 'DIFFERENCE' LEGEND                          *
     F*   55       DETAIL REPORT OPEN                                 *
     F*   56-73    PRINT ZERO SUPPRESSION                             *
     F*   90-99    USED IN STANDARD SUB-ROUTINES                      *
     F*   U7    DATABASE ERROR                                        *
     F*   U8    DATABASE / CONTROL ERROR                              *
     F*                                                               *
     F*****************************************************************
     F/SPACE 3
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*   DBERR  - DATABASE ERROR CONTROL                             *   S01117
     F*   RCFAU  - RCF PROCESSING FOR AUDIT REPORT                    *   S01117
     F*   RCFP1  - RCF PROCESSING FOR P1 REPORT                       *   S01117
     F*   *PSSR  - ERROR HANDLING                                     *   S01117
     F****ZSYSTM*-*ACCESS*ICD*RECORD***********************************   S01117
     F*   ZDATE2 - DAYNO - DATE CONVERSION                            *
     F*                                                               *
     F*****************************************************************
      /EJECT
     E                    CPY@    1   1 80
     E/COPY ZSRSRC,ZDATE2Z1
     E**********          ACD         6  4 0             A/C CODE ARRAY                       CGL029
     E                    ACD         6 10 0             A/C CODE ARRAY                       CGL029
     E***********         NCD         6  2 0             NAR.CODE ARRAY   E40424
     E                    NCD         6  2               NAR.CODE ARRAY   E40424
     E                    PRF         6  1 0             POST REF.ARRAY
      /SPACE 3
      *                                                                   E51839
      * Rename Input fields from file to fields used by program           E51839
      *                                                                   E51839
     ISEACKDF                                                             E51839
     I              NCDA1                           NCD1                  E51839
     I              NCDA2                           NCD2                  E51839
     I              NCDA3                           NCD3                  E51839
     I              NCDA4                           NCD4                  E51839
     I              NCDA5                           NCD5                  E51839
     I              NCDA6                           NCD6                  E51839
      *                                                                   E51839
     ISEACKDFX                                                            E51839
     I              NCDA1                           NCD1                  E51839
     I              NCDA2                           NCD2                  E51839
     I              NCDA3                           NCD3                  E51839
     I              NCDA4                           NCD4                  E51839
     I              NCDA5                           NCD5                  E51839
     I              NCDA6                           NCD6                  E51839
      *                                                                   E51839
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*
     I***LDA*****   UDS                            256                    S01117
     I***********                           134 177 DBLOT                 S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 177 DBASE                 S01117
     ILDA         DS                            256                       S01117
     I                                      134 183 DBLOT                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     I**                                                                  S01117
     I**  EXTERNAL DS FOR BANK DETAILS                                    S01117
     ISDBANK    E DSSDBANKPD                                              S01117
     I              BJURPT                          TITL                  S01117
     I**                                                                  S01117
     I**  DATA STRUCTURE FOR RUN DATE DETAILS                             S01117
     IRUNDT       DS                                                      S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
     I*                                                                   S01117
     I** DATA STRUCTURE FOR ACCESS OBJECTS, SHORT DATA STRUCTURE          S01117
     IDSFDY     E DSDSFDY                                                 S01117
     I*
     I           SDS
     I                                      244 246 WSID
     I                                      254 263 USID
     I*                                                                   E22236
     I*  DS FOR LINE NO. TO HANDLE OVERFLOW                               S01117
     I*                                                                   S01117
     ISPOOLU      DS                                                      S01117
     I                                       83  92 SFILEU                S01117
     I                                    B 123 1240SFNUMU                S01117
     IPIDS        DS                                                      E22236
     I                                       83  92 SFILE                 S01117
     I                                    B 123 1240SFNUM                 S01117
     I                                    B 188 1890OFLW                  E22236
     I                                    B 367 3680PRTLN                 E22236
     I*
     I            DS
      ***  Account Codes.                                                 E40424
     I**********                              1   40ACD1                                      CGL029
     I**********                              5   80ACD2                                      CGL029
     I**********                              9  120ACD3                                      CGL029
     I**********                             13  160ACD4                                      CGL029
     I**********                             17  200ACD5                                      CGL029
     I**********                             21  240ACD6                                      CGL029
     I**********                              1  240ACD                                       CGL029
     I                                        1  100ACD1                                      CGL029
     I                                       11  200ACD2                                      CGL029
     I                                       21  300ACD3                                      CGL029
     I                                       31  400ACD4                                      CGL029
     I                                       41  500ACD5                                      CGL029
     I                                       51  600ACD6                                      CGL029
     I                                        1  600ACD                                       CGL029
     I*
      ***  Narrative Codes need to be alpha, not numeric.                 E40424
     I*********** DS                                                      E40424
     I***********                             1   20NCD1                  E40424
     I***********                             3   40NCD2                  E40424
     I***********                             5   60NCD3                  E40424
     I***********                             7   80NCD4                  E40424
     I***********                             9  100NCD5                  E40424
     I***********                            11  120NCD6                  E40424
     I***********                             1  120NCD                   E40424
      *                                                                   E40424
     I            DS
      ***  Narrative Codes.                                               E40424
     I                                        1   2 NCD1                  E40424
     I                                        3   4 NCD2                  E40424
     I                                        5   6 NCD3                  E40424
     I                                        7   8 NCD4                  E40424
     I                                        9  10 NCD5                  E40424
     I                                       11  12 NCD6                  E40424
     I                                        1  12 NCD                   E40424
     I*
     I            DS
      ***  Posting References.                                            E40424
     I                                        1   10PRF1
     I                                        2   20PRF2
     I                                        3   30PRF3
     I                                        4   40PRF4
     I                                        5   50PRF5
     I                                        6   60PRF6
     I                                        1   60PRF
     C/EJECT
     C*================================================================
     C*  P R O G R A M     S T A R T
     C*================================================================
     C*
     C*
     C* PREPARE LDA
     C*
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL*BLANK    DBLOT
     C                     MOVEL'SE0370'  DBPGM
     C                     OUT  LDA                                       S01117
      *
      * INPUT PARAMETER :
      *
     C           *ENTRY    PLIST
     C                     PARM           MODE    1
     C                     PARM           SEQ     5                       S01117
      * DEFINE WORK FIELDS
     C********** *LIKE     DEFN SINS      ZINS                                              BUG12646
     C           *LIKE     DEFN SINS10    ZINS                                              BUG12646
     C********** *LIKE     DEFN SAMD      ZAMD                                              BUG12646
     C           *LIKE     DEFN SAMD10    ZAMD                                              BUG12646
     C********** *LIKE     DEFN SDEL      ZDEL                                              BUG12646
     C           *LIKE     DEFN SDEL10    ZDEL                                              BUG12646
     C/EJECT
      *================================================================
      *  FIRST TIME PROCESSING
      *================================================================
      *
      * SET INDICATORS FOR REPORT HEADING & OPEN INPUT FILE
     C           MODE      IFEQ 'I'
     C                     SETON                     40
     C                     ELSE
     C           MODE      IFEQ 'A'
     C                     SETON                     41
     C                     ELSE
     C                     SETON                     42
     C                     END
     C                     END
      *
     C**                                                                  S01117
     C** REGISTER SPOOL ENTRY FOR AU                                      S01117
     C**                                                                  S01117
     C                     EXSR RCFAU                                     S01117
     C**                                                                  S01117
     C** IN THE DATAAREA RUNDAT                                           S01117
     C**                                                                  S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C                     IN   RUNDT                                     S01117
     C**                                                                  S01117
     C** CHECK SYSTEM FORMAT DATE, DDMMYY OR MMDDYY(98 ON)                S01117
     C**                                                                  S01117
     C           DATF      IFEQ 'M'                                       S01117
     C                     SETON                     98                   S01117
     C                     END                                            S01117
      ***********                                                         S01117
      ***********                                                         S01117
      **GET*INSTALLATION*CONTROL*DATA*RECORD*1****************************S01117
      ***********                                                         S01117
     C***********          EXSR ZSYSTM                                    S01117
      ***********                                                         S01117
      **ERROR*IN*ZSYSTM***************************************************S01117
      ***********                                                         S01117
     C************IN,99    IFEQ '1'                                       S01117
     C***********          MOVEL'1'       *INU8                           S01117
     C***********          MOVEL'1'       *INU7                           S01117
     C***********          MOVEL'01'      DBASE            **DB ERROR 01**S01117
     C***********          MOVEL'TABLE'   DBFILE                          S01117
     C***********          MOVELZTABKY    DBKEY                           S01117
     C***********          WRITEHEADAU                                    S01117
     C***********          WRITEERROR                                     S01117
     C***********          WRITETRAILAU                                   S01117
     C***********          GOTO ENDPGM                                    S01117
     C***********          END                                            S01117
     C**                                                                  S01117
     C**   ACCESS BANK DETAILS                                            S01117
     C**                                                                  S01117
     C                     CALL 'AOBANKR0'                                S01117
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C           SDBANK    PARM SDBANK    DSFDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANK                                    S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'SDBANKPD'DBFILE                          S01117
     C                     MOVEL@OPTN     DBKEY            ***************S01117
     C                     MOVEL@OPTN     DBOPTN  7        * DBERROR 001 *S01117
     C                     Z-ADD1         DBASE            ***************S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR DBERR                                     S01117
     C                     END                                            S01117
      *
      *
     C   40                OPEN SEACKLCD
     C  N40                OPEN SEACKD
     C***********          Z-ADD40        MAXCNT  20                      E22236
     C/COPY WNCPYSRC,SE0370C001
     C/SPACE 3
      *================================================================
      *  M A I N   P R O C E S S I N G
      *================================================================
      *
      *
     C   40                READ SEACKLCD                 50
     C  N40                READ SEACKD                   50
      *
     C           *IN50     DOWNE'1'
      *
      * A RECORD HAS BEEN READ :-
      *
      * IF PARM=I & LAST CHANGE DATE NOT = RUN DATE - PRINT TOTALS ETC
     C           MODE      IFEQ 'I'
     C           LCD       IFNE RUND
     C                     GOTO TOTALS
     C                     END
     C                     END
      *
      * MAINTAIN COUNTS AS NECESSARY
     C           MODE      IFEQ 'I'
     C           MODE      OREQ 'A'
      *
      **  IF FOR RUN DATE
      *
     C           LCD       IFEQ RUND
      * I OR A MODES - INCLUDE DELETED RECORDS
     C           CHTP      IFEQ 'I'
     C                     ADD  1         ZINS
     C                     ELSE
     C           CHTP      IFEQ 'A'
     C                     ADD  1         ZAMD
     C                     ELSE
     C           CHTP      IFEQ 'D'
     C                     ADD  1         ZDEL
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
      * I MODE - COUNT OF RECORDS CHANGED TODAY
     C           MODE      IFEQ 'I'
     C           LCD       IFEQ RUND
     C                     ADD  1         ZCHG
     C                     END
     C                     ELSE
      * A MODE -
     C           MODE      IFEQ 'A'
     C           RECI      IFNE '*'
     C                     ADD  1         ZLIVE
     C                     END
     C           LCD       IFEQ RUND
      * A MODE - COUNT OF RECORDS READ + LIVE RECORDS
     C                     ADD  1         ZCOUNT
     C                     ELSE
      *        - IGNORE IF LCD NOT EQUAL RUN DATE
     C                     GOTO NEXT
     C                     END
      *
     C                     ELSE
      * L MODE - COUNT OF LIVE RECORDS
     C           RECI      IFNE '*'
     C                     ADD  1         ZLIVE
     C                     ELSE
      * L MODE - IGNORE IF DELETED RECORD
     C                     GOTO NEXT
     C                     END
     C                     END
     C                     END
      *
      * RECORD TO BE PRINTED -
      *     OPEN OUTPUT FILE IF REQUIRED
     C           *IN55     IFEQ '0'
     C                     SETON                     55
     C***********          Z-ADD70        LINCNT  20                      E22236
     C                     OPEN SE0370P1
     C                     EXSR RCFP1                                     S01117
     C                     WRITEHEADP1                                    E22236
     C                     END
      *
      **********PRINT*PAGE*HEADINGS
     C***********LINCNT    IFGT MAXCNT                                    E22236
     C***********          Z-ADD0         LINCNT                          E22236
     C***********          WRITEHEADP1                                    E22236
     C***********          END                                            E22236
      *
      **  FORMAT OUTPUT & PRINT
     C                     Z-ADD56        Z1      20
     C                     DO   6         Z       10
     C           ACD,Z     IFNE 0
     C                     MOVEA'1'       *IN,Z1
     C                     ELSE
     C                     MOVEA'0'       *IN,Z1
     C                     END
     C                     ADD  1         Z1
     C*
     C***********NCD,Z     IFNE 0                                         E40424
     C           NCD,Z     IFNE '00'                                      E40424
     C           NCD,Z     ANDNE'  '                                      E40424
     C                     MOVEA'1'       *IN,Z1
     C                     ELSE
     C                     MOVEA'0'       *IN,Z1
     C                     END
     C                     ADD  1         Z1
     C*
     C           PRF,Z     IFNE 0
     C                     MOVEA'1'       *IN,Z1
     C                     ELSE
     C                     MOVEA'0'       *IN,Z1
     C                     END
     C                     ADD  1         Z1
     C                     END
     C                     SETOF                     515253
     C           CHTP      IFEQ 'A'
     C                     SETON                     51
     C                     ELSE
     C           CHTP      IFEQ 'I'
     C                     SETON                     52
     C                     ELSE
     C           CHTP      IFEQ 'D'
     C                     SETON                     53
     C                     END
     C                     END
     C                     END
      *
     C                     Z-ADDLCD       ZDAYNO
     C                     EXSR ZDATE2
      *
     C***********          ADD  1         LINCNT                          E22236
     C                     WRITEDETAIL
     C/COPY WNCPYSRC,SE0370C002
     C           *IN01     IFEQ '1'                                       E22236
     C                     WRITEHEADP1                                    E22236
     C                     SETOF                         01               E22236
     C                     END                                            E22236
     C           *IN49     IFEQ '0'                                       S01117
     C                     MOVE '1'       *IN49                           S01117
     C                     END                                            S01117
      *
     C*
     C* NEXT
     C           NEXT      TAG                             ** NEXT TAG  **
     C   40                READ SEACKLCD                 50
     C  N40                READ SEACKD                   50
     C                     END
     C/SPACE 3
      *
      * END OF FILE - IF DETAIL RECORDS WRITTEN - WRITE TOTAL LINE
      *
     C           TOTALS    TAG                             ** TOTALS TAG**
      *
     C           *IN55     IFEQ '1'
     C*                                                                   E22236
     C*  CHECK IF ENOUGH ROOM FOR TOTALS                                  E22236
     C*                                                                   E22236
     C***********          ADD  6         LINCNT                          E22236
     C***********LINCNT    IFGT MAXCNT                                    E22236
     C***********          Z-ADD0         LINCNT                          E22236
     C                     Z-ADD9         RQDLIN  30                      E22236
     C           OFLW      SUB  PRTLN     AVBLN   30                      E22236
     C           RQDLIN    IFGE AVBLN                                     E22236
     C                     WRITEHEADP1
     C                     END
     C*                                                                   E22236
     C                     WRITETOTAL
     C                     WRITETRAILP1                                   E32829
     C***********          WRITETRAILP1                                   S01117
     C                     END
     C***********                                                   S01117E29170
     C****WRITE*'*****NO*DETAILS*TO*REPORT****'*LINE****************S01117E29170
     C***********                                                   S01117E29170
     C************IN55     IFEQ '0'                                 S01117E29170
     C***********          MOVE '1'       *IN55                     S01117E29170
     C***********          OPEN SE0370P1                            S01117E29170
     C***********          EXSR RCFP1                               S01117E29170
     C***********          WRITEHEADP1                              S01117E29170
     C***********          WRITENONEP1                              S01117E29170
     C***********          END                                      S01117E29170
      *
     C/SPACE 3
      *================================================================
      *  RUN CONTROL PROCESS
      *================================================================
      *
      *
      **WRITE*CONTROL*REPORT*HEADINGS*************************************S01117
     C***********          WRITEHEADAU                                    S01117
      *
      * READ AUDIT RECORD
     C                     READ SEACKA                   50
     C           *IN,50    IFEQ '1'
     C***********          MOVEL'1'       *INU8                           S01117
     C***********          MOVEL'1'       *INU7                           S01117
     C***********          MOVEL'02'      DBASE            **DB ERROR 02**S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     Z-ADD2         DBASE            **DB ERROR 02**S01117
     C                     MOVEL'SEACKA'  DBFILE
     C                     MOVE *BLANK    DBKEY
     C***********          WRITEERROR                                     S01117
     C***********          WRITETRAILAU                                   S01117
     C***********          GOTO ENDPGM                                    S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR DBERR                                     S01117
     C                     END
      *
      * 'I' MODE - PRINT REPORT
     C           MODE      IFEQ 'I'
     C                     WRITEHEADAU                                    S01117
     C                     WRITECONTROLI
      *
      *
      * 'A'/'L' MODE -
     C                     ELSE
      *
      *
      * 'A' MODE - DO RUN CONTROLS
     C           MODE      IFEQ 'A'
     C********** SLRB      ADD  SINS      ZWORK                                             BUG12646
     C           SLRB10    ADD  SINS10    ZWORK                                             BUG12646
     C********** ZWORK     SUB  SDEL      ZWORK                                             BUG12646
     C           ZWORK     SUB  SDEL10    ZWORK                                             BUG12646
     C           ZWORK     IFNE ZLIVE
     C                     SETON                     U854
     C                     END
      *
      *          - PRINT REPORT
     C                     WRITEHEADAU                                    S01117
     C                     WRITECONTROLA
      *
      *          - UPDATE AUDIT RECORD
     C           *INU8     IFEQ '0'
     C**********           Z-ADD0         SINS                                              BUG12646
     C                     Z-ADD0         SINS10                                            BUG12646
     C**********           Z-ADD0         SAMD                                              BUG12646
     C                     Z-ADD0         SAMD10                                            BUG12646
     C**********           Z-ADD0         SDEL                                              BUG12646
     C                     Z-ADD0         SDEL10                                            BUG12646
     C******               Z-ADDNORE      SLRB                            E13651
     C**********           Z-ADDZLIVE     SLRB                                       E13651 BUG12646
     C                     Z-ADDZLIVE     SLRB10                                            BUG12646
     C**********           Z-ADDZLIVE     NORE                                       E13651 BUG12646
     C                     Z-ADDZLIVE     NORE10                                            BUG12646
     C                     UPDATSEACKAF
     C                     END
      *
      * 'L' MODE - DO RUN CONTROLS
     C                     ELSE
     C********** NORE      IFNE ZLIVE                                                       BUG12646
     C           NORE10    IFNE ZLIVE                                                       BUG12646
     C                     SETON                     U854
     C                     END
      *
      *          - PRINT REPORT
     C                     WRITEHEADAU                                    S01117
     C                     WRITECONTROLL
     C                     END
     C                     END
      *
      *  IF NO OUTPUT - WRITE MESSAGE TO THIS EFFECT
     C************IN55     IFEQ '0'                                       S01117
     C           *IN49     IFEQ '0'                                       S01117
     C                     WRITENONE
     C                     END
      *
     C***********          WRITETRAILAU                                   S01117
     C***********          WRITETRAILP1                             S01117E32829
     C/SPACE 3
      *================================================================
      *  END OF PROGRAM
      *================================================================
      *
     C           ENDPGM    TAG                             ** ENDPGM TAG**
     C                     SETON                     LR
     C                     RETRN
     C*
     C*****************************************************************
     C/EJECT                                                              S01117
     C********************************************************************S01117
     C**                                                                  S01117
     C**   DBERR SR.- DATABASE ERROR SUBROUTINE                           S01117
     C**                                                                  S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C           DBERR     BEGSR                           ** DBERR SR ** S01117
     C**                                                                  S01117
     C**   DATABASE ERROR HANDLING , REPORT ETC.                          S01117
     C**                                                                  S01117
     C** WRITE DB ERROR DETAILS TO P1                                     S01117
     C**                                                                  S01117
     C           *IN55     IFEQ '0'                        * P1 NOT OPEN  S01117
     C                     MOVE '1'       *IN55                           S01117
     C                     OPEN SE0370P1                                  S01117
     C                     EXSR RCFP1                                     S01117
     C                     WRITEHEADP1                                    S01117
     C                     ELSE                            * P1 OPENED    S01117
     C**                                                                  S01117
     C** If less than 9 lines left on page, start new one.                S01117
     c**                                                                  S01117
     C                     Z-ADD9         RQDLIN  30                      S01117
     C           OFLW      SUB  PRTLN     AVBLN   30                      S01117
     C           RQDLIN    IFGE AVBLN                                     S01117
     C                     WRITEHEADP1                                    S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     WRITEERRORP1                                   S01117
     C                     WRITETRAILP1                                   S01117
     C**                                                                  S01117
     C** OUTPUT RUN CONTROL DETAILS FOR AU                                S01117
     C**                                                                  S01117
     C                     WRITEHEADAU                                    S01117
     C           MODE      IFEQ 'A'                                       S01117
     C                     WRITECONTROLA                                  S01117
     C                     ELSE                                           S01117
     C                     WRITECONTROLL                                  S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C** OUTPUT DB ERROR DETAILS FOR AU                                   S01117
     C**                                                                  S01117
     C                     WRITEERROR                                     S01117
     C**                                                                  S01117
     C                     SETON                     U7U8LR               S01117
     C                     EXSR *PSSR                                     S01117
     C**                                                                  S01117
     C                     RETRN                                          S01117
     C**                                                                  S01117
     C                     ENDSR                                          S01117
     C**                                                                  S01117
     C********************************************************************S01117
     C/EJECT                                                              S01117
     C********************************************************************S01117
     C**                                                                  S01117
     C** RCFP1 -- SUBROUTINE TO REGISTER P1 PRINTER FILE VIA RCF          S01117
     C**                                                                  S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C           RCFP1     BEGSR                            ** RCFP1 **   S01117
     C**                                                                  S01117
     C**      ENSURE REPORT SPOOL FILE RECORDED BY RCF                    S01117
     C**                                                                  S01117
     C                     Z-ADDSFNUM     ZSNUM   60                      S01117
     C**                                                                  S01117
     C                     CALL 'ZSFILE'                                  S01117
     C                     PARM           SEQ     5                       S01117
     C                     PARM *BLANKS   SENTY   3                       S01117
     C                     PARM           SFILE                           S01117
     C                     PARM           ZSNUM                           S01117
     C                     PARM           ZSERR   1                       S01117
     C*                                                                   S01117
     C           ZSERR     IFEQ 'Y'                                       S01117
     C**  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       S01117
     C                     SETON                     U7U8LR               S01117
     C                     RETRN                                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C/EJECT                                                              S01117
     C********************************************************************S01117
     C**                                                                  S01117
     C** RCFAU -- SUBROUTINE TO REGISTER AU PRINTER FILE VIA RCF          S01117
     C**                                                                  S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C           RCFAU     BEGSR                            ** RCFAU **   S01117
     C**                                                                  S01117
     C**      ENSURE AUDIT SPOOL FILE RECORDED BY RCF                     S01117
     C**                                                                  S01117
     C                     Z-ADDSFNUMU    ZSNUMU  60                      S01117
     C**                                                                  S01117
     C                     CALL 'ZSFILE'                                  S01117
     C                     PARM           SEQ     5                       S01117
     C                     PARM *BLANK    SENTY   3                       S01117
     C                     PARM           SFILEU                          S01117
     C                     PARM           ZSNUMU                          S01117
     C                     PARM           ZSERR   1                       S01117
     C*                                                                   S01117
     C           ZSERR     IFEQ 'Y'                                       S01117
     C**  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       S01117
     C                     SETON                     U7U8LR               S01117
     C                     RETRN                                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C*                                                                   S01117
      *****************************************************************   S01117
      /EJECT                                                              S01117
      *****************************************************************   S01117
      *                                                               *   S01117
      *  *PSSR  - Error control subroutine                            *   S01117
      *                                                               *   S01117
      *****************************************************************   S01117
      *                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR **    S01117
     C**                                                                  S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     ENDSR                                          S01117
      *                                                                   S01117
     C********************************************************************S01117
      /EJECT
     C/COPY ZSRSRC,ZDATE2Z4
      /EJECT
     C***COPY*ZSRSRC,ZSYSTMZ1                                             S01117
      ***
**  CPY@
(c) Finastra International Limited 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
