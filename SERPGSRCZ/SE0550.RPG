     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Trades confirmations')                        *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Securities Trading Module                            *
     F*                                                               *
     F*  SE0550 - TRADES CONFIRMATIONS                                *
     F*                                                               *
     F*  Function: To print Confirmations for Complete Trades that    *
     F*   (I/C)    were Input, Amended or Cancelled Today and also,   *
     F*  (I/C TRM) Trades that were made Complete today.              *
     F*                                                               *
     F*  Called by: SEC0304 - Input Cycle Confirmation Print          *
     F*             SEC0309 - Input Cycle Confirmation Reprint        *
     F*             Frequency:                                        *
     F*             - on request during I/C                           *
     F*             - As a reprint by trade number or 'all' in I/C    *
     F*             - As part of I/C Termination procedure for        *
     F*               unrequested items                               *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD046998A          Date 05Oct21               *
      *  Prev Amend No. 260909             Date 04Apr19               *
      *                 MD046248           Date 27Oct17               *
      *                 226449             Date 24Jun15               *
      *                 CER059             Date 19Jul10               *
      *                 CER054             Date 07Apr09               *
      *                 BUG23123           Date 09Mar09               *
      *                 CER048             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 245736             Date 28Feb07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD027             Date 09Dec05               *
      *                 BUG10347           Date 05Jan06               *
      *                 CGL031             Date 05Jul04               *
      *                 CSE071             Date 19Jul05               *
      *                 CGL029             Date 01Sep03               *
      *                 CGP001             Date 23May03               *
      *                 208241             Date 21Aug02               *
      *                 180056             Date 18Oct00               *
      *                 CSE037             Date 29Apr02               *
      *                 CSE035             Date 22Apr02               *
      *                 CAS006             Date 21Jan03               *
      *                 206316             Date 19Jul02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CSE031             Date 09Nov01               *
      *                 180707             Date 25Jul00               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CSE022             Date 29Mar01               *
      *                 127566             Date 09May01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 187888             Date 19Dec00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CSE023             Date 12Jul00               *
      * Midas DBA 3.03 -----------------------------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *                 165571             Date 17Aug99               *
     F*                 CSE006             Date 23Jul99               *
     F*                 CPB001             DATE 18Jun99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 130862             Date 18Oct98               *
      *                 151945             DATE 06Jan99               *
     F*                 CSE005             DATE 04FEB97               *
     F*                 100228             DATE 30MAY96               *
     F*                 S01408             DATE 14MAY96               *
     F*                 066041             DATE 29APR96               *
     F*                 100017             DATE 18APR96               *
     F*                 092968             DATE 09OCT95               *
     F*                 092961             DATE 04OCT95               *
     F*                 091254             DATE 20OCT95               *
     F*                 087837             DATE 07JUN95               *
     F*                 086491             DATE 15JUN95               *
     F*                 S01408             DATE 17JAN95               *
     F*                 S01408             DATE 17MAY94               *
     F*                 052254             DATE 10JAN94               *
     F*                 057453             DATE 25NOV93               *
     F*                 S01446             DATE 04NOV93               *
     F*                 S01401             DATE 16JUN93               *
     F*                 S01408             DATE 10FEB93               *
     F*                 E43703             DATE 06OCT92               *
     F*                 S01397             DATE 10SEP92               *
     F*                 E43208             DATE 01SEP92               *
     F*                 E42254             DATE 09JUL92               *
     F*                 AUS004             DATE 17JUN92               *
     F*                 E37680             DATE 26MAR92               *
     F*                 E37016             DATE 13MAR92               *
     F*                 E34947             DATE 20FEB92               *
     F*                 E32580             DATE 12DEC91               *
     F*                 E32540             DATE 12DEC91               *
     F*                 E32538             DATE 12DEC91               *
     F*                 E32537             DATE 12DEC91               *
     F*                 E29170             DATE 28OCT91               *
     F*                 E28804             DATE 15OCT91               *
     F*                 E03884             DATE 25SEP91               *
     F*                 E27083             DATE 24SEP91               *
     F*                 E27092             DATE 04SEP91               *
     F*                 S01117             DATE 13MAY91               *
     F*                 S01271             DATE 19JUN90               *
     F*                 E21616             DATE 03APR90               *
     F*                 E20651             DATE 04JAN90               *
     F*                 E19916             DATE 16NOV89               *
     F*                 E20125             DATE 08NOV89               *
     F*                 E20086             DATE 08NOV89               *
     F*                 E18982             DATE 07NOV89               *
     F*                 E19895             DATE 25OCT89               *
     F*                 E19896             DATE 19OCT89               *
     F*                 E18115             DATE 15/06/89              *
     F*                 E17174             DATE 18/04/89              *
     F*                 E16473             DATE 03/03/89              *
     F*                 E16331             DATE 28/02/89              *
     F*                 E16832             DATE 23/02/89              *
     F*                 E16831             DATE 23/02/89              *
     F*                 S01176             DATE 11/11/88              *
     F*                 E14238             DATE 27/07/88              *
     F*                 E13911             DATE 04/07/88              *
     F*                 S01175             DATE 01/07/88              *
     F*                 S01169             DATE 16/06/88              *
     F*                 E13529             DATE 15/06/88              *
     F*                 S01158             DATE 06/05/88              *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  MD046998A - Recompiled due to changes in /COPY ZDYYRZ3       *
      *            - Applied for MD-58911                             *
      *  260909 - Security Trade calculates wrong consideration on MBS*
      *         - Applied for MD-51447                                *
      *  MD046248 - Finastra Rebranding                               *
      *  226449 - Recompiled over changes made in /COPY ZDYYRZ3.      *
      *         - Applied for MD034387.                               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER054 - German Features - Church Tax (Recompile)            *
      *  BUG23123 - Report: Does not show Retail Account Number       *
      *                     Date is not Midas Standard Date           *
      *                     Period should be actual int. calc. period *
      *                     Secondary Tax amount is not printed       *
      *                     Added field TSSLID                        *
      *                     (Recompile)                               *
      *  CER048 - German Features - Taxes (Recompile)                 *
      *  245736 - Branch name is missing.                             *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  BUG10347- Branch record not found in TABLETR.                *
      *  CGL031 - Taxation of Savings Income                          *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CGP001 - Global Processing                                   *
      *  208241 - Recompiled over changed /CPY ZSDESCZ3.              *
      *  180056 - Recompiled over changed in ZDYYRZ3.                 *
      *  CSE037 - Bond Pricing - 3 Decimal Places in Trades Input     *
      *  CSE035 - NX/NNX Coupon Payment Processing.                   *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  206316 - Recompiled over changed ZLCDZ1.                     *
      *  CSE031 - Coupon Fixing for Floating Rate Notes.              *
      *           (recompilation due to change to ZNCD/ZLCD)          *
      *  180707 - No Position Settlements generated. Recompile over   *
      *           changes in /COPY ZNCDZ3.                            *
      *  CSE022 - Depository Definition Enhancement                   *
      *  127566 - Recompiled over changed ZSDESCZ3                    *
      *  187888 - Show Withholding Tax in Trades Confirmation and     *
      *           Trade Details Enquiry                               *
      *  CSE023 - Treaty Withholding Tax (Recompiled)                 *
     F*  165571 - Get erroneous account no. if sett. method 14.       *
     F*  CSE006 - Repurchase Agreements (REPOs) enhancement.  This    *
     F*           program no longer processes any Buy-Sell Backs.     *
     F*  CPB001 - 'Private Banking' Module                            *
     F*  130862 - Recompiled over ZLCDZ1 & ZDAYSZ2 changes.           *
     F*  151945 - Recompiled Over changed ZDYYRZ3 .                   *
     F*  CSE005 - Effect of holidays on FRN Coupon Dates              *
     F*           (recompilation due to change to ZNCD/ZLCD)          *
     F*  100228 - RECOMPILE OVER CHANGED ZDYYRZ3, ZLCDZ1 & ZNCDZ3.    *
     F*  S01408 - Core hook SE0550CCP2 added                          *
     F*           Core hook SE0550CCP1 added                          *
     F*  066041 - Wrong coupon rate printed on confirmation. Use      *
     F*           trade coupon rate instead of security coupon rate   *
     F*  100017 - Position settlement unable to pick up day adj. on   *
     F*           SECTYD. Change subroutine to use DADJN to stop      *
     F*           interest day adjustment being used for amortisation.*
     F*           Recompile over amended subroutine ZDAYS.            *
     F*  092968 - Remove 'DELIVER FROM' from text and change 'TO OUR' *
     F*           to 'FROM YOUR' and add Portfolio Reference          *
     F*  092961 - Recompile over ZDAYSZ2 which was amended by 086491  *
     F*           (Wrong number of days calculated for day basis 1    *
     F*           when start or end day is last day of February)      *
     F*  091254 - RECOMPILE OVER CHANGED ZLCDZ1 & ZNCDZ3              *
     F*  087837 - Deliver from depot reference not printed.           *
     F*  086491 - Wrong nbr of days calculated for day basis 1        *
     F*           when start or end day is last day of February       *
     F*           Recompiled for ZSRSRC/ZDAYSZ2 changes.              *
     F*  S01408 - Core hook SE0550FPG1 added                          *
     F*           Core hook SE0550CPD2 added                          *
     F*           Core hook SE0550CPD3 added                          *
     F*           Core hook SE0550CPD4 added                          *
     F*           Core hook SE0550CPD5 added                          *
     F*  S01408 - Core hook SE0550FPG  added                          *
     F*           Core hook SE0550CPD1 added                          *
     F*  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
     F*           to 10,9                                             *
     F*  057453 - Rounding error when calculating face value          *
     F*  S01446 - CUSTOMER COMMISSIONS (COURTAGE) ENHANCEMENT.        *
     F*           Recompiled due to changes in PF/SECGTD.             *
     F*  S01401 - MT5xx Message Generation. Mark paper confirmations  *
     F*           with 'Auto Transmission - Do not send' if they have *
     F*           already been sent via SWIFT.                        *
     F*  S01408 - Core hook SE0550CPDR added at end of SR/INSTR.      *
     F*  E43703 - If ALT name/address IND not blank pick up correct   *
     F*           record from CLINTCC                                 *
     F*  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
     F*          - Recompiled due to changes to files.                *
     F*  E43208 - Field AIBD changed to ISMA. ('Association of        *
     F*           International Bond Dealers' changed their name to   *
     F*           'International Securities Market Association').     *
     F*  E42254 - 'For a/c of - deliver to ' & 'For a/c of - deliver  *
     F*            from' should be clearly marked.                    *
     F*  AUS004 - Australian Release - 42 Line Confirmations Standard *
     F*           Recompiled over new printer files                   *
     F*  E37680 - Requested Branch checking is only applicable if the *
     F*           System is in Multibranched Mode.                    *
     F*  E37016 - LDA not allocated for output                        *
     F*  E34947 - Authorised amendments or cancellations do not print *
     F*           correct legend                                      *
     F*  E32580 - Should not show 'END OF REPORT'                     *
     F*  E32540 - Grey market confirmation should not show depots     *
     F*  E32538 - Account no. is not formatted properly on some       *
     F*           confirmations                                       *
     F*  E32537 - Account numbers should have branch codes            *
     F*  E29170 - Report Control Facility changes                     *
     F*  E28804 - Two new calls to SR/SE, (chain to PF/CLINTSE), added*
     F*           by E27083, should have a check for zero on the key  *
     F*           before processing.                                  *
     F*  E03884 - Stop 'NEXT COUPON DATE' showing for non-interest    *
     F*           bearing securities                                  *
     F*         - 'ADJUSTED BY' should only appear if there is any    *
     F*           interest adjustment                                 *
     F*  E27083 - Problems with Delivery For a/c of and a/c references*
     F*           for depots                                          *
     F*  E27092 - Recompiled over changed SR/ZLCD                     *
     F*  S01117 - Multibranching                                      *
     F*  S01271 - Recompiled for Pay/Receive in Input Cycle changes   *
     F*  E21616 - Recompiled over changed SR/ZLCD.                    *   E21616
     F*  E20651 - DB Error Numbers used in more than one place.       *   E20651
     F*           New Error Numbers as follows:                       *   E20651
     F*           DB ERROR 44  ->  48                                 *   E20651
     F*           DB ERROR 44  ->  49                                 *   E20651
     F*           DB ERROR 46  ->  50                                 *   E20651
     F*           DB ERROR 46  ->  51                                 *   E20651
     F*  E19916 - Changes made to Accrued Interest and Interest       *   E19916
     F*           Adjusted Lines.                                     *   E19916
     F*  E20125 - No of Days Accrued Interest calculated incorrectly. *   E20125
     F*           Pgm changed so that Date processing in SR/DAYSAC    *   E20125
     F*           is the same as that in SE0050.                      *   E20125
     F*  E20086 - Mortgage-Backs and Current Factor Processing Rewrite*   E20086
     F*          - Show nominal adjusted for current factor.          *   E20086
     F*          - Use TCSR from TRADSD record rather than recalcu-   *   E20086
     F*            lating Consideration from Nominal and Price. Since *   E20086
     F*            TCSR is no longer factored, the Current Factor     *   E20086
     F*            processing for PROT = '8' has been replaced.       *   E20086
     F*          - PROT is on INVTP. Have moved the INVTP CHAIN to    *   E20086
     F*            just after the SECTY CHAIN.                        *   E20086
     F*  E18982 - BROKER & CUSTOMER COMMISSIONS, AND CHARGES MUST BE  *   E18982
     F*           SHOWN SEPARATELY ON CONFIRMATION.                   *   E18982
     F*  E19895 - FACE VALUE NOT CORRECTLY SHOWN FOR TRADES - VALUE   *   E19895
     F*           TRUNCATED AFTER USING POWER8 ARRAY. TCSR FROM TRADE *   E19895
     F*           AS CALCULATED BY ZCTRV, IS USED FOR FACE VALUE.     *   E19895
     F*  E19896 - 'NEXT COUPON' ON THE CONFIRMATION SHOULD BE AS OF   *   E19896
     F*           VALUE DATE AND NOT RUN DATE. VALUE DATE MOVED TO    *   E19896
     F*           ECD AND REDUNDANT SUBROUTINE ZEVCD REMOVED          *   E19896
     F*  E18115 - CONFIRMATIONS 'VIA' REFERENCE FIELD.                *   E18115
     F*  E17174 - NEW ARRAY NARRATIVE FOR SETTLEMENT METHODS 05, 06   *   E17174
     F*           AND 15.                                             *   E17174
     F*  E16473 - DB ERROR WHEN PRODUCING SCHULDSCHEIN ISSUER         *   E16473
     F*           CONFIRMATIONS WITH SETTLEMENT METHODS 05 OR 06.     *   E16473
     F*  E16331 - THE 'VIA' FIELDS NOT APPEARING ON CERTAIN TRADE     *   E16331
     F*           CONFIRMATIONS.                                      *   E16331
     F*  E16832 - DO NOT HALF-ADJUST UP ON FACE VALUE.                *   E16832
     F*  E16831 - PRINT RETAIL ACCOUNT FROM TRADE FOR SETTLEMENT      *   E16831
     F*           INSTEAD OF FINDING FROM PF/CLINTSE.                 *   E16831
     F*  S01176 - SE 3.1 AUSTRALIAN MODS.                             *   S01176
     F*  E14238 - PRINT TRADE DATE INSTEAD OF RUN DATE.               *   E14238
     F*  E13911 - POST INCORPORATION FIXES FROM DEVELOPMENT.          *   E13911
     F*  S01175 - EUCLID.                                             *   S01175
     F*  S01169 - SEC. TRAD. 3.1(BAER INCORP.)                        *   S01169
     F*  E13529 - PROGRAM SHOULD NOT ONLY REFERENCE LIVE              *   E13529
     F*           SECURITIES BUT ALSO DELETED/CANCELLED SECURITIES.   *   E13529
     F*  S01158 - POST INCORPORATION DEVELOPMENT FIX.                 *
     F*                                                               *
     F*****************************************************************
      *
     FSE0550P1O   E                    PRINTER                        UC
     F                                              KINFDS SPOOL          E29170
     F*                                                                   S01408
     F/COPY WNCPYSRC,SE0550FPG1                                           S01408
     F*                                                                   S01408
     FSE0550AUO   E                    PRINTER                            S01117
     F                                              KINFDS SPOOLU         E29170
     FSECTY   IF  E           K        DISK
     FINVTP   IF  E           K        DISK
     FTRAUT   IF  E           K        DISK                               E34947
     FTRDCONF UF  E           K        DISK         KINFDS TRDDS
     F                                              KINFSR TRDSR
     F                                              KCOMIT                                    CGP001
     FSECGT   IF  E           K        DISK                               E18982
     FCLINT   IF  E           K        DISK
     F            CLINTCAF                          KIGNORE
     F*******     CLINTCBF                          KIGNORE
     F*******     CLINTCCF                          KIGNORE
     F            CLINTC1F                          KIGNORE
     F*******     CLINTSEF                          KIGNORE
     FTABSE   IF  E           K        DISK
     F* ICD 1     TABTB10F                          KIGNORE
     F* ICD 2     TABTB11F                          KIGNORE
     F* ICD SE    TABTB36F                          KIGNORE
     F*******     TABTB40F                          KIGNORE
     F*******     TABTG10F                          KIGNORE
     F            TABTG20F                          KIGNORE
     F            TABLETHF                          KIGNORE
     F*********** TABLETJF                          KIGNORE               S01117
     F            TABLETKF                          KIGNORE
     F*******     TABLETLF                          KIGNORE
     F            TABLETNF                          KIGNORE
     F            TABLETPF                          KIGNORE
     F*******     TABLETRF                          KIGNORE
     F            TABLETXF                          KIGNORE
     F*******     TABLET2F                          KIGNORE
     F            TABLET3F                          KIGNORE
     F            TABLET5F                          KIGNORE
     F            TABTE10F                          KIGNORE
     F            TABLETAF                          KIGNORE
     F            TABTE20F                          KIGNORE
     F            TABLETRF                          KIGNORE                                 BUG10347
     FTRADSDY1IF  E           K        DISK                           UC  S01401
     FTABTB20 IF  E                    DISK
     FFDRETALLIF  E           K        DISK                               165571
     F*                                                                   CSE006
     FSDBKPCL3IF  E           K        DISK                               CSE006
     FSDCSINL6IF  E           K        DISK                                                   CGL031
     F*                                                                   S01408
     F** Core hook for externalisation.                                   S01408
     F/COPY WNCPYSRC,SE0550FPG                                            S01408
     F*                                                                   S01408
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*   01/02  CONTROL FOR 'AUTO TRANSMISSION - DO NOT SEND'        *   S01401
     F*   03     CHAIN FAIL FOR TRADSDY1                              *   S01401
     F*   09     TEST CONDITION FOR TESTN COMMAND ON NAME TOWN 3      *
     F*   10     TEST CONDITION FOR TESTN COMMAND ON NAME TOWN 3      *
     F*   11     PRINT CONDITIONING INDICATOR                         *
     F*   12-19  COMPARE CHARGE FIELDS TO ZERO AND CONDITION OUTPUT   *   E18982
     F*   20     CONDITIONS PRINTING OF NO. OF DAYS FOR ACCRUED INT.  *
     F*   21     TEST CONDITION FOR TESTB COMMAND                     *
     F*   22-28  COMPARE OF ZEROS AND CONDITIONING OUTPUT             *
     F*   29     USED IN LOOK-UP OF ARRAY ARR36                       *
     F*   31     END OF FILE FOR TRDCONF                              *
     F*   33     PROCESSING TYPE '4'                                  *
     F*   37     MULTIBRANCHING ON                                    *   E29170
     F*   38     END OF FILE ON TRAUT                                 *   E34947
     F*   39     PORTFOLIO REFERENCE TO BE REPORTED                   *   092968
     F*   41     RECORD NOT FOUND WHEN CHAINING                       *
     F*   42     NOMINAL CCY DEC PLACES 0                             *
     F*   43     NOMINAL CCY DEC PLACES 1                             *
     F*   44     NOMINAL CCY DEC PLACES 2                             *
     F*   45     NOMINAL CCY DEC PLACES 3                             *
     F*   51     USED ON COMPARE OF BRANCH CODES BETWEEN RECORDS      *
     F*   61     FIRST TIME INDICATOR FOR OPENING PRINT FILE SE0550P1 *
     F*   71     USED IN STAR SUBROUTINE IN COMPARE OF *BLANKS        *
     F*   74-81  CONDITIONING LINE 16 LITERALS                        *
     F*   82     COMPARE OF PCOD                                      *
     F*   83     COMPARE OF PCOD FIELD                                *
     F*   84     COMPARE OF PCOD FIELD                                *
     F*   85     COMPARE OF PCOD FIELD                                *
     F*   86     COMPARE OF PCOD FIELD                                *
     F*   87     COMPARE OF PCOD FIELD                                *
     F*                                                               *
     F*   97     USED IN CONDITIONING IF UPDATE FAILS.                *
     F*   99     USED IN THE Z-SUBROUTINES                            *
     F*                                                               *
     F*   U7-U8  DATABASE    OR                                       *
     F*   U8     DIFFERENCE BETWEEN CALC AND FILE TOTALS OF RECORDS   *
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*  FIRST   -  OBTAINS ICD INFO                                  *
     F*  PRINT   -  CONTROLS PRINTING OF REPORT                       *
     F*  AUDIT   -  PRINTS ANY DB ERRORS                              *
     F*  INSTR   -  DETERMINES THE CONTENTS OF FIELDS 29 -34          *
     F*  ISSUER  -  DETERMINES OUTPUT OF AN ISSUER CONFIRMATION       *
     F*  DAYSAC  -  CALLED WHEN NO. OF DAYS OF ACCRUED INTEREST CALC'D*
     F*  UPDATE  -  UPDATE SR TO UPDATE TRDCONF                       *
     F*  STAR    -  ASTERISK FILL NUMERIC FIELDS                      *
     F*  CB      -  CHAINS TO THE CLINTCB FILE                        *
     F***CC******-  CHAINS TO THE CLINTCC FILE                        *   127566
     F*  CC0     -  CHAINS TO THE CLINTCC FILE                        *   127566
     F*  SE      -  CHAINS TO THE CLINTSE FILE                        *
     F*  TR      -  CHAINS TO THE TABLETR FILE                        *
     F*  TL      -  CHAINS TO THE TABLETL FILE                        *
     F*  T2      -  CHAINS TO THE TABLET2 FILE                        *
     F*  *PSSR   -  ERROR HANDLING                                    *   S01117
     F*  RCFP1   -  SUBROUTINE TO REGISTER P1 PRINTER FILE VIA RCF    *   E29170
     F*  RCFAU   -  SUBROUTINE TO REGISTER AU PRINTER FILE VIA RCF    *   E29170
     F*  SREWTX  -  PRINT EU W/HOLDING TAX IF CGL031 IS SWITCHED ON.  *                       CGL031
     F*                                                               *
     F*  ZCONV   -  CONVERTS AMOUNT FROM ONE CCY TO ANOTHER CCY       *
     F*  ZDATE2  -  DAYNO - DATE CONVERSION                           *
     F*  ZDAYS   -  CALCS NUMBER OF DAYS OF ACCRUED INTEREST.         *
     F*  ZDYYR   -  CALCS NUMBER OF DAYS IN INTEREST YEAR.            *
     F***ZEVCD***-**DETERMINE EVENT CONTROL DATE************          *   E19896
     F*  ZICD2   -  OBTAINS ICD INFORMATION                           *
     F*  ZICDSE  -  OBTAINS ICD INFORMATION                           *
     F*  ZLCD    -  CALCULATES THE LAST COUPON DATE                   *   E20125
     F*  ZNCD    -  CALCULATES THE NEXT COUPON DATE                   *
     F*  ZSEDIT  -  PUTS COMMAS, DEC.PL AND SIGN IN NUMERIC FIELDS    *
     F*  ZSYSTM  -  CHAINS TO ICD TABTB10                             *
     F*                                                               *
     F*****************************************************************
      /EJECT
     E                    CPY@    1   1 80
     E                    ARRB       21  1
     E                    ARR36      10  6
     E**********          ARRSE      10  6                                                    CSE022
     E                    ARRSE      10 20                                                    CSE022
     E/COPY ZSRSRC,ZNCDZ1
     E/COPY ZSRSRC,ZSEDITZ1
     E/COPY ZSRSRC,ZDAYSZ1
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY ZSRSRC,ZSDESCZ1
     E********************ARRA    1  39 58                                S01175
     E********************ARRA    1  40 58                       S01175   E17174
     E                    ARRA    1  41 58                       S01175   E17174
     E                    POWER8  1   8  8 4
     E/COPY ZSRSRC,ZPOWERZ1
     E/COPY WNCPYSRC,SE0550E001
      /EJECT
     E/COPY WNCPYSRC,SE0550E002
      *                                                                                       CSE037
     IINVTPDF                                                                                 CSE037
     I              SFLG                            ISFLG                                     CSE037
      *                                                                                       CSE037
     ICPYR@#      DS
     I*
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I*
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
      *                                                                                       CGL031
      ** DS Bank Details                                                                      CGL031
     ISDBANK    E DSSDBANKPD                                                                  CGL031
      *                                                                                       CGL031
     I** DS for Access Programs, Long Data Structure                                          CGL031
     IDSSDY     E DSDSSDY                                                                     CGL031
     I*
     I*LDA********UDS                            256                      S01117
     I*
     I*  LOCAL DATA-AREA DATA STRUCTURE USED FOR DB ERRORS
     I*
     ILDA         DS                            256                       S01117
     I                                      134 183 DBLOT                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     I***********                           134 177 DBLOT                 S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 1770DBASE                 S01117
     I*                                                                   E29170
     ISPOOL       DS                                                      E29170
     I*                                                                   E29170
     I**  DS FOR P1 SPOOL FILE NAME                                       E29170
     I*                                                                   E29170
     I                                       83  92 SFILE                 E29170
     I                                    B 123 1240SFNUM                 E29170
     I/COPY WNCPYSRC,SE0550I002
     I*                                                                   E29170
     ISPOOLU      DS                                                      E29170
     I*                                                                   E29170
     I                                       83  92 SFILEU                E29170
     I                                    B 123 1240SFNUMU                E29170
     I*
      *  Define a work field to set up key for CHAIN to LF/FDRETALL       165571
     I            DS                                                      165571
     I**********                              1  120W#ACNO                             165571 CGL029
     I                                        1  180W#ACNO                                    CGL029
     I                                        1  100K#ACNO                165571
      *                                                                   165571
     I            DS
     I*
     I*  REDEFINE THE FIELD PAYT (TRADES)
     I*
     I**********                              1  12 PAYT                                      CGL029
     I                                        1  18 PAYT                                      CGL029
     I                                        1   2 NOSTR
     I                                        3  18 @NSX                                      CSD027
     I                                        1   6 CUSTNO
     I                                        1   8 COUSNM
     I*
     I            DS
     I*
     I*  REDEFINE THE FIELD PYFM (TRADES)
     I*
     I**********                              1  12 PYFM                                      CGL029
     I                                        1  18 PYFM                                      CGL029
     I                                        1   2 NOSTR2
     I                                        3  18 @NSX2                                     CSD027
     I                                        1   6 CUSTN2
     I                                        1   8 COSNM2
     I*
     I            DS
     I*
     I*  REDEFINE THE FIELD TDFA (TRADES)
     I*
     I                                        1   8 TDFA
     I                                        1   6 TDFACN
     I*
     I            DS
     I*
     I*  REDIFINE THE FIELD DTFA (TRADES)
     I*
     I                                        1   8 DTFA
     I                                        1   6 DTFACN
     I*                                                                   S01175
     I            DS                                                      S01175
     I*                                                                   S01175
     I*  REDEFINE THE FIELD DFFA (TRADES)                                 S01175
     I*                                                                   S01175
     I                                        1   8 DFFA                  S01175
     I                                        1   6 DFFACN                S01175
     I*
     I            DS
     I*
     I*  DS TO FILL THE ARRAY ARR36 WHEN READING A RECORD
     I*  FROM THE FILE TABTB36
     I*
     I**********                              1   60DC01                                      CSD027
     I**********                              7  120DC02                                      CSD027
     I**********                             13  180DC03                                      CSD027
     I**********                             19  240DC04                                      CSD027
     I**********                             25  300DC05                                      CSD027
     I**********                             31  360DC06                                      CSD027
     I**********                             37  420DC07                                      CSD027
     I**********                             43  480DC08                                      CSD027
     I**********                             49  540DC09                                      CSD027
     I**********                             55  600DC10                                      CSD027
     I                                        1   6 DC01                                      CSD027
     I                                        7  12 DC02                                      CSD027
     I                                       13  18 DC03                                      CSD027
     I                                       19  24 DC04                                      CSD027
     I                                       25  30 DC05                                      CSD027
     I                                       31  36 DC06                                      CSD027
     I                                       37  42 DC07                                      CSD027
     I                                       43  48 DC08                                      CSD027
     I                                       49  54 DC09                                      CSD027
     I                                       55  60 DC10                                      CSD027
     I                                        1  60 ARR36
     I*
     I            DS
     I*
     I*  DS TO FILL THE ARRAY ARRSE WHEN READING A RECORD
     I*  FROM THE FILE CLINTSE
     I*
     I**********                              1   6 C101                                      CSE022
     I**********                              7  12 C102                                      CSE022
     I**********                             13  18 C103                                      CSE022
     I**********                             19  24 C104                                      CSE022
     I**********                             25  30 C105                                      CSE022
     I**********                             31  36 C106                                      CSE022
     I**********                             37  42 C107                                      CSE022
     I**********                             43  48 C108                                      CSE022
     I**********                             49  54 C109                                      CSE022
     I**********                             55  60 C110                                      CSE022
     I**********                              1  60 ARRSE                                     CSE022
     I                                        1  20 C201                                      CSE022
     I                                       21  40 C202                                      CSE022
     I                                       41  60 C203                                      CSE022
     I                                       61  80 C204                                      CSE022
     I                                       81 100 C205                                      CSE022
     I                                      101 120 C206                                      CSE022
     I                                      121 140 C207                                      CSE022
     I                                      141 160 C208                                      CSE022
     I                                      161 180 C209                                      CSE022
     I                                      181 200 C210                                      CSE022
     I                                        1 200 ARRSE                                     CSE022
     I*
     I            DS
     I*
     I*  DS USED OCCASIONALLY FOR OUTPUT AND HOLDS INFORMATION
     I*  FROM SEVERAL FIELDS WHICH ARE OUTPUT IN ONE FIELD.
     I*
     I***********                             1   6 CUST                  E32537
     I***********                             7  10 CURRCY                E32537
     I***********                            11  15 ACCODE                E32537
     I***********                            16  18 ACSEQ                 E32537
     I***********                             1  18 CUSTAC                E32537
     I**********                              1  22 CUSTAC                             E32537 CGL029
     I                                        1  28 CUSTAC                                    CGL029
     I                                        1   4 BRANCH                E32537
     I                                        5  10 CUST                  E32537
     I                                       11  14 CURRCY                E32537
     I**********                             15  19 ACCODE                             E32537 CGL029
     I**********                             20  22 ACSEQ                              E32537 CGL029
     I                                       15  25 ACCODE                                    CGL029
     I                                       26  28 ACSEQ                                     CGL029
     I            DS
     I                                        1   9 TRDKEY
     I***********                             1   30TDBR                  S01117
     I                                        1   3 TDBA                  S01117
     I                                        4   9 TDRF
     ITRDDS       DS
     I                                     *STATUS  TRDSTS
     I*                                                                   092968
     ISDMMOD    E DSSDMMODPD                                              092968
     I** Dummy record format for access to Modules File                   092968
     I*                                                                   092968
     ISDPORT    E DSSDPORTPD                                              092968
     I** Dummy record format for access to Portfolio Management ICD       092968
     I*                                                                   092968
     ISDBOOK    E DSSDBOOKPD                                              CSE006
     I** Dummy record format for access to Book Codes table               CSE006
     I*                                                                   CSE006
     ISDBRCH    E DSSDBRCHPD                                                                BUG10347
      ** Midas SD Branch Codes                                                              BUG10347
      *                                                                                     BUG10347
     IDSFDY     E DSDSFDY                                                 092968
     I** First DS for access programs, short data structure               092968
     I*                                                                   092968
     I/COPY WNCPYSRC,SE0550I001
     I/COPY ZSRSRC,ZSEDITZ2
     I/COPY ZSRSRC,ZNCDZ2
     I/COPY ZSRSRC,ZSDESCZ2
     C/EJECT
      *================================================================
      *  P R O G R A M   S T A R T                                    *
      *================================================================
     C*                                                                   S01117
     C* Parameter list                                                    S01117
     C*                                                                   S01117
     C           *ENTRY    PLIST                                          S01117
     C                     PARM           SEQ     5                       S01117
     C                     PARM           ENT     3                       S01117
     C*
     C* CLEAR LDA
     C*
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE *BLANK    DBLOT
     C                     MOVE 'SE0550  'DBPGM
     C                     OUT  LDA                                       S01117
     C*
     C*  INITIALIZE SUBSCRIPTS
     C*
     C                     Z-ADD1         A       20
     C                     Z-ADD1         B       20
     C                     Z-ADD1         Y       20
     C                     Z-ADD1         V       20
     C*
     C*  SET UP KEY TO ACCESS INVTPD FOR PROCESSING TYPE FIELD
     C*
     C           KEYFLD    KLIST
     C                     KFLD           NMCY
     C                     KFLD           SITP
     C*                                                                   E18982
     C*  SET UP KEY TO ACCESS SECGT FOR PROCESSING CHARGE CODE NARRATIVE  E18982
     C*                                                                   E18982
     C           @CCOD     KLIST                                          E18982
     C                     KFLD           @CCY                            E18982
     C                     KFLD           @CAM                            E18982
      *                                                                                       CGL031
      ** Set up key to access SDCSINL6                                                        CGL031
      *                                                                                       CGL031
     C           KCSIN6    KLIST                                                              CGL031
     C                     KFLD           BJRDNB                                              CGL031
     C                     KFLD           WMODI   1                                           CGL031
     C                     KFLD           WTDRF   60                                          CGL031
      *                                                                   S01401
      ***  Check if MT5xx Feature is switched on.                         S01401
      *                                                                   S01401
     C                     MOVE 'N'       S01401                          S01401
     C                     CALL 'AOSARDR0'                                S01401
     C                     PARM '       ' WRTCD   7                       S01401
     C                     PARM '*VERIFY' WOPTN   7                       S01401
     C                     PARM 'S01401'  WSARD   6                       S01401
      *                                                                   S01401
     C           WRTCD     IFEQ *BLANKS                                   S01401
     C                     MOVE 'Y'       S01401  1                       S01401
     C                     OPEN TRADSDY1                                  S01401
     C                     ENDIF                                          S01401
      *                                                                   CSE006
      ***  Check if CAC005 Feature is switched on.                        CSE006
      *                                                                   CSE006
     C                     MOVE 'N'       CAC005                          CSE006
     C                     CALL 'AOSARDR0'                                CSE006
     C                     PARM '       ' WRTCD   7                       CSE006
     C                     PARM '*VERIFY' WOPTN   7                       CSE006
     C                     PARM 'CAC005'  WSARD   6                       CSE006
      *                                                                   CSE006
     C           WRTCD     IFEQ *BLANKS                                   CSE006
     C                     MOVE 'Y'       CAC005  1                       CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      ** Check if CSE023 Feature is switched on                           187888
      *                                                                   187888
     C                     CALL 'AOSARDR0'                                187888
     C                     PARM *BLANKS   WRTCD                           187888
     C                     PARM '*VERIFY' WOPTN                           187888
     C                     PARM 'CSE023'  WSARD                           187888
      *                                                                   187888
     C           WRTCD     IFEQ *BLANKS                                   187888
     C                     MOVE 'Y'       CSE023  1                       187888
     C                     ELSE                                           187888
     C                     MOVE 'N'       CSE023                          187888
     C                     ENDIF                                          187888
      *                                                                   187888
     C                     CALL 'AOSARDR0'                                                    CSE022
     C                     PARM *BLANKS   PRTCO   7                                           CSE022
     C                     PARM '*VERIFY' POPTN   7                                           CSE022
     C                     PARM 'CSE022'  PSARD   6                                           CSE022
      *                                                                                       CSE022
     C           PRTCO     IFEQ *BLANKS                                                       CSE022
      *                                                                                       CSE022
     C                     MOVE 'Y'       CSE022  1                                           CSE022
      *                                                                                       CSE022
     C                     ELSE                                                               CSE022
      *                                                                                       CSE022
     C                     MOVE 'N'       CSE022                                              CSE022
      *                                                                                       CSE022
     C                     ENDIF                                                              CSE022
      *                                                                                       CSE022
      ** Access SAR details file to see if CSE035 is installed                                CSE035
      *                                                                                       CSE035
     C                     CALL 'AOSARDR0'                                                    CSE035
     C                     PARM *BLANKS   WRTCD                                               CSE035
     C                     PARM '*VERIFY' WOPTN                                               CSE035
     C                     PARM 'CSE035'  WSARD                                               CSE035
      *                                                                                       CSE035
     C           WRTCD     IFEQ *BLANK                                                        CSE035
     C                     MOVE 'Y'       CSE035  1                                           CSE035
     C                     ELSE                                                               CSE035
     C                     MOVE 'N'       CSE035                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
      ** Check if CGL031 Feature is switched on                                               CGL031
      *                                                                                       CGL031
     C                     MOVE *OFF      *IN73                                               CGL031
     C                     MOVE 'N'       CGL031  1                                           CGL031
     C                     CALL 'AOSARDR0'                                                    CGL031
     C                     PARM *BLANKS   PRTCO                                               CGL031
     C                     PARM '*VERIFY' POPTN                                               CGL031
     C                     PARM 'CGL031'  PSARD                                               CGL031
      *                                                                                       CGL031
      ** DB Error Management.                                                                 CGL031
      *                                                                                       CGL031
     C           PRTCO     IFNE *BLANK                                                        CGL031
     C           PRTCO     ANDNE'*NRF   '                                                     CGL031
     C           *LOCK     IN   LDA                                                           CGL031
     C                     Z-ADD69        DBASE                                               CGL031
     C                     MOVEL'SCSARDPD'DBFILE                                              CGL031
     C                     MOVEL'CGL031'  DBKEY                                               CGL031
     C                     OUT  LDA                                                           CGL031
     C                     EXSR *PSSR                                                         CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** CGL031 Feature is on.                                                                CGL031
      *                                                                                       CGL031
     C           PRTCO     IFEQ *BLANK                                                        CGL031
     C                     MOVE 'Y'       CGL031                                              CGL031
     C                     MOVE *ON       *IN73                                               CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** Access bank details if CGL031 is switched ON.                                        CGL031
      *                                                                                       CGL031
     C                     CALL 'AOBANKR0'                                                    CGL031
     C                     PARM *BLANKS   PRTCO                                               CGL031
     C                     PARM '*FIRST ' POPTN                                               CGL031
     C           SDBANK    PARM SDBANK    DSSDY                                               CGL031
      *                                                                                       CGL031
      ** DB Error Management.                                                                 CGL031
      *                                                                                       CGL031
     C           PRTCO     IFNE *BLANK                                                        CGL031
     C           *LOCK     IN   LDA                                                           CGL031
     C                     Z-ADD70        DBASE                                               CGL031
     C                     MOVEL'SDBANKPD'DBFILE                                              CGL031
     C                     MOVELPOPTN     DBKEY                                               CGL031
     C                     OUT  LDA                                                           CGL031
     C                     EXSR *PSSR                                                         CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C/COPY WNCPYSRC,SE0550C020
     C*
     C* OBTAIN ICD INFO
     C*
     C                     EXSR FIRST
     C*
     C* CHECK FOR DATABASE ERRORS
     C*
     C           *INU7     IFEQ '1'
     C                     GOTO EAUDIT
     C                     END
     C*
     C*
     C*  READ FIRST RECORD FROM THE TRADES FILE TRDCONF
     C*  IF EOF SETON *IN31
     C*
     C                     READ TRADSDF                  31
      *                                                                   E37680
      ***  If the system is in Multibranched Mode,                        E37680
      *                                                                   E37680
     C           MBIN      IFEQ 'Y'                                       E37680
     C*                                                                   E29170
     C** Only process record if branch is requested                       E29170
     C*                                                                   E29170
     C           *IN31     IFEQ '0'                                       E29170
     C           ENT       IFNE 'ALL'                                     E29170
     C           ENT       ANDNETDBA                                      E29170
     C                     SETON                     31                   E29170
     C                     END                                            E29170
     C                     END                                            E29170
      *                                                                   E37680
     C                     END                                            E37680
     C/COPY WNCPYSRC,SE0550C031
     C*                                                                   E29170
     C           *IN31     DOWEQ'0'
     C*                                                                   E19896
      * If Link Ref. is not blank, check to see if book is a Buy-Sell     CSE006
      * book (i.e. is the trade a Buy-Sell back).                         CSE006
     C           LKRF      IFNE *BLANKS                                   CSE006
     C                     EXSR SRBOOK                                    CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      * If is a Buy-Sell, read next record.  Else process the trade.      CSE006
     C           BDBYSL    IFNE 'Y'                                       CSE006
      *                                                                   CSE006
     C*  STORE THE VALUE DATE OF THE TRADE AS THE EVENT CONTROL DATE      E19896
     C*                                                                   E19896
     C                     Z-ADDTDVD      ECD     50                      E19896
     C*
     C*  STORE THE CONTENTS OF CHTP FROM THE TRADES FILE INTO A WORK FIELD
     C*  SO THAT IT CAN BE REFERRED TO LATER IN PROGRAM.
     C*  EXECUTE THE SUBROUTINE PRINT INORDER TO GET DATA TO BE OUTPUT.
     C*
     C                     MOVE CHTP      CHGTYP  1
     C                     MOVE RECI      TRECI   1                       E34947
     C                     EXSR PRINT
     C*
     C*  IF ANY DB ERRORS WHEN CHAINING TO A FILE IN SUBROUTINES, PERFORM
     C*  ERROR AUDIT REPORT ROUTINE.
     C*
     C           *INU7     IFEQ '1'
     C                     GOTO EAUDIT
     C                     END
     C*
     C*  IF THE PROCESSING TYPE (FROM LF/INVTP) OF THE CURRENT RECORD IS
     C*  = 6, PERFORM THE SR ISSUER.
     C*
     C           PROT      IFEQ '6'
     C                     EXSR ISSUER
     C*
     C*  IF ANY DB ERRORS WHEN CHAINING TO A FILE IN SUBROUTINES, PERFORM
     C*  ERROR AUDIT REPORT ROUTINE.
     C*
     C           *INU7     IFEQ '1'
     C                     GOTO EAUDIT
     C                     END
     C                     END
     C*
     C*  PERFORM SR UPDATE TO UPDATE THE CONFIRMATION REQUIRED AND MESSAGE
     C*  INDICATOR FIELDS ON THE TRADES FILE.
     C*
     C                     EXSR UPDATE
     C*
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C*  READ NEXT TRADES RECORD.
     C*
     C                     READ TRADSDF                  31
      *                                                                   E37680
      ***  If the system is in Multibranched Mode,                        E37680
      *                                                                   E37680
     C           MBIN      IFEQ 'Y'                                       E37680
     C*                                                                   E29170
     C** Only process record if branch is requested                       E29170
     C*                                                                   E29170
     C           *IN31     IFEQ '0'                                       E29170
     C           ENT       IFNE 'ALL'                                     E29170
     C           ENT       ANDNETDBA                                      E29170
     C                     SETON                     31                   E29170
     C                     END                                            E29170
     C                     END                                            E29170
      *                                                                   E37680
     C                     END                                            E37680
     C*                                                                   E29170
     C/COPY WNCPYSRC,SE0550C032
     C                     END
     C*                                                                   E29170
     C** If reach end of details and detail printer file not opened       E29170
     C** then print 'NO DETAILS TO REPORT' on audit report                E29170
     C*                                                                   E29170
     C           *IN61     IFEQ '0'                                       E29170
     C           *IN31     ANDEQ'1'                                       E29170
     C                     WRITEHEADAU                                    E29170
     C                     WRITENONE                                      E29170
     C*                                                                   E29170
     C** RCF Processing for Audit File                                    E29170
     C*                                                                   E29170
     C                     EXSR RCFAU                                     E29170
     C                     END                                            E29170
     C*                                                                   E29170
     C************IN61     IFEQ '1'                                 E29170E32580
     C***********          WRITEENDREP                              E29170E32580
     C***********          END                                      E29170E32580
     C***********                                                   E29170E32580
     C                     GOTO END
     C*
     C           EAUDIT    TAG
     C                     EXSR AUDIT
      *
      *================================================================
      *  P R O G R A M   E N D                                        *
      *                                                               *
     C           END       TAG
     C/COPY WNCPYSRC,SE0550C037
     C                     SETON                     LR
      *                                                               *
      *================================================================
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* FIRST - SUBROUTINE TO ACCESS ICD INFORMATION                  *
     C*                                                               *
     C*****************************************************************
     C*
     C           FIRST     BEGSR                           ** FIRST **
     C*
     C* ACCESS ICDS AND PERFORM STANDARD DB ERRORS IF NOT THERE
     C*
     C                     EXSR ZSYSTM
     C           *IN99     IFEQ '1'
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE           ***************
     C                     MOVELZTABKY    DBKEY            * DB ERROR 01 *
     C                     Z-ADD1         DBASE            ***************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     ELSE
      *
     C                     EXSR ZICD2
     C           *INU7     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE           ***************
     C                     MOVELZTABKY    DBKEY            * DB ERROR 02 *
     C                     Z-ADD2         DBASE            ***************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     ELSE
      *
     C                     EXSR ZICDSE
     C           *INU7     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE           ***************
     C                     MOVELZTABKY    DBKEY            * DB ERROR 03 *
     C                     Z-ADD3         DBASE            ***************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     ELSE
      *
     C                     MOVEL'01'      ZTABKY
     C                     MOVE '40'      ZTABKY
     C           ZTABKY    CHAINTABTB40F             41
     C           *IN41     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE           ***************
     C                     MOVELZTABKY    DBKEY            * DB ERROR 04 *
     C                     Z-ADD4         DBASE            ***************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     ELSE
      *
     C                     READ TABTB20F                 41
     C           *IN41     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE           ***************
     C                     MOVEL'01'      KEY20  12        * DB ERROR 05 *
     C                     MOVE '20'      KEY20            ***************
     C                     MOVELKEY20     DBKEY
     C                     Z-ADD5         DBASE
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     ELSE
     C*
     C***IF*EVERYTHING*OK*AT*PRESENT*EXECUTE*SR*ZEVCD*TO*GET*INFO*THAT**  E19896
     C***IS*REQUIRED*LATER*IN*THE*PROGRAM*BY*SR*ZNCD.***************      E19896
     C**************                                                      E19896
     C**************       EXSR ZEVCD                                     E19896
     C*                                                                   E19896
     C*  EVENT CONTROL DATE SHOULD BE OBTAINED FROM THE VALUE DATE OF THE E19896
     C*  TRADE AND NOT THE CURRENT DATE.                                  E19896
     C*                                                                   E19896
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C*                                                                   E29170
     C** Test whether multibranching is on                                E29170
     C*                                                                   E29170
     C           MBIN      IFEQ 'Y'                                       E29170
     C                     SETON                     37                   E29170
     C                     END                                            E29170
     C/COPY WNCPYSRC,SE0550C001
     C*
     C**  Access SDMMODPD for Portfolio Management Indicator.             092968
     C*                                                                   092968
     C                     CALL 'AOMMODR0'                                092968
     C                     PARM '*MSG    'PRTCD   7                       092968
     C                     PARM '*FIRST  'POPTN   7                       092968
     C           SDMMOD    PARM SDMMOD    DSFDY                           092968
     C*                                                                   092968
     C           PRTCD     IFNE *BLANK                                    092968
     C           BGTYLC    OREQ 'D'                                       092968
     C                     MOVE '54'      DBASE             ************  092968
     C                     MOVE 'SDMMODPD'DBFILE            * DATABASE *  092968
     C                     MOVEL*BLANKS   DBKEY             * ERROR 54 *  092968
     C                     SETON                     U7U8   ************  092968
      *                                                                   CSE006
      ** File is not under user control. Error caused as file would       CSE006
      ** be opened twice.                                                 CSE006
     C***********          OPEN SE0550AU                            092968CSE006
     C                     WRITEHEADAU                                    092968
     C                     WRITEERROR                                     092968
     C***********          CLOSESE0550AU                            092968CSE006
     C                     END                                            092968
     C*                                                                   092968
     C**  Access SDPORTPD for Portfolio Reference.                        092968
     C*                                                                   092968
     C           BGPFMG    IFEQ 'Y'                                       092968
     C*                                                                   092968
     C                     CALL 'AOPORTR0'                                092968
     C                     PARM '*MSG    'PRTCD                           092968
     C                     PARM '*FIRST  'POPTN                           092968
     C           SDPORT    PARM SDPORT    DSFDY                           092968
     C*                                                                   092968
     C           PRTCD     IFNE *BLANK                                    092968
     C                     MOVE '55'      DBASE             ************  092968
     C                     MOVE 'SDPORTPD'DBFILE            * DATABASE *  092968
     C                     MOVEL*BLANKS   DBKEY             * ERROR 55 *  092968
     C                     SETON                     U7U8   ************  092968
      *                                                                   CSE006
      ** File is not under user control. Error caused as file would       CSE006
      ** be opened twice.                                                 CSE006
     C***********          OPEN SE0550AU                            092968CSE006
     C                     WRITEHEADAU                                    092968
     C                     WRITEERROR                                     092968
     C***********          CLOSESE0550AU                            092968CSE006
     C                     END                                            092968
     C                     END                                            092968
     C/COPY WNCPYSRC,SE0550C022
     C*                                                                   092968
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  PRINT  -  GETS ALL INFORMATION FOR CONFIRMATIONS FOR EITHER  *
     C*            A SALE OR PURCHASE. TRADE CONFIRMATION PRINTED AT  *
     C*            END                                                *
     C*                                                               *
     C*****************************************************************
     C*
     C           PRINT     BEGSR                           ** PRINT **
     C*
     C*  CHECK THAT THE NEW BRANCH NUMBER OF THE TRADE IS = CURRENT BRANCH
     C*
     C***********TDBR      IFNE CHKBR                                     S01117
     C           TDBA      IFNE CHKBR                                     S01117
     C*
     C*  IF FIRST TIME IND. (*IN61) IS ON, CLOSE THE EXISTING SE0550P1
     C*  FILE. IF NOT ON SET IT ON
     C*
     C           *IN61     IFEQ '1'
     C***********          WRITEENDREP                              E29170E32580
     C                     CLOSESE0550P1
     C/COPY WNCPYSRC,SE0550C038
     C                     ELSE
     C                     SETON                     61
     C           *IN37     IFEQ '1'                                       E29170
     C           BRNC      COMP 'Y'                      11
     C                     ELSE                                           E29170
     C                     SETOF                     11                   E29170
     C                     END                                            E29170
     C                     END
     C*
     C*  OPEN NEW SE0550P1 FILE FOR EACH NEW BRANCH AND MOVE THE BRANCH
     C*  CODE TO THE TEMP FIELD FOR CHECKING WITH NEXT  TRADE.
     C*
     C                     OPEN SE0550P1
     C/COPY WNCPYSRC,SE0550C039
     C***********          MOVE TDBR      CHKBR   30                      S01117
     C                     MOVE TDBA      CHKBR   3                       S01117
     C                     Z-ADD0         PAGE                            E29170
     C*                                                                   E29170
     C** RCF Processing for Detail Printer File                           E29170
     C*                                                                   E29170
     C                     EXSR RCFP1                                     E29170
     C*
     C*  GET BRANCH NAME FROM THE FILE TABLETR IF NOT FOUND STD DB ERROR
     C*
     C           *IN11     IFEQ '1'
     C***********          MOVE TDBR      KEYF   12                       S01117
     C                     MOVE *BLANKS   KEYF   12                       S01117
     C                     MOVE TDBA      KEYF                            S01117
     C                     MOVEL'10'      KEYF
     C                     EXSR TR
     C           *INU7     IFEQ '1'                        ***************
     C                     Z-ADD6         DBASE            * DB ERROR 06 *
     C                     OUT  LDA                        ***************S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO EENDSR                     ***************
     C                     END
     C                     END
     C                     END
     C*
     C*  TEST THAT BIT 0 OF MESSAGE INDICATOR IS ON. IF IT IS PRINT EITHER
     C*  "AMENDMENT" OR "CANCELLATION" DEPENDING UPON THE CONTENTS OF THE
     C*  FIELD CHGTYP
     C*
     C                     MOVE *BLANKS   LIN11
     C                     TESTB'0'       TMSI           21
     C           *IN21     IFEQ '1'
     C           CHGTYP    IFEQ 'A'
     C           CHGTYP    OREQ 'C'
     C                     MOVEAARRA,1    LIN11  15
     C                     ELSE
     C           CHGTYP    IFEQ 'D'
     C                     MOVEAARRA,2    LIN11
     C                     END
     C                     END
     C*                                                                   E34947
     C*  If last change type is authorisation, access authorisation audit E34947
     C*  file to find whether trade has been amended or cancelled         E34947
     C*                                                                   E34947
     C           CHGTYP    IFEQ 'Y'                                       E34947
     C           TDRF      SETGTTRAUTDF                                   E34947
     C                     READPTRAUTDF                  38               E34947
     C                     READPTRAUTDF                  38               E34947
     C           TATYP     IFEQ 'AM'                                      E34947
     C           TATYP     OREQ 'CH'                                      E34947
     C                     MOVEAARRA,1    LIN11  15                       E34947
     C                     ELSE                                           E34947
     C           TATYP     IFEQ 'DL'                                      E34947
     C           TRECI     ANDEQ'C'                                       E34947
     C           TATYP     OREQ 'DL'                                      E34947
     C           TRECI     ANDEQ'*'                                       E34947
     C                     MOVEAARRA,2    LIN11                           E34947
     C                     END                                            E34947
     C                     END                                            E34947
     C                     END                                            E34947
     C                     END
     C*                                                                   E14238
     C*  CONVERT TRADE DATE FOR OUTPUT                                    E14238
     C*                                                                   E14238
     C                     MOVE TDDT      ZDAYNO                          E14238
     C                     EXSR ZDATE2                                    E14238
     C                     MOVE ZADATE    ODATE6  7                       E14238
     C*
     C*  OBTAIN VALUE DATE IN THE FORMAT DDMMMYY
     C*
     C                     MOVE TDVD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    ODATE1  7
     C/COPY WNCPYSRC,SE0550C041
     C*
     C*  IF THE TRADE IS INCOMPLETE OUTPUT AN INCOMPLETE MESSAGE ON THE
     C*  TRADE CONFIRMATION.
     C*
     C           TINC      IFEQ 'I'
     C                     MOVEAARRA,21   LIN15
     C                     ELSE
     C                     MOVE *BLANKS   LIN15
     C                     END
     C*
     C*  CHECK THE MARKET INDICATOR AND DETERMINE WHICH MESSAGE IS TO BE
     C*  PRINTED ON THE OUTPUT.
     C*
     C           TDMI      IFEQ 'G'
     C                     MOVEAARRA,3    LIN16A 35
     C                     ELSE
     C           TDMI      IFEQ 'P'
     C                     MOVEAARRA,4    LIN16A
     C                     ELSE
     C*
     C*  IF THE MARKET INDICATOR IS = 'S' CHECK THE PAY CODE FIELD AND
     C*  OUTPUT THE CORRECT MESSAGE FOR EACH CODE.
     C*
     C           PCOD      COMP '1'                  828384
     C   83                MOVEAARRA,5    LIN16A
     C   84                MOVEAARRA,6    LIN16A
     C   82                MOVEAARRA,7    LIN16A
     C           PCOD      COMP '3'                  85  86
     C   86                MOVEAARRA,8    LIN16A
     C   85                MOVEAARRA,9    LIN16A
     C           PCOD      COMP '5'                      87
     C   87                MOVEAARRA,37   LIN16A
     C                     END
     C                     END
     C*
     C* DETERMINE THE LITERAL TO BE PRINTED ON LINE 16 OF THE REPORT, BY
     C* CHECKING THE CAPACITY INDICATOR AND/OR THE TRADE TYPE
     C*
     C                     SETOF                     747576
     C                     SETOF                     777879
     C                     SETOF                     8081
     C           TCAP      IFEQ 1
     C                     SETON                     74
     C                     MOVELLIN16A    LIN16C 35
     C*
     C                     ELSE
     C           TCAP      IFEQ 2
     C                     SETON                     75
     C                     MOVELLIN16A    LIN16D 35
     C*
     C                     ELSE
     C           TCAP      IFEQ 3
     C                     SETON                     76
     C                     MOVELLIN16A    LIN16E 35
     C*
     C                     ELSE
     C           TCAP      IFEQ 4
     C                     SETON                     77
     C                     MOVELLIN16A    LIN16F 35
     C*
     C                     ELSE
     C           TCAP      IFEQ 5
     C                     SETON                     78
     C                     MOVELLIN16A    LIN16G 35
     C*
     C                     ELSE
     C           TCAP      IFEQ 6
     C                     SETON                     79
     C                     MOVELLIN16A    LIN16H 35
     C*
     C                     ELSE
     C           TDTP      IFEQ 'TS'
     C                     SETON                     80
     C                     MOVELLIN16A    LIN16B 35
     C*
     C                     ELSE
     C           TDTP      IFEQ 'TP'
     C                     SETON                     81
     C*
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C*
     C                     MOVE TNMC      NMC     3
     C*
     C*  FOLLOWING BLOCK OF CODE MOVED TO AFTER SECTY CHAIN TO ALLOW      E20086
     C*  MULTIPLICATION OF NOMINAL BY FACTOR IF PROT = '8'.               E20086
     C*                                                                   E20086
     C***EDIT*THE*NOMINAL*FIELD*ON*THE*TRADES*FILE*USING*THE*SR*ZSEDIT &  E20086
     C***THE*NOMINAL*DEC.*PLACES*ON*THE*TRADES.                           E20086
     C***MOVE*THE*OUTPUT*FIELD*TO*A*SMALLER*FIELD*TO*DROP*THE*SIGN.       E20086
     C**********                                                          E20086
     C**********           Z-ADDNOML      ZFLD15                          E20086
     C**********           MOVE 'J'       ZECODE                          E20086
     C**********           Z-ADDTNMD      ZDECS                           E20086
     C**********           EXSR ZSEDIT                                    E20086
     C**********           MOVE ZOUT21    TEMP   17                       E20086
     C**********           MOVE *BLANKS   ARRB                            E20086
     C**********           MOVEATEMP      ARRB                            E20086
     C**********                                                          E20086
     C**EXECUTE*THE*SR*STAR*SO*THAT*"*"*FILL*ALL*UNUSED*PARTS*OF*A*NUMERICE20086
     C**FIELD***                                                          E20086
     C**********                                                          E20086
     C**********           EXSR STAR                                      E20086
     C**********           MOVEAARRB      ONOM1  16                       E20086
     C*
     C**  ..  PORTFOLIO REFERENCE                                         092968
     C*                                                                   092968
     C           BGPFMG    IFEQ 'Y'                                       092968
     C           PTFR      ANDNE*BLANKS                                   092968
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           PTFR      ANDNE*BLANKS                                   CPB001
     C*                                                                   092968
     C**  ..  SET UP PORTFOLIO REFERENCE FOR REPORT                       092968
     C*                                                                   092968
     C                     SETON                     39                   092968
     C           PTFR      IFNE '9997'                                    092968
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C                     MOVE PTFR      RRPTFR  4                       092968
     C                     ELSE                                           092968
     C                     MOVE FCR997    RRPTFR                          092968
     C                     END                                            092968
     C                     ELSE                                           092968
     C                     SETOF                     39                   092968
     C                     END                                            092968
     C*                                                                   092968
     C*  CHAIN TO THE SECURITIES FILE USING SECURITY SHORTNAME ON THE TRADE
     C*  SO THAT THE SECURITY DESCRIPTIONS CAN BE OBTAINED USING THE SR
     C*  ZSDESC.
     C*
     C           TDSS      CHAINSECTYDF              41
     C           *IN41     IFEQ '1'
     C***********RECI      ORNE 'D'                                       E13529
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVE 'TABLE'   DBFILE                          E13529
     C                     MOVE 'SECTY'   DBFILE                          E13529
     C                     MOVELTDSS      DBKEY            ***************
     C                     Z-ADD7         DBASE            * DB ERROR 07 *
     C                     OUT  LDA                        ***************S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO EENDSR                     ***************
     C**********           ELSE                                           E20086
     C                     END                                            E20086
     C*
     C                     MOVE *BLANKS   ZSRPN
     C                     MOVE SFN1      ZSFN1
     C                     MOVE SFN2      ZSFN2
     C                     MOVE RSFD      ZRSFD                           S01117
      *                                                                   066041
      * Save security coupon rate and move in value of trade coupon       066041
      * rate for use in ZSDESC                                            066041
     C                     Z-ADDCPNR      CPNRSV 117                      066041
     C                     Z-ADDTDCR      CPNR                            066041
     C/COPY WNCPYSRC,SE0550C042
     C                     EXSR ZSDESC
      *                                                                   066041
      * Restore value of CPNR                                             066041
     C                     Z-ADDCPNRSV    CPNR                            066041
     C/COPY WNCPYSRC,SE0550C043
     C**********           END                                            E20086
     C*                                                                   E20086
     C*  CHAIN TO THE INVESTMENT TYPES FILE FOR THE PROCESSING TYPE FIELD E20086
     C*  FOR THE CURRENT SECURITY.                                        E20086
     C*                                                                   E20086
     C           KEYFLD    CHAININVTPDF              41                   E20086
     C           *IN41     IFEQ '1'                                       E20086
     C           RECI      ORNE 'D'                                       E20086
     C                     MOVE '1'       *INU7                           E20086
     C                     MOVE '1'       *INU8                           E20086
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVE 'TABLE'   DBFILE                   E20086 S01117
     C                     MOVE 'INVTP'   DBFILE                          S01117
     C                     MOVELNMCY      ERRKEY  6                       E20086
     C                     MOVE SITP      ERRKEY                          E20086
     C                     MOVELERRKEY    DBKEY            ***************E20086
     C                     Z-ADD9         DBASE            * DB ERROR 09 *E20086
     C                     OUT  LDA                        ***************S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO EENDSR                     ***************E20086
     C                     END                                            E20086
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0550CCP2                                           S01408
     C*                                                                   S01408
     C*                                                                   E20086
     C*  EDIT THE NOMINAL FIELD ON THE TRADES FILE USING THE SR ZSEDIT &  E20086
     C*  THE NOMINAL DEC. PLACES ON THE TRADES.                           E20086
     C*  MOVE THE OUTPUT FIELD TO A SMALLER FIELD TO DROP THE SIGN.       E20086
     C*                                                                   E20086
     C                     Z-ADDNOML      ZFLD15                          E20086
     C********** PROT      IFEQ '8'                                       E20086 260909
     C/COPY WNCPYSRC,SE0550C035
     C**********           MULT TCFC      ZFLD15    H                     E20086 260909
     C**********           END                                            E20086 260909
     C                     MOVE 'J'       ZECODE                          E20086
     C                     Z-ADDTNMD      ZDECS                           E20086
     C                     EXSR ZSEDIT                                    E20086
     C                     MOVE ZOUT21    TEMP   17                       E20086
     C                     MOVE *BLANKS   ARRB                            E20086
     C                     MOVEATEMP      ARRB                            E20086
     C*                                                                   E20086
     C* EXECUTE THE SR STAR SO THAT "*" FILL ALL UNUSED PARTS OF A NUMERICE20086
     C* FIELD                                                             E20086
     C*                                                                   E20086
     C                     EXSR STAR                                      E20086
     C                     MOVEAARRB      ONOM1  16                       E20086
     C*
     C*  GET THE PRICE/DISCOUNT/YIELD FIELD IN EDITED FORM USING ZSEDIT
     C*  PUT OUTPUT FIELD INTO SMALLER FIELD TO DROP SIGN THEN USE SR STAR
     C*  TO ASTERISK FILL THE FIELD.
     C*
     C                     Z-ADD*ZEROS    ZFLD15
     C                     MOVE TPDY      ZFLD15
     C                     MOVE 'L'       ZECODE
     C                     Z-ADD8         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    TEMP
     C                     MOVE *BLANKS   ARRB
     C                     MOVEATEMP      ARRB
     C                     EXSR STAR
     C                     MOVEAARRB      ONOM2  16
     C*
     C*  USE THE NOMINAL CURRENCY FIELD TO GET THE CORRECT NOMINAL CURRENCY
     C*  DECIMAL PLACES FOR THE CURRENCY. IF ERROR ON THE CHAIN TO TABTG10,
     C*  PERFORM STANDARD DB ERROR.
     C*
     C                     MOVE *BLANKS   KEYF   12
     C                     MOVEL'20'      KEYF
     C                     MOVE '1'       WK4     4
     C                     MOVELTNMC      WK4
     C                     MOVE WK4       KEYF
     C           KEYF      CHAINTABTG10F             41
     C           *IN41     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE
     C                     MOVELKEYF      DBKEY            ***************
     C                     Z-ADD8         DBASE            * DB ERROR 08 *
     C                     OUT  LDA                        ***************S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO EENDSR                     ***************
     C                     END
     C                     MOVE *BLANKS   KEYF
     C/COPY WNCPYSRC,SE0550C023
     C*
     C***USE*THE*CURRENCY*DECIMAL*PLACES*FOR*THE*CURRENCY*TO*GET*THE*NOMINAL
     C***FIELD*INTO*THE*CORRECT*FORM*USING*THE*POWER8*ARRAY.*AFTER*THAT   E19895
     C***MULTIPLY*THE*NOMINAL*BY*PRICE*TO*OBTAIN*THE*FACE*VALUE.******    E19895
     C**********                                                          E19895
     C********** CDP       SUB  TNMD      DP      30                      E19895
     C********** DP        ADD  5         DP                              E19895
     C********** NOML      MULT POWER8,DP TMPNOM 110H                     E19895
     C********** TMPNOM    MULT PRIC      FACEV  152H                     E16832
     C********** TMPNOM    MULT PRIC      FACEV  152               E16832 E19895
     C*                                                                   E19895
     C*  USE CONSIDERATION FROM TRADE AS FACE VALUE FOR CONFIRMATION      E19895
     C*                                                                   E19895
     C                     Z-ADDTCSR      FACEV  152                      E19895
     C*                                                                   E20086
     C***CHAIN*TO*THE*INVESTMENT*TYPES*FILE*FOR*THE*PROCESSING*TYPE*FIELD E20086
     C***FOR*THE*CURRENT*SECURITY.*IF*IT*IS*=*8*M*LTIPLY*BY*THE*CURRENT   E20086
     C***FACTOR.*PERFORM*DB*ERROR*IF*RECORD*NOT*FOUND.****                E20086
     C**********                                                          E20086
     C********** KEYFLD    CHAININVTPDF              41                   E20086
     C********** *IN41     IFEQ '1'                                       E20086
     C********** RECI      ORNE 'D'                                       E20086
     C**********           MOVE '1'       *INU7                           E20086
     C**********           MOVE '1'       *INU8                           E20086
     C**********           MOVE 'TABLE'   DBFILE                          E20086
     C**********           MOVELNMCY      ERRKEY  6                       E20086
     C**********           MOVE SITP      ERRKEY                          E20086
     C**********           MOVELERRKEY    DBKEY            ***************E20086
     C**********           Z-ADD9         DBASE            * DB ERROR 09 *E20086
     C**********           GOTO EENDSR                     ***************E20086
     C**********           END                                            E20086
     C********** PROT      IFEQ '8'                                       E19895
     C********** FACEV     MULT TCFC      FACEV     H                     E19895
     C**********           END                                            E19895
     C**********                                                          E19895
     C***IF*THE*PRICE*BASIS*FIELD*(ON*THE*SECURITIES*FILE)*=*P*THEN*DIVIDEE19895
     C***THE*RESULT*BY*100.********************************************   E19895
     C**********                                                          E19895
     C********** SPBS      IFEQ 'P'                                       E19895
     C********** FACEV     DIV  100       FACEV     H                     E19895
     C**********           END                                            E19895
     C**********           Z-ADDFACEV     FACVAL 130H                     E16832
     C*                                                                   E20086
     C*  TCSR ON TRADSD NO LONGER FACTORED.  THIS FIELD IS NOW USED       E20086
     C*  TO CALCULATE CONSIDERATION, SO CURRENT FACTOR PROCESSING FOR     E20086
     C*  PROT = '8' HAS BEEN  RE-INSERTED.                                E20086
     C*                                                                   E20086
     C********** PROT      IFEQ '8'                                                    E19895 260909
     C/COPY WNCPYSRC,SE0550C036
     C********** FACEV     MULT TCFC      FACEV     H                                  E19895 260909
     C**********           END                                                         E19895 260909
     C/COPY WNCPYSRC,SE0550C034
     C*
     C*********************Z-ADDFACEV     FACVAL 130               E16832 057453
     C                     Z-ADDFACEV     FACVAL 130H                     057453
     C*
     C*  MOVE THE RESULT OF THE CALCULATION TO ZFLD15 READY TO BE EDITED
     C*  USING SR ZSEDIT. MOVE THE OUTPUT FIELD FROM ZSEDIT TO ARRB
     C*  SO THAT SR STAR CAN BE USED TO ASTERISK FILL FIELD.
     C*
     C                     Z-ADDFACVAL    ZFLD15
     C                     Z-ADDCDP       ZDECS
     C                     MOVE 'J'       ZECODE
     C/COPY WNCPYSRC,SE0550C046
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    TEMP2  18
     C                     MOVE *BLANKS   ARRB
     C                     MOVEATEMP2     ARRB
     C                     EXSR STAR
     C                     MOVEAARRB      FVALUE 17
     C*
     C*  IF THE INITIAL DATE IS GT 0 GET THE NEXT COUPON DATE FOR THE
     C*  SECURITY, USING ZNCD.
     C*
     C           ITLD      IFGT 0
     C           CPNR      ANDGT0                                         E03884
     C                     MOVEAARRA,36   LIN21  12
     C                     EXSR ZNCD
     C                     MOVE NCD       ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    ODATE2
     C                     ELSE
     C                     MOVE *BLANKS   LIN21
     C                     MOVE *BLANKS   ODATE2
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0550CCP1                                           S01408
     C*                                                                   S01408
     C*
     C*  MULTIPLY THE NOMINAL (IN CCY DEC. PL FORM) BY THE REALLOWANCE.
     C*  OUTPUT IF THE RESULT IS NON-ZERO.
     C*
     C* Calculate reallowance amount from rate
     C*
     C                     Z-ADDRALL      WDRAL1 158
     C*
     C*   . if Discount
     C*
     C           STBS      IFEQ 'D'
     C           RALL      ANDNE0
     C                     Z-ADDTDVD      ZSDATE
     C                     Z-ADDMATY      ZEDATE
     C                     EXSR ZDAYS
     C                     Z-ADDZDDAYS    #DDAYS  50
     C                     EXSR ZDYYR
     C           ZINTDD    IFNE 0
     C           RALL      MULT #DDAYS    WPRIC1 158
     C           WPRIC1    DIV  ZINTDD    WDRALL 158H
     C*
     C           WDRALL    IFGE 0
     C           1         SUB  WDRALL    WDRAL1 158
     C                     ELSE
     C                     Z-SUBWDRALL    WDRALL
     C           1         SUB  WDRALL    WDRAL1
     C                     Z-SUBWDRAL1    WDRAL1
     C                     END
     C                     ELSE
     C                     Z-ADD*ZEROS    WDRAL1
     C                     END
     C                     END
     C*
     C                     Z-ADD*ZEROS    ZRALL  150
     C                     Z-ADD*ZEROS    ZRALL0 150
     C                     Z-ADD*ZEROS    ZRALL1 151
     C                     Z-ADD*ZEROS    ZRALL2 152
     C                     Z-ADD*ZEROS    ZRALL3 153
     C                     MOVEA'0000'    *IN,42
     C           42        ADD  CDP       J       20
     C                     MOVEA'1'       *IN,J
     C*
     C*  Calculate consideration/reallowance/charges/commission
     C*
     C   42      NOML      MULT WDRAL1    ZRALL0    H
     C   43      NOML      MULT WDRAL1    ZRALL1    H
     C   44      NOML      MULT WDRAL1    ZRALL2    H
     C   45      NOML      MULT WDRAL1    ZRALL3    H
     C*
     C   42                MOVE ZRALL0    ZRALL
     C   43                MOVE ZRALL1    ZRALL
     C   44                MOVE ZRALL2    ZRALL
     C   45                MOVE ZRALL3    ZRALL
     C*
     C*   Allow for nominal decimal places
     C*
     C           5         SUB  NMDP      DC      10
     C           ZRALL     MULT POWER8,DC ZRALL
     C*
     C           ZRALL     COMP *ZEROS                   21
     C           *IN21     IFEQ '0'
     C           SPBS      IFEQ 'P'
     C           ZRALL     DIV  100       ZRALL     H
     C                     END
     C                     Z-ADDZRALL     ZFLD15
     C                     MOVE 'J'       ZECODE
     C                     Z-ADDCDP       ZDECS
     C/COPY WNCPYSRC,SE0550C047
     C                     EXSR ZSEDIT
     C*
     C*  AFTER BEING EDITED, ASTERISK FILL THE FIELD
     C*
     C                     MOVE *BLANKS   ARRB
     C                     MOVEAZOUT21    ARRB
     C                     EXSR STAR
     C                     MOVEAARRB      REALLW 20
     C                     END
     C*
     C***SUM*THE*BROKER*COMMISSION*AND*CUSTOMER*COMMISSION,*IF*ZERO*THEN**E18982
     C***DO*NOT*PRINT.*ELSE*EDIT*THE*FIELD*AND*ASTERISK*FILL*RESULTING*FIEE18982
     C*                                                                   E18982
     C*  EDIT BROKER COMMISSION FIELD AND ASTERISK FILL RESULTING FIELD   E18982
     C*                                                                   E18982
     C********** TBCA      ADD  TCCA      COMAMT 150                      E18982
     C********** COMAMT    COMP *ZEROS                   22               E18982
     C           TBCA      COMP *ZEROS                   22               E18982
     C           *IN22     IFEQ '0'
     C**********           Z-ADDCOMAMT    ZFLD15                          E18982
     C/COPY WNCPYSRC,SE0550C024
     C                     Z-ADDTBCA      ZFLD15                          E18982
     C/COPY WNCPYSRC,SE0550C002
     C                     Z-ADDCDP       ZDECS
     C/COPY WNCPYSRC,SE0550C003
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE *BLANKS   ARRB
     C                     MOVEAZOUT21    ARRB
     C                     EXSR STAR
     C**********           MOVEAARRB      COMISN 21                       E18982
     C                     MOVEAARRB      COMISB 21                       E18982
     C                     END
     C*
     C*  EDIT CUSTOMER COMMISSION FIELD AND ASTERISK FILL RESULTING       E18982
     C*  FIELD                                                            E18982
     C*                                                                   E18982
     C           TCCA      COMP *ZEROS                   23               E18982
     C           *IN23     IFEQ '0'                                       E18982
     C/COPY WNCPYSRC,SE0550C025
     C                     Z-ADDTCCA      ZFLD15                          E18982
     C/COPY WNCPYSRC,SE0550C004
     C                     Z-ADDCDP       ZDECS                           E18982
     C/COPY WNCPYSRC,SE0550C005
     C                     MOVE 'J'       ZECODE                          E18982
     C                     EXSR ZSEDIT                                    E18982
     C                     MOVE *BLANKS   ARRB                            E18982
     C                     MOVEAZOUT21    ARRB                            E18982
     C                     EXSR STAR                                      E18982
     C                     MOVEAARRB      COMISC 21                       E18982
     C                     END                                            E18982
     C*                                                                   E18982
     C***SUM*CHARGE*AMOUNTS*1-3,*LOCAL*TAX*AMOUNT*AND*OTHER*CHARGE*AMOUNTSE18982
     C***IF*THE*RESULT*IS*ZERO,*DO*NOT*PRINT*ELSE*EDIT*THE*RESULT*AND**** E18982
     C***ASTERISK*FILL*THE*FIELD.                                         E18982
     C**********                                                          E18982
     C********** TCA1      ADD  TCA2      TCATOT 150                      E18982
     C********** TCATOT    ADD  TCA3      TCATOT                          E18982
     C********** TCATOT    ADD  TLTA      TCATOT                   S01176 E18982
     C********** TCATOT    ADD  TOCA      TCATOT                   S01176 E18982
     C*                                                                   E18982
     C***INCLUDE*LOCAL*TRANSFER*DUTY*AMOUNT,*PMT*CHARGE*AMOUNT*AND*S01169 S01176
     C***VAT*AMOUNT*IN*THE*CHARGES*TOTAL*****                      S01169 S01176
     C*
     C********** TCATOT    ADD  LTCA      TCATOT                   S01169 S01176
     C********** TCATOT    ADD  TPCA      TCATOT                   S01169 S01176
     C********** TCATOT    ADD  TVCA      TCATOT                   S01169 S01176
     C**********           ADD  TCA4      TCATOT                   S01176 E18982
     C**********           ADD  TCA5      TCATOT                   S01176 E18982
     C**********           ADD  TCA6      TCATOT                   S01176 E18982
     C**********           ADD  TCA7      TCATOT                   S01176 E18982
     C**********           ADD  TAXA      TCATOT                   S01176 E18982
     C********** TCATOT    COMP *ZEROS                   23               E18982
     C********** *IN23     IFEQ '0'                                       E18982
     C**********           Z-ADDTCATOT    ZFLD15                          E18982
     C**********           Z-ADDCDP       ZDECS                           E18982
     C**********           MOVE 'J'       ZECODE                          E18982
     C**********           EXSR ZSEDIT                                    E18982
     C**********           MOVE *BLANKS   ARRB                            E18982
     C**********           MOVEAZOUT21    ARRB                            E18982
     C**********           EXSR STAR                                      E18982
     C**********           MOVEAARRB      CHARGE 21                       E18982
     C**********           END                                            E18982
     C*                                                                   E18982
     C*  EDIT CHARGES1 FIELD AND ASTERISK FILL RESULTING FIELD            E18982
     C*                                                                   E18982
     C           TCA1      COMP *ZEROS                   12               E18982
     C           *IN12     IFEQ '0'                                       E18982
     C/COPY WNCPYSRC,SE0550C026
     C                     Z-ADDTCA1      ZFLD15                          E18982
     C/COPY WNCPYSRC,SE0550C006
     C                     Z-ADDCDP       ZDECS                           E18982
     C/COPY WNCPYSRC,SE0550C007
     C                     MOVE 'J'       ZECODE                          E18982
     C                     EXSR ZSEDIT                                    E18982
     C                     MOVE *BLANKS   ARRB                            E18982
     C                     MOVEAZOUT21    ARRB                            E18982
     C                     EXSR STAR                                      E18982
     C                     MOVEAARRB      TCAO1  21                       E18982
     C                     MOVE NMCY      @CCY    3                       E18982
     C                     MOVE TCC1      @CAM    2                       E18982
     C           @CCOD     CHAINSECGT                44                   E18982
     C  N44                MOVE CHNR      CHARG1 20                       E18982
     C                     END                                            E18982
     C*                                                                   E18982
     C*  EDIT CHARGES2 FIELD AND ASTERISK FILL RESULTING FIELD            E18982
     C*                                                                   E18982
     C           TCA2      COMP *ZEROS                   13               E18982
     C           *IN13     IFEQ '0'                                       E18982
     C/COPY WNCPYSRC,SE0550C027
     C                     Z-ADDTCA2      ZFLD15                          E18982
     C/COPY WNCPYSRC,SE0550C008
     C                     Z-ADDCDP       ZDECS                           E18982
     C/COPY WNCPYSRC,SE0550C009
     C                     MOVE 'J'       ZECODE                          E18982
     C                     EXSR ZSEDIT                                    E18982
     C                     MOVE *BLANKS   ARRB                            E18982
     C                     MOVEAZOUT21    ARRB                            E18982
     C                     EXSR STAR                                      E18982
     C                     MOVEAARRB      TCAO2  21                       E18982
     C                     MOVE NMCY      @CCY    3                       E18982
     C                     MOVE TCC2      @CAM    2                       E18982
     C           @CCOD     CHAINSECGT                44                   E18982
     C  N44                MOVE CHNR      CHARG2 20                       E18982
     C                     END                                            E18982
     C*                                                                   E18982
     C*  EDIT CHARGES3 FIELD AND ASTERISK FILL RESULTING FIELD            E18982
     C*                                                                   E18982
     C           TCA3      COMP *ZEROS                   14               E18982
     C           *IN14     IFEQ '0'                                       E18982
     C/COPY WNCPYSRC,SE0550C028
     C                     Z-ADDTCA3      ZFLD15                          E18982
     C/COPY WNCPYSRC,SE0550C010
     C                     Z-ADDCDP       ZDECS                           E18982
     C/COPY WNCPYSRC,SE0550C011
     C                     MOVE 'J'       ZECODE                          E18982
     C                     EXSR ZSEDIT                                    E18982
     C                     MOVE *BLANKS   ARRB                            E18982
     C                     MOVEAZOUT21    ARRB                            E18982
     C                     EXSR STAR                                      E18982
     C                     MOVEAARRB      TCAO3  21                       E18982
     C                     MOVE NMCY      @CCY    3                       E18982
     C                     MOVE TCC3      @CAM    2                       E18982
     C           @CCOD     CHAINSECGT                44                   E18982
     C  N44                MOVE CHNR      CHARG3 20                       E18982
     C                     END                                            E18982
     C*                                                                   E18982
     C*  EDIT CHARGES4 FIELD AND ASTERISK FILL RESULTING FIELD            E18982
     C*                                                                   E18982
     C           TCA4      COMP *ZEROS                   15               E18982
     C           *IN15     IFEQ '0'                                       E18982
     C                     Z-ADDTCA4      ZFLD15                          E18982
     C/COPY WNCPYSRC,SE0550C012
     C                     Z-ADDCDP       ZDECS                           E18982
     C/COPY WNCPYSRC,SE0550C013
     C                     MOVE 'J'       ZECODE                          E18982
     C/COPY WNCPYSRC,SE0550C048
     C                     EXSR ZSEDIT                                    E18982
     C                     MOVE *BLANKS   ARRB                            E18982
     C                     MOVEAZOUT21    ARRB                            E18982
     C                     EXSR STAR                                      E18982
     C                     MOVEAARRB      TCAO4  21                       E18982
     C                     MOVE NMCY      @CCY    3                       E18982
     C                     MOVE TCC4      @CAM    2                       E18982
     C           @CCOD     CHAINSECGT                44                   E18982
     C  N44                MOVE CHNR      CHARG4 20                       E18982
     C                     END                                            E18982
     C*                                                                   E18982
     C*  EDIT CHARGES5 FIELD AND ASTERISK FILL RESULTING FIELD            E18982
     C*                                                                   E18982
     C           TCA5      COMP *ZEROS                   16               E18982
     C           *IN16     IFEQ '0'                                       E18982
     C                     Z-ADDTCA5      ZFLD15                          E18982
     C/COPY WNCPYSRC,SE0550C014
     C                     Z-ADDCDP       ZDECS                           E18982
     C/COPY WNCPYSRC,SE0550C015
     C                     MOVE 'J'       ZECODE                          E18982
     C/COPY WNCPYSRC,SE0550C049
     C                     EXSR ZSEDIT                                    E18982
     C                     MOVE *BLANKS   ARRB                            E18982
     C                     MOVEAZOUT21    ARRB                            E18982
     C                     EXSR STAR                                      E18982
     C                     MOVEAARRB      TCAO5  21                       E18982
     C                     MOVE NMCY      @CCY    3                       E18982
     C                     MOVE TCC5      @CAM    2                       E18982
     C           @CCOD     CHAINSECGT                44                   E18982
     C  N44                MOVE CHNR      CHARG5 20                       E18982
     C                     END                                            E18982
     C*                                                                   E18982
     C*  EDIT CHARGES6 FIELD AND ASTERISK FILL RESULTING FIELD            E18982
     C*                                                                   E18982
     C           TCA6      COMP *ZEROS                   17               E18982
     C           *IN17     IFEQ '0'                                       E18982
     C                     Z-ADDTCA6      ZFLD15                          E18982
     C/COPY WNCPYSRC,SE0550C016
     C                     Z-ADDCDP       ZDECS                           E18982
     C/COPY WNCPYSRC,SE0550C017
     C                     MOVE 'J'       ZECODE                          E18982
     C/COPY WNCPYSRC,SE0550C050
     C                     EXSR ZSEDIT                                    E18982
     C                     MOVE *BLANKS   ARRB                            E18982
     C                     MOVEAZOUT21    ARRB                            E18982
     C                     EXSR STAR                                      E18982
     C                     MOVEAARRB      TCAO6  21                       E18982
     C                     MOVE NMCY      @CCY    3                       E18982
     C                     MOVE TCC6      @CAM    2                       E18982
     C           @CCOD     CHAINSECGT                44                   E18982
     C  N44                MOVE CHNR      CHARG6 20                       E18982
     C                     END                                            E18982
     C*                                                                   E18982
     C*  EDIT CHARGES7 FIELD AND ASTERISK FILL RESULTING FIELD            E18982
     C*                                                                   E18982
     C           TCA7      COMP *ZEROS                   18               E18982
     C           *IN18     IFEQ '0'                                       E18982
     C                     Z-ADDTCA7      ZFLD15                          E18982
     C/COPY WNCPYSRC,SE0550C018
     C                     Z-ADDCDP       ZDECS                           E18982
     C/COPY WNCPYSRC,SE0550C019
     C                     MOVE 'J'       ZECODE                          E18982
     C/COPY WNCPYSRC,SE0550C051
     C                     EXSR ZSEDIT                                    E18982
     C                     MOVE *BLANKS   ARRB                            E18982
     C                     MOVEAZOUT21    ARRB                            E18982
     C                     EXSR STAR                                      E18982
     C                     MOVEAARRB      TCAO7  21                       E18982
     C                     MOVE NMCY      @CCY    3                       E18982
     C                     MOVE TCC7      @CAM    2                       E18982
     C           @CCOD     CHAINSECGT                44                   E18982
     C  N44                MOVE CHNR      CHARG7 20                       E18982
     C                     END                                            E18982
     C*                                                                   E18982
     C*  EDIT TAX FIELD AND ASTERISK FILL RESULTING FIELD                 E18982
     C*                                                                   E18982
     C           TAXA      COMP *ZEROS                   19               E18982
     C           *IN19     IFEQ '0'                                       E18982
     C                     Z-ADDTAXA      ZFLD15                          E18982
     C                     Z-ADDCDP       ZDECS                           E18982
     C                     MOVE 'J'       ZECODE                          E18982
     C/COPY WNCPYSRC,SE0550C052
     C                     EXSR ZSEDIT                                    E18982
     C                     MOVE *BLANKS   ARRB                            E18982
     C                     MOVEAZOUT21    ARRB                            E18982
     C                     EXSR STAR                                      E18982
     C                     MOVEAARRB      TAX    21                       E18982
     C/COPY WNCPYSRC,SE0550C021
     C                     END                                            E18982
     C*
     C***OUTPUT*THE*NUMBER*OF*DAYS*OF*ACCRUED*INTEREST,*AND*WHAT*TYPE*OF  E19916
     C***INTEREST*IT*IS.*IF*THE*ACCRUED*INTEREST*IS*=*ZERO,*THEN*DO*NOT   E19916
     C***PRINT*ELSE*PRINT*THE*LINE*WITH*THE*INTEREST*IN*EDITED*FORM*&*ALSOE19916
     C***THE*FIELD*ASTERISK*FILLED.*********                              E19916
     C*                                                                   E19916
     C*  OUTPUT THE NUMBER OF DAYS OF ACCRUED INTEREST, AND  TYPE OF      E19916
     C*  INTEREST.                                                        E19916
     C*
     C                     MOVE '1'       *IN25                           E03884
     C           ITRA      COMP *ZEROS                   24
     C***24***** TINA      COMP *ZEROS                   24               E19916
     C  N24      PROT      COMP '6'                      24
     C           *IN24     IFEQ '0'
     C                     SETON                         20
     C*
     C           ACIN      IFEQ 'C'
     C           ACIN      OREQ 'X'
     C                     EXSR DAYSAC
     C           ZDDAYS    IFGT 0
     C                     SETOF                         20
     C                     END
     C*
     C                     END
     C*
     C           ACIN      IFEQ 'C'
     C                     MOVE '(CUM )'  ACINT   6
     C                     END
     C           ACIN      IFEQ 'X'
     C                     MOVE '(EX  )'  ACINT
     C                     END
     C           ACIN      IFEQ 'F'
     C                     MOVE '(FLAT)'  ACINT
     C                     END
     C*
     C*  IF INTEREST ADJUSTMENT FIELD IS ZERO, AND NO DAYS ADJUSTMENT,    E19916
     C*  USE INTEREST AMOUNT AS ACCRUED INTEREST, DO NOT PRINT INTEREST   E19916
     C*  ADJUSTMENT LINE.                                                 E19916
     C*                                                                   E19916
     C                     MOVE ITRA      ZFLD15                          E19916
     C                     MOVE '1'       *IN25                           E19916
     C*                                                                   E19916
     C*  IF INTEREST ADJUSTMENT AND DAYS ADJUSTMENT (DIFF), ADD DAYS      E19916
     C*  ADJUST. TO DAYS INTEREST.  INTEREST AMOUNT IS ACCRUED INTEREST   E19916
     C*                                                                   E19916
     C           TINA      IFNE 0                                         E19916
     C           DADJ      IFNE 0                                         E19916
     C           ADIN      IFEQ 'D'                                       E19916
     C           ZDDAYS    ADD  DADJ      ZDDAYS                          E19916
     C                     END                                            E19916
     C*                                                                   E19916
     C*  DAYS ADJUSTMENT (ACTUAL) IS ACTUAL DAYS INTEREST                 E19916
     C*                                                                   E19916
     C           ADIN      IFEQ 'A'                                       E19916
     C                     MOVE DADJ      ZDDAYS                          E19916
     C                     END                                            E19916
     C*                                                                   E19916
     C*  IF INTEREST ADJUSTMENT, BUT NO DAYS ADJUSTMENT, PRINT INTEREST   E19916
     C*  ADJ. ON ADJUSTMENT LINE, INTEREST AMOUNT +/- ADJUSTMENT          E19916
     C*                                                                   E19916
     C                     ELSE                                           E19916
     C                     MOVE '0'       *IN25                           E19916
     C********** ITRA      SUB  TINA      ZFLD15                          E19916
     C                     Z-ADDTINA      ZFLD15                          E19916
     C                     Z-ADDCDP       ZDECS
     C                     MOVE 'J'       ZECODE
     C/COPY WNCPYSRC,SE0550C053
     C                     EXSR ZSEDIT
     C                     MOVE *BLANKS   ARRB
     C                     MOVEAZOUT21    ARRB
     C                     EXSR STAR
     C**********           MOVEAARRB      ACCINT 21                       E19916
     C                     MOVEAARRB      INTADJ 21                       E19916
     C           ITRA      SUB  TINA      ZFLD15                          E19916
     C                     END
     C                     END                                            E19916
     C*
     C***IF*THE*INTEREST*ADJUSTMENT*IS*=*ZERO,*DO*NOT*PRINT*LINE,*ELSE    E19916
     C***OUTPUT*THE*NUMBER*OF*DAYS*ADJUSTED*AND*THE*INTEREST*ADJUSTMENT   E19916
     C***IN*EDITED*FORM*THROUGH*ZSEDIT*AND*WITH*ASTERISK*FILL.*******     E19916
     C*
     C********** TINA      COMP *ZEROS                   25               E19916
     C********** *IN25     IFEQ '0'                                       E19916
     C********** DADJ      COMP *ZEROS                   26               E19916
     C**********           Z-ADDTINA      ZFLD15                          E19916
     C*                                                                   E19916
     C*  EDIT INTEREST AMOUNT                                             E19916
     C*                                                                   E19916
     C                     Z-ADDCDP       ZDECS
     C                     MOVE 'J'       ZECODE
     C/COPY WNCPYSRC,SE0550C054
     C                     EXSR ZSEDIT
     C                     MOVE *BLANKS   ARRB
     C                     MOVEAZOUT21    ARRB
     C                     EXSR STAR
     C**********           MOVEAARRB      INTADJ 21                       E19916
     C                     MOVEAARRB      ACCINT 21                       E19916
     C                     END
     C*
     C*  OUTPUT ON LINE 27 OF THE CONFIRMATIONS, THE TOTAL CONSIDERATION
     C*  IN EDITED FORM AND WITH ASTERISK FILL
     C*
     C                     Z-ADDTCTR      ZFLD15
     C                     Z-ADDCDP       ZDECS
     C                     MOVE 'J'       ZECODE
     C/COPY WNCPYSRC,SE0550C055
     C                     EXSR ZSEDIT
     C                     MOVE *BLANKS   ARRB
     C                     MOVEAZOUT21    ARRB
     C                     EXSR STAR
     C                     MOVEAARRB      LIN27  21
      *                                                                   187888
      ** Withholding Tax                                                  187888
      *                                                                   187888
     C                     EXSR SRWTAX                                    187888
      *                                                                                       CGL031
      ** EU Withholding Tax                                                                   CGL031
      *                                                                                       CGL031
     C           CGL031    IFEQ 'Y'                                                           CGL031
     C                     EXSR SREWTX                                                        CGL031
     C                     ENDIF                                                              CGL031
      *                                                                   187888
     C*
     C*  IF THE NOMINAL CCY (ON TRADES) IS = SETTLEMENT CCY, DO NO PRINT
     C*  LINE 28. ELSE CONVERT THE COUNTERVALUE TO THE SETTLEMENT CCY AT
     C*  THE EXCHANGE RATE (ON TRADES) VIA THE SR ZCONV. EDIT VIA ZSEDIT AND
     C*  THEN ASTERISK FILL THE FIELD.
     C*
     C           TNMC      COMP SETC                     27
     C           *IN27     IFEQ '0'
     C                     Z-ADDTCTR      ZAMTCI
     C                     Z-ADDTDER      ZEXCH
     C                     MOVE TMDI      ZMD
     C                     MOVE TNMC      ZCCYI
     C                     MOVE CDP       ZCDPI                           S01117
     C                     MOVE SETC      ZCCYO
     C*                                                                   S01117
     C*  Find currency decimal places for settlement currency             S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   KEYF   12                       S01117
     C                     MOVEL'20'      KEYF                            S01117
     C                     MOVE '1'       WK4     4                       S01117
     C                     MOVELSETC      WK4                             S01117
     C                     MOVE WK4       KEYF                            S01117
     C           KEYF      CHAINTABTG10F             41                   S01117
     C           *IN41     IFEQ '1'                                       S01117
     C           RECI      ORNE 'D'                                       S01117
     C                     MOVE '1'       *INU7                           S01117
     C                     MOVE '1'       *INU8                           S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE                          S01117
     C                     MOVELKEYF      DBKEY            ***************S01117
     C                     Z-ADD10        DBASE            * DB ERROR 10 *S01117
     C                     OUT  LDA                        ***************S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO EENDSR                                    S01117
     C                     END                                            S01117
     C                     MOVE CDP       ZCDPO                           S01117
     C*                                                                   S01117
     C                     EXSR ZCONV
     C*
     C***CHECK*FOR*ERROR*FROM*ZCONV*BY*TESTING**INU7,*IF*ON*THEN**********S01117
     C***PERFORM*STANDARD*DB*ERROR****************************************S01117
     C***********                                                         S01117
     C************INU7     IFEQ '1'                                       S01117
     C***********          Z-ADD10        DBASE            ***************S01117
     C***********          MOVELTKEY      DBKEY            * DB ERROR 10 *S01117
     C***********          MOVE 'TABLE'   DBFILE           ***************S01117
     C***********          GOTO EENDSR                                    S01117
     C***********          END                                            S01117
     C*
     C*  EDIT THE OUTPUT FIELD AND ASTERISK FILL
     C*
     C                     Z-ADDZAMTCO    ZFLD15
     C                     Z-ADDCDP       ZDECS
     C                     MOVE 'J'       ZECODE
     C/COPY WNCPYSRC,SE0550C056
     C                     EXSR ZSEDIT
     C                     MOVE *BLANKS   ARRB
     C                     MOVEAZOUT21    ARRB
     C                     EXSR STAR
     C                     MOVEAARRB      LIN28  21
     C*
     C*  EDIT THE EXCHANGE RATE READY FOR PRINTING, IT HAS 8 DP
     C*  ONCE EDITED, ASTERISK FILL THE FIELD.
     C*
     C                     Z-ADD*ZEROS    ZFLD15
     C                     MOVE TDER      ZFLD15
     C                     Z-ADD8         ZDECS
     C                     MOVE 'L'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    TEMP3  15
     C                     MOVE *BLANKS   ARRB
     C                     MOVEATEMP3     ARRB
     C                     EXSR STAR
     C                     MOVEAARRB      LIN28B 14
     C                     END
     C/COPY WNCPYSRC,SE0550C033
     C*
     C*  FOR LINES 29 - 34 ON THE CONFIRMATION, EXECUTE THE SR INSTR
     C*
     C                     EXSR INSTR
     C*
     C*  IF AN ERROR HAS OCCURRED IN SR INSTR, DROP OUT IMMEDIATELY
     C*
     C           *INU7     IFEQ '1'
     C                     GOTO EENDSR
     C                     END
     C*
     C*  IF "FOR A/C OF (PAY)" FIELD NE *BLANKS,PUT OUT MESSAGE TO LIN35A
     C*  TEST THE FIRST 6 CHARS IN TDFA FOR NUMERICS, IF NUMERIC, GET THE
     C*  CUSTOMER NAME AND TOWN FROM THE CLINTCB FILE. ELSE GET THEM FROM
     C*  THE TABLET2 FILE
     C*
     C           TDFA      IFNE *BLANKS
     C                     MOVEAARRA,29   LIN35A 10
     C*
     C*  TEST TDFA ON TRADES FOR NUMERICS. SETON *IN28 IF NUMERIC.
     C*
     C***********          TESTN          TDFACN     28                                       CSD027
     C************IN28     IFEQ '1'                                                           CSD027
     C*
     C*  IF NUMERIC USE THE NUMBER TO CHAIN TO THE CB FILE, AND GET THE
     C*  CUSTOMER NAME AND TOWN
     C*
     C                     MOVE TDFACN    CLINNO
     C                     EXSR CB
     C*
     C**IF*ERROR*GOTO END OF SUBROUTINE AND PERFORM DB ERROR ROUTINE                          CSD027
      * Check if this is a customer                                                           CSD027
     C*
     C************INU7     IFEQ '1'                                                           CSD027
     C***********          Z-ADD11        DBASE            ***************                    CSD027
     C***********          OUT  LDA                                       S01117              CSD027
     C***********          EXSR *PSSR                      ***************S01117              CSD027
     C***********          GOTO EENDSR                     * DB ERROR 11 *                    CSD027
     C***********          END                             ***************                    CSD027
     C***********          MOVELCRNM      LIN36A 35                                           CSD027
     C***********          MOVELCTWN      LIN37A 20                                           CSD027
     C***********          ELSE                                                               CSD027
     C           *IN41     IFEQ *OFF                                                          CSD027
     C                     MOVELCRNM      LIN36A 35                                           CSD027
     C                     MOVELCTWN      LIN37A 20                                           CSD027
     C                     ELSE                                                               CSD027
      * CHAIN fail in CB                                                                      CSD027
     C*
     C*  IF TDFA ALPHA CHARS CHAIN TO TABLET2 FOR CUSTOMER NAME AND TOWN
     C*
     C                     MOVE TDFA      T2KEY  12
     C                     EXSR T2
     C*
     C*  IF ERROR, GOTO END AND PERFORM ERROR ROUTINE
     C*
     C           *INU7     IFEQ '1'
     C                     Z-ADD12        DBASE            ***************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                      ***************S01117
     C                     GOTO EENDSR                     * DB ERROR 12 *
     C                     END                             ***************
     C                     MOVE CPNM      LIN36A
     C                     MOVE CPTN      LIN37A
     C                     END
     C                     ELSE
     C*
     C*  IF TDFA IS = BLANKS THEN MOVE BLANKS TO OUTPUT FIELDS.
     C*
     C                     MOVE *BLANKS   LIN35A
     C                     MOVE *BLANKS   LIN36A
     C                     MOVE *BLANKS   LIN37A
     C                     END
     C*
     C***IF*"FOR*A/C*OF*DELIVER"*FIELD*NE**BLANKS,*PUT*OUT*LINES*35A*36A*37A****
     C*  IF "FOR A/C OF-DELIVER TO" FIELD NE *BLANKS, PUT OUT LINES 35A 36A 37A
     C*  TEST THE FIRST 6 CHARS IN DTFA FOR NUMERICS, IF NUMERIC, GET THE
     C*  CUSTOMER NAME AND TOWN FROM THE CLINTCB FILE. ELSE GET THEM FROM
     C*  THE TABLET2 FILE
     C*
     C           TDTP      IFEQ 'TS'                                      E27083
     C           DTFA      IFNE *BLANKS
     C**********           MOVEAARRA,29   LIN35B 10                       E42254
     C                     MOVEAARRA,29   LIN35B 23                       E42254
     C*
     C***TEST*DTFA ON TRADES FOR NUMERICS. SETON *IN28 IF NUMERIC.                            CSD027
     C*
     C***********          TESTN          DTFACN     28                                       CSD027
     C************IN28     IFEQ '1'                                                           CSD027
     C*
     C***IF*NUMERIC USE THE NUMBER TO CHAIN TO THE CB FILE, AND GET THE                       CSD027
     C***CUSTOMER NAME AND TOWN                                                               CSD027
     C*
     C                     MOVE DTFACN    CLINNO
     C                     EXSR CB
     C*
     C* IF ERROR GOTO END OF SUBROUTINE AND PERFORM DB ERROR ROUTINE
     C*
     C************INU7     IFEQ '1'                                                           CSD027
     C***********          Z-ADD13        DBASE            ***************                    CSD027
     C***********          OUT  LDA                                       S01117              CSD027
     C***********          EXSR *PSSR                      ***************S01117              CSD027
     C***********          GOTO EENDSR                     * DB ERROR 13 *                    CSD027
     C***********          END                             ***************                    CSD027
      ***********                                                                             CSD027
     C                     MOVELCRNM      LIN36B 35
     C                     MOVELCTWN      LIN37B 20
     C***********          ELSE                                                               CSD027
     C           *IN41     IFEQ *OFF                                                          CSD027
     C                     MOVELCRNM      LIN36B 35                                           CSD027
     C                     MOVELCTWN      LIN37B 20                                           CSD027
     C                     ELSE                                                               CSD027
      * CHAIN fail to CLINTCB                                                                 CSD027
     C*
     C*  IF DTFA ALPHA CHARS CHAIN TO TABLET2 FOR CUSTOMER NAME AND TOWN
     C*
     C                     MOVE DTFA      T2KEY  12
     C                     EXSR T2
     C*
     C*  IF ERROR, GOTO END AND PERFORM ERROR ROUTINE
     C*
     C           *INU7     IFEQ '1'
     C                     Z-ADD14        DBASE            ***************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                      ***************S01117
     C                     GOTO EENDSR                     * DB ERROR 14 *
     C                     END                             ***************
     C                     MOVE CPNM      LIN36B
     C                     MOVE CPTN      LIN37B
     C                     END
     C*
     C*  REFERENCE 3, USE COUNTERPARTY NUMBER TO CHAIN TO THE SE FILE
     C*
     C********** TCNR      IFNE *ZEROS                                                        CSD027
     C           TCNR      IFNE *BLANKS                                                       CSD027
     C                     MOVE TCNR      CLINNO
     C                     EXSR SE
     C*
     C*  IF ERROR, PERFORM STD DB ERROR.
     C*
     C           *INU7     IFEQ '1'
     C           *LOCK     IN   LDA                                       E37016
     C                     Z-ADD15        DBASE            ***************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                      ***************S01117
     C                     GOTO EENDSR                     * DB ERROR 15 *
     C                     END                             ***************
     C*
     C                     ELSE
     C**********           Z-ADD*ZEROS    CNUM                                                CSD027
     C                     MOVE *BLANKS   CNUM                                                CSD027
     C                     END
     C*
     C***USE*THE*"FOR*A/C*OF*DELIVERY"*FIELD*ON*TRADES*TO*CHECK*THAT*DEPOTS01175
     C**USE*THE*"FOR*A/C*OF-DELIVERY*TO"*FIELD*ONTTRADESOTOECHECKTTHAT*** S01175              CSE022
     C**DEPOT*REFERENCE*IS*ON*TABTB36.*IF*IT*IS*USE*THE*CORRESPONDING**                       CSE022
     C**DEPOT*REFERENCE*ON*CLINTSE*FOR*OUTPUT.*************************                       CSE022
      *                                                                                       CSE022
      ** Use the "FOR A/C OF-DELIVERY TO" field on trades to check if                         CSE022
      ** Depot Reference is on TABTB36.  If *IN29 is on, Discretionary                        CSE022
      ** Indicator is equal to 'M' and Market Indicator is not equal                          CSE022
      ** to 'G', use the corresponding depot reference on CLINTSE for                         CSE022
      ** output.  However if CSE022 is installed, use the new program                         CSE022
      ** SEDORFRTV for the output.                                                            CSE022
      *                                                                                       CSE022
     C*
     C                     Z-ADD1         B                               E16331
     C           DTFACN    LOKUPARR36,B                  29
      *                                                                                       CSE022
     C           CSE022    IFEQ 'N'                                                           CSE022
      *                                                                                       CSE022
     C           C1DI      IFEQ 'M'
     C           *IN29     ANDEQ'1'
     C           TDMI      ANDNE'G'                                       E32540
     C                     MOVEAARRSE,B   LIN37D  6
     C                     MOVE 'VIA'     LIN37C  3
     C                     END
      *                                                                                       CSE022
     C                     ELSE                                                               CSE022
     C                     MOVEL'SEDOR'   WPGM    9                                           CSE022
     C                     MOVE 'FRTV'    WPGM                                                CSE022
     C                     MOVELDTFACN    PDEPOT                                              CSE022
     C                     MOVELCNUM      PCNUM                                               CSE022
      *                                                                                       CSE022
     C                     CALL WPGM                                                          CSE022
     C                     PARM *BLANKS   PRTRN  10                                           CSE022
     C                     PARM           PDEPOT  6                                           CSE022
     C                     PARM           PCNUM   6                                           CSE022
     C                     PARM *BLANKS   PSKALR 20                                           CSE022
      *                                                                                       CSE022
     C                     MOVELPSKALR    LIN37D                                              CSE022
     C                     MOVE 'VIA'     LIN37C                                              CSE022
     C                     ENDIF                                                              CSE022
     C                     ELSE
     C*
     C*  IF DTFA IS = BLANKS THEN MOVE BLANKS TO OUTPUT FIELDS.
     C*
     C                     MOVE *BLANKS   LIN35B
     C                     MOVE *BLANKS   LIN36B
     C                     MOVE *BLANKS   LIN37B
     C                     MOVE *BLANKS   LIN37D  6
     C                     MOVE *BLANKS   LIN37C  3
     C                     END
     C                     END                                            E27083
     C*
     C* IF "FOR A/C OF-DELIVER FROM" FIELD NE *BLANKS,PUT OUT LINES 35A   S01175
     C* 36A 37A ,TEST THE FIRST 6 CHARS IN DFFA FOR NUMERICS, IF NUMERIC, S01175
     C* GET THE CUSTOMER NAME AND TOWN FROM THE CLINTCB FILE. ELSE        S01175
     C* GET THEM FROM THE TABLET2 FILE                                    S01175
     C*                                                                   S01175
     C           TDTP      IFEQ 'TP'                                      E27083
     C           DFFA      IFNE *BLANKS                                   S01175
     C**********           MOVEAARRA,40   LIN35B 10                S01175 E42254
     C                     MOVEAARRA,40   LIN35B 23                       E42254
     C*                                                                   S01175
     C*  TEST DFFA ON TRADES FOR NUMERICS. SETON *IN28 IF NUMERIC.        S01175
     C*                                                                   S01175
      ***********                                                                             CSD027
     C***********          TESTN          DFFACN     28                   S01175              CSD027
     C************IN28     IFEQ '1'                                       S01175              CSD027
     C*                                                                   S01175
     C*  IF NUMERIC USE THE NUMBER TO CHAIN TO THE CB FILE, AND GET THE   S01175
     C*  CUSTOMER NAME AND TOWN                                           S01175
     C*                                                                   S01175
     C                     MOVE DFFACN    CLINNO                          S01175
     C                     EXSR CB                                        S01175
     C*                                                                   S01175
     C* IF ERROR GOTO END OF SUBROUTINE AND PERFORM DB ERROR ROUTINE      S01175
     C*                                                                   S01175
     C************INU7     IFEQ '1'                                       S01175              CSD027
     C***********          Z-ADD44        DBASE      ***************S01175E20651
     C***********          GOTO EENDSR               ***DB*ERROR*13*S01175E20651
     C***********          END                       ***************S01175E20651
     C***********          Z-ADD48        DBASE            ***************E20651              CSD027
     C***********          OUT  LDA                                       S01117              CSD027
     C***********          EXSR *PSSR                      ***************S01117              CSD027
     C***********          GOTO EENDSR                     * DB ERROR 48 *E20651              CSD027
     C***********          END                             ***************E20651              CSD027
     C***********          MOVELCRNM      LIN36B 35                       S01175              CSD027
     C***********          MOVELCTWN      LIN37B 20                       S01175              CSD027
     C***********          ELSE                                           S01175              CSD027
     C           *IN41     IFEQ *OFF                                                          CSD027
     C                     MOVELCRNM      LIN36B 35                                           CSD027
     C                     MOVELCTWN      LIN37B 20                                           CSD027
     C                     ELSE                                                               CSD027
      * CHAIN fail on CLINTCB                                                                 CSD027
     C*                                                                   S01175
     C*  IF DFFA ALPHA CHARS CHAIN TO TABLET2 FOR CUSTOMER NAME AND TOWN  S01175
     C*                                                                   S01175
     C                     MOVE DFFA      T2KEY  12                       S01175
     C                     EXSR T2                                        S01175
     C*                                                                   S01175
     C*  IF ERROR, GOTO END AND PERFORM ERROR ROUTINE                     S01175
     C*                                                                   S01175
     C           *INU7     IFEQ '1'                                       S01175
     C                     Z-ADD45        DBASE            ***************S01175
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                      ***************S01117
     C                     GOTO EENDSR                     * DB ERROR 45 *S01175
     C                     END                             ***************S01175
     C                     MOVE CPNM      LIN36B                          S01175
     C                     MOVE CPTN      LIN37B                          S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C*  REFERENCE 3, USE COUNTERPARTY NUMBER TO CHAIN TO THE SE FILE     S01175
     C*                                                                   S01175
     C********** TCNR      IFNE *ZEROS                                                 S01175 CSD027
     C           TCNR      IFNE *BLANKS                                                       CSD027
     C                     MOVE TCNR      CLINNO                          S01175
     C                     EXSR SE                                        S01175
     C*                                                                   S01175
     C*  IF ERROR, PERFORM STD DB ERROR.                                  S01175
     C*                                                                   S01175
     C           *INU7     IFEQ '1'                                       S01175
     C***********          Z-ADD46        DBASE      ***************S01175E20651
     C***********          GOTO EENDSR               ***DB*ERROR*15*S01175E20651
     C***********          END                       ***************S01175E20651
     C           *LOCK     IN   LDA                                       E37016
     C                     Z-ADD50        DBASE            ***************E20651
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                      ***************S01117
     C                     GOTO EENDSR                     * DB ERROR 50 *E20651
     C                     END                             ***************E20651
     C*                                                                   S01175
     C                     ELSE                                           S01175
     C**********           Z-ADD*ZEROS    CNUM                                         S01175 CSD027
     C                     MOVE *BLANKS   CNUM                                                CSD027
     C                     END                                            S01175
     C*                                                                   S01175
     C**USE*THE*"FOR*A/C*OF-DELIVER*FROM"*FIELD*ON*TRADES*TO*CHECK*THAT   S01175              CSE022
     C**DEPOT*REFERENCE*IS*ON*TABTB36.*IF*IT*IS*USE*THE*CORRESPONDING**   S01175              CSE022
     C**DEPOT*REFERENCE*ON*CLINTSE*FOR*OUTPUT.*************************   S01175              CSE022
      *                                                                                       CSE022
      ** Use the "FOR A/C OF-DELIVERY FROM" field on trades to check if                       CSE022
      ** Depot Reference is on TABTB36.  If *IN29 on, Discretionary                           CSE022
      ** Indicator is equal to 'M' and Market Indicator is not equal                          CSE022
      ** to 'G', move the corresponding Depot Reference from CLINTSE                          CSE022
      ** to Output Field.  However if CSE022 is installed, use program                        CSE022
      ** SEDORFRTV for the Output Field.                                                      CSE022
      *                                                                                       CSE022
     C*                                                                   S01175
     C                     Z-ADD1         B                               E16331
     C           DFFACN    LOKUPARR36,B                  29               S01175
      *                                                                                       CSE022
     C           CSE022    IFEQ 'N'                                                           CSE022
      *                                                                                       CSE022
     C           C1DI      IFEQ 'M'                                       S01175
     C           *IN29     ANDEQ'1'                                       S01175
     C           TDMI      ANDNE'G'                                       E32540
     C                     MOVEAARRSE,B   LIN37D  6                       S01175
     C                     MOVE 'VIA'     LIN37C  3                       S01175
     C                     END                                            S01175
      *                                                                                       CSE022
     C                     ELSE                                                               CSE022
     C                     MOVEL'SEDOR'   WPGM    9                                           CSE022
     C                     MOVE 'FRTV'    WPGM                                                CSE022
     C                     MOVELDFFACN    PDEPOT                                              CSE022
     C                     MOVELCNUM      PCNUM                                               CSE022
      *                                                                                       CSE022
     C                     CALL WPGM                                                          CSE022
     C                     PARM *BLANKS   PRTRN  10                                           CSE022
     C                     PARM           PDEPOT  6                                           CSE022
     C                     PARM           PCNUM   6                                           CSE022
     C                     PARM *BLANKS   PSKALR 20                                           CSE022
      *                                                                                       CSE022
     C                     MOVELPSKALR    LIN37D                                              CSE022
     C                     MOVE 'VIA'     LIN37C                                              CSE022
     C                     ENDIF                                                              CSE022
     C                     ELSE                                           S01175
     C*                                                                   S01175
     C*  IF DFFA IS = BLANKS THEN MOVE BLANKS TO OUTPUT FIELDS.           S01175
     C*                                                                   S01175
     C                     MOVE *BLANKS   LIN35B                          S01175
     C                     MOVE *BLANKS   LIN36B                          S01175
     C                     MOVE *BLANKS   LIN37B                          S01175
     C                     MOVE *BLANKS   LIN37D  6                       S01175
     C                     MOVE *BLANKS   LIN37C  3                       S01175
     C                     END                                            S01175
     C                     END                                            E27083
     C*                                                                   S01175
     C*  IF THE SPECIAL INSTRUCTIONS FIELD IS NOT BLANK, PRINT THE
     C*  INSRUCTIONS ELSE DO NOT.
     C*
     C           TDSI      IFNE *BLANKS
     C                     MOVEAARRA,30   LIN38A 20
     C                     MOVE TDSI      LIN38B 35
     C                     ELSE
     C                     MOVE *BLANKS   LIN38A
     C                     MOVE *BLANKS   LIN38B
     C                     END
     C*
     C* USE THE COUNTERPARTY NUMBER TO CHAIN TO CLINTCC FILE FOR THE
     C* CUSTOMER NAME AND ADDRESS LINES.
     C*
     C********** TCNR      IFNE *ZEROS                                                        CSD027
     C           TCNR      IFNE *BLANKS                                                       CSD027
     C                     MOVE TCNR      CLINNO
     C                     EXSR SE                                        E43703
     C                     MOVE TCNR      CLINNO                          E43703
     C           C1AN      IFEQ ' '                                       E43703
     C           C1AN      OREQ 'B'                                       E43703
     C**********           EXSR CC                                 E43703 127566
     C                     EXSR CC0                                       127566
     C                     ELSE                                           E43703
     C                     EXSR CC1                                       E43703
     C                     END                                            E43703
     C*
     C*  IF ERROR DO ERROR ROUTINE.
     C*
     C           *INU7     IFEQ '1'
     C                     Z-ADD16        DBASE            ***************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                      ***************S01117
     C                     GOTO EENDSR                     * DB ERROR 16 *
     C                     END                             ***************
     C                     MOVE CNA1      LIN43  35
     C                     MOVE CNA2      LIN44  35
     C                     MOVE CNA3      LIN45  35
     C                     MOVE CNA4      LIN46  35
     C                     ELSE
     C                     MOVE *BLANKS   LIN43
     C                     MOVE *BLANKS   LIN44
     C                     MOVE *BLANKS   LIN45
     C                     MOVE *BLANKS   LIN46
     C**********           Z-ADD*ZEROS    CNUM                                                CSD027
     C                     MOVE *BLANKS   CNUM                                                CSD027
     C                     END
     C*
     C**IF*TRADE*IS*IN*ACCORDANCE*WITH*THE*AIBD*RULES,*PRINT*OUT*A*MESSAGEE43208
      ***  If Trade is in accordance with the ISMA rules, print out       E43208
      ***  a message.                                                     E43208
     C*
     C* - but only if the trade is not a share
     C*
     C***********          MOVE *BLANKS   LIN44B                          S01169
     C***********          MOVE *BLANKS   LIN45B                          S01169
     C***********AIIP      IFEQ 'Y'                                       S01169
     C***********PROT      IFEQ '1'                                       S01169
     C***********PROT      OREQ '3'                                       S01169
     C***********PROT      OREQ '5'                                       S01169
     C*                                                                   S01169
     C           PROT      IFNE '4'                                       S01169
     C********** AIIP      IFEQ 'Y'                                       S01169
     C           AIIP      ANDEQ'Y'                                       S01169
     C           TDMI      IFEQ 'S'
     C                     MOVEAARRA,31   LIN44B 27
     C                     MOVEAARRA,32   LIN45B 19
     C                     ELSE
     C           TDMI      IFEQ 'P'
     C                     MOVEAARRA,38   LIN44B 27
     C                     MOVEAARRA,39   LIN45B 19
     C                     ELSE
     C                     MOVE *BLANKS   LIN44B                          S01169
     C                     MOVE *BLANKS   LIN45B                          S01169
     C                     END
     C                     END
     C*
     C                     ELSE                                           S01169
     C                     MOVE *BLANKS   LIN44B                          S01169
     C                     MOVE *BLANKS   LIN45B                          S01169
     C                     END
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,SE0550CPD1                                           S01408
     C*                                                                   S01408
      *                                                                   S01401
      ***  If S.W.I.F.T. confirmation message generated = 'Y' then        S01401
      ***  Output 'AUTO TRANSMISSION - DO NOT SEND'.                      S01401
      *                                                                   S01401
     C                     MOVE *OFF      *IN01                           S01401
     C           S01401    IFEQ 'Y'                                       S01401
     C           TDRF      CHAINTRADSDY1             03                   S01401
     C           *IN03     IFEQ *OFF                                      S01401
     C           T1GMEC    ANDEQ'Y'                                       S01401
     C                     MOVE *ON       *IN01                           S01401
     C                     ENDIF                                          S01401
     C                     ENDIF                                          S01401
     C*
     C*  WRITE OUT THE DATA TO THE OUTPUT FILE.
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0550CPD2                                           S01408
     C*                                                                   S01408
     C                     WRITETRADCON
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0550CPD3                                           S01408
     C*                                                                   S01408
     C*
     C*  END SUBROUTINE
     C*
     C           EENDSR    TAG
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
      *****************************************************************   187888
      *                                                               *   187888
      *  SRWTAX - Subroutine for printing the Withholding Tax field,  *   187888
      *           based on Nominal Currency                           *   187888
      *                                                               *   187888
      *****************************************************************   187888
      *                                                                   187888
     C           SRWTAX    BEGSR                                          187888
      *                                                                   187888
     C                     MOVE *ON       *IN72                           187888
      *                                                                   187888
     C           CSE023    IFEQ 'Y'                                       187888
     C           WHTX      ANDNE*ZERO                                     187888
     C                     MOVE *OFF      *IN72                           187888
     C                     MOVE TNMC      RWCCY                           187888
     C                     Z-ADDWHTX      ZFLD15                          187888
     C                     Z-ADDCDP       ZDECS                           187888
     C                     MOVE 'J'       ZECODE                          187888
     C                     EXSR ZSEDIT                                    187888
     C                     MOVE *BLANKS   ARRB                            187888
     C                     MOVEAZOUT21    ARRB                            187888
     C                     EXSR STAR                                      187888
     C                     MOVEAARRB      RWHTX                           187888
     C                     ENDIF                                          187888
      *                                                                   187888
     C                     ENDSR                                          187888
      *                                                                   187888
      *****************************************************************   187888
      /EJECT                                                              187888
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  SREWTX - Print EU W/holding Tax field if CGL031 is ON.       *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
      *                                                                                       CGL031
     C           SREWTX    BEGSR                                                              CGL031
      *                                                                                       CGL031
     C                     MOVE 'S'       WMODI                                               CGL031
     C                     MOVE TDRF      WTDRF                                               CGL031
     C                     Z-ADD*ZERO     WWTXSR 150                                          CGL031
      *                                                                                       CGL031
      ** Access SDCSINL6 using the current rundate, mod id = 'S' and                          CGL031
      ** trade number and cumulate TSTXSR to WWTXSR.                                          CGL031
      *                                                                                       CGL031
     C           KCSIN6    SETLLSDCSINL6                                                      CGL031
     C           KCSIN6    READESDCSINL6                 05                                   CGL031
     C           *IN05     DOWEQ*OFF                                                          CGL031
     C                     ADD  TSTXSR    WWTXSR                                              CGL031
     C           KCSIN6    READESDCSINL6                 05                                   CGL031
     C                     ENDDO                                                              CGL031
      *                                                                                       CGL031
      ** Perform field conversion of WWTXSR if WWTXSR > 0.                                    CGL031
      *                                                                                       CGL031
     C                     Z-ADDWWTXSR    ZFLD15                                              CGL031
     C                     Z-ADDCDP       ZDECS                                               CGL031
     C                     MOVE 'J'       ZECODE                                              CGL031
      *                                                                                       CGL031
     C                     EXSR ZSEDIT                                                        CGL031
     C                     MOVE ZOUT21    TEMP                                                CGL031
     C                     MOVE *BLANKS   ARRB                                                CGL031
     C                     MOVEATEMP      ARRB                                                CGL031
      *                                                                                       CGL031
     C                     EXSR STAR                                                          CGL031
     C                     MOVEAARRB      RTXSR                                               CGL031
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
     C*****************************************************************
     C*                                                               *
     C*  INSTR -  SUBROUTINE FOR PRINTING THE INSRUCTIONS THAT GO ON  *
     C*           LINES 29 - 34 ON THE TRADE CONFIRMATIONS.           *
     C*                                                               *
     C*****************************************************************
     C*
     C           INSTR     BEGSR                           *** INSTR  ***
     C*
     C                     MOVE *BLANKS   LIN29A
     C                     MOVE *BLANKS   LIN29B
     C                     MOVE *BLANKS   LIN30A
     C                     MOVE *BLANKS   LIN30B
     C                     MOVE *BLANKS   LIN31A
     C                     MOVE *BLANKS   LIN31B
     C                     MOVE *BLANKS   LIN32A
     C                     MOVE *BLANKS   LIN32B
     C                     MOVE *BLANKS   LIN33A
     C                     MOVE *BLANKS   LIN33B
     C                     MOVE *BLANKS   LIN30C
     C                     MOVE *BLANKS   LIN30D
     C                     MOVE *BLANKS   LIN33C                          E18115
     C                     MOVE *BLANKS   LIN33D                          E18115
     C                     MOVE *BLANKS   LIN34A
     C                     MOVE *BLANKS   LIN34B
     C*
     C***  CHAIN TO THE SE FILE USING COUNTERPARTY NUMBER AND SAVE        E13911
     C***  THE DISCRETIONARY INDICATOR IF SUCCESSFUL.                     E13911
     C*                                                                   E13911
     C                     MOVE *BLANKS   @DISC   1                       E13911
     C********** TCNR      IFNE *ZEROS                                                        CSD027
     C           TCNR      IFNE *BLANKS                                                       CSD027
     C                     MOVE TCNR      CLINNO
     C                     EXSR SE
     C                     END
     C*                                                                   E13911
     C***IF TCNR = 0, OR ERROR ON READ, PERFORM STD DB ERROR              E13911
     C*                                                                   E13911
     C********** TCNR      IFEQ *ZEROS                                                 E13911 CSD027
     C           TCNR      IFEQ *BLANKS                                                       CSD027
     C           *INU7     OREQ '1'                                       E13911
     C***********          Z-ADD44        DBASE       **************E13911E20651
     C***********          GOTO EINSTR                ***DB*ERROR*44E13911E20651
     C***********          ELSE                       **************E13911E20651
     C           *LOCK     IN   LDA                                       E37016
     C                     Z-ADD49        DBASE            ***************E20651
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                      ***************S01117
     C                     GOTO EINSTR                     * DB ERROR 49 *E20651
     C                     ELSE                            ***************E20651
     C                     MOVE C1DI      @DISC                           E13911
     C                     END                                            E13911
     C*
     C*  IF THE TRADE TYPE FIELD IS = TP, EXECUTE THE FOLLOWING PIECE OF
     C*  CODE. ALL LITERALS THAT ARE OUTPUT ARE PLACED IN CORRESPONDING
     C*  LINE NUMBER ASSOCIATED WITH THE PRINT OUTAND WHAT IS ON THE SPEC.
     C*
     C           TDTP      IFEQ 'TP'
     C*
     C*  IF THE SETTLEMENT METHOD IS ANY OF THE FOLLOWING CODES, ACCESS THE
     C*  ARRAY ARRA AT THE BOTTOM OF THE PROGRAM AND PLACE IN LIN29A THE
     C*  VALUE ASSOCIATED WITH ENTRY 22
     C*
     C           SMTH      IFEQ 01
     C           SMTH      OREQ 05
     C           SMTH      OREQ 06
     C           SMTH      OREQ 07
     C           SMTH      OREQ 08
     C           SMTH      OREQ 15
     C***********          MOVEAARRA,22   LIN29A 37                       092968
     C                     MOVEAARRA,22   LIN29A 40                       092968
     C                     ELSE
     C*
     C*  IF THE SETTLEMENT METHOD IS EITHER 04 OR 14 PLACE ARRA ENTRY 13 IN
     C* LINE 29A, OTHERWISE PLACE ARRA ENTRY 23 IN LINE 29A.
     C*
     C           SMTH      IFEQ 04
     C           SMTH      OREQ 14
     C                     MOVEAARRA,13   LIN29A
     C                     ELSE
     C                     MOVEAARRA,23   LIN29A
     C                     END
     C                     END
     C*
     C*  PLACE ARRA ENTRY 25 INTO LINE 29B
     C*
     C***  DO NOT PRINT 'DELIVER FROM' FOR DISCRETIONARY CUSTOMERS        E13911
     C***  OR GREY MARKET TRADES                                          E32540
     C*                                                                   E13911
     C           @DISC     IFNE 'D'                                       E13911
     C           @DISC     ANDNE'S'                                       E13911
     C           TDMI      ANDNE'G'                                       E32540
     C                     MOVEAARRA,25   LIN29B 12
     C                     END                                            E13911
     C*
     C*  IF SETTLEM. METHOD = 02, MOVE ARRA,11 TO LIN30A AND BLANKS TO
     C*  LIN31A.
     C*
     C           SMTH      IFEQ 02
     C                     MOVEAARRA,11   LIN30A 26
     C                     ELSE
     C*
     C*  IF SETTLEM. METHOD = 12, MOVE ARRA,16 TO LIN30A AND BLANKS TO
     C*  LIN31A.
     C*
     C           SMTH      IFEQ 12
     C                     MOVEAARRA,16   LIN30A
     C                     ELSE
     C*
     C*  IF SETTLEM. METHOD = 00 OR BLANKS OR PAY FROM FIELD = BLANKS MOVE
     C*  ARRA,18 TO LIN30A AND BLANKS TO LIN31A
     C*
     C           SMTH      IFEQ *ZEROS
     C           PYFM      OREQ *BLANKS
     C           SMTH      ANDNE04
     C                     MOVEAARRA,18   LIN30A
     C                     ELSE
     C*
     C***IF SETTLEM.METH.*=*14*MOVE*PAY*FROM*FIELD*(TRADES)*TO*LIN30A*AND*165571
     C***BLANKS TO LIN31A**********************************************   165571
      *  If Sett. Method = 14, 'Pay From' is a 10 digit Retail account    165571
      *  no.  CHAIN to Account Master file to get full account number.    165571
      *  Move blanks to LIN31A.                                           165571
     C*
     C           SMTH      IFEQ 14
     C           PYFM      IFNE *BLANKS                                   E32538
     C                     MOVE PYFM      W#ACNO                          165571
     C           K#ACNO    CHAINFDRETALL             41                   165571
      *                                                                   165571
     C           *IN41     IFEQ '1'                                       165571
     C                     Z-ADD66        DBASE             ************  165571
     C                     MOVEL'FDRETALL'DBFILE            * DATABASE *  165571
     C                     MOVE K#ACNO    DBKEY             * ERROR 66 *  165571
     C                     SETON                     U7U8   ************  165571
     C                     EXSR *PSSR                                     165571
     C                     GOTO EINSTR                                    165571
     C                     ENDIF                                          165571
      *                                                                   165571
     C***********          TESTN          NOSTR2     10             E32538165571
     C***10******          TESTN          CUSTN2     09             E32538165571
     C*                                                                   E32538
     C************IN10     IFEQ '1'                                 E32538165571
     C************IN09     ANDEQ'0'                                 E32538165571
     C************         MOVELPYFM      LIN30A                    E32538165571
     C************         ELSE                                     E32538165571
     C************         MOVELPYFA      BRANCH                    E32537165571
     C                     MOVELBRCA      BRANCH                          165571
     C                     MOVE '-'       BRANCH                          E32537
     C************         MOVELCUSTN2    CUST                      E32538165571
     C************         MOVE SETC      CURRCY                    E32538165571
     C                     MOVELCNUM      CUST                            165571
     C                     MOVE CCY       CURRCY                          165571
     C                     MOVEL'-'       CURRCY                          E32538
     C************         MOVE PYFM      TEMP4   7                 E32538165571
     C************         MOVEL'-'       TEMP4                     E32538165571
     C************         MOVELTEMP4     ACCODE                    E32538165571
     C                     MOVE ACOD      ACCODE                          165571
     C                     MOVEL'-'       ACCODE                          165571
     C************         MOVE TEMP4     ACSEQ                     E32538165571
     C                     MOVE ACSQ      ACSEQ                           165571
     C                     MOVEL'-'       ACSEQ                           E32538
     C                     MOVELCUSTAC    LIN30A                          E32538
     C                     MOVE *BLANKS   LIN31A                          165571
     C************         END                                      E32538165571
     C                     END                                            E32538
     C                     ELSE
     C*
     C*  IF THE SETTLEM. METH. = 01 OR 07 OR 08 THEN CHAIN TO THE
     C*  NOSTRO FILE AND PICK UP THE CUSTOMER NUMBER FOR CHAINING TO
     C*  THE CLINTCB FILE.
     C*  ON AN ERROR PERFORM STD DB ERROR.
     C*
     C           SMTH      IFEQ 01
     C           SMTH      OREQ 07
     C           SMTH      OREQ 08
     C*
     C*  SETUP KEY FOR CHAINING TO TABLETL FILE VIA SR TL
     C*
     C                     MOVEL'70'      KEYF
     C                     MOVELSETC      KEYTMP  5
     C                     MOVELPYFM      NOST    2
     C                     MOVE KEYTMP    KEYF
     C                     MOVE NOST      KEYF
     C                     EXSR TL
     C           *INU7     IFEQ '1'                        *****************
     C                     Z-ADD17        DBASE            * DB ERROR 17 ***
     C                     OUT  LDA                        ***************S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO EINSTR                     *****************
     C                     END
     C*
     C*  IF NO ERRORS, USE CNUM TO CHAIN TO CLINTCB FILE FOR CUSTOMER NAME
     C*  AND TOWN. MOVE TO FIELDS FOR OUTPUT.
     C*
     C                     MOVE CNUM      CLINNO
     C                     EXSR CB
     C           *INU7     IFEQ '1'                        ***************
     C                     Z-ADD18        DBASE            * DB ERROR 18 *
     C                     OUT  LDA                        ***************S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO EINSTR                     ***************
     C                     END
     C                     MOVELCRNM      LIN30A
     C                     MOVELCTWN      LIN31A
     C*
     C*  IN THE NEXT FEW LINES CALACULATE THE DETAIL OUTPUT ON THE
     C*  LINES 32, 33, 34. THESE INCLUDE LITERAL 4 & 5 AND NAME & TOWN
     C*  3
     C*
     C*  MOVE LITERAL AT ARRA,27 TO LIN32A FOR OUTPUT *** LITERAL 4 ***
     C*
     C/COPY WNCPYSRC,SE0550C058
     C                     MOVEAARRA,27   LIN32A 10
     C/COPY WNCPYSRC,SE0550C059
     C*
     C*  TEST THE SUB-FIELDS OF PAYT (TRADES) FOR NUMERICS. DETERMINE THE
     C*  CONTENTS IE. WHETHER NUMERIC OR NOT. IF FIRST CHAR NUMERIC TEST
     C*  THAT FIRST 6 ARE AND IF NO,  CHAIN TO THE NOSTRO  FILE USING THE
     C*  FIRST 2 CHARS AND THE SETTLEMENT CCY. USE THE CUSTOMER NUMBER
     C*  TO CHAIN TO CLINTCB FILE FOR CUSTOMER NAME AND TOWN.
     C*  CHECK FOR *BLANKS IN PAY TO FIELD
     C*  *** NAME AND TOWN 3 ***
     C*
     C           PAYT      IFNE *BLANKS
     C*
     C                     TESTN          NOSTR      10
     C***10******          TESTN          CUSTNO     09                                       CSD027
     C************IN10     IFEQ '1'                                                           CSD027
     C************IN09     ANDEQ'0'                                                           CSD027
     C           *IN10     IFEQ *ON                                                           CSD027
     C           @NSX      ANDEQ*BLANKS                                                       CSD027
     C*
     C*  SET UP KEY FOR CHAINING TO NOSTRO FILE
     C*
     C                     MOVEL'70'      KEYF
     C                     MOVELSETC      KEYTMP  5
     C                     MOVE NOSTR     KEYTMP
     C                     MOVE KEYTMP    KEYF
     C                     EXSR TL
     C*
     C*  IF ERROR PERFORM STD DB ERROR.
     C*
     C           *INU7     IFEQ '1'                        ***************
     C                     Z-ADD19        DBASE            * DB ERROR 19 *
     C                     OUT  LDA                        ***************S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO EINSTR                     ***************
     C                     END
     C*
     C*  SET UP KEY FOR CHAINING TO CLINTCB.
     C*
     C                     MOVE CNUM      CLINNO
     C                     EXSR CB
     C*
     C*  IF ERROR PERFORM STD DB ERROR
     C*
     C************INU7     IFEQ '1'                        ***************                    CSD027
     C           *IN41     IFEQ '1'                        ***************                    CSD027
     C                     Z-ADD20        DBASE            * DB ERROR 20 *
     C                     OUT  LDA                        ***************S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO EINSTR                     ***************
     C                     END
     C*
     C*  MOVE CUSTOMER NAME AND TOWN TO FIELDS FOR OUTPUT.
     C*
     C                     MOVELCRNM      LIN33A
     C                     MOVELCTWN      LIN34A
     C*
     C                     ELSE
     C*
     C*  IF FIRST 6 CHARS ARE ALL NUMERIC, THEN CHAIN DIRECTLY TO CLINTCB
     C*
     C************IN10     IFEQ '1'                                                           CSD027
     C************IN09     ANDEQ'1'                                                           CSD027
     C**********           MOVE CUSTNO    CLINNO  60                                          CSD027
     C                     MOVE CUSTNO    CLINNO  6                                           CSD027
     C                     EXSR CB
     C*
     C* IF ERROR PERFORM STD DB ERROR.
     C*
     C************INU7     IFEQ '1'                                                           CSD027
     C************         Z-ADD21        DBASE            ***************                    CSD027
     C************         OUT  LDA                                       S01117              CSD027
     C************         EXSR *PSSR                      ***************S01117              CSD027
     C************         GOTO EINSTR                     * DB ERROR 21 *                    CSD027
     C************         END                             ***************                    CSD027
     C*
     C*  MOVE CUSTOMER NAME AND TOWN TO FIELDS FOR OUTPUT
     C***********                                                                             CSD027
     C***********          MOVELCRNM      LIN33A 35                                           CSD027
     C***********          MOVELCTWN      LIN34A 20                                           CSD027
     C*
     C***********          ELSE                                                               CSD027
     C           *IN41     IFEQ *OFF                                                          CSD027
     C*  MOVE CUSTOMER NAME AND TOWN TO FIELDS FOR OUTPUT                                     CSD027
     C                     MOVELCRNM      LIN33A 35                                           CSD027
     C                     MOVELCTWN      LIN34A 20                                           CSD027
     C                     ELSE                                                               CSD027
     C*
     C*  IF FIRST CHAR IS ALPHA, USE THE FIRST 8 CHARS TO CHAIN TO TABLET2
     C*  FOR CUSTOMER NAME AND TOWN.
     C*
     C************IN10     IFEQ '0'                                                           CSD027
     C*
     C                     MOVE COUSNM    T2KEY  12
     C                     EXSR T2
     C           *INU7     IFEQ '1'                        ***************
     C                     Z-ADD22        DBASE            * DB ERROR 22 *
     C                     OUT  LDA                        ***************S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO EINSTR                     ***************
     C                     END
     C                     MOVE CPNM      LIN33A 35
     C                     MOVE CPTN      LIN34A 20
     C************         END                                                                CSD027
     C                     END
     C                     END
     C*
     C*  IF THE PAY TO FIELD CONTAINS ALL  BLANKS, PUT OUT A MESSAGE ON
     C*  THE REPORT, PICK UP MESSAGE FROM ARRA,19.
     C*
     C                     ELSE
     C                     MOVEAARRA,19   LIN33A
     C                     END
     C                     ELSE
     C*
     C*  IF SETTLEM METH = 04 MAKE UP THE 4 PARTS TO BE OUTPUT AND CHAIN
     C*  TO TABLETR FOR THE START ACCOUNT SEQUENCE NUMBER.
     C*  *** NAME TOWN 1 ***
     C*
     C           SMTH      IFEQ 04
     C                     MOVELPYFA      BRANCH                          E32537
     C                     MOVE '-'       BRANCH                          E32537
     C                     MOVE TCNR      CUST    6
     C                     MOVE SETC      CURRCY  4
     C                     MOVEL'-'       CURRCY
     C**********           MOVE CADC      ACCODE  5                                           CGL029
     C                     MOVE CADC      ACCODE                                              CGL029
     C                     MOVEL'-'       ACCODE
     C***********          MOVEL'10'      KEYF                            S01117
     C***********          MOVE PYFB      KEYF                            S01117
     C***********          EXSR TR                                        S01117
     C************INU7     IFEQ '1'                        ***************S01117
     C***********          Z-ADD23        DBASE            * DB ERROR 23 *S01117
     C***********          GOTO EINSTR                     ***************S01117
     C***********          END                                            S01117
     C***********          MOVE NSACS     ACSEQ   3                       S01117
     C                     MOVE '01'      ACSEQ   3                       S01117
     C                     MOVEL'-'       ACSEQ
     C                     MOVELCUSTAC    LIN30A
     C                     ELSE
     C*
     C*  CONCERNED WITH NAME TOWN 1, IF SETTLEM. METH.= 05, SET UP THE
     C*  FOUR PARTS TO BE OUTPUT USING THE DATA IN PAY FROM FIELD.
     C*
     C           SMTH      IFEQ 05
     C                     MOVELPYFA      BRANCH                          E32537
     C                     MOVE '-'       BRANCH                          E32537
     C                     MOVELPYFM      CUST
     C                     MOVE SETC      CURRCY  4
     C                     MOVEL'-'       CURRCY
     C**********           MOVE PYFM      TEMP4   7                                           CGL029
     C                     MOVE PYFM      TEMP4  13                                           CGL029
     C                     MOVEL'-'       TEMP4
     C                     MOVELTEMP4     ACCODE
     C                     MOVE TEMP4     ACSEQ
     C                     MOVEL'-'       ACSEQ
     C                     MOVELCUSTAC    LIN30A
     C                     ELSE
     C*
     C*********ME TOWN 1 *** USE SOME DATA FROM THE PAY FROM FIELD AND CHAE16831
     C********* CLINTSE FILE FOR THE ACCOUNT CODE AND ACCOUNT SEQUENCE.   E16831
     C*
     C** USE SOME DATA FROM THE PAY FROM FIELD                            E16831
     C*
     C           SMTH      IFEQ 15
     C                     MOVELPYFA      BRANCH                          E32537
     C                     MOVE '-'       BRANCH                          E32537
     C                     MOVELPYFM      CUST
     C                     MOVE SETC      CURRCY
     C                     MOVEL'-'       CURRCY
     C********** CUST      IFNE *ZEROS                                                        CSD027
     C           CUST      IFNE *BLANKS                                                       CSD027
     C**********           MOVE CUST      CLINNO                          E16831
     C**********           EXSR SE                                        E16831
     C*
     C***IF*THERE*IS*AN*ERROR*THEN*PERFORM*STD*DB*ERROR***
     C*
     C********** *INU7     IFEQ '1'                        ***************E16831
     C**********           Z-ADD24        DBASE            * DB ERROR 24 *E16831
     C**********           GOTO EINSTR                     ***************E16831
     C**********           END                                            E16831
     C**********           MOVE C1AC      ACCODE                          E16831
     C**********           MOVEL'-'       ACCODE                          E16831
     C**********           MOVE C1SQ      ACSEQ                           E16831
     C**********           MOVEL'-'       ACSEQ                           E16831
     C**********           MOVE PYFM      WORK6   6                                    E16831 CGL029
     C**********           MOVELWORK6     WORK4   4                                    E16831 CGL029
     C                     MOVE PYFM      WORK6  12                                           CGL029
     C                     MOVELWORK6     WORK4  10                                           CGL029
     C                     MOVE WORK4     ACCODE                          E16831
     C                     MOVEL'-'       ACCODE                          E16831
     C                     MOVE WORK6     ACSEQ                           E16831
     C                     MOVEL'-'       ACSEQ                           E16831
     C                     MOVELCUSTAC    LIN30A
     C                     END
     C*
     C                     ELSE
     C                     MOVE *BLANKS   ACCODE
     C                     MOVE *BLANKS   ACSEQ
     C                     MOVE *BLANKS   LIN30A
     C**********           Z-ADD*ZEROS    CNUM                                                CSD027
     C                     MOVE *BLANKS   CNUM                                                CSD027
     C                     END
     C*
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C*                                                                   E13911
     C*  DO NOT PROCESS NAMES AND TOWNS 2 AND 4, LITERAL 5 AND            E13911
     C***REFERENCE*FOR*DISCRETIONARY*CUSTOMERS**********************E13911E32540
     C*  REFERENCE FOR DISCRETIONARY CUSTOMERS AND GREY MARKET TRADES     E32540
     C*                                                                   E13911
     C           @DISC     IFNE 'D'                                       E13911
     C           @DISC     ANDNE'S'                                       E13911
     C           TDMI      ANDNE'G'                                       E32540
     C*
     C*  USE THE DELIVER FROM FIELD ON TRADES TO FIND CUSTOMER NAME AND
     C*  TOWN FORN CLINTCB FILE FOR NAME & TOWN 2 ON SPEC. I.E. LINE 30B
     C*  AND LINE 31B      *** NAME TOWN 2 FOR TP ***
     C*
     C                     MOVE DELF      CLINNO
     C                     EXSR CB
     C           *INU7     IFEQ '1'                        ***************
     C                     Z-ADD25        DBASE            * DB ERROR 25 *
     C                     OUT  LDA                        ***************S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO EINSTR
     C                     END
     C                     MOVE CRNM      LIN30B 20
     C                     MOVE CTWN      LIN31B 10
      *                                                                   E28804
     C********** DELF      IFNE 0                                                      E28804 CSD027
     C           DELF      IFNE *BLANKS                                                       CSD027
     C                     MOVE DELF      CLINNO                          E27083
     C                     EXSR SE                                        E27083
     C           *INU7     IFEQ '1'                                       E27083
     C           *LOCK     IN   LDA                                       E37016
     C                     Z-ADD52        DBASE                           E27083
     C                     OUT  LDA                                       E27083
     C                     EXSR *PSSR                      ***************E27083
     C                     GOTO EINSTR                     * DB ERROR 52 *E27083
     C                     END                             ***************E27083
     C                     MOVE C1DI      DEPTYP  1                       E27083
     C                     ELSE                                           E28804
     C                     MOVE ' '       DEPTYP                          E28804
     C                     END                                            E28804
     C*
     C*  USE THE DELIVER TO   FIELD ON TRADES TO FIND CUSTOMER NAME AND
     C*  TOWN FROM CLINTCB FILE FOR NAME & TOWN 4 ON SPEC. I.E. LINE 33B
     C*  AND LINE 34B      *** NAME TOWN 4 FOR TP***
     C*
     C                     MOVE DELT      CLINNO
     C                     EXSR CB
     C           *INU7     IFEQ '1'                        ***************
     C                     Z-ADD26        DBASE            * DB ERROR 26 *
     C                     OUT  LDA                        ***************S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO EINSTR                     ***************
     C                     END
     C                     MOVE CRNM      LIN33B 20
     C                     MOVE CTWN      LIN34B 10
     C*
     C*  LITERAL 5, LINE 32B ON PRINT OUT OBTAINED FROM ARRA,26
     C*
     C                     MOVEAARRA,26   LIN32B 12
     C*                                                                   E27083
     C*  REFERENCE 2, Use Deliver From For A/C Of if entered              E27083
     C*                                                                   E27083
     C           DFFA      IFNE *BLANKS                                   E27083
     C                     MOVELDFFA      CLINNO                          E27083
     C                     EXSR SE                                        E27083
     C                     ELSE                                           E27083
     C*
     C*  REFERENCE 2, CHAIN TO THE SE FILE USING COUNTERPARTY NUMBER
     C*
     C********** TCNR      IFNE *ZEROS                                                        CSD027
     C           TCNR      IFNE *BLANKS                                                       CSD027
     C                     MOVE TCNR      CLINNO
     C                     EXSR SE
     C*
     C*  IF ERROR, PERFORM STD DB ERROR
     C*
     C           *INU7     IFEQ '1'                        ***************
     C           *LOCK     IN   LDA                                       E37016
     C                     Z-ADD27        DBASE            * DB ERROR 27 *
     C                     OUT  LDA                        ***************S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO EINSTR                     ***************
     C                     END
     C*
     C                     ELSE
     C**********           Z-ADD*ZEROS    CNUM                                                CSD027
     C                     MOVE *BLANKS   CNUM                                                CSD027
     C                     END
     C                     END                                            E27083
     C*                                                                   E27083
     C**If*the*Deliver*From*isaauEuroclear,dCedel,aoreKassenverein*depot8 E27083              CSE022
     C**the*depot*reference*is*in*a*fixed*position*********************** E27083              CSE022
      *                                                                                       CSE022
      ** If the Deliver From is a Euroclear or Cedel depot, the depot                         CSE022
      ** reference is in a fixed position.                                                    CSE022
      *                                                                                       CSE022
     C*                                                                   E27083
     C           DEPTYP    IFEQ 'E'                                       E27083
     C                     Z-ADD1         A                               E27083
     C                     SETON                     29                   E27083
     C                     ELSE                                           E27083
     C           DEPTYP    IFEQ 'C'                                       E27083
     C                     Z-ADD2         A                               E27083
     C                     SETON                     29                   E27083
     C                     ELSE                                           E27083
     C********** DEPTYP    IFEQ 'K'                                       E27083              CSE022
     C**********           Z-ADD3         A                               E27083              CSE022
     C**********           SETON                     29                   E27083              CSE022
     C**********           ELSE                                           E27083              CSE022
     C**********                                                          E18115              CSE022
     C***USE*THE*DELIVER*FROM*FIELD*TOCCHECKHTHATETHERENISUANAEQUIVALENT* E18115              CSE022
     C***DEPOT*REF.*ON*TABTB36,*IF*SO*AND*DISCRETIONARY*INDM=*M,*MOVE*THE E18115              CSE022
     C***CORRESPONDING*DEPOT.*REF.*FROM*CLINTSE*TO*OUPUT*FIELD*********** E18115              CSE022
      *                                                                                       CSE022
      ** Use the DELIVER FROM FIELD to check if there is an equivalent                        CSE022
      ** Depot Reference on TABTB36.  If *IN29 is on, Discretionary                           CSE022
      ** Indicator is equal to 'M' and Market Indicator is not equal                          CSE022
      ** to 'G', move the corresponding Depot Reference from CLINTSE                          CSE022
      ** to Output Field.  However if CSE022 is installed, use program                        CSE022
      ** SEDORFRTV for the Output Field.                                                      CSE022
      *                                                                                       CSE022
     C*                                                                   E18115
     C** NOTE ** ON A TRADE PURCHASE DELIVER FROM THE COUNTERPARTY AND    E18115
     C*          DELIVER TO THE USER                                      E18115
     C*                                                                   E18115
     C                     MOVE DELF      DELFA   6                       E18115
     C                     Z-ADD1         A                               E18115
     C           DELFA     LOKUPARR36,A                  29               E18115
     C**********           END                                            E27083              CSE022
     C                     END                                            E27083
     C                     END                                            E27083
      *                                                                                       CSE022
     C           CSE022    IFEQ 'N'                                                           CSE022
      *                                                                                       CSE022
     C           C1DI      IFEQ 'M'                                       E18115
     C           *IN29     ANDEQ'1'                                       E18115
     C           ARRSE,A   ANDNE*BLANKS                                   E18115
     C           TDMI      ANDNE'G'                                       E32540
     C                     MOVEAARRSE,A   LIN30D  6                       E18115
     C                     MOVE 'VIA'     LIN30C  3                       E18115
     C                     END                                            E18115
      *                                                                                       CSE022
     C                     ELSE                                                               CSE022
     C                     MOVEL'SEDOR'   WPGM    9                                           CSE022
     C                     MOVE 'FRTV'    WPGM                                                CSE022
     C                     MOVELDELFA     PDEPOT                                              CSE022
     C                     MOVELCNUM      PCNUM                                               CSE022
      *                                                                                       CSE022
     C                     CALL WPGM                                                          CSE022
     C                     PARM *BLANKS   PRTRN  10                                           CSE022
     C                     PARM           PDEPOT  6                                           CSE022
     C                     PARM           PCNUM   6                                           CSE022
     C                     PARM *BLANKS   PSKALR 20                                           CSE022
      *                                                                                       CSE022
     C                     MOVELPSKALR    LIN30D                                              CSE022
     C                     MOVE 'VIA'     LIN30C                                              CSE022
     C                     ENDIF                                                              CSE022
     C*                                                                   E18115
     C*  CHAIN TO THE SE FILE USING THE DELIVER TO FIELD                  E18115
     C*  THIS WILL FILL THE ELEMENTS OF ARRAY FOR LATER USE               E18115
     C*                                                                   E18115
     C********** DELT      IFNE *ZEROS                                                 E18115 CSD027
     C           DELT      IFNE *BLANKS                                                       CSD027
     C                     MOVE DELT      CLINNO                          E18115
     C                     EXSR SE                                        E18115
     C*                                                                   E18115
     C*  IF ERROR, PERFORM STD DB ERROR                                   E18115
     C*                                                                   E18115
     C********** *INU7     IFEQ '1'                  ***************E18115E20651
     C**********           Z-ADD46        DBASE      ***DB*ERROR*46*E18115E20651
     C**********           GOTO EINSTR               ***************E18115E20651
     C           *INU7     IFEQ '1'                        ***************E20651
     C           *LOCK     IN   LDA                                       E37016
     C                     Z-ADD51        DBASE            * DB ERROR 51 *E20651
     C                     OUT  LDA                        ***************S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO EINSTR                     ***************E20651
     C                     END                                            E18115
     C*                                                                   E18115
     C                     ELSE                                           E18115
     C**********           Z-ADD*ZEROS    CNUM                                         E18115 CSD027
     C                     MOVE *BLANKS   CNUM                                                CSD027
     C                     END                                            E18115
     C*                                                                   E27083
     C**If*the*Deliver*From*is*a*Euroclear,*Cedel,*or*Kassenverein******* E27083              CSE022
     C**the*depot*reference*is*in*a*fixed*position*********************** E27083              CSE022
      *                                                                                       CSE022
      ** If the Deliver From is a Euroclear or Cedel depot, the depot                         CSE022
      ** reference is in a fixed position.                                                    CSE022
      *                                                                                       CSE022
     C*                                                                   E27083
     C           C1DI      IFEQ 'E'                                       E27083
     C                     Z-ADD1         A                               E27083
     C                     SETON                     29                   E27083
     C                     ELSE                                           E27083
     C           C1DI      IFEQ 'C'                                       E27083
     C                     Z-ADD2         A                               E27083
     C                     SETON                     29                   E27083
     C                     ELSE                                           E27083
     C********** C1DI      IFEQ 'K'                                       E27083              CSE022
     C**********           Z-ADD3         A                               E27083              CSE022
     C**********           SETON                     29                   E27083              CSE022
     C**********           ELSE                                           E27083              CSE022
     C**********                                                                              CSE022
     C***USE*THE*DELIVER*TO***FIELD*TOCCHECKHTHATETHERENISUANAEQUIVALENT*                     CSE022
     C***DEPOT*REF.*ON*TABTB36,*IF*SOAANDIDISCRETIONARYDINDM=VM,HMOVE*THE                     CSE022
     C***CORRESPONDING*DEPOT.*REF.*FROM*CLINTSE*TO*OUPUT*FIELD***********                     CSE022
      *                                                                                       CSE022
      ** Use the DELIVER TO FIELD to check if there is an equivalent                          CSE022
      ** Depot Reference on TABTB36.  If so and Market Indicator is                           CSE022
      ** not equal to 'G', move the corresponding Depot Reference from                        CSE022
      ** CLINTSE to Output Field. However if CSE022 is installed, use                         CSE022
      ** SEDORFRTV for the output.                                                            CSE022
      *                                                                                       CSE022
     C*
     C                     MOVE DELT      DELTA   6
     C                     Z-ADD1         A                               E16331
     C           DELTA     LOKUPARR36,A                  29
     C**********           END                                            E27083              CSE022
     C                     END                                            E27083
     C                     END                                            E27083
      *                                                                                       CSE022
     C           CSE022    IFEQ 'N'                                                           CSE022
      *                                                                                       CSE022
     C***********C1DI      IFEQ 'M'                                       E18115
     C********** *IN29     ANDEQ'1'                                       E18115
     C           *IN29     IFEQ '1'                                       E18115
     C           TDMI      ANDNE'G'                                       E32540
     C***********          MOVEAARRSE,A   LIN30D  6                       E18115
     C***********          MOVE 'VIA'     LIN30C  3                       E18115
     C                     MOVEAARRSE,A   LIN33D                          E18115
     C                     MOVE 'VIA'     LIN33C                          E18115
     C                     END                                            E13911
      *                                                                                       CSE022
     C                     ELSE                                                               CSE022
     C                     MOVEL'SEDOR'   WPGM    9                                           CSE022
     C                     MOVE 'FRTV'    WPGM                                                CSE022
     C                     MOVELDELTA     PDEPOT                                              CSE022
     C                     MOVELCNUM      PCNUM                                               CSE022
      *                                                                                       CSE022
     C                     CALL WPGM                                                          CSE022
     C                     PARM *BLANKS   PRTRN  10                                           CSE022
     C                     PARM           PDEPOT  6                                           CSE022
     C                     PARM           PCNUM   6                                           CSE022
     C                     PARM *BLANKS   PSKALR 20                                           CSE022
      *                                                                                       CSE022
     C                     MOVELPSKALR    LIN33D                                              CSE022
     C                     MOVE 'VIA'     LIN33C                                              CSE022
     C                     ENDIF                                                              CSE022
     C*                                                                   E13911
     C                     END
     C                     END
     C*
     C*  IF THE TRADE TYPE FIELD IS = TS, EXECUTE THE FOLLOWING PIECE OF
     C*  CODE. ALL LITERALS THAT ARE OUTPUT ARE PLACED IN CORRESPONDING
     C*  LINE NUMBER ASSOCIATED WITH THE PRINT OUTAND WHAT IS ON THE SPEC.
     C*
     C           TDTP      IFEQ 'TS'
     C*
     C*  IF THE SETTLEMENT METHOD IS ANY OF THE FOLLOWING CODES, ACCESS THE
     C*  ARRAY ARRA AT THE BOTTOM OF THE PROGRAM AND PLACE IN LIN29A THE
     C*  VALUE ASSOCIATED WITH ENTRY 22
     C*
     C           SMTH      IFEQ 01
     C***********SMTH      OREQ 05                                        E17174
     C***********SMTH      OREQ 06                                        E17174
     C           SMTH      OREQ 07
     C           SMTH      OREQ 08
     C***********SMTH      OREQ 15                                        E17174
     C***********          MOVEAARRA,24   LIN29A 37                       092968
     C                     MOVEAARRA,24   LIN29A 40                       092968
     C                     ELSE
     C*
     C*  IF THE SETTLEMENT METHOD IS 05 OR 06 OR 15 PLACE ARRAY ENTRY     E17174
     C*  41 IN LINE29A.                                                   E17174
     C*                                                                   E17174
     C           SMTH      IFEQ 05                                        E17174
     C           SMTH      OREQ 06                                        E17174
     C           SMTH      OREQ 15                                        E17174
     C                     MOVEAARRA,41   LIN29A                          E17174
     C                     ELSE                                           E17174
     C*                                                                   E17174
     C*  IF THE SETTLEMENT METHOD IS EITHER 04 OR 14 PLACE ARRA ENTRY 24 IN
     C* LINE 29A, OTHERWISE PLACE ARRA ENTRY 23 IN LINE 29A.
     C*
     C           SMTH      IFEQ 04
     C           SMTH      OREQ 14
     C                     MOVEAARRA,12   LIN29A
     C                     ELSE
     C                     MOVEAARRA,23   LIN29A
     C                     END
     C                     END                                            E17174
     C                     END
     C*
     C*  PLACE ARRA ENTRY 26 INTO LINE 29B  *** LITERAL 2 ***
     C*
     C***  DO NOT PRINT 'DELIVER TO  ' FOR DISCRETIONARY CUSTOMERS        E13911
     C***  OR GREY MARKET TRADES                                          E32540
     C*                                                                   E13911
     C           @DISC     IFNE 'D'                                       E13911
     C           @DISC     ANDNE'S'                                       E13911
     C           TDMI      ANDNE'G'                                       E32540
     C                     MOVEAARRA,26   LIN29B 12
     C                     END                                            E13911
     C*
     C*  IF SETTLEM. METHOD = 02, MOVE LITERAL TO LIN30A AND BLANKS TO
     C*  LIN31A.
     C*
     C           SMTH      IFEQ 02
     C                     MOVEAARRA,10   LIN30A 26
     C                     ELSE
     C*
     C*  IF SETTLEM. METHOD = 12, MOVE ARRA,16 TO LIN30A AND BLANKS TO
     C*  LIN31A.
     C*
     C           SMTH      IFEQ 12
     C                     MOVEAARRA,16   LIN30A
     C                     ELSE
     C*
     C*  IF SETTLEM. METHOD = 00 OR BLANKS OR PAY TO FIELD = BLANKS MOVE
     C*  ARRA,18 TO LIN30A AND BLANKS TO LIN31A
     C*
     C           SMTH      IFEQ *ZEROS
     C           PAYT      OREQ *BLANKS
     C           SMTH      ANDNE04
     C                     MOVEAARRA,18   LIN30A
     C                     ELSE
     C*
     C***IF SETTLEM.METH.*=*14*MOVE*PAY*TOOFIELDL(TRADES)STOTLIN30A0A*AND*165571
     C***BLANKS TO LIN31A**********************************************   165571
      *  If Sett. Method = 14, 'Pay To' is a 10 digit Retail account      165571
      *  no.  CHAIN to Account Master file to get full account number.    165571
      *  Move blanks to LIN31A.                                           165571
     C*
     C           SMTH      IFEQ 14
     C           PAYT      IFNE *BLANKS                                   E32538
     C                     MOVE PAYT      W#ACNO                          165571
     C           K#ACNO    CHAINFDRETALL             41                   165571
      *                                                                   165571
     C           *IN41     IFEQ '1'                                       165571
     C                     Z-ADD67        DBASE             ************  165571
     C                     MOVEL'FDRETALL'DBFILE            * DATABASE *  165571
     C                     MOVE K#ACNO    DBKEY             * ERROR 67 *  165571
     C                     SETON                     U7U8   ************  165571
     C                     EXSR *PSSR                                     165571
     C                     GOTO EINSTR                                    165571
     C                     ENDIF                                          165571
      *                                                                   165571
     C***********          TESTN          NOSTR2     10             E32538165571
     C***10******          TESTN          CUSTNO     09             E32538165571
     C*                                                                   E32538
     C************IN10     IFEQ '1'                                 E32538165571
     C************IN09     ANDEQ'0'                                 E32538165571
     C************         MOVELPAYT      LIN30A                    E32538165571
     C************         ELSE                                     E32538165571
     C************         MOVELPYTA      BRANCH                    E32537165571
     C                     MOVELBRCA      BRANCH                          165571
     C                     MOVE '-'       BRANCH                          E32537
     C***********          MOVELCUSTNO    CUST                      E32538165571
     C***********          MOVE SETC      CURRCY                    E32538165571
     C                     MOVELCNUM      CUST                            165571
     C                     MOVE CCY       CURRCY                          165571
     C                     MOVEL'-'       CURRCY                          E32538
     C***********          MOVE PAYT      TEMP4   7                 E32538165571
     C***********          MOVEL'-'       TEMP4                     E32538165571
     C***********          MOVELTEMP4     ACCODE                    E32538165571
     C                     MOVE ACOD      ACCODE                          165571
     C                     MOVEL'-'       ACCODE                          165571
     C***********          MOVE TEMP4     ACSEQ                     E32538165571
     C                     MOVE ACSQ      ACSEQ                           165571
     C                     MOVEL'-'       ACSEQ                           E32538
     C                     MOVELCUSTAC    LIN30A                          E32538
     C                     MOVE *BLANKS   LIN31A                          165571
     C***********          END                                      E32538165571
     C                     END                                            E32538
     C                     ELSE
     C*
     C*  IF THE SETTLEM. METH. = 01 OR 07 OR 08 THEN CHAIN TO THE
     C*  NOSTRO FILE AND PICK UP THE CUSTOMER NUMBER FOR CHAINING TO
     C*  THE CLINTCB FILE.
     C*  ON AN ERROR PERFORM STD DB ERROR.
     C*
     C           SMTH      IFEQ 01
     C           SMTH      OREQ 07
     C           SMTH      OREQ 08
     C*
     C*  SETUP KEY FOR CHAINING TO TABLETL FILE VIA SR TL
     C*
     C                     MOVEL'70'      KEYF
     C                     MOVELSETC      KEYTMP  5
     C                     MOVELPAYT      NOST    2
     C                     MOVE KEYTMP    KEYF
     C                     MOVE NOST      KEYF
     C                     EXSR TL
     C           *INU7     IFEQ '1'                        ***************
     C                     Z-ADD28        DBASE            * DB ERROR 28 *
     C                     OUT  LDA                        ***************S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO EINSTR                     ***************
     C                     END
     C*
     C*  IF NO ERRORS, USE CNUM TO CHAIN TO CLINTCB FILE FOR CUSTOMER NAME
     C*  AND TOWN. MOVE TO FIELDS FOR OUTPUT.
     C*
     C                     MOVE CNUM      CLINNO
     C                     EXSR CB
     C           *INU7     IFEQ '1'                        ***************
     C                     Z-ADD29        DBASE            * DB ERROR 29 *
     C                     OUT  LDA                        ***************S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO EINSTR                     ***************
     C                     END
     C                     MOVELCRNM      LIN30A
     C                     MOVELCTWN      LIN31A
     C*
     C*  IN THE NEXT FEW LINES CALACULATE THE DETAIL OUTPUT ON THE
     C*  LINES 32, 33, 34. THESE INCLUDE LITERAL 4 & 5 AND NAME & TOWN
     C*  3
     C*
     C*  MOVE LITERAL AT ARRA,28 TO LIN32A FOR OUTPUT *** LITERAL 4 ***
     C*
     C/COPY WNCPYSRC,SE0550C060
     C                     MOVEAARRA,28   LIN32A 10
     C/COPY WNCPYSRC,SE0550C061
     C*
     C*  TEST THE SUB-FIELDS OF PFYM (TRADES) FOR NUMERICS. DETERMINE THE
     C*  CONTENTS IE. WHETHER NUMERIC OR NOT. IF FIRST CHAR NUMERIC TEST
     C*  THAT FIRST 6 ARE AND IF NO,  CHAIN TO THE NOSTRO  FILE USING THE
     C*  FIRST 2 CHARS AND THE SETTLEMENT CCY. USE THE CUSTOMER NUMBER
     C*  TO CHAIN TO CLINTCB FILE FOR CUSTOMER NAME AND TOWN.
     C*  FIRST CHECK FOR BLANKS IN PYFM
     C*  *** NAME AND TOWN 3 ***
     C*
     C           PYFM      IFNE *BLANKS
     C*
     C                     TESTN          NOSTR2     10
     C***10******          TESTN          CUSTN2     09                                       CSD027
     C************IN10     IFEQ '1'                                                           CSD027
     C************IN09     ANDEQ'0'                                                           CSD027
     C           *IN10     IFEQ *ON                                                           CSD027
     C           @NSX2     ANDEQ*BLANKS                                                       CSD027
     C*
     C*  SET UP KEY FOR CHAINING TO NOSTRO FILE
     C*
     C                     MOVEL'70'      KEYF
     C                     MOVELSETC      KEYTMP  5
     C                     MOVE NOSTR2    KEYTMP
     C                     MOVE KEYTMP    KEYF
     C                     EXSR TL
     C*
     C*  IF ERROR PERFORM STD DB ERROR.
     C*
     C           *INU7     IFEQ '1'                        ***************
     C                     Z-ADD30        DBASE            * DB ERROR 30 *
     C                     OUT  LDA                        ***************S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO EINSTR                     ***************
     C                     END
     C*
     C*  SET UP KEY FOR CHAINING TO CLINTCB.
     C*
     C                     MOVE CNUM      CLINNO
     C                     EXSR CB
     C*
     C*  IF ERROR PERFORM STD DB ERROR
     C*
     C************INU7     IFEQ '1'                        ***************                    CSD027
     C           *IN41     IFEQ '1'                        ***************                    CSD027
     C                     Z-ADD31        DBASE            * DB ERROR 31 *
     C                     OUT  LDA                        ***************S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO EINSTR                     ***************
     C                     END
     C*
     C*  MOVE CUSTOMER NAME AND TOWN TO FIELDS FOR OUTPUT.
     C*
     C                     MOVELCRNM      LIN33A
     C                     MOVELCTWN      LIN34A
     C                     ELSE
     C*
     C*  IF FIRST 6 CHARS ARE ALL NUMBERIC, THEN CHAIN DIRECTLY TO CLINTCB
     C*
     C************IN10     IFEQ '1'                                                           CSD027
     C************IN09     ANDEQ'1'                                                           CSD027
     C**********           MOVE CUSTN2    CLINNO  60                                          CSD027
     C                     MOVE CUSTN2    CLINNO  6                                           CSD027
     C                     EXSR CB
     C*
     C* IF ERROR PERFORM STD DB ERROR.
     C*
     C************INU7     IFEQ '1'                        ***************                    CSD027
     C***********          Z-ADD32        DBASE            * DB ERROR 32 *                    CSD027
     C***********          OUT  LDA                        ***************S01117              CSD027
     C***********          EXSR *PSSR                                     S01117              CSD027
     C***********          GOTO EINSTR                     ***************                    CSD027
     C***********          END                                                                CSD027
     C*
     C*  MOVE CUSTOMER NAME AND TOWN TO FIELDS FOR OUTPUT
     C***********                                                                             CSD027
     C***********          MOVELCRNM      LIN33A 35                                           CSD027
     C***********          MOVELCTWN      LIN34A 20                                           CSD027
     C***********          ELSE                                                               CSD027
     C           *IN41     IFEQ *OFF                                                          CSD027
     C*  MOVE CUSTOMER NAME AND TOWN TO FIELDS FOR OUTPUT                                     CSD027
     C                     MOVELCRNM      LIN33A 35                                           CSD027
     C                     MOVELCTWN      LIN34A 20                                           CSD027
     C                     ELSE                                                               CSD027
     C*
     C*  IF FIRST CHAR IS ALPHA, USE THE FIRST 8 CHARS TO CHAIN TO TABLET2
     C*  FOR CUSTOMER NAME AND TOWN.
     C*
     C************IN10     IFEQ '0'                                                           CSD027
     C*
     C                     MOVE COSNM2    T2KEY  12
     C                     EXSR T2
     C           *INU7     IFEQ '1'                        ***************
     C                     Z-ADD33        DBASE            * DB ERROR 33 *
     C                     OUT  LDA                        ***************S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO EINSTR                     ***************
     C                     END
     C                     MOVE CPNM      LIN33A 35
     C                     MOVE CPTN      LIN34A 20
     C************         END                                                                CSD027
     C                     END
     C                     END
     C*
     C*  IF NONE OF THE ABOVE 3 CONDITIONS ARE TRUE, PUT OUT A MESSAGE ON
     C*  THE REPORT, PICK UP MESSAGE FROM ARRA,19.
     C*
     C                     ELSE
     C                     MOVEAARRA,19   LIN33A
     C                     END
     C*
     C                     ELSE
     C*
     C*  IF SETTLEM METH = 04 MAKE UP THE 4 PARTS TO BE OUTPUT AND CHAIN
     C*  TO TABLETR FOR THE START ACCOUNT SEQUENCE NUMBER.
     C*  *** NAME TOWN 1 ***
     C*
     C           SMTH      IFEQ 04
     C                     MOVELPYTA      BRANCH                          E32537
     C                     MOVE '-'       BRANCH                          E32537
     C                     MOVE TCNR      CUST    6
     C                     MOVE SETC      CURRCY  4
     C                     MOVEL'-'       CURRCY
     C**********           MOVE CADC      ACCODE  5                                           CGL029
     C                     MOVE CADC      ACCODE                                              CGL029
     C                     MOVEL'-'       ACCODE
     C***********          MOVEL'10'      KEYF                            S01117
     C***********          MOVE PYTB      KEYF                            S01117
     C***********          EXSR TR                                        S01117
     C************INU7     IFEQ '1'                        ***************S01117
     C***********          Z-ADD34        DBASE            * DB ERROR 34 *S01117
     C***********          GOTO EINSTR                     ***************S01117
     C***********          END                                            S01117
     C***********          MOVE NSACS     ACSEQ   3                       S01117
     C                     MOVE '01'      ACSEQ   3                       S01117
     C                     MOVEL'-'       ACSEQ
     C                     MOVELCUSTAC    LIN30A
     C                     ELSE
     C*
     C*  CONCERNED WITH NAME TOWN 1, IF SETTLEM. METH.= 05, SET UP THE
     C*  FOUR PARTS TO BE OUTPUT USING THE DATA IN PAY FROM FIELD.
     C*
     C           SMTH      IFEQ 05
     C                     MOVELPYTA      BRANCH                          E32537
     C                     MOVE '-'       BRANCH                          E32537
     C                     MOVELPAYT      CUST
     C                     MOVE SETC      CURRCY  4
     C                     MOVEL'-'       CURRCY
     C**********           MOVE PAYT      TEMP4   7                                           CGL029
     C                     MOVE PAYT      TEMP4                                               CGL029
     C                     MOVEL'-'       TEMP4
     C                     MOVELTEMP4     ACCODE
     C                     MOVE TEMP4     ACSEQ
     C                     MOVEL'-'       ACSEQ
     C                     MOVELCUSTAC    LIN30A
     C                     ELSE
     C*
     C*  *** NAME TOWN 1 *** USE SOME DATA FROM THE PAY TO   FIELD AND CHAIN
     C*  TO THE CLINTSE FILE FOR THE ACCOUNT CODE AND ACCOUNT SEQUENCE.
     C*
     C           SMTH      IFEQ 15
     C                     MOVELPAYT      CUST
     C                     MOVE SETC      CURRCY
     C                     MOVEL'-'       CURRCY
     C********** CUST      IFNE *ZEROS                                                        CSD027
     C           CUST      IFNE *BLANKS                                                       CSD027
     C                     MOVE CUST      CLINNO
     C                     EXSR SE
     C*
     C*  IF THERE IS AN ERROR THEN PERFORM STD DB ERROR
     C*
     C           *INU7     IFEQ '1'                        ***************
     C           *LOCK     IN   LDA                                       E37016
     C                     Z-ADD35        DBASE            * DB ERROR 35 *
     C                     OUT  LDA                        ***************S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO EINSTR                     ***************
     C                     END
     C                     MOVELPYTA      BRANCH                          E32537
     C                     MOVE '-'       BRANCH                          E32537
     C                     MOVE C1AC      ACCODE
     C                     MOVEL'-'       ACCODE
     C                     MOVE C1SQ      ACSEQ
     C                     MOVEL'-'       ACSEQ
     C                     MOVELCUSTAC    LIN30A
     C                     ELSE
     C                     MOVE *BLANKS   ACCODE
     C                     MOVE *BLANKS   ACSEQ
     C                     MOVE *BLANKS   LIN30A
     C**********           Z-ADD*ZEROS    CNUM                                                CSD027
     C                     MOVE *BLANKS   CNUM                                                CSD027
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C*                                                                   E13911
     C*  DO NOT PROCESS NAMES AND TOWNS 2 AND 4, LITERAL 5 AND            E13911
     C***REFERENCE*FOR*DISCRETIONARY*CUSTOMERS**********************E13911E32540
     C*  REFERENCE FOR DISCRETIONARY CUSTOMERS OR GREY MARKET TRADES      E32540
     C*                                                                   E13911
     C           @DISC     IFNE 'D'                                       E13911
     C           @DISC     ANDNE'S'                                       E13911
     C           TDMI      ANDNE'G'                                       E32540
     C*
     C*  USE THE DELIVER TO   FIELD ON TRADES TO FIND CUSTOMER NAME AND
     C*  TOWN FORN CLINTCB FILE FOR NAME & TOWN 2 ON SPEC. I.E. LINE 30B
     C*  AND LINE 31B      *** NAME TOWN 2 FOR TS ***
     C*
     C                     MOVE DELT      CLINNO
     C                     EXSR CB
     C           *INU7     IFEQ '1'                        ***************
     C                     Z-ADD36        DBASE            * DB ERROR 36 *
     C                     OUT  LDA                        ***************S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO EINSTR                     ***************
     C                     END
     C                     MOVE CRNM      LIN30B 20
     C                     MOVE CTWN      LIN31B 10
      *                                                                   E28804
     C********** DELT      IFNE 0                                                      E28804 CSD027
     C           DELT      IFNE *BLANKS                                                       CSD027
     C                     MOVE DELT      CLINNO                          E27083
     C                     EXSR SE                                        E27083
     C           *INU7     IFEQ '1'                                       E27083
     C           *LOCK     IN   LDA                                       E37016
     C                     Z-ADD53        DBASE            ***************E27083
     C                     GOTO EINSTR                     ** DB ERROR 53 E27083
     C                     END                             ***************E27083
     C                     MOVE C1DI      DEPTYP                          E27083
     C                     ELSE                                           E28804
     C                     MOVE ' '       DEPTYP                          E28804
     C                     END                                            E28804
     C*
     C*  USE THE DELIVER FROM FIELD ON TRADES TO FIND CUSTOMER NAME AND
     C*  TOWN FROM CLINTCB FILE FOR NAME & TOWN 4 ON SPEC. I.E. LINE 33B
     C*  AND LINE 34B      *** NAME TOWN 4 FOR TS ***
     C*
     C                     MOVE DELF      CLINNO
     C                     EXSR CB
     C           *INU7     IFEQ '1'                        ***************
     C                     Z-ADD37        DBASE            * DB ERROR 37 *
     C                     OUT  LDA                        ***************S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO EINSTR                     ***************
     C                     END
     C                     MOVE CRNM      LIN33B 20
     C                     MOVE CTWN      LIN34B 10
     C*
     C*  LITERAL 5, LINE 32B ON PRINT OUT OBTAINED FROM ARRA,25
     C*
     C                     MOVEAARRA,25   LIN32B 12
     C*                                                                   E27083
     C*  REFERENCE 2, Use Deliver To For A/C Of if entered                E27083
     C*                                                                   E27083
     C           DTFA      IFNE *BLANKS                                   E27083
     C                     MOVELDTFA      CLINNO                          E27083
     C                     EXSR SE                                        E27083
     C                     ELSE                                           E27083
     C*
     C*  REFERENCE 2, CHAIN TO THE SE FILE USING COUNTERPARTY NUMBER
     C*
     C********** TCNR      IFNE *ZEROS                                                        CSD027
     C           TCNR      IFNE *BLANKS                                                       CSD027
     C                     MOVE TCNR      CLINNO
     C                     EXSR SE
     C*
     C*  IF ERROR, PERFORM STD DB ERROR
     C*
     C           *INU7     IFEQ '1'                        ***************
     C           *LOCK     IN   LDA                                       E37016
     C                     Z-ADD38        DBASE            * DB ERROR 38 *
     C                     OUT  LDA                        ***************S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO EINSTR                     ***************
     C                     END
     C*
     C                     ELSE
     C**********           Z-ADD*ZEROS    CNUM                                                CSD027
     C                     MOVE *BLANKS   CNUM                                                CSD027
     C                     END
     C                     END                                            E27083
     C*                                                                   E27083
     C**If*the*Deliver*To*is*a*Euroclear,*Cedel,*or*Kassenverein*depot*** E27083              CSE022
     C**the*depot*reference*is*in*a*fixed*position*********************** E27083              CSE022
      *                                                                                       CSE022
      ** If the Deliver To is a Euroclear or Cedel depot, the depot                           CSE022
      ** reference is in a fixed position.                                                    CSE022
      *                                                                                       CSE022
     C*                                                                   E27083
     C           DEPTYP    IFEQ 'E'                                       E27083
     C                     Z-ADD1         V                               E27083
     C                     SETON                     29                   E27083
     C                     ELSE                                           E27083
     C           DEPTYP    IFEQ 'C'                                       E27083
     C                     Z-ADD2         V                               E27083
     C                     SETON                     29                   E27083
     C                     ELSE                                           E27083
     C********** DEPTYP    IFEQ 'K'                                       E27083              CSE022
     C**********           Z-ADD3         V                               E27083              CSE022
     C**********           SETON                     29                   E27083              CSE022
     C**********           ELSE                                           E27083              CSE022
     C**********                                                                              CSE022
     C***USE*THE*DELIVER*TO***FIELD*TO*CHECK*THAT*THERE*IS*AN*EQUIVALENT* E18115              CSE022
     C***DEPOT*REF.*ON*TABTB36,*IF*SO*AND*DISCRETIONARY*IND*=*M,*MOVE*THE                     CSE022
     C***CORRESPONDING*DEPOT.*REF.*FROM*CLINTSE*TO*OUPUT*FIELD***********                     CSE022
      *                                                                                       CSE022
      ** Use the DELIVER TO FIELD to check if there is an equivalent                          CSE022
      ** Depot Reference on TABTB36.  If *IN29 is *on, Discretionary                          CSE022
      ** Indicator is equal to 'M' and Market Indicator is not equal                          CSE022
      ** to 'G', move the corresponding Depot Reference from CLINTSE                          CSE022
      ** to Output Field. However if CSE022 is installed, use program                         CSE022
      ** SEDORFRTV for the Output Field.                                                      CSE022
      *                                                                                       CSE022
     C*
     C***********          MOVE DELF      DELFA   6                       E18115
     C                     MOVE DELT      DELTA   6                       E18115
     C                     Z-ADD1         V                               E16331
     C***********DELFA     LOKUPARR36,V                  29               E18115
     C           DELTA     LOKUPARR36,V                  29               E18115
     C**********           END                                            E27083              CSE022
     C                     END                                            E27083
     C                     END                                            E27083
      *                                                                                       CSE022
     C           CSE022    IFEQ 'N'                                                           CSE022
      *                                                                                       CSE022
     C           C1DI      IFEQ 'M'
     C           *IN29     ANDEQ'1'
     C           TDMI      ANDNE'G'                                       E32540
     C                     MOVEAARRSE,V   LIN30D  6
     C                     MOVE 'VIA'     LIN30C  3
     C                     END                                            E13911
      *                                                                                       CSE022
     C                     ELSE                                                               CSE022
     C                     MOVEL'SEDOR'   WPGM    9                                           CSE022
     C                     MOVE 'FRTV'    WPGM                                                CSE022
     C                     MOVELDELTA     PDEPOT                                              CSE022
     C                     MOVELCNUM      PCNUM                                               CSE022
      *                                                                                       CSE022
     C                     CALL WPGM                                                          CSE022
     C                     PARM *BLANKS   PRTRN  10                                           CSE022
     C                     PARM           PDEPOT  6                                           CSE022
     C                     PARM           PCNUM   6                                           CSE022
     C                     PARM *BLANKS   PSKALR 20                                           CSE022
      *                                                                                       CSE022
     C                     MOVELPSKALR    LIN30D                                              CSE022
     C                     MOVE 'VIA'     LIN30C                                              CSE022
     C                     ENDIF                                                              CSE022
     C*                                                                   E13911
     C*  CHAIN TO THE SE FILE USING THE DELIVER FROM FIELD                E18115
     C*  THIS WILL FILL THE ELEMENTS OF ARRAY ARRSE FOR LATER USE         E18115
     C*                                                                   E18115
     C********** DELF      IFNE *ZEROS                                                 E18115 CSD027
     C           DELF      IFNE *BLANKS                                                       CSD027
     C                     MOVE DELF      CLINNO                          E18115
     C                     EXSR SE                                        E18115
     C*                                                                   E18115
     C*  IF ERROR, PERFORM STD DB ERROR                                   E18115
     C*                                                                   E18115
     C           *INU7     IFEQ '1'                        ***************E18115
     C           *LOCK     IN   LDA                                       E37016
     C                     Z-ADD47        DBASE            * DB ERROR 47 *E18115
     C                     OUT  LDA                        ***************S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO EINSTR                     ***************E18115
     C                     END                                            E18115
     C*                                                                   E18115
     C                     ELSE                                           E18115
     C**********           Z-ADD*ZEROS    CNUM                                         E18115 CSD027
     C                     MOVE *BLANKS   CNUM                                                CSD027
     C                     END                                            E18115
     C*                                                                   E27083
     C**If*the*Deliver*To*is*a*Euroclear,CCedel,rorsKassenvereinodepot*** E27083              CSE022
     C**the*depot*reference*is*in*a*fixed*position*********************** E27083              CSE022
      *                                                                                       CSE022
      ** If the Deliver To is a Euroclear or Cedel depot, the depot                           CSE022
      ** reference is in a fixed position.                                                    CSE022
      *                                                                                       CSE022
     C*                                                                   E27083
     C           C1DI      IFEQ 'E'                                       E27083
     C                     Z-ADD1         V                               E27083
     C                     SETON                     29                   E27083
     C                     ELSE                                           E27083
     C           C1DI      IFEQ 'C'                                       E27083
     C                     Z-ADD2         V                               E27083
     C                     SETON                     29                   E27083
     C                     ELSE                                           E27083
     C********** C1DI      IFEQ 'K'                                       E27083              CSE022
     C**********           Z-ADD3         V                               E27083              CSE022
     C**********           SETON                     29                   E27083              CSE022
     C**********           ELSE                                           E27083              CSE022
     C**********                                                          E18115              CSE022
     C**USE*THE*DELIVER*FROM*FIELD*TO*CHECK*THAT*THERE*IS*AN*EQUIVALENT** E18115              CSE022
     C**DEPOT*REF.*ON*TABTB36,*IF*SO*AND*DISCRETIONARY*IND,=*M,*MOVE*THE* E18115              CSE022
     C**CORRESPONDING*DEPOT.*REF.*FROM*CLINTSE*TO*OUTPUT*FIELD*********** E18115              CSE022
      *                                                                                       CSE022
      ** Use the DELIVER FROM FIELD to check if there is an equivalent                        CSE022
      ** Depot Reference on TABTB36.  If so and Market Indicator is not                       CSE022
      ** equal to 'G', move the corresponding Depot Reference from                            CSE022
      ** CLINTSE to Output Field. However if CSE022 is installed, use                         CSE022
      ** program SEDORFRTV for the Output Field.                                              CSE022
      *                                                                                       CSE022
     C*                                                                   E18115
     C                     MOVE DELF      DELFA                           087837
     C                     Z-ADD1         V                               E18115
     C           DELFA     LOKUPARR36,V                  29               E18115
     C**********           END                                            E27083              CSE022
     C                     END                                            E27083
     C                     END                                            E27083
      *                                                                                       CSE022
     C           CSE022    IFEQ 'N'                                                           CSE022
      *                                                                                       CSE022
     C           *IN29     IFEQ '1'                                       E18115
     C           TDMI      ANDNE'G'                                       E32540
     C                     MOVEAARRSE,V   LIN33D                          E18115
     C                     MOVE 'VIA'     LIN33C                          E18115
     C                     END                                            E18115
      *                                                                                       CSE022
     C                     ELSE                                                               CSE022
     C                     MOVEL'SEDOR'   WPGM    9                                           CSE022
     C                     MOVE 'FRTV'    WPGM                                                CSE022
     C                     MOVELDELFA     PDEPOT                                              CSE022
     C                     MOVELCNUM      PCNUM                                               CSE022
      *                                                                                       CSE022
     C                     CALL WPGM                                                          CSE022
     C                     PARM *BLANKS   PRTRN  10                                           CSE022
     C                     PARM           PDEPOT  6                                           CSE022
     C                     PARM           PCNUM   6                                           CSE022
     C                     PARM *BLANKS   PSKALR 20                                           CSE022
      *                                                                                       CSE022
     C                     MOVELPSKALR    LIN33D                                              CSE022
     C                     MOVE 'VIA'     LIN33C                                              CSE022
     C                     ENDIF                                                              CSE022
     C*                                                                   E18115
     C                     END
     C                     END
     C*                                                                   S01408
     C** Core hook for externalisation; end of subroutine INSTR.          S01408
     C/COPY WNCPYSRC,SE0550CPDR                                           S01408
     C*
     C*  END SUBROUTINE
     C*
     C           EINSTR    TAG
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  ISSUER - SUBROUTINE TO OUTPUT ISSUER CONFIRMATIONS IF THE    *
     C*           TRADE IS DEALING WITH SCHULDSCHEIN                  *
     C*                                                               *
     C*****************************************************************
     C*
     C           ISSUER    BEGSR                           *** ISSUER ***
     C*
     C                     MOVE *BLANKS   LN27
     C*
     C*  IF THE TRADE TYPE IS = TP SET ON *IN81 THAT CONDITIONS TWO
     C*  LINES ON THE PRINT OUT, SO THE CORRECT LINE IS PRINTED.
     C*
     C           TDTP      COMP 'TP'                     81
     C*
     C*  COVERT THE VALUE DATE FROM MIDAS DAY NO. FORMAT TO DDMMMYY VIA
     C*  SR ZDATE2
     C*
     C                     MOVE TDVD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    ODATE3  7
     C  N81                MOVE ODATE3    ODAT3   7
     C/COPY WNCPYSRC,SE0550C044
     C*
     C*  EDIT THE COUPON RATE FIELD FROM THE TRADES FILE VIA ZSEDIT, NO
     C*  NO COMMAS 7 DEC PL.  ASTERISK FILL THE FIELD AS WELL
     C*
     C                     Z-ADD0         ZFLD15
     C                     MOVE TDCR      ZFLD15
     C                     Z-ADD7         ZDECS
     C                     MOVE 'L'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    TEMP5  13
     C                     MOVE *BLANKS   ARRB
     C                     MOVEATEMP5     ARRB
     C                     EXSR STAR
     C                     MOVEAARRB      COUPRT 13
     C*
     C*  CONVERT THE ISSUE DATE TO DDMMMYY VIA ZDATE2, MOVE THE RESULTING
     C*  FIELD TO AN OUTPUT FIELD FOR PRINTING. NOW CONVERT  MATURITY DATE
     C*  TO DDMMMYY FORMAT.
     C*
     C                     MOVE ISSD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    ODATE4  7
     C                     MOVE MATY      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    ODATE5  7
     C/COPY WNCPYSRC,SE0550C045
     C*
     C*  IF THE TRADE TYPE IS = TP, SET UP LITERALS FOR THE LINES 23,
     C*  24, 26.
     C*
     C           TDTP      IFEQ 'TP'
     C                     MOVE 'FROM'    LN23A   4
     C                     MOVE 'PURCHASE'LN24B   8
     C                     MOVEAARRA,33   LN26B  58
     C                     ELSE
     C*
     C*  IF THE TRADE TYPE = TS, SET UP THE LITERALS FOR LINES 23, 24
     C*  26.
     C*
     C                     MOVE '  TO'    LN23A
     C                     MOVEL'SALE    'LN24B
     C                     MOVEAARRA,34   LN26B
     C                     END
     C*
     C*  USE THE COUNTER PARTY NUMBER TO GET THE CUSTOMER NAME AND TOWN
     C*  FROM THE CLINTCB FILE.
     C*
     C                     MOVE TCNR      CLINNO
     C                     EXSR CB
     C*
     C*  IF ERROR HAS OCCURRED, DO STD DB ERROR
     C*
     C           *INU7     IFEQ '1'                        ***************
     C                     Z-ADD39        DBASE            * DB ERROR 39 *
     C                     OUT  LDA                        ***************S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO EISSUE                     ***************
     C                     END
     C                     MOVE CRNM      LN23B  20
     C                     MOVE CTWN      LN23C  10
     C*
     C***IF*THE*SETTLEM.*METH.*=*01*OR*05*OR*06*OR*07*OR*08,*CHECK*THE**  E16473
     C*  IF THE SETTLEM. METH. = 01 OR 02 OR 07 OR 08 OR 12, CHECK THE    E16473
     C*  TRADE TYPE AND PAY FROM AND PAY TO FIELDS, FOR TP, TS AND
     C*  BLANKS. IF CONDITIONS MET OUTPUT MESSAGE, ELSE CHAIN TO THE
     C*  NOSTRO FILE FOR CUSTOMER NAME AND TOWN.
     C*
     C           SMTH      IFEQ 01
     C***********SMTH      OREQ 05                                        E16473
     C***********SMTH      OREQ 06                                        E16473
     C           SMTH      OREQ 02                                        E16473
     C           SMTH      OREQ 07
     C           SMTH      OREQ 08
     C           SMTH      OREQ 12                                        E16473
     C*
     C*  IF TRADE TYPE = TP
     C*
     C           TDTP      IFEQ 'TP'
     C           PYFM      ANDEQ*BLANKS
     C           TDTP      OREQ 'TS'
     C           PAYT      ANDEQ*BLANKS
     C                     MOVEAARRA,18   LN27   31
     C                     ELSE
     C*
     C*  CHAIN TO NOSTRO FILE USING DATA FROM PAY FROM FIELD AND THE
     C*  SETTLEMENT CCY.
     C*
     C                     MOVEL'70'      KEYF
     C                     MOVELSETC      KEYTMP  5
     C           TDTP      IFEQ 'TP'
     C                     MOVE NOSTR2    KEYTMP
     C                     ELSE
     C                     MOVE NOSTR     KEYTMP
     C                     END
     C                     MOVE KEYTMP    KEYF
     C                     EXSR TL
     C*
     C*  IF ERROR LEAVE SUBROUTINE.
     C*
     C           *INU7     IFEQ '1'                        ***************
     C                     Z-ADD40        DBASE            * DB ERROR 40 *
     C                     OUT  LDA                        ***************S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO EISSUE                     ***************
     C                     END
     C                     MOVE CNUM      CLINNO
     C*
     C*  USE THE CUSTOMER NUMBER TO CHAIN TO THE CB FILE TO GET THE
     C*  CUSTOMER NAME AND TOWN. IF ERROR DROP OUT.
     C*
     C                     EXSR CB
     C           *INU7     IFEQ '1'                        ***************
     C                     Z-ADD41        DBASE            * DB ERROR 41 *
     C                     OUT  LDA                        ***************S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO EISSUE                     ***************
     C                     END
     C                     MOVELCRNM      LN27
     C                     MOVE CTWN      LN27
     C                     END
     C                     ELSE
     C*
     C* IF ANY OTHER SETTLEMENT METHOD OTHER THAN ABOVE, OUTPUT MESSAGE
     C*
     C                     MOVEAARRA,18   LN27   31
     C                     END
     C*
     C*  IF TRADE TYPE = TS, OUTPUT MESSAGE ABOUT FUTURE PAYMENTS. NO NEED
     C*  TO CHAIN TO CLINTCC  FILE TO GET THE NEW OWNERS NAME AND ADDRESS AS
     C*  ALREADY DONE IN SR PRINT. *IN81 CONDITIONS PRINTOUT.
     C*
     C           *IN81     IFEQ '0'
     C                     MOVEAARRA,35   LN29   51
     C                     MOVE CNA1      LN30   35
     C                     MOVE CNA2      LN31   35
     C                     MOVE CNA3      LN32   35
     C                     MOVE CNA4      LN33   35
     C                     ELSE
     C                     MOVE *BLANKS   LN29
     C                     MOVE *BLANKS   LN30
     C                     MOVE *BLANKS   LN31
     C                     MOVE *BLANKS   LN32
     C                     MOVE *BLANKS   LN33
     C                     END
     C*
     C*  CHAIN TO THE CLINTCC FILE FOR THE ISSUERS NAME AND ADDRESS
     C*  IF ERROR LEAVE SUBROUTINE
     C*
     C                     MOVE *BLANKS   CNA1
     C                     MOVE *BLANKS   CNA2
     C                     MOVE *BLANKS   CNA3
     C                     MOVE *BLANKS   CNA4
     C********** ISSR      IFNE *ZEROS                                                        CSD027
     C           ISSR      IFNE *BLANKS                                                       CSD027
     C                     MOVE ISSR      CLINNO
     C**********           EXSR CC                                        127566
     C                     EXSR CC0                                       127566
     C           *INU7     IFEQ '1'                        ***************
     C                     Z-ADD42        DBASE            * DB ERROR 42 *
     C                     OUT  LDA                        ***************S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO EISSUE                     ***************
     C                     END
     C*
     C                     ELSE
     C**********           Z-ADD*ZEROS    CNUM                                                CSD027
     C                     MOVE *BLANKS   CNUM                                                CSD027
     C                     END
      *                                                                   S01401
      ***  If S.W.I.F.T. confirmation message generated = 'Y' then        S01401
      ***  Output 'AUTO TRANSMISSION - DO NOT SEND'.                      S01401
      *                                                                   S01401
     C                     MOVE *OFF      *IN02                           S01401
     C           S01401    IFEQ 'Y'                                       S01401
     C           TDRF      CHAINTRADSDY1             03                   S01401
     C           *IN03     IFEQ *OFF                                      S01401
     C           T1GMEC    ANDEQ'Y'                                       S01401
     C                     MOVE *ON       *IN02                           S01401
     C                     ENDIF                                          S01401
     C                     ENDIF                                          S01401
     C*
     C*  WRITE DATA TO THE OUTPUT FILE
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0550CPD4                                           S01408
     C*                                                                   S01408
     C                     WRITEISSUERF
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0550CPD5                                           S01408
     C*                                                                   S01408
     C*
     C*  END SUBROUTINE
     C*
     C           EISSUE    TAG
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  DAYSAC - SUBROUTINE TO CALCULATE THE NUMBER OF DAYS OF       *
     C*           ACCRUED INTEREST                                    *
     C*                                                               *
     C*****************************************************************
     C*
     C           DAYSAC    BEGSR                           *** DAYSAC ***
     C*
     C* IF TRADE IS A CUM-COUPON TRADE,DETERMINE THE START AND END DATES FOR
     C* CALCULATING THE NUMBER OF DAYS.
     C*
     C           ACIN      IFEQ 'C'
     C********** LCPN      IFLT TDVD                                      E20125
     C********** LCPN      ANDNE0                                         E20125
     C**********           Z-ADDLCPN      ZSDATE                          E20125
     C**********           ELSE                                           E20125
     C********** TDVD      IFLT FCPN                                      E20125
     C********** LCPN      OREQ 0                                         E20125
     C**********           Z-ADDITLD      ZSDATE                          E20125
     C**********           END                                            E20125
     C**********           END                                            E20125
     C********** TDVD      IFGT NCD                                S01158 E20125
     C**********           Z-ADDNCD       ZSDATE                   S01158 E20125
     C**********           END                                     S01158 E20125
     C*
     C*                                                                   E20125
     C*    GET START DATE OF INTEREST BY OBTAINING THE LAST COUPON        E20125
     C*    DATE BEFORE THE VALUE DATE OF THE TRADE                        E20125
      *                                                                   E20125
     C                     Z-ADDECD       ZECD                            E20125
     C                     EXSR ZLCD                                      E20125
     C                     Z-ADDZZLCD     ZSDATE                          E20125
     C*                                                                   E20125
     C                     Z-ADDTDVD      ZEDATE
     C                     END
     C*
     C* IF TRADE IS AN EX-COUPON TRADE, SET THE START DATE TO VALUE DATE OF
     C* TRADE AND END DATE TO NEXT COUPON DATE.
     C*
     C           ACIN      IFEQ 'X'
     C                     Z-ADDTDVD      ZSDATE
     C                     Z-ADDNCD       ZEDATE
     C                     END
     C*
     C* CALCULATE THE NUMBER OF DAYS OF ACCRUED INTEREST.
     C*
     C                     EXSR ZDAYS
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* UPDATE - SUBROUTINE TO UPDATE CONFIRMATION REQUIRED FIELD AND *
     C*          MESSAGE INDICATOR OF THE RECORD ON THE TRADES FILE   *
     C*                                                               *
     C*****************************************************************
     C*
     C           UPDATE    BEGSR                           *** UPDATE ***
     C*
     C                     MOVE 'N'       TCFR
     C                     BITON'0'       TMSI
     C*
     C*  UPDATE FILE
     C*
     C                     EXCPTTRDREC
     C                     COMIT                                                              CGP001
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  AUDIT  - SUBROUTINE TO OUTPUT AUDIT REPORT ONLY WHEN A DB    *
     C*           ERROR HAS OCCURRED IN THE PROCESSING OF A RECORD    *
     C*                                                               *
     C*****************************************************************
     C*
     C           AUDIT     BEGSR                           *** AUDIT  ***
     C***********                                                         E29170
     C************IN61     IFEQ '0'                                       E29170
     C***********          OPEN SE0550P1                                  E29170
     C***********          END                                            E29170
     C*
     C                     WRITEHEADAU
     C*
     C                     WRITEERROR
     C*                                                                   E29170
     C** RCF Processing for Audit File                                    E29170
     C*                                                                   E29170
     C                     EXSR RCFAU                                     E29170
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*   STAR  - PUTS AN ASTERISK IN EVERY ZERO SUPRESSED POSITION   *
     C*           OF THE OUTPUT NUMERIC FIELDS AFTER EDITTING BY      *
     C*           ZSEDIT.                                             *
     C*                                                               *
     C*****************************************************************
     C*
     C           STAR      BEGSR                           ***  STAR  ***
     C*
     C                     Z-ADD1         Y       20
     C                     SETON                     71
     C           *IN71     DOUEQ'0'
     C           Y         OREQ 21
     C           ARRB,Y    COMP *BLANK                   71
     C   71                MOVEA'*'       ARRB,Y
     C                     ADD  1         Y
     C                     END
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* TRDSR  - SUBROUTINE FOR ERROR HANDLING OF TRADE CONFIRMATIONS *
     C*                                                               *
     C*****************************************************************
     C*
     C           TRDSR     BEGSR                           *** TRDSR  ***
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TRDCO'   DBFILE
     C                     MOVELTRDKEY    DBKEY            ***************
     C                     Z-ADD43        DBASE            * DB ERROR 43 *
     C                     MOVE TRDSTS    DBSTAT  5        ***************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     MOVE '1'       *IN97
     C                     SETON                     99U7U8
     C                     GOTO EAUDIT
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /SPACE 3
     C*****************************************************************
     C*                                                               *
     C*  CB   - THIS SMALL SUBROUTINE CHAINS TO CLINTCB AND REPORTS   *
     C*         ANY DB ERRORS.                                        *
     C*                                                               *
     C*****************************************************************
     C*
     C           CB        BEGSR                           ***   CB   ***
     C*
     C                     MOVE *BLANKS   CRNM                                                CSD027
     C                     MOVE *BLANKS   CTWN                                                CSD027
     C                     MOVE *BLANKS   CNUM                                                CSD027
      *                                                                                       CSD027
     C********** CLINNO    IFNE 0                                                             CSD027
     C           CLINNO    IFNE *BLANKS                                                       CSD027
     C           CLINNO    CHAINCLINTCBF             41
     C           *IN41     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     SETON                     41                                       CSD027
     C                     END                                                                CSD027
      ***********                                                                             CSD027
     C************LOCK     IN   LDA                                       S01117              CSD027
     C************         MOVE '1'       *INU7                                               CSD027
     C***********          MOVE '1'       *INU8                                               CSD027
     C***********          MOVE 'CLINT'   DBFILE                                              CSD027
     C***********          MOVELCLINNO    DBKEY                                               CSD027
     C***********          END                                                                CSD027
     C**********           MOVE *ZEROS    CLINNO                                              CSD027
     C                     MOVE *BLANKS   CLINNO                                              CSD027
     C                     ELSE
     C                     MOVE *BLANK    CRNM
     C                     MOVE *BLANK    CTWN
     C**********           Z-ADD*ZEROS    CNUM                                                CSD027
     C                     MOVE *BLANKS   CNUM                                                CSD027
     C                     END
     C*
     C/COPY WNCPYSRC,SE0550C057
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C***CC***-*THIS*SMALL*SUBROUTINE*CHAINS*TO*CLINTCC*AND*REPORTS   *   127566
     C*  CC0  - THIS SMALL SUBROUTINE CHAINS TO CLINTCC AND REPORTS   *   127566
     C*         ANY DB ERRORS.                                        *
     C*                                                               *
     C*****************************************************************
     C*
     C********** CC        BEGSR                           ***   CC   *** 127566
     C           CC0       BEGSR                           ***   CC0  *** 127566
     C*
     C           CLINNO    CHAINCLINTCCF             41
     C           *IN41     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'CLINT'   DBFILE
     C                     MOVELCLINNO    DBKEY
     C                     END
     C**********           MOVE *ZEROS    CLINNO                                              CSD027
     C                     MOVE *BLANKS   CLINNO                                              CSD027
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT                                                              E43703
     C*****************************************************************   E43703
     C**                                                              *   E43703
     C** CC1          This small subroutine chains to CLINTCC and     *   E43703
     C**              reports any DB errors (for alternate address    *   E43703
     C**              if present)                                     *   E43703
     C**                                                              *   E43703
     C** Fields used  CLINNO  (6,0)  Customer number                  *   E43703
     C**              C1AN    (1A)   Record type                      *   E43703
     C**                                                              *   E43703
     C** Called by    PRINT                                           *   E43703
     C***Calls********CC                                           E43703 127566
     C** Calls        CC0                                             *   127566
     C**                                                              *   E43703
     C*****************************************************************   E43703
     C*                                                                   E43703
     C           CC1       BEGSR                           ***   CC1  *** E43703
     C*                                                                   E43703
     C           KEYALT    KLIST                                          E43703
     C                     KFLD           CLINNO                          E43703
     C                     KFLD           C1AN                            E43703
     C           KEYALT    CHAINCLINT                41                   E43703
     C*                                                                   E43703
     C**  If not found or deleted use 'B' address                         E43703
     C*                                                                   E43703
     C           *IN41     IFEQ '1'                                       E43703
     C           RECI      ORNE 'D'                                       E43703
     C                     MOVE '0'       *IN41                           E43703
     C**********           EXSR CC                                 E43703 127566
     C                     EXSR CC0                                       127566
     C                     END                                            E43703
     C*                                                                   E43703
     C                     ENDSR                                          E43703
     C*                                                                   E43703
     C*****************************************************************   E43703
      /SPACE 3
     C*****************************************************************
     C*                                                               *
     C*  SE   - THIS SMALL SUBROUTINE CHAINS TO CLINTSE AND REPORTS   *
     C*         ANY DB ERRORS.                                        *
     C*                                                               *
     C*****************************************************************
     C*
     C           SE        BEGSR                           ***   SE   ***
     C*
     C           CLINNO    CHAINCLINTSEF             41
     C           *IN41     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'CLINT'   DBFILE
     C                     MOVELCLINNO    DBKEY
     C                     OUT  LDA                                       E37016
     C                     END
     C**********           MOVE *ZEROS    CLINNO                                              CSD027
     C                     MOVE *BLANKS   CLINNO                                              CSD027
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /SPACE 3
     C*****************************************************************
     C*                                                               *
     C*  TR - THIS SMALL SUBROUTINE CHAINS TO TABLETR AND REPORTS ANY *
     C*       DB ERRORS.                                              *
     C*                                                               *
     C*****************************************************************
     C*
     C           TR        BEGSR                           ***   TR   ***
     C*
      *                                                                                     BUG10347
     C                     CALL 'AOBRCHR1'                                                  BUG10347
     C                     PARM *BLANKS   PRTCD                                             BUG10347
     C                     PARM '*KEY   ' POPTN                                             BUG10347
     C                     PARM TDBA      PBRCH   3                                         BUG10347
     C           SDBRCH    PARM SDBRCH    DSSDY                                             BUG10347
      *                                                                                     BUG10347
     C           PRTCD     IFNE *BLANKS                                                     BUG10347
     C           *LOCK     IN   LDA                                                         BUG10347
     C                     MOVE *ON       *INU7                                             BUG10347
     C                     MOVE *ON       *INU8                                             BUG10347
     C                     MOVE 'SDBRCHPD'DBFILE                                            BUG10347
     C                     MOVELKEYF      DBKEY                                             BUG10347
     C                     ELSE                                                             245736
     C                     MOVE A8BRNM    BRNM                                              245736
     C                     ENDIF                                                            BUG10347
      *                                                                                     BUG10347
     C********** KEYF      CHAINTABLETRF             41                                     BUG10347
     C********** *IN41     IFEQ '1'                                                         BUG10347
     C********** RECI      ORNE 'D'                                                         BUG10347
     C********** *LOCK     IN   LDA                                                  S01117 BUG10347
     C**********           MOVE '1'       *INU7                                             BUG10347
     C**********           MOVE '1'       *INU8                                             BUG10347
     C**********           MOVE 'TABLE'   DBFILE                                            BUG10347
     C**********           MOVELKEYF      DBKEY                                             BUG10347
     C**********           END                                                              BUG10347
     C                     MOVE *BLANKS   KEYF
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /SPACE 3
     C*****************************************************************
     C*                                                               *
     C*  TL - THIS SMALL SUBROUTINE CHAINS TO TABLETL AND REPORTS ANY *
     C*         DB ERRORS.                                            *
     C*                                                               *
     C*****************************************************************
     C*
     C           TL        BEGSR                           ***   TL   ***
     C*
     C           KEYF      CHAINTABLETLF             41
     C           *IN41     IFEQ '1'
     C           RECI      ORNE 'D'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE 'TABLE'   DBFILE
     C                     MOVELKEYF      DBKEY
     C                     END
     C                     MOVE *BLANKS   KEYF
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /SPACE 3
     C*****************************************************************
     C*                                                               *
     C*  T2 - THIS SMALL SUBROUTINE CHAINS TO TABLET2 AND REPORTS ANY *
     C*       DB ERRORS.                                              *
     C*                                                               *
     C*****************************************************************
     C*
     C           T2        BEGSR                           ***   T2   ***
     C*
     C                     MOVEL'71'      T2KEY
     C           T2KEY     CHAINTABLET2F             41
     C           *IN41     IFEQ '1'
     C           RECI      ORNE 'D'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE 'TABLE'   DBFILE
     C                     MOVELT2KEY     DBKEY
     C                     END
     C                     MOVE *BLANKS   T2KEY
     C*
     C                     ENDSR
     C*
      *****************************************************************   S01117
      /EJECT                                                              S01117
      *****************************************************************   CSE006
      *                                                               *   CSE006
      * SRBOOK - ACCESS BOOK DETAILS FOR A TRADE                      *   CSE006
      *                                                               *   CSE006
      *****************************************************************   CSE006
     C           SRBOOK    BEGSR                                          CSE006
      *                                                                   CSE006
      ** If CAC005 is installed need to convert pseudo book to user       CSE006
      ** book prior to call to AOBOOKR0.                                  CSE006
     C           CAC005    IFEQ 'Y'                                       CSE006
      *                                                                   CSE006
     C           TDBK      CHAINSDBKPCL3             89                   CSE006
      *                                                                   CSE006
      ** Handle Database Error                                            CSE006
     C           *IN89     IFNE *OFF                                      CSE006
     C                     MOVE '1'       *INU7                           CSE006
     C                     MOVE '1'       *INU8                           CSE006
     C           *LOCK     IN   LDA                                       CSE006
     C                     MOVE 'SDBKPCL3'DBFILE           ***************CSE006
     C                     MOVELTDBK      DBKEY            * DB ERROR 68 *CSE006
     C                     Z-ADD68        DBASE            ***************CSE006
     C                     OUT  LDA                                       CSE006
     C                     EXSR *PSSR                                     CSE006
      *                                                                   CSE006
     C                     ELSE                                           CSE006
     C                     MOVE PSBKCD    PBKCD                           CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     ELSE                                           CSE006
     C                     MOVE TDBK      PBKCD                           CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      **  Access Midas book details ICD                                   CSE006
      *                                                                   CSE006
     C                     CALL 'AOBOOKR0'                                CSE006
     C                     PARM *BLANKS   PRTCD                           CSE006
     C                     PARM '*KEY   ' POPTN                           CSE006
     C                     PARM           PBKCD   2                       CSE006
     C           SDBOOK    PARM SDBOOK    DSFDY                           CSE006
      *                                                                   CSE006
     C           PRTCD     IFNE *BLANKS                                   CSE006
     C           *LOCK     IN   LDA                                       CSE006
     C                     MOVE '56'      DBASE             ************  CSE006
     C                     MOVE 'SDBOOKPD'DBFILE            * DATABASE *  CSE006
     C                     MOVELTDBK      DBKEY             * ERROR 56 *  CSE006
     C                     SETON                     U7U8LR ************  CSE006
      *                                                                   CSE006
     C                     WRITEHEADAU                                    CSE006
     C                     WRITEERROR                                     CSE006
      *                                                                   CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     ENDSR                                          CSE006
      *****************************************************************   CSE006
      /EJECT                                                              CSE006
      *****************************************************************   S01117
      *                                                               *   S01117
      *  *PSSR  - Error control subroutine                            *   S01117
      *                                                               *   S01117
      *****************************************************************   S01117
      *                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR **    S01117
     C**                                                                  S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     ENDSR                                          S01117
      *                                                                   S01117
     C*****************************************************************
     C/EJECT                                                              E29170
     C********************************************************************E29170
     C*                                                                   E29170
     C*  RCFP1 -- SUBROUTINE TO REGISTER P1 PRINTER FILE VIA RCF          E29170
     C*                                                                   E29170
     C********************************************************************E29170
     C*                                                                   E29170
     C           RCFP1     BEGSR                            ** RCFP1 **   E29170
     C*                                                                   E29170
     C**      ENSURE REPORT SPOOL FILE RECORDED BY RCF                    E29170
     C*                                                                   E29170
     C                     Z-ADDSFNUM     ZSNUM   60                      E29170
     C**                                                                  E29170
     C                     CALL 'ZSFILE'                                  E29170
     C                     PARM           SEQ     5                       E29170
     C                     PARM TDBA      SENTY   3                       E29170
     C                     PARM           SFILE                           E29170
     C                     PARM           ZSNUM                           E29170
     C                     PARM           ZSERR   1                       E29170
     C*                                                                   E29170
     C           ZSERR     IFEQ 'Y'                                       E29170
     C*                                                                   E29170
     C**  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       E29170
     C*                                                                   E29170
     C                     SETON                     U7U8LR               E29170
     C                     RETRN                                          E29170
     C                     END                                            E29170
     C/COPY WNCPYSRC,SE0550C040
     C*                                                                   E29170
     C                     ENDSR                                          E29170
     C*                                                                   E29170
     C********************************************************************E29170
     C/EJECT                                                              E29170
     C********************************************************************E29170
     C*                                                                   E29170
     C*  RCFAU -- SUBROUTINE TO REGISTER AU PRINTER FILE VIA RCF          E29170
     C*                                                                   E29170
     C********************************************************************E29170
     C*                                                                   E29170
     C           RCFAU     BEGSR                            ** RCFAU **   E29170
     C*                                                                   E29170
     C**      ENSURE AUDIT SPOOL FILE RECORDED BY RCF                     E29170
     C*                                                                   E29170
     C                     Z-ADDSFNUMU    ZSNUMU  60                      E29170
     C**                                                                  E29170
     C                     CALL 'ZSFILE'                                  E29170
     C                     PARM           SEQ                             E29170
     C                     PARM *BLANKS   SENTY                           E29170
     C                     PARM           SFILEU                          E29170
     C                     PARM           ZSNUMU                          E29170
     C                     PARM *BLANK    ZSERR                           E29170
     C*                                                                   E29170
     C           ZSERR     IFEQ 'Y'                                       E29170
     C*                                                                   E29170
     C**  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       E29170
     C*                                                                   E29170
     C                     SETON                     U7U8LR               E29170
     C                     RETRN                                          E29170
     C                     END                                            E29170
     C*                                                                   E29170
     C                     ENDSR                                          E29170
     C*                                                                   E29170
     C*****************************************************************   E29170
     C/COPY WNCPYSRC,SE0550C029
      /EJECT
     C/COPY ZSRSRC,ZCONVZ1
     C/COPY WNCPYSRC,SE0550C030
      /EJECT
     C/COPY ZSRSRC,ZDATE1Z2
      /EJECT                                                              S01169
     C/COPY ZSRSRC,ZDATE2Z2                                               S01169
      ***/EJECT******************                                         S01169
     C***/COPY*ZSRSRC,ZDATE2Z4***                                         S01169
      /EJECT
     C/COPY ZSRSRC,ZDAYSZ2
      /EJECT
     C/COPY ZSRSRC,ZDYYRZ3
      ***/EJECT*****************                                          E19886
     C***/COPY*ZSRSRC,ZEVCDZ1***                                          E19886
      /EJECT
     C/COPY ZSRSRC,ZICD2Z1
      /EJECT
     C/COPY ZSRSRC,ZICDSEZ1
      /EJECT                                                              E20125
     C/COPY ZSRSRC,ZLCDZ1                                                 E20125
      /EJECT
     C/COPY ZSRSRC,ZNCDZ3
      /EJECT
     C/COPY ZSRSRC,ZSDESCZ3
      /EJECT
     C/COPY ZSRSRC,ZSEDITZ3
      /EJECT
     C/COPY ZSRSRC,ZSYSTMZ1
     O/EJECT
     OTRADSDF E                TRDREC
     O                         TCFR
     O                         TMSI
      /EJECT
     O/COPY WNCPYSRC,SE0550O001
      ***
      ***  ARRA Array entry A.I.B.D. changed to I.S.M.A.                  E43208
**  CPY@
(c) Finastra International Limited 2001
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
0006001521029820444305904073650882610287117481320914670161311759219053
2051421975234362489726358278192928030741322023366335124365853804639507
40968424294389045351
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** ARRA
AMENDMENT TO
CANCELLATION OF
ON IF, AS AND WHEN BASIS
ON PRIMARY MARKET TERMS
FOR PAYMENT AGAINST DELIVERY
FOR DELIVERY AGAINST PAYMENT
FOR PAYMENT AFTER DELIVERY
FOR FREE DELIVERY
FOR DELIVERY AFTER PAYMENT
WE AWAIT YOUR REMITTANCE
WE WILL SEND REMITTANCE
DEBIT TO A/C NUMBER
CREDIT TO A/C NUMBER
AS PER OUR INSTRUCTIONS
AS PER YOUR INSTRUCTIONS
WE WILL COLLECT REMITTANCE
YOU WILL COLLECT REMITTANCE
INSTRUCTIONS TO BE ADVISED
WE AWAIT YOUR ADVICE
OURSELVES
**INCOMPLETE**
PAYMENT AT VALUE DATE FROM
PAYMENT AT VALUE DATE
PAYMENT AT VALUE DATE FROM YOUR A/C WITH                                  092968
DELIVER FROM
DELIVER TO
PAYMENT TO
PAYMENT BY
FOR A/C OF                                                          S01175092968
SPECIAL INSTRUCTIONS
THIS TRADE IS IN ACCORDANCE
WITH I.S.M.A. RULES
INTEREST DUE TO
THE ABOVE INTEREST AT NEXT INTEREST DATE TO OUR ACCOUNT AT
PLEASE CREDIT ALL FUTURE PAYMENTS TO THE NEW OWNER:
NEXT COUPON
FOR DELIVERY AGAINST PAYMENT G'TEED
THIS TRADE IS IN ACCORDANCE
WITH I.P.M.A. RULES
FOR A/C OF                                                          S01175092968
PAYMENT AT VALUE DATE FROM YOUR A/C                                 E17174092968
** POWER8
00000001
00000010
00000100
00001000
00010000
00100000
01000000
10000000
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
     X/COPY WNCPYSRC,SE0550X001
