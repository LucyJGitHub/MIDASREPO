     H        1                                                           SE0580
      *****************************************************************
/*S*D****RPGBASE*******************************************************                       CSD053
/*STD *  RPGBNOCVT                                                    *                       CSD053
/*EXS *  RPGCVTOPT1                                                   *                       CSD053
/*EXI *  TEXT('Midas SE Position settlement confirmations')
      *****************************************************************
      *                                                               *
      *  Midas - Securities Trading Module                            *
      *                                                               *
      *  SE0580  - POSITION SETTLEMENT CONFIRMATIONS                  *
      *                                                               *
      *  Function: To print a confirmation for all Position           *
      *   (COB)    Settlements that have been authorised for          *
      *            Portfolio Customers.                               *
      *                                                               *
      *  Called by: SEC0604B - Position Settlement Confirmations      *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *  Prev Amend No. CRE026             Date 24May06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD053             Date 01Jun06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 234881             Date 14Oct05               *
      *                 235035             Date 25Aug05               *
      *                 CGL031             Date 05Jul04               *
      *                 CSE071             Date 19Jul05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 208241             Date 17Jan03               *
      * Midas Release 4.01 -------------------------------------------*
      *                 176581             Date 15Jan02               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 174836             Date 30Jun01               *
      *                 127566             Date 09May01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 158880             Date 28Feb01               *
      * Midas DBA 3.03 -----------------------------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CPB001             DATE 18Jun99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CEU017             Date 03Avr98               *
      *                 CSE007             Date 04FEB97               *
      *                 076424             DATE 24JUL96               *
      *                 035443             DATE 07MAY96               *
      *                 093965             DATE 05OCT95               *
      *                 S01408             DATE 21JUL95               *
      *                 089211             DATE 19JUN95               *
      *                 087284             DATE 02JUN95               *
      *                 084174             DATE 02MAR95               *
      *                 S01522             DATE 12JAN95               *
      *                 S01408             DATE 17JAN95               *
      *                 S01496             DATE 10NOV94               *
      *                 S01486             DATE 31OCT94               *
      *                 S01512             DATE 10AUG94               *
      *                 062718             DATE 02NOV93               *
      *                 S01447             DATE 25OCT93               *
      *                 052254             DATE 10JAN94               *
      *                 S01401             DATE 16JUN93               *
      *                 S01397             DATE 10SEP92               *
      *                 AUS004             DATE 17JUN92               *
      *                 E37786             DATE 31MAR92               *
      *                 E29170             DATE 07OCT91               *
      *                 S01117             DATE 13MAY91               *
      *                 S01269             DATE 02AUG90               *
      *                 E15929             DATE 10JAN90               *
      *                 E16772             DATE 31/05/89              *
      *                 E14957             DATE 11/09/88              *
      *                 E14714             DATE 16/08/88              *
      *                 E13911             DATE 28/06/88              *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  MD046248 - Finastra Rebranding                               *
      *  CRE026 - Consumer Banking (Recompile)                        *
      *  CSD053 - Correspondence Manager Multilanguage Upgrade        *
      *         - (Recompile)                                         *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  234881 - No need to condition the display of EU tax with the *
      *           event types. As long as EU tax is non-zero, it will *
      *           still display the amount for CP, MT, DV, MP, and    *
      *           including types for redemptions (RC) and corporate  *
      *           actions.                                            *
      *  235035 - EU tax does not appear on the report. Changed       *
      *           CGL031 to get the tax from POSETD, rather than in   *
      *           SDCSINPD.                                           *
      *  CGL031 - Taxation of Savings Income                          *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits (Recompile)      *
      *  208241 - Recompiled over changed /CPY ZSDESCZ3.              *
      *  176581 - Recompiled over changes in SE0580P1.                *
      *  174836 - First detail line missing for Corporate Action.     *
      *  127566 - Recompiled over changed ZSDESCZ3                    *
      *  158880 - SE amount per unit not always on positon settlement *
      *           confirmation.The value (PSVL) should be used in     *
      *           comparing with the payment date (SDPD) instead of   *
      *           the due date (PDUD) to retrieve the corresponding   *
      *           Amount per Unit (SDVA). Applied fix 107579          *
      *  CPB001 - 'Private Banking' Module                            *
      *  CEU017 - Securities Redenomination Euro Changes              *
      *  CSE007 - Corporate Actions                                   *
      *  076424 - OVERFLOW ERROR WHEN PRINTING COUNTERPARTY           *
      *  035443 - Account sequence not loaded for settlement '4'      *
      *  093965 - S01486 and S01496 did not take into account the     *
      *           change in confirmation size done by AUS004          *
      *  S01408 - Core hook SE0580CCP1 added                          *
      *           Core hook SE0580CCP2 added                          *
      *  089211 - Process all with value date less than next          *
      *           working day                                         *
      *  087284 - Use AOCUSTR0 to retrieve address reference B        *
      *  084174 - Use AOALTNR0 to retrieve alternative addresses      *
      *  S01522 - User Defined Correspondence                         *
      *  S01408 - Addition of core hook SE0580CCPG                    *
      *           Addition of core hook SE0580CPD1                    *
      *           Addition of core hook SE0580CPD2                    *
      *           Addition of core hook SE0580CPD3                    *
      *  S01496 - Incorporation of JYSKE Enhancements (S10978)        *
      *  S01486 - Incorporation of PM Enhancements (S01313)           *
      *           (B7925 and B7268 Included)                          *
      *  S01512 - Add value date to Position Settlements              *
      *  062718 - Recompiled for fix to printer file SE0580P1.        *
      *  S01447 - WITHHOLDING TAX (SE).                               *
      *           Amended to print the Withholding Tax details for    *
      *           CP & DV Position Settlements if they exist, and the *
      *           Withholding Tax feature is switched on.             *
      *  052254 - CURRENT FACTOR amended from 9,8 to 10,9             *
      *  S01401 - MT5xx SWIFT Messages Feature:                       *
      *          - Recompiled due to changes to files.                *
      *  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
      *          - Recompiled due to changes to files.                *
      *  AUS004 - Australian Release - 42 Line Confirmations Standard *
      *           Recompiled over new printer files                   *
      *  E37786 - Branch codes should show in the account             *
      *  E29170 - RCF CHANGES                                         *
      *  S01117 - Multibranching                                      *
      *  S01269 - Trade authorisation: recompiled over changed file   *
      *           TABSE.                                              *
      *  E15929 - Show the partly paid % instead of the amount if the *   E15929
      *           security is % priced.                               *   E15929
      *  E16772 - The Dividend Payment Amount field SDDV has been     *   E16772
      *           replaced by the field SDVA, to increase its size    *   E16772
      *           from 9,4 to 13,8                                    *   E16772
      *  E14957 - PRINTS SETTLEMENT CCY/AMOUNT INSTEAD OF             *   E14957
      *           NOMINAL CCY/AMOUNT DUE                              *   E14957
      *  E14714 - D/B ERROR CAUSED WHEN A DIVIDEND, PARTLY PAID OR    *   E14714
      *           MORTGAGE PAYMENT IS INSERTED.                       *   E14714
      *  E13911 - POST INCORPORATION DEVELOPMENT FIX - DO NOT TRY TO  *   E13911
      *           FIND CP EVENTS ON THE DIARY EVENTS FILE.            *   E13911
      *                                                               *
      *****************************************************************
      *
     FPOSCONF IF  E           K        DISK
     FSEDEV   IF  E           K        DISK
     FSECTY   IF  E           K        DISK
     FSECOATL0IF  E           K        DISK                               CSE007
     F***SDCSINL8IF  E           K        DISK                                         CGL031 235035
     FCLINT   IF  E           K        DISK
     F            CLINTCAF                          KIGNORE
     F            CLINTCCF                          KIGNORE               084174
     F            CLINTC1F                          KIGNORE
     FTABSE   IF  E           K        DISK
     F            TABLETAF                          KIGNORE
     F            TABTE10F                          KIGNORE
     F            TABTE20F                          KIGNORE
     F            TABTG20F                          KIGNORE
     F            TABLETHF                          KIGNORE
     F*********** TABLETJF                          KIGNORE               S01117
     F            TABLETKF                          KIGNORE
     F            TABLETNF                          KIGNORE
     F            TABLETPF                          KIGNORE
     F            TABLETXF                          KIGNORE
     F            TABLET3F                          KIGNORE
     F            TABLET5F                          KIGNORE
     FTABTB20 IF  E                    DISK
     F***SE0580P1O***E                    PRINTER                         E29170
     FSE0580P1O   E                    PRINTER                        UC  E29170
     F                                              KINFDS SPOOL          E29170
     FSE0580AUO   E                    PRINTER                            E29170
     F                                              KINFDS SPOOLU         E29170
     F/COPY WNCPYSRC,SE0580F001
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*   F U N C T I O N   O F   I N D I C A T O R S                 *
     F*                                                               *
     F*   10-14   Portfolio ref on report                             *   S01486
      *   19  -   EU Withholding Tax                                  *                       CGL031
     F*   20  -   Event type is 'CP'                                  *
     F*   21  -   Event type is 'DV'                                  *
     F*   22  -   Event type is 'PP'                                  *
     F*   23  -   Event type is 'MP'                                  *
     F*   24  -   Event type is 'MT'                                  *
     F*   76      Event type is 'RC'.                                 *   S01496
     F*                                                               *
     F*   25  -   Settlement a/c is blank                             *
     F*   26  -   Counterparty bank is blank                          *
     F*   27  -   For a/c of is blank                                 *
     F*   28  -   Special instructions is blank                       *
     F*   29  -   Currency for call amount is blank (as amount is %)  *   E15929
     F*   30  -   Withholding Tax switchable feature (S01447).        *   S01447
     F*   31  -   Settlement currency NE nominal currency             *
     F*   35  -   Pay receive indicator is 'P'                        *
     F*   36  -   Pay receive indicator is 'R'                        *
     F*   37  -   MULTIBRANCHING ON                                   *   E29170
     F*   38  -   Valid nostro                                        *   E37786
     F*   39  -   S01512 POSITION SETTLEMENTS                         *   S01512
     F*   40  -   Reversal                                            *   S01496
     F*   41  -   Settlement Type is 0 or blank                       *
     F*   42  -   Settlement Type is 2                                *
     F*   43  -   Settlement Type is 4                                *
     F*   44  -   Settlement Type is 5                                *
     F*   45  -   Settlement Type is 7 or 8                           *
     F*   46  -   Settlement Type is 14                               *
     F*   47  -   Settlement Type is 12                               *
     F*   48  -   Settlement Type is 15                               *
     F*                                                               *
     F*   50  -   File chain fail indicator                           *
     F*                                                               *
     F*   70      Corporate Action Event Type                         *   CSE007
     F*                                                               *
     F*   90  -   End main processing indicator                       *
     F*                                                               *
     F*   U7  -   Data base error                                     *
     F*   U8  -   Data base error/Audit record count difference       *
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*   BAINIT  Initialisation routine                              *
     F*   BBMAIN  Main-line processing                                *
     F*   BCCLOS  Closing routine                                     *
     F*   CINIT   Initialise printer fields                           *
     F*   CONFM   Prepare settlement confirmation details             *
     F*   CONPR   Print settlement confirmations                      *
     F*   FASECT  Access Security file                                *
     F*   *PSSR   Error handling                                      *   S01117
     F*                                                               *
     F*   ZDATE2  Format date print fields                            *
     F*   ZICDSE  Access ICD record 3 for securities trading          *
     F*   ZICD2   Access ICD record 2 for securities trading          *
     F*   ZSDESC  Access Security description                         *
     F*   ZSEDIT  Insert a decimal point and sign into a numeric field*
     F*           and to blank out leading zeros (optionally inserting*
     F*                                                       commas) *
     F*   ZSYSTM  Chain to the installation control data record       *
     F****SREWTX**Retrieve*European*Withholding*Tax********************                CGL031 235035
     F*                                                               *
     F*****************************************************************
      /EJECT
     E/COPY ZSRSRC,ZALIGNZ1
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY ZSRSRC,ZSEDITZ1
     E/COPY ZSRSRC,ZSDESCZ1
     E                    CPY@    1   1 80
     E/COPY WNCPYSRC,SE0580E001
      /EJECT
     I*
     I*LDA********UDS                            256                      S01117
     I*
     I*  Local data area
     I*
     ILDA         DS                            256                       S01117
     I                                      134 183 DBLOT                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     I***********                           134 177 DBLOT                 S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 177 DBASE                 S01117
     I*                                                                   E29170
     I*___________________________________________________________________084174
     I***P#CORR    E DSCGCORRPD                                     084174087284
     I*                                                                   087284
     I* Data structure for returned values from AOALTNR0 --               087284
     I*  alternative names and addresses                                  087284
     I*                                                                   087284
     IP#ALTN    E DSSDALTNPD                                              087284
     I*                                                                   087284
     I* Data structure for returned values from AOALTNR0 --               087284
     I*  alternative names and addresses                                  087284
     I*                                                                   087284
     IP#CUSD    E DSSDCUSTPD                                              087284
     I*                                                                   087284
     I* Data structure for returned values from AOCUSTR0 --               087284
     I*  alternative names and addresses                                  087284
     I*                                                                   087284
     I* 084174                                                            084174
     I*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~084174
     ISDBANK    E DSSDBANKPD                                              089211
      *                                                                   089211
      **  External DS for bank details                                    089211
      *                                                                   089211
     I*                                                                   087284
     IDSSDY     E DSDSSDY                                                 087284
     I*                                                                   087284
     I** Second DS for access programs, Long data structure               087284
     ISPOOL       DS                                                      E29170
     I*                                                                   E29170
     I**  DS FOR SPOOL FILE NAME                                          E29170
     I*                                                                   E29170
     I                                       83  92 SFILE                 E29170
     I                                    B 123 1240SFNUM                 E29170
     I**                                                                  E29170
     ISPOOLU      DS                                                      E29170
     I                                       83  92 SFILEU                E29170
     I                                    B 123 1240SFNUMU                E29170
     IRUNDT       DS                                                      E29170
     I                                        1   7 RUNA                  E29170
     I                                    P   8  100RUND                  E29170
     I                                       11  11 SSF                   E29170
     I                                       12  12 DATF                  E29170
     I                                       13  13 MBIN                  E29170
     I*                                                                   E29170
     I**  DATA STRUCTURE FOR RUN DATE DETAILS                             E29170
     I*                                                                   E29170
     I*
     I*  Date structure used in ZSEDIT routine
     I/COPY ZSRSRC,ZSEDITZ2
     I*
     IPSDS       SDS
     I*
     I*  Program status data structure
     I*
     I                                      244 246 WSID
     I                                      254 263 USRID
     I*
     I            DS
     I*
     I*  Settlement a/c data structure
     I*
     I**********                              1  12 PSEA                                      CGL029
     I                                        1  18 PSEA                                      CGL029
     I                                        1   6 RPSA1
     I**********                              7  10 RPSA2                                     CGL029
     I**********                             11  12 RPSA3                                     CGL029
     I                                        7  16 RPSA2                                     CGL029
     I                                       17  18 RPSA3                                     CGL029
     ICPYR@#      DS
     I*
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I*
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*                                                                   S01486
     I@MMOD     E DSSDMMODPD                                              S01486
     I** Dummy record format for access to Modules File                   S01486
     I*                                                                   S01486
     I@PORT     E DSSDPORTPD                                              S01486
     I** Dummy record format for access to Portfolio Management ICD       S01486
     I*                                                                   S01486
     IDSFDY     E DSDSFDY                                                 S01486
     I** First DS for access programs, short data structure               S01486
     I*                                                                   S01486
     I/COPY ZSRSRC,ZSDESCZ2
     I/COPY WNCPYSRC,SE0580I001
     C/EJECT
      *================================================================
      *  P R O G R A M   S T A R T                                    *
      *================================================================
     C*
     C*  Initialisation routine
     C*
     C                     EXSR BAINIT
     C*
     C*  Mainline processing
     C*
     C                     EXSR BBMAIN
      *
      *================================================================
      *  P R O G R A M   E N D                                        *
      *  Closing routine                                              *
      *                                                               *
     C                     EXSR BCCLOS
      *                                                               *
      *================================================================
      /EJECT
      *****************************************************************
      *                                                               *
      *  BAINIT - Subroutine to perform Initialisation.               *
      *                                                               *
      *****************************************************************
      *
     C           BAINIT    BEGSR                           *** BAINIT ***
     C*
     C* Define key list for file CLINT
     C*
     C           KLCLNT    KLIST
     C                     KFLD           CNUM
     C                     KFLD           RCDT
     C*
     C* Define key list for file POSCONF
     C*
     C           KLPOSC    KLIST
     C                     KFLD           LCD
     C***********          KFLD           PBCH                            S01117
     C                     KFLD           PBCA                            S01117
     C                     KFLD           PSSH
     C                     KFLD           PCPY
     C                     KFLD           PDUD
     C                     KFLD           PEVT
     C*
     C* Define key list for file SEDEV
     C*
     C           KLSEDV    KLIST
     C                     KFLD           SDSN
     C                     KFLD           SDED
     C                     KFLD           SDET
      *                                                                                       CGL031
      * Define key list for file SDCSINL8                                                     CGL031
      *                                                                                       CGL031
     C********** KCSIN8    KLIST                                                       CGL031 235035
     C**********           KFLD           BJRDNB                                       CGL031 235035
     C**********           KFLD           WMODI   1                                    CGL031 235035
     C**********           KFLD           WSESN  10                                    CGL031 235035
      *                                                                                       CGL031
     C/COPY WNCPYSRC,SE0580C001
     C*
     C* Prepare LDA
     C*
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE *BLANKS   DBLOT
     C                     MOVEL'SE0580'  DBPGM
     C                     OUT  LDA                                       S01117
     C*                                                                   E29170
     C** IN THE DATAAREA RUNDAT                                           E29170
     C*                                                                   E29170
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           E29170
     C                     IN   RUNDT                                     E29170
     C*                                                                   E29170
     C**  TEST FOR MULTIBRANCHING                                         E29170
     C*                                                                   E29170
     C           MBIN      IFEQ 'Y'                                       E29170
     C                     SETON                     37                   E29170
     C                     END                                            E29170
     C*
     C* Define fields
     C*
     C************LIKE     DEFN PBCH      SAVBR                           S01117
     C           *LIKE     DEFN PBCA      SAVBR                           S01117
     C           *LIKE     DEFN PSSH      SAVSS
     C           *LIKE     DEFN PCHA      WPCHA
     C           *LIKE     DEFN TASO      WTASO                           S01447
     C           *LIKE     DEFN TAUS      WTAUS                           S01447
     C           *LIKE     DEFN PCAM      WPCAM
     C           *LIKE     DEFN PAMD      WPAMD
     C************LIKE     DEFN PBCH      WPSEB                           S01117
     C           *LIKE     DEFN PBCA      WPSEB                           S01117
     C*                                                                   E29170
     C** RCF Processing for Audit File                                    E29170
     C*                                                                   E29170
     C                     MOVE *BLANKS   PBCASV  3                       E29170
     C                     EXSR RCFAU                                     E29170
     C*
     C* Get Installation Control Data record 1
     C*
     C                     EXSR ZSYSTM
     C*
     C* If error in ZSYSTM, abort program
     C*
     C           *IN99     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVE '01'      DBASE            ***************S01117
     C                     Z-ADD1         DBASE            ***************S01117
     C                     MOVEL'TABLE'   DBFILE           * DB ERROR 01 *
     C                     MOVELZTABKY    DBKEY            ***************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     SETON                     U7U8
     C                     WRITEHEADAU
     C                     WRITEERROR
     C                     ELSE
     C*
     C* Get Installation Control Data record 2
     C*
     C                     EXSR ZICD2
     C*
     C* If error in ZICD2, abort program
     C*
     C           *IN99     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVE '02'      DBASE            ***************S01117
     C                     Z-ADD2         DBASE            ***************S01117
     C                     MOVEL'TABLE'   DBFILE           * DB ERROR 02 *
     C                     MOVELZTABKY    DBKEY            ***************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     SETON                     U7U8
     C                     WRITEHEADAU
     C                     WRITEERROR
     C                     ELSE
     C*
     C* Get Installation Control Data record 3
     C*
     C                     EXSR ZICDSE
     C*
     C* If error in ZICDSE, abort program
     C*
     C           *IN99     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVE '03'      DBASE            ***************S01117
     C                     Z-ADD3         DBASE            ***************S01117
     C                     MOVEL'TABLE'   DBFILE           * DB ERROR 03 *
     C                     MOVELZTABKY    DBKEY            ***************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     SETON                     U7U8
     C                     WRITEHEADAU
     C                     WRITEERROR
     C                     END
     C                     END
     C                     END
     C*
     C*   Get TABTB40 record for Branch print default
     C*
     C                     MOVE *BLANKS   KEY12
     C                     MOVEL'01'      KEY12
     C                     MOVE '40'      KEY12
     C           KEY12     CHAINTABTB40F             50
     C*
     C           *IN50     IFEQ '1'
     C           *IN50     OREQ '0'
     C           RECI      ANDEQ'*'
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVE '04'      DBASE            ***************S01117
     C                     Z-ADD4         DBASE            ***************S01117
     C                     MOVEL'TABLE'   DBFILE           * DB ERROR 04 *
     C                     MOVELKEY12     DBKEY            ***************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     SETON                     U7U8
     C                     WRITEHEADAU
     C                     WRITEERROR
     C                     END
     C*
     C*   Get ICD TABTB20 record
     C*
     C                     MOVE *BLANKS   DBKEY
     C           1         CHAINTABTB20F             50
     C           *IN50     IFEQ '1'
     C           *IN50     OREQ '0'
     C           RECI      ANDEQ'*'
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVE '05'      DBASE            ***************S01117
     C                     Z-ADD5         DBASE            ***************S01117
     C                     MOVEL'TABLE'   DBFILE           * DB ERROR 05 *
     C                     MOVEL'01'      DBKEY            ***************
     C                     MOVE '20'      DBKEY
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     SETON                     U7U8
     C                     WRITEHEADAU
     C                     WRITEERROR
     C                     END
     C**  Access SDMMODPD for Portfolio Management Indicator.             S01486
     C*                                                                   S01486
     C                     CALL 'AOMMODR0'                                S01486
     C                     PARM '*MSG    '@RTCD   7                       S01486
     C                     PARM '*FIRST  '@OPTN   7                       S01486
     C           @MMOD     PARM @MMOD     DSFDY                           S01486
     C*                                                                   S01486
     C           @RTCD     IFNE *BLANK                                    S01486
     C           BGTYLC    OREQ 'D'                                       S01486
     C                     MOVE '12'      DBASE             ************  S01486
     C                     MOVE 'SDMMODPD'DBFILE            * DATABASE *  S01486
     C                     MOVEL*BLANKS   DBKEY             * ERROR 12 *  S01486
     C                     SETON                     U7U8   ************  S01486
     C                     OPEN SE0580AU                                  S01486
     C                     WRITEHEADAU                                    S01486
     C                     WRITEERROR                                     S01486
     C                     CLOSESE0580AU                                  S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C**  Access SDPORTPD for Portfolio Reference.                        S01486
     C*                                                                   S01486
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C*                                                                   S01486
     C                     CALL 'AOPORTR0'                                S01486
     C                     PARM '*MSG    '@RTCD   7                       S01486
     C                     PARM '*FIRST  '@OPTN   7                       S01486
     C           @PORT     PARM @PORT     DSFDY                           S01486
     C*                                                                   S01486
     C           @RTCD     IFNE *BLANK                                    S01486
     C                     MOVE '11'      DBASE             ************  S01486
     C                     MOVE 'SDPORTPD'DBFILE            * DATABASE *  S01486
     C                     MOVEL*BLANKS   DBKEY             * ERROR 11 *  S01486
     C                     SETON                     U7U8   ************  S01486
     C                     OPEN SE0580AU                                  S01486
     C                     WRITEHEADAU                                    S01486
     C                     WRITEERROR                                     S01486
     C                     CLOSESE0580AU                                  S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C** SET EVENT CONTROL DATE TO LESSER OF ACCRUAL PROFIT DATE AND      S01486
     C** DATE OF NEXT WORKING DAY - 1                                     S01486
     C           DNWD      SUB  1         WWCHK   50                      S01486
     C           APDA      IFLT WWCHK                                     S01486
     C                     Z-ADDAPDA      WWECD                           S01486
     C                     ELSE                                           S01486
     C                     Z-ADDWWCHK     WWECD   50                      S01486
     C                     END                                            S01486
     C*
      *                                                                   S01447
      *** Call to the switchable features file to check if S01447         S01447
      *** is switched on.                                                 S01447
      *                                                                   S01447
     C                     MOVE *OFF      *IN30                           S01447
     C                     MOVE 'N'       S01447                          S01447
     C                     CALL 'AOSARDR0'                                S01447
     C                     PARM *BLANKS   @RTCD   7                       S01447
     C                     PARM '*VERIFY' @OPTN   7                       S01447
     C                     PARM 'S01447'  @SARD   6                       S01447
      *                                                                   S01447
     C           @RTCD     IFEQ *BLANK                                    S01447
     C                     MOVE 'Y'       S01447  1                       S01447
     C                     ENDIF                                          S01447
      *                                                                   S01512
      **  Access SAR details file to see if core feature S01512           S01512
      **  switched ON.                                                    S01512
      *                                                                   S01512
     C                     CALL 'AOSARDR0'                                S01512
     C                     PARM *BLANKS   @RTCD                           S01512
     C                     PARM '*VERIFY' @OPTN                           S01512
     C                     PARM 'S01512'  @SARD   6                       S01512
      *                                                                   S01512
     C           @RTCD     IFEQ *BLANK                                    S01512
     C                     MOVE '1'       *IN39                           S01512
     C                     END                                            S01512
     C*                                                                   S01496
     C** Check if S01496 is installed.                                    S01496
     C*                                                                   S01496
     C                     CALL 'AOSARDR0'                                S01496
     C                     PARM *BLANKS   @RTCD                           S01496
     C                     PARM '*VERIFY' @OPTN                           S01496
     C                     PARM 'S01496'  @SARD                           S01496
     C*                                                                   S01496
     C** Set indicator if installed.                                      S01496
     C*                                                                   S01496
     C           @RTCD     IFEQ *BLANKS                                   S01496
     C                     MOVE 'Y'       S01496  1                       S01496
     C                     END                                            S01496
     C*                                                                   CSE007
     C** Check if CSE007 is installed.                                    CSE007
     C*                                                                   CSE007
     C                     CALL 'AOSARDR0'                                CSE007
     C                     PARM *BLANKS   @RTCD                           CSE007
     C                     PARM '*VERIFY' @OPTN                           CSE007
     C                     PARM 'CSE007'  @SARD                           CSE007
     C*                                                                   CSE007
     C** Set indicator if installed.                                      CSE007
     C*                                                                   CSE007
     C           @RTCD     IFEQ *BLANKS                                   CSE007
     C                     MOVE 'Y'       CSE007  1                       CSE007
     C                     END                                            CSE007
      *                                                                   CEU017
      ***  Check if CEU017 is installed.                                  CEU017
      *                                                                   CEU017
     C                     MOVE 'N'       CEU017  1                       CEU017
     C                     CALL 'AOSARDR0'                                CEU017
     C                     PARM *BLANKS   @RTCD                           CEU017
     C                     PARM '*VERIFY' @OPTN                           CEU017
     C                     PARM 'CEU017'  @SARD                           CEU017
     C*                                                                   CEU017
     C** Set indicator if installed.                                      CEU017
     C*                                                                   CEU017
     C           @RTCD     IFEQ *BLANKS                                   CEU017
     C                     MOVE 'Y'       CEU017  1                       CEU017
     C                     ENDIF                                          CEU017
      *                                                                                       CGL031
      ** Check if CGL031 is switched ON.                                                      CGL031
      *                                                                                       CGL031
     C                     CALL 'AOSARDR0'                                                    CGL031
     C                     PARM *BLANKS   PRTCD   7                                           CGL031
     C                     PARM '*VERIFY' POPTN   7                                           CGL031
     C                     PARM 'CGL031'  PSARD   6                                           CGL031
      *                                                                                       CGL031
      ** DB Error Management.                                                                 CGL031
      *                                                                                       CGL031
     C           PRTCD     IFNE *BLANK                                                        CGL031
     C           PRTCD     ANDNE'*NRF   '                                                     CGL031
     C           *LOCK     IN   LDA                                                           CGL031
     C                     Z-ADD14        DBASE                                               CGL031
     C                     MOVEL'SCSARDPD'DBFILE                                              CGL031
     C                     MOVEL'CGL031'  DBKEY                                               CGL031
     C                     OUT  LDA                                                           CGL031
     C                     EXSR *PSSR                                                         CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** Set indicator if CGL031 feature is ON.                                               CGL031
      *                                                                                       CGL031
     C           PRTCD     IFEQ *BLANKS                                                       CGL031
     C                     MOVE 'Y'       CGL031  1                                           CGL031
     C                     END                                                                CGL031
      *                                                                                       CGL031
      ** Access bank details                                                                  CGL031
      *                                                                                       CGL031
     C                     CALL 'AOBANKR0'                                                    CGL031
     C                     PARM *BLANKS   PRTCD                                               CGL031
     C                     PARM '*FIRST ' POPTN                                               CGL031
     C           SDBANK    PARM SDBANK    DSSDY                                               CGL031
      *                                                                                       CGL031
      ** DB Error Management.                                                                 CGL031
      *                                                                                       CGL031
     C           PRTCD     IFNE *BLANK                                                        CGL031
     C           *LOCK     IN   LDA                                                           CGL031
     C                     Z-ADD15        DBASE                                               CGL031
     C                     MOVEL'SDBANKPD'DBFILE                                              CGL031
     C                     MOVEL@OPTN     DBKEY                                               CGL031
     C                     OUT  LDA                                                           CGL031
     C                     EXSR *PSSR                                                         CGL031
     C                     ENDIF                                                              CGL031
      *                                                                   S01447
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0580CCPG                                           S01408
     C*                                                                   S01408
      *                                                                   S01447
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  BBMAIN - Subroutine to perform Main Processing.              *
      *                                                               *
      *****************************************************************
      *
     C           BBMAIN    BEGSR                           *** BBMAIN ***
     C*
     C           *INU7     IFEQ '1'
     C           *INU8     ANDEQ'1'
     C                     GOTO BBEND
     C                     END
     C*
     C*  Perform main processing for each Position Settlement record..
     C*
     C                     Z-ADD99999     LCD
     C***********          Z-ADD*ZEROS    PBCH                            S01117
     C                     MOVE *BLANKS   PBCA                            S01117
     C                     MOVE *BLANKS   PSSH
     C**********           Z-ADD*ZEROS    PCPY                                                CSD027
     C                     MOVE *BLANKS   PCPY                                                CSD027
     C                     Z-ADD*ZEROS    PDUD
     C                     MOVE *BLANKS   PEVT
     C           KLPOSC    SETLLPOSETDF
     C                     READ POSETDF                  90
     C*
     C*    If no records found end program
     C*
     C           *IN90     IFEQ '1'
     C                     GOTO BBEND
     C                     END
     C*
     C*    else process confirmations where discretionary
     C*      indicator for counterparty EQ 'S' or 'D'.
     C*
     C           *IN90     DOWEQ'0'
     C*                                                                   S01522
     C**   If confirmation not already produced - by UDC                  S01522
     C*                                                                   S01522
     C           PSCF      IFNE 'Y'                                       S01522
     C           PSVL      ANDLTDNWD                                      089211
     C*                                                                   S01496
     C           S01496    IFEQ 'Y'                                       S01496
     C           CSE007    OREQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C           PEVT      ORNE 'RC'                                      S01496
     C*                                                                   S01496
     C                     MOVE '0'       *IN70                           CSE007
     C                     MOVE '0'       *IN76                           S01496
     C*                                                                   S01496
     C***********RECI      IFEQ 'D'                                       S01496
     C           RECI      IFNE '*'                                       S01496
     C                     MOVE '0'       *IN40                           S01496
     C           RECI      IFEQ 'R'                                       S01496
     C                     MOVE '1'       *IN40                           S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C*                                                                   S01522
     C           RECI      IFEQ 'D'
     C*                                                                   CSE007
     C                     MOVE 'N'       PEVTCA  1                       CSE007
     C                     MOVE *BLANKS   RRDESC                          CSE007
     C                     MOVE *BLANKS   WWPTYP  2                       CSE007
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C*                                                                   CSE007
     C           PEVT      IFNE 'CP'                                      CSE007
     C           PEVT      ANDNE'DV'                                      CSE007
     C           PEVT      ANDNE'PP'                                      CSE007
     C           PEVT      ANDNE'MP'                                      CSE007
     C           PEVT      ANDNE'MT'                                      CSE007
     C           PEVT      ANDNE'RC'                                      CSE007
     C           PEVT      CHAINSECOATL0             50                   CSE007
     C           *IN50     IFEQ '0'                                       CSE007
     C                     MOVE 'Y'       PEVTCA                          CSE007
     C                     MOVELMMDESC    RRDESC                          CSE007
     C                     MOVELMMPTYP    WWPTYP                          CSE007
     C                     ENDIF                                          CSE007
     C                     ENDIF                                          CSE007
     C*                                                                   CSE007
     C                     ENDIF                                          CSE007
     C*                                                                   CSE007
     C           PEVT      IFEQ 'CP'
     C           PEVT      OREQ 'DV'
     C           PEVT      OREQ 'PP'
     C           PEVT      OREQ 'MP'
     C           PEVT      OREQ 'MT'
     C           PEVT      OREQ 'RC'                                      S01496
     C           PEVTCA    OREQ 'Y'                                       CSE007
     C*                                                                   S01496
     C           PEVT      IFEQ 'RC'                                      S01496
     C                     MOVE '1'       *IN76                           S01496
     C                     END                                            S01496
     C*                                                                   CSE007
     C           PEVTCA    IFEQ 'Y'                                       CSE007
     C                     MOVE '1'       *IN70                           CSE007
     C                     END                                            CSE007
     C*                                                                   S01486
     C****                 Z-ADDTNLU      WWTNLU  50                      S01486
     C******************** Z-ADDTNL1      WWTNLU  50                      S01486
     C                     Z-ADDTNLU      WWTNLU  50                      S01486
     C*                                                                   S01486
     C*
     C*    Get Customer details ....
     C*
     C**********           Z-ADDPCPY      CNUM                                                CSD027
     C                     MOVE PCPY      CNUM                                                CSD027
     C                     MOVE '1'       RCDT
     C           KLCLNT    CHAINCLINTSEF             50
     C*
     C*     .. database error if not found
     C*
     C           *IN50     IFEQ '0'
     C           RECI      ANDEQ'*'
     C           *IN50     OREQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVE '06'      DBASE            ***************S01117
     C                     Z-ADD6         DBASE            ***************S01117
     C                     MOVEL'CLINT'   DBFILE           * DB ERROR 06 *
     C                     MOVELPCPY      DBKEY            ***************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     SETON                     U7U8
     C                     WRITEHEADAU
     C                     WRITEERROR
     C                     GOTO BBEND
     C                     END
     C/COPY WNCPYSRC,SE0580C011
     C*
     C*   Get alternative name & address if present
     C*
     C           C1AN      IFNE *BLANKS
     C                     MOVE C1AN      RCDT
     C                     ELSE
     C                     MOVE 'B'       RCDT
     C                     END
     C***********                                                         084174
     C********** KLCLNT    CHAINCLINTCCF             50                   084174
     C********** *IN50     IFEQ '0'                                       084174
     C********** RECI      ANDNE'*'                                       084174
     C***********          MOVE CNA1      RCNA1                           084174
     C***********          MOVE CNA2      RCNA2                           084174
     C***********          MOVE CNA3      RCNA3                           084174
     C***********          MOVE CNA4      RCNA4                           084174
     C***********          END                                            084174
     C*                                                                   084174
     C* Retrieve correspondent details from CGCORRPD via AOALTNR0:        084174
     C*                                                                   084174
     C                     MOVELCNUM      P#CUST                          084174
     C                     MOVEL*BLANKS   P#CUS1                          087284
     C                     MOVELCNUM      P#CUS1                          087284
      *                                                                   087284
      * If address reference is B use AOCUSTRO else AOALTNR0              087284
      *                                                                   087284
     C           RCDT      IFEQ 'B'                                       087284
     C                     CALL 'AOCUSTR0'             9090               087284
     C                     PARM *BLANKS   P#RTCD  7                       087284
     C                     PARM '*KEY   ' P#OPTN  7                       087284
     C                     PARM           P#CUS1 10                       087284
     C                     PARM *BLANKS   P#KYST  7                       087284
     C           P#CUSD    PARM *BLANKS   DSSDY                           087284
      *                                                                   087284
     C           *IN90     IFEQ '1'                                       087284
     C           *LOCK     IN   LDA                                       087284
     C                     MOVEL'AOCUSTR0'DBFILE           ***************087284
     C                     MOVELP#CUS1    DBKEY            * DB ERROR 13 *087284
     C                     Z-ADD13        DBASE            ***************087284
     C                     OUT  LDA                                       087284
     C                     EXSR *PSSR                                     087284
     C                     SETON                     U7U8                 087284
     C                     ELSE                                           087284
     C                     MOVELBBCNA1    RCNA1                           087284
     C                     MOVELBBCNA2    RCNA2                           087284
     C                     MOVELBBCNA3    RCNA3                           087284
     C                     MOVELBBCNA4    RCNA4                           087284
     C                     END                                            087284
     C                     ELSE                                           087284
     C*                                                                   084174
     C                     CALL 'AOALTNR0'                                084174
     C                     PARM *BLANKS   P#RTCD  7        B:Return code  084174
     C                     PARM '*KEY   ' P#OPTN  7        I:Option       084174
     C                     PARM           P#CUST  6        I:Customer no. 084174
     C                     PARM RCDT      P#ADCD  1        I:Address code 084174
     C***********P#CORR    PARM P#CORR    DSFDY            O:Format 084174087284
     C           P#ALTN    PARM P#ALTN    DSFDY            O:Format       084174
     C***********          ENDIF                                    087284093965
     C*                                                                   084174
     C           P#RTCD    IFEQ *BLANKS                                   084174
     C***********          MOVELCDADD1    CNA1                      084174087284
     C***********          MOVELCDADD2    CNA2                      084174087284
     C***********          MOVELCDADD3    CNA3                      084174087284
     C***********          MOVELCDADD4    CNA4                      084174087284
     C                     MOVELBCCNA1    RCNA1                           087284
     C                     MOVELBCCNA2    RCNA2                           087284
     C                     MOVELBCCNA3    RCNA3                           087284
     C                     MOVELBCCNA4    RCNA4                           087284
     C                     ENDIF                                          084174
     C                     ENDIF                                          093965
     C*
     C*    .. else check discretionary indicator
     C*
     C           C1DI      IFEQ 'S'
     C           C1DI      OREQ 'D'
     C*
     C*    Initialise details
     C*
     C                     EXSR CINIT
     C*
     C*    Prepare settlement details
     C*
     C                     EXSR CONFM
     C*
     C*    Print confirmation details if no errors
     C*
     C           *INU7     IFEQ '1'
     C           *INU8     ANDEQ'1'
     C                     GOTO BBEND
     C                     END
     C*
     C*                                                                   E29170
     C** If there are details to report and a new branch then open        E29170
     C** detail printer file for it and do RCF processing                 E29170
     C*                                                                   E29170
     C           PBCA      IFNE PBCASV                                    E29170
     C                     MOVE PBCA      PBCASV                          E29170
     C           FILOPN    IFEQ 'Y'                                       E29170
     C                     CLOSESE0580P1                                  E29170
     C                     END                                            E29170
     C                     OPEN SE0580P1                                  E29170
     C                     Z-ADD0         PAGE                            E29170
     C                     MOVEL'Y'       FILOPN  1                       E29170
     C                     EXSR RCFP1                                     E29170
     C                     END                                            E29170
     C                     EXSR CONPR
     C*
     C                     END
     C                     END
     C                     END
     C                     END                                            S01496
     C                     END                                            S01496
     C                     END                                            S01522
     C*
     C                     READ POSETDF                  90
     C                     END
     C*
     C           BBEND     ENDSR
     C*
     C********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      *  BCCLOS - Subroutine to Close Print File and Terminate Program.  *
      *                                                                  *
      ********************************************************************
      *
     C           BCCLOS    BEGSR                           *** BCCLOS ***
     C*
     C                     CLOSESE0580P1
     C/COPY WNCPYSRC,SE0580C007
     C*                                                                   E29170
     C** IF NO RECORDS HAVE BEEN WRITTEN THEN THE DETAIL PRINTER FILE     E29170
     C** IS NOT OPEN - IN THIS CASE WRITE NO DEATILS TO AUDIT             E29170
     C*                                                                   E29170
     C           FILOPN    IFNE 'Y'                                       E29170
     C                     WRITEHEADAU                                    E29170
     C                     WRITENONE                                      E29170
     C                     END                                            E29170
     C*
     C                     SETON                     LR
     C                     RETRN
     C*
     C                     ENDSR
     C*
     C********************************************************************
      /EJECT
     C********************************************************************
     C*                                                                  *
     C*  CINIT  Sub routine to initialise the confirmation print fields  *
     C*                                                                  *
     C********************************************************************
     C**
     C           CINIT     BEGSR
     C*
     C*  Initialise details
     C*
     C                     MOVE *BLANKS   DDATE
     C                     MOVE *BLANKS   VDATE                           S01512
     C                     MOVE *BLANKS   RPNMP
     C                     MOVE *BLANKS   RCPNR
     C                     MOVE *BLANKS   RPSAT
     C                     MOVE *BLANKS   RSDDV
     C                     MOVE *BLANKS   RSDCP
     C                     MOVE *BLANKS   RPCHA
     C                     MOVE *BLANKS   RPCAM
     C/COPY WNCPYSRC,SE0580C002
     C                     MOVE *BLANKS   RPDUE
     C                     MOVE *BLANKS   RPSXR
     C                     MOVE *BLANKS   RNSBN
     C                     MOVE *BLANKS   RCPBN
     C                     MOVE *BLANKS   RNSTN
     C                     MOVE *BLANKS   RCPTN
     C                     MOVE *BLANKS   RNSBT
     C                     MOVE *BLANKS   RCPBT
     C                     MOVE *BLANKS   RNSTT
     C                     MOVE *BLANKS   RCPTT
     C                     MOVE *BLANKS   RFACN
     C                     MOVE *BLANKS   RFACT
     C                     MOVE *BLANKS   RSTBR
     C                     MOVE *BLANKS   RPAMD                           E14957
     C                     MOVE *BLANKS   RTASO                           S01447
     C                     MOVE *BLANKS   RTAUS                           S01447
     C                     MOVE *BLANKS   RTXSR                                               CGL031
     C*
     C*  Set off indicators
     C*
     C                     SETOF                     1228
     C                     MOVEA'00000000'*IN,20
     C                     MOVEA'000000'  *IN,31
     C                     MOVEA'00000000'*IN,41
     C                     SETOF                     38                   E37786
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  CONFM  Sub routine to prepare Position Settlement            *
     C*         Confirmation details.                                 *
     C*                                                               *
     C*****************************************************************
     C**
     C           CONFM     BEGSR
     C*
     C*  Access Security file details
     C*
     C           PSSH      IFNE SAVSS
     C                     EXSR FASECT
     C*
     C*    .. exit if error
     C*
     C           *INU7     IFEQ '1'
     C           *INU8     ANDEQ'1'
     C                     GOTO COEND
     C                     END
     C                     MOVE PSSH      SAVSS
     C                     END
     C*
     C*  Get nominal currency decimal places
     C*
     C                     MOVEL*BLANKS   KEY12  12
     C                     MOVEL'20'      KEY12
     C                     MOVE '1'       WFLD4   4
     C                     MOVELPNCY      WFLD4
     C                     MOVE WFLD4     KEY12
     C           KEY12     CHAINTABTG10F             50
     C           *IN50     IFEQ '1'
     C           *IN50     OREQ '0'
     C           RECI      ANDEQ'*'
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVE '07'      DBASE            ***************S01117
     C                     Z-ADD7         DBASE            ***************S01117
     C                     MOVEL'TABLE'   DBFILE           * DB ERROR 07 *
     C                     MOVELKEY12     DBKEY            ***************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     SETON                     U7U8
     C                     WRITEHEADAU
     C                     WRITEERROR
     C                     GOTO COEND
     C                     END
     C/COPY WNCPYSRC,SE0580C004
     C*
     C* Store Nominal currency decimal places
     C*
     C                     Z-ADDCDP       NCDP    10
     C/COPY WNCPYSRC,SE0580C015
     C*
     C*  Get settlement currency decimal places
     C*
     C                     MOVEL*BLANKS   KEY12  12
     C                     MOVEL'20'      KEY12
     C                     MOVE '1'       WFLD4   4
     C                     MOVELPSCU      WFLD4
     C                     MOVE WFLD4     KEY12
     C           KEY12     CHAINTABTG10F             50
     C           *IN50     IFEQ '1'
     C           *IN50     OREQ '0'
     C           RECI      ANDEQ'*'
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVE '10'      DBASE            ***************S01117
     C                     Z-ADD10        DBASE            ***************S01117
     C                     MOVEL'TABLE'   DBFILE           * DB ERROR 10 *
     C                     MOVELKEY12     DBKEY            ***************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     SETON                     U7U8
     C                     WRITEHEADAU
     C                     WRITEERROR
     C                     GOTO COEND
     C                     END
     C*
     C* Store Settlement currency decimal places
     C*
     C                     Z-ADDCDP       SCDP    10
     C/COPY WNCPYSRC,SE0580C016
     C*
     C*  If Branch name to print access Branch Codes table file
     C*  if multibranching on                                             E29170
     C*
     C           BRNC      IFEQ 'Y'
     C           *IN37     ANDEQ'1'                                       E29170
     C***********PBCH      IFNE SAVBR                                     S01117
     C           PBCA      IFNE SAVBR                                     S01117
     C                     MOVE *BLANKS   KEY12
     C***********          MOVE PBCH      KEY12                           S01117
     C                     MOVE PBCA      KEY12                           S01117
     C                     MOVEL'10'      KEY12
     C           KEY12     CHAINTABLETRF             50
     C           *IN50     IFNE '1'
     C                     MOVE BRNM      RBRNM
     C***********          MOVE PBCH      SAVBR                           S01117
     C                     MOVE PBCA      SAVBR                           S01117
     C***********          MOVE NSACS     RNSAC                           S01117
     C                     MOVE '01'      RNSAC                           S01117
     C                     END
     C                     END
     C                     END
     C*
     C*  Get Settlement branch if NE Branch code
     C*
     C                     MOVE PSEB      WPSEB
     C***********PBCH      IFNE WPSEB                                     S01117
     C           PBCA      IFNE WPSEB                                     S01117
     C                     MOVE *BLANKS   KEY12
     C                     MOVE WPSEB     KEY12
     C                     MOVEL'10'      KEY12
     C           KEY12     CHAINTABLETRF             50
     C           *IN50     IFNE '1'
     C                     MOVELBRNM      RSTBR
     C                     END
     C                     END
     C*
     C*  Access Security Diary Events file
     C*  if Event Type is 'DV' 'PP' OR 'MP'                               E13911
     C*
     C           PEVT      IFEQ 'DV'                                      E13911
     C           PEVT      OREQ 'PP'                                      E13911
     C           PEVT      OREQ 'MP'                                      E13911
     C                     SETOF                     50
     C           PSSH      SETLLSEDEVDF
     C           AGAIN     TAG
     C           PSSH      READESEDEVDF                  50
     C*
     C           *IN50     IFEQ '0'
     C*
     C           RECI      IFEQ '*'
     C           PEVT      ORNE SDET
     C                     GOTO AGAIN
     C                     END
     C*
     C           PEVT      IFEQ 'DV'
     C           PEVT      OREQ 'MP'
     C********** PDUD      CABNESDPD      AGAIN                           158880
     C           PSVL      CABNESDPD      AGAIN                           158880
     C                     ELSE
     C           PDUD      CABNESDED      AGAIN
     C                     END
     C*
     C                     END
     C*
     C           *IN50     IFEQ '1'
     C**********           MOVELPDUD      FLD7    7                       E14714
     C**********           MOVE '09'      DBASE            ***************E14714
     C**********           MOVEL'SEDEV'   DBFILE           * DB ERROR 09 *E14714
     C**********           MOVELPSSH      DBKEY            ***************E14714
     C**********           MOVE FLD7      DBKEY                           E14714
     C**********           MOVE PEVT      DBKEY                           E14714
     C**********           SETON                     U7U8                 E14714
     C**********           WRITEHEADAU                                    E14714
     C**********           WRITEERROR                                     E14714
     C**********           GOTO COEND                                     E14714
     C**********           MOVE *ZEROS    SDDV                      E14714E16772
     C                     MOVE *ZEROS    SDVA                            E16772
     C                     MOVE *ZEROS    SDCP                            E14714
     C                     MOVE *ZEROS    SDPP                            E14714
     C                     END
     C*                                                                   E13911
     C                     END                                            E13911
     C*
     C*  Set indicators to print literals
     C*
     C*   ..  Event type
     C*
     C           PEVT      IFEQ 'CP'
     C                     SETON                     20
     C                     ELSE
     C           PEVT      IFEQ 'DV'
     C                     SETON                     21
     C                     ELSE
     C           PEVT      IFEQ 'PP'
     C                     SETON                     22
     C                     ELSE
     C           PEVT      IFEQ 'MP'
     C                     SETON                     23
     C                     ELSE
     C           PEVT      IFEQ 'MT'
     C           PAMD      ANDNE0                                         S01486
     C                     SETON                     24
     C                     ELSE                                           S01486
     C           PEVT      IFEQ 'MT'                                B6    S01486
     C           PAMD      ANDEQ0                                         S01486
     C                     SETON                     32                   S01486
     C                     ELSE                                           S01496
     C           PEVT      IFEQ 'RC'                                      S01496
     C           PAMD      ANDNE0                                         S01496
     C                     SETON                     24                   S01496
     C                     ELSE                                           S01496
     C           PEVT      IFEQ 'RC'                                      S01496
     C           PAMD      ANDEQ0                                         S01496
     C                     SETON                     32                   S01496
     C                     END                                            S01496
     C                     END                                            S01496
     C                     END                                      E6    S01486
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C*                                                                   S01486
     C*   ..  PORTFOLIO REFERENCE                                         S01486
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           PTFR      ANDNE*BLANKS                                   S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           PTFR      ANDNE*BLANKS                                   CPB001
     C*                                                                   S01486
     C*   ..  SET UP PORTFOLIO REFERENCE FOR REPORT                       S01486
     C           PTFR      IFNE '9997'                                    S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C                     MOVE PTFR      RRPTFR  4                       S01486
     C                     ELSE                                           S01486
     C******************** MOVE P9R997    RRPTFR                          S01486
     C                     MOVE FCR997    RRPTFR                          S01486
     C                     END                                            S01486
     C******************** MOVEA'000000'  *IN,10                    093965CSE007
     C                     MOVEA'0000000' *IN,10                          CSE007
     C           *IN20     IFEQ '1'                                       S01486
     C                     SETON                     10                   S01486
     C                     MOVE RRPTFR    RRPTF1                          S01486
     C                     ELSE                                           S01486
     C           *IN21     IFEQ '1'                                       S01486
     C                     SETON                     11                   S01486
     C                     MOVE RRPTFR    RRPTF2                          S01486
     C                     ELSE                                           S01486
     C           *IN22     IFEQ '1'                                       S01486
     C                     SETON                     12                   S01486
     C                     MOVE RRPTFR    RRPTF3                          S01486
     C                     ELSE                                           S01486
     C           *IN23     IFEQ '1'                                       S01486
     C                     SETON                     13                   S01486
     C                     MOVE RRPTFR    RRPTF4                          S01486
     C                     ELSE                                           S01486
     C           *IN24     IFEQ '1'                                       S01486
     C                     SETON                     14                   S01486
     C                     MOVE RRPTFR    RRPTF5                          S01486
     C*******************  END                                            S01486
     C                     ELSE                                           S01486
     C           *IN32     IFEQ '1'                                       S01486
     C                     SETON                     15                   S01486
     C                     MOVE RRPTFR    RRPTF6                          S01486
     C                     ELSE                                           CSE007
     C           *IN70     IFEQ '1'                                       CSE007
     C                     SETON                     16                   CSE007
     C                     MOVE RRPTFR    RRPTF7                          CSE007
     C                     END                                            CSE007
     C                     END                                            S01486
     C                     END                                            S01486
     C                     END                                            S01486
     C                     END                                            S01486
     C                     END                                            S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C*
     C*   ..  Settlement method
     C*
     C           PSMT      IFEQ 0
     C                     SETON                     41
     C                     ELSE
     C           PSMT      IFEQ 2
     C                     SETON                     42
     C                     ELSE
     C           PSMT      IFEQ 4
     C                     SETON                     43
     C                     ELSE
     C           PSMT      IFEQ 5
     C                     SETON                     44
     C                     ELSE
     C           PSMT      IFEQ 1
     C           PSMT      OREQ 7
     C           PSMT      OREQ 8
     C                     SETON                     45
     C                     ELSE
     C           PSMT      IFEQ 14
     C                     SETON                     46
     C                     ELSE
     C           PSMT      IFEQ 12
     C                     SETON                     47
     C                     ELSE
     C           PSMT      IFEQ 15
     C                     SETON                     48
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C*
     C*   ..  Settlement/Nominal currency
     C*
     C           PNCY      IFNE PSCU
     C                     SETON                     31
     C                     END
     C*
     C*   ..  Pay receive indicator
     C*
     C           PPRE      IFEQ 'P'
     C                     SETON                     35
     C                     ELSE
     C           PPRE      IFEQ 'R'
     C                     SETON                     36
     C                     END
     C                     END
     C*
     C*   ..  Settlement a/c
     C*
     C           PSEA      IFEQ *BLANKS
     C                     SETON                     25
     C                     END
     C*
     C*   ..  Counterparty bank
     C*
     C           PCPN      IFEQ *BLANKS
     C                     SETON                     26
     C                     END
     C*
     C*   ..  For a/c of
     C*
     C           PFAC      IFEQ *BLANKS
     C                     SETON                     27
     C                     END
     C*
     C*   ..  Special instructions
     C*
     C           PSPI      IFEQ *BLANKS
     C                     SETON                     28
     C                     END
     C*
     C*  Format fields to print
     C*                                                                *
     C*   ..  Due date
     C*                                                                *
     C                     Z-ADDPDUD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    DDATE
     C*                                                                   S01512
     C**  ..  Value date if core feature S01512 switched ON               S01512
     C           *IN39     IFEQ '1'                                       S01512
     C                     Z-ADDPSVL      ZDAYNO                          S01512
     C                     EXSR ZDATE2                                    S01512
     C                     MOVE ZADATE    VDATE                           S01512
     C                     END                                            S01512
     C*
     C*   ..  Nominal position
     C*
     C                     MOVE *BLANKS   ZFLD15
     C/COPY WNCPYSRC,SE0580C005
     C                     MOVE PNMP      ZFLD15
     C                     Z-ADDNMDP      ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    RPNMP
     C*
     C*   ..  Coupon rate
     C*
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE CPNR      ZFLD15
     C                     MOVE 'J'       ZECODE
     C                     Z-ADD7         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    RCPNR
     C*
     C*   ..  Dividend
     C*
     C***********SDDV      IFNE *ZEROS                              E14714E16772
     C           SDVA      IFNE *ZEROS                                    E16772
     C                     MOVE *BLANKS   ZFLD15
     C***********          MOVE SDDV      ZFLD15                          E16772
     C                     MOVE SDVA      ZFLD15                          E16772
     C                     MOVE 'J'       ZECODE
     C***********          Z-ADD4         ZDECS                           E16772
     C                     Z-ADD8         ZDECS                           E16772
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    RSDDV
     C                     ELSE                                           E14714
     C                     MOVE *BLANKS   RSDDV                           E14714
     C                     END                                            E14714
     C*
     C*   ..  Call amount
     C*
     C           SDPC      IFNE *ZEROS                                    E15929
     C                     SETON                         29               E15929
     C                     MOVE *BLANKS   ZFLD15                          E15929
     C                     MOVE SDPC      ZFLD15                          E15929
     C                     MOVE 'L'       ZECODE                          E15929
     C                     Z-ADD3         ZDECS                           E15929
     C                     EXSR ZSEDIT                                    E15929
     C                     MOVELZOUT21    RSDPP                           E15929
     C                     MOVE ' %'      RSDPP                           E15929
     C                     ELSE                                           E15929
     C           SDPP      IFNE *ZEROS                                    E14714
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE SDPP      ZFLD15
     C                     MOVE 'J'       ZECODE
     C                     Z-ADDNCDP      ZDECS
     C/COPY WNCPYSRC,SE0580C017
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    RSDPP
     C                     ELSE                                           E14714
     C                     MOVE *BLANKS   RSDPP                           E14714
     C                     END                                            E14714
     C                     END                                            E15929
     C*
     C*   ..  Current factor
     C*
     C           SDCP      IFNE *ZEROS                                    E14714
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE SDCP      ZFLD15
     C                     MOVE 'J'       ZECODE
     C                     Z-ADD8         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    RSDCP
     C                     ELSE                                           E14714
     C                     MOVE *BLANKS   RSDCP                           E14714
     C                     END                                            E14714
     C*
     C*     ..  AMOUNT DUE                                                E14957
     C*
     C                     MOVE PAMD      ZFLD15                          E14957
     C                     MOVE 'J'       ZECODE                          E14957
     C                     Z-ADDNCDP      ZDECS                           E14957
     C/COPY WNCPYSRC,SE0580C018
     C                     EXSR ZSEDIT                                    E14957
     C                     MOVE ZOUT21    RPAMD                           E14957
     C*
     C*   ..  Settlement amount
     C*
     C                     MOVE *BLANKS   ZFLD15
     C           PNCY      IFNE PSCU
     C                     MOVE PSAT      ZFLD15
     C                     MOVE 'J'       ZECODE
     C                     Z-ADDSCDP      ZDECS
     C/COPY WNCPYSRC,SE0580C019
     C                     ELSE
     C                     MOVE PAMD      ZFLD15
     C                     MOVE 'J'       ZECODE
     C                     Z-ADDNCDP      ZDECS
     C/COPY WNCPYSRC,SE0580C020
     C                     END
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    RPSAT
     C*
     C*   ..  Charge amount
     C*
     C                     Z-SUBPCHA      WPCHA
     C/COPY WNCPYSRC,SE0580C008
     C                     MOVE *BLANKS   ZFLD15
     C           PPRE      IFEQ 'P'
     C                     MOVE WPCHA     ZFLD15
     C                     ELSE
     C                     MOVE PCHA      ZFLD15
     C                     END
     C                     MOVE 'J'       ZECODE
     C                     Z-ADDNCDP      ZDECS
     C/COPY WNCPYSRC,SE0580C021
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    RPCHA
     C*
     C*   ..  Commission amount
     C*
     C                     Z-SUBPCAM      WPCAM
     C                     MOVE *BLANKS   ZFLD15
     C           PPRE      IFEQ 'P'
     C                     MOVE WPCAM     ZFLD15
     C                     ELSE
     C                     MOVE PCAM      ZFLD15
     C                     END
     C                     MOVE 'J'       ZECODE
     C                     Z-ADDNCDP      ZDECS
     C/COPY WNCPYSRC,SE0580C022
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    RPCAM
     C/COPY WNCPYSRC,SE0580C003
      *                                                                   S01447
      *** Processing for the Withholding Tax fields if the feature        S01447
      *** is on.                                                          S01447
      *                                                                   S01447
     C           S01447    IFEQ 'Y'                                       S01447
     C           PEVT      IFEQ 'CP'                                      S01447
     C           PEVT      OREQ 'DV'                                      S01447
     C           CSE007    OREQ 'Y'                                       CSE007
     C           WWPTYP    ANDEQ'DV'                                      CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C           WWPTYP    ANDEQ'DV'                                      CEU017
     C           *IN70     OREQ *ON                                       174836
     C*                                                                   S01447
     C                     MOVE *ON       *IN30                           S01447
     C*                                                                   S01447
     C                     Z-SUBTASO      WTASO                           S01447
     C                     MOVE *BLANKS   ZFLD15                          S01447
     C           PPRE      IFEQ 'P'                                       S01447
     C                     MOVE WTASO     ZFLD15                          S01447
     C                     ELSE                                           S01447
     C                     MOVE TASO      ZFLD15                          S01447
     C                     END                                            S01447
     C                     MOVE 'J'       ZECODE                          S01447
     C                     Z-ADDNCDP      ZDECS                           S01447
     C/COPY WNCPYSRC,SE0580C023
     C                     EXSR ZSEDIT                                    S01447
     C                     MOVE ZOUT21    RTASO                           S01447
      *                                                                   S01447
     C                     Z-SUBTAUS      WTAUS                           S01447
     C                     MOVE *BLANKS   ZFLD15                          S01447
     C           PPRE      IFEQ 'P'                                       S01447
     C                     MOVE WTAUS     ZFLD15                          S01447
     C                     ELSE                                           S01447
     C                     MOVE TAUS      ZFLD15                          S01447
     C                     END                                            S01447
     C                     MOVE 'J'       ZECODE                          S01447
     C                     Z-ADDNCDP      ZDECS                           S01447
     C/COPY WNCPYSRC,SE0580C024
     C                     EXSR ZSEDIT                                    S01447
     C                     MOVE ZOUT21    RTAUS                           S01447
     C                     ENDIF                                          S01447
     C                     ENDIF                                          S01447
      *                                                                                       CGL031
      ** Processing for the EU Withholding Tax if CGL031 feature                              CGL031
      ** is switched ON                                                                       CGL031
      *                                                                                       CGL031
     C           CGL031    IFEQ 'Y'                                                           CGL031
     C********** PEVT      IFEQ 'DV'                                                   CGL031 234881
     C********** PEVT      OREQ 'CP'                                                   CGL031 234881
     C********** PEVT      OREQ 'MT'                                                   CGL031 234881
     C********** PEVT      OREQ 'MP'                                                   CGL031 234881
     C**********           EXSR SREWTX                                                 CGL031 235035
      *                                                                                       235035
     C                     MOVE '0'       *IN19                                               235035
     C                     MOVE *BLANKS   ZFLD15                                              235035
     C           TXNM      IFGT *ZERO                                                         235035
     C                     MOVE '1'       *IN19                                               235035
     C                     Z-SUBTXNM      WWTXNM 150                                          235035
      *                                                                                       235035
     C           PPRE      IFEQ 'P'                                                           235035
     C                     MOVE WWTXNM    ZFLD15                                              235035
     C                     ELSE                                                               235035
     C                     MOVE TXNM      ZFLD15                                              235035
     C                     ENDIF                                                              235035
      *                                                                                       235035
     C                     ENDIF                                                              235035
      *                                                                                       235035
     C                     MOVE 'J'       ZECODE                                              235035
     C                     Z-ADDNCDP      ZDECS                                               235035
     C                     EXSR ZSEDIT                                                        235035
     C                     MOVE ZOUT21    RTXSR                                               235035
      *                                                                                       235035
     C**********           ENDIF                                                       CGL031 234881
     C                     ENDIF                                                              CGL031
     C*
     C*   ..  Amount
     C*
     C                     MOVE *BLANKS   ZFLD15
     C           PPRE      IFEQ 'P'
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0580CPD1                                           S01408
     C*                                                                   S01408
     C           PAMD      SUB  PCHA      WPAMD
     C                     SUB  PCAM      WPAMD
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0580CPD2                                           S01408
     C*                                                                   S01408
     C           *IN30     IFEQ '1'                                       S01447
     C                     SUB  TASO      WPAMD                           S01447
     C                     SUB  TAUS      WPAMD                           S01447
     C                     ENDIF                                          S01447
      *                                                                                       CGL031
     C           *IN19     IFEQ *ON                                                           CGL031
     C**********           SUB  WWTXSR    WPAMD                                        CGL031 235035
     C                     SUB  TXNM      WPAMD                                               235035
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ELSE
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0580CPD3                                           S01408
     C*                                                                   S01408
     C           PAMD      ADD  PCHA      WPAMD
     C                     ADD  PCAM      WPAMD
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0580CPD2                                           S01408
     C*                                                                   S01408
     C           *IN30     IFEQ '1'                                       S01447
     C                     ADD  TASO      WPAMD                           S01447
     C                     ADD  TAUS      WPAMD                           S01447
     C                     ENDIF                                          S01447
     C                     END
     C/COPY WNCPYSRC,SE0580C010
     C                     MOVE WPAMD     ZFLD15
     C                     MOVE 'J'       ZECODE
     C                     Z-ADDNCDP      ZDECS
     C/COPY WNCPYSRC,SE0580C025
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    RPDUE
     C*
     C*   ..  Settlement exchange rate
     C*
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE PSXR      ZFLD15
     C                     MOVE 'J'       ZECODE
     C                     Z-ADD8         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    RPSXR
     C*
     C*  Get Nostro name
     C*
     C           PSEA      IFNE *BLANKS
     C                     MOVEL*BLANKS   KEY12  12
     C                     MOVEL'70'      KEY12
     C                     MOVELPSEA      WFLD2   2
     C                     MOVE WFLD2     WFLD5   5
     C                     MOVELPSCU      WFLD5
     C                     MOVE WFLD5     KEY12
     C           KEY12     CHAINTABLETLF             50
     C           *IN50     IFEQ '0'
     C           RECI      ANDNE'*'
     C                     MOVE 'A'       RCDT
     C                     SETON                     38                   E37786
     C           KLCLNT    CHAINCLINTCBF             50
     C           *IN50     IFEQ '0'
     C           RECI      ANDNE'*'
     C                     MOVELCRNM      RNSBN
     C                     MOVELCRNM      RNSTN
     C                     MOVELCTWN      RNSBT
     C                     MOVELCTWN      RNSTT
     C                     END
     C                     END
     C                     END
     C*
     C*  Get Counterparty bank name
     C*
     C           PCPN      IFNE *BLANKS
     C                     MOVE *BLANKS   KEY12
     C                     MOVEL'71'      KEY12
     C                     MOVE PCPN      KEY12
     C           KEY12     CHAINTABLET2F             50
     C           *IN50     IFEQ '0'
     C           RECI      ANDNE'*'
     C                     MOVELCPNM      RCPBN
     C                     MOVELCPNM      RCPTN
     C                     MOVELCPTN      RCPBT
     C                     MOVELCPTN      RCPTT
     C                     END
     C                     END
     C*
     C*  Get For a/c of name
     C*
     C           PFAC      IFNE *BLANKS
     C                     MOVE *BLANKS   KEY12
     C                     MOVEL'71'      KEY12
     C                     MOVE PFAC      KEY12
     C           KEY12     CHAINTABLET2F             50
     C           *IN50     IFEQ '0'
     C           RECI      ANDNE'*'
     C                     MOVELCPNM      RFACN
     C                     MOVELCPTN      RFACT
     C                     END
     C                     END
     C*
     C           COEND     ENDSR
     C*
     C*****************************************************************
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  SREWTX - Retrieve European Withholding Tax                   *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
      *                                                                                       CGL031
     C********** SREWTX    BEGSR                                                       CGL031 235035
      *                                                                                       CGL031
     C**********           MOVE *OFF      *IN19                                        CGL031 235035
      *                                                                                       CGL031
     C**********           MOVE 'S'       WMODI                                        CGL031 235035
     C**********           MOVE PSSH      WSESN                                        CGL031 235035
     C**********           Z-ADD*ZERO     WWTXSR 150                                   CGL031 235035
     C**********           MOVE *BLANKS   ZFLD15                                       CGL031 235035
      *                                                                                       CGL031
      ** Access SDCSINL8 using the current rundate, mod id = 'S' and                          CGL031
      ** Security Shortname and event type.                                                   CGL031
      *                                                                                       CGL031
     C********** KCSIN8    SETLLSDCSINL8                                               CGL031 235035
     C********** KCSIN8    READESDCSINL8                 05                            CGL031 235035
     C********** *IN05     DOWEQ*OFF                                                   CGL031 235035
      *                                                                                       CGL031
     C********** PEVT      IFEQ TSETYP                                                 CGL031 235035
     C**********           ADD  TSTXSR    WWTXSR                                       CGL031 235035
     C**********           ENDIF                                                       CGL031 235035
      *                                                                                       CGL031
     C********** KCSIN8    READESDCSINL8                 05                            CGL031 235035
     C**********           ENDDO                                                       CGL031 235035
      *                                                                                       CGL031
     C********** WWTXSR    IFGT *ZERO                                                  CGL031 235035
     C**********           MOVE *ON       *IN19                                        CGL031 235035
     C**********           Z-SUBWWTXSR    ZZTXSR 150                                   CGL031 235035
      *                                                                                       CGL031
     C********** PPRE      IFEQ 'P'                                                    CGL031 235035
     C**********           MOVE ZZTXSR    ZFLD15                                       CGL031 235035
     C**********           ELSE                                                        CGL031 235035
     C**********           MOVE WWTXSR    ZFLD15                                       CGL031 235035
     C**********           ENDIF                                                       CGL031 235035
      *                                                                                       CGL031
     C**********           ENDIF                                                       CGL031 235035
      *                                                                                       CGL031
     C**********           MOVE 'J'       ZECODE                                       CGL031 235035
     C**********           Z-ADDNCDP      ZDECS                                        CGL031 235035
     C**********           EXSR ZSEDIT                                                 CGL031 235035
     C**********           MOVE ZOUT21    RTXSR                                        CGL031 235035
      *                                                                                       CGL031
     C**********           ENDSR                                                       CGL031 235035
      *****************************************************************                       CGL031
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  CONPR  S/R to print Position Settlement Confirmations        *
     C*                                                               *
     C*****************************************************************
     C**
     C           CONPR     BEGSR
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0580CCP1                                           S01408
     C*                                                                   S01408
     C*  Print confirmation
     C*
     C           BRNC      IFEQ 'Y'
     C           *IN37     ANDEQ'1'                                       E29170
     C                     WRITEHEADS
     C                     END
     C/COPY WNCPYSRC,SE0580C012
     C                     WRITEREFRN
     C/COPY WNCPYSRC,SE0580C013
     C                     WRITESETTL
     C                     WRITESECRT
     C           PEVT      IFEQ 'CP'
     C                     WRITEEVTCP
     C                     ELSE
     C           PEVT      IFEQ 'DV'
     C                     WRITEEVTDV
     C                     ELSE
     C           PEVT      IFEQ 'PP'
     C                     WRITEEVTPP
     C                     ELSE
     C           PEVT      IFEQ 'MP'
     C                     WRITEEVTMP
     C                     ELSE
     C           PEVT      IFEQ 'MT'
     C                     WRITEEVTMT
     C                     ELSE                                           S01496
     C           PEVT      IFEQ 'RC'                                      S01496
     C                     WRITEEVTRC                                     S01496
     C                     ELSE                                           174836
     C           PEVTCA    IFEQ 'Y'                                       174836
     C                     WRITEEVTCA                                     174836
     C                     END                                            174836
     C                     END                                            S01496
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C*
     C                     WRITECHARG
     C*
     C           PSMT      IFEQ 0
     C                     WRITESETL1
     C                     ELSE
     C*
     C           PSMT      IFEQ 4
     C           PSMT      OREQ 5
     C           PSMT      OREQ 15
     C                     WRITESETL2
     C           PSMT      IFEQ 4                                         035443
     C           PSEA      ANDNE*BLANKS                                   035443
     C                     MOVE RPSA2     CADC                            035443
     C                     MOVE RPSA3     RNSAC                           035443
     C                     END                                            035443
     C                     WRITESETL4
     C***********PBCH      IFNE WPSEB                                     S01117
     C           PBCA      IFNE WPSEB                                     S01117
     C                     WRITESETLB
     C                     END
     C                     ELSE
     C*
     C           PSMT      IFEQ 14
     C                     WRITESETL2
     C           *IN38     IFEQ '1'                                       E37786
     C                     WRITESETL3
     C                     ELSE                                           E37786
     C                     WRITESETL4                                     E37786
     C                     END                                            E37786
     C***********PBCH      IFNE WPSEB                                     S01117
     C           PBCA      IFNE WPSEB                                     S01117
     C                     WRITESETLB
     C                     END
     C                     ELSE
     C*
     C           PSMT      IFEQ 1
     C           PSMT      OREQ 2
     C           PSMT      OREQ 7
     C           PSMT      OREQ 8
     C           PSMT      OREQ 12
     C                     WRITESETL5
     C                     END
     C                     END
     C                     END
     C                     END
     C*
     C************         WRITECNTPY                                     076424
     C                     WRITECNTPY                  60                 076424
     C           *IN60     IFEQ '1'                                       076424
     C                     MOVE '0'       *IN60                           076424
     C                     END                                            076424
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0580CCP2                                           S01408
     C*                                                                   S01408
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  FASECT Sub routine to access Security file                   *
     C*                                                               *
     C*****************************************************************
     C**
     C           FASECT    BEGSR
     C*
     C*  Access Security details
     C*
     C           PSSH      CHAINSECTYDF              50
     C*
     C*  If record found ....
     C*
     C           *IN50     IFEQ '0'
     C           RECI      ANDNE'*'
     C*
     C*     ... get Security description
     C*
     C                     MOVE *BLANKS   ZSRPN
     C                     MOVE *BLANKS   ZSFN1
     C                     MOVE *BLANKS   ZSFN2
     C                     MOVELSFN1      ZSFN1
     C                     MOVELSFN2      ZSFN2
     C                     MOVE RSFD      ZRSFD                           S01117
     C*
     C                     EXSR ZSDESC
     C                     MOVELZFNM1     SDES1
     C                     MOVELZFNM2     SDES2
     C                     MOVELZFNM3     SDES3
     C/COPY WNCPYSRC,SE0580C014
     C*
     C*  Else database error if not found
     C*
     C                     ELSE
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE *BLANKS   DBKEY
     C***********          MOVE '08'      DBASE            ***************S01117
     C                     Z-ADD8         DBASE            ***************S01117
     C                     MOVEL'SECTY'   DBFILE           * DB ERROR 08 *
     C                     MOVELPSSH      DBKEY            ***************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     SETON                     U7U8
     C                     WRITEHEADAU
     C                     WRITEERROR
     C*
     C                     END
     C*
     C           FAEND     ENDSR
     C*
      *****************************************************************   S01117
      /EJECT                                                              S01117
      *****************************************************************   S01117
      *                                                               *   S01117
      *  *PSSR  - Error control subroutine                            *   S01117
      *                                                               *   S01117
      *****************************************************************   S01117
      *                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR **    S01117
     C**                                                                  S01117
     C/COPY WNCPYSRC,SE0580C009
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     ENDSR                                          S01117
      *                                                                   S01117
     C*****************************************************************
     C/EJECT                                                              E29170
     C********************************************************************E29170
     C*                                                                   E29170
     C*  RCFP1 -- SUBROUTINE TO REGISTER P1 PRINTER FILE VIA RCF          E29170
     C*                                                                   E29170
     C********************************************************************E29170
     C*                                                                   E29170
     C           RCFP1     BEGSR                            ** RCFP1 **   E29170
     C*                                                                   E29170
     C**      ENSURE REPORT SPOOL FILE RECORDED BY RCF                    E29170
     C*                                                                   E29170
     C                     Z-ADDSFNUM     ZSNUM   60                      E29170
     C**                                                                  E29170
     C                     CALL 'ZSFILE'                                  E29170
     C                     PARM           SEQ     5                       E29170
     C                     PARM PBCA      SENTY   3                       E29170
     C                     PARM           SFILE                           E29170
     C                     PARM           ZSNUM                           E29170
     C                     PARM           ZSERR   1                       E29170
     C*                                                                   E29170
     C           ZSERR     IFEQ 'Y'                                       E29170
     C*                                                                   E29170
     C**  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       E29170
     C*                                                                   E29170
     C                     SETON                     U7U8LR               E29170
     C                     RETRN                                          E29170
     C                     END                                            E29170
     C*                                                                   E29170
     C                     ENDSR                                          E29170
     C*                                                                   E29170
     C********************************************************************E29170
     C/EJECT                                                              E29170
     C********************************************************************E29170
     C*                                                                   E29170
     C*  RCFAU -- SUBROUTINE TO REGISTER AU PRINTER FILE VIA RCF          E29170
     C*                                                                   E29170
     C********************************************************************E29170
     C*                                                                   E29170
     C           RCFAU     BEGSR                            ** RCFAU **   E29170
     C*                                                                   E29170
     C**      ENSURE AUDIT SPOOL FILE RECORDED BY RCF                     E29170
     C*                                                                   E29170
     C                     Z-ADDSFNUMU    ZSNUMU  60                      E29170
     C**                                                                  E29170
     C                     CALL 'ZSFILE'                                  E29170
     C                     PARM           SEQ                             E29170
     C                     PARM *BLANKS   SENTY                           E29170
     C                     PARM           SFILEU                          E29170
     C                     PARM           ZSNUMU                          E29170
     C                     PARM *BLANK    ZSERR                           E29170
     C*                                                                   E29170
     C           ZSERR     IFEQ 'Y'                                       E29170
     C*                                                                   E29170
     C**  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       E29170
     C*                                                                   E29170
     C                     SETON                     U7U8LR               E29170
     C                     RETRN                                          E29170
     C                     END                                            E29170
     C*                                                                   E29170
     C                     ENDSR                                          E29170
     C*                                                                   E29170
     C*****************************************************************   E29170
     C/COPY WNCPYSRC,SE0580C006
      /EJECT
     C/COPY ZSRSRC,ZDATE2Z4
      /EJECT
     C/COPY ZSRSRC,ZICD2Z1
      /EJECT
     C/COPY ZSRSRC,ZICDSEZ1
      /EJECT
     C/COPY ZSRSRC,ZSDESCZ3
      /EJECT
     C/COPY ZSRSRC,ZSEDITZ3
      /EJECT
     C/COPY ZSRSRC,ZSYSTMZ1
      /EJECT
      ***
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  CPY@
(c) Finastra International Limited 2001
