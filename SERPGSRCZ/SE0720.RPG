     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Trading positions report')                    *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Securities Trading Module                            *
     F*                                                               *
     F*  SE0720 - TRADING POSITIONS REPORT                            *
     F*                                                               *
     F*  Function: Report showing the Day's Opening and Closing       *
     F*   (COB)    Balances with the 'B/F and C/F' Value Date Average *
     F*            Prices for each Market, Branch and Book.           *
     F*                                                               *
     F*  Called by: SEC0613B - Trading Positions                      *
     F*                                                               *
     F*  Frequency: Daily during COB                                  *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD036157           Date 26Jan16               *
      *  Prev Amend No. MD050604           Date 21Feb20               *
      *                 MD046248           Date 27Oct17               *
      *                 226449             Date 24Jun15               *
      *                 MD034776           Date 08Jul15               *
      *                 AR1067108          Date 11Dec12               *
      *                 AR1001183A         Date 20Nov12               *
      *                 CSE105             Date 06Dec10               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 247396             Date 10May07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 234300             Date 29Sep06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSE071             Date 19Jul05               *
      *                 229857             Date 07Oct04               *
      *                 226570             Date 27Jun04               *
      *                 CGL029             Date 01Sep03               *
      *                 211407             Date 07Jan03               *
      *                 208241             Date 21Aug02               *
      *                 194370             Date 12Jul01               *
      *                 207543             Date 17JUL02               *
      *                 180056             Date 18Oct00               *
      *                 CSE037             Date 29Apr02               *
      *                 CSE035             Date 22Apr02               *
      *                 CAS006             Date 21Jan03               *
      *                 206316             Date 19Jul02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 182960             Date 06Mar02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 17Jun01               *
      *                 CSE031             Date 09Nov01               *
      *                 180707             Date 25Jul00               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 127566             Date 09May01               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 141659             Date 10May00               *
     F*                 124140             DATE 26Apr00               *
      *                 140272             Date 20Apr00               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CAC005             Date 17Dec98               *
      *                 130862             Date 18Oct98               *
      *                 151945             Date 06Jan99               *
      *                 CEU017             Date 07Apr98               *
      *                 CSE007             Date 03Feb97               *
     F*                 CSE005             DATE 04FEB97               *
     F*                 127967             Date 13Oct97               *
     F*                 109884             DATE 26Feb97               *
     F*                 CAC002             Date 12Sep96               *
     F*                 S01408             Date 22Aug96               *
     F*                 084704             Date 01Aug96               *
     F*                 083039             Date 01Aug96               *
     F*                 059110             Date 25Jul96               *
     F*                 088047             Date 26Jun96               *
     F*                 100228             DATE 30MAY96               *
     F*                 099886             DATE 18APR96               *
     F*                 100017             DATE 18APR96               *
     F*                 S01408             DATE 04FEB96               *
     F*                 092961             DATE 04OCT95               *
     F*                 091254             DATE 20OCT95               *
     F*                 086491             DATE 15JUN95               *
     F*                 083223             DATE 06JUN95               *
     F*                 064575             DATE 15AUG94               *
     F*                 065301             DATE 05MAY94               *
     F*                 054257             DATE 10JAN94               *
     F*                 052254             DATE 10JAN94               *
     F*                 S01401             DATE 16JUN93               *
     F*                 E39495             DATE 25FEB93               *
     F*                 047922             DATE 01FEB93               *
     F*                 S01397             DATE 10SEP92               *
     F*                 E36263             DATE 24FEB92               *
     F*                 E33529             DATE 10JAN92               *
     F*                 E33528             DATE 10JAN92               *
     F*                 E33532             DATE 24DEC91               *
     F*                 E27934             DATE 22OCT91               *
     F*                 E29170             DATE 17OCT91               *
     F*                 E27092             DATE 04SEP91               *
     F*                 S01195             DATE 10JUL91               *
     F*                 S01117             DATE 10JUL91               *
     F*                 S01269             DATE 31JUL90               *
     F*                 E22803             DATE 10AUG90               *
     F*                 E21533             DATE 11APR90               *
     F*                 E21521             DATE 11APR90               *
     F*                 E21668             DATE 01MAY90               *
     F*                 E21616             DATE 03APR90               *
     F*                 E21246             DATE 26FEB90               *
     F*                 E21027             DATE 06FEB90               *
     F*                 E21002             DATE 02FEB90               *
     F*                 E20651             DATE 29JAN90               *
     F*                 E20576             DATE 18DEC89               *
     F*                 E20657             DATE 18DEC89               *
     F*                 E20656             DATE 18DEC89               *
     F*                 E20572             DATE 11DEC89               *
     F*                 E20608             DATE 11DEC89               *
     F*                 E20571             DATE 11DEC89               *
     F*                 E20587             DATE 11DEC89               *
     F*                 E20569             DATE 09DEC89               *
     F*                 E20451             DATE 05DEC89               *
     F*                 E20380             DATE 30NOV89               *
     F*                 E20236             DATE 20NOV89               *
     F*                 E20125             DATE 09NOV89               *
     F*                 E20149             DATE 09NOV89               *
     F*                 E18670             DATE 07/07/89              *
     F*                 E18652             DATE 04/07/89              *
     F*                 E16772             DATE 20/06/89              *
     F*                 E15840             DATE 13/02/89              *
     F*                 E15429             DATE 02/11/88              *
     F*                 E15965             DATE 31/10/88              *
     F*                 E15683             DATE 20/10/88              *
     F*                 E15305             DATE 29/09/88              *
     F*                 E13911             DATE 23/06/88              *
     F*                 S01158             DATE 06/05/88              *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  MD036157 - Coupon entries are missing from Position settle-  *
      *             ments maintenance screen. Recompiled due to       *
      *             /COPY ZACCZZ1 changes.                            *
      *  MD050604 - Average price of position changed incorrectly.    *
      *           - Increased length of field ZAPNC from 15,0 to 17,0 *
      *             with changes in copy sources ZAVPRZ1 and ZCNSDZ1. *
      *  MD046248 - Finastra Rebranding                               *
      *  226449 - Recompiled over changes made in /COPY ZDYYRZ3.      *
      *         - Applied for MD034387.                               *
      *  MD034776 - Reverse AR1001183A to allow negative interest     *
      *             rate. (Recompile)                                 *
      *  AR1067108 - PMC1140 Component failed during Clean COB        *
      *              Applied fix AR1001183A                           *
      *  AR1001183A - Coupon rate was still used in computation of    *
      *              interest instead of using the details in FRN tab *
      *              (Reopen) (Recompile)                             *
      *  CSE105 - Portuguese Upgrade - Discount/Premium Amortisation  *
      *           on Trade Date                                       *
      *  247396 - Use the latest current factor from SEDEV to get the *
      *           correct B/FWD position amount.                      *
      *  234300 - Recompiled over changed in PF/HSTTRD.               *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  229857 - Recompiled due to change in ZYLDZ2.                 *
      *  226570 - Recompiled due to change in ZYLDZ2.                 *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  211407 - Recompile after change on copy sources ZYLDZ2,      *
      *           ZACCRZ1 and ZYCEZ1 for NX/NNX processing.           *
      *           The change was to call subroutine ZLCD1 instead     *
      *           of ZLCD in retrieving the PERIOD for NNX processing *
      *           and ZNCD1 is called instead of ZNCD in retrieving   *
      *           the WBENCD for NNX processing. Also rewrite tests   *
      *           for identifying if position is NX,NNX or CUM.       *
      *  208241 - Recompiled over changed /CPY ZSDESCZ3.              *
      *  194370 - Recompile after change on copy sources ZYLDZ2,      *
      *           For securities with divisor basis = '5' and first   *
      *           coupon date > valuation date (rundate + 1), set     *
      *           event control date to first coupon date before      *
      *           processing SR/ZDYYR. This is to ensure that the     *
      *           correct hypothetical last and next coupon dates are *
      *           used in deriving the price/yield rate.              *
      *  207543 - CEU018 not working on a price basis.                *
      *           Recompiled over changed ZYLDZ2.                     *
      *  180056 - Recompiled over changed in ZDYYRZ3.                 *
      *  CSE037 - Bond Pricing - 3 Decimal Places in Trades Input     *
      *  CSE035 - NX/NNX Coupon Payment Processing.                   *
      *           Recompile over changed ZACCRZ1/ZYLDZ2
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  206316 - Recompiled over changed ZLCDZ1.                     *
      *  182960 - Database error occured at 007 due to chaining of    *
      *           cancelled trades to trades file. Applied fix        *
      *           163664 which chains to CNCTRD if chain failed on    *
      *           the trades file.                                    *
      *  CPK015 - Conversion of ZYIELD from PLI to RPG.               *
      *           Recompile over changed ZYLDZ2.                      *
      *  CSE031 - Coupon Fixing for Floating Rate Notes.              *
      *           (recompilation due to change to ZNCD/ZLCD/ZACCR).   *
      *  180707 - No Position Settlements generated. Recompile over   *
      *           changes in /COPY ZNCDZ3.                            *
      *  127566 - Recompiled over changed ZSDESCZ3                    *
      *  141659 - Dbase error occurred due to chaining of cancelled   *
      *           trades to trades file.  Applied fix 119260 and      *
      *           chain to CNCTRD if chain failed on trades file.     *
     F*  124140 - B/F line incorrect after mark-to-market.            *
     F*  140272 - Recompile over changed ZYLDZ2                       *
      *  CAC005 - Profit Centre Accounting - SE Enhancement           *
     F*  130862 - Recompiled over ZLCDZ1 & ZDAYSZ2 changes.           *
     F*  151945 - Recompiled Over changed ZDYYRZ3 .                   *
     F*  CEU017 - Securities Redenomination Euro Changes              *
     F*           Just recompile                                      *
     F*  CSE007 - Corporate Actions - Just recompile                  *
     F*  CSE005 - Effect of holidays on FRN Coupon Dates              *
     F*           (recompilation due to change to ZNCD/ZLCD/ZACCR).   *
     F*  127967 - Record not found in TRADS for deleted deals.        *
     F*  109884 - Add 2 to line counter when writing profit lines to  *
     F*           avoid overflow error on SE0720P1.                   *
     F*  CAC002 - Profit Centre Accounting Development - Phase 2      *
     F*         - Use booking profit centre in the report.            *
     F*  S01408 - Addition of core hook SE0720CCP4
     F*  084704 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
     F*  083039 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
     F*  059110 - Recompiled over changed ZYLDZ2 sub.                 *
     F*  088047 - RECOMPILE over change SR/ZYLDZ2.                    *
     F*  100228 - RECOMPILE OVER CHANGED ZDYYRZ3, ZLCDZ1 & ZNCDZ3.    *
     F*  099886 - Rounding problem for partly paid securities.        *
     F*           Recompile over amended standard subroutine ZACCZ.   *
     F*  100017 - Position settlement unable to pick up day adj. on   *
     F*           SECTYD. Change subroutine to use DADJN to stop      *
     F*           interest day adjustment being used for amortisation.*
     F*           Recompile over amended subroutine ZDAYS.            *
     F*  S01408 - Addition of core hook SE0720FFP1
     F*           Addition of core hook SE0720CCP1
     F*           Addition of core hook SE0720CCP2
     F*           Addition of core hook SE0720CCP3
     F*  092961 - Recompile over ZDAYSZ2 which was amended by 086491  *
     F*           (Wrong number of days calculated for day basis 1    *
     F*           when start or end day is last day of February)      *
     F*  091254 - RECOMPILE OVER CHANGED ZLCDZ1 & ZNCDZ3              *
     F*  086491 - Wrong nbr of days calculated for day basis 1        *
     F*           when start or end day is last day of February       *
     F*           Recompiled for ZSRSRC/ZDAYSZ2 changes.              *
     F*  080857 - Chain also on historic file ( TRADHS USED )         *
     F*           DBE TRADS                                           *
     F*  064575 - Recompiled over amended ZYLDZ2 subroutine.          *
     F*  065301 - Recompiled over changed copy source ZACCR subr.     *
     F*           with ZAMT increased to 15,0.                        *
     F*  054257 - RECOMPILED as PREV CURRENT FACTOR amended from 9,8  *
     F*           to 10,9                                             *
     F*  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
     F*           to 10,9                                             *
     F*  S01401 - MT5xx SWIFT Messages Feature:                       *
     F*           - Recompiled due to changes to files.               *
     F*  E39495 - New /COPY subroutine ZCALCD added (called from      *
     F*           sr. ZYLD)                                           *
     F*         - Recompiled over changed ZYLDZ2                      *
     F*         - Restored /COPY subroutine ZACCZZ1 which was removed *
     F*           by S01117                                           *
     F*  047922 - Recompiled over changed SR/ZYLDZ2                   *
     F*  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
     F*           - Recompiled due to changes to files and SR/ZYLD.   *
     F*  E36263 - Output brought forward price in both percentage and *
     F*           Price/Discount/Yield formats                        *
     F*  E33529 - Only output today's profit if it is worked out on   *
     F*           a trade date basis                                  *
     F*  E33528 - Recompiled over changed printer file                *
     F*  E33532 - Carried Forward price should be shown in price/     *
     F*           discount/yield format and not percentage format     *
     F*  E27934 - Recompiled over the changed version of ZACCRZ1      *
     F*  E29170 - Report Control Facility program changes             *
     F*  E27092 - Recompiled over changed SR/ZLCD                     *
     F*  S01195 - Holiday Processing.                                 *
     F*  S01117 - Multibranching.                                     *
     F*  S01269 - TRADE AUTHORISTION: Recompiled for change to        *
     F*           file TABSE                                          *
     F*  E22803 - Recompiled over changed display file SE0720P1       *
     F*  E21533 - Overflow errors on SE0720P1 & SE0730P1 caused EOD   *
     F*           to halt.  Line count processing rewritten.          *
     F*  E21521 - TODAY'S PROFIT figure was misleading - did not      *
     F*           reflect changes in realized profit due to reversals *
     F*           or changes done today.  Must accumulate this figure *
     F*           from action records; can't just take it from BKPOS. *
     F*  E21668 - Recompiled over changed SR/ZYLDZ2                   *
     F*  E21616 - Recompiled over changed SR/ZLCD.                    *
     F*  E21246 - Merk to Market Reval P/L is being added twice to    *
     F*           Month-to-Date Profit.                               *
     F*  E21027 - B/F, C/F Prices should be shown as Percentage for   *
     F*           Trades on Discount/Yield Based Securities.          *
     F*  E21002 - Report should use Contract Price for Trade detail   *
     F*           line, not Trade Price.                              *
     F*  E20651 - DB Error Numbers used in more than one place.       *
     F*           New Error Numbers as follows:                       *
     F*           DB ERROR 01 -> 05                                   *
     F*           DB ERROR 01 -> 06                                   *
     F*  E20576 - Brought/Carried Forward Price should not be shown   *
     F*           for Discount/Yield Based Securities.                *
     F*  E20657 - Current Factor for Brought/Carried Forward line     *
     F*           should be taken from AAPR in BKPOS and from BBCF/   *
     F*           BCCF in TDBPA for Trade Line.                       *
     F*  E20656 - Amended to use ZCNSD to calculate Consideration.    *
     F*  E20572 - Amended as Price Action fields BBPR and BCPR        *
     F*           already hold Price in Price/Discount/Yield form.    *
     F*  E20608 - Processing for Adjusted B/F line redundant.         *
     F*  E20571 - BBTP used instead of BBPT.                          *
     F*  E20587 - Brought/Carried Forward Price and Consideration     *
     F*           must = 0 if Brought/Carried Forward Nominal = 0     *
     F*           with decimals lined up accordingly.                 *
     F*  E20569 - End of Report.                                      *
     F*  E20451 - E20236 is incomplete - for back-valued trades use   *
     F*           BBTP instead of BCTD.                               *
     F*  E20380 - Recompile for changed ZYLDZ1/2 and include ZLCDZ1.  *
     F*  E20236 - Fix E20125 is incorrect. Prices should be output    *
     F*           as a P/D/Y. However the field displayed for the     *
     F*           trades should not be converted from CNTP but should *
     F*           be BCTD, which as a result of E20235 is already a   *
     F*           P/D/Y.                                              *
     F*  E20125 - Eliminate the conversion of Prices to Yields.       *
     F*  E20149 - Rounding error in calculation of carried-forward    *
     F*           consideration for a stock basket (PROT 7).          *
     F*  E18670 - Line overflow.                                      *
     F*  E18652 - Changes to process Trades done on Coupon Date.      *
     F*  E16772 - Recompiled for the Dividend Payment Amount field    *
     F*           changes.                                            *
     F*  E15840 - Both B/Fwd and C/Fwd balances of zero are reported  *
     F*           with a non-zero average price.                      *
     F*  E15429 - Distinguish Price, Discount and Yield Securities.   *
     F*  E15965 - Mark to market revaluation                          *
     F*  E15683 - Enlarged Price fields to 15,8 - Recompile.          *
     F*  E15305 - Do not edit price with commas, and round up total   *
     F*           consideration calculation.                          *
     F*  E13911 - POST INCORPORATION FIXES FROM DEVELOPMENT.          *
     F*  S01158 - POST INCORPORATION DEVELOPMENT FIX.                 *
     F*  NOTE:  - A small amount of deleted code for S01158 has been  *
     F*           removed in an exercise to clarify the processing.   *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
      *
     FTDBPA   IP  E           K        DISK
     FBKPHD   IF  E           K        DISK
     FBKMTH   IF  E           K        DISK
     FBKPOS   IF  E           K        DISK
     FTABSE   IF  E           K        DISK
     F            TABLETAF                          KIGNORE
     F            TABTE10F                          KIGNORE
     F            TABTE20F                          KIGNORE
     F            TABTG20F                          KIGNORE
     F            TABLETHF                          KIGNORE
     F*********   TABLETJF                          KIGNORE               E21002
     F            TABLETKF                          KIGNORE
     F            TABLETLF                          KIGNORE
     F            TABLETNF                          KIGNORE
     F            TABLETPF                          KIGNORE
     F            TABLETXF                          KIGNORE
     F            TABLET2F                          KIGNORE
     F            TABLET3F                          KIGNORE
     F            TABLET5F                          KIGNORE
     F            TABTB40F                          KIGNORE
     FCLINT   IF  E           K        DISK
     F            CLINTCAF                          KIGNORE
     F            CLINTCCF                          KIGNORE
     F            CLINTC1F                          KIGNORE
     F            CLINTSEF                          KIGNORE
     FINVTP   IF  E           K        DISK
     FSECTY   IF  E           K        DISK
     F*SEDEV***IF**E           K        DISK                              E20125
     F*SEDEV***IF**E           K        DISK                       E20236 E20576
     FSEDEV   IF  E           K        DISK                               E21002
     F***SECEO***IF  E           K        DISK                      E21002S01117
     F*********** SEDEVDF                           KRENAMESEDEVDO  E21002S01117
     F*********** SNDEVDF                           KRENAMESNDEVDO  E21002S01117
     FSECEO   IF  E           K        DISK                               E39495
     F            SEDEVDF                           KRENAMESEDEVDO        E39495
     F            SNDEVDF                           KRENAMESNDEVDO        E39495
     F***TRADS***IF**E           K        DISK                     S01117 083223
     FTRADHS  IF  E           K        DISK                               083223
     FCNCTR   IF  E           K        DISK                               141659
     F            TRADSDF                           KRENAMECNCTRDF        141659
     FBACPT   IF  E           K        DISK                               124140
     F            BPACHDF                           KRENAMEBPACHDO        124140
     FSE0720AUO   E                    PRINTER
     F                                              KINFDS SPOOLU         E29170
     FSE0720P1O   E                    PRINTER                        UC
     F                                              KINFDS SPOOL          E29170
     F*                                                                   S01408
     F/COPY WNCPYSRC,SE0720FFP1                                           S01408
      *                                                                                       CSE105
     FBOOKD   IF  E           K        DISK                                                   CSE105
      ** SD Book Details                                                                      CSE105
      *                                                                                       CSE105
     F*                                                                   S01408
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*   01  -    Book Position Actions (Back-valued) record read    *
     F*   02  -    Book Position Actions (Current) record read        *
     F*   03  -    Book Position Actions (Historic) record read       *   S01158
      *   04  -    CAC005 is Installed                                *   CAC005
     F*   20  -    Multibranching set on                              *   S01117
     F*   21  -    Profit Centres used                                *   S01117
     F*   25  -    Nominal Currency decimal places equal to 0         *
     F*   26  -    Nominal Currency decimal places equal to 1         *
     F*   27  -    Nominal Currency decimal places equal to 2         *
     F*   28  -    Nominal Currency decimal places equal to 3         *
     F*   33  -    General work indicator                             *
     F*   34  -    Seton if no previous Book Position record found    *
     F*   41  -    Australian yield traded security                   *   E21002
     F*   42  -    Discount/Yield traded security                     *   E33532
     F*   51  -    Seton if Trade Action detail record read           *
     F*   52  -    Seton if Price Action detail record read           *
     F*   69  -    Used to Control fist cycle processing              *
     F*                                                               *
     F* 90-99 - Used in standard subroutines                          *
     F*                                                               *
     F*   U7  -    Database error                                     *
     F*   U8  -    Database / Control error                           *
     F*                                                               *
     F*   L5  -    Change of Branch                                   *
     F*   L4  -    Change of Book                                     *
     F*   L3  -    Change of Market                                   *
     F*   L2  -    Change of Investment type                          *
     F*   L1  -    Change of Security                                 *
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*   *PSSR  - DUMP program on error                              *   S01117
     F*   RCFAU  - Define AU printer file to RCF program ZSFILE       *   E29170
     F*   RCFP1  - Define P1 printer file to RCF program ZSFILE       *   E29170
     F*   ZCALCD - Calculate long term CD price from input yield      *   E39495
     F*   ZCNSD  - Calculate Consideration                            *   E20656
     F*   ZDATE1 - DATE - DAYNO conversion                            *
     F*   ZDATE2 - DAYNO - DATE conversion                            *
     F*   ZDAYS  - Calculate number of days between two dates for     *
     F*            Interest calculations                              *
     F*   ZDYYR  - Calculate number of days in Interest year          *
     F*   ZEVCD  - Determine Event Control date                       *
     F*   ZICD2  - Access ICD record 2                                *
     F*   ZICDSE - Access ICD record for Securities Trading           *
     F*   ZNCD   - Determine Next Coupon date                         *
     F*   ZPRCO  - Convert Price to Discount/Yield/Percentage         *   E21002
     F*   ZSDESC - Format Security Description                        *
     F*   ZSEDIT - Insert a decimal point and sign into a numeric     *
     F*            field and blank out leading zeros                  *
     F*   ZSYSTM - Access ICD record                                  *
     F*   ZYLDO  - Output Price as Price/Discount/Yield               *   E21002
     F*   ZYLDZ  - Set up parameters for ZYLDO                        *   E21002
     F*                                                               *
     F*****************************************************************
      /EJECT
     E                    CPY@    1   1 80
     E                    TABMIN  3   3  1   TABMNM  9
     E*/COPY*ZSRSRC*ZDAYSZ1***                                            E20125
     E/COPY ZSRSRC,ZDAYSZ1                                                E20236
     E/COPY ZSRSRC,ZDATE2Z1
     E***/COPY*ZSRSRC,ZDATE6Z1                                      E21002S01195
     E/COPY ZSRSRC,ZSDESCZ1
     E/COPY ZSRSRC,ZPOWER8Z1
     E/COPY ZSRSRC,ZSEDITZ1
     E*/COPY*ZSRSRC*ZNCDZ1***                                             E20125
     E/COPY ZSRSRC,ZNCDZ1                                                 E20236
      /EJECT
     IBPACBDF     01
     I***********                                   BBBR  L5              S01117
     I                                              BBBA  L5              S01117
     I                                              BBBK  L4
     I                                              BBMK  L3
     I                                              BBIT  L2
     I                                              BBSS  L1
     IBPACCDF     02
     I***********                                   BCBR  L5              S01117
     I                                              BCBA  L5              S01117
     I                                              BCBO  L4
     I                                              BCMK  L3
     I                                              BCIT  L2
     I                                              BCSS  L1
     IBPACHDF     03                                                      S01158
     I***********                                   BCBR  L5        S01158S01117
     I                                              BCBA  L5              S01117
     I                                              BCBO  L4              S01158
     I                                              BCMK  L3              S01158
     I                                              BCIT  L2              S01158
     I                                              BCSS  L1              S01158
     IBPACHDO                                                             124140
     I              BCSS                            HBCSS                 124140
     I              BCBA                            HBCBA                 124140
     I              BCMK                            HBCMK                 124140
     I              BCBO                            HBCBO                 124140
     I              BCAD                            HBCAD                 124140
     I              BCED                            HBCED                 124140
     I              BCAS                            HBCAS                 124140
     I              BCTP                            HBCTP                 124140
     I              BCIT                            HBCIT                 124140
     I              BCOT                            HBCOT                 124140
     I              BCTR                            HBCTR                 124140
     I              BCPS                            HBCPS                 124140
     I              BCNL                            HBCNL                 124140
     I              BCRV                            HBCRV                 124140
     I              PCHI                            HPCHI                 124140
     I              CNTP                            HCNTP                 124140
     I              ACRI                            HACRI                 124140
     I              TRCP                            HTRCP                 124140
     I              BCPR                            HBCPR                 124140
     I              BCPL                            HBCPL                 124140
     I              BCCF                            HBCCF                 124140
      *                                                                                       CSE037
     IINVTPDF                                                                                 CSE037
     I              SFLG                            ISFLG                                     CSE037
      *
     I***LDA*****   UDS                            256                    S01117
     I***********                           134 177 DBLOT                 S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 177 DBASE                 S01117
      *                                                                   S01117
     ILDA         DS                            256                       S01117
      *                                                                   S01117
      ** *LOCK IN LDA immediately before and OUT LDA immediately          S01117
      ** after each database error handling.                              S01117
      *                                                                   S01117
     I                                      134 183 DBLOT                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
      *                                                                   S01117
     IRUNDT       DS                                                      S01117
      *                                                                   S01117
      ** RUNDAT data area                                                 S01117
      *                                                                   S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
     I*
     I           SDS
     I                                      244 246 WSID
     I                                      254 263 USID
     I/COPY ZSRSRC,ZNCDZ2
     I/COPY ZSRSRC,ZSEDITZ2
     I/COPY ZSRSRC,ZSDESCZ2
     I*COPY*ZSRSRC*ZYLDZ1*****                                            E20576
     I/COPY ZSRSRC,ZYLDZ1                                                 E21002
      *
     ICPYR@#      DS
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
      *                                                                   E29170
     ISPOOL       DS                                                      E29170
      *                                                                   E29170
      ** Data structures for RCF spooled file names                       E29170
      *                                                                   E29170
     I                                       83  92 SFILE                 E29170
     I                                    B 123 1240SFNUM                 E29170
      *                                                                   E29170
     ISPOOLU      DS                                                      E29170
     I                                       83  92 SFILEU                E29170
     I                                    B 123 1240SFNUMU                E29170
      *                                                                   E29170
     ISDGELR    E DSSDGELRPD                                              S01117
      *                                                                   S01117
      ** General Ledger Details                                           S01117
      *                                                                   S01117
     ISDMMOD    E DSSDMMODPD                                              CAC002
     I**  Modules File Details                                            CAC002
     I*                                                                   CAC002
     IDSFDY     E DSDSFDY                                                 S01117
      *                                                                   S01117
      ** Short data structure for access programs (200 long)              S01117
      *                                                                   S01117
     I/COPY WNCPYSRC,SE0720I001
      *                                                                                       CSE105
     ISCSARD    E DSSCSARDPD                                                                  CSE105
      *                                                                                       CSE105
      ** SAR Descriptions                                                                     CSE105
      *                                                                                       CSE105
      *                                                                                       CGL029
     IDSSDY     E DSDSSDY                                                                     CGL029
      *                                                                                       CGL029
     I              'DiscPremAmortPostn  'C         SVALKK                                    CSE105
      *                                                                                       CSE105
     C/EJECT
      *================================================================
      *  P R O G R A M   S T A R T                                    *
      *================================================================
     C*  FIRST TIME PROCESSING
     C*
     C           *IN69     IFEQ '0'
      *                                                                   E29170
      ** RCF Processing for Audit File                                    E29170
      *                                                                   E29170
     C                     MOVE '     '   SEQ     5                       E29170
     C                     EXSR RCFAU                                     E29170
     C*
     C**  Prepare LDA
     C*
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL*BLANK    DBLOT
     C                     MOVEL'SE0720'  DBPGM
     C                     OUT  LDA                                       S01117
      *                                                                   S01117
      ** Read in RUNDAT data area                                         S01117
      *                                                                   S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C                     IN   RUNDT                                     S01117
      *                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     SETON                         20               S01117
     C                     END                                            S01117
      *                                                                   S01117
      ** Access General Ledger details                                    S01117
      *                                                                   S01117
     C**********           CALL 'AOGELRR0'                                             S01117 CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C********** SDGELR    PARM SDGELR    DSFDY                                        S01117 CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C/COPY WNCPYSRC,SE0720C004
      *                                                                                       CSE105
      ** Access SAR details file to see if feature CSE105 is installed.                       CSE105
      *                                                                                       CSE105
     C                     CALL 'AOSARDR0'                                                    CSE105
     C                     PARM '       ' @RTCD                                               CSE105
     C                     PARM '*VERIFY' @OPTN                                               CSE105
     C                     PARM 'CSE105'  @SARD                                               CSE105
     C           SCSARD    PARM SCSARD    DSFDY                                               CSE105
      *                                                                                       CSE105
     C           @RTCD     IFEQ *BLANKS                                                       CSE105
     C                     MOVE 'Y'       CSE105  1                                           CSE105
     C                     ELSE                                                               CSE105
     C                     MOVE 'N'       CSE105                                              CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
      ** Check system values if CSE105 is switched on                                         CSE105
      *                                                                                       CSE105
     C           CSE105    IFEQ 'Y'                                                           CSE105
      *                                                                                       CSE105
     C                     CALL 'AOSVALR0'                                                    CSE105
     C                     PARM *BLANKS   @RTCD                                               CSE105
     C                     PARM SVALKK    SVALK1 20                                           CSE105
     C                     PARM           SVAL1 200                                           CSE105
     C                     PARM *BLANK    SVALK2 20                                           CSE105
     C                     PARM           SVAL2 200                                           CSE105
     C                     PARM *BLANK    SVALK3 20                                           CSE105
     C                     PARM           SVAL3 200                                           CSE105
     C                     PARM *BLANK    SVALK4 20                                           CSE105
     C                     PARM           SVAL4 200                                           CSE105
     C                     PARM *BLANK    SVALK5 20                                           CSE105
     C                     PARM           SVAL5 200                                           CSE105
     C                     PARM *BLANK    SVALK6 20                                           CSE105
     C                     PARM           SVAL6 200                                           CSE105
     C                     PARM *BLANK    SVALK7 20                                           CSE105
     C                     PARM           SVAL7 200                                           CSE105
     C                     PARM *BLANK    SVALK8 20                                           CSE105
     C                     PARM           SVAL8 200                                           CSE105
     C                     PARM *BLANK    SVALK9 20                                           CSE105
     C                     PARM           SVAL9 200                                           CSE105
     C                     PARM *BLANK    SVALK0 20                                           CSE105
     C                     PARM           SVAL10200                                           CSE105
      *                                                                                       CSE105
     C           @RTCD     IFNE *BLANKS                                                       CSE105
     C           *LOCK     IN   LDA                                                           CSE105
     C                     MOVE 'SDSVALPD'DBFILE                                              CSE105
     C                     MOVELSVALK1    DBKEY                                               CSE105
     C                     Z-ADD15        DBASE                                               CSE105
     C                     OUT  LDA                                                           CSE105
     C                     EXSR *PSSR                                                         CSE105
     C                     SETON                       U7U8                                   CSE105
     C                     ELSE                                                               CSE105
     C                     MOVELSVAL1     SESVAL  1                                           CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
     C           SESVAL    IFEQ *BLANKS                                                       CSE105
     C                     MOVE 'V'       SESVAL                                              CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
     C                     MOVE '1'       *IN32                                               CSE105
      *                                                                                       CSE105
     C                     ENDIF                                                              CSE105
     C*                                                                   CAC002
     C**  Check if Analytical Accounting module is installed.             CAC002
     C*                                                                   CAC002
     C                     CALL 'AOMMODR0'                                CAC002
     C                     PARM '*MSG   ' @RTCD                           CAC002
     C                     PARM '*FIRST ' @OPTN                           CAC002
     C           SDMMOD    PARM SDMMOD    DSFDY                           CAC002
     C*                                                                   CAC002
     C           @RTCD     IFNE *BLANKS                                   CAC002
     C           *LOCK     IN   LDA                                       CAC002
     C                     Z-ADD8         DBASE            ************   CAC002
     C                     MOVEL'SDMMODPD'DBFILE           * DBERR 08 *   CAC002
     C                     MOVEL@OPTN     DBKEY            ************   CAC002
     C                     OUT  LDA                                       CAC002
     C                     SETON                     U7U8                 CAC002
     C                     WRITEHEADAU                                    CAC002
     C                     WRITEERROR                                     CAC002
     C                     EXSR *PSSR                                     CAC002
     C                     SETON                     LR                   CAC002
     C                     RETRN                                          CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   S01117
      ** Set on indicator 21 if profit centre used for printer file       S01117
      *                                                                   S01117
     C           BKPRCU    IFEQ 'Y'                                       S01117
     C                     MOVE '1'       *IN21                           S01117
     C                     END                                            S01117
     C*
     C**  Get installation Control data record 1
     C*
     C                     EXSR ZSYSTM
     C*
     C**  Error in ZSYSTM
     C*
     C           *IN99     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'1'       *INU8
     C                     MOVEL'1'       *INU7                           E20651
     C***********          MOVEL'01'      DBASE                           E20651
     C***********          MOVEL'05'      DBASE                     E20651S01117
     C                     Z-ADD5         DBASE            ***************S01117
     C                     MOVEL'TABLE'   DBFILE           * DB ERROR 05 *
     C                     MOVELZTABKY    DBKEY            ***************
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     SETON                     LR
     C                     RETRN
     C                     END
     C*
     C**  Get Installation Control data record for security
     C*
     C                     EXSR ZICDSE
     C*
     C**  Error in ZICDSE
     C*
     C           *IN99     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'1'       *INU8
     C                     MOVEL'1'       *INU7
     C***********          MOVEL'02'      DBASE                           S01117
     C                     Z-ADD2         DBASE            ***************S01117
     C                     MOVEL'TABLE'   DBFILE           * DB ERROR 02 *
     C                     MOVELZTABKY    DBKEY            ***************
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     SETON                     LR
     C                     RETRN
     C                     END
     C*
     C**  Get Installation Control Data record 2
     C*
     C                     EXSR ZICD2
     C*
     C**  Error in ZICD2
     C*
     C           *IN99     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'1'       *INU8
     C                     MOVEL'1'       *INU7
     C***********          MOVEL'03'      DBASE                           S01117
     C                     Z-ADD3         DBASE            ***************S01117
     C                     MOVEL'TABLE'   DBFILE           * DB ERROR 03 *
     C                     MOVELZTABKY    DBKEY            ***************
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     SETON                     LR
     C                     RETRN
     C                     END
      *                                                                   CAC005
      ** Access Switchable feature files for CAC005                       CAC005
      *                                                                   CAC005
     C                     CALL 'AOSARDR0'                                CAC005
     C                     PARM *BLANKS   PRTCD   7                       CAC005
     C                     PARM '*VERIFY' POPTN   7                       CAC005
     C                     PARM 'CAC005'  PSARD   6                       CAC005
      *                                                                   CAC005
     C           PRTCD     IFEQ *BLANKS                                   CAC005
     C                     MOVE 'Y'       CAC005  1                       CAC005
     C                     MOVE '1'       *IN04                           CAC005
     C                     ELSE                                           CAC005
     C                     MOVE 'N'       CAC005                          CAC005
     C                     MOVE '0'       *IN04                           CAC005
     C                     ENDIF                                          CAC005
      *                                                                                       CSE035
      ** Access SAR details file to see if CSE035 is installed                                CSE035
      *                                                                                       CSE035
     C                     CALL 'AOSARDR0'                                                    CSE035
     C                     PARM *BLANKS   @RTCD                                               CSE035
     C                     PARM '*VERIFY' @OPTN                                               CSE035
     C                     PARM 'CSE035'  @SARD   6                                           CSE035
      *                                                                                       CSE035
     C           @RTCD     IFEQ *BLANK                                                        CSE035
     C                     MOVE 'Y'       CSE035  1                                           CSE035
     C                     ELSE                                                               CSE035
     C                     MOVE 'N'       CSE035                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       207543
      ** Access SAR details file to see if CEU018 is installed                                207543
      *                                                                                       207543
     C                     CALL 'AOSARDR0'                                                    207543
     C                     PARM *BLANKS   @RTCD                                               207543
     C                     PARM '*VERIFY' @OPTN                                               207543
     C                     PARM 'CEU018'  @SARD                                               207543
      *                                                                                       207543
     C           @RTCD     IFEQ *BLANK                                                        207543
     C                     MOVE 'Y'       CEU018  1                                           207543
     C                     ELSE                                                               207543
     C                     MOVE 'N'       CEU018                                              207543
     C                     ENDIF                                                              207543
     C*
     C**  CALCULATE EVENT CONTROL DATE
     C*
     C                     Z-ADDDNWD      ZZDNWD                          S01117
     C                     Z-ADDAPDA      ZZAPDT                          S01117
     C                     EXSR ZEVCD
     C*
     C**  Define work field
     C*
     C           *LIKE     DEFN AAPR      CFAAPR                          E20657
     C           *LIKE     DEFN NPSN      CFNPSN
     C           *LIKE     DEFN RPTP      CFRPTP
     C           *LIKE     DEFN BPSC      SVBPSC
     C************LIKE     DEFN BPBR      SVBPBR                          S01117
     C           *LIKE     DEFN BPBA      SVBPBA                          S01117
     C           *LIKE     DEFN BPBK      SVBPBK
     C           *LIKE     DEFN BPMK      SVBPMK
     C           *LIKE     DEFN BPTV      SVBPTV
     C/COPY WNCPYSRC,SE0720C005
     C           *LIKE     DEFN WCONS     AMVAL                                               CSE105
     C*
     C**  Key to access Investment types
     C*
     C           ITPKA     KLIST
     C                     KFLD           NMCY
     C                     KFLD           INVTYP  3
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0720CCP1                                           S01408
     C*                                                                   S01408
     C*
     C**  Key 1 to access Book Position header record
     C*
     C           HDDKA     KLIST
     C                     KFLD           BBSS
     C***********          KFLD           BBBR                            S01117
     C                     KFLD           BBBA                            S01117
     C                     KFLD           BBBK
     C                     KFLD           BBMK
     C                     KFLD           TRDVAL  1
     C*
     C                     MOVE 'T'       TRDVAL
     C*
     C**  Key 2 to access Book Position header record
     C*
     C           HDDKB     KLIST
     C                     KFLD           BCSS
     C***********          KFLD           BCBR                            S01117
     C                     KFLD           BCBA                            S01117
     C                     KFLD           BCBO
     C                     KFLD           BCMK
     C                     KFLD           TRDVAL
     C*
     C**  Key 1 to access Book Position Month End Header
     C*
     C           HDMKA     KLIST
     C                     KFLD           BBSS
     C***********          KFLD           BBBR                            S01117
     C                     KFLD           BBBA                            S01117
     C                     KFLD           BBBK
     C                     KFLD           BBMK
     C                     KFLD           TRDVAL  1
     C                     KFLD           BKED
     C*
     C**  Key 2 to access Book Position Month End Header record
     C*
     C           HDMKB     KLIST
     C                     KFLD           BCSS
     C***********          KFLD           BCBR                            S01117
     C                     KFLD           BCBA                            S01117
     C                     KFLD           BCBO
     C                     KFLD           BCMK
     C                     KFLD           TRDVAL
     C                     KFLD           BKED
     C*
     C**  Key 3 to access Book Position Month End Header
     C*
     C           HMKA      KLIST
     C                     KFLD           BBSS
     C***********          KFLD           BBBR                            S01117
     C                     KFLD           BBBA                            S01117
     C                     KFLD           BBBK
     C                     KFLD           BBMK
     C                     KFLD           TRDVAL  1
     C*
     C**  Key 4 to access Book Position Month End Header record
     C*
     C           HMKB      KLIST
     C                     KFLD           BCSS
     C***********          KFLD           BCBR                            S01117
     C                     KFLD           BCBA                            S01117
     C                     KFLD           BCBO
     C                     KFLD           BCMK
     C                     KFLD           TRDVAL
     C*
     C**  Key 1 to access latest Book Position
     C*
     C           BKPKA     KLIST
     C                     KFLD           BBSS
     C***********          KFLD           BBBR                            S01117
     C                     KFLD           BBBA                            S01117
     C                     KFLD           BBBK
     C                     KFLD           BBMK
     C                     KFLD           TRDVAL
     C*********************KFLD           LPCD                            E15965
     C                     KFLD           LPSD                            E15965
     C*
     C**  Key 2 to access latest Book Position
     C*
     C           BKPKB     KLIST
     C                     KFLD           BCSS
     C***********          KFLD           BCBR                            S01117
     C                     KFLD           BCBA                            S01117
     C                     KFLD           BCBO
     C                     KFLD           BCMK
     C                     KFLD           TRDVAL
     C*********************KFLD           LPCD                            E15965
     C                     KFLD           LPSD                            E15965
     C*
     C**  Key 3 to fetch B/f Book Position
     C*
     C           BKPKC     KLIST
     C                     KFLD           BBSS
     C***********          KFLD           BBBR                            S01117
     C                     KFLD           BBBA                            S01117
     C                     KFLD           BBBK
     C                     KFLD           BBMK
     C                     KFLD           TRDVAL
     C                     KFLD           BBAD
     C*
     C**  Key 4 to fetch B/f Book Position
     C*
     C           BKPKD     KLIST
     C                     KFLD           BCSS
     C***********          KFLD           BCBR                            S01117
     C                     KFLD           BCBA                            S01117
     C                     KFLD           BCBO
     C                     KFLD           BCMK
     C                     KFLD           TRDVAL
     C***********          KFLD           BBAD                            E13911
     C                     KFLD           BCAD                            E13911
     C*                                                                   124140
     C**  Key to access BPACHD details                                    124140
     C*                                                                   124140
     C           HMBH1     KLIST                                          124140
     C                     KFLD           BBBA                            124140
     C                     KFLD           BBBK                            124140
     C                     KFLD           BBSS                            124140
     C                     KFLD           BBMK                            124140
     C                     KFLD           BBAD                            124140
     C*                                                                   124140
     C           HMBH2     KLIST                                          124140
     C                     KFLD           BCBA                            124140
     C                     KFLD           BCBO                            124140
     C                     KFLD           BCSS                            124140
     C                     KFLD           BCMK                            124140
     C                     KFLD           BCAD                            124140
     C*                                                                   124140
     C           HMBH1A    KLIST                                          124140
     C                     KFLD           BBBA                            124140
     C                     KFLD           BBBK                            124140
     C                     KFLD           BBSS                            124140
     C                     KFLD           BBMK                            124140
     C*                                                                   124140
     C           HMBH2A    KLIST                                          124140
     C                     KFLD           BCBA                            124140
     C                     KFLD           BCBO                            124140
     C                     KFLD           BCSS                            124140
     C                     KFLD           BCMK                            124140
     C/COPY WNCPYSRC,SE0720C006
      *                                                                                       CSE105
      ** Book Details.                                                                        CSE105
      *                                                                                       CSE105
     C           BOKKEY    KLIST                                                              CSE105
     C                     KFLD           BHBK                                                CSE105
      *                                                                                       CSE105
     C*
     C                     SETON                     69
     C                     END
     C*
     C**  Count records read
     C*
     C                     ADD  1         READS
      *                                                                   CAC005
     C                     MOVE *BLANKS   BKPRF                           CAC005
      *                                                                   CAC005
     C           *IN01     IFEQ '1'                                       CAC005
     C                     MOVE BBBK      BKPRF                           CAC005
     C                     END                                            CAC005
      *                                                                   CAC005
     C           *IN02     IFEQ '1'                                       CAC005
     C           *IN03     OREQ '1'                                       CAC005
     C                     MOVE BCBO      BKPRF                           CAC005
     C                     END                                            CAC005
      *                                                                   CAC005
      ** If CAC005 is installed, retrieve the corresponding user book     CAC005
      ** and profit centre.                                               CAC005
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     CALL 'AOBKPCR0'                                CAC005
     C                     PARM *BLANKS   PRTCD                           CAC005
     C                     PARM '*USER  ' POPTN                           CAC005
     C                     PARM           PBKCD   2                       CAC005
     C                     PARM           PPRFC   4                       CAC005
     C                     PARM BKPRF     PPSBK   2                       CAC005
      *                                                                   CAC005
     C           PRTCD     IFEQ *BLANKS                                   CAC005
     C                     MOVE PBKCD     BKPRF                           CAC005
     C                     MOVE PPRFC     PRFC                            CAC005
     C                     ELSE                                           CAC005
     C                     MOVE *BLANKS   PRFC                            CAC005
     C                     ENDIF                                          CAC005
     C                     ENDIF                                          CAC005
      *
      ***  C H A N G E   O F   B R A N C H
      *
     C   L5                DO
     C*
     C**  Fetch Branch Name
     C*
     C                     MOVE *BLANKS   KEY12A 12
     C                     MOVEL'10'      KEY12A
     C***01******          MOVE BBBR      KEY12A                          S01117
     C***02******          MOVE BCBR      KEY12A                          S01117
     C***03******          MOVE BCBR      KEY12A                    S01158S01117
     C   01                MOVE BBBA      KEY12A                          S01117
     C   02                MOVE BCBA      KEY12A                          S01117
     C   03                MOVE BCBA      KEY12A                          S01117
     C           KEY12A    CHAINTABLETRF             33
     C   33                MOVE *BLANKS   BRNM
     C*
     C**  Open report file, reset page no. and print headings
     C*
     C                     OPEN SE0720P1
     C                     EXSR RCFP1                                     E29170
     C                     Z-ADD*ZEROS    PAGE
     C                     WRITEHEADL5
     C***********          Z-ADD7         LCOUNT  20                      E21533
     C                     Z-ADD8         LCOUNT  20                      E21533
     C*
     C   L5                END
      *
      ***  C H A N G E   O F   S E C U R I T Y
      *
     C   L1                DO
     C*
     C**  Fetch Market name (from indicator)
     C*
     C   01      BBMK      LOKUPTABMIN    TABMNM         33
     C   02      BCMK      LOKUPTABMIN    TABMNM         33
     C   03      BCMK      LOKUPTABMIN    TABMNM         33               S01158
     C  N33                MOVE *BLANKS   TABMNM
     C*
     C**  Fetch Security details
     C*
     C   01      BBSS      CHAINSECTYDF              33
     C   02      BCSS      CHAINSECTYDF              33
     C   03      BCSS      CHAINSECTYDF              33                   S01158
     C*
     C**  Australian yield traded security?                               E21002
     C*                                                                   E21002
     C           STBS      IFEQ 'Y'                                       E21002
     C           SYBS      ANDEQ'AU'                                      E21002
     C                     SETON                     41                   E21002
     C                     ELSE                                           E21002
     C                     SETOF                     41                   E21002
     C                     END                                            E21002
     C*                                                                   E33532
     C**  Price or yield/discount traded security?                        E33532
     C*                                                                   E33532
     C           STBS      IFEQ 'P'                                       E33532
     C                     SETOF                     42                   E33532
     C                     ELSE                                           E33532
     C                     SETON                     42                   E33532
     C                     END                                            E33532
     C/COPY WNCPYSRC,SE0720C007
      *                                                                                       CSE105
      ** Reset Amortisation Total.                                                            CSE105
      *                                                                                       CSE105
     C           CSE105    IFEQ 'Y'                                                           CSE105
     C                     Z-ADD*ZERO     AMVAL                                               CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
     C*
     C**  Fetch Nominal currency decimal places
     C*
     C                     MOVE *BLANKS   KEY12A 12
     C                     MOVELNMCY      WORK4A  4
     C                     MOVE '1'       WORK4A
     C                     MOVEL'20'      KEY12A
     C                     MOVE WORK4A    KEY12A
     C           KEY12A    CHAINTABTG10F             33
     C  N33      RECI      COMP '*'                      33
     C           *IN33     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     SETON                     U7U8
     C***********          MOVEL'04'      DBASE                           S01117
     C                     Z-ADD4         DBASE            ***************S01117
     C                     MOVEL'TABLE'   DBFILE           * DB ERROR 04 *
     C                     MOVELKEY12A    DBKEY            ***************
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     SETON                     LR
     C                     RETRN
     C                     END
     C                     Z-ADDCDP       NCDP                            E21002
     C*
     C**  Fetch Investment name
     C*
     C   01                MOVE BBIT      INVTYP
     C   02                MOVE BCIT      INVTYP
     C   03                MOVE BCIT      INVTYP                          S01158
     C           ITPKA     CHAININVTPDF              33
     C   33                MOVE *BLANKS   INAM
     C*
     C**  Setup Security short description
     C*
     C                     MOVELSESN      ZSRPN
     C                     MOVE *BLANKS   ZSFN1
     C                     MOVE *BLANKS   ZSFN2
     C                     MOVE RSFD      ZRSFD                           S01117
     C                     EXSR ZSDESC
      *                                                                   E21533
      **  Following code moved here because field ADJI from BKPOS is      E21533
      **  needed for overflow calculation prior to output of headings.    E21533
      *                                                                   E21533
      **  Fetch Book Position Header.                                     E21533
      *                                                                   E21533
     C   01      HDDKA     SETGTBKPHDDF                                   E21533
     C   02      HDDKB     SETGTBKPHDDF                                   E21533
     C   03      HDDKB     SETGTBKPHDDF                                   E21533
     C                     READPBKPHDDF                  33               E21533
     C/COPY WNCPYSRC,SE0720C008
      *                                                                                       CSE105
      ** If CSE105 is *ON, obtain book details.                                               CSE105
      *                                                                                       CSE105
     C           CSE105    IFEQ 'Y'                                                           CSE105
     C                     EXSR BOKCHN                                                        CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
      *                                                                   E21533
      **  Fetch latest Book Position.                                     E21533
      *                                                                   E21533
     C   01      BKPKA     CHAINBKPOSDF              33                   E21533
     C   02      BKPKB     CHAINBKPOSDF              33                   E21533
     C   03      BKPKB     CHAINBKPOSDF              33                   E21533
     C*
     C**  Print header
     C*
      **  Don't start new position on this page unless there is space     E21533
      **  for Position Headings (5 lines), B/F data (3-5 lines) and at    E21533
      **  least one Detail (1 line).  Thus, minimum is 9-11 lines.        E21533
      *                                                                   E21533
     C***********LCOUNT    IFGT 56                                 S01158 E18670
     C***********LCOUNT    IFGT 50                                 E18670 E21533
     C           LCOUNT    IFGT 52                                        E21533
     C           LCOUNT    ORGT 50                                        E21533
     C           ADJI      ANDEQ'Y'                                       E21533
     C                     WRITEHEADL5
     C***********          Z-ADD7         LCOUNT                          E21533
     C                     Z-ADD8         LCOUNT                          E21533
     C                     END
     C*
      *****Conversion of Prices to Discounts/Yields no longer performed   E20125
     C**Set up*DISC/PRICE/YIELD*heading*depending*on*TRADE*BASIS** E15429 E20125
     C************************************************************ E15429 E20125
     C*****IN29*=*'D'********************************************* E15429 E20125
     C*****IN30*=*'P'********************************************* E15429 E20125
     C*****IN31*=*'Y'********************************************* E15429 E20125
     C***********STBS      COMP 'P'                  312930        E15429 E20125
     C*                                                                   E20236
     C**  E20236 reverses out E20125                                      E20236
     C*                                                                   E20236
     C**  Set up DISC/PRICE/YIELD heading depending on TRADE BASIS        E20236
     C*                                                                   E20236
     C**   IN29 = 'D'                                                     E20236
     C**   IN30 = 'P'                                                     E20236
     C**   IN31 = 'Y'                                                     E20236
     C*                                                                   E20236
     C           STBS      COMP 'P'                  312930               E20236
     C                     WRITEHEADL1
     C***********          ADD  8         LCOUNT                          E21533
     C                     ADD  5         LCOUNT                          E21533
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     ADD  1         LCOUNT                          CAC005
     C                     ENDIF                                          CAC005
     C*
     C**Fetch*Book*Position*header*************************************   E21533
      ***********  ALREADY DONE  ***********                              E21533
     C***********                                                         E21533
     C***01******HDDKA     SETGTBKPHDDF                                   E21533
     C***02******HDDKB     SETGTBKPHDDF                                   E21533
     C***03******HDDKB     SETGTBKPHDDF                            S01158 E21533
     C***********          READPBKPHDDF                  33               E21533
     C*
     C**  Fetch Book Position Month End header
     C*
     C                     MOVE *HIVAL    BKED
     C   01      HDMKA     SETLLBKMTHDF
     C   02      HDMKB     SETLLBKMTHDF
     C   03      HDMKB     SETLLBKMTHDF                                   S01158
     C   01      HMKA      READEBKMTHDF                  33
     C   02      HMKB      READEBKMTHDF                  33
     C   03      HMKB      READEBKMTHDF                  33               S01158
     C*
     C**Fetch*latest*book*position*************************************   E21533
      ***  ALREADY DONE  ***                                              E21533
     C*
     C***01******BKPKA     CHAINBKPOSDF              33                   E21533
     C***02******BKPKB     CHAINBKPOSDF              33                   E21533
     C***03******BKPKB     CHAINBKPOSDF              33            S01158 E21533
     C*
     C**  Save Carried forward Nominal position
     C*
     C                     Z-ADDNPSN      CFNPSN
      *                                                                   E21521
      **  Clear TODAY'S PROFIT for accumulation from trade actions.       E21521
     C***********          Z-ADDRPTP      CFRPTP                          E21521
     C                     Z-ADD0         CFRPTP                          E21521
     C                     Z-ADDAAPR      CFAAPR                          E20657
     C*                                                                   124140
     C** Read previous mark-to-market price and B/F date                  124140
     C*                                                                   124140
     C           *IN01     IFEQ '1'                                       124140
     C           HMBH1     SETLLBPACHDO                                   124140
     C           HMBH1A    REDPEBPACHDO                  35               124140
     C                     ELSE                                           124140
     C           HMBH2     SETLLBPACHDO                                   124140
     C           HMBH2A    REDPEBPACHDO                  35               124140
     C                     ENDIF                                          124140
     C           *IN35     IFEQ '1'                                       124140
     C           *IN35     OREQ '0'                                       124140
     C           HBCTP     ANDNE'MM'                                      124140
     C           *IN35     OREQ '0'                                       124140
     C           RECI      ANDNE'*'                                       124140
     C                     Z-ADD0         HBCED                           124140
     C                     ENDIF                                          124140
     C*
     C**  Read previous book position unaffected
     C*
     C           *IN01     IFEQ '1'                                       S01158
     C                     MOVE BBSS      SVBPSC                          S01158
     C***********          MOVE BBBR      SVBPBR                    S01158S01117
     C                     MOVE BBBA      SVBPBA                          S01117
     C                     MOVE BBBK      SVBPBK                          S01158
     C                     MOVE BBMK      SVBPMK                          S01158
     C                     MOVE TRDVAL    SVBPTV                          S01158
     C           BKPKC     SETLLBKPOSDF                                   S01158
     C                     END                                            S01158
     C           *IN02     IFEQ '1'                                       S01158
     C           *IN03     OREQ '1'                                       S01158
     C                     MOVE BCSS      SVBPSC                          S01158
     C***********          MOVE BCBR      SVBPBR                    S01158S01117
     C                     MOVE BCBA      SVBPBA                          S01117
     C                     MOVE BCBO      SVBPBK                          S01158
     C                     MOVE BCMK      SVBPMK                          S01158
     C                     MOVE TRDVAL    SVBPTV                          S01158
     C           BKPKD     SETLLBKPOSDF                                   S01158
     C                     END                                            S01158
     C                     READPBKPOSDF                  34
     C************IN34     IFEQ '0'                                       E20587
     C***********BPSC      ANDEQSVBPSC                                    E20587
     C***********BPBR      ANDEQSVBPBR                                    E20587
     C***********BPBK      ANDEQSVBPBK                                    E20587
     C***********BPMK      ANDEQSVBPMK                                    E20587
     C***********BPTV      ANDEQSVBPTV                                    E20587
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  BROUGHT FORWARD LINE                                         *
      *                                                               *
      *****************************************************************
      *
     C           *IN34     IFEQ '1'                                       E20587
     C           BPSC      ORNE SVBPSC                                    E20587
     C***********BPBR      ORNE SVBPBR                              E20587S01117
     C           BPBA      ORNE SVBPBA                                    S01117
     C           BPBK      ORNE SVBPBK                                    E20587
     C           BPMK      ORNE SVBPMK                                    E20587
     C           BPTV      ORNE SVBPTV                                    E20587
     C           NPSN      OREQ *ZEROS                                    E20587
     C*                                                                   E20587
     C**  If no previous record found or B/F position flat,               E20587
     C**  price defaults to zero                                          E20587
     C*                                                                   E20587
     C                     MOVE *ZEROS    NPSN                            E20587
     C                     MOVE *BLANKS   AVGPRC                          E20587
     C                     MOVE '0000000 'WORK11 11                       E20587
     C                     MOVEL'0.0'     WORK11                          E20587
     C                     MOVE WORK11    AVGPRC                          E20587
     C*                                                                   E36263
     C**  Use percentage price if yield/discount traded security          E36263
     C*                                                                   E36263
     C           *IN42     IFEQ '1'                                       E36263
     C                     MOVE *BLANKS   BFPPR                           E36263
     C                     MOVE WORK11    BFPPR                           E36263
     C                     END                                            E36263
     C                     ELSE                                           E20587
     C*                                                                   E20587
     C**  B/F Price
     C*
     C***For*a*b/f*position of zero set the average price to zero. E15840 E20587
     C***********                                                  E15840 E20587
     C***********NPSN      IFEQ 0                                  E15840 E20587
     C***********          Z-ADD0         APPB                     E15840 E20587
     C***********          END                                     E15840 E20587
     C***********                                                  E15840 E20587
     C***********          Z-ADDAPPB      ZPRICE                          E20125
     C***********          Z-ADDBPPD      ZFDATE                          E20125
AB   C***********          EXSR ZNCD                                      E20125
     C***********          EXSR ZPRCO                                     E20125
     C***********                                                  E20236 E20576
     C***********          Z-ADDAPPB      ZPRICE                   E20236 E20576
     C***********          Z-ADDBPPD      ZFDATE                   E20236 E20576
AB   C***********          EXSR ZNCD                               E20236 E20576
     C***********          EXSR ZPRCO                              E20236 E20576
     C                     Z-ADD*ZEROS    ZFLD15                          E20236
     C************IN30     IFEQ '1'                                E20576 E21027
     C***********          MOVE ZPRCOT    ZFLD15                   E20125 E20576
     C***********          MOVE ZPRCOT    ZFLD15                   E20236 E20576
     C/COPY WNCPYSRC,SE0720C013
     C           *IN42     IFEQ '1'                                       E36263
     C*                                                                   124140
     C           HBCED     IFLT BPPD                                      124140
     C                     MOVE APPB      ZFLD15                          E20125
     C                     ELSE                                           124140
     C                     MOVE HBCPR     ZFLD15                          124140
     C                     END                                            124140
     C*                                                                   124140
     C                     Z-ADD8         ZDECS
     C***********          MOVE 'J'       ZECODE                          E15305
     C                     MOVE 'L'       ZECODE                          E15305
     C                     EXSR ZSEDIT
     C                     MOVE *BLANKS   BFPPR                           E36263
     C                     MOVE ZOUT21    BFPPR                           E36263
     C                     MOVE *BLANKS   ZFLD15                          E36263
     C                     END                                            E36263
     C*                                                                   E36263
     C** B/F Price - Express as Price/Discount/Yield                      E36263
     C*                                                                   E36263
     C           HBCED     IFLT BPPD                                      124140
     C                     Z-ADDAPPB      ZPRICE                          E36263
     C                     Z-ADDBPPD      ZFDATE                          E36263
     C                     ELSE                                           124140
     C                     Z-ADDHBCPR     ZPRICE                          124140
     C                     Z-ADDHBCED     ZFDATE                          124140
     C                     END                                            124140
     C*                                                                   124140
     C                     Z-ADDZFDATE    ECD                             E36263
     C                     EXSR ZNCD                                      E36263
     C                     EXSR ZPRCO                                     E36263
     C/COPY WNCPYSRC,SE0720C001
     C*                                                                   E36263
     C** Convert to output format                                         E36263
     C*                                                                   E36263
     C                     MOVE ZPRCOT    ZFLD15                          E36263
     C                     Z-ADD8         ZDECS                           E36263
     C                     MOVE 'L'       ZECODE                          E36263
     C                     EXSR ZSEDIT                                    E36263
     C                     MOVE ZOUT21    AVGPRC
     C*                                                                   E20587
     C************         END                                     E20576 E21027
     C                     END                                            E20587
     C*
     C**  B/F Nominal
     C*
     C                     MOVE *BLANKS   ZFLD15
     C                     Z-ADDNPSN      ZFLD15
     C                     Z-ADDNMDP      ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    NOMPOS
     C*
     C**  B/F Position
     C*
     C           NPSN      IFGT *ZEROS
     C                     MOVE 'LONG '   BFPOSN
     C                     ELSE
     C           NPSN      IFEQ *ZEROS
     C                     MOVE 'FLAT '   BFPOSN
     C                     ELSE
     C                     MOVE 'SHORT'   BFPOSN
     C                     END
     C                     END
     C*
     C**  B/F Consideration
     C*
     C***********          Z-ADD*ZEROS    WCONS  150                      E20656
     C***********          Z-ADD*ZEROS    WCONS0 150                      E20656
     C***********          Z-ADD*ZEROS    WCONS1 151                      E20656
     C***********          Z-ADD*ZEROS    WCONS2 152                      E20656
     C***********          Z-ADD*ZEROS    WCONS3 153                      E20656
     C***********          MOVEA'0000'    *IN,25                          E20656
     C***********25        ADD  CDP       J       20                      E20656
     C***********          MOVEA'1'       *IN,J                           E20656
     C***25******NPSN      MULT APPB      WCONS0                          E20656
     C***26******NPSN      MULT APPB      WCONS1                          E20656
     C***27******NPSN      MULT APPB      WCONS2                          E20656
     C***28******NPSN      MULT APPB      WCONS3                          E20656
     C***********                                                         E20656
     C**If*Price*Basis*'P',*divide*by*100******************************   E20656
     C***********                                                         E20656
     C***********SPBS      IFEQ 'P'                                       E20656
     C***25******          DIV  100       WCONS0                          E20656
     C***26******          DIV  100       WCONS1                          E20656
     C***27******          DIV  100       WCONS2                          E20656
     C***28******          DIV  100       WCONS3                          E20656
     C***********          END                                            E20656
     C***********                                                         E20656
     C***********PROT      IFEQ '8'                                       E20657
     C***25******          MULT CFCT      WCONS0    H                     E20657
     C***26******          MULT CFCT      WCONS1    H                     E20657
     C***27******          MULT CFCT      WCONS2    H                     E20657
     C***28******          MULT CFCT      WCONS3    H                     E20657
     C***********          END                                            E20657
     C***********                                                         E20656
     C***25******          MOVE WCONS0    WCONS                           E20656
     C***26******          MOVE WCONS1    WCONS                           E20656
     C***27******          MOVE WCONS2    WCONS                           E20656
     C***28******          MOVE WCONS3    WCONS                           E20656
     C***********                                                         E20656
     C****Allow*for*nominal*decimal*places*****************************   E20656
     C***********                                                         E20656
     C***********5         SUB  NMDP      DC      10                      E20656
     C***********WCONS     MULT POWER8,DC WCONS                           E20656
     C*                                                                   E20656
     C           HBCED     IFLT BPPD                                      124140
     C                     Z-ADDAPPB      ZPRC                            E20656
     C                     ELSE                                           124140
     C                     Z-ADDHBCPR     ZPRC                            124140
     C                     END                                            124140
     C*                                                                   124140
     C                     Z-ADDNPSN      ZNOML                           E20656
     C                     Z-ADDCDP       ZCDP                            S01117
     C                     EXSR ZCNSD                                     E20656
     C                     Z-ADDZCONS     WCONS                           E20656
     C*                                                                   E20656
     C           PROT      IFEQ '8'                                       E20657
     C/COPY WNCPYSRC,SE0720C015
     C           SEKEY1    KLIST                                                              247396
     C                     KFLD           SDSN                                                247396
     C                     KFLD           SDET                                                247396
     C                     KFLD           SDED                                                247396
      *                                                                                       247396
     C                     MOVE SESN      SDSN                                                247396
     C                     MOVE 'MP'      SDET                                                247396
     C                     Z-ADDRUND      SDED                                                247396
      *                                                                                       247396
     C           SEKEY1    SETLLSEDEVDO                                                       247396
     C                     READ SEDEVDO                  89                                   247396
      *                                                                                       247396
     C           *IN89     IFEQ '0'                                                           247396
     C           SDSN      ANDEQSESN                                                          247396
     C           SDET      ANDEQ'MP'                                                          247396
     C                     MULT SDCP      WCONS     H                                         247396
     C                     ELSE                                                               247396
     C                     MULT AAPR      WCONS  150H                     E20657
     C                     ENDIF                                                              247396
      *                                                                                       247396
     C                     END                                            E20657
     C/COPY WNCPYSRC,SE0720C009
      *                                                                                       CSE105
      ** If CSE105 is installed, only perform SR/AMORT if new Trade                           CSE105
      ** Basis is 'B' or 'V'.                                                                 CSE105
      *                                                                                       CSE105
     C           CSE105    IFEQ 'Y'                                                           CSE105
     C           SESVAL    ANDEQ'B'                                                           CSE105
     C           MATY      ANDNE99999                                                         CSE105
     C           NPSN      ANDNE*ZERO                                                         CSE105
     C           MATY      ANDNE*ZERO                                                         CSE105
     C           CSE105    OREQ 'Y'                                                           CSE105
     C           SESVAL    ANDEQ'V'                                                           CSE105
     C           MATY      ANDNE99999                                                         CSE105
     C           NPSN      ANDNE*ZERO                                                         CSE105
     C           MATY      ANDNE*ZERO                                                         CSE105
      *                                                                                       CSE105
     C           STAD      IFEQ 'Y'                                                           CSE105
     C           STAD      OREQ 'C'                                                           CSE105
     C           STBS      OREQ 'D'                                                           CSE105
     C           GDPK      ANDEQ'Y'                                                           CSE105
      *                                                                                       CSE105
     C                     Z-ADD0         BUDU                                                CSE105
     C           5         SUB  NMDP      DC      10                                          CSE105
     C                     ADD  CDP       DC                                                  CSE105
     C           NPSN      MULT POWER8,DC WORK   150                                          CSE105
     C           WORK      SUB  WCONS     BUDU                                                CSE105
      *                                                                                       CSE105
     C                     EXSR AMORT                                                         CSE105
      *                                                                                       CSE105
     C                     ADD  WADP      WCONS                                               CSE105
     C**********           Z-ADDWCONS     ZAPNC  150                                 CSE105 MD050604
     C                     Z-ADDWCONS     ZAPNC                                             MD050604
     C                     Z-ADDNPSN      ZNOML                                               CSE105
     C                     EXSR ZAVPR                                                         CSE105
     C                     Z-ADDZPRC      APPB                                                CSE105
      *                                                                                       CSE105
     C                     ENDIF                                                              CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
      ** ...no need to condition to SESVAL for CSE105.                                        CSE105
      *                                                                                       CSE105
     C           MATY      IFNE *ZERO                                                         CSE105
     C           MATY      ANDNE99999                                                         CSE105
     C           NPSN      ANDNE*ZERO                                                         CSE105
     C           CSE105    ANDEQ'Y'                                                           CSE105
      *                                                                                       CSE105
     C           STAD      IFEQ 'Y'                                                           CSE105
     C           STAD      OREQ 'C'                                                           CSE105
     C           STBS      OREQ 'D'                                                           CSE105
     C           GDPK      ANDEQ'Y'                                                           CSE105
      *                                                                                       CSE105
      ** B/F Price                                                                            CSE105
      *                                                                                       CSE105
     C                     Z-ADDAPPB      ZPRICE                                              CSE105
     C   01                Z-ADDBBAD      ZFDATE                                              CSE105
     C   02                Z-ADDBCAD      ZFDATE                                              CSE105
     C   03                Z-ADDBCAD      ZFDATE                                              CSE105
      *                                                                                       CSE105
     C                     EXSR ZPRCO                                                         CSE105
     C*                                                                                       CSE105
     C                     Z-ADD*ZEROS    ZFLD15                                              CSE105
     C                     MOVE ZPRCOT    ZFLD15                                              CSE105
     C                     Z-ADD8         ZDECS                                               CSE105
     C                     MOVE 'L'       ZECODE                                              CSE105
     C                     EXSR ZSEDIT                                                        CSE105
     C                     MOVE ZOUT21    AVGPRC                                              CSE105
      *                                                                                       CSE105
     C                     ENDIF                                                              CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
      ** Do this only if CSE105 is *ON.                                                       CSE105
      *                                                                                       CSE105
     C           CSE105    IFEQ 'Y'                                                           CSE105
      *                                                                                       CSE105
     C                     ADD  WCONS     AMVAL                                               CSE105
      *                                                                                       CSE105
      ** Output brought forward date.                                                         CSE105
      *                                                                                       CSE105
     C           NPSN      IFNE *ZERO                                                         CSE105
     C                     Z-ADDZFDATE    ZDAYNO                                              CSE105
     C                     EXSR ZDATE2                                                        CSE105
     C                     MOVE ZADATE    BFDAT                                               CSE105
     C                     ELSE                                                               CSE105
     C                     MOVE *BLANKS   BFDAT                                               CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
     C*                                                                   E20657
     C                     Z-ADDWCONS     ZFLD15
     C                     Z-ADDCDP       ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    PRVCON
     C*
     C***********          ELSE                                           E20587
     C***********                                                         E20587
     C**If*no*previous*record*found,*default*to*zero*******************   E20587
     C***********                                                         E20587
     C***********          MOVE *BLANKS   AVGPRC                          E20587
     C***********          MOVE *BLANKS   NOMPOS                          E20587
     C***********          MOVE *BLANKS   PRVCON                          E20587
     C***********          MOVE '0000000 'WORK11 11                       E20587
     C***********          MOVEL'0.0'     WORK11                          E20587
     C***********          MOVE WORK11    AVGPRC                          E20587
     C***********          MOVE WORK11    NOMPOS                          E20587
     C***********          MOVE 'FLAT '   BFPOSN                          E20587
     C***********          MOVE WORK11    PRVCON                          E20587
     C***********          END                                            E20587
     C*
     C**  Print B/F line
     C*
     C                     WRITEBFWD1
     C***********          ADD  4         LCOUNT                    S01158E21533
     C                     ADD  3         LCOUNT                          E21533
     C           *IN42     IFEQ '1'                                       E36263
     C                     ADD  1         LCOUNT                          E36263
     C                     END                                            E36263
     C                     MOVE '1'       BF      1                       S01158
      *
      *****************************************************************
      /EJECT
      *****************************************************************   E20608
      ***********                                                     *   E20608
      ***ADJUSTED*BROUGHT*FORWARD*LINE*********************************   E20608
      ***********                                                     *   E20608
      *****************************************************************   E20608
      ***********                                                         E20608
     C**Only*print*if*adjusted*indicator*is*'Y'************************   E20608
     C***********                                                         E20608
     C***********ADJI      IFEQ 'Y'                                       E20608
     C***********                                                         E20608
     C**Adjusted*B/F*Price*********************************************   E20608
     C***********                                                         E20608
     C***********          Z-ADDAAPR      ZPRICE                   E20125 E20608
     C***********          Z-ADDBPPD      ZFDATE                   E20125 E20608
AB   C***********          EXSR ZNCD                               E20125 E20608
     C***********          EXSR ZPRCO                              E20125 E20608
     C***********                                                  E20236 E20608
     C***********          Z-ADDAAPR      ZPRICE                   E20236 E20608
     C***********          Z-ADDBPPD      ZFDATE                   E20236 E20608
AB   C***********          EXSR ZNCD                               E20236 E20608
     C***********          EXSR ZPRCO                              E20236 E20608
     C***********          Z-ADD*ZEROS    ZFLD15                          E20608
     C***********          MOVE ZPRCOT    ZFLD15                   E20125 E20608
     C***********          MOVE ZPRCOT    ZFLD15                   E20236 E20608
     C***********          MOVE AAPR      ZFLD15            E20125 E20236 E20608
     C***********          Z-ADD8         ZDECS                           E20608
     C***********          MOVE 'J'       ZECODE                   E15305 E20608
     C***********          MOVE 'L'       ZECODE                   E15305 E20608
     C***********          EXSR ZSEDIT                                    E20608
     C***********          MOVE ZOUT21    ADJAVP                          E20608
     C***********                                                         E20608
     C**Adjusted*B/F*Nominal*******************************************   E20608
     C***********                                                         E20608
     C***********          MOVE *BLANKS   ZFLD15                          E20608
     C***********          MOVE ANMP      ZFLD15                          E20608
     C***********          Z-ADDNMDP      ZDECS                           E20608
     C***********          MOVE 'J'       ZECODE                          E20608
     C***********          EXSR ZSEDIT                                    E20608
     C***********          MOVE ZOUT21    ADJNOM                          E20608
     C***********                                                         E20608
     C**Adjusted*B/F*Position******************************************   E20608
     C***********                                                         E20608
     C***********ANMP      IFGT *ZEROS                                    E20608
     C***********          MOVE 'LONG '   ADJPOS                          E20608
     C***********          ELSE                                           E20608
     C***********ANMP      IFEQ *ZEROS                                    E20608
     C***********          MOVE 'FLAT '   ADJPOS                          E20608
     C***********          ELSE                                           E20608
     C***********          MOVE 'SHORT'   ADJPOS                          E20608
     C***********          END                                            E20608
     C***********          END                                            E20608
     C***********                                                         E20608
     C**Adjusted*B/F*Consideration*************************************   E20608
     C***********                                                         E20608
     C***********ANMP      MULT AAPR      RESULT 150H                     E20608
     C***********          Z-ADDRESULT    ZFLD15                          E20608
     C***********          Z-ADDCDP       ZDECS                           E20608
     C***********          MOVE 'J'       ZECODE                          E20608
     C***********          EXSR ZSEDIT                                    E20608
     C***********          MOVE ZOUT21    ADJCON                          E20608
     C***********                                                         E20608
     C**Print*adjusted*B/F*line****************************************   E20608
     C***********                                                         E20608
     C***********          WRITEBFWD2                                     E20608
     C***********          ADD  2         LCOUNT                          E20608
     C***********                                                         E20608
     C***********          END                                            E20608
     C*
     C   L1                END
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  TRADE ACTION DETAIL RECORDS                                  *
      *                                                               *
      *****************************************************************
      *
     C***01******BBAS      COMP '10'                     51               E18652
     C***02******BCAS      COMP '10'                     51               E18652
     C***03******BCAS      COMP '10'                     51        S01158 E18652
     C   01      BBAS      COMP '40'                     51               E18652
     C   02      BCAS      COMP '40'                     51               E18652
     C   03      BCAS      COMP '40'                     51               E18652
     C           *IN51     IFEQ '1'
     C*
     C**  Fetch Customer Report name and town
     C*
     C           TRCP      CHAINCLINTCBF             33
     C           *IN33     IFEQ '1'
     C                     MOVE *BLANKS   CRNM
     C                     MOVE *BLANKS   CTWN
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0720CCP4                                           S01408
     C*                                                                   S01408
     C                     END
     C*
      **  IF REVERSED, SET CANCELLATION FLAG
      *
     C           *IN01     IFEQ '1'
     C           BBRI      ANDEQ'Y'
     C           *IN02     OREQ '1'
     C           BCRV      ANDEQ'Y'
     C           *IN03     OREQ '1'                                       S01158
     C           BCRV      ANDEQ'Y'                                       S01158
     C                     MOVE 'C'       CFLAG
     C                     ELSE
     C                     MOVE ' '       CFLAG
     C                     END
     C*
     C**  Trade date
     C*
     C   01                Z-ADDBBAD      ZDAYNO
     C   02                Z-ADDBCAD      ZDAYNO
     C   03                Z-ADDBCAD      ZDAYNO                          S01158
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    TRDDAT
     C*
     C**  Value date
     C*
     C   01                Z-ADDBBOD      ZDAYNO
     C   02                Z-ADDBCOT      ZDAYNO
     C   03                Z-ADDBCOT      ZDAYNO                          S01158
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    VALDAT
      *                                                                   S01117
      ** Profit Centre                                                    S01117
      *                                                                   S01117
      ** ...if used                                                       S01117
      *                                                                   S01117
     C           BKPRCU    IFEQ 'Y'                                       S01117
      *                                                                   S01117
      ** If book position action is trade action then retrieve profit     S01117
      ** centre from associated trade.                                    S01117
      *                                                                   182960
      **  If Chain to Trades file failed, chain to CNCTRD for records     182960
      **  that were earlier dropped.                                      182960
      *                                                                   S01117
     C           BCAS      IFEQ '40'                                      S01117
     C           *IN02     ANDEQ'1'                                       CAC002
     C           BCAS      OREQ '40'                                      CAC002
     C           *IN03     ANDEQ'1'                                       CAC002
     C           BBAS      OREQ '40'                                      CAC002
     C           *IN01     ANDEQ'1'                                       CAC002
      *                                                                   CAC002
      *                                                                   CAC002
     C           BCAS      IFEQ '40'                                      CAC002
     C           *IN02     ANDEQ'1'                                       CAC002
     C           BCAS      OREQ '40'                                      CAC002
     C           *IN03     ANDEQ'1'                                       CAC002
     C***********BCTR      CHAINTRADSDF              33            S01117 083223
     C           BCTR      CHAINTRADHS               33                   083223
     C   33      BCTR      CHAINCNCTRDF              33                   182960
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
      *                                                                   141659
      **  If chain to trades file failed, chain to CNCTRD for records     141659
      **  that were earlier dropped.                                      141659
      *                                                                   141659
     C           BBAS      IFEQ '40'                                      CAC002
     C           *IN01     ANDEQ'1'                                       CAC002
     C           BBTR      CHAINTRADHS               33                   CAC002
     C   33      BBTR      CHAINCNCTRDF              33                   182960
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C**N33******RECI      COMP '*'                      33        S01117 127967
     C           *IN33     IFEQ '1'                                       S01117
     C********** BCTR      CHAINCNCTRDF              33                                141659 182960
     C********** *IN33     IFEQ '1'                                                    141659 182960
     C           *LOCK     IN   LDA                                       S01117
     C                     SETON                     U7U8                 S01117
     C                     Z-ADD7         DBASE            ***************S01117
     C                     MOVEL'TRADS'   DBFILE           * DB ERROR 07 *S01117
     C           *IN01     IFNE '1'                        *             *182960
     C                     MOVELBCTR      DBKEY            ***************S01117
     C                     ELSE                                           182960
     C                     MOVELBBTR      DBKEY                           182960
     C                     ENDIF                                          182960
      *                                                                   182960
     C                     WRITEHEADAU                                    S01117
     C                     WRITEERROR                                     S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     SETON                     LR                   S01117
     C                     RETRN                                          S01117
     C**********           ENDIF                                                       141659 182960
     C                     END                                            S01117
     C*                                                                   CAC002
     C**  If Analytical Accounting is installed, use the booking profit   CAC002
     C**  centre on the report.                                           CAC002
     C*                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE BPRC      PRFC                            CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C                     ELSE                                           S01117
     C                     MOVE *BLANKS   PRFC                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*
     C*****Express*Contract*price*as*Price/Discount/Yield**************   E20236
     C*                                                                   E20236
     C* Output Trade price (which is a Price/Discount/Yield)              E20236
     C*  (Therefore do not reverse this part of E20125)                   E20236
     C*                                                                   E20236
     C***********          Z-ADDCNTP      ZPRICE                          E20125
     C***01******          Z-ADDBBAD      ZFDATE                          E20125
     C***02******          Z-ADDBCAD      ZFDATE                          E20125
     C***03******          Z-ADDBCAD      ZFDATE                   S01158 E20125
AB   C***********          EXSR ZNCD                                      E20125
     C***********          EXSR ZPRCO                                     E20125
     C*
     C* Format for printing
     C*
     C***********          Z-ADD*ZEROS    ZFLD15                          E21002
     C***********          MOVE ZPRCOT    ZFLD15                          E20125
     C***********          MOVE CNTP      ZFLD15                    E20125E20236
     C***********          MOVE BCTD      ZFLD15                    E20236E20451
     C***01******          MOVE BBTP      ZFLD15                    E20451E20571
     C***01******          MOVE BBPT      ZFLD15                    E20571E21002
     C***02******          MOVE BCTD      ZFLD15                    E20451E21002
     C***03******          MOVE BCTD      ZFLD15                    E20451E21002
     C*                                                                   E21002
     C** USE CONTRACT PRICE                                               E21002
     C*                                                                   E21002
     C                     Z-ADDCNTP      ZPRICE                          E21002
     C   01                Z-ADDBBOD      ZFDATE                          E21002
     C   02                Z-ADDBCOT      ZFDATE                          E21002
     C   03                Z-ADDBCOT      ZFDATE                          E21002
     C                     Z-ADDZFDATE    ECD     50                      E21002
     C                     EXSR ZNCD                                      E21002
     C*                                                                   E21002
     C** If an Australian Yield Security - set up parameters              E21002
     C*                                                                   E21002
     C           *IN41     IFEQ '1'                                       E21002
     C           BBNM      IFNE 0                                         E21002
     C           BCNL      ORNE 0                                         E21002
     C   01      PCHI      DIV  BBNM      WRKPI                           E21002
     C   02      PCHI      DIV  BCNL      WRKPI                           E21002
     C   03      PCHI      DIV  BCNL      WRKPI                           E21002
     C                     ELSE                                           E21002
     C                     Z-ADD0         WRKPI                           E21002
     C                     END                                            E21002
     C***********          MOVE ACRI      SCUMEX                    E21002E39495
     C                     END                                            E21002
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0720CCP2                                           S01408
     C*                                                                   S01408
     C*                                                                   E39495
     C                     MOVE ACRI      SCUMEX                          E39495
     C   01                Z-ADDBBNM      ZNOML                           E39495
     C   02                Z-ADDBCNL      ZNOML                           E39495
     C   03                Z-ADDBCNL      ZNOML                           E39495
     C*                                                                   E21002
     C                     EXSR ZPRCO                                     E21002
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0720CCP3                                           S01408
     C*                                                                   S01408
     C*                                                                   E21002
     C                     Z-ADD*ZEROS    ZFLD15                          E21002
     C                     MOVE ZPRCOT    ZFLD15                          E21002
     C                     Z-ADD8         ZDECS
     C***********          MOVE 'J'       ZECODE                          E15305
     C                     MOVE 'L'       ZECODE                          E15305
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    PRICE
     C*
     C**  Nominal
     C*
     C   01                Z-ADDBBNM      ZFLD15
     C   02                Z-ADDBCNL      ZFLD15
     C   03                Z-ADDBCNL      ZFLD15                          S01158
     C                     Z-ADDNMDP      ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    NOMNAL
     C*
     C**  Bought/Sold
     C*
     C           *IN01     IFEQ '1'
     C           BBPS      IFEQ 'P'
     C                     MOVE 'BOUGHT'  TRACTN
     C                     ELSE
     C           BBPS      IFEQ 'S'
     C                     MOVE 'SOLD  '  TRACTN
     C                     END
     C                     END
      *                                                                   E21521
      **  Accumulate today's profit                                       E21521
      *                                                                   E21521
     C           BBRI      IFEQ 'Y'                                       E21521
     C                     SUB  BBPL      CFRPTP                          E21521
     C                     ELSE                                           E21521
     C                     ADD  BBPL      CFRPTP                          E21521
     C                     END                                            E21521
      *                                                                   E21521
     C                     ELSE
     C           *IN02     IFEQ '1'
     C           *IN03     OREQ '1'                                       S01158
     C           BCPS      IFEQ 'P'
     C                     MOVE 'BOUGHT'  TRACTN
     C                     ELSE
     C***********BCPS      IFEQ 'TS'                                      E13911
     C           BCPS      IFEQ 'S'                                       E13911
     C                     MOVE 'SOLD  '  TRACTN
     C                     END
     C                     END
      *                                                                   E21521
      **  Accumulate today's profit                                       E21521
      *                                                                   E21521
     C           BCRV      IFEQ 'Y'                                       E21521
     C                     SUB  BCPL      CFRPTP                          E21521
     C                     ELSE                                           E21521
     C                     ADD  BCPL      CFRPTP                          E21521
     C                     END                                            E21521
      *                                                                   E21521
     C                     END
     C                     END
     C*
     C**  Consideration
     C*
     C***********          Z-ADD0         ZFLD15                          E21002
     C***01******          MOVE BBCN      ZFLD15                          E21002
     C***02******          MOVE BCCN      ZFLD15                          E21002
     C***03******          MOVE BCCN      ZFLD15                          S01158
     C*                                                                   E20657
     C                     Z-ADDCNTP      ZPRC                            E21002
     C   01                Z-ADDBBNM      ZNOML                           E21002
     C   02                Z-ADDBCNL      ZNOML                           E21002
     C   03                Z-ADDBCNL      ZNOML                           E21002
     C                     Z-ADDCDP       ZCDP                            S01117
     C                     EXSR ZCNSD                                     E21002
     C                     Z-ADDZCONS     ZFLD15                          E21002
     C/COPY WNCPYSRC,SE0720C010
      *                                                                                       CSE105
      ** If CSE105 is *ON and trade is not deleted, update amortisation                       CSE105
      ** value.                                                                               CSE105
      *                                                                                       CSE105
     C           CSE105    IFEQ 'Y'                                                           CSE105
     C           CFLAG     ANDNE'C'                                                           CSE105
      *                                                                                       CSE105
     C           TRACTN    IFEQ 'BOUGHT'                                                      CSE105
     C                     ADD  ZCONS     AMVAL                                               CSE105
     C                     ELSE                                                               CSE105
     C                     SUB  ZCONS     AMVAL                                               CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
     C*                                                                   E21002
     C           PROT      IFEQ '8'                                       E20657
     C/COPY WNCPYSRC,SE0720C016
     C   01                MULT BBCF      ZFLD15    H                     E20657
     C   02                MULT BCCF      ZFLD15    H                     E20657
     C   03                MULT BCCF      ZFLD15    H                     E20657
     C                     END                                            E20657
     C*                                                                   E20657
     C                     Z-ADDCDP       ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    CONSID
     C*
     C**  Print Trade action detail line
     C*
      ***  Since program now checks line counter before printing C/F      E21533
      ***  and Profit lines, details may print to bottom of page.         E21533
     C*
     C***********LCOUNT    IFGE 56                                 S01158 E21533
     C           LCOUNT    IFGE 60                                        E21533
     C           BF        ANDEQ'0'                                       S01158
     C                     WRITEHEADL5
     C                     WRITEHEADL1
     C***********          Z-ADD15        LCOUNT                          E21533
     C                     Z-ADD13        LCOUNT                          E21533
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     ADD  1         LCOUNT                          CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C                     END
     C*
     C                     WRITEDETL1
     C                     MOVE '0'       BF                              S01158
     C                     ADD  1         LCOUNT
     C*
     C**  Count actions reported
     C*
     C                     ADD  1         ACTNS
     C*
     C                     END
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  PRICE ACTION DETAIL RECORDS                                  *
      *                                                               *
      *****************************************************************
      *
     C   01      BBAS      COMP '60'                     52
     C   02      BCAS      COMP '60'                     52
     C   03      BCAS      COMP '60'                     52               S01158
      *
     C           *IN52     IFEQ '1'
     C*
     C**  Action date
     C*
     C   01                Z-ADDBBOD      ZDAYNO                          E21002
     C   02                Z-ADDBCOT      ZDAYNO                          E21002
     C   03                Z-ADDBCOT      ZDAYNO                          E21002
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    PRCDAT
     C*
     C**  Price
     C*
     C                     Z-ADD*ZEROS    ZFLD15                          E20125
     C           *IN01     IFEQ '1'
     C***********          Z-ADDBBPR      ZPRICE                   E20125 E20572
     C***********          Z-ADDBBAD      ZFDATE                   E20125 E20572
     C***********          Z-ADDBBPR      ZPRICE                   E20236 E20572
     C***********          Z-ADDBBAD      ZFDATE                   E20236 E20572
     C                     MOVE BBPR      ZFLD15                   E20125 E20236
     C                     ELSE
     C           *IN02     IFEQ '1'
     C           *IN03     OREQ '1'                                       S01158
     C***********          Z-ADDBCPR      ZPRICE                   E20125 E20572
     C***********          Z-ADDBCAD      ZFDATE                   E20125 E20572
     C***********          Z-ADDBCPR      ZPRICE                   E20236 E20572
     C***********          Z-ADDBCAD      ZFDATE                   E20236 E20572
     C                     MOVE BCPR      ZFLD15                   E20125 E20236
     C                     END
     C                     END
AB   C***********          EXSR ZNCD                               E20125 E20572
     C***********          EXSR ZPRCO                              E20125 E20572
AB   C***********          EXSR ZNCD                               E20236 E20572
     C***********          EXSR ZPRCO                              E20236 E20572
     C*
     C**  Format for printing
     C*
     C***********          Z-ADD*ZEROS    ZFLD15                   E20125 E20572
     C***********          MOVE ZPRCOT    ZFLD15                   E20125 E20572
     C***********          Z-ADD*ZEROS    ZFLD15                   E20236 E20572
     C***********          MOVE ZPRCOT    ZFLD15                   E20236 E20572
     C                     Z-ADD8         ZDECS
     C***********          MOVE 'J'       ZECODE                          E15305
     C                     MOVE 'L'       ZECODE                          E15305
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    PRCCHG
     C*
     C**  Print Price action detail line
     C*
      ***  Since program now checks line counter before printing C/F      E21533
      ***  and Profit lines, details may print to bottom of page.         E21533
     C*
     C***********LCOUNT    IFGE 50                                 S01158 E21533
     C           LCOUNT    IFGE 60                                        E21533
     C           BF        ANDEQ'0'                                       S01158
     C                     WRITEHEADL5
     C                     WRITEHEADL1
     C***********          Z-ADD15        LCOUNT                          E21533
     C                     Z-ADD13        LCOUNT                          E21533
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     ADD  1         LCOUNT                          CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C                     END
     C*
     C                     WRITEPRCHG1
     C                     ADD  1         LCOUNT
     C                     MOVE '0'       BF                              S01158
     C*
     C**  Count actions reported
     C*
     C                     ADD  1         ACTNS
     C*
     C                     END
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  CARRIED FORWARD LINE                                         *
      *                                                               *
      *****************************************************************
      *
     CL1                   DO
      *
     CL0         READS     IFGT *ZERO
      *                                                                   E15840
     C***For*a*c/f*position of zero set the average price to zero. E15840 E20587
     C*************                                                E15840 E20587
     C*L0********CFNPSN    IFEQ 0                                  E15840 E20587
     C*L0**********        Z-ADD0         LAVP                     E15840 E20587
     C*L0**********        END                                     E15840 E20587
     C*************                                                E15840 E20587
     C*                                                                   E20587
     CL0         CFNPSN    IFEQ *ZEROS                                    E20587
     C*                                                                   E20587
     C**  If C/F position is FLAT, price defaults to zero                 E20587
     C*                                                                   E20587
     CL0                   MOVE *BLANKS   CFPRC                           E20587
     CL0                   MOVE '0000000 'WORK11 11                       E20587
     CL0                   MOVEL'0.0'     WORK11                          E20587
     CL0                   MOVE WORK11    CFPRC                           E20587
     C*                                                                   E33532
     C**  Use percentage price if yield/discount traded security          E33532
     C*                                                                   E33532
     CL0         *IN42     IFEQ '1'                                       E33532
     CL0                   MOVE *BLANKS   CFPPR                           E33532
     CL0                   MOVE WORK11    CFPPR                           E33532
     CL0                   END                                            E33532
     CL0                   ELSE                                           E20587
     C*                                                                   E20587
     C**C/F*Price*-*Express*as*Price/Discount/Yield********************   E20576
     C*                                                                   E20576
     C* OUTPUT ONLY IF PRICE BASED                                        E20576
     C*                                                                   E20576
     C***  E20125 was wrongly incorporated - reversed out                 E20236
     C*                                                                   E20576
     C*L0********          Z-ADDLAVP      ZPRICE                          E20125
     C*L0********          Z-ADDLPSD      ZFDATE                          E15965
     C*L0********          Z-ADDLPCD      ZFDATE                   E15965 E20125
AB   C*L0********          EXSR ZNCD                                      E20125
     C*L0********          EXSR ZPRCO                                     E20125
     C***********                                                         E20125
     C*L0********          Z-ADDLAVP      ZPRICE                   E20125 E20576
     C*L0********          Z-ADDLPCD      ZFDATE                   E20125 E20576
AB   C*L0********          EXSR ZNCD                               E20125 E20576
     C*L0********          EXSR ZPRCO                              E20125 E20576
     C*
     C**  Convert to output format
     C*
     C*L0********          MOVE *BLANKS   ZFLD15                          E20576
     C*L0********          MOVE ZPRCOT    ZFLD15                          E20125
     C*L0********          MOVE LAVP      ZFLD15                   E20125 E20236
     C*L0********          MOVE ZPRCOT    ZFLD15                   E20236 E20576
     C***L0******             Z-ADD*ZEROS    ZFLD15                 E20576E33532
     C*L0*********IN30     IFEQ '1'                                E20576 E21027
     C***L0******             MOVE LAVP      ZFLD15                 E20576E33532
     C*                                                                   E33532
     C** C/F Price - Express as Price/Discount/Yield                      E33532
     C*                                                                   E33532
     C/COPY WNCPYSRC,SE0720C014
     CL0                   Z-ADDLAVP      ZPRICE                          E33532
     CL0                   Z-ADDLPCD      ZFDATE                          E33532
     CL0                   Z-ADDZFDATE    ECD                             E33532
     CL0                   EXSR ZNCD                                      E33532
     C/COPY WNCPYSRC,SE0720C002
     CL0                   EXSR ZPRCO                                     E33532
     C/COPY WNCPYSRC,SE0720C003
     C*                                                                   E33532
     C** Convert to output format                                         E33532
     C*                                                                   E33532
     CL0                   MOVE *BLANKS   ZFLD15                          E33532
     CL0                   MOVE ZPRCOT    ZFLD15                          E33532
     CL0                   Z-ADD8         ZDECS
     CL0                   MOVE 'L'       ZECODE
     CL0                   EXSR ZSEDIT
     CL0                   MOVE ZOUT21    CFPRC
     C*L0********          END                                     E20576 E21027
     C*                                                                   E33532
     C**  Use percentage price if yield/discount traded security          E33532
     C*                                                                   E33532
     CL0         *IN42     IFEQ '1'                                       E33532
     CL0                   Z-ADD*ZEROS    ZFLD15                          E33532
     CL0                   MOVE LAVP      ZFLD15                          E33532
     CL0                   Z-ADD8         ZDECS                           E33532
     CL0                   MOVE 'L'       ZECODE                          E33532
     CL0                   EXSR ZSEDIT                                    E33532
     CL0                   MOVE *BLANKS   CFPPR                           E33532
     CL0                   MOVE ZOUT21    CFPPR                           E33532
     CL0                   END                                            E33532
     CL0                   END                                            E20587
     C*
     C**  C/F Nominal position
     C*
     CL0                   Z-ADDCFNPSN    ZFLD15
     CL0                   Z-ADDNMDP      ZDECS
     CL0                   MOVE 'J'       ZECODE
     CL0                   EXSR ZSEDIT
     CL0                   MOVE ZOUT21    CFNOM
     C*
     C**  C/F Position
     C*
     CL0         CFNPSN    IFGT *ZEROS
     CL0                   MOVE 'LONG '   CFPOSN
     CL0                   ELSE
     CL0         CFNPSN    IFEQ *ZEROS
     CL0                   MOVE 'FLAT '   CFPOSN
     CL0                   ELSE
     CL0                   MOVE 'SHORT'   CFPOSN
     CL0                   END
     CL0                   END
     C*
     C**  C/F Consideration
     C*                                                                   E20656
     C*L0********          Z-ADD*ZEROS    WCONS  150                      E20656
     C*L0********          Z-ADD*ZEROS    WCONS0 150                      E20656
     C*L0********          Z-ADD*ZEROS    WCONS1 151                      E20656
     C*L0********          Z-ADD*ZEROS    WCONS2 152                      E20656
     C*L0********          Z-ADD*ZEROS    WCONS3 153                      E20656
     C*L0********          MOVEA'0000'    *IN,25                          E20656
     C*L0********25        ADD  CDP       J       20                      E20656
     C*L0********          MOVEA'1'       *IN,J                           E20656
     C***25******CFNPSN    MULT LAVP      WCONS0                          E15305
     C***26******CFNPSN    MULT LAVP      WCONS1                          E15305
     C***27******CFNPSN    MULT LAVP      WCONS2                          E15305
     C***28******CFNPSN    MULT LAVP      WCONS3                          E15305
     C*L025******CFNPSN    MULT LAVP      WCONS0    H              E15305 E20656
     C*L026******CFNPSN    MULT LAVP      WCONS1    H              E15305 E20656
     C*L027******CFNPSN    MULT LAVP      WCONS2    H              E15305 E20656
     C*L028******CFNPSN    MULT LAVP      WCONS3    H              E15305 E20656
     C***********                                                         E20656
     C**If*Price*Basis 'P', divide by 100                                 E20656
     C***********                                                         E20656
     C*L0********SPBS      IFEQ 'P'                                       E20656
     C***25******          DIV  100       WCONS0                          E15305
     C***26******          DIV  100       WCONS1                          E15305
     C***27******          DIV  100       WCONS2                          E15305
     C***28******          DIV  100       WCONS3                          E15305
     C*L025******          DIV  100       WCONS0    H              E15305 E20656
     C*L026******          DIV  100       WCONS1    H              E15305 E20656
     C*L027******          DIV  100       WCONS2    H              E15305 E20656
     C*L028******          DIV  100       WCONS3    H              E15305 E20656
     C*L0********          END                                            E20656
     C***********                                                         E20656
     C*L0********PROT      IFEQ '8'                                       E20657
     C*L025******          MULT CFCT      WCONS0    H                     E20657
     C*L026******          MULT CFCT      WCONS1    H                     E20657
     C*L027******          MULT CFCT      WCONS2    H                     E20657
     C*L028******          MULT CFCT      WCONS3    H                     E20657
     C*L0********          END                                            E20657
     C***********                                                         E20656
     C*L025******          MOVE WCONS0    WCONS                           E20656
     C*L026******          MOVE WCONS1    WCONS                           E20656
     C*L027******          MOVE WCONS2    WCONS                           E20656
     C*L028******          MOVE WCONS3    WCONS                           E20656
     C***********                                                         E20656
     C****Allow*for*nominal*decimal*places*****************************   E20656
     C***********                                                         E20656
     C*L0********5         SUB  NMDP      DC      10                      E20656
     C*0*********WCONS     MULT POWER8,DC WCONS                           E20149
     C*L0********WCONS     MULT POWER8,DC WCONS     H              E20149 E20656
     C*
     CL0                   Z-ADDLAVP      ZPRC                            E20656
     CL0                   Z-ADDCFNPSN    ZNOML                           E20656
     CL0                   Z-ADDCDP       ZCDP                            S01117
     CL0                   EXSR ZCNSD                                     E20656
     CL0                   Z-ADDZCONS     WCONS                           E20656
     C*                                                                   E20656
     CL0         PROT      IFEQ '8'                                       E20657
     C/COPY WNCPYSRC,SE0720C017
     CL0                   MULT CFAAPR    WCONS     H                     E20657
     CL0                   END                                            E20657
     C*                                                                   E20657
     CL0                   Z-ADDWCONS     ZFLD15
     CL0                   Z-ADDCDP       ZDECS
     CL0                   MOVE 'J'       ZECODE
     CL0                   EXSR ZSEDIT
     CL0                   MOVE ZOUT21    CFCON
     C/COPY WNCPYSRC,SE0720C011
      *                                                                                       CSE105
      ** Do this only if CSE105 is *ON...                                                     CSE105
      *                                                                                       CSE105
     CL0         CSE105    IFEQ 'Y'                                                           CSE105
      *                                                                                       CSE105
      **  Calculate closing position                                                          CSE105
      *                                                                                       CSE105
     CL0         AMVAL     ADD  CFRPTP    ZFLD15                                              CSE105
      *                                                                                       CSE105
     CL0         PROT      IFEQ '8'                                                           CSE105
     CL0                   MULT CFAAPR    ZFLD15    H                                         CSE105
     CL0                   ENDIF                                                              CSE105
      *                                                                                       CSE105
     CL0                   Z-ADDCDP       ZDECS                                               CSE105
     CL0                   MOVE 'J'       ZECODE                                              CSE105
     CL0                   EXSR ZSEDIT                                                        CSE105
     CL0                   MOVE ZOUT21    CLCON                                               CSE105
      *                                                                                       CSE105
      ** Print amortisation for today                                                         CSE105
      *                                                                                       CSE105
     CL0                   SUB  WCONS     AMVAL                                               CSE105
     CL0                   ADD  CFRPTP    AMVAL                                               CSE105
      *                                                                                       CSE105
     CL0                   Z-ADDAMVAL     ZFLD15                                              CSE105
     CL0                   Z-SUBZFLD15    ZFLD15                                              CSE105
     CL0                   Z-ADDCDP       ZDECS                                               CSE105
     CL0                   MOVE 'J'       ZECODE                                              CSE105
     CL0                   EXSR ZSEDIT                                                        CSE105
     CL0                   MOVE ZOUT21    AMCON                                               CSE105
      *                                                                                       CSE105
      ** ...Disc/Prem Amortisation Trade Basis must be 'T' or 'B'.                            CSE105
      *                                                                                       CSE105
     CL0         SESVAL    IFNE 'V'                                                           CSE105
      *                                                                                       CSE105
      ** Check if overflow...                                                                 CSE105
      *                                                                                       CSE105
     CL0         LCOUNT    IFGE 55                                                            CSE105
     CL0                   WRITEHEADL5                                                        CSE105
     CL0                   WRITEHEADL1                                                        CSE105
     CL0                   Z-ADD13        LCOUNT                                              CSE105
     CL0                   END                                                                CSE105
      *                                                                                       CSE105
      ** Print Amortisation line.                                                             CSE105
      *                                                                                       CSE105
     CL0         READS     IFGT *ZEROS                                                        CSE105
     CL0                   WRITEAMRT1                                                         CSE105
     CL0                   ENDIF                                                              CSE105
     CL0                   ADD  5         LCOUNT                                              CSE105
      *                                                                                       CSE105
     CL0                   ENDIF                                                              CSE105
      *                                                                                       CSE105
     CL0                   ENDIF                                                              CSE105
      *                                                                                       CSE105
     C*
     C**  Print C/F line
     C*
      **  Must check for overflow here.  Although it's unsightly to       E21533
      **  have a C/F line as the first item on a page, it's preferable    E21533
      **  to an overflow error that halts end of day.                     E21533
      *                                                                   E21533
     CL0         LCOUNT    IFGE 55                                        E21533
     CL0                   WRITEHEADL5                                    E21533
     CL0                   WRITEHEADL1                                    E21533
     CL0                   Z-ADD13        LCOUNT                          E21533
      *                                                                   CAC005
     CL0         CAC005    IFEQ 'Y'                                       CAC005
     CL0                   ADD  1         LCOUNT                          CAC005
     CL0                   ENDIF                                          CAC005
      *                                                                   CAC005
     CL0                   END                                            E21533
     C*                                                                   E21533
     CL0         READS     IFGT *ZERO
     CL0                   WRITECFWD1
     CL0                   END
     CL0                   ADD  6         LCOUNT                          S01158
     CL0         *IN42     IFEQ '1'                                       E36263
     CL0                   ADD  1         LCOUNT                          E36263
     CL0                   END                                            E36263
     CL0                   MOVE '0'       BF                              S01158
     C*
     C**  Today's profit
     C*
     CL0                   Z-ADDCFRPTP    ZFLD15
     CL0                   Z-ADDCDP       ZDECS
     CL0                   MOVE 'J'       ZECODE
     CL0                   EXSR ZSEDIT
     CL0                   MOVE ZOUT21    PRFTDY
     C*
     C**  Month-to-date profit
     C*
     C**L0*******RPTM      ADD  MMPL      ZFLD15                          E21246
     CL0                   Z-ADDRPTM      ZFLD15                          E21246
     CL0                   Z-ADDCDP       ZDECS
     CL0                   MOVE 'J'       ZECODE
     CL0                   EXSR ZSEDIT
     CL0                   MOVE ZOUT21    PRFMTD
     C*
     C**  Print Profit lines
     C*
     C*                                                                   E33529
     C** Only output if profit is calculated on a trade date basis        E33529
     C*                                                                   E33529
     CL0         RPBS      IFNE 'V'                                       E33529
     CL0                   WRITEPROF1
     CL0                   ADD  2         LCOUNT                          109884
     CL0                   END                                            E33529
     C*
     CL0                   END
     C*
     CL1                   END
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  PROFIT LINE                                                  *
      *                                                               *
      *****************************************************************
      *
     CL5                   DO
      *
     CL0         READS     IFGT *ZERO
     CL0         LCOUNT    IFGE 58                                        E20569
     CL0                   WRITEHEADL5                                    E20569
     CL0                   END                                            E20569
     CL0                   WRITETRAIL                                     E20569
     C*
     C**  Close printer file
     C*
     CL0                   CLOSESE0720P1
     CL0                   END
     CL5                   END
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  AUDIT REPORT                                                 *
      *                                                               *
      *****************************************************************
      *
     CLR                   DO
     C*
     C** Get installation Control data record 1 for title if no records
     C** read in
     C*
     CL0         READS     IFEQ *ZERO
     CL0                   EXSR ZSYSTM
     C*
     C**  Error in ZSYSTM
     C*
     CL0         *IN99     IFEQ '1'
     CL0         *LOCK     IN   LDA                                       S01117
     CL0                   MOVEL'1'       *INU8
     CL0                   MOVEL'1'       *INU7
     C**L0*******          MOVEL'01'      DBASE                           E20651
     C**L0*******          MOVEL'06'      DBASE                     E20651S01117
     CL0                   Z-ADD6         DBASE            ***************S01117
     CL0                   MOVEL'TABLE'   DBFILE           * DB ERROR 06 *
     CL0                   MOVELZTABKY    DBKEY            ***************
     CL0                   WRITEHEADAU
     CL0                   WRITEERROR
     C**L0*******          WRITETRAILAU                                   S01117
     CL0                   OUT  LDA                                       S01117
     CL0                   EXSR *PSSR                                     S01117
     CL0                   SETON                     LR
     CL0                   RETRN
     CL0                   END
     C*
     CL0                   END
     C*
     C**  Print Audit Report
     C*
     CL0                   WRITEHEADAU
     CL0                   WRITEDETLAU
     C**L0*******          WRITETRAILAU                                   S01117
     CL0         READS     IFEQ *ZERO                                     E29170
     CL0                   WRITENONE                                      E29170
     CL0                   END                                            E29170
     C*
     CLR                   END
      *
      *****************************************************************
      /EJECT                                                              S01117
      *****************************************************************   S01117
      *                                                               *   S01117
      * *PSSR  - Database error subroutine.                           *   S01117
      *          This subroutine DUMPs the program just once.         *   S01117
      *                                                               *   S01117
      * Called by: DB ERROR PROCESSING                                *   S01117
      *                                                               *   S01117
      * Calls: None                                                   *   S01117
      *                                                               *   S01117
      *****************************************************************   S01117
      *                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR SR ** S01117
      *                                                                   S01117
     C           @RUN      IFEQ *BLANK                                    S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     ENDSR                                          S01117
      *                                                                   S01117
      ********************************************************************S01117
      /EJECT                                                              E29170
      *****************************************************************   E29170
      *                                                               *   E29170
      *  RCFP1 -- SUBROUTINE TO REGISTER P1 PRINTER FILE VIA RCF      *   E29170
      *                                                               *   E29170
      *****************************************************************   E29170
      *                                                                   E29170
     C           RCFP1     BEGSR                            ** RCFP1 **   E29170
      *                                                                   E29170
      ** Ensure report spool file recorded by RCF                         E29170
      *                                                                   E29170
     C                     Z-ADDSFNUM     ZSNUM   60                      E29170
      *                                                                   E29170
     C                     CALL 'ZSFILE'                                  E29170
     C                     PARM           SEQ     5                       E29170
     C                     PARM BBBA      SENTY   3                       E29170
     C                     PARM           SFILE                           E29170
     C                     PARM           ZSNUM                           E29170
     C                     PARM           ZSERR   1                       E29170
      *                                                                   E29170
     C           ZSERR     IFEQ 'Y'                                       E29170
      *                                                                   E29170
      ** Error during ZSFILE processing, return to calling program        E29170
      *                                                                   E29170
     C                     SETON                     U7U8LR               E29170
     C                     RETRN                                          E29170
     C                     END                                            E29170
      *                                                                   E29170
     C                     ENDSR                                          E29170
      *                                                                   E29170
      *****************************************************************   E29170
      /EJECT                                                              E29170
      *****************************************************************   E29170
      *                                                               *   E29170
      *  RCFAU -- SUBROUTINE TO REGISTER AU PRINTER FILE VIA RCF      *   E29170
      *                                                               *   E29170
      *****************************************************************   E29170
      *                                                                   E29170
     C           RCFAU     BEGSR                            ** RCFAU **   E29170
      *                                                                   E29170
      ** Ensure audit spool file recorded by RCF                          E29170
      *                                                                   E29170
     C                     Z-ADDSFNUMU    ZSNUMU  60                      E29170
      *                                                                   E29170
     C                     CALL 'ZSFILE'                                  E29170
     C                     PARM           SEQ                             E29170
     C                     PARM *BLANKS   SENTY                           E29170
     C                     PARM           SFILEU                          E29170
     C                     PARM           ZSNUMU                          E29170
     C                     PARM *BLANK    ZSERR                           E29170
      *                                                                   E29170
     C           ZSERR     IFEQ 'Y'                                       E29170
      *                                                                   E29170
      ** Error during ZSFILE processing, return to calling program        E29170
      *                                                                   E29170
     C                     SETON                     U7U8LR               E29170
     C                     RETRN                                          E29170
     C                     END                                            E29170
      *                                                                   E29170
     C                     ENDSR                                          E29170
     C/COPY ZSRSRC,ZAVPRZ1                                                                    CSE105
     C/COPY WNCPYSRC,SE0720C012
      *****************************************************************                       CSE105
      *                                                               *                       CSE105
      *  AMORT  - Subroutine to amortise Discount/Premium.            *                       CSE105
      *                                                               *                       CSE105
      *  Called By: Main Processing                                   *                       CSE105
      *  Calls: None                                                  *                       CSE105
      *                                                               *                       CSE105
      *****************************************************************                       CSE105
      *                                                                                       CSE105
     C           AMORT     BEGSR                                                              CSE105
      *                                                                                       CSE105
      ** Only amortise interest-bearing securities.                                           CSE105
      *                                                                                       CSE105
     C           PROT      IFEQ '2'                                                           CSE105
     C           PROT      OREQ '4'                                                           CSE105
     C           PROT      OREQ '7'                                                           CSE105
     C                     GOTO EAMORT                                                        CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
      ** Discount/Premium amortised only if not equal to zero.                                CSE105
      *                                                                                       CSE105
     C           BUDU      IFNE 0                                                             CSE105
      *                                                                                       CSE105
      ** Calculate days to maturity.                                                          CSE105
      *                                                                                       CSE105
      ** Since BUDU represents discount/premium remaining as of the                           CSE105
      ** prior amortization date, days to maturity should be calculated                       CSE105
      ** from the prior amortization date, not from LPCD,                                     CSE105
      ** unless no prior amortization has been performed.                                     CSE105
      *                                                                                       CSE105
     C                     Z-ADDBPPD      ZSDATE                                              CSE105
      *                                                                                       CSE105
     C                     Z-ADDMATY      ZEDATE                                              CSE105
     C                     EXSR ZDAYS                                                         CSE105
     C                     Z-ADDZDDAYS    WDAYSM  50                                          CSE105
      *                                                                                       CSE105
     C   01                Z-ADDBBAD      ZEDATE                                              CSE105
     C   02                Z-ADDBCAD      ZEDATE                                              CSE105
     C   03                Z-ADDBCAD      ZEDATE                                              CSE105
     C                     EXSR ZDAYS                                                         CSE105
     C                     Z-ADDZDDAYS    WDAYSA  50                                          CSE105
      *                                                                                       CSE105
      ** Calculate earned Disc/Prem since Latest Posn Date.                                   CSE105
      *                                                                                       CSE105
     C           WDAYSM    IFEQ 0                                                             CSE105
     C           WDAYSM    ORLT WDAYSA                                                        CSE105
      *                                                                                       CSE105
      ** If issue is maturing, amortize remaining discount/premium.                           CSE105
      *                                                                                       CSE105
     C                     Z-ADDBUDU      WEDP                                                CSE105
     C                     ELSE                                                               CSE105
     C           BUDU      DIV  WDAYSM    WEDPXX 152H                                         CSE105
      *                                                                                       CSE105
      ** Do not include todays amortisation.                                                  CSE105
      *                                                                                       CSE105
     C                     SUB  1         WDAYSA                                              CSE105
      *                                                                                       CSE105
     C           WEDPXX    MULT WDAYSA    WEDP   130H                                         CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
      ** Calculate amortised Disc/Prem to post.                                               CSE105
      *                                                                                       CSE105
     C                     Z-ADDWEDP      WADP   130                                          CSE105
      *                                                                                       CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
     C           EAMORT    ENDSR                                                              CSE105
      *                                                                                       CSE105
      *****************************************************************                       CSE105
      *                                                               *                       CSE105
      *  BOKCHN - Subroutine to chain to Book File.                   *                       CSE105
      *                                                               *                       CSE105
      *  Called By: Main Processing                                   *                       CSE105
      *  Calls: None                                                  *                       CSE105
      *                                                               *                       CSE105
      *****************************************************************                       CSE105
      *                                                                                       CSE105
     C           BOKCHN    BEGSR                                                              CSE105
      *                                                                                       CSE105
     C           BOKKEY    CHAINBOOKDDF              80                                       CSE105
     C  N80      RECI      COMP 'D'                  8080                                     CSE105
     C           *IN80     IFEQ '1'                                                           CSE105
     C           *LOCK     IN   LDA                                                           CSE105
     C                     MOVE '1'       *INU8                                               CSE105
     C                     MOVE '1'       *INU7                                               CSE105
     C                     MOVEL'BOOKD'   DBFILE                                              CSE105
     C                     MOVELBHBK      DBKEY                                               CSE105
     C                     Z-ADD009       DBASE                                               CSE105
     C                     WRITEHEADAU                                                        CSE105
     C                     WRITEERROR                                                         CSE105
     C                     OUT  LDA                                                           CSE105
     C                     EXSR *PSSR                                                         CSE105
     C                     SETON                     LR                                       CSE105
     C                     RETRN                                                              CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
     C                     ENDSR                                                              CSE105
      *                                                                                       CSE105
      /EJECT                                                                                  CSE105
      *                                                                   E29170
      *****************************************************************   E29170
      ***/EJECT                                                     E21002S01195
     C***/COPY ZSRSRC,XDATE3Z1                                      E21002S01195
      ***/EJECT                                                     E21002S01117
     C***/COPY*ZSRSRC,ZACCRZ1                                       E21002S01117
      ***/EJECT                                                     E21002S01117
     C***/COPY ZSRSRC,ZACCZZ1                                       E21002S01117
      /EJECT                                                              E39495
     C/COPY ZSRSRC,ZACCRZ1                                                E39495
      /EJECT                                                              E39495
     C/COPY ZSRSRC,ZACCZZ1                                                E39495
      /EJECT                                                              E20656
     C/COPY ZSRSRC,ZCNSDZ1                                                E20656
      /EJECT
     C/COPY ZSRSRC,ZDATE1Z2
      /EJECT
     C/COPY ZSRSRC,ZDATE2Z4
      /EJECT
     C/COPY ZSRSRC,ZDAYSZ2
      /EJECT
     C/COPY ZSRSRC,ZDYYRZ3
      /EJECT
     C/COPY ZSRSRC,ZEVCDZ1
      /EJECT
     C/COPY ZSRSRC,ZICD2Z1
      /EJECT
     C/COPY ZSRSRC,ZICDSEZ1
      /EJECT                                                              E20380
     C/COPY ZSRSRC,ZLCDZ1                                                 E20380
      /EJECT
     C/COPY ZSRSRC,ZNCDZ3
      ***/EJECT*****************                                          E20576
     C***/COPY*ZSRSRC*ZPRCOZ1***                                          E20576
      /EJECT                                                              E21002
     C/COPY ZSRSRC,ZPRCOZ1                                                E21002
      /EJECT                                                              E21002
     C/COPY ZSRSRC,ZRATEZ1                                                E21002
      /EJECT
     C/COPY ZSRSRC,ZSDESCZ3
      /EJECT
     C/COPY ZSRSRC,ZSEDITZ3
      /EJECT
     C/COPY ZSRSRC,ZSYSTMZ1
      /EJECT                                                              E21002
     C/COPY ZSRSRC,ZYLDOZ1                                                E21002
      /EJECT                                                              E21002
     C/COPY ZSRSRC,ZYLDZ2                                                 E21002
     C/COPY ZSRSRC,ZCALCD                                                 E39495
      ***
**  CPY@
(c) Finastra International Limited 2001
**   TABMIN/TABMNM    Market indicator/Market Name
GGREY     PPRIMARY  SSECONDARY
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
0006001521029820444305904073650882610287117481320914670161311759219053
2051421975234362489726358278192928030741322023366335124365853804639507
40968424294389045351
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  POWER8 - ARRAY OF POWERS FOR CURRENCY CONVERSION
00000001
00000010
00000100
00001000
00010000
00100000
01000000
10000000
