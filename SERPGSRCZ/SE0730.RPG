     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Value date positions report')                 *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Securities Trading Module                            *
     F*                                                               *
     F*  SE0730 - VALUE DATE POSITIONS REPORT                         *
     F*                                                               *
     F*  Function: Report showing the Day's Opening and Closing       *
     F*   (COB)    Balances with 'B/F and C/F' Value Date Average     *
     F*            Prices for each Market, Branch and Book.           *
     F*                                                               *
     F*  Called by: SEC0613C - Value Date Positions                   *
     F*                                                               *
     F*  Frequency: Daily during COB                                  *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      *  Prev Amend No. 226449             Date 24Jun15               *
      *                 MD034776           Date 08Jul15               *
      *                 AR1067108          Date 11Dec12               *
      *                 AR1001183A         Date 20Nov12               *
      *                 CSE105             Date 06Dec10               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 248189             Date 31May07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 234300             Date 29Sep06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSE071             Date 19Jul05               *
      *                 229857             Date 07Oct04               *
      *                 226570             Date 27Jun04               *
      *                 CGL029             Date 01Sep03               *
      *                 211407             Date 09Nov02               *
      *                 208241             Date 21Aug02               *
      *                 207543             Date 17JUL02               *
      *                 194370             Date 12Jul01               *
      *                 180056             Date 18Oct00               *
      *                 CSE037             Date 29Apr02               *
      *                 CSE035             Date 22Apr02               *
      *                 206316             Date 19Jul02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 182960             Date 11Mar02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 17Jun01               *
      *                 CSE031             Date 09Nov01               *
      *                 180707             Date 25Jul00               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 127566             Date 09May01               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 141659             Date 10May00               *
     F*                 140272             Date 20Apr00               *
      * Midas DBA 3.02 -----------------------------------------------*
     F*                 CSE006             Date 29Jul99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 CAC005             Date 17Dec98               *
      *                 130862             Date 18Oct98               *
      *                 151945             Date 06Jan99               *
      *                 CEU017             Date 07Apr98               *
      *                 CSE007             Date 03Feb97               *
     F*                 CSE005             DATE 04FEB97               *
     F*                 127967             Date 13Oct97               *
     F*                 CAC002             DATE 12SEP96               *
     F*                 S01408             DATE 22AUG96               *
     F*                 084704             DATE 01AUG96               *
     F*                 083039             DATE 01AUG96               *
     F*                 059110             DATE 25JUL96               *
     F*                 091053             Date 27Jun96               *
     F*                 088047             DATE 26JUN96               *
     F*                 100228             DATE 31MAY96               *
     F*                 101959             DATE 24MAY96               *
     F*                 100060             DATE 24MAY96               *
     F*                 099886             DATE 18APR96               *
     F*                 100017             DATE 18APR96               *
     F*                 S01408             DATE 04FEB96               *
     F*                 092961             DATE 04OCT95               *
     F*                 091254             DATE 20OCT95               *
     F*                 088628             DATE 14JUN95               *
     F*                 086491             DATE 15JUN95               *
     F*                 080857             DATE 28DEC94               *
     F*                 064575             DATE 15AUG94               *
     F*                 065301             DATE 05MAY94               *
     F*                 054257             DATE 25NOV93               *
     F*                 052254             DATE 25NOV93               *
     F*                 051104             DATE 25NOV93               *
     F*                 054485             DATE 12OCT93               *
     F*                 S01401             DATE 16JUN93               *
     F*                 E39495             DATE 17FEB93               *
     F*                 E48308             DATE 01FEB93               *
     F*                 E47922             DATE  1FEB93               *
     F*                 E45979             DATE 30OCT92               *
     F*                 S01397             DATE 10SEP92               *
     F*                 E33532             DATE 13JAN92               *
     F*                 E33529             DATE 10JAN92               *
     F*                 E33528             DATE 10JAN92               *
     F*                 E27934             DATE 22OCT91               *
     F*                 E29170             DATE 17OCT91               *
     F*                 E27092             DATE 04SEP91               *
     F*                 S01195             DATE 18JUL91               *
     F*                 S01117             DATE 18JUL91               *
     F*                 S01269             DATE 01AUG90               *
     F*                 E21533             DATE 11APR90               *
     F*                 E21521             DATE 11APR90               *
     F*                 E21668             DATE 01MAY90               *
     F*                 E21616             DATE 03APR90               *
     F*                 E21002             DATE 02FEB90               *
     F*                 E20651             DATE 31JAN90               *
     F*                 E20656             DATE 18DEC89               *
     F*                 E20657             DATE 18DEC89               *
     F*                 S01232             DATE 18DEC89               *
     F*                 E20608             DATE 11DEC89               *
     F*                 E20587             DATE 11DEC89               *
     F*                 E20570             DATE 09DEC89               *
     F*                 E20572             DATE 09DEC89               *
     F*                 E20454             DATE 09DEC89               *
     F*                 E20456             DATE 30NOV89               *
     F*                 E20380             DATE 30NOV89               *
     F*                 E20149             DATE 08NOV89               *
     F*                 E20087             DATE 08NOV89               *
     F*                 E18652             DATE 04/07/89              *
     F*                 E18814             DATE 04/07/89              *
     F*                 E18800             DATE 03/07/89              *
     F*                 E18672             DATE 03/07/89              *
     F*                 E16772             DATE 20/06/89              *
     F*                 E17303             DATE 21/04/89              *
     F*                 E15429             DATE 02/11/88              *
     F*                 E15965             DATE 31/10/88              *
     F*                 E15683             DATE 20/10/88              *
     F*                 E15717             DATE 13/10/88              *
     F*                 E15305             DATE 29/09/88              *
     F*                 E14037             DATE 12/07/88              *
     F*                 S01158             DATE 13/05/88              *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  MD046248 - Finastra Rebranding                               *
      *  226449 - Recompiled over changes made in /COPY ZDYYRZ3.      *
      *         - Applied for MD034387.                               *
      *  MD034776 - Reverse AR1001183A to allow negative interest     *
      *             rate. (Recompile)                                 *
      *  AR1067108 - PMC1140 Component failed during Clean COB        *
      *              Applied fix AR1001183A                           *
      *  AR1001183A - Coupon rate was still used in computation of    *
      *              interest instead of using the details in FRN tab *
      *              (Reopen) (Recompile)                             *
      *  CSE105 - Portuguese Upgrade - Discount/Premium Amortisation  *
      *           on Trade Date                                       *
      *  248189 - Use the latest current factor from SEDEV to get the *
      *           correct B/FWD position amount.                      *
      *  234300 - Recompiled over changed in PF/HSTTRD.               *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  229857 - Recompiled due to change in ZYLDZ2.                 *
      *  226570 - Recompiled due to change in ZYLDZ2.                 *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  211407 - Recompile after change on copy sources ZYLDZ2,      *
      *           ZACCRZ1 and ZYCEZ1 for NX/NNX processing.           *
      *           The change was to call subroutine ZLCD1 instead     *
      *           of ZLCD in retrieving the PERIOD for NNX processing *
      *           and ZNCD1 is called instead of ZNCD in retrieving   *
      *           the WBENCD for NNX processing. Also rewrite tests   *
      *           for identifying if position is NX,NNX or CUM.       *
      *  208241 - Recompiled over changed /CPY ZSDESCZ3.              *
      *  207543 - CEU018 not working on a price basis.                *
      *           Recompiled over changed ZYLDZ2.                     *
      *  194370 - Recompile after change on copy sources ZYLDZ2,      *
      *           For securities with divisor basis = '5' and first   *
      *           coupon date > valuation date (rundate + 1), set     *
      *           event control date to first coupon date before      *
      *           processing SR/ZDYYR. This is to ensure that the     *
      *           correct hypothetical last and next coupon dates are *
      *           used in deriving the price/yield rate.              *
      *  180056 - Recompiled over changed in ZDYYRZ3.                 *
      *  CSE037 - Bond Pricing - 3 Decimal Places in Trades Input     *
      *  CSE035 - NX/NNX Coupon Payment Processing.                   *
      *           Recompile over changed ZACCRZ1/ZYLDZ2/ZYCEZ1
      *                                                               *
      *  206316 - Recompiled over changed ZLCDZ1.                     *
      *  182960 - Database error occured at 007 due to chaining of    *
      *           cancelled trades to trades file. Applied fix        *
      *           163664 which chains to CNCTRD if chain failed on    *
      *           the trades file.                                    *
      *  CPK015 - Conversion of ZYIELD from PLI to RPG.               *
      *           Recompile over changed ZYLDZ2.                      *
      *  CSE031 - Coupon Fixing for Floating Rate Notes.              *
      *           (recompilation due to change to ZNCD/ZLCD/ZACCR).   *
      *  180707 - No Position Settlements generated. Recompile over   *
      *           changes in /COPY ZNCDZ3.                            *
      *  127566 - Recompiled over changed ZSDESCZ3                    *
      *  141659 - Dbase error occurred due to chaining of cancelled   *
      *           trades to trades file.  Applied fix 119260 and      *
      *           chain to CNCTRD if chain failed on trades file.     *
     F*  140272 - Recompile over changed ZYLDZ2.                      *
     F*  CSE006 - Repurchase Agreements (REPOs) enhancement           *
      *  CAC005 - Profit Centre Accounting - SE Enhancement           *
     F*  130862 - Recompiled over ZLCDZ1 & ZDAYSZ2 changes.           *
     F*  151945 - Recompiled Over changed ZDYYRZ3 .                   *
     F*  CEU017 - Securities Redenomination Euro Changes              *
     F*           Just recompile                                      *
     F*  CSE007 - Corporate Actions - Just recompile                  *
     F*  CSE005 - Effect of holidays on FRN Coupon Dates              *
     F*           (recompilation due to change to ZNCD/ZLCD/ZACCR).   *
     F*  127967 - Record not found in TRADS for deleted deals.        *
     F*  CAC002 - Profit Centre Accounting Development - Phase 2      *
     F*         - Use booking profit centre in the report.            *
     F*  S01408 - Addition of core hook SE0730CCP9
     F*  084704 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
     F*  083039 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
     F*  059110 - Recompiled over changed ZYLDZ2 sub.                 *
     F*  091053 - Wrong yield and book cost on B/FWD line.            *
     F*  088047 - RECOMPILE over change SR/ZYLDZ2.                    *
     F*  100228 - RECOMPILE OVER CHANGED ZDYYRZ3, ZLCDZ1 & ZNCDZ3.    *
     F*  101959 - For processing type 8, multiply the closing cost    *
     F*           amount with the current factor (CFAAPR).            *
     F*  100060 - B/F line incorrect after mark-to-market.            *
     F*  099886 - Rounding problem for partly paid securities.        *
     F*           Recompile over amended standard subroutine ZACCZ.   *
     F*  100017 - Position settlement unable to pick up day adj. on   *
     F*           SECTYD. Change subroutine to use DADJN to stop      *
     F*           interest day adjustment being used for amortisation.*
     F*           Recompile over amended subroutine ZDAYS.            *
     F*  S01408 - Addition of core hook SE0730FFP1
     F*           Addition of core hook SE0730CCP1
     F*           Addition of core hook SE0730CCP2
     F*           Addition of core hook SE0730CCP3
     F*           Addition of core hook SE0730CCP4
     F*           Addition of core hook SE0730CCP5
     F*           Addition of core hook SE0730CCP6
     F*           Addition of core hook SE0730CCP7
     F*           Addition of core hook SE0730CCP8
     F*  092961 - Recompile over ZDAYSZ2 which was amended by 086491  *
     F*           (Wrong number of days calculated for day basis 1    *
     F*           when start or end day is last day of February)      *
     F*  091254 - RECOMPILE OVER CHANGED ZLCDZ1 & ZNCDZ3              *
     F*  088628 - Incorrect book code printed on change of book code. *
     F*  086491 - Wrong nbr of days calculated for day basis 1        *
     F*           when start or end day is last day of February       *
     F*           Recompiled for ZSRSRC/ZDAYSZ2 changes.              *
     F*  080857 - CHAIN ALSO ON HISTORIC FILE ( TRADHS USED )         *
     F*           DBE TRADS                                           *
     F*  064575 - Recompiled over amended ZYLDZ2 subroutine.          *
     F*  065301 - Recompiled over changed copy source ZACCR subr.     *
     F*           with ZAMT increased to 15,0.                        *
     F*  054257 - RECOMPILED as PREV CURRENT FACTOR amended from 9,8  *
     F*           to 10,9                                             *
     F*  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
     F*           to 10,9                                             *
     F*  051104 - Carried Forward Discount is calculated from the     *
     F*           Latest Average Price, but uses the Last Position    *
     F*           Change Date as the From Date. Must use the Run Date *
     F*           or the Discount is meaningless.                     *
     F*  054485 - Ensure book and branch printed on page throw at end *
     F*           of VDBPA file.                                      *
     F*  S01401 - MT5xx SWIFT Messages Feature:                       *
     F*           - Recompiled due to changes to files.               *
     F*  E39495 - New /COPY subroutine ZCALCD added (called from      *
     F*           sr. ZYLD)                                           *
     F*         - Recompiled over changed ZYLDZ2                      *
     F*  E48308 - SEVERAL FIXES:                                      *
     F*           1. Amortization amount wrongly reported if:         *
     F*                Cancelled trades processed                     *
     F*                'AU' Yields Calculated as at coupon date       *
     F*           2. Add Amortisation line                            *
     F*           3. Incorrect B/FWD figure in SE0730. Figures for    *
     F*              book cost do not add to reported profit.         *
     F*              FIX : Recalculate Amortised calue in SE0730.     *
     F*           4. C/FWD value in yield column for value date       *
     F*              position report is incorrect                     *
     F*  E47922 - Recompiled over changed SR/ZYLDZ2                   *
     F*  E45979 - Use correct dates for calculation of price - yield  *
     F*  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
     F*           - Recompiled due to changes to files and SR/ZYLD.   *
     F*  E33532 - Carried Forward price should be shown in price/     *
     F*           discount/yield format and not percentage format     *
     F*  E33529 - Only output today's profit if it is worked out on   *
     F*           a value date basis                                  *
     F*  E33528 - Recompiled over changed printer file                *
     F*  E27934 - Recompiled over the changed version of ZACCRZ1      *
     F*  E29170 - Report Control Facility program changes             *
     F*  E27092 - Recompiled over changed SR/ZLCD                     *
     F*  S01195 - Holiday Processing.                                 *
     F*  S01117 - Multibranching.                                     *
     F*  S01269 - Trade authorisation: recompiled over changed        *
     F*           file TABSE                                          *
     F*  E21533 - Overflow errors on SE0720P1 & SE0730P1 caused EOD   *
     F*           to halt.  Line count processing rewritten.          *
     F*  E21521 - TODAY'S PROFIT figure was misleading - did not      *
     F*           reflect changes in realized profit due to reversals *
     F*           or changes done today.  Must accumulate this figure *
     F*           from action records; can't just take it from BKPOS. *
     F*  E21668 - Recompiled over changed SR/ZYLDZ2                   *
     F*  E21616 - Recompiled over changed SR/ZLCD.                    *
     F*  E21002 - REPORT SHOULD USE CONTRACT PRICE FOR TRADE DETAIL   *
     F*           LINE, NOT TRADE PRICE.                              *
     F*  E20651 - DB ERROR NUMBERS USED IN MORE THAN ONE PLACE.       *
     F*           NEW ERROR NUMBERS AS FOLLOWS:                       *
     F*           DB ERROR 01 -> 05                                   *
     F*           DB ERROR 01 -> 06                                   *
     F*  E20656 - AMENDED TO USE ZCNSD TO CALCULATE CONSIDERATION     *
     F*  E20657 - CURRENT FACTOR FOR BROUGHT/CARRIED FORWARD LINE     *
     F*           SHOULD BE TAKEN FROM AAPR IN BKPOS AND FROM         *
     F*           BBCF/BCCF IN VDBPA FOR TRADE LINE.                  *
     F*  S01232 - AUSTRALIAN YIELD MODIFICATION                       *
     F*  E20608 - PROCESSING FOR ADJUSTED B/FWD LINE REDUNDANT        *
     F*  E20587 - BROUGHT/CARRIED FORWARD PRICE AND CONSIDERATION     *
     F*           MUST = 0 IF BROUGHT/CARRIED FORWARD NOMINAL = 0     *
     F*           WITH DECIMALS LINED UP ACCORDINGLY                  *
     F*  E20570 - END OF REPORT                                       *
     F*  E20572 - AMENDED AS PRICE ACTION FIELDS BBPR AND BCPR        *
     F*           ALREADY HOLD PRICE IN PRICE/YIELD/DISCOUNT FORM     *
     F*  E20454 - AMENDED AS TRADE PRICE FIELDS BBPT AND BCTD NOW     *
     F*           ALREADY HOLD PRICE IN PRICE/YIELD/DISCOUNT FORM     *
     F*  E20456 - DISCOUNT C/F PRICE IS INCORRECT.                    *
     F*  E20380 - RECOMPILE FOR CHANGED ZYLDZ1/2 AND INCLUDE ZLCDZ1   *
     F*  E20149 - ROUNDING ERROR IN CALCULATION OF CARRIED-FORWARD    *
     F*           CONSIDERATION FOR A STOCK BASKET (PROT 7).          *
     F*  E20087 - Discount Amortization Processing:                   *
     F*  E18652 - CHANGES TO PROCESS TRADES DONE ON COUPON DATE       *
     F*  E18814 - FIX E15717 USES WRONG FIELD BBTP(ACTION TYPE)       *
     F*           INSTEAD OF BBPT(TRADE PRICE) FOR THE PRICE.         *
     F*  E18800 - MARK TO MARKET REVAL P/L IS BEING ADDED TWICE TO    *
     F*           MONTH TO DATE PROFIT.                               *
     F*  E18672 - LINE OVERFLOW                                       *
     F*  E16772 - Recompiled for the Dividend Payment Amount field    *
     F*           changes.                                            *
     F*  E17303 - RECOMPILE PROGRAM OVER CHANGED ZDYYRZ3 ZYLDZ1 ZYLDZ2*
     F*  E15429 - DISTINGUISH PRICE, DISCOUNT AND YIELD SECURITIES    *
     F*  E15965 - Mark to market revaluation                          *
     F*  E15683 - ENLARGE PRICE FIELDS TO CATER FOR 15,8              *
     F*           (RECOMPILE ONLY)                                    *
     F*  E15717 - PRICE ON DETAIL LINE DOES NOT MATCH ACTUAL TRADE    *
     F*           PRICE FOR A YIELD - BASED TRADE.                    *
     F*  E15305 - Do not edit price with commas, and round up total   *
     F*           consideration calculation                           *
     F*  E14037 - CORRECT INCORPORATION 'TYPOGRAPHICAL' ERRORS        *
     F*  S01158 - POST INCORPORATION DEVELOPMENT FIXES INCLUDING      *
     F*  NOTE:  - A small amount of deleted code for S01158 has been  *
     F*           removed in an exercise to clarify the processing.   *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
      *
     FVDBPA   IP  E           K        DISK
     FBKPHD   IF  E           K        DISK
     FBKMTH   IF  E           K        DISK
     FBKPOS   IF  E           K        DISK
     FBOOKD   IF  E           K        DISK                               E48308
     FTABSE   IF  E           K        DISK
     F            TABLETAF                          KIGNORE
     F            TABTE10F                          KIGNORE
     F            TABTE20F                          KIGNORE
     F            TABTG20F                          KIGNORE
     F            TABLETHF                          KIGNORE
     F**** HOLS * TABLETJF                          KIGNORE               S01232
     F            TABLETKF                          KIGNORE
     F            TABLETLF                          KIGNORE
     F            TABLETNF                          KIGNORE
     F            TABLETPF                          KIGNORE
     F            TABLETXF                          KIGNORE
     F            TABLET2F                          KIGNORE
     F            TABLET3F                          KIGNORE
     F            TABLET5F                          KIGNORE
     F            TABTB40F                          KIGNORE
     FCLINT   IF  E           K        DISK
     F            CLINTCAF                          KIGNORE
     F            CLINTCCF                          KIGNORE
     F            CLINTC1F                          KIGNORE
     F            CLINTSEF                          KIGNORE
     FINVTP   IF  E           K        DISK
     FSECTY   IF  E           K        DISK
     FSEDEV   IF  E           K        DISK
     FSECEO   IF  E           K        DISK                               S01232
     F            SEDEVDF                           KRENAMESEDEVDO        S01232
     F            SNDEVDF                           KRENAMESNDEVDO        S01232
     F*RADS   IF  E           K        DISK                       S01117  080857
     FTRADHS  IF  E           K        DISK                               080857
     FCNCTR   IF  E           K        DISK                               141659
     F            TRADSDF                           KRENAMECNCTRDF        141659
     FBACPV   IF  E           K        DISK                               100060
     F            BPACHDF                           KRENAMEBPACHDO        100060
     FSE0730P1O   E                    PRINTER                        UC
     F                                              KINFDS SPOOL          E29170
     FSE0730AUO   E                    PRINTER
     F                                              KINFDS SPOOLU         E29170
     FTRADS   IF  E           K        DISK                               CSE006
     F            TRADSDF                           KRENAMEVTRADS0        CSE006
     F*                                                                   S01408
     F/COPY WNCPYSRC,SE0730FFP1                                           S01408
     F*                                                                   S01408
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*   01  -    Book Position Actions (Back-valued) record read    *
     F*   02  -    Book Position Actions (Current) record read        *
     F*   03  -    Book Position Actions (Historic) record read       *   S01158
      *   04  -    CAC005 is Installed                                *   CAC005
     F*   20  -    Multibranching set on                              *   S01117
     F*   21  -    Profit Centres used                                *   S01117
     F*   25  -    Nominal Currency decimal places equal to 0         *
     F*   26  -    Nominal Currency decimal places equal to 1         *
     F*   27  -    Nominal Currency decimal places equal to 2         *
     F*   28  -    Nominal Currency decimal places equal to 3         *
     F*   32  -    TRADS Chain indicator                              *   CSE006
     F*   33  -    General work indicator                             *
     F*   34  -    Seton if no previous Book Position record found    *
     F*   36  -    Seton to print 0 for the B/Forward line            *   CSE006
     F*   37  -    Seton to print the new B/Forward line              *   CSE006
     F*   41  -    Australian yield traded security                   *   S01232
     F*   42  -    Discount/Yield traded security                     *   E33532
     F*   51  -    Seton if Trade Action detail record read           *
     F*   52  -    Seton if Price Action detail record read           *
     F*   69  -    Used to Control fist cycle processing              *
     F*                                                               *
     F* 90-99 - Used in standard subroutines                          *
     F*                                                               *
     F*   U7  -    Database error                                     *
     F*   U8  -    Database / Control error                           *
     F*                                                               *
     F*   L5  -    Change of Branch                                   *
     F*   L4  -    Change of Book                                     *
     F*   L3  -    Change of Market                                   *
     F*   L2  -    Change of Investment type                          *
     F*   L1  -    Change of Security                                 *
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*  *PSSR  - DUMP program on error                               *   S01117
     F*   RCFAU  - Define AU printer file to RCF program ZSFILE       *   E29170
     F*   RCFP1  - Define P1 printer file to RCF program ZSFILE       *   E29170
     F***XDATE3*-*TO*CALCULATE*ANY*NUMBER*OF*WORKING*DAYS*BACK.*****S01232S01195
     F*  ZACCR  - CALCULATE INTEREST ACCRUED TO A SPECIFIC DATE       *   S01232
     F*  ZACCZ  - CALCULATE ACCRUED INTEREST BETWEEN 2 DATES          *   S01232
     F*  ZCALCD - Calculate long term CD price from input yield       *   E39495
     F*  ZCNSD  - Calculate consideration                             *   E20656
     F*  ZDATE1 - DATE - DAYNO conversion                             *
     F*  ZDATE2 - DAYNO - DATE conversion                             *
     F*  ZDAYS  - Calculate number of days between two dates for      *
     F*           Interest calculations                               *
     F*  ZDYYR  - Calculate number of days in Interest year           *
     F*****ZEVCD**-*Determine Event Control date                      *   E20087
     F*  ZICD2  - Access ICD record 2                                 *
     F*  ZICDSE - Access ICD record for Securities Trading            *
     F*  ZNCD   - Determine Next Coupon date                          *
     F*  ZPRCO  - Convert Price to Discount/Yield/Percentage          *
     F*  ZRATE  - TO WORK OUT EFFECTIVE INTEREST RATE OVER A PERIOD   *   S01232
     F*  ZSDESC - Format Security Description                         *
     F*  ZSEDIT - Insert a decimal point and sign into a numeric field*
     F*           and blank out leading zeros                         *
     F*  ZSYSTM - Access ICD record                                   *
     F*  ZYCE   - SET UP CUM/EX PARAMETER FOR AUSTRALIAN YIELDS       *   S01232
     F*  ZYLDO  - Output Price as Price/Discount/Yield                *
     F*  ZYLDI  - OUTPUTS YIELD AS PERCENTAGE                         *   E48308
     F*  BRNCD  - Set up Book and Branch code                         *   054485
     F*  NEWBF  - Set up new B/F values and print the B/F line for    *   CSE006
     F*         - Repos enhancements                                  *   CSE006
     F*  NEWCF  - Set up new C/F values and print the C/F line for    *   CSE006
     F*         - Repos enhancements                                  *   CSE006
     F*                                                               *
     F*****************************************************************
      /EJECT
     E                    CPY@    1   1 80
     E                    TABMIN  3   3  1   TABMNM  9
     E/COPY ZSRSRC,ZDAYSZ1
     E/COPY ZSRSRC,ZDATE2Z1
     E***/COPY*ZSRSRC,ZDATE6Z1                                      S01232S01195
     E/COPY ZSRSRC,ZSDESCZ1
     E/COPY ZSRSRC,ZPOWER8Z1
     E/COPY ZSRSRC,ZSEDITZ1
     E/COPY ZSRSRC,ZNCDZ1
     E                    WK1         8  1
     E                    WK2        15  1
     E/COPY ZSRSRC,ZHOLE                                                  S01195
      /EJECT
     IBPACBDF     01
     I***********                                   BBBR  L5              S01117
     I                                              BBBA  L5              S01117
     I                                              BBBK  L4
     I                                              BBMK  L3
     I                                              BBIT  L2
     I                                              BBSS  L1
     IBPACCDF     02
     I***********                                   BCBR  L5              S01117
     I                                              BCBA  L5              S01117
     I                                              BCBO  L4
     I                                              BCMK  L3
     I                                              BCIT  L2
     I                                              BCSS  L1
     IBPACHDF     03                                                      S01158
     I***********                                   BCBR  L5        S01158S01117
     I                                              BCBA  L5              S01117
     I                                              BCBO  L4              S01158
     I                                              BCMK  L3              S01158
     I                                              BCIT  L2              S01158
     I                                              BCSS  L1              S01158
      *
     IBPACHDO                                                             100060
     I              BCSS                            HBCSS                 100060
     I              BCBA                            HBCBA                 100060
     I              BCMK                            HBCMK                 100060
     I              BCBO                            HBCBO                 100060
     I              BCAD                            HBCAD                 100060
     I              BCED                            HBCED                 100060
     I              BCAS                            HBCAS                 100060
     I              BCTP                            HBCTP                 100060
     I              BCIT                            HBCIT                 100060
     I              BCOT                            HBCOT                 100060
     I              BCTR                            HBCTR                 100060
     I              BCPS                            HBCPS                 100060
     I              BCNL                            HBCNL                 100060
     I              BCRV                            HBCRV                 100060
     I              PCHI                            HPCHI                 100060
     I              CNTP                            HCNTP                 100060
     I              ACRI                            HACRI                 100060
     I              TRCP                            HTRCP                 100060
     I              BCPR                            HBCPR                 100060
     I              BCPL                            HBCPL                 100060
     I              BCCF                            HBCCF                 100060
     IVTRADS0                                                             CSE006
     I              TDRF                            VTDRF                 CSE006
     I              TINC                            VTINC                 CSE006
     I              TDSS                            VTDSS                 CSE006
     I              TCNR                            VTCNR                 CSE006
     I              TDTP                            VTDTP                 CSE006
     I              NOML                            VNOML                 CSE006
     I              TNMC                            VTNMC                 CSE006
     I              TNMD                            VTNMD                 CSE006
     I              TPDY                            VTPDY                 CSE006
     I              TDVD                            VTDVD                 CSE006
     I              TDBA                            VTDBA                 CSE006
     I              ORBR                            VORBR                 CSE006
     I              TDBK                            VTDBK                 CSE006
     I              TDDT                            VTDDT                 CSE006
     I              TSUB                            VTSUB                 CSE006
     I              LKRF                            VLKRF                 CSE006
     I              TDMI                            VTDMI                 CSE006
     I              TDNR                            VTDNR                 CSE006
     I              TDID                            VTDID                 CSE006
     I              AIIP                            VAIIP                 CSE006
     I              TMKC                            VTMKC                 CSE006
     I              TCAP                            VTCAP                 CSE006
     I              TCSR                            VTCSR                 CSE006
     I              PRIC                            VPRIC                 CSE006
      *                                                                                       CSE037
     IINVTPDF                                                                                 CSE037
     I              SFLG                            ISFLG                                     CSE037
      *                                                                                       CSE037
     I***LDA*****   UDS                            256                    S01117
     I***********                           134 177 DBLOT                 S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 177 DBASE                 S01117
      *                                                                   S01117
     ILDA         DS                            256                       S01117
      *                                                                   S01117
      ** *LOCK IN LDA immediately before and OUT LDA immediately          S01117
      ** after each database error handling.                              S01117
      *                                                                   S01117
     I                                      134 183 DBLOT                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     I*
     I           SDS
     I                                      244 246 WSID
     I                                      254 263 USID
     I/COPY ZSRSRC,ZNCDZ2
     I/COPY ZSRSRC,ZSEDITZ2
     I/COPY ZSRSRC,ZSDESCZ2
     I/COPY ZSRSRC,ZYLDZ1
      *
     ICPYR@#      DS
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
      *                                                                   E29170
     ISPOOL       DS                                                      E29170
      *                                                                   E29170
      ** Data structures for RCF spooled file names                       E29170
      *                                                                   E29170
     I                                       83  92 SFILE                 E29170
     I                                    B 123 1240SFNUM                 E29170
      *                                                                   E29170
     ISPOOLU      DS                                                      E29170
     I                                       83  92 SFILEU                E29170
     I                                    B 123 1240SFNUMU                E29170
      *                                                                   S01195
      ** Data structures for holiday processing.                          S01195
      *                                                                   S01195
     I/COPY ZSRSRC,ZHOLI                                                  S01195
      *                                                                   S01195
     I/COPY ZSRSRC,ZHOLDS                                                 S01195
      *                                                                   S01117
     IRUNDT       DS                                                      S01117
      *                                                                   S01117
      ** RUNDAT data area                                                 S01117
      *                                                                   S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
     I*
     ISDGELR    E DSSDGELRPD                                              S01117
      *                                                                   S01117
      ** General Ledger Details                                           S01117
      *                                                                   S01117
     ISDMMOD    E DSSDMMODPD                                              CAC002
     I**  Modules File Details                                            CAC002
      *                                                                   CSE006
     ISCSARD    E DSSCSARDPD                                              CSE006
      ** External data structures for Switchable Features File            CSE006
      *                                                                   CSE006
     ISDBOOK    E DSSDBOOKPD                                              CSE006
      ** External data structures for Switchable Features File            CSE006
     I*                                                                   CAC002
     IDSFDY     E DSDSFDY                                                 S01117
      *                                                                   S01117
      ** Short data structure for access programs (200 long)              S01117
      *                                                                   S01117
     I              'DiscPremAmortPostn  'C         SVALKK                                    CSE105
      *                                                                                       CSE105
     I/COPY WNCPYSRC,SE0730I001
     C/EJECT
      *================================================================
      *  P R O G R A M   S T A R T                                    *
      *================================================================
     C*
     C*  FIRST TIME PROCESSING
     C*
     C           *IN69     IFEQ '0'
      *                                                                   E29170
      ** RCF Processing for Audit File                                    E29170
      *                                                                   E29170
     C                     MOVE '     '   SEQ     5                       E29170
     C                     EXSR RCFAU                                     E29170
     C*
     C**  Prepare LDA
     C*
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL*BLANK    DBLOT
     C                     MOVEL'SE0730'  DBPGM
     C                     OUT  LDA                                       S01117
      *                                                                   S01117
      ** Read in RUNDAT data area                                         S01117
      *                                                                   S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C                     IN   RUNDT                                     S01117
      *                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     SETON                         20               S01117
     C                     END                                            S01117
      *                                                                   S01117
      ** Access General Ledger details                                    S01117
      *                                                                   S01117
     C**********           CALL 'AOGELRR0'                                             S01117 CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C********** SDGELR    PARM SDGELR    DSFDY                                        S01117 CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C*                                                                   CAC002
     C**  Check if Analytical Accounting module is installed.             CAC002
     C*                                                                   CAC002
     C                     CALL 'AOMMODR0'                                CAC002
     C                     PARM '*MSG   ' @RTCD                           CAC002
     C                     PARM '*FIRST ' @OPTN                           CAC002
     C           SDMMOD    PARM SDMMOD    DSFDY                           CAC002
     C*                                                                   CAC002
     C           @RTCD     IFNE *BLANKS                                   CAC002
     C           *LOCK     IN   LDA                                       CAC002
     C                     Z-ADD8         DBASE            ************   CAC002
     C                     MOVEL'SDMMODPD'DBFILE           * DBERR 08 *   CAC002
     C                     MOVEL@OPTN     DBKEY            ************   CAC002
     C                     OUT  LDA                                       CAC002
     C                     SETON                     U7U8                 CAC002
     C                     WRITEHEADAU                                    CAC002
     C                     WRITEERROR                                     CAC002
     C                     EXSR *PSSR                                     CAC002
     C                     SETON                     LR                   CAC002
     C                     RETRN                                          CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   S01117
      *                                                                   CSE006
      ** Access SAR details file to determine if CSE006                   CSE006
      ** (REPOS enhancement switchable feature) is on.                    CSE006
      *                                                                   CSE006
     C                     CALL 'AOSARDR0'                                CSE006
     C                     PARM *BLANKS   @RTCD                           CSE006
     C                     PARM '*VERIFY' @OPTN                           CSE006
     C                     PARM 'CSE006'  @SARD   6                       CSE006
     C           SCSARD    PARM SCSARD    DSFDY                           CSE006
      *                                                                   CSE006
      * Database Error                                                    CSE006
      *                                                                   CSE006
     C           @RTCD     IFNE *BLANKS                                   CSE006
     C           @RTCD     ANDNE'*NRF'                                    CSE006
     C           *LOCK     IN   LDA                                       CSE006
     C                     MOVEL'SCSARDPD'DBFILE           ***************CSE006
     C                     MOVEL'*FIRST'  DBKEY            * DB ERROR 09 *CSE006
     C                     Z-ADD009       DBASE            ***************CSE006
     C                     OUT  LDA                                       CSE006
     C                     SETON                     U7U8LR               CSE006
     C                     WRITEHEADAU                                    CSE006
     C                     WRITEERROR                                     CSE006
     C                     EXSR *PSSR                                     CSE006
     C                     RETRN                                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C           @RTCD     IFEQ *BLANK                                    CSE006
     C                     MOVEL'Y'       CSE006  1                       CSE006
     C                     ELSE                                           CSE006
     C                     MOVEL'N'       CSE006                          CSE006
     C                     ENDIF                                          CSE006
      *
      ** Set on indicator 21 if profit centre used for printer file       S01117
      *                                                                   S01117
     C           BKPRCU    IFEQ 'Y'                                       S01117
     C                     MOVE '1'       *IN21                           S01117
     C                     END                                            S01117
     C*
     C**  Get installation Control data record 1
     C*
     C                     EXSR ZSYSTM
     C*
     C**  Error in ZSYSTM
     C*
     C           *IN99     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'1'       *INU8
     C                     MOVEL'1'       *INU7
     C***********          MOVEL'01'      DBASE                           E20651
     C***********          MOVEL'05'      DBASE                     E20651S01117
     C                     Z-ADD5         DBASE            ***************S01117
     C                     MOVEL'TABLE'   DBFILE           * DB ERROR 05 *
     C                     MOVELZTABKY    DBKEY            ***************
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     SETON                     LR
     C                     RETRN
     C                     END
     C*
     C**  Get Installation Control data record for security
     C*
     C                     EXSR ZICDSE
     C*
     C**  Error in ZICDSE
     C*
     C           *IN99     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'1'       *INU8
     C                     MOVEL'1'       *INU7
     C***********          MOVEL'02'      DBASE            ***************S01117
     C                     Z-ADD2         DBASE            * DB ERROR 02 *S01117
     C                     MOVEL'TABLE'   DBFILE           ***************
     C                     MOVELZTABKY    DBKEY
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     SETON                     LR
     C                     RETRN
     C                     END
     C*
     C**  Get Installation Control Data record 2
     C*
     C                     EXSR ZICD2
     C*
     C**  Error in ZICD2
     C*
     C           *IN99     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'1'       *INU8
     C                     MOVEL'1'       *INU7
     C***********          MOVEL'03'      DBASE                           S01117
     C                     Z-ADD3         DBASE            ***************S01117
     C                     MOVEL'TABLE'   DBFILE           * DB ERROR 03 *
     C                     MOVELZTABKY    DBKEY            ***************
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     SETON                     LR
     C                     RETRN
     C                     END
      *                                                                   CAC005
      ** Access Switchable feature files for CAC005                       CAC005
      *                                                                   CAC005
     C                     CALL 'AOSARDR0'                                CAC005
     C                     PARM *BLANKS   PRTCD   7                       CAC005
     C                     PARM '*VERIFY' POPTN   7                       CAC005
     C                     PARM 'CAC005'  PSARD   6                       CAC005
      *                                                                   CAC005
     C           PRTCD     IFEQ *BLANKS                                   CAC005
     C                     MOVE 'Y'       CAC005  1                       CAC005
     C                     MOVE '1'       *IN04                           CAC005
     C                     ELSE                                           CAC005
     C                     MOVE 'N'       CAC005                          CAC005
     C                     MOVE '0'       *IN04                           CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
      ** Access SAR details file to see if CSE035 is installed                                CSE035
      *                                                                                       CSE035
     C                     CALL 'AOSARDR0'                                                    CSE035
     C                     PARM *BLANKS   @RTCD                                               CSE035
     C                     PARM '*VERIFY' @OPTN                                               CSE035
     C                     PARM 'CSE035'  @SARD                                               CSE035
      *                                                                                       CSE035
     C           @RTCD     IFEQ *BLANK                                                        CSE035
     C                     MOVE 'Y'       CSE035  1                                           CSE035
     C                     ELSE                                                               CSE035
     C                     MOVE 'N'       CSE035                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       207543
      ** Access SAR details file to see if CEU018 is installed                                207543
      *                                                                                       207543
     C                     CALL 'AOSARDR0'                                                    207543
     C                     PARM *BLANKS   @RTCD                                               207543
     C                     PARM '*VERIFY' @OPTN                                               207543
     C                     PARM 'CEU018'  @SARD                                               207543
      *                                                                                       207543
     C           @RTCD     IFEQ *BLANK                                                        207543
     C                     MOVE 'Y'       CEU018  1                                           207543
     C                     ELSE                                                               207543
     C                     MOVE 'N'       CEU018                                              207543
     C                     ENDIF                                                              207543
      *                                                                                       CSE035
     C/COPY WNCPYSRC,SE0730C006
      *                                                                                       CSE105
      ** Access SAR details file to see if feature CSE105 is installed.                       CSE105
      *                                                                                       CSE105
     C                     CALL 'AOSARDR0'                                                    CSE105
     C                     PARM '       ' @RTCD                                               CSE105
     C                     PARM '*VERIFY' @OPTN                                               CSE105
     C                     PARM 'CSE105'  @SARD                                               CSE105
     C           SCSARD    PARM SCSARD    DSFDY                                               CSE105
      *                                                                                       CSE105
     C           @RTCD     IFEQ *BLANKS                                                       CSE105
     C                     MOVE 'Y'       CSE105  1                                           CSE105
     C                     ELSE                                                               CSE105
     C                     MOVE 'N'       CSE105                                              CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
      ** Check system values if CSE105 is switched on                                         CSE105
      *                                                                                       CSE105
     C           CSE105    IFEQ 'Y'                                                           CSE105
      *                                                                                       CSE105
     C                     CALL 'AOSVALR0'                                                    CSE105
     C                     PARM *BLANKS   @RTCD                                               CSE105
     C                     PARM SVALKK    SVALK1 20                                           CSE105
     C                     PARM           SVAL1 200                                           CSE105
     C                     PARM *BLANK    SVALK2 20                                           CSE105
     C                     PARM           SVAL2 200                                           CSE105
     C                     PARM *BLANK    SVALK3 20                                           CSE105
     C                     PARM           SVAL3 200                                           CSE105
     C                     PARM *BLANK    SVALK4 20                                           CSE105
     C                     PARM           SVAL4 200                                           CSE105
     C                     PARM *BLANK    SVALK5 20                                           CSE105
     C                     PARM           SVAL5 200                                           CSE105
     C                     PARM *BLANK    SVALK6 20                                           CSE105
     C                     PARM           SVAL6 200                                           CSE105
     C                     PARM *BLANK    SVALK7 20                                           CSE105
     C                     PARM           SVAL7 200                                           CSE105
     C                     PARM *BLANK    SVALK8 20                                           CSE105
     C                     PARM           SVAL8 200                                           CSE105
     C                     PARM *BLANK    SVALK9 20                                           CSE105
     C                     PARM           SVAL9 200                                           CSE105
     C                     PARM *BLANK    SVALK0 20                                           CSE105
     C                     PARM           SVAL10200                                           CSE105
      *                                                                                       CSE105
     C           @RTCD     IFNE *BLANKS                                                       CSE105
     C           *LOCK     IN   LDA                                                           CSE105
     C                     MOVE 'SDSVALPD'DBFILE                                              CSE105
     C                     MOVELSVALK1    DBKEY                                               CSE105
     C                     Z-ADD15        DBASE                                               CSE105
     C                     OUT  LDA                                                           CSE105
     C                     EXSR *PSSR                                                         CSE105
     C                     SETON                       U7U8                                   CSE105
     C                     ELSE                                                               CSE105
     C                     MOVELSVAL1     SESVAL  1                                           CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
     C           SESVAL    IFEQ *BLANKS                                                       CSE105
     C                     MOVE 'V'       SESVAL                                              CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
     C                     ENDIF                                                              CSE105
     C*
AB   C**CALCULATE*EVENT*CONTROL*DATE***********************************   E20087
AB   C** ECD is irrelevant; use action date when calling ZNCD.            E20087
AB   C*
AB   C***********          EXSR ZEVCD                                     E20087
     C*
     C**  Define work field
     C*
     C           *LIKE     DEFN AAPR      CFAAPR                          E20657
     C           *LIKE     DEFN NPSN      CFNPSN
     C           *LIKE     DEFN RPTP      CFRPTP
     C           *LIKE     DEFN BPSC      SVBPSC
     C************LIKE     DEFN BPBR      SVBPBR                          S01117
     C           *LIKE     DEFN BPBA      SVBPBA                          S01117
     C           *LIKE     DEFN BPBK      SVBPBK
     C           *LIKE     DEFN BPMK      SVBPMK
     C           *LIKE     DEFN BPTV      SVBPTV
     C           *LIKE     DEFN WCONS     AMVAL                           E48308
     C*
     C**  Key to access Investment types
     C*
     C           ITPKA     KLIST
     C                     KFLD           NMCY
     C                     KFLD           INVTYP  3
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0730CCP1                                           S01408
     C*                                                                   S01408
     C*
     C**  Key 1 to access Book Position header record
     C*
     C           HDDKA     KLIST
     C                     KFLD           BBSS
     C***********          KFLD           BBBR                            S01117
     C                     KFLD           BBBA                            S01117
     C                     KFLD           BBBK
     C                     KFLD           BBMK
     C                     KFLD           TRDVAL  1
     C*
     C                     MOVE 'V'       TRDVAL
     C*
     C**  Key 2 to access Book Position header record
     C*
     C           HDDKB     KLIST
     C                     KFLD           BCSS
     C***********          KFLD           BCBR                            S01117
     C                     KFLD           BCBA                            S01117
     C                     KFLD           BCBO
     C                     KFLD           BCMK
     C                     KFLD           TRDVAL
     C*
     C**  Key 1 to access latest Book Position
     C*
     C           BKPKA     KLIST
     C                     KFLD           BBSS
     C***********          KFLD           BBBR                            S01117
     C                     KFLD           BBBA                            S01117
     C                     KFLD           BBBK
     C                     KFLD           BBMK
     C                     KFLD           TRDVAL
     C*********************KFLD           LPCD                            E15965
     C                     KFLD           LPSD                            E15965
     C*
     C**  Key 2 to access latest Book Position
     C*
     C           BKPKB     KLIST
     C                     KFLD           BCSS
     C***********          KFLD           BCBR                            S01117
     C                     KFLD           BCBA                            S01117
     C                     KFLD           BCBO
     C                     KFLD           BCMK
     C                     KFLD           TRDVAL
     C*********************KFLD           LPCD                            E15965
     C                     KFLD           LPSD                            E15965
     C*
     C**  Key 3 to fetch B/f Book Position
     C*
     C           BKPKC     KLIST
     C                     KFLD           BBSS
     C***********          KFLD           BBBR                            S01117
     C                     KFLD           BBBA                            S01117
     C                     KFLD           BBBK
     C                     KFLD           BBMK
     C                     KFLD           TRDVAL
     C                     KFLD           BBAD
     C*
     C**  Key 4 to fetch B/f Book Position
     C*
     C           BKPKD     KLIST
     C                     KFLD           BCSS
     C***********          KFLD           BCBR                            S01117
     C                     KFLD           BCBA                            S01117
     C                     KFLD           BCBO
     C                     KFLD           BCMK
     C                     KFLD           TRDVAL
     C***********          KFLD           BBAD                            S01158
     C                     KFLD           BCAD                            S01158
     C*
     C**  Key 1 to access Book Position Month End header record
     C*
     C           HDMKA     KLIST
     C                     KFLD           BBSS
     C***********          KFLD           BBBR                            S01117
     C                     KFLD           BBBA                            S01117
     C                     KFLD           BBBK
     C                     KFLD           BBMK
     C                     KFLD           TRDVAL  1
     C                     KFLD           BKED
     C*
     C**  Key 1 to access Book Position Month End header record
     C*
     C           HDMKB     KLIST
     C                     KFLD           BCSS
     C***********          KFLD           BCBR                            S01117
     C                     KFLD           BCBA                            S01117
     C                     KFLD           BCBO
     C                     KFLD           BCMK
     C                     KFLD           TRDVAL
     C                     KFLD           BKED
     C*
     C**  Key 3 to access Book Position Month End header record
     C*
     C           HMKA      KLIST
     C                     KFLD           BBSS
     C***********          KFLD           BBBR                            S01117
     C                     KFLD           BBBA                            S01117
     C                     KFLD           BBBK
     C                     KFLD           BBMK
     C                     KFLD           TRDVAL  1
     C*
     C**  Key 4 to access Book Position Month End header record
     C*
     C           HMKB      KLIST
     C                     KFLD           BCSS
     C***********          KFLD           BCBR                            S01117
     C                     KFLD           BCBA                            S01117
     C                     KFLD           BCBO
     C                     KFLD           BCMK
     C                     KFLD           TRDVAL
     C*                                                                   100060
     C**  Key to access BPACHD details                                    100060
     C*                                                                   100060
     C           HMBH1     KLIST                                          100060
     C                     KFLD           BBBA                            100060
     C                     KFLD           BBBK                            100060
     C                     KFLD           BBSS                            100060
     C                     KFLD           BBMK                            100060
     C                     KFLD           BBAD                            100060
     C*                                                                   100060
     C           HMBH2     KLIST                                          100060
     C                     KFLD           BCBA                            100060
     C                     KFLD           BCBO                            100060
     C                     KFLD           BCSS                            100060
     C                     KFLD           BCMK                            100060
     C                     KFLD           BCAD                            100060
     C*                                                                   100060
     C           HMBH1A    KLIST                                          100060
     C                     KFLD           BBBA                            100060
     C                     KFLD           BBBK                            100060
     C                     KFLD           BBSS                            100060
     C                     KFLD           BBMK                            100060
     C*                                                                   100060
     C           HMBH2A    KLIST                                          100060
     C                     KFLD           BCBA                            100060
     C                     KFLD           BCBO                            100060
     C                     KFLD           BCSS                            100060
     C                     KFLD           BCMK                            100060
     C*                                                                   E48308
     C**    BOOK DETAILS                                                  E48308
     C*                                                                   E48308
     C           BOKKEY    KLIST                                          E48308
     C                     KFLD           BHBK                            E48308
     C*
     C                     SETON                     69
     C                     END
     C*
     C**  Count records read
     C*
     C                     ADD  1         READS
      *                                                                   CAC005
     C                     MOVE *BLANKS   BKPRF   2                       CAC005
      *                                                                   CAC005
     C           *IN01     IFEQ '1'                                       CAC005
     C                     MOVE BBBK      BKPRF                           CAC005
     C                     END                                            CAC005
      *                                                                   CAC005
     C           *IN02     IFEQ '1'                                       CAC005
     C           *IN03     OREQ '1'                                       CAC005
     C                     MOVE BCBO      BKPRF                           CAC005
     C                     END                                            CAC005
      *                                                                   CAC005
      ** If CAC005 is installed, retrieve the corresponding user book     CAC005
      ** and profit centre.                                               CAC005
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     CALL 'AOBKPCR0'                                CAC005
     C                     PARM *BLANKS   PRTCD                           CAC005
     C                     PARM '*USER  ' POPTN                           CAC005
     C                     PARM           PBKCD   2                       CAC005
     C                     PARM           PPRFC   4                       CAC005
     C                     PARM BKPRF     PPSBK   2                       CAC005
      *                                                                   CAC005
     C           PRTCD     IFEQ *BLANKS                                   CAC005
     C                     MOVE PBKCD     BKPRF                           CAC005
     C                     MOVE PPRFC     PRFC                            CAC005
     C                     ELSE                                           CAC005
     C                     MOVE *BLANKS   PRFC                            CAC005
     C                     ENDIF                                          CAC005
     C                     ENDIF                                          CAC005
      *
      ***  C H A N G E   O F   B R A N C H
      *
     C   L5                DO
     C*
     C**  Fetch Branch Name
     C*
     C                     MOVE *BLANKS   KEY12A 12
     C                     MOVEL'10'      KEY12A
     C***01******          MOVE BBBR      KEY12A                          S01117
     C***02******          MOVE BCBR      KEY12A                          S01117
     C***03******          MOVE BCBR      KEY12A                    S01158S01117
     C   01                MOVE BBBA      KEY12A                          S01117
     C   02                MOVE BCBA      KEY12A                          S01117
     C   03                MOVE BCBA      KEY12A                          S01117
     C           KEY12A    CHAINTABLETRF             33
     C   33                MOVE *BLANKS   BRNM
     C*
     C**  Open report file, reset page no. and print headings
     C*
     C                     OPEN SE0730P1
     C                     EXSR RCFP1                                     E29170
     C                     Z-ADD*ZEROS    PAGE
     C                     EXSR BRNCD                                     054485
     C                     WRITEHEADL5
     C***********          Z-ADD7         LCOUNT  20                      E18672
     C                     Z-ADD8         LCOUNT  20                      E18672
     C*
     C   L5                END
      *
      ***  C H A N G E   O F   S E C U R I T Y
      *
     C   L1                DO
     C*
     C**  Fetch Market name (from indicator)
     C*
     C   01      BBMK      LOKUPTABMIN    TABMNM         33
     C   02      BCMK      LOKUPTABMIN    TABMNM         33
     C   03      BCMK      LOKUPTABMIN    TABMNM         33               S01158
     C  N33                MOVE *BLANKS   TABMNM
     C*
     C**  Fetch Security details
     C*
     C   01      BBSS      CHAINSECTYDF              33
     C   02      BCSS      CHAINSECTYDF              33
     C   03      BCSS      CHAINSECTYDF              33                   S01158
     C*                                                                   S01232
     C**  Australian yield traded security?                               S01232
     C*                                                                   S01232
     C           STBS      IFEQ 'Y'                                       S01232
     C           SYBS      ANDEQ'AU'                                      S01232
     C                     SETON                     41                   S01232
     C                     ELSE                                           S01232
     C                     SETOF                     41                   S01232
     C                     END                                            S01232
     C*                                                                   E33532
     C**  Price or yield/discount traded security?                        E33532
     C*                                                                   E33532
     C           STBS      IFEQ 'P'                                       E33532
     C                     SETOF                     42                   E33532
     C                     ELSE                                           E33532
     C                     SETON                     42                   E33532
     C                     END                                            E33532
     C*                                                                   E48308
     C*  Reset Amortisation total                                         E48308
     C*                                                                   E48308
     C                     Z-ADD*ZERO     AMVAL                           E48308
     C*
     C**  Fetch Nominal currency decimal places
     C*
     C                     MOVE *BLANKS   KEY12A 12
     C                     MOVELNMCY      WORK4A  4
     C                     MOVE '1'       WORK4A
     C                     MOVEL'20'      KEY12A
     C                     MOVE WORK4A    KEY12A
     C           KEY12A    CHAINTABTG10F             33
     C  N33      RECI      COMP '*'                      33
     C           *IN33     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     SETON                     U7U8
     C***********          MOVEL'04'      DBASE                           S01117
     C                     Z-ADD4         DBASE            ***************S01117
     C                     MOVEL'TABLE'   DBFILE           * DB ERROR 04 *
     C                     MOVELKEY12A    DBKEY            ***************
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     SETON                     LR
     C                     RETRN
     C                     END
     C                     Z-ADDCDP       NCDP                            S01232
     C*
     C**  Fetch Investment name
     C*
     C   01                MOVE BBIT      INVTYP
     C   02                MOVE BCIT      INVTYP
     C   03                MOVE BCIT      INVTYP                          S01158
     C           ITPKA     CHAININVTPDF              33
     C   33                MOVE *BLANKS   INAM
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0730CCP2                                           S01408
     C*                                                                   S01408
     C*
     C**  Setup Security short description
     C*
     C                     MOVELSESN      ZSRPN
     C                     MOVE *BLANKS   ZSFN1
     C                     MOVE *BLANKS   ZSFN2
     C                     MOVE RSFD      ZRSFD                           S01117
     C                     EXSR ZSDESC
      *                                                                   E21533
      ***  Following code moved here because field ADJI from BKPOS is     E21533
      ***  needed for overflow calculation prior to output of headings.   E21533
      *                                                                   E21533
      **  Fetch Book Position Header                                      E21533
      *                                                                   E21533
     C   01      HDDKA     SETGTBKPHDDF                                   E21533
     C   02      HDDKB     SETGTBKPHDDF                                   E21533
     C   03      HDDKB     SETGTBKPHDDF                                   E21533
     C                     READPBKPHDDF                  33               E21533
     C*                                                                   E48308
     C** Obtain book details                                              E48308
     C*                                                                   E48308
     C                     EXSR BOKCHN                                    E48308
      *                                                                   E21533
      **  Fetch latest Book Position.                                     E21533
      *                                                                   E21533
     C   01      BKPKA     CHAINBKPOSDF              33                   E21533
     C   02      BKPKB     CHAINBKPOSDF              33                   E21533
     C   03      BKPKB     CHAINBKPOSDF              33                   E21533
     C*
     C**  Print header
     C*
      **  Start new position on this page only if there is space          E21533
      **  ie, minimum is 9-11 lines.                                      E21533
     C*
     C***********LCOUNT    IFGT 56                                 S01158 E18672
     C***********LCOUNT    IFGT 50                                 E18672 E21533
     C           LCOUNT    IFGT 52                                        E21533
     C           LCOUNT    ORGT 50                                        E21533
     C           ADJI      ANDEQ'Y'                                       E21533
     C                     EXSR BRNCD                                     054485
     C                     WRITEHEADL5
     C***********          Z-ADD7         LCOUNT                          E18672
     C                     Z-ADD8         LCOUNT                          E18672
     C                     END
     C*
     C**  Set up DISCOUNT/PRICE/YIELD heading depending on TRADE BASIS    E15429
     C**   *IN29 = 'D'                                                    E15429
     C**   *IN30 = 'P'                                                    E15429
     C**   *IN31 = 'Y'                                                    E15429
     C*                                                                   E15429
     C           STBS      COMP 'P'                  312930               E15429
     C*                                                                   E15429
     C                     EXSR BRNCD                                     088628
     C                     WRITEHEADL1
     C***********          ADD  8         LCOUNT                          E21533
     C                     ADD  5         LCOUNT                          E21533
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     ADD  1         LCOUNT                          CAC005
     C                     ENDIF                                          CAC005
     C*
     C**Fetch*Book*Position*header*************************************   E21533
      ***  ALREADY DONE                                                   E21533
     C*
     C***01******HDDKA     SETGTBKPHDDF                                   E21533
     C***02******HDDKB     SETGTBKPHDDF                                   E21533
     C***03******HDDKB     SETGTBKPHDDF                            S01158 E21533
     C***********          READPBKPHDDF                  33               E21533
     C*
     C**  Fetch Book Position header - MONTH END RECORD
     C*
     C                     MOVE *HIVAL    BKED
     C   01      HDMKA     SETLLBKMTHDF
     C   02      HDMKB     SETLLBKMTHDF
     C   03      HDMKB     SETLLBKMTHDF                                   S01158
     C   01      HMKA      READEBKMTHDF                  33
     C   02      HMKB      READEBKMTHDF                  33
     C   03      HMKB      READEBKMTHDF                  33               S01158
     C*
     C**Fetch*latest*book*position*************************************   E21533
      ***  ALREADY DONE                                                   E21533
     C*
     C***01******BKPKA     CHAINBKPOSDF              33                   E21533
     C***02******BKPKB     CHAINBKPOSDF              33                   E21533
     C***03******BKPKB     CHAINBKPOSDF              33            S01158 E21533
     C*
     C**  Save Carried forward Nominal position and today's profit
     C**  AND CURRENT FACTOR                                              E20657
     C*
     C                     Z-ADDNPSN      CFNPSN
      *                                                                   E21521
      **  Clear TODAY'S PROFIT for accumulation from trade actions.       E21521
      *                                                                   E21521
     C***********          Z-ADDRPTP      CFRPTP                          E21521
     C                     Z-ADD0         CFRPTP                          E21521
     C                     Z-ADDAAPR      CFAAPR                          E20657
     C*                                                                   100060
     C** Read previous mark-to-market price and B/F date                  100060
     C*                                                                   100060
     C           *IN01     IFEQ '1'                                       100060
     C           HMBH1     SETLLBPACHDO                                   100060
     C           HMBH1A    REDPEBPACHDO                  35               100060
     C                     ELSE                                           100060
     C           HMBH2     SETLLBPACHDO                                   100060
     C           HMBH2A    REDPEBPACHDO                  35               100060
     C                     ENDIF                                          100060
     C           *IN35     IFEQ '0'                                       100060
     C           *IN42     ANDEQ'1'                                       100060
     C           *IN35     OREQ '0'                                       100060
     C           HBCTP     ANDNE'MM'                                      100060
     C                     MOVE '1'       *IN35                           100060
     C                     ENDIF                                          100060
     C*
     C**  Read previous book position unaffected
     C*
     C           *IN01     IFEQ '1'                                       S01158
     C                     MOVE BBSS      SVBPSC                          S01158
     C***********          MOVE BBBR      SVBPBR                    S01158S01117
     C                     MOVE BBBA      SVBPBA                          S01117
     C                     MOVE BBBK      SVBPBK                          S01158
     C                     MOVE BBMK      SVBPMK                          S01158
     C                     MOVE TRDVAL    SVBPTV                          S01158
     C           BKPKC     SETLLBKPOSDF                                   S01158
     C                     END                                            S01158
     C           *IN02     IFEQ '1'                                       S01158
     C           *IN03     OREQ '1'                                       S01158
     C                     MOVE BCSS      SVBPSC                          S01158
     C***********          MOVE BCBR      SVBPBR                    S01158S01117
     C                     MOVE BCBA      SVBPBA                          S01117
     C                     MOVE BCBO      SVBPBK                          S01158
     C                     MOVE BCMK      SVBPMK                          S01158
     C                     MOVE TRDVAL    SVBPTV                          S01158
     C           BKPKD     SETLLBKPOSDF                                   S01158
     C                     END                                            S01158
     C***********          READPBKPOSDF                  34     S01158    E14037
     C                     READPBKPOSDF                  34
      *                                                                   CSE006
      *** If REPOS indicator CSE0006 is on  then find out of the          CSE006
      *** Buy-Sell book using access obj AOBOOKR0                         CSE006
      *                                                                   CSE006
     C           CSE006    IFEQ *ON                                       CSE006
      *                                                                   CSE006
      *** If *IN01is on then use BBBK                                     CSE006
      *                                                                   CSE006
     C           *IN01     IFEQ *ON                                       CSE006
     C                     CALL 'AOBOOKR0'                                CSE006
     C                     PARM *BLANKS   PRTCD                           CSE006
     C                     PARM '*KEY   ' POPTN                           CSE006
     C                     PARM BBBK      PBKCD   2                       CSE006
     C           SDBOOK    PARM SDBOOK    DSFDY                           CSE006
      *                                                                   CSE006
     C           PRTCD     IFNE *BLANKS                                   CSE006
     C           *LOCK     IN   LDA                                       CSE006
     C                     MOVEL'AOBOOKR0'DBFILE           ***************CSE006
     C                     MOVEL'*FIRST'  DBKEY            * DB ERROR 10 *CSE006
     C                     Z-ADD010       DBASE            ***************CSE006
     C                     OUT  LDA                                       CSE006
     C                     SETON                     U7U8LR               CSE006
     C                     WRITEHEADAU                                    CSE006
     C                     WRITEERROR                                     CSE006
     C                     EXSR *PSSR                                     CSE006
     C                     RETRN                                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** If *IN02is on then use BCBO                                     CSE006
      *                                                                   CSE006
     C           *IN02     IFEQ *ON                                       CSE006
     C                     CALL 'AOBOOKR0'                                CSE006
     C                     PARM *BLANKS   PRTCD                           CSE006
     C                     PARM '*KEY   ' POPTN                           CSE006
     C                     PARM BCBO      PBKCD   2                       CSE006
     C           SDBOOK    PARM SDBOOK    DSFDY                           CSE006
      *                                                                   CSE006
     C           PRTCD     IFNE *BLANKS                                   CSE006
     C           *LOCK     IN   LDA                                       CSE006
     C                     MOVEL'AOBOOKR0'DBFILE           ***************CSE006
     C                     MOVEL'*FIRST'  DBKEY            * DB ERROR 11 *CSE006
     C                     Z-ADD011       DBASE            ***************CSE006
     C                     OUT  LDA                                       CSE006
     C                     SETON                     U7U8LR               CSE006
     C                     WRITEHEADAU                                    CSE006
     C                     WRITEERROR                                     CSE006
     C                     EXSR *PSSR                                     CSE006
     C                     RETRN                                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** If the BYSL book flag is 'Y' then chain to the trading file.    CSE006
      *** Use different kkeys depending whether indicator 01 or 02 is on. CSE006
      *                                                                   CSE006
     C           BYSL      IFEQ *ON                                       CSE006
      *                                                                   CSE006
     C           *IN01     IFEQ *ON                                       CSE006
     C           BBTR      CHAINTRADS                32                   CSE006
     C           *IN32     IFEQ '1'                                       CSE006
     C           *LOCK     IN   LDA                                       CSE006
     C                     SETON                     U7U8LR               CSE006
     C                     Z-ADD011       DBASE            ***************CSE006
     C                     MOVEL'TRADS'   DBFILE           * DB ERROR 11 *CSE006
     C                     MOVELBBTR      DBKEY            ***************CSE006
     C                     WRITEHEADAU                                    CSE006
     C                     WRITEERROR                                     CSE006
     C                     OUT  LDA                                       CSE006
     C                     EXSR *PSSR                                     CSE006
     C                     RETRN                                          CSE006
     C                     ENDIF                                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C           *IN02     IFEQ *ON                                       CSE006
     C           BCTR      CHAINTRADS                32                   CSE006
     C           *IN32     IFEQ '1'                                       CSE006
     C           *LOCK     IN   LDA                                       CSE006
     C                     SETON                     U7U8LR               CSE006
     C                     Z-ADD012       DBASE            ***************CSE006
     C                     MOVEL'TRADS'   DBFILE           * DB ERROR 12 *CSE006
     C                     MOVELBCTR      DBKEY            ***************CSE006
     C                     WRITEHEADAU                                    CSE006
     C                     WRITEERROR                                     CSE006
     C                     OUT  LDA                                       CSE006
     C                     EXSR *PSSR                                     CSE006
     C                     RETRN                                          CSE006
     C                     ENDIF                                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C           VLKRF     CHAINTRADS                32                   CSE006
     C           *IN32     IFEQ '1'                                       CSE006
     C           *LOCK     IN   LDA                                       CSE006
     C                     SETON                     U7U8LR               CSE006
     C                     Z-ADD013       DBASE            ***************CSE006
     C                     MOVEL'TRADS'   DBFILE           * DB ERROR 13 *CSE006
     C                     MOVELLKRF      DBKEY            ***************CSE006
     C                     WRITEHEADAU                                    CSE006
     C                     WRITEERROR                                     CSE006
     C                     OUT  LDA                                       CSE006
     C                     EXSR *PSSR                                     CSE006
     C                     RETRN                                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** Save value date in temporary field.                             CSE006
      *                                                                   CSE006
     C                     Z-ADDVTDVD     WTDVD   50                      CSE006
     C                     Z-ADDVPRIC     WPRIC  158                      CSE006
     C                     Z-ADDVTPDY     WTPDY  158                      CSE006
     C                     Z-ADDVNOML     WNOML                           CSE006
     C                     Z-ADDVTCSR     WTCSR  150                      CSE006
      *                                                                   CSE006
      *** If VDBPA Value date is < link ref value date print              CSE006
      *** 0 for B/F line                                                  CSE006
      *                                                                   CSE006
     C           VTDVD     IFLT WTDVD                                     CSE006
     C                     MOVE *ON       *IN36                           CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** If VDBPA Value date is > link ref value date print              CSE006
???   *** new  B/F line (greater then or greater than and = to)           CSE006
      *                                                                   CSE006
     C           VTDVD     IFGT WTDVD                                     CSE006
     C                     MOVE *ON       *IN37                           CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** Seton on indicator (no previous book position found)            CSE006
      *                                                                   CSE006
     C                     MOVE *ON       *IN34                           CSE006
      *                                                                   CSE006
EBYSLC                     ENDIF                                          CSE006
      *                                                                   CSE006
ECSE C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C************IN34     IFEQ '0'                                       E20587
     C***********BPSC      ANDEQSVBPSC                                    E20587
     C***********BPBR      ANDEQSVBPBR                                    E20587
     C***********BPBK      ANDEQSVBPBK                                    E20587
     C***********BPMK      ANDEQSVBPMK                                    E20587
     C***********BPTV      ANDEQSVBPTV                                    E20587
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  BROUGHT FORWARD LINE                                         *
      *                                                               *
      *****************************************************************
      *
     C           *IN34     IFEQ '1'                                       E20587
     C           BPSC      ORNE SVBPSC                                    E20587
     C***********BPBR      ORNE SVBPBR                              E20587S01117
     C           BPBA      ORNE SVBPBA                                    S01117
     C           BPBK      ORNE SVBPBK                                    E20587
     C           BPMK      ORNE SVBPMK                                    E20587
     C           BPTV      ORNE SVBPTV                                    E20587
     C           NPSN      OREQ *ZEROS                                    E20587
     C*                                                                   E20587
     C**  If no previous record found or B/F position is flat,            E20587
     C**  default to zero                                                 E20587
     C*                                                                   E20587
     C                     MOVE *ZEROS    NPSN                            E20587
     C                     MOVE *BLANKS   AVGPRC                          E20587
     C                     MOVE '0000000 'WORK11 11                       E20587
     C                     MOVEL'0.0'     WORK11                          E20587
     C                     MOVE WORK11    AVGPRC                          E20587
     C*                                                                   E36263
     C**  Use percentage price if yield/discount traded security          E36263
     C*                                                                   E36263
     C           *IN42     IFEQ '1'                                       E36263
     C                     MOVE *BLANKS   BFPPR                           E36263
     C                     MOVE WORK11    BFPPR                           E36263
     C                     END                                            E36263
     C                     ELSE                                           E20587
     C*
     C**  B/F Price
     C*
     C           *IN35     IFEQ '1'                                       100060
     C                     Z-ADDAPPB      ZPRICE
     C                     Z-ADDBPPD      ZFDATE
     C                     ELSE                                           100060
     C                     Z-ADDHBCPR     ZPRICE                          100060
     C                     Z-ADDHBCED     ZFDATE                          100060
     C                     ENDIF                                          100060
     C*                                                                   E48308
     C** Obtain next coupon date for previous period                      E48308
     C*                                                                   E48308
     C           ZFDATE    ADD  1         ECD     50                      E48308
     C                     EXSR ZNCD                                      E48308
     C*                                                                   E48308
     C** Obtain last coupon date for previous period                      E48308
     C*                                                                   E48308
     C           NCD       SUB  1         ZECD                            E48308
     C                     EXSR ZLCD                                      E48308
     C                     Z-ADDZZLCD     LCPN                            E48308
     C*********************Z-ADDBPPD      ECD     50               E20087 E48308
     C*********************EXSR ZNCD                                      E48308
     C*                                                                   S01232
     C**  Austalian yield parameters                                      S01232
     C*                                                                   S01232
     C           *IN41     IFEQ '1'                                       S01232
     C           NPSN      ANDNE0                                         S01232
     C                     Z-ADDLCPN      ZDCSDT                          S01232
     C                     Z-ADDBPPD      ZDCEDT                          S01232
     C                     Z-ADDNPSN      ZAMT                            S01232
     C                     Z-ADDCDP       ZCDP                            S01117
     C                     EXSR ZACCZ                                     S01232
     C           ZDCINT    DIV  NPSN      WRKPI                           S01232
     C                     Z-ADDBPPD      WRKD    50                      S01232
     C                     EXSR ZYCE                                      S01232
     C*                                                                   S01232
     C**  IF EX-COUPON, PURCHASED INTEREST PASSED IS THE REMAINING        S01232
     C**  INTEREST UNTIL NEXT COUPON DATE AND IS NEGATIVE                 S01232
     C*                                                                   S01232
     C           SCUMEX    IFEQ 'X'                                       S01232
     C                     Z-ADDLCPN      ZDCSDT                          S01232
     C                     Z-ADDNCD       ZDCEDT                          S01232
     C                     Z-ADDCDP       ZCDP                            S01117
     C                     EXSR ZACCZ                                     S01232
     C           ZDCINT    DIV  NPSN      WKWPI  159                      S01232
     C           WRKPI     SUB  WKWPI     WRKPI                           S01232
     C                     END                                            S01232
     C                     ELSE                                           S01232
     C                     Z-ADD0         WRKPI                           S01232
     C                     MOVE 'C'       SCUMEX                          S01232
     C                     END                                            S01232
     C*                                                                   E39495
     C           NPSN      IFLT *ZERO                                     E39495
     C                     Z-SUBNPSN      ZNOML                           E39495
     C                     ELSE                                           E39495
     C                     Z-ADDNPSN      ZNOML                           E39495
     C                     END                                            E39495
     C*                                                                   S01232
     C                     EXSR ZPRCO
     C/COPY WNCPYSRC,SE0730C001
     C                     Z-ADD*ZEROS    ZFLD15
     C                     MOVE ZPRCOT    ZFLD15
     C                     Z-ADD8         ZDECS
     C**********           MOVE 'J'       ZECODE                          E15305
     C                     MOVE 'L'       ZECODE                          E15305
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    AVGPRC
     C*                                                                   E36263
     C**  Use percentage price if yield/discount traded security          E36263
     C*                                                                   E36263
     C           *IN42     IFEQ '1'                                       E36263
     C                     Z-ADD*ZEROS    ZFLD15                          E36263
     C                     MOVE APPB      ZFLD15                          E36263
     C                     Z-ADD8         ZDECS                           E36263
     C                     MOVE 'L'       ZECODE                          E36263
     C                     EXSR ZSEDIT                                    E36263
     C                     MOVE *BLANKS   BFPPR                           E36263
     C                     MOVE ZOUT21    BFPPR                           E36263
     C                     END                                            E36263
     C*                                                                   E20587
     C                     END                                            E20587
     C*
     C**  B/F Nominal
     C*
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE NPSN      ZFLD15
     C                     Z-ADDNMDP      ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    NOMPOS
     C*
     C**  B/F Position
     C*
     C           NPSN      IFGT *ZEROS
     C                     MOVE 'LONG '   BFPOSN
     C                     ELSE
     C           NPSN      IFEQ *ZEROS
     C                     MOVE 'FLAT '   BFPOSN
     C                     ELSE
     C                     MOVE 'SHORT'   BFPOSN
     C                     END
     C                     END
     C*
     C**  B/F Consideration
     C*
     C***********          Z-ADD*ZEROS    WCONS  150                      E20656
     C***********          Z-ADD*ZEROS    WCONS0 150                      E20656
     C***********          Z-ADD*ZEROS    WCONS1 151                      E20656
     C***********          Z-ADD*ZEROS    WCONS2 152                      E20656
     C***********          Z-ADD*ZEROS    WCONS3 153                      E20656
     C***********          MOVEA'0000'    *IN,25                          E20656
     C***********25        ADD  CDP       J       20                      E20656
     C***********          MOVEA'1'       *IN,J                           E20656
     C***25******NPSN      MULT APPB      WCONS0                          E20656
     C***26******NPSN      MULT APPB      WCONS1                          E20656
     C***27******NPSN      MULT APPB      WCONS2                          E20656
     C***28******NPSN      MULT APPB      WCONS3                          E20656
     C***********                                                         E20656
     C**If*Price*Basis*'P',*divide*by*100******************************   E20656
     C***********                                                         E20656
     C***********SPBS      IFEQ 'P'                                       E20656
     C***25******          DIV  100       WCONS0                          E20656
     C***26******          DIV  100       WCONS1                          E20656
     C***27******          DIV  100       WCONS2                          E20656
     C***28******          DIV  100       WCONS3                          E20656
     C***********          END                                            E20656
     C***********                                                         E20656
     C***********PROT      IFEQ '8'                                       E20657
     C***25******          MULT CFCT      WCONS0    H                     E20657
     C***26******          MULT CFCT      WCONS1    H                     E20657
     C***27******          MULT CFCT      WCONS2    H                     E20657
     C***28******          MULT CFCT      WCONS3    H                     E20657
     C***********          END                                            E20657
     C***********                                                         E20656
     C***25******          MOVE WCONS0    WCONS                           E20656
     C***26******          MOVE WCONS1    WCONS                           E20656
     C***27******          MOVE WCONS2    WCONS                           E20656
     C***28******          MOVE WCONS3    WCONS                           E20656
     C***********                                                         E20656
     C****Allow*for*nominal*decimal*places*****************************   E20656
     C***********                                                         E20656
     C***********5         SUB  NMDP      DC      10                      E20656
     C***********WCONS     MULT POWER8,DC WCONS                           E20656
     C*
     C           *IN35     IFEQ '1'                                       100060
     C                     Z-ADDAPPB      ZPRC                            E20656
     C                     ELSE                                           100060
     C                     Z-ADDHBCPR     ZPRC                            100060
     C                     ENDIF                                          100060
     C                     Z-ADDNPSN      ZNOML                           E20656
     C                     Z-ADDCDP       ZCDP                            S01117
     C                     EXSR ZCNSD                                     E20656
     C                     Z-ADDZCONS     WCONS  150                      E20656
     C*                                                                   E20656
     C           PROT      IFEQ '8'                                       E20657
     C/COPY WNCPYSRC,SE0730C016
     C           SEKEY1    KLIST                                          248189
     C                     KFLD           SDSN                            248189
     C                     KFLD           SDET                            248189
     C                     KFLD           SDED                            248189
      *                                                                   248189
     C                     MOVE SESN      SDSN                            248189
     C                     MOVE 'MP'      SDET                            248189
     C                     Z-ADDRUND      SDED                            248189
      *                                                                   248189
     C           SEKEY1    SETLLSEDEVDO                                   248189
     C                     READ SEDEVDO                  89               248189
      *                                                                   248189
     C           *IN89     IFEQ '0'                                       248189
     C           SDSN      ANDEQSESN                                      248189
     C           SDET      ANDEQ'MP'                                      248189
     C                     MULT SDCP      WCONS     H                     248189
     C                     ELSE                                           248189
     C                     MULT AAPR      WCONS     H                     E20657
     C                     ENDIF                                          248189
      *                                                                   248189
     C                     END                                            E20657
     C/COPY WNCPYSRC,SE0730C011
     C*
     C           MATY      IFNE *ZERO                                     E48308
     C           MATY      ANDNE99999                                     E48308
     C           NPSN      ANDNE*ZERO                                     E48308
     C/COPY WNCPYSRC,SE0730C007
      *                                                                                       CSE105
     C           CSE105    ANDEQ'N'                                                           CSE105
      *                                                                                       CSE105
      ** If CSE105 is installed, only perform SR/AMORT if new Trade                           CSE105
      ** Basis is 'B' or 'V'.                                                                 CSE105
      *                                                                                       CSE105
     C           CSE105    OREQ 'Y'                                                           CSE105
     C           SESVAL    ANDEQ'B'                                                           CSE105
     C           MATY      ANDNE99999                                                         CSE105
     C           NPSN      ANDNE*ZERO                                                         CSE105
     C           MATY      ANDNE*ZERO                                                         CSE105
     C           CSE105    OREQ 'Y'                                                           CSE105
     C           SESVAL    ANDEQ'V'                                                           CSE105
     C           MATY      ANDNE99999                                                         CSE105
     C           NPSN      ANDNE*ZERO                                                         CSE105
     C           MATY      ANDNE*ZERO                                                         CSE105
      *                                                                                       CSE105
     C           STAD      IFEQ 'Y'                                       E48308
     C           STAD      OREQ 'C'                                       E48308
     C           STBS      OREQ 'D'                                       E48308
     C           GDPK      ANDEQ'Y'                                       E48308
     C/COPY WNCPYSRC,SE0730C015
     C                     Z-ADD0         BUDU                            E48308
     C           5         SUB  NMDP      DC      10                      E48308
     C                     ADD  CDP       DC                              E48308
     C           NPSN      MULT POWER8,DC WORK   150                      E48308
     C           WORK      SUB  WCONS     BUDU                            E48308
     C*                                                                   E48308
     C                     EXSR AMORT                                     E48308
     C*                                                                   E48308
     C                     ADD  WADP      WCONS                           E48308
     C                     Z-ADDWCONS     ZAPNC  150                      E48308
     C                     Z-ADDNPSN      ZNOML                           E48308
     C                     EXSR ZAVPR                                     E48308
     C                     Z-ADDZPRC      APPB                            E48308
     C/COPY WNCPYSRC,SE0730C008
      *                                                                                       CSE105
     C                     ENDIF                                                              CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
      ** ...no need to condition to SESVAL for CSE105.                                        CSE105
      *                                                                                       CSE105
     C           MATY      IFNE *ZERO                                                         CSE105
     C           MATY      ANDNE99999                                                         CSE105
     C           NPSN      ANDNE*ZERO                                                         CSE105
     C           STAD      IFEQ 'Y'                                                           CSE105
     C           STAD      OREQ 'C'                                                           CSE105
     C           STBS      OREQ 'D'                                                           CSE105
     C           GDPK      ANDEQ'Y'                                                           CSE105
      *                                                                                       CSE105
     C*                                                                   E48308
     C** B/F Price                                                        E48308
     C*                                                                   E48308
     C                     Z-ADDAPPB      ZPRICE                          E48308
     C   01                Z-ADDBBAD      ZFDATE                          E48308
     C   02                Z-ADDBCAD      ZFDATE                          E48308
     C   03                Z-ADDBCAD      ZFDATE                          E48308
     C***01****************Z-ADDBBAD      ECD     50               041387 E48308
     C***02****************Z-ADDBCAD      ECD     50               041387 E48308
     C***03****************Z-ADDBCAD      ECD     50               041387 E48308
     C*********************EXSR ZNCD                               041387 E48308
     C*                                                                   E48308
     C** Obtain next coupon date for previous period                      E48308
     C*                                                                   E48308
     C           ZFDATE    ADD  1         ECD     50                      E48308
     C                     EXSR ZNCD                                      E48308
     C*                                                                   E48308
     C** Obtain last coupon date for previous period                      E48308
     C*                                                                   E48308
     C           NCD       SUB  1         ZECD                            E48308
     C                     EXSR ZLCD                                      E48308
     C                     Z-ADDZZLCD     LCPN                            E48308
     C*                                                                   E48308
     C* Austalian yield parameters                                        E48308
     C*                                                                   E48308
     C           *IN41     IFEQ '1'                                       E48308
     C           NPSN      ANDNE0                                         E48308
     C                     Z-ADDLCPN      ZDCSDT                          E48308
     C   01                Z-ADDBBAD      ZDCEDT                          E48308
     C   02                Z-ADDBCAD      ZDCEDT                          E48308
     C   03                Z-ADDBCAD      ZDCEDT                          E48308
     C                     Z-ADDNPSN      ZAMT                            E48308
     C                     EXSR ZACCZ                                     E48308
     C           ZDCINT    DIV  NPSN      WRKPI                           E48308
     C   01                Z-ADDBBAD      WRKD    50                      E48308
     C   02                Z-ADDBCAD      WRKD    50                      E48308
     C   03                Z-ADDBCAD      WRKD    50                      E48308
     C                     EXSR ZYCE                                      E48308
     C*                                                                   E48308
     C* IF EX-COUPON THEN PI PASSED IS THE REMAINING INTEREST             E48308
     C* TILL NCD AND IS NEGATIVE                                          E48308
     C*                                                                   E48308
     C           SCUMEX    IFEQ 'X'                                       E48308
     C                     Z-ADDLCPN      ZDCSDT                          E48308
     C                     Z-ADDNCD       ZDCEDT                          E48308
     C                     EXSR ZACCZ                                     E48308
     C           ZDCINT    DIV  NPSN      WKWPI  159                      E48308
     C           WRKPI     SUB  WKWPI     WRKPI                           E48308
     C                     END                                            E48308
     C                     ELSE                                           E48308
     C                     Z-ADD0         WRKPI                           E48308
     C                     MOVE 'C'       SCUMEX                          E48308
     C                     END                                            E48308
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0730CCP3                                           S01408
     C*                                                                   S01408
     C*                                                                   E48308
     C                     EXSR ZPRCO                                     E48308
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0730CCP4                                           S01408
     C*                                                                   S01408
     C*                                                                   E48308
     C                     Z-ADD*ZEROS    ZFLD15                          E48308
     C                     MOVE ZPRCOT    ZFLD15                          E48308
     C                     Z-ADD8         ZDECS                           E48308
     C                     MOVE 'L'       ZECODE                          E48308
     C                     EXSR ZSEDIT                                    E48308
     C                     MOVE ZOUT21    AVGPRC                          E48308
     C*                                                                   E48308
     C                     END                                            E48308
     C*                                                                   E48308
     C                     END                                            E48308
     C*                                                                   E48308
     C                     Z-ADDWCONS     ZFLD15
     C                     Z-ADDCDP       ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    PRVCON
     C*                                                                   E48308
     C                     ADD  WCONS     AMVAL                           E48308
     C*                                                                   E48308
     C*   Output brought forward date                                     E48308
     C*                                                                   E48308
     C           NPSN      IFNE *ZERO                                     E48308
     C                     Z-ADDZFDATE    ZDAYNO                          E48308
     C                     EXSR ZDATE2                                    E48308
     C                     MOVE ZADATE    BFDAT                           E48308
     C                     ELSE                                           E48308
     C                     MOVE *BLANKS   BFDAT                           E48308
     C                     END                                            E48308
     C*
     C***********          ELSE                                           E20587
     C***********                                                         E20587
     C**If*no*previous*record*found,*default*to*zero*******************   E20587
     C***********                                                         E20587
     C***********          MOVE *BLANKS   AVGPRC                          E20587
     C***********          MOVE *BLANKS   NOMPOS                          E20587
     C***********          MOVE *BLANKS   PRVCON                          E20587
     C***********          MOVE '0000000 'WORK11 11                       E20587
     C***********          MOVEL'0.0'     WORK11                          E20587
     C***********          MOVE WORK11    AVGPRC                          E20587
     C***********          MOVE WORK11    NOMPOS                          E20587
     C***********          MOVE 'FLAT '   BFPOSN                          E20587
     C***********          MOVE WORK11    PRVCON                          E20587
     C***********          END                                            E20587
      *                                                                   CSE006
      *** If Repos enhancement active and book is BYSL carry              CSE006
      *** out new SR/NEWBF.                                               CSE006
      *                                                                   CSE006
     C           CSE006    IFEQ *ON                                       CSE006
     C           BYSL      ANDEQ'Y'                                       CSE006
     C                     EXSR NEWBF                                     CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C**  Print B/F line
     C*
     C                     WRITEBFWD1
     C***********          ADD  4         LCOUNT                   S01158 E21533
     C                     ADD  3         LCOUNT                          E21533
     C           *IN42     IFEQ '1'                                       E36263
     C                     ADD  1         LCOUNT                          E36263
     C                     END                                            E36263
     C                     MOVE '1'       BF      1                       S01158
      *
      *****************************************************************
      /EJECT
      *****************************************************************   E20608
      ***********                                                     *   E20608
      ***ADJUSTED*BROUGHT*FORWARD*LINE*********************************   E20608
      ***********                                                     *   E20608
      *****************************************************************   E20608
      ***********                                                         E20608
     C**Only*print*if*adjusted*indicator*is*'Y'************************   E20608
     C***********                                                         E20608
     C***********ADJI      IFEQ 'Y'                                       E20608
     C***********                                                         E20608
     C**Adjusted*B/F*Price*********************************************   E20608
     C***********                                                         E20608
     C***********          Z-ADDAAPR      ZPRICE                          E20608
     C***********          Z-ADDBPPD      ZFDATE                          E20608
     C***********          EXSR ZNCD                                      E20608
     C***********          EXSR ZPRCO                                     E20608
     C***********          Z-ADD*ZEROS    ZFLD15                          E20608
     C***********          MOVE ZPRCOT    ZFLD15                          E20608
     C***********          Z-ADD8         ZDECS                           E20608
     C***********          MOVE 'J'       ZECODE                   E15305 E20608
     C***********          MOVE 'L'       ZECODE                   E15305 E20608
     C***********          EXSR ZSEDIT                                    E20608
     C***********          MOVE ZOUT21    ADJAVP                          E20608
     C***********                                                         E20608
     C**Adjusted*B/F*Nominal*******************************************   E20608
     C***********                                                         E20608
     C***********          MOVE *BLANKS   ZFLD15                          E20608
     C***********          MOVE ANMP      ZFLD15                          E20608
     C***********          Z-ADDNMDP      ZDECS                           E20608
     C***********          MOVE 'J'       ZECODE                          E20608
     C***********          EXSR ZSEDIT                                    E20608
     C***********          MOVE ZOUT21    ADJNOM                          E20608
     C***********                                                         E20608
     C**Adjusted*B/F*Position******************************************   E20608
     C***********                                                         E20608
     C***********ANMP      IFGT *ZEROS                                    E20608
     C***********          MOVE 'LONG '   ADJPOS                          E20608
     C***********          ELSE                                           E20608
     C***********ANMP      IFEQ *ZEROS                                    E20608
     C***********          MOVE 'FLAT '   ADJPOS                          E20608
     C***********          ELSE                                           E20608
     C***********          MOVE 'SHORT'   ADJPOS                          E20608
     C***********          END                                            E20608
     C***********          END                                            E20608
     C***********                                                         E20608
     C**Adjusted*B/F*Consideration*************************************   E20608
     C***********                                                         E20608
     C***********ANMP      MULT AAPR      RESULT 150H                     E20608
     C***********          Z-ADDRESULT    ZFLD15                          E20608
     C***********          Z-ADDCDP       ZDECS                           E20608
     C***********          MOVE 'J'       ZECODE                          E20608
     C***********          EXSR ZSEDIT                                    E20608
     C***********          MOVE ZOUT21    ADJCON                          E20608
     C***********                                                         E20608
     C**Print*adjusted*B/F*line****************************************   E20608
     C***********                                                         E20608
     C***********          WRITEBFWD2                                     E20608
     C***********          ADD  2         LCOUNT                          E20608
     C***********                                                         E20608
     C***********          END                                            E20608
     C*
     C   L1                END
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  TRADE ACTION DETAIL RECORDS                                  *
      *                                                               *
      *****************************************************************
      *
     C***01******BBAS      COMP '10'                     51               E18652
     C***02******BCAS      COMP '10'                     51               E18652
     C***03******BCAS      COMP '10'                     51        S01158 E18652
     C   01      BBAS      COMP '40'                     51               E18652
     C   02      BCAS      COMP '40'                     51               E18652
     C   03      BCAS      COMP '40'                     51               E18652
      *
     C           *IN51     IFEQ '1'
     C*
     C**  Fetch Customer Report name and town
     C*
     C           TRCP      CHAINCLINTCBF             33
     C           *IN33     IFEQ '1'
     C                     MOVE *BLANKS   CRNM
     C                     MOVE *BLANKS   CTWN
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0730CCP9                                           S01408
     C*                                                                   S01408
     C                     END
     C*
      **  IF IT'S A REVERSAL, PRINT 'C' FOR CANCELLED
      *
     C           *IN01     IFEQ '1'
     C           BBRI      ANDEQ'Y'
     C           *IN02     OREQ '1'
     C           BCRV      ANDEQ'Y'
     C           *IN03     OREQ '1'                                       S01158
     C           BCRV      ANDEQ'Y'                                       S01158
     C                     MOVE 'C'       CFLAG
     C                     ELSE
     C                     MOVE ' '       CFLAG
     C                     END
     C*
     C**  Trade date
     C*
     C   01                Z-ADDBBOD      ZDAYNO
     C   02                Z-ADDBCOT      ZDAYNO
     C   03                Z-ADDBCOT      ZDAYNO                          S01158
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    TRDDAT
      *                                                                   S01117
      ** Profit Centre                                                    S01117
      *                                                                   S01117
      ** ...if used                                                       S01117
      *                                                                   S01117
     C           BKPRCU    IFEQ 'Y'                                       S01117
      *                                                                   S01117
      ** If book position action is trade action then retrieve profit     S01117
      ** centre from associated trade.                                    S01117
      *                                                                   S01117
      **  If Chain to Trades file failed, chain to CNCTRD for records     182960
      **  that were earlier dropped.                                      182960
      *                                                                   182960
     C           BCAS      IFEQ '40'                                      S01117
     C           *IN02     ANDEQ'1'                                       CAC002
     C           BCAS      OREQ '40'                                      CAC002
     C           *IN03     ANDEQ'1'                                       CAC002
     C           BBAS      OREQ '40'                                      CAC002
     C           *IN01     ANDEQ'1'                                       CAC002
      *                                                                   CAC002
      *                                                                   CAC002
     C           BCAS      IFEQ '40'                                      CAC002
     C           *IN02     ANDEQ'1'                                       CAC002
     C           BCAS      OREQ '40'                                      CAC002
     C           *IN03     ANDEQ'1'                                       CAC002
     C***********BCTR      CHAINTRADSDF              33            S01117 080857
     C           BCTR      CHAINTRADHS               33                   080857
     C   33      BCTR      CHAINCNCTRDF              33                   182960
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
      *                                                                   141659
      **  If chain to trades file failed, chain to CNCTRD for records     141659
      **  that were earlier dropped.                                      141659
      *                                                                   141659
     C           BBAS      IFEQ '40'                                      CAC002
     C           *IN01     ANDEQ'1'                                       CAC002
     C           BBTR      CHAINTRADHS               33                   CAC002
     C   33      BBTR      CHAINCNCTRDF              33                   182960
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C**N33******RECI      COMP '*'                      33        S01117 127967
     C           *IN33     IFEQ '1'                                       S01117
     C********** BCTR      CHAINCNCTRDF              33                                141659 182960
     C********** *IN33     IFEQ '1'                                                    141659 182960
     C           *LOCK     IN   LDA                                       S01117
     C                     SETON                     U7U8                 S01117
     C                     Z-ADD7         DBASE            ***************S01117
     C                     MOVEL'TRADS'   DBFILE           * DB ERROR 07 *S01117
     C           *IN01     IFNE '1'                        *             *182960
     C                     MOVELBCTR      DBKEY            ***************S01117
     C                     ELSE                                           182960
     C                     MOVELBBTR      DBKEY                           182960
     C                     ENDIF                                          182960
      *                                                                   182960
     C                     WRITEHEADAU                                    S01117
     C                     WRITEERROR                                     S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     SETON                     LR                   S01117
     C                     RETRN                                          S01117
     C**********           ENDIF                                                       141659 182960
     C                     END                                            S01117
     C*                                                                   CAC002
     C**  If Analytical Accounting is installed, use the booking profit   CAC002
     C**  centre on the report.                                           CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE BPRC      PRFC                            CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C                     ELSE                                           S01117
     C                     MOVE *BLANKS   PRFC                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*
     C**  Value date
     C*
     C   01                Z-ADDBBAD      ZDAYNO
     C   02                Z-ADDBCAD      ZDAYNO
     C***03******          Z-ADDBCOT      ZDAYNO                 S01158   E14037
     C   03                Z-ADDBCAD      ZDAYNO                          E14037
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    VALDAT
     C*
     C**Express*Contract*price*as*Price/Discount/Yield***********        *E15717
     C**USE*TRADE*PRICE*INSTEAD*OF*CONVERTED*CONTRACT*PRICE*      *E15717 E20454
     C**But*must*still*convert*to*correct*form*                    E20087 E20454
     C*                                                                  *E15717
     C***********          Z-ADDCNTP      ZPRICE                         *E15717
     C***01******          Z-ADDBBAD      ZFDATE                         *E15717
     C***02******          Z-ADDBCAD      ZFDATE                         *E15717
     C***03******          Z-ADDBCAD      ZDAYNO                 S01158  *E15717
     C***********          EXSR ZNCD                                     *E15717
     C***********          EXSR ZPRCO                                    *E15717
      *****If*Trade*is Discount, use Contract Price.              E20087  E20454
      ***********                                                 E20087  E20454
     C************IN29     IFEQ '1'                               E20087  E20454
     C***********          Z-ADDCNTP      ZFLD15                  E20087  E20454
     C***********          ELSE                                   E20087  E20454
      ***********                                                 E20087  E20454
     C************IN01     IFEQ '1'                               E20087  E20454
     C***********          Z-ADDBBPT      ZPRICE                  E20087  E20454
     C***********          Z-ADDBBAD      ZFDATE                  E20087  E20454
     C***********          ELSE                                   E20087  E20454
     C***********          Z-ADDBCTD      ZPRICE                  E20087  E20454
     C***********          Z-ADDBCAD      ZFDATE                  E20087  E20454
     C***********          END                                    E20087  E20454
     C***********          Z-ADDZFDATE    ECD                     E20087  E20454
     C***********          EXSR ZNCD                              E20087  E20454
     C***********          EXSR ZPRCO                             E20087  E20454
     C***********                                                 E20087  E20454
     C*
     C* Format for printing
     C*
     C***********          Z-ADD*ZEROS    ZFLD15                  E20087  E20454
     C***********          MOVE ZPRCOT    ZFLD15                          E15717
     C***********          MOVE ZPRCOT    ZFLD15                  E20087  E20454
     C***********          END                                    E20087  E20454
     C***********          Z-ADD*ZEROS    ZFLD15                  E20454  E21002
     C************IN01     IFEQ '1'                         5717  E20087  E21002
     C***********          MOVE BBTP      ZFLD15            5717 *E18814  E21002
     C***********          MOVE BBPT      ZFLD15                 *E18814  E21002
     C***********          ELSE                             5717  E20087  E21002
     C***********          MOVE BCTD      ZFLD15            5717  E20087  E21002
     C***********          END                              5717  E20087  E21002
     C*                                                                   E21002
     C**  USE CONTRACT PRICE                                              E21002
     C*                                                                   E21002
     C                     Z-ADDCNTP      ZPRICE                          E21002
     C   01                Z-ADDBBAD      ZFDATE                          E21002
     C   02                Z-ADDBCAD      ZFDATE                          E21002
     C   03                Z-ADDBCAD      ZFDATE                          E21002
     C                     Z-ADDZFDATE    ECD     50                      E21002
     C                     EXSR ZNCD                                      E21002
     C*                                                                   E21002
     C**  If an Australian Yield Security - set up parameters             E21002
     C*                                                                   E21002
     C           *IN41     IFEQ '1'                                       E21002
     C           BBNM      IFNE 0                                         E21002
     C           BCNL      ORNE 0                                         E21002
     C   01      PCHI      DIV  BBNM      WRKPI                           E21002
     C   02      PCHI      DIV  BCNL      WRKPI                           E21002
     C   03      PCHI      DIV  BCNL      WRKPI                           E21002
     C                     ELSE                                           E21002
     C                     Z-ADD0         WRKPI                           E21002
     C                     END                                            E21002
     C***********          MOVE ACRI      SCUMEX                   E21002 E39495
     C                     END                                            E21002
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0730CCP5                                           S01408
     C*                                                                   S01408
     C*                                                                   E39495
     C                     MOVE ACRI      SCUMEX                          E39495
     C   01                Z-ADDBBNM      ZNOML                           E39495
     C   02                Z-ADDBCNL      ZNOML                           E39495
     C   03                Z-ADDBCNL      ZNOML                           E39495
     C*                                                                   E21002
     C                     EXSR ZPRCO                                     E21002
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0730CCP6                                           S01408
     C*                                                                   S01408
     C*                                                                   E21002
     C                     Z-ADD*ZEROS    ZFLD15                          E21002
     C                     MOVE ZPRCOT    ZFLD15                          E21002
     C                     Z-ADD8         ZDECS
     C***********          MOVE 'J'       ZECODE                          E15305
     C                     MOVE 'L'       ZECODE                          E15305
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    PRICE
     C*
     C**  Nominal
     C*
     C   01                Z-ADDBBNM      ZFLD15
     C   02                Z-ADDBCNL      ZFLD15
     C   03                Z-ADDBCNL      ZFLD15                          S01158
     C                     Z-ADDNMDP      ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    NOMNAL
     C*
     C**  Bought/Sold
     C*
     C           *IN01     IFEQ '1'
     C           BBPS      IFEQ 'P'
     C                     MOVE 'BOUGHT'  TRACTN
     C                     ELSE
     C           BBPS      IFEQ 'S'
     C                     MOVE 'SOLD  '  TRACTN
     C                     END
     C                     END
      *                                                                   E21521
      **  Accumulate today's Profit                                       E21521
      *
     C           BBRI      IFEQ 'Y'                                       E21521
     C***********          SUB  BBPL      CFRPTP                   E21521 E48308
     C                     ELSE                                           E21521
     C                     ADD  BBPL      CFRPTP                          E21521
     C                     END                                            E21521
      *                                                                   E21521
     C                     ELSE
     C           *IN02     IFEQ '1'
     C           *IN03     OREQ '1'                                       S01158
     C           BCPS      IFEQ 'P'
     C                     MOVE 'BOUGHT'  TRACTN
     C                     ELSE
     C           BCPS      IFEQ 'S'
     C                     MOVE 'SOLD  '  TRACTN
     C                     END
     C                     END
      *                                                                   E21521
      **  Accumulate today's Profit                                       E21521
      *                                                                   E21521
     C           BCRV      IFEQ 'Y'                                       E21521
     C***********          SUB  BCPL      CFRPTP                   E21521 E48308
     C                     ELSE                                           E21521
     C                     ADD  BCPL      CFRPTP                          E21521
     C                     END                                            E21521
      *                                                                   E21521
     C                     END
     C                     END
     C*
     C**  Format consideration for printing
     C*                                                                   E21002
     C***********          Z-ADD0         ZFLD15                          E21002
     C***01******          MOVE BBCN      ZFLD15                          E21002
     C***02******          MOVE BCCN      ZFLD15                          E21002
     C***03******          MOVE BCCN      ZFLD15                   S01158 E21002
     C*                                                                   E20657
     C                     Z-ADDCNTP      ZPRC                            E21002
     C   01                Z-ADDBBNM      ZNOML                           E21002
     C   02                Z-ADDBCNL      ZNOML                           E21002
     C   03                Z-ADDBCNL      ZNOML                           E21002
     C                     Z-ADDCDP       ZCDP                            S01117
     C                     EXSR ZCNSD                                     E21002
     C                     Z-ADDZCONS     ZFLD15                          E21002
     C*                                                                   E48308
     C* IF TRADE NOT DELETED, UPDATE AMORTIZATION VALUE                   E48308
     C*                                                                   E48308
     C           CFLAG     IFNE 'C'                                       E48308
     C           TRACTN    IFEQ 'BOUGHT'                                  E48308
     C                     ADD  ZCONS     AMVAL                           E48308
     C                     ELSE                                           E48308
     C                     SUB  ZCONS     AMVAL                           E48308
     C                     END                                            E48308
     C                     END                                            E48308
     C*                                                                   E21002
     C           PROT      IFEQ '8'                                       E20657
     C/COPY WNCPYSRC,SE0730C017
     C   01                MULT BBCF      ZFLD15    H                     E20657
     C   02                MULT BCCF      ZFLD15    H                     E20657
     C   03                MULT BCCF      ZFLD15    H                     E20657
     C                     END                                            E20657
     C/COPY WNCPYSRC,SE0730C012
     C*                                                                   E20657
     C                     Z-ADDCDP       ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    CONSID
     C*
      **  Print Trade Action detail line to bottom of page                E21533
     C*
     C***********LCOUNT    IFGE 56                                 S01158 E21533
     C           LCOUNT    IFGE 60                                        E21533
     C           BF        ANDEQ'0'                                       S01158
     C                     EXSR BRNCD                                     054485
     C                     WRITEHEADL5
     C                     WRITEHEADL1
     C***********          Z-ADD15        LCOUNT                          E18672
     C***********          Z-ADD16        LCOUNT                   E18672 E21533
     C                     Z-ADD13        LCOUNT                          E21533
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     ADD  1         LCOUNT                          CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C                     END
     C*
     C                     WRITEDETL1
     C                     ADD  1         LCOUNT
     C                     MOVE '0'       BF                              S01158
     C*
     C**  Count actions reported
     C*
     C                     ADD  1         ACTNS
     C*
     C                     END
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  PRICE ACTION DETAIL RECORDS                                  *
      *                                                               *
      *****************************************************************
      *
     C   01      BBAS      COMP '60'                     52
     C   02      BCAS      COMP '60'                     52
     C   03      BCAS      COMP '60'                     52               S01158
      *
     C           *IN52     IFEQ '1'
     C*
     C**  Action date
     C*
     C   01                Z-ADDBBAD      ZDAYNO
     C   02                Z-ADDBCAD      ZDAYNO
     C   03                Z-ADDBCAD      ZDAYNO                          S01158
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    PRCDAT
     C*
     C**Price*****                                                        E20572
     C***********                                                         E20572
     C************IN01     IFEQ '1'                                       E20572
     C***********          Z-ADDBBPR      ZPRICE                          E20572
     C***********          Z-ADDBBAD      ZFDATE                          E20572
     C***********          ELSE                                           E20572
     C************IN02     IFEQ '1'                                       E20572
     C************IN03     OREQ '1'                                S01158 E20572
     C***********          Z-ADDBCPR      ZPRICE                          E20572
     C***********          Z-ADDBCAD      ZFDATE                          E20572
     C***********          END                                            E20572
     C***********          END                                            E20572
     C***********          Z-ADDZFDATE    ECD                      E20087 E20572
     C***********          EXSR ZNCD                                      E20572
     C***********          EXSR ZPRCO                                     E20572
     C*
     C                     Z-ADD*ZEROS    ZFLD15                          E20572
     C           *IN01     IFEQ '1'                                       E20572
     C                     MOVE BBPR      ZFLD15                          E20572
     C                     ELSE                                           E20572
     C           *IN02     IFEQ '1'                                       E20572
     C           *IN03     OREQ '1'                                       E20572
     C                     MOVE BCPR      ZFLD15                          E20572
     C                     END                                            E20572
     C                     END                                            E20572
     C*                                                                   E20572
     C**  Format for printing
     C*
     C*************        Z-ADD*ZEROS    ZFLD15                          E20572
     C*************        MOVE ZPRCOT    ZFLD15                          E20572
     C                     Z-ADD8         ZDECS
     C*************        MOVE 'J'       ZECODE                          E15305
     C                     MOVE 'L'       ZECODE                          E15305
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    PRCCHG
     C*
     C**  Print Price action detail line
      *
      ***  Since program now checks line counter before printing C/F      E21533
      ***  and Profit lines, details may print to bottom of page.         E21533
      *
     C***********LCOUNT    IFGE 50                                 S01158 E21533
     C           LCOUNT    IFGE 60                                        E21533
     C           BF        ANDEQ'0'                                       S01158
     C                     EXSR BRNCD                                     054485
     C                     WRITEHEADL5
     C                     WRITEHEADL1
     C***********          Z-ADD15        LCOUNT                          E18672
     C***********          Z-ADD16        LCOUNT                   E18672 E21533
     C                     Z-ADD13        LCOUNT                          E21533
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     ADD  1         LCOUNT                          CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C                     END
     C*
     C                     WRITEPRCHG1
     C                     ADD  1         LCOUNT
     C                     MOVE '0'       BF                              S01158
     C*
     C**  Count actions reported
     C*
     C                     ADD  1         ACTNS
     C*
     C                     END
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  CARRIED FORWARD LINE                                         *
      *                                                               *
      *****************************************************************
      *
     CL1                   DO
      *
     CL0         READS     IFGT *ZEROS
      *
     CL0         CFNPSN    IFEQ *ZEROS                                    E20587
     C*                                                                   E20587
     C**  If C/F position flat, price defaults to zero                    E20587
     C*                                                                   E20587
     CL0                   MOVE *BLANKS   CFPRC                           E20587
     CL0                   MOVE '0000000 'WORK11 11                       E20587
     CL0                   MOVEL'0.0'     WORK11                          E20587
     CL0                   MOVE WORK11    CFPRC                           E20587
     C*                                                                   E33532
     C**  Use percentage price if yield/discount traded security          E33532
     C*                                                                   E33532
     CL0         *IN42     IFEQ '1'                                       E33532
     CL0                   MOVE *BLANKS   CFPPR                           E33532
     CL0                   MOVE WORK11    CFPPR                           E33532
     CL0                   END                                            E33532
     CL0                   ELSE                                           E20587
     C*
     C**  C/F Price - Express as Price/Discount/Yield
     C*
     CL0                   Z-ADDLAVP      ZPRICE
     C*L0********          Z-ADDLPSD      ZFDATE                          E15965
     CL0         LATD      IFNE 0                                         E48308
     CL0                   Z-ADDLATD      ZFDATE                          E48308
     CL0                   ELSE                                           E48308
     CL0                   Z-ADDLPCD      ZFDATE                          E48308
     CL0                   END                                            E48308
     C*                                                                   E20087
     C***Price-to-discount*conversion*was*off*by*one*day.********* E20087 E20456
     C*L0********STBS      IFEQ 'D'                                E20087 E20456
     C*L0********          ADD  1         ZFDATE                   E20087 E20456
     C*L0********          END                                     E20087 E20456
     CL0                   Z-ADDZFDATE    ECD                             E20087
     C*                                                                   E20087
     CL0                   EXSR ZNCD
     C*                                                                   S01232
     C**  Set Australian yield parameters                                 S01232
     C*                                                                   S01232
     CL0         *IN41     IFEQ '1'                                       S01232
     CL0         CFNPSN    ANDNE0                                         S01232
     CL0                   Z-ADDLCPN      ZDCSDT                          S01232
     C***L0*******************Z-ADDLPCD      ZDCEDT                S01232 E45979
     CL0         LPCD      IFGT ZFDATE                                    E45979
     CL0                   Z-ADDLPCD      ZDCEDT                          E45979
     CL0                   ELSE                                           E45979
     CL0                   Z-ADDZFDATE    ZDCEDT                          E45979
     CL0                   END                                            E45979
     CL0                   Z-ADDCFNPSN    ZAMT                            S01232
     CL0                   Z-ADDCDP       ZCDP                            S01117
     CL0                   EXSR ZACCZ                                     S01232
     CL0         ZDCINT    DIV  CFNPSN    WRKPI                           S01232
     C***L0*******************Z-ADDLPCD      WRKD    50            S01232 E45979
     CL0         LPCD      IFGT ZFDATE                                    E45979
     CL0                   Z-ADDLPCD      WRKD    50                      E45979
     CL0                   ELSE                                           E45979
     CL0                   Z-ADDZFDATE    WRKD    50                      E45979
     CL0                   END                                            E45979
     CL0                   EXSR ZYCE                                      S01232
     C*                                                                   S01232
     C** IF EX-COUPON THEN PURCHASED INTEREST PASSED IS THE REMAINDER     S01232
     C** UNTIL NEXT COUPON DATE AND IS NEGATIVE                           S01232
     C*                                                                   S01232
     CL0         SCUMEX    IFEQ 'X'                                       S01232
     CL0                   Z-ADDLCPN      ZDCSDT                          S01232
     CL0                   Z-ADDNCD       ZDCEDT                          S01232
     CL0                   Z-ADDCDP       ZCDP                            S01117
     CL0                   EXSR ZACCZ                                     S01232
     CL0         ZDCINT    DIV  CFNPSN    WKWPI  159                      S01232
     CL0         WRKPI     SUB  WKWPI     WRKPI                           S01232
     CL0                   END                                            S01232
     CL0                   ELSE                                           S01232
     CL0                   Z-ADD0         WRKPI                           S01232
     CL0                   MOVE 'C'       SCUMEX                          S01232
     CL0                   END                                            S01232
     C*                                                                   E39495
     CL0         CFNPSN    IFLT *ZERO                                     E39495
     CL0                   Z-SUBCFNPSN    ZNOML                           E39495
     CL0                   ELSE                                           E39495
     CL0                   Z-ADDCFNPSN    ZNOML                           E39495
     CL0                   END                                            E39495
     C*                                                                   E39495
      *                                                                   051104
      ***  Must use Run Date, not Last Position Change Date as the From   051104
      ***  Date for the Carried Forward Discount/Yield conversion or it   051104
      ***  produces a meaningless figure.                                 051104
      *                                                                   051104
     CL0                   Z-ADDZFDATE    WFDATE  50                      051104
     CL0                   Z-ADDRUND      ZFDATE                          051104
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0730CCP7                                           S01408
     C*                                                                   S01408
     CL0                   EXSR ZPRCO
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0730CCP8                                           S01408
     C*                                                                   S01408
     CL0                   Z-ADDWFDATE    ZFDATE                          051104
     C*
     C**  Convert to output format
     C*
     CL0                   MOVE *BLANKS   ZFLD15
     CL0                   MOVE ZPRCOT    ZFLD15
     CL0                   Z-ADD8         ZDECS
     CL0                   MOVE 'L'       ZECODE
     CL0                   EXSR ZSEDIT
     CL0                   MOVE ZOUT21    CFPRC
     C*                                                                   E33532
     C**  Use percentage price if yield/discount traded security          E33532
     C*                                                                   E33532
     CL0         *IN42     IFEQ '1'                                       E33532
     CL0                   Z-ADD*ZEROS    ZFLD15                          E33532
     CL0                   MOVE LAVP      ZFLD15                          E33532
     CL0                   Z-ADD8         ZDECS                           E33532
     CL0                   MOVE 'L'       ZECODE                          E33532
     CL0                   EXSR ZSEDIT                                    E33532
     CL0                   MOVE *BLANKS   CFPPR                           E33532
     CL0                   MOVE ZOUT21    CFPPR                           E33532
     CL0                   END                                            E33532
     C*
     CL0                   END                                            E20587
     C*                                                                   E20587
     C**  C/F Nominal position
     C*
     CL0                   Z-ADDCFNPSN    ZFLD15
     CL0                   Z-ADDNMDP      ZDECS
     CL0                   MOVE 'J'       ZECODE
     CL0                   EXSR ZSEDIT
     CL0                   MOVE ZOUT21    CFNOM
     C*
     C**  C/F Position
     C*
     CL0         CFNPSN    IFGT *ZEROS
     CL0                   MOVE 'LONG '   CFPOSN
     CL0                   ELSE
     CL0         CFNPSN    IFEQ *ZEROS
     CL0                   MOVE 'FLAT '   CFPOSN
     CL0                   ELSE
     CL0                   MOVE 'SHORT'   CFPOSN
     CL0                   END
     CL0                   END
     C*
     C**  C/F Consideration
     C*                                                                   E20656
     C*L0********          Z-ADD*ZEROS    WCONS  150                      E20656
     C*L0********          Z-ADD*ZEROS    WCONS0 150                      E20656
     C*L0********          Z-ADD*ZEROS    WCONS1 151                      E20656
     C*L0********          Z-ADD*ZEROS    WCONS2 152                      E20656
     C*L0********          Z-ADD*ZEROS    WCONS3 153                      E20656
     C*L0********          MOVEA'0000'    *IN,25                          E20656
     C*L0********25        ADD  CDP       J       20                      E20656
     C*L0********          MOVEA'1'       *IN,J                           E20656
     C***25******CFNPSN    MULT LAVP      WCONS0                          E15305
     C***26******CFNPSN    MULT LAVP      WCONS1                          E15305
     C***27******CFNPSN    MULT LAVP      WCONS2                          E15305
     C***28******CFNPSN    MULT LAVP      WCONS3                          E15305
     C*L025******CFNPSN    MULT LAVP      WCONS0    H              E15305 E20656
     C*L026******CFNPSN    MULT LAVP      WCONS1    H              E15305 E20656
     C*L027******CFNPSN    MULT LAVP      WCONS2    H              E15305 E20656
     C*L028******CFNPSN    MULT LAVP      WCONS3    H              E15305 E20656
     C***********                                                         E20656
     C**If*Price*Basis 'P', divide by 100                                 E20656
     C***********                                                         E20656
     C*L0********SPBS      IFEQ 'P'                                       E20656
     C***25******          DIV  100       WCONS0                          E15305
     C***26******          DIV  100       WCONS1                          E15305
     C***27******          DIV  100       WCONS2                          E15305
     C***28******          DIV  100       WCONS3                          E15305
     C*L025******          DIV  100       WCONS0    H              E15305 E20656
     C*L026******          DIV  100       WCONS1    H              E15305 E20656
     C*L027******          DIV  100       WCONS2    H              E15305 E20656
     C*L028******          DIV  100       WCONS3    H              E15305 E20656
     C*L0********          END                                            E20656
     C***********                                                         E20656
     C*L0********PROT      IFEQ '8'                                       E20657
     C*L025******          MULT CFCT      WCONS0    H                     E20657
     C*L026******          MULT CFCT      WCONS1    H                     E20657
     C*L027******          MULT CFCT      WCONS2    H                     E20657
     C*L028******          MULT CFCT      WCONS3    H                     E20657
     C*L0********          END                                            E20657
     C***********                                                         E20656
     C*L025******          MOVE WCONS0    WCONS                           E20656
     C*L026******          MOVE WCONS1    WCONS                           E20656
     C*L027******          MOVE WCONS2    WCONS                           E20656
     C*L028******          MOVE WCONS3    WCONS                           E20656
     C***********                                                         E20656
     C****Allow*for*nominal*decimal*places*****************************   E20656
     C***********                                                         E20656
     C*L0********5         SUB  NMDP      DC      10                      E20656
     C*0*********WCONS     MULT POWER8,DC WCONS                           E20149
     C*L0********WCONS     MULT POWER8,DC WCONS     H                     E20149
     C*
     CL0                   Z-ADDLAVP      ZPRC                            E20656
     CL0                   Z-ADDCFNPSN    ZNOML                           E20656
     CL0                   Z-ADDCDP       ZCDP                            S01117
     CL0                   EXSR ZCNSD                                     E20656
     CL0                   Z-ADDZCONS     WCONS                           E20656
     C*                                                                   E20656
     CL0         PROT      IFEQ '8'                                       E20657
     C/COPY WNCPYSRC,SE0730C018
     CL0                   MULT CFAAPR    WCONS     H                     E20657
     CL0                   END                                            E20657
     C/COPY WNCPYSRC,SE0730C013
     C*
     CL0                   Z-ADDWCONS     ZFLD15
     CL0                   Z-ADDCDP       ZDECS
     CL0                   MOVE 'J'       ZECODE
     CL0                   EXSR ZSEDIT
     CL0                   MOVE ZOUT21    CFCON
     CL0                   Z-ADDZFDATE    ZDAYNO                          E48308
     CL0                   EXSR ZDATE2                                    E48308
     CL0                   MOVE ZADATE    CFDAT                           E48308
     C*                                                                   E48308
     C*   Calculate closing position                                      E48308
     C*                                                                   E48308
     CL0         AMVAL     ADD  CFRPTP    ZFLD15                          E48308
     C*                                                                   101959
     CL0         PROT      IFEQ '8'                                       101959
     C/COPY WNCPYSRC,SE0730C019
     CL0                   MULT CFAAPR    ZFLD15    H                     101959
     CL0                   END                                            101959
     C/COPY WNCPYSRC,SE0730C014
     C*                                                                   101959
     CL0                   Z-ADDCDP       ZDECS                           E48308
     CL0                   MOVE 'J'       ZECODE                          E48308
     CL0                   EXSR ZSEDIT                                    E48308
     CL0                   MOVE ZOUT21    CLCON                           E48308
     C*                                                                   E48308
     C*    Print amortisation for today                                   E48308
     C*                                                                   E48308
     CL0                   SUB  WCONS     AMVAL                           E48308
     CL0                   ADD  CFRPTP    AMVAL                           E48308
     C*                                                                   E48308
     CL0                   Z-ADDAMVAL     ZFLD15                          E48308
     CL0                   Z-SUBZFLD15    ZFLD15                          E48308
     CL0                   Z-ADDCDP       ZDECS                           E48308
     CL0                   MOVE 'J'       ZECODE                          E48308
     CL0                   EXSR ZSEDIT                                    E48308
     CL0                   MOVE ZOUT21    AMCON                           E48308
     C/COPY WNCPYSRC,SE0730C009
      *                                                                                       CSE105
      ** If CSE105 is *ON ...Disc/Prem Amortisation Trade Basis must be                       CSE105
      ** 'V' or 'B'.                                                                          CSE105
      *                                                                                       CSE105
     CL0         CSE105    IFEQ 'N'                                                           CSE105
     CL0         CSE105    OREQ 'Y'                                                           CSE105
     CL0         SESVAL    ANDNE'T'                                                           CSE105
      *                                                                                       CSE105
     CL0         LCOUNT    IFGE 55                                        E48308
     CL0                   EXSR BRNCD                                     054485
     CL0                   WRITEHEADL5                                    E48308
     CL0                   WRITEHEADL1                                    E48308
     CL0                   Z-ADD13        LCOUNT                          E48308
      *                                                                   CAC005
     CL0         CAC005    IFEQ 'Y'                                       CAC005
     CL0                   ADD  1         LCOUNT                          CAC005
     CL0                   ENDIF                                          CAC005
      *                                                                   CAC005
     CL0                   END                                            E48308
     C*                                                                   E48308
     C* Print Amortisation Line                                           E48308
     C*                                                                   E48308
     CL0         READS     IFGT *ZEROS                                    E48308
     CL0                   WRITEAMRT1                                     E48308
     CL0                   END                                            E48308
     CL0                   ADD  5         LCOUNT                          E48308
     C/COPY WNCPYSRC,SE0730C010
      *                                                                                       CSE105
     CL0                   ENDIF                                                              CSE105
      *                                                                                       CSE105
      *                                                                   E21533
      **  Check for overflow to prevent error halting end of day          E21533
      *                                                                   E21533
     CL0         LCOUNT    IFGE 55                                        E21533
     CL0                   EXSR BRNCD                                     054485
     CL0                   WRITEHEADL5                                    E21533
     CL0                   WRITEHEADL1                                    E21533
     CL0                   Z-ADD13        LCOUNT                          E21533
      *                                                                   CAC005
     CL0         CAC005    IFEQ 'Y'                                       CAC005
     CL0                   ADD  1         LCOUNT                          CAC005
     CL0                   ENDIF                                          CAC005
      *                                                                   CAC005
     CL0                   END                                            E21533
      *                                                                   CSE006
      *** If Repos enhancement active and book is BYSL end of             CSE006
      *** carried forward processing.                                     CSE006
      *                                                                   CSE006
     CL0         CSE006    IFEQ *ON                                       CSE006
     CL0         BYSL      ANDEQ'Y'                                       CSE006
     CL0                   GOTO TAGX                                      CSE006
     CL0                   ENDIF                                          CSE006
     C*
     C**  Print C/F line
     C*
     CL0         READS     IFGT *ZEROS
     CL0                   WRITECFWD1
     CL0                   END
     CL0                   ADD  6         LCOUNT                          S01158
     CL0         *IN42     IFEQ '1'                                       E36263
     CL0                   ADD  1         LCOUNT                          E36263
     CL0                   END                                            E36263
     CL0                   MOVE '0'       BF                              S01158
     C****L0*****              ADD  4         LCOUNT                      S01158
     C*
     C****L0*****    LCOUNT    IFEQ 60                                    S01158
     C****L0*****              WRITEHEADL5                                S01158
     C****L0*****              WRITEHEADL1                                S01158
     C****L0*****              Z-ADD15        LCOUNT                      S01158
     C****L0*****              END                                        S01158
     C*
     C**  Today's profit
     C*
     CL0                   Z-ADDCFRPTP    ZFLD15
     CL0                   Z-ADDCDP       ZDECS
     CL0                   MOVE 'J'       ZECODE
     CL0                   EXSR ZSEDIT
     CL0                   MOVE ZOUT21    PRFTDY
     C*
     C**  Month-to-date profit
     C*
     C**L0*******RPTM      ADD  MMPL      ZFLD15                          E18800
     CL0                   Z-ADDRPTM      ZFLD15                          E18800
     CL0                   Z-ADDCDP       ZDECS
     CL0                   MOVE 'J'       ZECODE
     CL0                   EXSR ZSEDIT
     CL0                   MOVE ZOUT21    PRFMTD
     C*
     C**  Print Profit lines
     C*
     C*                                                                   E33529
     C** Only output if profit is calculated on a value date basis        E33529
     C*                                                                   E33529
     CL0         RPBS      IFNE 'T'                                       E33529
     CL0                   WRITEPROF1
     CL0                   END                                            E33529
     C*
     CL0                   END
     C*
      *                                                                   CSE006
     CL0         TAGX      TAG                                            CSE006
     CL0         CSE006    IFEQ *ON                                       CSE006
     CL0         BYSL      ANDEQ'Y'                                       CSE006
     CL0                   EXSR NEWCF                                     CSE006
     CL0                   ENDIF                                          CSE006
      *                                                                   CSE006
     CL1                   END
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  PROFIT LINE                                                  *
      *                                                               *
      *****************************************************************
      *
     CL5                   DO
      *
     CL0         READS     IFGT *ZEROS
     CL0         LCOUNT    IFGE 58                                        E20570
     CL0                   EXSR BRNCD                                     054485
     CL0                   WRITEHEADL5                                    E20570
     CL0                   END                                            E20570
     CL0                   WRITETRAIL                                     E20570
     C*
     C**  Close printer file
     C*
     CL0                   CLOSESE0730P1
     CL0                   END
     C*
     CL5                   END
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  AUDIT REPORT                                                 *
      *                                                               *
      *****************************************************************
      *
     CLR                   DO
     C*
     C** Get installation Control data record 1 for title if no records
     C** read in
     C*
     CL0         READS     IFEQ *ZERO
     CL0                   EXSR ZSYSTM
     C*
     C**  Error in ZSYSTM
     C*
     CL0         *IN99     IFEQ '1'
     CL0         *LOCK     IN   LDA                                       S01117
     CL0                   MOVEL'1'       *INU8
     CL0                   MOVEL'1'       *INU7
     C**L0*******          MOVEL'01'      DBASE                           E20651
     C**L0*******          MOVEL'06'      DBASE                     E20651S01117
     CL0                   Z-ADD6         DBASE            ***************S01117
     CL0                   MOVEL'TABLE'   DBFILE           * DB ERROR 06 *
     CL0                   MOVELZTABKY    DBKEY            ***************
     CL0                   WRITEHEADAU
     CL0                   WRITEERROR
     C***L0******          WRITETRAILAU                                   S01117
     CL0                   OUT  LDA                                       S01117
     CL0                   EXSR *PSSR                                     S01117
     CL0                   SETON                     LR
     CL0                   RETRN
     CL0                   END
     C*
     CL0                   END
     C*
     C**  Print Audit Report
     C*
     CL0                   WRITEHEADAU
     CL0                   WRITEDETLAU
     C***L0******          WRITETRAILAU                                   S01117
     CL0         READS     IFEQ *ZERO                                     E29170
     CL0                   WRITENONE                                      E29170
     CL0                   END                                            E29170
     C/COPY WNCPYSRC,SE0730C020
     C*
     CLR                   END
      *
      *****************************************************************
      /EJECT                                                              E48308
      *****************************************************************   E48308
      *                                                                   E48308
      *   AMORT  - SUBROUTINE TO AMORTIZE DISCOUNT/PREMIUM                E48308
      *                                                                   E48308
      *****************************************************************   E48308
      *                                                                   E48308
     C           AMORT     BEGSR                           **  AMORT **   E48308
     C*                                                                   E48308
     C* ONLY AMORTIZE INTEREST-BEARING SECURITIES                         E48308
     C*                                                                   E48308
     C           PROT      IFEQ '2'                                       E48308
     C           PROT      OREQ '4'                                       E48308
     C           PROT      OREQ '7'                                       E48308
     C                     GOTO EAMORT                                    E48308
     C                     END                                            E48308
     C*                                                                   E48308
     C** DISCOUNT/PREMIUM AMORTISED ONLY IF NOT EQUAL ZERO                E48308
     C*                                                                   E48308
     C           BUDU      IFNE 0                                         E48308
     C*                                                                   E48308
     C**  AMORTIZE PREM/DISC ON YIELD CURVE BASIS FOR AUSTRALIA.          E48308
     C**  -IF YIELD CURVE BASIS                                           E48308
     C**  -AND NOT FIFO                                                   E48308
     C**  -AND NOT SCHULDSHEIN                                            E48308
     C**  -AND YIELD-BASED SECURITY                                       E48308
     C*                                                                   E48308
     C           STAD      IFEQ 'C'                                       E48308
     C           FIFO      ANDNE'Y'                                       E48308
     C           PROT      ANDNE'6'                                       E48308
     C           STBS      ANDEQ'Y'                                       E48308
     C                     EXSR AAMORT                                    E48308
     C*                                                                   E48308
     C                     ELSE                                           E48308
     C*                                                                   E48308
     C**  - CALCULATE DAYS TO MATURITY                                    E48308
     C*                                                                   E48308
     C** Since BUDU represents discount/premium remaining as of the       E48308
     C** prior amortization date, days to maturity should be calculated   E48308
     C** from the prior amortization date, not from LPCD,                 E48308
     C** unless no prior amortization has been performed.                 E48308
     C*                                                                   E48308
     C                     Z-ADDBPPD      ZSDATE                          E48308
     C*                                                                   E48308
     C                     Z-ADDMATY      ZEDATE                          E48308
     C                     EXSR ZDAYS                                     E48308
     C                     Z-ADDZDDAYS    WDAYSM  50                      E48308
     C*                                                                   E48308
     C   01                Z-ADDBBAD      ZEDATE                          E48308
     C   02                Z-ADDBCAD      ZEDATE                          E48308
     C   03                Z-ADDBCAD      ZEDATE                          E48308
     C                     EXSR ZDAYS                                     E48308
     C                     Z-ADDZDDAYS    WDAYSA  50                      E48308
     C*                                                                   E48308
     C**  - CALCULATE EARNED DISC/PREM SINCE LATEST POSN DATE             E48308
     C*                                                                   E48308
     C           WDAYSM    IFEQ 0                                         E48308
     C           WDAYSM    ORLT WDAYSA                                    E48308
     C*                                                                   E48308
     C** If issue is maturing, amortize remaining discount/premium.       E48308
     C*                                                                   E48308
     C                     Z-ADDBUDU      WEDP                            E48308
     C                     ELSE                                           E48308
     C           BUDU      DIV  WDAYSM    WEDPXX 152H                     E48308
     C*                                                                   091053
     C** Do not include todays amortisation                               091053
     C*                                                                   091053
     C                     SUB  1         WDAYSA                          091053
     C*                                                                   091053
     C           WEDPXX    MULT WDAYSA    WEDP   130H                     E48308
     C                     END                                            E48308
     C*                                                                   E48308
     C**  - CALCULATE AMORTISED DISC/PREM TO POST                         E48308
     C*                                                                   E48308
     C                     Z-ADDWEDP      WADP   130                      E48308
     C*********************ADD  WADP      WCONS                     E48308091053
     C*                                                                   E48308
     C                     END                                            E48308
     C                     END                                            E48308
     C*                                                                   E48308
     C           EAMORT    ENDSR                                          E48308
     C*                                                                   E48308
      /EJECT                                                              E48308
     C*                                                                   E48308
     C********************************************************************E48308
     C*                                                                   E48308
     C* SUBROUTINE TO AMORTIZE PREM/DISC ON A YIELD CURVE BASIS FOR       E48308
     C*                 AUSTRALIAN MARKET                                 E48308
     C*                                                                   E48308
     C           AAMORT    BEGSR                           **  AAMORT **  E48308
     C*                                                                   E48308
     C** If initial date has not been reached yet, then bypass            E48308
     C*                                                                   E48308
     C           *IN01     IFEQ '1'                                       E48308
     C           ITLD      IFGT BBAD                                      E48308
     C                     GOTO AAEND                                     E48308
     C                     END                                            E48308
     C                     END                                            E48308
     C*                                                                   E48308
     C           *IN02     IFEQ '1'                                       E48308
     C           *IN03     OREQ '1'                                       E48308
     C           ITLD      IFGT BCAD                                      E48308
     C                     GOTO AAEND                                     E48308
     C                     END                                            E48308
     C                     END                                            E48308
     C*                                                                   E48308
     C                     Z-ADD0         YLDPRC 158                      E48308
     C                     Z-ADD0         LCDWRK 130                      E48308
     C                     Z-ADD0         NCDWRK 130                      E48308
     C                     Z-ADD0         ACTWRK 130                      E48308
     C                     Z-ADD0         WRKPIX 130                      E48308
     C                     Z-ADD0         WRKPI                           E48308
     C*                                                                   E48308
     C                     Z-ADDBPPD      LASTD   50                      E48308
     C*                                                                   E48308
     C* Save Event Control Date.                                          E48308
     C                     Z-ADDECD       ECDPRV  50                      E48308
     C*                                                                   E48308
     C* set nominal to positive for working on                            E48308
     C           NPSN      IFLT 0                                         E48308
     C                     Z-SUBNPSN      WNOML  130                      E48308
     C                     ELSE                                           E48308
     C                     Z-ADDNPSN      WNOML                           E48308
     C                     END                                            E48308
     C*                                                                   E48308
     C** If Coupon rate = zeroes (eg. Commercial Paper) then zeroise      E48308
     C** WRKPI and bypass interest calcs.                                 E48308
     C*                                                                   E48308
     C           CPNR      IFEQ 0                                         E48308
     C           SYBS      ORNE 'AU'                                      E48308
     C                     Z-ADD*ZEROS    WRKPI                           E48308
     C*                                                                   E48308
     C                     ELSE                                           E48308
     C*                                                                   E48308
     C** Obtain next coupon date for previous period                      E48308
     C*                                                                   E48308
     C           LASTD     ADD  1         ECD                             E48308
     C                     EXSR ZNCD                                      E48308
     C*                                                                   E48308
     C** Obtain last coupon date for previous period                      E48308
     C*                                                                   E48308
     C           NCD       SUB  1         ZECD                            E48308
     C                     EXSR ZLCD                                      E48308
     C                     Z-ADDZZLCD     LCOUP   50                      E48308
     C*                                                                   E48308
     C* Determine if period Cum. or Ex                                    E48308
     C                     Z-ADDLASTD     WRKD                            E48308
     C                     EXSR ZYCE                                      E48308
     C*                                                                   E48308
     C           CSE035    IFEQ 'Y'                                                           CSE035
     C                     Z-ADDLCOUP     ZDCSDT                                              CSE035
     C                     Z-ADDLASTD     ZDCEDT                                              CSE035
     C                     Z-ADDWNOML     ZAMT                                                CSE035
     C                     EXSR ZACCZ                                                         CSE035
     C                     Z-ADDZDCINT    TOTACC 150                                          CSE035
     C                     Z-ADDZDCINT    WRKPIX                                              CSE035
     C                     ELSE                                                               CSE035
      *                                                                                       CSE035
     C/COPY WNCPYSRC,SE0730C002
     C* Calculate interest for Cum period (SCUMEX = C)                    E48308
     C           SCUMEX    IFEQ 'C'                                       E48308
     C/COPY WNCPYSRC,SE0730C003
     C                     Z-ADDLCOUP     ZDCSDT                          E48308
     C                     Z-ADDLASTD     ZDCEDT                          E48308
     C                     Z-ADDWNOML     ZAMT                            E48308
     C                     EXSR ZACCZ                                     E48308
     C                     Z-ADDZDCINT    TOTACC 150                      E48308
     C                     Z-ADDZDCINT    WRKPIX                          E48308
     C/COPY WNCPYSRC,SE0730C004
     C*                                                                   E48308
     C                     END                                            E48308
     C*                                                                   E48308
     C/COPY WNCPYSRC,SE0730C005
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C* Calculate interest for Ex period (SCUMEX = X)                     E48308
     C           SCUMEX    IFEQ 'X'                                       E48308
     C*                                                                   E48308
     C* Calculate interest from last coupon to latest pos. date           E48308
     C                     Z-ADDLCOUP     ZDCSDT                          E48308
     C                     Z-ADDLASTD     ZDCEDT                          E48308
     C                     Z-ADDWNOML     ZAMT                            E48308
     C                     EXSR ZACCZ                                     E48308
     C                     Z-ADDZDCINT    LCDWRK                          E48308
     C*                                                                   E48308
     C* Calculate interest from last coupon to next coupon                E48308
     C                     Z-ADDLCOUP     ZDCSDT                          E48308
     C                     Z-ADDNCD       ZDCEDT                          E48308
     C                     Z-ADDWNOML     ZAMT                            E48308
     C                     EXSR ZACCZ                                     E48308
     C                     Z-ADDZDCINT    NCDWRK                          E48308
     C*                                                                   E48308
     C           LCDWRK    SUB  NCDWRK    WRKPIX                          E48308
     C*                                                                   E48308
     C                     END                                            E48308
     C*                                                                   E48308
     C* Make interest figure a percentage                                 E48308
     C           WRKPIX    DIV  WNOML     WRKPI                           E48308
     C*                                                                   E48308
     C                     END                                            E48308
     C*                                                                   E48308
     C* Calculate Yield from last (change/amort) date                     E48308
     C                     Z-ADDAPPB      ZPRICE                          E48308
     C                     Z-ADDLASTD     ZFDATE                          E48308
     C                     EXSR ZPRCO                                     E48308
     C                     Z-ADDZPRCOT    YLDPRC                          E48308
     C*                                                                   E48308
     C* CALCULATE PRICE FROM YIELD TO ACTION DATE.                        E48308
     C*                                                                   E48308
     C* If Coupon rate = zeroes (eg. Commercial Paper) then zeroise       E48308
     C* WRKPI and bypass interest calcs.                                  E48308
     C           CPNR      IFEQ 0                                         E48308
     C           SYBS      ORNE 'AU'                                      E48308
     C                     Z-ADD*ZEROS    WRKPI                           E48308
     C*                                                                   E48308
     C                     ELSE                                           E48308
     C*                                                                   E48308
     C* Obtain coupon date for current period                             E48308
     C   01      BBAD      ADD  1         ECD                             E48308
     C   02      BCAD      ADD  1         ECD                             E48308
     C   03      BCAD      ADD  1         ECD                             E48308
     C                     EXSR ZNCD                                      E48308
     C*                                                                   E48308
     C* Obtain last coupon date for current period                        E48308
     C           NCD       SUB  1         ZECD                            E48308
     C                     EXSR ZLCD                                      E48308
     C                     Z-ADDZZLCD     LCOUP   50                      E48308
     C*                                                                   E48308
     C* Determine if period Cum. or Ex.                                   E48308
     C   01                Z-ADDBBAD      WRKD                            E48308
     C   02                Z-ADDBCAD      WRKD                            E48308
     C   03                Z-ADDBCAD      WRKD                            E48308
     C                     EXSR ZYCE                                      E48308
     C*                                                                   E48308
     C* Calculate interest for Cum period (SCUMEX = C)                    E48308
     C           SCUMEX    IFEQ 'C'                                       E48308
     C                     Z-ADDLCOUP     ZDCSDT                          E48308
     C   01                Z-ADDBBAD      ZDCEDT                          E48308
     C   02                Z-ADDBCAD      ZDCEDT                          E48308
     C   03                Z-ADDBCAD      ZDCEDT                          E48308
     C                     Z-ADDWNOML     ZAMT                            E48308
     C                     EXSR ZACCZ                                     E48308
     C                     Z-ADDZDCINT    TOTACC                          E48308
     C                     Z-ADDZDCINT    WRKPIX                          E48308
     C*                                                                   E48308
     C                     END                                            E48308
     C*                                                                   E48308
     C* Calculate interest for Ex period (SCUMEX = X)                     E48308
     C           SCUMEX    IFEQ 'X'                                       E48308
     C*                                                                   E48308
     C** Calculate interest from last coupon to action date               E48308
     C*                                                                   E48308
     C                     Z-ADDLCOUP     ZDCSDT                          E48308
     C   01                Z-ADDBBAD      ZDCEDT                          E48308
     C   02                Z-ADDBCAD      ZDCEDT                          E48308
     C   03                Z-ADDBCAD      ZDCEDT                          E48308
     C                     Z-ADDWNOML     ZAMT                            E48308
     C                     EXSR ZACCZ                                     E48308
     C                     Z-ADDZDCINT    ACTWRK                          E48308
     C*                                                                   E48308
     C** Calculate interest from last coupon to next coupon               E48308
     C*                                                                   E48308
     C                     Z-ADDLCOUP     ZDCSDT                          E48308
     C                     Z-ADDNCD       ZDCEDT                          E48308
     C                     Z-ADDWNOML     ZAMT                            E48308
     C                     EXSR ZACCZ                                     E48308
     C                     Z-ADDZDCINT    NCDWRK                          E48308
     C*                                                                   E48308
     C           ACTWRK    SUB  NCDWRK    WRKPIX                          E48308
     C*                                                                   E48308
     C                     END                                            E48308
     C*                                                                   E48308
     C* Make interest figure a percentage                                 E48308
     C           WRKPIX    DIV  WNOML     WRKPI                           E48308
     C*                                                                   E48308
     C                     END                                            E48308
     C*                                                                   E48308
     C* Calculate New Price from Action date                              E48308
     C                     Z-ADDYLDPRC    ZPRCIN 158                      E48308
     C   01                Z-ADDBBAD      ZFDATE                          E48308
     C   02                Z-ADDBCAD      ZFDATE                          E48308
     C   03                Z-ADDBCAD      ZFDATE                          E48308
     C                     EXSR ZPRCI                                     E48308
     C*                                                                   E48308
     C* Calculate amount to amortise                                      E48308
     C           ZPRCOT    SUB  APPB      ZPRC                            E48308
     C                     Z-ADDNPSN      ZNOML                           E48308
     C                     EXSR ZCNSD                                     E48308
     C                     Z-ADDZCONS     WADP                            E48308
     C*                                                                   E48308
     C* Return old Event Control Date                                     E48308
     C                     Z-ADDECDPRV    ECD                             E48308
     C*                                                                   E48308
     C           AAEND     ENDSR                                          E48308
     C*                                                                   E48308
      /EJECT                                                              E48308
     C***************************************************************     E48308
     C*                                                                   E48308
     C*                                                                   E48308
     C*  BOKCHN  -  SUBROUTINE TO CHAIN TO BOOK FILE                      E48308
     C*                                                                   E48308
     C           BOKCHN    BEGSR                           **  BOKCHN **  E48308
     C*                                                                   E48308
     C           CAC005    IFEQ 'Y'                                       CAC005
     C           BKPRF     CHAINBOOKDDF              80                   CAC005
     C                     ELSE                                           CAC005
     C           BOKKEY    CHAINBOOKDDF              80                   E48308
     C                     ENDIF                                          CAC005
     C  N80      RECI      COMP 'D'                  8080                 E48308
     C           *IN80     IFEQ '1'                                       E48308
     C                     MOVEL'BOOKD'   DBFILE           ************   E48308
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVE BKPRF     DBKEY                           CAC005
     C                     ELSE                                           CAC005
     C                     MOVELBHBK      DBKEY            DB ERROR 07    E48308
     C                     ENDIF                                          CAC005
     C                     MOVEL'07'      DBASE            ************   E48308
     C                     SETON                     LR                   E48308
     C                     SETON                     U7U8                 E48308
     C                     END                                            E48308
     C*                                                                   E48308
     C                     ENDSR                                          E48308
     C*                                                                   E48308
      *****************************************************************   CSE006
      /EJECT                                                              CSE006
      *****************************************************************   CSE006
      *                                                                   CSE006
      *   NEWBF  - SUBROUTINE TO SET UP NEW B/F AND PRINT THE B/F LINE    CSE006
      *                                                                   CSE006
      *****************************************************************   CSE006
      *                                                                   CSE006
     C           NEWBF     BEGSR                           **  NEWBF **   CSE006
      *                                                                   CSE006
      *** If 0 print indicator is on zero fileds before writing B/F lin   CSE006
      *                                                                   CSE006
     C           *IN36     IFEQ *ON                                       CSE006
     C                     MOVEL*ZERO     AVGPRC                          CSE006
     C                     MOVEL*ZERO     NOMPOS                          CSE006
     C                     MOVEL*ZERO     BFPOSN                          CSE006
     C                     MOVEL*ZERO     PRVCON                          CSE006
     C                     MOVEL*ZERO     BFPPR                           CSE006
     C                     WRITEBFWD1                                     CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** If new B/F indicator is on set the values from the first        CSE006
      *** trade details                                                   CSE006
      *                                                                   CSE006
     C           *IN37     IFEQ *ON                                       CSE006
      *                                                                   CSE006
      *** Set up Average price                                            CSE006
      *                                                                   CSE006
     C                     MOVE VTPDY     ZFLD15                          CSE006
     C                     Z-ADD8         ZDECS                           CSE006
     C                     MOVE 'L'       ZECODE                          CSE006
     C                     EXSR ZSEDIT                                    CSE006
     C                     MOVE ZOUT21    AVGPRC                          CSE006
      *                                                                   CSE006
      *** If it is a yield/ discount traded security, use % price         CSE006
      *                                                                   CSE006
     C           *IN42     IFEQ *ON                                       CSE006
 ??  C                     MOVE VTPDY     ZFLD15                          CSE006
     C                     Z-ADD8         ZDECS                           CSE006
     C                     MOVE 'L'       ZECODE                          CSE006
     C                     EXSR ZSEDIT                                    CSE006
     C                     MOVE ZOUT21    BFPPR                           CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** Set up nominal field                                            CSE006
      *                                                                   CSE006
     C                     MOVE VNOML     ZFLD15                          CSE006
     C                     Z-ADDNMDP      ZDECS                           CSE006
     C                     MOVE 'J'       ZECODE                          CSE006
     C                     EXSR ZSEDIT                                    CSE006
     C                     MOVE ZOUT21    NOMPOS                          CSE006
      *                                                                   CSE006
      ***  Set up B/F position                                            CSE006
      *                                                                   CSE006
     C                     SELEC                                          CSE006
     C           VNOML     WHGT 0                                         CSE006
     C                     MOVE 'LONG'    BFPOSN                          CSE006
     C           VNOML     WHEQ 0                                         CSE006
     C                     MOVE 'FLAT'    BFPOSN                          CSE006
     C                     OTHER                                          CSE006
     C                     MOVE 'SHORT'   BFPOSN                          CSE006
     C                     ENDSL                                          CSE006
      *                                                                   CSE006
      ***  Set up B/F Consideration (PRVCON)                              CSE006
      *                                                                   CSE006
     C                     Z-ADDVTCSR     ZFLD15                          CSE006
     C                     Z-ADDCDP       ZDECS                           CSE006
     C                     MOVE 'J'       ZECODE                          CSE006
     C                     EXSR ZSEDIT                                    CSE006
     C                     MOVE ZOUT21    PRVCON                          CSE006
      *                                                                   CSE006
einyyC                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     ENDSR                                          CSE006
      *                                                                   CSE006
      *****************************************************************   CSE006
      /EJECT                                                              CSE006
      *****************************************************************   CSE006
      *                                                                   CSE006
      *   NEWCF  - SUBROUTINE TO SET UP NEW C/F AND PRINT THE C/F LINE    CSE006
      *                                                                   CSE006
      *****************************************************************   CSE006
      *                                                                   CSE006
     C           NEWCF     BEGSR                           **  NEWCF **   CSE006
      *                                                                   CSE006
      *** If *IN36 is on, set the values of the C/F line from the         CSE006
      *** actual values of the trade, beofre writing the C/F line.        CSE006
      *                                                                   CSE006
     C           *IN36     IFEQ *ON                                       CSE006
      *                                                                   CSE006
AD?  C                     MOVELCFPRC     PRICE                           CSE006
AD   C                     MOVELCFNOM     NOMNAL                          CSE006
     C           TRACTN    IFEQ 'BOUGHT'                                  CSE006
     C                     MOVE 'LONG'    CFPOSN                          CSE006
     C                     ENDIF                                          CSE006
     C           TRACTN    IFEQ 'SOLD'                                    CSE006
     C                     MOVE 'SHORT'   CFPOSN                          CSE006
     C                     ENDIF                                          CSE006
     C                     MOVE CFCON     CONSID                          CSE006
      *                                                                   CSE006
      *** If trade is yield/discount traded security use %price           CSE006
      *                                                                   CSE006
     C           *IN42     IFEQ *ON                                       CSE006
     C                     MOVELPRICE     ZFLD15                          CSE006
     C                     Z-ADDCDP       ZDECS                           CSE006
     C                     MOVE 'J'       ZECODE                          CSE006
     C                     EXSR ZSEDIT                                    CSE006
     C                     MOVELZOUT21    CFPPR                           CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
EIN36C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** If new B/F indicator is on set the values of the carried        CSE006
      *** forward field to zero.                                          CSE006
      *                                                                   CSE006
     C           *IN37     IFEQ *ON                                       CSE006
     C                     MOVEL*ZERO     CFPRC                           CSE006
     C                     MOVEL*ZERO     CFNOM                           CSE006
??   C                     MOVEL*ZERO     CFPOSN                          CSE006
     C                     MOVEL*ZERO     CFPRC                           CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** Check Line count                                                CSE006
      *                                                                   CSE006
     C           LCOUNT    IFGE 55                                        CSE006
     C                     EXSR BRNCD                                     CSE006
     C                     WRITEHEADL5                                    CSE006
     C                     WRITEHEADL1                                    CSE006
     C                     Z-ADD13        LCOUNT                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     WRITECFWD1                                     CSE006
     C                     ADD  6         LCOUNT                          CSE006
      *                                                                   CSE006
     C           *IN42     IFEQ *ON                                       CSE006
     C                     ADD  1         LCOUNT                          CSE006
     C                     MOVE '0'       BF                              CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** Print todays profit                                             CSE006
      *                                                                   CSE006
     C                     MOVELCONSID    ZFLD15                          CSE006
     C                     Z-ADDCDP       ZDECS                           CSE006
     C                     MOVE '0'       ZECODE                          CSE006
     C                     EXSR ZSEDIT                                    CSE006
     C                     MOVE ZOUT21    PRFTDY                          CSE006
      *                                                                   CSE006
      *** Print month to date profit                                      CSE006
      *                                                                   CSE006
     C           *IN36     IFEQ *ON                                       CSE006
     C                     MOVE CONSID    ZFLD15                          CSE006
     C                     Z-ADDCDP       ZDECS                           CSE006
     C                     MOVE '0'       ZECODE                          CSE006
     C                     EXSR ZSEDIT                                    CSE006
     C                     MOVE ZOUT21    PRFMTD                          CSE006
     C                     ENDIF                                          CSE006
      *
     C           *IN37     IFEQ *ON                                       CSE006
      *
     C                     MOVE PRVCON    WPRVCO 150                      CSE006
     C                     MOVE CONSID    WCONSI 150                      CSE006
      *
     C           WPRVCO    SUB  WCONSI    TCONSI 150                      CSE006
     C                     Z-ADDTCONSI    ZFLD15                          CSE006
     C                     Z-ADDCDP       ZDECS                           CSE006
     C                     MOVE '0'       ZECODE                          CSE006
     C                     EXSR ZSEDIT                                    CSE006
     C                     MOVE ZOUT21    PRFMTD                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** If profit is calculated on a value date basis, output todays    CSE006
      *** profit and month to date profit                                 CSE006
      *                                                                   CSE006
     C           RPBS      IFNE 'T'                                       CSE006
     C                     WRITEPROF1                                     CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     ENDSR                                          CSE006
      *                                                                   CSE006
     C***************************************************************     CSE006
      /EJECT                                                              S01117
      *****************************************************************   S01117
      *                                                               *   S01117
      * *PSSR  - Database error subroutine.                           *   S01117
      *          This subroutine DUMPs the program just once.         *   S01117
      *                                                               *   S01117
      * Called by: DB ERROR PROCESSING                                *   S01117
      *                                                               *   S01117
      * Calls: None                                                   *   S01117
      *                                                               *   S01117
      *****************************************************************   S01117
      *                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR SR ** S01117
      *                                                                   S01117
     C           @RUN      IFEQ *BLANK                                    S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     ENDSR                                          S01117
      *                                                                   S01117
      ********************************************************************S01117
      /EJECT                                                              E29170
      *****************************************************************   E29170
      *                                                               *   E29170
      *  RCFP1 -- SUBROUTINE TO REGISTER P1 PRINTER FILE VIA RCF      *   E29170
      *                                                               *   E29170
      *****************************************************************   E29170
      *                                                                   E29170
     C           RCFP1     BEGSR                            ** RCFP1 **   E29170
      *                                                                   E29170
      ** Ensure report spool file recorded by RCF                         E29170
      *                                                                   E29170
     C                     Z-ADDSFNUM     ZSNUM   60                      E29170
      *                                                                   E29170
     C                     CALL 'ZSFILE'                                  E29170
     C                     PARM           SEQ     5                       E29170
     C                     PARM BCBA      SENTY   3                       E29170
     C                     PARM           SFILE                           E29170
     C                     PARM           ZSNUM                           E29170
     C                     PARM           ZSERR   1                       E29170
      *                                                                   E29170
     C           ZSERR     IFEQ 'Y'                                       E29170
      *                                                                   E29170
      ** Error during ZSFILE processing, return to calling program        E29170
      *                                                                   E29170
     C                     SETON                     U7U8LR               E29170
     C                     RETRN                                          E29170
     C                     END                                            E29170
      *                                                                   E29170
     C                     ENDSR                                          E29170
      *                                                                   E29170
      *****************************************************************   E29170
      /EJECT                                                              E29170
      *****************************************************************   E29170
      *                                                               *   E29170
      *  RCFAU -- SUBROUTINE TO REGISTER AU PRINTER FILE VIA RCF      *   E29170
      *                                                               *   E29170
      *****************************************************************   E29170
      *                                                                   E29170
     C           RCFAU     BEGSR                            ** RCFAU **   E29170
      *                                                                   E29170
      ** Ensure audit spool file recorded by RCF                          E29170
      *                                                                   E29170
     C                     Z-ADDSFNUMU    ZSNUMU  60                      E29170
      *                                                                   E29170
     C                     CALL 'ZSFILE'                                  E29170
     C                     PARM           SEQ                             E29170
     C                     PARM *BLANKS   SENTY                           E29170
     C                     PARM           SFILEU                          E29170
     C                     PARM           ZSNUMU                          E29170
     C                     PARM *BLANK    ZSERR                           E29170
      *                                                                   E29170
     C           ZSERR     IFEQ 'Y'                                       E29170
      *                                                                   E29170
      ** Error during ZSFILE processing, return to calling program        E29170
      *                                                                   E29170
     C                     SETON                     U7U8LR               E29170
     C                     RETRN                                          E29170
     C                     END                                            E29170
      *                                                                   E29170
     C                     ENDSR                                          E29170
      *                                                                   E29170
     C/EJECT                                                              054485
     C*****************************************************************   054485
     C*                                                               *   054485
     C*  BRNCD - Subroutine to set up Book and Branch code            *   054485
     C*                                                               *   054485
     C* Called by: MAIN                                               *   054485
     C*                                                               *   054485
     C* Calls: None                                                   *   054485
     C*                                                               *   054485
     C*****************************************************************   054485
     C*                                                                   054485
     C           BRNCD     BEGSR                            ** BRNCD **   054485
     C*                                                                   054485
     C** Set up branch code and book code                                 054485
     C*                                                                   054485
     C           *IN01     IFEQ '1'                                       054485
     C                     MOVE BBBA      BACOD                           054485
     C                     MOVE BBBK      BKCOD                           054485
     C                     END                                            054485
     C*                                                                   054485
     C           *IN02     IFEQ '1'                                       054485
     C           *IN03     OREQ '1'                                       054485
     C                     MOVE BCBA      BACOD                           054485
     C                     MOVE BCBO      BKCOD                           054485
     C                     END                                            054485
     C*                                                                   054485
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVE BKPRF     BKCOD                           CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C                     ENDSR                                          054485
     C*                                                                   054485
      *****************************************************************   E29170
      ***/EJECT**                                                   S01232S01195
     C***/COPY*ZSRSRC,XDATE3Z1                                      S01232S01195
      /EJECT                                                              S01195
     C/COPY ZSRSRC,ZACCH                                                  S01195
      /EJECT                                                              S01232
     C/COPY ZSRSRC,ZACCRZ1                                                S01232
      /EJECT                                                              S01232
     C/COPY ZSRSRC,ZACCZZ1                                                S01232
      /EJECT                                                              S01195
     C/COPY ZSRSRC,ZBKDT                                                  S01195
      /EJECT                                                              E20656
     C/COPY ZSRSRC,ZCNSDZ1                                                E20656
      /EJECT                                                              E48308
     C********************************************************************E48308
     C**  ZPRCI  - CONVERTS PRICE TO %PRICE                               E48308
     C*                                                                   E48308
     C/COPY ZSRSRC,ZPRCIZ1                                                E48308
     C*                                                                   E48308
      /EJECT
     C/COPY ZSRSRC,ZDATE1Z2
      /EJECT
     C/COPY ZSRSRC,ZDATE2Z4
      /EJECT
     C/COPY ZSRSRC,ZDAYSZ2
      /EJECT
     C/COPY ZSRSRC,ZDYYRZ3
      ***/EJECT*****************                                          E20087
     C***/COPY*ZSRSRC,ZEVCDZ1***                                          E20087
      /EJECT
     C/COPY ZSRSRC,ZICD2Z1
      /EJECT
     C/COPY ZSRSRC,ZICDSEZ1
      /EJECT                                                              E20380
     C/COPY ZSRSRC,ZLCDZ1                                                 E20380
      /EJECT
     C/COPY ZSRSRC,ZNCDZ3
      /EJECT
     C/COPY ZSRSRC,ZPRCOZ1
      /EJECT                                                              S01232
     C/COPY ZSRSRC,ZRATEZ1                                                S01232
      /EJECT
     C/COPY ZSRSRC,ZSDESCZ3
      /EJECT
     C/COPY ZSRSRC,ZSEDITZ3
      /EJECT
     C/COPY ZSRSRC,ZSYSTMZ1
      /EJECT                                                              S01232
     C/COPY ZSRSRC,ZYCEZ1                                                 S01232
      /EJECT
     C/COPY ZSRSRC,ZYLDOZ1
      /EJECT
     C/COPY ZSRSRC,ZYLDIZ1                                                E48308
      /EJECT                                                              E48308
     C/COPY ZSRSRC,ZYLDZ2
      /EJECT
     C/COPY ZSRSRC,ZAVPRZ1                                                E48308
      /EJECT                                                              E48308
     C/COPY ZSRSRC,ZCALCD                                                 E39495
      ***
**  CPY@
(c) Finastra International Limited 2001
**   TABMIN/TABMNM    Market indicator/Market Name
GGREY     PPRIMARY  SSECONDARY
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
0006001521029820444305904073650882610287117481320914670161311759219053
2051421975234362489726358278192928030741322023366335124365853804639507
40968424294389045351
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  POWER8 - ARRAY OF POWERS FOR CURRENCY CONVERSION
00000001
00000010
00000100
00001000
00010000
00100000
01000000
10000000
