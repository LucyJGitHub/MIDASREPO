     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Monthly profitability extract')               *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Securities Trading Module                            *
     F*                                                               *
     F*  SE0920 - MONTHLY PROFITABILITY EXTRACT                       *
     F*                                                               *
     F*  Function: To extract or calculate Profit and Loss data       *
     F*   (COB)    from Book Positions and Trades to be shown on the  *
     F*            Monthly Profitability Report, (SE0925).            *
     F*            Reset month-to-date figures on Book Position       *
     F*            Monthly statistics when report is run at Month-End.*
     F*                                                               *
     F*  Called by: SEC0903 - Monthly Profitability Report            *
     F*                                                               *
     F*            Frequency:                                         *
     F*            - On request during COB                            *
     F*            - Automatically at end of month using value date   *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      *  Prev Amend No. 226449             Date 24Jun15               *
      *                 MD034776           Date 09Jul15               *
      *                 AR1067108          Date 11Dec12               *
      *                 AR1001183A         Date 20Nov12               *
      *                 CSE105             Date 06Dec10               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CPK024             Date 24Feb06               *
      *                 BUG7798            Date 28Jul05               *
      *                 CSE071             Date 19Jul05               *
      *                 229857             Date 07Oct04               *
      *                 226570             Date 27Jun04               *
      *                 211407             Date 07Jan03               *
      *                 207543             Date 17JUL02               *
      *                 190677             Date 13MAR01               *
      *                 194370             Date 12Jul01               *
      *                 180056             Date 18Oct00               *
      *                 CSE037             Date 29Apr02               *
      *                 CSE035             Date 22Apr02               *
      *                 206316             Date 19Jul02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 17Jun01               *
      *                 CSE031             Date 09Nov01               *
      *                 180707             Date 25Jul00               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      *                 140272             Date 20Apr00               *
      *                 099459             Date 27Mar00               *
      * Midas DBA 3.02 -----------------------------------------------*
     F*                 CSE006             Date 25Jun99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 130862             Date 18Oct98               *
      *                 151945             DATE 06Jan99               *
     F*                 122266             Date 16Feb98               *
     F*                 CSE005             Date 04Feb97               *
     F*                 091803             DATE 19AUG96               *
     F*                 084704             DATE 01AUG96               *
     F*                 083039             DATE 01AUG96               *
     F*                 077580             DATE 30JUL96               *
     F*                 077581             DATE 30JUL96               *
     F*                 059110             DATE 25JUL96               *
     F*                 088047             DATE 26JUN96               *
     F*                 100228             DATE 31MAY96               *
     F*                 100630             DATE 24MAY96               *
     F*                 099886             DATE 18APR96               *
     F*                 100017             DATE 18APR96               *
     F*                 S01408             DATE 04MAR96               *
     F*                 092961             DATE 04OCT95               *
     F*                 091254             DATE 20OCT95               *
     F*                 086491             DATE 15JUN95               *
     F*                 080858             DATE 28DEC94               *
     F*                 S01502             DATE 02DEC94               *
     F*                 064575             DATE 15AUG94               *
     F*                 065301             DATE 05MAY94               *
     F*                 052254             DATE 10JAN94               *
     F*                 S01401             DATE 16JUN93               *
     F*                 E39495             DATE 18FEB93               *
     F*                 E48259             DATE 01FEB93               *
     F*                 E47922             DATE 01FEB93               *
     F*                 S01397             DATE 10SEP92               *
     F*                 E37395             DATE 24MAR92               *
     F*                 E37168             DATE 23MAR92               *
     F*                 E36491             DATE 27FEB92               *
     F*                 E35627             DATE 24FEB92               *
     F*                 E35608             DATE 11FEB92               *
     F*                 E29170             DATE 31OCT91               *
     F*                 E27934             DATE 22OCT91               *
     F*                 E27092             DATE 04SEP91               *
     F*                 S01117             DATE 20MAY91               *
     F*                 S01195             DATE 20MAY91               *
     F*                 S01269             DATE 16JUL90               *
     F*                 S01271             DATE 19JUN90               *
     F*                 E21587             DATE 04APR90               *
     F*                 E21581             DATE 04APR90               *
     F*                 E21526             DATE 04APR90               *
     F*                 E21525             DATE 04APR90               *
     F*                 E21512             DATE 04APR90               *
     F*                 E21668             DATE 01MAY90               *
     F*                 E21616             DATE 03APR90               *
     F*                 E20652             DATE 18DEC89               *
     F*                 S01232             DATE 14DEC89               *
     F*                 E20552             DATE 08DEC89               *
     F*                 E20568             DATE 09DEC89               *
     F*                 E20475             DATE 04DEC89               *
     F*                 E20380             DATE 08NOV89               *
     F*                 E20129             DATE 08NOV89               *
     F*                 E20125             DATE 08NOV89               *
     F*                 E20087             DATE 08NOV89               *
     F*                 E20085             DATE 08NOV89               *
     F*                 E19866             DATE 30/10/89              *
     F*                 E18800             DATE 03/07/89              *
     F*                 E15950             DATE 23/06/89              *
     F*                 E16772             DATE 20/06/89              *
     F*                 E16833             DATE 20/02/89              *
     F*                 E16780             DATE 10/02/89              *
     F*                 E16106             DATE 08/11/88              *
     F*                 E15714             DATE 08/11/88              *
     F*                 S01176             DATE 08/11/88              *
     F*                 S01169             DATE 08/11/88              *
     F*                 E14616             DATE 06/10/88              *
     F*                 E14013             DATE 11/07/88              *
     F*                 E13911             DATE 28/06/88              *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  MD046248 - Finastra Rebranding                               *
      *  226449 - Recompiled over changes made in /COPY ZDYYRZ3.      *
      *         - Applied for MD034387.                               *
      *  MD034776 - Reverse AR1001183A to allow negative interest     *
      *             rate. (Recompile)                                 *
      *  AR1067108 - PMC1140 Component failed during Clean COB        *
      *              Applied fix AR1001183A                           *
      *  AR1001183A - Coupon rate was still used in computation of    *
      *              interest instead of using the details in FRN tab *
      *              (Reopen) (Recompile)                             *
      *  CSE105 - Portuguese Upgrade - Discount/Premium Amortisation  *
      *           on Trade Date                                       *
      *  CPK024 - Packaging for MPLUS 1.2.1. EUTX from data structure *
      *           SESTAT was renamed to EUTXB                         *
      *  BUG7798- Remove fix 190677, as it removes code that is       *
      *           needed, causing incorrect Unrealised P&L.           *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  229857 - Recompiled due to change in ZYLDZ2.                 *
      *  226570 - Recompiled due to change in ZYLDZ2.                 *
      *  211407 - Recompile after change on copy sources ZYLDZ2,      *
      *           ZACCRZ1 and ZYCEZ1 for NX/NNX processing.           *
      *           The change was to call subroutine ZLCD1 instead     *
      *           of ZLCD in retrieving the PERIOD for NNX processing *
      *           and ZNCD1 is called instead of ZNCD in retrieving   *
      *           the WBENCD for NNX processing. Also rewrite tests   *
      *           for identifying if position is NX,NNX or CUM.       *
      *  207543 - CEU018 not working on a price basis.                *
      *           Recompiled over changed ZYLDZ2.                     *
      *  190677 - Unrealised P/L is not right due to it being divided *
      *           by 100 more than once. Remove part of 122266.       *
      *  194370 - Recompile after change on copy sources ZYLDZ2,      *
      *           For securities with divisor basis = '5' and first   *
      *           coupon date > valuation date (rundate + 1), set     *
      *           event control date to first coupon date before      *
      *           processing SR/ZDYYR. This is to ensure that the     *
      *           correct hypothetical last and next coupon dates are *
      *           used in deriving the price/yield rate.              *
      *  180056 - Recompiled over changed in ZDYYRZ3.                 *
      *  CSE037 - Bond Pricing - 3 Decimal Places in Trades Input     *
      *  CSE035 - NX/NNX Coupon Payment Processing.                   *
      *           Recompile over changed ZACCRZ1/ZYLDZ2/ZYCEZ1
      *  206316 - Recompiled over changed ZLCDZ1.                     *
      *  CPK015 - Conversion of ZYIELD from PLI to RPG.               *
      *           Recompile over changed ZYLDZ2.                      *
      *  CSE031 - Coupon Fixing for Floating Rate Notes.              *
      *           (recompilation due to change to ZNCD/ZLCD/ZACCR).   *
      *  180707 - No Position Settlements generated. Recompile over   *
      *           changes in /COPY ZNCDZ3.                            *
     F*  140272 - Recompile over changed ZYLDZ2                       *
     F*  099459 - Add 1 to WDD if leap year and month is February.    *
      *  CSE006 - Repurchase Agreements (REPOs) enhancement           *
      *           Buy-Sell Books are no longer processed              *
     F*  130862 - Recompiled over ZLCDZ1 & ZDAYSZ2 changes.           *
     F*  151945 - Recompiled Over changed ZDYYRZ3 .                   *
     F*  CSE005 - Effect of holidays on FRN Coupon Dates              *
     F*           (recompilation due to change to ZNCD/ZLCD/ZACCR).   *
     F*  122266 - Unrealised Profit and Loss was calculated incorrect-*
     F*           ly due to Nominal Position being truncated.  Change *
     F*           field length of WNOMNL to 17,4 so that it can       *
     F*           handle Nominal position with 12 digits.             *
     F*  091803 - Do unrealised profit/loss processing when the       *
     F*           market price exists as zero.                        *
     F*  084704 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
     F*  083039 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
     F*  077580 - monthly profitablity report should include (with    *
     F*           values reversed) trades cancelled this month but    *
     F*           completed in previous months .                      *
     F*           Also Mod. JB1441 upgraded from r21 .                *
     F*             Ignore BKMTHD record if security matured and all  *
     F*             amounts are zero.                                 *
     F*  077581 - (JB2907) 1p difference in U1realised P&L in SE0925  *
     F*           from SE0915 . This extract (for SE0925) changed to  *
     F*           agree with SE0915 . Note Unrealised P&L not accrued.*
     F*             a) quantity adjusted by current factor before     *
     F*                price extension ,not after (PROT=8 only).      *
     F*             b) instead of extending qty by (Market Price-     *
     F*                LastAveragePrice ) to get UnrP&L               *
     F*                Do 2 multiplications and net difference - this *
     F*                actually increases the chance of a rounding    *
     F*                error but conforms with SE0915 which reports   *
     F*                MarketValue .                                  *
     F*  059110 - Recompile over changed ZYLDZ2 sub.                  *
     F*  088047 - RECOMPILE over change SR/ZYLDZ2.                    *
     F*  100228 - RECOMPILE OVER CHANGED ZDYYRZ3, ZLCDZ1 & ZNCDZ3.    *
     F*  100630 - Unrealised P/L incorrect for yield based securities *
     F*  099886 - Rounding problem for partly paid securities.        *
     F*           Recompile over amended standard subroutine ZACCZ.   *
     F*  100017 - Position settlement unable to pick up day adj. on   *
     F*           SECTYD. Change subroutine to use DADJN to stop      *
     F*           interest day adjustment being used for amortisation.*
     F*           Recompile over amended subroutine ZDAYS.            *
     F*  S01408 - Addition of core hook SE0920FFP1
     F*           Addition of core hook SE0920CCP1
     F*           Addition of core hook SE0920CCP2
     F*           Addition of core hook SE0920CCP3
     F*           Addition of core hook SE0920CCP4
     F*  092961 - Recompile over ZDAYSZ2 which was amended by 086491  *
     F*           (Wrong number of days calculated for day basis 1    *
     F*           when start or end day is last day of February)      *
     F*  091254 - RECOMPILE OVER CHANGED ZLCDZ1 & ZNCDZ3              *
     F*  086491 - Wrong nbr of days calculated for day basis 1        *
     F*           when start or end day is last day of February       *
     F*           Recompiled for ZSRSRC/ZDAYSZ2 changes.              *
     F*  080858 - NMCY ALTERED BY DIARY EVENTS FILE                   *
     F*  S01502 - BLI Telekurs Processing.  Recompiled due to change  *
     F*           in length of SESTAT, 133 long.                      *
     F*  064575 - Recompiled over amended ZYLDZ2 subroutine.          *
     F*  065301 - Recompiled over changed copy source ZACCR subr.     *
     F*           with ZAMT increased to 15,0.                        *
     F*  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
     F*           to 10,9                                             *
     F*  S01401 - MT5xx SWIFT Messages Feature:                       *
     F*           - Recompiled due to changes to files.               *
     F*  E39495 - New /COPY subroutine ZCALCD added (called from      *
     F*           sr. ZYLD)                                           *
     F*         - /COPY subroutine ZCNSDZ1 added (called from sr.     *
     F*           ZYLD)                                               *
     F*         - Recompiled over changed ZYLDZ2                      *
     F*         - Some code changes were already applied under        *
     F*           gems#48259.                                         *
     F*  E48259 - UNREALIZED P/L WRONG FOR 'AU' YIELD SECURITIES      *
     F*  E47922 - Recompiled over changed SR/ZYLDZ2                   *
     F*  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
     F*           - Recompiled due to changes to files and SR/ZYLD.   *
     F*  E37395 - Interest earned is wrong on maturity of schuldschein*
     F*  E37168 - Discount amortisation should not be included on     *
     F*           trade date interest earned as on maturity the       *
     F*           discount will be shown in the realised profit       *
     F*  E36491 - Do not calculate ex-coupon interest if ex-coupon    *
     F*           nominal is from a previous coupon period            *
     F*  E35627 - Recompiled over changed printer file                *
     F*  E35608 - Charges and commissions often have wrong sign       *
     F*  E29170 - Report Control Facility changes                     *
     F*  E27934 - Recompiled over the changed version of ZACCRZ1      *
     F*  E27092 - Recompiled over changed SR/ZLCD                     *
     F*  S01117 - Multibranching                                      *
     F*  S01195 - Holiday processing                                  *
     F*  S01269 - TRADES AUTHORISATION PROCESSING                     *
     F*  S01271 - Recompiled for Pay/Receive in Input Cycle changes   *
     F*           to TRADSD and/or DPTMVD                             *
     F*  E21587 - Open Positions should show, even if all of the      *
     F*           calculated Profit figures are zero.                 *
     F*  E21581 - Incorrect Interest Earned on Matured Securities,    *
     F*           when Maturity Date does not fall on a standard      *
     F*           Coupon Date.(ie. not on Coupon Array on SECTYD).    *
     F*  E21526 - For Trades which were 'Made Complete' last month,   *
     F*           but which come to Value this month, the Purchased   *
     F*           Interest and charges were not being extracted.      *
     F*  E21525 - Should not report on Securities that Matured before *
     F*           the beginning of this Month.                        *
     F*  E21512 - File control problems - BKMTHA updated incorrectly. *
     F*  E21668 - Recompiled over changed SR/ZYLDZ2                   *
     F*  E21616 - Recompiled over changed SR/ZLCD.                    *
     F*  E20652 - Various amendments to Reallowance and Charges       *
     F*           processing of Trades .                              *
     F*  S01232 - Australian Yield Modifications.                     *
     F*  E20552 - Remove Discount Amortization on Trade Date Basis.   *
     F*  E20568 - ZACCZ changed to read Non-Diary Events File -       *
     F*           renamed record format of SECEO.                     *
     F*  E20475 - Reverse E18800 - error fixed in SE2220 instead      *
     F*  E20380 - ZYLDZ1/2 changed, SR/ZLCDZ1 now required.           *
     F*  E20129 - On Monthly run, do not write a new BKMTH record for *
     F*           next month if the Security has Matured.             *
     F*  E20125 - Unrealized Profit fields should be zero for Matured *
     F*           Holdings. Also, wrong dates were used in Unrealised *
     F*           Profit/Loss calculations for Discounted instruments.*
     F*  E20087 - Discount Amortization Processing:                   *
     F*           - Incorrect Unrealized P/L for Discounted 'T'       *
     F*             holdings. And: Chain fail on BKMTH should not be a*
     F*             Database Error.                                   *
     F*           - Include Discount/Premium Amortized this month in  *
     F*             Interest Earned.                                  *
     F*  E20085 - Interest and Coupon Calculations Rewrite:           *
     F*           - LF/SECEO member SEDEVD changed to omit RECI = 'C'.*
     F*           - 'CPs/DVs this Month' and 'Tot Int on Pos as at End*
     F*             of Last Month' are only updtd on BKMTH on a Value *
     F*             Date Basis, so the Trade Date 'Interest Earned'   *
     F*             calculation must use the Value Date CPDD and TIPN.*
     F*           - Because accrual is to ACDT now, instead of RPTDT, *
     F*             a chk must be made against MATY to avoid accruing *
     F*             past the Maturity Date.                           *
     F*           - Purchased Interest, (ITRA), from the Trades File, *
     F*             includes an Interest Adjustment. This should be   *
     F*             included in the Total Interest in SE0925, but to  *
     F*             simplify matters, it is just removed here, (from  *
     F*             the other side of the equation).                  *
     F*           - Various problems in BKMTH processing:             *
     F*           a) If record for new month had already been set up  *
     F*              by SE2220 (see E16780), or by prior run of SE0920*
     F*              in ACCR1, program read wrong record.             *
     F*           b) At EOM, program updated UPLE and TIPN on CURRENT *
     F*              month's record with figures for next month;      *
     F*           c) UPLE and TIPN not set up on 'T' records, so the  *
     F*              Interest and Unrealized P/L on trade-basis report*
     F*              were cumulative, not month-to-date;              *
     F*      Also: Efficiency improvements in EOM date calculations.  *
     F*           - SR/ZACCZ rewritten  to do the Interest Accrual    *
     F*             calculations correctly.                           *
     F*           - New Subroutine ZLCD added to get Last Coupon Date.*
     F*             File definitions added/amended for this purpose.  *
     F*           - Incorrect number of days calculated in ZDYYR for  *
     F*             divisor basis 3 because ZNCD had not been called. *
     F*           - FIX Interest Earned.                              *
     F*             Accruals are calculated incorrectly when program  *
     F*             runs in ONREQ phase. Related to E14616 fix below. *
     F*  E19866 - INCORRECT UPDATING OF BKMTHA WITH NO. OF RECORDS    *
     F*           BEING WRITTEN TO MPREXA : BKMTHA FIELD RENAMED.     *
     F*  E18800 - MARK TO MARKET REVAL P/L IS BEING ADDED TWICE TO    *
     F*           TOTAL REALISED P/L THIS MONTH.                      *
     F*  E15950 - MONTHLY PROFITABILITY SHOWED 0 FOR REALIZED         *
     F*           PROFIT/LOSS, EVEN THOUGH THE END OF THE MONTH RUN   *
     F*           SHOWED A DIFFERENT FIGURE.                          *
     F*  E16772 - Recompiled for the Dividend Payment Amount field    *
     F*           changes.                                            *
     F*  E16833 - BKMTHA FILE NOT BEING UPDATED CORRECTLY.            *
     F*  E16780 - DO NOT WRITE OUT BKMTHD RECORD IF ALREADY THERE,    *
     F*           AND UPDATE BKMTHA AUDIT FILE CORRECTLY.             *
     F*  E16106 - THE CHARGE/COMMISSIONS WERE INCORRECT FOR A         *
     F*           SECURITY WHICH HAS A CANCELLED TRADE                *
     F*  E15714 - REPORT ONLY PRINTS DETAILS FOR A SECURITY IF THERE  *
     F*           ARE DETAILS FOR BOTH TRADE AND VALUE DATE.          *
     F*  S01176 - SEC. TRAD. 3.1                                      *
     F*  S01169 - SEC. TRAD. 3.1 (BAER INCORP)                        *
     F*  E14616 - INTEREST ACCRUAL INCORRECT IF EVENTS OF TYPE        *
     F*           IR, PP, MP EXIST FOR SECURITY DURING THE ACCRUAL    *
     F*           PERIOD.                                             *
     F*  E14013 - Total Charges/Commissions allowing for Portfolio    *
     F*           Customers.                                          *
     F*  E13911 - POST INCORPORATION DEVELOPMENT FIX - IF ALL AMOUNT  *
     F*           FIELDS ARE ZERO DO NOT OUTPUT RECORD.               *
     F*                                                               *
     F*****************************************************************
      *
     FBKPHD   IF  E           K        DISK
     F                                              KINFDS AAADS          S01169
     F                                              KINFSR AAASR          S01169
     FPRICED  IF  E           K        DISK                               091803
     FBKPHDA  IF  E           K        DISK
     FBKMTH   UF  E           K        DISK         KINFDS BKMDS A
     F                                              KINFSR BKMSR
     FBKMTHA  UF  E           K        DISK
     FBKPOS   IF  E           K        DISK
     FTRDBR   IF  E           K        DISK
     F***TRDMTHT*IF**E***        K        DISK                     E20087 E20552
     F*********** TRADSDF                           KRENAMETRDMTHF E20087 E20552
     FSECTY   IF  E           K        DISK
     FSEDEV   IF  E           K        DISK
     FSECEO   IF  E           K        DISK                               E20085
     F            SEDEVDF                           KRENAMESEDEVDO        E20085
     F*********** SNDEVDF                           KIGNORE        E20085 E20568
     F            SNDEVDF                           KRENAMESNDEVDO        E20568
     F***SECED***IF**E***        K        DISK                     E14616 E20085
     F*********** SEDEVDF                           KRENAMESEDEVDF1 14616 E20085
     F*********** SNDEVDF                           KRENAMESNDEVDF1 14616 E20085
     F***SECET***IF**E***        K        DISK                     E14616 E20085
     F*********** SEDEVDF                           KRENAMESEDEVDF2 14616 E20085
     FINVTP   IF  E           K        DISK
     FCLINT   IF  E           K        DISK
     F            CLINTCAF                          KIGNORE
     F            CLINTCBF                          KIGNORE
     F            CLINTCCF                          KIGNORE
     F*********** CLINTC1F                          KIGNORE               S01169
     FTABSE   IF  E           K        DISK
     F* ICD 1     TABTB10F                          KIGNORE
     F* ICD 2     TABTB11F                          KIGNORE
     F* ICD SE    TABTB36F                          KIGNORE
     F            TABTB40F                          KIGNORE
     F* CCY       TABTG10F                          KIGNORE
     F            TABTG20F                          KIGNORE
     F            TABLETAF                          KIGNORE
     F            TABLETHF                          KIGNORE
     F*********** TABLETJF                          KIGNORE               S01232
     F            TABLETLF                          KIGNORE
     F            TABLETRF                          KIGNORE
     F            TABLETXF                          KIGNORE
     F            TABLET2F                          KIGNORE
     F            TABLET3F                          KIGNORE
     F            TABLET5F                          KIGNORE
     F            TABTE10F                          KIGNORE
     F            TABTE20F                          KIGNORE
     F            TABLETNF                          KIGNORE
     F            TABLETKF                          KIGNORE
     F            TABLETPF                          KIGNORE
     FMPREXD  O   E                    DISK         KINFDS IDDDS
     F                                              KINFSR IDDSR
     FMPREXA  O   E                    DISK         KINFDS IDADS
     F                                              KINFSR IDASR
     FSE0920AUO   E                    PRINTER
     F                                              KINFDS BBBDS          S01169
     F                                              KINFSR BBBSR          S01169
     F*                                                                   S01408
     F/COPY WNCPYSRC,SE0920FFP1                                           S01408
     F*                                                                   S01408
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*   10  - Error on Chain.                                       *
     F*   21  - No records in PRICED file                             *   091803
     F*   22  - No price record exists for a security                 *   091803
     F*   35  - Nominal Currency decimal places equal to 0            *
     F*   36  - Nominal Currency decimal places equal to 1            *
     F*   37  - Nominal Currency decimal places equal to 2            *
     F*   38  - Nominal Currency decimal places equal to 3            *
     F*   41  - Australian yield traded security                      *   S01232
     F*   57  - SHOW CONTROL DIFFERENCE ON REPORT                     *
     F*   80  - END OF FILE ON BKPHD                                  *
     F*   81  - END OF FILE ON TRDBR                                  *
     F*   85  - CURRENT FIFO TRADE FOUND FOR THIS POSITION            *   E20087
     F*   86  - END OF TRDMTHT RECORDS FOR THIS POSITION              *   E20087
     F*   87  - SHOW STATUS ON ERROR REPORT                           *
     F*                                                               *
     F* 90-99 - Used in Standard Subroutines.                         *
     F*                                                               *
     F*   U7  - Database Error.                                       *
     F*   U8  - Database / Control Error                              *
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*  FIRST  - FIRST TIME PROCESSING                               *
     F*  AUDIT  - AUDIT TIME PROCESSING                               *
     F*  SBKPOS - BOOK POSITION PROCESSING                            *
     F*  SINT   - SUBROUTINE TO CALCULATE INTEREST ON POSITION        *
     F*  STRADE - TRADE PROCESSING                                    *
     F*  SCLREX - SUB TO CLEAR DOWN EXTRACT RECORD AFTER WRITTEN      *
     F***ADJUPL*-*Adjust*Unreal.*P/L*for*discounted*trade*date*holding*   E20087
     F***ACCUM**-*Accumulate*trade*amounts*for*SR/ADJUPL*processing.***   E20087
     F*                                                               *
     F*  IDDSR  - HANDLE ERRORS IN MPREXD                             *
     F*  IDASR  - HANDLE ERRORS IN MPREXA                             *
     F*  *PSSR  - Error handling                                      *   S01117
     F*                                                               *
     F***XDATE3*-*TO*CALCULATE*ANY*NUMBER*OF*WORKING*DAYS*BACK.****S01232 S01195
     F*  ZACCR  - SUB TO CALCULATE INTEREST ACCRUED BETWEEN TWO DATES *
     F*  ZACCZ  - SUBROUTINE TO CALCULATE INTEREST ACCRUED ON A       *   E14616
     F*           SECURITY (NOT SCHULDSHEIN) UP TO A SPECIFIED DATE.  *   E14616
     F*  ZCALCD - Calculate LONG TERM CD PRICE from input yield       *   E39495
     F*  ZCNSD  - Calculate CONSIDERATION                             *   E39495
     F*  ZBKDT  - Calculate the nth working day back from a given     *   S01195
     F*           start date for a currency and (optional) location   *   S01195
     F*  ZCONV  - CONVERT AMOUNTS FROM ONE CURRENCY TO ANOTHER        *
     F*  ZDATE1 - TO VALIDATE DATES SUBMITTED AND CONVERT TO A NUMBER *
     F*           OF DAYS.                                            *
     F*  ZDATE2 - TO CONVERT A DAY NUMBER TO DATE FORMATS.            *
     F*  ZDAYS  - TO CALCULATE NUMBER OF DAYS BETWEEN TWO DATES FOR   *
     F*           INTEREST CALCULATIONS                               *
     F*  ZDYYR  - TO CALCULATE NO OF DAYS IN INTEREST YEAR            *
     F*  ZD5DYS - TO CALCULATE NO OF DAYS IN INT. YEAR FOR DVBS 5.    *
     F*  ZEVCD  - DETERMINE EVENT CONTROL DATE                        *
     F*  ZICD2  - ACCESS ICD2 RECORD                                  *
     F*  ZICDSE - ACCESS ICD FOR SE RECORD                            *
     F*  ZLCD   - DETERMINE LAST COUPON DATE                          *   E20085
     F*  ZNCD   - DETERMINE NEXT COUPON DATE                          *
     F*  ZPRCI  - TO CONVERT PRICE TO PERCENTAGE PRICE                *
     F*  ZRATE  - TO CALCULATE EFFECTIVE RATE                         *
     F*  ZSYSTM - ACCESS ICD1 RECORD                                  *
     F*  ZYCE   - SET UP CUM/EX PARAMETER FOR AUSTRALIAN YIELDS       *   S01232
     F*  ZYLDI  - TO CONVERT YIELD TO PERCENTAGE PRICE                *
     F*  ZYLDO  - SUBROUTINE TO OUTPUT PRICE AS PRICE/DISCOUNT/YIELD  *
     F*                                                               *
     F*****************************************************************
      /EJECT
     E                    CPY@    1   1 80
     E/COPY ZSRSRC,ZDAYSZ1
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY ZSRSRC,ZDATE6Z1                                               S01232
     E                    MM     12  12  2 0 DD      2 0 DAYS IN MONTHS
     E/COPY ZSRSRC,ZNCDZ1
     E/COPY ZSRSRC,ZPOWER8Z1
     E/COPY WNCPYSRC,SE0920E001
     E                    TDS        15 13 0                              E15714
     E                    VDS        15 13 0                              E15714
     E/COPY WNCPYSRC,SE0920E002
     E/COPY ZSRSRC,ZHOLE                                                  S01195
      /EJECT
     I***********                                                  E19866 E21512
     I***BKMTHAF*                                                  E19866 E21512
     I***********   NORE                            NOREBK         E19866 E21512
      *
      ***  Rename RECI from BKPHD to identify matured positions.
     IBKPHDDF                                                             E20125
     I              RECI                            RECIH                 E20125
      ***  Rename RECI from SECTYD to identify matured security.          E37395
     ISECTYDF                                                             E37395
     I              RECI                            RECIS                 E37395
      *                                                                                       CSE037
     IINVTPDF                                                                                 CSE037
     I              SFLG                            ISFLG                                     CSE037
     I*
     I/COPY ZSRSRC,ZNCDZ2
     I/COPY ZSRSRC,ZYLDZ1
     I/COPY ZSRSRC,ZHOLI                                                  S01195
     I/COPY ZSRSRC,ZHOLDS                                                 S01195
     I*                                                                   S01169
     I***  FILE INFORMATION DATA STRUCTURE FOR FILE BKPHD                 S01169
     I*                                                                   S01169
     IAAADS       DS                            366                       S01169
     I*                                                                   S01169
     I***  FILE INFORMATION DATA STRUCTURE FOR FILE SE0920AU              S01169
     I*                                                                   S01169
     IBBBDS       DS                            366                       S01169
     I*                                                                   S01169
     I***  FILE INFORMATION DATA STRUCTURE USED BY ERROR PROCESSING       S01169
     I*                                                                   S01169
     IEPFDS       DS                                                      S01169
     I                                        1 256 EPFDS1                S01169
     I                                      257 366 EPFDS2                S01169
     I*                                                                   S01169
     I***  PROGRAM STATUS DATA STRUCTURE USED BY ERROR PROCESSING         S01169
     I*                                                                   S01169
     IEPPDS      SDS                                                      S01169
     I                                        1  10 EPPP                  S01169
     I                                       81  90 EPPPL                 S01169
     I                                        1 253 EPPDS1                S01169
     I                                      254 429 EPPDS2                S01169
     I*                                                                   S01169
     IBKMDS       DS
     I                                     *STATUS  STSBKM
     I*
     IIDDDS       DS                            366
     I                                     *STATUS  STSIDD
     IIDADS       DS                            366
     I                                     *STATUS  STSIDA
     I*
     I* DATA STRUCTURE FOR BOOK HEADER MONTHLY KEY
     I*
     I            DS
     I                                        1  20 BKMKEY
     I                                        1  10 BKSS
     I***********                            11  130BKBR                  S01117
     I                                       11  13 BKBA                  S01117
     I                                       14  15 BKBO
     I                                       16  16 BKMK
     I                                       17  17 BKTV
     I                                    P  18  200BKED
     I/COPY WNCPYSRC,SE0920I001
     I*                                                                   E13911
     I* DATA STRUCTURE OVER TRADE & VALUE DATE FIELDS                     E13911
     I*                                                                   E13911
     I            DS                                                      E13911
     I                                        1  130TUPL                  E13911
     I                                       14  260TTIP                  E13911
     I                                       27  390TCDM                  E13911
     I                                       40  520TTRP                  E13911
     I                                       53  650TUPN                  E13911
     I                                       66  780TPSN                  E13911
     I                                       79  910TECP                  E13911
     I                                       92 1040TPIM                  E13911
     I                                      105 1170TSIM                  E13911
     I                                      118 1300TPST                  E13911
     I                                      131 1430TRAM                  E13911
     I                                      144 1560TCMT                  E13911
     I                                      157 1690TCCT                  E13911
     I                                      170 1820TCMD                  E13911
     I                                      183 1950TCCD                  E13911
     I/COPY WNCPYSRC,SE0920I005
     I                                        1 195 TDS                   E13911
     I/COPY WNCPYSRC,SE0920I006
     I            DS                                                      E13911
     I                                        1  130VUPL                  E13911
     I                                       14  260VTIP                  E13911
     I                                       27  390VCDM                  E13911
     I                                       40  520VTRP                  E13911
     I                                       53  650VUPN                  E13911
     I                                       66  780VPSN                  E13911
     I                                       79  910VECP                  E13911
     I                                       92 1040VPIM                  E13911
     I                                      105 1170VSIM                  E13911
     I                                      118 1300TPSV                  E13911
     I                                      131 1430VRAM                  E13911
     I                                      144 1560VCMT                  E13911
     I                                      157 1690VCCT                  E13911
     I                                      170 1820VCMD                  E13911
     I                                      183 1950VCCC                  E13911
     I/COPY WNCPYSRC,SE0920I007
     I                                        1 195 VDS                   E13911
     I/COPY WNCPYSRC,SE0920I002
     I*                                                                   E13911
      ***  Local Data Area for DB Error Information
     ILDA         DS                            256                       S01117
     I                                      134 183 DBLOT                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     I*LDA******* UDS                            256                      S01117
     I***********                           134 177 DBLOT                 S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 1770DBASE                 S01117
     I*
     I*    SESTAT DATA STRUCTURE
     I*
     IDTAARA    E DSSESTAT
     I              EUTX                            EUTXB                                     CPK024
     I/COPY WNCPYSRC,SE0920I004
      *                                                                                       CSE105
     ISCSARD    E DSSCSARDPD                                                                  CSE105
      *                                                                                       CSE105
      ** SAR Descriptions                                                                     CSE105
      *                                                                                       CSE105
     I*
     I*   KEY FOR MPREXD FILE (USED ONLY IN ERROR HANDLING)
     IMPRKEY      DS
     I***********                             1   30MPBR                  S01117
     I                                        1   3 MPBA                  S01117
     I                                        4   5 MPBK
     I                                        6   8 MPNC
     I                                        9   9 MPMK
     I                                       10  12 MPIN
     I                                       13  22 MPSS
     I*
     I*   KEY FOR INVTPD FILE (USED ONLY IN ERROR HANDLING)
     IINVKDS      DS
     I                                        1   3 NMCY
     I                                        4   6 SITP
     I*
     I*   KEY FOR BKPOS  FILE (USED ONLY IN ERROR HANDLING)
     IBKPKDS      DS
     I                                        1  10 BHSC
     I***********                            11  130BHBR                  S01117
     I                                       11  13 BHBA                  S01117
     I                                       14  15 BHBK
     I                                       16  16 BHMK
     I                                       17  17 BHTV
     I                                    P  18  200LPSD
     I*
     I* DATA STRUCTURE FOR TABLE FILE KEY
     I            DS
     I                                        1  12 TABKEY
     I                                        1   20RECT
     I                                        3  10 ZZ008
     I                                       11  120RCDE
     I                                        3   8 ZZ006
     I                                        9  11 RCCY
     I                                       12  12 ZZ001
     I*
     I*   DATE FIELD FOR BKMTHD NEW RECORD IN W02 SUBR
     I*
     I            DS
     I                                        1   60WDATEE
     I                                        1   20WDD
     I                                        3   40WMM
     I                                        5   60WYY
      *
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
      *                                                                   CSE006
     ISDBOOK    E DSSDBOOKPD                                              CSE006
      *                                                                   CSE006
      ** Book Details                                                     CSE006
      *                                                                   CSE006
     IDSFDY     E DSDSFDY                                                 CSE006
      *                                                                   CSE006
      ** Short data structure for access programs (200 long)              CSE006
      *                                                                   CSE006
     I              'DiscPremAmortPostn  'C         SVALKK                                    CSE105
      *                                                                                       CSE105
     I/COPY WNCPYSRC,SE0920I003
     C/EJECT
      *================================================================
      *  P R O G R A M   S T A R T                                    *
      *================================================================
      *
      ***  Define Work fields.
      *
     C           *LIKE     DEFN BHSC      SBHSC
     C************LIKE     DEFN BHBR      SBHBR                           S01117
     C           *LIKE     DEFN BHBA      SBHBA                           S01117
     C           *LIKE     DEFN BHBK      SBHBK
     C           *LIKE     DEFN BHMK      SBHMK
     C           *LIKE     DEFN BHTV      SBHTV
     C           *LIKE     DEFN BHSC      TRBHSC
     C************LIKE     DEFN BHBR      TRBHBR                          S01117
     C           *LIKE     DEFN BHBA      TRBHBA                          S01117
     C           *LIKE     DEFN BHBK      TRBHBK
     C           *LIKE     DEFN BHMK      TRBHMK
      *
      *  DEFINE KEY LIST FOR READING BKPOS
      *
     C           BKPOSK    KLIST
     C                     KFLD           BHSC
     C***********          KFLD           BHBR                            S01117
     C                     KFLD           BHBA                            S01117
     C                     KFLD           BHBK
     C                     KFLD           BHMK
     C                     KFLD           BHTV
     C                     KFLD           LPSD
     C*
     C* KEY LIST FOR SET LOW  OF BOOK POSITION HEADER  MONTH END FILE
     C*
     C           BMKEY     KLIST
     C                     KFLD           BKSS
     C***********          KFLD           BKBR                            S01117
     C                     KFLD           BKBA                            S01117
     C                     KFLD           BKBO
     C                     KFLD           BKMK
     C                     KFLD           BKTV
     C                     KFLD           BKED
     C*
     C* KEY LIST FOR READ EQUAL OF BOOK POSITION HEADER  MONTH END FILE
     C*
     C           BMKY      KLIST
     C                     KFLD           BKSS
     C***********          KFLD           BKBR                            S01117
     C                     KFLD           BKBA                            S01117
     C                     KFLD           BKBO
     C                     KFLD           BKMK
     C                     KFLD           BKTV
     C*
     C*  DEFINE KEY LIST FOR READING TRDBR
      *
     C           TRDBRK    KLIST
     C***********          KFLD           SBHBR                           S01117
     C                     KFLD           SBHBA                           S01117
     C                     KFLD           SBHSC
     C                     KFLD           SBHBK
     C                     KFLD           SBHMK
      *                                                                   E20087
      ***  Define Key List for reading TRDMTHT.                           E20087
      *                                                                   E20087
     C           TRDMTK    KLIST                                          E20087
     C***********          KFLD           BHBR                     E20087 S01117
     C                     KFLD           BHBA                            S01117
     C                     KFLD           BHBK                            E20087
     C                     KFLD           BHSC                            E20087
     C                     KFLD           BHMK                            E20087
     C*
     C*  DEFINE KEY LIST FOR READING INVTP
      *
     C           INVTPK    KLIST
     C                     KFLD           NMCY
     C                     KFLD           SITP
     C*                                                                   091803
     C** PRICED file key                                                  091803
     C*                                                                   091803
     C           PKEY      KLIST                                          091803
     C                     KFLD           PSSN                            091803
     C                     KFLD           PPRT                            091803
     C                     KFLD           PVDT                            091803
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0920CCP1                                           S01408
     C*                                                                   S01408
     C*
     C* RECEIVE PARAMETER
     C           *ENTRY    PLIST
     C                     PARM           TVTYP   1                       E15714
     C                     PARM           RUNTYP  1
     C*
     C* ACCESS ICD INFORMATION
     C*
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE *BLANK    DBLOT                           S01117
     C                     MOVE 'SE0920  'DBPGM
     C                     OUT  LDA                                       S01117
     C                     MOVE *ZEROS    TDS                             E13911
     C                     MOVE *ZEROS    VDS                             E13911
     C                     EXSR FIRST
     C*
     C* CHECK FOR DATABASE ERRORS
     C*
     C           *IN99     CABEQ'1'       EAUDIT
     C*
     C** READ EACH BOOK POSITION HEADER RECORD
     C*
     C                     READ BKPHD                    80
     C           *IN80     DOWNE'1'
      *                                                                   CSE006
      **  If CSE006 is on and book code is a buy-sell book, read next     CSE006
      **  book position header record                                     CSE006
      *                                                                   CSE006
     C           CSE006    IFEQ 'Y'                                       CSE006
     C                     CALL 'AOBOOKR0'                                CSE006
     C                     PARM *BLANKS   @RTCD   7                       CSE006
     C                     PARM '*KEY   ' @OPTN   7                       CSE006
     C                     PARM BHBK      @BKCD   2                       CSE006
     C           SDBOOK    PARM SDBOOK    DSFDY                           CSE006
     C           BDBYSL    IFEQ 'Y'                                       CSE006
     C                     ADD  1         ZINS                            CSE006
     C                     GOTO BYSEL                                     CSE006
     C                     ENDIF                                          CSE006
     C                     ENDIF                                          CSE006
     C*
     C** If security change read security record and investment
     C** Type record
     C           BHSC      IFNE SBHSC
     C           BHSC      CHAINSECTY                10
     C  N10      RECI      COMP '*'                      10
     C           *IN10     IFEQ '1'
     C                     MOVE 'SECTY'   DBFILE           ***************
     C                     MOVELBHSC      DBKEY            * DB ERROR 04 *
     C                     Z-ADD4         DBASE            ***************
     C                     SETON                     99U7U8
     C                     GOTO EAUDIT
     C                     END
     C                     MOVE NMCY      NMCYS   3                       080858
     C*                                                                   S01232
     C* INDICATE AUSTRALIAN YIELD SECURITY                                S01232
     C*                                                                   S01232
     C           STBS      IFEQ 'Y'                                       S01232
     C           SYBS      ANDEQ'AU'                                      S01232
     C                     SETON                     41                   S01232
     C                     ELSE                                           S01232
     C                     SETOF                     41                   S01232
     C                     END                                            S01232
     C***********          Z-ADDCDP       NCDP                     S01232 E48259
     C*
     C           INVTPK    CHAININVTP                10
     C  N10      RECI      COMP '*'                      10
     C           *IN10     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'INVTP'   DBFILE           ***************
     C                     MOVELINVKDS    DBKEY            * DB ERROR 05 *
     C                     Z-ADD5         DBASE            ***************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     SETON                     99U7U8
     C                     GOTO EAUDIT
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0920CCP2                                           S01408
     C*                                                                   S01408
     C*
     C*  READ TABTG10 TO GET NOMINAL CURRENCY DEC PLACES
     C*
     C                     MOVE *BLANK    ZZ006
     C                     MOVE '20'      RECT
     C                     MOVE 1         ZZ001
     C                     MOVE NMCY      RCCY
     C*
     C           TABKEY    CHAINTABTG10F             10
     C  N10      RECI      COMP '*'                      10
     C           *IN10     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE           ***************
     C                     MOVELTABKEY    DBKEY            * DB ERROR 06 *
     C                     Z-ADD6         DBASE            ***************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     SETON                     99U7U8
     C                     GOTO EAUDIT
     C                     END
     C                     END
     C                     Z-ADDCDP       NCDP                            E48259
     C*
     C** Save type of last change
     C                     MOVELBHSC      SBHSC
     C***********          MOVELBHBR      SBHBR                           S01117
     C                     MOVELBHBA      SBHBA                           S01117
     C                     MOVELBHBK      SBHBK
     C                     MOVELBHMK      SBHMK
     C*
     C* Process all Book position records with the same
     C* Sec, Br, Book, Mkt
     C           BHSC      DOWEQSBHSC
     C***********BHBR      ANDEQSBHBR                                     S01117
     C           BHBA      ANDEQSBHBA                                     S01117
     C           BHBK      ANDEQSBHBK
     C           BHMK      ANDEQSBHMK
     C           *IN80     ANDNE'1'
     C*
     C** Maintain count of BOOK POSITION HEADER records input
     C                     ADD  1         ZINS
      *                                                                   E21525
      ***  Do not process Securities that Matured before                  E21525
      ***  the End of Last Month.                                         E21525
      *                                                                   E21525
     C           MATY      IFEQ 0                                         E21525
     C           MATY      ORGT PMNDT                                     E21525
     C*
     C*  ACCESS BPPK HEADER MONTHLY STATISTICS FILE
     C*
     C                     MOVE BHSC      BKSS
     C***********          Z-ADDBHBR      BKBR                            S01117
     C                     MOVE BHBA      BKBA                            S01117
     C                     MOVE BHBK      BKBO
     C                     MOVE BHMK      BKMK
     C                     MOVE BHTV      BKTV
      *                                                                   E20085
      ** Following line changed to prevent accessing next month's record. E20085
     C***********          MOVE *HIVAL    BKED                            E20085
     C                     MOVELEOPT      BKED                            E20085
     C           BMKEY     SETLLBKMTH                                     E20487
     C           BMKY      READEBKMTH                    88               E20487
     C  N88      BKID      COMP '*'                      88
     C*
     C**OUTPUT*DATABASE*ERROR*ONLY*IF*LATEST*POSTION*CHANGE*DATE*ON*BOOK  E20087
     C****POSITION*HEADER*NON-ZERO*(TRADE*CANCELLED*ON*SAME*DAY*AS*INPUT) E20087
     C** If BKMTH record not found, simply ignore - no DB error.          E20087
     C*
     C************IN88     IFEQ '1'                                       E20087
     C***********LPCD      ANDNE0                                         E20087
     C***********          MOVE '1'       *IN99                           E20087
     C***********          MOVE '1'       *INU7                           E20087
     C***********          MOVE '1'       *INU8            ***************E20087
     C***********          Z-ADD07        DBASE            * DB ERROR 07 *E20087
     C***********          MOVEL'BKMTH'   DBFILE           ***************E20087
     C***********          MOVELBKMKEY    DBKEY                           E20087
     C***********          END                                            E20087
     C*
     C**Process*Book*Position*header***********************************   E20129
      *---------------------------------------------------------------*
      ***  Process Book Month Position record.                        *   E20129
      *                                                               *   E20129
      *  UPLE/TUPL/VUPL - Unrealised Profit/Loss as at Last EOM.      *
      *  BCDM/TCMD/VCMD - Commission on Coupons/Dividends This Month. *
      *  BCCM/TCCD/VCCC - Charges on Coupons/Dividends This Month.    *
      *  BPIT/TPST/TPSV - Net PI/SI on Trades Reversed This Month.    *
      *  RPTM/          - Realised Profit/Loss This Month.            *
      *  MMPL/          - Mark to Market Profit/Loss This Month.      *
      *      /TTRP/VTRP - Total Realised Profit/Loss This Month.      *
      *  TIPN/TTIP/VTIP - Total Interest on Position as at Last EOM.  *
      *  CPDD/TCDM/VCDM - Coupons Received/Dividends Declared Due     *
      *                   This Month.                                 *
      *  DPTM/          - Discount/Premium Amortised This Month.      *
      *      /TPSN/VPSN - Total Interest on Total Nominal Now.        *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                                   077580
      * Ignore record if security matured and all amounts are zero        077580
     C           RECIS     IFNE 'D'                                       077580
     C           BPIT      ANDEQ0                                         077580
     C           TIPN      ANDEQ0                                         077580
     C           UPLE      ANDEQ0                                         077580
     C           CPDD      ANDEQ0                                         077580
     C           BCDM      ANDEQ0                                         077580
     C           BCCM      ANDEQ0                                         077580
     C           MMPL      ANDEQ0                                         077580
     C           RPTM      ANDEQ0                                         077580
     C/COPY WNCPYSRC,SE0920C015
     C                     MOVE *ON       *IN88                           077580
     C                     ENDIF                                          077580
      *                                                                   077580
      *
     C           *IN88     IFEQ '0'
      *
      ***  Trade Date Basis
     C           BHTV      IFEQ 'T'
     C                     ADD  UPLE      TUPL
     C***********          ADD  TIPN      TTIP                            E20085
     C***********          ADD  CPDD      TCDM                            E20085
     C                     ADD  BCDM      TCMD
     C                     ADD  BCCM      TCCD
     C                     ADD  BPIT      TPST
     C***********RPTM      ADD  MMPL      TTRP                            E18800
     C***********          Z-ADDRPTM      TTRP                     E18800 E20475
     C           RPTM      ADD  MMPL      TTRP                            E20475
     C/COPY WNCPYSRC,SE0920C014
      *                                                                                       CSE105
      ** If the system value is set to T-Trade Date Position or B-Both, add                   CSE105
      ** discount/premium amortised this month to total interest on total nominal             CSE105
      *                                                                                       CSE105
     C           CSE105    IFEQ 'Y'                                                           CSE105
     C           SESVAL    ANDEQ'T'                                                           CSE105
     C           CSE105    OREQ 'Y'                                                           CSE105
     C           SESVAL    ANDEQ'B'                                                           CSE105
     C                     ADD  DPTM      TPSN                                                CSE105
     C                     ENDIF                                                              CSE105
      *
      ***  Else, Value Date Basis
     C                     ELSE
     C                     ADD  UPLE      VUPL
     C                     ADD  TIPN      TTIP                            E20085
     C                     ADD  TIPN      VTIP
     C                     ADD  CPDD      TCDM                            E20085
     C                     ADD  CPDD      VCDM
     C                     ADD  BCDM      VCMD
     C                     ADD  BCCM      VCCC
     C                     ADD  BPIT      TPSV
     C***********          ADD  DPTM      TPSN                      E20087E37168
     C                     ADD  DPTM      VPSN                            E20087
     C***********RPTM      ADD  MMPL      VTRP                            E18800
     C***********          Z-ADDRPTM      VTRP                     E18800 E20475
     C           RPTM      ADD  MMPL      VTRP                            E20475
     C/COPY WNCPYSRC,SE0920C016
     C                     END
     C                     END
     C*
     C* Access Book position record for this month
     C           BKPOSK    CHAINBKPOS                10
     C  N10      RECI      COMP '*'                      10
     C           *IN10     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'BKPOS'   DBFILE           ***************
     C                     MOVELBKPKDS    DBKEY            * DB ERROR 08 *
     C                     Z-ADD8         DBASE            ***************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     SETON                     99U7U8
     C                     GOTO EAUDIT
     C                     END
     C*
     C* Process Book Position record
     C                     EXSR SBKPOS
     C*
     C* Process all Trade records for this Book Position
     C* within month  (ONLY DO ONCE FOR EACH BR,SEC,BK,MKT COMB'N)
     C*
     C***********TRBHBR    IFNE SBHBR                                     S01117
     C           TRBHBA    IFNE SBHBA                                     S01117
     C           TRBHSC    ORNE SBHSC
     C           TRBHBK    ORNE SBHBK
     C           TRBHMK    ORNE SBHMK
     C*
     C           TRDBRK    SETLLTRDBR                    81
     C           *IN81     DOUEQ'1'                                       E16106
     C***********RECI      ORNE 'C'                                 E16106077580
     C***********RECI      ANDNE'L'                                 S01269077580
     C           RECI      ORNE 'L'                                       077580
     C           RECI      ANDNE'P'                                       S01269
     C                     READ TRDBR                    81
     C                     END                                            E16106
     C*
     C* Process all trades records in BR, SEC, BOOK, MARKET
     C* and with Date made complete LE Report date.
     C***********TDBR      DOWEQSBHBR                                     S01117
     C           TDBA      DOWEQSBHBA                                     S01117
     C           TDSS      ANDEQSBHSC
     C           TDBK      ANDEQSBHBK
     C           TDMI      ANDEQSBHMK
     C           TDMC      ANDLERPTDT
     C           *IN81     ANDNE'1'
      *
     C           TDMC      IFNE *ZEROS
      *                                                                   077580
      *  set flag for cancellations...                                    077580
     C           RECI      IFNE 'C'                                       077580
     C           RECI      ANDNE'*'                                       077580
     C                     MOVE *OFF      REVERS  1                       077580
     C                     ELSE                                           077580
     C                     MOVE *ON       REVERS  1                       077580
     C                     ENDIF                                          077580
      *                                                                   077580
      *  Process non-cancellations ...                                    077580
     C           REVERS    IFEQ *OFF                                      077580
      *                                                                   077580
      *  ..... and cancellations this month of previous months            077580
     C           TDMC      ORLE PMNDT                      made comp lastM077580
     C           LCD       ANDGTPMNDT                      cancel this Mon077580
     C           LCD       ANDLERPTDT                      before runDate 077580
     C                     EXSR STRADE
     C                     ENDIF                                          077580
     C                     END
     C*
     C* READ NEXT TRADES DETAIL RECORD
     C           *IN81     DOUEQ'1'                                       E16106
     C***********RECI      ORNE 'C'                                 E16106077580
     C***********RECI      ANDNE'L'                                 S01269077580
     C           RECI      ORNE 'L'                                       077580
     C           RECI      ANDNE'P'                                       S01269
     C                     READ TRDBR                    81
     C                     END                                            E16106
      ***  End of Do While (Process all Trades)
     C                     END
      *
     C***********          MOVE SBHBR     TRBHBR                          S01117
     C                     MOVE SBHBA     TRBHBA                          S01117
     C                     MOVE SBHSC     TRBHSC
     C                     MOVE SBHBK     TRBHBK
     C                     MOVE SBHMK     TRBHMK
      ***  End of If Not Equal (Process all Trades for Book Position).
     C                     END
     C*
     C***If*monthly*run*Reset*monthly*fields*on*BOOK*Position**********   E20129
     C***Header********************************************************   E20129
      ***  If monthly run, Reset the fields on BOOK Month Position, BUT   E20129
      ***  DO NOT write a new record if the Security has Matured.         E20129
      *                                                                   E20129
     C           RUNTYP    IFEQ 'Y'
     C           MATY      ANDGTBKED                                      E20129
     C*                                                                   E20129
     C** Must also check for MATY = 0 (stock, warrants, baskets/funds).   E20129
     C           RUNTYP    OREQ 'Y'                                       E20129
     C           MATY      ANDEQ0                                         E20129
      *                                                                   E20085
      ***  If record exists for next month, update it, else write one.    E20085
      ***  Record for current month should NOT be updated at EOM.         E20085
      *                                                                   E20085
     C                     MOVE BHSC      BKSS                            E20085
     C***********          Z-ADDBHBR      BKBR                     E20085 S01117
     C                     MOVE BHBA      BKBA                            S01117
     C                     MOVE BHBK      BKBO                            E20085
     C                     MOVE BHMK      BKMK                            E20085
     C                     MOVE BHTV      BKTV                            E20085
     C                     Z-ADDBKEDNM    BKED                            E20085
     C           BMKEY     CHAINBKMTH                88                   E20085
     C*                                                                   E20085
     C** Initialize TIPN here to avoid lots of ELSEs below.               E20085
     C                     Z-ADD0         TIPN                            E20085
     C/COPY WNCPYSRC,SE0920C017
     C*                                                                   E20085
     C           BKTV      IFEQ 'V'
     C***********          Z-ADDVPSN      TIPN                            E15950
     C*                                                                   E20085
     C           STBS      IFNE 'D'                                       E20085
     C           VPSN      SUB  VECP      TIPN                            E15950
     C                     END                                            E20085
     C*                                                                   E20085
     C                     Z-ADDVUPN      UPLE
     C                     ELSE
     C** No need to clear TIPN here. It's already been done above.        E20085
     C***********          Z-ADD0         TIPN                            E20085
      *                                                                   E20085
      ***  Failure to set up UPLE here caused figure on trade-basis       E20085
      ***  Profitability Report to be cumulative, not month-to-date.      E20085
      *                                                                   E20085
     C                     Z-ADDTUPN      UPLE                            E20085
     C                     END
     C**N88******          UPDATBKMTHDF                                   E20085
     C*
     C* WRITE NEXT MONTHS STATISTICS RECORD  IN W02 SUBR
     C*       if not already there                                        E16780
     C*
     C           *IN88     IFEQ '0'                                       E20085
     C                     UPDATBKMTHDF                                   E20085
     C                     ELSE                                           E20085
     C***********          MOVELEOPT      WORK50  50               E16780 E20085
     C***********BKED      IFEQ WORK50                             E16780 E20085
     C                     EXSR W02
     C***********          END                                     E16780 E20085
     C*
     C* INCREMENT COUNT OF MONTHLY RECORDS (U02 IN ELEMENT)
     C*
     C                     ADD  1         U02CNT  50
     C                     END                                            E20085
     C*
      ***  If processing a 'V' record with interest at EOM, retrieve      E20085
      ***  the 'T' record and update. Else, TIPN on the 'T' record will   E20085
      ***  always be zero.                                                E20085
      *                                                                   E20085
     C           BHTV      IFEQ 'V'                                       E20085
     C           TIPN      ANDNE0                                         E20085
     C*                                                                   E20085
     C** This process does not apply to discounted instruments.           E20085
     C           STBS      ANDNE'D'                                       E20085
     C*                                                                   E20085
     C                     MOVE 'T'       BKTV                            E20085
     C           BMKEY     CHAINBKMTH                88                   E20085
     C           *IN88     IFEQ '0'                                       E20085
     C           TPSN      SUB  TECP      TIPN                            E20085
     C                     UPDATBKMTHDF                                   E20085
     C                     END                                            E20085
     C                     END                                            E20085
     C*                                                                   E20085
      ***  End of If RUNTYP = 'Y' (Monthly Run)
     C                     END
      *                                                                   E21525
      ***  End of Maturity Date check.                                    E21525
     C                     END                                            E21525
      *                                                                   CSE006
      **  If CSE006 is on and book code is a buy-sell book, read next     CSE006
      **  book position header record                                     CSE006
      *                                                                   CSE006
     C           BYSEL     TAG                                            CSE006
      *                                                                   E21525
     C** Read next Book position header file record
     C                     READ BKPHD                    80
     C*
     C** NEXT END IS END OF 'BHSC DOWEQ SBHSC ......'
     C*
     C                     END
     C*                                                                   E13911
     C** IF ALL AMOUNT FIELDS ARE ZERO DO NOT OUTPUT RECORD               E13911
     C*                                                                   E13911
     C                     XFOOTTDS       WTDS   150                      E15714
     C                     XFOOTVDS       WVDS   150                      E15714
     C*                                                                   E15714
     C           TVTYP     IFEQ 'T'                                       E15714
     C           WTDS      ANDNE*ZEROS                                    E15714
     C           TVTYP     OREQ 'V'                                       E15714
     C           WVDS      ANDNE*ZEROS                                    E15714
      *                                                                   E21587
      ***  All open Positions (i.e. not 0 and not Matured) should print   E21587
     C           TVTYP     OREQ 'T'                                       E21587
     C           NPSNT     ANDNE0                                         E21587
     C           TVTYP     OREQ 'V'                                       E21587
     C           NPSNV     ANDNE0                                         E21587
      *                                                                   E21587
      ***  At month end, extract is for value AND trade date reports.     E21587
     C           RUNTYP    OREQ 'Y'                                       E21587
     C           NPSNT     ANDNE0                                         E21587
     C           RUNTYP    OREQ 'Y'                                       E21587
     C           WTDS      ANDNE0                                         E21587
      *                                                                   E21587
     C***********TDS       IFNE *ZEROS                             E13911 E15714
     C***********VDS       ANDNE*ZEROS                             E13911 E15714
     C*
     C** Set up and output extract record
     C*
     C* Move in fields that are not automaticaly moved
     C                     MOVE 'D'       RECI
     C***********          MOVE SBHBR     MPBR                            S01117
     C                     MOVE SBHBA     MPBA                            S01117
     C                     MOVE SBHBK     MPBK
     C***********          MOVE NMCY      MPNC                            O80958
     C                     MOVE NMCYS     MPNC                            080858
     C                     MOVE SBHMK     MPMK
     C                     MOVE SITP      MPIN
     C                     MOVE SBHSC     MPSS
     C*
     C                     WRITEMPREXDF
     C/COPY WNCPYSRC,SE0920C001
     C                     ADD  1         ZROUT   50
     C                     END                                            E13911
     C*
     C* Clear down extract  ready for next batch
     C                     EXSR SCLREX
      *                                                                   E21587
      ***  Clear Nominal Position work fields.                            E21587
     C                     Z-ADD0         NPSNT  150                      E21587
     C                     Z-ADD0         NPSNV  150                      E21587
     C*
      ***  End of Do While *IN80 = '0' (Reading Book Position Headers)
     C                     END
     C*
     C           EAUDIT    TAG                             *** EAUDIT ***
     C*
     C* OUTPUT RUN CONTROL REPORT
     C*
     C                     EXSR AUDIT
     C*
      *================================================================
      *  P R O G R A M     E N D                                      *
      *                                                               *
     C                     SETON                     LR
      *                                                               *
      *================================================================
      /EJECT
      *****************************************************************
      *                                                               *
      *  FIRST  - Subroutine to access ICD Information.               *
      *                                                               *
      *  Calls - ZSYSTM, ZICD2, ZICDSE, ZEVCD                         *
      *                                                               *
      *****************************************************************
      *
     C           FIRST     BEGSR                           *** FIRST  ***
     C*
     C* ACCESS ICD1
     C*
     C                     EXSR ZSYSTM
     C           *IN99     IFEQ '1'
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE           ***************
     C                     MOVEL'ICDR1'   DBKEY            * DB ERROR 01 *
     C                     Z-ADD1         DBASE            ***************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     END
     C*
     C* ACCESS ICD2, UNLESS ERROR ON PREVIOUS TABLE
     C*
     C           *IN99     IFEQ '0'
     C                     EXSR ZICD2
     C           *IN99     IFEQ '1'
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE           ***************
     C                     MOVEL'ICDR2'   DBKEY            * DB ERROR 02 *
     C                     Z-ADD2         DBASE            ***************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     END
     C                     END
     C*
     C* ACCESS ICD FOR SE (TABTB36), UNLESS ERROR ON PREVIOUS TABLES
     C*
     C           *IN99     IFEQ '0'
     C                     EXSR ZICDSE
     C           *IN99     IFEQ '1'
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE           ***************
     C                     MOVEL'ICDSE'   DBKEY            * DB ERROR 03 *
     C                     Z-ADD3         DBASE            ***************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     END
     C                     END
     C*                                                                   E14616
     C**CALCULATE*ACCRUAL*CONTROL*DATE**************************** E14616 E15950
     C***********                                                  E14616 E15950
     C***********ACLD      IFEQ 'Y'                                E14616 E15950
     C***********          Z-ADDAPDA      ACDT    50               E14616 E15950
     C***********          ELSE                                    E14616 E15950
     C***********APDA      ADD  1         ACDT    50               E14616 E15950
     C***********          END                                     E14616 E15950
     C*
     C** ACCESS BOOK HEADER MONTHLY STATISTICS FILE AUDIT RECORD
     C*
     C           *IN99     IFNE '1'
     C                     READ BKMTHA                   99
     C           *IN99     IFNE '1'
     C***********          Z-ADDNORE      U02CNT  50                      E16833
     C                     Z-ADDNORE      U02CNT  50                      E21512
     C                     ELSE
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'BKMTH'   DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 09 *
     C                     Z-ADD9         DBASE            ***************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     END
     C                     END
     C*
     C* DETERMINE RUN DATE, UNLESS ERROR ALREADY
     C           *IN99     IFEQ '0'
     C*
     C* Get Data area SESTAT                                              E15950
     C*                                                                   E15950
     C           *NAMVAR   DEFN SESTAT    DTAARA                          E15950
     C                     IN   DTAARA                                    E15950
     C/COPY WNCPYSRC,SE0920C013
     C*                                                                   E15950
     C* Execute P/ZEVCD to obtain Event Control Date                      E15950
     C*                                                                   E15950
     C                     Z-ADDDNWD      ZZDNWD                          S01117
     C                     Z-ADDAPDA      ZZAPDT                          S01117
     C                     EXSR ZEVCD                                     E15950
     C*                                                                   E15950
     C* If Monthly run (Passed Parm = 'Y')
     C**Get*Data*area*SESTAT*and*set*report*data*=*This*EOM*date*******   E15950
     c*  ..then use Report Date = This EOM Date                           E15950
     C*                                                                   E15950
     C           RUNTYP    IFEQ 'Y'
     C*
     C************NAMVAR   DEFN SESTAT    DTAARA                          E20085
     C***********          IN   DTAARA                                    E20085
     C*
     C                     MOVELEOPT      RPTDT   50
     C*                                                                   E20085
      ***  If this is an EOM-run, then calculate the Date fields for      E20085
      ***  next month's BKMTH records.                                    E20085
      *                                                                   E20085
     C                     EXSR BKMDAT                                    E20085
     C*
     C**Else**use*P/ZEVCD*and*set*Report*date*=*Event*Control*Date*****   E15950
      ***  ELSE set Report date = Event Control Date                      E15950
      *                                                                   E20085
     C                     ELSE
     C***********          EXSR ZEVCD                                     E15950
     C                     Z-ADDECD       RPTDT
     C                     END
      *                                                                   E15950
     C           ACLD      IFEQ 'Y'                                       E20085
     C                     Z-ADDRPTDT     ACDT    50                      E20085
     C                     ELSE                                           E20085
     C           RPTDT     ADD  1         ACDT                            E20085
     C                     END                                            E20085
      *                                                                   E20085
      ***  Previous End of Month Date                                     E15950
     C*                                                                   E15950
     C                     MOVELEOPM      PMNDT   50                      E15950
     C                     END
      *                                                                   CSE006
      ** Check if CSE006 is on                                            CSE006
      *                                                                   CSE006
     C                     MOVE 'N'       CSE006  1                       CSE006
     C                     CALL 'AOSARDR0'                                CSE006
     C                     PARM *BLANKS   @RTCD   7                       CSE006
     C                     PARM '*VERIFY' @OPTN   7                       CSE006
     C                     PARM 'CSE006'  @SARD   6                       CSE006
      *                                                                   CSE006
     C           @RTCD     IFEQ *BLANK                                    CSE006
     C                     MOVE 'Y'       CSE006                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      ** Access SAR details file to see if CSE035 is installed                                CSE035
      *                                                                                       CSE035
     C                     CALL 'AOSARDR0'                                                    CSE035
     C                     PARM *BLANKS   @RTCD                                               CSE035
     C                     PARM '*VERIFY' @OPTN                                               CSE035
     C                     PARM 'CSE035'  @SARD                                               CSE035
      *                                                                                       CSE035
     C           @RTCD     IFEQ *BLANK                                                        CSE035
     C                     MOVE 'Y'       CSE035  1                                           CSE035
     C                     ELSE                                                               CSE035
     C                     MOVE 'N'       CSE035                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       207543
      ** Access SAR details file to see if CEU018 is installed                                207543
      *                                                                                       207543
     C                     CALL 'AOSARDR0'                                                    207543
     C                     PARM *BLANKS   @RTCD                                               207543
     C                     PARM '*VERIFY' @OPTN                                               207543
     C                     PARM 'CEU018'  @SARD                                               207543
      *                                                                                       207543
     C           @RTCD     IFEQ *BLANK                                                        207543
     C                     MOVE 'Y'       CEU018  1                                           207543
     C                     ELSE                                                               207543
     C                     MOVE 'N'       CEU018                                              207543
     C                     ENDIF                                                              207543
      *                                                                                       CSE035
     C/COPY WNCPYSRC,SE0920C002
      *                                                                                       CSE105
      ** Access SAR details file to see if feature CSE105 is installed.                       CSE105
      *                                                                                       CSE105
     C                     CALL 'AOSARDR0'                                                    CSE105
     C                     PARM '       ' @RTCD                                               CSE105
     C                     PARM '*VERIFY' @OPTN                                               CSE105
     C                     PARM 'CSE105'  @SARD                                               CSE105
     C           SCSARD    PARM SCSARD    DSFDY                                               CSE105
      *                                                                                       CSE105
     C           @RTCD     IFEQ *BLANKS                                                       CSE105
     C                     MOVE 'Y'       CSE105  1                                           CSE105
     C                     ELSE                                                               CSE105
     C                     MOVE 'N'       CSE105                                              CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
      ** Check system values if CSE105 is switched on                                         CSE105
      *                                                                                       CSE105
     C           CSE105    IFEQ 'Y'                                                           CSE105
      *                                                                                       CSE105
     C                     CALL 'AOSVALR0'                                                    CSE105
     C                     PARM *BLANKS   @RTCD                                               CSE105
     C                     PARM SVALKK    SVALK1 20                                           CSE105
     C                     PARM           SVAL1 200                                           CSE105
     C                     PARM *BLANK    SVALK2 20                                           CSE105
     C                     PARM           SVAL2 200                                           CSE105
     C                     PARM *BLANK    SVALK3 20                                           CSE105
     C                     PARM           SVAL3 200                                           CSE105
     C                     PARM *BLANK    SVALK4 20                                           CSE105
     C                     PARM           SVAL4 200                                           CSE105
     C                     PARM *BLANK    SVALK5 20                                           CSE105
     C                     PARM           SVAL5 200                                           CSE105
     C                     PARM *BLANK    SVALK6 20                                           CSE105
     C                     PARM           SVAL6 200                                           CSE105
     C                     PARM *BLANK    SVALK7 20                                           CSE105
     C                     PARM           SVAL7 200                                           CSE105
     C                     PARM *BLANK    SVALK8 20                                           CSE105
     C                     PARM           SVAL8 200                                           CSE105
     C                     PARM *BLANK    SVALK9 20                                           CSE105
     C                     PARM           SVAL9 200                                           CSE105
     C                     PARM *BLANK    SVALK0 20                                           CSE105
     C                     PARM           SVAL10200                                           CSE105
      *                                                                                       CSE105
     C           @RTCD     IFNE *BLANKS                                                       CSE105
     C           *LOCK     IN   LDA                                                           CSE105
     C                     MOVE 'SDSVALPD'DBFILE                                              CSE105
     C                     MOVELSVALK1    DBKEY                                               CSE105
     C                     Z-ADD15        DBASE                                               CSE105
     C                     OUT  LDA                                                           CSE105
     C                     EXSR *PSSR                                                         CSE105
     C                     SETON                     99U7U8                                   CSE105
     C                     ELSE                                                               CSE105
     C                     MOVELSVAL1     SESVAL  1                                           CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
     C           SESVAL    IFEQ *BLANKS                                                       CSE105
     C                     MOVE 'V'       SESVAL                                              CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
     C                     ENDIF                                                              CSE105
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SBKPOS - Subroutine to Process Book Position Record.         *
      *                                                               *
      *  Calls - SINT                                                 *
      *                                                               *
      *****************************************************************
      *
     C           SBKPOS    BEGSR                           *** SBKPOS ***
     C*
     C           MKPR      IFEQ 0
      *                                                                   E20125
      ***  There is no unrealized profit on a matured holding.            E20125
     C***********RECIH     OREQ 'M'                                E20125 091803
     C           RECIH     ANDNE'M'                                       091803
      *                                                                   E20125
     C*                                                                   091803
     C** If market price equals to zero, CHAIN to PRICED file if a        091803
     C** price exists.                                                    091803
     C*                                                                   091803
     C                     MOVE BHSC      PSSN                            091803
     C                     MOVE 'V '      PPRT                            091803
     C                     Z-ADDECD       PVDT                            091803
     C*                                                                   091803
     C           PKEY      SETGTPRICED                                    091803
     C                     READPPRICED                   21               091803
     C*                                                                   091803
     C           *IN21     IFEQ *OFF                                      091803
     C           PSSN      ANDEQBHSC                                      091803
     C           PPRT      ANDEQ'V '                                      091803
     C           PPRC      ANDEQ0                                         091803
     C                     ELSE                                           091803
     C                     MOVE *ON       *IN22                           091803
     C                     END                                            091803
     C*                                                                   091803
     C                     END                                            091803
     C*                                                                   091803
      ***  There is no unrealized profit on a matured holding.            091803
     C*                                                                   091803
     C           RECIH     IFEQ 'M'                                       091803
     C                     MOVE *ON       *IN22                           091803
     C                     END                                            091803
     C*                                                                   091803
     C** If market price exists but zero, do unrealised P/L processing    091803
     C*                                                                   091803
     C           *IN22     IFEQ *ON                                       091803
     C                     MOVE *OFF      *IN22                           091803
     C                     Z-ADD0         WUPN
     C                     ELSE
      *                                                                   E20125
      *****If*processing*a*Trade*Date*record,*adjust*Book*and*Market 0087 E20552
      *****Prices*for*discounted*holdings*(FIFO only).************ E20087 E20552
      ***********                                                  E20125 E20552
     C***********BHTV      IFEQ 'T'                                E20087 E20552
     C***********FIFO      ANDEQ'Y'                                E20087 E20552
     C***********STBS      ANDEQ'D'                                E20087 E20552
     C***********          EXSR ADJUPL                             E20087 E20552
     C***********          ELSE                                    E20087 E20552
      *
      ***  Convert Market Price to Percentage Price.
     C                     Z-ADDMKPR      ZPRCIN
      *                                                                   E20125
      ** Use of incorrect 'from date' in price conversion led to erron-   E20125
      ** eous unrealized P/L calculations for discounted instruments.     E20125
      ** For yield basis securities, date should be the report date       100630
     C***********          Z-ADDRUND      ZFDATE                          E20125
     C           STBS      IFEQ 'Y'                                       100630
     C           ACLD      ANDNE'Y'                                       100630
     C                     Z-ADDRPTDT     ZFDATE                          100630
     C                     ELSE                                           100630
     C                     Z-ADDACDT      ZFDATE                          E20125
     C                     ENDIF                                          100630
      *                                                                   S01232
      ***  Australian Yield Security Parameters                           S01232
      *                                                                   S01232
     C           *IN41     IFEQ '1'                                       S01232
     C           NPSN      ANDNE0                                         S01232
     C***********          Z-ADDLCPN      ZDCSDT                   S01232 E48259
     C***********          Z-ADDRUND      ZDCEDT                   S01232 E48259
     C***********          Z-ADDNPSN      ZAMT                     S01232 E48259
     C***********          Z-ADDCDP       ZCDP                     S01117 E48259
     C***********          EXSR ZACCZ                              S01232 E48259
     C***********ZDCINT    DIV  NPSN      WRKPI                    S01232 E48259
     C***********          Z-ADDRUND      WRKD    50               S01232 E48259
     C***********          MOVE *BLANKS   ZLOC                     S01195 E48259
     C***********          EXSR ZYCE                               S01232 E48259
      *                                                                   S01232
      *****If*Ex-Coupon,*then the Purchased Interest passed        S01232 E48259
      *****remaining*Interest to Next Coupon Date, and is ne       S01232 E48259
      *                                                                   S01232
     C***********SCUMEX    IFEQ 'X'                                S01232 E48259
     C***********          Z-ADDLCPN      ZDCSDT                   S01232 E48259
     C***********          Z-ADDNCD       ZDCEDT                   S01232 E48259
     C***********          Z-ADDCDP       ZCDP                     S01117 E48259
     C***********          EXSR ZACCZ                              S01232 E48259
     C***********ZDCINT    DIV  NPSN      WKWPI  159               S01232 E48259
     C***********WRKPI     SUB  WKWPI     WRKPI                    S01232 E48259
     C***********          END                                     S01232 E48259
     C*                                                                   E48259
     C* Set Nominal to positive for working on                            E48259
     C*                                                                   E48259
     C           NPSN      IFLT 0                                         E48259
     C                     Z-SUBNPSN      WNOML  130                      E48259
     C                     ELSE                                           E48259
     C                     Z-ADDNPSN      WNOML                           E48259
     C                     END                                            E48259
     C*                                                                   E48259
     C* Save Event Control Date.                                          E48259
     C*                                                                   E48259
     C                     Z-ADDECD       ECDPRV  50                      E48259
     C*                                                                   E48259
     C* Obtain next coupon date                                           E48259
     C* (Add 1 to ECD so that if ZFDATE=NCD,calculate NCD after that)     E48259
     C*                                                                   E48259
     C           ZFDATE    ADD  1         ECD                             E48259
     C                     EXSR ZNCD                                      E48259
     C*                                                                   E48259
     C* Obtain last coupon date                                           E48259
     C*                                                                   E48259
     C           NCD       SUB  1         ZECD                            E48259
     C                     EXSR ZLCD                                      E48259
     C                     Z-ADDZZLCD     LCOUP   50                      E48259
     C*                                                                   E48259
     C* Determine if period Cum or Ex                                     E48259
     C*                                                                   E48259
     C                     Z-ADDZFDATE    WRKD    50                      E48259
     C                     EXSR ZYCE                                      E48259
     C*                                                                   E48259
     C* Calculate interest for Cum period (SCUMEX = C)                    E48259
     C*                                                                   E48259
     C           SCUMEX    IFEQ 'C'                                       E48259
     C                     Z-ADDWNOML     ZAMT                            E48259
     C                     Z-ADDLCOUP     ZDCSDT                          E48259
     C                     Z-ADDZFDATE    ZDCEDT                          E48259
     C                     Z-ADDCDP       ZCDP                            E48259
     C                     EXSR ZACCZ                                     E48259
     C                     Z-ADDZDCINT    WRKPIX                          E48259
     C*                                                                   E48259
     C                     END                                            E48259
     C*                                                                   E48259
     C*   IF EX-COUPON THEN PI PASSED IS THE REMAINING INTEREST           E48259
     C*   TILL NCD AND IS NEGATIVE                                        E48259
     C*                                                                   E48259
     C           SCUMEX    IFEQ 'X'                                       E48259
     C                     Z-ADDLCOUP     ZDCSDT                          E48259
     C                     Z-ADDNCD       ZDCEDT                          E48259
     C                     Z-ADDWNOML     ZAMT                            E48259
     C                     Z-ADDCDP       ZCDP                            E48259
     C                     EXSR ZACCZ                                     E48259
     C                     Z-ADDZDCINT    NCDWRK 130                      E48259
     C*                                                                   E48259
     C* Calculate interest to Next Coupon Date                            E48259
     C*                                                                   E48259
     C                     Z-ADDLCOUP     ZDCSDT                          E48259
     C                     Z-ADDZFDATE    ZDCEDT                          E48259
     C                     EXSR ZACCZ                                     E48259
     C                     Z-ADDZDCINT    LCDWRK 130                      E48259
     C*                                                                   E48259
     C           LCDWRK    SUB  NCDWRK    WRKPIX 130                      E48259
     C*                                                                   E48259
     C                     END                                            E48259
     C*                                                                   E48259
     C* Make interest figure a percentage                                 E48259
     C*                                                                   E48259
     C           WRKPIX    DIV  WNOML     WRKPI                           E48259
     C*                                                                   E48259
     C* Return old Event Control Date                                     E48259
     C*                                                                   E48259
     C                     Z-ADDECDPRV    ECD                             E48259
     C                     ELSE                                           S01232
     C                     Z-ADD0         WRKPI                           S01232
     C                     MOVE 'C'       SCUMEX                          S01232
     C                     END                                            S01232
     C*                                                                   S01232
     C           PROT      IFEQ '8'                                       077581
     C***********NPSN      MULT CFCT      WNOMNL 154               077581 122266
     C           NPSN      MULT CFCT      WNOMNL 174                      122266
     C                     ELSE                                           077581
     C                     Z-ADDNPSN      WNOMNL                          077581
     C                     ENDIF                                          077581
      *                                                                   077581
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0920CCP3                                           S01408
     C*                                                                   S01408
     C                     EXSR ZPRCI
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0920CCP4                                           S01408
     C*                                                                   S01408
     C*                                                                   100630
     C** Bring back ZFDATE, regardless of basis                           100630
     C*                                                                   100630
     C                     Z-ADDACDT      ZFDATE                          100630
     C*
     C***********ZPRCOT    SUB  LAVP      WPDIF  158                      077581
     C*
     C***********          Z-ADD*ZEROS    WUPN   150                      077581
     C***********          Z-ADD*ZEROS    WUPN0  150                      077581
     C***********          Z-ADD*ZEROS    WUPN1  151                      077581
     C***********          Z-ADD*ZEROS    WUPN2  152                      077581
     C***********          Z-ADD*ZEROS    WUPN3  153                      077581
     C                     MOVEA'0000'    *IN,35
     C           35        ADD  CDP       J       20
     C                     MOVEA'1'       *IN,J
     C***********SPBS      IFEQ 'P'                                                    122266 190677
     C***********          DIV  100       WNOMNL                                       122266 190677
     C***********          END                                                         122266 190677
     C           SPBS      IFEQ 'P'                                            122266 190677 BUG7798
     C                     DIV  100       WNOMNL                               122266 190677 BUG7798
     C                     END                                                 122266 190677 BUG7798
      *                                                                   077581
      * extend nominal by latest price for market valuation               077581
     C   35      WNOMNL    MULT ZPRCOT    MKVL0  150                      077581
     C   36      WNOMNL    MULT ZPRCOT    MKVL1  151                      077581
     C   37      WNOMNL    MULT ZPRCOT    MKVL2  152                      077581
     C   38      WNOMNL    MULT ZPRCOT    MKVL3  153                      077581
     C   35                MOVE MKVL0     MKVL   150                      077581
     C   36                MOVE MKVL1     MKVL                            077581
     C   37                MOVE MKVL2     MKVL                            077581
     C   38                MOVE MKVL3     MKVL                            077581
      *                                                                   077581
      * extend nominal by average price for book cost                     077581
     C   35      WNOMNL    MULT LAVP      BOOK0  150                      077581
     C   36      WNOMNL    MULT LAVP      BOOK1  151                      077581
     C   37      WNOMNL    MULT LAVP      BOOK2  152                      077581
     C   38      WNOMNL    MULT LAVP      BOOK3  153                      077581
     C   35                MOVE BOOK0     BOOK   150                      077581
     C   36                MOVE BOOK1     BOOK                            077581
     C   37                MOVE BOOK2     BOOK                            077581
     C   38                MOVE BOOK3     BOOK                            077581
      *                                                                   077581
     C***35      WPDIF     MULT NPSN      WUPN0                           077581
     C***36      WPDIF     MULT NPSN      WUPN1                           077581
     C***37      WPDIF     MULT NPSN      WUPN2                           077581
     C***38      WPDIF     MULT NPSN      WUPN3                           077581
     C***********                                                         077581
     C***35                MOVE WUPN0     WUPN                            077581
     C***36                MOVE WUPN1     WUPN                            077581
     C***37                MOVE WUPN2     WUPN                            077581
     C***38                MOVE WUPN3     WUPN                            077581
     C*
      *                                                                   077581
      * UnrealisedP&L is market valuation less book cost                  077581
     C           MKVL      SUB  BOOK      WUPN   150                      077581
      *                                                                   077581
     C***********SPBS      IFEQ 'P'                                       122266
     C***********          DIV  100       WUPN      H                     122266
     C***********          END                                            122266
     C*
     C***********PROT      IFEQ '8'                                       077581
     C***********          MULT CFCT      WUPN                            077581
     C***********          END                                            077581
     C*
     C           5         SUB  NMDP      DC      10
     C                     MULT POWER8,DC WUPN
     C*
     C***********          END                                     E20087 E20552
     C                     END
     C*
     C** If Tr/VAL Basis = 'T'
     C           BHTV      IFEQ 'T'
     C                     ADD  WUPN      TUPN
     C*
     C** ELSE TR/VAL Basis NOT = 'T'
     C                     ELSE
     C                     ADD  WUPN      VUPN
     C*
     C** If Interest Bearing security (i.e. Processing type
     C***=*1,3,5,6,or*8*and*Day*Basis*NE*4)****************************   S01176
      ***  = 1, 3, 5, 6, 8 or 9 and Day Basis NE 4), then calculate       S01176
      ***  the Interest on the Position, else zero the Interest fields.   S01176
      *                                                                   S01176
     C           PROT      IFEQ '1'
     C           PROT      OREQ '3'
     C           PROT      OREQ '5'
     C           PROT      OREQ '6'
     C           PROT      OREQ '8'
     C           PROT      OREQ '9'                                       S01176
     C           DYBS      IFNE '4'
     C                     EXSR SINT
     C                     ADD  WPSN      TPSN
     C                     ADD  WPSN      VPSN
     C                     ADD  WECP      TECP
     C                     ADD  WECP      VECP
     C                     ELSE
     C                     Z-ADD0         TPSN
     C                     Z-ADD0         VPSN
     C                     Z-ADD0         TECP
     C                     Z-ADD0         VECP
     C                     END
     C                     ELSE
     C                     Z-ADD0         TPSN
     C                     Z-ADD0         VPSN
     C                     Z-ADD0         TECP
     C                     Z-ADD0         VECP
     C                     END
     C                     END
     C/COPY WNCPYSRC,SE0920C018
      *                                                                   E21587
      ***  If not Matured, save the Nominal Position for later use.       E21587
      *                                                                   E21587
     C           RECIH     IFNE 'M'                                       E21587
     C           BHTV      IFEQ 'T'                                       E21587
     C                     Z-ADDNPSN      NPSNT                           E21587
     C                     ELSE                                           E21587
     C                     Z-ADDNPSN      NPSNV                           E21587
     C                     END                                            E21587
     C                     END                                            E21587
     C*
     C* COUNT RECORD
     C                     ADD  1         ZBPCT   50
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      ************************************************************ E20087 E20552
      ***********                                                  E20087 E20552
      ****SUBROUTINE - ADJUPL                                      E20087 E20552
      ****Adjust unrealized P/L for discounted trade date positionsE20087 E20552
      ***********                                                  E20087 E20552
      ************************************************************ E20087 E20552
     C***********                                                  E20087 E20552
     C***********ADJUPL    BEGSR                                   E20087 E20552
     C***********                                                  E20087 E20552
     C**CLEAR*'CURRENT*FIFO*TRADE*FOUND'*INDICATOR*AND*ACCUMULATOR*FIELDS.E20552
     C***********          MOVE '0'       *IN85                    E20087 E20552
     C***********          Z-ADD0         TOTBC                    E20087 E20552
     C***********          Z-ADD0         TOTMV                    E20087 E20552
     C***********                                                  E20087 E20552
     C***********          MOVE BHTR      BHTRA   6                E20087 E20552
      ***********                                                  E20087 E20552
     C***********TRDMTK    CHAINTRDMTHF              86            E20087 E20552
     C***********                                                  E20087 E20552
     C***LOOP*FOR*ALL*TRADES*FOR*THIS*POSITION******************** E20087 E20552
     C************IN86     DOWEQ'0'                                E20087 E20552
     C***********                                                  E20087 E20552
     C***********RECI      IFNE '*'                                E20087 E20552
     C***********TINC      ANDEQ'C'                                E20087 E20552
     C***********                                                  E20087 E20552
     C***IF*CURRENT*FIFO*TRADE,*USE*REMAINING*UNLIQUIDATED*NOMINAL E20087 E20552
     C************IN85     IFEQ '0'                                E20087 E20552
     C***********TDRF      ANDEQBHTRA                              E20087 E20552
     C***********                                                  E20087 E20552
     C***********          MOVE '1'       *IN85                    E20087 E20552
     C***********          Z-ADDBHRN      NOML                     E20087 E20552
     C***********          MOVE TDTP      STDTP   2                E20087 E20552
     C***********                                                  E20087 E20552
     C***CONVERT*MARKET*DISCOUNT*RATE*TO*CURRENT*PERCENTAGE*PRICE* E20087 E20552
     C***********MKPR      IFNE 0                                  E20087 E20552
     C***********          Z-ADDMKPR      ZPRCIN                   E20087 E20552
     C***********          Z-ADDACDT      ZFDATE                   E20087 E20552
     C***********          EXSR ZPRCI                              E20087 E20552
     C***********          Z-ADDZPRCOT    MPACDT 158               E20087 E20552
     C***********          END                                     E20087 E20552
     C***********                                                  E20087 E20552
     C***********          END                                     E20087 E20552
     C***********                                                  E20087 E20552
     C***ONLY*PROCESS*CURRENT*FIFO*TRADE*AND*LATER*TRADES*OF*SAME*TYPE* 7 E20552
     C************IN85     IFEQ '1'                                E20087 E20552
     C***********TDTP      ANDEQSTDTP                              E20087 E20552
     C***********          EXSR ACCUM                              E20087 E20552
     C***********          END                                     E20087 E20552
     C***********                                                  E20087 E20552
     C***********          END                                     E20087 E20552
     C***********                                                  E20087 E20552
     C***********TRDMTK    READETRDMTHF                8686        E20087 E20552
     C***********                                                  E20087 E20552
     C***********          END                                     E20087 E20552
     C***********                                                  E20087 E20552
     C***Calculate*unrealized*P/L*using*accumulated*values.******* E20087 E20552
     C************IN85     IFEQ '1'                                E20087 E20552
     C***********TOTMV     SUB  TOTBC     WRKUPL 150               E20087 E20552
     C***Adjust*for*percentage*pricing.*************************** E20087 E20552
     C***********WRKUPL    DIV  100       WUPN                     E20087 E20552
     C***********          ELSE                                    E20087 E20552
     C***********          Z-ADD0         WUPN                     E20087 E20552
     C***********          END                                     E20087 E20552
     C***********                                                  E20087 E20552
     C***********          ENDSR                                   E20087 E20552
     C***********                                                  E20087 E20552
      ************************************************************ E20087 E20552
      /EJECT
      *************************************************************E20087 E20552
      ***********                                                  E20087 E20552
      ******SUBROUTINE - ACCUM                                     E20087 E20552
      ******SUBROUTINE TO ACCUMULATE ADJUSTED CONSIDERATION FROM TRADES 7 E20552
      ***********                                                  E20087 E20552
      *************************************************************E20087 E20552
      ***********                                                  E20087 E20552
     C***********ACCUM     BEGSR                                   E20087 E20552
     C***********                                                  E20087 E20552
     C***IF*TRADE*HAS*REACHED*VALUE,*CONVERT*DISCOUNT*TO*PRICE*AS*OF*ACDT E20552
     C***OTHERWISE,*USE*PERCENTAGE*PRICE*(PRIC)*FROM*TRADE*RECORD*AND 087 E20552
     C***********TDVD      IFLE ACDT                               E20087 E20552
     C***********          Z-ADDTPDY      ZPRCIN                   E20087 E20552
     C***********          Z-ADDACDT      ZFDATE                   E20087 E20552
     C***********          EXSR ZPRCI                              E20087 E20552
     C***********          Z-ADDZPRCOT    TPOUT  158               E20087 E20552
     C***********          ELSE                                    E20087 E20552
     C***********          Z-ADDPRIC      TPOUT                    E20087 E20552
     C***********          END                                     E20087 E20552
      ***********                                                  E20087 E20552
     C**CALCULATE*ADJUSTED*BOOK*COST****************************** E20087 E20552
     C***********                                                  E20087 E20552
     C***ADJUST*FOR*CURRENCY*DECIMAL*PLACES*********************** E20087 E20552
     C***********5         ADD  CDP       DC      10               E20087 E20552
     C***********NOML      MULT POWER8,DC WRK150 150               E20087 E20552
     C***********WRK150    MULT TPOUT     BKCT   150H              E20087 E20552
     C***********          ADD  BKCT      TOTBC  150               E20087 E20552
     C***********                                                  E20087 E20552
     C***MARKET*PRICE/VALUE*CALCULATIONS************************** E20087 E20552
     C***********MKPR      IFNE 0                                  E20087 E20552
     C***********                                                  E20087 E20552
     C***IF*TRADE*HASN'T*REACHED*VALUE,*CONVERT*MARKET*DISCOUNT*TO*PRICE  E20087
     C***AS*OF*TDVD;*ELSE*USE*PRICE*AS*OF*ACDT*CALCULATED*IN*SR/PROCTR. 7 E20087
     C***********TDVD      IFGT ACDT                               E20087 E20552
     C***********          Z-ADDMKPR      ZPRCIN                   E20087 E20552
     C***********          Z-ADDTDVD      ZFDATE                   E20087 E20552
     C***********          EXSR ZPRCI                              E20087 E20552
     C***********WRK150    MULT ZPRCOT    MKVL   150H              E20087 E20552
     C***********          ELSE                                    E20087 E20552
     C***********WRK150    MULT MPACDT    MKVL      H              E20087 E20552
     C***********          END                                     E20087 E20552
     C***********                                                  E20087 E20552
     C***ACCUMULATE*MARKET*VALUE********************************** E20087 E20552
     C***********          ADD  MKVL      TOTMV  150               E20087 E20552
      ***********                                                  E20087 E20552
     C***********          END                                     E20087 E20552
     C***********                                                  E20087 E20552
     C***********          ENDSR                                   E20087 E20552
      ***********                                                  E20087 E20552
      ************************************************************ E20087 E20552
      /EJECT
      *****************************************************************
      *
      *  THIS SUBROUTINE HAS BEEN REWRITTEN BELOW                         E20085
      *                                                                   E20085
     C**SUBROUTINE*TO*CALCULATE*INTEREST*ON*POSITION*******************   E20085
     C**CALLS*-*ZACCR,*ZNCD********************************************   E20085
     C*                                                                   E20085
     C*****************************************************************   E20085
     C***********SINT      BEGSR                           ** SINT  **    E20085
     C***********          ENDSR                                          E20085
      ***********                                                         E20085
      ********************************************************************E20085
      /EJECT                                                              E20085
      *****************************************************************   E20085
      *                                                               *   E20085
      *  SINT - Subroutine to calculate the Interest on the Position. *   E20085
      *                                                               *   E20085
      *  Calls - ZLCD   (Obtain Last Coupon Date)                     *   E20085
      *          ZNCD   (Obtain Next Coupon Date)                     *   E20085
      *          ZACCZ  (Calculate Accrued Interest between two Dates)*   E20085
      *                                                               *   E20085
      *****************************************************************   E20085
      *                                                                   E20085
     C           SINT      BEGSR                           ***  SINT  *** E20085
      *                                                                   E20085
     C           ITLD      IFGT RPTDT                                     E20085
      *                                                                   E21581
      ***  By definition, Accrued Interest on a Matured Security is 0.    E21581
     C           MATY      ORLE RPTDT                                     E21581
      *                                                                   E21581
     C                     Z-ADD0         WPSN   130                      E20085
     C                     Z-ADD0         WECP   130                      E20085
     C                     ELSE                                           E20085
      *                                                                   E20085
      ***  Determine the Last Coupon Date to use as the Start Date.       E20085
      *                                                                   E20085
     C                     Z-ADDECD       ZECD                            E20085
     C                     EXSR ZLCD                                      E20085
      *                                                                   E20085
      ***  Determine the Next Coupon Date.                                E20085
      *                                                                   E20085
     C                     EXSR ZNCD                                      E20085
      *                                                                   E20085
      ***  Calculate the Accrued Interest on the Total Nominal            E20085
      ***  Position up to the Report Date.                                E20085
      *                                                                   E20085
     C                     Z-ADDZZLCD     ZDCSDT                          E20085
      *                                                                   E20085
      ***  But make sure that the Accrue-To Date is not > Maturity Date   E20085
      *                                                                   E20085
     C           MATY      IFEQ 0                                         E20085
     C           ACDT      ORLE MATY                                      E20085
     C                     Z-ADDACDT      ZDCEDT                          E20085
     C                     ELSE                                           E20085
     C                     Z-ADDMATY      ZDCEDT                          E20085
     C                     END                                            E20085
      *                                                                   E20085
     C                     Z-ADDNPSN      ZAMT                            E20085
     C                     Z-ADDCDP       ZCDP                            S01117
     C                     EXSR ZACCZ                                     E20085
     C                     Z-ADDZDCINT    WPSN                            E20085
      *                                                                   E20085
      ***  Calculate the Accrued Interest on the Ex-Coupon Nominal        E20085
      ***  Position from the Report Date.                                 E20085
      *                                                                   E20085
     C           ECNP      IFEQ 0                                         E20085
     C           ECNP      ORGT 0                                         E36491
     C           BPPD      ANDLEZZLCD                                     E36491
     C                     Z-ADD*ZERO     WECP                            E20085
     C                     ELSE                                           E20085
     C                     Z-ADDZZLCD     ZDCSDT                          E20085
     C                     Z-ADDNCD       ZDCEDT                          E20085
      *                                                                   E20085
     C           ACLD      IFEQ 'Y'                                       E20085
     C                     ADD  1         ZDCEDT                          E20085
     C                     END                                            E20085
      *                                                                   E20085
     C                     Z-ADDECNP      ZAMT                            E20085
     C                     Z-ADDCDP       ZCDP                            S01117
     C                     EXSR ZACCZ                                     E20085
     C                     Z-ADDZDCINT    WECP                            E20085
     C                     END                                            E20085
      *                                                                   E20085
     C                     END                                            E20085
      *                                                                   E20085
     C                     ENDSR                                          E20085
      *                                                                   E20085
      *****************************************************************   E20085
      /EJECT
      *****************************************************************
      *                                                               *
      *  STRADE - Subroutine to process Trade Records.                *
      *                                                               *
      *****************************************************************
      *
     C           STRADE    BEGSR                           *** STRADE ***
     C/COPY WNCPYSRC,SE0920C019
      *
     C           TCNR      CHAINCLINTSEF             10
     C           *IN10     IFEQ '0'
     C           RECI      IFEQ '*'
     C                     SETON                     10
     C                     END
     C                     END
      *
     C           *IN10     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'CLINT'   DBFILE           ***************
     C                     MOVELTCNR      DBKEY            * DB ERROR 10 *
     C                     Z-ADD10        DBASE            ***************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     SETON                     99U7U8
     C                     GOTO EAUDIT
     C                     END
     C*
     C* CONVERT NOMINAL TO A CURRENCY AMOUNT
     C*
     C*   . if Discount
     C*
     C           STBS      IFEQ 'D'
     C           RALL      ANDNE0
     C                     Z-ADDTDVD      ZSDATE
     C                     Z-ADDMATY      ZEDATE
     C                     EXSR ZNCD
     C                     EXSR ZDAYS
     C                     EXSR ZDYYR
      *
     C           ZINTDD    IFNE 0
     C           RALL      MULT 0.01      WPRICE 158
     C           WPRICE    MULT ZDDAYS    WPRICE
     C           WPRICE    DIV  ZINTDD    WDRALL 158H
     C                     ELSE
     C                     Z-ADD*ZEROS    WDRALL
     C                     END
      *
     C                     ELSE
     C                     Z-ADDRALL      WDRALL
     C                     END
     C*
     C                     Z-ADD*ZEROS    WRAM   150
     C                     Z-ADD*ZEROS    WRAM0  150
     C                     Z-ADD*ZEROS    WRAM1  151
     C                     Z-ADD*ZEROS    WRAM2  152
     C                     Z-ADD*ZEROS    WRAM3  153
     C                     MOVEA'0000'    *IN,35
     C           35        ADD  CDP       J       20
     C                     MOVEA'1'       *IN,J
     C   35      NOML      MULT WDRALL    WRAM0
     C   36      NOML      MULT WDRALL    WRAM1
     C   37      NOML      MULT WDRALL    WRAM2
     C   38      NOML      MULT WDRALL    WRAM3
     C*
     C   35                MOVE WRAM0     WRAM
     C   36                MOVE WRAM1     WRAM
     C   37                MOVE WRAM2     WRAM
     C   38                MOVE WRAM3     WRAM
     C*
     C           PRBS      IFEQ 'P'
     C                     DIV  100       WRAM      H
     C                     END
     C*
     C           5         SUB  NMDP      DC      10
     C                     MULT POWER8,DC WRAM
     C/COPY WNCPYSRC,SE0920C003
     C*
     C           TBCA      ADD  TCCA      WTCA   150
     C/COPY WNCPYSRC,SE0920C004
     C*
     C***If*Market*or*internal*trade*make*fields*-ve************** E14013 E20652
     C***If*Market**or*Portfolio*customer*trade******************* E14013 E20652
     C***purchase,*reverse*sign*********************************** E14013 E20652
     C***********C1DI      IFEQ 'M'                                       E20652
     C***********C1DI      OREQ 'I'                                       E14013
     C***********TDTP      ANDEQ'TP'                               E14013 E20652
     C***********C1DI      OREQ 'D'                                E14013 E20652
     C***********TDTP      ANDEQ'TP'                               E14013 E20652
     C***********C1DI      OREQ 'S'                                E14013 E20652
     C***********TDTP      ANDEQ'TP'                               E14013 E20652
     C***If*Market*or*internal*trade*make*fields*-ve**************        E14013
      ***********                                                         E20652
      *****Ensure*Income*is*+ve*and*Expense*is*-ve*for*extract.********** E20652
      ***********                                                  E20652 E35608
     C***********TDTP      IFEQ 'TP'                               E20652 E35608
     C***********          Z-SUBWTCA      WCR    150                      E35608
     C***********                                                         E35608
     C***Else*make*fields*+ve************************************         E35608
     C***********          ELSE                                           E35608
     C***********          Z-ADDWTCA      WCR                             E35608
     C***********          END                                            E35608
     C*
     C** Calculate Charges receivable
     C/COPY WNCPYSRC,SE0920C005
     C                     Z-ADDTCA1      WTOTC  150
     C                     ADD  TCA2      WTOTC
     C                     ADD  TCA3      WTOTC
     C                     ADD  TCA4      WTOTC                           S01176
     C                     ADD  TCA5      WTOTC                           S01176
     C                     ADD  TCA6      WTOTC                           S01176
     C                     ADD  TCA7      WTOTC                           S01176
     C/COPY WNCPYSRC,SE0920C006
     C                     ADD  TAXA      WTOTC                           S01176
     C*                                                                   S01176
     C***********          ADD  TLTA      WTOTC                           S01176
     C***********          ADD  TOCA      WTOTC                           S01176
     C***********                                                         S01176
     C***********          ADD  LTCA      WTOTC                    S01169 S01176
     C***********          ADD  TPCA      WTOTC                    S01169 S01176
     C***********          ADD  TVCA      WTOTC                    S01169 S01176
     C***********                                                         E20652
     C***If*Market*or*internal*trade*make*fields*-ve************** E14013 E20652
     C***If*Market**or*Portfolio*customer*trade******************* E14013 E20652
     C***purchase,*reverse*sign*********************************** E14013 E20652
     C********** C1DI      IFEQ 'M'                                       E20652
     C********** C1DI      OREQ 'I'                                       E14013
     C********** TDTP      ANDEQ'TP'                               E14013 E20652
     C********** C1DI      OREQ 'D'                                E14013 E20652
     C********** TDTP      ANDEQ'TP'                               E14013 E20652
     C********** C1DI      OREQ 'S'                                E14013 E20652
     C********** TDTP      ANDEQ'TP'                               E14013 E20652
     C***If*Market*or*internal*trade*make*fields*-ve*******************   E14013
      *                                                                   E20652
      ***  Ensure Income is +ve and Expense is -ve for extract.           E20652
      *                                                                   E20652
     C           TDTP      IFEQ 'TP'                                      E20652
     C           REVERS    ANDEQ*OFF                                      077580
      *                                                                   077580
      * treat cancelled sales as if purchases                             077580
     C           REVERS    OREQ *ON                                       077580
     C           TDTP      ANDEQ'TS'                                      077580
     C                     Z-SUBWTOTC     WCHR   150
     C***********          Z-SUBWCR       WCR    150               E20652 E35608
     C                     Z-SUBWTCA      WCR    150                      E35608
     C                     Z-SUBWRAM      WRAM   150                      E20652
     C/COPY WNCPYSRC,SE0920C007
     C*
     C** Else make fields +ve
     C                     ELSE
     C                     Z-ADDWTOTC     WCHR   150
     C***********          Z-ADDWCR       WCR    150               E20652 E35608
     C                     Z-ADDWTCA      WCR    150                      E35608
     C                     Z-ADDWRAM      WRAM   150                      E20652
     C/COPY WNCPYSRC,SE0920C008
     C                     END
      *                                                                   E20085
      ***  ITRA includes an adjustment which should not be reflected      E20085
      ***  in later calculations in SE0925, so remove it here.            E20085
      ***  except for a matured schuldschein                              E37395
      *                                                                   E20085
     C           PROT      IFNE '6'                                       E37395
     C           RECIS     ORNE 'M'                                       E37395
     C                     SUB  TINA      ITRA                            E20085
     C                     END                                            E37395
      *                                                                   E20085
     C**If*EX-COUPON*reverse*sign*of*the*interest***************** E15950 E20652
     C***   Following 3 lines redundant due to SE0050(-ve interest for    E20652
     C***   Ex-coupon nominal is now output to Trades file )              E20652
     C***********ACIN      IFEQ 'X'                                E15950 E20652
     C***********          Z-SUBITRA      ITRA                     E15950 E20652
     C***********          END                                     E15950 E20652
     C*                                                                   E15950
     C* If Trade made complete this month, do trade date output           E15950
     C*                                                                   E15950
     C           TDMC      IFLE RPTDT                                     E15950
     C           TDMC      ANDGTPMNDT                                     E15950
     C           REVERS    OREQ *ON                                       077580
      *                                                                   E15950
      ***  Accumulate Reallowance Amount, Commission Receivable and       E20085
      ***  Charges Receivable on Trade Date Basis.                        E20085
      *                                                                   E20085
     C                     ADD  WRAM      TRAM                            E20085
     C                     ADD  WCR       TCMT                            E20085
     C                     ADD  WCHR      TCCT                            E20085
     C/COPY WNCPYSRC,SE0920C009
      *                                                                   E20085
     C                     ADD  1         ZTDCT   50                      E20085
      *                                                                   E21526
     C                     END                                            E21526
      *                                                                   E20085
      ***  If Trade has come to Value; If Trade was made complete this    E21526
      ***  month OR Trade was made complete in a prior month and comes    E21526
      ***  to Value this month, THEN add BOTH Trade and Value             E21526
      *****If*Trade*has*also*come*to*value,*add*BOTH*Trade*and*Value 0085 E21526
      ***  Interest and do other Value Date Output.                       E20085
      *                                                                   E20085
     C           TDVD      IFLE RPTDT                                     E20085
      *                                                                   E21526
     C           TDMC      IFGT PMNDT                                     E21526
     C           TINC      OREQ 'C'                                       E21526
     C           TDVD      ANDGTPMNDT                                     E21526
     C           REVERS    OREQ *ON                                       077580
      *                                                                   E20085
     C           TDTP      IFEQ 'TP'                                      E20085
     C                     ADD  ITRA      TPIM                            E20085
     C                     ADD  ITRA      VPIM                            E20085
     C                     ELSE                                           E20085
     C                     ADD  ITRA      TSIM                            E20085
     C                     ADD  ITRA      VSIM                            E20085
     C                     END                                            E20085
     C/COPY WNCPYSRC,SE0920C020
      *                                                                   E20085
      ***  Accumulate Reallowance Amount, Commission Receivable and       E20085
      ***  Charges Receivable on Value Date Basis.                        E20085
      *                                                                   E20085
     C                     ADD  WRAM      VRAM                            E20085
     C                     ADD  WCR       VCMT                            E20085
     C***********          ADD  WTOTC     VCCT                     E20085 E35608
     C                     ADD  WCHR      VCCT                            E35608
     C/COPY WNCPYSRC,SE0920C010
      *                                                                   E20085
     C                     ADD  1         ZVDCT   50                      E20085
      *                                                                   E20085
     C                     END                                            E20085
     C*
     C***********TDTP      IFEQ 'TP'                                      E20085
     C***********          ADD  ITRA      TPIM                            E20085
     C***********          ELSE                                           E20085
     C***********TDTP      IFEQ 'TS'                                      E20085
     C***********          ADD  ITRA      TSIM                            E20085
     C***********          END                                            E20085
     C***********          END                                            E20085
     C**ACCUM*REALLOWANCE*AMT;*COMM*RECEIVABLE;*CHG*RECEIVABLE*********   E20085
     C***********          ADD  WRAM      TRAM                            E20085
     C***********          ADD  WCR       TCMT                            E20085
     C***********          ADD  WCHR      TCCT                            E20085
     C***********                                                         E20085
     C***********          ADD  1         ZTDCT   50                      E20085
     C***********                                                         E20085
     C                     END                                            E15950
     C*
     C**If*Value*date*within*thi$*month,*do*value*dat"*output**********   E15950
     C**If*Value*date*within*this*month,*and*trade*made*complete*this 950 E20085
     C**month,*do*value*date*output******************************* E15950 E20085
     C***********                                                  E15950 E20085
     C***********TDVD      IFLE RPTDT                                     E20085
     C***********TDMC      ANDLERPTDT                              E15950 E20085
     C***********TDMC      ANDGTPMNDT                              E15950 E20085
     C***********TDTP      IFEQ 'TP'                                      E20085
     C***********          ADD  ITRA      VPIM                            E20085
     C***********          ELSE                                           E20085
     C***********TDTP      IFEQ 'TS'                                      E20085
     C***********          ADD  ITRA      VSIM                            E20085
     C***********          END                                            E20085
     C***********          END                                            E20085
     C**ACCUM*REALLOWANCE*AMT;*COMM*RECEIVABLE;*CHG*RECEIVABLE*********   E20085
     C***********          ADD  WRAM      VRAM                            E20085
     C***********          ADD  WCR       VCMT                            E20085
     C***********          ADD  WTOTC     VCCT                            E20085
     C***********                                                         E20085
     C***********          ADD  1         ZVDCT   50                      E20085
     C***********          END                                            E20085
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SCLREX - Subroutine to clear Extract record after written.   *
      *                                                               *
      *****************************************************************
      *
     C           SCLREX    BEGSR                           *** SCLREX ***
     C*
     C                     MOVE 'D'       RECI
     C***********          MOVE '   '     MPBR                            S01117
     C                     MOVE '   '     MPBA                            S01117
     C                     MOVE '  '      MPBK
     C                     MOVE '   '     MPNC
     C                     MOVE ' '       MPMK
     C                     MOVE '   '     MPIN
     C                     MOVEL*BLANKS   MPSS
     C                     Z-ADD0         TUPL
     C                     Z-ADD0         TTIP
     C                     Z-ADD0         TCDM
     C                     Z-ADD0         TTRP
     C                     Z-ADD0         TUPN
     C                     Z-ADD0         TPSN
     C                     Z-ADD0         TECP
     C                     Z-ADD0         TPIM
     C                     Z-ADD0         TSIM
     C                     Z-ADD0         TPST
     C                     Z-ADD0         TRAM
     C                     Z-ADD0         TCMT
     C                     Z-ADD0         TCCT
     C                     Z-ADD0         TCMD
     C                     Z-ADD0         TCCD
     C                     Z-ADD0         VUPL
     C                     Z-ADD0         VTIP
     C                     Z-ADD0         VCDM
     C                     Z-ADD0         VTRP
     C                     Z-ADD0         VUPN
     C                     Z-ADD0         VPSN
     C                     Z-ADD0         VECP
     C                     Z-ADD0         VPIM
     C                     Z-ADD0         VSIM
     C                     Z-ADD0         TPSV
     C                     Z-ADD0         VRAM
     C                     Z-ADD0         VCMT
     C                     Z-ADD0         VCCT
     C                     Z-ADD0         VCMD
     C                     Z-ADD0         VCCC
     C/COPY WNCPYSRC,SE0920C011
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  W02    - Subroutine to write new Monthly Statistics Record.  *
      *                                                               *
      *****************************************************************
      *
     C           W02       BEGSR                           ***  W02   ***
     C*
     C                     MOVE 'D'       BKID
     C                     MOVE BHSC      BKSS
     C***********          MOVE BHBR      BKBR                            S01117
     C                     MOVE BHBA      BKBA                            S01117
     C                     MOVE BHBK      BKBO
     C                     MOVE BHMK      BKMK
     C                     MOVE BHTV      BKTV
      *                                                                   E20085
      ***  The following calculations are now done by SR/BKMDAT in the    E20085
      ***  First Cycle (EOM only).                                        E20085
      *                                                                   E20085
     C************IN88     IFEQ '1'                                       E20085
     C***********          Z-ADDLPSD      ZDAYNO                          E20085
     C***********          EXSR ZDATE2                                    E20085
     C***********          MOVE ZMTH      WMM                             E20085
     C***********          MOVE ZYEAR     WYY                             E20085
     C***********          ELSE                                           E20085
     C***********          MOVELBKMY      WMM     20                      E20085
     C***********          MOVE BKMY      WYY     20                      E20085
     C***********          END                                            E20085
     C***********                                                         E20085
     C****ADD*1*MONTH*TO*LAST*PERIOD*(I.E.*LAST*MONTH)*FOR*NEXT*MONTH**   E20085
     C****RECORD*AND*ESTABLISH*LAST*DAY*OF*MONTH*FOR*MONTH*END*DATE****   E20085
     C***********                                                         E20085
     C***********WMM       IFEQ 12                                        E20085
     C***********          Z-ADD1         WMM                             E20085
     C***********WYY       ADD  1         WYY                             E20085
     C***********          ELSE                                           E20085
     C***********          ADD  1         WMM                             E20085
     C***********          END                                            E20085
     C***********          Z-ADD1         I       20                      E20085
     C***********WMM       LOKUPMM,I                     79               E20085
     C***79******          Z-ADDDD,I      WDD     20                      E20085
     C************IN98     IFEQ '0'                                       E20085
     C***********          Z-ADDWDATEE    ZDATE                           E20085
     C***********          ELSE                                           E20085
     C***********          MOVELWDD       W4      4                       E20085
     C***********          MOVE WYY       W4                              E20085
     C***********          MOVE W4        ZDATE                           E20085
     C***********          MOVELWMM       ZDATE                           E20085
     C***********          END                                            E20085
     C***********          EXSR ZDATE1                                    E20085
     C***********          Z-ADDZDAYNO    BKED                            E20085
     C***********          MOVELWMM       BKMY                            E20085
     C***********          MOVE WYY       BKMY                            E20085
      *
      ***  End of Month Date, Month/Year
     C                     Z-ADDBKEDNM    BKED                            E20085
     C                     MOVE BKMYNM    BKMY                            E20085
     C*
     C                     Z-ADD0         BPIT
     C                     Z-ADD0         CPDD
     C                     Z-ADD0         BCDM
     C                     Z-ADD0         BCCM
     C                     Z-ADD0         MMPL
     C                     Z-ADD0         RPTM
     C*                                                                   E20087
     C** Initialize 'Discount/Premium Posted this Month'                  E20087
     C                     Z-ADD0         DPTM                            E20087
     C/COPY WNCPYSRC,SE0920C021
     C*
     C                     WRITEBKMTHDF
     C*
     C                     ENDSR
      *
      *****************************************************************
     C/COPY WNCPYSRC,SE0920C022
      /EJECT                                                              E20085
      *****************************************************************   E20085
      *                                                               *   E20085
      *  BKMDAT - SR to determine EOM Dates for new BKMTH records.    *   E20085
      *                                                               *   E20085
      *  Called by: SR/FIRST, only if this is an EOM run.             *   E20085
      *                                                               *   E20085
      *****************************************************************   E20085
      *                                                                   E20085
     C           BKMDAT    BEGSR                           *** BKMDAT *** E20085
      *                                                                   E20085
     C                     Z-ADDRUND      ZDAYNO                          E20085
     C                     EXSR ZDATE2                                    E20085
     C                     MOVE ZMTH      WMM                             E20085
     C                     MOVE ZYEAR     WYY                             E20085
      *                                                                   E20085
      ***  Add 1 to current month and determine last day of next month.   E20085
      *                                                                   E20085
     C           WMM       IFEQ 12                                        E20085
     C                     Z-ADD1         WMM                             E20085
     C           WYY       ADD  1         WYY                             E20085
     C                     ELSE                                           E20085
     C                     ADD  1         WMM                             E20085
     C                     END                                            E20085
      *                                                                   E20085
     C                     Z-ADD1         I       20                      E20085
     C           WMM       LOKUPMM,I                     79               E20085
     C   79                Z-ADDDD,I      WDD     20                      E20085
      *                                                                   099459
      * If leap year (*IN91 = 1) and month is February (WMM=02)           099459
      * add 1 to day (WDD)                                                099459
      *                                                                   099459
     C           *IN91     IFEQ '1'                                       099459
     C           WMM       ANDEQ02                                        099459
     C                     ADD  1         WDD                             099459
     C                     END                                            099459
      *                                                                   E20085
     C           *IN98     IFEQ '0'                                       E20085
     C                     Z-ADDWDATEE    ZDATE                           E20085
     C                     ELSE                                           E20085
     C                     MOVELWDD       W4      4                       E20085
     C                     MOVE WYY       W4                              E20085
     C                     MOVE W4        ZDATE                           E20085
     C                     MOVELWMM       ZDATE                           E20085
     C                     END                                            E20085
      *                                                                   E20085
     C                     EXSR ZDATE1                                    E20085
      *                                                                   E20085
      ***  Save Date values for use in SR/W02.                            E20085
      *                                                                   E20085
     C                     Z-ADDZDAYNO    BKEDNM  50                      E20085
     C                     MOVELWMM       BKMYNM  4                       E20085
     C                     MOVE WYY       BKMYNM                          E20085
      *                                                                   E20085
     C                     ENDSR                                          E20085
      *                                                                   E20085
      *****************************************************************   E20085
      /EJECT
      *****************************************************************
      *                                                               *
      *  AUDIT  - Subroutine to Update Audit records and Output the   *
      *           Audit Control Report.                               *
      *                                                               *
      *****************************************************************
      *
     C           AUDIT     BEGSR                           *** AUDIT  ***
     C*
     C* ACCESS BKPHDA RECORD IF NO ERRORS
     C           *INU8     IFEQ '0'
     C                     READ BKPHDA                   10
     C           *IN10     IFEQ '1'
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE 'BKPHDA'  DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 11 *
     C                     Z-ADD11        DBASE            ***************
     C                     ELSE
     C*
     C* IF RECORD COUNT NOT EQUAL TO AUDIT COUNT
     C                     Z-ADDNORE      ZRIN
     C           ZRIN      IFNE ZINS
     C                     SETON                     U857
     C                     END
     C                     END
     C                     END
     C*
     C* OUTPUT CONTROL RECORD TO MPREXA
     C*
     C           *INU8     IFEQ '0'
     C                     Z-ADDZROUT     NORE
     C                     WRITEMPREXAF
     C                     END
     C*
     C* UPDATE CONTROL RECORD TO BKMTHA
     C*
     C           *INU8     IFEQ '0'
     C***********          ADD  U02CNT    NORE                            E19866
     C***********          ADD  U02CNT    NOREBK                   E19866 E21512
     C                     Z-ADDU02CNT    NORE                            E21512
     C                     UPDATBKMTHAF
     C                     END
     C*
     C* OUTPUT CONTROL REPORT
     C*
     C                     WRITEHEADAU
     C           *INU7     IFEQ '0'
     C           *INU8     OREQ '0'
     C                     WRITECONTROL
     C                     ELSE
     C                     WRITEERROR
     C                     END
     C***********                                                         E29170
     C***********          WRITETRAILAU                                   E29170
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  IDDSR  - Subroutine for Error Handling of MPREXD.            *
      *                                                               *
      *****************************************************************
      *
     C           IDDSR     BEGSR
     C*
     C                     MOVE 'MPREXD'  DBFILE
     C                     MOVELMPRKEY    DBKEY
     C                     Z-ADD12        DBASE
     C                     MOVE STSIDD    DBSTAT
     C                     MOVE '1'       *IN87
     C                     SETON                     99U7U8
     C                     GOTO EAUDIT
     C*
     C                     ENDSR
      *
      *****************************************************************
     C/COPY WNCPYSRC,SE0920C012
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  BKMSR  - Subroutine for Error Handling of BKMTHD.            *
      *                                                               *
      *****************************************************************
      *
     C           BKMSR     BEGSR
     C*
     C                     MOVEL'BKMTH '  DBFILE
     C                     MOVELBKMKEY    DBKEY
     C                     Z-ADD13        DBASE
     C                     MOVE STSBKM    DBSTAT
     C                     MOVE '1'       *IN87
     C                     SETON                     99U7U8
     C                     GOTO EAUDIT
     C*
     C                     ENDSR
      *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  IDASR  - Subroutine for Error Handling of MPREXA.            *
      *                                                               *
      *****************************************************************
      *
     C           IDASR     BEGSR
     C*
     C                     MOVE 'MPREXA'  DBFILE
     C                     MOVEL'AUDIT'   DBKEY
     C                     Z-ADD14        DBASE
     C                     MOVE STSIDA    DBSTAT
     C                     MOVE '1'       *IN87
     C                     SETON                     99U7U8
     C                     GOTO EAUDIT
     C*
     C                     ENDSR
      *
      *****************************************************************
      /SPACE 3                                                            S01169
      *****************************************************************   S01169
      *                                                               *   S01169
      *  AAASR  - Subroutine for Error Handling of BKPHD.             *   S01169
      *                                                               *   S01169
      *****************************************************************   S01169
      *                                                                   S01169
     C           AAASR     BEGSR                           *** AAASR ***  S01169
      *                                                                   S01169
     C                     MOVE AAADS     EPFDS                           S01169
     C                     MOVE 'F'       EPFLAG  1                       S01169
     C                     EXSR *PSSR                                     S01169
      *                                                                   S01169
     C                     ENDSR                                          S01169
      *                                                                   S01169
      *****************************************************************   S01169
      /SPACE 3                                                            S01169
      *****************************************************************   S01169
      *                                                               *   S01169
      *  BBBSR  - Subroutine for Error Handling of Audit Print File.  *   S01169
      *                                                               *   S01169
      *****************************************************************   S01169
      *                                                                   S01169
     C           BBBSR     BEGSR                           *** BBBSR ***  S01169
      *                                                                   S01169
     C                     MOVE BBBDS     EPFDS                           S01169
     C                     MOVE 'F'       EPFLAG                          S01169
     C                     EXSR *PSSR                                     S01169
      *                                                                   S01169
     C                     ENDSR                                          S01169
      *                                                                   S01169
      *****************************************************************   S01169
      /SPACE 3                                                            S01169
      *****************************************************************   S01169
      *                                                                   S01169
      *  *PSSR  - Program Exception/Error.                            *   S01169
      *                                                               *   S01169
      *****************************************************************   S01169
      *                                                                   S01169
     C           *PSSR     BEGSR                           *** *PSSR ***  S01169
      *                                                                   S01169
     C           EPSW      IFNE '1'                                       S01169
     C                     MOVE '1'       EPSW    1                       S01169
     C*                                                                   S01169
     C***********EPFLAG    IFNE 'F'                                S01169 S01117
     C***********                                                  S01169 S01117
     C***********          CALL 'SDC2505'                          S01169 S01117
     C***********          PARM           EPPDS1                   S01169 S01117
     C***********          PARM           EPPDS2                   S01169 S01117
     C***********                                                  S01169 S01117
     C***********          ELSE                                    S01169 S01117
     C***********                                                  S01169 S01117
     C***********          CALL 'SDC2500'                          S01169 S01117
     C***********          PARM           EPFDS1                   S01169 S01117
     C***********          PARM           EPFDS2                   S01169 S01117
     C***********          PARM           EPPP                     S01169 S01117
     C***********          PARM           EPPPL                    S01169 S01117
     C***********                                                  S01169 S01117
     C***********          END                                     S01169 S01117
     C***********                                                  S01169 S01117
     C                     DUMP                                           S01169
     C                     END                                            S01169
     C*                                                                   S01169
     C***********          SETON                     LR            S01169 S01117
     C***********          RETRN                                   S01169 S01117
     C*                                                                   S01169
     C                     ENDSR                                          S01169
      *                                                                   S01169
      *****************************************************************   S01169
      */EJECT***************                                       S01232 S01195
     C*/COPY*ZSRSRC,XDATE3Z1**********                             S01232 S01195
      /EJECT                                                              S01195
     C/COPY ZSRSRC,ZACCH                                                  S01195
      /EJECT
     C/COPY ZSRSRC,ZACCRZ1
      /EJECT                                                              E14616
     C/COPY ZSRSRC,ZACCZZ1                                                E14616
      /EJECT                                                              S01195
     C/COPY ZSRSRC,ZBKDT                                                  S01195
      /EJECT
     C/COPY ZSRSRC,ZDATE1Z2
      /EJECT
     C/COPY ZSRSRC,ZDATE2Z4
      /EJECT
     C/COPY ZSRSRC,ZDAYSZ2
      /EJECT
     C/COPY ZSRSRC,ZDYYRZ3
      /EJECT
     C/COPY ZSRSRC,ZEVCDZ1
      /EJECT
     C/COPY ZSRSRC,ZICD2Z1
      /EJECT
     C/COPY ZSRSRC,ZICDSEZ1
      /EJECT                                                              E20380
     C/COPY ZSRSRC,ZLCDZ1                                                 E20380
      /EJECT
     C/COPY ZSRSRC,ZNCDZ3
      /EJECT
     C/COPY ZSRSRC,ZPRCIZ1
      /EJECT
     C/COPY ZSRSRC,ZRATEZ1
      /EJECT
     C/COPY ZSRSRC,ZSYSTMZ1
      /EJECT                                                              S01232
     C/COPY ZSRSRC,ZYCEZ1                                                 S01232
      /EJECT
     C/COPY ZSRSRC,ZYLDIZ1
      /EJECT
     C/COPY ZSRSRC,ZYLDZ2
      /EJECT
     C/COPY ZSRSRC,ZCALCD                                                 E39495
     C/EJECT                                                              E39495
     C/COPY ZSRSRC,ZCNSDZ1                                                E39495
     C/EJECT                                                              E39495
      ***
**  CPY@
(c) Finastra International Limited 2001
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
0006001521029820444305904073650882610287117481320914670161311759219053
2051421975234362489726358278192928030741322023366335124365853804639507
40968424294389045351
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  MM/DD ALTERNATING TABLE OF MONTHS AND DAYS IN EACH MONTH
013102280331043005310630073108310930103111301231
**  POWER8 - ARRAY OF POWERS FOR CURRENCY CONVERSION
00000001
00000010
00000100
00001000
00010000
00100000
01000000
10000000
