     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Customer Valuation Stmnt Prompt')
     F*****************************************************************
     F*                                                               *
     F*  Midas - Securities Trading Module
     F*                                                               *
     F*  SE0932 - ON-REQUEST CUSTOMER VALUATION STATEMENT PROMPT      *
     F*                                                               *
     F*  Function: To prompt for Customer/Branch combinations for     *
     F*   (I/C)    which a Customer Valuation Statement is required.  *
     F*                                                               *
     F*  Called by: SEC0305 - Customer Valuation Statements Prompt    *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Last Amend No. CSD031             Date 10Apr06               *
      *  Prev Amend No. CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3122            Date 17Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 052254             Date 10Jan94               *
      *                 S01117             Date 06Aug91               *
     F*                 S01269             DATE 31JUL90               *
     F*                 E20448             DATE 07DEC89               *
     F*                 S01199             DATE 02AUG89               *
     F*                 E16600             DATE 27JUL89               *
     F*                 E16778             DATE 31JAN89               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3122 - Recompiled due to changes in SDSECSPD.             *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
     F*  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
     F*           to 10,9                                             *
     F*  S01117 - Multibranching                                      *
     F*           Screen function                                     *
     F*           Access object programs used to replace table files  *
     F*  S01269 - TRADE AUTHORISATION: RECOMPILED FOR CHANGE TO       *
     F*           FILE TABSE                                          *
     F*  E20448 - Prompt Screen missing WSID + Add DONMSG.            *
     F*  S01199 -  Help system.                                    *
     F*  E16600 - Recompiled to pick up changed Display file SE0932DF *
     F*  E16778 - Customer Valuation Statement should only be         *
     F*           produced for Safe and Discretionary Clients.        *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
      *
     FSE0932DFCF  E                    WORKSTN
     F*CVALS***IF**E           K        DISK                              S01117
     F*********** CVALSDF                           KRENAMECVALSLF        S01117
     F***CLINT***IF  E           K        DISK                            S01117
     F*********** CLINTCAF                          KIGNORE               S01117
     F*********** CLINTCBF                          KIGNORE               S01117
     F*********** CLINTCCF                          KIGNORE               S01117
     F*********** CLINTC1F                          KIGNORE               S01117
     F***TABSE***IF  E           K        DISK                            S01117
     F*********** TABLETAF                          KIGNORE               S01117
     F**ICD****** TABTB10F                          KIGNORE               S01117
     F**ICD*2**** TABTB11F                          KIGNORE               S01117
     F**ICD*SE*** TABTB36F                          KIGNORE               S01117
     F*********** TABTE10F                          KIGNORE               S01117
     F*********** TABTE20F                          KIGNORE               S01117
     F*********** TABTG10F                          KIGNORE               S01117
     F*********** TABTG20F                          KIGNORE               S01117
     F*********** TABLETHF                          KIGNORE               S01117
     F*********** TABLETJF                          KIGNORE               S01117
     F*********** TABLETKF                          KIGNORE               S01117
     F*********** TABLETLF                          KIGNORE               S01117
     F*********** TABLETNF                          KIGNORE               S01117
     F*********** TABLETPF                          KIGNORE               S01117
     F**BRC****** TABLETRF                          KIGNORE               S01117
     F*********** TABLETXF                          KIGNORE               S01117
     F*********** TABLET2F                          KIGNORE               S01117
     F*********** TABLET3F                          KIGNORE               S01117
     F*********** TABLET5F                          KIGNORE               S01117
     F*********** TABTB40F                          KIGNORE               S01117
     F***SNAME***IF  E           K        DISK                            S01117
     FCVALSD  O   E                    DISK                      A
     FCVALSA  UF  E                    DISK                      A
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*   01  - F3                                                    *
     F****06**-*HELP*requested*****************************************   S01199
     F*   12  - F12 pressed                                           *   S01117
     F*   33  - General work indicator                                *
     F****51**-*Branch*code*error**************************************   S01117
     F*   52  - Customer number error                                 *
     F*   53  - Branch/Customer already entered                       *
     F*   54  - Customer is not Safe or Discretionary                 *   E16778
     F*   55  - Display Statement requested message                   *   E20448
     F****70**-*Display*Branch*field*for*entry*************************   S01117
     F*   70  - Multibranching on (show F12 key)                      *   S01117
     F*                                                               *
     F**90-99*-*Used*in*Standard*Subroutines.**************************   S01117
     F*                                                               *
     F*   U7  - Database Error.                                       *
     F*   U8  - Database / Control Error                              *
     F*                                                               *
     F*****************************************************************
      /SPACE 3
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*  *PSSR  - DUMP program on error                               *   S01117
     F*  CHKSEL - Check for "?" selection (screen 1)                  *   S01117
     F*                                                               *
     F***ZICDSE*-*Access*ICD*record*for*Securities*Trading*************   S01117
     F***ZICD2**-*ACCESS*ICD2*RECORD***********************************   S01117
     F***ZSYSTM*-*ACCESS*ICD1*RECORD***********************************   S01117
     F*                                                               *
     F*****************************************************************
      /EJECT
     E                    CPY@    1   1 80
     E***********         ERR     1   3 76                                E16778
     E***********         ERR     1   4 76                         E16778 E20448
     E                    ERR     1   5 76                                E20448
      *                                                                   S01117
      ** Define array for branch codes                                    S01117
      *                                                                   S01117
     E                    BRC       100  3                                S01117
     I*                                                                   S01117
     I***LDA*****   UDS                            256                    S01117
     I***********                           134 177 DBLOT                 S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 177 DBASE                 S01117
      *                                                                   S01117
     ILDA         DS                            256                       S01117
      *                                                                   S01117
      ** *LOCK IN LDA immediately before and OUT LDA immediately          S01117
      ** after each database error handling.                              S01117
      *                                                                   S01117
     I                                      134 183 DBLOT                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     IPSDS       SDS                                                      E20448
     I*                                                                   E20448
     I** PROGRAM STATUS DATA STRUCTURE FOR WS/USER ID'S                   E20448
     I*                                                                   E20448
     I                                      244 246 WSID                  E20448
     ICPYR@#      DS
      *
      ** DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
      *
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
      *
     IRUNDT       DS                                                      S01117
      *                                                                   S01117
      ** RUNDAT data area                                                 S01117
      *                                                                   S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
      *                                                                   S01117
     ISDBANK    E DSSDBANKPD                                              S01117
      *                                                                   S01117
      ** Bank Details                                                     S01117
      *                                                                   S01117
     ISDBRCH    E DSSDBRCHPD                                              S01117
      *                                                                   S01117
      ** Branch Details                                                   S01117
      *                                                                   S01117
     ISDCUST    E DSSDCUSTPD                                              S01117
     I              QQDFAC                          #DFAC1                                    CGL029
      *                                                                   S01117
      ** Customer Details                                                 S01117
      *                                                                   S01117
     ISDSECS    E DSSDSECSPD                                              S01117
      *                                                                   S01117
      ** Securities Customers                                             S01117
      *                                                                   S01117
     ISDSTRD    E DSSDSTRDPD                                              S01117
      *                                                                   S01117
      ** Securities Trading Data                                          S01117
      *                                                                   S01117
     IDSFDY     E DSDSFDY                                                 S01117
      *                                                                   S01117
      ** Short data structure for access programs (200 long)              S01117
      *                                                                   S01117
     IDSSDY     E DSDSSDY                                                 S01117
      *                                                                   S01117
      ** Long data structure for access programs (800 long)               S01117
      *                                                                   S01117
     C/EJECT
      *================================================================
      *  P R O G R A M   S T A R T                                    *
      *================================================================
      *                                                                   S01117
      ** RCF parameter list                                               S01117
      *                                                                   S01117
     C           *ENTRY    PLIST                                          S01117
     C                     PARM           RSEQ    5                       S01117
     C                     PARM           RLEV    1                       S01117
     C                     PARM           BRANCH  3                       S01117
     C                     PARM           RPARM 100                       S01117
     C                     PARM           RACT    1                       S01117
     C                     PARM           RCMD    1                       S01117
     C*
     C* Prepare LDA
     C*
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL*BLANK    DBLOT
     C                     MOVEL'SE0932'  DBPGM
     C                     OUT  LDA                                       S01117
     C***********                                                         S01117
     C**Get*installation Control data record 1                            S01117
     C***********                                                         S01117
     C***********          EXSR ZSYSTM                                    S01117
     C***********                                                         S01117
     C**Error*in*ZSYSTM                                                   S01117
     C***********                                                         S01117
     C************IN99     IFEQ '1'                        ***************S01117
     C***********          MOVEL'01'      DBASE            **DB ERROR 01**S01117
     C***********          MOVEL'TABLE'   DBFILE           ***************S01117
     C***********          MOVELZTABKY    DBKEY                           S01117
     C***********          SETON                     U7U8LR               S01117
     C***********          RETRN                                          S01117
     C***********          END                                            S01117
     C***********                                                         S01117
     C**Get*Installation Control Data record 2                            S01117
     C***********                                                         S01117
     C***********          EXSR ZICD2                                     S01117
     C***********                                                         S01117
     C**Error*in*ZICD2                                                    S01117
     C***********                                                         S01117
     C************IN99     IFEQ '1'                        ***************S01117
     C***********          MOVEL'02'      DBASE            **DB ERROR 02**S01117
     C***********          MOVEL'TABLE'   DBFILE           ***************S01117
     C***********          MOVELZTABKY    DBKEY                           S01117
     C***********          SETON                     U7U8LR               S01117
     C***********          RETRN                                          S01117
     C***********          END                                            S01117
     C***********                                                         S01117
     C**Get*Installation Control data record for security                 S01117
     C***********                                                         S01117
     C***********          EXSR ZICDSE                                    S01117
     C***********                                                         S01117
     C**Error*in*ZICDSE                                                   S01117
     C***********                                                         S01117
     C************IN99     IFEQ '1'                        ***************S01117
     C***********          MOVEL'03'      DBASE            **DB ERROR 03**S01117
     C***********          MOVEL'TABLE'   DBFILE           ***************S01117
     C***********          MOVELZTABKY    DBKEY                           S01117
     C***********          SETON                     U7U8LR               S01117
     C***********          RETRN                                          S01117
     C***********          END                                            S01117
      *                                                                   S01117
      ** Read in RUNDAT data area                                         S01117
      *                                                                   S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C                     IN   RUNDT                                     S01117
      *                                                                   S01117
      ** Access bank details                                              S01117
      *                                                                   S01117
     C                     CALL 'AOBANKR0'                                S01117
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C           SDBANK    PARM SDBANK    DSFDY                           S01117
     C*                                                                   S01117
     C* Check if Multi-Branch entry                                       S01117
     C*
     C           MBIN      IFEQ 'Y'
     C                     SETON                     70
     C                     ELSE
     C***********          MOVE DSTB      BRANCH                          S01117
     C                     MOVE BJSBRC    BRANCH                          S01117
     C                     END
      *                                                                   S01117
      ** Access Securities Trading details                                S01117
      *                                                                   S01117
     C                     CALL 'AOSTRDR0'                                S01117
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C           SDSTRD    PARM SDSTRD    DSSDY                           S01117
     C*
     C**Key*for*duplicate*record*check*****************************       S01117
     C***********                                                         S01117
     C***********CVALKA    KLIST                                          S01117
     C***********          KFLD           WORK3N                          S01117
     C***********          KFLD           WORK6N                          S01117
     C*
     C* Display screen until F3 taken
     C* or F12 taken                                                      S01117
     C*
     C           *IN01     DOUEQ'1'
     C           *IN12     OREQ '1'                                       S01117
     C*
     C**N51N52N53**        DO                                             E16778
     C**N51N52N53**                                                 E16778S01117
     C**ANN54******          DO                                     E16778S01117
     C***70******          MOVE *BLANKS   BRANCH                          S01117
      *                                                                   S01117
      ** Blank out screen customer field if it is not in error and has    S01117
      ** not been selected from the ? prompt                              S01117
      *                                                                   S01117
     C           *IN52     IFEQ '0'                                       S01117
     C           *IN53     ANDEQ'0'                                       S01117
     C           *IN54     ANDEQ'0'                                       S01117
     C           @SEL      ANDEQ0                                         S01117
     C                     MOVE *BLANKS   CUSTMR
     C                     END
     C*
     C                     EXFMTSE0932D1
     C*
     C* RESET error indicators                                            E20448
     C*                                                                   E20448
     C***********          MOVEA'00000'   *IN,51                    E20448S01117
     C                     MOVEA'0000'    *IN,52                          S01117
     C                     MOVE *BLANKS   ERRMSG                          S01117
     C*                                                                   E20448
     C**HELP*key*pressed***********************************************   S01199
     C***********                                                         S01199
     C************IN06     DOWEQ'1'                                       S01199
     C***********          CALL 'MHELP'                                   S01199
     C***********          PARM           DBPGM                           S01199
     C***********          PARM *BLANKS   ERRMSG                          S01199
     C***********                                                         S01199
     C***********          READ SE0932D1                 33               S01199
     C***********          END                                            S01199
     C*
     C           *IN01     IFEQ '0'
      *
      ** Check for ? prompt in customer field and skip validation to
      ** redisplay screen if prompted
      *
     C                     EXSR CHKSEL                                    S01117
     C           @SEL      IFEQ 0                                         S01117
     C***********          SETOF                     515253               S01117
     C***********          MOVE *BLANKS   ERRMSG                          S01117
     C*
     C**If*multi-branch*mode,*check*branch*valid*                         S01117
     C***********                                                         S01117
     C************IN70     IFEQ '1'                                       S01117
     C***********                                                         S01117
     C**If*blank,*use*default*                                            S01117
     C***********                                                         S01117
     C***********BRANCH    IFEQ *BLANKS                                   S01117
     C***********          MOVE DSTB      BRANCH                          S01117
     C***********          END                                            S01117
     C***********                                                         S01117
     C***********          MOVE *BLANKS   KEY12A 12                       S01117
     C***********          MOVEL'10'      KEY12A                          S01117
     C***********          MOVE BRANCH    KEY12A                          S01117
     C***********KEY12A    CHAINTABLETRF             51                   S01117
     C**N51******RECI      COMP '*'                      51               S01117
     C************IN51     IFEQ '1'                                       S01117
     C***********          MOVEAERR,1     ERRMSG                          S01117
     C***********          END                                            S01117
     C***********          END                                            S01117
      *
      ** Check customer entered is valid
      *
     C***********CUSTMR    CHAINCLINTCBF             33                   S01117
     C************IN33     IFEQ '1'                                       S01117
      *                                                                   S01117
      ** Access Customer Details file                                     S01117
      *                                                                   S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM CUSTMR    @KEY1  10                       S01117
     C                     PARM           @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
      *                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C**********           MOVELCUSTMR    WORK6N  60                                          CSD027
     C                     MOVELCUSTMR    WORK6N  6                                           CSD027
     C                     MOVELCUSTMR    WORK6A  6
     C                     ELSE
     C***********          Z-ADDCNUM      WORK6N                          S01117
     C                     MOVELBBCUST    WORK6N                          S01117
     C                     MOVELBBCUST    WORK6A                          S01117
     C                     END
     C*
     C***********WORK6N    CHAINCLINTSEF             52                   S01117
     C**N52******RECI      COMP '*'                      52               S01117
     C************IN52     IFEQ '1'                                       S01117
      *                                                                   S01117
      ** Access securities clients details                                S01117
      *                                                                   S01117
     C                     CALL 'AOSECSR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM WORK6A    @AENB   6                       S01117
     C           SDSECS    PARM SDSECS    DSSDY                           S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C**N51******          MOVEAERR,2     ERRMSG                          S01117
     C                     MOVEAERR,2     ERRMSG                          S01117
     C                     MOVE '1'       *IN52                           S01117
     C                     END
     C*
     C* Check Customer is either 'Safe' or 'Discretionary'                E16778
     C*                                                                   E16778
     C**N51N52***C1DI      COMP 'S'                  5454           E16778E20448
     C***********C1DI      COMP 'S'                  5454           E20448S01117
     C           BFCLAS    COMP 'S'                  5454                 S01117
     C           *IN54     IFEQ '1'                                       E16778
     C***********C1DI      COMP 'D'                  5454           E16778S01117
     C           BFCLAS    COMP 'D'                  5454                 S01117
     C           *IN54     IFEQ '1'                                       E16778
     C***********          MOVEAERR,4     ERRMSG                    E16778E20448
     C**N51N52***          MOVEAERR,4     ERRMSG                    E20448S01117
     C  N52                MOVEAERR,4     ERRMSG                          S01117
     C                     END                                            E16778
     C                     END                                            E16778
      *                                                                   S01117
      ** If branch is 'ALL' and branch array is empty then load it up     S01117
      *                                                                   S01117
     C           BRANCH    IFEQ 'ALL'                                     S01117
     C           @RDBR     IFEQ 0                                         S01117
     C                     EXSR READBR                                    S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*
     C**Check*Branch/Customer*not*already*entered*************************S01117
     C***********                                                         S01117
     C***********          MOVE BRANCH    WORK3N  30                      S01117
     C***********CVALKA    SETLLCVALSLF                  53               S01117
     C************IN53     IFEQ '1'                                       S01117
     C**N51N52***          MOVEAERR,3     ERRMSG                          S01117
     C***********          END                                            S01117
     C*
     C* Write to file if no errors
     C*
     C**N51N52N53**        DO                                             E16778
     C**N51N52N53**                                                 E16778S01117
     C**ANN54******          DO                                           E16778
     C           *IN52     IFEQ '0'                                       S01117
     C           *IN53     ANDEQ'0'                                       S01117
     C           *IN54     ANDEQ'0'                                       S01117
     C                     MOVE 'A'       RECI
     C***********          MOVE BRANCH    CVBR                            S01117
     C                     MOVE RSEQ      CVSEQ                           S01117
     C                     MOVE WORK6N    CVCN
      *                                                                   S01117
      ** If all branches requested then call subroutine to write out      S01117
      ** a record for the customer and every branch on the system         S01117
      *                                                                   S01117
     C           BRANCH    IFEQ 'ALL'                                     S01117
     C                     EXSR WRITBR                                    S01117
     C                     ELSE                                           S01117
      *                                                                   S01117
      ** Write one record only if single branch requested                 S01117
      *                                                                   S01117
     C                     MOVE BRANCH    CVBA                            S01117
     C                     WRITECVALSDF
     C                     ADD  1         COUNT   50
     C                     END                                            S01117
      *                                                                   S01117
     C                     SETON                         55               E20448
     C                     MOVEAERR,5     DONMSG                          E20448
     C                     END
     C*
     C                     END
     C                     END                                            S01117
     C                     END
      *                                                                   S01117
      ** Set return codes for RCF                                         S01117
      *                                                                   S01117
     C           *IN12     IFEQ '1'                                       S01117
     C                     MOVE 'F'       RCMD                            S01117
     C                     END                                            S01117
     C           *IN01     IFEQ '1'                                       S01117
     C           COUNT     ANDEQ0                                         S01117
     C                     MOVE 'E'       RCMD                            S01117
     C                     END                                            S01117
     C*
     C* Write audit record (or add to existing one if found)
     C*
     C           COUNT     IFGT *ZEROS
     C                     READ CVALSAF                  33
     C           *IN33     IFEQ '1'
     C                     MOVE 'A'       RECI
     C                     Z-ADDCOUNT     NORE
     C                     WRITECVALSAF
     C                     ELSE
     C                     ADD  COUNT     NORE
     C                     UPDATCVALSAF
     C                     END
     C                     END
      *
      *================================================================
      *  P R O G R A M   E N D                                        *
      *                                                               *
     C***********          SETON                     LRRT                 S01117
     C                     SETON                     LR                   S01117
      *                                                               *
      *================================================================
      /EJECT                                                              S01117
      *****************************************************************   S01117
      *                                                               *   S01117
      * *PSSR  - Database error subroutine.                           *   S01117
      *          This subroutine DUMPs the program just once.         *   S01117
      *                                                               *   S01117
      * Called by: Database error processing                          *   S01117
      *                                                               *   S01117
      * Calls: None                                                   *   S01117
      *                                                               *   S01117
      *****************************************************************   S01117
      *                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR SR ** S01117
      *                                                                   S01117
     C           @RUN      IFEQ *BLANK                                    S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     ENDSR                                          S01117
      *                                                                   S01117
      ********************************************************************S01117
      /EJECT                                                              S01117
      *****************************************************************   S01117
      *                                                               *   S01117
      * CHKSEL - Subroutine to check for question marks.              *   S01117
      *                                                               *   S01117
      * Called by: Main processing                                    *   S01117
      *                                                               *   S01117
      * Calls: None                                                   *   S01117
      *                                                               *   S01117
      *****************************************************************   S01117
      *                                                                   S01117
     C           CHKSEL    BEGSR                                          S01117
      *                                                                   S01117
     C                     Z-ADD0         @SEL    10                      S01117
      *                                                                   S01117
     C                     MOVELCUSTMR    @QMK    1                       S01117
     C           @QMK      IFEQ '?'                                       S01117
     C                     Z-ADD1         @SEL                            S01117
      *                                                                   S01117
      ** Access Securities Clients Details file                           S01117
      *                                                                   S01117
     C                     CALL 'AOSECSR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM '?     '  @AENB   6                       S01117
     C           SDSECS    PARM SDSECS    DSSDY                           S01117
     C           @RTCD     IFEQ '*NOSEL'                                  S01117
     C                     MOVE *BLANK    CUSTMR                          S01117
     C                     ELSE                                           S01117
     C                     MOVE *BLANK    CUSTMR                          S01117
     C                     MOVELBFCUST    CUSTMR                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     ENDSR                                          S01117
      ********************************************************************S01117
      /EJECT                                                              S01117
      *****************************************************************   S01117
      *                                                               *   S01117
      * READBR - Subroutine to read all branch codes into array       *   S01117
      *                                                               *   S01117
      * Called by: Main processing                                    *   S01117
      *                                                               *   S01117
      * Calls: None                                                   *   S01117
      *                                                               *   S01117
      *****************************************************************   S01117
      *                                                                   S01117
     C           READBR    BEGSR                                          S01117
      *                                                                   S01117
      ** Only read in the branch codes once                               S01117
      *                                                                   S01117
     C                     Z-ADD1         @RDBR   10                      S01117
      *                                                                   S01117
      ** Read first branch                                                S01117
      ** Access branch codes file SDBRCHPD via access object program      S01117
      *                                                                   S01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*DBERR'  @RTCD   7                       S01117
     C                     PARM '*FIRST'  @OPTN   7                       S01117
     C                     PARM           @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *                                                                   S01117
      ** Set array index                                                  S01117
      *                                                                   S01117
     C                     Z-ADD0         X       30                      S01117
      *                                                                   S01117
     C           @RTCD     DOWEQ*BLANKS                                   S01117
     C           X         ANDLT100                                       S01117
      *                                                                   S01117
      ** Load up branch code array                                        S01117
      *                                                                   S01117
     C                     ADD  1         X                               S01117
     C                     MOVE A8BRCD    BRC,X                           S01117
      *                                                                   S01117
      ** Access branch codes file SDBRCHPD via access object program      S01117
      *                                                                   S01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*NEXT'   @OPTN   7                       S01117
     C                     PARM           @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C                     END                                            S01117
      *                                                                   S01117
      ** Save the number of branches on the system                        S01117
      *                                                                   S01117
     C                     MOVE X         @BRCNO  30                      S01117
      *                                                                   S01117
     C                     ENDSR                                          S01117
      ********************************************************************S01117
      /EJECT                                                              S01117
      *****************************************************************   S01117
      *                                                               *   S01117
      * WRITBR - Subroutine to write out a record to CVALSD for the   *   S01117
      *          customer and each branch on the system               *   S01117
      *                                                               *   S01117
      * Called by: Main processing                                    *   S01117
      *                                                               *   S01117
      * Calls: None                                                   *   S01117
      *                                                               *   S01117
      *****************************************************************   S01117
      *                                                                   S01117
     C           WRITBR    BEGSR                                          S01117
      *                                                                   S01117
     C                     Z-ADD0         X                               S01117
     C           X         DOWLT@BRCNO                                    S01117
     C                     ADD  1         X                               S01117
     C                     MOVE BRC,X     CVBA                            S01117
     C                     WRITECVALSDF                                   S01117
     C                     ADD  1         COUNT   50                      S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     ENDSR                                          S01117
      ********************************************************************S01117
      ***/EJECT*                                                          S01117
     C***/COPY*ZSRSRC,ZICD2Z1                                             S01117
      ***/EJECT*                                                          S01117
     C***/COPY*ZSRSRC,ZICDSEZ1                                            S01117
      ***/EJECT*                                                          S01117
     C***/COPY*ZSRSRC,ZSYSTMZ1                                            S01117
      /EJECT
      ***
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
** Error messages E20448 - ADD ERR,5 FOR DONMSG                           E20448
**BRANCH ENTERED IS NOT VALID  Message redundant due to RCF               S01117
CUSTOMER/SHORTNAME ENTERED IS NOT A SECURITIES TRADING CUSTOMER
STATEMENT ALREADY REQUESTED
CUSTOMER/SHORTNAME ENTERED IS NOT A SAFE OR DISCRETIONARY CLIENT
STATEMENT REQUEST ACCEPTED. It will be produced during Close of Business
