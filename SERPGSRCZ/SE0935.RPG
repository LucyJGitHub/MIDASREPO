     H        1
     F*****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Customer valuation statement')                *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Securities Trading Module                            *
     F*                                                               *
     F*  SE0935 - CUSTOMER VALUATION STATEMENTS                       *
     F*                                                               *
     F*  Function: To produce the Valuation Statements for each       *
     F*   (COB)    Customer/Branch which are due on a frequency       *
     F*   (I/C)    basis or have been requested individually (in I/C),*
     F*            showing data from the Dealing and Retail Modules   *
     F*            if they are present.                               *
     F*                                                               *
     F*  Calls : ZACCRC - Calculate Interest - Customer Position      *
     F*                                                               *
     F*  Called by: SEC0904 - Customer Valuation Statements           *
     F*                                                               *
     F*            Frequency:                                         *
     F*            - Automatically at defined frequency               *
     F*            - As requested during input cycle                  *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. 248698             Date 01Jun20               *
      *  Prev Amend No. MD057247           Date 01Feb21               *
      *                 MD050604           Date 21Feb20               *
      *                 MD053295           Date 13Apr19               *
      *                 MD046248           Date 05Feb18               *
      *                 CDL099             Date 06Oct17               *
      *                 226449             Date 24Jun15               *
      *                 MD034776           Date 09Jul15               *
      *                 CGL165             Date 15Feb17               *
      *                 CDL096             Date 22Sep14               *
      *                 CDL094             Date 11Jun14               *
      *                 AR1067108          Date 11Dec12               *
      *                 AR1001183          Date 20Nov12               *
      *                 263666             Date 01Feb10               *
      *                 CER059             Date 19Jul10               *
      *                 CER016A            Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 246141             Date 26Mar07               *
      *                 164847             Date 30Nov06               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 234300             Date 29Sep06               *
      *                 CDL049             Date 11May06               *
      *                 CSD027             Date 09Dec05               *
      *                 242286             Date 25Sep06               *
      *                 BUG7985            Date 07Jul05               *
      *                 229957             Date 29Oct04               *
      *                 CDL038             Date 10May05               *
      *                 CIR013             Date 25Apr05               *
      *                 CSE071             Date 19Jul05               *
      *                 229857             Date 07Oct04               *
      *                 226570             Date 27Jun04               *
      *                 210170             Date 25May04               *
      *                 BUG2507            Date 25May04               *
      *                 222727             Date 05Nov03               *
      *                 211407             Date 07Jan03               *
      *                 208241             Date 21Aug02               *
      *                 207543             Date 17JUL02               *
      *                 194370             Date 12Jul01               *
      *                 180056             Date 18Oct00               *
      *                 CSE037             Date 29Apr02               *
      *                 CSE035             Date 22Apr02               *
      *                 206316             Date 19Jul02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 17Jun01               *
      *                 CSE031             Date 09Nov01               *
      *                 180707             Date 25Jul00               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 174665             Date 14Jun01               *
      *                 127566             Date 09May01               *
      * Midas DBA 3.04 -----------------------------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CIR004             Date 20Jan00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CSE015             Date 06Dec99               *
      *                 CSE017             Date 20Oct99               *
      *                 CSE012             Date 16Aug99               *
     F*                 167710             Date 22Sep99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 130862             Date 18Oct98               *
      *                 151945             DATE 06Jan99               *
     F*                 126017             Date 14Nov97               *
     F*                 121768             Date 19Feb98               *
     F*                 102754             DATE 13FEB98               *
     F*                 CSE005             DATE 04FEB97               *
     F*                 097885             DATE 03FEB97               *
     F*                 084704             DATE 12AUG96               *
     F*                 083039             DATE 12AUG96               *
     F*                 059110             DATE 12AUG96               *
     F*                 071382             DATE 12AUG96               *
     F*                 088047             DATE 26JUN96               *
     F*                 101516             DATE 02APR96               *
     F*                 100228             DATE 30MAY96               *
     F*                 054690             DATE 02MAY96               *
     F*                 032925             DATE 30APR96               *
     F*                 095028             DATE 23APR96               *
     F*                 099886             DATE 18APR96               *
     F*                 100017             DATE 18APR96               *
     F*                 S01408             DATE 04MAR96               *
     F*                 095244             DATE 01NOV95               *
     F*                 095238             DATE 31OCT95               *
     F*                 092961             DATE 04OCT95               *
     F*                 091254             DATE 20OCT95               *
     F*                 093508             DATE 25SEP95               *
     F*                 086491             DATE 15JUN95               *
     F*                 S01408             DATE 22AUG94               *
     F*                 064575             DATE 15AUG94               *
     F*                 S01408             DATE 19MAY94               *
     F*                 065301             DATE 05MAY94               *
     F*                 066550             DATE 04FEB94               *
     F*                 052254             DATE 10JAN94               *
     F*                 S01453             DATE 14DEC93               *
     F*                 S01401             DATE 16JUN93               *
     F*                 E39495             DATE 17FEB93               *
     F*                 E31440             DATE 17FEB93               *
     F*                 E47922             DATE 01FEB93               *
     F*                 E47474             DATE 01FEB93               *
     F*                 S01397             DATE 10SEP92               *
     F*                 E37680             DATE 27MAR92               *
     F*                 E37297             DATE 24MAR92               *
     F*                 E35780             DATE 25FEB92               *
     F*                 E35677             DATE 10FEB92               *
     F*                 E35439             DATE 07FEB92               *
     F*                 E35419             DATE 06FEB92               *
     F*                 E31197             DATE 04NOV91               *
     F*                 E30860             DATE 30OCT91               *
     F*                 E27576             DATE 24OCT91               *
     F*                 E27934             DATE 22OCT91               *
     F*                 E29170             DATE 08OCT91               *
     F*                 E27092             DATE 04SEP91               *
     F*                 S01117             DATE 11JUL91               *
     F*                 S01195             DATE 11JUL91               *
     F*                 S01269             DATE 19JUL90               *
     F*                 S01271             DATE 19JUN90               *
     F*                 E21668             DATE 01MAY90               *
     F*                 E21616             DATE 03APR90               *
     F*                 E20887             DATE 15FEB90               *
     F*                 E20953             DATE 31JAN90               *
     F*                 S01232             DATE 18NOV89               *
     F*                 E20380             DATE 30NOV89               *
     F*                 E18203             DATE 27NOV89               *
     F*                 E19812             DATE 11OCT89               *
     F*                 E16095             DATE 09AUG 89              *
     F*                 E16772             DATE 31/05/89              *
     F*                 E15776             DATE 08/03/89              *
     F*                 E16093             DATE 13/02/89              *
     F*                 S01176             DATE 15/08/88              *
     F*                 E14040             DATE 08/08/88              *
     F*                 S01129             DATE 19/04/88              *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  248698 - Rounding discrepancies on some SE reports. Applied  *
      *           fix 228682.                                         *
      *  228682 - Recompiled due to ZCNSDZ1 changes. Applied 176594.  *
      *  MD057247 - Multiple calls of UTCHOBJEX for several COB com-  *
      *             ponents - Securities module.                      *
      *           - Moved the call of AOSARDR0 from /copy ZLCDZ1.     *
      *  MD050604 - Average price of position changed incorrectly.    *
      *           - Recompiled due to changes in copy source ZCNSDZ1. *
      *  MD053295 - Lending loan with Interest Calculation Basis      *
      *             method 3 (30/360) has wrong interest payment      *
      *             amount for month of March (Recompile)             *
      *  MD046248 - Finastra Rebranding                               *
      *  CDL099 - Split Value Date (Recompile)                        *
      *  226449 - Recompiled over changes made in /COPY ZDYYRZ3.      *
      *         - Applied for MD034387.                               *
      *  MD034776 - Reverse AR1001183A to allow negative interest     *
      *             rate. (Recompile)                                 *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *           (Recompiled)                                        *
      *  AR1067108 - PMC1140 Component failed during Clean COB        *
      *              Applied fix AR1001183A                           *
      *  AR1001183A - Coupon rate was still used in computation of    *
      *              interest instead of using the details in FRN tab *
      *              (Reopen) (Recompile)                             *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *           to Midas Plus (Recompile)                           *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  234300 - Recompiled over changed in PF/HSTTRD.               *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  BUG7985- Several components failed due to accessing TABLETR  *
      *  229957 - Initialize CPC, IPC, NPC to zero if TOTPFC is zero. *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over GLINTC and ZINTDY.                   *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  229857 - Recompiled due to change in ZYLDZ2.                 *
      *  226570 - Recompiled due to change in ZYLDZ2.                 *
      *  210170 - Logical File must contain Depot Value Date with     *
      *           CSE015.                                             *
      *  BUG2507 - Logical File must contain Depot Value Date with    *
      *           CSE015.  Applied fix 210170.                        *
      *  222727 - Release 5.0 errors  (Recompile)                     *
      *  211407 - Recompile after change on copy sources ZYLDZ2,      *
      *           ZACCRZ1 and ZYCEZ1 for NX/NNX processing.           *
      *           The change was to call subroutine ZLCD1 instead     *
      *           of ZLCD in retrieving the PERIOD for NNX processing *
      *           and ZNCD1 is called instead of ZNCD in retrieving   *
      *           the WBENCD for NNX processing. Also rewrite tests   *
      *           for identifying if position is NX,NNX or CUM.       *
      *  208241 - Recompiled over changed /CPY ZSDESCZ3.              *
      *  207543 - CEU018 not working on a price basis.                *
      *           Recompiled over changed ZYLDZ2.                     *
      *  194370 - Recompile after change on copy sources ZYLDZ2,      *
      *           For securities with divisor basis = '5' and first   *
      *           coupon date > valuation date (rundate + 1), set     *
      *           event control date to first coupon date before      *
      *           processing SR/ZDYYR. This is to ensure that the     *
      *           correct hypothetical last and next coupon dates are *
      *           used in deriving the price/yield rate.              *
      *  180056 - Recompiled over changed in ZDYYRZ3.                 *
      *  CSE037 - Bond Pricing - 3 Decimal Places in Trades Input     *
      *  CSE035 - NX/NNX Coupon Payment Processing.                   *
      *           Recompile over changed ZACCRZ1/ZYLDZ2/ZYCEZ1
      *  206316 - Recompiled over changed ZLCDZ1.                     *
      *  CPK015 - Conversion of ZYIELD from PLI to RPG.               *
      *           Recompile over changed ZYLDZ2.                      *
      *  CSE031 - Coupon Fixing for Floating Rate Notes.              *
      *           (recompilation due to change to ZNCD/ZLCD/ZACCR).   *
      *  180707 - No Position Settlements generated. Recompile over   *
      *           changes in /COPY ZNCDZ3.                            *
      *  174665 - Only write an 'Other Holding' line for retail accnt.*
      *  127566 - Recompiled over changed ZSDESCZ3                    *
      *  CIR004 - Dealing Calculation Method Change                   *
      *         - Recompiled due to GLINTC and ZINTDY changes         *
      *  CSE015 - Forward Valued Depot Movements (Recompile)          *
      *  CSE017 - Cum/Ex Indicator on Depot Movements (Recompile)     *
      *  CSE012 - SE Depot Movement Narratives (Recompiled).          *
     F*  167710 - Fields Book Price and Market price too small in     *
     F*           printer file SE0935P1. Increased from 18 to 21.     *
     F*           Re-compile this program.
     F*  130862 - Recompiled over ZLCDZ1 & ZDAYSZ2 changes.           *
     F*  151945 - Recompiled Over changed ZDYYRZ3 .                   *
     F*  126017 - Correction to interest calculation for calculation  *
     F*           basis 6 in SR/GLINTC. Add SR/ZDAT10                 *
     F*  121768 - Recompile over changed GLINTCZ1                     *
     F*  102754 - DBERR IN 017. DEFAULT CCY USING BASE CCY.           *
     F*  CSE005 - Effect of holidays on FRN Coupon Dates              *
     F*           (recompilation due to change to ZNCD/ZLCD/ZACCR).   *
     F*  097885 - Recompiled for wrong calculation of number of day   *
     F*           interest (ZINTDYZ2).                                *
     F*  084704 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
     F*  083039 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
     F*  059110 - Recompile over changed ZYLDZ2 sub.                  *
     F*  071382 - Do not print zero position if it is created by      *
     F*           user error.                                         *
     F*  088047 - RECOMPILE over change SR/ZYLDZ2.                    *
     F*  101516 - Changes for Value currency for S01509 and S01510    *
     F*  100228 - RECOMPILE OVER CHANGED ZDYYRZ3, ZLCDZ1 & ZNCDZ3.    *
     F*  054690 - The balance does not reflect the account balance    *
     F*  032925 - Accrued interest wrongly added in report cause      *
     F*           interest amounts reveresed in file
     F*  095028 - Overflow problem during output of TOTAL2            *
     F*  099886 - Rounding problem for partly paid securities.        *
     F*           Fix applied is the same as in ZACCZ subroutine.     *
     F*  100017 - Position settlement unable to pick up day adj. on   *
     F*           SECTYD. Change subroutine to use DADJN to stop      *
     F*           interest day adjustment being used for amortisation.*
     F*           Recompile over amended subroutine ZDAYS.            *
     F*  S01408 - Addition of core hook SE0935FFP1
     F*           Addition of core hook SE0935CCP1
     F*           Addition of core hook SE0935CCP2
     F*           Addition of core hook SE0935CCP3
     F*  095244 - Recompiled for Calculation method 3                 *
     F*  095238 - Recompiled for Calculation method 3                 *
     F*  092961 - Recompile over ZDAYSZ2 which was amended by 086491  *
     F*           (Wrong number of days calculated for day basis 1    *
     F*           when start or end day is last day of February)      *
     F*  091254 - RECOMPILE OVER CHANGED ZLCDZ1 & ZNCDZ3              *
     F*  093508 - Recompile program following increase of market price*
     F*           field in printer file SE0935P1                      *
     F*  086491 - Wrong nbr of days calculated for day basis 1        *
     F*           when start or end day is last day of February       *
     F*           Recompiled for ZSRSRC/ZDAYSZ2 changes.              *
     F*  S01408 - Core hook SE0935CIPG added                          *
     F*           Core hook SE0935CPLT added                          *
     F*  064575 - Recompiled over amended ZYLDZ2 subroutine.          *
     F*  S01408 - Core hook SE0935CCPG added                          *
     F*  065301 - Recompiled over changed copy source ZACCR subr.     *
     F*           with ZAMT increased to 15,0.                        *
     F*  066550 - GLINTC has had historical problems and inaccuracies *
     F*           and is now externaly descibed and changed to use    *
     F*           ZINTDYZ1. See document atached to error no on GEMS  *
     F*  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
     F*           to 10,9                                             *
     F*  S01453 - MARGIN AND FX POSITIONS/POINTS AND BASE CURRENCY    *
     F*           POSITIONS/POINTS ADDED TO FX INPUT (RECOMPILED)     *
     F*  S01401 - MT5xx SWIFT Messages Feature:                       *
     F*            - Recompiled due to changes to files.              *
     F*  E39495 - New /COPY subroutine ZCALCD added (called from      *
     F*           sr. ZYLD)                                           *
     F*         - /COPY subroutine ZCNSDZ1 added (called from sr.ZYLD)*
     F*         - Recompiled over changed ZYLDZ2                      *
     F*  E31440 - 'OTHER HOLDINGS', the balance should be a sum of    *
     F*           all retail accounts per currency.                   *
     F*  E47922 - Recompiled over changed SR/ZYLDZ2                   *
     F*  E47474 - Detail printer file closed when program tries to    *
     F*           write to it                                         *
     F*  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
     F*           - Recompiled due to changes to files and SR/ZYLD.   *
     F*  E37680 - Requested Branch checking is only applicable if the *
     F*           System is in Multibranched Mode.                    *
     F*  E37297 - Strange problem with zoned decimal parameter        *
     F*           passed to ZACCR                                     *
     F*  E35780 - If price is not found on file PRICT, the price of   *
     F*           the previous record is used.                        *
     F*  E35677 - Portfolio ccy name is different for every page      *
     F*  E35439 - New heading printed for a branch which has no       *
     F*           records to report                                   *
     F*  E35419 - Book value and market value in portfolio ccy  are   *
     F*           100 times too small.                                *
     F*  E31197 - Should report no details on Audit printer file      *
     F*  E30860 - Mandatory report will have a sequence no. of blanks *
     F*           on CVALSD so save initial value of the seq. no.     *
     F*           parameter for comparison                            *
     F*  E27576 - Market price always shown as zero                   *
     F*  E27934 - Recompiled over the changed version of ZACCRZ1      *
     F*  E29170 - RCF CHANGES                                         *
     F*  E27092 - Recompiled over changed SR/ZLCD                     *
     F*  S01117 - Multibranching                                      *
     F*  S01195 - Holiday amendment                                   *
     F*  S01269 - TRADE AUTHORISATION                                 *
     F*  S01271 - Recompiled for Pay/Receive in Input Cycle changes   *
     F*           to TRADSD and/or DPTMVD                             *
     F*  E21668 - Recompiled over changed SR/ZYLDZ2                   *
     F*  E21616 - Recompiled over changed SR/ZLCD.                    *
     F*  E20887 - Correct Edit Code for ratios and add DB Error 26.   *
     F*  E20953 - Use Cum/Ex Indicator from Trade for Australian      *
     F*           Price/Yield conversion.                             *
     F*  S01232 - Australian Yields modifications.                    *
     F*  E20380 - Recompile for changed ZYLDZ1/2 and include ZLCDZ1.  *
     F*  E18203 - Take Base Currency if Portfolio Currency does not   *
     F*           exist (i.e. if Market Customer).                    *
     F*  E19812 - Fix E16095 is wrong. Average Price is out by a      *
     F*           factor of 10,000.                                   *
     F*  E16095 - Decimal Places on Customer Average Price calculated *
     F*           incorrectly.                                        *
     F*  E16772 - The Dividend Payment Amount field SDDV has been     *
     F*           replaced by the field SDVA, to increase its size    *
     F*           from 9,4 to 13,8                                    *
     F*  E15776 - OVERFLOW ERRORS ON PRINT FILE.                      *
     F*  E16093 - ONLY FUTURE-VALUED TRADES SHOULD BE REPORTED.       *
     F*  S01176 - SECURITIES TRADING 3.1 (AUSTRALIA).                 *
     F*  E14040 - BOOK PRICE & BOOK VALUE HAD THE WRONG SIGN IF       *
     F*           NOMINAL IS NEGATIVE.                                *
     F*           OVERPRINTING ERROR ON REPORT.                       *
     F*  S01129 - MARKETING FIX SUPPLIED DURING INCORPORATION         *
     F*                                                               *
     F*****************************************************************
      *
     F***CVALS***IP  E           K        DISK                            S01117
     FCVALS   UP  E           K        DISK                               S01117
     FCPOSC   IF  E           K        DISK
     FCPOSH   IF  E           K        DISK                           UC  101516
     F            CPOSNDF                           KRENAMECPOSHF         101516
     FSECET   IF  E           K        DISK
     F            SEDEVDF                           KRENAMESEDEVET        S01232
     FSEDEV   IF  E           K        DISK                               S01232
     FSECEO   IF  E           K        DISK                               S01232
     F            SEDEVDF                           KRENAMESEDEVDO        S01232
     F            SNDEVDF                           KRENAMESNDEVDO        S01232
     FPRICT   IF  E           K        DISK
     FACCBR   IF  E           K        DISK                           U1
     FREACR   IF  E           K        DISK                           U1
     F            REACRAF                           KIGNORE
     F            REACRZF                           KIGNORE
     FCUSDB   IF  E           K        DISK                           U2
     FCLINT   IF  E           K        DISK
     F            CLINTCAF                          KIGNORE
     F            CLINTCBF                          KIGNORE
     F            CLINTC1F                          KIGNORE
     FTABSE   IF  E           K        DISK
     F            TABLETAF                          KIGNORE
     F* ICD       TABTB10F                          KIGNORE
     F* ICD 2     TABTB11F                          KIGNORE
     F* ICD SE    TABTB36F                          KIGNORE
     F            TABTE10F                          KIGNORE
     F            TABTE20F                          KIGNORE
     F* CCY       TABTG10F                          KIGNORE
     F            TABTG20F                          KIGNORE
     F* COUNTRY   TABLETHF                          KIGNORE
     F********    TABLETJF                          KIGNORE               S01232
     F            TABLETKF                          KIGNORE
     F            TABLETLF                          KIGNORE
     F            TABLETNF                          KIGNORE
     F            TABLETPF                          KIGNORE
     F* BRC       TABLETRF                          KIGNORE
     F            TABLETXF                          KIGNORE
     F            TABLET2F                          KIGNORE
     F            TABLET3F                          KIGNORE
     F            TABLET5F                          KIGNORE
     F            TABTB40F                          KIGNORE
     FSECTY   IF  E           K        DISK
     FINVTP   IF  E           K        DISK
     FCPPRIC  IF  E           K        DISK                               S01176
     FTDPBT   IF  E           K        DISK                               071382
     F            HSTTRDF                           KRENAMETDPBTF1        071382
     F            TRADSDF                           KRENAMETDPBTF2        071382
     F            DPTMVDF                           KRENAMETDPBTF3        071382
     F            DPTMVTF                           KRENAMETDPBTF4        071382
     FTRDBV   IF  E           K        DISK
     F/COPY WNCPYSRC,SE0935F001
     F***CVALSAU*IF  E           K        DISK                            S01117
     FCVALSAU UF  E           K        DISK                               S01117
     FSE0935P1O   E                    PRINTER                        UC
     F                                              KINFDS SPOOL          E29170
     FSE0935AUO   E                    PRINTER
     F                                              KINFDS SPOOLU         E29170
     F*                                                                   S01408
     F/COPY WNCPYSRC,SE0935FFP1                                           S01408
     F*                                                                   S01408
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*   L1  - Change of Customer                                    *
     F*   L2  - Change of Branch                                      *
     F*                                                               *
     F*   01  - CVALS record read                                     *
     F*                                                               *
     F*   21  - Nominal currency dec. places 0                        *
     F*   22  - Nominal currency dec. places 1                        *
     F*   23  - Nominal currency dec. places 2                        *
     F*   24  - Nominal currency dec. places 3                        *
     F*   30  - '1' - Trade date basis, '0' - Value date basis        *
     F*   31  - Indicator accrued interest for debit                  *   032925
     F*   33  - General work indicator                                *
     F*   34  - General work indicator 2                              *
     F*   35  - General work indicator 3                              *
     F*   36  - General work indicator 4                              *
     F*   37  - Indicator accrued interest for credit                 *   032925
     F*   38  - Read on CPOSH                                         *   101516
     F*   41  - Australian yield traded security                      *   S01232
     F*   42  - Multibranching                                        *   S01117
     F*                                                               *
     F*   50  - Print TIME on detail report                           *
     F*   51  - Print % sign on detail report                         *
     F*   52  - Print accrued interest details                        *
     F*   53  - Print % sign on forward-value trade line              *
     F*   54  - Print value currency details                          *
     F*   55  - Print 'To date'                                       *
     F****56**-*Difference*on*audit*extract*record*no.*****************   S01117
     F****57**-*Difference*on*audit*prompt*record*no.******************   S01117
     F*   61  - Print % sign for Country of origin total              *
     F*         on summary report                                     *
     F*   62  - Print % sign for Investment type total                *
     F*         on summary report                                     *
     F*   63  - Print % sign for Nominal currency total               *
     F*         on summary report                                     *
     F*   69  - Used to Control first cycle processing                *
     F*   71  - Control printing of totals for customer               *
     F*   80  - Chain indicator CPPRIC                                *   S01176
     F*                                                               *
     F* 90-99 - Used in Standard Subroutines.                         *
     F*                                                               *
     F*   U1  - Retail module present                                 *
     F*   U2  - Dealing module present                                *
     F*   U7  - Database Error.                                       *
     F*   U8  - Database / Control Error                              *
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*  AUDIT  - Process and print audit trail                       *
     F*  CTLPRT - Control processing and printing of statements       *
     F*  FXDEAL - Print FX deals                                      *
     F*  GLINTC - Calculate accrued interest since control date       *
     F*  MNYMKT - Print money market loans and deposits               *
     F*  PRTDIV - Print dividend details                              *
     F*  PRTFVT - Print forward-value trade details                   *
     F*  PRTHLD - Print holding details                               *
     F*  PRTSUM - Print summary details                               *
     F*  RETAIL - Print retail and settlement totals                  *
     F*  STORE  - STORE DETAILS FOR A CURRENCY                        *
     F*  TOTALS - Print customer totals                               *
     F*  ZCALCD - Calculate long term CD price from input yield       *   E39495
     F*  ZCNSD  - Calculate consideration                             *   E39495
     F*  RCFP1  - SUBROUTINE TO REGISTER P1 PRINTER FILE VIA RCF      *   E29170
     F*  RCFAU  - SUBROUTINE TO REGISTER AU PRINTER FILE VIA RCF      *   E29170
     F*                                                               *
     F***XDATE3*-*TO*CALCULATE*ANY*NUMBER*OF*WORKING*DAYS*BACK.****S01232 S01195
     F*  ZBKDT  - CALCULATE BUSINESS DAYS BACKWARDS                   *   S01195
     F*  ZACCR  - CALCULATE INTEREST ACCRUED TO A SPECIFIC DATE       *   S01232
     F*  ZACCZ  - CALCULATE ACCRUED INTERESR BETWEEN 2 DATES          *   S01232
     F*  ZCONV  - Convert an amount from one currency to another      *
     F*  ZDATE1 - DATE - DAYNO conversion                             *
     F*  ZDATE2 - DAYNO - DATE conversion                             *
     F*  ZDAYS  - Calculate number of days between two dates for      *
     F*           Interest calculations                               *
     F*  ZDYYR  - Calculate number of days in Interest year           *
     F*  ZEDIT  - Insert a decimal point into a numeric field and blan*
     F*            out leading zeros                                  *
     F*  ZEVCD  - Determine Event Control date                        *
     F*  ZICDSE - Access ICD record for Securities Trading            *
     F*  ZICD2  - Access ICD2 Record                                  *
     F*  ZLCD   - GET PREVIOUS COUPON DATE.                           *   E20380
     F*  ZNCD   - Determine Next Coupon date                          *
     F*  ZPRCI  - Output Price as % Price                             *   S01176
     F*  ZPRCO  - Convert Price to Discount/Yield/Percentage          *
     F*  ZRATE  - TO WORK OUT EFFECTIVE INTEREST RATE OVER A PERIOD   *   S01232
     F*  ZRSTOR - Restores indicators 90 - 97                         *
     F*  ZSAVE  - Remember setting and then setof indicators 90 - 97  *
     F*  ZSDESC - Format Security Description                         *
     F*  ZSEDIT - Insert a decimal point and sign into a numeric field*
     F*           and blank out leading zeros                         *
     F*  ZSYSTM - Access ICD1 Record                                  *
     F*  ZXRATE - Fetch cross-currency exchange rate and multiply/divi*
     F*           indicator between two currencies                    *
     F*  ZYCE   - SET UP CUM/EX PARAMETER FOR AUSTRALIAN YIELDS       *  S0 1232
     F*  ZYLD   - Sets up parameters and call ZYIELD routine for      *  S0 1176
     F*           calculating yields or prices                        *  S0 1176
     F*  ZYLDI  - Output Yield as % Price                             *  S0 1176
     F*  ZYLDO  - Output Price as Price/Discount/Yield                *
     F*  ZYMTX  - Calculate Yield based on days to maturity           *  S0 1176
     F*                                                               *
     F*****************************************************************
      /EJECT
     E                    CPY@    1   1 80
     E/COPY ZSRSRC,ZDATE2Z1
     E*COPY*ZSRSRC,ZDATE6Z1                                        S01232 S01195
     E/COPY ZSRSRC,ZHOLE                                                  S01195
     E/COPY ZSRSRC,ZDAYSZ1
     E/COPY ZSRSRC,ZNCDZ1
     E/COPY ZSRSRC,ZSDESCZ1
     E/COPY ZSRSRC,ZPOWERZ1
     E/COPY ZSRSRC,ZSEDITZ1
     E/COPY ZSRSRC,ZALIGNZ1
     E/COPY ZSRSRC,ZYMTXZ1                                                S01176
     E                    CUR        50  3
     E                    XCR        50 13 8
     E                    COR        50  2
     E                    CPC        50 15 0
     E                    NMC        50  3
     E                    NPC        50 15 0
     E                    ITP        50  3
     E                    ITN        50  3
     E                    IPC        50 15 0
     E                    SCU        50  3
     E                    SDP        50  1 0
     E/COPY WNCPYSRC,SE0935E002
     E                    SSR        50 13 8
     E                    SXR        50 13 8
     E                    SMD        50  1
     E                    BAL        50 15 0
     E                    ACI        50 15 0
     E                    OTS        50 15 0
     E                    TBL        50 15 0
     E                    PCE        50 15 0
     E                    TABTYP  1   7  2   TABDSC 12
     E/COPY WNCPYSRC,SE0935E001
     E/COPY ZSRSRC,ZPOWER8Z1
     E/COPY ZSRSRC,ZDATE9Z1                                               066550
      /EJECT
     ICVALSDF     01
     I***********                                   CVBR  L2              S01117
     I                                              CVBA  L2              S01117
     I                                              CVCN  L1
     I              RECI                            RECICV
     ITDPBTF1                                                             071382
     I              RECI                            TRECI                 071382
     ITDPBTF2                                                             071382
     I              RECI                            TRECI                 071382
     ITDPBTF3                                                             071382
     I              RECI                            TRECI                 071382
     I              DPSS                            TDSS                  071382
     I              DPBN                            TCNR                  071382
     ITDPBTF4                                                             071382
     I              RECI                            TRECI                 071382
     I              DPSS                            TDSS                  071382
     I              DPBN                            TCNR                  071382
     ICPOSHF                                                              101516
     I              RECI                            RECIH                 101516
     I              CSNT                            CSNTH                 101516
     I              CSNV                            CSNVH                 101516
     I              CSPT                            CSPTH                 101516
     I              CSPV                            CSPVH                 101516
      *                                                                                       CSE037
     IINVTPDF                                                                                 CSE037
     I              SFLG                            ISFLG                                     CSE037
      *                                                                                       CSE037
     I/COPY WNCPYSRC,SE0935I003
     I*LDA********UDS                            256                      S01117
     I***********                           134 177 DBLOT                 S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 177 DBASE                 S01117
     ILDA         DS                            256                       S01117
     I                                      134 183 DBLOT                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     I*
     I           SDS
     I                                      244 246 WSID
     I                                      254 263 USID
     ICPYR@#      DS
     I*
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I*
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*                                                                   E29170
     ISPOOL       DS                                                      E29170
     I*                                                                   E29170
     I**  DS FOR P1 SPOOL FILE NAME                                       E29170
     I*                                                                   E29170
     I                                       83  92 SFILE                 E29170
     I                                    B 123 1240SFNUM                 E29170
     I**                                                                  E29170
     ISPOOLU      DS                                                      E29170
     I                                       83  92 SFILEU                E29170
     I                                    B 123 1240SFNUMU                E29170
     I**                                                                  E37297
     I            DS                                                      E37297
     I**********                              1   60CSCN                               E37297 CSD027
     I                                        1   6 CSCN                                      CSD027
     I                                        1   6 ZCUST                 E37297
      *                                                                                      BUG7985
     ISDBRCH    E DSSDBRCHPD                                                                 BUG7985
     I              A8BRNM                          BRNM                                     BUG7985
      ** Midas SD Branch Codes                                                               BUG7985
      *                                                                                      BUG7985
     I/COPY WNCPYSRC,SE0935I002
     I*
     I/COPY ZSRSRC,ZSEDITZ2
     I/COPY ZSRSRC,ZNCDZ2
     I/COPY ZSRSRC,ZSDESCZ2
     I/COPY ZSRSRC,ZYLDZ1
     I*
     I/COPY ZSRSRC,ZHOLI                                                  S01195
      **  EXTERNAL DS FOR HOLIDAY DETAILS                                 S01195
     I*                                                                   S01195
     I/COPY ZSRSRC,ZHOLDS                                                 S01195
      **  EXTERNAL DS FOR HOLIDAY DETAILS AND ACCESS OBJECTS              S01195
     IRUNDT       DS                                                      S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
     I**  DATA STRUCTURE FOR RUN DATE DETAILS                             S01117
     I/COPY ZSRSRC,ZINTDYZ1                                               066550
     I/COPY ZSRSRC,ZDATE9Z2                                               066550
     I/COPY ZSRSRC,ZDAT10Z1                                               126017
     I/COPY WNCPYSRC,SE0935I001
     C/EJECT
      *================================================================
      *  P R O G R A M   S T A R T                                    *
      *================================================================
     C*
     C*  FIRST TIME PROCESSING
     C*
     C           *IN69     IFEQ '0'
     C*
     C/COPY WNCPYSRC,SE0935C028
     C           *ENTRY    PLIST                                          S01117
     C                     PARM           SEQ     5                       S01117
     C                     PARM           ENT     3                       S01117
     C/COPY WNCPYSRC,SE0935C026
     C*                                                                   S01117
     C           *NAMVAR   DEFN           LDA
     C*
     C           *LIKE     DEFN CDP       PFCDP
     C           *LIKE     DEFN CDP       NMCDP
     C           *LIKE     DEFN SPOT      PFSPOT
     C           *LIKE     DEFN SPOT      NMSPOT
     C           *LIKE     DEFN MDIN      PFMDIN
     C           *LIKE     DEFN MDIN      NMMDIN
     C           *LIKE     DEFN CVBA      SAVBCH                          E47474
     C           *LIKE     DEFN TDDT      @DATE                           071382
     C           *LIKE     DEFN TDRF      @REF                            071382
     C*
     C* Prepare LDA
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE *BLANKS   DBLOT
     C                     MOVEL'SE0935'  DBPGM
     C                     OUT  LDA                                       S01117
     C*
     C** IN THE DATAAREA RUNDAT                                           S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C                     IN   RUNDT                                     S01117
     C/COPY WNCPYSRC,SE0935C056
     C**                                                                  S01117
     C**  TEST FOR MULTIBRANCHING                                         S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     SETON                     42                   S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C** CHECK SYSTEM FORMAT DATE, DDMMYY OR MMDDYY(98 ON)                S01117
     C           DATF      IFEQ 'M'                                       S01117
     C                     SETON                     98                   S01117
     C                     END                                            S01117
     C*                                                                   E30860
     C*  Save sequence no. for later comparison                           E30860
     C*                                                                   E30860
     C                     MOVE SEQ       SVSEQ   5                       E30860
     C*                                                                   E29170
     C** RCF Processing for Audit File                                    E29170
     C*                                                                   E29170
     C                     EXSR RCFAU                                     E29170
     C**                                                                  S01117
     C* Get installation Control data record 1
     C*
     C                     EXSR ZSYSTM
     C*
     C* Error in ZSYSTM
     C*
     C           *IN99     IFEQ '1'
     C           *LOCK     IN   LDA                        ***************S01117
     C***********          MOVEL'01'      DBASE            * DB ERROR 01 *S01117
     C                     Z-ADD1         DBASE            ***************S01117
     C                     MOVEL'TABLE'   DBFILE
     C                     MOVELZTABKY    DBKEY
     C                     OUT  LDA                                       S01117
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   S01117
     C                     SETON                     U7U8LR
     C                     EXSR *PSSR                                     S01117
     C                     RETRN
     C                     END
     C*
     C* Get Installation Control data record for security
     C*
     C                     EXSR ZICDSE
     C*
     C* Error in ZICDSE
     C*
     C           *IN99     IFEQ '1'
     C           *LOCK     IN   LDA                        ***************S01117
     C***********          MOVEL'02'      DBASE            * DB ERROR 02 *S01117
     C                     Z-ADD2         DBASE            ***************S01117
     C                     MOVEL'TABLE'   DBFILE
     C                     MOVELZTABKY    DBKEY
     C                     OUT  LDA                                       S01117
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   S01117
     C                     SETON                     U7U8LR
     C                     EXSR *PSSR                                     S01117
     C                     RETRN
     C                     END
     C*
     C* Get Installation Control Data record 2
     C*
     C                     EXSR ZICD2
     C*
     C* Error in ZICD2
     C*
     C           *IN99     IFEQ '1'
     C           *LOCK     IN   LDA                        ***************S01117
     C***********          MOVEL'03'      DBASE            * DB ERROR 03 *S01117
     C                     Z-ADD3         DBASE            ***************S01117
     C                     MOVEL'TABLE'   DBFILE
     C                     MOVELZTABKY    DBKEY
     C                     OUT  LDA                                       S01117
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   S01117
     C                     SETON                     U7U8LR
     C                     EXSR *PSSR                                     S01117
     C                     RETRN
     C                     END
      *                                                                   101516
      ** Check if Dividends Based on Ex-date (S01510) is on.              101516
      *                                                                   101516
     C                     CALL 'AOSARDR0'                                101516
     C                     PARM '*BLANKS' WRTCD   7                       101516
     C                     PARM '*VERIFY' WOPTN   7                       101516
     C                     PARM 'S01510'  @SARD   6                       101516
      *                                                                   101516
     C           WRTCD     IFEQ *BLANKS                                   101516
     C                     MOVE 'Y'       S01510  1                       101516
     C                     OPEN CPOSH                                     101516
     C                     END                                            101516
      *                                                                   101516
      ** Check if Value ccy to be ccy of issuer payments(S01509) is on.   101516
      *                                                                   101516
     C                     CALL 'AOSARDR0'                                101516
     C                     PARM '*BLANKS' WRTCD   7                       101516
     C                     PARM '*VERIFY' WOPTN   7                       101516
     C                     PARM 'S01509'  @SARD   6                       101516
      *                                                                   101516
     C           WRTCD     IFEQ *BLANKS                                   101516
     C                     MOVE 'Y'       S01509  1                       101516
     C                     END                                            101516
      *                                                                                       CSE035
      ** Access SAR details file to see if CSE035 is installed                                CSE035
      *                                                                                       CSE035
     C                     CALL 'AOSARDR0'                                                    CSE035
     C                     PARM *BLANKS   @RTCD                                               CSE035
     C                     PARM '*VERIFY' @OPTN                                               CSE035
     C                     PARM 'CSE035'  @SARD                                               CSE035
      *                                                                                       CSE035
     C           @RTCD     IFEQ *BLANK                                                        CSE035
     C                     MOVE 'Y'       CSE035  1                                           CSE035
     C                     ELSE                                                               CSE035
     C                     MOVE 'N'       CSE035                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       207543
      ** Access SAR details file to see if CEU018 is installed                                207543
      *                                                                                       207543
     C                     CALL 'AOSARDR0'                                                    207543
     C                     PARM *BLANKS   @RTCD                                               207543
     C                     PARM '*VERIFY' @OPTN                                               207543
     C                     PARM 'CEU018'  @SARD                                               207543
      *                                                                                       207543
     C           @RTCD     IFEQ *BLANK                                                        207543
     C                     MOVE 'Y'       CEU018  1                                           207543
     C                     ELSE                                                               207543
     C                     MOVE 'N'       CEU018                                              207543
     C                     ENDIF                                                              207543
      *                                                                                       CSE035
      ** Access Switchable Features file to determine if CSE031 is                          MD057247
      ** installed in the system.                                                           MD057247
      *                                                                                     MD057247
     C                     CALL 'AOSARDR0'                                                  MD057247
     C                     PARM           URTNCD  7                                         MD057247
     C                     PARM '*VERIFY' UOPTN   7                                         MD057247
     C                     PARM 'CSE031'  UUKEY   6                                         MD057247
     C                     PARM           UDSFDY 76                                         MD057247
      *                                                                                     MD057247
     C                     MOVE 'N'       CSE031  1                                         MD057247
     C           URTNCD    IFEQ *BLANKS                                                     MD057247
     C                     MOVE 'Y'       CSE031                                            MD057247
     C                     ENDIF                                                            MD057247
      *                                                                                     MD057247
      ** Access Switchable Features file to determine if CSE071 is                          MD057247
      ** installed in the system.                                                           MD057247
      *                                                                                     MD057247
     C                     CALL 'AOSARDR0'                                                  MD057247
     C                     PARM           URTNCD                                            MD057247
     C                     PARM '*VERIFY' UOPTN                                             MD057247
     C                     PARM 'CSE071'  UUKEY                                             MD057247
     C                     PARM           UDSFDY                                            MD057247
      *                                                                                     MD057247
     C                     MOVE 'N'       CSE071  1                                         MD057247
     C           URTNCD    IFEQ *BLANKS                                                     MD057247
     C                     MOVE 'Y'       CSE071                                            MD057247
     C                     ENDIF                                                            MD057247
      *                                                                                     MD057247
     C/COPY WNCPYSRC,SE0935C001
     C*
     C* Set up Trade/Valuation basis
     C*
     C           TVVL      COMP 'T'                      30
     C*
     C* Define work fields
     C*
     C           *LIKE     DEFN ECD       ACRCD
     C*
     C* Calculate Accrual Control date (EQ Event Control date)
     C*
     C                     Z-ADDAPDA      ZZAPDT                          S01117
     C                     Z-ADDDNWD      ZZDNWD                          S01117
     C                     EXSR ZEVCD
     C                     Z-ADDECD       ACRCD
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,SE0935CIPG                                           S01408
     C*                                                                   S01408
     C*
     C* Key to read Customer positions
     C*
     C           CPOSKA    KLIST
     C***********          KFLD           CVBR                            S01117
     C                     KFLD           CVBA                            S01117
     C                     KFLD           CVCN
     C*                                                                   101516
     C* Key to read historic customer positions                           101516
     C*                                                                   101516
     C           CPOSKH    KLIST                                          101516
     C                     KFLD           CVBA                            101516
     C                     KFLD           CSSC                            101516
     C                     KFLD           CVCN                            101516
     C                     KFLD           SDXD                            101516
     C*                                                                   101516
     C* Key to read historic customer positions                           101516
     C*                                                                   101516
     C           CPOSKL    KLIST                                          101516
     C                     KFLD           CVBA                            101516
     C                     KFLD           CSSC                            101516
     C                     KFLD           CVCN                            101516
     C*
     C* Key to access investment types
     C*
     C           INVKA     KLIST
     C                     KFLD           NMCY
     C                     KFLD           SITP
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0935CCP1                                           S01408
     C*                                                                   S01408
     C*
     C* Key to access Price File
     C*
     C           KEYPT     KLIST
     C                     KFLD           PTYP    2
     C                     KFLD           SESN
     C                     KFLD           PDAT    50
     C**********           KFLD           PCST    60                      S01155
     C********** KEYPT     KLIST                                          S01155
     C**********           KFLD           PCUS    60                                   S01155 CSD027
     C                     KFLD           PCUS    6                                           CSD027
      *                                                                   S01155
     C           KEYPTP    KLIST                                          S01155
     C                     KFLD           PTYP
     C                     KFLD           SESN
     C*
     C* Key to read Dividend diary events
     C*
     C           DEVKA     KLIST
     C                     KFLD           SESN
     C                     KFLD           EVTTYP  2
     C*
     C                     MOVE 'DV'      EVTTYP
     C*
     C* Key to read Trades file
     C*
     C           TRDKA     KLIST
     C***********          KFLD           CVBR                            S01117
     C                     KFLD           CVBA                            S01117
     C                     KFLD           CVCN
     C                     KFLD           SESN
     C*                                                                   071382
     C* Full key for Transaction file (TDPBT)                             071382
     C*                                                                   071382
     C           TDPKF     KLIST                                          071382
     C                     KFLD           CSBA                            071382
     C                     KFLD           CSCN                            071382
     C                     KFLD           CSSC                            071382
     C                     KFLD           @DATE                           071382
     C                     KFLD           @REF                            071382
     C*                                                                   071382
     C* Part key for Transaction file (TDPBT)                             071382
     C*                                                                   071382
     C           TDPKP     KLIST                                          071382
     C                     KFLD           CSBA                            071382
     C                     KFLD           CSCN                            071382
     C                     KFLD           CSSC                            071382
     C*
     C* Key to fetch accrued interest record
     C*
     C           ACRKA     KLIST
     C                     KFLD           CNUM
     C                     KFLD           CCY
     C                     KFLD           ACOD
     C                     KFLD           ACSQ
     C*                                                                   S01176
     C* Key to access Commercial Paper Prices                             S01176
     C*                                                                   S01176
     C           CPPKA     KLIST                                          S01176
     C                     KFLD           KINVT   3                       S01176
     C                     KFLD           KCCY    3                       S01176
     C/COPY WNCPYSRC,SE0935C054
     C*
     C                     SETON                     69
     C                     END
      *                                                                   S01117
      ** If sequence number changes then all relevant records read        S01117
      *                                                                   S01117
     C***********SEQ       IFNE CVSEQ                              S01117 E30860
     C           SVSEQ     IFNE CVSEQ                                     E30860
     C                     MOVE '1'       *INLR                           S01117
     C                     END                                            S01117
      *                                                                   E37680
      ***  If the system is in Multibranched Mode,                        E37680
      *                                                                   E37680
     C           MBIN      IFEQ 'Y'                                       E37680
     C*                                                                   E29170
     C** IF BRANCH READ IS NOT THE BRANCH REQUESTED                       E29170
     C** THEN STOP PROCESSING                                             E29170
     C*                                                                   E29170
     C           ENT       IFNE 'ALL'                                     E29170
     C           ENT       ANDNECVBA                                      E29170
     C                     SETON                     LR                   E29170
     C                     END                                            E29170
      *                                                                   E37680
     C                     END                                            E37680
      *                                                                   S01117
      ** Skip processing if last report for this sequence has been done   S01117
      *                                                                   S01117
     C           *INLR     IFEQ '0'                                       S01117
     C*
     C* Count records read - separate counts for frequency-based
     C* statements and on-request statements
     C*
     C           RECICV    IFEQ 'D'
     C                     SETOF                     50
     C                     ADD  1         FREQS
     C                     ELSE
     C           RECICV    IFEQ 'A'
     C                     ADD  1         ONRQS      50
      *                                                                   S01117
      ** Update RECI to asterisk so statement will not get produced       S01117
      ** more than once for the same request                              S01117
      *                                                                   S01117
     C                     MOVE '*'       RECICV                          S01117
     C                     EXCPTCVUPD                                     S01117
     C*
     C* Fetch time
     C*
     C                     TIME           SYSTIM  60
     C                     END
     C                     END
      *
      *---------------------------------------------------------------
      *  Change of Branch processing
      *---------------------------------------------------------------
      *
     C   L2                DO
     C*
     C                     MOVE 'N'       FILOPN  1                       E35439
     C* Fetch Branch Name
     C*
     C                     MOVE *BLANKS   KEY12A 12
     C**********           MOVEL'10'      KEY12A                                             BUG7985
     C***********          MOVE CVBR      KEY12A                          S01117
     C**********           MOVE CVBA      KEY12A                                      S01117 BUG7985
     C********** KEY12A    CHAINTABLETRF             33                                      BUG7985
      *                                                                                      BUG7985
     C                     CALL 'AOBRCHR1'                                                   BUG7985
     C                     PARM *BLANKS   PRTCD   7                                          BUG7985
     C                     PARM '*KEY   ' POPTN   7                                          BUG7985
     C                     PARM CVBA      PBRCH   3                                          BUG7985
     C           SDBRCH    PARM SDBRCH    DSSDY                                              BUG7985
     C*                                                                                      BUG7985
     C** Database error if no record found                                                   BUG7985
     C*                                                                                      BUG7985
     C           PRTCD     IFNE *BLANKS                                                      BUG7985
     C**N33***** RECI      COMP '*'                      33                                  BUG7985
     C********** *IN33     IFEQ '1'                                                          BUG7985
     C           *LOCK     IN   LDA                        ***************S01117
     C************         MOVEL'04'      DBASE            * DB ERROR 04 *S01117
     C                     Z-ADD4         DBASE            ***************S01117
     C**********           MOVEL'TABLE'   DBFILE                                             BUG7985
     C**********           MOVELKEY12A    DBKEY                                              BUG7985
     C                     MOVEL'SDBRCHPD'DBFILE                                             BUG7985
     C                     MOVELCVBA      DBKEY                                              BUG7985
     C                     OUT  LDA                                       S01117
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   S01117
     C                     SETON                     U7U8LR
     C                     EXSR *PSSR                                     S01117
     C                     RETRN
     C                     END
     C*
     C**Open*report*file*and*reset*page*no.****************************   E35439
     C***********                                                         E35439
     C***********          OPEN SE0935P1                                  E35439
     C***********          Z-ADD*ZEROS    PAGE                            E35439
     C***********                                                  E29170 E35439
     C***RCF*Processing*for*Detail*Printer*File********************E29170 E35439
     C***********                                                  E29170 E35439
     C***********          EXSR RCFP1                              E29170 E35439
     C*
     C   L2                END
      *
      *---------------------------------------------------------------
      *  Change of Customer processing
      *---------------------------------------------------------------
      *
     C   L1                DO
     C*
     C                     MOVE 'N'       PRTHD   1                       E35439
     C* Fetch Customer Name and address
     C/COPY WNCPYSRC,SE0935C057
     C*
     C           CVCN      CHAINCLINTCCF             33
     C  N33      RECI      COMP '*'                      33
     C           *IN33     IFEQ '1'
     C           *LOCK     IN   LDA                        ***************S01117
     C***********          MOVEL'05'      DBASE            * DB ERROR 05 *S01117
     C                     Z-ADD5         DBASE            ***************S01117
     C                     MOVEL'CLINT'   DBFILE
     C                     MOVELCVCN      DBKEY
     C                     OUT  LDA                                       S01117
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   S01117
     C                     SETON                     U7U8LR
     C                     EXSR *PSSR                                     S01117
     C                     RETRN
     C                     END
     C*
     C/COPY WNCPYSRC,SE0935C029
     C* Fetch Portfolio currency
     C*
     C           CVCN      CHAINCLINTSEF             33
     C  N33      RECI      COMP '*'                      33
     C           *IN33     IFEQ '1'
     C           *LOCK     IN   LDA                        ***************S01117
     C***********          MOVEL'06'      DBASE            * DB ERROR 06 *S01117
     C                     Z-ADD6         DBASE            ***************S01117
     C                     MOVEL'CLINT'   DBFILE
     C                     MOVELCVCN      DBKEY
     C                     OUT  LDA                                       S01117
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   S01117
     C                     SETON                     U7U8LR
     C                     EXSR *PSSR                                     S01117
     C                     RETRN
     C                     END
     C*
     C* Fetch currency name
     C*
     C                     MOVE *BLANKS   KEY12A 12
     C           C1PC      IFNE *BLANKS                                   E18203
     C                     MOVELC1PC      WORK4A  4
     C                     ELSE                                           E18203
     C                     MOVELBCCY      WORK4A                          E18203
     C                     END                                            E18203
      *
     C                     MOVE '1'       WORK4A
     C                     MOVEL'20'      KEY12A
     C                     MOVE WORK4A    KEY12A
     C           KEY12A    CHAINTABTG10F             33
     C  N33      RECI      COMP '*'                      33
     C           *IN33     IFEQ '1'
     C           *LOCK     IN   LDA                        ***************S01117
     C***********          MOVEL'07'      DBASE            * DB ERROR 07 *S01117
     C                     Z-ADD7         DBASE            ***************S01117
     C                     MOVEL'TABLE'   DBFILE
     C                     MOVELKEY12A    DBKEY
     C                     OUT  LDA                                       S01117
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   S01117
     C                     SETON                     U7U8LR
     C                     EXSR *PSSR                                     S01117
     C                     RETRN
     C                     END
     C/COPY WNCPYSRC,SE0935C002
     C*
     C* Remember portfolio currency decimal places, spot rate and
     C* multiply/divide indicator
     C*
     C                     Z-ADDCDP       PFCDP
     C/COPY WNCPYSRC,SE0935C119
     C                     Z-ADDSPOT      PFSPOT
     C/COPY WNCPYSRC,SE0935C003
     C                     MOVE MDIN      PFMDIN
     C*                                                                   E35677
     C*  Save portfolio name for printer file                             E35677
     C                     MOVE CCNM      PFNM   14                       E35677
     C*
     C**Print*new*page*headings****************************************   E35439
     C*
     C***********          WRITENEWPAG                                    E35439
     C***********          WRITEDHEAD1                                    E35439
     C***********          Z-ADD15        LCOUNT  30                      E35439
     C*
     C                     MOVEA*BLANKS   COR
     C                     Z-ADD*ZEROS    CPC
     C                     MOVEA*BLANKS   NMC
     C                     Z-ADD*ZEROS    NPC
     C                     MOVEA*BLANKS   ITP
     C                     MOVEA*BLANKS   ITN
     C                     Z-ADD*ZEROS    IPC
     C                     Z-ADD*ZEROS    TOHPFE
     C                     Z-ADD*ZEROS    TOTPFC
     C                     MOVEA*BLANKS   CUR
     C                     Z-ADD*ZEROS    XCR
     C*
     C   L1                END
     C/COPY WNCPYSRC,SE0935C025
     C*
     C* Read each live position for this Branch/Customer
     C*
     C           CPOSKA    SETLLCPOSNDF
     C/COPY WNCPYSRC,SE0935C073
     C                     SETOF                     34
     C           *IN34     DOWEQ'0'
     C/COPY WNCPYSRC,SE0935C074
     C           CPOSKA    READECPOSNDF                  34
     C/COPY WNCPYSRC,SE0935C058
     C                     MOVE '0'       *IN78                           071382
     C           *IN34     IFEQ '0'
     C           RECI      ANDEQ'D'
     C/COPY WNCPYSRC,SE0935C030
     C*                                                                   071382
     C** If the nominal position is zero, check if there is transaction   071382
     C** on file before print.                                            071382
     C*                                                                   071382
     C           CSNT      IFEQ 0                                         071382
     C           CSNV      ANDEQ0                                         071382
     C           CSEX      ANDEQ0                                         071382
     C                     Z-ADD0         @DATE                           071382
     C                     MOVE *BLANKS   @REF                            071382
     C                     EXSR CHKTRN                                    071382
     C                     ELSE                                           071382
     C                     MOVE '1'       *IN78                           071382
     C                     END                                            071382
     C                     END                                            071382
     C/COPY WNCPYSRC,SE0935C027
     C*                                                                   071382
     C           *IN78     IFEQ '1'                                       071382
     C*
     C* If new Branch read, open report file and reset page no.           E35439
     C*                                                                   E35439
     C           FILOPN    IFNE 'Y'                                       E35439
     C************INL2     ANDEQ'1'                                 E35439E47474
     C           CVBA      ANDNESAVBCH                                    E47474
     C*                                                                   E35439
     C                     MOVE CVBA      SAVBCH                          E47474
     C                     OPEN SE0935P1                                  E35439
     C                     Z-ADD*ZEROS    PAGE                            E35439
     C                     MOVE 'Y'       FILOPN                          E35439
     C*                                                                   E35439
     C** RCF Processing for Detail Printer File                           E35439
     C*                                                                   E35439
     C                     EXSR RCFP1                                     E35439
     C*                                                                   E35439
     C                     END                                            E35439
     C           FILOPN    IFEQ 'Y'                                       E35439
     C           PRTHD     ANDNE'Y'                                       E35439
     C           *INL1     ANDEQ'1'                                       E35439
     C* Print new page headings                                           E35439
     C/COPY WNCPYSRC,SE0935C031
     C                     WRITENEWPAG                                    E35439
     C/COPY WNCPYSRC,SE0935C032
     C                     WRITEDHEAD1                                    E35439
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,SE0935CCPG                                           S01408
     C*                                                                   S01408
     C                     Z-ADD15        LCOUNT  30                      E35439
     C/COPY WNCPYSRC,SE0935C033
     C                     MOVE 'Y'       PRTHD                           E35439
     C                     END                                            E35439
     C*                                                                   E35439
     C* Print Security holdings and related dividends and trades
     C*
     C                     EXSR CTLPRT
     C/COPY WNCPYSRC,SE0935C059
     C*
     C                     END
     C                     END
     C*
     C                     MOVE 'N'       PRTHD                           E35439
     C*                                                                   E35439
     C           FILOPN    IFEQ 'Y'                                       E35439
     C/COPY WNCPYSRC,SE0935C060
     C* Print summary for securities
     C*
     C                     EXSR PRTSUM
     C*
     C* Print heading for U1 and/or U2 processing
     C*
     C           *INU1     IFEQ '1'
     C           *INU2     OREQ '1'
     C                     WRITEDHEAD4
     C                     ADD  7         LCOUNT
     C/COPY WNCPYSRC,SE0935C075
     C                     END
     C*
     C* Print Retail/Settlement balances if Retail module present (U1 on)
     C*
     C                     EXSR RETAIL
     C*
     C* Print Money market loan/deposit details if Dealing module present
     C* (U2 on)
     C*
     C   U2                EXSR MNYMKT
     C*
     C* Print FX deals if Dealing module present (U2) on
     C*
     C   U2                EXSR FXDEAL
     C*
     C* Print totals
     C*
     C                     EXSR TOTALS
     C*
     C/COPY WNCPYSRC,SE0935C061
     C                     END                                            E35439
     C                     END                                            S01117
     CL2                   CLOSESE0935P1
     CL2                   MOVE 'N'       FILOPN                          E35439
      *
      *================================================================
      *  P R O G R A M   E N D                                        *
      *                                                               *
     CLR                   EXSR AUDIT
      *                                                               *
      *================================================================
      /EJECT                                                              071382
     C*****************************************************************   071382
     C*                                                               *   071382
     C* CHKTRN    - Subroutine to check if the position is generated  *   071382
     C*             by real transaction.                              *   071382
     C*                                                               *   071382
     C*****************************************************************   071382
     C*                                                                   071382
     C           CHKTRN    BEGSR                                          071382
     C*                                                                   071382
     C           TDPKF     SETLLTDPBT                                     071382
     C                     MOVE '0'       *IN77                           071382
     C                     MOVE '0'       *IN78                           071382
     C           *IN77     DOWEQ'0'                                       071382
     C           TDPKP     READETDPBT                    77               071382
     C           *IN77     IFEQ '0'                                       071382
     C           TRECI     IFNE '*'                                       071382
     C           TRECI     ANDNE'C'                                       071382
     C                     MOVE '1'       *IN77                           071382
     C                     MOVE '1'       *IN78                           071382
     C                     END                                            071382
     C                     END                                            071382
     C                     END                                            071382
     C                     ENDSR                                          071382
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* AUDIT S/R - performs the processing and printing of the audit *
     C*             trail                                             *
     C*                                                               *
     C*****************************************************************
     C*
     C           AUDIT     BEGSR                           *AUDIT BEGSR*
     C*
     C* Get installation Control data record 1 for title if no records
     C* read in
     C*
     C           FREQS     IFEQ *ZERO
     C           ONRQS     ANDEQ*ZERO
     C*
     C* Prepare LDA
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL*BLANK    DBLOT
     C                     MOVEL'SE0935'  DBPGM
     C                     OUT  LDA                                       S01117
     C*
     C                     EXSR ZSYSTM
     C*
     C* Error in ZSYSTM
     C*
     C           *IN99     IFEQ '1'
     C           *LOCK     IN   LDA                        ***************S01117
     C***********          MOVEL'08'      DBASE            * DB ERROR 08 *S01117
     C                     Z-ADD8         DBASE            ***************S01117
     C                     MOVEL'TABLE'   DBFILE
     C                     MOVELZTABKY    DBKEY
     C                     OUT  LDA                                       S01117
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   S01117
     C                     SETON                     U7U8LR
     C                     EXSR *PSSR                                     S01117
     C                     RETRN
     C                     END
     C*
     C                     END
     C*
     C**Fetch*no*of*frequency-basis*records*                              S01117
     C***********                                                         S01117
     C***********          MOVE 'D'       KEY1A   1                       S01117
     C***********KEY1A     CHAINCVALSAF              33                   S01117
     C************IN33     IFEQ '1'                        ***************S01117
     C***********          MOVEL'09'      DBASE            **DB*ERROR*09**S01117
     C***********          MOVEL'AUDIT'   DBFILE           ***************S01117
     C***********          MOVELKEY1A     DBKEY                           S01117
     C***********          WRITEHEADAU                                    S01117
     C***********          WRITEERROR                                     S01117
     C***********          WRITETRAILAU                                   S01117
     C***********          SETON                     U7U8LR               S01117
     C***********          EXSR *PSSR                                     S01117
     C***********          RETRN                                          S01117
     C***********          END                                            S01117
     C***********                                                         S01117
     C**Compare*with*total*counted*and*output*error*if*different*         S01117
     C***********                                                         S01117
     C***********          Z-ADDNORE      FREQF                           S01117
     C***********FREQF     IFNE FREQS                                     S01117
     C***********          SETON                     56U8                 S01117
     C***********          END                                            S01117
     C                     MOVE KEY1A     KEY1A   1                       S01117
     C*
     C* Fetch no of on request-basis records
     C*
     C           ONRQS     IFNE 0
     C                     MOVE 'A'       KEY1A
     C           KEY1A     CHAINCVALSAF              33
     C           *IN33     IFEQ '1'
     C           *LOCK     IN   LDA                        ***************S01117
     C***********          MOVEL'10'      DBASE            * DB ERROR 10 *S01117
     C                     Z-ADD10        DBASE            ***************S01117
     C                     MOVEL'AUDIT'   DBFILE
     C                     MOVELKEY1A     DBKEY
     C                     OUT  LDA                                       S01117
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   S01117
     C                     SETON                     U7U8LR
     C                     EXSR *PSSR                                     S01117
     C                     RETRN
     C                     END
     C*
      ** Update number of live records on file as RECIs have been         S01117
      ** changed to '*'                                                   S01117
      *                                                                   S01117
     C                     SUB  ONRQS     NORE                            S01117
     C                     UPDATCVALSAF                                   S01117
      *                                                                   S01117
     C**Compare*with*total*counted*and*output*error*if*different*         S01117
     C***********                                                         S01117
     C***********          Z-ADDNORE      ONRQF                           S01117
     C***********ONRQF     IFNE ONRQS                                     S01117
     C***********          SETON                     57U8                 S01117
     C***********          END                                            S01117
     C                     END
     C*
     C* Print audit report
     C*
     C                     WRITEHEADAU
     C                     WRITEDETLAU
     C***********          WRITETRAILAU                                   S01117
     C*                                                                   E31197
     C** If no records read then print 'No Details' on                    E31197
     C** Audit Printer File                                               E31197
     C*                                                                   E31197
     C           FREQS     IFEQ *ZERO                                     E31197
     C           ONRQS     ANDEQ*ZERO                                     E31197
     C                     WRITENONE                                      E31197
     C                     END                                            E31197
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* CTLPRT S/R - controls the printing of the security            *
     C*              holdings and related dividends and trades        *
     C*                                                               *
     C*****************************************************************
     C*
     C           CTLPRT    BEGSR                           *CTLPRT BEGSR*
     C*
     C                     SETOF                     52
     C                     Z-ADD*ZEROS    DAYS
     C*
     C* Fetch security details
     C*
     C           CSSC      CHAINSECTYDF              33
     C  N33      RECI      COMP '*'                      33
     C           *IN33     IFEQ '1'
     C           *LOCK     IN   LDA                        ***************S01117
     C***********          MOVEL'11'      DBASE            * DB ERROR 11 *S01117
     C                     Z-ADD11        DBASE            ***************S01117
     C                     MOVEL'SECTY'   DBFILE
     C                     MOVELCSSC      DBKEY
     C                     OUT  LDA                                       S01117
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   S01117
     C                     SETON                     U7U8LR
     C                     EXSR *PSSR                                     S01117
     C                     RETRN
     C                     END
     C*                                                                   S01232
     C*    Set up indicator for Australian yields                         S01232
     C*                                                                   S01232
     C           STBS      IFEQ 'Y'                                       S01232
     C           SYBS      ANDEQ'AU'                                      S01232
     C                     SETON                     41                   S01232
     C                     ELSE                                           S01232
     C                     SETOF                     41                   S01232
     C                     END                                            S01232
     C*
     C* Fetch and remember nominal currency decimal places, spot rate and
     C* multiply/divide indicator
     C*
     C                     MOVE *BLANKS   KEY12A 12
     C                     MOVELNMCY      WORK4A  4
     C                     MOVE '1'       WORK4A
     C                     MOVEL'20'      KEY12A
     C                     MOVE WORK4A    KEY12A
     C           KEY12A    CHAINTABTG10F             33
     C  N33      RECI      COMP '*'                      33
     C           *IN33     IFEQ '1'
     C           *LOCK     IN   LDA                        ***************S01117
     C***********          MOVEL'12'      DBASE            * DB ERROR 12 *S01117
     C                     Z-ADD12        DBASE            ***************S01117
     C                     MOVEL'TABLE'   DBFILE
     C                     MOVELKEY12A    DBKEY
     C                     OUT  LDA                                       S01117
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   S01117
     C                     SETON                     U7U8LR
     C                     EXSR *PSSR                                     S01117
     C                     RETRN
     C                     END
     C/COPY WNCPYSRC,SE0935C004
     C                     Z-ADDCDP       NMCDP
     C/COPY WNCPYSRC,SE0935C120
     C                     Z-ADDCDP       NCDP                            S01232
     C                     Z-ADDSPOT      NMSPOT
     C/COPY WNCPYSRC,SE0935C005
     C                     MOVE MDIN      NMMDIN
     C*
     C* Fetch investment type
     C*
     C           INVKA     CHAININVTPDF              33
     C  N33      RECI      COMP '*'                      33
     C           *IN33     IFEQ '1'
     C           *LOCK     IN   LDA                        ***************S01117
     C***********          MOVEL'13'      DBASE            * DB ERROR 13 *S01117
     C                     Z-ADD13        DBASE            ***************S01117
     C                     MOVEL'INVTP'   DBFILE
     C                     MOVELNMCY      WORK6A  6
     C                     MOVE SITP      WORK6A
     C                     MOVELWORK6A    DBKEY
     C                     OUT  LDA                                       S01117
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   S01117
     C                     SETON                     U7U8LR
     C                     EXSR *PSSR                                     S01117
     C                     RETRN
     C                     END
     C*
     C* if Security is interest-bearing
     C*
     C           PROT      IFEQ '1'
     C           PROT      OREQ '3'
     C           PROT      OREQ '5'
     C           PROT      OREQ '6'
     C           PROT      OREQ '8'
     C           PROT      OREQ '9'                                       S01176
     C*
     C* and day basis is not 4
     C*
     C           DYBS      IFNE '4'
     C*
     C* Calculate accrued interest for customer position
     C/COPY WNCPYSRC,SE0935C090
     C*
     C                     UNLCKLDA
     C                     MOVE 'A'       ZAB
     C                     CALL 'ZACCRC'
     C                     PARM           LCPN
     C                     PARM           ACRCD
     C************         PARM           CVBR                            S01117
     C                     PARM           CVBA                            S01117
     C***********          PARM           CVCN                            E37297
     C                     PARM           ZCUST                           E37297
     C                     PARM           CSSC
     C                     PARM           CDP
     C                     PARM           ACRINT 150
     C                     PARM           ZAB     1
     C/COPY WNCPYSRC,SE0935C091
     C*
     C           *INU7     IFEQ '1'
     C           *INU8     OREQ '1'                                       E20887
     C           *LOCK     IN   LDA                        ***************S01117
     C***********          MOVEL'26'      DBASE            * DB ERROR 26 *S01117
     C                     Z-ADD26        DBASE            ***************S01117
     C                     MOVEL'ZACCRC'  DBPGM
     C                     OUT  LDA                                       S01117
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   S01117
     C                     SETON                     LR
     C                     EXSR *PSSR                                     S01117
     C                     RETRN
     C                     END
     C*
     C                     FREE 'ZACCRC'
     C           *LOCK     IN   LDA
     C                     MOVEL'SE0935'  DBPGM
     C                     OUT  LDA                                       S01117
     C*
     C                     SETON                     52
     C*
     C                     END
     C                     END
     C*
     C* Print holding details
     C*
     C                     EXSR PRTHLD
     C*
     C* Store Currency and cross rate if not already there
     C*
     C                     Z-ADD1         X
     C           NMCY      LOKUPCUR,X                    33
     C           *IN33     IFEQ '0'
     C                     Z-ADD1         X
     C           '   '     LOKUPCUR,X                    33
     C                     MOVE NMCY      CUR,X
     C                     Z-ADDZRATEX    XCR,X
     C                     END
     C*
     C* Dividends due - For each diary dividend record
     C*
     C********** DEVKA     SETLLSEDEVDF                                   S01232
     C           DEVKA     SETLLSEDEVET                                   S01232
     C                     SETOF                     35
     C           *IN35     DOWEQ'0'
     C********** DEVKA     READESEDEVDF                  35               S01232
     C           DEVKA     READESEDEVET                  35               S01232
     C           *IN35     IFEQ '0'
     C*
     C* Where event date is not before rundate
     C*
     C           SDED      IFGE RUND
     C*
     C* but not '99999'
     C*
     C           SDED      ANDNE99999
     C*
     C* Print dividend details
     C*
     C                     EXSR PRTDIV
     C                     END
     C*
     C                     END
     C                     END
     C*
     C* If Value date basis valuations
     C*
     C           TVVL      IFEQ 'V'
     C*
     C* For each trade for this Branch/Customer/Security
     C*
     C           TRDKA     SETLLTRDBV
     C                     SETOF                     36
     C           *IN36     DOWEQ'0'
     C           TRDKA     READETRDBV                    36
     C           *IN36     IFEQ '0'
     C*                                                                   S01269
     C* If record id (LF/TRDBV) is not 'L' or 'P'                         S01269
     C*                                                                   S01269
     C           RECI      IFNE 'L'                                       S01269
     C           RECI      ANDNE'P'                                       S01269
     C*
     C* Print trade details
     C* Only for trades with value date greater than run date.            E16093
     C*
     C           TDVD      IFGT RUND                                      E16093
     C/COPY WNCPYSRC,SE0935C115
     C                     EXSR PRTFVT
     C                     END                                            E16093
     C*                                                                   S01269
     C                     END                                            S01269
     C*                                                                   E16093
     C                     END
     C                     END
     C*
     C                     END
     C/COPY WNCPYSRC,SE0935C062
     C*
     C* Accumulate portfolio currency
     C*
     C                     ADD  MKVPFC    TOTPFC 150
     C*
     C* Accumulate market values in portfolio currency
     C*
     C* per country of risk
     C*
     C                     Z-ADD1         X       20
     C           SCOR      LOKUPCOR,X                    33
     C           *IN33     IFEQ '0'
     C           *ZEROS    LOKUPCPC,X                    33
     C                     MOVE SCOR      COR,X
     C                     Z-ADDMKVPFC    CPC,X
     C/COPY WNCPYSRC,SE0935C107
     C                     ELSE
     C                     ADD  MKVPFC    CPC,X
     C/COPY WNCPYSRC,SE0935C108
     C                     END
     C*
     C* per nominal currency
     C*
     C                     Z-ADD1         X
     C           NMCY      LOKUPNMC,X                    33
     C           *IN33     IFEQ '0'
     C           *ZEROS    LOKUPNPC,X                    33
     C                     MOVE NMCY      NMC,X
     C                     Z-ADDMKVPFC    NPC,X
     C/COPY WNCPYSRC,SE0935C109
     C                     ELSE
     C                     ADD  MKVPFC    NPC,X
     C/COPY WNCPYSRC,SE0935C110
     C                     END
     C*
     C* per investment type
     C*
     C                     Z-ADD1         X
     C           SITP      LOKUPITP,X                    33
     C           *IN33     IFEQ '0'
     C           *ZEROS    LOKUPIPC,X                    33
     C                     MOVE SITP      ITP,X
     C                     Z-ADDMKVPFC    IPC,X
     C                     MOVE NMCY      ITN,X
     C/COPY WNCPYSRC,SE0935C111
     C                     ELSE
     C                     ADD  MKVPFC    IPC,X
     C/COPY WNCPYSRC,SE0935C112
     C                     END
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* FXDEAL S/R - prints FX deals                                  *
     C*                                                               *
     C*****************************************************************
     C*
     C           FXDEAL    BEGSR                           *FXDEAL BEGSR*
     C*
     C* Read deals and print live records
     C*
     C           CPOSKA    SETLLDEALSDBF
     C/COPY WNCPYSRC,SE0935C084
     C                     SETOF                     33
     C           *IN33     DOWEQ'0'
     C           CPOSKA    READEDEALSDBF                 33
     C/COPY WNCPYSRC,SE0935C085
     C           *IN33     IFEQ '0'
     C           RECI      ANDEQ'D'
     C*
     C* Fetch Sale currency decimal places
     C*
     C                     MOVE *BLANKS   KEY12A 12
     C                     MOVELSLCY      WORK4A  4
     C                     MOVE '1'       WORK4A
     C                     MOVEL'20'      KEY12A
     C                     MOVE WORK4A    KEY12A
     C           KEY12A    CHAINTABTG10F             34
     C  N34      RECI      COMP '*'                      34
     C           *IN34     IFEQ '1'
     C           *LOCK     IN   LDA                        ***************S01117
     C***********          MOVEL'14'      DBASE            * DB ERROR 14 *S01117
     C                     Z-ADD14        DBASE            ***************S01117
     C                     MOVEL'TABLE'   DBFILE
     C                     MOVELKEY12A    DBKEY
     C                     OUT  LDA                                       S01117
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   S01117
     C                     SETON                     U7U8LR
     C                     EXSR *PSSR                                     S01117
     C                     RETRN
     C                     END
     C/COPY WNCPYSRC,SE0935C006
     C*
     C* Format Sale amount for printing
     C*
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE SLAM      ZFLD15
     C/COPY WNCPYSRC,SE0935C121
     C                     Z-ADDCDP       ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SLBAL
     C*
     C* Value date
     C*
     C                     Z-ADDVDAT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    VALDAT
     C*
     C* Rate
     C*
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE EXRT      ZFLD15
     C                     Z-ADD8         ZDECS
     C                     MOVE 'L'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    EXRATE
     C*
     C* Fetch Purchase currency decimal places
     C*
     C                     MOVE *BLANKS   KEY12A 12
     C                     MOVELPUCY      WORK4A  4
     C                     MOVE '1'       WORK4A
     C                     MOVEL'20'      KEY12A
     C                     MOVE WORK4A    KEY12A
     C           KEY12A    CHAINTABTG10F             34
     C  N34      RECI      COMP '*'                      34
     C           *IN34     IFEQ '1'
     C           *LOCK     IN   LDA                        ***************S01117
     C***********          MOVEL'15'      DBASE            * DB ERROR 15 *S01117
     C                     Z-ADD15        DBASE            ***************S01117
     C                     MOVEL'TABLE'   DBFILE
     C                     MOVELKEY12A    DBKEY
     C                     OUT  LDA                                       S01117
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   S01117
     C                     SETON                     U7U8LR
     C                     EXSR *PSSR                                     S01117
     C                     RETRN
     C                     END
     C/COPY WNCPYSRC,SE0935C007
     C*
     C* Purchase amount
     C*
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE PUAM      ZFLD15
     C/COPY WNCPYSRC,SE0935C122
     C                     Z-ADDCDP       ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    PCHAMT
     C*
     C/COPY WNCPYSRC,SE0935C104
     C* Check overflow
     C*
     C********** LCOUNT    IFGE 55                                        E15776
     C           LCOUNT    IFGE 51                                        E15776
     C/COPY WNCPYSRC,SE0935C034
     C                     WRITENEWPAG
     C                     WRITEDHEAD4
     C/COPY WNCPYSRC,SE0935C035
     C                     Z-ADD16        LCOUNT
     C/COPY WNCPYSRC,SE0935C036
     C                     END
     C*
     C* Print detail line
     C*
     C/COPY WNCPYSRC,SE0935C094
     C                     WRITEFXDET
     C/COPY WNCPYSRC,SE0935C095
     C                     ADD  1         LCOUNT
     C/COPY WNCPYSRC,SE0935C116
     C*
     C                     END
     C                     END
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* MNYMKT S/R prints Money market loans and deposits             *
     C*                                                               *
     C*****************************************************************
     C*
     C           MNYMKT    BEGSR                           *MNYMKT BEGSR*
     C*
     C* Fetch valid deals
     C*
     C           CPOSKA    SETLLDEALSDCF
     C/COPY WNCPYSRC,SE0935C086
     C                     SETOF                     33
     C           *IN33     DOWEQ'0'
     C           CPOSKA    READEDEALSDCF                 33
     C/COPY WNCPYSRC,SE0935C087
     C           *IN33     IFEQ '0'
     C           RECI      ANDEQ'D'
     C           VDAT      ANDLEECD
     C*
     C* Calculate accrued interest - zero if accrual date from file
     C* greater than calculated
     C*
     C           IACD      IFGT ACRCD
     C                     Z-ADD*ZEROS    ACINTR 150
     C                     ELSE
     C*
     C                     Z-ADDPCPL      ZIAMT
     C                     Z-ADDINTR      ZIRATE
     C                     Z-ADDIACD      ZIBEG
     C           MDAT      IFEQ *ZEROS
     C           MDAT      ORGT ACRCD
     C                     Z-ADDACRCD     ZIEND
     C                     ELSE
     C                     Z-ADDMDAT      ZIEND
     C                     END
     C                     MOVE ICBS      ZICALC
     C                     EXSR GLINTC
     C           ZINTR     DIV  1         WK13N  130H
     C                     ADD  AITC      WK13N
     C                     ADD  AIAN      WK13N
     C                     ADD  AIAP      WK13N
     C                     END
     C*
     C* Fetch description
     C*
     C           DTYP      LOKUPTABTYP    TABDSC         34
     C                     MOVE TABDSC    DTDESC
     C*
     C* Fetch Deal currency decimal places
     C*
     C                     MOVE *BLANKS   KEY12A 12
     C                     MOVELCCY       WORK4A  4
     C                     MOVE '1'       WORK4A
     C                     MOVEL'20'      KEY12A
     C                     MOVE WORK4A    KEY12A
     C           KEY12A    CHAINTABTG10F             34
     C  N34      RECI      COMP '*'                      34
     C           *IN34     IFEQ '1'
     C           *LOCK     IN   LDA                        ***************S01117
     C***********          MOVEL'16'      DBASE            * DB ERROR 16 *S01117
     C                     Z-ADD16        DBASE            ***************S01117
     C                     MOVEL'TABLE'   DBFILE
     C                     MOVELKEY12A    DBKEY
     C                     OUT  LDA                                       S01117
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   S01117
     C                     SETON                     U7U8LR
     C                     EXSR *PSSR                                     S01117
     C                     RETRN
     C                     END
     C/COPY WNCPYSRC,SE0935C008
     C*
     C* Format numeric fields for printing
     C*
     C* Balance
     C*
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE PCPL      ZFLD15
     C/COPY WNCPYSRC,SE0935C123
     C                     Z-ADDCDP       ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    PCPLBL
     C*
     C/COPY WNCPYSRC,SE0935C092
     C* Accrued interest
     C*
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE WK13N     ZFLD15
     C/COPY WNCPYSRC,SE0935C124
     C                     Z-ADDCDP       ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    TACRI
     C*
     C* Total balance
     C*
     C           PCPL      ADD  WK13N     TOTALB 150
     C           DTYP      IFEQ 'IP'
     C           DTYP      OREQ 'TI'
     C           DTYP      OREQ 'CL'
     C           DTYP      OREQ 'DL'
     C                     Z-SUBTOTALB    TOTALB
     C                     END
     C*
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE TOTALB    ZFLD15
     C/COPY WNCPYSRC,SE0935C125
     C                     Z-ADDCDP       ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    TOTBAL
     C*
     C* Convert to Porfolio currency
     C*
     C                     Z-ADDSPOT      ZRATE1
     C                     MOVE MDIN      ZMDI1
     C                     Z-ADDPFSPOT    ZRATE2
     C                     MOVE PFMDIN    ZMDI2
     C                     EXSR ZXRATE
     C*
     C                     MOVE TOTALB    ZAMTCI
     C/COPY WNCPYSRC,SE0935C093
     C                     Z-ADDZRATEX    ZEXCH
     C           ZMDIX     IFEQ '0'
     C                     MOVE 'D'       ZMD
     C                     ELSE
     C                     MOVE 'M'       ZMD
     C                     END
     C                     MOVE CCY       ZCCYI
     C                     MOVE C1PC      ZCCYO
     C* Set up currency decimal places for Deal currency and Portfolio    S01117
     C* currency to be used in ZCONV                                      S01117
     C                     Z-ADDCDP       ZCDPI                           S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   KEY12A 12                       S01117
     C           C1PC      IFNE *BLANKS                                   102754
     C                     MOVELC1PC      WORK4A  4                       S01117
     C                     ELSE                                           102754
     C                     MOVELBCCY      WORK4A                          102754
     C                     END                                            102754
     C                     MOVE '1'       WORK4A                          S01117
     C                     MOVEL'20'      KEY12A                          S01117
     C                     MOVE WORK4A    KEY12A                          S01117
     C           KEY12A    CHAINTABTG10F             34                   S01117
     C  N34      RECI      COMP '*'                      34               S01117
     C           *IN34     IFEQ '1'                        ***************S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     Z-ADD17        DBASE                           S01117
     C                     MOVEL'TABLE'   DBFILE           ***************S01117
     C                     MOVELKEY12A    DBKEY                           S01117
     C                     OUT  LDA                                       S01117
     C                     WRITEHEADAU                                    S01117
     C                     WRITEERROR                                     S01117
     C                     SETON                     U7U8LR               S01117
     C                     EXSR *PSSR                                     S01117
     C                     RETRN                                          S01117
     C                     END                                            S01117
     C/COPY WNCPYSRC,SE0935C009
     C* Save portfolio ccy.decimal places for later use                   S01117
     C***********          Z-ADDCDP       @WRK1   10               S01117 E35419
     C                     Z-ADDCDP       ZCDPO                           S01117
     C                     EXSR ZCONV
     C*
     C************INU7     IFEQ '1'                                       S01117
     C************INU8     OREQ '1'                        ***************S01117
     C***********          MOVEL'17'      DBASE            **DB*ERROR*17**S01117
     C***********          MOVEL'TABLE'   DBFILE           ***************S01117
     C***********          MOVELTKEY      DBKEY                           S01117
     C***********          WRITEHEADAU                                    S01117
     C***********          WRITEERROR                                     S01117
     C***********          WRITETRAILAU                                   S01117
     C***********          SETON                     LR                   S01117
     C***********          RETRN                                          S01117
     C***********          END                                            S01117
     C*
     C* Format for printing
     C*
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE ZAMTCO    ZFLD15
     C/COPY WNCPYSRC,SE0935C126
     C                     Z-ADDPFCDP     ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    TBLPFE
     C*
     C* Accumulate total
     C*
     C                     ADD  ZAMTCO    TOHPFE 150
     C*
     C* From date
     C*
     C                     Z-ADDVDAT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    VALDAT
     C*
     C* To date (if there)
     C*
     C                     SETOF                     55
     C           MDAT      IFNE *ZEROS
     C                     Z-ADDMDAT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    MATDAT
     C                     SETON                     55
     C                     END
     C*
     C* At (Rate)
     C*
     C                     TESTB'1'       DSTI           34
     C           *IN34     IFEQ '1'
     C                     Z-SUBINTR      INTR
     C                     END
     C*
     C* Format for printing
     C*
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE INTR      ZFLD15
     C                     Z-ADD7         ZDECS
     C                     MOVE 'L'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    INTRAT
     C*
     C* Check overflow
     C*
     C********** LCOUNT    IFGE 55                                        E15776
     C/COPY WNCPYSRC,SE0935C037
     C           LCOUNT    IFGE 51                                        E15776
     C                     WRITENEWPAG
     C/COPY WNCPYSRC,SE0935C038
     C                     WRITEDHEAD4
     C                     Z-ADD16        LCOUNT
     C/COPY WNCPYSRC,SE0935C039
     C                     END
     C*
     C* Print detail line
     C*
     C/COPY WNCPYSRC,SE0935C096
     C                     WRITEMMLDET
     C/COPY WNCPYSRC,SE0935C097
     C                     ADD  4         LCOUNT
     C*
     C* Store Currency and cross rate if not already there
     C*
     C                     Z-ADD1         X
     C           CCY       LOKUPCUR,X                    34
     C           *IN34     IFEQ '0'
     C                     Z-ADD1         X
     C           '   '     LOKUPCUR,X                    34
     C                     MOVE CCY       CUR,X
     C                     Z-ADDZRATEX    XCR,X
     C                     END
     C*
     C                     END
     C                     END
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* PRTDIV sr prints dividend details                             *
     C*                                                               *
     C*****************************************************************
     C*
     C           PRTDIV    BEGSR                           *PRTDIV BEGSR*
     C*
     C* Calculate dividend due
     C*
     C***********CSNV      MULT SDDV      DIVDUE 150H                     E16772
     C***********CSNV      MULT SDVA      DIVDUE 150H              E16772 101516
     C***********                                                         101516
     C**Price*basis*'P'*********                                          101516
     C***********                                                         101516
     C***********SPBS      IFEQ 'P'                                       101516
     C***********DIVDUE    DIV  100       DIVDUE                          101516
     C***********          END                                            101516
     C*                                                                   101516
     C           S01510    IFEQ 'Y'                                       101516
     C           CPOSKH    SETGTCPOSHF                                    101516
     C           CPOSKL    REDPECPOSHF                   37               101516
     C           *IN37     IFEQ '0'                                       101516
     C                     Z-ADDCSNT      ZNOML                           101516
     C                     ELSE                                           101516
     C                     Z-ADD0         ZNOML                           101516
     C                     END                                            101516
     C                     ELSE                                           101516
     C           CSNT      SUB  CSEX      ZNOML                           101516
     C                     END                                            101516
     C*                                                                   101516
     C* If S01509 is on amount is in value ccy                            101516
     C*                                                                   101516
     C           S01509    IFEQ 'Y'                                       101516
     C           VLCY      ANDNENMCY                                      101516
     C                     MOVE *BLANKS   KEY12A 12                       101516
     C                     MOVELVLCY      WORK4A  4                       101516
     C                     MOVE '1'       WORK4A                          101516
     C                     MOVEL'20'      KEY12A                          101516
     C                     MOVE WORK4A    KEY12A                          101516
     C           KEY12A    CHAINTABTG10F             33                   101516
     C  N33      RECI      COMP '*'                      33               101516
     C           *IN33     IFEQ '1'                                       101516
     C           *LOCK     IN   LDA                                       101516
     C                     Z-ADD26        DBASE            ***************101516
     C                     MOVEL'TABLE'   DBFILE           * DB ERROR 26 *101516
     C                     MOVELKEY12A    DBKEY            ***************101516
     C                     OUT  LDA                                       101516
     C                     WRITEHEADAU                                    101516
     C                     WRITEERROR                                     101516
     C                     SETON                     U7U8LR               101516
     C                     EXSR *PSSR                                     101516
     C                     RETRN                                          101516
     C                     END                                            101516
     C/COPY WNCPYSRC,SE0935C010
     C                     Z-ADDCDP       ZCDP                            101516
     C                     SETON                     54                   101516
     C                     ELSE                                           101516
     C                     SETOF                     54                   101516
     C                     Z-ADDNMCDP     ZCDP                            101516
     C                     END                                            101516
     C                     Z-ADDSDVA      ZPRC                            101516
     C                     EXSR ZCNSD                                     101516
     C/COPY WNCPYSRC,SE0935C011
     C*                                                                   101516
     C* Format div  amount for printing                                   101516
     C*                                                                   101516
     C                     MOVE *BLANKS   ZFLD15                          101516
     C                     MOVE ZCONS     ZFLD15                          101516
     C                     Z-ADDZCDP      ZDECS                           101516
     C                     MOVE 'J'       ZECODE                          101516
     C                     EXSR ZSEDIT                                    101516
     C                     MOVE ZOUT21    DIVDUE                          101516
     C*
     C* Format Event date for printing
     C*
     C                     Z-ADDSDED      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    DTDECL
     C*
     C* Check overflow
     C*
     C********** LCOUNT    IFGE 55                                        E15776
     C/COPY WNCPYSRC,SE0935C040
     C           LCOUNT    IFGE 51                                        E15776
     C/COPY WNCPYSRC,SE0935C105
     C                     WRITENEWPAG
     C                     WRITEDHEAD1
     C/COPY WNCPYSRC,SE0935C041
     C                     Z-ADD14        LCOUNT
     C/COPY WNCPYSRC,SE0935C076
     C                     END
     C*
     C* Print dividend details
     C*
     C/COPY WNCPYSRC,SE0935C098
     C                     WRITEDIVDND
     C/COPY WNCPYSRC,SE0935C099
     C                     ADD  1         LCOUNT
     C*
     C/COPY WNCPYSRC,SE0935C063
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* PRTFVT sr prints forward-value trade details                  *
     C*                                                               *
     C*****************************************************************
     C*
     C           PRTFVT    BEGSR                           *PRTFVT BEGSR*
     C*
     C                     SETOF                     5354
     C*
     C* Fetch trade type description (from customer's viewpoint)
     C*
     C           TDTP      IFEQ 'TS'
     C                     MOVE 'PURCHASE'CUSTYP
     C                     ELSE
     C           TDTP      IFEQ 'TP'
     C                     MOVE 'SALE    'CUSTYP
     C                     END
     C                     END
     C*
     C* Format Nominal amount for printing
     C*
     C/COPY WNCPYSRC,SE0935C012
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE NOML      ZFLD15
     C                     Z-ADDNMDP      ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    NOMAMT
     C*
     C* Format value date for printing
     C*
     C                     Z-ADDTDVD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    VALDAT
     C*
     C* Format trade price as Price/Discount/Yield
     C*
     C                     EXSR ZNCD
     C                     Z-ADDPRIC      ZPRICE
     C                     Z-ADDTDVD      ZFDATE
     C*                                                                   S01232
     C*      Set up parameters for Australian yield securities            S01232
     C*                                                                   S01232
     C           *IN41     IFEQ '1'                                       S01232
     C           NOML      ANDNE0                                         E20953
     C           ITRA      DIV  NOML      WRKPI                           S01232
     C***********          Z-ADDTDVD      WRKD    50               S01232 E20953
     C***********          EXSR ZYCE                               S01232 E20953
     C*                                                                   S01232
     C***********IF*EX-COUPON*THEN*PI*PASSED*IS*THE*REMAINING*INTEREST*   E20953
     C***********TILL*NCD*AND*IS*NEGATIVE**************************S01232 E20953
     C*                                                                   S01232
     C***********SCUMEX    IFEQ 'X'                                S01232 E20953
     C***********          Z-ADDLCPN      ZDCSDT                   S01232 E20953
     C***********          Z-ADDNCD       ZDCEDT                   S01232 E20953
     C                     Z-ADDCDP       ZCDP                            S01117
     C***********          EXSR ZACCZ                              S01232 E20953
     C***30******ZDCINT    DIV  CSNT      WKWPI  159               S01232 E20953
     C**N30******ZDCINT    DIV  CSNV      WKWPI                    S01232 E20953
     C***********WRKPI     SUB  WKWPI     WRKPI                    S01232 E20953
     C***********          END                                     S01232 E20953
     C                     ELSE                                           S01232
     C***********          MOVE 'C'       SCUMEX                   S01232 E20953
     C                     Z-ADD0         WRKPI                           S01232
     C                     END                                            S01232
     C                     MOVE ACIN      SCUMEX                          E20953
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0935CCP2                                           S01408
     C*                                                                   S01408
     C   30                Z-ADDCSNT      ZNOML                           E39495
     C  N30                Z-ADDCSNV      ZNOML                           E39495
     C*                                                                   S01232
     C                     EXSR ZPRCO
     C/COPY WNCPYSRC,SE0935C022
     C                     Z-ADDZPRCOT    FWDPRC
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0935CCP3                                           S01408
     C*                                                                   S01408
     C*
     C* Price basis '%'
     C*
     C           SPBS      COMP 'P'                      53
     C*
     C**if*value*currency*is*not*blank*and*different*to*nominal*currency**101516
     C***********                                                         101516
     C***********VLCY      IFNE '   '                                     101516
     C***********VLCY      ANDNENMCY                                      101516
     C***********          SETON                     54                   101516
     C***********                                                         101516
     C**output*value*type*********                                        101516
     C***********                                                         101516
     C***********TDTP      IFEQ 'TS'                                      101516
     C***********          MOVE 'WORTH'   VALTYP                          101516
     C***********          ELSE                                           101516
     C***********TDTP      IFEQ 'TP'                                      101516
     C***********          MOVE 'COST '   VALTYP                          101516
     C***********          END                                            101516
     C***********          END                                            101516
     C***********                                                         101516
     C**Convert*Countervalue*to*value*currency*************               101516
     C***********                                                         101516
     C***********          MOVE TCTR      ZAMTCI                          101516
     C***********          Z-ADDSEXR      ZEXCH                           101516
     C***********          MOVE SMDI      ZMD                             101516
     C***********          MOVE NMCY      ZCCYI                           101516
     C***********          MOVE VLCY      ZCCYO                           101516
     C***********                                                  S01117 101516
     C**Set*up*currency*decimal*places*for*Nominal*ccy*and*Value***S01117 101516
     C**currency,*to*be*used*in*ZCONV***************               S01117 101516
     C***********                                                  S01117 101516
     C***********          Z-ADDNMCDP     ZCDPI                    S01117 101516
     C***********                                                  S01117 101516
     C***********          MOVE *BLANKS   KEY12A 12                S01117 101516
     C***********          MOVELVLCY      WORK4A  4                S01117 101516
     C***********          MOVE '1'       WORK4A                   S01117 101516
     C***********          MOVEL'20'      KEY12A                   S01117 101516
     C***********          MOVE WORK4A    KEY12A                   S01117 101516
     C***********KEY12A    CHAINTABTG10F             34            S01117 101516
     C**N34******RECI      COMP '*'                      34        S01117 101516
     C************IN34     IFEQ '1'                        ********S01117 101516
     C************LOCK     IN   LDA                                S01117 101516
     C***********          Z-ADD18        DBASE                    S01117 101516
     C***********          MOVEL'TABLE'   DBFILE                   S01117 101516
     C***********          MOVELKEY12A    DBKEY                    S01117 101516
     C***********          OUT  LDA                                S01117 101516
     C***********          WRITEHEADAU                             S01117 101516
     C***********          WRITEERROR                              S01117 101516
     C***********          SETON                     U7U8LR        S01117 101516
     C***********          EXSR *PSSR                              S01117 101516
     C***********          RETRN                                   S01117 101516
     C***********          END                                     S01117 101516
     C***********          Z-ADDCDP       ZCDPO                    S01117 101516
     C***********          EXSR ZCONV                                     101516
     C***********                                                         101516
     C************INU7     IFEQ '1'                                       S01117
     C************INU8     OREQ '1'                        ***************S01117
     C***********          MOVEL'18'      DBASE            **DB*ERROR*18**S01117
     C***********          MOVEL'TABLE'   DBFILE           ***************S01117
     C***********          MOVELTKEY      DBKEY                           S01117
     C***********          WRITEHEADAU                                    S01117
     C***********          WRITEERROR                                     S01117
     C***********          WRITETRAILAU                                   S01117
     C***********          SETON                     LR                   S01117
     C***********          RETRN                                          S01117
     C***********          END                                            S01117
     C*
     C**Fetch*value*currency*decimal*places****************************   S01117
     C***********                                                         S01117
     C***********          MOVE *BLANKS   KEY12A 12                       S01117
     C***********          MOVELVLCY      WORK4A  4                       S01117
     C***********          MOVE '1'       WORK4A                          S01117
     C***********          MOVEL'20'      KEY12A                          S01117
     C***********          MOVE WORK4A    KEY12A                          S01117
     C***********KEY12A    CHAINTABTG10F             33                   S01117
     C**N33******RECI      COMP '*'                      33               S01117
     C************IN33     IFEQ '1'                        ***************S01117
     C***********          MOVEL'19'      DBASE            **DB*ERROR*19**S01117
     C***********          MOVEL'TABLE'   DBFILE           ***************S01117
     C***********          MOVELKEY12A    DBKEY                           S01117
     C***********          WRITEHEADAU                                    S01117
     C***********          WRITEERROR                                     S01117
     C***********          WRITETRAILAU                                   S01117
     C***********          SETON                     U7U8LR               S01117
     C***********          RETRN                                          S01117
     C***********          END                                            S01117
     C***********                                                         101516
     C**Format*result for printing                                        101516
     C***********                                                         101516
     C***********          MOVE *BLANKS   ZFLD15                          101516
     C***********          MOVE ZAMTCO    ZFLD15                          101516
     C***********          Z-ADDCDP       ZDECS                           101516
     C***********          MOVE 'J'       ZECODE                          101516
     C***********          EXSR ZSEDIT                                    101516
     C***********          MOVE ZOUT21    CVALUE                          101516
     C***********                                                         101516
     C***********          END                                            101516
     C*
     C* Check overflow
     C*
     C********** LCOUNT    IFGE 55                                        E15776
     C/COPY WNCPYSRC,SE0935C042
     C           LCOUNT    IFGE 51                                        E15776
     C                     WRITENEWPAG
     C                     WRITEDHEAD1
     C/COPY WNCPYSRC,SE0935C043
     C                     Z-ADD14        LCOUNT
     C/COPY WNCPYSRC,SE0935C077
     C                     END
     C*
     C* Print forward trade details
     C*
     C/COPY WNCPYSRC,SE0935C100
     C                     WRITEFWDTRD
     C/COPY WNCPYSRC,SE0935C101
     C                     ADD  1         LCOUNT
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* PRTHLD sr prints holding details                              *
     C*                                                               *
     C*****************************************************************
     C*
     C           PRTHLD    BEGSR                           *PRTHLD BEGSR*
     C*
     C* Format quantity for printing
     C*
     C/COPY WNCPYSRC,SE0935C013
     C   30                MOVELCSNT      ZFLD15
     C  N30                MOVELCSNV      ZFLD15
     C                     Z-ADDNMDP      ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    QUANT1
     C*
     C* Security description
     C*
     C           CSSC      CHAINSECTYDF              33
     C  N33      RECI      COMP '*'                      33
     C           *IN33     IFEQ '1'
     C           *LOCK     IN   LDA                        ***************S01117
     C***********          MOVEL'20'      DBASE            * DB ERROR 20 *S01117
     C                     Z-ADD20        DBASE            ***************S01117
     C                     MOVEL'SECTY'   DBFILE
     C                     MOVELCSSC      DBKEY
     C                     OUT  LDA                                       S01117
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   S01117
     C                     SETON                     U7U8LR
     C                     EXSR *PSSR                                     S01117
     C                     RETRN
     C                     END
     C*                    MOVELSESN      ZSRPN
     C                     MOVE *BLANKS   ZSRPN
     C                     MOVELSFN1      ZSFN1
     C                     MOVELSFN2      ZSFN2
     C**********           MOVE *BLANKS   ZSFN1
     C**********           MOVE *BLANKS   ZSFN2
     C                     MOVE RSFD      ZRSFD                           S01117
     C/COPY WNCPYSRC,SE0935C102
     C                     EXSR ZSDESC
     C/COPY WNCPYSRC,SE0935C103
     C*
     C* Calculate Customer average price
     C*
     C           *IN30     IFEQ '1'
     C           CSNT      IFNE *ZEROS
     C********** CSPT      DIV  CSNT      CUSAVP 150H                     E16095
     C           CSPT      DIV  CSNT      CUSAVP 158H                     E16095
     C                     ELSE
     C                     Z-ADDCSPT      CUSAVP
     C                     END
     C*
     C                     ELSE
     C           CSNV      IFNE *ZEROS
     C           CSPV      DIV  CSNV      CUSAVP    H
     C                     ELSE
     C                     Z-ADDCSPV      CUSAVP
     C                     END
     C                     END
     C*
     C* Allow for percentage calculation
     C*
     C/COPY WNCPYSRC,SE0935C014
     C           SPBS      IFEQ 'P'                                       E19812
     C                     MULT 100       CUSAVP                          E19812
     C                     END                                            E19812
     C*                                                                   E14040
     C* Allow for nominal decimal places
     C* AND NOMINAL CURRENCY DECIMAL PLACES                               E16095
     C*
     C           5         SUB  NMDP      DC      10
     C                     ADD  NMCDP     DC                              E16095
     C***********          MULT POWER8,DC CUSAVP                          E19812
     C                     DIV  POWER8,DC CUSAVP                          E19812
     C*
     C******Allow*for*percentage*calculation***************************   E19812
     C***********                                                         E19812
     C***********SPBS      IFEQ 'P'                                       E19812
     C***********          MULT 100       CUSAVP                          E19812
     C***********          END                                            E19812
     C*                                                                   E14040
     C           CSNT      IFLT *ZEROS                                    E14040
     C                     Z-SUBCUSAVP    CUSAVP                          E14040
     C                     END                                            E14040
     C*
     C* Express as Price/Discount/Yield
     C*
     C                     EXSR ZNCD
     C                     MOVE CUSAVP    ZPRICE
     C                     Z-ADDRUND      ZFDATE
     C*                                                                   S01232
     C*      Set up parameters for Australian yield securities            S01232
     C*                                                                   S01232
     C           *IN41     IFEQ '1'                                       S01232
     C*                                                                   S01232
     C*  CSNT must not be zero                                            E20887
     C*                                                                   S01232
     C           CSNT      ANDNE*ZEROS                                    E20887
     C***********          Z-ADDRUND      WRKD                     S01232 E20953
     C                     Z-ADDRUND      WRKD    50                      E20953
     C                     Z-ADDLCPN      ZDCSDT                          S01232
     C                     Z-ADDRUND      ZDCEDT                          S01232
     C   30                Z-ADDCSNT      ZAMT                            S01232
     C  N30                Z-ADDCSNV      ZAMT                            S01232
     C                     Z-ADDCDP       ZCDP                            S01117
     C                     EXSR ZACCZ                                     S01232
     C   30      ZDCINT    DIV  CSNT      WRKPI                           S01232
     C  N30      ZDCINT    DIV  CSNV      WRKPI                           S01232
     C                     EXSR ZYCE                                      S01232
     C*                                                                   S01232
     C*          IF EX-COUPON THEN PI PASSED IS THE REMAINING INTEREST    S01232
     C*          TILL NCD AND IS NEGATIVE                                 S01232
     C*                                                                   S01232
     C           SCUMEX    IFEQ 'X'                                       S01232
     C                     Z-ADDLCPN      ZDCSDT                          S01232
     C                     Z-ADDNCD       ZDCEDT                          S01232
     C                     Z-ADDCDP       ZCDP                            S01117
     C                     EXSR ZACCZ                                     S01232
     C***30******ZDCINT    DIV  CSNT      WKWPI                    S01232 E20953
     C   30      ZDCINT    DIV  CSNT      WKWPI  159                      E20953
     C  N30      ZDCINT    DIV  CSNV      WKWPI                           S01232
     C           WRKPI     SUB  WKWPI     WRKPI                           S01232
     C                     END                                            S01232
     C                     ELSE                                           S01232
     C                     MOVE 'C'       SCUMEX                          S01232
     C                     Z-ADD0         WRKPI                           S01232
     C                     END                                            S01232
     C   30                Z-ADDCSNT      ZNOML                           E39495
     C  N30                Z-ADDCSNV      ZNOML                           E39495
     C*                                                                   S01232
     C                     EXSR ZPRCO
     C/COPY WNCPYSRC,SE0935C023
     C*
     C* Format for printing
     C*
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE ZPRCOT    ZFLD15
     C***********          Z-ADDNMCDP     ZDECS                           S01176
     C                     Z-ADD8         ZDECS                           S01176
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    BVALPC
     C/COPY WNCPYSRC,SE0935C064
     C*
     C* Price basis is %
     C*
     C           SPBS      COMP 'P'                      51
     C*
     C* Calculate Book value
     C*
     C           *IN30     IFEQ '1'
     C********** CSNT      MULT CUSAVP    BKVAL  150
     C                     Z-ADDCSPT      BKVAL  150
     C                     ELSE
     C********** CSNV      MULT CUSAVP    BKVAL
     C                     Z-ADDCSPV      BKVAL  150
     C                     END
     C*                                                                   E14040
     C           CSNT      IFLT *ZEROS                                    E14040
     C                     Z-SUBBKVAL     BKVAL                           E14040
     C                     END                                            E14040
     C*
     C* Format for printing
     C*
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE BKVAL     ZFLD15
     C/COPY WNCPYSRC,SE0935C127
     C                     Z-ADDNMCDP     ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    BVALUE
     C*
     C**Market*price*-*Express*as*Price/Discount/Yield********************S01176
     C********************************************************************S01176
     C***********          EXSR ZNCD                                      S01176
     C***********          MOVE MKPR      WK15   150                      S01176
     C***********8         SUB  CDP       Y       10                      S01176
     C***********          DO   Y                                         S01176
     C***********WK15      DIV  10        WK15      H                     S01176
     C***********          END                                            S01176
     C***********          MOVE WK15      ZPRICE                          S01176
     C***********          Z-ADDRUND      ZFDATE                          S01176
     C***********          EXSR ZPRCO                                     S01176
     C***********                                                         S01176
     C**Format*for*printing***********************************************S01176
     C***********                                                         S01176
     C***********          MOVE *BLANKS   ZFLD15                          S01176
     C***********          MOVE ZPRCOT    ZFLD15                          S01176
     C***********          Z-ADDCDP       ZDECS                           S01176
     C***********          MOVE 'J'       ZECODE                          S01176
     C***********          EXSR ZSEDIT                                    S01176
     C***********          MOVE ZOUT21    MVALPC                          S01176
     C***********                                                         S01176
     C**Calculate*Market*value********************************************S01176
     C***********                                                         S01176
     C**Fetch*nominal*Currency*decimal*places*****************************S01176
     C***********                                                         S01176
     C***********          MOVEA'0000'    *IN,21                          S01176
     C***********          Z-ADD*ZEROS    MKVAL  150                      S01176
     C***********          Z-ADD*ZEROS    MKVAL0 150                      S01176
     C***********          Z-ADD*ZEROS    MKVAL1 151                      S01176
     C***********          Z-ADD*ZEROS    MKVAL2 152                      S01176
     C***********          Z-ADD*ZEROS    MKVAL3 153                      S01176
     C***********21        ADD  NMCDP     J       20                      S01176
     C***********          MOVEA'1'       *IN,J                           S01176
     C***********                                                         S01176
     C**Access*Price*file*for*Security*and*Type*'V'*for*Price******S01155 S01176
     C***-*If*not*found,*use*Market*Price*from*Security************S01155 S01176
     C***********                                                  S01155 S01176
     C***********          MOVE 'V '      PTYP                     S01155 S01176
     C***********          MOVE *ZEROS    PCUS                     S01155 S01176
     C***********          Z-ADD0         PDAT                     S01155 S01176
     C***********KEYPT     SETLLPRICT                              S01155 S01176
     C***********KEYPTP    READEPRICT                    99        S01155 S01176
     C************IN99     IFEQ '1'                                S01155 S01176
     C***********          MOVE MKPR      WMPRIC 158               S01155 S01176
     C***********          ELSE                                    S01155 S01176
     C***********          MOVE PPRC      WMPRIC                   S01155 S01176
     C***********          END                                     S01155 S01176
     C***********                                                  S01155 S01176
     C*                                                                   S01176
     C** DECIDE WHERE TO GET THE PRICE DETAILS -                          S01176
     C**   *IN81 ON = FROM CPPRIC, *IN82 ON = PRIC, ELSE SECTY            S01176
     C*                                                                   S01176
     C                     MOVEA'000'     *IN,80                          S01176
     C           PROT      IFEQ '9'                                       S01176
     C           TRBS      ANDEQ'Y'                                       S01176
     C                     MOVE SITP      KINVT                           S01176
     C                     MOVE NMCY      KCCY                            S01176
     C           CPPKA     CHAINCPPRIDF              80                   S01176
     C           *IN80     IFEQ '0'                                       S01176
     C           RECI      ANDNE'*'                                       S01176
     C                     SETON                     81                   S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C           *IN81     IFEQ '0'                                       S01176
     C***********          MOVE 'V'       PTYP                     S01176 E27576
     C                     MOVEL'V'       PTYP                            E27576
     C**********           MOVE *ZEROS    PCUS                                         S01176 CSD027
     C                     MOVE *BLANKS   PCUS                                                CSD027
     C                     Z-ADD0         PDAT                            S01176
     C           KEYPT     SETLLPRICT                99                   S01176
     C           *IN99     IFEQ '0'                                       S01176
     C           KEYPTP    READEPRICT                    99               S01176
     C           RECI      IFNE '*'                                       S01176
     C           *IN99     ANDEQ'0'                                       E35780
     C                     SETON                     82                   S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C** MARKET PRICE                                                     S01176
     C*                                                                   S01176
     C           *IN81     IFEQ '0'                                       S01176
     C           *IN82     ANDEQ'0'                                       S01176
     C                     MOVE MKPR      WK15   158                      S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C           *IN82     IFEQ '1'                                       S01176
     C                     MOVE PPRC      WK15                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C           *IN81     IFEQ '1'                                       S01176
     C*                                                                   S01176
     C* Calculate Yield using standard subroutine ZYMTX                   S01176
     C*                                                                   S01176
     C                     Z-ADDMATY      ZMDAT                           S01176
     C                     Z-ADDRUND      ZBASD                           S01176
     C*                                                                   S01176
     C                     Z-ADDND01      ZND,1                           S01176
     C                     Z-ADDND02      ZND,2                           S01176
     C                     Z-ADDND03      ZND,3                           S01176
     C                     Z-ADDND04      ZND,4                           S01176
     C                     Z-ADDND05      ZND,5                           S01176
     C                     Z-ADDND06      ZND,6                           S01176
     C                     Z-ADDND07      ZND,7                           S01176
     C                     Z-ADDND08      ZND,8                           S01176
     C                     Z-ADDND09      ZND,9                           S01176
     C                     Z-ADDND10      ZND,10                          S01176
     C                     Z-ADDND11      ZND,11                          S01176
     C                     Z-ADDND12      ZND,12                          S01176
     C                     Z-ADDND13      ZND,13                          S01176
     C                     Z-ADDND14      ZND,14                          S01176
     C                     Z-ADDND15      ZND,15                          S01176
     C                     Z-ADDND16      ZND,16                          S01176
     C                     Z-ADDND17      ZND,17                          S01176
     C                     Z-ADDND18      ZND,18                          S01176
     C                     Z-ADDND19      ZND,19                          S01176
     C                     Z-ADDND20      ZND,20                          S01176
     C                     Z-ADDND21      ZND,21                          S01176
     C                     Z-ADDND22      ZND,22                          S01176
     C                     Z-ADDND23      ZND,23                          S01176
     C                     Z-ADDND24      ZND,24                          S01176
     C                     Z-ADDND25      ZND,25                          S01176
     C*                                                                   S01176
     C                     Z-ADDYR01      ZRT,1                           S01176
     C                     Z-ADDYR02      ZRT,2                           S01176
     C                     Z-ADDYR03      ZRT,3                           S01176
     C                     Z-ADDYR04      ZRT,4                           S01176
     C                     Z-ADDYR05      ZRT,5                           S01176
     C                     Z-ADDYR06      ZRT,6                           S01176
     C                     Z-ADDYR07      ZRT,7                           S01176
     C                     Z-ADDYR08      ZRT,8                           S01176
     C                     Z-ADDYR09      ZRT,9                           S01176
     C                     Z-ADDYR10      ZRT,10                          S01176
     C                     Z-ADDYR11      ZRT,11                          S01176
     C                     Z-ADDYR12      ZRT,12                          S01176
     C                     Z-ADDYR13      ZRT,13                          S01176
     C                     Z-ADDYR14      ZRT,14                          S01176
     C                     Z-ADDYR15      ZRT,15                          S01176
     C                     Z-ADDYR16      ZRT,16                          S01176
     C                     Z-ADDYR17      ZRT,17                          S01176
     C                     Z-ADDYR18      ZRT,18                          S01176
     C                     Z-ADDYR19      ZRT,19                          S01176
     C                     Z-ADDYR20      ZRT,20                          S01176
     C                     Z-ADDYR21      ZRT,21                          S01176
     C                     Z-ADDYR22      ZRT,22                          S01176
     C                     Z-ADDYR23      ZRT,23                          S01176
     C                     Z-ADDYR24      ZRT,24                          S01176
     C                     Z-ADDYR25      ZRT,25                          S01176
     C/COPY WNCPYSRC,SE0935C055
     C*                                                                   S01176
     C                     EXSR ZYMTX                                     S01176
     C                     MOVE ZY1       WK15                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     EXSR ZNCD                                      S01176
     C*                                                                   S01176
     C* Format for printing                                               S01176
     C*                                                                   S01176
     C                     MOVE *BLANKS   ZFLD15                          S01176
     C                     MOVE WK15      ZFLD15                          S01176
     C                     Z-ADD8         ZDECS                           S01176
     C                     MOVE 'J'       ZECODE                          S01176
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT21    MVALPC                          S01176
     C/COPY WNCPYSRC,SE0935C065
     C*                                                                   S01176
     C* Calculate Market value                                            S01176
     C*                                                                   S01176
     C           *IN81     IFEQ '1'                                       S01176
     C                     Z-ADDZY1       ZPRCIN                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C           *IN82     IFEQ '1'                                       S01176
     C                     Z-ADDPPRC      ZPRCIN                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C           *IN81     IFEQ '0'                                       S01176
     C           *IN82     ANDEQ'0'                                       S01176
     C                     Z-ADDMKPR      ZPRCIN                          S01176
     C                     END                                            S01176
     C*                                                                   E39495
     C   30                Z-ADDCSNT      ZNOML                           E39495
     C  N30                Z-ADDCSNV      ZNOML                           E39495
     C*                                                                   S01176
     C                     Z-ADDRUND      ZFDATE                          S01176
     C                     EXSR ZPRCI                                     S01176
      *                                                                                       CSE035
      ** ADJUST PRICE : PRICE + PUR INT BEFORE ROUNDING                                       CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
     C           NCD       IFGE MATY                                                          CSE035
     C           SYBS      ANDEQ'AU'                                                          CSE035
     C                     Z-ADDZPRCOT    ZPRCOT                                              CSE035
     C                     ELSE                                                               CSE035
     C           SYBS      IFNE 'AU'                                                          CSE035
     C           SYBS      ANDNE'DA'                                                          CSE035
     C           STBS      ANDEQ'Y'                                                           CSE035
     C           ZPRCOT    ADD  ZWAMT     ZPRCOT                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
     C           NCD       IFGE MATY                                                          CSE035
     C           SYBS      ANDEQ'AU'                                                          CSE035
     C                     ELSE                                                               CSE035
     C           SYBS      IFNE 'AU'                                                          CSE035
     C           SYBS      ANDNE'DA'                                                          CSE035
     C           STBS      ANDEQ'Y'                                                           CSE035
     C           ZPRCOT    SUB  PURINT    ZPRCOT                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     END                                                                CSE035
      *                                                                                       CSE035
     C                     END                                                                CSE035
      *                                                                                       CSE035
     C/COPY WNCPYSRC,SE0935C024
     C                     Z-ADDZPRCOT    WMPRIC 158                      S01176
     C*                                                                   S01176
     C* Fetch nominal currency decimal places                             S01176
     C*                                                                   S01176
     C                     MOVEA'0000'    *IN,21                          S01176
     C                     Z-ADD*ZEROS    MKVAL  150                      S01176
     C                     Z-ADD*ZEROS    MKVAL0 150                      S01176
     C                     Z-ADD*ZEROS    MKVAL1 151                      S01176
     C                     Z-ADD*ZEROS    MKVAL2 152                      S01176
     C                     Z-ADD*ZEROS    MKVAL3 153                      S01176
     C           21        ADD  NMCDP     J       20                      S01176
     C                     MOVEA'1'       *IN,J                           S01176
     C*                                                                   S01176
     C*                                                                   S01155
     C           *IN30     IFEQ '1'
     C***21***** CSNT      MULT MKPR      MKVAL0    H                     S01155
     C***22***** CSNT      MULT MKPR      MKVAL1    H                     S01155
     C***23***** CSNT      MULT MKPR      MKVAL2    H                     S01155
     C***24***** CSNT      MULT MKPR      MKVAL3    H                     S01155
     C   21      CSNT      MULT WMPRIC    MKVAL0    H                     S01155
     C   22      CSNT      MULT WMPRIC    MKVAL1    H                     S01155
     C   23      CSNT      MULT WMPRIC    MKVAL2    H                     S01155
     C   24      CSNT      MULT WMPRIC    MKVAL3    H                     S01155
     C                     ELSE
     C***21***** CSNV      MULT MKPR      MKVAL0    H                     S01155
     C***22***** CSNV      MULT MKPR      MKVAL1    H                     S01155
     C***23***** CSNV      MULT MKPR      MKVAL2    H                     S01155
     C***24***** CSNV      MULT MKPR      MKVAL3    H                     S01155
     C   21      CSNV      MULT WMPRIC    MKVAL0    H                     S01155
     C   22      CSNV      MULT WMPRIC    MKVAL1    H                     S01155
     C   23      CSNV      MULT WMPRIC    MKVAL2    H                     S01155
     C   24      CSNV      MULT WMPRIC    MKVAL3    H                     S01155
     C                     END
     C*
     C   21                MOVE MKVAL0    MKVAL
     C   22                MOVE MKVAL1    MKVAL
     C   23                MOVE MKVAL2    MKVAL
     C   24                MOVE MKVAL3    MKVAL
     C*
     C* Price basis 'P', divide by 100
     C*
     C/COPY WNCPYSRC,SE0935C015
     C           SPBS      IFEQ 'P'
     C                     DIV  100       MKVAL
     C                     END
     C*
     C* Adjust for nominal decimal places
     C*
     C           5         SUB  NMDP      DC
     C                     MULT POWER8,DC MKVAL
     C*
     C* Format for printing
     C*
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE MKVAL     ZFLD15
     C                     Z-ADDNMCDP     ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    MVALUE
     C*
     C* Book value in portfolio currency
     C*
     C/COPY WNCPYSRC,SE0935C016
     C                     Z-ADDNMSPOT    ZRATE1 138
     C                     MOVE NMMDIN    ZMDI1   1
     C                     Z-ADDPFSPOT    ZRATE2 138
     C                     MOVE PFMDIN    ZMDI2   1
     C/COPY WNCPYSRC,SE0935C017
     C*
     C* Fetch cross-exchange rate
     C*
     C                     EXSR ZXRATE
     C*
     C* Convert to Portfolio currency
     C*
     C                     MOVE BKVAL     ZAMTCI
     C                     Z-ADDZRATEX    ZEXCH
     C           ZMDIX     IFEQ '0'
     C                     MOVE 'D'       ZMD
     C                     ELSE
     C                     MOVE 'M'       ZMD
     C                     END
     C                     MOVE NMCY      ZCCYI
     C                     MOVE C1PC      ZCCYO
     C                     Z-ADDNMCDP     ZCDPI                           S01117
     C***********          Z-ADD@WRK1     ZCDPO                    S01117 E35419
     C                     Z-ADDPFCDP     ZCDPO                           E35419
     C                     EXSR ZCONV
     C*
     C************INU7     IFEQ '1'                                       S01117
     C************INU8     OREQ '1'                        ***************S01117
     C***********          MOVEL'21'      DBASE            **DB*ERROR*21**S01117
     C***********          MOVEL'TABLE'   DBFILE           ***************S01117
     C***********          MOVELTKEY      DBKEY                           S01117
     C***********          WRITEHEADAU                                    S01117
     C***********          WRITEERROR                                     S01117
     C***********          WRITETRAILAU                                   S01117
     C***********          SETON                     LR                   S01117
     C***********          RETRN                                          S01117
     C***********          END                                            S01117
     C*
     C* Format for printing
     C*
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE ZAMTCO    ZFLD15
     C/COPY WNCPYSRC,SE0935C128
     C                     Z-ADDPFCDP     ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    BVALPF
     C*
     C* Market value in portfolio currency
     C*
     C                     Z-ADDNMSPOT    ZRATE1
     C                     MOVE NMMDIN    ZMDI1
     C                     Z-ADDPFSPOT    ZRATE2
     C                     MOVE PFMDIN    ZMDI2
     C*
     C* Fetch cross-exchange rate
     C*
     C                     EXSR ZXRATE
     C*
     C* Convert to Portfolio currency
     C*
     C                     MOVE MKVAL     ZAMTCI
     C                     Z-ADDZRATEX    ZEXCH
     C           ZMDIX     IFEQ '0'
     C                     MOVE 'D'       ZMD
     C                     ELSE
     C                     MOVE 'M'       ZMD
     C                     END
     C                     MOVE NMCY      ZCCYI
     C                     MOVE C1PC      ZCCYO
     C                     Z-ADDNMCDP     ZCDPI                           S01117
     C***********          Z-ADD@WRK1     ZCDPO                    S01117 E35419
     C                     Z-ADDPFCDP     ZCDPO                           E35419
     C                     EXSR ZCONV
     C*
     C************INU7     IFEQ '1'                                       S01117
     C************INU8     OREQ '1'                        ***************S01117
     C***********          MOVEL'22'      DBASE            **DB*ERROR*22**S01117
     C***********          MOVEL'TABLE'   DBFILE           ***************S01117
     C***********          MOVELTKEY      DBKEY                           S01117
     C***********          WRITEHEADAU                                    S01117
     C***********          WRITEERROR                                     S01117
     C***********          WRITETRAILAU                                   S01117
     C***********          SETON                     LR                   S01117
     C***********          RETRN                                          S01117
     C***********          END                                            S01117
     C*
     C* Remember Market value in Portfolio currency
     C*
     C                     Z-ADDZAMTCO    MKVPFC 150
     C*
     C/COPY WNCPYSRC,SE0935C066
     C* Format for printing
     C*
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE ZAMTCO    ZFLD15
     C/COPY WNCPYSRC,SE0935C129
     C                     Z-ADDPFCDP     ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    MVALPF
     C*
     C* Format Interest amount for printing
     C*
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE ACRINT    ZFLD15
     C/COPY WNCPYSRC,SE0935C130
     C                     Z-ADDNMCDP     ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    INTRST
     C*
     C* Check overflow
     C*
     C********** LCOUNT    IFGE 55                                        E15776
     C/COPY WNCPYSRC,SE0935C044
     C           LCOUNT    IFGE 51                                        E15776
     C                     WRITENEWPAG
     C                     WRITEDHEAD1
     C/COPY WNCPYSRC,SE0935C045
     C                     Z-ADD14        LCOUNT
     C/COPY WNCPYSRC,SE0935C078
     C                     END
     C*
     C* Output to report
     C*
     C                     WRITETRDDET
     C                     ADD  8         LCOUNT
     C/COPY WNCPYSRC,SE0935C079
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* PRTSUM sr prints summary details                              *
     C*                                                               *
     C*****************************************************************
     C*
     C           PRTSUM    BEGSR                           *PRTSUM BEGSR*
     C*
     C* Start new report
     C*
     C/COPY WNCPYSRC,SE0935C046
     C                     WRITENEWPAG
     C*
     C* Print headings
     C*
     C                     WRITEDHEAD2
     C/COPY WNCPYSRC,SE0935C047
     C                     Z-ADD14        LCOUNT
     C*
     C/COPY WNCPYSRC,SE0935C067
     C* Print percentages per country, investment type and currency
     C*
     C                     Z-ADD1         X
     C           X         DOUEQ51
     C           CPC,X     OREQ *ZEROS
     C           NPC,X     ANDEQ*ZEROS
     C           IPC,X     ANDEQ*ZEROS
     C/COPY WNCPYSRC,SE0935C068
     C                     SETOF                     616263
     C*
     C* Find % total market value for country total
     C*
     C                     MOVE *BLANKS   CORPC
     C                     MOVE *BLANKS   CNM
     C           TOTPFC    IFEQ *ZERO                                                         229957
     C                     Z-ADD0         CPC,X                                               229957
     C                     ENDIF                                                              229957
     C           CPC,X     IFNE *ZEROS
     C           CPC,X     DIV  TOTPFC    WK15N  154H
     C           WK15N     MULT 100       PC15N  152
     C*
     C* Format for printing
     C*
     C***********          MOVE *BLANKS   ZFIELD                          E20887
     C***********          MOVE PC15N     ZFIELD                          E20887
     C***********          Z-ADD2         ZADEC   10                      E20887
     C***********          EXSR ZEDIT                                     E20887
     C***********          MOVE ZFIELD    CORPC                           E20887
     C*                                                                   E20887
     C                     MOVE *BLANKS   ZFLD15                          E20887
     C                     MOVE PC15N     ZFLD15                          E20887
     C                     Z-ADD2         ZDECS                           E20887
     C                     MOVE 'L'       ZECODE                          E20887
     C                     EXSR ZSEDIT                                    E20887
     C                     MOVE ZOUT21    CORPC                           E20887
     C*
     C* Fetch country name
     C*
     C                     MOVE *BLANKS   KEY12A
     C                     MOVEL'50'      KEY12A
     C                     MOVE COR,X     KEY12A
     C           KEY12A    CHAINTABLETHF             33
     C                     SETON                     61
     C                     END
     C*
     C* Find % total market value for investment type total
     C*
     C                     MOVE *BLANKS   ITPPC
     C                     MOVE *BLANKS   INAM
     C           TOTPFC    IFEQ *ZERO                                                         229957
     C                     Z-ADD0         IPC,X                                               229957
     C                     ENDIF                                                              229957
     C           IPC,X     IFNE *ZEROS
     C           IPC,X     DIV  TOTPFC    WK15N  154H
     C/COPY WNCPYSRC,SE0935C069
     C           WK15N     MULT 100       PC15N  152
     C*
     C* Format for printing
     C*
     C***********          MOVE *BLANKS   ZFIELD                          E20887
     C***********          MOVE PC15N     ZFIELD                          E20887
     C***********          Z-ADD2         ZADEC                           E20887
     C***********          EXSR ZEDIT                                     E20887
     C***********          MOVE ZFIELD    ITPPC                           E20887
     C*                                                                   E20887
     C                     MOVE *BLANKS   ZFLD15                          E20887
     C                     MOVE PC15N     ZFLD15                          E20887
     C                     Z-ADD2         ZDECS                           E20887
     C                     MOVE 'L'       ZECODE                          E20887
     C                     EXSR ZSEDIT                                    E20887
     C                     MOVE ZOUT21    ITPPC                           E20887
     C*
     C* Fetch investment type name
     C*
     C                     MOVE ITN,X     NMCY
     C                     MOVE ITP,X     SITP
     C           INVKA     CHAININVTPDF              33
     C                     SETON                     62
     C                     END
     C*
     C/COPY WNCPYSRC,SE0935C070
     C* Find % total market value for nominal currency total
     C*
     C                     MOVE *BLANKS   NMCPC
     C                     MOVE *BLANKS   TNMC
     C           TOTPFC    IFEQ *ZERO                                                         229957
     C                     Z-ADD0         NPC,X                                               229957
     C                     ENDIF                                                              229957
     C           NPC,X     IFNE *ZEROS
     C           NPC,X     DIV  TOTPFC    WK15N  154H
     C           WK15N     MULT 100       PC15N  152
     C*
     C* Format for printing
     C*
     C***********          MOVE *BLANKS   ZFIELD                          E20887
     C***********          MOVE PC15N     ZFIELD                          E20887
     C***********          Z-ADD2         ZADEC                           E20887
     C***********          EXSR ZEDIT                                     E20887
     C***********          MOVE ZFIELD    NMCPC                           E20887
     C*                                                                   E20887
     C                     MOVE *BLANKS   ZFLD15                          E20887
     C                     MOVE PC15N     ZFLD15                          E20887
     C                     Z-ADD2         ZDECS                           E20887
     C                     MOVE 'L'       ZECODE                          E20887
     C                     EXSR ZSEDIT                                    E20887
     C                     MOVE ZOUT21    NMCPC                           E20887
     C*
     C* Print nominal currency code
     C*
     C                     MOVELNMC,X     TNMC
     C                     SETON                     63
     C                     END
     C*
     C* Check overflow
     C*
     C********** LCOUNT    IFGE 55                                        E15776
     C/COPY WNCPYSRC,SE0935C048
     C           LCOUNT    IFGE 51                                        E15776
     C                     WRITENEWPAG
     C                     WRITEDHEAD2
     C/COPY WNCPYSRC,SE0935C049
     C                     Z-ADD14        LCOUNT
     C/COPY WNCPYSRC,SE0935C080
     C                     END
     C*
     C* Print summary total line
     C*
     C                     WRITECNTYPC
     C                     ADD  1         LCOUNT
     C                     ADD  1         X
     C*
     C                     END
     C*
     C/COPY WNCPYSRC,SE0935C071
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* RETAIL sr prints Retail/Settlement balances                   *
     C*                                                               *
     C*****************************************************************
     C*
     C           RETAIL    BEGSR                           *RETAIL BEGSR*
     C*
     C                     MOVEA*BLANKS   SCU
     C/COPY WNCPYSRC,SE0935C131
     C                     Z-ADD*ZEROS    SDP
     C                     Z-ADD*ZEROS    SSR
     C                     Z-ADD*ZEROS    SXR
     C                     Z-ADD*ZEROS    BAL
     C                     Z-ADD*ZEROS    ACI
     C                     Z-ADD*ZEROS    OTS
     C                     Z-ADD*ZEROS    TBL
     C                     Z-ADD*ZEROS    PCE
     C*
     C* OBTAIN TOTAL RETAIL A/C BALANCES (IF RETAIL MODULE PRESENT)
     C*
     C* Read account file for Branch/Customer
     C*
     C           *INU1     IFEQ '1'
     C           CPOSKA    SETLLACCNTABF
     C/COPY WNCPYSRC,SE0935C088
     C                     SETOF                     33
     C           *IN33     DOWEQ'0'
     C           CPOSKA    READEACCNTABF                 33
     C/COPY WNCPYSRC,SE0935C089
     C           *IN33     IFEQ '0'
     C/COPY WNCPYSRC,SE0935C106
     C           ATYP      ANDEQ'R'                                       174665
     C                     MOVE CCY       CCYSTO  3
     C                     EXSR STORE
     C*
     C* Calculate and store balance
     C*
     C           RECI      IFEQ 'D'
     C           ATYP      ANDEQ'R'
     C***********RTLB      SUB  CLBL      WK15N2 150                      054690
     C                     Z-SUBCLBL      WK15N2 150                      054690
     C***********          Z-ADDWK15N2    BAL,X                           E31440
     C                     ADD  WK15N2    BAL,X                           E31440
     C                     END
     C*
     C* Fetch accrued interest values
     C*
     C           ACRKA     CHAINREACRDF              34
     C           *IN34     IFEQ '1'
     C           RECI      OREQ '*'
     C***********          Z-ADD*ZEROS    WK15N2                          032925
     C                     ELSE
     C*                                                                   032925
     C* INTEREST AMOUNTS ARE REVERSED IN FILE FOR CREDIT                  032925
     C*                                                                   032925
     C***********DAIC1     ADD  MADI      WK15N2                          032925
     C***********          ADD  GADI      WK15N2                          032925
     C***********          ADD  CAIC1     WK15N2                          032925
     C***********          ADD  MACI      WK15N2                          032925
     C***********          ADD  GACI      WK15N2                          032925
     C                     Z-ADD*ZEROS    WK15N2                          032925
     C*                                                                   032925
     C           DAIC1     IFGT 0                                         032925
     C                     SUB  DAIC1     WK15N2                          032925
     C                     ELSE                                           032925
     C                     ADD  DAIC1     WK15N2                          032925
     C                     END                                            032925
     C*                                                                   032925
     C           MADI      IFGT 0                                         032925
     C                     SUB  MADI      WK15N2                          032925
     C                     ELSE                                           032925
     C                     ADD  MADI      WK15N2                          032925
     C                     END                                            032925
     C*                                                                   032925
     C           GADI      IFGT 0                                         032925
     C                     SUB  GADI      WK15N2                          032925
     C                     ELSE                                           032925
     C                     ADD  GADI      WK15N2                          032925
     C                     END                                            032925
     C*                                                                   032925
     C           CAIC1     IFGT 0                                         032925
     C                     ADD  CAIC1     WK15N2                          032925
     C                     ELSE                                           032925
     C                     SUB  CAIC1     WK15N2                          032925
     C                     END                                            032925
     C*                                                                   032925
     C           MACI      IFGT 0                                         032925
     C                     ADD  MACI      WK15N2                          032925
     C                     ELSE                                           032925
     C                     SUB  MACI      WK15N2                          032925
     C                     END                                            032925
     C*                                                                   032925
     C           GACI      IFGT 0                                         032925
     C                     ADD  GACI      WK15N2                          032925
     C                     ELSE                                           032925
     C                     SUB  GACI      WK15N2                          032925
     C                     END                                            032925
     C*                                                                   032925
     C                     END
     C*
     C                     Z-ADDWK15N2    ACI,X
     C                     END
     C*
     C                     END
     C                     END
     C*
     C* OBTAIN TOTAL O/S COUNTER VALUE IF TVVL IS 'T'
     C*
     C* Fetch total outstanding countervalue for unsettled trades
     C*
     C           TVVL      IFEQ 'T'
     C           CPOSKA    SETLLTRDBV
     C                     SETOF                     34
     C           *IN34     DOWEQ'0'
     C           CPOSKA    READETRDBV                    34
     C           *IN34     IFEQ '0'
     C           RECI      ANDEQ'D'
     C*
     C* Fetch nominal ccy decimal places                                  S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   KEY12A 12                       S01117
     C                     MOVELTNMC      WORK4A  4                       S01117
     C                     MOVE '1'       WORK4A                          S01117
     C                     MOVEL'20'      KEY12A                          S01117
     C                     MOVE WORK4A    KEY12A                          S01117
     C           KEY12A    CHAINTABTG10F             34                   S01117
     C  N34      RECI      COMP '*'                      34               S01117
     C           *IN34     IFEQ '1'                                       S01117
     C           *LOCK     IN   LDA                        ***************S01117
     C                     Z-ADD23        DBASE            * DB ERROR 23 *S01117
     C                     MOVEL'TABLE'   DBFILE           ***************S01117
     C                     MOVELKEY12A    DBKEY                           S01117
     C                     OUT  LDA                                       S01117
     C                     WRITEHEADAU                                    S01117
     C                     WRITEERROR                                     S01117
     C                     SETON                     U7U8LR               S01117
     C                     EXSR *PSSR                                     S01117
     C                     RETRN                                          S01117
     C                     END                                            S01117
     C                     Z-ADDCDP       ZCDPI                           S01117
     C*                                                                   S01117
     C* ACCESS DETAILS FOR SETTLEMENT CCY & STORE
     C*
     C/COPY WNCPYSRC,SE0935C113
     C                     MOVE SETC      CCYSTO
     C                     EXSR STORE
     C                     Z-ADDSDP,X     ZCDPO                           S01117
     C/COPY WNCPYSRC,SE0935C114
     C*
     C* Convert countervalue to settlement currency
     C*
     C                     Z-ADDTCTR      ZAMTCI
     C                     Z-ADDTDER      ZEXCH
     C                     MOVE TMDI      ZMD
     C                     MOVE TNMC      ZCCYI
     C                     MOVE SETC      ZCCYO
     C                     EXSR ZCONV
     C*
     C************INU7     IFEQ '1'                                       S01117
     C************INU8     OREQ '1'                        ***************S01117
     C***********          MOVEL'23'      DBASE            **DB*ERROR*23**S01117
     C***********          MOVEL'TABLE'   DBFILE           ***************S01117
     C***********          MOVELTKEY      DBKEY                           S01117
     C***********          WRITEHEADAU                                    S01117
     C***********          WRITEERROR                                     S01117
     C***********          WRITETRAILAU                                   S01117
     C***********          SETON                     LR                   S01117
     C***********          RETRN                                          S01117
     C***********          END                                            S01117
     C*
     C           TDTP      IFEQ 'TP'
     C                     ADD  ZAMTCO    OTS,X
     C                     ELSE
     C                     SUB  ZAMTCO    OTS,X
     C                     END
     C*
     C                     END
     C                     END
     C*
     C                     END
     C*
     C* Print detail records
     C*
     C           TVVL      IFEQ 'T'
     C           *INU1     OREQ '1'
     C                     Z-ADD1         X
     C           X         DOWLE50
     C           SCU,X     ANDNE'   '
     C*
     C* Calculate total balance
     C*
     C           BAL,X     IFNE *ZEROS
     C           OTS,X     ORNE *ZEROS
     C           BAL,X     ADD  ACI,X     WK15N2
     C                     ADD  OTS,X     WK15N2
     C                     Z-ADDWK15N2    TBL,X
     C                     END
     C*
     C* Fetch cross-exchange rate
     C*
     C                     Z-ADDSSR,X     ZRATE1
     C                     MOVE SMD,X     ZMDI1
     C                     Z-ADDPFSPOT    ZRATE2
     C                     MOVE PFMDIN    ZMDI2
     C                     EXSR ZXRATE
     C                     Z-ADDZRATEX    SXR,X
     C*
     C* Convert to Portfolio currency
     C*
     C                     Z-ADDTBL,X     ZAMTCI
     C                     Z-ADDZRATEX    ZEXCH
     C           ZMDIX     IFEQ '0'
     C                     MOVE 'D'       ZMD
     C                     ELSE
     C                     MOVE 'M'       ZMD
     C                     END
     C                     MOVE SCU,X     ZCCYI
     C                     MOVE C1PC      ZCCYO
     C                     Z-ADDSDP,X     ZCDPI                           S01117
     C***********          Z-ADD@WRK1     ZCDPO                   S01117  E35419
     C                     Z-ADDPFCDP     ZCDPO                           E35419
     C                     EXSR ZCONV
     C*
     C************INU7     IFEQ '1'                                       S01117
     C************INU8     OREQ '1'                        ***************S01117
     C***********          MOVEL'24'      DBASE            **DB*ERROR*24**S01117
     C***********          MOVEL'TABLE'   DBFILE           ***************S01117
     C***********          MOVELTKEY      DBKEY                           S01117
     C***********          WRITEHEADAU                                    S01117
     C***********          WRITEERROR                                     S01117
     C***********          WRITETRAILAU                                   S01117
     C***********          SETON                     LR                   S01117
     C***********          RETRN                                          S01117
     C***********          END                                            S01117
     C*
     C                     Z-ADDZAMTCO    PCE,X
     C*
     C* Fetch total
     C*
     C                     XFOOTPCE       TOHPFE
     C*
     C                     MOVE SCU,X     STRCUR
     C*
     C* Format values for printing
     C*
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE BAL,X     ZFLD15
     C/COPY WNCPYSRC,SE0935C132
     C                     Z-ADDSDP,X     ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    STRBAL
     C*
     C                     SETOF                     31                   032925
     C                     SETOF                     37                   032925
     C*                                                                   032925
     C           ACI,X     IFGT 0                                         032925
     C                     SETON                     31                   032925
     C                     END                                            032925
     C*                                                                   032925
     C           ACI,X     IFLT 0                                         032925
     C                     SETON                     37                   032925
     C                     END                                            032925
     C*                                                                   032925
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE ACI,X     ZFLD15
     C/COPY WNCPYSRC,SE0935C133
     C                     Z-ADDSDP,X     ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    STRACI
     C*
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE OTS,X     ZFLD15
     C/COPY WNCPYSRC,SE0935C134
     C                     Z-ADDSDP,X     ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    STROST
     C*
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE TBL,X     ZFLD15
     C/COPY WNCPYSRC,SE0935C135
     C                     Z-ADDSDP,X     ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    STRTBL
     C*
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE PCE,X     ZFLD15
     C/COPY WNCPYSRC,SE0935C136
     C                     Z-ADDPFCDP     ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    STRPFE
     C*
     C* Check overflow
     C*
     C********** LCOUNT    IFGE 55                                        E15776
     C/COPY WNCPYSRC,SE0935C050
     C           LCOUNT    IFGE 51                                        E15776
     C                     WRITENEWPAG
     C                     WRITEDHEAD4
     C/COPY WNCPYSRC,SE0935C051
     C                     Z-ADD16        LCOUNT
     C/COPY WNCPYSRC,SE0935C081
     C                     END
     C*
     C                     WRITERTLDET
     C                     ADD  1         LCOUNT
     C/COPY WNCPYSRC,SE0935C082
     C*
     C* STORE CURRENCY & CROSS RATE IF NOT ALREADY THERE
     C                     Z-ADD1         I       20
     C           SCU,X     LOKUPCUR,I                    33
     C           *IN33     IFEQ '0'
     C                     Z-ADD1         I
     C           '   '     LOKUPCUR,I                    33
     C                     MOVE SCU,X     CUR,I
     C                     Z-ADDSXR,X     XCR,I
     C                     END
     C                     ADD  1         X
     C*
     C                     END
     C                     END
     C*
     C                     ENDSR
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* STORE  S/R - STORE CURRENCY DETAILS                           *
     C*                                                               *
     C*****************************************************************
     C*
     C           STORE     BEGSR                           *STORE  BEGSR*
     C*
     C* Store currency
     C*
     C                     Z-ADD1         X
     C           CCYSTO    LOKUPSCU,X                    34
     C           *IN34     IFEQ '0'
     C           '   '     LOKUPSCU,X                    34
     C                     MOVE CCYSTO    SCU,X
     C*
     C* Fetch and store currency decimal places
     C*
     C                     MOVE *BLANKS   KEY12A 12
     C                     MOVELCCYSTO    WORK4A  4
     C                     MOVE '1'       WORK4A
     C                     MOVEL'20'      KEY12A
     C                     MOVE WORK4A    KEY12A
     C           KEY12A    CHAINTABTG10F             34
     C  N34      RECI      COMP '*'                      34
     C           *IN34     IFEQ '1'
     C           *LOCK     IN   LDA                        ***************S01117
     C***********          MOVEL'25'      DBASE            * DB ERROR 25 *S01117
     C                     Z-ADD25        DBASE            ***************S01117
     C                     MOVEL'TABLE'   DBFILE
     C                     MOVELKEY12A    DBKEY
     C                     OUT  LDA                                       S01117
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   S01117
     C                     SETON                     U7U8LR
     C                     EXSR *PSSR                                     S01117
     C                     RETRN
     C                     END
     C/COPY WNCPYSRC,SE0935C018
     C                     Z-ADDCDP       SDP,X
     C                     Z-ADDSPOT      SSR,X
     C                     MOVE MDIN      SMD,X
     C/COPY WNCPYSRC,SE0935C137
     C                     END
     C*
     C                     ENDSR
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* TOTALS S/R - prints Total lines                               *
     C*                                                               *
     C*****************************************************************
     C*
     C           TOTALS    BEGSR                           *TOTALS BEGSR*
     C*
     C                     SETOF                     71
     C*
     C           *INU1     IFEQ '1'
     C           *INU2     OREQ '1'
     C                     SETON                     71
     C*
     C* Format total other holdings for printing
     C*
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE TOHPFE    ZFLD15
     C/COPY WNCPYSRC,SE0935C138
     C                     Z-ADDPFCDP     ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    TOHVAL
     C*
     C* Print total value
     C*
     C/COPY WNCPYSRC,SE0935C117
     C                     WRITETOTAL1
     C                     ADD  4         LCOUNT
     C*
     C                     END
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,SE0935CPLT                                           S01408
     C*                                                                   S01408
     C*
     C* Format total for printing
     C*
     C                     ADD  TOHPFE    TOTPFC
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE TOTPFC    ZFLD15
     C/COPY WNCPYSRC,SE0935C139
     C                     Z-ADDPFCDP     ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    TPFVAL
     C*
     C* Print total values
     C*
     C                     MOVE C1PC      PFCY
     C           LCOUNT    IFGE 51                                        095028
     C                     WRITENEWPAG                                    095028
     C                     Z-ADD9         LCOUNT                          095028
     C/COPY WNCPYSRC,SE0935C083
     C                     END                                            095028
     C                     WRITETOTAL2
     C                     ADD  9         LCOUNT
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,SE0935CPLT                                           S01408
     C*                                                                   S01408
     C*
     C* List all exchange rates used
     C*
     C                     Z-ADD1         X
     C/COPY WNCPYSRC,SE0935C072
     C           X         DOUEQ51
     C           CUR,X     OREQ '   '
     C*
     C                     MOVEACUR,X     STRCUR
     C*
     C* Format exchange rate for printing
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE XCR,X     ZFIELD
     C                     Z-ADD8         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    STREXR
     C*
     C* Check overflow
     C*
     C********** LCOUNT    IFGE 55                                        E15776
     C********** LCOUNT    IFGE 51                                  E15776095028
     C/COPY WNCPYSRC,SE0935C052
     C           LCOUNT    IFGE 59                                        095028
     C                     WRITENEWPAG
     C                     Z-ADD9         LCOUNT
     C                     END
     C*
     C/COPY WNCPYSRC,SE0935C118
     C* Write out currency line
     C*
     C                     WRITECCYSTR
     C                     ADD  1         LCOUNT
     C                     ADD  1         X
     C*
     C                     END
     C/COPY WNCPYSRC,SE0935C053
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT                                                              S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C*   *PSSR -- ERROR HANDLING SUBROUTINE                              S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C**                                                                  S01117
     C           *PSSR     BEGSR                                          S01117
     C**                                                                  S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     ENDSR                                          S01117
     C**                                                                  S01117
     C*                                                                   S01117
     C*****************************************************************   S01117
     C/EJECT                                                              E29170
     C********************************************************************E29170
     C*                                                                   E29170
     C*  RCFP1 -- SUBROUTINE TO REGISTER P1 PRINTER FILE VIA RCF          E29170
     C*                                                                   E29170
     C********************************************************************E29170
     C*                                                                   E29170
     C           RCFP1     BEGSR                            ** RCFP1 **   E29170
     C*                                                                   E29170
     C**      ENSURE REPORT SPOOL FILE RECORDED BY RCF                    E29170
     C*                                                                   E29170
     C                     Z-ADDSFNUM     ZSNUM   60                      E29170
     C**                                                                  E29170
     C                     CALL 'ZSFILE'                                  E29170
     C                     PARM           SEQ                             E29170
     C                     PARM CVBA      SENTY   3                       E29170
     C                     PARM           SFILE                           E29170
     C                     PARM           ZSNUM                           E29170
     C                     PARM *BLANKS   ZSERR   1                       E29170
     C*                                                                   E29170
     C           ZSERR     IFEQ 'Y'                                       E29170
     C*                                                                   E29170
     C**  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       E29170
     C*                                                                   E29170
     C                     SETON                     U7U8LR               E29170
     C                     RETRN                                          E29170
     C                     END                                            E29170
     C*                                                                   E29170
     C                     ENDSR                                          E29170
     C*                                                                   E29170
     C********************************************************************E29170
     C/EJECT                                                              E29170
     C********************************************************************E29170
     C*                                                                   E29170
     C*  RCFAU -- SUBROUTINE TO REGISTER AU PRINTER FILE VIA RCF          E29170
     C*                                                                   E29170
     C********************************************************************E29170
     C*                                                                   E29170
     C           RCFAU     BEGSR                            ** RCFAU **   E29170
     C*                                                                   E29170
     C**      ENSURE AUDIT SPOOL FILE RECORDED BY RCF                     E29170
     C*                                                                   E29170
     C                     Z-ADDSFNUMU    ZSNUMU  60                      E29170
     C**                                                                  E29170
     C                     CALL 'ZSFILE'                                  E29170
     C                     PARM           SEQ                             E29170
     C                     PARM *BLANKS   SENTY                           E29170
     C                     PARM           SFILEU                          E29170
     C                     PARM           ZSNUMU                          E29170
     C                     PARM *BLANK    ZSERR                           E29170
     C*                                                                   E29170
     C           ZSERR     IFEQ 'Y'                                       E29170
     C*                                                                   E29170
     C**  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       E29170
     C*                                                                   E29170
     C                     SETON                     U7U8LR               E29170
     C                     RETRN                                          E29170
     C                     END                                            E29170
     C*                                                                   E29170
     C                     ENDSR                                          E29170
     C*                                                                   E29170
     C*****************************************************************   E29170
     C/COPY WNCPYSRC,SE0935C019
      /EJECT
      /COPY ZSRSRC,GLINTCZ1
      /EJECT                                                              S01232
     C/COPY ZSRSRC,ZDAT10Z2                                               126017
     C/EJECT                                                              126017
     C/COPY ZSRSRC,ZACCRZ1                                                S01232
      /EJECT                                                              S01232
     C/COPY ZSRSRC,ZACCZZ1                                                S01232
      /EJECT                                                              S01232
     C/COPY ZSRSRC,ZACCH                                                  S01195
      /EJECT                                                              S01195
     C*COPY*ZSRSRC,XDATE3Z1*****                                   S01232 S01195
     C/COPY ZSRSRC,ZBKDT                                                  S01195
      /EJECT
     C/COPY WNCPYSRC,SE0935C020
     C/COPY ZSRSRC,ZCONVZ1
     C/COPY WNCPYSRC,SE0935C021
      /EJECT
     C/COPY ZSRSRC,ZDATE1Z2
      /EJECT
     C/COPY ZSRSRC,ZDATE2Z4
      /EJECT
     C/COPY ZSRSRC,ZDAYSZ2
      /EJECT
     C/COPY ZSRSRC,ZDYYRZ3
      /EJECT
     C/COPY ZSRSRC,ZEDITZ2
      /EJECT
     C/COPY ZSRSRC,ZEVCDZ1
      /EJECT
     C/COPY ZSRSRC,ZICD2Z1
      /EJECT
     C/COPY ZSRSRC,ZICDSEZ1
      /EJECT                                                              E20380
     C/COPY ZSRSRC,ZLCDZ1                                                            E20380 MD057247
      /EJECT
     C/COPY ZSRSRC,ZNCDZ3
      /EJECT                                                              S01176
     C/COPY ZSRSRC,ZPRCIZ1                                                S01176
      /EJECT
     C/COPY ZSRSRC,ZPRCOZ1
      /EJECT                                                              S01232
     C/COPY ZSRSRC,ZRATEZ1                                                S01232
      /EJECT
     C/COPY ZSRSRC,ZRSTORZ1
      /EJECT
     C/COPY ZSRSRC,ZSAVEZ1
      /EJECT
      /COPY ZSRSRC,ZSDESCZ3
      /EJECT
     C/COPY ZSRSRC,ZSEDITZ3
      /EJECT
     C/COPY ZSRSRC,ZSYSTMZ1
      /EJECT
     C/COPY ZSRSRC,ZXRATEZ1
      /EJECT                                                              S01232
     C/COPY ZSRSRC,ZYCEZ1                                                 S01232
      /EJECT
     C/COPY ZSRSRC,ZYLDIZ1
      /EJECT
     C/COPY ZSRSRC,ZYLDOZ1
      /EJECT
     C/COPY ZSRSRC,ZCNSDZ1                                                E39495
     C/EJECT                                                              E39495
     C/COPY ZSRSRC,ZYLDZ2
      /EJECT                                                              S01176
     C/COPY ZSRSRC,ZYMTXZ2                                                S01176
     C/EJECT                                                              E39495
     C/COPY ZSRSRC,ZCALCD                                                 E39495
      /EJECT                                                              066550
     C/COPY ZSRSRC,ZINTDYZ2                                               066550
      /EJECT                                                              066550
     C/COPY ZSRSRC,ZDATE9Z3                                               066550
      /EJECT                                                              066550
     O/EJECT                                                              S01117
     OCVALSDF E                CVUPD                                      S01117
     O                         RECICV                                     S01117
      /EJECT
      ***
**  CPY@
(c) Finastra International Limited 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
0006001521029820444305904073650882610287117481320914670161311759219053
2051421975234362489726358278192928030741322023366335124365853804639507
40968424294389045351
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
** Deal types/descriptions
ITTAKING
IPPLACING
TDTIME DEPOSIT
TITIME LOAN
CDCALL DEPOSIT
CLCALL LOAN
DLDEMAND LOAN
**  POWER8 - ARRAY OF POWERS FOR NOMINAL DP TO CURRENCY DP CONVERSION
00000001
00000010
00000100
00001000
00010000
00100000
01000000
10000000
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
