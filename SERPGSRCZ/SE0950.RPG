     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Monthly trading reconciliation')              *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Securities Trading Module
     F*                                                               *
     F*  SE0950 - MONTHLY TRADING RECONCILIATION REPORT               *
     F*                                                               *
     F*  Function: This report lists all the accepted trades for the  *
     F*   (COB)    month. Each security displays the month's opening  *
     F*            and closing balances, together with the average    *
     F*            price carried forward, for each of the bank's books*
     F*            Customer positions are not included. The profit and*
     F*            loss of the month's dealing is also reported for   *
     F*            each security, this being calculated on an average *
     F*            price basis. The report can be produced on either  *
     F*            a trade date or a value date basis.                *
     F*                                                               *
     F*  Called by: SEC0906 - Monthly Trading Reconciliation          *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. 248698             Date 01Jun20               *
      *  Prev Amend No. MD057247           Date 01Feb21               *
      *                 MD050604           Date 21Feb20               *
      *                 MD046248           Date 27Oct17               *
      *                 226449             Date 24Jun15               *
      *                 MD034776           Date 09Jul15               *
      *                 AR1067108          Date 11Dec12               *
      *                 AR1001183A         Date 20Nov12               *
      *                 AR322165           Date 31Jul12               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 234300             Date 29Sep06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CPK024             Date 13Feb06               *
      *                 CSE071             Date 19Jul05               *
      *                 229857             Date 07Oct04               *
      *                 229342             Date 01Nov02               *
      *                 226570             Date 27Jun04               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 211407             Date 07Jan03               *
      *                 208241             Date 21Aug02               *
      *                 207543             Date 17JUL02               *
      *                 194370             Date 12Jul01               *
      *                 180056             Date 18Oct00               *
      *                 CSE035             Date 22Apr02               *
      *                 206316             Date 19Jul02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 17Jun01               *
      *                 CSE031             Date 09Nov01               *
      *                 180707             Date 25Jul00               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 127566             Date 09May01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 148071             Date 31Oct00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 180218             Date 14Jun00               *
      *                 140272             Date 20Apr00               *
      *                 CDE001             Date 13Apr00               *
      * Midas DBA 3.02 -----------------------------------------------*
     F*                 CSE006             Date 12Aug99               *
      * Midas DBA 3.00 -----------------------------------------------*
     F*                 CAC005             Date 18Dec98               *
      *                 130862             Date 18Oct98               *
      *                 151945             DATE 06Jan99               *
      *                 CEU017             Date 07Apr98               *
      *                 CSE007             Date 17Mar98               *
     F*                 CSE005             DATE 04FEB97               *
     F*                 084704             DATE 01AUG96               *
     F*                 083039             DATE 01AUG96               *
     F*                 059110             DATE 25JUL96               *
     F*                 088047             DATE 26JUN96               *
     F*                 100228             DATE 30MAY96               *
     F*                 101959             DATE 24MAY96               *
     F*                 099886             DATE 18APR96               *
     F*                 100017             DATE 18APR96               *
     F*                 S01408             DATE 04MAR96               *
     F*                 092961             DATE 04OCT95               *
     F*                 091254             DATE 20OCT95               *
     F*                 086491             DATE 15JUN95               *
     F*                 S01496             DATE 15JUL94               *
     F*                 S01502             DATE 02DEC94               *
     F*                 064575             DATE 15AUG94               *
     F*                 054257             DATE 25NOV93               *
     F*                 052254             DATE 25NOV93               *
     F*                 051421             DATE 25NOV92               *
     F*                 S01401             DATE 16JUN93               *
     F*                 E39495             DATE 17FEB93               *
     F*                 E47922             DATE 01FEB93               *
     F*                 047009             DATE 17NOV92               *
     F*                 S01397             DATE 10SEP92               *
     F*                 E40390             DATE 27MAY92               *
     F*                 E37419             DATE 24MAR92               *
     F*                 E35580             DATE 10FEB92               *
     F*                 E33035             DATE 09DEC91               *
     F*                 E29170             DATE 09OCT91               *
     F*                 E27092             DATE 04SEP91               *
     F*                 S01117             DATE 22MAY91               *
     F*                 S01269             DATE 18JUL90               *
     F*                 S01271             DATE 19JUN90               *
     F*                 E23674             DATE 14SEP90               *
     F*                 E23586             DATE 10SEP90               *
     F*                 E21540             DATE 06APR90               *
     F*                 E21580             DATE 06APR90               *
     F*                 E21668             DATE 01MAY90               *
     F*                 E21616             DATE 03APR90               *
     F*                 E21308             DATE 06MAR90               *
     F*                 E21002             DATE 07FEB90               *
     F*                 E20959             DATE 26JAN89               *
     F*                 E20621             DATE 18DEC89               *
     F*                 E20125             DATE 14NOV89               *
     F*                 E20145             DATE 14NOV89               *
     F*                 E19490             DATE 14NOV89               *
     F*                 E20129             DATE 14NOV89               *
     F*                 E19408             DATE 14NOV89               *
     F*                 E19505             DATE 14NOV89               *
     F*                 E20085             DATE 08NOV89               *
     F*                 E20086             DATE 07NOV89               *
     F*                 E16772             DATE 19/06/89              *
     F*                 E18657             DATE 12/06/89              *
     F*                 E17159             DATE 05/05/89              *
     F*                 E17160             DATE 18/04/89              *
     F*                 E17161             DATE 17/04/89              *
     F*                 E15594             DATE 18/10/88              *
     F*                 E15279             DATE 13/10/88              *
     F*                 E14741             DATE 16/08/88              *
     F*                 S01129             DATE 12/04/88              *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  248698 - Rounding discrepancies on some SE reports. Applied  *
      *           fix 228682.                                         *
      *  228682 - Recompiled due to ZCNSDZ1 changes. Applied 176594.  *
      *  MD057247 - Multiple calls of UTCHOBJEX for several COB com-  *
      *             ponents - Securities module.                      *
      *           - Moved the call of AOSARDR0 from /copy ZLCDZ1.     *
      *  MD050604 - Average price of position changed incorrectly.    *
      *           - Recompiled due to changes in /copy sources ZAVPRZ1*
      *             and ZCNSDZ1.                                      *
      *  MD046248 - Finastra Rebranding                               *
      *  226449 - Recompiled over changes made in /COPY ZDYYRZ3.      *
      *         - Applied for MD034387.                               *
      *  MD034776 - Reverse AR1001183A to allow negative interest     *
      *             rate. (Recompile)                                 *
      *  AR1067108 - PMC1140 Component failed during Clean COB        *
      *              Applied fix AR1001183A                           *
      *  AR1001183A - Coupon rate was still used in computation of    *
      *              interest instead of using the details in FRN tab *
      *              (Reopen) (Recompile)                             *
      *  AR322165 - Printer overflow problem in SE0950P1. Patterned   *
      *             after fix 254262.                                 *
      *  234300 - Recompiled over changed in PF/HSTTRD.               *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CPK024 - Packaging for MPLUS 1.2.1. EUTX from data structure *
      *           SESTAT was renamed to EUTXB                         *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  229857 - Recompiled due to change in ZYLDZ2.                 *
      *  229342 - No DB Error if customer is flagged for closure      *
      *  226570 - Recompiled due to change in ZYLDZ2.                 *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits (Recompile)      *
      *  211407 - Recompile after change on copy sources ZYLDZ2,      *
      *           ZACCRZ1 and ZYCEZ1 for NX/NNX processing.           *
      *           The change was to call subroutine ZLCD1 instead     *
      *           of ZLCD in retrieving the PERIOD for NNX processing *
      *           and ZNCD1 is called instead of ZNCD in retrieving   *
      *           the WBENCD for NNX processing. Also rewrite tests   *
      *           for identifying if position is NX,NNX or CUM.       *
      *  208241 - Recompiled over changed /CPY ZSDESCZ3.              *
      *  207543 - CEU018 not working on a price basis.                *
      *           Recompiled over changed ZYLDZ2.                     *
      *  194370 - Recompile after change on copy sources ZYLDZ2,      *
      *           For securities with divisor basis = '5' and first   *
      *           coupon date > valuation date (rundate + 1), set     *
      *           event control date to first coupon date before      *
      *           processing SR/ZDYYR. This is to ensure that the     *
      *           correct hypothetical last and next coupon dates are *
      *           used in deriving the price/yield rate.              *
      *  180056 - Recompiled over changed in ZDYYRZ3.                 *
      *  CSE035 - NX/NNX Coupon Payment Processing.                   *
     F*  206316 - Recompiled over changed ZLCDZ1.                     *
      *  CPK015 - Conversion of ZYIELD from PLI to RPG.               *
      *           Recompile over changed ZYLDZ2.                      *
     F*  CSE031 - Coupon Fixing for Floating Rate Notes.              *
     F*           (recompilation due to change to ZNCD/ZLCD/ZACCR).   *
     F*  180707 - No Position Settlements generated. Recompile over   *
     F*           changes in /COPY ZNCDZ3.                            *
      *  127566 - Recompiled over changed ZSDESCZ3                    *
      *  148071 - When there is nothing to report in SE0950, there    *
      *           is no header in the report SE0950P1.                *
     F*  180218 - Caused by CSE006. 'Realised profit this month' not  *
     F*           shown on report if CSE006 is off.                   *
     F*  140272 - Recompile over changed ZYLDZ2                       *
      *  CDE001 - Data Export - CCRM Limits                           *
     F*  CSE006 - Repurchase Agreements (REPOs) enhancement           *
      *  CAC005 - PCA-SE Enhancement.                                 *
     F*  130862 - Recompiled over ZLCDZ1 & ZDAYSZ2 changes.           *
     F*  151945 - Recompiled Over changed ZDYYRZ3 .                   *
     F*  CEU017 - Securities Redenomination Euro Changes              *
     F*           Just recompile                                      *
     F*  CSE007 - Corporate Actions - Just recompile                  *
     F*  CSE005 - Effect of holidays on FRN Coupon Dates              *
     F*           (recompilation due to change to ZNCD/ZLCD/ZACCR).   *
     F*  084704 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
     F*  083039 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
     F*  059110 - Recompile over changed ZYLDZ2 sub.                  *
     F*  088047 - RECOMPILE over change SR/ZYLDZ2.                    *
     F*  100228 - RECOMPILE OVER CHANGED ZDYYRZ3, ZLCDZ1 & ZNCDZ3.    *
     F*  101959 - For processing type 8 use current factor from       *
     F*           TRADSD instead of SECTYD.                           *
     F*  099886 - Rounding problem for partly paid securities.        *
     F*           Fix applied is the same as in ZACCZ  subroutine.    *
     F*  100017 - Position settlement unable to pick up day adj. on   *
     F*           SECTYD. Change subroutine to use DADJN to stop      *
     F*           interest day adjustment being used for amortisation.*
     F*           Recompile over amended subroutine ZDAYS.            *
     F*  S01408 - Addition of core hook SE0950FFP1
     F*           Addition of core hook SE0950CCP1
     F*           Addition of core hook SE0950CCP2
     F*           Addition of core hook SE0950CCP3
     F*           Addition of core hook SE0950CCP4
     F*           Addition of core hook SE0950CCP5
     F*  092961 - Recompile over ZDAYSZ2 which was amended by 086491  *
     F*           (Wrong number of days calculated for day basis 1    *
     F*           when start or end day is last day of February)      *
     F*  091254 - RECOMPILE OVER CHANGED ZLCDZ1 & ZNCDZ3              *
     F*  086491 - Wrong nbr of days calculated for day basis 1        *
     F*           when start or end day is last day of February       *
     F*           Recompiled for ZSRSRC/ZDAYSZ2 changes.              *
     F*  S01496 - Incorporation of JYSKE Enhancements (S10978)        *
     F*  S01502 - BLI TELEKURS PROCESSING, RECOMPILED DUE TO CHANGE   *
     F*           IN LENGTH OF SESTAT, 133 LONG.                      *
     F*  064575 - Recompiled over amended ZYLDZ2 subroutine.          *
     F*  054257 - RECOMPILED as PREV CURRENT FACTOR amended from 9,8  *
     F*           to 10,9                                             *
     F*  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
     F*           to 10,9                                             *
     F*  051421 - Add Nominal Currency to Report.                     *
     F*  S01401 - MT5xx SWIFT Messages Feature:                       *
     F*          - Recompiled due to changes to files.                *
     F*  E39495 - New /COPY subroutine ZCALCD added (called from      *
     F*           sr. ZYLD)                                           *
     F*         - /COPY subroutines ZACCZZ1 (called from sr. ZYLD and *
     F*           ZCALCD)                                             *
     F*         - /COPY subroutines ZACCRZ1 and ZRATEZ1 added (called *
     F*           from sr. ZACCZ)                                     *
     F*         - Recompiled over changed ZYLDZ2                      *
     F*  E47922 - Recompiled over changed SR/ZYLDZ2                   *
     F*  047009 - Database Error reported for book position when      *
     F*           book position is OK; Month End drop has dropped     *
     F*           flat position.                                      *
     F*  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
     F*          - Recompiled due to changes to files and SR/ZYLD.    *
     F*  E40390 - Recompiled due to printer file change to display    *
     F*           customer town and name.                             *
     F*  E37419 - Correct Final Position line for matured securities  *
     F*  E35580 - Unauthorised deletions are counted as deletions     *
     F*  E33035 - Tries to output to a closed file                    *
     F*  E29170 - Report Control Facility program changes             *
     F*  E27092 - Recompiled over changed SR/ZLCD                     *
     F*  S01117 - Multibranching                                      *
     F*  S01269 - Trades Authorisation                                *
     F*  S01271 - Recompiled for Pay/Receive in Input Cycle changes   *
     F*           to TRADSD and/or DPTMVD                             *
     F*  E23674 - RECOMPILE OVER CHANGED PRINT FILE SE0950P1          *
     F*           FIELD FOR PRICE CHANGE DATE SHOULD BE 7 CHARACTERS  *
     F*  E23586 - Missing /COPY statement for ZAUPRZ1.                *
     F*  E21540 - 3 Previous fixes plus some original code still did  *   E21540
     F*           not give the correct results 100% of the time.      *   E21540
     F*           Also adjusted E17160 to make it simpler.            *   E21540
     F*  E21580 - Trades entered in Prior Month, then amended so that *   E21580
     F*           Trade Date is in Current Month, should be listed.   *   E21580
     F*  E21668 - Recompiled over changed SR/ZYLDZ2                   *   E21668
     F*  E21616 - Recompiled over changed SR/ZLCD.                    *   E21616
     F*  E21308 - Recompiled over changed Printer File.               *   E21308
     F*  E21002 - Report should use Contract Price for Trade Detail   *   E21002
     F*           line, not Trade Price.                              *   E21002
     F*  E20959 - All prices (inc price changes) should be shown as % *   E20959
     F*  E20621 - C/F Price for Flat positions was not zero.          *   E20621
     F*  E20125 - C/F Balance wrong for Trades Backvalued to previous *   E20125
     F*           Month, because they were being counted twice.       *   E20125
     F*         - Carried Forward figures should be set to zero for a *   E20125
     F*           Matured Security.                                   *   E20125
     F*         - Program recompiled for changes to Printer File.     *   E20125
     F*         - Ignore items with flat position and no activity.    *   E20125
     F*         - Amount fields are too small - large figures were    *   E20125
     F*           being truncated. Spread amounts out on the line and *   E20125
     F*           all of the amounts are now edited with commas.      *   E20125
     F*  E20145 - Exclude trades backvalued to previous month from    *   E20145
     F*           brought-forward position.                           *   E20145
     F*    Note:  We have NOT adjusted brought-forward price or       *   E20145
     F*           consideration, since these are less critical.       *   E20145
     F*  E19490 - Error in E20129 fix caused exclusion of securities  *   E19490
     F*           with maturity date 0 (shares, warrants, mutuals).   *   E19490
     F*  E20129 - Do not print Securities that had Matured by the end *   E20129
     F*           of Last Month.                                      *   E20129
     F*  E19408 - Carried Forward Short Consideration has the sign    *   E19408
     F*           removed for the report. Do the same for the Brought *   E19408
     F*           Forward figure to make it consistent. (Also changed *   E19408
     F*           the report to line up B/F and C/F comments).        *   E19408
     F*  E19505 - Errors in treatment of trades:                      *   E19505
     F*         - Wrong conditions for showing trade on V-Date report.*   E19505
     F*         - Cancelled trades should not affect C/F position.    *   E19505
     F*  E20085 - Interest and Coupon Calculations Rewrite:           *   E20085
     F*          - BACPT/V format is now correctly named BPACHDF.     *   E20085
     F*  E20086 - Mortgage-Backs and Current Factor Processing Rewrite*   E20086
     F*          - Consideration is now held on TRADSD exclusive of   *   E20086
     F*            the Current Factor, so it needs to be included.    *   E20086
     F*  E16772 - Recompiled for the Dividend Payment Amount field    *   E16772
     F*           changes.                                            *   E16772
     F*  E18657 - PROGRAM RECOMPILED DUE TO CHANGE TO PRINTER FILE    *   E17159
     F*  E17159 - L2 FOR CHANGE OF INVESTMENT TYPE NOT NECESSARY      *   E17159
     F*  E17160 - PREVENT INCOMPLETE TRADES FROM PRINTING.            *   E17160
     F*  E17161 - EDIT PROFIT, CONSIDERATION AND NOMINAL FIELDS WITH  *   E17161
     F*           COMMAS AND NEGATIVE SIGNS.                          *   E17161
     F*  E15594 - ERRONEOUS LINE COUNT CAUSES OVERFLOW ERROR.         *   E15594
     F*  E15279 - NEED TO CHECK DATE FORMAT TO SET UP RUNMY           *   E15279
     F*           THIS PREVENTS REALISED P & L FROM SHOWING AS ZERO   *   E15279
     F*  E14741 - TO DISPLAY '** MATURED **' FOR MATURED SECURITIES.  *   E14741
     F*  S01129 - DELIVERED FIX FOR SE                                *   S01129
     F*                                                               *
     F*****************************************************************
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
      *
     FBPOHTR  IP  E           K        DISK
     F*CLINT***IF  E           K        DISK                              S01117
     F*********** CLINTCAF                          KIGNORE               S01117
     F*********** CLINTCCF                          KIGNORE               S01117
     F*********** CLINTC1F                          KIGNORE               S01117
     F*********** CLINTSEF                          KIGNORE               S01117
     FSECTY   IF  E           K        DISK
     F*BOOKD***IF  E           K        DISK                              S01117
     FINVTP   IF  E           K        DISK
     FBKMTH   IF  E           K        DISK
     FBKPOS   IF  E           K        DISK
     FBACPV   IF  E           K        DISK
     FSEDEV   IF  E           K        DISK                               E20959
     FSEERALL2IF  E           K        DISK                           UC  S01496
     FSECEO   IF  E           K        DISK                               E39495
     F            SEDEVDF                           KRENAMESEDEVDO        E39495
     F            SNDEVDF                           KRENAMESNDEVDO        E39495
     FTRDMTH  IF  E           K        DISK
     F            HSTTRDF                           KIGNORE               CDE001
     FBSPOSDL1IF  E           K        DISK                               CSE006
     FTRADS   IF  E           K        DISK                               CSE006
     F            TRADSDF                           KRENAMETRADSD1        CSE006
     F*TABSE***IF  E           K        DISK                              S01117
     F*********** TABLETAF                          KIGNORE               S01117
     F*********** TABTB10F                          KIGNORE               S01117
     F*********** TABTB11F                          KIGNORE               S01117
     F*********** TABTB36F                          KIGNORE               S01117
     F*********** TABTE10F                          KIGNORE               S01117
     F*********** TABTE20F                          KIGNORE               S01117
     F*********** TABTG10F                          KIGNORE               S01117
     F*********** TABTG20F                          KIGNORE               S01117
     F*********** TABLETHF                          KIGNORE               S01117
     F*********** TABLETJF                          KIGNORE               S01117
     F*********** TABLETKF                          KIGNORE               S01117
     F*********** TABLETLF                          KIGNORE               S01117
     F*********** TABLETNF                          KIGNORE               S01117
     F*********** TABLETPF                          KIGNORE               S01117
     F*********** TABLETRF                          KIGNORE               S01117
     F*********** TABLETXF                          KIGNORE               S01117
     F*********** TABLET2F                          KIGNORE               S01117
     F*********** TABLET3F                          KIGNORE               S01117
     F*********** TABLET5F                          KIGNORE               S01117
     F*********** TABTB40F                          KIGNORE               S01117
     FSE0950AUO   E                    PRINTER                        UC
     F                                              KINFDS SPOOLU         E29170
     FSE0950P1O   E                    PRINTER                        UC
     F                                              KINFDS SPOOL          E29170
     F*                                                                   S01408
     F/COPY WNCPYSRC,SE0950FFP1                                           S01408
     F*                                                                   S01408
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*   01  - Book Position Header record read                      *
     F*   20  - First Price Change for this Position                  *
      *   30  - CAC005 ON                                             *   CAC005
     F*   32  - Details have been printed                             *   E29170
     F*   33  - General work indicator                                *
     F*   34  - End of records on BACPT/V for this Position           *
     F*   40  - Security has matured                                  *   E14741
     F*   51  - Position Long                                         *
     F*   52  - Position Short                                        *
     F*   53  - Position Flat                                         *
     F*   55  - READ ON BSPOSDL1                                      *   CSE006
     F*   61  - Trade to be listed on report                          *
     F*   63  - Buy SEll trade to be listed on report                 *   CSE006
     F*   64  - Linked Buy sell trade to be listed on report          *   CSE006
     F*   65  - On -> CSE006 On. Use in SE0950P1                      *   180218
     F*   62  - Trade to be Reversed out of B/F Nominal.              *   E21540
     F*   69  - Used to Control first cycle processing                *
     F*   71  - SETLL equal indicator for LF/SEERALL2                 *   S01496
     F*         (show transaction from ER)                            *   S01496
     F*   77  - One of above errors has occurred                      *
     F*   80  - Chain fail to TABTG10                                 *   E21002
     F*                                                               *   E29170
     F*   88  - Multibranching                                        *   E29170
     F*                                                               *
     F* 90-99 - Used in Standard Subroutines.                         *
     F*                                                               *
     F*   U7  - Database Error.                                       *
     F*   U8  - Database / Control Error                              *
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*  BSINFO - Print trade info for Buy - Sell books               *   CSE006
     F*  ZACCR  - Calculate accrued interest between two dates        *   E39495
     F*  ZACCZ  - Calculate accrued interest between two dates        *   E39495
     F*  *PSSR  - Error handling                                      *   S01117
     F*  RCFAU  - Define AU printer file to RCF program ZSFILE        *   E29170
     F*  RCFP1  - Define P1 printer file to RCF program ZSFILE        *   E29170
     F*  ZCALCD - Calculate long term CD price from input yield       *   E39495
     F*  ZBKCTP - Calculates bank's contract price                    *   E21002
     F*  ZCNSD  - Calculates consideration/book cost                  *   E21002
     F*  ZDATE2 - DAYNO - DATE conversion                             *
     F*  ZICD2  - Access ICD record 2                                 *
     F*  ZICDSE - Access ICD record for Securities Trading            *
     F*  ZRATE  - Calculate effective interest rate                   *   E39495
     F*  ZSDESC - Format Security Description                         *
     F*  ZSEDIT - Insert a decimal point into a numeric field and     *
     F*           blank out leading zeros                             *
     F*  ZSYSTM - Access ICD record                                   *
     F*                                                               *
     F*****************************************************************
      /EJECT
     E/COPY ZSRSRC,ZACCRZ0                                                E39495
     E                    CPY@    1   1 80
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY ZSRSRC,ZSEDITZ1
     E/COPY ZSRSRC,ZSDESCZ1
     E/COPY ZSRSRC,ZALIGNZ1
     E                    TABMKT  1   3  1   TABDSC  9
     E/COPY ZSRSRC,ZDAYSZ1                                                E20959
     E/COPY ZSRSRC,ZPOWER8Z1
     E/COPY ZSRSRC,ZNCDZ1                                                 E20959
      /EJECT
     IBKPHDDF     01
     I***********                                   BHBR  L5              S01117
     I                                              BHBA  L5              S01117
     I                                              BHBK  L4
     I                                              INVT  L3
     I                                              BHSC  L2
     I                                              BHMK  L1
     ITRADSDF
     I***********   CHTP                            XCHTP                 E35580
     I              RECI                            XRECI                 E35580
     ITRADSD1                                                             CSE006
     I              RECI                            RECI1                 CSE006
     ISDBANK    E DSSDBANKPD                                              S01117
     I** Bank details                                                     S01117
     ISDBOOK    E DSSDBOOKPD                                              S01117
     I** Book details                                                     S01117
     ISDBRCH    E DSSDBRCHPD                                              S01117
     I** Branch details                                                   S01117
     ISDCURR    E DSSDCURRPD                                              S01117
     I** Currency details                                                 S01117
     ISDCUST    E DSSDCUSTPD                                              S01117
     I              QQDFAC                          #DFAC1                                    CGL029
     I** Customer details                                                 S01117
     ISDSTRD    E DSSDSTRDPD                                              S01117
     I** Securities Trading ICD                                           S01117
      *                                                                   CAC005
     ISDPRFC    E DSSDPRFCPD                                              CAC005
      ** Profit Centre Accounting                                         CAC005
     I** Switchable features file                                         CSE006
     ISCSARD    E DSSCSARDPD                                              CSE006
      *
     IDSFDY     E DSDSFDY                                                 S01117
     I**  Short DS for access programs                                    S01117
     IDSSDY     E DSDSSDY                                                 S01117
     I**  Long  DS for access programs                                    S01117
      *                                                                    229342
      ** DS for access objects - long data structure                       229342
     IDSLDY     E DSDSLDY                                                  229342
      *
      /COPY ZSRSRC,ZSEDITZ2
      *
      ***  Local Data Area for DB Error Information
     ILDA         DS                            256                       S01117
     I                                      134 183 DBLOT                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     I*LDA******* UDS                            256                      S01117
     I***********                           134 177 DBLOT                 S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 177 DBASE                 S01117
     I*                                                                   S01117
     IRUNDT       DS                                                      S01117
     I** DATA AREA RUNDAT                                                 S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
      *                                                                   E20129
      *** SESTAT Data Structure (to get End of Last Month Date).          E20129
      *                                                                   E20129
     IDTAARA    E DSSESTAT                                                E20129
     I              EUTX                            EUTXB                                     CPK024
      *                                                                   E20129
     I            DS
     I                                        1  17 BKMERR
     I                                        1  10 BHSC
     I***********                            11  130BHBR                  S01117
     I                                       11  13 BHBA                  S01117
     I                                       14  15 BHBK
     I                                       16  16 BHMK
     I                                       17  17 BHTV
     I            DS
     I                                        1   6 INVERR
     I                                        1   3 NCRY
     I                                        4   6 INVT
     I            DS
     I                                        1  21 ZOUT21
     I                                       21  21 Z21SIG
     ISPOOL       DS                                                      E29170
      *                                                                   E29170
      **  DS FOR SPOOL FILE NAME                                          E29170
      *                                                                   E29170
     I                                       83  92 SFILE                 E29170
     I                                    B 123 1240SFNUM                 E29170
     I                                    B 188 1890OFLLN1                                  AR322165
     I                                    B 367 3680PRTLN1                                  AR322165
      *                                                                   E29170
     ISPOOLU      DS                                                      E29170
     I                                       83  92 SFILEU                E29170
     I                                    B 123 1240SFNUMU                E29170
     I*
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I/COPY ZSRSRC,ZNCDZ2                                                 E20959
     I/COPY ZSRSRC,ZYLDZ1                                                 E20959
     I/COPY ZSRSRC,ZSDESCZ2
     I/COPY WNCPYSRC,SE0950I001
     C/EJECT
      *================================================================
      *  P R O G R A M   S T A R T                                    *
      *================================================================
      *
      ***  First Time Processing
      *
     C           *IN69     IFEQ '0'
     C*                                                                   S01117
     C           *ENTRY    PLIST                                          S01117
     C                     PARM           SEQ     5                       S01117
     C                     PARM           ENT     3                       S01117
     C*
     C* Prepare LDA
     C*
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL*BLANK    DBLOT
     C                     MOVEL'SE0950'  DBPGM
     C                     OUT  LDA                                       S01117
     C                     MOVE 'L'       ZECODE
     C*
     C***********          Z-ADDBHBR      BHBR                            S01117
     C*                                                                   S01117
     C**   Read in RUNDAT                                                 S01117
     C*                                                                   S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C                     IN   RUNDT                                     S01117
      *                                                                   E29170
      ** Set multibranching indicator for printer file                    E29170
      *                                                                   E29170
     C           MBIN      IFEQ 'Y'                                       E29170
     C                     SETON                         88               E29170
     C                     END                                            E29170
     C**                                                                  S01117
     C**   Check System Date Format, DDMMYY or MMDDYY.                    S01117
     C**                                                                  S01117
     C           DATF      IFEQ 'M'                                       S01117
     C                     SETON                         98               S01117
     C                     END                                            S01117
     C*
     C**Get*installation*Control*data*record*1****************************S01117
     C***********                                                         S01117
     C***********          EXSR ZSYSTM                                    S01117
     C***********                                                         S01117
     C**Error*in*ZSYSTM***************************************************S01117
     C***********                                                         S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          OPEN SE0950AU                   ***************S01117
     C***********          MOVEL'01'      DBASE            * DB ERROR 01 *S01117
     C***********          MOVEL'TABLE'   DBFILE           ***************S01117
     C***********          MOVELZTABKY    DBKEY                           S01117
     C*                                                                   S01117
     C**   Access Bank Details                                            S01117
     C*                                                                   S01117
     C                     CALL 'AOBANKR0'                                S01117
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C           SDBANK    PARM SDBANK    DSFDY                           S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     OPEN SE0950AU                                  S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'SDBANK'  DBFILE           ***************S01117
     C                     Z-ADD1         DBASE            **DB ERROR 01 *S01117
     C                     MOVEL'*FIRST'  DBKEY            ***************S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   E29170
     C                     CLOSESE0950AU
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
     C*
     C**Get*Installation*Control*data*record*2****************************S01117
     C***********                                                         S01117
     C***********          EXSR ZICD2                                     S01117
     C***********                                                         S01117
     C**Error*in*ZICDSE***************************************************S01117
     C***********                                                         S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          OPEN SE0950AU                   ***************S01117
     C***********          MOVEL'02'      DBASE            * DB ERROR 02 *S01117
     C***********          MOVEL'TABLE'   DBFILE           ***************S01117
     C***********          MOVELZTABKY    DBKEY                           S01117
     C***********          WRITEHEADAU                                    S01117
     C***********          WRITEERROR                                     S01117
     C***********          WRITETRAILAU                                   S01117
     C***********          CLOSESE0950AU                                  S01117
     C***********          SETON                     U7U8LR               S01117
     C***********          RETRN                                          S01117
     C***********          END                                            S01117
     C***********                                                         S01117
     C**Get*Installation*Control*data*record*for*security*****************S01117
     C***********                                                         S01117
     C***********          EXSR ZICDSE                                    S01117
     C***********                                                         S01117
     C**Error*in*ZICDSE***************************************************S01117
     C***********                                                         S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          OPEN SE0950AU                   ***************S01117
     C***********          MOVEL'03'      DBASE            * DB ERROR 03 *S01117
     C***********          MOVEL'TABLE'   DBFILE           ***************S01117
     C***********          MOVELZTABKY    DBKEY                           S01117
     C*                                                                   S01117
     C**   Access Securities Trading ICD                                  S01117
     C*                                                                   S01117
     C                     CALL 'AOSTRDR0'                                S01117
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C           SDSTRD    PARM SDSTRD    DSSDY                           S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     OPEN SE0950AU                                  S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'SDSTRD'  DBFILE           ***************S01117
     C                     Z-ADD1         DBASE            **DB ERROR 01 *S01117
     C                     MOVEL'*FIRST'  DBKEY            ***************S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   E29170
     C                     CLOSESE0950AU
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
     C*
     C* Fetch Month and Year of run date - current and previous
     C*
     C                     Z-ADDRUND      ZDAYNO
     C                     EXSR ZDATE2
      *                                                                   E15279
     C*  NEED TO CHECK ON THE DATE FORMAT BEFORE MOVING ZDATE TO RUNMY    E15279
     C***********          MOVE ZDATE     RUNMY   4                       E15279
     C*                                                                   E15279
     C           *IN98     IFEQ '1'                                       E15279
     C                     MOVE ZDATE     WKYR    2                       E15279
     C                     MOVELZDATE     WKMTH   2                       E15279
     C                     MOVELWKMTH     RUNMY   4                       E15279
     C                     MOVE WKYR      RUNMY                           E15279
     C                     ELSE                                           E15279
     C                     MOVE ZDATE     RUNMY                           E15279
     C                     END                                            E15279
     C*                                                                   E15279
     C                     MOVELRUNMY     MONTH   20
     C                     MOVE RUNMY     YEAR    20
     C                     SUB  1         MONTH
     C           MONTH     IFEQ *ZEROS
     C                     Z-ADD12        MONTH
     C                     SUB  1         YEAR
     C           YEAR      IFLT *ZEROS
     C                     Z-ADD99        YEAR
     C                     END
     C                     END
     C                     MOVE YEAR      PREVMY  4
     C                     MOVELMONTH     PREVMY
      *                                                                   E20129
      ***  Get Data Area SESTAT and move End of Previous Month field      E20129
      ***  to a numeric field.                                            E20129
      *                                                                   E20129
     C           *NAMVAR   DEFN SESTAT    DTAARA                          E20129
     C                     IN   DTAARA                                    E20129
      *                                                                   E20129
     C                     MOVE EOPM      EOPMTH  50                      E20129
     C           CSE006    IFEQ 'Y'                                       180218
      *                                                                   CSE006
      ***  Move End of THIS Month field to a numeric field                CSE006
     C                     MOVE EOPT      EOTMTH  50                      CSE006
     C                     ENDIF                                          180218
     C*
     C* Set up report heading depending on file
     C*
     C                     MOVE ' DATE'   RPTTYP
     C           BHTV      IFEQ 'T'
     C                     MOVEL'TRADE'   RPTTYP
     C                     MOVE 'TRD'     DATTYP
     C                     ELSE
     C           BHTV      IFEQ 'V'
     C                     MOVEL'VALUE'   RPTTYP
     C                     MOVE 'VAL'     DATTYP
     C                     END
     C                     END
     C*
     C* Set up key to fetch investment type
     C*
     C           INVKA     KLIST
     C                     KFLD           NCRY
     C                     KFLD           INVT
     C*
     C* Set up key to access trades file
     C*
     C           TRDKA     KLIST
     C***********          KFLD           BHBR                            S01117
     C                     KFLD           BHBA                            S01117
     C                     KFLD           BHBK
     C                     KFLD           BHSC
     C                     KFLD           BHMK
     C*
     C* Set up key to fetch Book month record
     C*
     C           BKMKA     KLIST
     C                     KFLD           BHSC
     C***********          KFLD           BHBR                            S01117
     C                     KFLD           BHBA                            S01117
     C                     KFLD           BHBK
     C                     KFLD           BHMK
     C                     KFLD           BHTV
     C*
     C* Set up key to fetch latest book position record
     C*
     C           BKPKA     KLIST
     C                     KFLD           BHSC
     C***********          KFLD           BHBR                            S01117
     C                     KFLD           BHBA                            S01117
     C                     KFLD           BHBK
     C                     KFLD           BHMK
     C                     KFLD           BHTV
     C                     KFLD           BKED
     C*
     C**Set*up*key*to*fetch*BPACCD*record*via*BACPT/V******************   E20085
     C* Set up key to fetch BPACHD record via BACPT/V                     E20085
     C*
     C           BACKEY    KLIST
     C***********          KFLD           BHBR                            S01117
     C                     KFLD           BHBA                            S01117
     C                     KFLD           BHBK
     C                     KFLD           BHSC
     C                     KFLD           BHMK
     C                     KFLD           FROMDT
     C*
     C**Set*up*key*to*fetch*BPACCD*record*via*BACPT/V******************   E20085
     C* Set up key to fetch BPACHD record via BACPT/V                     E20085
     C*
     C           BACKY1    KLIST
     C***********          KFLD           BHBR                            S01117
     C                     KFLD           BHBA                            S01117
     C                     KFLD           BHBK
     C                     KFLD           BHSC
     C                     KFLD           BHMK
     C/COPY WNCPYSRC,SE0950CCP1                                           S01408
     C*                                                                   S01408
      ** Access SAR details file to see if CSE035 is installed                                CSE035
      *                                                                                       CSE035
     C                     CALL 'AOSARDR0'                                                    CSE035
     C                     PARM *BLANKS   @RTCD                                               CSE035
     C                     PARM '*VERIFY' @OPTN                                               CSE035
     C                     PARM 'CSE035'  @SARD                                               CSE035
      *                                                                                       CSE035
     C           @RTCD     IFEQ *BLANK                                                        CSE035
     C                     MOVE 'Y'       CSE035  1                                           CSE035
     C                     ELSE                                                               CSE035
     C                     MOVE 'N'       CSE035                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       207543
      ** Access SAR details file to see if CEU018 is installed                                207543
      *                                                                                       207543
     C                     CALL 'AOSARDR0'                                                    207543
     C                     PARM *BLANKS   @RTCD                                               207543
     C                     PARM '*VERIFY' @OPTN                                               207543
     C                     PARM 'CEU018'  WSARD                                               207543
      *                                                                                       207543
     C           @RTCD     IFEQ *BLANK                                                        207543
     C                     MOVE 'Y'       CEU018  1                                           207543
     C                     ELSE                                                               207543
     C                     MOVE 'N'       CEU018                                              207543
     C                     ENDIF                                                              207543
      *                                                                   S01496
      **  Access SAR details file to see if JYSKE Enhcmts is installed.   S01496
      *                                                                   S01496
     C                     CALL 'AOSARDR0'                                S01496
     C                     PARM '       ' @RTCD   7                       S01496
     C                     PARM '*VERIFY' @OPTN   7                       S01496
     C                     PARM 'S01496'  WSARD   6                       S01496
      *                                                                   S01496
     C           @RTCD     IFEQ *BLANK                                    S01496
     C                     MOVE 'Y'       S01496  1                       S01496
     C                     END                                            S01496
      *                                                                   CAC005
      ** Check if CAC005 - PCA-SE Enhancement is on.                      CAC005
      *                                                                   CAC005
     C                     MOVE 'N'       CAC005  1                       CAC005
     C                     MOVE *OFF      *IN30                           CAC005
     C                     CALL 'AOSARDR0'                                CAC005
     C                     PARM *BLANKS   @RTCD   7                       CAC005
     C                     PARM '*VERIFY' @OPTN   7                       CAC005
     C                     PARM 'CAC005'  @SARD   6                       CAC005
      *                                                                   CAC005
     C           @RTCD     IFEQ *BLANK                                    CAC005
     C                     MOVE 'Y'       CAC005                          CAC005
     C                     MOVE *ON       *IN30                           CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CSE006
      ** Access SAR details file to determine if CSE006                   CSE006
      ** (REPOS enhancement switchable feature) is on.                    CSE006
      *                                                                   CSE006
     C                     CALL 'AOSARDR0'                                CSE006
     C                     PARM *BLANKS   @RTCD                           CSE006
     C                     PARM '*VERIFY' @OPTN                           CSE006
     C                     PARM 'CSE006'  @SARD   6                       CSE006
     C           SCSARD    PARM SCSARD    DSFDY                           CSE006
      *                                                                   CSE006
      * Database Error                                                    CSE006
      *                                                                   CSE006
     C           @RTCD     IFNE *BLANKS                                   CSE006
     C           @RTCD     ANDNE'*NRF'                                    CSE006
     C                     OPEN SE0950AU                                  CSE006
     C           *LOCK     IN   LDA                                       CSE006
     C                     MOVEL'SCSARDPD'DBFILE           ***************CSE006
     C                     MOVEL'*FIRST'  DBKEY            * DB ERROR 13 *CSE006
     C                     Z-ADD13        DBASE            ***************CSE006
     C                     OUT  LDA                                       CSE006
     C                     EXSR *PSSR                                     CSE006
     C                     WRITEHEADAU                                    CSE006
     C                     WRITEERROR                                     CSE006
     C                     CLOSESE0950AU                                  CSE006
     C                     SETON                     U7U8LR               CSE006
     C                     RETRN                                          CSE006
     C                     ENDIF                                          CSE006
     C***  The indicator 65 is used to condition output in SE0950P1       180218
      *                                                                   CSE006
     C           @RTCD     IFEQ *BLANK                                    CSE006
     C                     MOVEL'Y'       CSE006  1                       CSE006
     C                     SETON                     65                   180218
     C                     ELSE                                           CSE006
     C                     MOVEL'N'       CSE006                          CSE006
     C                     SETOF                     65                   180218
     C                     ENDIF                                          CSE006
      *                                                                                     MD057247
      ** Access Switchable Features file to determine if CSE031 is                          MD057247
      ** installed in the system.                                                           MD057247
      *                                                                                     MD057247
     C                     CALL 'AOSARDR0'                                                  MD057247
     C                     PARM           URTNCD  7                                         MD057247
     C                     PARM '*VERIFY' UOPTN   7                                         MD057247
     C                     PARM 'CSE031'  UUKEY   6                                         MD057247
     C                     PARM           UDSFDY 76                                         MD057247
      *                                                                                     MD057247
     C                     MOVE 'N'       CSE031  1                                         MD057247
     C           URTNCD    IFEQ *BLANKS                                                     MD057247
     C                     MOVE 'Y'       CSE031                                            MD057247
     C                     ENDIF                                                            MD057247
      *                                                                                     MD057247
      ** Access Switchable Features file to determine if CSE071 is                          MD057247
      ** installed in the system.                                                           MD057247
      *                                                                                     MD057247
     C                     CALL 'AOSARDR0'                                                  MD057247
     C                     PARM           URTNCD                                            MD057247
     C                     PARM '*VERIFY' UOPTN                                             MD057247
     C                     PARM 'CSE071'  UUKEY                                             MD057247
     C                     PARM           UDSFDY                                            MD057247
      *                                                                                     MD057247
     C                     MOVE 'N'       CSE071  1                                         MD057247
     C           URTNCD    IFEQ *BLANKS                                                     MD057247
     C                     MOVE 'Y'       CSE071                                            MD057247
     C                     ENDIF                                                            MD057247
     C*
     C                     SETON                     69
     C                     END
      *
      *================================================================
      /EJECT
      *================================================================
      *  L E V E L   B R E A K   5   -   B R A N C H                  *
      *================================================================
      *
     C   L5                DO
      *                                                                   E29170
      ** If report is for only one branch and the branch read is not      E29170
      ** that required then skip to end.                                  E29170
      *                                                                   E29170
     C           ENT       IFEQ 'ALL'                                     E29170
     C           ENT       OREQ '   '                                     E29170
     C           ENT       OREQ BHBA                                      E29170
     C*
     C* Fetch Branch name
     C*
     C***********          MOVE *BLANKS   KEY12A 12                       S01117
     C***********          MOVEL'10'      KEY12A                          S01117
     C***********          MOVE BHBR      KEY12A                          S01117
     C***********KEY12A    CHAINTABLETRF             33                   S01117
     C**N33******RECI      COMP '*'                      33               S01117
     C************IN33     IFEQ '1'                                       S01117
     C***********          OPEN SE0950AU                   ***************S01117
     C***********          MOVEL'04'      DBASE            * DB ERROR 04 *S01117
     C***********          MOVEL'TABLE'   DBFILE           ***************S01117
     C***********          MOVELKEY12A    DBKEY                           S01117
     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM BHBA      @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01117              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     OPEN SE0950AU                                  S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'SDBRCH'  DBFILE           ***************S01117
     C                     Z-ADD4         DBASE            **DB ERROR 04 *S01117
     C                     MOVELBHBA      DBKEY            ***************S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   E29170
     C                     CLOSESE0950AU
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
     C*
     C* Open printer file, reset page number and print heading
     C*
     C                     Z-ADD*ZEROS    PAGE
     C                     OPEN SE0950P1
     C                     EXSR RCFP1                                     E29170
      *                                                                   E29170
      ** Set up field to say details have been printed                    E29170
      *                                                                   E29170
     C                     MOVE '1'       *IN32                           E29170
     C                     MOVE 'Y'       FILOPN  1                       E33035
      *                                                                   E29170
     C                     ELSE                                           E29170
     C                     MOVE '1'       *INLR                           E29170
     C                     GOTO MTJUMP                                    E29170
     C                     END                                            E29170
     C*
     C   L5                END
      *
      *================================================================
      *  L E V E L   B R E A K   4   -   B O O K                      *
      *================================================================
      *
     C   L4                DO
     C*
     C* Fetch Book description
     C*
     C***********BHBK      CHAINBOOKD                33                   S01117
     C**N33******RECI      COMP '*'                      33               S01117
     C************IN33     IFEQ '1'                                       S01117
     C***********          OPEN SE0950AU                   ***************S01117
     C***********          MOVEL'05'      DBASE            * DB ERROR 05 *S01117
     C***********          MOVEL'BOOKD'   DBFILE           ***************S01117
     C***********          MOVELBHBK      DBKEY                           S01117
      *                                                                   CAC005
      ** Move book to printer book code                                   CAC005
      *                                                                   CAC005
     C                     MOVE BHBK      PBKCD                           CAC005
      *                                                                   CAC005
      ** If CAC005 is on, retrieve user book from AOBKPCR0.               CAC005
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     CALL 'AOBKPCR0'                                CAC005
     C                     PARM           PRTCD   7                       CAC005
     C                     PARM '*USER  ' POPTN   7                       CAC005
     C           PMBKCD    PARM *BLANKS   PMBKCD  2                       CAC005
     C           PMPRFC    PARM *BLANKS   PMPRFC  4                       CAC005
     C                     PARM BHBK      PMPSBK  2                       CAC005
      *                                                                   CAC005
     C           PRTCD     IFEQ *BLANKS                                   CAC005
     C                     MOVELPMBKCD    PBKCD                           CAC005
     C                     MOVE PMPRFC    PPRFC                           CAC005
      *                                                                   CAC005
     C                     CALL 'AOPRFCR0'                                CAC005
     C                     PARM           @RTCD                           CAC005
     C                     PARM '*KEY   ' @OPTN                           CAC005
     C                     PARM PPRFC     @PRFC   4                       CAC005
     C           SDPRFC    PARM SDPRFC    DSFDY                           CAC005
      *                                                                   CAC005
     C           @RTCD     IFEQ *BLANKS                                   CAC005
     C                     MOVE DSPCDS    PPCDS  30                       CAC005
     C                     ELSE                                           CAC005
     C                     MOVE *BLANKS   PPCDS                           CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C                     ELSE                                           CAC005
     C                     MOVEL*BLANKS   PPRFC                           CAC005
     C                     MOVE *BLANKS   PPCDS                           CAC005
     C                     ENDIF                                          CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C                     CALL 'AOBOOKR0'                                S01117
     C                     PARM '*MSG    '@RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C***********          PARM BHBK      @BOOK   2                S01117 CAC005
     C                     PARM PBKCD     @BOOK   2                       CAC005
     C           SDBOOK    PARM SDBOOK    DSFDY                           S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     OPEN SE0950AU                                  S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'SDBOOK'  DBFILE           ***************S01117
     C                     Z-ADD5         DBASE            **DB ERROR 05 *S01117
     C***********          MOVELBHBK      DBKEY            ********S01117*CAC005
     C                     MOVELPBKCD     DBKEY                           CAC005
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   E29170
     C                     CLOSESE0950AU
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0950CCP2                                           S01408
     C*                                                                   S01408
     C*
     C   L4                END
      *
      *================================================================
      ***L*E*V*E*L***B*R*E*A*K***3***-***I*N*V*E*S*T*M*E*N*T***T*Y*P*E*   E17159
      *================================================================
      *================================================================   E17159
      *  L E V E L   B R E A K   2   -   S E C U R I T Y              *   E17159
      *================================================================   E17159
      *
     C***L3******          DO                                             E17159
     C   L2                DO                                             E17159
     C*
     C* Fetch Investment type description
     C*
     C           INVKA     CHAININVTPDF              33
     C  N33      RECI      COMP '*'                      33
     C           *IN33     IFEQ '1'
     C                     OPEN SE0950AU                                  S01117
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVEL'07'      DBASE            ***************S01117
     C                     Z-ADD7         DBASE            * DB ERROR 07 *S01117
     C                     MOVEL'INVTP'   DBFILE           ***************
     C                     MOVELINVERR    DBKEY
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   E29170
     C                     CLOSESE0950AU
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0950CCP3                                           S01408
     C*                                                                   S01408
     C*
     C***L3******          END                                            E17159
      *
      *================================================================
      ***L*E*V*E*L***B*R*E*A*K***2***-***S*E*C*U*R*I*T*Y***************   E17159
      *================================================================
      *
     C***L2******          DO                                             E17159
     C*
     C* Fetch Security details
     C*
     C           BHSC      CHAINSECTYDF              33
     C  N33      RECI      COMP '*'                      33
     C  N33      RECI      COMP 'M'                      40               E14741
     C           *IN33     IFEQ '1'
     C                     OPEN SE0950AU                                  S01117
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVEL'06'      DBASE            ***************S01117
     C                     Z-ADD6         DBASE            * DB ERROR 06 *S01117
     C                     MOVEL'SECTY'   DBFILE           ***************
     C                     MOVELBHSC      DBKEY
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   E29170
     C                     CLOSESE0950AU
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
     C/COPY WNCPYSRC,SE0950C004
      *                                                                   E20129
      ***  Securities that matured by the End of Last Month should not    E20129
      ***  appear on this report.                                         E20129
      *                                                                   E20129
     C           MATY      IFLE EOPMTH                                    E20129
     C           MATY      ANDNE0                                         E19490
      *                                                                   E19490
      ***  Jump to just before Change of Branch Processing at the end     E20129
      ***  of the Main Section.                                           E20129
     C                     GOTO MTJUMP                                    E20129
     C                     END                                            E20129
     C*
     C* Fetch short description
     C*
     C                     MOVE SRPN      ZSRPN
     C                     MOVE *BLANKS   ZSFN1
     C                     MOVE *BLANKS   ZSFN2
     C                     MOVE BVRIDF    ZRSFD                           S01117
     C                     EXSR ZSDESC
     C*
     C   L2                END
      *
      *================================================================
      *  L E V E L   B R E A K   1   -   M A R K E T                  *
      *================================================================
      *
     C   L1                DO
     C*
     C* Fetch market description
     C*
     C                     MOVE *BLANKS   MARKET
     C           BHMK      LOKUPTABMKT    TABDSC         33
     C   33                MOVE TABDSC    MARKET
     C                     MOVE *BLANKS   HDFLAG  1                       E20125
      *                                                                   E20125
     C**Print*header*lines*********************************************   E20125
      ***  Don't output headings unless position/activity found.          E20125
      *                                                                   E20125
     C***********          WRITEHEADER                                    E20125
     C***********          Z-ADD17        LCOUNT  20               E15594 E20125
     C***********          Z-ADD18        LCOUNT  20               E15594 E20125
     C*
     C   L1                END
      *
      *================================================================
      /EJECT
     C*
     C* Fetch nominal currency decimal places
     C*
     C***********          MOVE *BLANKS   KEY12A 12                       S01117
     C***********          MOVELNCRY      WORK4A  4                       S01117
     C***********          MOVE '1'       WORK4A                          S01117
     C***********          MOVEL'20'      KEY12A                          S01117
     C***********          MOVE WORK4A    KEY12A                          S01117
     C***********KEY12A    CHAINTABTG10F             33                   S01117
     C**N33******RECI      COMP '*'                      33               S01117
     C************IN33     IFEQ '1'                                       S01117
     C***********          OPEN SE0950AU                   ***************S01117
     C***********          MOVEL'11'      DBASE            * DB ERROR 11 *S01117
     C***********          MOVEL'TABLE'   DBFILE           ***************S01117
     C***********          MOVELKEY12A    DBKEY                           S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*MSG    '@RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM NCRY      @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     OPEN SE0950AU                                  S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'SDCURR'  DBFILE           ***************S01117
     C                     Z-ADD11        DBASE            **DB ERROR 11 *S01117
     C                     MOVELNCRY      DBKEY            ***************S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   E29170
     C                     CLOSESE0950AU
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
      *                                                                   051421
      ***  Save Nominal Currency Name for Report.                         051421
      *                                                                   051421
     C                     MOVE A6CYNM    RCYNM                           051421
     C*
     C* Identify work field to be used - based on Nominal Currency
     C* Decimal Places
     C*
     C                     MOVEA'0000'    *IN,41
     C***********CDP       COMP 1                    334142               S01117
     C***33******CDP       COMP 2                    44  43               S01117
     C           A6NBDP    COMP 1                    334142               S01117
     C   33      A6NBDP    COMP 2                    44  43               S01117
      *
      *================================================================
      /EJECT
     C*
     C* Fetch Book/month record for previous month
     C*
     C           BKMKA     SETLLBKMTHDF
     C                     SETOF                     33
     C                     MOVE *BLANKS   BKMY
      *
     C           BKMY      DOUEQPREVMY
     C           *IN33     OREQ '1'
     C           BKMKA     READEBKMTHDF                  33
     C                     END
     C*
     C* If not found - ASSUME EMPTY FIELDS AND DO NOT ACCESS BKPOSD
     C*
     C           *IN33     IFEQ '1'
     C*
     C                     Z-ADD0         APPB
     C                     Z-ADD0         NPSN
      *                                                                   E21540
      ***  Following part of E20125 removed because processing changed    E21540
      ***  so that all actions reported will update the B/F Balance.      E21540
      ***********                                                  E20125 E21540
      *****Must*zero*NOMTOT*here*because*Z-ADD*statement*has*been*moved 5 E21540
      *****inside*the*ELSE*part*of*this*IF-statement.************* E20125 E21540
     C***********          Z-ADD0         NOMTOT                   E20125 E21540
     C***********          Z-ADD0         LAVP
     C                     Z-ADD0         BKED
     C                     ELSE
     C*
     C* Fetch latest position
      *                                                                   CSE006
     C           CSE006    IFEQ 'Y'                                       CSE006
     C           BDBYSL    ANDNE'Y'                                       CSE006
     C           CSE006    ORNE 'Y'                                       CSE006
     C*
     C           BKPKA     SETGTBKPOSDF
     C                     READPBKPOSDF                  33
     C           *IN33     IFEQ '1'
     C           BHSC      ORNE BPSC
     C***********BHBR      ORNE BPBR                                      S01117
     C           BHBA      ORNE BPBA                                      S01117
     C           BHBK      ORNE BPBK
     C           BHMK      ORNE BPMK
     C           BHTV      ORNE BPTV
     C                     Z-ADD0         APPB                            047009
     C                     Z-ADD0         NPSN                            047009
     C***********          OPEN SE0950AU                           S01117 047009
     C************LOCK     IN   LDA                                S01117 047009
     C***********          MOVEL'09'      DBASE            ***************S01117
     C***********          Z-ADD9         DBASE            * DB 09*S01117 047009
     C***********          MOVEL'BKPOS'   DBFILE           ***************047009
     C***********          MOVELBKMERR    WORK21 21                       047009
     C***********          MOVE BKED      WORK21                          047009
     C***********          MOVELWORK21    DBKEY                           047009
     C***********          OUT  LDA                                S01117 047009
     C***********          EXSR *PSSR                              S01117 047009
     C***********          WRITEHEADAU                                    047009
     C***********          WRITEERROR                                     047009
     C***********          WRITETRAILAU                                   E29170
     C***********          CLOSESE0950AU                                  047009
     C***********          SETON                     U7U8LR               047009
     C***********          RETRN                                          047009
     C                     END
      *                                                                   E21540
      ***  Following part of E20125 removed because processing changed    E21540
      ***  so that all actions reported will update the B/F Balance.      E21540
      ***********                                                  E20125 E21540
      *****This*statement*moved*from*below*so*that*we*can*catch*theE20125 E21540
      *****Nominal*before*it*is*adjusted,*as*Detail*processing*willE20125 E21540
      *****still*adjust*the*value*to*carry*forward.*************** E20125 E21540
     C***********          Z-ADDNPSN      NOMTOT                   E20125 E21540
     C*                                                                   E20145
      *                                                                   CSE006
      *                                                                   CSE006
     C** S/R BVTRDS adjusts brought-forward nominal for trades entered    E20145
     C** this month with trade/value dates in prior months.               E20145
     C                     EXSR BVTRDS                                    E20145
     C*                                                                   E20145
     C                     ENDIF                                          CSE006
     C                     END
     C*
     C* Setup fields for printing
      ***  Only do so if the book is not a buy-sell book                  CSE006
      *                                                                   CSE006
     C           CSE006    IFEQ 'Y'                                       CSE006
     C           BDBYSL    ANDNE'Y'                                       CSE006
     C           CSE006    ORNE 'Y'                                       CSE006
     C*
     C* Price
     C*
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE APPB      ZFLD15
     C                     Z-ADD8         ZDECS
     C                     MOVE 'L'       ZECODE                          E20125
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    BFPRIC
     C*
     C* Nominal
     C*
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE NPSN      ZFLD15
     C                     MOVE 'J'       ZECODE                          E17161
     C                     Z-ADDNMDP      ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE *BLANK    Z21SIG
     C                     MOVE ZOUT21    BFNOML
     C*
      ***  Following statement replaced because processing changed so     E21540
      ***  that all actions reported will update the B/F Balance.         E21540
      *****This*statement*moved*to*before*execution*of*SR/BVTRDS*so*as 25 E21540
      *****to*use*the*unadjusted*Nominal*as*base*for*C/F*Position. E20125 E21540
     C*
     C* Use as base for Carried forward position
     C*
     C***********          Z-ADDNPSN      NOMTOT                          E20125
     C                     Z-ADDNPSN      NOMTOT                          E21540
     C*
     C* Position
     C*
     C           NPSN      COMP *ZEROS               515253
     C   51                MOVE 'LONG '   BFPOSN
     C   52                MOVE 'SHORT'   BFPOSN
     C   53                MOVE 'FLAT '   BFPOSN
     C*
     C* Consideration
     C*
     C   41      NPSN      MULT APPB      CON150 150H
     C   42      NPSN      MULT APPB      CON151 151H
     C   43      NPSN      MULT APPB      CON152 152H
     C   44      NPSN      MULT APPB      CON153 153H
     C*
     C* If Price basis 'P', divide by 100
     C*
     C           SPBS      IFEQ 'P'
     C   41      CON150    DIV  100       CON150    H
     C   42      CON151    DIV  100       CON151    H
     C   43      CON152    DIV  100       CON152    H
     C   44      CON153    DIV  100       CON153    H
     C                     END
     C*
     C* If Processing type '8', multiply by Current factor
     C*
     C           PROT      IFEQ '8'
     C/COPY WNCPYSRC,SE0950C005
     C   41      CON150    MULT CFCT      CON150    H
     C   42      CON151    MULT CFCT      CON151    H
     C   43      CON152    MULT CFCT      CON152    H
     C   44      CON153    MULT CFCT      CON153    H
     C                     END
     C/COPY WNCPYSRC,SE0950C001
     C*
     C                     MOVE *BLANKS   ZFLD15
     C   41                MOVE CON150    ZFLD15
     C   42                MOVE CON151    ZFLD15
     C   43                MOVE CON152    ZFLD15
     C   44                MOVE CON153    ZFLD15
     C           5         SUB  NMDP      ZI      20
     C           ZFLD15    MULT POWER8,ZI ZFLD15    H
     C                     MOVE 'J'       ZECODE                          E17161
     C***********          Z-ADDCDP       ZDECS                           S01117
     C                     Z-ADDA6NBDP    ZDECS                           S01117
     C                     EXSR ZSEDIT
     C                     MOVE *BLANKS   Z21SIG                          E19408
     C                     MOVE ZOUT21    BFCONS
     C*
     C* Print Brought forward line
     C*
     C           NPSN      IFNE 0                                         E20125
     C                     MOVE 'Y'       HDFLAG                          E20125
     C                     WRITEHEADER                                    E20125
     C                     WRITEBFLINE
     C***********          ADD  2         LCOUNT                          E20125
     C**********           Z-ADD20        LCOUNT  20                                 E20125 AR322165
      *                                                                   CAC005
     C********** CAC005    IFEQ 'Y'                                                  CAC005 AR322165
     C**********           ADD  1         LCOUNT                                     CAC005 AR322165
     C**********           ENDIF                                                     CAC005 AR322165
      *                                                                   CAC005
     C                     END                                            E20125
      *
      *================================================================
      /EJECT
      *                                                                                     AR322165
      **  Initialise work fields for overflow calculation.                                  AR322165
      *                                                                                     AR322165
     C                     Z-ADD0         RQDLN1  30                                        AR322165
     C                     Z-ADD0         PRTLN1                                            AR322165
     C*
     C* Fetch Trade records
     C*
     C           TRDKA     SETLLTRADSDF
     C                     SETOF                     33
      *
     C           *IN33     DOWEQ'0'
     C           TRDKA     READETRADSDF                  33
     C           *IN33     IFEQ '1'
     C*
     C* At end of records for this position, check price changes
     C*
     C                     EXSR PRICE
     C                     SETOF                     20
      *
     C                     ELSE
      *
     C                     SETOF                     61
     C*
     C* Check record valid for inclusion
     C*
      ***  Only Complete Trades to be processed - adjusted E17160         E21540
      ***  change to simplify the following conditioning a little.        E21540
      *                                                                   E21540
     C           TINC      IFEQ 'C'                                       E21540
      *                                                                   E21540
      ***  If Trade Date Reporting.                                       E21540
     C           BHTV      IFEQ 'T'
      *
      ***  If entered This Month.                                         E21540
     C           TOED      IFGT BKED
      *                                                                   E21580
      ***  OR entered in a Prior Month but with the Trade Date amended    E21580
      ***  so that it is in This Month.                                   E21580
     C           TDDT      ORGT BKED                                      E21580
      *                                                                   E21580
     C***********RECI      IFEQ 'D'                                       E35580
     C***********RECI      OREQ 'S'                                       E35580
     C***********RECI      OREQ 'R'                                S01269 E35580
     C           XRECI     IFEQ 'D'                                       E35580
     C           XRECI     OREQ 'S'                                       E35580
     C           XRECI     OREQ 'R'                                       E35580
     C***********TINC      IFNE 'I'                                E17160 E21540
     C                     SETON                     61
     C***********          END                                     E17160 E21540
     C                     END
     C                     END
     C*
      ***  OR, If entered in a Prior Month and Reversed This Month.       E21540
     C***********XCHTP     IFEQ 'D'                                       E35580
     C***********RECI      ANDNE'R'                                S01269 E35580
     C           XRECI     IFEQ '*'                                       E35580
     C           LCD       ANDGTBKED
     C           TOED      ANDLEBKED
     C***********TINC      IFNE 'I'                                E17160 E21540
     C                     SETON                     61
     C***********          END                                     E17160 E21540
     C                     END
      *
      ***  ELSE, If Value Date Reporting.                                 E21540
     C                     ELSE
      *
      ***  IFs rewritten - what is required is Trades Entered This        E21540
      ***  Month Valued up to Today OR Trades entered Last Month that     E21540
      ***  are Valued This Month up to Today.                             E21540
      *                                                                   E21540
     C** Next line excluded trades entered last month valued this month.  E19505
     C***********TOED      IFGT BKED                                      E19505
     C***********TDVD      IFGT BKED                               E19505 E21540
     C***********TDVD      ANDLERUND                                      E21540
      *                                                                   E21540
     C           TOED      IFGT BKED                                      E21540
     C           TOED      ORLE BKED                                      E21540
     C           TDVD      ANDGTBKED                                      E21540
      *                                                                   E21540
     C           TDVD      IFLE RUND                                      E21540
     C***********RECI      IFEQ 'D'                                       E35580
     C***********RECI      OREQ 'S'                                       E35580
     C***********RECI      OREQ 'R'                                S01269 E35580
     C           XRECI     IFEQ 'D'                                       E35580
     C           XRECI     OREQ 'S'                                       E35580
     C           XRECI     OREQ 'R'                                       E35580
     C***********TINC      IFNE 'I'                                E17160 E21540
     C                     SETON                     61
     C***********          END                                     E17160 E21540
     C                     END
     C                     END
     C                     END                                            E21540
     C*
     C***********XCHTP     IFEQ 'D'                                       E35580
     C***********RECI      ANDNE'R'                                S01269 E35580
     C           XRECI     IFEQ '*'                                       E35580
     C           LCD       ANDGTBKED
      *                                                                   E21540
      ***  What is required here is Reversals of Trades both Entered      E21540
      ***  AND Valued Last Month.                                         E21540
      *                                                                   E21540
     C***Only*show*reversals*of*trades*VALUED*last*month.********* E19505 E21540
      *                                                                   E21540
     C***********TOED      ANDLEBKED                                      E19505
     C           TOED      ANDLEBKED                                      E21540
     C           TDVD      ANDLEBKED                                      E19505
     C***********TINC      IFNE 'I'                                E17160 E21540
     C                     SETON                     61
     C***********          END                                     E17160 E21540
     C                     END
      *
     C                     END
     C                     END                                            E21540
     C*
     C* Ok to include
     C*
     C           *IN61     IFEQ '1'
     C*                                                                   E20125
     C* Output headings and B/F line if not already done.                 E20125
     C*                                                                   E20125
     C           HDFLAG    IFNE 'Y'                                       E20125
     C                     MOVE 'Y'       HDFLAG                          E20125
     C                     WRITEHEADER                                    E20125
     C                     WRITEBFLINE                                    E20125
     C**********           Z-ADD20        LCOUNT  20                                 E20125 AR322165
      *                                                                   CAC005
     C********** CAC005    IFEQ 'Y'                                                  CAC005 AR322165
     C**********           ADD  1         LCOUNT                                     CAC005 AR322165
     C**********           ENDIF                                                     CAC005 AR322165
      *                                                                   CAC005
     C                     END                                            E20125
     C*
     C* Print price changes for selected records
     C*
     C***********XCHTP     IFNE 'D'                                       E35580
     C           XRECI     IFNE '*'                                       E35580
     C                     EXSR PRICE
     C                     END
     C*
     C* Add nominal to total for Carried forward position
     C*
      ***  Because of changes to processing, the following is no longer   E21540
      ***  true and therefore E19505 fix has been removed.                E21540
     C**Ignore*cancellations*-*B/F*position*already*reflects*them. E19505 E21540
      *
     C***********XCHTP     IFNE 'D'                                E19505 E21540
     C           TDTP      IFEQ 'TP'
     C***********XCHTP     IFEQ 'D'                                       E19505
     C***********          SUB  NOML      NOMTOT 150                      E19505
     C***********          ELSE                                           E19505
      *                                                                   E21540
     C***********XCHTP     IFEQ 'D'                                E21540 E35580
     C           XRECI     IFEQ '*'                                       E35580
     C                     SUB  NOML      NOMTOT 150                      E21540
     C                     ELSE                                           E21540
     C                     ADD  NOML      NOMTOT 150
     C***********          END                                            E19505
     C                     END                                            E21540
      *                                                                   E21540
     C                     ELSE
     C***********XCHTP     IFEQ 'D'                                       E19505
     C***********          ADD  NOML      NOMTOT 150                      E19505
     C***********          ELSE                                           E19505
      *                                                                   E21540
     C***********XCHTP     IFEQ 'D'                                E21540 E35580
     C           XRECI     IFEQ '*'                                       E35580
     C                     ADD  NOML      NOMTOT 150                      E21540
     C                     ELSE                                           E21540
     C                     SUB  NOML      NOMTOT
     C                     END
      *                                                                   E21540
     C                     END
     C*
     C* Format fields for printing
     C*
     C* Value date  OR TRADE DATE
     C*
     C           BHTV      IFEQ 'T'
     C                     Z-ADDTDDT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    VALDAT
     C                     ELSE
     C                     Z-ADDTDVD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    VALDAT
     C                     END
     C*
     C* Fetch Customer Report name and town
     C*
     C***********TCNR      CHAINCLINTCBF             33                   S01117
     C**N33******RECI      COMP '*'                      33               S01117
     C************IN33     IFEQ '1'                                       S01117
     C***********          OPEN SE0950AU                   ***************S01117
     C***********          MOVEL'10'      DBASE            * DB ERROR 10 *S01117
     C***********          MOVEL'CLINT'   DBFILE           ***************S01117
     C***********          MOVELTCNR      DBKEY                           S01117
     C                     MOVELTCNR      @KEY1                           S01117
     C*********************CALL 'AOCUSTR0'                         S01117 229342
     C                     CALL 'AOCUSTR1'                                229342
     C                     PARM           @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM           @KEY1  10                       S01117
     C                     PARM           @KYST   7                       S01117
     C***********SDCUST    PARM SDCUST    DSSDY                    S01117 229342
     C           SDCUST    PARM SDCUST    DSLDY                           229342
     C           @RTCD     IFNE *BLANKS                                   S01117
     C           BBCLST    ANDNE'Y'                                       229342
     C                     OPEN SE0950AU                                  S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'SDCUST'  DBFILE           ***************S01117
     C                     Z-ADD10        DBASE            **DB ERROR 10 *S01117
     C                     MOVELTCNR      DBKEY            ***************S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   E29170
     C                     CLOSESE0950AU
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
     C*
     C* Set up Trade type
     C*
     C                     MOVE *BLANKS   TRDTYP
      *
     C           TDTP      IFEQ 'TP'
     C                     MOVEL'BOUGHT A'WORK9   9
     C                     MOVE 'T'       WORK9
     C                     ELSE
     C           TDTP      IFEQ 'TS'
     C                     MOVEL'SOLD AT 'WORK9   9
     C                     MOVE ' '       WORK9
     C                     END
     C                     END
      *
     C                     MOVELWORK9     TRDTYP
     C***********XCHTP     IFEQ 'D'                                       E35580
     C           XRECI     IFEQ '*'                                       E35580
     C                     MOVE '(REV)'   TRDTYP
     C                     END
     C*                                                                   S01496
     C*    Check if current Trade was previously generated by ER          S01496
     C*                                                                   S01496
     C           S01496    IFEQ 'Y'                        *B1            S01496
     C                     OPEN SEERALL2                                  S01496
     C           TDRF      SETLLSEERALL2                 71               S01496
     C           *IN71     IFEQ '1'                        *B2 FOUND      S01496
     C           TDTP      IFEQ 'TP'                       *B3            S01496
     C           XRECI     ANDEQ'*'                                       S01496
     C                     MOVE '(RRI)'   TRDTYP                          S01496
     C                     ELSE                                           S01496
     C           TDTP      IFEQ 'TP'                       *B4            S01496
     C                     MOVE ' (RI)'   TRDTYP                          S01496
     C                     ELSE                                           S01496
     C           TDTP      IFEQ 'TS'                       *B5            S01496
     C           XRECI     ANDEQ'*'                                       S01496
     C                     MOVE '(RRO)'   TRDTYP                          S01496
     C                     ELSE                                           S01496
     C           TDTP      IFEQ 'TS'                       *B6            S01496
     C                     MOVE ' (RO)'   TRDTYP                          S01496
     C                     END                             *E6            S01496
     C                     END                             *E5            S01496
     C                     END                             *E4            S01496
     C                     END                             *E3            S01496
     C                     END                             *E2            S01496
     C                     CLOSESEERALL2                                  S01496
     C                     END                             *E1            S01496
     C*
     C* Price
     C* NEED TO USE CONTRACT PRICE                                        E21002
     C* USE TRADE FILE TRADE NOMINAL CURRENCY FIELD TNMC                  E21002
      *                                                                   E21002
     C***********          MOVEL'20      'TKEY   12                       E21002
     C***********          MOVELTNMC      ZWK4    4                       E21002
     C***********          MOVE 1         ZWK4                            E21002
     C***********          MOVE ZWK4      TKEY                            E21002
     C***********TKEY      CHAINTABTG10F             80                   E21002
     C**N80******RECI      COMP 'D'                  8080                 E21002
     C************IN80     IFEQ '1'                                       E21002
     C***********          OPEN SE0950AU                   ***************E21002
     C***********          MOVEL'12'      DBASE            * DB ERROR 12 *E21002
     C***********          MOVEL'TABLE'   DBFILE           ***************E21002
     C***********          MOVELTKEY      DBKEY                           E21002
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*MSG    '@RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM NCRY      @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     OPEN SE0950AU                                  S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'SDCURR'  DBFILE           ***************S01117
     C                     Z-ADD11        DBASE            **DB ERROR 11 *S01117
     C                     MOVELNCRY      DBKEY            ***************S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     WRITEHEADAU                                    E21002
     C                     WRITEERROR                                     E21002
     C***********          WRITETRAILAU                             E21002E29170
     C                     CLOSESE0950AU                                  E21002
     C                     SETON                     U7U8LR               E21002
     C                     RETRN                                          E21002
     C                     END                                            E21002
     C*                                                                   E21002
     C                     Z-ADDA6NBDP    ZCDP                            S01117
     C                     EXSR ZBKCTP                                    E21002
     C*                                                                   E21002
     C                     MOVE *BLANKS   ZFLD15
     C***********          MOVE PRIC      ZFLD15                          E21002
     C                     MOVE ZCONP     ZFLD15                          E21002
     C                     Z-ADD8         ZDECS
     C                     MOVE 'L'       ZECODE                          E21002
     C                     EXSR ZSEDIT                                    E21002
     C**************       MOVE 'L'       ZECODE                   E21025 E21002
     C                     MOVE ZOUT21    TRDPRC
     C*
     C* Nominal
     C*
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE NOML      ZFLD15
     C                     MOVE 'J'       ZECODE                          E17161
     C                     Z-ADDTNMD      ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    TRDNML
     C*
     C* Consideration
     C                     Z-ADDZCONP     ZPRC                            E21002
     C                     Z-ADDNOML      ZNOML                           E21002
     C                     Z-ADDA6NBDP    ZCDP                            S01117
     C                     EXSR ZCNSD                                     E21002
     C                     Z-ADDZCONS     ZFLD15                          E21002
     C*                                                                   E21002
     C           PROT      IFEQ '8'                                       E21002
     C/COPY WNCPYSRC,SE0950C006
     C                     MULT TCFC      ZFLD15    H                     E21002
     C                     END                                            E21002
     C/COPY WNCPYSRC,SE0950C002
     C*
     C***********          MOVE *BLANKS   ZFLD15                          E21002
     C****If*Asset-Backed*Security,*adjust*for*Current*Factor.**** E20086 E21002
     C************LIKE     DEFN TCSR      FTCSR                    E20086 E21002
     C***********PROT      IFEQ '8'                                E20086 E21002
     C***********TCSR      MULT TCFC      FTCSR                    E20086 E21002
     C***********          ELSE                                    E20086 E21002
     C***********          Z-ADDTCSR      FTCSR                    E20086 E21002
     C***********          END                                     E20086 E21002
     C***********          MOVE TCSR      ZFLD15                   E20086 E21002
     C***********          MOVE FTCSR     ZFLD15                   E20086 E21002
     C                     MOVE 'J'       ZECODE                          E17161
     C***********          Z-ADDCDP       ZDECS                           S01117
     C                     Z-ADDA6NBDP    ZDECS                           S01117
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    TRDCON
     C*
     C* Overflow handling
     C*
     C***********LCOUNT    IFGT 59                                        E15594
     C********** LCOUNT    IFGT 55                                                   E15594 AR322165
     C**********           WRITEHEADER                                                      AR322165
     C**********           Z-ADD17        LCOUNT                                            AR322165
      *                                                                   CAC005
     C********** CAC005    IFEQ 'Y'                                                  CAC005 AR322165
     C**********           ADD  1         LCOUNT                                     CAC005 AR322165
     C**********           ENDIF                                                     CAC005 AR322165
      *                                                                   CAC005
     C**********           END                                                              AR322165
      *                                                                                     AR322165
      ** Amend the overflow procedure                                                       AR322165
      *                                                                                     AR322165
     C                     Z-ADD1         RQDLN1                                            AR322165
     C           OFLLN1    SUB  PRTLN1    DIFLN1  30                                        AR322165
     C           DIFLN1    IFLE RQDLN1                                                      AR322165
     C                     WRITEHEADER                                                      AR322165
     C                     ENDIF                                                            AR322165
     C*
     C* Print Trade line
     C*
     C                     WRITETRADE
     C**********           ADD  1         LCOUNT                                            AR322165
     C*
      ***  End of If *IN61 = '1' (OK to include).
     C                     END
     C*
      ***  End of If/Else *IN33 = '1' (Trade record not found/found)
     C                     END
      *
      ***  End of Do While *IN33 = '0' (Read Trades).
     C                     END
      *
      *================================================================
      /EJECT
      *
      *** Carried Forward Processing.
      *                                                                   E20125
     C* If No B/F Balance and No Activity Detected, Skip C/F Processing.  E20125
     C           HDFLAG    IFEQ 'Y'                                       E20125
     C*
     C* IF NO BOOK/MONTH RECORD READ ZEROISE REALISED PROFIT FIELD
     C                     Z-ADD0         RPTM
     C***********NOMTOT    IFNE *ZEROS
     C           BKMKA     SETLLBKMTHDF
     C                     SETOF                     33
     C                     MOVE *BLANKS   BKMY
      *
     C           BKMY      DOUEQRUNMY
     C           *IN33     OREQ '1'
     C           BKMKA     READEBKMTHDF                  33
     C                     END
     C*
     C* NOT Error if not found
     C*
     C           *IN33     IFEQ '1'
     C                     Z-ADD*ZEROS    RPTM
     C                     END
     C*
     C* Format fields for printing
     C*
     C****Carried*Forward*Amounts*should*be*zero*if*the*Security****E20125E37419
     C****has*Matured.**(*IN40*ON).*********************************E20125E37419
     C*
     C* Price
     C*
     C                     MOVE *BLANKS   ZFLD15
     C************IN40     IFEQ '1'                                 E20125E37419
     C***********NOMTOT    OREQ 0                                   E20621E37419
     C           NOMTOT    IFEQ 0                                         E37419
     C                     MOVE *ZEROS    ZFLD15                          E20125
     C                     ELSE                                           E20125
     C                     MOVE LAVP      ZFLD15
     C                     END                                            E20125
     C                     Z-ADD8         ZDECS
     C                     MOVE 'L'       ZECODE                          E21025
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    CFPRIC
     C*
     C* Nominal
     C*
     C                     MOVE *BLANKS   ZFLD15
     C************IN40     IFEQ '1'                                 E20125E37419
     C***********          MOVE *ZEROS    ZFLD15                    E20125E37419
     C***********          ELSE                                     E20125E37419
     C                     MOVE NOMTOT    ZFLD15
     C***********          END                                      E20125E37419
     C                     MOVE 'J'       ZECODE                          E17161
     C                     Z-ADDNMDP      ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE *BLANK    Z21SIG
     C                     MOVE ZOUT21    CFNOML
     C*
     C* Position
     C*
     C           NOMTOT    COMP *ZEROS               515253
     C   51                MOVE 'LONG '   CFPOSN
     C   52                MOVE 'SHORT'   CFPOSN
     C   53                MOVE 'FLAT '   CFPOSN
     C*
     C* Consideration
     C*
     C************IN40     IFEQ '1'                                 E20125E37419
     C***********          MOVE 'FLAT '   CFPOSN                    E20125E37419
     C***********          MOVE *ZEROS    ZFLD15                    E20125E37419
     C***********          ELSE                                     E20125E37419
      ***********                                                   E20125E37419
     C   41      NOMTOT    MULT LAVP      CON150    H
     C   42      NOMTOT    MULT LAVP      CON151    H
     C   43      NOMTOT    MULT LAVP      CON152    H
     C   44      NOMTOT    MULT LAVP      CON153    H
     C*
     C* If Price basis 'P', divide by 100
     C*
     C           SPBS      IFEQ 'P'
     C   41      CON150    DIV  100       CON150    H
     C   42      CON151    DIV  100       CON151    H
     C   43      CON152    DIV  100       CON152    H
     C   44      CON153    DIV  100       CON153    H
     C                     END
     C*
     C* If Processing type '8', multiply by Current factor
     C*
     C           PROT      IFEQ '8'
     C/COPY WNCPYSRC,SE0950C007
     C***41******CON150    MULT CFCT      CON150    H                     101959
     C***42******CON151    MULT CFCT      CON151    H                     101959
     C***43******CON152    MULT CFCT      CON152    H                     101959
     C***44******CON153    MULT CFCT      CON153    H                     101959
     C   41      CON150    MULT TCFC      CON150    H                     101959
     C   42      CON151    MULT TCFC      CON151    H                     101959
     C   43      CON152    MULT TCFC      CON152    H                     101959
     C   44      CON153    MULT TCFC      CON153    H                     101959
     C                     END
     C/COPY WNCPYSRC,SE0950C003
     C*
     C                     MOVE *BLANKS   ZFLD15
     C   41                MOVE CON150    ZFLD15
     C   42                MOVE CON151    ZFLD15
     C   43                MOVE CON152    ZFLD15
     C   44                MOVE CON153    ZFLD15
      ***********                                                   E20125E37419
     C***********          END                                      E20125E37419
      ***********                                                   E20125E37419
     C           5         SUB  NMDP      ZI      20
     C           ZFLD15    MULT POWER8,ZI ZFLD15    H
     C                     MOVE 'J'       ZECODE                          E17161
     C***********          Z-ADDCDP       ZDECS                           S01117
     C                     Z-ADDA6NBDP    ZDECS                           S01117
     C                     EXSR ZSEDIT
     C                     MOVE *BLANK    Z21SIG
     C                     MOVE ZOUT21    CFCONS
     C*
     C* Realised profit this month
     C*
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE RPTM      ZFLD15
     C                     MOVE 'J'       ZECODE                          E17161
     C***********          Z-ADDCDP       ZDECS                           S01117
     C                     Z-ADDA6NBDP    ZDECS                           S01117
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    RPRFTM
     C*                                                                   S01129
     C* Mark to Market Profit this month                                  S01129
     C*                                                                   S01129
     C                     MOVE *BLANKS   ZFLD15                          S01129
     C                     MOVE MMPL      ZFLD15                          S01129
     C                     MOVE 'J'       ZECODE                          E17161
     C***********          Z-ADDCDP       ZDECS                    S01129 S01117
     C                     Z-ADDA6NBDP    ZDECS                           S01117
     C                     EXSR ZSEDIT                                    S01129
     C                     MOVE ZOUT21    MMPLTM                          S01129
     C*
     C* Overflow handling
     C*
     C********** LCOUNT    IFGT 55                                                          AR322165
     C**********           WRITEHEADER                                                      AR322165
     C***********          Z-ADD17        LCOUNT                          E15594
     C**********           Z-ADD18        LCOUNT                                     E15594 AR322165
      *                                                                   CAC005
     C********** CAC005    IFEQ 'Y'                                                  CAC005 AR322165
     C**********           ADD  1         LCOUNT                                     CAC005 AR322165
     C**********           ENDIF                                                     CAC005 AR322165
      *                                                                   CAC005
     C**********           END                                                              AR322165
      *                                                                                     AR322165
      ** Amend the overflow procedure                                                       AR322165
      *                                                                                     AR322165
     C                     Z-ADD8         RQDLN1                                            AR322165
     C           OFLLN1    SUB  PRTLN1    DIFLN1                                            AR322165
     C           DIFLN1    IFLE RQDLN1                                                      AR322165
     C                     WRITEHEADER                                                      AR322165
     C                     ENDIF                                                            AR322165
     C*
     C* Print Carried forward line
     C*
     C                     WRITECFLINE
     C***********          ADD  4         LCOUNT                          E15594
     C**********           ADD  5         LCOUNT                                     E15594 AR322165
     C           CSE006    IFEQ 'Y'                                       180218
AD   C                     MOVE *OFF      *IN61                           CSE006
     C                     ENDIF                                          180218
     C*                                                                   E20125
     C** If No B/F Balance and No Activity, Skip to here.                 E20125
     C*                                                                   E20125
     C                     END                                            E20125
      *                                                                   CSE006
     C                     ENDIF                                          CSE006
     C*                                                                   E20129
      ***  TAG for Matured Securities GOTO.                               E20129
      *                                                                   E20129
     C           MTJUMP    TAG                             *** MTJUMP *** E20129
      *                                                                   CSE006
      *** If Book is Buy-sell the execute s/r BSINFO                      CSE006
      *                                                                   CSE006
     CL5         CSE006    IFEQ 'Y'                                       CSE006
     CL5 01                EXSR BSINFO                                    CSE006
     CL5                   ENDIF                                          CSE006
     C*
     C* Change of Branch, Close printer file
     C*
     CL5 01 32   FILOPN    IFEQ 'Y'                                       E33035
      *                                                                                     AR322165
      ** Amend the overflow procedure                                                       AR322165
      *                                                                                     AR322165
     CL5                   Z-ADD3         RQDLN1                                            AR322165
     CL5         OFLLN1    SUB  PRTLN1    DIFLN1                                            AR322165
     CL5         HDFLAG    IFNE 'Y'                                       148071
     CL5         *IN01     ANDEQ'1'                                       148071
     CL5         *IN32     ANDEQ'1'                                       148071
     CL5         DIFLN1    ORLE RQDLN1                                                      AR322165
     CL5                   WRITEHEADER1                                   148071
     CL5                   ENDIF                                          148071
     CL5 01 32             WRITETRAIL                                     E29170
     C***L5*01***          CLOSESE0950P1                                  E29170
     CL5 01 32             CLOSESE0950P1                                  E29170
     CL5 01 32             MOVE ' '       FILOPN                          E33035
     CL5                   END                                            E33035
      *                                                                   E29170
      ** Last record processing                                           E29170
      *                                                                   E29170
     CLR 32      FILOPN    IFEQ 'Y'                                       E33035
      *                                                                                     AR322165
      ** Amend the overflow procedure                                                       AR322165
      *                                                                                     AR322165
     CLR                   Z-ADD3         RQDLN1                                            AR322165
     CLR         OFLLN1    SUB  PRTLN1    DIFLN1                                            AR322165
     CLR         HDFLAG    IFNE 'Y'                                       148071
     CLR         *IN32     ANDEQ'1'                                       148071
     CLR         DIFLN1    ORLE RQDLN1                                                      AR322165
     CLR                   WRITEHEADER1                                   148071
     CLR                   ENDIF                                          148071
     CLR 32                WRITETRAIL                                     E29170
     CLR                   END                                            E33035
      *                                                                   E29170
      ** RCF Processing for Audit File                                    E29170
      *                                                                   E29170
     CLR         *INU7     IFEQ '1'                                       E29170
     CLR                   EXSR RCFAU                                     E29170
     CLR                   END                                            E29170
      *                                                                   E29170
      ** If no details printed then show this on audit file               E29170
      *                                                                   E29170
     CLR         *INU7     IFEQ '0'                                       E29170
     CLR         *IN32     ANDNE'1'                                       E29170
     CLR                   OPEN SE0950AU                                  S01117
     CLR                   EXSR RCFAU                                     E29170
     CLR                   WRITEHEADAU                                    E29170
     CLR                   WRITENONE                                      E29170
     CLR                   CLOSESE0950AU                                  S01117
     CLR                   END                                            E29170
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  PRICE  - Subroutine to Print Price Changes for Average Prices*
      *                                                               *
      *****************************************************************
      *
     C           PRICE     BEGSR
     C*
     C* Set from date for first call to end of previous month
     C*
     C           *IN20     IFEQ '0'
     C                     MOVE '1'       *IN20
     C                     Z-ADDBKED      FROMDT  50
     C                     END
     C*
     C* Set to date
     C*
     C           *IN33     IFEQ '1'
     C                     Z-ADD99999     TODT    50
     C                     ELSE
     C           BHTV      IFEQ 'T'
     C                     Z-ADDTDDT      TODT
     C                     ELSE
     C                     Z-ADDTDVD      TODT
     C                     END
     C                     END
     C*
     C* Read through all price change records for this position
     C*
     C           BACKEY    SETLLBACPV
     C*
     C                     MOVE '0'       *IN34
     C           *IN34     DOWEQ'0'
     C           BACKY1    READEBACPV                    34
     C*
     C* For each record between from and to dates, print detail line
     C*
     C           *IN34     IFEQ '0'
     C           BCAD      ANDLTTODT
     C*                                                                   E20125
     C* Output headings and B/F line if not already done.                 E20125
     C*                                                                   E20125
     C           HDFLAG    IFNE 'Y'                                       E20125
     C                     MOVE 'Y'       HDFLAG                          E20125
     C                     WRITEHEADER                                    E20125
     C                     WRITEBFLINE                                    E20125
     C**********           Z-ADD20        LCOUNT  20                                 E20125 AR322165
      *                                                                   CAC005
     C********** CAC005    IFEQ 'Y'                                                  CAC005 AR322165
     C**********           ADD  1         LCOUNT                                     CAC005 AR322165
     C**********           ENDIF                                                     CAC005 AR322165
      *                                                                   CAC005
     C                     END                                            E20125
     C*
     C                     Z-ADDBCAD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    PRCDAT
     C*
     C                     MOVE *BLANKS   ZFLD15
     C* PRICE (IN % FORMAT )                                              E20959
     C                     Z-ADDBCPR      ZPRCIN                          E20959
     C                     Z-ADDBCAD      ZFDATE                          E20959
     C*                                                                   E39495
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0950CCP4                                           S01408
     C*                                                                   S01408
     C           ACRI      IFEQ 'X'                                       E39495
     C                     MOVE 'X'       SCUMEX                          E39495
     C                     ELSE                                           E39495
     C                     MOVE 'C'       SCUMEX                          E39495
     C                     END                                            E39495
     C                     Z-ADDBCNL      ZNOML                           E39495
     C*                                                                   E39495
     C                     EXSR ZPRCI                                     E20959
      *                                                                                       CSE035
      ** ADJUST PRICE : PRICE + PUR INT BEFORE ROUNDING                                       CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
     C           NCD       IFGE MATY                                                          CSE035
     C           SYBS      ANDEQ'AU'                                                          CSE035
     C                     Z-ADDZPRCOT    ZPRCOT                                              CSE035
     C                     ELSE                                                               CSE035
     C           SYBS      IFNE 'AU'                                                          CSE035
     C           SYBS      ANDNE'DA'                                                          CSE035
     C           STBS      ANDEQ'Y'                                                           CSE035
     C           ZPRCOT    ADD  ZWAMT     ZPRCOT                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
     C           NCD       IFGE MATY                                                          CSE035
     C           SYBS      ANDEQ'AU'                                                          CSE035
     C                     ELSE                                                               CSE035
     C           SYBS      IFNE 'AU'                                                          CSE035
     C           SYBS      ANDNE'DA'                                                          CSE035
     C           STBS      ANDEQ'Y'                                                           CSE035
     C           ZPRCOT    SUB  PURINT    ZPRCOT                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0950CCP5                                           S01408
     C*                                                                   S01408
     C                     MOVE ZPRCOT    ZFLD15                          E20959
     C***********          MOVE BCPR      ZFLD15                          E20959
     C                     Z-ADD8         ZDECS
     C                     MOVE 'L'       ZECODE                          E21025
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    NWPRIC
     C*
      *                                                                                     AR322165
      ** Check for overflow                                                                 AR322165
      *                                                                                     AR322165
     C                     Z-ADD1         RQDLN1                                            AR322165
     C           OFLLN1    SUB  PRTLN1    DIFLN1                                            AR322165
     C           DIFLN1    IFLE RQDLN1                                                      AR322165
     C                     WRITEHEADER                                                      AR322165
     C                     ENDIF                                                            AR322165
     C                     WRITENEWPRC
     C**********           ADD  1         LCOUNT                                            AR322165
     C*
     C                     ELSE
     C                     MOVE '1'       *IN34
     C                     END
     C                     END
     C*
     C* Reset fromdate to todate
     C*
     C                     Z-ADDTODT      FROMDT
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT                                                              E20145
      *****************************************************************   E20145
      *                                                               *   E20145
      *  BVTRDS - Removes trades B/V to prev. months from B/F position*   E20145
      *                                                               *   E20145
      *****************************************************************   E20145
      *                                                                   E20145
     C           BVTRDS    BEGSR                            *** BVTRDS ***E20145
     C*                                                                   E20145
     C* Fetch Trade records - CHAIN to first one, then READE the rest.    E20145
     C*                                                                   E20145
     C           TRDKA     CHAINTRADSDF              33                   E20145
      *                                                                   E21540
      ***  Because of the conditioning required, it is necessary to       E21540
      ***  read ALL the Trades with this Key.                             E21540
     C*                                                                   E20145
      ***  Back out the Trades until a change of Key*or*the******  E20145 E21540
      ***  Current*Month*is*encountered.***                        E20145 E21540
      *                                                                   E21540
     C           *IN33     DOWEQ'0'                                       E20145
     C*                                                                   E20145
     C***********BHTV      IFEQ 'V'                                E20145 E21540
     C***********TDVD      ANDGTEOPMTH                             E20145 E21540
     C***********BHTV      OREQ 'T'                                E20145 E21540
     C***********TDDT      ANDGTEOPMTH                             E20145 E21540
     C***********          MOVE '1'       *IN33                    E20145 E21540
     C***********          ELSE                                    E20145 E21540
     C*                                                                   E20145
     C** Subtract purchases, add sales.                                   E20145
      ***  AND vice versa for Reversals.                                  E21540
     C*                                                                   E20145
     C* Check whether adjustment required                                 E20145
     C*                                                                   E20145
     C***********TOED      IFGT EOPMTH                             E20145 E21540
     C***********TINC      ANDNE'I'                                E20145 E21540
     C***********RECI      IFEQ 'D'                                E20145 E21540
     C***********RECI      OREQ 'S'                                E20145 E21540
      *                                                                   E21540
     C                     SETOF                     62                   E21540
      *                                                                   E21540
      ***  Only interested in Complete Trades.                            E21540
     C           TINC      IFEQ 'C'                                       E21540
      *                                                                   E21540
      ***  If Trade Date Reporting.                                       E21540
     C           BHTV      IFEQ 'T'                                       E21540
      *                                                                   E21540
      ***  If entered This Month with Trade Date in Prior Month.          E21540
     C           TOED      IFGT BKED                                      E21540
     C           TDDT      ANDLEBKED                                      E21540
     C***********RECI      IFEQ 'D'                                E21540 E35580
     C***********RECI      OREQ 'S'                                E21540 E35580
     C           XRECI     IFEQ 'D'                                       E35580
     C           XRECI     OREQ 'S'                                       E35580
     C           XRECI     OREQ 'R'                                       E35580
     C                     SETON                     62                   E21540
     C                     END                                            E21540
     C                     END                                            E21540
      *                                                                   E21540
      ***  OR, If entered in a Prior Month and Deleted This Month.        E21540
     C***********XCHTP     IFEQ 'D'                                E21540 E35580
     C           XRECI     IFEQ '*'                                       E35580
     C           TOED      ANDLEBKED                                      E21540
     C           LCD       ANDGTBKED                                      E21540
     C                     SETON                     62                   E21540
     C                     END                                            E21540
      *                                                                   E21540
      ***  ELSE, If Value Date Reporting.                                 E21540
     C                     ELSE                                           E21540
      *                                                                   E21540
      ***  If entered This Month with Trade Date in Prior Month.          E21540
     C           TOED      IFGT BKED                                      E21540
     C           TDVD      ANDLEBKED                                      E21540
     C***********RECI      IFEQ 'D'                                E21540 E35580
     C***********RECI      OREQ 'S'                                E21540 E35580
     C           XRECI     IFEQ 'D'                                       E35580
     C           XRECI     OREQ 'S'                                       E35580
     C           XRECI     OREQ 'R'                                       E35580
     C                     SETON                     62                   E21540
     C                     END                                            E21540
     C                     END                                            E21540
      *                                                                   E21540
      ***  OR, If entered AND Valued in a Prior Month                     E21540
      ***  and Deleted This Month.                                        E21540
     C***********XCHTP     IFEQ 'D'                                E21540 E35580
     C           XRECI     IFEQ '*'                                       E35580
     C           TOED      ANDLEBKED                                      E21540
     C           TDVD      ANDLEBKED                                      E21540
     C           LCD       ANDGTBKED                                      E21540
     C                     SETON                     62                   E21540
     C                     END                                            E21540
      *                                                                   E21540
     C                     END                                            E21540
     C                     END                                            E21540
      *                                                                   E21540
      ***  Remove Trade Nominal from B/F Nominal, if required.            E21540
     C           *IN62     IFEQ '1'                                       E21540
      *                                                                   E21540
     C           TDTP      IFEQ 'TP'                                      E20145
      *                                                                   E21540
     C***********XCHTP     IFEQ 'D'                                E21540 E35580
     C           XRECI     IFEQ '*'                                       E35580
     C                     ADD  NOML      NPSN                            E21540
     C                     ELSE                                           E21540
     C                     SUB  NOML      NPSN                            E20145
     C                     END                                            E21540
      *                                                                   E21540
     C                     ELSE                                           E20145
      *                                                                   E21540
     C***********XCHTP     IFEQ 'D'                                E21540 E35580
     C           XRECI     IFEQ '*'                                       E35580
     C                     SUB  NOML      NPSN                            E21540
     C                     ELSE                                           E21540
     C                     ADD  NOML      NPSN                            E20145
     C                     END                                            E20145
      *                                                                   E21540
     C                     END                                            E20145
     C                     END                                            E20145
     C*                                                                   E20145
     C**N33******TRDKA     READETRADSDF                  33        E20145 E21540
     C           TRDKA     READETRADSDF                  33               E21540
     C*                                                                   E20145
     C***********          END                                            E21540
     C                     END                                            E20145
     C*                                                                   E20145
     C                     ENDSR                                          E20145
      *                                                                   E20145
      *****************************************************************   S01117
      *****************************************************************   CSE006
      /EJECT                                                              CSE006
      *****************************************************************   CSE006
      *                                                               *   CSE006
      *  BSINFO - Print Buy-Sell Trades info                          *   CSE006
      *                                                               *   CSE006
      *****************************************************************   CSE006
      *                                                                   CSE006
     C           BSINFO    BEGSR                            *** BSINFO ***CSE006
      *                                                                   CSE006
      *** Set  Low limit on Buy sell book file                            CSE006
      *                                                                   CSE006
     C           *LOVAL    SETLLBSPOSDL1                                  CSE006
     C           BHBA      SETLLBSPOSDL1                                  CSE006
      *                                                                   CSE006
      *** Initialise indicator and set total profit/loss to 0             CSE006
      *                                                                   CSE006
     C                     MOVEL*BLANKS   BHSC                            CSE006
     C                     MOVEL*BLANKS   BHBK                            CSE006
     C                     MOVE *OFF      *IN55                           CSE006
     C                     Z-ADD0         @TPL   150                      CSE006
      *                                                                   CSE006
      *** Get Buy-sell book file details                                  CSE006
      *                                                                   CSE006
     C           BHBA      READEBSPOSDL1                 55               CSE006
      *                                                                   CSE006
     C           *IN55     DOWEQ*OFF                                      CSE006
     C           BSRECI    IFEQ 'D'                                       CSE006
      *                                                                   CSE006
      ** Move book to printer book code                                   CSE006
      *                                                                   CSE006
     C                     MOVE BSBOK     PBKCD                           CSE006
      *                                                                   CSE006
      * Fetch Book description                                            CSE006
      *                                                                   CSE006
     C                     CALL 'AOBOOKR0'                                CSE006
     C                     PARM '*MSG    '@RTCD   7                       CSE006
     C                     PARM '*KEY   ' @OPTN   7                       CSE006
     C                     PARM PBKCD     @BOOK   2                       CSE006
     C           SDBOOK    PARM SDBOOK    DSFDY                           CSE006
     C           @RTCD     IFNE *BLANKS                                   CSE006
     C                     OPEN SE0950AU                                  CSE006
     C           *LOCK     IN   LDA                                       CSE006
     C                     MOVEL'SDBOOK'  DBFILE           ***************CSE006
     C                     Z-ADD19        DBASE            **DB ERROR 19 *CSE006
     C                     MOVELPBKCD     DBKEY            ***************CSE006
     C                     OUT  LDA                                       CSE006
     C                     EXSR *PSSR                                     CSE006
     C                     WRITEHEADAU                                    CSE006
     C                     WRITEERROR                                     CSE006
     C                     CLOSESE0950AU                                  CSE006
     C                     SETON                     U7U8LR               CSE006
     C                     RETRN                                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** Fetch Security details                                          CSE006
      *                                                                   CSE006
     C           BSSEN     CHAINSECTYDF              33                   CSE006
     C  N33      RECI      COMP '*'                      33               CSE006
     C  N33      RECI      COMP 'M'                      40               CSE006
     C           *IN33     IFEQ '1'                                       CSE006
     C                     OPEN SE0950AU                                  CSE006
     C           *LOCK     IN   LDA                        ***************CSE006
     C                     Z-ADD21        DBASE            * DB ERROR 21 *CSE006
     C                     MOVEL'SECTY'   DBFILE           ***************CSE006
     C                     MOVELBSSEN     DBKEY                           CSE006
     C                     OUT  LDA                                       CSE006
     C                     EXSR *PSSR                                     CSE006
     C                     WRITEHEADAU                                    CSE006
     C                     WRITEERROR                                     CSE006
     C                     CLOSESE0950AU                                  CSE006
     C                     SETON                     U7U8LR               CSE006
     C                     RETRN                                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      ***  Securities that matured by the End of Last Month should not    CSE006
      ***  appear on this report.                                         CSE006
      *                                                                   CSE006
     C           MATY      IFLE EOPMTH                                    CSE006
     C           MATY      ANDNE0                                         CSE006
      *                                                                   CSE006
      ***  Jump to next read of Buy-sell book                             CSE006
      *                                                                   CSE006
     C                     GOTO BSJUMP                                    CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** Fetch Investment type description                               CSE006
      *                                                                   CSE006
     C           INVK1     KLIST                                          CSE006
     C                     KFLD           NMCY                            CSE006
     C                     KFLD           SITP                            CSE006
      *                                                                   CSE006
     C           INVK1     CHAININVTPDF              33                   CSE006
     C  N33      RECI      COMP '*'                      33               CSE006
     C           *IN33     IFEQ '1'                                       CSE006
     C                     OPEN SE0950AU                                  CSE006
     C           *LOCK     IN   LDA                                       CSE006
     C                     Z-ADD20        DBASE            * DB ERROR 20 *CSE006
     C                     MOVEL'INVTP'   DBFILE           ***************CSE006
     C                     MOVELINVERR    DBKEY                           CSE006
     C                     OUT  LDA                                       CSE006
     C                     EXSR *PSSR                                     CSE006
     C                     WRITEHEADAU                                    CSE006
     C                     WRITEERROR                                     CSE006
     C                     CLOSESE0950AU                                  CSE006
     C                     SETON                     U7U8LR               CSE006
     C                     RETRN                                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** Get Trade Details                                               CSE006
      *                                                                   CSE006
     C           BSPRF     CHAINTRADSD1              33                   CSE006
      *                                                                   CSE006
     C           *IN33     IFEQ '1'                                       CSE006
     C                     OPEN SE0950AU                                  CSE006
     C           *LOCK     IN   LDA                        ***************CSE006
     C                     Z-ADD14        DBASE            * DB ERROR 14 *CSE006
     C                     MOVEL'TRADS'   DBFILE           ***************CSE006
     C                     MOVELBSPRF     DBKEY                           CSE006
     C                     OUT  LDA                                       CSE006
     C                     EXSR *PSSR                                     CSE006
     C                     WRITEHEADAU                                    CSE006
     C                     WRITEERROR                                     CSE006
     C                     CLOSESE0950AU                                  CSE006
     C                     SETON                     U7U8LR               CSE006
     C                     RETRN                                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** Check if trade needs to be printed                              CSE006
      *                                                                   CSE006
     C                     MOVE *OFF      *IN63                           CSE006
      *                                                                   CSE006
      * Check record valid for inclusion                                  CSE006
      *                                                                   CSE006
      ***  Only Complete Trades to be processed - adjusted E17160         CSE006
      ***  change to simplify the following conditioning a little.        CSE006
      *                                                                   CSE006
     C           TINC      IFEQ 'C'                                       CSE006
      *                                                                   CSE006
      ***  If entered This Month.                                         CSE006
     C           TOED      IFLT EOTMTH                                    CSE006
      *                                                                   CSE006
      ***  OR entered in a Prior Month but with the Trade Date amended    CSE006
      ***  so that it is in This Month.                                   CSE006
     C           TDDT      ORLT EOTMTH                                    CSE006
      *                                                                   CSE006
     C           RECI1     IFEQ 'D'                                       CSE006
     C           RECI1     OREQ 'S'                                       CSE006
     C           RECI1     OREQ 'R'                                       CSE006
     C                     SETON                     63                   CSE006
     C                     ENDIF                                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      ***  OR, If entered in a Prior Month and Reversed This Month.       CSE006
     C           RECI1     IFEQ '*'                                       CSE006
     C           LCD       ANDLTEOTMTH                                    CSE006
     C           TOED      ANDLEEOPMTH                                    CSE006
     C                     SETON                     63                   CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      ***  ELSE, If Value Date Reporting.                                 CSE006
     C                     ELSE                                           CSE006
      *                                                                   CSE006
      ***  What is required is Trades Entered This                        CSE006
      ***  Month Valued up to Today OR Trades entered Last Month that     CSE006
      ***  are Valued This Month up to Today.                             CSE006
      *                                                                   CSE006
      ** Next line excluded trades entered last month valued this month.  CSE006
      *                                                                   CSE006
     C           TOED      IFLT EOPMTH                                    CSE006
     C           TOED      ORLE EOPMTH                                    CSE006
     C           TDVD      ANDLTEOTMTH                                    CSE006
      *                                                                   CSE006
     C           TDVD      IFLE RUND                                      CSE006
     C           RECI1     IFEQ 'D'                                       CSE006
     C           RECI1     OREQ 'S'                                       CSE006
     C           RECI1     OREQ 'R'                                       CSE006
     C                     SETON                     63                   CSE006
     C                     ENDIF                                          CSE006
     C                     ENDIF                                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C           RECI1     IFEQ '*'                                       CSE006
     C           LCD       ANDLTEOTMTH                                    CSE006
      *                                                                   CSE006
      ***  What is required here is Reversals of Trades both Entered      CSE006
      ***  AND Valued Last Month.                                         CSE006
      *                                                                   CSE006
      *                                                                   CSE006
     C           TOED      ANDLEEOPMTH                                    CSE006
     C           TDVD      ANDLEEOPMTH                                    CSE006
     C                     SETON                     63                   CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** Ok to include                                                   CSE006
      *                                                                   CSE006
     C           *IN63     IFEQ '1'                                       CSE006
      *                                                                   CSE006
      ***  Set BF/Line fields to 0                                        CSE006
      *                                                                   CSE006
     C                     MOVE *BLANKS   ZFLD15                          CSE006
     C                     MOVE 0         ZFLD15                          CSE006
     C                     MOVE 'J'       ZECODE                          CSE006
     C                     Z-ADDNMDP      ZDECS                           CSE006
     C                     EXSR ZSEDIT                                    CSE006
     C                     MOVE *BLANK    Z21SIG                          CSE006
     C                     MOVE ZOUT21    BFNOML                          CSE006
      *                                                                   CSE006
     C                     MOVE 'FLAT '   BFPOSN                          CSE006
      *                                                                   CSE006
     C                     MOVE *BLANKS   ZFLD15                          CSE006
     C                     MOVE *ZEROS    ZFLD15                          CSE006
     C                     Z-ADD8         ZDECS                           CSE006
     C                     MOVE 'L'       ZECODE                          CSE006
     C                     EXSR ZSEDIT                                    CSE006
     C                     MOVE ZOUT21    BFPRIC                          CSE006
      *                                                                   CSE006
     C                     MOVE *BLANKS   ZFLD15                          CSE006
     C                     MOVE *ZEROS    ZFLD15                          CSE006
     C           5         SUB  NMDP      ZI      20                      CSE006
     C           ZFLD15    MULT POWER8,ZI ZFLD15    H                     CSE006
     C                     MOVE 'J'       ZECODE                          CSE006
     C                     Z-ADDA6NBDP    ZDECS                           CSE006
     C                     EXSR ZSEDIT                                    CSE006
     C                     MOVE *BLANKS   Z21SIG                          CSE006
     C                     MOVE ZOUT21    BFCONS                          CSE006
      *                                                                   CSE006
      * Output headings and B/F line if not already done.                 CSE006
      *                                                                   CSE006
     C                     MOVE 'Y'       HDFLAG                          CSE006
     C                     WRITEHEADER                                    CSE006
     C                     WRITEBFLINE                                    CSE006
     C**********           Z-ADD20        LCOUNT  20                                 CSE006 AR322165
      *                                                                   CSE006
     C********** CAC005    IFEQ 'Y'                                                  CSE006 AR322165
     C**********           ADD  1         LCOUNT                                     CSE006 AR322165
     C**********           ENDIF                                                     CSE006 AR322165
      *                                                                   CSE006
      * Add nominal to total for Carried forward position                 CSE006
      *                                                                   CSE006
     C           TDTP      IFEQ 'TP'                                      CSE006
      *                                                                   CSE006
     C           RECI1     IFEQ '*'                                       CSE006
     C                     SUB  NOML      NOMTOT 150                      CSE006
     C                     ELSE                                           CSE006
     C                     ADD  NOML      NOMTOT 150                      CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     ELSE                                           CSE006
      *                                                                   CSE006
     C           RECI1     IFEQ '*'                                       CSE006
     C                     ADD  NOML      NOMTOT 150                      CSE006
     C                     ELSE                                           CSE006
     C                     SUB  NOML      NOMTOT                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      * Format fields for printing                                        CSE006
      *                                                                   CSE006
      * Value date  OR TRADE DATE                                         CSE006
      *                                                                   CSE006
     C                     Z-ADDTDDT      ZDAYNO                          CSE006
     C                     EXSR ZDATE2                                    CSE006
     C                     MOVE ZADATE    VALDAT                          CSE006
      *                                                                   CSE006
      *** Fetch Customer Report name and town                             CSE006
      *                                                                   CSE006
     C                     MOVELTCNR      @KEY1                           CSE006
     C                     CALL 'AOCUSTR0'                                CSE006
     C                     PARM           @RTCD   7                       CSE006
     C                     PARM '*KEY   ' @OPTN   7                       CSE006
     C                     PARM           @KEY1  10                       CSE006
     C                     PARM           @KYST   7                       CSE006
     C           SDCUST    PARM SDCUST    DSSDY                           CSE006
     C           @RTCD     IFNE *BLANKS                                   CSE006
     C                     OPEN SE0950AU                                  CSE006
     C           *LOCK     IN   LDA                                       CSE006
     C                     MOVEL'SDCUST'  DBFILE           ***************CSE006
     C                     Z-ADD15        DBASE            **DB ERROR 15 *CSE006
     C                     MOVELTCNR      DBKEY            ***************CSE006
     C                     OUT  LDA                                       CSE006
     C                     EXSR *PSSR                                     CSE006
     C                     WRITEHEADAU                                    CSE006
     C                     WRITEERROR                                     CSE006
     C                     CLOSESE0950AU                                  CSE006
     C                     SETON                     U7U8LR               CSE006
     C                     RETRN                                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** Set up Trade type                                               CSE006
      *                                                                   CSE006
     C                     MOVE *BLANKS   TRDTYP                          CSE006
      *                                                                   CSE006
     C           TDTP      IFEQ 'TP'                                      CSE006
     C                     MOVEL'BOUGHT A'WORK9   9                       CSE006
     C                     MOVE 'T'       WORK9                           CSE006
     C                     ELSE                                           CSE006
     C           TDTP      IFEQ 'TS'                                      CSE006
     C                     MOVEL'SOLD AT 'WORK9   9                       CSE006
     C                     MOVE ' '       WORK9                           CSE006
     C                     ENDIF                                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     MOVELWORK9     TRDTYP                          CSE006
     C           RECI1     IFEQ '*'                                       CSE006
     C                     MOVE '(REV)'   TRDTYP                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      ***  Check if current Trade was previously generated by ER          CSE006
      *                                                                   CSE006
     C           S01496    IFEQ 'Y'                                       CSE006
     C                     OPEN SEERALL2                                  CSE006
     C           TDRF      SETLLSEERALL2                 71               CSE006
     C           *IN71     IFEQ '1'                                       CSE006
     C           TDTP      IFEQ 'TP'                                      CSE006
     C           RECI1     ANDEQ'*'                                       CSE006
     C                     MOVE '(RRI)'   TRDTYP                          CSE006
     C                     ELSE                                           CSE006
     C           TDTP      IFEQ 'TP'                                      CSE006
     C                     MOVE ' (RI)'   TRDTYP                          CSE006
     C                     ELSE                                           CSE006
     C           TDTP      IFEQ 'TS'                                      CSE006
     C           RECI1     ANDEQ'*'                                       CSE006
     C                     MOVE '(RRO)'   TRDTYP                          CSE006
     C                     ELSE                                           CSE006
     C           TDTP      IFEQ 'TS'                                      CSE006
     C                     MOVE ' (RO)'   TRDTYP                          CSE006
     C                     ENDIF                                          CSE006
     C                     ENDIF                                          CSE006
     C                     ENDIF                                          CSE006
     C                     ENDIF                                          CSE006
     C                     ENDIF                                          CSE006
     C                     CLOSESEERALL2                                  CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** Price                                                           CSE006
      *** NEED TO USE CONTRACT PRICE                                      CSE006
      *** USE TRADE FILE TRADE NOMINAL CURRENCY FIELD TNMC                CSE006
      *                                                                   CSE006
     C                     CALL 'AOCURRR0'                                CSE006
     C                     PARM '*MSG    '@RTCD   7                       CSE006
     C                     PARM '*KEY   ' @OPTN   7                       CSE006
     C                     PARM TNMC      @AJCD   3                       CSE006
     C           SDCURR    PARM SDCURR    DSSDY                           CSE006
     C           @RTCD     IFNE *BLANKS                                   CSE006
     C                     OPEN SE0950AU                                  CSE006
     C           *LOCK     IN   LDA                                       CSE006
     C                     MOVEL'SDCURR'  DBFILE           ***************CSE006
     C                     Z-ADD16        DBASE            **DB ERROR 16 *CSE006
     C                     MOVELTNMC      DBKEY            ***************CSE006
     C                     OUT  LDA                                       CSE006
     C                     EXSR *PSSR                                     CSE006
     C                     WRITEHEADAU                                    CSE006
     C                     WRITEERROR                                     CSE006
     C                     CLOSESE0950AU                                  CSE006
     C                     SETON                     U7U8LR               CSE006
     C                     RETRN                                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     Z-ADDA6NBDP    ZCDP                            CSE006
     C                     EXSR ZBKCTP                                    CSE006
      *                                                                   CSE006
     C                     MOVE *BLANKS   ZFLD15                          CSE006
     C                     MOVE ZCONP     ZFLD15                          CSE006
     C                     Z-ADD8         ZDECS                           CSE006
     C                     MOVE 'L'       ZECODE                          CSE006
     C                     EXSR ZSEDIT                                    CSE006
     C                     MOVE ZOUT21    TRDPRC                          CSE006
      *                                                                   CSE006
      *** Nominal                                                         CSE006
      *                                                                   CSE006
     C                     MOVE *BLANKS   ZFLD15                          CSE006
     C                     MOVE NOML      ZFLD15                          CSE006
     C                     MOVE 'J'       ZECODE                          CSE006
     C                     Z-ADDTNMD      ZDECS                           CSE006
     C                     EXSR ZSEDIT                                    CSE006
     C                     MOVE ZOUT21    TRDNML                          CSE006
      *                                                                   CSE006
      *** Consideration                                                   CSE006
      *                                                                   CSE006
     C                     Z-ADDZCONP     ZPRC                            CSE006
     C                     Z-ADDNOML      ZNOML                           CSE006
     C                     Z-ADDA6NBDP    ZCDP                            CSE006
     C                     EXSR ZCNSD                                     CSE006
     C                     Z-ADDZCONS     ZFLD15                          CSE006
      *                                                                   CSE006
     C           PROT      IFEQ '8'                                       CSE006
     C                     MULT TCFC      ZFLD15    H                     CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     MOVE 'J'       ZECODE                          CSE006
     C                     Z-ADDA6NBDP    ZDECS                           CSE006
     C                     EXSR ZSEDIT                                    CSE006
     C                     MOVE ZOUT21    TRDCON                          CSE006
      *                                                                   CSE006
      *** Overflow handling                                               CSE006
      *                                                                   CSE006
     C********** LCOUNT    IFGT 55                                                   CSE006 AR322165
     C**********           WRITEHEADER                                               CSE006 AR322165
     C**********           Z-ADD17        LCOUNT                                     CSE006 AR322165
      *                                                                   CSE006
     C********** CAC005    IFEQ 'Y'                                                  CSE006 AR322165
     C**********           ADD  1         LCOUNT                                     CSE006 AR322165
     C**********           ENDIF                                                     CSE006 AR322165
      *                                                                   CSE006
     C**********           ENDIF                                                     CSE006 AR322165
      *                                                                                     AR322165
      ** Amend the overflow procedure                                                       AR322165
      *                                                                                     AR322165
     C                     Z-ADD1         RQDLN1                                            AR322165
     C           OFLLN1    SUB  PRTLN1    DIFLN1                                            AR322165
     C           DIFLN1    IFLE RQDLN1                                                      AR322165
     C                     WRITEHEADER                                                      AR322165
     C                     ENDIF                                                            AR322165
      *                                                                   CSE006
      *** Print Trade line                                                CSE006
      *                                                                   CSE006
     C                     WRITETRADE                                     CSE006
      *                                                                   CSE006
     C**********           ADD  1         LCOUNT                                     CSE006 AR322165
      *                                                                   CSE006
      ***  End of If *IN63 = '1' (OK to include).                         CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** Save Trade details into temp fields                             CSE006
      *                                                                   CSE006
     C                     MOVE TRDNML    TNML1  16                       CSE006
     C                     MOVE TRDPRC    TPRC1  19                       CSE006
     C                     MOVE TRDTYP    TTYP1  12                       CSE006
     C                     MOVE TRDCON    TCON1  21                       CSE006
      *                                                                   CSE006
     C           LKRF      CHAINTRADSD1              33                   CSE006
      *                                                                   CSE006
     C           *IN33     IFEQ '1'                                       CSE006
     C                     OPEN SE0950AU                                  CSE006
     C           *LOCK     IN   LDA                        ***************CSE006
     C                     Z-ADD17        DBASE            * DB ERROR 17 *CSE006
     C                     MOVEL'TRADS'   DBFILE           ***************CSE006
     C                     MOVELLKRF      DBKEY                           CSE006
     C                     OUT  LDA                                       CSE006
     C                     EXSR *PSSR                                     CSE006
     C                     WRITEHEADAU                                    CSE006
     C                     WRITEERROR                                     CSE006
     C                     CLOSESE0950AU                                  CSE006
     C                     SETON                     U7U8LR               CSE006
     C                     RETRN                                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** Check if linked trade needs to be printed                       CSE006
      *                                                                   CSE006
     C                     MOVE *OFF      *IN64                           CSE006
      *                                                                   CSE006
      * Check record valid for inclusion                                  CSE006
      *                                                                   CSE006
      ***  Only Complete Trades to be processed - adjusted E17160         CSE006
      ***  change to simplify the following conditioning a little.        CSE006
      *                                                                   CSE006
     C           TINC      IFEQ 'C'                                       CSE006
      *                                                                   CSE006
      ***  If entered This Month.                                         CSE006
     C           TOED      IFLT EOTMTH                                    CSE006
      *                                                                   CSE006
      ***  OR entered in a Prior Month but with the Trade Date amended    CSE006
      ***  so that it is in This Month.                                   CSE006
     C           TDDT      ORLT EOTMTH                                    CSE006
      *                                                                   CSE006
     C           RECI1     IFEQ 'D'                                       CSE006
     C           RECI1     OREQ 'S'                                       CSE006
     C           RECI1     OREQ 'R'                                       CSE006
     C                     SETON                     64                   CSE006
     C                     ENDIF                                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      ***  OR, If entered in a Prior Month and Reversed This Month.       CSE006
     C           RECI1     IFEQ '*'                                       CSE006
     C           LCD       ANDLTEOTMTH                                    CSE006
     C           TOED      ANDLEEOPMTH                                    CSE006
     C                     SETON                     64                   CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      ***  ELSE, If Value Date Reporting.                                 CSE006
     C                     ELSE                                           CSE006
      *                                                                   CSE006
      ***  What is required is Trades Entered This                        CSE006
      ***  Month Valued up to Today OR Trades entered Last Month that     CSE006
      ***  are Valued This Month up to Today.                             CSE006
      *                                                                   CSE006
      ** Next line excluded trades entered last month valued this month.  CSE006
      *                                                                   CSE006
     C           TOED      IFLT EOTMTH                                    CSE006
     C           TOED      ORLE EOPMTH                                    CSE006
     C           TDVD      ANDLTEOTMTH                                    CSE006
      *                                                                   CSE006
     C           TDVD      IFLE RUND                                      CSE006
     C           RECI1     IFEQ 'D'                                       CSE006
     C           RECI1     OREQ 'S'                                       CSE006
     C           RECI1     OREQ 'R'                                       CSE006
     C                     SETON                     64                   CSE006
     C                     ENDIF                                          CSE006
     C                     ENDIF                                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C           RECI1     IFEQ '*'                                       CSE006
     C           LCD       ANDLTEOTMTH                                    CSE006
      *                                                                   CSE006
      ***  What is required here is Reversals of Trades both Entered      CSE006
      ***  AND Valued Last Month.                                         CSE006
      *                                                                   CSE006
      *                                                                   CSE006
     C           TOED      ANDLEEOPMTH                                    CSE006
     C           TDVD      ANDLEEOPMTH                                    CSE006
     C                     SETON                     64                   CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** Ok to include                                                   CSE006
      *                                                                   CSE006
     C           *IN64     IFEQ '1'                                       CSE006
      *                                                                   CSE006
      *** If 1st trade isn't to beprinted then set BFline values to 1st   CSE006
      *** trade                                                           CSE006
      *                                                                   CSE006
     C           *IN63     IFEQ '0'                                       CSE006
      *                                                                   CSE006
     C                     MOVE *BLANKS   ZFLD15                          CSE006
     C                     MOVE TPRC1     ZFLD15                          CSE006
     C                     Z-ADD8         ZDECS                           CSE006
     C                     MOVE 'L'       ZECODE                          CSE006
     C                     EXSR ZSEDIT                                    CSE006
     C                     MOVE ZOUT21    BFPRIC                          CSE006
      *                                                                   CSE006
     C                     MOVE *BLANKS   ZFLD15                          CSE006
     C                     MOVE TNML1     ZFLD15                          CSE006
     C                     MOVE 'J'       ZECODE                          CSE006
     C                     Z-ADDNMDP      ZDECS                           CSE006
     C                     EXSR ZSEDIT                                    CSE006
     C                     MOVE *BLANK    Z21SIG                          CSE006
     C                     MOVE ZOUT21    BFNOML                          CSE006
      *                                                                   CSE006
     C                     MOVE *BLANKS   ZFLD15                          CSE006
     C                     MOVE TCON1     ZFLD15                          CSE006
     C           5         SUB  NMDP      ZI      20                      CSE006
     C           ZFLD15    MULT POWER8,ZI ZFLD15    H                     CSE006
     C                     MOVE 'J'       ZECODE                          CSE006
     C                     Z-ADDA6NBDP    ZDECS                           CSE006
     C                     EXSR ZSEDIT                                    CSE006
     C                     MOVE *BLANKS   Z21SIG                          CSE006
     C                     MOVE ZOUT21    BFCONS                          CSE006
      *                                                                   CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** Output headings and B/F line if not already done.               CSE006
      *                                                                   CSE006
     C           HDFLAG    IFNE 'Y'                                       CSE006
     C                     MOVE 'Y'       HDFLAG                          CSE006
     C                     WRITEHEADER                                    CSE006
     C                     WRITEBFLINE                                    CSE006
     C**********           Z-ADD20        LCOUNT  20                                 CSE006 AR322165
      *                                                                   CSE006
     C********** CAC005    IFEQ 'Y'                                                  CSE006 AR322165
     C**********           ADD  1         LCOUNT                                     CSE006 AR322165
     C**********           ENDIF                                                     CSE006 AR322165
      *                                                                   CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** Add nominal to total for Carried forward position               CSE006
      *                                                                   CSE006
     C           TDTP      IFEQ 'TP'                                      CSE006
      *                                                                   CSE006
     C           RECI1     IFEQ '*'                                       CSE006
     C                     SUB  NOML      NOMTOT 150                      CSE006
     C                     ELSE                                           CSE006
     C                     ADD  NOML      NOMTOT 150                      CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     ELSE                                           CSE006
      *                                                                   CSE006
     C           RECI1     IFEQ '*'                                       CSE006
     C                     ADD  NOML      NOMTOT 150                      CSE006
     C                     ELSE                                           CSE006
     C                     SUB  NOML      NOMTOT                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** Format fields for printing                                      CSE006
      *** Value date  OR TRADE DATE                                       CSE006
      *                                                                   CSE006
     C                     Z-ADDTDDT      ZDAYNO                          CSE006
     C                     EXSR ZDATE2                                    CSE006
     C                     MOVE ZADATE    VALDAT                          CSE006
      *                                                                   CSE006
      *** Fetch Customer Report name and town                             CSE006
      *                                                                   CSE006
     C                     MOVELTCNR      @KEY1                           CSE006
     C                     CALL 'AOCUSTR0'                                CSE006
     C                     PARM           @RTCD   7                       CSE006
     C                     PARM '*KEY   ' @OPTN   7                       CSE006
     C                     PARM           @KEY1  10                       CSE006
     C                     PARM           @KYST   7                       CSE006
     C           SDCUST    PARM SDCUST    DSSDY                           CSE006
     C           @RTCD     IFNE *BLANKS                                   CSE006
     C                     OPEN SE0950AU                                  CSE006
     C           *LOCK     IN   LDA                                       CSE006
     C                     MOVEL'SDCUST'  DBFILE           ***************CSE006
     C                     Z-ADD15        DBASE            **DB ERROR 15 *CSE006
     C                     MOVELTCNR      DBKEY            ***************CSE006
     C                     OUT  LDA                                       CSE006
     C                     EXSR *PSSR                                     CSE006
     C                     WRITEHEADAU                                    CSE006
     C                     WRITEERROR                                     CSE006
     C                     CLOSESE0950AU                                  CSE006
     C                     SETON                     U7U8LR               CSE006
     C                     RETRN                                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** Set up Trade type                                               CSE006
      *                                                                   CSE006
     C                     MOVE *BLANKS   TRDTYP                          CSE006
      *                                                                   CSE006
     C           TDTP      IFEQ 'TP'                                      CSE006
     C                     MOVEL'BOUGHT A'WORK9   9                       CSE006
     C                     MOVE 'T'       WORK9                           CSE006
     C                     ELSE                                           CSE006
     C           TDTP      IFEQ 'TS'                                      CSE006
     C                     MOVEL'SOLD AT 'WORK9   9                       CSE006
     C                     MOVE ' '       WORK9                           CSE006
     C                     ENDIF                                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     MOVELWORK9     TRDTYP                          CSE006
     C           RECI1     IFEQ '*'                                       CSE006
     C                     MOVE '(REV)'   TRDTYP                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      ***  Check if current Trade was previously generated by ER          CSE006
      *                                                                   CSE006
     C           S01496    IFEQ 'Y'                                       CSE006
     C                     OPEN SEERALL2                                  CSE006
     C           TDRF      SETLLSEERALL2                 71               CSE006
     C           *IN71     IFEQ '1'                                       CSE006
     C           TDTP      IFEQ 'TP'                                      CSE006
     C           RECI1     ANDEQ'*'                                       CSE006
     C                     MOVE '(RRI)'   TRDTYP                          CSE006
     C                     ELSE                                           CSE006
     C           TDTP      IFEQ 'TP'                                      CSE006
     C                     MOVE ' (RI)'   TRDTYP                          CSE006
     C                     ELSE                                           CSE006
     C           TDTP      IFEQ 'TS'                                      CSE006
     C           RECI1     ANDEQ'*'                                       CSE006
     C                     MOVE '(RRO)'   TRDTYP                          CSE006
     C                     ELSE                                           CSE006
     C           TDTP      IFEQ 'TS'                                      CSE006
     C                     MOVE ' (RO)'   TRDTYP                          CSE006
     C                     ENDIF                                          CSE006
     C                     ENDIF                                          CSE006
     C                     ENDIF                                          CSE006
     C                     ENDIF                                          CSE006
     C                     ENDIF                                          CSE006
     C                     CLOSESEERALL2                                  CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** Price                                                           CSE006
      *** NEED TO USE CONTRACT PRICE                                      CSE006
      *** USE TRADE FILE TRADE NOMINAL CURRENCY FIELD TNMC                CSE006
      *                                                                   CSE006
     C                     CALL 'AOCURRR0'                                CSE006
     C                     PARM '*MSG    '@RTCD   7                       CSE006
     C                     PARM '*KEY   ' @OPTN   7                       CSE006
     C                     PARM TNMC      @AJCD   3                       CSE006
     C           SDCURR    PARM SDCURR    DSSDY                           CSE006
     C           @RTCD     IFNE *BLANKS                                   CSE006
     C                     OPEN SE0950AU                                  CSE006
     C           *LOCK     IN   LDA                                       CSE006
     C                     MOVEL'SDCURR'  DBFILE           ***************CSE006
     C                     Z-ADD16        DBASE            **DB ERROR 16 *CSE006
     C                     MOVELTNMC      DBKEY            ***************CSE006
     C                     OUT  LDA                                       CSE006
     C                     EXSR *PSSR                                     CSE006
     C                     WRITEHEADAU                                    CSE006
     C                     WRITEERROR                                     CSE006
     C                     CLOSESE0950AU                                  CSE006
     C                     SETON                     U7U8LR               CSE006
     C                     RETRN                                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     Z-ADDA6NBDP    ZCDP                            CSE006
     C                     EXSR ZBKCTP                                    CSE006
      *                                                                   CSE006
     C                     MOVE *BLANKS   ZFLD15                          CSE006
     C                     MOVE ZCONP     ZFLD15                          CSE006
     C                     Z-ADD8         ZDECS                           CSE006
     C                     MOVE 'L'       ZECODE                          CSE006
     C                     EXSR ZSEDIT                                    CSE006
     C                     MOVE ZOUT21    TRDPRC                          CSE006
      *                                                                   CSE006
      *** Nominal                                                         CSE006
      *                                                                   CSE006
     C                     MOVE *BLANKS   ZFLD15                          CSE006
     C                     MOVE NOML      ZFLD15                          CSE006
     C                     MOVE 'J'       ZECODE                          CSE006
     C                     Z-ADDTNMD      ZDECS                           CSE006
     C                     EXSR ZSEDIT                                    CSE006
     C                     MOVE ZOUT21    TRDNML                          CSE006
      *                                                                   CSE006
      *** Consideration                                                   CSE006
      *                                                                   CSE006
     C                     Z-ADDZCONP     ZPRC                            CSE006
     C                     Z-ADDNOML      ZNOML                           CSE006
     C                     Z-ADDA6NBDP    ZCDP                            CSE006
     C                     EXSR ZCNSD                                     CSE006
     C                     Z-ADDZCONS     ZFLD15                          CSE006
      *                                                                   CSE006
     C           PROT      IFEQ '8'                                       CSE006
     C                     MULT TCFC      ZFLD15    H                     CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     MOVE 'J'       ZECODE                          CSE006
     C                     Z-ADDA6NBDP    ZDECS                           CSE006
     C                     EXSR ZSEDIT                                    CSE006
     C                     MOVE ZOUT21    TRDCON                          CSE006
      *                                                                   CSE006
      *** Overflow handling                                               CSE006
      *                                                                   CSE006
     C********** LCOUNT    IFGT 55                                                   CSE006 AR322165
     C**********           WRITEHEADER                                               CSE006 AR322165
     C**********           Z-ADD17        LCOUNT                                     CSE006 AR322165
      *                                                                   CSE006
     C********** CAC005    IFEQ 'Y'                                                  CSE006 AR322165
     C**********           ADD  1         LCOUNT                                     CSE006 AR322165
     C**********           ENDIF                                                     CSE006 AR322165
      *                                                                   CSE006
     C**********           ENDIF                                                     CSE006 AR322165
      *                                                                                     AR322165
      ** Amend the overflow procedure                                                       AR322165
      *                                                                                     AR322165
     C                     Z-ADD1         RQDLN1                                            AR322165
     C           OFLLN1    SUB  PRTLN1    DIFLN1                                            AR322165
     C           DIFLN1    IFLE RQDLN1                                                      AR322165
     C                     WRITEHEADER                                                      AR322165
     C                     ENDIF                                                            AR322165
      *                                                                   CSE006
      *** Print Trade line                                                CSE006
      *                                                                   CSE006
     C                     WRITETRADE                                     CSE006
      *                                                                   CSE006
     C**********           ADD  1         LCOUNT                                     CSE006 AR322165
      *                                                                   CSE006
      ***  End of If *IN64 = '1' (OK to include).                         CSE006
      *                                                                   CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** If only the first trade has been printed then set the           CSE006
      *** C/F Price equal to price of first trade                         CSE006
      *                                                                   CSE006
     C                     SELEC                                          CSE006
     C           *IN63     WHEQ '1'                                       CSE006
     C           *IN64     ANDEQ'0'                                       CSE006
      *** Price                                                           CSE006
     C                     MOVE *BLANKS   ZFLD15                          CSE006
     C                     MOVE TPRC1     ZFLD15                          CSE006
     C                     Z-ADD8         ZDECS                           CSE006
     C                     MOVE 'L'       ZECODE                          CSE006
     C                     EXSR ZSEDIT                                    CSE006
     C                     MOVE ZOUT21    CFPRIC                          CSE006
      *** Nominal                                                         CSE006
     C                     MOVE *BLANKS   ZFLD15                          CSE006
     C                     MOVE TNML1     ZFLD15                          CSE006
     C                     MOVE 'J'       ZECODE                          CSE006
     C                     Z-ADDNMDP      ZDECS                           CSE006
     C                     EXSR ZSEDIT                                    CSE006
     C                     MOVE *BLANK    Z21SIG                          CSE006
     C                     MOVE ZOUT21    CFNOML                          CSE006
     C                     MOVE ZOUT21    WCFNOM 160                      CSE006
      *                                                                   CSE006
      *** Consideration                                                   CSE006
      *                                                                   CSE006
     C                     MOVE *BLANKS   ZFLD15                          CSE006
     C                     MOVE TCON1     ZFLD15                          CSE006
     C           5         SUB  NMDP      ZI      20                      CSE006
     C           ZFLD15    MULT POWER8,ZI ZFLD15    H                     CSE006
     C                     MOVE 'J'       ZECODE                          CSE006
     C                     Z-ADDA6NBDP    ZDECS                           CSE006
     C                     EXSR ZSEDIT                                    CSE006
     C                     MOVE *BLANK    Z21SIG                          CSE006
     C                     MOVE ZOUT21    CFCONS                          CSE006
      *                                                                   CSE006
      *** If the second trade has been printed then set the               CSE006
      *** C/F Price equal to price of first trade                         CSE006
      *                                                                   CSE006
     C           *IN64     WHEQ '1'                                       CSE006
      *** Price                                                           CSE006
     C                     MOVE *BLANKS   ZFLD15                          CSE006
     C                     MOVE *ZEROS    ZFLD15                          CSE006
     C                     Z-ADD8         ZDECS                           CSE006
     C                     MOVE 'L'       ZECODE                          CSE006
     C                     EXSR ZSEDIT                                    CSE006
     C                     MOVE ZOUT21    CFPRIC                          CSE006
      *** Nominal                                                         CSE006
     C                     MOVE *BLANKS   ZFLD15                          CSE006
     C                     MOVE *ZEROS    ZFLD15                          CSE006
     C                     MOVE 'J'       ZECODE                          CSE006
     C                     Z-ADDNMDP      ZDECS                           CSE006
     C                     EXSR ZSEDIT                                    CSE006
     C                     MOVE *BLANK    Z21SIG                          CSE006
     C                     MOVE ZOUT21    CFNOML                          CSE006
     C                     MOVE ZOUT21    WCFNOM 160                      CSE006
      *                                                                   CSE006
      *** Consideration                                                   CSE006
     C                     MOVE *BLANKS   ZFLD15                          CSE006
     C                     MOVE *ZEROS    ZFLD15                          CSE006
     C           5         SUB  NMDP      ZI      20                      CSE006
     C           ZFLD15    MULT POWER8,ZI ZFLD15    H                     CSE006
     C                     MOVE 'J'       ZECODE                          CSE006
     C                     Z-ADDA6NBDP    ZDECS                           CSE006
     C                     EXSR ZSEDIT                                    CSE006
     C                     MOVE *BLANK    Z21SIG                          CSE006
     C                     MOVE ZOUT21    CFCONS                          CSE006
      *                                                                   CSE006
     C                     ENDSL                                          CSE006
      *                                                                   CSE006
      *** Realised profit/Loss this month                                 CSE006
      *                                                                   CSE006
     C                     MOVE *BLANKS   ZFLD15                          CSE006
     C                     MOVE BSPL      ZFLD15                          CSE006
     C                     MOVE 'J'       ZECODE                          CSE006
     C                     Z-ADDA6NBDP    ZDECS                           CSE006
     C                     EXSR ZSEDIT                                    CSE006
     C                     MOVE ZOUT21    RPRLSM                          CSE006
      *                                                                   CSE006
      *** If C/F nominal is 0 then calculate p/l equal BSPL               CSE006
      *** and set the C/F nominal postion to 'FLAT'                       CSE006
      *                                                                   CSE006
     C           WCFNOM    IFEQ *ZERO                                     CSE006
     C                     MOVE BSPL      WBSPL  150                      CSE006
     C           WBSPL     ADD  @TPL      @TPL                            CSE006
      *                                                                   CSE006
     C                     MOVE 'FLAT '   CFPOSN                          CSE006
      *                                                                   CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** If any one of the trades is printed then print C/F line         CSE006
      *                                                                   CSE006
     C           *IN63     IFEQ '1'                                       CSE006
     C           *IN64     OREQ '1'                                       CSE006
      *                                                                   CSE006
      *** Total realised Profit this month                                CSE006
      *                                                                   CSE006
     C                     MOVE *BLANKS   ZFLD15                          CSE006
     C                     MOVE @TPL      ZFLD15                          CSE006
     C                     MOVE 'J'       ZECODE                          CSE006
     C                     Z-ADDA6NBDP    ZDECS                           CSE006
     C                     EXSR ZSEDIT                                    CSE006
     C                     MOVE ZOUT21    TRPRTM                          CSE006
      *                                                                   CSE006
      *** Overflow handling                                               CSE006
      *                                                                   CSE006
     C********** LCOUNT    IFGT 55                                                   CSE006 AR322165
     C**********           WRITEHEADER                                               CSE006 AR322165
     C**********           Z-ADD18        LCOUNT                                     CSE006 AR322165
      *                                                                   CSE006
     C********** CAC005    IFEQ 'Y'                                                  CSE006 AR322165
     C**********           ADD  1         LCOUNT                                     CSE006 AR322165
     C**********           ENDIF                                                     CSE006 AR322165
      *                                                                   CSE006
     C**********           ENDIF                                                     CSE006 AR322165
      *                                                                                     AR322165
      ** Amend the overflow procedure                                                       AR322165
      *                                                                                     AR322165
     C                     Z-ADD8         RQDLN1                                            AR322165
     C           OFLLN1    SUB  PRTLN1    DIFLN1                                            AR322165
     C           DIFLN1    IFLE RQDLN1                                                      AR322165
     C                     WRITEHEADER                                                      AR322165
     C                     ENDIF                                                            AR322165
      *                                                                   CSE006
      *** Print Carried forward line                                      CSE006
      *                                                                   CSE006
     C                     WRITECFLINE                                    CSE006
     C                     MOVE *OFF      *IN63                           CSE006
     C                     MOVE *OFF      *IN64                           CSE006
     C**********           ADD  5         LCOUNT                                     CSE006 AR322165
      *                                                                   CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** TAG for Matured securities                                      CSE006
      *                                                                   CSE006
     C           BSJUMP    TAG                                            CSE006
      *                                                                   CSE006
      *** Initialise work field                                           CSE006
      *                                                                   CSE006
     C                     MOVE *BLANKS   WCFNOM                          CSE006
      *                                                                   CSE006
     C           BHBA      READEBSPOSDL1                 55               CSE006
      *                                                                   CSE006
     C                     ENDDO                                          CSE006
      *                                                                   CSE006
     C                     ENDSR                                          CSE006
      *                                                                   CSE006
      *****************************************************************   CSE006
      /EJECT                                                              S01117
      *****************************************************************   S01117
      *                                                               *   S01117
      *  *PSSR  - Error control subroutine                            *   S01117
      *                                                               *   S01117
      *****************************************************************   S01117
      *                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR **    S01117
     C**                                                                  S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     ENDSR                                          S01117
     C**                                                                  S01117
      *****************************************************************   E20145
      /EJECT                                                              E29170
      *****************************************************************   E29170
      *                                                               *   E29170
      *  RCFP1 -- SUBROUTINE TO REGISTER P1 PRINTER FILE VIA RCF      *   E29170
      *                                                               *   E29170
      *****************************************************************   E29170
      *                                                                   E29170
     C           RCFP1     BEGSR                            ** RCFP1 **   E29170
      *                                                                   E29170
      ** Ensure report spool file recorded by RCF                         E29170
      *                                                                   E29170
     C                     Z-ADDSFNUM     ZSNUM   60                      E29170
      *                                                                   E29170
     C                     CALL 'ZSFILE'                                  E29170
     C                     PARM           SEQ     5                       E29170
     C                     PARM BHBA      SENTY   3                       E29170
     C                     PARM           SFILE                           E29170
     C                     PARM           ZSNUM                           E29170
     C                     PARM           ZSERR   1                       E29170
      *                                                                   E29170
     C           ZSERR     IFEQ 'Y'                                       E29170
      *                                                                   E29170
      ** Error during ZSFILE processing, return to calling program        E29170
      *                                                                   E29170
     C                     SETON                     U7U8LR               E29170
     C                     RETRN                                          E29170
     C                     END                                            E29170
      *                                                                   E29170
     C                     ENDSR                                          E29170
      *                                                                   E29170
      *****************************************************************   E29170
      /EJECT                                                              E29170
      *****************************************************************   E29170
      *                                                               *   E29170
      *  RCFAU -- SUBROUTINE TO REGISTER AU PRINTER FILE VIA RCF      *   E29170
      *                                                               *   E29170
      *****************************************************************   E29170
      *                                                                   E29170
     C           RCFAU     BEGSR                            ** RCFAU **   E29170
      *                                                                   E29170
      ** Ensure audit spool file recorded by RCF                          E29170
      *                                                                   E29170
     C                     Z-ADDSFNUMU    ZSNUMU  60                      E29170
      *                                                                   E29170
     C                     CALL 'ZSFILE'                                  E29170
     C                     PARM           SEQ                             E29170
     C                     PARM *BLANKS   SENTY                           E29170
     C                     PARM           SFILEU                          E29170
     C                     PARM           ZSNUMU                          E29170
     C                     PARM *BLANK    ZSERR                           E29170
      *                                                                   E29170
     C           ZSERR     IFEQ 'Y'                                       E29170
      *                                                                   E29170
      ** Error during ZSFILE processing, return to calling program        E29170
      *                                                                   E29170
     C                     SETON                     U7U8LR               E29170
     C                     RETRN                                          E29170
     C                     END                                            E29170
      *                                                                   E29170
     C                     ENDSR                                          E29170
      *                                                                   E29170
      *****************************************************************   E29170
      /EJECT                                                              E21002
     C/COPY ZSRSRC,ZBKCTPZ1                                               E21002
      /EJECT                                                              E21002
     C/COPY ZSRSRC,ZAVPRZ1                                                E23586
      /EJECT                                                              E23586
     C/COPY ZSRSRC,ZCNSDZ1                                                E21002
      /EJECT                                                              E20959
     C/COPY ZSRSRC,ZDATE1Z2                                               E20959
      /EJECT
     C/COPY ZSRSRC,ZDATE2Z4
      /EJECT                                                              E20959
     C/COPY ZSRSRC,ZDAYSZ2                                                E20959
      /EJECT                                                              E20959
     C/COPY ZSRSRC,ZDYYRZ3                                                E20959
      /EJECT                                                              E20959
     C/COPY ZSRSRC,ZEVCDZ1                                                E20959
      */EJECT*******************                                          S01117
     C*/COPY*ZSRSRC,ZICD2Z1*****                                          S01117
      */EJECT*****************                                            S01117
     C*/COPY*ZSRSRC,ZICDSEZ1***                                           S01117
      /EJECT                                                              E20959
     C/COPY ZSRSRC,ZLCDZ1                                                            E20959 MD057247
      /EJECT                                                              E20959
     C/COPY ZSRSRC,ZNCDZ3                                                 E20959
      /EJECT                                                              E20959
     C/COPY ZSRSRC,ZPRCIZ1                                                E20959
      /EJECT
     C/COPY ZSRSRC,ZSDESCZ3
      /EJECT
     C/COPY ZSRSRC,ZSEDITZ3
      */EJECT****************                                             S01117
     C*/COPY*ZSRSRC,ZSYSTMZ1***                                           S01117
      /EJECT                                                              E20959
     C/COPY ZSRSRC,ZYLDIZ1                                                E20959
      /EJECT                                                              E20959
     C/COPY ZSRSRC,ZYLDZ2                                                 E20959
      /EJECT
     C/COPY ZSRSRC,ZCALCD                                                 E39495
     C/EJECT                                                              E39495
     C/COPY ZSRSRC,ZACCZZ1                                                E39495
     C/EJECT                                                              E39495
     C/COPY ZSRSRC,ZACCRZ1                                                E39495
     C/EJECT                                                              E39495
     C/COPY ZSRSRC,ZRATEZ1                                                E39495
     C/EJECT                                                              E39495
      ***
**  CPY@
(c) Finastra International Limited 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   MKT  - Market/Description
PPRIMARY
SSECONDARY
GGREY
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
0006001521029820444305904073650882610287117481320914670161311759219053
2051421975234362489726358278192928030741322023366335124365853804639507
40968424294389045351
**  POWER8 - ARRAY OF POWERS FOR CURRENCY CONVERSION
00000001
00000010
00000100
00001000
00010000
00100000
01000000
10000000
