     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Holdings exposure report')                    *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Securities Trading Module                            *
     F*                                                               *
     F*  SE1020 - HOLDINGS EXPOSURE REPORT                            *
     F*                                                               *
     F*  Function: Report holdings exposure against limits.  Report   *
     F*   (COB)    shows exposure for one of the following catagories:*
     F*            - Issuer/Risk Customer                             *
     F*            - Parent of Issuer/Risk Customer                   *
     F*            - Currency                                         *
     F*            - Country of Risk (from security)                  *
     F*            - Country of Risk (from Issuer/Risk customer)      *
     F*            - Investment Type                                  *
     F*            - Security                                         *
     F*                                                               *
     F*  Input Parameters:                                            *
     F*            Reporting Level        - S,C or B                  *
     F*            Exposure Category      - 1,2,3,4,5,6 OR 7          *
     F*            Holdings Indicator     - O,D,S OR A                *
     F*            Exception Indicator    - Y OR N                    *
     F*            Factored Indicator     - U OR F                    *
     F*            Sequence Number                                    *   S01117
     F*            Entity                                             *   S01117
     F*                                                               *
     F*  Called by: SEC0801 - Exposure Reports - Holdings             *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. 248698             Date 01Jun20               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 226449             Date 24Jun15               *
      *                 MD034776           Date 09Jul15               *
      *                 AR1067108          Date 11Dec12               *
      *                 AR1001183A         Date 20Nov12               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSE081             Date 15Feb06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSE071             Date 19Jul05               *
      * Midas Plus 1.2 -----------------------------------------------*
      *                 229857             Date 07Oct04               *
      *                 226570             Date 27Jun04               *
      *                 211407             Date 07Jan03               *
      *                 207543             Date 17Jul02               *
      *                 194370             Date 12Jul01               *
      *                 180056             Date 18Oct00               *
      *                 CSE037             Date 29Apr02               *
      *                 CSE035             Date 22Apr02               *
      *                 206316             Date 19Jul02               *
      * Midas Release 4.01.03 ----------------------------------------*
      *                 208369             Date 14Jan03               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 203823             Date 13Mar02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 17Jun01               *
      *                 CSE031             Date 09Nov01               *
      *                 180707             Date 25Jul00               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      *                 140272             Date 20Apr00               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CAC005             Date 13Jan99               *
     F*                 130862             Date 18Oct98               *
      *                 151945             Date 06Jan99               *
      *                 123783             Date 04Feb98               *
      *                 CSE005             Date 04Feb97               *
     F*                 084704             DATE 01AUG96               *
     F*                 083039             DATE 01AUG96               *
     F*                 059110             DATE 25JUL96               *
     F*                 088047             DATE 26JUN96               *
     F*                 100228             DATE 30MAY96               *
     F*                 099886             DATE 18APR96               *
     F*                 100017             DATE 18APR96               *
     F*                 S01408             DATE 05MAR96               *
     F*                 092961             DATE 04OCT95               *
     F*                 091254             DATE 20OCT95               *
     F*                 086491             DATE 15JUN95               *
     F*                 064575             DATE 15AUG94               *
     F*                 065301             DATE 05MAY94               *
     F*                 052254             DATE 10JAN94               *
     F*                 S01401             DATE 16JUN93               *
     F*                 E39495             DATE 17FEB93               *
     F*                 E47922             DATE 01FEB93               *
     F*                 S01397             DATE 10SEP92               *
     F*                 E38657             DATE 22APR92               *
     F*                 E37493             DATE 01APR92               *
     F*                 E35470             DATE 05FEB92               *
     F*                 E33035             DATE 09DEC91               *
     F*                 E29170             DATE 23OCT91               *
     F*                 E27934             DATE 22OCT91               *
     F*                 E27092             DATE 04SEP91               *
     F*                 S01195             DATE 19JUL91               *
     F*                 S01117             DATE 19JUL91               *
     F*                 S01269             DATE 01AUG90               *
     F*                 E21668             DATE 01MAY90               *
     F*                 E21616             DATE 03APR90               *
     F*                 E21582             DATE 30MAR90               *
     F*                 E21100             DATE 10FEB90               *
     F*                 E20988             DATE 30JAN90               *
     F*                 S01232             DATE 12DEC89               *
     F*                 E20380             DATE 08DEC89               *
     F*                 E19505             DATE 14NOV89               *
     F*                 E16231             DATE 19/06/89              *
     F*                 E18218             DATE 12/06/89              *
     F*                 E14607             DATE 31/08/88              *
     F*                 S01176             DATE 18/08/88              *
     F*                 S01158             DATE 05/05/88              *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  248698 - Rounding discrepancies on some SE reports. Applied  *
      *           fix 228682.                                         *
      *  228682 - Recompiled due to ZCNSDZ1 changes. Applied 176594.  *
      *  MD046248 - Finastra Rebranding                               *
      *  226449 - Recompiled over changes made in /COPY ZDYYRZ3.      *
      *         - Applied for MD034387.                               *
      *  MD034776 - Reverse AR1001183A to allow negative interest     *
      *             rate. (Recompile)                                 *
      *  AR1067108 - PMC1140 Component failed during Clean COB.       *
      *              Applied fix AR1001183A                           *
      *  AR1001183A - Coupon rate was still used in computation of    *
      *              interest instead of using the details in FRN tab *
      *              (Reopen) (Recompile)                             *
      *  CSE081 - For category type 6 exposure should be reported     *
      *           Avoid loop if end period is greater than 24 months  *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  229857 - Recompiled due to change in ZYLDZ2.                 *
      *  226570 - Recompiled due to change in ZYLDZ2.                 *
      *  211407 - Recompile after change on copy sources ZYLDZ2,      *
      *           ZACCRZ1 and ZYCEZ1 for NX/NNX processing.           *
      *           The change was to call subroutine ZLCD1 instead     *
      *           of ZLCD in retrieving the PERIOD for NNX processing *
      *           and ZNCD1 is called instead of ZNCD in retrieving   *
      *           the WBENCD for NNX processing. Also rewrite tests   *
      *           for identifying if position is NX,NNX or CUM.       *
      *  207543 - CEU018 not working on a price basis.                *
      *           Recompiled over changed ZYLDZ2.                     *
      *  194370 - Recompile after change on copy sources ZYLDZ2,      *
      *           For securities with divisor basis = '5' and first   *
      *           coupon date > valuation date (rundate + 1), set     *
      *           event control date to first coupon date before      *
      *           processing SR/ZDYYR. This is to ensure that the     *
      *           correct hypothetical last and next coupon dates are *
      *           used in deriving the price/yield rate.              *
      *  180056 - Recompiled over changed in ZDYYRZ3.                 *
      *  CSE037 - Bond Pricing - 3 Decimal Places in Trades Input     *
      *  CSE035 - NX/NNX Coupon Payment Processing.                   *
      *           Recompile over changed ZACCRZ1/ZYLDZ2/ZYCEZ1
      *  206316 - Recompiled over changed ZLCDZ1.                     *
      *  208369 - Period End computed incorrectly. Fix is to simply   *
      *           add the number of years to rundate year. Applied    *
      *           fix 163073.                                         *
      *  203823 - Increase Array sizes again.                         *
      *  CPK015 - Conversion of ZYIELD from PLI to RPG.               *
      *           Recompile over changed ZYLDZ2.                      *
      *  CSE031 - Coupon Fixing for Floating Rate Notes.              *
      *           (recompilation due to change to ZNCD/ZLCD/ZACCR).   *
      *  180707 - No Position Settlements generated. Recompile over   *
      *           changes in /COPY ZNCDZ3.                            *
     F*  140272 - Recompile over changed ZYLDZ2                       *
      *  CAC005 - Profit Centre Accounting - SE Enhancement           *
     F*  130862 - Recompiled over ZLCDZ1 & ZDAYSZ2 changes.           *
     F*  151945 - Recompiled Over changed ZDYYRZ3 .                   *
     F*  CSE005 - Effect of holidays on FRN Coupon Dates              *
     F*           (recompilation due to change to ZNCD/ZLCD/ZACCR).   *
     F*  123783 - Limits not appearing on exposure reports.           *
     F*  084704 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
     F*  083039 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
     F*  059110 - Recompile over changed ZYLDZ2 sub.                  *
     F*  088047 - RECOMPILE over change SR/ZYLDZ2.                    *
     F*  100228 - RECOMPILE OVER CHANGED ZDYYRZ3, ZLCDZ1 & ZNCDZ3.    *
     F*  099886 - Rounding problem for partly paid securities.        *
     F*           Fix applied is the same as in ZACCZ subroutine.     *
     F*  100017 - Position settlement unable to pick up day adj. on   *
     F*           SECTYD. Change subroutine to use DADJN to stop      *
     F*           interest day adjustment being used for amortisation.*
     F*           Recompile over amended subroutine ZDAYS.            *
     F*  S01408 - Addition of core hook SE1020FFP1                    *
     F*           Addition of core hook SE1020CCP1                    *
     F*           Addition of core hook SE1020CCP2                    *
     F*           Addition of core hook SE1020CCP3                    *
     F*  092961 - Recompile over ZDAYSZ2 which was amended by 086491  *
     F*           (Wrong number of days calculated for day basis 1    *
     F*           when start or end day is last day of February)      *
     F*  091254 - RECOMPILE OVER CHANGED ZLCDZ1 & ZNCDZ3              *
     F*  086491 - Wrong nbr of days calculated for day basis 1        *
     F*           when start or end day is last day of February       *
     F*           Recompiled for ZSRSRC/ZDAYSZ2 changes.              *
     F*  064575 - Recompiled over amended ZYLDZ2 subroutine.          *
     F*  065301 - Recompiled over changed copy source ZACCR subr.     *
     F*           with ZAMT increased to 15,0.                        *
     F*  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
     F*           to 10,9                                             *
     F*  S01401 - MT5xx SWIFT Messages Feature:                       *
     F*           - Recompiled due to changes to files.               *
     F*  E39495 - New /COPY subroutine ZCALCD added (called from      *
     F*           SR. ZYLD)                                           *
     F*         - /COPY subroutine ZCNSDZ1 added (called from SR.ZYLD)*
     F*         - Recompiled over changed ZYLDZ2                      *
     F*  E47922 - Recompiled over changed SR/ZYLDZ2                   *
     F*  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
     F*           - Recompiled due to changes to files and SR/ZYLD.   *
     F*  E38657 - Incorrect branch passed to ZSFILE                   *
     F*  E37493 - Recompiled over changed printer file                *
     F*  E35470 - System level report was not having titles           *
     F*  E33035 - Trying to open opened P1 printer file               *
     F*  E29170 - Report Control Facility changes                     *
     F*  E27934 - Recompiled over the changed version of ZACCRZ1      *
     F*  E27092 - Recompiled over changed SR/ZLCD                     *
     F*  S01195 - Holiday Processing.                                 *
     F*  S01117 - Multibranching.                                     *
     F*  S01269 - Trade authorisation: recompile over changed file    *
     F*           TABSE.                                              *
     F*  E21668 - Recompiled over changed SR/ZYLDZ2                   *
     F*  E21616 - Recompiled over changed SR/ZLCD.                    *
     F*  E21582 - Array Index Variable redefined larger.              *
     F*  E21100 - Program loops if Limit End Period is an Invalid Date*
     F*  E20988 - Correct the keylist for INVTPC and always show the  *
     F*           INVT so that least some description is given.       *
     F*         - Correct selection criteria; If no book limit is     *
     F*           found then do NOT use the system wide default.      *
     F*  S01232 - AUSTRALIAN YIELDS MODIFICATION                      *
     F*  E20380 - ZYLDZ1 and ZYLDZ2 changed. ZLCDZ1 now needed.       *
     F*  E19505 - Array Index Limits were too small for Book Codes    *
     F*           and Exposure Percentages. Increased to 150.         *
     F*  E16231 - FOR A YIELD BASED SECURITY CONVERT YIELD TO PRICE.  *
     F*           ALSO - CORRECT EXPOSURE = NOMINAL X MKT PRICE.      *
     F*  E18218 - PRINT COUPON RATE AND MATURITY DATE BESIDE          *
     F*           THE REPORT NAME OF EACH SECURITY. ALSO -            *
     F*           INCREMENT YEAR FOR ANNUAL PERIODS.                  *
     F*  E14607 - REMOVE CALCS. FOR PART PAYMENT IN SR/EXP            *
     F*  S01176 - SECURITIES TRADING 3.1                              *
     F*  S01158 - POST INCORPORATION DEVELOPMENT FIXES                *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
      *
     FSLIMQF  IF  E           K        DISK
     FBKPHDQF IF  E           K        DISK                           UC
     FCPOSNQF IF  E           K        DISK                           UC
     FSLIMEL  IF  E           K        DISK                           UC
     FSLIMFL  IF  E           K        DISK                           UC
     FSLIMGL  IF  E           K        DISK                           UC
     FSLIMHL  IF  E           K        DISK                           UC
     FSLIMIL  IF  E           K        DISK                           UC
     FBOOKD   IF  E           K        DISK                           UC
     FLMTPD   IF  E           K        DISK
     FSECTY   IF  E           K        DISK
     FINVTPC  IF  E           K        DISK                               S01176
     FCLINT   IF  E           K        DISK                           UC
     F            CLINTCAF                          KIGNORE
     F            CLINTSEF                          KIGNORE
     F            CLINTCCF                          KIGNORE
     F            CLINTC1F                          KIGNORE
     FSE1020P1O   E                    PRINTER                        UC
     F                                              KINFDS SPOOL          E29170
     FSE1020AUO   E                    PRINTER                        UC  E29170
     F                                              KINFDS SPOOLU         E29170
     FTABTG30 IT  F      40           EDISK
     FTABSE   IF  E           K        DISK
     F* ICD 1     TABTB10F                          KIGNORE
     F* ICD 2     TABTB11F                          KIGNORE
     F* ICD SE    TABTB36F                          KIGNORE
     F            TABTB40F                          KIGNORE
     F* CCYS      TABTG10F                          KIGNORE               S01232
     F            TABTG20F                          KIGNORE
     F* COUNTRY   TABLETHF                          KIGNORE
     F* HOLS      TABLETJF                          KIGNORE               S01232
     F            TABLETLF                          KIGNORE
     F* BRANCH    TABLETRF                          KIGNORE
     F            TABLETXF                          KIGNORE
     F            TABLET2F                          KIGNORE
     F* COMPANY   TABLET3F                          KIGNORE
     F            TABLET5F                          KIGNORE
     F            TABTE10F                          KIGNORE
     F            TABLETNF                          KIGNORE
     F            TABLETKF                          KIGNORE
     F            TABLETPF                          KIGNORE
     F            TABLETAF                          KIGNORE
     FSEDEV   IF  E           K        DISK                               E16231
     FSECEO   IF  E           K        DISK                               S01232
     F            SEDEVDF                           KRENAMESEDEVDO        S01232
     F            SNDEVDF                           KRENAMESNDEVDO        S01232
     F*                                                                   S01408
     F/COPY WNCPYSRC,SE1020FFP1                                           S01408
     F*                                                                   S01408
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*   20  - USED FOR TABLE LOOKUPS                                *
     F*   41  - AUSTRALIAN YIELD TRADED SECURITY                      *   S01232
     F*   50  - ON IF CHECK INDICATES LIMITS HAVE BEEN EXCEEDED       *
     F*   60  - ON IF EXCEPT IS Y                                     *
     F*   61  - ON IF LEVEL IS C                                      *
     F*   62  - ON IF LEVEL IS B                                      *
     F*   63  - ON IF BOOK DESC TO BE PRINTED                         *
     F*   64  - ON IF FACTORED IS F                                   *
     F*   65  - ON IF CATEGORY DESC TO BE PRINTED                     *
     F*   80  - ERROR ON READING OTHER FILES                          *
     F*   82  - ON WHEN EOF ON ALL INPUT FILES                        *
     F*   83  - RECORD BEING PROCESSED FROM CPOSNQF FILE              *
     F*   84  - RECORD BEING PROCESSED FROM BKPHDQF FILE              *
     F*   85  - RECORD BEING PROCESSED FROM SLIMQF FILE               *
     F*   86  - EOF BOOKD                                             *
     F*   87  - END OF FILE ON CPOSNQF                                *
     F*   88  - END OF FILE ON BKPHDQF                                *
     F*   89  - END OF FILE ON SLIMQF                                 *
     F*                                                               *
     F* 90-99 - Used in Standard Subroutines.                         *
     F*                                                               *
     F* U7-U8 - DATABASE ERROR                                        *
     F*   U8  - DIFFERENCE BETWEEN CALC AND FILE TOTALS OF RECORDS    *
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*  *PSSR  - DUMP program on error                               *   S01117
     F*  FIRST  - OBTAINS ICD INFO AND CALCULATES REPORT CONTROL DATE *
     F*  LIMIT  - CALCULATE LIMITS                                    *
     F***PERIOD*-*CALCULATE*LIMIT*PERIODS*&*AMOUNTS********************   E16231
     F*  PERID  - CALCULATE LIMIT PERIODS & AMOUNTS                   *   E16231
     F*  DATE   - CALCULATE LIMIT PERIOD END DATE                     *
     F*  EXP    - CALCULATE EXPOSURE                                  *
     F*  CAT    - ACCESS DESCRIPTIONS                                 *
     F*  PRINT  - PRINT DETAIL REPORT                                 *
     F*  PCONV  - CONVERT EXPOSURE FROM NOMINAL TO BASE CURRENCY      *
     F*  RCFP1  - SUBROUTINE TO REGISTER P1 PRINTER FILE VIA RCF      *   E29170
     F*  RCFAU  - SUBROUTINE TO REGISTER AU PRINTER FILE VIA RCF      *   E29170
     F*                                                               *
     F*  ZACCZ  - CALCULATE ACCRUED INTEREST BETWEEN 2 DATES          *   S01117
     F*  ZCALCD - Calculate long term CD Price from Yield             *   E39495
     F*  ZCNSD  - Calculate consideration                             *   E39495
     F*  ZDATE1,2 DATE FORMATTERS                                     *
     F*  ZEVCD  - Determine Event Control date                        *   S01117
     F*  ZICD2  - CHAINS TO ICD TABTB11                               *
     F*  ZICDSE - CHAINS TO ICD TABTB36                               *
     F*  ZLCD   - Determine previous coupon date                      *   E20380
     F*  ZSEDIT - EDIT FIELDS                                         *
     F*  ZSYSTM - Obtains ICD1.                                       *
     F*                                                               *
     F*****************************************************************
      /EJECT
     E                    CPY@    1   1 80
     E/COPY ZSRSRC,ZHOLE                                                  S01195
     E* ARRAYS TO HOLD BOOK CODES AND ASSOCIATED DETAILS
     E********************BOK        50  2                                E19505
     E********************BDSC       50 30                                E19505
     E********************BSTP       50  3 0                              E19505
     E**********          BOK       150  2                                             E19505 203823
     E**********          BDSC      150 30                                             E19505 203823
     E**********          BSTP      150  3 0                                           E19505 203823
     E                    BOK       999  2                                                    203823
     E                    BDSC      999 30                                                    203823
     E                    BSTP      999  3 0                                                  203823
     E* ARRAYS TO HOLD PRINTER LEGENDS
     E                    HLA     1   4 23
     E                    C1A     1   7 16
     E                    C2A     1   7 15
     E* ARRAYS TO HOLD 7 X PERIOD DATES,EXPOSURE,LIMIT,EXCESS DETAILS
     E                    WPB         7  3
     E                    WP5         7  5 0
     E                    WPE         7  7
     E                    WLE         7 15 0
     E                    WLL         7 15 0
     E                    WSE         7 15 0
     E                    WSL         7 15 0
     E* ARRAYS OVER LIMIT TYPE FILE
     E                    LEP         6  3
     E                    LPC         6  3 0
     E/COPY ZSRSRC,ZPOWER8Z1
     E/COPY ZSRSRC,ZDATE2Z1
     E***/COPY*ZSRSRC,ZDATE6Z1                                      S01232S01195
     E/COPY ZSRSRC,ZSEDITZ1
     E/COPY ZSRSRC,ZDAYSZ1                                                E16231
     E/COPY ZSRSRC,ZNCDZ1                                                 E16231
     E* ARRAY TO LOAD CURRENCIES FROM TABTG30
     E    TABTG30         CCYA    1 150  3   CCYDT  37
      *                                                                                       CSE037
     IINVTPDF                                                                                 CSE037
     I              SFLG                            ISFLG                                     CSE037
      *                                                                                       CSE037
     E/COPY ZSRSRC,ZSEDITZ2
      /EJECT
     I*
     I            DS
     I*
     I* DATA STRUCTURES TO STORE KEYS
     I*
     I                                        1  12 TKEY
     I                                        1   20RECT
     I                                        3  10 ZZ008
     I            DS
     I                                        1  15 SLKEY
     I                                        1   3 SQEN
     I                                        4   5 SQBK
     I                                        6  15 SQCT
     I            DS
     I                                        1  15 BKKEY
     I                                        1   3 BQEN
     I                                        4   5 BQBK
     I                                        6  15 BQCT
     I            DS                                                      CAC005
     I                                        1  15 NWKEY                 CAC005
     I                                        1   3 NBQEN                 CAC005
     I                                        4   5 NBKCD                 CAC005
     I                                        6  15 NBQCT                 CAC005
     I            DS
     I                                        1  15 CPKEY
     I                                        1   3 CQEN
     I                                        4   5 CQBK
     I                                        6  15 CQCT
     I            DS
     I                                        1  15 THKEY
     I                                        1   3 TENT
     I                                        4   5 TBOK
     I                                        6  15 TCAT
     I                                        6   7 CAT2
     I                                        6   8 CAT3
     I                                        6  11 CAT6
     I            DS
     I                                        1  15 LTKEY
     I                                        1   3 LENT
     I                                        4   5 LBOK
     I                                        6  15 LCAT
     I            DS
     I                                        1  15 PRKEY
     I                                        1   3 PENT
     I                                        4   5 PBOK
     I                                        6  15 PRCAT
      *
     I            DS
      *
      * OTHER DATA STRUCTURES
      *
     I                                        1  37 CCYDEN
     I                                        1   10XDECN
     I                                        9   90XMDIN
     I                                    P  10  168XERLN
     I            DS
     I                                        1  37 CCYDEB
     I                                        1   10XDECB
     I                                        9   90XMDIB
     I                                    P  10  168XERLB
     I            DS
     I                                        1  31 CATD
     I                                        1  20 CATD1
     I                                       22  31 CATD2
     I            DS
     I                                        1  18 LPC
     I                                        1   30LPC1
     I                                        4   60LPC2
     I                                        7   90LPC3
     I                                       10  120LPC4
     I                                       13  150LPC5
     I                                       16  180LPC6
     I            DS
     I                                        1  18 LEP
     I                                        1   3 LEP1
     I                                        4   6 LEP2
     I                                        7   9 LEP3
     I                                       10  12 LEP4
     I                                       13  15 LEP5
     I                                       16  18 LEP6
     I            DS
     I                                        1   60DATWK
     I                                        1   20DWK1
     I                                        3   40DWK2
     I                                        5   60DWK3
     I            DS
     I                                        1   3 LEPWK
     I                                        1   30LEPWKN
     I                                        1   20LEPW12
     I                                        3   3 LEPW3
     I*
     I***LDA*****   UDS                            256                    S01117
     I***********                           134 177 DBLOT                 S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 177 DBASE                 S01117
      *                                                                   S01117
     ILDA         DS                            256                       S01117
      *                                                                   S01117
      ** *LOCK IN LDA immediately before and OUT LDA immediately          S01117
      ** after each database error handling.                              S01117
      *                                                                   S01117
     I                                      134 183 DBLOT                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     I*                                                                   E29170
     ISPOOL       DS                                                      E29170
     I*                                                                   E29170
     I**  DS FOR P1 SPOOL FILE NAME                                       E29170
     I*                                                                   E29170
     I                                       83  92 SFILE                 E29170
     I                                    B 123 1240SFNUM                 E29170
     I*                                                                   E29170
     ISPOOLU      DS                                                      E29170
     I*                                                                   E29170
     I                                       83  92 SFILEU                E29170
     I                                    B 123 1240SFNUMU                E29170
     I*
     ICPYR@#      DS
     I*
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I*
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*
     I/COPY ZSRSRC,ZNCDZ2                                                 E16231
     I/COPY ZSRSRC,ZYLDZ1                                                 E16231
      *                                                                   S01195
      ** Data structures for holiday processing.                          S01195
      *                                                                   S01195
     I/COPY ZSRSRC,ZHOLI                                                  S01195
      *                                                                   S01195
     I/COPY ZSRSRC,ZHOLDS                                                 S01195
     I/COPY WNCPYSRC,SE1020I001
     ISDPRFC    E DSSDPRFCPD                                              CAC005
      ** External data structure for Profit Centre Details                CAC005
      *                                                                   CAC005
     IDSFDY     E DSDSFDY                                                 CAC005
      ** First DS for Access Programs, Short Data Structure               CAC005
      *                                                                   CAC005
     C/EJECT
     C*================================================================
     C*  P R O G R A M     S T A R T
     C*================================================================
     C* KEYLISTS FOR CHAINING TO FILES
     C*
     C* TABLE FILE
     C*
     C           TABKEY    KLIST
     C                     KFLD           TKEY   12
     C*
     C* CLINT FILE
     C*
     C           CLKEY     KLIST
     C                     KFLD           CAT6P
     C                     KFLD           CRECID
     C*
     C* INVTPC FILE                                                       S01176
     C*
     C           INKEY     KLIST                                          S01176
     C***********          KFLD           CCYI                     S01176 E20988
     C                     KFLD           INVT                            S01176
     C                     KFLD           CCYI                     S01176 E20988
     C*                                                                   S01176
     C* SLIM FILES
     C*                                                                   S01176
     C           SHKEY     KLIST
     C                     KFLD           PLEVEL
     C                     KFLD           TENT
     C                     KFLD           NOBOOK
     C                     KFLD           CAT6P
     C           SFKEY     KLIST
     C                     KFLD           PLEVEL
     C                     KFLD           TENT
     C                     KFLD           NOBOOK
     C                     KFLD           CAT3
     C           SEKEY     KLIST
     C                     KFLD           PLEVEL
     C                     KFLD           TENT
     C                     KFLD           NOBOOK
     C                     KFLD           CAT2
     C           SGKEY     KLIST
     C                     KFLD           PLEVEL
     C                     KFLD           TENT
     C                     KFLD           NOBOOK
     C                     KFLD           CAT3
     C           SIKEY     KLIST
     C                     KFLD           PLEVEL
     C                     KFLD           TENT
     C                     KFLD           NOBOOK
     C                     KFLD           TCAT
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE1020CCP1                                           S01408
     C*                                                                   S01408
     C*
     C* INPUT PARAMETERS
     C*
     C           *ENTRY    PLIST
     C                     PARM           PLEVEL  1
     C                     PARM           PCAT    1
     C                     PARM           PHOLD   1
     C                     PARM           PEXCPT  1
     C                     PARM           PFACT   1
     C                     PARM           SEQ     5                       S01117
     C                     PARM           ENT     3                       S01117
     C*
     C* CLEAR LDA
     C*
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE *BLANK    DBLOT
     C                     MOVE 'SE1020  'DBPGM
     C                     OUT  LDA                                       S01117
     C*
     C* OBTAIN ICD INFO
     C*
     C                     EXSR FIRST
     C*
     C* CHECK FOR DATABASE ERRORS
     C*
     C           *INU7     CABEQ'1'       ENDPGM
     C*
      /SPACE 5
     C*
     C* READ FIRST RECORD OFF UP TO 3 INPUT FILES
     C*
     C***********          OPEN SE1020P1                                  E29170
     C***********          Z-ADD70        LCNT                            E29170
     C                     READ SLIMQF                   89
     C           *IN89     IFEQ '1'
     C                     MOVE *HIVAL    SLKEY
     C                     END
     C*
     C           *IN88     IFEQ '0'
     C                     READ BKPHDQF                  88
      *                                                                   CAC005
      ** If CAC005 is installed, retrieve the corresponding user book     CAC005
      ** and profit centre.                                               CAC005
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     CALL 'AOBKPCR0'                                CAC005
     C                     PARM *BLANKS   PRTCD                           CAC005
     C                     PARM '*USER  ' POPTN                           CAC005
     C                     PARM           PBKCD   2                       CAC005
     C                     PARM           PPRFC   4                       CAC005
     C                     PARM BQBK      PPSBK   2                       CAC005
      *                                                                   CAC005
     C           PRTCD     IFEQ *BLANKS                                   CAC005
     C                     MOVE PBKCD     NBKCD                           CAC005
     C                     MOVE PPRFC     PRFC                            CAC005
     C                     ELSE                                           CAC005
     C                     MOVE *BLANKS   PRFC                            CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C                     MOVE BQEN      NBQEN                           CAC005
     C                     MOVE BQCT      NBQCT                           CAC005
     C                     MOVE NWKEY     WKKEY  15                       CAC005
     C                     ELSE                                           CAC005
     C                     MOVE BKKEY     WKKEY                           CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C           *IN88     IFEQ '1'
     C***********          MOVE *HIVAL    BKKEY                           CAC005
     C                     MOVE *HIVAL    WKKEY                           CAC005
     C                     END
     C                     ELSE
     C***********          MOVE *HIVAL    BKKEY                           CAC005
     C                     MOVE *HIVAL    WKKEY                           CAC005
     C                     END
     C*
     C           *IN87     IFEQ '0'
     C                     READ CPOSNQF                  87
     C           *IN87     IFEQ '1'
     C                     MOVE *HIVAL    CPKEY
     C                     END
     C                     ELSE
     C                     MOVE *HIVAL    CPKEY
     C                     END
     C*
     C* SET INDICATOR TO SHOW EOF ON ALL INPUT FILES
     C*
     C           *IN89     IFEQ '1'
     C           *IN88     ANDEQ'1'
     C           *IN87     ANDEQ'1'
     C                     SETON                     82
     C                     END
     C*
     C* PROCESS RECORDS UNTIL EOF ON ALL THOSE BEING PROCESSED
     C*
     C           *IN82     DOWNE'1'
     C*
     C* DETERMINE WHICH RECORD TO PROCESS NEXT
     C*
     C***********SLKEY     IFLE BKKEY                                     CAC005
     C           SLKEY     IFLE WKKEY                                     CAC005
     C           SLKEY     ANDLECPKEY
     C                     SETON                     85
     C                     MOVE SLKEY     THKEY
     C                     ELSE
     C***********BKKEY     IFLE CPKEY                                     CAC005
     C           WKKEY     IFLE CPKEY                                     CAC005
     C                     SETON                     84
     C***********          MOVE BKKEY     THKEY                           CAC005
     C                     MOVE WKKEY     THKEY                           CAC005
     C                     ELSE
     C                     SETON                     83
     C                     MOVE CPKEY     THKEY
     C                     END
     C                     END
     C*                                                                   E29170
     C** ONLY PROCESS RECORD IF REQUESTED                                 E29170
     C*                                                                   E29170
     C           ENT       IFEQ 'ALL'                                     E29170
     C           ENT       OREQ '   '                                     E29170
     C           ENT       OREQ TENT                                      E29170
     C*
     C* IF RECORD FOR NEW CATEGORY (& NOT FIRST RECORD) -
     C*     IF EXCEPT=Y CHECK WHETHER LIMITS HAVE BEEN EXCEEDED
     C*
     C           THKEY     IFNE LTKEY
     C           LTKEY     ANDNE*BLANKS
     C           PEXCPT    IFEQ 'Y'
     C                     EXSR CHECK
     C*
     C*     IF EXCEPT=Y & LIMITS HAVE BEEN EXCEEDED - PRINT DETAILS
     C*
     C           *IN50     IFEQ '1'
     C                     EXSR PRINT
     C                     END
     C*
     C*     IF EXCEPT=N - PRINT DETAILS
     C*
     C                     ELSE
     C                     EXSR PRINT
     C                     END
     C                     END
     C*
     C* IF RECORD FOR NEW CATEGORY -
     C*
     C           THKEY     IFNE LTKEY
     C*
     C*     ZEROISE EXPOSURE FIELDS
     C*
     C                     Z-ADD0         WLE
     C                     Z-ADD0         WSE
     C*
     C*     IF RECORD IS NOT A LIMIT RECORD CALCULATE LIMIT
     C*
     C           *IN85     IFEQ '0'
     C           *INU1     ORNE '1'                                       123783
     C                     EXSR LIMIT
     C                     END
     C*
     C*     CALCULATE PERIOD END DATES & LIMIT AMOUNTS
     C*
     C***********          EXSR PERIOD                                    E16231
     C                     EXSR PERID                                     E16231
     C*
     C*     GET CATEGORY DESCRIPTION
     C*
     C                     EXSR CAT
     C*
     C*     STORE NEW KEY FIELDS
     C*
     C                     MOVE THKEY     LTKEY
     C                     END
     C*
     C* IF RECORD IS A POSITION RECORD -
     C*
     C           *IN85     IFEQ '0'
     C*
     C*     CALCULATE EXPOSURE
     C*
     C                     EXSR EXP
     C                     END
     C                     END                                            E29170
     C*
     C* READ NEW RECORD FROM FILE LAST PROCESSED
     C*
     C           *IN85     IFEQ '1'
     C                     READ SLIMQF                   89
     C           *IN89     IFEQ '1'
     C                     MOVE *HIVAL    SLKEY
     C                     END
     C                     ELSE
     C           *IN84     IFEQ '1'
     C                     READ BKPHDQF                  88
      *                                                                   CAC005
      ** If CAC005 is installed, retrieve the corresponding user book     CAC005
      ** and profit centre.                                               CAC005
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     CALL 'AOBKPCR0'                                CAC005
     C                     PARM *BLANKS   PRTCD                           CAC005
     C                     PARM '*USER  ' POPTN                           CAC005
     C                     PARM           PBKCD                           CAC005
     C                     PARM           PPRFC                           CAC005
     C                     PARM BQBK      PPSBK                           CAC005
      *                                                                   CAC005
     C           PRTCD     IFEQ *BLANKS                                   CAC005
     C                     MOVE PBKCD     NBKCD                           CAC005
     C                     MOVE PPRFC     PRFC                            CAC005
     C                     ELSE                                           CAC005
     C                     MOVE *BLANKS   PRFC                            CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C                     MOVE BQEN      NBQEN                           CAC005
     C                     MOVE BQCT      NBQCT                           CAC005
     C                     MOVE NWKEY     WKKEY                           CAC005
     C                     ELSE                                           CAC005
     C                     MOVE BKKEY     WKKEY                           CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C           *IN88     IFEQ '1'
     C***********          MOVE *HIVAL    BKKEY                           CAC005
     C                     MOVE *HIVAL    WKKEY                           CAC005
     C                     END
     C                     ELSE
     C                     READ CPOSNQF                  87
     C           *IN87     IFEQ '1'
     C                     MOVE *HIVAL    CPKEY
     C                     END
     C                     END
     C                     END
     C                     SETOF                     838485
     C*
     C* SET INDICATOR TO SHOW EOF ON ALL INPUT FILES
     C*
     C           *IN89     IFEQ '1'
     C           *IN88     ANDEQ'1'
     C           *IN87     ANDEQ'1'
     C                     SETON                     82
     C                     END
     C*
     C                     END
     C*
     C* IF END OF FILE & AT LEAST 1 RECORD READ -
     C*     IF EXCEPT=Y CHECK WHETHER LIMITS HAVE BEEN EXCEEDED
     C*
     C           LTKEY     IFNE *BLANKS
     C                     MOVE *BLANKS   THKEY
     C           PEXCPT    IFEQ 'Y'
     C                     EXSR CHECK
     C*
     C*     IF EXCEPT=Y & LIMITS HAVE BEEN EXCEEDED - PRINT DETAILS
     C*
     C           *IN50     IFEQ '1'
     C                     EXSR PRINT
     C                     END
     C*
     C*     IF EXCEPT=N - PRINT DETAILS
     C*
     C                     ELSE
     C                     EXSR PRINT
     C                     END
     C                     END
     C           FILOPN    IFEQ 'Y'                                       E29170
     C           LCNT      IFGT MAXCNT
     C                     WRITEHEAD1
     C                     WRITEHEAD2
     C                     Z-ADD0         LCNT
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     ADD  1         LCNT                            CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C                     END
     C                     WRITETRAIL
     C           *INU7     IFEQ '1'                                       E29170
     C                     OPEN SE1020AU                                  E29170
     C                     WRITEHEADAU                                    E29170
     C                     WRITEERROR                                     E29170
     C*                                                                   E29170
     C** RCF PROCESSING FOR AUDIT PRINTER FILE                            E29170
     C*                                                                   E29170
     C                     EXSR RCFAU                                     E29170
     C                     END                                            E29170
     C*                                                                   E29170
     C                     ELSE                                           E29170
     C                     OPEN SE1020AU                                  E29170
     C                     WRITEHEADAU                                    E29170
     C                     WRITENODETL                                    E29170
     C*                                                                   E29170
     C** RCF PROCESSING FOR AUDIT PRINTER FILE                            E29170
     C*                                                                   E29170
     C                     EXSR RCFAU                                     E29170
     C                     END                                            E29170
     C*
     C           ENDPGM    TAG
     C*
     C                     SETON                     LR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  FIRST  - Subroutine to access ICD Information, etc.          *
      *                                                               *
      *****************************************************************
      *
     C           FIRST     BEGSR                           ** FIRST **
      *                                                                   CAC005
      ** Access Switchable feature files for CAC005                       CAC005
      *                                                                   CAC005
     C                     CALL 'AOSARDR0'                                CAC005
     C                     PARM *BLANKS   PRTCD   7                       CAC005
     C                     PARM '*VERIFY' POPTN   7                       CAC005
     C                     PARM 'CAC005'  PSARD   6                       CAC005
      *                                                                   CAC005
     C           PRTCD     IFEQ *BLANKS                                   CAC005
     C                     MOVE 'Y'       CAC005  1                       CAC005
     C                     MOVE '1'       *IN01                           CAC005
     C                     ELSE                                           CAC005
     C                     MOVE 'N'       CAC005                          CAC005
     C                     MOVE '0'       *IN01                           CAC005
     C                     ENDIF                                          CAC005
      *                                                                                       CSE035
      ** Access SAR details file to see if CSE035 is installed                                CSE035
      *                                                                                       CSE035
     C                     CALL 'AOSARDR0'                                                    CSE035
     C                     PARM *BLANKS   @RTCD   7                                           CSE035
     C                     PARM '*VERIFY' @OPTN   7                                           CSE035
     C                     PARM 'CSE035'  @SARD   6                                           CSE035
      *                                                                                       CSE035
     C           @RTCD     IFEQ *BLANK                                                        CSE035
     C                     MOVE 'Y'       CSE035  1                                           CSE035
     C                     ELSE                                                               CSE035
     C                     MOVE 'N'       CSE035                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       207543
      ** Access SAR details file to see if CEU018 is installed                                207543
      *                                                                                       207543
     C                     CALL 'AOSARDR0'                                                    207543
     C                     PARM *BLANKS   @RTCD                                               207543
     C                     PARM '*VERIFY' @OPTN                                               207543
     C                     PARM 'CEU018'  @SARD                                               207543
      *                                                                                       207543
     C           @RTCD     IFEQ *BLANK                                                        207543
     C                     MOVE 'Y'       CEU018  1                                           207543
     C                     ELSE                                                               207543
     C                     MOVE 'N'       CEU018                                              207543
     C                     ENDIF                                                              207543
     C*
     C                     CALL 'AOSARDR0'                                CSE081
     C                     PARM *BLANKS   PRTCD                           CSE081
     C                     PARM '*VERIFY' POPTN                           CSE081
     C                     PARM 'CSE081'  PSARD                           CSE081
      *                                                                   CSE081
     C           PRTCD     IFEQ *BLANKS                                   CSE081
     C                     MOVE 'Y'       CSE081  1                       CSE081
     C                     ELSE                                           CSE081
     C                     MOVE 'N'       CSE081                          CSE081
     C                     ENDIF                                          CSE081
     C* ACCESS ICD
     C*
     C                     EXSR ZSYSTM
     C           *IN99     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE 'TABLE'   DBFILE           *****************
     C                     MOVELZTABKY    DBKEY            ** DB ERROR 01 **
     C                     Z-ADD1         DBASE            *****************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     ELSE
     C*
     C* ACCESS ICD2
     C*
     C                     EXSR ZICD2
     C           *INU7     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE           *****************
     C                     MOVELZTABKY    DBKEY            ** DB ERROR 02 **
     C                     Z-ADD2         DBASE            *****************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     ELSE
     C*
     C* ACCESS ICDSE
     C*
     C                     EXSR ZICDSE
     C           *INU7     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE           *****************
     C                     MOVELZTABKY    DBKEY            ** DB ERROR 03 **
     C                     Z-ADD3         DBASE            *****************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     ELSE
     C*
     C* DETERMINE WHETHER THIS IS AN EXCEPTION ONLY REPORT OR FULL REPORT
     C*
     C           PEXCPT    COMP 'Y'                      60
     C*
     C* DETERMINE WHETHER FACTORED TO BE PRINTED                       RT
     C*
     C           PFACT     COMP 'F'                      64
     C*
     C* DETERMINE WHETHER COMPANY OR BRANCH DESCRIPTIONS REQUIRED      RT
     C*
     C           PLEVEL    COMP 'C'                      61
     C           PLEVEL    COMP 'B'                      62
     C*
     C* DETERMINE CATEGORY REQ'D - SET UP LEGENDS & OPEN FILES
     C*
     C                     MOVE PCAT      Z       10
     C                     MOVE C1A,Z     CATT1
     C                     MOVE C2A,Z     CATT2
     C           PCAT      IFEQ '1'
     C           PCAT      OREQ '2'
     C                     OPEN CLINT
     C                     MOVE 'A'       CRECID  1
     C                     END
     C*
     C* SET UP HOLD LEGEND - SET INDICATORS TO SHOW IF FILES NOT REQ'D
     C*
     C           PHOLD     IFEQ 'O'
     C                     MOVE HLA,1     HOLDT
     C                     SETON                     87    CPOSNQF N/R
     C                     ELSE
     C           PHOLD     IFEQ 'D'
     C                     MOVE HLA,2     HOLDT
     C                     SETON                     88    BKPHDQF N/R
     C                     ELSE
     C           PHOLD     IFEQ 'S'
     C                     MOVE HLA,3     HOLDT
     C                     SETON                     88    BKPHDQF N/R
     C                     ELSE
     C                     MOVE HLA,4     HOLDT
     C                     END
     C                     END
     C                     END
     C*
     C* OPEN OPTIONAL QUERY FILES AS REQUIRED
     C*
     C           *IN87     IFEQ '0'
     C                     OPEN CPOSNQF
     C                     END
     C           *IN88     IFEQ '0'
     C                     OPEN BKPHDQF
     C                     END
     C*
     C*  OPEN NECESSARY LIMITS FILES EVEN IF NOT BY BOOK.                 123783
     C*                                                                   123783
     C                     OPEN SLIMEL                                    123783
     C                     OPEN SLIMFL                                    123783
     C                     OPEN SLIMGL                                    123783
     C                     OPEN SLIMHL                                    123783
     C                     OPEN SLIMIL                                    123783
     C*
     C* READ THROUGH ALL BOOK DETAIL RECORDS STORING CODES AND DETAILS IN
     C*   ARRAYS IF REPORT IS BYBOOK  & OPEN NECESSARY FILES
     C*
     C           *INU1     IFEQ '1'
     C*
     C                     SETON                     63
     C                     OPEN BOOKD
     C*********            OPEN SLIMEL                                    123783
     C*********            OPEN SLIMFL                                    123783
     C*********            OPEN SLIMGL                                    123783
     C*********            OPEN SLIMHL                                    123783
     C*********            OPEN SLIMIL                                    123783
     C*
     C***********          Z-ADD0         S       20                      E21582
     C                     Z-ADD0         S       30                      E21582
     C           *IN86     DOUEQ'1'
     C                     READ BOOKD                    86
     C           *IN86     IFEQ '0'
     C                     ADD  1         S
     C                     MOVE BOKC      BOK,S
     C                     MOVE BOKD      BDSC,S
     C                     Z-ADDSTEP      BSTP,S
     C                     END
     C                     END
     C*
     C                     END
     C                     END
     C*
     C                     END
     C                     END
     C*
     C* RETRIEVE BASE CURRENCY EXCHANGE RATE
     C*
     C                     Z-ADD1         A       30
     C           BCYL      LOKUPCCYA,A                   20
     C           *IN20     IFEQ '1'
     C                     MOVE CCYDT,A   CCYDEB
     C                     ELSE
     C           *LOCK     IN   LDA                                       S01117
     C                     SETON                     U7U8
     C                     MOVE 'TABLE'   DBFILE           *****************
     C                     MOVELBCYL      DBKEY            ** DB ERROR 14 **
     C                     Z-ADD14        DBASE            *****************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO ENDPGM
     C                     END
     C/COPY WNCPYSRC,SE1020C001
     C*
     C*     SET UP LIKE FIELDS
     C*
     C           *LIKE     DEFN BOKC      NOBOOK
     C           *LIKE     DEFN STEP      WKSTP
     C                     Z-ADD40        MAXCNT  20
     C                     Z-ADD0         LCNT    20
     C                     Z-ADD0         WKLL   123
     C                     Z-ADD0         WKSL   123
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  CAT    - Subroutine to obtain Category and Level Description.*
      *                                                               *
      *****************************************************************
      *
     C           CAT       BEGSR                           ** CAT  **
     C*
     C                     MOVE *BLANKS   WDATE                           E18218
     C                     MOVE *BLANKS   WCPNR                           E18218
     C                     MOVE *BLANKS   CATD                            E20988
     C*
     C* IF LEVEL PARM IS C AND CHANGE IN ENTITY ENCOUNTERED
     C*  -  OBTAIN COMPANY NAME FROM TABLET3
     C*
     C           PLEVEL    IFEQ 'C'
     C           LENT      ANDNETENT
     C                     MOVELTENT      HDCO
     C           TENT      IFNE *BLANK
     C                     MOVE *BLANKS   TKEY
     C***********          MOVELTENT      WK2     2                       E29170
     C                     MOVEL'11'      TKEY
     C***********          MOVE WK2       TKEY                            E29170
     C                     MOVE TENT      TKEY                            E29170
     C           TABKEY    CHAINTABLET3F             80
     C           *IN80     IFEQ '1'
     C           RECI      ORNE 'D'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE           *****************
     C                     MOVELTKEY      DBKEY            ** DB ERROR 04 **
     C                     Z-ADD04        DBASE            *****************
     C                     SETON                     U7U8
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO ENDPGM
     C                     END
     C                     MOVE CMNM      HDCMNM
     C                     ELSE
     C                     MOVE 'NONE'    HDCMNM
     C                     END
     C                     END
     C*
     C* IF LEVEL PARM IS B, AND THERE IS A CHANGE IN ENTITY
     C*  -  OBTAIN BRANCH NAME FROM TABLETR
     C*
     C           PLEVEL    IFEQ 'B'
     C           TENT      ANDNELENT
     C                     MOVELTENT      HDBR
     C                     MOVE *BLANKS   TKEY
     C                     MOVEL'10'      TKEY
     C                     MOVE TENT      TKEY
     C           TABKEY    CHAINTABLETRF             80
     C           *IN80     IFEQ '1'
     C           RECI      ORNE 'D'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE           ***************
     C                     MOVELTKEY      DBKEY            * DB ERROR 05 *
     C                     Z-ADD5         DBASE            ***************
     C                     SETON                     U7U8
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO ENDPGM
     C                     END
     C                     MOVE BRNM      HDBRNM
     C                     END
     C*
     C* IF BY BOOK PARM IS Y AND THERE IS A CHANGE IN BOOK CODE
     C*  -  OBTAIN BOOK NAME FROM ARRAY
     C*
     C           *INU1     IFEQ '1'
     C           TBOK      ANDNELBOK
     C                     MOVELTBOK      HDBK
     C                     Z-ADD1         A
     C           TBOK      LOKUPBOK,A                    20
     C           *IN20     IFEQ '0'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'BOOKD'   DBFILE           *****************
     C                     MOVELTBOK      DBKEY            ** DB ERROR 06 **
     C                     Z-ADD06        DBASE            *****************
     C                     SETON                     U7U8
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO ENDPGM
     C                     END
     C                     MOVE BDSC,A    HDBDSC
     C                     Z-ADDBSTP,A    WKSTP
     C                     END
     C*
     C* IF CATEGORY 1 OR 2 -
     C*  -  OBTAIN CUSTOMER REPORT NAME & TOWN FROM CLINT
     C*
     C           PCAT      IFEQ '1'
     C           PCAT      OREQ '2'
     C**********           MOVE CAT6      CAT6P   60                                          CSD027
     C                     MOVE CAT6      CAT6P   6                                           CSD027
     C           CLKEY     CHAINCLINT                80
     C           *IN80     IFEQ '1'
     C           RECI      ORNE 'D'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'CLINT'   DBFILE           ***************
     C                     MOVELCAT6      DBKEY            * DB ERROR 07 *
     C                     Z-ADD7         DBASE            ***************
     C                     SETON                     U7U8
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO ENDPGM
     C                     END
     C                     MOVE CRNM      CATD1
     C                     MOVE CTWN      CATD2
     C                     END
     C*
     C* IF CATEGORY 3 -
     C*  -  OBTAIN CURRENCY NAME FROM TABTG30 ARRAY
     C*
     C           PCAT      IFEQ '3'
     C                     Z-ADD1         A
     C           CAT3      LOKUPCCYA,A                   20
     C           *IN20     IFEQ '0'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'TABLE'   DBFILE           *****************
     C                     MOVELCAT3      DBKEY            ** DB ERROR 11 **
     C                     Z-ADD11        DBASE            *****************
     C                     SETON                     U7U8
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO ENDPGM
     C                     END
     C                     MOVE CCYDT,A   TMPNAM 20
     C                     MOVELTMPNAM    TMPNM2 14
     C                     MOVE *BLANKS   CATD
     C                     MOVELTMPNM2    CATD
     C                     END
     C*
     C* IF CATEGORY 4 OR 5 -
     C*  -  OBTAIN COUNTRY NAME FROM TABLETH
     C*
     C           PCAT      IFEQ '4'
     C           PCAT      OREQ '5'
     C                     MOVE *BLANKS   TKEY
     C                     MOVEL'50'      TKEY
     C                     MOVE CAT2      TKEY
     C           TABKEY    CHAINTABLETHF             80
     C           *IN80     IFEQ '1'
     C           RECI      ORNE 'D'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE           ***************
     C                     MOVELTKEY      DBKEY            * DB ERROR 10 *
     C                     Z-ADD10        DBASE            ***************
     C                     SETON                     U7U8
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO ENDPGM
     C                     END
     C                     MOVELCNM       CATD
     C                     END
     C*
     C* IF CATEGORY 6 -
     C*  -  INSERT INVESTMENT CODE
     C*     (output the INVT used so that if the chain to INVTPC fails    E20988
     C*      then at least some details of the investment type are shown) E20988
     C*
     C           PCAT      IFEQ '6'
     C*                                                                   S01176
     C                     MOVELCAT3      CATD                            E20988
     C                     MOVELCAT3      INVT                            E20988
     C                     MOVE *BLANKS   CCYI                            S01176
     C           INKEY     CHAININVTPC               81                   S01176
     C           *IN81     IFEQ '0'                                       S01176
     C           INAM      IFNE *BLANK                                    S01176
     C                     MOVE INAM      CATD                            S01176
     C***********          ELSE                                    S01176 E20988
     C***********          MOVELCAT3      CATD                            E20988
     C                     END
     C                     END                                            S01176
     C                     END                                            S01176
     C*
     C* IF CATEGORY 7 -
     C*  -  OBTAIN SECURITY NAME FROM SECTY
     C*
     C           PCAT      IFEQ '7'
     C           TCAT      CHAINSECTY                80
     C           *IN80     IFEQ '1'
     C***********RECI      ORNE 'D'                                       S01158
     C           RECI      OREQ 'C'                                       S01158
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'SECTY'   DBFILE           ***************
     C                     MOVELTCAT      DBKEY            * DB ERROR 09 *
     C                     Z-ADD9         DBASE            ***************
     C                     SETON                     U7U8
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO ENDPGM
     C                     END
     C*                                                                   S01232
     C*   Indicate if an Australian Yield Traded security                 S01232
     C*                                                                   S01232
     C                     MOVELSRPN      CATD
     C*                                                                   E18218
     C                     SETON                         66               E18218
     C                     Z-ADDMATY      ZDAYNO                          E18218
     C                     EXSR ZDATE2                                    E18218
     C                     MOVE ZADATE    WDATE                           E18218
     C*                                                                   E18218
     C                     MOVEL*BLANK    ZFLD15                          E18218
     C                     MOVE CPNR      ZFLD15                          E18218
     C                     MOVEL'L'       ZECODE                          E18218
     C                     Z-ADD7         ZDECS                           E18218
     C                     EXSR ZSEDIT                                    E18218
     C                     MOVE ZOUT21    WCPNR                           E18218
     C*                                                                   E18218
     C                     END
     C*
     C* SETON INDICATOR TO SHOW CATEGORY DESC TO BE PRINTED
     C*
     C                     SETON                     65
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  LIMIT  - Subroutine to calculate Limits.                     *
      *                                                               *
      *****************************************************************
      *
     C           LIMIT     BEGSR                           ** LIMIT**
     C*
     C* IF NOT BY BOOK
     C* OR IF NO RECORD FOUND WITH LIMIT EXPIRY DATE > RUN DATE -
     C*       -  SET LONG & SHORT LIMITS TO ZERO & LIMIT TYPE TO BLANK
     C*
     C                     Z-ADD0         WKLL
     C                     Z-ADD0         WKSL
     C                     MOVE *BLANKS   SLMT
     C*
     C* Set the Limits fields to zero or blank.                           123783
     C*                                                                   123783
     C                     Z-ADD0         EXDE                            123783
     C                     Z-ADD0         LLME                            123783
     C                     Z-ADD0         SLME                            123783
     C                     MOVE *BLANKS   LMTE                            123783
     C*
     C* IF BY BOOK (U1 ON) -
     C*
     C           *INU1     IFEQ '1'
     C*
     C*  -  USE THE BOOK TO CHECK FOR LIMITS                              E20988
     C*
     C                     MOVE TBOK      NOBOOK                          E20988
     C                     END                                            123783
     C*
     C*  -  CHECK FOR A 'NON-BOOK' LIMIT -
     C*       ACCESS RECORD FROM CORRECT SLIM FILE
     C*
     C           PCAT      IFEQ '1'
     C           PCAT      OREQ '2'
     C                     MOVE CAT6      CAT6P
     C           SHKEY     CHAINSLIMHL               80
     C           *IN80     IFEQ '0'                                       123783
     C                     Z-ADDEXDH      EXDE
     C                     Z-ADDLLMH      LLME
     C                     Z-ADDSLMH      SLME
     C                     MOVE LMTH      LMTE
     C                     END                                            123783
     C                     END
     C           PCAT      IFEQ '3'
     C           SFKEY     CHAINSLIMFL               80
     C           *IN80     IFEQ '0'                                       123783
     C                     Z-ADDEXDF      EXDE
     C                     Z-ADDLLMF      LLME
     C                     Z-ADDSLMF      SLME
     C                     MOVE LMTF      LMTE
     C                     END                                            123783
     C                     END
     C           PCAT      IFEQ '4'
     C           PCAT      OREQ '5'
     C           SEKEY     CHAINSLIMEL               80
     C                     END
     C           PCAT      IFEQ '6'
     C           SGKEY     CHAINSLIMGL               80
     C           *IN80     IFEQ '0'                                       123783
     C                     Z-ADDEXDG      EXDE
     C                     Z-ADDLLMG      LLME
     C                     Z-ADDSLMG      SLME
     C                     MOVE LMTG      LMTE
     C                     END                                            123783
     C                     END
     C           PCAT      IFEQ '7'
     C           SIKEY     CHAINSLIMIL               80
     C           *IN80     IFEQ '0'                                       123783
     C                     Z-ADDEXDI      EXDE
     C                     Z-ADDLLMI      LLME
     C                     Z-ADDSLMI      SLME
     C                     MOVE *BLANKS   LMTE
     C                     END                                            123783
     C                     END
     C*
     C* IF RECORD FOUND WITH LIMIT EXPIRY DATE > RUN DATE - AND IF NOT    123783
     C* BY BOOK MOVE LONG & SHORT LIMITS INTO WKSL AND WKLL               123783
     C*                                                                   123783
     C           *INU1     IFEQ '0'                                       123783
     C           *IN80     IFEQ '0'                                       123783
     C           RECI      ANDEQ'D'                                       123783
     C           EXDE      ANDGTRUND                                      123783
     C                     Z-ADDLLME      WKLL                            123783
     C                     Z-ADDSLME      WKSL                            123783
     C                     END                                            123783
     C                     ELSE                                           123783
     C* IF RECORD FOUND WITH LIMIT EXPIRY DATE > RUN DATE - AND BY BOOK   123783
     C*         MULTIPLY LONG & SHORT LIMITS BY THE EXPOSURE % FOR BOOK
     C*
     C           *IN80     IFEQ '0'
     C           RECI      ANDEQ'D'
     C           EXDE      IFGT RUND
     C                     MOVE LMTE      SLMT
     C           LLME      MULT WKSTP     WKLL
     C           WKLL      DIV  100       WKLL      H
     C           SLME      MULT WKSTP     WKSL
     C           WKSL      DIV  100       WKSL      H
     C                     END
     C                     END
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  PERID  - Subroutine to calculate Limit Periods and Amounts.  *
      *                                                               *
      *****************************************************************
      *
     C***********PERIOD    BEGSR                           ** PERIOD*     E16231
     C           PERID     BEGSR                           ** PERID *     E16231
     C*
     C* IF LIMITS RECORD -
     C*   IF LIMIT EXPIRY DATE < RUN DATE - SET LIMIT AMOUNTS TO ZERO
     C*
     C           *INU1     IFEQ '1'                                       123783
     C           *IN85     IFEQ '1'
     C           SQEX      IFLE RUND
     C                     Z-ADD0         WKLL
     C                     Z-ADD0         WKSL
     C                     MOVE *BLANKS   SLMT
     C                     ELSE
     C                     Z-ADDSQLL      WKLL
     C                     Z-ADDSQSL      WKSL
     C                     MOVE SQLT      SLMT
     C                     END
     C                     END
     C                     END                                            123783
     C*
     C* IF HOLD=D MULTIPLY LIMITS BY DISC.LIMIT FACTOR / 100
     C*
     C           PHOLD     IFEQ 'D'
     C           WKLL      MULT DSLF      WORK   153
     C           WORK      DIV  100       WKLL      H
     C           WKSL      MULT DSLF      WORK   153
     C           WORK      DIV  100       WKSL      H
     C                     END
     C*
     C* IF HOLD=S MULTIPLY LIMITS BY CUST.LIMIT FACTOR / 100
     C*
     C           PHOLD     IFEQ 'S'
     C           WKLL      MULT CSLF      WORK   153
     C           WORK      DIV  100       WKLL      H
     C           WKSL      MULT CSLF      WORK   153
     C           WORK      DIV  100       WKSL      H
     C                     END
     C*
     C* IF HOLD=A MULTIPLY LIMITS BY ALL HOLDINGS LIMIT FACTOR / 100
     C*
     C           PHOLD     IFEQ 'A'
     C           WKLL      MULT AHLF      WORK   153
     C           WORK      DIV  100       WKLL      H
     C           WKSL      MULT AHLF      WORK   153
     C           WORK      DIV  100       WKSL      H
     C                     END
     C*
     C* SET ALL PERIOD DATES & LIMIT AMOUNTS TO 0
     C*
     C                     MOVE *BLANKS   WPB
     C                     MOVE *BLANKS   WPE
     C                     Z-ADD0         WP5
     C                     Z-ADD0         WLL
     C                     Z-ADD0         WSL
     C*
     C* IF LIMIT TYPE BLANK - ONLY SET PERIOD 1 DETAILS
     C*
     C           SLMT      IFEQ *BLANKS
     C                     Z-ADD99999     WP5,1
     C                     Z-ADDWKLL      WLL,1
     C                     Z-ADDWKSL      WSL,1
     C                     Z-ADD2         S
     C*
     C* IF LIMIT TYPE NOT BLANK -
     C*    ACCESS LIMIT TYPE DETAILS
     C*
     C                     ELSE
     C           SLMT      CHAINLMTPD                80
     C           *IN80     IFEQ '1'
     C           RECI      ORNE 'D'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'LMTPD'   DBFILE           ***************
     C                     MOVELSLMT      DBKEY            * DB ERROR 12 *
     C                     Z-ADD12        DBASE            ***************
     C                     SETON                     U7U8
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO ENDPGM
     C                     END
     C*
     C* IF RECORD FOUND -
     C*    FOR EACH NON-BLANK PERIOD END -
     C*
     C                     Z-ADD0         SAVL12  20                      E18218
     C                     Z-ADD0         RES12   20                      E18218
     C                     DO   6         S
     C           LEP,S     CABEQ*BLANKS   PEREND
     C*
     C*       CALCULATE END DATE
     C*
     C                     EXSR DATE
     C*
     C*       CALCULATE SHORT & LONG LIMITS
     C*
     C           WKLL      MULT LPC,S     WORK
     C           WORK      DIV  100       WLL,S     H
     C           WKSL      MULT LPC,S     WORK
     C           WORK      DIV  100       WSL,S     H
     C                     END
     C                     END
     C*
     C           PEREND    TAG                             ** PEREND **
     C*
     C* IF NO ARRAY SET UP FOR DATE 99999 - DO THIS NOW
     C*
     C                     SUB  1         S
     C           S         IFEQ 0
     C           WP5,S     ORNE 99999
     C                     ADD  1         S
     C                     Z-ADD99999     WP5,S
     C                     Z-ADD0         WLL,S
     C                     Z-ADD0         WSL,S
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  DATE   - Subroutine to calculate Limit Period End Date.      *
      *                                                               *
      *****************************************************************
      *
     C           DATE      BEGSR                           ** DATE **
     C*
     C                     MOVE LEP,S     LEPWK
     C                     Z-ADDRUND      DWK5    50
     C*
     C* IF BYTE 3 OF PERIOD END IS NOT M OR Y -
     C*    ADD NO. IN BYTES 1-3 OF PERIOD END TO RUN DATE
     C*
     C           LEPW3     IFNE 'M'
     C           LEPW3     ANDNE'Y'
     C*
     C*    IF BYTES 1,2,3 ARE 999 - SET END DATE TO 99999
     C*
     C           LEPWK     IFEQ '999'
     C                     Z-ADD99999     ZDAYNO
     C                     ELSE
     C           DWK5      ADD  LEPWKN    ZDAYNO
     C                     END
     C*
     C* IF BYTE 3 OF PERIOD END IS M -
     C*
     C                     ELSE
     C           LEPW3     IFEQ 'M'
     C*
     C*    IF BYTES 1 & 2 ARE 99 - SET END DATE TO 99999
     C*
     C           LEPW12    IFEQ 99
     C                     Z-ADD99999     ZDAYNO
     C                     ELSE
     C*
     C*    CONVERT RUN DATE TO DDMMYY FORMAT
     C*
     C                     Z-ADDDWK5      ZDAYNO
     C                     EXSR ZDATE2
     C*
     C*    INCREMENT YY AND/OR MM ACCORDING TO NO. MONTHS IN BYTES 1 & 2
     C*
     C                     Z-ADDZDATE     DATWK
     C           *IN98     IFEQ '0'
     C                     ADD  LEPW12    DWK2
B1   C           CSE081    IFEQ 'N'                                              CSE081
     C           DWK2      IFGT 12
     C                     ADD  1         DWK3
     C                     SUB  12        DWK2
     C                     END
X1   C                     ELSE                                                  CSE081
     C           DWK2      DOWGT12                                               CSE081
     C                     ADD  1         DWK3                                   CSE081
     C                     SUB  12        DWK2                                   CSE081
E1   C                     ENDDO                                                 CSE081
E1   C                     ENDIF                                                 CSE081
      *
     C                     ELSE
     C                     ADD  LEPW12    DWK1
B1   C           CSE081    IFEQ 'N'                                              CSE081
     C           DWK1      IFGT 12
     C                     ADD  1         DWK3
     C                     SUB  12        DWK1
     C                     END
X1   C                     ELSE                                                  CSE081
     C           DWK2      DOWGT12                                               CSE081
     C                     ADD  1         DWK3                                   CSE081
     C                     SUB  12        DWK2                                   CSE081
E1   C                     ENDDO                                                 CSE081
E1   C                     ENDIF                                                 CSE081
     C                     END
     C*
     C*    CONVERT DATE TO DAY NO. FORMAT (SUBTRACT 1 FROM DD UNTIL VALID)
     C*
     C***********          Z-ADDDATWK     ZDATE                           E21100
     C           *IN99     DOUEQ'0'
     C                     Z-ADDDATWK     ZDATE                           E21100
     C                     EXSR ZDATE1
     C           *IN99     IFEQ '1'
     C           *IN98     IFEQ '0'
     C                     SUB  1         DWK1
     C                     ELSE
     C                     SUB  1         DWK2
     C                     END
     C                     END
     C                     END
     C                     END
     C*
     C* IF BYTE 3 OF PERIOD END IS Y -
     C*
     C                     ELSE
     C           LEPW3     IFEQ 'Y'
     C*
     C*    IF BYTES 1 & 2 ARE 99 - SET END DATE TO 99999
     C*
     C           LEPW12    IFEQ 99
     C                     Z-ADD99999     ZDAYNO
     C                     ELSE
     C*
     C*    CONVERT RUN DATE TO DDMMYY FORMAT
     C*
     C                     Z-ADDDWK5      ZDAYNO
     C                     EXSR ZDATE2
     C*
     C*****INCREMENT*YY*ACCORDING*TO*NO.*MONTHS*IN*BYTES*1*&*2*********                       208369
      ** Increment YY according to the number of years in bytes 1 & 2                         208369
     C*
     C                     Z-ADDZDATE     DATWK
     C********** SAVL12    IFEQ 0                                                      E18218 208369
     C**********           Z-ADDLEPW12    SAVL12                                       E18218 208369
     C**********           ADD  1         DWK3                                                208369
     C**********           ELSE                                                        E18218 208369
     C********** LEPW12    SUB  SAVL12    RES12                                        E18218 208369
     C**********           ADD  1         DWK3                                         E18218 208369
     C**********           ADD  RES12     DWK3                                         E18218 208369
     C**********           END                                                         E18218 208369
     C                     ADD  LEPW12    DWK3                                                208369
     C*
     C*    CONVERT DATE TO DAY NO. FORMAT (SUBTRACT 1 FROM DD UNTIL VALID)
     C*
     C                     Z-ADDDATWK     ZDATE
     C           *IN99     DOUEQ'0'
     C                     EXSR ZDATE1
     C           *IN99     IFEQ '1'
     C           *IN98     IFEQ '0'
     C                     SUB  1         DWK1
     C                     ELSE
     C                     SUB  1         DWK2
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C*
     C* FILL PERIOD END DATE WITH THAT CALCULATED
     C*
     C                     Z-ADDZDAYNO    WP5,S
     C                     MOVE LEP,S     WPB,S
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  EXP    - Subroutine to calculate Exposure.                   *
      *                                                               *
      *****************************************************************
      *
     C           EXP       BEGSR                           ** EXP  **
      *
      **  DETERMINE LEVEL OF ACCURACY DEPENDING ON NOM CURRENCY
      **  AND SET INDICATOR FOR LATER CALCS. CODE COPIED FROM SE0720
      *
     C* OBTAIN DECIMAL PLACES FOR CURRENCY INPUT  (NOMINAL)
     C*
     C           *IN84     IFEQ '1'
     C                     MOVE BQNC      NOMCUR  3
     C                     END
     C           *IN83     IFEQ '1'
     C                     MOVE CQNC      NOMCUR
     C                     END
     C                     Z-ADD1         A
     C           NOMCUR    LOKUPCCYA,A                   20
     C           *IN20     IFEQ '1'
     C                     MOVE CCYDT,A   CCYDEN
     C                     ELSE
     C                     SETON                     U7U8
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE           *****************
     C                     MOVELNOMCUR    DBKEY            ** DB ERROR 13 **
     C                     Z-ADD13        DBASE            *****************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO ENDPGM
     C                     END
      *
      **  CLEAR WORK FIELDS AND INDICATORS
      *
     C                     Z-ADD*ZEROS    WCONS0 150
     C                     Z-ADD*ZEROS    WCONS1 151
     C                     Z-ADD*ZEROS    WCONS2 152
     C                     Z-ADD*ZEROS    WCONS3 153
     C                     MOVEA'0000'    *IN,30
     C           30        ADD  XDECN     J       30
     C                     MOVEA'1'       *IN,J
     C*                                                                   E16231
     C*   FOR A YIELD BASED SECURITY CALCULATE THE EXPOSURE USING THE     E16231
     C*   MARKET PRICE (INPUT AS YIELD) CONVERTED TO A PRICE (IF THE      E16231
     C*   MARKET/BOOK EXPOSURE FIELD ON TABTB36 IS 'M').                  E16231
     C*                                                                   E16231
      *  For category type 6, no exposure is reported                     CSE081
      *                                                                   CSE081
     C           STBS      IFNE 'P'                                       E16231
     C           CSE081    ANDEQ'N'                                       CSE081
     C           STBS      OREQ 'Y'                                       CSE081
     C           CSE081    ANDEQ'Y'                                       CSE081
     C                     Z-ADDDNWD      ZZDNWD                          S01117
     C                     Z-ADDAPDA      ZZAPDT                          S01117
     C                     EXSR ZEVCD                                     E16231
     C                     MOVE ECD       ZFDATE                          E16231
     C                     MOVE BQMP      ZPRCIN                          E16231
     C*                                                                   S01332
     C*   Australian Yield Parameters                                     S01332
     C*                                                                   S01332
     C           *IN41     IFEQ '1'                                       S01232
     C           *IN83     IFEQ '1'                                       S01232
     C                     Z-ADDCQNP      ZAMT                            S01232
     C                     ELSE                                           S01232
     C                     Z-ADDBQNP      ZAMT                            S01232
     C                     END                                            S01232
     C                     Z-ADDLCPN      ZDCSDT                          S01232
     C                     Z-ADDECD       ZDCEDT                          S01232
     C                     Z-ADDCDP       ZCDP                            S01117
AB   C                     EXSR ZACCZ                                     S01232
AB   C           ZDCINT    DIV  ZAMT      WRKPI                           S01232
AB   C                     Z-ADDECD       WRKD    50                      S01232
AB   C                     EXSR ZYCE                                      S01232
     C*                                                                   S01232
     C*          IF EX-COUPON THEN PI PASSED IS THE REMAINING INTEREST    S01232
     C*          TILL NCD AND IS NEGATIVE                                 S01232
     C*                                                                   S01232
     C           SCUMEX    IFEQ 'X'                                       S01232
     C                     Z-ADDLCPN      ZDCSDT                          S01232
     C                     Z-ADDNCD       ZDCEDT                          S01232
     C                     Z-ADDCDP       ZCDP                            S01117
     C                     EXSR ZACCZ                                     S01232
     C           ZDCINT    DIV  ZAMT      WKWPI  159                      S01232
     C           WRKPI     SUB  WKWPI     WRKPI                           S01232
     C                     END                                            S01232
     C                     ELSE                                           S01232
     C                     Z-ADD0         WRKPI                           S01232
     C                     MOVE 'C'       SCUMEX                          S01232
     C                     END                                            S01232
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE1020CCP2                                           S01408
     C*                                                                   S01408
     C*                                                                   S01332
     C           *IN83     IFEQ '1'                                       E39495
     C                     Z-ADDCQNP      ZNOML                           E39495
     C                     ELSE                                           E39495
     C                     Z-ADDBQNP      ZNOML                           E39495
     C                     END                                            E39495
     C*                                                                   E39495
     C                     EXSR ZPRCI                                     E16231
      *                                                                                       CSE035
      ** ADJUST PRICE : PRICE + PUR INT BEFORE ROUNDING                                       CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
     C           NCD       IFGE MATY                                                          CSE035
     C           SYBS      ANDEQ'AU'                                                          CSE035
     C                     Z-ADDZPRCOT    ZPRCOT                                              CSE035
     C                     ELSE                                                               CSE035
     C           SYBS      IFNE 'AU'                                                          CSE035
     C           SYBS      ANDNE'DA'                                                          CSE035
     C           STBS      ANDEQ'Y'                                                           CSE035
     C           ZPRCOT    ADD  ZWAMT     ZPRCOT                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
     C           NCD       IFGE MATY                                                          CSE035
     C           SYBS      ANDEQ'AU'                                                          CSE035
     C                     ELSE                                                               CSE035
     C           SYBS      IFNE 'AU'                                                          CSE035
     C           SYBS      ANDNE'DA'                                                          CSE035
     C           STBS      ANDEQ'Y'                                                           CSE035
     C           ZPRCOT    SUB  PURINT    ZPRCOT                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE1020CCP3                                           S01408
     C*                                                                   S01408
     C                     MOVE ZPRCOT    BQMP                            E16231
     C                     END                                            E16231
      *
      **  ADJUST NOMINAL FOR NO. OF DPS. IS HELD IN 15.0 FIELD
      **  WHATEVER THE ACTUAL DPS. MOVE TO APPROPRIATE WORK
      **  FIELD.
     C*
     C* IF MARKET/BOOK EXP IS M OR RECORD FROM CPOSNQF -
     C*     EXPOSURE = NOMINAL X PRICE
     C*
     C           *IN83     IFEQ '1'
     C***30******CQMP      MULT CQMP      WCONS0                          E16231
     C***31******CQMP      MULT CQMP      WCONS1                          E16231
     C***32******CQMP      MULT CQMP      WCONS2                          E16231
     C***33******CQMP      MULT CQMP      WCONS3                          E16231
     C   30      CQNP      MULT CQMP      WCONS0                          E16231
     C   31      CQNP      MULT CQMP      WCONS1                          E16231
     C   32      CQNP      MULT CQMP      WCONS2                          E16231
     C   33      CQNP      MULT CQMP      WCONS3                          E16231
     C                     ELSE
     C           MBEX      IFEQ 'M'
     C   30      BQNP      MULT BQMP      WCONS0
     C   31      BQNP      MULT BQMP      WCONS1
     C   32      BQNP      MULT BQMP      WCONS2
     C   33      BQNP      MULT BQMP      WCONS3
     C*
     C* OTHERWISE EXPOSURE = NOMINAL X AVERAGE PRICE
     C*
     C                     ELSE
     C   30      BQNP      MULT BQAP      WCONS0
     C   31      BQNP      MULT BQAP      WCONS1
     C   32      BQNP      MULT BQAP      WCONS2
     C   33      BQNP      MULT BQAP      WCONS3
     C                     END
     C                     END
     C*
     C* IF % PRICE SECURITY EXPOSURE IS DIVIDED BY 100
     C*
     C           *IN84     IFEQ '1'
     C           BQPB      ANDEQ'P'
     C           *IN83     OREQ '1'
     C           CQPB      ANDEQ'P'
     C   30                DIV  100       WCONS0    H
     C   31                DIV  100       WCONS1    H
     C   32                DIV  100       WCONS2    H
     C   33                DIV  100       WCONS3    H
     C                     END
     C*
     C* IF MORTGAGE BACKED SECURITY - EXPOSURE = EXPOSURE X CURRENT FACTOR
     C*
     C           *IN84     IFEQ '1'
     C           BQPT      ANDEQ'8'
     C   30                MULT BQCF      WCONS0
     C   31                MULT BQCF      WCONS1
     C   32                MULT BQCF      WCONS2
     C   33                MULT BQCF      WCONS3
     C                     END
     C           *IN83     IFEQ '1'
     C           CQPT      ANDEQ'8'
     C   30                MULT CQCF      WCONS0
     C   31                MULT CQCF      WCONS1
     C   32                MULT CQCF      WCONS2
     C   33                MULT CQCF      WCONS3
     C                     END
     C*
     C**IF*PARTLY*PAID*SECURITY*-*EXP=*EXP*X*CUR*PP*PRICE*/*FULLY*PAID*PRIE14607
     C************IN84     IFEQ '1'                                       E14607
     C***********BQPI      ANDEQ'Y'                                       E14607
     C***30******          MULT BQPP      WCONS0                          E14607
     C***31******          MULT BQPP      WCONS1                          E14607
     C***32******          MULT BQPP      WCONS2                          E14607
     C***33******          MULT BQPP      WCONS3                          E14607
     C***********BQFP      IFNE 0                                         E14607
     C***30******          DIV  BQFP      WCONS0    H                     E14607
     C***31******          DIV  BQFP      WCONS1    H                     E14607
     C***32******          DIV  BQFP      WCONS2    H                     E14607
     C***33******          DIV  BQFP      WCONS3    H                     E14607
     C***********          ELSE                                           E14607
     C***30******          Z-ADD0         WCONS0                          E14607
     C***31******          Z-ADD0         WCONS1                          E14607
     C***32******          Z-ADD0         WCONS2                          E14607
     C***33******          Z-ADD0         WCONS3                          E14607
     C***********          END                                            E14607
     C***********          END                                            E14607
     C************IN83     IFEQ '1'                                       E14607
     C***********CQPI      ANDEQ'Y'                                       E14607
     C***30******          MULT CQPP      WCONS0                          E14607
     C***31******          MULT CQPP      WCONS1                          E14607
     C***32******          MULT CQPP      WCONS2                          E14607
     C***33******          MULT CQPP      WCONS3                          E14607
     C***********CQFP      IFNE 0                                         E14607
     C***30******          DIV  CQFP      WCONS0    H                     E14607
     C***31******          DIV  CQFP      WCONS1    H                     E14607
     C***32******          DIV  CQFP      WCONS2    H                     E14607
     C***33******          DIV  CQFP      WCONS3    H                     E14607
     C***********          ELSE                                           E14607
     C***30******          Z-ADD0         WCONS0                          E14607
     C***31******          Z-ADD0         WCONS1                          E14607
     C***32******          Z-ADD0         WCONS2                          E14607
     C***33******          Z-ADD0         WCONS3                          E14607
     C***********          END                                            E14607
     C***********          END                                            E14607
     C*
     C* IF FACTORED = F - EXP. = EXP X EXP % / 100
     C*
     C           PFACT     IFEQ 'F'
     C           *IN84     IFEQ '1'
     C   30                MULT BQEP      WCONS0
     C   31                MULT BQEP      WCONS1
     C   32                MULT BQEP      WCONS2
     C   33                MULT BQEP      WCONS3
     C                     END
     C           *IN83     IFEQ '1'
     C   30                MULT CQEP      WCONS0
     C   31                MULT CQEP      WCONS1
     C   32                MULT CQEP      WCONS2
     C   33                MULT CQEP      WCONS3
     C                     END
     C   30                DIV  100       WCONS0    H
     C   31                DIV  100       WCONS1    H
     C   32                DIV  100       WCONS2    H
     C   33                DIV  100       WCONS3    H
     C                     END
     C*
     C* CONVERT EXPOSURE FROM NOMINAL TO BASE CURRENCY
     C*
     C                     EXSR PCONV
     C*
     C* FIND SMALLEST LIMIT PERIOD END DATE >= SECURITY MATURITY DATE
     C*
     C           *IN84     IFEQ '1'
     C                     Z-ADDBQMD      MATYDA  50
     C                     END
     C           *IN83     IFEQ '1'
     C                     Z-ADDCQMD      MATYDA
     C                     END
     C           MATYDA    IFEQ 0
     C                     Z-ADD99999     MATYDA
     C                     END
     C                     DO   7         S
     C           WP5,S     IFGE MATYDA
     C                     GOTO OUT
     C                     END
     C                     END
     C                     Z-ADD7         S
     C           OUT       TAG                             ** OUT  **
     C*
     C* IF EXP IS +VE - ADD TO LONG EXP AMOUNT FOR THE PERIOD
     C*
     C           WCONS0    IFGT 0
     C                     ADD  WCONS0    WLE,S
     C*
     C* IF EXP IS -VE - SUBTRACT FROM SHORT EXP AMOUNT FOR THE PERIOD
     C*
     C                     ELSE
     C                     SUB  WCONS0    WSE,S
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  CHECK  - Subroutine to check for excess.                     *
      *                                                               *
      *****************************************************************
      *
     C           CHECK     BEGSR                           ** CHECK**
     C*
     C* ASSUME NO EXCESS
     C*
     C                     SETOF                     50
     C*
     C* FOR EACH LIMIT PERIOD WITH NON-ZERO END DATE -
     C*
     C                     DO   7         S
     C           WP5,S     CABEQ0         CHKEND
     C*
     C*     IF LONG EXP > LONG LIMIT  OR SHORT EXP > SHORT LIMIT - EXCESS
     C*
     C           WLE,S     IFGT WLL,S
     C           WSE,S     ORGT WSL,S
     C                     SETON                     50
     C                     GOTO CHKEND
     C                     END
     C                     END
     C*
     C           CHKEND    ENDSR                           ** CHKEND  **
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  PCONV  - Subroutine to convert an Amount fron one Currency to*
      *           another.                                            *
      *                                                               *
      *  Input  : WCONS0,1,2 or 3                                     *
      *  Output : WCONS0                                              *
      *                                                               *
      *****************************************************************
      *
     C           PCONV     BEGSR                           ** PCONV **
     C*
     C* IF EXCHANGE RATE IS 0 - OUTPUT CURRENCY AMOUNT AS ZERO
     C*
     C           XERLN     IFEQ 0
     C                     Z-ADD0         WCONS0
     C                     GOTO EPCONV
     C                     END
     C*
     C***  CALCULATE OUTPUT CURRENCY AMOUNT BY DIVIDING EXCHANGE RATE INTO
     C*** OR MULTIPLYING EXCHANGE RATE BY CURRENCY AMOUNT INPUT DEPENDING
     C*** ON INDICATOR. RESULT TO 15.0 FIELD WCONS0.
     C*
     C           XMDIN     IFEQ 0
     C   30                DIV  XERLN     WCONS0    H
     C   31      WCONS1    DIV  XERLN     WCONS0    H
     C   32      WCONS2    DIV  XERLN     WCONS0    H
     C   33      WCONS3    DIV  XERLN     WCONS0    H
     C                     ELSE
     C   30                MULT XERLN     WCONS0    H
     C   31      WCONS1    MULT XERLN     WCONS0    H
     C   32      WCONS2    MULT XERLN     WCONS0    H
     C   33      WCONS3    MULT XERLN     WCONS0    H
     C                     END
      *
      **  ADJUST FOR NOMINAL DECIMAL PLACES
      *
     C           *IN83     IFEQ '1'
     C           5         SUB  CQND      PX      10
     C                     ELSE
     C           5         SUB  BQND      PX      10
     C                     END
      *
     C                     MULT POWER8,PX WCONS0
      *
     C           EPCONV    ENDSR                           ** EPCONV **
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  PRINT  - Subroutine to Print Detail Report.                  *
      *                                                               *
      *****************************************************************
      *
     C           PRINT     BEGSR                           ** PRINT**
     C*
     C*   CHECK FOR CHANGE IN MAIN KEY FIELDS
     C*
     C           PENT      IFNE LENT
     C***********PENT      ANDNE*BLANKS                                   E29170
     C***********PLEVEL    ANDEQ'B'                                       E29170
     C           PLEVEL    OREQ 'S'                                       E33035
     C           FILOPN    IFEQ 'Y'                                       E29170
     C           PLEVEL    ANDNE'S'                                       E33035
     C                     WRITETRAIL
     C                     CLOSESE1020P1
     C                     END                                            E29170
     C           PLEVEL    IFNE 'S'                                       E33035
     C           PLEVEL    OREQ 'S'                                       E33035
     C           FILOPN    ANDNE'Y'                                       E33035
     C                     OPEN SE1020P1
     C                     Z-ADD0         LCNT
     C                     Z-ADD0         PAGE
     C***********          MOVEL'Y'       FILOPN  1                 E29170E35470
     C*                                                                   E29170
     C** RCF PROCESSING FOR DETAIL PRINTER FILE                           E29170
     C*                                                                   E29170
     C                     EXSR RCFP1                                     E29170
     C                     END                                            E33035
     C                     END
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     CALL 'AOPRFCR0'                                CAC005
     C                     PARM *BLANKS   PRTCD                           CAC005
     C                     PARM '*KEY   ' POPTN                           CAC005
     C                     PARM PRFC      PPCCD   4                       CAC005
     C           SDPRFC    PARM SDPRFC    DSFDY                           CAC005
      *                                                                   CAC005
     C           PRTCD     IFNE *BLANKS                                   CAC005
     C           *LOCK     IN   LDA                                       CAC005
     C                     MOVE 'SDPRFCPD'DBFILE           ************   CAC005
     C                     MOVELPRFC      DBKEY            * DBERR 15 *   CAC005
     C                     Z-ADD15        DBASE            ************   CAC005
     C                     OUT  LDA                                       CAC005
     C                     EXSR *PSSR                                     CAC005
     C                     GOTO ENDPGM                                    CAC005
     C                     ELSE                                           CAC005
     C                     MOVELDSPCDS    PRFN                            CAC005
     C                     ENDIF                                          CAC005
     C                     ENDIF                                          CAC005
     C*
     C* IF THERE HAS BEEN A CHANGE IN ANY KEY FIELD
     C*
     C           PENT      IFNE LENT
     C           PBOK      ORNE LBOK
     C           PLEVEL    OREQ 'S'                                       E35470
     C           FILOPN    ANDNE'Y'                                       E35470
     C                     MOVEL'Y'       FILOPN  1                       E35470
     C                     WRITEHEAD1
     C                     WRITEHEAD2
     C                     Z-ADD0         LCNT
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     ADD  1         LCNT                            CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C                     END
     C*
     C* SET UP & PRINT UP TO 7 DETAIL LINES
     C* STOP IF A ZERO END DATE IS FOUND
     C*
     C                     DO   7         S
     C           WP5,S     CABEQ0         EPRINT
     C*
     C* SET PERIOD START
     C*
     C           S         IFEQ 1
     C                     MOVE *BLANKS   STP
     C                     ELSE
     C                     MOVE ENP       STP
     C                     END
     C*
     C* SET PERIOD END
     C*
     C           WP5,S     IFNE 99999
     C                     MOVE WPB,S     ENP
     C                     ELSE
     C                     MOVE 'END'     ENP
     C                     END
     C*
     C* SET PERIOD END DATE
     C*
     C                     MOVE *BLANKS   ENDATE
     C           WP5,S     IFNE 99999
     C                     Z-ADDWP5,S     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    ENDATE
     C                     END
     C*
     C* SET LONG EXPOSURE
     C*
     C           WLE,S     DIV  1000      WKAMT  130H
     C                     Z-ADDWKAMT     ZFLD15
     C                     MOVE 'J'       ZECODE
     C                     Z-ADD0         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    LEXP
     C*
     C* SET LONG EXCESS
     C*
     C           WKAMT     SUB  WLL,S     ZFLD15
     C           ZFLD15    IFGT 0
     C                     MOVE 'J'       ZECODE
     C                     Z-ADD0         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    LEXC
     C                     ELSE
     C                     MOVE *BLANKS   LEXC
     C                     END
     C*
     C* SET SHORT EXPOSURE
     C*
     C           WSE,S     DIV  1000      WKAMT     H
     C                     Z-ADDWKAMT     ZFLD15
     C                     MOVE 'J'       ZECODE
     C                     Z-ADD0         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SEXP
     C*
     C* SET SHORT EXCESS
     C*
     C           WKAMT     SUB  WSL,S     ZFLD15
     C           ZFLD15    IFGT 0
     C                     MOVE 'J'       ZECODE
     C                     Z-ADD0         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SEXC
     C                     ELSE
     C                     MOVE *BLANKS   SEXC
     C                     END
     C*
     C* SET LONG LIMIT
     C*
     C                     Z-ADDWLL,S     ZFLD15
     C                     MOVE 'J'       ZECODE
     C                     Z-ADD0         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    LLIM
     C*
     C* SET SHORT LIMIT
     C*
     C                     Z-ADDWSL,S     ZFLD15
     C                     MOVE 'J'       ZECODE
     C                     Z-ADD0         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SLIM
     C*
     C*   CHECK FOR PAGE OVERFLOW
     C*
     C           LCNT      IFGT MAXCNT
     C                     WRITEHEAD1
     C                     WRITEHEAD2
     C                     Z-ADD0         LCNT
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     ADD  1         LCNT                            CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C                     END
     C*
     C*   OUTPUT LINE
     C*
     C                     WRITEDETAIL
     C                     SETOF                     66                   E18218
     C*
     C*   INCREMENT LINE COUNT
     C*
     C           *IN65     IFEQ '1'
     C                     ADD  2         LCNT
     C                     SETOF                     65
     C                     ELSE
     C                     ADD  1         LCNT
     C                     END
     C                     END
     C*
     C           EPRINT    TAG                             ** EPRINT **
     C                     MOVE LTKEY     PRKEY
     C*
     C                     ENDSR
      *
      ******************************************************************
      /EJECT                                                              S01117
      *****************************************************************   S01117
      *                                                               *   S01117
      * *PSSR  - Database error subroutine.                           *   S01117
      *          This subroutine DUMPs the program just once.         *   S01117
      *                                                               *   S01117
      * Called by: DB ERROR PROCESSING                                *   S01117
      *                                                               *   S01117
      * Calls: None                                                   *   S01117
      *                                                               *   S01117
      *****************************************************************   S01117
      *                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR SR ** S01117
      *                                                                   S01117
     C           @RUN      IFEQ *BLANK                                    S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     ENDSR                                          S01117
      *                                                                   S01117
      ********************************************************************S01117
     C/EJECT                                                              E29170
     C********************************************************************E29170
     C*                                                                   E29170
     C*  RCFP1 -- SUBROUTINE TO REGISTER P1 PRINTER FILE VIA RCF          E29170
     C*                                                                   E29170
     C********************************************************************E29170
     C*                                                                   E29170
     C           RCFP1     BEGSR                            ** RCFP1 **   E29170
     C*                                                                   E29170
     C**      ENSURE REPORT SPOOL FILE RECORDED BY RCF                    E29170
     C*                                                                   E29170
     C                     Z-ADDSFNUM     ZSNUM   60                      E29170
     C**                                                                  E29170
     C           PLEVEL    IFEQ 'C'                                       E29170
     C                     MOVE HDCO      SENTY                           E38657
     C                     ELSE                                           E38657
     C           PLEVEL    IFEQ 'B'                                       E38657
     C***********PLEVEL    OREQ 'B'                                E29170 E38657
     C***********          MOVELPENT      SENTY                    E29170 E38657
     C                     MOVE HDBR      SENTY                           E38657
     C                     ELSE                                           E29170
     C                     MOVEL*BLANKS   SENTY                           E29170
     C                     END                                            E29170
     C                     END                                            E38657
     C**                                                                  E29170
     C                     CALL 'ZSFILE'                                  E29170
     C                     PARM           SEQ     5                       E29170
     C                     PARM           SENTY   3                       E29170
     C                     PARM           SFILE                           E29170
     C                     PARM           ZSNUM                           E29170
     C                     PARM           ZSERR   1                       E29170
     C*                                                                   E29170
     C           ZSERR     IFEQ 'Y'                                       E29170
     C*                                                                   E29170
     C**  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       E29170
     C*                                                                   E29170
     C                     SETON                     U7U8LR               E29170
     C                     RETRN                                          E29170
     C                     END                                            E29170
     C*                                                                   E29170
     C                     ENDSR                                          E29170
     C*                                                                   E29170
     C********************************************************************E29170
     C/EJECT                                                              E29170
     C********************************************************************E29170
     C*                                                                   E29170
     C*  RCFAU -- SUBROUTINE TO REGISTER AU PRINTER FILE VIA RCF          E29170
     C*                                                                   E29170
     C********************************************************************E29170
     C*                                                                   E29170
     C           RCFAU     BEGSR                            ** RCFAU **   E29170
     C*                                                                   E29170
     C**      ENSURE REPORT SPOOL FILE RECORDED BY RCF                    E29170
     C*                                                                   E29170
     C                     Z-ADDSFNUMU    ZSNUMU  60                      E29170
     C**                                                                  E29170
     C                     CALL 'ZSFILE'                                  E29170
     C                     PARM           SEQ                             E29170
     C                     PARM *BLANKS   SENTY                           E29170
     C                     PARM           SFILEU                          E29170
     C                     PARM           ZSNUMU                          E29170
     C                     PARM           ZSERR                           E29170
     C*                                                                   E29170
     C           ZSERR     IFEQ 'Y'                                       E29170
     C*                                                                   E29170
     C**  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       E29170
     C*                                                                   E29170
     C                     SETON                     U7U8LR               E29170
     C                     RETRN                                          E29170
     C                     END                                            E29170
     C*                                                                   E29170
     C                     ENDSR                                          E29170
     C*                                                                   E29170
     C********************************************************************E29170
      ***/EJECT**                                                   S01232S01195
     C***/COPY*ZSRSRC,XDATE3Z1                                      S01232S01195
      /EJECT                                                              S01195
     C/COPY ZSRSRC,ZACCH                                                  S01195
      /EJECT                                                              S01232
     C/COPY ZSRSRC,ZACCRZ1                                                S01232
      /EJECT                                                              S01232
     C/COPY ZSRSRC,ZACCZZ1                                                S01232
      /EJECT                                                              S01195
     C/COPY ZSRSRC,ZBKDT                                                  S01195
      /EJECT
     C/COPY ZSRSRC,ZDATE1Z2
      /EJECT
     C/COPY ZSRSRC,ZDATE2Z4
      /EJECT                                                              E16231
     C/COPY ZSRSRC,ZDAYSZ2                                                E16231
      /EJECT                                                              E16231
     C/COPY ZSRSRC,ZDYYRZ3                                                E16231
      /EJECT                                                              E16231
     C/COPY ZSRSRC,ZEVCDZ1                                                E16231
      /EJECT
     C/COPY ZSRSRC,ZICD2Z1
      /EJECT
     C/COPY ZSRSRC,ZICDSEZ1
      /EJECT                                                              E20380
     C/COPY ZSRSRC,ZLCDZ1                                                 E20380
      /EJECT                                                              E16231
     C/COPY ZSRSRC,ZNCDZ3                                                 E16231
      /EJECT                                                              E16231
     C/COPY ZSRSRC,ZPRCIZ1                                                E16231
      /EJECT                                                              S01232
     C/COPY ZSRSRC,ZRATEZ1                                                S01232
      /EJECT
     C/COPY ZSRSRC,ZSEDITZ3
      /EJECT
     C/COPY ZSRSRC,ZSYSTMZ1
      /EJECT                                                              S01232
     C/COPY ZSRSRC,ZYCEZ1                                                 S01232
      /EJECT                                                              E16231
     C/COPY ZSRSRC,ZYLDIZ1                                                E16231
      /EJECT                                                              E16231
     C/COPY ZSRSRC,ZYLDZ2                                                 E16231
      /EJECT
     C/COPY ZSRSRC,ZCALCD                                                 E39495
     C/EJECT                                                              E39495
     C/COPY ZSRSRC,ZCNSDZ1                                                E39495
     C/EJECT                                                              E39495
      ***
**  CPY@
(c) Finastra International Limited 2001
** HLA - HOLD LEGENDS
OWN
DISCRETIONARY CUSTOMERS
SAFE CUSTODY CUSTOMERS
ALL
** C1A - CAT TITLES
ISSUER/RISK CUSTOMER
PARENT OF ISSUER/RISK CUSTOMER
CURRENCY
SECURITY COUNTRY
ISSUER/RISK CUSTOMER COUNTRY
INVESTMENT TYPE
SECURITY
** C2A - CAT COLUMN HEADINGS
ISSUER/RISK CUSTOMER
PARENT
CURRENCY
COUNTRY
COUNTRY
INVESTMENT TYPE
SECURITY
**  POWER8 - ARRAY OF POWERS FOR CURRENCY CONVERSION
00000001
00000010
00000100
00001000
00010000
00100000
01000000
10000000
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
0006001521029820444305904073650882610287117481320914670161311759219053
2051421975234362489726358278192928030741322023366335124365853804639507
40968424294389045351
