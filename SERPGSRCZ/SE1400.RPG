000100200604     H        1
000200200604      *****************************************************************
000300200604/*STD *  RPGBASE                                                      *
000400200604/*EXI *  TEXT('Midas SE Create Trade Events')                         *
000500200604      *****************************************************************
000600200604      *                                                               *
000700200604      *  Midas - Securities Trading Module
000800200604      *                                                               *
000900200604      *  SE1400 - CREATE TRADE EVENTS AND AUDIT REPORT                *
001000200604      *                                                               *
001100200604      *  Function: The Trades File is read; for each Unsettled or     *
001200200604      *   (COB)    Forward-Valued Trade, an Event record is written   *
001300200604      *            to Trade Events.  (For trades with Portfolio       *
001400200604      *            Customer as Counterparty, an Event record is also  *
001500200604      *            written to Portfolio Customers Trade Events). This *
001600200604      *            is used to project Forward Positions (Book, Depot, *
001700200604      *            Customer, User-Depot, and Customer-Depot); and in  *
001800200604      *            reports with forward projections (Events by        *
001900200604      *            Security Report, Shadow Postings, Dealing Module   *
002000200604      *            Event reports.)                                    *
002100200604      *            Event codes : TP = 31P1                            *
002200200604      *                          TS = 31S1                            *
002300200604      *                                                               *
002400200604      *  Called by: SEC1101 - Create Trade Events for Forward Value   *
002500200604      *                       Dates on Trades.                        *
002600200604      *                                                               *
002700200604      *  (c) Finastra International Limited 2001                      *
002800200604      *                                                               *
002900200604      *  Last Amend No. MD048883           Date 01Jun20               *
003000200604      *  Prev Amend No. MD046248           Date 27Oct17               *
003100200604      *                 CER049             Date 06Dec10               *
003200200604      *                 CER059             Date 19Jul10               *
003300200604      *                 CER043             Date 19May08               *
003400200604      * Bank Fusion Midas 1.4 Base -----------------------------------*
003500200604      * Midas Plus 1.4 Base 04 ---------------------------------------*
003600200604      * Midas Plus 1.4 Base ------------------------------------------*
003700200604      *                 241795             Date 04Sep06               *
003800200604      * Midas Plus 1.3 ----------- Base ------------------------------*
003900200604      *                 CSE078             Date 14Feb06               *
004000200604      *                 CSD031             Date 10Apr06               *
004100200604      *                 CSD027             Date 09Dec05               *
004200200604      * Midas Plus 1.2 -----------------------------------------------*
004300200604      *                 CGL029             Date 01Sep03               *
004400200604     F*                 209234             Date 20Sep02               *
004500200604     F*                 162703             Date 20Aug99               *
004600200604      * Midas Release 4.01 -------------------------------------------*
004700200604      *                 204137             Date 24Apr02               *
004800200604      * Midas Release 4 --------------- Base -------------------------*
004900200604      * Midas DBA 3.05 -----------------------------------------------*
005000200604      *                 CSD006             Date 06Jun01               *
005100200604      * Midas DBA 3.03 -----------------------------------------------*
005200200604      *                 137337             Date 19Apr00               *
005300200604      * Midas DBA 3.00 ---------------- Base -------------------------*
005400200604      *                 CAC005             Date 23Nov98               *
005500200604      *                 CEU011             Date 11Mar98               *
005600200604      *                 108525             Date 24Feb97               *
005700200604      *                 S01408             Date 22Aug96               *
005800200604      *                 066530             DATE 02MAY96               *
005900200604      *                 S01486             DATE 23NOV94               *
006000200604      *                 S01496             DATE 15JUL94               *
006100200604      *                 052254             DATE 10JAN94               *
006200200604      *                 E37370             DATE 20MAR92               *
006300200604      *                 E34034             DATE  7JAN92               *
006400200604      *                 S01117             DATE 02NOV90               *
006500200604      *                 S01269             DATE 19JUL90               *
006600200604      *                 S01271             DATE 19JUN90               *
006700200604      *                 E20190             DATE 01FEB90               *
006800200604      *                 E20581             DATE 01FEB90               *
006900200604      *                 E19101             DATE 29JAN90               *
007000200604      *                 E20125             DATE 10NOV89               *
007100200604      *                 E18450             DATE 04/07/89              *
007200200604      *                                                               *
007300200604      *---------------------------------------------------------------*
007400200604      *                                                               *
007500200604      *  MD048883 - Incorrect warning message that the account has    *
007600200604      *             insufficient funds and will be overdrawn due to   *
007700200604      *             extra shadow posting on the account.              *
007800200604      *           - Pattern fix from AR677686.                        *
007900200604      *  MD046248 - Finastra Rebranding                               *
008000200604      *  CER049 - Stamp Tax                                           *
008100200604      *  CER059 - German Feature Upgrade to Delhi                     *
008200200604      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
008300200604      *           (Recompile)                                         *
008400200604      *  241795 - Populate ECSS whether CEU011 is switched on or off. *
008500200604      *  CSE078 - Sort Report using Currency Sort Sequence            *
008600200604      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
008700200604      *  CSD027 - Conversion Of Customer Number to Alpha              *
008800200604      *  CGL029 - Increase Account Code to 10 digits                  *
008900200604      *  209234 - Reverse fix 204137 as it caused duplicate           *
009000200604      *           entry postings for SE.                              *
009100200604     F*  162703 - CASH FLOW RPT (GL0540) USES NEW FILE DLEVNTL6 WITH  *
009200200604     F*           FIRST KEY FIELD BEING CCY SORT SEQ NO.  AMEND SE    *
009300200604     F*           EVENT CREATION TO OUTPUT CCY SORT SEQ NO TO OBTAIN  *
009400200604     F*           CORRECT ORDER FOR REPORTING.                        *
009500200604      *  204137 - Reverse out 137337 as EVNTM1 excludes inter-branch  *
009600200604      *           postings for SE.                                    *
009700200604      *  CSD006 - AOCURRR0 should use DSSDY not DSFDY                 *
009800200604      *  137337 - Revesre out 108525 as not required if 102807 not    *
009900200604      *           present, causes duplicate entries otherwise.        *
010000200604      *  CAC005 - Profit Centre Accounting - SE Enhancement           *
010100200604      *  CEU011 - EMU Position/Risk Reporting                         *
010200200604      *  108525 - PROJECTED MOVEMENTS NOT INCLUDE SE TRADE            *
010300200604      *  S01408 - Core Hook SE1400CCP7 Added.                         *
010400200604      *         - Core Hook SE1400CCP6 Added.                         *
010500200604      *         - Core Hook SE1400CCP5 Added.                         *
010600200604      *         - Core Hook SE1400CCP4 Added.                         *
010700200604      *         - Core Hook SE1400CCP3 Added.                         *
010800200604      *         - Core Hook SE1400CCP2 Added.                         *
010900200604      *         - Core Hook SE1400CCP1 Added.                         *
011000200604      *  066530 - Multiply/divide indicator is now 'M' or 'D'.        *  *
011100200604      *  S01486 - Recompiled for Portfolio Management Enhancements.   *
011200200604      *  S01496 - Incorporation of JYSKE Enhancements (S10978)        *
011300200604      *  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
011400200604      *           to 10,9                                             *
011500200604      *  E37370 - DB error when pay/from branches are blank           *
011600200604      *  E34034 - Recompiled over changed printer file                *
011700200604      *  S01117 - MULTIBRANCHING                                      *
011800200604      *  S01269 - TRADE AUTHORISATION                                 *
011900200604      *  S01271 - Recompiled for Pay/Receive in Input Cycle changes   *
012000200604      *           to TRADSD and/or DPTMVD                             *
012100200604      *  E20190 - Trades with Overdue Indicator set to 'Y' should     *
012200200604      *           still have Event Code.                              *
012300200604      *  E20581 - When Database Error on CHAIN to CLINT is caused by  *   E20581
012400200604      *           incorrect RECI, Program priunts out File Control    *   E20581
012500200604      *           details erroneously.                                *   E20581
012600200604      *  E19101 - Events Less Than or Equal To zero should not be     *   E19101
012700200604      *           written to Output Files.                            *   E19101
012800200604      *  E20125 - Events generated for Cancelled Trades.              *   E20125
012900200604      *  E18450 - Outstanding Value on Trade Events should be         *   E18450
013000200604      *           'UNSETTLED AMOUNT' not 'COUNTERVALUE'.              *   E18450
013100200604      *                                                               *
013200200604      *****************************************************************
013300200604      *
013400200604     FTRADS   IPE E           K        DISK
013500200604     FSDCURRL1IF  E           K        DISK                               CEU011
013600200604     FTRADSA  IF  E                    DISK
013700200604     FCLINT   IF  E           K        DISK
013800200604     F************CLINTSEF                          KIGNORE
013900200604     F            CLINTCAF                          KIGNORE
014000200604     F************CLINTCBF                          KIGNORE
014100200604     F            CLINTCCF                          KIGNORE
014200200604     F            CLINTC1F                          KIGNORE
014300200604     FTRADSQL0IF  E           K        DISK                                                   CER049
014400200604     F*TABSE***IF**E           K        DISK                              S01117
014500200604     F************TABLETAF                          KIGNORE               S01117
014600200604     F************TABLETHF                          KIGNORE               S01117
014700200604     F*********** TABLETJF                          KIGNORE               S01117
014800200604     F************TABLETLF                          KIGNORE               S01117
014900200604     F************TABLETKF                          KIGNORE               S01117
015000200604     F************TABLETNF                          KIGNORE               S01117
015100200604     F************TABLETPF                          KIGNORE               S01117
015200200604     F************TABLETRF                          KIGNORE               S01117
015300200604     F************TABLETXF                          KIGNORE               S01117
015400200604     F**ICD*1*****TABTB10F**************************KIGNORE***************S01117
015500200604     F************TABTB10F                          KIGNORE               S01117
015600200604     F**ICD*1*****TABTB11F                          KIGNORE               S01117
015700200604     F************TABTB36F                          KIGNORE               S01117
015800200604     F************TABTB40F                          KIGNORE               S01117
015900200604     F************TABTE10F                          KIGNORE               S01117
016000200604     F************TABTE20F                          KIGNORE               S01117
016100200604     F**CCY*******TABTG10F                          KIGNORE               S01117
016200200604     F************TABTG20F                          KIGNORE               S01117
016300200604     F************TABLET2F                          KIGNORE               S01117
016400200604     F************TABLET3F                          KIGNORE               S01117
016500200604     F************TABLET5F                          KIGNORE               S01117
016600200604     FTREVED  O   E                    DISK
016700200604     FTREVEA  O   E                    DISK
016800200604     FPCTEVD  O   E                    DISK
016900200604     FPCTEVA  O   E                    DISK
017000200604     FSE1400AUO   E                    PRINTER
017100200604     F/COPY WNCPYSRC,SE1400F001
017200200604      /EJECT
017300200604     F*****************************************************************
017400200604     F*                                                               *
017500200604     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
017600200604     F*                                                               *
017700200604     F*   40  - Detail records read                                   *
017800200604     F*   50  - Work indicator                                        *
017900200604     F*   51  - ICD record 2 not found                                *
018000200604     F****51**-*ICD*record*2*not*found************************        *   S01117
018100200604     F*   52  - Database Errors                                       *
018200200604      *  42  - End of file indicator -LF/SDCURRL1                     *   CEU011
018300200604      *  41  - Currency lokup indicator                               *   CEU011
018400200604     F*                                                               *
018500200604     F* 90-99 - Used in Standard Subroutines                          *
018600200604     F*                                                               *
018700200604     F*   U7  - Database Error                                        *
018800200604     F*   U8  - Database / Control Error                              *
018900200604     F*                                                               *
019000200604     F*****************************************************************
019100200604      /SPACE 3
019200200604     F*****************************************************************
019300200604     F*                                                               *
019400200604     F*  S U B R O U T I N E   I N D E X                              *
019500200604     F*                                                               *
019600200604     F*  SRHASH - Add Event Amounts To Hash Totals                    *
019700200604     F*  SRLR   - Total time Calculations                             *
019800200604     F*  *PSSR  - ERROR HANDLING SUBROUTINE                           *   S01117
019900200604     F*                                                               *
020000200604     F*  ZCONV  - CCY1 to CCY2 Amount conversion                      *
020100200604     F*  ZEVCD  - Calculate Event Control Date                        *
020200200604     F***ZICD2**-*Access*ICD record*2**(TABTB11)***********************   S01117
020300200604     F***ZSYSTM*-*Access*ICD*record*1**(TABTB10)***********************   S01117
020400200604     F*                                                               *
020500200604     F*****************************************************************
020600200604      /EJECT
020700200604     E                    CPY@    1   1 80
020800200604     E/COPY ZSRSRC,ZPOWERZ1
020900200604     E                    CUR       200  3   SRT     2 0                  CEU011
021000200604      ** Array to store the sort sequence no. of each currency            CEU011
021100200604      *                                                                   CEU011
021200200604     ITRADSDF
021300200604     I              RECI                            TRECI
021400200604     I              TDSS                            TRSS
021500200604     I              TDTP                            TRTT
021600200604     I              TDRF                            TRTR
021700200604     I              TDVD                            TRVD
021800200604     I              TNMC                            TRNC
021900200604     I              TOSN                            TRON
022000200604     I              SETC                            TRSC
022100200604     I              TCNR                            TRPT
022200200604     I***********   TDBR                            TRBN                  S01117
022300200604     I              TDBA                            TRBA                  S01117
022400200604     I              TDBK                            TRBK
022500200604     I              TDMI                            TRMK
022600200604     I              ACIN                            TRED
022700200604     I              TSUB                            TRTS
022800200604     I***********   SMTH                            TRSM                  S01117
022900200604     I              CLTY                            TRCR
023000200604     ITRADSAF
023100200604     I              NORE                            TRIN
023200200604     ICLINTCBF
023300200604     I              CRNM                            TRCN
023400200604     I              CTWN                            TRTN
023500200604      /SPACE 3
023600200604     ICPYR@#      DS
023700200604     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
023800200604     I                                        1  80 CPY@
023900200604     I                                        1  20 CPY@##
024000200604      *
024100200604      ***  Local Data Area for DB Error Information
024200200604     I*DA********UDS                            256                       S01117
024300200604     I***********                           134 177 #DBLOT                S01117
024400200604     ILDA         DS                            256                       S01117
024500200604     I                                      134 183 #DBLOT                S01117
024600200604     I            DS
024700200604     I***********                           134 177 DBLOT                 S01117
024800200604     I***********                           134 138 DBFILE                S01117
024900200604     I***********                           139 167 DBKEY                 S01117
025000200604     I***********                           168 175 DBPGM                 S01117
025100200604     I***********                           176 177 DBASE                 S01117
025200200604     I                                      134 183 DBLOT                 S01117
025300200604     I                                      134 141 DBFILE                S01117
025400200604     I                                      142 170 DBKEY                 S01117
025500200604     I                                      171 180 DBPGM                 S01117
025600200604     I                                      181 1830DBASE                 S01117
025700200604     I*                                                                   S01117
025800200604     I** DATA AREA RUNDAT                                                 S01117
025900200604     I*                                                                   S01117
026000200604     IRUNDT       DS                                                      S01117
026100200604     I                                        1   7 RUNA                  S01117
026200200604     I                                    P   8  100RUND                  S01117
026300200604     I                                       11  11 SSF                   S01117
026400200604     I                                       12  12 DATF                  S01117
026500200604     I                                       13  13 MBIN                  S01117
026600200604     I*                                                                   S01117
026700200604     I**  EXTERNAL DS FOR BANK DETAILS                                    S01117
026800200604     I*                                                                   S01117
026900200604     ISDBANK    E DSSDBANKPD                                              S01117
027000200604     I*                                                                   S01117
027100200604     ISDBRCH    E DSSDBRCHPD                                              S01117
027200200604     I** Branch Details                                                   S01117
027300200604     I*                                                                   S01117
027400200604     ISDCURR    E DSSDCURRPD                                              S01117
027500200604     I*                                                                   S01117
027600200604     I** Currency Details                                                 S01117
027700200604     I*                                                                   S01117
027800200604     ISDGELR    E DSSDGELRPD                                              S01117
027900200604     I** General ledger details                                           S01117
028000200604     I*                                                                   CAC005
028100200604     ISDMMOD    E DSSDMMODPD                                              CAC005
028200200604     I** Midas Modules details                                            CAC005
028300200604     I**                                                                  S01117
028400200604     I**  FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE              S01117
028500200604     I*                                                                   S01117
028600200604     ISCSARD    E DSSCSARDPD                                              CEU011
028700200604      **  Switchable Features File                                        CEU011
028800200604      *                                                                   CEU011
028900200604     IDSFDY     E DSDSFDY                                                 S01117
029000200604     I*
029100200604     IDSSDY     E DSDSSDY                                                                     CSD006
029200200604      ** Long data structure for access programs                                              CSD006
029300200604      *                                                                                       CSD006
029400200604     I           SDS
029500200604     I                                      244 246 WSID
029600200604     I                                      254 263 USID
029700200604     ISDDTA       DS                                                                        MD048883
029800200604     I                                        1 256 SDDATA                                  MD048883
029900200604     I                                      116 116 ACCR                                    MD048883
030000200604     ISEDTA       DS                                                                        MD048883
030100200604     I                                        1 133 SEDATA                                  MD048883
030200200604     I                                       56  600EOPT                                    MD048883
030300200604     I/COPY WNCPYSRC,SE1400I001
030400200604     C/EJECT
030500200604      *================================================================
030600200604      *  P R O G R A M   S T A R T                                    *
030700200604      *================================================================
030800200604      *
030900200604      **  Initial Processing
031000200604      *
031100200604     C           *IN40     IFEQ '0'
031200200604      *                                                                   162703
031300200604     C           *LIKE     DEFN TRSC      #TRSC                           162703
031400200604     C                     CLEAR#TRSC                                     162703
031500200604      *
031600200604      **  Prepare LDA for the database error output
031700200604      *
031800200604     C                     MOVEL*BLANK    DBLOT
031900200604     C                     MOVEL'SE1400'  DBPGM
032000200604      *
032100200604     C**Access*the*I.C.D.*record*1**(PF/TABTB10)**************************S01117
032200200604      ***********                                                         S01117
032300200604     C***********          EXSR ZSYSTM                                    S01117
032400200604     C*                                                                   S01117
032500200604     C* Get Bank Title by access object                                   S01117
032600200604     C*                                                                   S01117
032700200604     C                     CALL 'AOBANKR0'                                S01117
032800200604     C                     PARM '*MSG   ' @RTCD   7                       S01117
032900200604     C                     PARM '*FIRST ' @OPTN   7                       S01117
033000200604     C           SDBANK    PARM SDBANK    DSFDY                           S01117
033100200604     C*                                                                   S01117
033200200604     C**Error*in*ZSYSTM***************************************************S01117
033300200604     C************IN99     IFEQ '1'                                       S01117
033400200604     C           @RTCD     IFNE *BLANKS                                   S01117
033500200604     C                     MOVE '1'       *INLR
033600200604     C                     MOVEL'SDBANKPD'DBFILE           ***************S01117
033700200604     C                     MOVEL@OPTN     DBKEY            ** DB ERROR 3  S01117
033800200604     C                     Z-ADD3         DBASE            ***************S01117
033900200604     C                     MOVEL@OPTN     DBOPTN  7                       S01117
034000200604     C                     SETON                       U7U8               S01117
034100200604     C                     EXSR *PSSR                                     S01117
034200200604     C                     ELSE
034300200604      *
034400200604      ****Access*the*I.C.D.*record*2**(PF/TABTB11)                        S01117
034500200604     C* Access general ledger details                                     S01117
034600200604      *
034700200604     C*********************EXSR ZICD2                                     S01117
034800200604     C**********           CALL 'AOGELRR0'                                             S01117 CGL029
034900200604     C                     CALL 'AOGELRR1'                                                    CGL029
035000200604     C                     PARM '*MSG   ' @RTCD   7                       S01117
035100200604     C                     PARM '*FIRST ' @OPTN   7                       S01117
035200200604     C********** SDGELR    PARM SDGELR    DSFDY                                        S01117 CGL029
035300200604     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
035400200604      *
035500200604      ****Error*in*ZICD2***
035600200604      *
035700200604     C********** *IN99*****IFEQ '1'                                       S01117
035800200604     C***********          MOVE '1'       *IN51                           S01117
035900200604     C           @RTCD     IFNE *BLANKS                                   S01117
036000200604     C                     MOVE '1'       *INLR
036100200604     C*********************MOVEL'TABLE   'DBFILE           ***************S01117
036200200604     C                     MOVEL'SDGELRPD'DBFILE           ***************S01117
036300200604     C                     MOVEL@OPTN     DBKEY            ** DB ERROR 4  S01117
036400200604     C                     Z-ADD4         DBASE            ***************S01117
036500200604     C                     MOVEL@OPTN     DBOPTN  7                       S01117
036600200604     C                     SETON                       U7U8               S01117
036700200604     C                     EXSR *PSSR                                     S01117
036800200604     C                     ELSE
036900200604     C*                                                                   CAC005
037000200604     C**  Access Midas Modules Details                                    CAC005
037100200604     C*                                                                   CAC005
037200200604     C                     CALL 'AOMMODR0'                                CAC005
037300200604     C                     PARM '*MSG   ' @RTCD   7                       CAC005
037400200604     C                     PARM '*FIRST ' @OPTN   7                       CAC005
037500200604     C           SDMMOD    PARM SDMMOD    DSFDY                           CAC005
037600200604     C*                                                                   CAC005
037700200604     C           @RTCD     IFNE *BLANK                                    CAC005
037800200604     C                     MOVE '1'       *INLR                           CAC005
037900200604     C                     Z-ADD16        DBASE            ************   CAC005
038000200604     C                     MOVEL'SDMMODPD'DBFILE           * DBERR 16 *   CAC005
038100200604     C                     MOVEL@OPTN     DBKEY            ************   CAC005
038200200604     C                     SETON                     U7U8                 CAC005
038300200604     C*                    EXSR *PSSR                                     CAC005
038400200604     C                     END                                            CAC005
038500200604     C*                                                                   S01117
038600200604     C**   IN THE DATAAREA RUNDAT                                         S01117
038700200604     C*                                                                   S01117
038800200604     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
038900200604     C                     IN   RUNDT                                     S01117
039000200604     C**                                                                  S01117
039100200604     C**   CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.                    S01117
039200200604     C**                                                                  S01117
039300200604     C           DATF      COMP 'M'                      98               S01117
039400200604      *
039500200604      **  ICD records 1 & 2 found
039600200604      **  Calculate the Event Control Date
039700200604      *
039800200604     C** Input parameters to SR.ZEVCD are Date Next Working Day           S01117
039900200604     C**                              and Accrual Profit Date             S01117
040000200604     C*                                                                   S01117
040100200604     C                     Z-ADDBJDNWD    ZZDNWD                          S01117
040200200604     C                     Z-ADDBKAPDT    ZZAPDT                          S01117
040300200604     C                     EXSR ZEVCD
040400200604     C                     MOVE '1'       *IN40
040500200604     C                     MOVE 'D'       TRRI
040600200604      *                                                                   CEU011
040700200604      ** Check if EMU Position/Risk Reporting is switch on.               CEU011
040800200604      *                                                                   CEU011
040900200604     C                     CALL 'AOSARDR0'                                CEU011
041000200604     C                     PARM *BLANKS   @RTCD                           CEU011
041100200604     C                     PARM '*VERIFY' @OPTN                           CEU011
041200200604     C                     PARM 'CEU011'  @SARD   6                       CEU011
041300200604     C           SCSARD    PARM SCSARD    DSFDY                           CEU011
041400200604      *                                                                   CEU011
041500200604     C           @RTCD     IFEQ *BLANKS                                   CEU011
041600200604     C                     MOVE 'Y'       CEU011  1                       CEU011
041700200604     C                     ELSE                                           CEU011
041800200604     C                     MOVE 'N'       CEU011                          CEU011
041900200604      *                                                                   CEU011
042000200604     C           @RTCD     IFNE '*NRF   '                                 CEU011
042100200604     C                     MOVEL'SCSARDPD'DBFILE                          CEU011
042200200604     C                     MOVEL'CEU011'  DBKEY            ************   CEU011
042300200604     C                     Z-ADD14        DBASE            *DBERROR 14*   CEU011
042400200604     C                     MOVEL@OPTN     DBOPTN           ************   CEU011
042500200604     C                     MOVE '1'       *INLR                           CEU011
042600200604     C                     SETON                       U7U8               CEU011
042700200604     C                     EXSR *PSSR                                     CEU011
042800200604     C                     ENDIF                                          CEU011
042900200604      *                                                                   CEU011
043000200604     C                     ENDIF                                          CEU011
043100200604      *                                                                   S01496
043200200604      **  Access SAR details file to see if JYSKE Enhcmts is installed.   S01496
043300200604      *                                                                   S01496
043400200604     C                     CALL 'AOSARDR0'                                S01496
043500200604     C                     PARM '       ' @RTCD   7                       S01496
043600200604     C                     PARM '*VERIFY' @OPTN   7                       S01496
043700200604     C                     PARM 'S01496'  WSARD   6                       S01496
043800200604      *                                                                   S01496
043900200604     C           @RTCD     IFEQ *BLANK                                    S01496
044000200604     C                     MOVE 'Y'       S01496  1                       S01496
044100200604     C                     END                                            S01496
044200200604      *                                                                   CSE078
044300200604     C                     MOVE 'N'       CSE078                          CSE078
044400200604     C                     CALL 'AOSARDR0'                                CSE078
044500200604     C                     PARM '       ' @RTCD                           CSE078
044600200604     C                     PARM '*VERIFY' @OPTN                           CSE078
044700200604     C                     PARM 'CSE078'  WSARD                           CSE078
044800200604      *                                                                   CSE078
044900200604     C           @RTCD     IFEQ *BLANK                                    CSE078
045000200604     C                     MOVE 'Y'       CSE078  1                       CSE078
045100200604     C                     END                                            CSE078
045200200604      *                                                                                       CER049
045300200604      ** Determine if CER049 enhancement is installed                                         CER049
045400200604      *                                                                                       CER049
045500200604     C                     CALL 'AOSARDR0'                                                    CER049
045600200604     C                     PARM *BLANKS   @RTCD                                               CER049
045700200604     C                     PARM '*VERIFY' @OPTN                                               CER049
045800200604     C                     PARM 'CER049'  WSARD                                               CER049
045900200604     C                     MOVE 'N'       CER049  1                                           CER049
046000200604      *                                                                                       CER049
046100200604      ** If feature is on, set up SAR work flag                                               CER049
046200200604      *                                                                                       CER049
046300200604     C           @RTCD     IFEQ *BLANKS                                                       CER049
046400200604     C                     MOVE 'Y'       CER049                                              CER049
046500200604     C                     ENDIF                                                              CER049
046600200604      *                                                                   CEU011
046700200604      ** Read first 200 records form LF/SDCURRL1 and for each ccy         CEU011
046800200604      ** get the sort sequence no.                                        CEU011
046900200604      *                                                                   CEU011
047000200604     C********** CEU011    IFEQ 'Y'                                                    CEU011 241795
047100200604     C********** CSE078    OREQ 'Y'                                                    CSE078 241795
047200200604     C           CSE078    IFEQ 'Y'                                                           241795
047300200604     C                     Z-ADD1         J       30                      CEU011
047400200604     C           *LOVAL    SETLLSDCURRL1                                  CEU011
047500200604     C                     READ SDCURRL1                 70               CEU011
047600200604      *                                                                   CEU011
047700200604     C           J         DOWLE200                                       CEU011
047800200604     C           *IN70     ANDEQ'0'                                       CEU011
047900200604      *                                                                   CEU011
048000200604     C                     MOVELA6CYCD    CUR,J                           CEU011
048100200604     C                     MOVELA6SSNB    SRT,J                           CEU011
048200200604      *                                                                   CEU011
048300200604     C                     READ SDCURRL1                 70               CEU011
048400200604     C                     ADD  1         J       30                      CEU011
048500200604     C                     ENDDO                                          CEU011
048600200604      *                                                                   CEU011
048700200604     C                     ENDIF                                          CEU011
048800200604      *
048900200604     C                     END
049000200604     C                     END
049100200604      *                                                                                     MD048883
049200200604     C           *NAMVAR   DEFN SDSTAT    SDDTA                                             MD048883
049300200604     C           *NAMVAR   DEFN SESTAT    SEDTA                                             MD048883
049400200604     C                     IN   SDDTA                                                       MD048883
049500200604     C                     IN   SEDTA                                                       MD048883
049600200604      *                                                                                     MD048883
049700200604     C/COPY WNCPYSRC,SE1400C001
049800200604     C                     END
049900200604     C/COPY WNCPYSRC,SE1400C003
050000200604      *
050100200604      **  DEFINE WORK FIELDS
050200200604      *
050300200604     C           *LIKE     DEFN #HRWN     TRHRWN
050400200604     C           *LIKE     DEFN #HRDC     TRHRDC
050500200604     C           *LIKE     DEFN #HRWN     PCHRWN
050600200604     C           *LIKE     DEFN #HRDC     PCHRDC
050700200604      *
050800200604      *================================================================
050900200604      /EJECT
051000200604      *================================================================
051100200604      *
051200200604      **  Main Processing
051300200604      *
051400200604      *                                                                   CEU011
051500200604      ** Move the Sort Sequence No. of the the nominal currency           CEU011
051600200604      ** to the field ECSS.                                               CEU011
051700200604      *                                                                   CEU011
051800200604     C********** CEU011    IFEQ 'Y'                                                    CEU011 241795
051900200604     C********** CSE078    OREQ 'Y'                                                    CSE078 241795
052000200604     C           CSE078    IFEQ 'Y'                                                           241795
052100200604     C                     Z-ADD1         X       30                      CEU011
052200200604      *                                                                   CEU011
052300200604     C           TRNC      LOKUPCUR,X                    71               CEU011
052400200604      *                                                                   CEU011
052500200604     C           *IN71     IFEQ '1'                                       CEU011
052600200604     C                     Z-ADDSRT,X     ECSS                            CEU011
052700200604     C                     ELSE                                           CEU011
052800200604     C                     MOVEL'SDCURRL1'DBFILE                          CEU011
052900200604     C                     MOVELTRNC      DBKEY            ************   CEU011
053000200604     C                     Z-ADD15        DBASE            *DBERROR 15*   CEU011
053100200604     C                     MOVE '1'       *INLR            ************   CEU011
053200200604     C                     SETON                       U7U8               CEU011
053300200604     C                     EXSR *PSSR                                     CEU011
053400200604     C                     ENDIF                                          CEU011
053500200604      *                                                                   CEU011
053600200604     C                     ENDIF                                          CEU011
053700200604      *                                                                   CEU011
053800200604      **  Records read
053900200604      *
054000200604     C           TRECI     IFNE '*'
054100200604     C                     ADD  1         TRCNT   50
054200200604     C                     END
054300200604      *                                                                                     MD048883
054400200604     C           *IN40     IFEQ '1'                                                         MD048883
054500200604     C           TRECI     ANDNE'S'                                                         MD048883
054600200604     C           TRECI     ANDNE'*'                                                         MD048883
054700200604     C           TRECI     ANDNE'C'                                                         MD048883
054800200604     C           TINC      ANDEQ'C'                                                         MD048883
054900200604     C           TRECI     ANDNE'L'                                                         MD048883
055000200604     C           TRECI     ANDNE'P'                                                         MD048883
055100200604      *                                                                                     MD048883
055200200604      ** If ACCR = '3' then bypass all the TRADES to be settled by                          MD048883
055300200604      ** SEC0602D seq 00002.                                                                MD048883
055400200604      *                                                                                     MD048883
055500200604     C                     TESTB'1'       TACI           20                                 MD048883
055600200604      *                                                                                     MD048883
055700200604     C           *IN20     IFEQ '0'                                                         MD048883
055800200604     C           AUTS      ANDEQ'Y'                                                         MD048883
055900200604     C           ACCR      ANDEQ'3'                                                         MD048883
056000200604     C           TRVD      ANDGTEOPT                                                        MD048883
056100200604     C           TRVD      ANDLTBJDNWD                                                      MD048883
056200200604     C           BKANWD    ANDNE'2'                                                         MD048883
056300200604     C                     GOTO NEXT                                                        MD048883
056400200604     C                     ENDIF                                                            MD048883
056500200604      *                                                                                     MD048883
056600200604     C                     ENDIF                                                            MD048883
056700200604      *                                                                                       CER049
056800200604     C           CER049    IFEQ 'Y'                                                           CER049
056900200604     C           TRTR      CHAINTRADSQL0             21                                       CER049
057000200604     C           *IN21     IFEQ *ON                                                           CER049
057100200604     C                     MOVEL'SE1400'  DBPGM                                               CER049
057200200604     C                     MOVE TRTR      DBKEY                                               CER049
057300200604     C                     MOVEL'TRADSQL0'DBFILE                                              CER049
057400200604     C                     Z-ADD47        DBASE                                               CER049
057500200604     C                     SETON                       U7U8                                   CER049
057600200604     C                     EXSR *PSSR                                                         CER049
057700200604     C                     ENDIF                                                              CER049
057800200604     C                     ENDIF                                                              CER049
057900200604      *                                                                   162703
058000200604      **  Set up the CCY SORT SEQUENCE NO. for cash flow reporting        162703
058100200604     C           TRSC      IFNE #TRSC                                     162703
058200200604     C                     MOVELTRSC      #TRSC                           162703
058300200604     C                     CALL 'AOCURRR0'                                162703
058400200604     C                     PARM '*MSG   ' @RTCD   7                       162703
058500200604     C                     PARM '*KEY   ' @OPTN   7                       162703
058600200604     C                     PARM TRSC      @AJCD   3                       162703
058700200604     C           SDCURR    PARM SDCURR    DSFDY                           162703
058800200604     C*                                                                   162703
058900200604     C           @RTCD     IFNE *BLANKS                                   162703
059000200604     C                     MOVE '1'       *INLR                           162703
059100200604     C                     MOVEL'SDCURRPD'DBFILE           ***************162703
059200200604     C                     MOVEL@OPTN     DBKEY            ** DB ERROR 7  162703
059300200604     C                     Z-ADD38        DBASE            ***************162703
059400200604     C                     MOVEL@OPTN     DBOPTN  7                       162703
059500200604     C                     SETON                       U7U8               162703
059600200604     C                     EXSR *PSSR                                     162703
059700200604     C                     ELSE                                           162703
059800200604     C                     Z-ADDA6SSNB    ECSS                            162703
059900200604     C                     END                                            162703
060000200604     C                     END                                            162703
060100200604      *
060200200604      **  Countervalue
060300200604      *
060400200604     C           *IN40     IFEQ '1'
060500200604     C           TRECI     ANDNE'S'
060600200604     C           TRECI     ANDNE'*'
060700200604     C           TRECI     ANDNE'C'                                       E20125
060800200604     C           TINC      ANDEQ'C'
060900200604     C           TRECI     ANDNE'L'                                       S01269
061000200604     C           TRECI     ANDNE'P'                                       S01269
061100200604      *
061200200604      **  If settlement currency not EQ nominal currency, calculate
061300200604      **  the countervalue in the settlement currency, else set
061400200604      **  to countervalue in nominal ccy.
061500200604      *
061600200604     C***********          Z-ADDTCTR      TRVN                            E18450
061700200604     C***********          Z-ADDTCTR      TRVS                            E18450
061800200604     C                     Z-ADDTOSV      TRVN                            E18450
061900200604     C                     Z-ADDTOSV      TRVS                            E18450
062000200604      *
062100200604     C           TRSC      IFNE TRNC
062200200604     C*                                                                   S01117
062300200604     C* Get In currency decimal places                                    S01117
062400200604     C*                                                                   S01117
062500200604     C                     CALL 'AOCURRR0'                                S01117
062600200604     C                     PARM '*MSG   ' @RTCD   7                       S01117
062700200604     C                     PARM '*KEY   ' @OPTN   7                       S01117
062800200604     C                     PARM TRSC      @AJCD   3                       S01117
062900200604     C********** SDCURR    PARM SDCURR    DSFDY                    S01117 CSD006
063000200604     C           SDCURR    PARM SDCURR    DSSDY                           CSD006
063100200604     C*                                                                   S01117
063200200604     C           @RTCD     IFNE *BLANKS                                   S01117
063300200604     C                     MOVE '1'       *INLR
063400200604     C                     MOVEL'SDCURRPD'DBFILE           ***************S01117
063500200604     C                     MOVEL@OPTN     DBKEY            ** DB ERROR 7  S01117
063600200604     C                     Z-ADD7         DBASE            ***************S01117
063700200604     C                     MOVEL@OPTN     DBOPTN  7                       S01117
063800200604     C                     SETON                       U7U8               S01117
063900200604     C                     EXSR *PSSR                                     S01117
064000200604     C                     ELSE                                           S01117
064100200604     C                     Z-ADDA6NBDP    ZCDPI                           S01117
064200200604     C                     END                                            S01117
064300200604     C*                                                                   S01117
064400200604     C* Get Out Currency decimal places                                   S01117
064500200604     C*                                                                   S01117
064600200604     C                     CALL 'AOCURRR0'                                S01117
064700200604     C                     PARM '*MSG   ' @RTCD   7                       S01117
064800200604     C                     PARM '*KEY   ' @OPTN   7                       S01117
064900200604     C                     PARM TRNC      @AJCD   3                       S01117
065000200604     C********** SDCURR    PARM SDCURR    DSFDY                    S01117 CSD006
065100200604     C           SDCURR    PARM SDCURR    DSSDY                           CSD006
065200200604     C*                                                                   S01117
065300200604     C           @RTCD     IFNE *BLANKS                                   S01117
065400200604     C                     MOVE '1'       *INLR
065500200604     C                     MOVEL'SDCURRPD'DBFILE           ***************S01117
065600200604     C                     MOVEL@OPTN     DBKEY            ** DB ERROR 8  S01117
065700200604     C                     Z-ADD8         DBASE            ***************S01117
065800200604     C                     MOVEL@OPTN     DBOPTN  7                       S01117
065900200604     C                     SETON                       U7U8               S01117
066000200604     C                     EXSR *PSSR                                     S01117
066100200604     C                     ELSE                                           S01117
066200200604     C                     Z-ADDA6NBDP    ZCDPO                           S01117
066300200604     C                     END                                            S01117
066400200604      *
066500200604     C***********          MOVE TRNC      ZCCYI                           E18450
066600200604     C***********          MOVE TRSC      ZCCYO                           E18450
066700200604     C                     MOVE TRSC      ZCCYI                           E18450
066800200604     C                     MOVE TRNC      ZCCYO                           E18450
066900200604     C***********          Z-ADDTCTR      ZAMTCI                          E18450
067000200604     C                     Z-ADDTRVS      ZAMTCI                          E18450
067100200604     C                     Z-ADDTDER      ZEXCH
067200200604     C***********          MOVE TMDI      ZMD                             E18450
067300200604      *
067400200604      **  Multiply/Divide Indicator
067500200604      *
067600200604     C**         TMDI      IFEQ '0'                                E18450 066530
067700200604     C**                   MOVE '1'       ZMD                      E18450 066530
067800200604     C**                   ELSE                                    E18450 066530
067900200604     C**                   MOVE '0'       ZMD                      E18450 066530
068000200604     C**                   END                                     E18450 066530
068100200604      *
068200200604     C           TMDI      IFEQ 'M'                                       066530
068300200604     C                     MOVE 'D'       ZMD                             066530
068400200604     C                     ELSE                                           066530
068500200604     C                     MOVE 'M'       ZMD                             066530
068600200604     C                     END                                            066530
068700200604     C                     EXSR ZCONV
068800200604     C***********          Z-ADDZAMTCO    TRVS                            E18450
068900200604     C                     Z-ADDZAMTCO    TRVN                            E18450
069000200604      ***********                                                         S01117
069100200604      ****Check*for Database Error                                        S01117
069200200604      ***********                                                         S01117
069300200604     C************INU7     IFEQ '1'                                       S01117
069400200604     C***********          MOVE '1'       *IN52                           S01117
069500200604     C***********          MOVE '1'       *INLR            ***************S01117
069600200604     C***********          MOVEL'06'      DBASE            **DB ERROR 06**S01117
069700200604     C***********          MOVEL'ZCONV   'DBFILE           ***************S01117
069800200604     C***********          MOVE '   /   ' #7A     7                       S01117
069900200604     C***********          MOVELTRNC      #7A                             S01117
070000200604     C***********          MOVE TRSC      #7A                             S01117
070100200604     C***********          MOVEL#7A       DBKEY                           S01117
070200200604     C***********          END                                            S01117
070300200604      *
070400200604     C                     END
070500200604     C                     END
070600200604      *
070700200604      *
070800200604     C           *IN40     IFEQ '1'
070900200604     C           TRECI     ANDNE'S'
071000200604     C           TRECI     ANDNE'*'
071100200604     C           TRECI     ANDNE'C'                                       E20125
071200200604     C           *IN52     ANDEQ'0'
071300200604     C           TINC      ANDEQ'C'
071400200604     C           TRECI     ANDNE'L'                                       S01269
071500200604     C           TRECI     ANDNE'P'                                       S01269
071600200604      *
071700200604      **  Set Our Depot to EQ :
071800200604      **     Deliver to depot   , If trade type TP.
071900200604      **     Deliver from depot , If trade type TS.
072000200604      **  If Our Depot equal zero , set to 999999.
072100200604      *
072200200604     C**********           Z-ADD999999    TROD                                                CSD027
072300200604     C                     MOVE '999999'  TROD                                                CSD027
072400200604      *
072500200604      **  To Depot
072600200604     C           TRTT      IFEQ 'TP'
072700200604     C********** DELT      ANDNE0                                                             CSD027
072800200604     C**********           Z-ADDDELT      TROD                                                CSD027
072900200604     C           DELT      ANDNE*BLANKS                                                       CSD027
073000200604     C                     MOVE DELT      TROD                                                CSD027
073100200604     C                     END
073200200604      *
073300200604      **  From Depot
073400200604      *
073500200604     C           TRTT      IFEQ 'TS'
073600200604     C********** DELF      ANDNE0                                                             CSD027
073700200604     C**********           Z-ADDDELF      TROD                                                CSD027
073800200604     C           DELF      ANDNE*BLANKS                                                       CSD027
073900200604     C                     MOVE DELF      TROD                                                CSD027
074000200604     C                     END
074100200604      *
074200200604      **  If value date LT event control date,
074300200604      **   set overdue indicator EQ 'Y'.
074400200604      **  Else
074500200604      **   set Event Code for   TP : 31P1,   TS : 31S1
074600200604      *
074700200604     C                     MOVE ' '       TROI
074800200604     C                     MOVE *BLANKS   TREC
074900200604      *
075000200604     C           TRVD      IFLE ECD
075100200604     C                     MOVE 'Y'       TROI
075200200604     C**********           ELSE                                           E20190
075300200604     C                     END                                            E20190
075400200604      *
075500200604     C           TRTT      IFEQ 'TP'
075600200604     C                     MOVE '31P1'    TREC
075700200604     C                     END
075800200604      *
075900200604     C           TRTT      IFEQ 'TS'
076000200604     C                     MOVE '31S1'    TREC
076100200604     C                     END
076200200604     C**********           END                                            E20190
076300200604      *
076400200604      **  Access the conterparty Client record (LF/CLINT, CLINTSEF).
076500200604      **   If Discrepency indicator 'S', or 'D',
076600200604      **   set Portfolio indicator EQ 'Y'.
076700200604      *
076800200604     C           TRPT      CHAINCLINTSEF             52
076900200604      *
077000200604     C           *IN52     IFEQ '1'
077100200604     C           RECI      ORNE 'D'
077200200604     C                     SETON                     52                   E20581
077300200604     C                     MOVE '1'       *INLR            ***************
077400200604     C***********          MOVEL'01'      DBASE            **DB ERROR 01**S01117
077500200604     C                     Z-ADD1         DBASE            **DB ERROR 01**S01117
077600200604     C                     MOVEL'CLINTSEF'DBFILE           ***************
077700200604     C                     MOVELTRPT      DBKEY
077800200604     C                     SETON                       U7U8               S01117
077900200604     C                     EXSR *PSSR                                     S01117
078000200604     C                     ELSE
078100200604     C                     MOVE ' '       TRPI
078200200604      *
078300200604     C           C1DI      IFEQ 'S'
078400200604     C           C1DI      OREQ 'D'
078500200604     C                     MOVE 'Y'       TRPI
078600200604     C                     END
078700200604      *
078800200604      **  Access the conterparty report details (LF/CLINT, CLINTCBF).
078900200604      **   If Discrepency indicator 'S', or 'D',
079000200604      **   set Portfolio indicator EQ 'Y'.
079100200604      *
079200200604     C           TRPT      CHAINCLINTCBF             52
079300200604     C           *IN52     IFEQ '1'
079400200604     C           RECI      ORNE 'D'
079500200604     C                     SETON                     52                   E20581
079600200604     C                     MOVE '1'       *INLR            ***************
079700200604     C***********          MOVEL'02'      DBASE            **DB ERROR 02**S01117
079800200604     C                     Z-ADD2         DBASE            **DB ERROR 02**S01117
079900200604     C                     MOVEL'CLINTCBF'DBFILE           ***************
080000200604     C                     MOVELTRPT      DBKEY
080100200604     C                     SETON                       U7U8               S01117
080200200604     C                     EXSR *PSSR                                     S01117
080300200604     C                     ELSE
080400200604      *
080500200604      * Set   I/O Indicator        =         O            I
080600200604      *       Settl Account        =      Pay From      Pay To
080700200604      *       Settl Branch         =     From Branch   To Branch
080800200604      *                                  -----------   ---------
080900200604      *  depending on Trade Type   =        TP            TS
081000200604      *
081100200604     C                     MOVE *BLANKS   TRIO
081200200604     C                     MOVE *BLANKS   TRSA
081300200604     C***********          MOVE *BLANKS   TRSB                            S01117
081400200604     C                     MOVE *BLANKS   TRTA                            S01117
081500200604      *
081600200604     C           TRTT      IFEQ 'TP'
081700200604     C                     MOVE 'O'       TRIO
081800200604     C                     MOVE PYFM      TRSA
081900200604     C***********          MOVE PYFB      TRSB                            S01117
082000200604     C           PYFA      IFNE *BLANKS                                   E37370
082100200604     C                     MOVE PYFA      TRTA                            S01117
082200200604     C                     ELSE                                           E37370
082300200604     C                     MOVE TRBA      TRTA                            E37370
082400200604     C                     END                                            E37370
082500200604     C                     END
082600200604      *
082700200604     C           TRTT      IFEQ 'TS'
082800200604     C                     MOVE 'I'       TRIO
082900200604     C                     MOVE PAYT      TRSA
083000200604     C***********          MOVE PYTB      TRSB                            S01117
083100200604     C           PYTA      IFNE *BLANKS                                   E37370
083200200604     C                     MOVE PYTA      TRTA                            S01117
083300200604     C                     ELSE                                           E37370
083400200604     C                     MOVE TRBA      TRTA                            E37370
083500200604     C                     END                                            E37370
083600200604     C                     END
083700200604      *
083800200604     C* Store the settlement A/C and settlement method in temporary       S01117
083900200604     C* fields for later use.                                             S01117
084000200604     C*                                                                   S01117
084100200604     C**********           MOVE TRSA      SETAC  12                                    S01117 CGL029
084200200604     C                     MOVE TRSA      SETAC  18                                           CGL029
084300200604     C                     MOVE SMTH      SETMT   20                      S01117
084400200604     C*                                                                   S01117
084500200604     C                     MOVE *BLANKS   COOB                            S01117
084600200604     C                     MOVE *BLANKS   COBB                            S01117
084700200604     C                     MOVE *BLANKS   COSB    3                       S01117
084800200604     C*                                                                   S01117
084900200604     C*                                                                   S01117
085000200604     C* Obtain Company of Originating Branch via access object            S01117
085100200604     C*                                                                   S01117
085200200604     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
085300200604     C                     CALL 'AOBRCHR1'                                                    CGL029
085400200604     C                     PARM '*MSG   ' @RTCD   7                       S01117
085500200604     C                     PARM '*KEY   ' @OPTN   7                       S01117
085600200604     C                     PARM ORBR      @DSNB   3                       S01117
085700200604     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
085800200604     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
085900200604     C*                                                                   S01117
086000200604     C           @RTCD     IFNE *BLANKS                                   S01117
086100200604     C                     MOVE '1'       *INLR                           S01117
086200200604     C                     MOVEL'SDBRCHPD'DBFILE           ***************S01117
086300200604     C                     MOVEL@OPTN     DBKEY            ** DB ERROR 10 S01117
086400200604     C                     Z-ADD10        DBASE            ***************S01117
086500200604     C                     MOVEL@OPTN     DBOPTN  7                       S01117
086600200604     C                     SETON                       U7U8               S01117
086700200604     C                     EXSR *PSSR                                     S01117
086800200604     C                     ELSE                                           S01117
086900200604     C                     MOVE A8CMCD    COOB                            S01117
087000200604     C                     END                                            S01117
087100200604     C*                                                                   S01117
087200200604     C* Obtain Company of Settlement Branch via access object             S01117
087300200604     C*                                                                   S01117
087400200604     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
087500200604     C                     CALL 'AOBRCHR1'                                                    CGL029
087600200604     C                     PARM '*MSG   ' @RTCD   7                       S01117
087700200604     C                     PARM '*KEY   ' @OPTN   7                       S01117
087800200604     C                     PARM TRTA      @DSNB   3                       S01117
087900200604     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
088000200604     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
088100200604     C*                                                                   S01117
088200200604     C           @RTCD     IFNE *BLANKS                                   S01117
088300200604     C                     MOVE '1'       *INLR                           S01117
088400200604     C                     MOVEL'SDBRCHPD'DBFILE           ***************S01117
088500200604     C                     MOVEL@OPTN     DBKEY            ** DB ERROR 11 S01117
088600200604     C                     Z-ADD11        DBASE            ***************S01117
088700200604     C                     MOVEL@OPTN     DBOPTN  7                       S01117
088800200604     C                     SETON                       U7U8               S01117
088900200604     C                     EXSR *PSSR                                     S01117
089000200604     C                     ELSE                                           S01117
089100200604     C                     MOVE A8CMCD    COSB                            S01117
089200200604     C                     END                                            S01117
089300200604     C*                                                                   S01117
089400200604     C* Obtain Company of Booking Branch via access object                S01117
089500200604     C*                                                                   S01117
089600200604     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
089700200604     C                     CALL 'AOBRCHR1'                                                    CGL029
089800200604     C                     PARM '*MSG   ' @RTCD   7                       S01117
089900200604     C                     PARM '*KEY   ' @OPTN   7                       S01117
090000200604     C                     PARM TRBA      @DSNB   3                       S01117
090100200604     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
090200200604     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
090300200604     C*                                                                   S01117
090400200604     C           @RTCD     IFNE *BLANKS                                   S01117
090500200604     C                     MOVE '1'       *INLR                           S01117
090600200604     C                     MOVEL'SDBRCHPD'DBFILE           ***************S01117
090700200604     C                     MOVEL@OPTN     DBKEY            ** DB ERROR 12 S01117
090800200604     C                     Z-ADD12        DBASE            ***************S01117
090900200604     C                     MOVEL@OPTN     DBOPTN  7                       S01117
091000200604     C                     SETON                       U7U8               S01117
091100200604     C                     EXSR *PSSR                                     S01117
091200200604     C                     ELSE                                           S01117
091300200604     C                     MOVE A8CMCD    COBB                            S01117
091400200604     C                     END                                            S01117
091500200604     C*                                                                   S01117
091600200604     C*                                                                   S01117
091700200604     C                     MOVE SMTH      TRSM                            S01117
091800200604     C***********          MOVE TRBA      EBRC                     S01117 108525
091900200604     C***********          MOVE TRTA      EBRC                     108525 137337
092000200604     C***********          MOVE TRBA      EBRC                     137337 204137
092100200604     C***********          MOVE TRTA      EBRC                                         204137 209234
092200200604     C                     MOVE TRBA      EBRC                                                209234
092300200604     C                     MOVE COBB      ECPY                            S01117
092400200604     C*                                                                   S01117
092500200604     C                     MOVE *BLANKS   EXEI                            S01117
092600200604     C                     MOVE 'B'       ELVB                            S01117
092700200604     C                     MOVE 'C'       ELVC                            S01117
092800200604     C                     MOVE 'S'       ELVS                            S01117
092900200604     C                     MOVE 'N'       IBRE                            S01117
093000200604     C                     MOVE 'Y'       ICYE                            S01117
093100200604     C*                                                                   CAC005
093200200604     C           BGN0ST    IFEQ 'Y'                                       CAC005
093300200604     C                     MOVE BPRC      PRFC                            CAC005
093400200604     C                     ENDIF                                          CAC005
093500200604     C*                                                                   S01117
093600200604     C***********MBIN      IFEQ 'Y'                                S01117 108525
093700200604     C***********TRBA      ANDNETRTA                               S01117 108525
093800200604     C***********          MOVE *BLANKS   TRSA                     S01117 108525
093900200604     C***********          MOVE '00'      TRSM                     S01117 108525
094000200604     C***********          END                                     S01117 108525
094100200604     C********** MBIN      IFEQ 'Y'                                137337 204137
094200200604     C********** TRBA      ANDNETRTA                               137337 204137
094300200604     C**********           MOVE *BLANKS   TRSA                     137337 204137
094400200604     C**********           MOVE '00'      TRSM                     137337 204137
094500200604     C**********           END                                     137337 204137
094600200604     C           MBIN      IFEQ 'Y'                                                           209234
094700200604     C           TRBA      ANDNETRTA                                                          209234
094800200604     C                     MOVE *BLANKS   TRSA                                                209234
094900200604     C                     MOVE '00'      TRSM                                                209234
095000200604     C                     END                                                                209234
095100200604     C*                                                                   S01117
095200200604      **  Accumulate Hash Totals of the Event Amount
095300200604      *
095400200604     C                     Z-ADDTRON      #HAMT
095500200604     C                     Z-ADDTRHRWN    #HRWN
095600200604     C                     Z-ADDTRHRDC    #HRDC
095700200604     C           #HAMT     CASNE0         SRHASH
095800200604     C                     END
095900200604      *
096000200604     C                     Z-ADD#HRWN     TRHRWN
096100200604     C                     Z-ADD#HRDC     TRHRDC
096200200604      *
096300200604      **  Write the Trade Events Record.
096400200604      *
096500200604     C*                                                                   S01408
096600200604     C/COPY WNCPYSRC,SE1400CCP1                                           S01408
096700200604     C*                                                                   S01408
096800200604     C           TRVS      IFGT 0                                         E19101
096900200604     C                     ADD  1         OUTRTR
097000200604     C                     WRITETREVEDF
097100200604     C/COPY WNCPYSRC,SE1400C004
097200200604     C           CER049    IFEQ 'Y'                                                           CER049
097300200604     C                     SETON                     55                                       CER049
097400200604     C                     EXSR SRSTAX                                                        CER049
097500200604     C                     ENDIF                                                              CER049
097600200604     C                     END                                            E19101
097700200604     C*                                                                   S01408
097800200604     C/COPY WNCPYSRC,SE1400CCP2                                           S01408
097900200604     C*                                                                   S01408
098000200604      *
098100200604      **  If counterparty is a Portfolio Customer
098200200604      **  Write A Portfolio Customer Trade Events Record.
098300200604      *
098400200604     C           TRPI      IFEQ 'Y'
098500200604      *
098600200604      **  Set Our Depot to EQ :
098700200604      **     Deliver from depot , If trade type TP.
098800200604      **     Deliver to depot   , If trade type TS.
098900200604      **  If Our Depot equal zero , set to 999999.
099000200604      *
099100200604     C**********           Z-ADD999999    TROD                                                CSD027
099200200604     C                     MOVE '999999'  TROD                                                CSD027
099300200604      *
099400200604      **  From Depot
099500200604      *
099600200604     C           TRTT      IFEQ 'TP'
099700200604     C********** DELF      ANDNE0                                                             CSD027
099800200604     C**********           Z-ADDDELF      TROD                                                CSD027
099900200604     C           DELF      ANDNE*BLANKS                                                       CSD027
100000200604     C                     MOVE DELF      TROD                                                CSD027
100100200604     C                     END
100200200604      *
100300200604      **  To Depot
100400200604      *
100500200604     C           TRTT      IFEQ 'TS'
100600200604     C********** DELT      ANDNE0                                                             CSD027
100700200604     C**********           Z-ADDDELT      TROD                                                CSD027
100800200604     C           DELT      ANDNE*BLANKS                                                       CSD027
100900200604     C                     MOVE DELT      TROD                                                CSD027
101000200604     C                     END
101100200604      *
101200200604     C                     MOVE SETAC     TRSA                            S01117
101300200604     C                     MOVE SETMT     TRSM                            S01117
101400200604      *                                                                   S01117
101500200604      **  Accumulate Hash Totals of the Event Amount
101600200604      *
101700200604     C                     Z-ADDTRON      #HAMT
101800200604     C                     Z-ADDPCHRWN    #HRWN
101900200604     C                     Z-ADDPCHRDC    #HRDC
102000200604     C           #HAMT     CASNE0         SRHASH
102100200604     C                     END
102200200604      *
102300200604     C                     Z-ADD#HRWN     PCHRWN
102400200604     C                     Z-ADD#HRDC     PCHRDC
102500200604      *                                                                   S01496
102600200604      **  Only output Portfolio Reference to file if S01496 is on         S01496
102700200604      **  for use in SE1510                                               S01496
102800200604      *                                                                   S01496
102900200604     C           S01496    IFNE 'Y'                                       S01496
103000200604     C                     MOVE *BLANKS   PTFR                            S01496
103100200604     C                     MOVE *BLANKS   EARL                            S01496
103200200604     C                     END                                            S01496
103300200604     C/COPY WNCPYSRC,SE1400C002
103400200604      *
103500200604      **  Write a Portfolio Customer Trade Events Record.
103600200604      *
103700200604     C           TRVS      IFGT 0                                         E19101
103800200604     C                     ADD  1         OUTRPC
103900200604     C                     WRITEPCTEVDF
104000200604     C           CER049    IFEQ 'Y'                                                           CER049
104100200604     C                     SETOF                     55                                       CER049
104200200604     C                     EXSR SRSTAX                                                        CER049
104300200604     C                     ENDIF                                                              CER049
104400200604     C                     END                                            E19101
104500200604      *
104600200604     C                     END
104700200604     C*                                                                   S01117
104800200604     C* If the event is Inter-branch (ie Event Settlement Branch is       S01117
104900200604     C* not the Trade Booking Branch) then generate two extra events.     S01117
105000200604     C*                                                                   S01117
105100200604     C           MBIN      IFEQ 'Y'                                       S01117
105200200604     C           TRBA      ANDNETRTA                                      S01117
105300200604     C                     MOVE *BLANKS   TRSA                            S01117
105400200604     C                     MOVE '00'      TRSM                            S01117
105500200604     C                     EXSR GENREC                                    S01117
105600200604     C*                                                                   S01117
105700200604     C                     END                                            S01117
105800200604     C*                                                                   S01117
105900200604     C                     END
106000200604     C                     END
106100200604     C                     END
106200200604     C           NEXT      TAG                                                              MD048883
106300200604      *
106400200604      *================================================================
106500200604      *  E N D   O F   P R O G R A M                                  *
106600200604      *                                                               *
106700200604     CLR                   EXSR SRLR
106800200604      *                                                               *
106900200604      *================================================================
107000200604     C********************************************************************S01117
107100200604      /EJECT
107200200604     C********************************************************************S01117
107300200604     C*                                                                   S01117
107400200604     C*  SUBROUTINE GENREC - TO WRITE TWO EXTRA RECORDS ON PF/TREVED      S01117
107500200604     C*                      FOR AN INTER-BRANCH EVENT                    S01117
107600200604     C********************************************************************S01117
107700200604     C*                                                                   S01117
107800200604     C           GENREC    BEGSR                                          S01117
107900200604     C*                                                                   S01117
108000200604     C**   First extra inter-branch event record                          S01117
108100200604     C*                                                                   S01117
108200200604     C                     MOVE TRTA      EBRC                            S01117
108300200604     C                     MOVE COSB      ECPY                            S01117
108400200604     C*                                                                   S01117
108500200604     C           ECPY      IFNE COBB                                      S01117
108600200604     C                     MOVE 'Y'       ICYE                            S01117
108700200604     C                     ELSE                                           S01117
108800200604     C                     MOVE 'N'       ICYE                            S01117
108900200604     C                     END                                            S01117
109000200604     C*                                                                   S01117
109100200604     C           EBRC      IFNE TRBA                                      S01117
109200200604     C                     MOVE 'Y'       IBRE                            S01117
109300200604     C                     ELSE                                           S01117
109400200604     C                     MOVE 'N'       IBRE                            S01117
109500200604     C                     END                                            S01117
109600200604     C*                                                                   S01117
109700200604     C                     MOVE SMTH      TRSM                            S01117
109800200604     C*                                                                   S01117
109900200604     C                     MOVE SETAC     TRSA                            S01117
110000200604     C*                                                                   S01408
110100200604     C/COPY WNCPYSRC,SE1400CCP3                                           S01408
110200200604     C*                                                                   S01408
110300200604     C*                                                                   S01117
110400200604     C           TRVS      IFGT 0                                         S01117
110500200604     C                     ADD  1         OUTRTR                          S01117
110600200604     C                     WRITETREVEDF                                   S01117
110700200604     C/COPY WNCPYSRC,SE1400C005
110800200604     C           CER049    IFEQ 'Y'                                                           CER049
110900200604     C                     SETON                     55                                       CER049
111000200604     C                     EXSR SRSTAX                                                        CER049
111100200604     C                     ENDIF                                                              CER049
111200200604     C                     END                                            S01117
111300200604     C*                                                                   S01408
111400200604     C/COPY WNCPYSRC,SE1400CCP4                                           S01408
111500200604     C*                                                                   S01408
111600200604     C*                                                                   S01117
111700200604     C** Accumulate Hash Totals of the Event Amount                       S01117
111800200604     C*                                                                   S01117
111900200604     C                     Z-ADDTRON      #HAMT                           S01117
112000200604     C                     Z-ADDTRHRWN    #HRWN                           S01117
112100200604     C                     Z-ADDTRHRDC    #HRDC                           S01117
112200200604     C           #HAMT     CASNE0         SRHASH                          S01117
112300200604     C                     END                                            S01117
112400200604     C                     Z-ADD#HRWN     TRHRWN                          S01117
112500200604     C                     Z-ADD#HRDC     TRHRDC                          S01117
112600200604     C*                                                                   S01117
112700200604     C**   Second extra inter-branch event record                         S01117
112800200604     C*                                                                   S01117
112900200604     C           TRIO      IFEQ 'I'                                       S01117
113000200604     C                     MOVE 'O'       TRIO                            S01117
113100200604     C                     ELSE                                           S01117
113200200604     C           TRIO      IFEQ 'O'                                       S01117
113300200604     C                     MOVE 'I'       TRIO                            S01117
113400200604     C                     END                                            S01117
113500200604     C                     END                                            S01117
113600200604     C*                                                                   S01117
113700200604     C           TRTT      IFEQ 'TP'                                      S01117
113800200604     C                     MOVE 'TS'      TRTT                            S01117
113900200604     C                     ELSE                                           S01117
114000200604     C           TRTT      IFEQ 'TS'                                      S01117
114100200604     C                     MOVE 'TP'      TRTT                            S01117
114200200604     C                     END                                            S01117
114300200604     C                     END                                            S01117
114400200604     C*                                                                   S01117
114500200604     C                     MOVE A8BICN    TRPT                            S01117
114600200604     C                     MOVE *BLANKS   TRSA                            S01117
114700200604     C                     MOVE '00'      TRSM                            S01117
114800200604     C*                                                                   S01408
114900200604     C/COPY WNCPYSRC,SE1400CCP5                                           S01408
115000200604     C*                                                                   S01408
115100200604     C*                                                                   S01117
115200200604     C           TRVS      IFGT 0                                         S01117
115300200604     C                     ADD  1         OUTRTR                          S01117
115400200604     C                     WRITETREVEDF                                   S01117
115500200604     C/COPY WNCPYSRC,SE1400C006
115600200604     C           CER049    IFEQ 'Y'                                                           CER049
115700200604     C                     SETON                     55                                       CER049
115800200604     C                     EXSR SRSTAX                                                        CER049
115900200604     C                     ENDIF                                                              CER049
116000200604     C                     END                                            S01117
116100200604     C*                                                                   S01408
116200200604     C/COPY WNCPYSRC,SE1400CCP6                                           S01408
116300200604     C*                                                                   S01408
116400200604     C*                                                                   S01117
116500200604      * Accumulate Hash Totals of the Event Amount                        S01117
116600200604     C                     Z-ADDTRON      #HAMT                           S01117
116700200604     C                     Z-ADDTRHRWN    #HRWN                           S01117
116800200604     C                     Z-ADDTRHRDC    #HRDC                           S01117
116900200604     C           #HAMT     CASNE0         SRHASH                          S01117
117000200604     C                     END                                            S01117
117100200604     C                     Z-ADD#HRWN     TRHRWN                          S01117
117200200604     C                     Z-ADD#HRDC     TRHRDC                          S01117
117300200604     C*                                                                   S01117
117400200604     C*                                                                   S01117
117500200604     C                     ENDSR                                          S01117
117600200604     C********************************************************************S01117
117700200604      /EJECT
117800200604      *****************************************************************
117900200604      *                                                               *
118000200604      *  SRHASH - Subroutine to add Event Amounts to Hash Totals      *
118100200604      *           (Determine Dec. Posn. and ADD as Positive Values)   *
118200200604      *                                                               *
118300200604      *       Input   #HAMT (15/0)   Un-edited Amount                 *
118400200604      *       Output  #HRWN (15/0)   Whole Numbers                    *
118500200604      *               #HRDC  (3/0)   Decimal Places                   *
118600200604      *                                                               *
118700200604      *****************************************************************
118800200604      *
118900200604     C           SRHASH    BEGSR                           *** SRHASH ***
119000200604      *
119100200604      **  Set up fields to be hashed as positive
119200200604      *
119300200604     C           #HAMT     IFGE 0
119400200604     C                     Z-ADD#HAMT     #HAMT  150
119500200604     C                     ELSE
119600200604     C                     Z-SUB#HAMT     #HAMT
119700200604     C                     END
119800200604      *
119900200604      **  Split up the hash amount as  Integer and Decimal parts
120000200604      *
120100200604     C                     MOVEL#HAMT     #HI    120
120200200604     C                     MOVE #HAMT     #HD     30
120300200604      *
120400200604      **  Add to the DECIMAL HASH TOTAL part and check for carry
120500200604      *
120600200604     C                     ADD  #HD       #HRDC   30
120700200604      *
120800200604     C           #HRDC     IFLT #HD
120900200604     C                     ADD  1         #HI
121000200604     C                     END
121100200604      *
121200200604      **  Add to the INTEGER HASH TOTAL part
121300200604      *
121400200604     C                     ADD  #HI       #HRWN  150
121500200604      *
121600200604     C                     ENDSR
121700200604      *
121800200604      *****************************************************************
121900200604      /EJECT
122000200604      *****************************************************************
122100200604      *                                                               *
122200200604      *  SRLR   - End of Program Control Processing.                  *
122300200604      *                                                               *
122400200604      *****************************************************************
122500200604      *
122600200604     C           SRLR      BEGSR
122700200604      *
122800200604      **  If no records read - Empty Primary File,
122900200604      ***access*the*I.C.D.*records*1*(PF/TABTB10)*************************S01117
123000200604      *  in the DTAARA/RUNDAT and get title by access object              S01117
123100200604      *
123200200604     C           *IN40     IFEQ '0'
123300200604     C           @RTCD     ANDEQ*BLANKS                                   S01117
123400200604     C************IN99*****ANDEQ'0'                                       S01117
123500200604     C***********          EXSR ZSYSTM                                    S01117
123600200604     C*                                                                   S01117
123700200604     C**   IN THE DATAAREA RUNDAT                                         S01117
123800200604     C*                                                                   S01117
123900200604     C                     IN   RUNDT                                     S01117
124000200604     C**                                                                  S01117
124100200604     C**   CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.                    S01117
124200200604     C**                                                                  S01117
124300200604     C           DATF      COMP 'M'                      98               S01117
124400200604     C*                                                                   S01117
124500200604     C*                                                                   S01117
124600200604     C* Get Bank Title by access object                                   S01117
124700200604     C*                                                                   S01117
124800200604     C                     CALL 'AOBANKR0'                                S01117
124900200604     C                     PARM '*MSG   ' @RTCD   7                       S01117
125000200604     C                     PARM '*FIRST ' @OPTN   7                       S01117
125100200604     C           SDBANK    PARM SDBANK    DSFDY                           S01117
125200200604     C*                                                                   S01117
125300200604     C           @RTCD     IFNE *BLANKS                                   S01117
125400200604     C                     MOVEL'SDBANKPD'DBFILE           ***************S01117
125500200604     C                     MOVEL@OPTN     DBKEY            ** DB ERROR 9  S01117
125600200604     C                     Z-ADD9         DBASE            ***************S01117
125700200604     C                     MOVEL@OPTN     DBOPTN  7                       S01117
125800200604     C                     SETON                       U7U8               S01117
125900200604     C                     EXSR *PSSR                                     S01117
126000200604     C                     END                                            S01117
126100200604     C                     END
126200200604      *
126300200604      **  Write control report headings
126400200604      *
126500200604     C                     WRITEHEADAU
126600200604      *
126700200604      **  Errors
126800200604      *
126900200604     C************IN99     IFEQ '1'                                       S01117
127000200604     C************IN52     OREQ '1'                                       S01117
127100200604     C***********          MOVE '1'       *INU8                           S01117
127200200604     C***********          MOVE '1'       *INU7                           S01117
127300200604      **ICD*1/2***********************************************************S01117
127400200604     C************IN52     IFEQ '0'                        ***************S01117
127500200604     C***********          MOVEL'03'      DBASE            **DB ERROR 03**S01117
127600200604     C***********          MOVEL'TABLE'   DBFILE           ***************S01117
127700200604     C***********          MOVELZTABKY    DBKEY                           S01117
127800200604     C***********          END                                            S01117
127900200604      **ICD*2*************************************************************S01117
128000200604     C************IN51     IFEQ '1'                        ***************S01117
128100200604     C***********          MOVEL'04'      DBASE            **DB ERROR 04**S01117
128200200604     C***********          END                             ***************S01117
128300200604     C           *INU7     IFEQ '1'                                       S01117
128400200604     C           *INU8     ANDEQ'1'                                       S01117
128500200604     C                     WRITEERROR
128600200604      *
128700200604     C                     END
128800200604      *
128900200604      **  Access Trade's AUDIT record.
129000200604      *
129100200604     C                     Z-ADD0         TRIN
129200200604     C                     READ TRADSA                   50
129300200604      *
129400200604      **  Compare Control Totals
129500200604      *
129600200604     C                     WRITETRTOT
129700200604      *
129800200604      **  Trade Records' Totals
129900200604      *
130000200604     C           TRIN      IFNE TRCNT
130100200604     C           *INU7     IFEQ '0'                                       S01117
130200200604     C                     WRITEDIFF
130300200604     C                     END                                            S01117
130400200604     C           *INU8     IFEQ '0'
130500200604     C                     MOVE '1'       *INU8            ***************
130600200604     C***********          MOVEL'05'      DBASE            **DB ERROR 05**S01117
130700200604     C***********          MOVEL'TRADSA  'DBFILE           ***************S01117
130800200604     C***********          MOVEL'*AUDIT**'DBKEY                           S01117
130900200604     C***********          WRITEERROR                                     S01117
131000200604      *
131100200604     C                     END
131200200604     C                     END
131300200604      *
131400200604      **  Write Trade Events Audit record
131500200604      *
131600200604     C                     Z-ADDOUTRTR    NORE
131700200604     C                     Z-ADDTRHRWN    HRWN
131800200604     C                     Z-ADDTRHRDC    HRDC
131900200604     C                     WRITETREVEAF
132000200604      *
132100200604      **  Write Portfolio Customer Trade Events Audit record
132200200604      *
132300200604     C                     Z-ADDOUTRPC    NORE
132400200604     C                     Z-ADDPCHRWN    HRWN
132500200604     C                     Z-ADDPCHRDC    HRDC
132600200604     C                     WRITEPCTEVAF
132700200604      *
132800200604     C***IF*NO*OUTPUT*-*Print*a*message*to*this*effect********************S01117
132900200604     C************IN40     IFEQ '0'                                       S01117
133000200604     C***********          WRITENONE                                      S01117
133100200604      ***********                                                         S01117
133200200604     C*********ELSE***-*Print Records*Written*Total***********************S01117
133300200604     C***********          ELSE                                           S01117
133400200604     C                     WRITECONTROL
133500200604     C***********          END                                            S01117
133600200604      *
133700200604      **  END OF PROGRAM
133800200604      *
133900200604     C***********          WRITETRAILAU                                   S01117
134000200604      *
134100200604      **  If Database Erorrs found, update LDA
134200200604      *
134300200604     C           *NAMVAR   DEFN           LDA
134400200604     C           *INU8     IFEQ '1'
134500200604     C           *LOCK     IN   LDA
134600200604     C                     MOVELDBLOT     #DBLOT
134700200604     C                     OUT  LDA
134800200604     C                     END
134900200604      *
135000200604     C                     ENDSR
135100200604     C*
135200200604      *****************************************************************                       CER049
135300200604      *                                                               *                       CER049
135400200604      *  SRSTAX - Generate Stamp tax event type 49ST                  *                       CER049
135500200604      *                                                               *                       CER049
135600200604      *****************************************************************                       CER049
135700200604      *                                                                                       CER049
135800200604     C           SRSTAX    BEGSR                                                              CER049
135900200604      *                                                                                       CER049
136000200604     C           TQTAX     IFEQ 'Y'                                                           CER049
136100200604      *                                                                                       CER049
136200200604     C           TRTT      IFEQ 'TP'                                                          CER049
136300200604     C           TREC      ANDEQ'31P1'                                                        CER049
136400200604     C           TRTT      OREQ 'TS'                                                          CER049
136500200604     C           TREC      ANDEQ'31S1'                                                        CER049
136600200604     C                     MOVE TREC      STREC   4                                           CER049
136700200604     C                     MOVE TRIO      STRIO   1                                           CER049
136800200604     C                     MOVE TRON      STRON  110                                          CER049
136900200604     C                     MOVE '49ST'    TREC                                                CER049
137000200604     C                     MOVE 'O'       TRIO                                                CER049
137100200604     C                     MOVE TQSTAF    TRON                                                CER049
137200200604     C           *IN55     IFEQ *ON                                                           CER049
137300200604     C                     WRITETREVEDF                                                       CER049
137400200604     C                     ELSE                                                               CER049
137500200604     C                     WRITEPCTEVDF                                                       CER049
137600200604     C                     ENDIF                                                              CER049
137700200604      *                                                                                       CER049
137800200604      **  Accumulate Hash Totals of the Event Amount                                          CER049
137900200604      *                                                                                       CER049
138000200604     C                     Z-ADDTRON      #HAMT                                               CER049
138100200604      *                                                                                       CER049
138200200604     C           *IN55     IFEQ *ON                                                           CER049
138300200604     C                     ADD  1         OUTRTR                                              CER049
138400200604     C                     Z-ADDTRHRWN    #HRWN                                               CER049
138500200604     C                     Z-ADDTRHRDC    #HRDC                                               CER049
138600200604     C           #HAMT     CASNE0         SRHASH                                              CER049
138700200604     C                     END                                                                CER049
138800200604     C                     Z-ADD#HRWN     TRHRWN                                              CER049
138900200604     C                     Z-ADD#HRDC     TRHRDC                                              CER049
139000200604     C                     ELSE                                                               CER049
139100200604     C                     ADD  1         OUTRPC                                              CER049
139200200604     C                     Z-ADDPCHRWN    #HRWN                                               CER049
139300200604     C                     Z-ADDPCHRDC    #HRDC                                               CER049
139400200604     C           #HAMT     CASNE0         SRHASH                                              CER049
139500200604     C                     END                                                                CER049
139600200604     C                     Z-ADD#HRWN     PCHRWN                                              CER049
139700200604     C                     Z-ADD#HRDC     PCHRDC                                              CER049
139800200604     C                     ENDIF                                                              CER049
139900200604      *                                                                                       CER049
140000200604     C                     MOVE STREC     TREC                                                CER049
140100200604     C                     MOVE STRIO     TRIO                                                CER049
140200200604     C                     MOVE STRON     TRON                                                CER049
140300200604     C                     ENDIF                                                              CER049
140400200604      *                                                                                       CER049
140500200604     C                     ENDIF                                                              CER049
140600200604     C                     ENDSR                                                              CER049
140700200604      *                                                                                       CER049
140800200604     C*****************************************************************
140900200604      /EJECT
141000200604     C********************************************************************S01117
141100200604     C*                                                                   S01117
141200200604     C* *PSSR - SUBROUTINE TO HANDLE ABNORMAL ERROR CONDITIONS            S01117
141300200604     C*                                                                   S01117
141400200604     C* CALLED FROM : AFTER ABNORMAL OPERATION OCCURS                     S01117
141500200604     C*                                                                   S01117
141600200604     C* CALLS : NOTHING                                                   S01117
141700200604     C*                                                                   S01117
141800200604     C           *PSSR     BEGSR                           ** *PSSR **    S01117
141900200604     C*                                                                   S01117
142000200604     C           @RUN      IFEQ *BLANKS                                   S01117
142100200604     C                     MOVE 'Y'       @RUN    1                       S01117
142200200604     C                     DUMP                                           S01117
142300200604     C                     END                                            S01117
142400200604     C*                                                                   S01117
142500200604     C                     ENDSR                                          S01117
142600200604     C********************************************************************S01117
142700200604     C*                                                                   S01408
142800200604     C/COPY WNCPYSRC,SE1400CCP7                                           S01408
142900200604     C*                                                                   S01408
143000200604      /EJECT
143100200604     C/COPY ZSRSRC,ZCONVZ1
143200200604      /EJECT
143300200604     C/COPY ZSRSRC,ZEVCDZ1
143400200604      /EJECT
143500200604     C*/COPY*ZSRSRC,ZICD2Z1***********                                    S01117
143600200604      /EJECT
143700200604     C*COPY*ZSRSRC,ZSYSTMZ1**                                             S01117
143800200604      /EJECT
143900200604      ***
144000200604**  CPY@
144100200604(c) Finastra International Limited 2001
144200200604**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
1443002006040000001
1444002006040000010
1445002006040000100
1446002006040001000
1447002006040010000
1448002006040100000
1449002006041000000
