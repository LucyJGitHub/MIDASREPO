000100200529     H        1                                                           SE1550
000200200529      *****************************************************************
000300200529/*STD *  RPGBASE                                                      *
000400200529/*EXI *  TEXT('Midas SE Create Shadow Postings')
000500200529      *****************************************************************
000600200529      *                                                               *
000700200529      *  Midas- Securities Trading Module
000800200529      *                                                               *
000900200529      *  SE1550 - CREATE SHADOW POSTINGS                              *
001000200529      *                                                               *
001100200529      *  Function: Trade and Depot Position Events are used to create *
001200200529      *   (COB)    Shadow Postings for all Settlements due across     *
001300200529      *            Retail Accounts up to and including Date of Next   *
001400200529      *            Working Day.                                       *
001500200529      *                                                               *
001600200529      *  Called by: SEC0102 - Create Shadow Postings                  *
001700200529      *                                                               *
001800200529      *  (c) Finastra International Limited 2001                      *
001900200529      *      1988, 1991.                                              *
002000200529      *                                                               *
002100200604      *  Last Amend No. 258879             Date 22May20               *
002200200604      *  PREV Amend No. 249578             Date 22May20               *
002300200604      *                 MD046248           Date 27Oct17               *
002400200529      * Bank Fusion Midas 1.4 Base -----------------------------------*
002500200529      * Midas Plus 1.4 Base 04 ---------------------------------------*
002600200529      *                 CRE026             Date 24May06               *
002700200529      * Midas Plus 1.3 ----------- Base ------------------------------*
002800200529      *                 CSD027             Date 09Dec05               *
002900200529      *                 CSW037A            Date 02May05               *
003000200529      *                 CSD025             Date 11Jan05               *
003100200529      *                 CSW037             Date 15Dec04               *
003200200529      *                 CSW036             Date 15Dec04               *
003300200529      *                 CGL029             Date 01Sep03               *
003400200529      *                 CGL020             Date 12Dec02               *
003500200529      *                 CRE009             Date 27Aug02               *
003600200529      * Midas Release 4.01 -------------------------------------------*
003700200529      *                 201149             Date 31Jan02               *
003800200529      * Midas Release 4 --------------- Base -------------------------*
003900200529      * Midas DBA 3.05 -----------------------------------------------*
004000200529      *                 132257             Date 28Dec00               *
004100200529      * Midas DBA 3.01 -----------------------------------------------*
004200200529      *                 CGL007             Date 26Mar99               *
004300200529      * Midas DBA 3.00 ---------------- Base -------------------------*
004400200529      *                 091969             Date 20Aug96               *
004500200529      *                 071134             Date 25Jul96               *
004600200529      *                 088755             DATE 18JUL96               *
004700200529      *                 086485             DATE 21APR95               *
004800200529      *                 S01510             DATE 30SEP94               *
004900200529      *                 S01502             DATE 08JUL94               *
005000200529      *                 061659             DATE 04AUG94               *
005100200529      *                 S01448             DATE 22DEC93               *
005200200529      *                 S01455             DATE 05NOV93               *
005300200529      *                 052254             DATE 10JAN94               *
005400200529      *                 S10736             DATE 03SEP92               *
005500200529      *                 E29170             DATE 05NOV91               *
005600200529      *                 S01117             DATE 29JUL91               *
005700200529      *                 S01269             DATE 02AUG90               *
005800200529      *                 E21675             DATE 17MAY90               *
005900200529      *                 S01182             DATE 09APR90               *
006000200529      *                 E20651             DATE 30JAN90               *
006100200529      *                 S01154             DATE 06/04/89              *
006200200529      *                                                               *
006300200529      *---------------------------------------------------------------*
006400200529      *                                                               *
006500200529      *  258879 - Duplicate projected a/c movements for TS generated  *
006600200529      *           in COB. Applied fixes 255167 and 252669.            *
006700200529      *  249578 - Position settlements.  Applied 234878.              *
006800200529      *  MD046248 - Finastra Rebranding                               *
006900200529      *  CRE026 - Consumer Banking (Recompile)                        *
007000200529      *  CSD027 - Conversion Of Customer Number to Alpha              *
007100200529      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
007200200529      *  CSD025 - Customer De-Activation                              *
007300200529      *  CSW037 - Additional Field Data on MT300/MT320                *
007400200529      *  CSW036 - Dual SWIFT BIC held on Client Details               *
007500200529      *  CGL029 - Increase Account Code to 10 digits                  *
007600200529      *  CGL020 - Midas Compliance Watch - Additional A/C Postings    *
007700200529      *           Information (Recompile)                             *
007800200529      *  CRE009 - Projected Account Movements for Retail Accounts     *
007900200529      *  201149 - Expected trade settlement (retail) projections were *
008000200529      *           not generated on the account movements. Removed the *
008100200529      *           condition introduced by S01448. Applied fix 143302. *
008200200529      *  132257 - Problem when value date falls on a non working day  *
008300200529      *  CGL007 - Account Postings Enquiry.  Recompile.               *
008400200529      *  091969 - When looking for a/c for settlement, program should *
008500200529      *           use the branch code from the settlement. Otherwise  *
008600200529      *           it may cause DBERROR 004.                           *
008700200529      *  071134 - MEMOS is being updated incorrectly in RE0672 due    *
008800200529      *           to incorrect setting of DRCR on GESTMPD; set        *
008900200529      *           according to value of incoming/outgoing ind.        *
009000200529      *           instead of trade type/event type and sign of amount *
009100200529      *           (NB. amount is always positive).                    *
009200200529      *  088755 - Should only check Profit Centres Position file if   *
009300200529      *           profit centres are used                             *
009400200529      *  086485 - Access settlement account with settl. branch        *
009500200529      *           + review db key length                              *
009600200529      *  S01510 - Set value date = payment date if payment date is    *
009700200529      *           not the same date as event date                     *
009800200529      *  S01502 - BLI Telekurs Processing.  Recompiled due to change  *
009900200529      *           in length of SESTAT, 133 long.                      *
010000200529      *  061659 - Amend to update shadow balances if settlement is    *
010100200529      *           via a nostro that is a retail account.              *
010200200529      *  S01448 - BULK INPUT ENHANCEMENTS                             *
010300200529      *           As an adjunct to the fixes introduced into Bulk and *
010400200529      *           Trades Input, Shadow Postings has been amended:     *
010500200529      *           Only if trade date A/C Keys are being suppressed    *
010600200529      *           should shadow posting be generated.  Otherwise this *
010700200529      *           amount will already have been accounted for.        *
010800200529      *  S01455 - 'FF' ACCOUNT KEY ENHANCEMENTS.                      *
010900200529      *           Recompiled due to changes in PF/TABTB80.            *
011000200529      *  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
011100200529      *           to 10,9                                             *
011200200529      *  S10736 - RECOMPILE FOR MANAGEMENT ACCOUNTING                 *
011300200529      *  E29170 - Report Control Facility changes                     *
011400200529      *  S01117 - Multibranching (Rel 10.0)                           *
011500200529      *  S01269 - Trade authorisation: recompiled over changed        *
011600200529      *           file TABICD.                                        *
011700200529      *  E21675 - Check SESTAT for PFPL = 'Y' before CHAIN to CPEVEA, *   E21675
011800200529      *           else DB Error 6 occurs if no Portfolio Customers.   *   E21675
011900200529      *  S01182 - Recompiled in order to take into account amended    *   S01182
012000200529      *           format on PF/GESTMPD (changed for MIS).             *   S01182
012100200529      *  E20651 - DB Error Numbers used in more than one place.       *   E20651
012200200529      *           New Error Numbers as follows:                       *   E20651
012300200529      *           DB ERROR 01 -> 08                                   *   E20651
012400200529      *           DB ERROR 01 -> 09                                   *   E20651
012500200529      *           DB ERROR 03 -> 10                                   *   E20651
012600200529      *           DB ERROR 03 -> 11                                   *   E20651
012700200529      *  S01154 - ADDITION OF REAL TIME STATEMENTS                    *   S01154
012800200529      *                                                               *
012900200529      *****************************************************************
013000200529      *
013100200529     FSETEV   IP  E           K        DISK
013200200529     FTREVEA  IF  E                    DISK
013300200529     FCPEVEA  IF  E                    DISK
013400200529     FDPEVEA  IF  E                    DISK
013500200529     FSEPCCD  IF  E           K        DISK                               S01117
013600200529     FACNUM   IF  E           K        DISK
013700200529     F            ACCNTABF                          KRENAMEACNUMF
013800200529     FACCNT   IF  E           K        DISK
013900200529     F            ACCNTAAF                          KIGNORE
014000200529     F            ACCNTACF                          KIGNORE
014100200529     FTABICD  IF  E           K        DISK
014200200529     F            TABLETAF                          KIGNORE
014300200529     F* ICD       TABTB10F                          KIGNORE
014400200529     F* ICD 2     TABTB11F                          KIGNORE
014500200529     F            TABTB20F                          KIGNORE
014600200529     F            TABTB30F                          KIGNORE
014700200529     F            TABTB35F                          KIGNORE
014800200529     F************TABTB36F                          KIGNORE               S01154
014900200529     F            TABTB40F                          KIGNORE
015000200529     F            TABTB50F                          KIGNORE
015100200529     F            TABTB55F                          KIGNORE
015200200529     F            TABTB95F                          KIGNORE
015300200529     F            TABTE10F                          KIGNORE
015400200529     F            TABTE20F                          KIGNORE
015500200529     F            TABTG10F                          KIGNORE
015600200529     F            TABTG20F                          KIGNORE
015700200529     F            TABLETHF                          KIGNORE
015800200529     F            TABLETRF                          KIGNORE
015900200529     F            TABLETXF                          KIGNORE
016000200529     F            TABLET5F                          KIGNORE
016100200529     FSDNOSTL1IF  E           K        DISK                               061659
016200200529     F/COPY WNCPYSRC,SE1550F001
016300200529     FGESTMHH O   E                    DISK                      A
016400200529     FGESTMPD O   E                    DISK                      A
016500200529     FGESTMZZ O   E                    DISK                      A
016600200529     F/COPY WNCPYSRC,SE1550F002
016700200529     FSE1550AUO   E                    PRINTER
016800200529      /EJECT
016900200529     F*****************************************************************
017000200529     F*                                                               *
017100200529     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
017200200529     F*                                                               *
017300200529     F*   01  - Trade event record                                    *
017400200529     F*   02  - Customer event record                                 *
017500200529     F*   03  - Depot event record                                    *
017600200529     F*   33  - General work indicator                                *
017700200529     F*   50  - Processing required                                   *
017800200529     F*   69  - Used to Control first cycle processing                *
017900200529     F*   71  - Trade event difference on audit report                *
018000200529     F*   72  - Customer position event difference on audit report    *
018100200529     F*   73  - Depot position event difference on audit report       *
018200200529     F*                                                               *
018300200529     F* 90-99 - Used in Standard Subroutines                          *
018400200529     F*                                                               *
018500200529     F*   U7  - Database Error                                        *
018600200529     F*   U8  - Database / Control Error                              *
018700200529     F*                                                               *
018800200529     F*****************************************************************
018900200529      /SPACE 3
019000200529     F*****************************************************************
019100200529     F*                                                               *
019200200529     F*  S U B R O U T I N E   I N D E X                              *
019300200529     F*                                                               *
019400200529     F*  SHDPST - Output shadow posting records                       *
019500200529     F*                                                               *
019600200529     F*  ZHASH  - Calculate hash value for run control                *
019700200529     F*  ZICD2  - Access ICD record 2                                 *
019800200529     F*  ZICDSE - Access ICD record 3 for securities trading          *   S01154
019900200529     F*  ZSYSTM - Access ICD record                                   *
020000200529     F*                                                               *
020100200529     F*****************************************************************
020200200529      /EJECT
020300200529     E                    CPY@    1   1 80                                S01117
020400200529     E/COPY ZSRSRC,ZHASHZ1
020500200529      /EJECT
020600200529     ITREVEDF     01
020700200529     I              PRFC                            TRPRFC                S01117
020800200529     I*                                                                   S01117
020900200529     I**  PRFC renamed to avoid overwriting with field on ACCNT           S01117
021000200529     I*                                                                   S01117
021100200529     ICPEVEDF     02
021200200529     I              RECI                            EVRECI                                    249578
021300200529     I              CPYD                            CCPD                  S01510
021400200529     IDPEVEDF     03
021500200529     I              RECI                            EVRECI                                    249578
021600200529     ILDA         DS                            256                       S01117
021700200529     I*                                                                   S01117
021800200529     I**  Local Data Area for Database Error Reporting                    S01117
021900200529     I*                                                                   S01117
022000200529     I                                      134 183 DBLOT                 S01117
022100200529     I                                      134 141 DBFILE                S01117
022200200529     I                                      142 170 DBKEY                 S01117
022300200529     I                                      171 180 DBPGM                 S01117
022400200529     I                                      181 1830DBASE                 S01117
022500200529     I***********LDA        UDS                            256            S01117
022600200529     I***********                           134 177 DBLOT                 S01117
022700200529     I***********                           134 138 DBFILE                S01117
022800200529     I***********                           139 167 DBKEY                 S01117
022900200529     I***********                           168 175 DBPGM                 S01117
023000200529     I***********                           176 177 DBASE                 S01117
023100200529     I*
023200200529     I            DS
023300200529     I************                            1  15 ACKYDS                086485
023400200529     I**********                              1  18 ACKYDS                             086485 CGL029
023500200529     I                                        1  24 ACKYDS                                    CGL029
023600200529     I**********                              1   60CNUM                                      CSD027
023700200529     I                                        1   6 CNUM                                      CSD027
023800200529     I                                        7   9 CCY
023900200529     I**********                             10  130ACOD                                      CGL029
024000200529     I**********                             14  150ACSQ                                      CGL029
024100200529     I**********                             16  18 BRCA                               S01117 CGL029
024200200529     I                                       10  190ACOD                                      CGL029
024300200529     I                                       20  210ACSQ                                      CGL029
024400200529     I                                       22  24 BRCA                                      CGL029
024500200529     IKSEPCR      DS                                                      S01117
024600200529     I*                                                                   S01117
024700200529     I* Customer Position Profit Centres PF/SEPCCD                        S01117
024800200529     I*                                                                   S01117
024900200529     I**********                              1   60CCCN                               S01117 CSD027
025000200529     I                                        1   6 CCCN                                      CSD027
025100200529     I                                        7   9 CCBA                  S01117
025200200529     I                                       10  19 CCSS                  S01117
025300200529     I*                                                                   E21675
025400200529     I* DATA STRUCTURE FOR SESTAT                                         E21675
025500200529     I*                                                                   E21675
025600200529     ISESTAT    E DS                                                      E21675
025700200529     I*
025800200529     ICPYR@#      DS                                                      S01117
025900200529     I*                                                                   S01117
026000200529     I*  Data structure for compilation - copyright insertion             S01117
026100200529     I*                                                                   S01117
026200200529     I                                        1  80 CPY@                  S01117
026300200529     I                                        1  20 CPY@##                S01117
026400200529     I/COPY ZSRSRC,ZHASHZ2
026500200529     ISDGELR    E DSSDGELRPD                                              088755
026600200529     I** DUMMY RECORD FORMATS FOR ACCESS TO GENERAL LEDGER DETAILS        088755
026700200529     I*                                                                   088755
026800200529     ISCSARD    E DSSCSARDPD                                              CRE009
026900200529     I** DUMMY RECORD FORMATS FOR ACCESS TO SAR DETAILS                   CRE009
027000200529     I*                                                                   CRE009
027100200529     IREPMED      DS                              5                       CRE009
027200200529     I*                                                                   CRE009
027300200529     IDSFDY     E DSDSFDY                                                 088755
027400200529     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                088755
027500200529     I*                                                                   088755
027600200529     I/COPY WNCPYSRC,SE1550I001
027700200529      *                                                                                       CGL029
027800200529     IDSSDY     E DSDSSDY                                                                     CGL029
027900200529      *                                                                                       CGL029
028000200529     C/EJECT
028100200529     C*                                                                   S01117
028200200529     C* Customer Position Profit Centres PF/SEPCCD                        S01117
028300200529     C*                                                                   S01117
028400200529     C           KSEPCC    KLIST                                          S01117
028500200529     C                     KFLD           CCCN                            S01117
028600200529     C                     KFLD           CCBA                            S01117
028700200529     C                     KFLD           CCSS                            S01117
028800200529     C*                                                                   S01117
028900200529     C/COPY WNCPYSRC,SE1550C001
029000200529     C*================================================================
029100200529     C*  P R O G R A M     S T A R T                                  *
029200200529     C*================================================================
029300200529     C*
029400200529     C           *IN69     IFEQ '0'
029500200529     C*
029600200529     C* Prepare LDA
029700200529     C*
029800200529     C           *NAMVAR   DEFN           LDA                             S01117
029900200529     C           *LOCK     IN   LDA                                       S01117
030000200529     C                     MOVE *BLANKS   DBLOT
030100200529     C                     MOVE 'SE1550  'DBPGM
030200200529     C                     OUT  LDA                                       S01117
030300200529     C*
030400200529      ** Determine if feature CRE009 is installed.                        CRE009
030500200529      *                                                                   CRE009
030600200529     C           *NAMVAR   DEFN           REPMED                          CRE009
030700200529     C           *LOCK     IN   REPMED                                    CRE009
030800200529     C                     MOVE REPMED    WDATE   50                      CRE009
030900200529     C                     OUT  REPMED                                    CRE009
031000200529     C                     MOVE 'N'       CRE009  1                       CRE009
031100200529      *                                                                   CRE009
031200200529     C                     CALL 'AOSARDR0'                                CRE009
031300200529     C                     PARM '       ' @RTCD                           CRE009
031400200529     C                     PARM '*VERIFY' @OPTN                           CRE009
031500200529     C                     PARM 'CRE009'  @KEY   29                       CRE009
031600200529     C           SCSARD    PARM SCSARD    DSFDY                           CRE009
031700200529      *                                                                   CRE009
031800200529     C           @RTCD     IFNE *BLANKS                                   CRE009
031900200529     C           @RTCD     ANDNE'*NRF   '                                 CRE009
032000200529     C                     MOVEL'SCSARDPD'DBFILE           ************   CRE009
032100200529     C                     MOVEL'CRE009'  DBKEY            * DBERR 09 *   CRE009
032200200529     C                     MOVEL'009'     DBASE            ************   CRE009
032300200529     C                     MOVE *ON       *INU7                           CRE009
032400200529     C                     MOVE *ON       *INU8                           CRE009
032500200529     C                     MOVE *ON       *INLR                           CRE009
032600200529     C                     EXSR *PSSR                                     CRE009
032700200529     C                     ENDIF                                          CRE009
032800200529      *                                                                   CRE009
032900200529     C           @RTCD     IFEQ *BLANKS                                   CRE009
033000200529     C                     MOVE 'Y'       CRE009                          CRE009
033100200529     C                     ENDIF                                          CRE009
033200200529      *
033300200529     C*
033400200529     C* Get Installation Control Data record 1
033500200529     C*
033600200529     C                     EXSR ZSYSTM
033700200529     C*
033800200529     C* If error in ZSYSTM, abend program
033900200529     C*
034000200529     C           *IN99     IFEQ '1'                        ***************
034100200529     C           *LOCK     IN   LDA                        **           **S01117
034200200529     C***********          MOVE '01'      DBASE            **DB*ERROR*01**E20651
034300200529     C***********          MOVE '08'      DBASE     **DB*ERROR*08**E20651 S01117
034400200529     C                     Z-ADD08        DBASE            **DB ERROR 08**S01117
034500200529     C                     MOVEL'TABLE'   DBFILE           ***************
034600200529     C                     MOVELZTABKY    DBKEY
034700200529     C                     WRITEHEADAU
034800200529     C                     WRITEERROR
034900200529     C***********          WRITETRAILAU                                   E29170
035000200529     C                     SETON                     U7U8LR
035100200529     C                     OUT  LDA                                       S01117
035200200529     C                     EXSR *PSSR                                     S01117
035300200529     C                     RETRN
035400200529     C                     END
035500200529     C*
035600200529     C* Get Installation Control Data 2
035700200529     C*
035800200529     C                     EXSR ZICD2
035900200529     C*
036000200529     C* If error in ZICD2, abend program
036100200529     C*
036200200529     C           *IN99     IFEQ '1'                        ***************
036300200529     C           *LOCK     IN   LDA                        **           **S01117
036400200529     C***********          MOVE '02'      DBASE            **DB*ERROR*02**S01117
036500200529     C                     Z-ADD02        DBASE            **DB ERROR 02**S01117
036600200529     C                     MOVEL'TABLE'   DBFILE           ***************
036700200529     C                     MOVELZTABKY    DBKEY
036800200529     C                     WRITEHEADAU
036900200529     C                     WRITEERROR
037000200529     C***********          WRITETRAILAU                                   E29170
037100200529     C                     SETON                     U7U8LR
037200200529     C                     OUT  LDA                                       S01117
037300200529     C                     EXSR *PSSR                                     S01117
037400200529     C                     RETRN
037500200529     C                     END
037600200529     C*                                                                   S01154
037700200529     C* Get Installation Control Data record 3                            S01154
037800200529     C*                                                                   S01154
037900200529     C                     EXSR ZICDSE                                    S01154
038000200529     C*                                                                   S01154
038100200529     C* If error in ZICDSE, abort program                                 S01154
038200200529     C*                                                                   S01154
038300200529     C           *IN99     IFEQ '1'                                       S01154
038400200529     C           *LOCK     IN   LDA                                       S01117
038500200529     C***********          MOVE '03'      DBASE             *******S01154 E20651
038600200529     C***********          MOVE '10'      DBASE      ************  E20651 S01117
038700200529     C                     Z-ADD10        DBASE             ************  S01117
038800200529     C                     MOVEL'TABLE'   DBFILE            * DATABASE *  S01154
038900200529     C***********          MOVELZTABKY    DBKEY       * ERROR 03 * S01154 E20651
039000200529     C                     MOVELZTABKY    DBKEY             * ERROR 10 *  E20651
039100200529     C                     SETON                     U7U801 ************  S01154
039200200529     C                     OUT  LDA                                       S01117
039300200529     C                     EXSR *PSSR                                     S01117
039400200529     C                     END                                            S01154
039500200529     C*
039600200529     C* Keys to access ACCNT records
039700200529     C*
039800200529     C           ACCNTK    KLIST
039900200529     C                     KFLD           CNUM
040000200529     C                     KFLD           CCY
040100200529     C                     KFLD           ACOD
040200200529     C                     KFLD           ACSQ
040300200529     C                     KFLD           BRCA                            S01117
040400200529     C*                                                                   061659
040500200529     C** Key list to access SDNOSTL1                                      061659
040600200529     C*                                                                   061659
040700200529     C           KLNOST    KLIST                                          061659
040800200529     C                     KFLD           A7CYCD                          061659
040900200529     C                     KFLD           A7NONB                          061659
041000200529     C*
041100200529     C                     Z-ADD*ZEROS    ZZAMT
041200200529     C*
041300200529     C** CALL ACCESS PROGRAM FOR GENERAL LEDGER DETAILS                   088755
041400200529     C**********           CALL 'AOGELRR0'                                088755              CGL029
041500200529     C                     CALL 'AOGELRR1'                                                    CGL029
041600200529     C                     PARM '*MSG    '@RTCD   7                       088755
041700200529     C                     PARM '*FIRST  '@OPTN   7                       088755
041800200529     C********** SDGELR    PARM SDGELR    DSFDY                           088755              CGL029
041900200529     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
042000200529     C*                                                                   088755
042100200529     C           @RTCD     IFNE *BLANK                                    088755
042200200529     C                     MOVEL'SDGELRPD'DBFILE            ************* 088755
042300200529     C                     Z-ADD1         DBASE             * DBERROR 01* 088755
042400200529     C                     MOVEL@OPTN     DBKEY             ************* 088755
042500200529     C                     SETON                     U7U8LR               088755
042600200529     C                     EXSR *PSSR                                     088755
042700200529     C                     END                                            088755
042800200529     C*                                                                   088755
042900200529     C                     SETON                     69
043000200529     C                     END
043100200529     C*
043200200529     C* Count records in
043300200529     C*
043400200529     C   01                ADD  1         TCOUNT
043500200529     C   02                ADD  1         CCOUNT
043600200529     C   03                ADD  1         DCOUNT
043700200529     C/COPY WNCPYSRC,SE1550C002
043800200529     C*
043900200529     C* Check for records requiring further action
044000200529     C*
044100200529     C                     SETOF                     50
044200200529     C*
044300200529     C           *IN01     IFEQ '1'
044400200529     C***********TRVD      IFEQ DNWD                                      S01154
044500200529     C***********TRVD      IFEQ RUND                               S01154 132257
044600200529     C***********TRVD      IFLT DNWD                               132257 CRE009
044700200529     C           CRE009    IFEQ 'Y'                                       CRE009
044800200529     C           TRVD      ANDLEWDATE                                     CRE009
044900200529     C           IBRE      ANDNE'Y'                                                           258879
045000200529     C********** TRVD      ANDGERUND                                                   132257 258879
045100200529     C           CRE009    OREQ 'N'                                       CRE009
045200200529     C           TRVD      ANDLTDNWD                                      CRE009
045300200529     C           IBRE      ANDNE'Y'                                                           258879
045400200529     C********** TRVD      ANDGERUND                                                   CRE009 258879
045500200529     C********** SKTD      ANDEQ'T'                                                    S01448 201149
045600200529     C/COPY WNCPYSRC,SE1550C003
045700200529     C*
045800200529     C           TRSM      IFEQ 4
045900200529     C           TRSM      OREQ 5
046000200529     C           TRSM      OREQ 14
046100200529     C           TRSM      OREQ 15
046200200529     C*
046300200529     C           TRCR      IFNE *BLANK
046400200529     C           TRCR      ANDNE'0'
046500200529     C                     SETON                     50
046600200529     C                     END
046700200529     C*                                                                   061659
046800200529     C** If settlement is via nostro obtain details                       061659
046900200529     C*                                                                   061659
047000200529     C                     ELSE                                           061659
047100200529     C           TRSM      IFEQ 1                                         061659
047200200529     C           TRSM      OREQ 7                                         061659
047300200529     C           TRSM      OREQ 8                                         061659
047400200529     C                     MOVELTRSC      A7CYCD                          061659
047500200529     C                     MOVELTRSA      A7NONB                          061659
047600200529     C                     MOVE '1'       *IN50                           061659
047700200529     C           KLNOST    CHAINSDNOSTL1             33                   061659
047800200529     C           *IN33     IFEQ '1'                                       061659
047900200529     C           *LOCK     IN   LDA                                       061659
048000200529     C                     Z-ADD21        DBASE             ************  061659
048100200529     C                     MOVEL'SDNOST'  DBFILE            * DATABASE *  061659
048200200529     C                     MOVELA7CYCD    WRK5    5         * ERROR 21 *  061659
048300200529     C                     MOVE A7NONB    WRK5              ************  061659
048400200529     C                     MOVELWRK5      DBKEY                           061659
048500200529     C                     SETON                     U7U8                 061659
048600200529     C                     OUT  LDA                                       061659
048700200529     C                     EXSR *PSSR                                     061659
048800200529     C                     END                                            061659
048900200529     C                     END                                            061659
049000200529      *                                                                   061659
049100200529     C                     END
049200200529     C                     END
049300200529     C*
049400200529     C                     ELSE
049500200529     C           APNS      IFEQ 'Y'                                       S01154
049600200529     C           EVRECI    OREQ 'A'                                                           249578
049700200529     C***********CCDT      IFEQ DNWD                                      S01154
049800200529     C***********CCDT      IFEQ RUND                               S01154 132257
049900200529     C***********CCDT      IFLT DNWD                               132257 CRE009
050000200529     C           CRE009    IFEQ 'Y'                                       CRE009
050100200529     C           CCDT      ANDLEWDATE                                     CRE009
050200200529     C********** CCDT      ANDGERUND                                                   132257 258879
050300200529     C           CRE009    OREQ 'N'                                       CRE009
050400200529     C           CCDT      ANDLTDNWD                                      CRE009
050500200529     C********** CCDT      ANDGERUND                                                   CRE009 258879
050600200529     C/COPY WNCPYSRC,SE1550C004
050700200529     C*
050800200529     C           CCSM      IFEQ 4
050900200529     C           CCSM      OREQ 5
051000200529     C           CCSM      OREQ 14
051100200529     C           CCSM      OREQ 15
051200200529     C*
051300200529     C           CCTC      IFNE *BLANKS
051400200529     C                     SETON                     50
051500200529     C                     END
051600200529     C*                                                                   061659
051700200529     C** If settlement is via nostro obtain details                       061659
051800200529     C*                                                                   061659
051900200529     C                     ELSE                                           061659
052000200529     C           CCSM      IFEQ 1                                         061659
052100200529     C           CCSM      OREQ 7                                         061659
052200200529     C           CCSM      OREQ 8                                         061659
052300200529     C                     MOVELCCEC      A7CYCD                          061659
052400200529     C                     MOVELCCSA      A7NONB                          061659
052500200529     C                     MOVE '1'       *IN50                           061659
052600200529     C           KLNOST    CHAINSDNOSTL1             33                   061659
052700200529     C           *IN33     IFEQ '1'                                       061659
052800200529     C           *LOCK     IN   LDA                                       061659
052900200529     C                     Z-ADD21        DBASE             ************  061659
053000200529     C                     MOVEL'SDNOST'  DBFILE            * DATABASE *  061659
053100200529     C                     MOVELA7CYCD    WRK5    5         * ERROR 21 *  061659
053200200529     C                     MOVE A7NONB    WRK5              ************  061659
053300200529     C                     MOVELWRK5      DBKEY                           061659
053400200529     C                     SETON                     U7U8                 061659
053500200529     C                     OUT  LDA                                       061659
053600200529     C                     EXSR *PSSR                                     061659
053700200529     C                     END                                            061659
053800200529     C                     END                                            061659
053900200529      *                                                                   061659
054000200529     C                     END
054100200529     C                     END
054200200529     C                     END                                            S01154
054300200529     C*
054400200529     C                     END
054500200529     C*
054600200529     C* Further action required
054700200529     C*
054800200529     C           *IN50     IFEQ '1'
054900200529     C*
055000200529     C   01                MOVE '  '      CCSM
055100200529     C  N01                MOVE '  '      TRSM
055200200529     C*
055300200529     C           TRSM      IFEQ 14
055400200529     C           CCSM      OREQ 14
055500200529     C           *IN01     IFEQ '1'
055600200529     C                     MOVELTRSA      WORK10 100
055700200529     C                     ELSE
055800200529     C                     MOVELCCSA      WORK10
055900200529     C                     END
056000200529     C*
056100200529     C* Fetch key fields to access account file
056200200529     C*
056300200529     C           WORK10    CHAINACNUMF               33
056400200529     C           *IN33     IFEQ '1'                        ***************
056500200529     C           *LOCK     IN   LDA                                       S01117
056600200529     C***********          MOVE '03'      DBASE            **DB*ERROR*03**E20651
056700200529     C***********          MOVE '11'      DBASE     **DB*ERROR*11**E20651 S01117
056800200529     C                     Z-ADD11        DBASE            **DB ERROR 11**S01117
056900200529     C                     MOVEL'ACNUM'   DBFILE           ***************
057000200529     C                     MOVELWORK10    DBKEY
057100200529     C                     WRITEHEADAU
057200200529     C                     WRITEERROR
057300200529     C***********          WRITETRAILAU                                   E29170
057400200529     C                     SETON                     U7U8LR
057500200529     C                     OUT  LDA                                       S01117
057600200529     C                     EXSR *PSSR                                     S01117
057700200529     C                     RETRN
057800200529     C                     END
057900200529     C*
058000200529     C                     ELSE
058100200529     C           *IN01     IFEQ '1'
058200200529     C           TRSM      IFEQ 1                                         061659
058300200529     C           TRSM      OREQ 7                                         061659
058400200529     C           TRSM      OREQ 8                                         061659
058500200529     C                     MOVELA7CUST    CNUM                            061659
058600200529     C                     MOVELTRSC      CCY                             061659
058700200529     C                     MOVELA7ACCD    ACOD                            061659
058800200529     C                     MOVELA7ACSN    ACSQ                            061659
058900200529     C                     MOVELA7BRCD    BRCA                            061659
059000200529     C***********          MOVELA7BRCD    TRBA                     061659 086485
059100200529     C                     MOVELA7BRCD    TRTA                            086485
059200200529     C                     ELSE                                           061659
059300200529     C                     MOVELTRSA      CNUM
059400200529     C                     MOVE TRSC      CCY
059500200529     C**********           MOVE TRSA      WORK6   6                                           CGL029
059600200529     C                     MOVE TRSA      WORK6  12                                           CGL029
059700200529     C                     MOVELWORK6     ACOD
059800200529     C                     MOVE WORK6     ACSQ
059900200529     C***********          MOVE TRBA      BRCA                     S01117 086485
060000200529     C                     MOVE TRTA      BRCA                            086485
060100200529     C                     END                                            061659
060200200529     C                     ELSE
060300200529     C           CCSM      IFEQ 1                                         061659
060400200529     C           CCSM      OREQ 7                                         061659
060500200529     C           CCSM      OREQ 8                                         061659
060600200529     C                     MOVELA7CUST    CNUM                            061659
060700200529     C                     MOVELCCEC      CCY                             061659
060800200529     C                     MOVELA7ACCD    ACOD                            061659
060900200529     C                     MOVELA7ACSN    ACSQ                            061659
061000200529     C                     MOVELA7BRCD    BRCA                            061659
061100200529     C***********          MOVELA7BRCD    CCBA                     061659 086485
061200200529     C                     MOVELA7BRCD    CCTA                            086485
061300200529     C                     ELSE                                           061659
061400200529     C                     MOVELCCSA      CNUM
061500200529     C                     MOVE CCEC      CCY
061600200529     C                     MOVE CCSA      WORK6
061700200529     C                     MOVELWORK6     ACOD
061800200529     C                     MOVE WORK6     ACSQ
061900200529     C***********          MOVE CCBA      BRCA                     S01117 086485
062000200529     C                     MOVE CCTA      BRCA                            086485
062100200529     C                     END                                            061659
062200200529     C                     END
062300200529     C                     END
062400200529     C*
062500200529     C           ACCNTK    CHAINACCNTABF             33
062600200529     C           *IN33     IFEQ '1'                        ***************
062700200529     C           *LOCK     IN   LDA                                       S01117
062800200529     C***********          MOVE '04'      DBASE            **DB*ERROR*04**S01117
062900200529     C                     Z-ADD04        DBASE            **DB ERROR 04**S01117
063000200529     C                     MOVEL'ACCNT'   DBFILE           ***************
063100200529     C                     MOVELACKYDS    DBKEY
063200200529     C                     WRITEHEADAU
063300200529     C                     WRITEERROR
063400200529     C***********          WRITETRAILAU                                   E29170
063500200529     C                     SETON                     U7U8LR
063600200529     C                     OUT  LDA                                       S01117
063700200529     C                     EXSR *PSSR                                     S01117
063800200529     C                     RETRN
063900200529     C                     END
064000200529     C*
064100200529     C* Only output shadow posting if a/c type 'R'
064200200529     C*
064300200529     C           ATYP      IFEQ 'R'
064400200529     C                     EXSR SHDPST
064500200529     C                     END
064600200529     C*
064700200529     C                     END
064800200529     C*
064900200529     C* Do audit process at last record time
065000200529     C*
065100200529     CLR                   DO
065200200529     C*
065300200529     C* If no records read, perform 1st time calcs for audit report
065400200529     C*
065500200529     CL0         TCOUNT    IFEQ *ZEROS
065600200529     CL0         CCOUNT    ANDEQ*ZEROS
065700200529     CL0         DCOUNT    ANDEQ*ZEROS
065800200529     C*
065900200529     C* Prepare LDA
066000200529     C*
066100200529     CL0                   MOVE *BLANKS   DBLOT
066200200529     CL0                   MOVE 'SE1550  'DBPGM
066300200529     C*
066400200529     C* Get Installation Control Data record 1
066500200529     C*
066600200529     CL0                   EXSR ZSYSTM
066700200529     C*
066800200529     C* If error in ZSYSTM, abend program
066900200529     C*
067000200529     CL0         *IN99     IFEQ '1'                        ***************
067100200529     CL0         *LOCK     IN   LDA                        **           **S01117
067200200529     C**L0*******          MOVE '01'      DBASE            **DB*ERROR*01**E20651
067300200529     C***********L0        MOVE '09'      DBASE     **DB ERROR 09**E20651 S01117
067400200529     CL0                   Z-ADD09        DBASE            **DB ERROR 09**S01117
067500200529     CL0                   MOVEL'TABLE'   DBFILE           ***************
067600200529     CL0                   MOVELZTABKY    DBKEY
067700200529     CL0                   WRITEHEADAU
067800200529     CL0                   WRITEERROR
067900200529     C*0*********          WRITETRAILAU                                   E29170
068000200529     CL0                   SETON                     U7U8LR
068100200529     CL0                   RETRN
068200200529     CL0                   OUT  LDA                                       S01117
068300200529     CL0                   EXSR *PSSR                                     S01117
068400200529     CL0                   END
068500200529     C*
068600200529     CL0                   END
068700200529     C*                                                                   E21675
068800200529     C* DEFINE DATA AREA SESTAT                                           E21675
068900200529     C*                                                                   E21675
069000200529     CL0         *NAMVAR   DEFN           SESTAT                          E21675
069100200529     CL0                   IN   SESTAT                                    E21675
069200200529     C*
069300200529     C* Fetch Trade events audit file
069400200529     C*
069500200529     CL0         1         CHAINTREVEAF              33
069600200529     CL0         *IN33     IFEQ '1'                        ***************
069700200529     CL0         *LOCK     IN   LDA                        **           **S01117
069800200529     C***********L0        MOVEL'05'      DBASE            **DB*ERROR*05**S01117
069900200529     CL0                   Z-ADD05        DBASE            **DB ERROR 05**S01117
070000200529     CL0                   MOVEL'TREVE'   DBFILE           ***************
070100200529     CL0                   MOVEL'AUDIT'   DBKEY
070200200529     CL0                   WRITEHEADAU
070300200529     CL0                   WRITEERROR
070400200529     C*0*********          WRITETRAILAU                                   E29170
070500200529     CL0                   SETON                     U7U8
070600200529     CL0                   OUT  LDA                                       S01117
070700200529     CL0                   EXSR *PSSR                                     S01117
070800200529     CL0                   RETRN
070900200529     CL0                   END
071000200529     C*
071100200529     C* Compare control total to number of records read
071200200529     C*
071300200529     CL0         NORE      COMP TCOUNT               7171
071400200529     C*
071500200529     C* Setup output field
071600200529     C*
071700200529     CL0                   Z-ADDNORE      TERNO
071800200529     C*
071900200529     C* Fetch Customer position events audit file
072000200529     C* if Portfolio Customer Processing is on.                           E21675
072100200529     C*
072200200529     CL0         PFPL      IFEQ 'Y'                                       E21675
072300200529     CL0         1         CHAINCPEVEAF              33
072400200529     CL0         *IN33     IFEQ '1'                        ***************
072500200529     CL0         *LOCK     IN   LDA                        **           **S01117
072600200529     C***********L0        MOVEL'06'      DBASE            **DB*ERROR*06**S01117
072700200529     CL0                   Z-ADD06        DBASE            **DB ERROR 06**S01117
072800200529     CL0                   MOVEL'CPEVE'   DBFILE           ***************
072900200529     CL0                   MOVEL'AUDIT'   DBKEY
073000200529     CL0                   WRITEHEADAU
073100200529     CL0                   WRITEERROR
073200200529     C*0*********          WRITETRAILAU                                   E29170
073300200529     CL0                   SETON                     U7U8
073400200529     CL0                   OUT  LDA                                       S01117
073500200529     CL0                   EXSR *PSSR                                     S01117
073600200529     CL0                   RETRN
073700200529     CL0                   END
073800200529     C*
073900200529     C* Compare control total to number of records read
074000200529     C*
074100200529     CL0         NORE      COMP CCOUNT               7272
074200200529     C*
074300200529     C* Setup output field
074400200529     C*
074500200529     CL0                   Z-ADDNORE      CPRNO
074600200529     CL0                   END                                            E21675
074700200529     C*
074800200529     C* Fetch Depot position events audit file
074900200529     C*
075000200529     CL0         1         CHAINDPEVEAF              33
075100200529     CL0         *IN33     IFEQ '1'                        ***************
075200200529     CL0         *LOCK     IN   LDA                        **           **S01117
075300200529     C***********L0        MOVEL'07'      DBASE            **DB*ERROR*07**S01117
075400200529     CL0                   Z-ADD07        DBASE            **DB ERROR 07**S01117
075500200529     CL0                   MOVEL'DPEVE'   DBFILE           ***************
075600200529     CL0                   MOVEL'AUDIT'   DBKEY
075700200529     CL0                   WRITEHEADAU
075800200529     CL0                   WRITEERROR
075900200529     C*0*********          WRITETRAILAU                                   E29170
076000200529     CL0                   SETON                     U7U8
076100200529     CL0                   OUT  LDA                                       S01117
076200200529     CL0                   EXSR *PSSR                                     S01117
076300200529     CL0                   RETRN
076400200529     CL0                   END
076500200529     C*
076600200529     C* Compare control total to number of records read
076700200529     C*
076800200529     CL0         NORE      COMP DCOUNT               7373
076900200529     C*
077000200529     C* Setup output field
077100200529     C*
077200200529     CL0                   Z-ADDNORE      DPRNO
077300200529     C*
077400200529     C* Update files if no difference errors
077500200529     C*
077600200529     CL0         *IN71     IFEQ '1'
077700200529     CL0         *IN72     OREQ '1'
077800200529     CL0         *IN73     OREQ '1'
077900200529     CL0                   SETON                     U8
078000200529     CL0                   END
078100200529     C*
078200200529     CL0         *INU8     IFEQ '0'
078300200529     C/COPY WNCPYSRC,SE1550C005
078400200529     C*
078500200529     C* Write header record
078600200529     C*
078700200529     CL0                   MOVE 'H'       RECI
078800200529     CL0                   Z-ADD99999     FLSZ
078900200529     CL0                   WRITEAPOSTHHF
079000200529     C*
079100200529     C* Write trailer record
079200200529     C*
079300200529     CL0                   MOVE 'T'       RECI
079400200529     CL0         SPOSTS    ADD  2         NORE1
079500200529     CL0                   Z-ADDHSHINT    HRWN
079600200529     CL0                   Z-ADDHSHDEC    HRDC
079700200529     CL0                   WRITEAPOSTZZF
079800200529     C/COPY WNCPYSRC,SE1550C006
079900200529     C*
080000200529     CL0                   END
080100200529     C*
080200200529     C* Print audit report
080300200529     C*
080400200529     CL0                   WRITEHEADAU
080500200529     CL0                   WRITEDETLAU
080600200529     C*0*********          WRITETRAILAU                                   E29170
080700200529     C*
080800200529     CLR                   END
080900200529     C*
081000200529     C*****************************************************************
081100200529      /EJECT
081200200529     C*****************************************************************
081300200529     C*                                                               *
081400200529     C* SHDPST SR. writes out Shadow Posting records                  *
081500200529     C*                                                               *
081600200529     C*****************************************************************
081700200529     C*                                                               *
081800200529     CSR         SHDPST    BEGSR
081900200529     C*
082000200529     C/COPY WNCPYSRC,SE1550C007
082100200529     C                     MOVE 'P'       RECI
082200200529     C                     MOVE *BLANKS   ZZ006
082300200529     C                     Z-ADD*ZEROS    TRAT
082400200529     C                     MOVE *BLANKS   PNAR
082500200529     C**********           Z-ADD*ZEROS    ASOC                                                CSD027
082600200529     C                     MOVE *BLANKS   ASOC                                                CSD027
082700200529     C                     Z-ADD*ZEROS    CHQN
082800200529     C************         MOVE '  GE-ST' SPOS                            S01154
082900200529     C                     MOVE '  GE-SE' SPOS                            S01154
083000200529     C                     Z-ADD1         RIND
083100200529     C                     Z-ADD*ZEROS    REJC
083200200529     C                     MOVE *BLANKS   DPMT
083300200529     C                     Z-ADD*ZEROS    RRNM
083400200529     C                     MOVE *BLANKS   ZZ009
083500200529     C                     MOVE 'R'       ATYP
083600200529     C                     MOVE *BLANKS   ZZ002
083700200529     C                     MOVE *BLANK    EXIN
083800200529     C                     BITOF'01234567'PRIN
083900200529     C                     MOVE 'S'       GETP
084000200529     C                     Z-ADD1         ACUM
084100200529     C           *IN01     IFEQ '1'
084200200529     C                     Z-ADDTRVD      PSTD
084300200529     C                     Z-ADDTRVD      VALD
084400200529     C***********          MOVELTRSS      WORK16 16                       S01154
084500200529     C***********          MOVE TRTR      WORK16                          S01154
084600200529     C                     MOVE TRSS      WORK16 16                       S01154
084700200529     C                     MOVELTRTR      WORK16                          S01154
084800200529     C                     MOVELWORK16    PNAR
084900200529     C                     Z-ADDTRVS      PSTA
085000200529     C***********          Z-ADDTRBN      BRCD                            S01117
085100200529     C***********          MOVE TRBA      BRCA                     S01117 091969
085200200529     C                     MOVE TRTA      BRCA                            091969
085300200529     C***********TRTT      IFEQ 'TP'                                      071134
085400200529     C***********PSTA      IFGT *ZEROS                                    071134
085500200529     C***********          Z-ADD1         DRCR                            071134
085600200529     C***********          ELSE                                           071134
085700200529     C***********          Z-ADD0         DRCR                            071134
085800200529     C***********          END                                            071134
085900200529     C***********          ELSE                                           071134
086000200529     C***********PSTA      IFGT *ZEROS                                    071134
086100200529      *                                                                   071134
086200200529      * Incoming amount is a debit, outgoing is a credit.                 071134
086300200529     C           TRIO      IFEQ 'I'                                       071134
086400200529     C                     Z-ADD0         DRCR
086500200529     C                     ELSE
086600200529     C                     Z-ADD1         DRCR
086700200529     C                     END
086800200529     C***********          END                                            071134
086900200529     C*                                                                   S01117
087000200529     C** Transfer trade profit centre to posting                          S01117
087100200529     C*                                                                   S01117
087200200529     C                     MOVE TRPRFC    PRFC                            S01117
087300200529     C                     ELSE
087400200529     C           *IN02     IFEQ '1'
087500200529     C***********CCET      IFEQ 'PP'                                      071134
087600200529     C***********CCEA      IFGT *ZEROS                                    071134
087700200529      *                                                                   071134
087800200529      * Incoming amount is a debit, outgoing is a credit.                 071134
087900200529     C           CCIO      IFEQ 'I'                                       071134
088000200529     C                     Z-ADD0         DRCR
088100200529     C                     ELSE
088200200529     C                     Z-ADD1         DRCR
088300200529     C                     END
088400200529     C***********          ELSE                                           071134
088500200529     C***********CCEA      IFGT *ZEROS                                    071134
088600200529     C***********          Z-ADD1         DRCR                            071134
088700200529     C***********          ELSE                                           071134
088800200529     C***********          Z-ADD0         DRCR                            071134
088900200529     C***********          END                                            071134
089000200529     C***********          END                                            071134
089100200529     C*                                                                   S01117
089200200529     C** Obtain customer position profit centre                           S01117
089300200529     C*                                                                   S01117
089400200529     C           BKPRCU    IFEQ 'Y'                                       088755
089500200529     C           KSEPCC    CHAINSEPCCD               33                   S01117
089600200529     C           *IN33     IFEQ '1'                                       S01117
089700200529     C           *LOCK     IN   LDA                        ***************S01117
089800200529     C                     Z-ADD12        DBASE            **DB ERROR 12**S01117
089900200529     C                     MOVEL'SEPCCD'  DBFILE           ***************S01117
090000200529     C                     MOVELKSEPCR    DBKEY                           S01117
090100200529     C                     WRITEHEADAU                                    S01117
090200200529     C                     WRITEERROR                                     S01117
090300200529     C***********          WRITETRAILAU                             S01117E29170
090400200529     C                     SETON                     U7U8LR               S01117
090500200529     C                     OUT  LDA                                       S01117
090600200529     C                     EXSR *PSSR                                     S01117
090700200529     C                     RETRN                                          S01117
090800200529     C                     END                                            S01117
090900200529     C                     END                                            088755
091000200529     C                     MOVE PCCU      PRFC                            S01117
091100200529     C*                                                                   S01117
091200200529     C                     ELSE
091300200529     C           *IN03     IFEQ '1'
091400200529     C***********CCET      IFEQ 'PP'                                      071134
091500200529     C***********CCEA      IFGT *ZEROS                                    071134
091600200529     C***********          Z-ADD1         DRCR                            071134
091700200529     C***********          ELSE                                           071134
091800200529     C***********          Z-ADD0         DRCR                            071134
091900200529     C***********          END                                            071134
092000200529     C***********          ELSE                                           071134
092100200529     C***********CCEA      IFGT *ZEROS                                    071134
092200200529      *                                                                   071134
092300200529      * Incoming amount is a debit, outgoing is a credit.                 071134
092400200529     C           CCIO      IFEQ 'I'                                       071134
092500200529     C                     Z-ADD0         DRCR
092600200529     C                     ELSE
092700200529     C                     Z-ADD1         DRCR
092800200529     C                     END
092900200529     C***********          END                                            071134
093000200529     C*                                                                   S01117
093100200529     C** Depot positions do not have profit centres                       S01117
093200200529     C*                                                                   S01117
093300200529     C                     MOVE *BLANKS   PRFC                            S01117
093400200529     C*                                                                   S01117
093500200529     C                     END
093600200529     C                     END
093700200529     C                     Z-ADDCCDT      PSTD
093800200529     C*                                                                   S01510
093900200529     C** If S01510 is active and payment date not the same as event       S01510
094000200529     C** date, set value date to payment date                             S01510
094100200529     C*                                                                   S01510
094200200529     C           CCPD      IFNE CCDT                                      S01510
094300200529     C                     Z-ADDCCPD      VALD                            S01510
094400200529     C                     ELSE                                           S01510
094500200529     C                     Z-ADDCCDT      VALD
094600200529     C                     END                                            S01510
094700200529     C*                                                                   S01510
094800200529     C                     MOVELCCSS      PNAR
094900200529     C                     Z-ADDCCEA      PSTA
095000200529     C***********          Z-ADDCCBR      BRCD                            S01117
095100200529     C***********          MOVE CCBA      BRCA                     S01117 091969
095200200529     C                     MOVE CCTA      BRCA                            091969
095300200529     C                     END
095400200529     C                     WRITEAPOSTPDF
095500200529     C*
095600200529     C* Keep total for audit record
095700200529     C*
095800200529     C                     ADD  1         SPOSTS
095900200529     C*
096000200529     C* Fetch and keep hash totals for audit record
096100200529     C*
096200200529     C                     MOVE PSTA      ZZAMT
096300200529     C                     Z-ADD1         S
096400200529     C                     Z-ADD1         Z
096500200529     C                     EXSR ZHASH
096600200529     C                     Z-ADDINT,S     HSHINT
096700200529     C                     Z-ADDDEC,S     HSHDEC
096800200529     C*
096900200529     C/COPY WNCPYSRC,SE1550C008
097000200529     CSR                   ENDSR
097100200529     C*
097200200529     C*****************************************************************
097300200529      /EJECT                                                              S01117
097400200529     C*****************************************************************
097500200529      *                                                               *   S01117
097600200529      *  *PSSR  - Error control subroutine                            *   S01117
097700200529      *                                                               *   S01117
097800200529      *****************************************************************   S01117
097900200529      *                                                                   S01117
098000200529     C           *PSSR     BEGSR                           ** *PSSR **    S01117
098100200529     C**                                                                  S01117
098200200529     C           @RUN      IFEQ *BLANKS                                   S01117
098300200529     C                     MOVE 'Y'       @RUN    1                       S01117
098400200529     C                     DUMP                                           S01117
098500200529     C                     END                                            S01117
098600200529     C**                                                                  S01117
098700200529     C                     ENDSR                                          S01117
098800200529      *                                                                   S01117
098900200529      *****************************************************************   S01117
099000200529     C/COPY WNCPYSRC,SE1550C009
099100200529      /EJECT
099200200529     C/COPY ZSRSRC,ZHASHZ3
099300200529      /EJECT
099400200529     C/COPY ZSRSRC,ZICD2Z1
099500200529      /EJECT                                                              S01154
099600200529     C/COPY ZSRSRC,ZICDSEZ1                                               S01154
099700200529      /EJECT
099800200529     C/COPY ZSRSRC,ZSYSTMZ1
099900200529**  CPY@
100000200529(c) Finastra International Limited 2001
