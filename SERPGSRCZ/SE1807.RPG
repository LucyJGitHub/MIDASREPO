     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Depot movements extension maintenance')       *
/*OVRF*  OVRDBF FILE(DPTMVDZ1) TOFILE(DPTMVDY1) SHARE(*NO)            *
/*OVRF*  OVRDBF FILE(DPTMVDZ3) TOFILE(DPTMVDY2) SHARE(*NO)            *                       201230
     F*****************************************************************
     F*                                                               *
     F*  Midas - Securities Trading Module
     F*                                                               *
     F*     This program will be made redundant at DBA R4.00          *
     F*     In the interim please check the new ILE RPG versions      *
     F*     and apply any new fixes if they are appropriate.          *
     F*                                                               *
     F*  SE1807 - Depot Movements - Update Extension File             *
     F*                                                               *
     F*  Function: This program allows input of the fields needed     *
     F*   (I/C)    to produce the SWIFT Messages - MT5XX.             *
     F*                                                               *
     F*  Called By: SE0070 - Depot Movements Maintenance              *
     F*             MMREPOSIN - Repo Maintenance                      *
     F*                                                               *
     F*         NB. ANY CHANGE MADE TO THIS PGM WILL ALMOST           *
     F*             DEFINITELY NEED TO BE APPLIED TO SE1805           *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. MD046998A          Date 15Apr21               *
      *  Prev Amend No. MD057247           Date 01Feb21               *
      *                 MD046248           Date 27Oct17               *
      *                 226449             Date 24Jun15               *
      *                 AR545944           Date 07Jun10               *
      *                 CSW210             Date 04May10               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 246912             Date 24Apr07               *
      *                 243125             Date 05Mar07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      *                 244538             Date 06Apr05               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CAP087             Date 09Sep05               *
      *                 CSE071             Date 19Jul05               *
      *                 CSW037A            Date 02May05               *
      *                 BUG6308            Date 13Apr05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3122            Date 17Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 CSC022             Date 24Feb04               *
      *                 CGL029             Date 01Sep03               *
      *                 222727             Date 05Nov03               *
      *                 CSD015             Date 14Oct02               *
      *                 206316             Date 19Jul02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 212289             Date 20Nov02               *
      *                 211823             Date 11Nov02               *
      *                 209778             Date 04Oct02               *
      *                 203796             Date 15May02               *
      * Midas Release 4.01.01 ----------------------------------------*
      *                 CSW202             Date 20May02               *
      *                 207255             Date 09Jul02               *
      *                 207006             Date 18Jun02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CSE034             Date 18Apr02               *
      *                 204662             Date 25Apr02               *
      *                 204954             Date 23Apr02               *
      *                 204956             Date 23Apr02               *
      *                 204920             Date 23Apr02               *
      *                 204661             Date 16Apr02               *
      *                 204352             Date 27Mar02               *
      *                 204333             Date 26Mar02               *
      *                 CSE033             Date 20Mar02               *
      *                 CSE031             Date 09Nov01               *
      *                 180707             Date 25Jul00               *
      *                 200716             Date 02Jan02               *
      *                 201429             Date 24Dec01               *
      *                 201233             Date 20Dec01               *
      *                 201231             Date 19Dec01               *
      *                 201230             Date 18Dec01               *
      *                 199797             Date 01Nov01               *
      *                 175115             Date 01Oct01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CSE028             Date 06Jun01               *
      *                 CSW201             Date 02May01               *
      *                 194231             Date 18Jun01               *
      *                 190754             Date 07Jun01               *
      *                 190743             Date 12Mar01               *
      *                 CSE022             Date 29Mar01               *
      *                 190892             Date 12Apr01               *
      * Midas DBA 3.03 -----------------------------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CSE015             Date 20Oct99               *
      *                 CSE017             Date 20Oct99               *
     F*                 164481             Date 19Jul99               *
     F*                 CSE006             Date 24Jun99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 130862             Date 18Oct98               *
      *                 151945             DATE 06Jan99               *
     F*                 CSW098             Date 22Apr98               *
     F*                 CSE005             Date 04Feb97               *
     F*                 104032             DATE 04JUN96               *
     F*                 103583             DATE 23MAY96               *
     F*                 103449             DATE 21MAY96               *
     F*                 CSW003             DATE 18DEC95               *
     F*                 098856             DATE 18DEC95               *
     F*                 094415             DATE 18DEC95               *
     F*                 096833             DATE 06DEC95               *
     F*                 S01445             DATE 04NOV93               *
     F*                 S01401             DATE 16JUN93               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  MD046998A - Recompiled due to changes in /COPY ZDYYRZ3       *
      *            - Applied fix for MD057480                         *
      *  MD057247 - Multiple calls of UTCHOBJEX for several COB com-  *
      *             ponents - Securities module.                      *
      *           - Moved the call of AOSARDR0 from /copy ZLCDZ1.     *
      *  MD046248 - Finastra Rebranding                               *
      *  226449 - Recompiled over changes made in /COPY ZDYYRZ3.      *
      *         - Applied for MD034387.                               *
      *  AR545944 - Error in DPWI/DPWO for Free or Against Payment    *
      *             field                                             *
      *  CSW210 - SWIFT 2010 Changes (Recompile)                      *
      *  246912 - When Amend mode and the ext. record is not found in *
      *           SEDMRPX1 (called from MMRPDLSFL processing), switch *
      *           to Insert mode to create the extension record(s).   *
      *  243125 - MOVEL with a field (15,0) to (13,0) caused interest *
      *           shown on the MT5xx messages to be 100x smaller.     *
      *           Amended the program to use Z-ADD instead of MOVEL.  *
      *         - Display the message type correctly when ISO15022    *
      *           is switched on (i.e. MT540/42 instead of MT520/22). *
      *  244538 - Remove part of 211823 so that Settlement Message    *
      *           Request is defaulted to blank as in R4.0            *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CAP087 - Depot Movement API - Java Wrapper in Midasplus      *
      *           Extended settlement details can't viewed via F14.   *
      *           Remove dependency of value of PWHEN to feature      *
      *           CSW003 as extended settlement record is always      *
      *           created with 'S' (and 'M') anyway regardless        *
      *           of CSW003 feature being on or off.                  *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  BUG6308- 207255 incorrecty condition setup of default        *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3122 - Recompiled due to changes in SDSECSPD.             *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CSC022 - Commitment Control Changes for MidasPlus            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222727 - Release 5.0 errors  (Recompile)                     *
      *  CSD015 - Midas Compliance Watch - Watch List Checking        *
      *  206316 - Recompiled over changed ZLCDZ1.                     *
      *  212289 - Settlement Message Request is 'Y' even if the msg   *
      *           is unroutable                                       *
      *  211823 - Walk In Input - not defaulting to settlement screen *
      *  209778 - Depot Ext Settlement fields amendable in enquire    *
      *           (Recompile)                                         *
      *  203796 - For WI and WO, the default of 'Free or Against      *
      *           Payment' = 'F'                                      *
      *  CSW202 - SWIFT 2002 Standards Update                         *
      *  207255 - Depot movememt walk out new change control          *
      *  207006 - Add Counterparty & Market Centre to SSI (Recompile) *
      *  CSE034 - Standard Settlement Instruction improvements        *
     F*  204662 - Allow correct retrieval of SSI for RP, RR, BL and BB*
     F*  204954 - For Bond Lending/Bond Borrowing, Time of Trade      *
     F*           not correctly defaulted.                            *
     F*  204956 - For Bond Lending/Bond Borrowing, field SGMEC should *
     F*           be defaulted to 'N'.                                *
     F*  204920 - Review display of Extended Sett. screens.           *
      *  204661 - Default free/against payment for non-default action *
      *  204352 - Settlement message request keeps defaulting back    *
      *           to 'N'.                                             *
      *  204333 - free/against payment field not defaulting correctly *
      *  CSE033 - ISO15022 message generation (Using ME module)       *
      *  CSE031 - Coupon Fixing for Floating Rate Notes.              *
      *           (recompilation due to change to ZNCD/ZLCD/ZACCR).   *
      *  180707 - No Position Settlements generated. Recompile over   *
      *           changes in /COPY ZNCDZ3.                            *
      *  200716 - Unable to amend additional details.                 *
      *  201429 - New validation needed for ISO15022 in               *
      *           extended settlement screen.                         *
      *  201233 - If message is unroutable, settlement of message     *
      *           request cannot be a 'Y'.                            *
      *  201231 - Repo input unable to change ISO1522 indicator       *
      *           during insert.                                      *
      *  201230 - DPTMVX2 is not being output if F14 is not taken.    *
      *           Force F14 if ISO1522 is 'Y' to prevent db error     *
      *           during message generation.                          *
      *  199797 - Additional changes and fixes for CSE028 (SSIs).     *
      *  175115 - Do not check Securities Customer file if Depot      *
      *           Movement is a Repo or Reverse Repo.                 *
      *  CSE028 - Standing Settlement Instructions Enhancement        *
      *  CSW201 - SWIFT 2001 Standards Update                         *
     F*  194231 - Set correct defaults for free or against payment    *
     F*           flag. Defaults should be 'F' for bonds and 'A' for  *
     F*           all other entries.                                  *
     F*  190754 - Details of MT500's not being brought back to subfile*
     F*  190743 - If record not found allow entry instead of issuing  *
     F*           database error.                                     *
      *  CSE022 - Depository Definition Enhancement                   *
     F*  190892 - It is incorrect to always default 'F' into          *
     F*           field 'Free or Against Payment'.                    *
      *  CSE015 - Forward Valued Depot Movements (Recompile)          *
      *  CSE017 - Cum/Ex Indicator on Depot Movements (Recompile)     *
     F*  164481 - ENDIF in wrong place in SE1807.                     *
     F*  CSE006 - Repos enhancement - New entry parameters added.     *
     F*  130862 - Recompiled over ZLCDZ1 & ZDAYSZ2 changes.           *
     F*  151945 - Recompiled Over changed ZDYYRZ3 .                   *
     F*  CSW098 - SWIFT 98 changes. New field added - Standard        *
     F*           Instructions Override.                              *
     F*  CSE005 - Effect of holidays on FRN Coupon Dates              *
     F*           (recompilation due to change to ZNCD/ZLCD/ZACCR).   *
     F*  104032 - Default Settlement Request of 'N' when value date   *
     F*           is before run date                                  *
     F*  103583 - Failure to evaluate Euroclear/Cedel Code correctly. *
     F*  103449 - Allow confirmation message for 'PD' and 'PL'        *
     F*  CSW003 - MT5XX Message Generation - Phase 2.                 *
     F*  098856 - Unable to update transaction time.                  *
     F*  094415 - Wrong destination on messages.                      *
     F*  096833 - Added error messages SEW5122 and SEW5128 to *msgf   *
     F*           GBSEUSRMSG.                                         *
     F*  S01445 - DEPOT MOVEMENT CHARGES ENHANCEMENT.                 *
     F*           Recompiled due to changes in PF/DPTMVD.             *
     F*  S01401 - The generation of MT5xx SWIFT Messages if the       *
     F*           option is available.  NEW PROGRAM.                  *
     F*                                                               *
     F*****************************************************************
      *
     FDPTMVDY1UF  E           K        DISK         KCOMIT       A
     F            DPTMVDD1                          KRENAMEUPDIDX
     FDPTMVDZ1IF  E           K        DISK         KCOMIT
     F            DPTMVDD1                          KRENAMERTVIDX
     FDPTMVDZ3IF  E           K        DISK         KCOMIT                                    201230
     F            DPTMVDD2                          KRENAMERTVIDX2                            201230
     FMGECONL0IF  E           K        DISK
     F/COPY WNCPYSRC,SE1807F002
     FSE1807DFCF  E                    WORKSTN
     F/COPY WNCPYSRC,SE1807F003
     FSECTY   IF  E           K        DISK                               CSW003
     FINVTP   IF  E           K        DISK                               CSW003
     F/COPY WNCPYSRC,SE1807F001
      /TITLE FUNCTION OF INCICATORS
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*    08  - Rolldown                                             *
     F*    09  - Protect Input Fields                                 *
     F*    14  - Enable Rolldown                                      *
     F*    20  - If ON, Destination of Confirmation and Confirmation  *   CSW003
     F*          Message Request are NOT displayed                    *   CSW003
     F*    21  - Settlement Message request                           *
     F*    22  - Instructions type                                    *
     F*    23  - Instructions sub-type                                *
     F*    24  - Counterparty Euroclear/Cedel code                    *
     F*    25  - Safekeeping Account                                  *
     F*    26  - Requested Priority                                   *
     F*    27  - Confirmation Message request                         *
     F*    28  - If ON, Fungibility Code is NOT displayed on 1st Scr. *   CSW003
     F*    29  - If ON, Fungibility Code is NOT displayed on 2nd Scr. *   CSW003
     F*    30  - Time of Trade                                        *
     F*    31  - Guaranteed Delivery                                  *
     F*    32  - Fungibility Code                                     *
     F*    34  - Sender's Role                                        *
     F*    35  - Free or against payment indicator                    *
     F*    36  - Price Validation.                                    *   CSW003
     F*    37  - Exchange Rate Validation.                            *   CSW003
     F*    38  - Accrued Interest Validation.                         *   CSW003
     F*    39  - On if CSW003 = Y, + PDPMV NE 'WI' or 'WO' and not    *   CSW003
     F*          Processing Type 2, 4 or 7 - Accrued Interest         *   CSW003
     F*    40  - On if CSW003 = Y, + PDPMV NE 'WI', 'WO' or 'DT'      *   CSW003
     F*    41  - On if CSW003 = Y, + PDPMV NE 'WI' or 'WO'            *   CSW003
     F*    42  - Position Cursor                                      *
     F*    43  - If ON, the following are NOT displayed on 1st Screen *   CSW003
     F*          Instruction Type, Instruction Sub-Type, Euroclear/   *   CSW003
     F*          Cedel Code, Safekeeping Account, Requested Priority, *   CSW003
     F*          Guaranteed Delivery, Fungibility Code + Sender's Role*   CSW003
     F*    44  - If ON, the above are NOT displayed on 2nd Screen     *
     F*    45  - Switchable feature CSW098 is on or date is greater   *   CSW098
     F*          than 16 October 1998. Can also be error on call to   *   CSW098
     F*          SWIFT98.                                             *   CSW098
     F*    46  - Standard Instructions Override.                      *   CSW098
      *    47  - Standard Instructions Override non-display           *                       CSW201
     F*    48  - On if *IN39 = *ON and NOT called from MMRPDLSFL      *   CSE006
     F*    49  - On if *IN40 = *ON and NOT called from MMRPDLSFL      *   CSE006
     F*    50  - Control of call to ZM1100                            *
     F*    51  - CSE028 is switched on                                *                       CSE028
     F*    52  - CSE029 is switched on                                *                       CSE028
     F*    53  - If ON, do not display Euroclear/Clearstream code     *                       CSE034
     F*          on the 1st screen                                    *                       CSE034
     F*    54  - If ON, do not display Euroclear/Clearstream code     *                       CSE034
     F*          on the 2nd screen                                    *                       CSE034
     F*    60  - No record found on chain                             *
     F*    61  - Error on chain                                       *
     F*    68  - Error on file update                                 *
     F*    69  - Indicator for SFLEND in SE1807DF                     *
     F*    75  - General error in validation                          *
     F*    81  - Control of call to DBERRCTL                          *
     F*    85  - Work indicator                                       *
     F*    86  - Work indicator                                       *
     F*    89  - No record found on chain to retrieval index          *
     F*                                                               *
     F*    98  - Date Format: DDMMYY (off); MMDDYY (on)               *
     F*  90-99 - Used by Standard Subroutines                         *
     F*                                                               *
     F*  U7+U8 - Database Error                                       *
     F*                                                               *
     F*    KC  - End (exit to menu) requested                         *
     F*    KE  - Refresh requested                                    *
     F*    KL  - Previous screen requested                            *
     F*    KN  - Extended Settlements requested                       *
     F*    KS  - F18 - Override requested                             *
     F*    KT  - F19 - Reset Requested                                *
     F*                                                               *
     F*****************************************************************
      /TITLE SUBROUTINE INDEX
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*  SRINS  - Process Insert                                      *
     F*  SRAMD  - Process Amend                                       *
     F*  SRENQ  - Process Enquiry                                     *
     F*  SRSMSG - Routine to send messages to message subfile.        *
     F*  SRALOC - Routine to access record via update index           *
     F*  SRRTRN - Routine to set up return code for calling program   *
     F*  SRSCRN - Routine to handle screen                            *
     F*  SRVAL  - Routine to control validation of each field.        *
     F*  SRINZ  - Routine to initialize screen fields with defaults   *
     F*  INITRA - Routine to initialize Accrued Interest Rate Fields  *   CSW003
     F*  INTDER - Routine to initialize Exchange Rate Fields          *   CSW003
     F*  SRPRIC - Routine to Validate Price                           *   CSW003
     F*  SRTDER - Routine to Validate Exchange Rate                   *   CSW003
     F*  SRITRA - Routine to Validate Accrued Interest                *   CSW003
     F*  FMPRIC - Routine to Format Price                             *   CSW003
     F*  FMTDER - Routine to Format Exchange Rate                     *   CSW003
     F*  FMITRA - Routine to Format Accrued Interest                  *   CSW003
     F*  SRFTOS - Routine to move file fields to screen fields        *
     F*  SRSTOF - Routine to move screen fields to file fields        *
     F*  SD2WF -  SR to Move Start Date Screen Fields to Work Fields  *   CSW003
     F*  MD2WF -  SR to Move Mat. Date Screen Fields to Work Fields   *   CSW003
     F*  WF2SD -  SR to Move Work Fields to Start Date Screen Fields  *   CSW003
     F*  WF2MD -  SR to Move Work Fields to Mat. Date Screen Fields   *   CSW003
     F*  SRSD2F - Routine to move Start Date fields to file fields    *   CSW003
     F*  SRMD2F - Routine to move Mat. Date fields to file fields     *   CSW003
     F*  WRPRER - Routine to write Price and Exchange Rate to File    *   CSW003
     F*  WRITRA - Routine to write Accrued Interest to File           *   CSW003
     F*  SRPOSS - ROUTINE TO CALL EXTENDED SETTLEMENTS PROGRAM        *
     F*  SR1100 - DETERMINE NETWORK AND ADDRESSES                     *
     F*  SRGMES - VALIDATE SETTLEMENT MESSAGE REQUEST                 *
     F*  SRINST - VALIDATE INSTRUCTIONS TYPE (SINST)                  *
     F*  SRINSS - VALIDATE INSTRUCTIONS SUB-TYPE (SINSS)              *
     F*  SREUCL - VALIDATE EUROCLEAR/CEDEL CODE (SEUCL)               *
     F*  SRSAFA - VALIDATE SAFEKEEPING ACCOUNT (SSAFA)                *
     F*  SRRPTY - VALIDATE REQUESTED PRIORITY FIELD (SRPTY)           *
     F*  SRFIND - Routine to validate Free or against payment Ind.    *
     F*  SRGMEC - VALIDATE CONFIRMATION MESSAGE REQUEST               *
     F*  SRTRTT - VALIDATE TIME OF TRADE FIELD (STRTT)                *
     F*  SRGDEL - VALIDATE GUARANTEED DELIVERY FIELD (SGDEL)          *
     F*  SRFCOD - VALIDATE FUNGIBILITY CODE FIELD (SRPTY)             *
     F*  SRSROL - VALIDATE SENDER'S ROLE (SSROL)                      *
     F*  SRINIT - Routine to handle initial processing                *
     F*  *PSSR  - Routine to handle database errors                   *
     F*  ZALIGN - Validate and Right Align Numeric Fields.            *   CSW003
     F*  ZASIGN - Validate and Right Align Signed Numeric Fields.     *   CSW003
     F*  ZEDIT  - Insert d.p. + blank out leading zeros.              *   CSW003
     F*  ZSEDIT - Insert d.p. + sign + blank out leading zeros.       *   CSW003
     F*  ZNCD   - Determine Next Coupon Date (calls ZDATE1 + ZDATE2). *   CSW003
     F*  ZDATE1 - Validate and Convert Date to Day Number.            *   CSW003
     F*  ZDATE2 - Convert Day Number to Date.                         *   CSW003
     F*  ZEVCD  - Determine Event Control Date.                       *   CSW003
     F*  ZRATE  - Calculate Effective Interest Rate.                  *   CSW003
     F*  ZACCR  - Calculate Interest Accrued between 2 dates (calls   *   CSW003
     F*           ZDAYS + ZDYYR).                                     *   CSW003
     F*  ZDYYR  - Calculate no. of days in Interest Year (calls ZDAYS)*   CSW003
     F*  ZDAYS  - Calculate number of days between 2 dates.           *   CSW003
     F*  EUCLF  - Remove leading blanks from Euroclear/Cedel Code     *   CSW003
     F*                                                               *   CSW003
     F*  ZA0340 - Send a message to the program message queue         *
     F*  ZA0250 - Clear program message queue                         *
     F*                                                               *
     F*****************************************************************
     E/TITLE E-SPECIFICATIONS
     E                    CPY@    1   1 80
      ***  Array for Object Copyright Statement.
      *
     E                    EUCLA       6  1                                CSW003
     E                    EUCLB       6  1                                CSW003
      ***  Arrays to remove leading blanks from Euroclear/Cedel Code      CSW003
      *                                                                   CSW003
     E/COPY ZSRSRC,ZALIGNZ1
      * ZALIGN array
      *
     E/COPY ZSRSRC,ZSEDITZ1
      * ZSEDIT array
      *
     E/COPY ZSRSRC,ZASIGNZ1                                               CSW003
      * ZASIGN ARRAY                                                      CSW003
      *                                                                   CSW003
     E*COPY*ZSRSRC,ZDATE1Z1                                               CSW003
      * (Replaced by /COPY ZSRSRC,ZDATE2Z1 which has same arrays + 1 more)CSW003
      *
     E/COPY ZSRSRC,ZDATE2Z1                                               CSW003
      *                                                                   CSW003
     E/COPY ZSRSRC,ZDAYSZ1                                                CSW003
     E                    EU1         6  1
      * Array used to split SEUCL into individual characters
      *
     E                    ROU        12  1
      * Array used to move right Swift Id.
      *
     E                    MGFUN      50  1
      * Array used to check Fungibility Codes
      *
     E                    VA0    10  10  1
      * Array used in EUCL validations
      *
     E                    VA1    10  10  3
      * Array for Instructions type validation (alphabetic)
      *
     E                    VA2    10  30  3
      * Array for Cedel codes validation (numeric)
      *
     E                    VA3    10  20  3
      * Array for Euroclear codes validation (numeric)
      *
     E                    @MT         3  2                                CSE006
      * Array used to hold MT5xx message type                             CSE006
      *                                                                   CSE006
     E/COPY ZSRSRC,ZPOWER8Z1                                              CSW003
      *                                                                   CSW003
     E/COPY ZSRSRC,ZNCDZ1                                                 CSW003
      *                                                                   CSW003
      ** Array of Commitment Job Names                                                        CSC022
     E                    CMTJOB     10 10                                                    CSC022
     I/TITLE I-SPECIFICATIONS
      *                                                                   CSW003
     I/COPY ZSRSRC,ZNCDZ2                                                 CSW003
      *                                                                   CSW003
     I/COPY ZSRSRC,ZSEDITZ2
      * ZSEDIT data structure
      *
     I            DS
      * KMGECO data structure
     I                                        1  20 WWGECO
     I                                        1   5 WWSENT
     I                                        6  12 WWINST
     I                                       13  20 WWINSS
      *
     I           SDS
      * Get program name and window id from PSDS
     I                                     *PROGRAM WWPGM
     I                                      244 253 SJOB
     I                                      254 263 SUSER
      *
     I            DS
      * Euroclear/Cedel code validation
     I                                        1  10 SEUCL
     I                                        1   1 SEU11
     I                                        1   4 SEU14
     I                                        3   3 SEU33
     I                                        2   7 SEU27
     I                                        5   9 SEU59
     I                                        5  10 SEU51
     I            DS
      * Safekeeping Account
     I                                        1   6 SSAFA
     I                                        2   6 SSA26
      *
     I            DS                                                      ERR033
      ** Data Structure to set up field for chain to SDCUSTPD             ERR033
     I**********                              1   60WPTC1                 ERR033              CSD027
     I                                        1   6 WPTC1                                     CSD027
     I                                        1   6 WPTC2                 ERR033
      *                                                                   ERR033
     I            DS                                                      CSW003
      ** Data Structure to set up key list for chain to DPTMVDY1          CSW003
     I                                        1  17 DS002                 CSW003
     I            DS                                                      CSE028
      ** Work data structures for date reversals movement date in         CSE028
     I                                        1   60@WKIN                 CSE028
     I                                        1   20@WKIN1                CSE028
     I                                        3   40@WKIN2                CSE028
     I                                        5   60@WKIN3                CSE028
     I            DS                                                      CSE028
      ** Work data structures for date reversals movement date in         CSE028
     I                                        1   60@MVIN                 CSE028
     I                                        1   20@MVIN1                CSE028
     I                                        3   40@MVIN2                CSE028
     I                                        5   60@MVIN3                CSE028
     I            DS                                                      CSE028
      ** Work data structures for date reversals movement date out        CSE028
     I                                        1   60@WKOT                 CSE028
     I                                        1   20@WKOT1                CSE028
     I                                        3   40@WKOT2                CSE028
     I                                        5   60@WKOT3                CSE028
     I            DS                                                      CSE028
      ** Work data structures for date reversals movement date out        CSE028
     I                                        1   60@MVOT                 CSE028
     I                                        1   20@MVOT1                CSE028
     I                                        3   40@MVOT2                CSE028
     I                                        5   60@MVOT3                CSE028
     ISDSTRD    E DSSDSTRDPD                                              CSE028
     I** Securities Trading ICD                                           CSE028
      *                                                                   CSW003
     IDSFDY     E DSDSFDY
      ** First Data Structure for Access Objects
      *
     IDSSDY     E DSDSSDY
      ** Second Data Structure for Access Objects
      *
     ISDBANK    E DSSDBANKPD
      ** Bank Details
      *
     ISDCURR    E DSSDCURRPD                                              CSW003
      ** Currency Details                                                 CSW003
      *                                                                   CSW003
     ISDGELR    E DSSDGELRPD                                              CSW003
      ** General Ledger Details                                           CSW003
      *                                                                   CSW003
     ISCSARD    E DSSCSARDPD                                              CSW003
      ** Switchable Features                                              CSW003
      *                                                                   CSW003
     ISDSECS    E DSSDSECSPD
     I              QQACCD                          QQACD1                                    CGL029
      ** Security Customer Details
      *
     ISDCUST    E DSSDCUSTPD
     I** Customer details
      *
     IPDATA     E DSSE70DT
      ** Data structure to receive parameters from SE0070 for MT5xxs
      *
     IDBERR       DS                            256
      * Data structure for data-base error processing.
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     IDSSTD     E DSSTDSED                    2                           CSE028
      * Data structure for standard settlement instructions               CSE028
      * Renames for fields already defined                                CSE028
     I              LCD                             STDLCD                CSE028
      *                                                                   CSE028
     IDSADD     E DSSTDADSED                  8                           CSE028
      * Data structure for standard additional settlement details         CSE028
     IPMCWL       DS                           9999                                           CSD015
     IPTEMP       DS                           9999                                           CSD015
      ** Additional entry parameter for Midas Compliance Watch                                CSD015
      *                                                                                       CSD015
     ISCCMT       DS                            256                                           CSC022
     I                                        1   30CMTNUM                                    CSC022
     I                                        4 103 CMTARR                                    CSC022
      *                                                                                       CSC022
      *  Program data structure                                                               CSC022
      *                                                                                       CSC022
     I/COPY WNCPYSRC,SE1807I001
      /TITLE Main Processing
      *================================================================
      *  P R O G R A M     S T A R T                                  *
      *================================================================
      *
      ***  Perform Initialisation.
     C                     EXSR SRINIT
      *
      * Execute specific routine depending on action
     C           PACTN     CASEQ'I'       SRINS
     C           PACTN     CASEQ'A'       SRAMD
     C           PACTN     CASEQ'E'       SRENQ
     C           PACTN     CASEQ'D'       DEFLT                           CSE006
     C                     END
     C/COPY WNCPYSRC,SE1807C064
      *
      *================================================================
      *  P R O G R A M   E N D                                        *
      *                                                               *
      * Execute routine to setup return code and exit program
     C                     EXSR SRRTRN
      *                                                               *
      *================================================================
      /TITLE SR/SRINIT
      *****************************************************************
      *                                                               *
      * SRINIT - Routine to handle initial processing                 *
      *                                                               *
      *****************************************************************
      *
     C           SRINIT    BEGSR
      *
      **  Copyright Statement
     C                     MOVEACPY@      BIS@   80
      *
      * Get parameters from calling program
     C           *ENTRY    PLIST
     C                     PARM           PCMD    2
     C                     PARM           PERR    1
     C                     PARM           PDATA
     C                     PARM           MODE    1                       CSE006
     C                     PARM           MSGTPS 10                       CSE006
      *                                                                                       CSD015
      ** Added parameter for Midas Compliamce Watch                                           CSD015
      *                                                                                       CSD015
     C                     PARM           PMCWL                                               CSD015
      *                                                                   CSE006
      ** Blank out message types parameter                                CSE006
     C                     MOVE *BLANKS   MSGTPS                          CSE006
      *
      ** Set up action code for ('D') default mode                        CSE006
     C           MODE      IFEQ 'D'                                       CSE006
     C                     MOVE 'D'       PACTN                           CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      ** Set up Call From work field if called from Repo Maintenance      CSE006
     C           MODE      IFEQ 'M'                                       CSE006
     C                     MOVE 'CSE006'  @CFRM   6                       CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      ** Access Bank Details
     C                     CALL 'AOBANKR0'
     C                     PARM '*DBERR ' WRTCD   7
     C                     PARM '*FIRST ' WOPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
      *
     C                     MOVE BJMRDT    SDATE
      *                                                                   CSW003
      ** Access General Ledger Details                                    CSW003
     C**********           CALL 'AOGELRR0'                                             CSW003 CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR ' WRTCD                           CSW003
     C                     PARM '*FIRST ' WOPTN                           CSW003
     C********** SDGELR    PARM SDGELR    DSFDY                                        CSW003 CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
      *                                                                   CSE028
      * Access Securities Trading ICD                                     CSE028
      *                                                                   CSE028
     C                     EXSR AOSTRD                                    CSE028
      *                                                                   CSW003
      * Date format indicator
     C           BJDFIN    IFEQ 'M'
     C                     SETON                     98
     C                     END
     C/COPY WNCPYSRC,SE1807C018
      *
      ** Set up non-input capable screen fields
     C                     MOVE PACTN     SACTN
     C                     MOVE PDPSS     SDPSS
     C                     MOVE PDPRN     SDPRN
      *
      * Setup keys values using transaction data passed from caller
     C           KEY001    KLIST
     C                     KFLD           PDPSS
     C                     KFLD           PDPRN
     C                     KFLD           PWHEN   1                       CSW003
      *                                                                   CSW003
      ** Define Key List for Chaining to file INVTP.                      CSW003
     C           INVKA     KLIST                                          CSW003
     C                     KFLD           NMCY                            CSW003
     C                     KFLD           SITP                            CSW003
      *
     C                     MOVE PDPSS     DPDPSS
     C                     MOVE PDPRN     DPDPRN
      *
      * Initialise error indicators
     C                     SETOF                     303132
     C                     SETOF                     333435
     C                     SETOF                     75
      *
      * Retrieve Depot In Securities Trading info
     C                     MOVEL*BLANKS   CLAIE   1
     C                     MOVEL*BLANKS   CLAIC   1
     C                     MOVEL*BLANKS   DRAIE   6
     C                     MOVEL*BLANKS   DRAIC   6
      *
     C********** PDPID     IFNE 0                                                             CSD027
     C           PDPID     IFNE *BLANKS                                                       CSD027
     C                     MOVE PDPID     WWCUST  6
     C                     CALL 'AOSECSR0'
     C                     PARM '*DBERR ' WRTCD   7
     C                     PARM '*KEY   ' WOPTN   7
     C                     PARM           WWCUST
     C           SDSECS    PARM SDSECS    DSSDY
      *
     C           BFCLAS    IFEQ 'E'
     C                     MOVE 'E'       CLAIE
      *                                                                   CSE022
      ** BFDRF1 needs to be updated by the 1st 6 characters of BFNDR1.    CSE022
      *                                                                   CSE022
     C                     MOVELBFNDR1    BFDRF1                          CSE022
     C                     MOVELBFDRF1    DRAIE
     C                     END
      *
     C           BFCLAS    IFEQ 'C'
     C                     MOVE 'C'       CLAIC
      *                                                                   CSE022
      ** BFDRF2 needs to be updated by the 1st 6 characters of BFNDR2.    CSE022
      *                                                                   CSE022
     C                     MOVELBFNDR2    BFDRF2                          CSE022
     C                     MOVELBFDRF2    DRAIC
     C                     END
      *                                                                   CSW003
     C********** BFCLAS    IFEQ 'K'                                CSW003 CSE022
     C**********           MOVE 'K'       CLAIK   1                CSW003 CSE022
     C**********           ENDIF                                   CSW003 CSE022
      *                                                                   CSW003
     C                     END
      *
      * Retrieve Depot Out Securities Trading info
     C                     MOVE *BLANKS   CLAOE   1
     C                     MOVE *BLANKS   CLAOC   1
     C                     MOVEL*BLANKS   DRAOE   6
     C                     MOVEL*BLANKS   DRAOC   6
      *
     C********** PDPOD     IFNE 0                                                             CSD027
     C           PDPOD     IFNE *BLANKS                                                       CSD027
     C           PDPMV     IFNE 'RP'                                                          175115
     C           PDPMV     ANDNE'RR'                                                          175115
     C                     MOVE PDPOD     WWCUST
     C                     CALL 'AOSECSR0'
     C                     PARM '*DBERR ' WRTCD   7
     C                     PARM '*KEY   ' WOPTN   7
     C                     PARM           WWCUST
     C           SDSECS    PARM SDSECS    DSSDY
      *
     C           BFCLAS    IFEQ 'E'
     C                     MOVE 'E'       CLAOE
     C                     MOVELBFNDR1    BFDRF1                          CSE022
     C                     MOVELBFDRF1    DRAOE
     C                     END
      *
     C           BFCLAS    IFEQ 'C'
     C                     MOVE 'C'       CLAOC
     C                     MOVELBFNDR2    BFDRF2                          CSE022
     C                     MOVELBFDRF2    DRAOC
     C                     END
      *                                                                   CSW003
     C********** BFCLAS    IFEQ 'K'                                CSW003 CSE022
     C**********           MOVE 'K'       CLAOK   1                CSW003 CSE022
     C**********           ENDIF                                   CSW003 CSE022
     C                     ENDIF                                                              175115
      *                                                                   CSW003
     C                     END
      *
      * Determine classification of Beneficiary Customer (if relevant).   CSW003
     C********** PDPBN     IFNE *ZEROS                                                 CSW003 CSD027
     C           PDPBN     IFNE *BLANKS                                                       CSD027
     C                     MOVE PDPBN     WWCUST                          CSW003
      *                                                                   CSW003
     C                     CALL 'AOSECSR0'                                CSW003
     C                     PARM '*DBERR ' WRTCD                           CSW003
     C                     PARM '*KEY   ' WOPTN                           CSW003
     C                     PARM           WWCUST                          CSW003
     C           SDSECS    PARM SDSECS    DSSDY                           CSW003
      *                                                                   CSW003
     C                     MOVE BFCLAS    BCCLAS  1                       CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
      * Some Depot References start by a blank in SDSECSPD |
     C                     MOVELDRAIE     WWDRA1  1
     C           WWDRA1    IFEQ ' '
     C                     MOVE DRAIE     WWDRA5  5
     C                     MOVEL*BLANKS   DRAIE
     C                     MOVELWWDRA5    DRAIE
     C                     END
     C                     MOVELDRAIC     WWDRA1
     C           WWDRA1    IFEQ ' '
     C                     MOVE DRAIC     WWDRA5
     C                     MOVEL*BLANKS   DRAIC
     C                     MOVELWWDRA5    DRAIC
     C                     END
     C                     MOVELDRAOE     WWDRA1
     C           WWDRA1    IFEQ ' '
     C                     MOVE DRAOE     WWDRA5
     C                     MOVEL*BLANKS   DRAOE
     C                     MOVELWWDRA5    DRAOE
     C                     END
     C                     MOVELDRAOC     WWDRA1
     C           WWDRA1    IFEQ ' '
     C                     MOVE DRAOC     WWDRA5
     C                     MOVEL*BLANKS   DRAOC
     C                     MOVELWWDRA5    DRAOC
     C                     END
      *
      ** Initialize non-screen fields
     C                     MOVE 'N'       DPCONG
     C                     MOVE 'N'       DPRCDG
     C                     Z-ADD*ZEROS    DPLSWS
     C                     Z-ADD*ZEROS    DPLSSC
     C                     Z-ADDBJRDNB    DPLCD
      *
      **  Define save fields for Settlement/Confirmation messages.
     C           *LIKE     DEFN SGMES     SVGMES
     C           *LIKE     DEFN SGMEC     SVGMEC
      *                                                                   CSW003
      ** Check if (CSW003) MT5XX - Phase 2 Message Generation is on.      CSW003
      *                                                                   CSW003
     C                     CALL 'AOSARDR0'                                CSW003
     C                     PARM '*BLANKS' WRTCD                           CSW003
     C                     PARM '*VERIFY' WOPTN                           CSW003
     C                     PARM 'CSW003'  @SARD   6                       CSW003
     C           SCSARD    PARM SCSARD    DSFDY                           CSW003
      *                                                                   CSW003
     C           WRTCD     IFEQ *BLANKS                                   CSW003
     C                     MOVE 'Y'       CSW003  1                       CSW003
      *                                                                   CSW003
      ** Access Currency Details                                          CSW003
     C                     CALL 'AOCURRR0'                                CSW003
     C                     PARM '*DBERR ' @RTCD   7                       CSW003
     C                     PARM '*KEY   ' @OPTN   7                       CSW003
     C                     PARM PNMCY     @AJCD   3                       CSW003
     C           SDCURR    PARM SDCURR    DSSDY                           CSW003
     C                     Z-ADDA6NBDP    WWCDP   10                      CSW003
      *                                                                   CSW003
      ** Determine Securities Processing Type and whether to display      CSW003
      ** 'Accrued Interest Field' - *IN39 *ON if displayed.               CSW003
     C                     EXSR SRPROT                                    CSW003
     C                     ENDIF                                          CSW003
     C/COPY WNCPYSRC,SE1807C001
      *                                                                                       CSE034
      ** Check if CSE028 feature is installed                                                 CSE034
      *                                                                                       CSE034
     C                     MOVE 'N'       CSE028  1                                           CSE034
     C                     MOVE *OFF      *IN51                                               CSE034
     C                     CALL 'AOSARDR0'                                                    CSE034
     C                     PARM '       ' @RTCD                                               CSE034
     C                     PARM '*VERIFY' @OPTN                                               CSE034
     C                     PARM 'CSE028'  @SARD                                               CSE034
      *                                                                                       CSE034
     C           @RTCD     IFNE *BLANKS                                                       CSE034
     C           @RTCD     ANDNE'*NRF   '                                                     CSE034
     C                     MOVEL'08'      DBASE                                               CSE034
     C                     MOVEL'SE1807'  DBPGM                                               CSE034
     C                     MOVEL'SCSARDPD'DBFILE                                              CSE034
     C                     MOVEL@SARD     DBKEY                                               CSE034
     C                     EXSR *PSSR                                                         CSE034
     C                     ENDIF                                                              CSE034
      *                                                                                       CSE034
     C           @RTCD     IFEQ *BLANK                                                        CSE034
     C                     MOVE 'Y'       CSE028                                              CSE034
     C                     MOVE *ON       *IN51                                               CSE034
     C                     ENDIF                                                              CSE034
      *                                                                                       CSE034
      *                                                                   CSW003
      ** If CSW003 on, and not 'Walk In', 'Walk Out' move *ON *IN41 to '  CSW003
      ** allow display of 'Maturity Date' Screen.                      '  CSW003
     C           CSW003    IFEQ 'Y'                                       CSW003
     C           PDPMV     IFNE 'WI'                                      CSW003
     C           PDPMV     ANDNE'WO'                                      CSW003
     C                     MOVE *ON       *IN41                           CSW003
      ** If not 'Depot Transfer' display Price and Exchange Rate Fields.  CSW003
     C           PDPMV     IFNE 'DT'                                      CSW003
     C                     MOVE *ON       *IN40                           CSW003
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSE006
     C           *IN40     IFEQ *ON                                       CSE006
     C           @CFRM     ANDNE'CSE006'                                  CSE006
     C                     MOVE *ON       *IN49                           CSE006
     C                     ELSE                                           CSE006
     C                     MOVE *OFF      *IN49                           CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSW003
     C           PDPMV     IFNE 'RP'                                      CSW003
     C           PDPMV     ANDNE'RR'                                      CSW003
     C           PDPMV     ANDNE'PD'                                      CSW003
     C           PDPMV     ANDNE'PL'                                      CSW003
      ** NON-display of Destination of Confirmation and Confirmation      CSW003
      ** Message Request.                                                 CSW003
     C                     MOVE *ON       *IN20                           CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
      ** Determine remaining fields to display in First Screen.           CSW003
     C           PDPMV     IFEQ 'WI'                                      CSW003
     C           PDPMV     OREQ 'BB'                                      CSW003
     C           PDPMV     OREQ 'BL'                                      CSW003
     C           PDPMV     OREQ 'RR'                                      CSW003
     C           PDPMV     OREQ 'RP'                                      CSW003
     C           PDPMV     OREQ 'PD'                                      CSW003
     C           PDPMV     OREQ 'PL'                                      CSW003
     C           CLAIE     IFEQ 'E'                                       CSW003
      ** NON-display Fungibility Code in First Screen.                    CSW003
     C                     MOVE *ON       *IN28                           CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C           CLAIC     IFNE 'C'                                       CSW003
     C           CLAIE     ANDNE'E'                                       CSW003
      ** NON-display the following fields in First Screen -               CSW003
      ** Instruction Type, Instruction Sub-Type, Euroclear/Cedel Code,    CSW003
      ** Safekeeping Account, Requested Priority, Guaranteed Delivery,    CSW003
      ** Fungibility Code and Sender's Role.                              CSW003
     C           CSE028    IFNE 'Y'                                                           CSE034
     C                     MOVE *ON       *IN43                           CSW003
     C                     ENDIF                                                              CSE034
     C                     MOVE *ON       *IN53                                               CSE034
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
      *                                                                   CSW003
      ** Determine remaining fields to display in Second Screen.          CSW003
     C           PDPMV     IFEQ 'BB'                                      CSW003
     C           PDPMV     OREQ 'BL'                                      CSW003
     C           PDPMV     OREQ 'RR'                                      CSW003
     C           PDPMV     OREQ 'RP'                                      CSW003
     C           PDPMV     OREQ 'PD'                                      CSW003
     C           PDPMV     OREQ 'PL'                                      CSW003
     C           CLAIE     IFEQ 'E'                                       CSW003
      ** NON-display Fungibility Code in Second Screen.                   CSW003
     C                     MOVE *ON       *IN29                           CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C           CLAIC     IFNE 'C'                                       CSW003
     C           CLAIE     ANDNE'E'                                       CSW003
      ** NON-display the following fields in Second Screen -              CSW003
      ** Instruction Type, Instruction Sub-Type, Euroclear/Cedel Code,    CSW003
      ** Safekeeping Account, Requested Priority, Guaranteed Delivery,    CSW003
      ** Fungibility Code and Sender's Role.                              CSW003
     C           CSE028    IFNE 'Y'                                                           CSE034
     C                     MOVE *ON       *IN44                           CSW003
     C                     ENDIF                                                              CSE034
     C                     MOVE *ON       *IN54                                               CSE034
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C           PDPMV     IFEQ 'WO'                                      CSW003
     C           CLAOE     IFEQ 'E'                                       CSW003
      ** NON-display Fungibility Code in First Screen.                    CSW003
     C                     MOVE *ON       *IN28                           CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C           CLAOC     IFNE 'C'                                       CSW003
     C           CLAOE     ANDNE'E'                                       CSW003
      ** NON-display the following fields in First Screen -               CSW003
      ** Instruction Type, Instruction Sub-Type, Euroclear/Cedel Code,    CSW003
      ** Safekeeping Account, Requested Priority, Guaranteed Delivery,    CSW003
      ** Fungibility Code and Sender's Role.                              CSW003
     C           CSE028    IFNE 'Y'                                                           CSE034
     C                     MOVE *ON       *IN43                           CSW003
     C                     ENDIF                                                              CSE034
     C                     MOVE *ON       *IN53                                               CSE034
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C           PDPMV     IFEQ 'DT'                                      CSW003
     C           CLAOE     IFEQ 'E'                                       CSW003
      ** NON-display Fungibility Code in 'FROM' Screen.                   CSW003
     C                     MOVE *ON       *IN28                           CSW003
     C                     ENDIF                                          CSW003
     C           CLAIE     IFEQ 'E'                                       CSW003
      ** NON-display Fungibility Code in 'TO' Screen.                     CSW003
     C                     MOVE *ON       *IN29                           CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C           CLAOC     IFNE 'C'                                       CSW003
     C           CLAOE     ANDNE'E'                                       CSW003
      ** NON-display the following fields in 'FROM' Screen -              CSW003
      ** Instruction Type, Instruction Sub-Type, Euroclear/Cedel Code,    CSW003
      ** Safekeeping Account, Requested Priority, Guaranteed Delivery,    CSW003
      ** Fungibility Code and Sender's Role.                              CSW003
     C           CSE028    IFNE 'Y'                                                           CSE034
     C                     MOVE *ON       *IN43                           CSW003
     C                     ENDIF                                                              CSE034
     C                     MOVE *ON       *IN53                                               CSE034
     C                     ENDIF                                          CSW003
     C           CLAIC     IFNE 'C'                                       CSW003
     C           CLAIE     ANDNE'E'                                       CSW003
      ** NON-display the above fields in 'TO' Screen.                     CSW003
     C           CSE028    IFNE 'Y'                                                           CSE034
     C                     MOVE *ON       *IN44                           CSW003
     C                     ENDIF                                                              CSE034
     C                     MOVE *ON       *IN54                                               CSE034
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW098
      ** Check to see if switchable feature CSW098 is on or if date is    CSW098
      ** greater than 16 October 1998.                                    CSW098
     C                     CALL 'SWIFT98'              45                 CSW098
     C                     PARM           SWRTN   7                       CSW098
      *                                                                   CSW098
     C           *IN45     IFEQ *ON                        ***************CSW098
     C                     MOVEL'07'      DBASE            **DB ERROR 007*CSW098
     C                     MOVEL'SE1807'  DBPGM            ***************CSW098
     C                     MOVEL'ERR CALL'DBFILE                          CSW098
     C                     MOVEL'SWIFT98' DBKEY                           CSW098
     C                     EXSR *PSSR                                     CSW098
     C                     ENDIF                                          CSW098
      *                                                                   CSW098
     C           SWRTN     IFEQ 'CSW098 '                                 CSW098
     C                     MOVE *ON       *IN45                           CSW098
     C                     ELSE                                           CSW098
     C                     MOVE *OFF      *IN45                           CSW098
     C                     ENDIF                                          CSW098
      *                                                                                       CSW201
      ** Check if enhancement CSW201 is on                                                    CSW201
      *                                                                                       CSW201
     C                     CALL 'SWIF2001'             9090                                   CSW201
     C                     PARM *BLANKS   WRTCD                                               CSW201
      *                                                                                       CSW201
     C           *IN90     IFEQ '1'                        ***************                    CSW201
     C                     MOVEL'08'      DBASE            **DB ERROR 008*                    CSW201
     C                     MOVEL'SE1807'  DBPGM            ***************                    CSW201
     C                     MOVEL'ERR CALL'DBFILE                                              CSW201
     C                     MOVEL'SWIF2001'DBKEY                                               CSW201
     C                     EXSR *PSSR                                                         CSW201
     C                     ELSE                                                               CSW201
      *                                                                                       CSW201
     C           WRTCD     IFEQ 'CSW2001'                                                     CSW201
     C                     MOVE 'Y'       CSW201  1                                           CSW201
     C                     MOVE '1'       *IN47                                               CSW201
     C                     ELSE                                                               CSW201
     C                     MOVE 'N'       CSW201                                              CSW201
     C                     MOVE '0'       *IN47                                               CSW201
     C                     ENDIF                                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C/COPY WNCPYSRC,SE1807C065
      *                                                                   CSW098
      ***Check*if*CSE028*feature is installed                             CSE028              CSE034
      *********************                                               CSE028              CSE034
     C*********************MOVE 'N'       CSE028  1                       CSE028              CSE034
     C*********************MOVE *OFF      *IN51                           CSE028              CSE034
     C*********************CALL 'AOSARDR0'                                CSE028              CSE034
     C*********************PARM '       ' @RTCD                           CSE028              CSE034
     C*********************PARM '*VERIFY' @OPTN                           CSE028              CSE034
     C*********************PARM 'CSE028'  @SARD                           CSE028              CSE034
      *********************                                               CSE028              CSE034
     C***********@RTCD*****IFNE *BLANKS                                   CSE028              CSE034
     C***********@RTCD*****ANDNE'*NRF   '                                 CSE028              CSE034
     C*********************MOVEL'08'      DBASE                           CSE028              CSE034
     C*********************MOVEL'SE1807'  DBPGM                           CSE028              CSE034
     C*********************MOVEL'SCSARDPD'DBFILE                          CSE028              CSE034
     C*********************MOVEL@SARD     DBKEY                           CSE028              CSE034
     C*********************EXSR *PSSR                                     CSE028              CSE034
     C*********************ENDIF                                          CSE028              CSE034
      *********************                                               CSE028              CSE034
     C***********@RTCD*****IFEQ *BLANK                                    CSE028              CSE034
     C*********************MOVE 'Y'       CSE028                          CSE028              CSE034
     C*********************MOVE *ON       *IN51                           CSE028              CSE034
     C*********************ENDIF                                          CSE028              CSE034
      *                                                                   CSE028
      * Check if CSE029 is present.                                       CSE028
      *                                                                   CSE028
     C                     MOVE 'N'       CSE029  1                       CSE028
     C                     MOVE *OFF      *IN52                           CSE028
     C                     CALL 'AOSARDR0'                                CSE028
     C                     PARM '       ' @RTCD                           CSE028
     C                     PARM '*VERIFY' @OPTN                           CSE028
     C                     PARM 'CSE029'  @SARD                           CSE028
      *                                                                   CSE028
     C           @RTCD     IFNE *BLANKS                                   CSE028
     C           @RTCD     ANDNE'*NRF   '                                 CSE028
     C                     MOVEL'09'      DBASE                           CSE028
     C                     MOVEL'SE1807'  DBPGM                           CSE028
     C                     MOVEL'SCSARDPD'DBFILE                          CSE028
     C                     MOVEL@SARD     DBKEY                           CSE028
     C                     EXSR *PSSR                                     CSE028
     C                     ENDIF                                          CSE028
      *                                                                   CSE028
     C           @RTCD     IFEQ *BLANK                                    CSE028
     C                     MOVE 'Y'       CSE029                          CSE028
     C                     MOVE *ON       *IN52                           CSE028
     C                     ENDIF                                          CSE028
      *                                                                                       CSE033
      ** Check if CSE033 is present.                                                          CSE033
      *                                                                                       CSE033
     C                     MOVE 'N'       CSE033  1                                           CSE033
     C                     CALL 'AOSARDR0'                                                    CSE033
     C                     PARM '       ' @RTCD                                               CSE033
     C                     PARM '*VERIFY' @OPTN                                               CSE033
     C                     PARM 'CSE033'  @SARD                                               CSE033
      *                                                                                       CSE033
     C           @RTCD     IFNE *BLANKS                                                       CSE033
     C           @RTCD     ANDNE'*NRF   '                                                     CSE033
     C                     MOVEL'10'      DBASE                                               CSE033
     C                     MOVEL'SE1807'  DBPGM                                               CSE033
     C                     MOVEL'SCSARDPD'DBFILE                                              CSE033
     C                     MOVEL@SARD     DBKEY                                               CSE033
     C                     EXSR *PSSR                                                         CSE033
     C                     ENDIF                                                              CSE033
      *                                                                                       CSE033
     C           @RTCD     IFEQ *BLANK                                                        CSE033
     C                     MOVE 'Y'       CSE033                                              CSE033
     C                     ENDIF                                                              CSE033
      *                                                                                       CSE033
     C           CSE033    IFEQ 'Y'                                                           CSE033
     C           CSE029    ANDEQ'N'                                                           CSE033
     C                     MOVE 'Y'       CSE029                                              CSE033
     C                     MOVE *ON       *IN52                                               CSE033
     C                     ENDIF                                                              CSE033
      *                                                                                       CSW202
      ** Check if CSW202 is switched on                                                       CSW202
      *                                                                                       CSW202
     C                     MOVE 'N'       CSW202  1                                           CSW202
     C                     MOVE *OFF      *IN53                                               CSW202
     C                     CALL 'SWIF2002'                                                    CSW202
     C                     PARM *BLANKS   @RTCD                                               CSW202
      *                                                                                       CSW202
     C           @RTCD     IFEQ 'CSW2002'                                                     CSW202
     C                     MOVE 'Y'       CSW202                                              CSW202
     C                     MOVE *ON       *IN53                                               CSW202
     C                     ENDIF                                                              CSW202
      *                                                                   CSE028
      * Save fields for screen SE1807SD if defaulting from SESSIR0.       CSE028
     C           *LIKE     DEFN SDROUS    DFROUS                          CSE028
     C           *LIKE     DEFN SDROTS    DFROTS                          CSE028
     C           *LIKE     DEFN SDGMES    DFGMES                          CSE028
     C           *LIKE     DEFN SD1522    DF1522                          CSE028
     C           *LIKE     DEFN SDINST    DFINST                          CSE028
     C           *LIKE     DEFN SDINSS    DFINSS                          CSE028
     C           *LIKE     DEFN SDEUCL    DFEUCL                          CSE028
     C           *LIKE     DEFN SDSAFA    DFSAFA                          CSE028
     C           *LIKE     DEFN SDFIND    DFFIND                          CSE028
     C           *LIKE     DEFN SDPRIC    DFPRIC                          CSE028
     C           *LIKE     DEFN SDTRTT    DFTRTT                          CSE028
     C           *LIKE     DEFN SDTDER    DFTDER                          CSE028
     C           *LIKE     DEFN SDRPTY    DFRPTY                          CSE028
     C           *LIKE     DEFN SDITRA    DFITRA                          CSE028
     C           *LIKE     DEFN SDGDEL    DFGDEL                          CSE028
     C           *LIKE     DEFN SDSROL    DFSROL                          CSE028
     C           *LIKE     DEFN SDFCOD    DFFCOD                          CSE028
     C           *LIKE     DEFN SDROUC    DFROUC                          CSE028
     C           *LIKE     DEFN SDROTC    DFROTC                          CSE028
     C           *LIKE     DEFN SDGMEC    DFGMEC                          CSE028
     C           *LIKE     DEFN SDSTST    DFSTST                          CSE028
     C           *LIKE     DEFN SDSIOR    DFSIOR                          CSE028
     C           *LIKE     DEFN SDTRRM    DFTRRM                          CSE028
     C           *LIKE     DEFN SDCHID    DFCHID                          CSE028
      *                                                                   CSE028
      ** If PERR is 'M', change this to 'N' . Set a flag that                                 201231
      ** will bypass validation checking when amending ISO15022                               201231
      ** indicator.                                                                           201231
      *                                                                                       201231
     C                     MOVEL'N'       WB1522  1                                           201231
     C           PERR      IFEQ 'M'                                                           201231
     C                     MOVEL'N'       PERR                                                201231
     C                     MOVEL'Y'       WB1522                                              201231
     C                     ENDIF                                                              201231
      *                                                                                       201231
      ** If action is Insert and record is already existing, then change                      201429
      ** action from 'I' to 'A' to avoid writing of duplicate records                         201429
      ** in the extension files.                                                              201429
      *                                                                                       201429
     C           PACTN     IFEQ 'I'                                                           201429
     C           CSW003    IFEQ 'Y'                                                           246912
     C                     MOVEL'S'       PWHEN                                               201429
     C                     ELSE                                                               246912
     C                     MOVEL' '       PWHEN                                               246912
     C                     ENDIF                                                              246912
     C           KEY001    CHAINRTVIDX               01                                       201429
     C           *IN01     IFEQ *OFF                                                          201429
     C                     MOVEL'A'       PACTN                                               201429
     C                     MOVE PACTN     SACTN                                               246912
     C                     ENDIF                                                              201429
     C                     ENDIF                                                              201429
      *                                                                                       246912
      ** If in Amend mode, program is called from Repo, and the ext.                          246912
      ** record is not found in file SEDMRPX1, switch to Insert mode                          246912
      *                                                                                       246912
     C           PACTN     IFEQ 'A'                                                           246912
     C           CSW003    IFEQ 'Y'                                                           246912
     C                     MOVEL'S'       PWHEN                                               246912
     C                     ELSE                                                               246912
     C                     MOVEL' '       PWHEN                                               246912
     C                     ENDIF                                                              246912
     C           KEY001    CHAINRTVIDX               01                                       246912
     C           *IN01     IFEQ '1'                                                           246912
     C                     MOVEL'I'       PACTN                                               246912
     C                     MOVE PACTN     SACTN                                               246912
     C                     ENDIF                                                              246912
     C                     ENDIF                                                              246912
      *                                                                                       CSC022
      ** Check if CSC022 is switched *ON.                                                     CSC022
      *                                                                                       CSC022
     C                     CALL 'AOSARDR0'                                                    CSC022
     C                     PARM *BLANKS   @RTCD                                               CSC022
     C                     PARM '*VERIFY' @OPTN                                               CSC022
     C                     PARM 'CSC022'  @SARD                                               CSC022
     C           SCSARD    PARM SCSARD    DSFDY                                               CSC022
      *                                                                                       CSC022
     C                     MOVE 'N'       CSC022  1                                           CSC022
     C                     MOVE 'N'       CMTSKP  1                                           CSC022
     C           @RTCD     IFEQ *BLANKS                                                       CSC022
     C                     MOVE 'Y'       CSC022                                              CSC022
     C           *NAMVAR   DEFN SCCMTJOB  SCCMT                                               CSC022
     C                     IN   SCCMT                                                         CSC022
     C                     Z-ADD1         C       30                                          CSC022
     C                     MOVEACMTARR    CMTJOB                                              CSC022
     C           CMTNUM    IFGT 0                                                             CSC022
     C           C         DOWLECMTNUM                                                        CSC022
     C           CMTSKP    ANDEQ'N'                                                           CSC022
     C           SJOB      IFEQ CMTJOB,C                                                      CSC022
     C                     MOVE 'Y'       CMTSKP                                              CSC022
     C                     ENDIF                                                              CSC022
     C                     ADD  1         C                                                   CSC022
     C                     ENDDO                                                              CSC022
     C                     ENDIF                                                              CSC022
     C                     ELSE                                                               CSC022
     C                     MOVE 'N'       CSC022                                              CSC022
     C                     ENDIF                                                              CSC022
      *                                                                                       201429
      ** Access Switchable Features file to determine if CSE031 is                          MD057247
      ** installed in the system.                                                           MD057247
      *                                                                                     MD057247
     C                     CALL 'AOSARDR0'                                                  MD057247
     C                     PARM           URTNCD  7                                         MD057247
     C                     PARM '*VERIFY' UOPTN   7                                         MD057247
     C                     PARM 'CSE031'  UUKEY   6                                         MD057247
     C                     PARM           UDSFDY 76                                         MD057247
      *                                                                                     MD057247
     C                     MOVE 'N'       CSE031  1                                         MD057247
     C           URTNCD    IFEQ *BLANKS                                                     MD057247
     C                     MOVE 'Y'       CSE031                                            MD057247
     C                     ENDIF                                                            MD057247
      *                                                                                     MD057247
      ** Access Switchable Features file to determine if CSE071 is                          MD057247
      ** installed in the system.                                                           MD057247
      *                                                                                     MD057247
     C                     CALL 'AOSARDR0'                                                  MD057247
     C                     PARM           URTNCD                                            MD057247
     C                     PARM '*VERIFY' UOPTN                                             MD057247
     C                     PARM 'CSE071'  UUKEY                                             MD057247
     C                     PARM           UDSFDY                                            MD057247
      *                                                                                     MD057247
     C                     MOVE 'N'       CSE071  1                                         MD057247
     C           URTNCD    IFEQ *BLANKS                                                     MD057247
     C                     MOVE 'Y'       CSE071                                            MD057247
     C                     ENDIF                                                            MD057247
      *                                                                                     MD057247
     C                     ENDSR
      *                                                               *   CSE028
      *================================================================   CSE028
      /TITLE SR/AOSTRD                                                    CSE028
      *****************************************************************   CSE028
      *                                                               *   CSE028
      * AOSTRD - Access object : Securities Trading ICD               *   CSE028
      *                                                               *   CSE028
      *****************************************************************   CSE028
      *                                                                   CSE028
     C           AOSTRD    BEGSR                                          CSE028
      *                                                                   CSE028
     C                     CALL 'AOSTRDR0'                                CSE028
     C                     PARM '*DBERR ' @RTCD   7                       CSE028
     C                     PARM '*FIRST ' @OPTN   7                       CSE028
     C           SDSTRD    PARM SDSTRD    DSSDY                           CSE028
      *                                                                   CSE028
     C                     ENDSR                                          CSE028
      *
      *****************************************************************
      /TITLE SR/SRINS
      *****************************************************************
      *                                                               *
      * SRINS - Routine to handle 'INSERT' action                     *
      *                                                               *
      *****************************************************************
      *
     C           SRINS     BEGSR
      *
      * Initialize fields
     C                     MOVE 'S'       PWHEN                           CSW003
     C                     MOVE 'N'       WPROC   1                                           201230
     C                     EXSR SRINZ
     C/COPY WNCPYSRC,SE1807C002
      *                                                                   CSW003
      * Move Work Fields to Screen Fields.                                CSW003
     C                     EXSR WF2SD                                     CSW003
      *                                                                   CSE028
      * If screen fields were defaulted from program SESSIR0              CSE028
      * then save screen fields for comparison later.                     CSE028
     C           CSE028    IFEQ 'Y'                                       CSE028
     C           Z         ANDNE0                                         CSE028
     C                     MOVE SDROUS    DFROUS                          CSE028
     C                     MOVE SDROTS    DFROTS                          CSE028
     C                     MOVE SDGMES    DFGMES                          CSE028
     C                     MOVE SD1522    DF1522                          CSE028
     C                     MOVE SDINST    DFINST                          CSE028
     C                     MOVE SDINSS    DFINSS                          CSE028
     C                     MOVE SDEUCL    DFEUCL                          CSE028
     C                     MOVE SDSAFA    DFSAFA                          CSE028
     C                     MOVE SDFIND    DFFIND                          CSE028
     C                     MOVE SDPRIC    DFPRIC                          CSE028
     C                     MOVE SDTRTT    DFTRTT                          CSE028
     C                     MOVE SDTDER    DFTDER                          CSE028
     C                     MOVE SDRPTY    DFRPTY                          CSE028
     C                     MOVE SDITRA    DFITRA                          CSE028
     C                     MOVE SDGDEL    DFGDEL                          CSE028
     C                     MOVE SDSROL    DFSROL                          CSE028
     C                     MOVE SDFCOD    DFFCOD                          CSE028
     C                     MOVE SDROUC    DFROUC                          CSE028
     C                     MOVE SDROTC    DFROTC                          CSE028
     C                     MOVE SDGMEC    DFGMEC                          CSE028
     C                     MOVE SDSTST    DFSTST                          CSE028
     C                     MOVE SDSIOR    DFSIOR                          CSE028
     C                     MOVE SDTRRM    DFTRRM                          CSE028
     C                     MOVE SDCHID    DFCHID                          CSE028
     C                     ENDIF                                          CSE028
      *                                                                   CSW003
      ** If CSW003 = 'Y' and PDPMV not 'WI', 'WO' or 'DT' and not         CSW003
      ** processing types 2,4 or 7 *IN39 is *ON.                          CSW003
      ** Initialize Accrued Interest Field                                CSW003
     C           *IN39     IFEQ *ON                                       CSW003
     C                     EXSR INITRA                                    CSW003
     C** Store Mat. Date Interest Rate in case F12 pressed.               CSW003
     C                     MOVE MDITRA    ITRA12 15                       CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
      ** If CSW003='Y' + PDPMV Type not 'WI','WO' or 'DT' *IN40 is *ON.   CSW003
      ** Initialize Exchange Rate Field                                   CSW003
     C           *IN40     IFEQ *ON                                       CSW003
     C                     EXSR INTDER                                    CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
      * Position cursor
     C                     SETON                     42
      *
      ** Handle screens until F3, F5 or F12 taken or no errors
      ** INDICATOR 61 AND 60 ALWAYS OFF (SRALOC)                          CSW003
     C           *IN61     DOUEQ'0'
     C           *IN60     ANDEQ'0'
     C           *IN75     ANDEQ'0'
     C           *INKN     ANDEQ'0'
     C           *INKC     OREQ '1'
     C           *INKE     OREQ '1'
     C           *INKL     OREQ '1'
      *
      ** If F14 (for Extended Settlements) NOT taken then display
      ** screen; else call program to handle Extended Settlements
     C           *INKN     IFEQ '0'
     C***********CSW003    IFEQ 'Y'                                       CSW003              CAP087
     C                     MOVE 'S'       PWHEN                           CSW003
     C***********          ENDIF                                          CSW003              CAP087
     C                     EXSR SRSCRN
     C                     END
     C/COPY WNCPYSRC,SE1807C066
      *
      ** If F14 (for Extended Settlements) taken then call program
      ** to handle Extended Settlements
     C           *INKN     IFEQ '1'
     C                     EXSR SRPOSS
     C                     SETOF                     KN
      *
      * if F3 taken in SE1808 (trade lost) return to menu;
     C           PCMD      IFEQ '03'
     C                     MOVE '1'       *INKC
     C                     END
      *
      * if F5 taken in SE1808 return to initial screen;
     C           PCMD      IFEQ '05'
     C                     MOVE '1'       *INKE
     C                     END
      *
      * If F12 taken in SE1808 (data lost) or if F14 taken (to Exit
      * Extended Settlements) (data kept) or if error code not 'N'
      * then redisplay screen;
     C           PCMD      IFEQ '12'
     C           PCMD      OREQ '14'
     C           PERR      ORNE 'N'
      *                                                                                       201230
      ** If F12 taken and ISO1522 is 'Y', call SE1808 again to                                201230
      ** write record in DPTMVDX2.                                                            201230
     C           PCMD      IFEQ '12'                                                          201230
     C           SD1522    ANDEQ'Y'                                                           201230
     C           SDGMES    ANDEQ'Y'                                                           201230
     C           CSE028    ANDEQ'Y'                                                           201230
     C           Z         ANDEQ0                                                             201230
     C                     CALL 'SE1808'                                                      201230
     C                     PARM '00'      PCMD                                                201230
     C                     PARM 'N'       PERR                                                201230
     C                     PARM           PDATA                                               201230
     C                     PARM           PWHEN                                               201230
     C                     PARM 'Y'       PMODE   1                                           201230
     C                     PARM SDSAFA    PSAFA   5                                           201230
     C                     PARM *BLANKS   PTEMP                                               CSD015
      *                                                                                       CSD015
     C                     CAT  PTEMP:0   PMCWL                                               CSD015
     C                     ENDIF                                                              201230
      *                                                                                       201230
     C                     MOVE 'S'       PWHEN                           CSW003
     C                     EXSR SRSCRN
     C/COPY WNCPYSRC,SE1807C019
     C                     CALL 'ZA0250'
     C                     MOVEL*ON       *INKN                           204920
     C/COPY WNCPYSRC,SE1807C020
     C                     END
      *                                                                                       201230
     C           PCMD      IFEQ '00'                                                          201230
     C           PERR      ANDEQ'N'                                                           201230
     C           SD1522    ANDEQ'Y'                                                           201230
     C           SDGMES    ANDEQ'Y'                                                           201230
     C           CSE028    ANDEQ'Y'                                                           201230
     C                     MOVEL'Y'       WPROC                                               201230
     C                     ENDIF                                                              201230
      *
      * (else <enter> taken so validate Trade Extension Input)
     C                     END
      *
      * De-Position cursor
     C                     SETOF                     42
      *
      ** If F3, F5, F12 and F14 NOT taken then continue
      ** (else repeat 'do until' loop).
     C           *INKC     IFEQ '0'
     C           *INKE     ANDEQ'0'
     C           *INKL     ANDEQ'0'
     C           *INKN     ANDEQ'0'
      *
      * Clear messages for redisplay
     C/COPY WNCPYSRC,SE1807C021
     C                     CALL 'ZA0250'
     C/COPY WNCPYSRC,SE1807C022
      *                                                                   CSW003
      * Move Screen Input Fields to Work Fields (except Price, Accrued    CSW003
      * Interest and Exchange Rate).                                      CSW003
     C                     EXSR SD2WF                                     CSW003
      *
      * Validate input
     C                     EXSR SRVAL
     C/COPY WNCPYSRC,SE1807C063
      *                                                                   CSE028
      * If no errors from validation of SE1807SD                          CSE028
     C           *IN75     IFEQ *OFF                                      CSE028
      *                                                                                       201230
      ** Write ext. sett. method if Sett. Msg. Requested                                      201230
      ** is 'Y' and ISO15022 is 'Y'.                                                          201230
      *                                                                                       201230
     C           SD1522    IFEQ 'Y'                                                           201230
     C           SDGMES    ANDEQ'Y'                                                           201230
     C           CSE028    ANDEQ'Y'                                                           201230
     C           WPROC     ANDNE'Y'                                                           201230
      *                                                                                       201230
      * If default data has been accessed via SESSIR0                     CSE028
     C           Z         IFNE 0                                         CSE028
      *                                                                                       201230
      ** Set up parameter fields to be passed to SE1808.                                      201230
     C                     MOVE WWSENT    PSENT                                               201230
     C                     MOVE SDGMES    PGMES                                               201230
     C                     MOVE SGMEC     PGMEC                                               201230
     C                     MOVE SFIND     PFIND                                               201230
     C                     MOVE SD1522    PSNEW                                               201230
      *                                                                                       201230
      * If screen default data has not been changed and re-prompt = no    CSE028
     C           SDROUS    IFEQ DFROUS                                    CSE028
     C           SDROTS    ANDEQDFROTS                                    CSE028
     C           SDGMES    ANDEQDFGMES                                    CSE028
     C           SD1522    ANDEQDF1522                                    CSE028
     C           SDINST    ANDEQDFINST                                    CSE028
     C           SDINSS    ANDEQDFINSS                                    CSE028
     C           SDEUCL    ANDEQDFEUCL                                    CSE028
     C           SDSAFA    ANDEQDFSAFA                                    CSE028
     C           SDFIND    ANDEQDFFIND                                    CSE028
     C           SDPRIC    ANDEQDFPRIC                                    CSE028
     C           SDTRTT    ANDEQDFTRTT                                    CSE028
     C           SDTDER    ANDEQDFTDER                                    CSE028
     C           SDRPTY    ANDEQDFRPTY                                    CSE028
     C           SDITRA    ANDEQDFITRA                                    CSE028
     C           SDGDEL    ANDEQDFGDEL                                    CSE028
     C           SDSROL    ANDEQDFSROL                                    CSE028
     C           SDFCOD    ANDEQDFFCOD                                    CSE028
     C           SDROUC    ANDEQDFROUC                                    CSE028
     C           SDROTC    ANDEQDFROTC                                    CSE028
     C           SDGMEC    ANDEQDFGMEC                                    CSE028
     C           SDSTST    ANDEQDFSTST                                    CSE028
     C           SDSIOR    ANDEQDFSIOR                                    CSE028
     C           SDTRRM    ANDEQDFTRRM                                    CSE028
     C           SDCHID    ANDEQDFCHID                                    CSE028
     C           BVREDE    ANDEQ'N'                                       CSE028
     C                     CALL 'SE1808'                                  CSE028
     C                     PARM '00'      PCMD                            CSE028
     C                     PARM 'N'       PERR                            CSE028
     C                     PARM           PDATA                           CSE028
     C                     PARM           PWHEN                           CSE028
     C                     PARM 'Y'       PMODE   1                       CSE028
     C                     PARM SDSAFA    PSAFA                                               201230
     C                     PARM *BLANKS   PTEMP                                               CSD015
      *                                                                                       CSD015
     C                     CAT  PTEMP:0   PMCWL                                               CSD015
     C                     ELSE                                           CSE028
     C                     MOVE 'Y'       WPROC                                               201230
     C**********           CALL 'SE1808'                            CSE028204920
     C**********           PARM '00'      PCMD                      CSE028204920
     C**********           PARM 'N'       PERR                      CSE028204920
     C**********           PARM           PDATA                     CSE028204920
     C**********           PARM           PWHEN                     CSE028204920
     C**********           PARM 'N'       PMODE                     CSE028204920
     C**********           PARM SDSAFA    PSAFA                     201230204920
      *                                                                   204920
     C                     EXSR SRPOSS                                    204920
      *                                                                   204920
      * if F3 taken in SE1808 (trade lost) return to menu;                204920
     C           PCMD      IFEQ '03'                                      204920
     C                     MOVE '1'       *INKC                           204920
     C                     END                                            204920
      *                                                                   204920
      * if F5 taken in SE1808 return to initial screen;                   204920
     C           PCMD      IFEQ '05'                                      204920
     C                     MOVE '1'       *INKE                           204920
     C                     END                                            204920
      *                                                                   204920
      * If F12 taken in SE1808 (data lost) or if F14 taken (to Exit       204920
      * Extended Settlements) (data kept) or if error code not 'N'        204920
      * then redisplay screen;                                            204920
     C           PCMD      IFEQ '12'                                      204920
     C           PCMD      OREQ '14'                                      204920
     C           PERR      ORNE 'N'                                       204920
      *                                                                   204920
      ** If F12 taken and ISO1522 is 'Y', call SE1808 again to            204920
      ** write record in DPTMVDX2.                                        204920
     C           PCMD      IFEQ '12'                                      204920
     C           SD1522    ANDEQ'Y'                                       204920
     C           SDGMES    ANDEQ'Y'                                       204920
     C           CSE028    ANDEQ'Y'                                       204920
     C           Z         ANDEQ0                                         204920
     C                     CALL 'SE1808'                                  204920
     C                     PARM '00'      PCMD                            204920
     C                     PARM 'N'       PERR                            204920
     C                     PARM           PDATA                           204920
     C                     PARM           PWHEN                           204920
     C                     PARM 'Y'       PMODE   1                       204920
     C                     PARM SDSAFA    PSAFA   5                       204920
     C                     PARM *BLANKS   PTEMP                                               CSD015
      *                                                                                       CSD015
     C                     CAT  PTEMP:0   PMCWL                                               CSD015
     C                     ENDIF                                          204920
      *                                                                   204920
     C                     MOVE 'S'       PWHEN                           204920
     C                     EXSR SRSCRN                                    204920
     C                     CALL 'ZA0250'                                  204920
     C                     MOVE *ON       *INKN                           204920
     C                     ITER                                           204920
     C                     END                                            204920
      *                                                                   204920
     C           PCMD      IFEQ '00'                                      204920
     C           PERR      ANDEQ'N'                                       204920
     C           SD1522    ANDEQ'Y'                                       204920
     C           SDGMES    ANDEQ'Y'                                       204920
     C           CSE028    ANDEQ'Y'                                       204920
     C                     MOVEL'Y'       WPROC                           204920
     C                     ENDIF                                          204920
      *                                                                   204920
     C                     ENDIF                                          CSE028
      *                                                                                       201230
      ** No SSI set up then display Extended settlement screen.                               201230
     C                     ELSE                                                               201230
     C**********           MOVE 'Y'       WPROC                           204920              201230
     C**********           MOVE *ON       *INKN                           204920              201230
     C                     EXSR SRPOSS                                    204920
      *                                                                   204920
      * if F3 taken in SE1808 (trade lost) return to menu;                204920
     C           PCMD      IFEQ '03'                                      204920
     C                     MOVE '1'       *INKC                           204920
     C                     END                                            204920
      *                                                                   204920
      * if F5 taken in SE1808 return to initial screen;                   204920
     C           PCMD      IFEQ '05'                                      204920
     C                     MOVE '1'       *INKE                           204920
     C                     END                                            204920
      *                                                                   204920
      * If F12 taken in SE1808 (data lost) or if F14 taken (to Exit       204920
      * Extended Settlements) (data kept) or if error code not 'N'        204920
      * then redisplay screen;                                            204920
     C           PCMD      IFEQ '12'                                      204920
     C           PCMD      OREQ '14'                                      204920
     C           PERR      ORNE 'N'                                       204920
      *                                                                   204920
      ** If F12 taken and ISO1522 is 'Y', call SE1808 again to            204920
      ** write record in DPTMVDX2.                                        204920
     C           PCMD      IFEQ '12'                                      204920
     C           SD1522    ANDEQ'Y'                                       204920
     C           SDGMES    ANDEQ'Y'                                       204920
     C           CSE028    ANDEQ'Y'                                       204920
     C           Z         ANDEQ0                                         204920
     C                     CALL 'SE1808'                                  204920
     C                     PARM '00'      PCMD                            204920
     C                     PARM 'N'       PERR                            204920
     C                     PARM           PDATA                           204920
     C                     PARM           PWHEN                           204920
     C                     PARM 'Y'       PMODE   1                       204920
     C                     PARM SDSAFA    PSAFA   5                       204920
     C                     PARM *BLANKS   PTEMP                                               CSD015
      *                                                                                       CSD015
     C                     CAT  PTEMP:0   PMCWL                                               CSD015
     C                     ENDIF                                          204920
      *                                                                   204920
     C                     MOVE 'S'       PWHEN                           204920
     C                     EXSR SRSCRN                                    204920
     C                     CALL 'ZA0250'                                  204920
     C                     MOVE *ON       *INKN                           204920
     C                     ITER                                           204920
     C                     END                                            204920
      *                                                                   204920
     C           PCMD      IFEQ '00'                                      204920
     C           PERR      ANDEQ'N'                                       204920
     C           SD1522    ANDEQ'Y'                                       204920
     C           SDGMES    ANDEQ'Y'                                       204920
     C           CSE028    ANDEQ'Y'                                       204920
     C                     MOVEL'Y'       WPROC                           204920
     C                     ENDIF                                          204920
      *                                                                   204920
     C                     ENDIF                                          CSE028
      *                                                                                       201230
     C                     ENDIF                                                              201230
     C                     ENDIF                                          CSE028
      *                                                                   CSW003
     C           *INKC     IFEQ '0'                                       204920
     C           *INKE     ANDEQ'0'                                       204920
     C           *INKL     ANDEQ'0'                                       204920
     C           *INKN     ANDEQ'0'                                       204920
      *                                                                   204920
      ** If CSW003 = 'Y' and PDPMV Type not 'WI','WO' *IN41 is *ON.       CSW003
     C           *IN41     IFEQ *ON                                       CSW003
      ** And no errors on Validation.                                     CSW003
     C           *IN75     ANDEQ*OFF                                      CSW003
     C/COPY WNCPYSRC,SE1807C023
     C                     CALL 'ZA0250'                                  CSW003
     C/COPY WNCPYSRC,SE1807C024
      *                                                                   CSW003
     C           *INKC     DOUEQ*ON                                       CSW003
     C           *INKL     OREQ *ON                                       CSW003
     C           *INKN     OREQ *OFF                                      CSW003
     C           *IN75     ANDEQ*OFF                                      CSW003
     C           *INKN     IFEQ *OFF                                      CSW003
     C/COPY WNCPYSRC,SE1807C025
     C                     WRITESE1807C1                                  CSW003
     C/COPY WNCPYSRC,SE1807C026
     C                     MOVE 'M'       PWHEN                           CSW003
      ** Store Start Date Cedel/Euroclear Destination for F12 pressed     CSW003
     C                     MOVELWWSENT    TMPSEN  5                       CSW003
      ** Store Start Date Clearance Type for F12 pressed                  CSW003
     C                     MOVELWWCLTY    TMPCLT  2                       CSW003
     C                     EXSR SRINZ                                     CSW003
     C/COPY WNCPYSRC,SE1807C003
      *                                                                   CSE028
      ** If CSE028 is installed and data defaulted from SESSIR0           CSE028
      ** Move data returned from call to SESSIR0 to screen fields         CSE028
      ** Data structure occurence to use depends on movement type         CSE028
      ** from SE70DT (can be 7-8)                                         CSE028
      *                                                                   CSE028
      ** IF Z not set then we have no data from SESSIR0 so                CSE028
      ** use normal defaulting.                                           CSE028
      *                                                                   CSE028
     C           CSE028    IFEQ 'Y'                                       CSE028
     C           Z         ANDNE0                                         CSE028
      *                                                                   CSE028
     C                     SELEC                                          CSE028
     C           @MVIN     WHGT @MVOT                                     CSE028
      * Depot in second screen                                            CSE028
     C                     Z-ADD7         Z                               CSE028
     C           @MVIN     WHLT @MVOT                                     CSE028
      * Depot out second screen                                           CSE028
     C                     Z-ADD8         Z                               CSE028
     C                     ENDSL                                          CSE028
      *                                                                   CSE028
     C           Z         OCUR DSADD                                     CSE028
      * Destination of settlement                                         CSE028
      * (Not done from SESSIR0)                                           CSE028
      *                                                                   CSE028
      * Settlement message request                                        CSE028
     C                     MOVE SAGMES    MDGMES                          CSE028
      * ISO15022 Messages indicator                                       CSE028
     C           CSE029    IFEQ 'Y'                                       CSE028
     C                     MOVE SNEW      MD1522                          CSE028
     C                     ENDIF                                          CSE028
      * Instruction type                                                  CSE028
     C                     MOVE SAINST    MDINST                          CSE028
      * Instruction sub-type                                              CSE028
     C                     MOVE SAINSS    MDINSS                          CSE028
      * Euroclear/Cedel code                                              CSE028
      * (Not done from SESSIR0)                                           CSE028
      *                                                                   CSE028
      * Safekeeping Account                                               CSE028
      *                                                                   CSE028
     C                     MOVELSKAC      MDSAFA                                              CSE028
      * Free or against Payment                                           CSE028
     C                     MOVE SAFIND    MDFIND                          CSE028
      * Price                                                             CSE028
     C                     MOVE PMKTP     ZFIELD                          CSE028
     C                     Z-ADD8         ZADEC                           CSE028
     C                     EXSR ZEDIT                                     CSE028
     C                     MOVE ZFIELD    MDPRIC                          CSE028
      * Time of transaction                                               CSE028
     C                     MOVE STRTT     MDTRTT                          CSE028
      * Exchange rate                                                     CSE028
      * (Not done from SESSIR0)                                           CSE028
      *                                                                   CSE028
      * Requested priority                                                CSE028
     C                     MOVE SARPTY    MDRPTY                          CSE028
      * Accrued interest                                                  CSE028
      * (Not done from SESSIR0)                                           CSE028
      *                                                                   CSE028
      * Guaranteed delivery                                               CSE028
     C                     MOVE SAGDEL    MDGDEL                          CSE028
      * Senders role                                                      CSE028
     C                     MOVE SASROL    MDSROL                          CSE028
      * Fungibility code                                                  CSE028
      * (Not done from SESSIR0)                                           CSE028
      *                                                                   CSE028
      * Destination of confirmation                                       CSE028
      * (Not done from SESSIR0)                                           CSE028
      *                                                                   CSE028
      * Confirmation message request                                      CSE028
     C                     MOVE SACONG    MDGMEC                          CSE028
      * Stamp status                                                      CSE028
     C                     MOVE SASTMP    MDSTST                          CSE028
      * Standing instructions override                                    CSE028
      * (Not done from SESSIR0)                                           CSE028
      *                                                                   CSE028
      * Transaction report marker                                         CSE028
     C                     MOVE SATRRM    MDTRRM                          CSE028
      * Charity identifier                                                CSE028
     C                     MOVE SACHID    MDCHID                          CSE028
      *                                                                   CSE028
     C                     ENDIF                                          CSE028
      *                                                                   CSE028
      * Move Work Fields to Screen Fields.                                CSW003
     C                     EXSR WF2MD                                     CSW003
      * Move relevent Start Date Fields to Maturity Date fields.          CSW003
     C                     MOVE SDTRTT    MDTRTT                          CSW003
     C                     MOVE SDFIND    MDFIND                          CSW003
     C           PDPMV     IFNE 'DT'                                      CSW003
     C                     MOVE *BLANKS   MDROUS                          CSW003
     C                     MOVE SDROUS    MDROUS                          CSW003
     C                     MOVE *BLANKS   MDROTS                          CSW003
     C                     MOVE SDROTS    MDROTS                          CSW003
     C                     MOVE *BLANKS   MDGMES                          CSW003
     C                     MOVE SDGMES    MDGMES                          CSW003
     C           *IN43     IFEQ *OFF                                      CSW003
     C           *IN44     ANDEQ*OFF                                      CSW003
     C*********************MOVE SDEUCL    MDEUCL                          CSW003              CSE034
     C                     MOVE SDSAFA    MDSAFA                          CSW003
     C                     ENDIF                                          CSW003
     C           *IN53     IFEQ *OFF                                                          CSE034
     C           *IN54     ANDEQ*OFF                                                          CSE034
     C                     MOVE SDEUCL    MDEUCL                                              CSE034
     C                     ENDIF                                                              CSE034
     C                     ENDIF                                          CSW003
     C           *IN43     IFEQ *OFF                                      CSW003
     C           *IN44     ANDEQ*OFF                                      CSW003
     C                     MOVE SDRPTY    MDRPTY                          CSW003
     C                     MOVE SDGDEL    MDGDEL                          CSW003
     C                     MOVE SDSROL    MDSROL                          CSW003
     C                     MOVE SDFCOD    MDFCOD                          CSW003
     C                     ENDIF                                          CSW003
     C           *IN40     IFEQ *ON                                       CSW003
     C                     MOVE SDPRIC    MDPRIC                          CSW003
     C                     MOVE SDTDER    MDTDER                          CSW003
     C/COPY WNCPYSRC,SE1807C010
     C                     ENDIF                                          CSW003
     C           *IN20     IFEQ *OFF                                      CSW003
     C                     MOVE SDROUC    MDROUC                          CSW003
     C                     MOVE SDROTC    MDROTC                          CSW003
     C                     MOVE 'N'       MDGMEC                          CSW003
      *                                                                   CSW098
     C           CSW201    IFEQ 'N'                                                           CSW201
     C           SWRTN     IFEQ 'CSW098 '                                 CSW098
     C                     MOVE 'N'       MDSIOR                          CSW098
     C                     ENDIF                                          CSW098
     C                     ENDIF                                                              CSW201
      *                                                                   CSW098
     C                     ENDIF                                          CSW003
     C/COPY WNCPYSRC,SE1807C027
     C                     EXFMTSE1807MD                                  CSW003
     C/COPY WNCPYSRC,SE1807C028
     C                     EXSR MD2WF                                     CSW003
     C/COPY WNCPYSRC,SE1807C029
     C                     CALL 'ZA0250'                                  CSW003
     C/COPY WNCPYSRC,SE1807C030
     C                     EXSR SRVAL                                     CSW003
      *                                                                   CSE028
      *                                                                   CSE028
      * If no errors from validation of SE1807MD                          CSE028
     C           *IN75     IFEQ *OFF                                      CSE028
     C           *INKL     ANDEQ'0'                                       204920
      * If default data has been accessed via SESSIR0                     CSE028
     C           Z         IFNE 0                                         CSE028
      * If screen default data has not been changed and re-prompt = no    CSE028
     C           MDROUS    IFEQ DFROUS                                    CSE028
     C           MDROTS    ANDEQDFROTS                                    CSE028
     C           MDGMES    ANDEQDFGMES                                    CSE028
     C           MD1522    ANDEQDF1522                                    CSE028
     C           MDINST    ANDEQDFINST                                    CSE028
     C           MDINSS    ANDEQDFINSS                                    CSE028
     C           MDEUCL    ANDEQDFEUCL                                    CSE028
     C           MDSAFA    ANDEQDFSAFA                                    CSE028
     C           MDFIND    ANDEQDFFIND                                    CSE028
     C           MDPRIC    ANDEQDFPRIC                                    CSE028
     C           MDTRTT    ANDEQDFTRTT                                    CSE028
     C           MDTDER    ANDEQDFTDER                                    CSE028
     C           MDRPTY    ANDEQDFRPTY                                    CSE028
     C           MDITRA    ANDEQDFITRA                                    CSE028
     C           MDGDEL    ANDEQDFGDEL                                    CSE028
     C           MDSROL    ANDEQDFSROL                                    CSE028
     C           MDFCOD    ANDEQDFFCOD                                    CSE028
     C           MDROUC    ANDEQDFROUC                                    CSE028
     C           MDROTC    ANDEQDFROTC                                    CSE028
     C           MDGMEC    ANDEQDFGMEC                                    CSE028
     C           MDSTST    ANDEQDFSTST                                    CSE028
     C           MDSIOR    ANDEQDFSIOR                                    CSE028
     C           MDTRRM    ANDEQDFTRRM                                    CSE028
     C           MDCHID    ANDEQDFCHID                                    CSE028
     C           BVREDE    ANDEQ'N'                                       CSE028
     C                     CALL 'SE1808'                                  CSE028
     C                     PARM '00'      PCMD                            CSE028
     C                     PARM 'N'       PERR                            CSE028
     C                     PARM           PDATA                           CSE028
     C                     PARM           PWHEN                           CSE028
     C                     PARM 'Y'       PMODE   1                       CSE028
     C                     PARM SDSAFA    PSAFA                                               201230
     C                     PARM *BLANKS   PTEMP                                               CSD015
      *                                                                                       CSD015
     C                     CAT  PTEMP:0   PMCWL                                               CSD015
     C                     ELSE                                           CSE028
     C**********           CALL 'SE1808'                            CSE028204920
     C**********           PARM '00'      PCMD                      CSE028204920
     C**********           PARM 'N'       PERR                      CSE028204920
     C**********           PARM           PDATA                     CSE028204920
     C**********           PARM           PWHEN                     CSE028204920
     C**********           PARM 'N'       PMODE                     CSE028204920
     C**********           PARM SDSAFA    PSAFA                           204920              201230
     C                     EXSR SRPOSS                                    204920
     C           PCMD      IFEQ '03'                                      204920
     C                     MOVE *ON       *INKC                           204920
     C                     ENDIF                                          204920
     C           PCMD      IFEQ '12'                                      204920
     C           PCMD      OREQ '14'                                      204920
     C           PERR      ORNE 'N'                                       204920
     C                     MOVE 'M'       PWHEN                           204920
     C                     EXSR SRSCRN                                    204920
     C           *INKL     IFEQ '0'                                       204920
     C                     MOVEL*ON       *INKN                           204920
     C                     ENDIF                                          204920
     C                     CALL 'ZA0250'                                  204920
     C                     ITER                                           204920
     C                     ENDIF                                          204920
      *                                                                   204920
     C                     ENDIF                                          CSE028
      *                                                                   204920
     C                     ELSE                                           204920
     C                     EXSR SRPOSS                                    204920
     C           PCMD      IFEQ '03'                                      204920
     C                     MOVE *ON       *INKC                           204920
     C                     ENDIF                                          204920
     C           PCMD      IFEQ '12'                                      204920
     C           PCMD      OREQ '14'                                      204920
     C           PERR      ORNE 'N'                                       204920
     C                     MOVE 'M'       PWHEN                           204920
     C                     EXSR SRSCRN                                    204920
     C           *INKL     IFEQ '0'                                       204920
     C                     MOVEL*ON       *INKN                           204920
     C                     ENDIF                                          204920
     C                     CALL 'ZA0250'                                  204920
     C                     ITER                                           204920
     C                     ENDIF                                          204920
      *                                                                   204920
     C                     ENDIF                                          CSE028
     C                     ENDIF                                          CSE028
      *                                                                   CSE028
      * Else Call  Extended Settlements Pgm.                              CSW003
     C                     ELSE                                           CSW003
     C                     EXSR SRPOSS                                    CSW003
     C                     MOVE *OFF      *INKN                           CSW003
     C           PCMD      IFEQ '03'                                      CSW003
     C                     MOVE *ON       *INKC                           CSW003
     C                     ENDIF                                          CSW003
     C           PCMD      IFEQ '12'                                      CSW003
     C           PCMD      OREQ '14'                                      CSW003
     C           PERR      ORNE 'N'                                       CSW003
     C                     MOVE 'M'       PWHEN                           CSW003
     C                     EXSR SRSCRN                                    CSW003
     C/COPY WNCPYSRC,SE1807C031
     C                     CALL 'ZA0250'                                  CSW003
     C           *INKL     IFEQ '0'                                       204920
     C                     MOVEL*ON       *INKN                           204920
     C                     ENDIF                                          204920
     C/COPY WNCPYSRC,SE1807C032
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
     C                     ENDDO                                          CSW003
      *                                                                   CSW003
      ** If Cmd 3 pressed exit DO loop.                                   CSW003
     C           *INKC     IFEQ *ON                                       CSW003
     C                     LEAVE                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
      ** If Cmd 12 pressed redisplay first screen.                        CSW003
     C           *INKL     IFEQ *ON                                       CSW003
     C                     MOVE *OFF      *INKL                           CSW003
     C                     MOVEA'00000'   *IN,21                          CSW003
     C                     MOVEA'00'      *IN,26                          CSW003
     C                     MOVEA'000'     *IN,30                          CSW003
     C                     MOVEA'00000'   *IN,34                          CSW003
     C                     MOVE *ON       *IN75                           CSW003
      ** Restore prev determined Cedel/Euroclear Dest + Clearance Type.   CSW003
     C                     MOVELTMPSEN    WWSENT                          CSW003
     C                     MOVELTMPCLT    WWCLTY                          CSW003
     C/COPY WNCPYSRC,SE1807C033
     C                     CALL 'ZA0250'                                  CSW003
     C/COPY WNCPYSRC,SE1807C034
      *                                                                   CSW003
      ** Restore default values to Maturity Date Screen.                  CSW003
      ** If CSW003 = 'Y' and PDPMV not 'WI', 'WO' or 'DT' and not         CSW003
      ** processing types 2,4 or 7 *IN39 is *ON - Acc. Interest Displayed.CSW003
     C           *IN39     IFEQ *ON                                       CSW003
     C                     MOVE ITRA12    MDITRA                          CSW003
     C                     ENDIF                                          CSW003
     C                     ITER                                           CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C           *IN75     IFEQ *OFF                                      CSW003
      ** Write SD details to file fields (except Price, AI + ER)          CSW003
     C                     EXSR SRSD2F                                    CSW003
      ** Write SD Accrued Interest to file.                               CSW003
     C                     MOVE 'S'       PWHEN                           CSW003
     C           *IN39     IFEQ *ON                                       CSW003
     C                     EXSR WRITRA                                    CSW003
     C                     ENDIF                                          CSW003
     C           *IN40     IFEQ *ON                                       CSW003
      ** Write SD Price and Exchange Rate to file.                        CSW003
     C***********          ENDIF                                    CSW003164481
     C                     EXSR WRPRER                                    CSW003
     C                     ENDIF                                          164481
     C                     WRITEUPDIDX                 68                 CSW003
      *                                                                   CSW003
      ** Write MD details to file fields (except Price, AI + ER)          CSW003
     C                     EXSR SRMD2F                                    CSW003
      ** Write MD Accrued Interest to file.                               CSW003
     C                     MOVE 'M'       PWHEN                           CSW003
     C           *IN39     IFEQ *ON                                       CSW003
     C                     EXSR WRITRA                                    CSW003
     C                     ENDIF                                          CSW003
      ** Write MD Price and Exchange Rate to file.                        CSW003
     C           *IN40     IFEQ *ON                                       CSW003
     C                     EXSR WRPRER                                    CSW003
     C                     ENDIF                                          CSW003
     C                     WRITEUPDIDX                 68                 CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ELSE                                           CSW003
      *                                                                   CSW003
      ** Check safekeeping account if entered on the second screen                            201429
     C           *IN75     IFEQ '0'                                                           201429
     C                     EXSR SRVAL2                                                        201429
     C                     ENDIF                                                              201429
      *
      ** If no errors on validation move screen fields to file fields;
      ** write new record.
     C           *IN75     IFEQ '0'
     C           *INKN     ANDEQ'0'                                                           201230
     C                     EXSR SRSTOF
     C                     WRITEUPDIDX                 68
     C                     END
     C***********          END                                            CSW003
      *
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          204920
      *                                                                   CSW003
     C                     END                                            CSW003
      *
     C                     END
      *
      * Reset override indicators
     C                     MOVE ' '       OVER1   1
     C                     MOVE ' '       OVER2   1
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/SRAMD
      *****************************************************************
      *                                                               *
      * SRAMD - Routine to handle 'AMEND' action                      *
      *                                                               *
      *****************************************************************
      *
     C           SRAMD     BEGSR
      *
      * Check whether record exists
     C***********CSW003    IFEQ 'Y'                                       CSW003              CAP087
     C                     MOVE 'S'       PWHEN                           CSW003
     C***********          ENDIF                                          CSW003              CAP087
     C                     MOVE 'N'       WPROC                                               201429
      *                                                                   CSW003
     C           KEY001    CHAINRTVIDX               89
      *
      ** If record not found then setup message, protect fields for
      ** display, display screen and handle database error.
     C********** *IN89     IFEQ '1'                                                           190743
      *
     C**********           MOVEL'SEW9999' ZAMSID                                              190743
     C**********           EXSR SRSMSG                                                        190743
      *
     C**********           SETON                     09                                       190743
      *                                                                   CSW003
     C**********           EXSR SRSCRN                                                        190743
      *
     C***********          MOVEL'DPTMVDX1'DBFILE           ***************                    190743
     C***********          Z-ADD1         DBASE            * DB ERROR 01 *                    190743
     C***********          MOVELPDPSS     DBFLD  16        ***************                    190743
     C***********          MOVE PDPRN     DBFLD                                               190743
     C***********CSW003    IFEQ 'Y'                                       CSW003              190743
     C***********          MOVELDBFLD     DS002                           CSW003              190743
     C***********          MOVE PWHEN     DS002                           CSW003              190743
     C***********          MOVELDS002     DBKEY                           CSW003              190743
     C***********          ELSE                                           CSW003              190743
     C***********          MOVELDBFLD     DBKEY                                               190743
     C***********          ENDIF                                          CSW003              190743
     C***********          EXSR *PSSR                                                         190743
      *
     C***********          ELSE                                                               190743
      *
      ***Else,*record*found,*so*set*file*fields*to*screen fields          CSW003
      ** Move file fields to work fields.                                 CSW003
     C                     EXSR SRFTOS
      *                                                                                       204661
     C           SFIND     IFEQ *BLANKS                                                       204661
     C           PDPMV     IFEQ 'BB'                                                          204661
     C           PDPMV     OREQ 'BL'                                                          204661
     C                     MOVE 'F'       SFIND                                               204661
     C                     ELSE                                                               204661
     C                     MOVE 'A'       SFIND                                               204661
     C                     ENDIF                                                              204661
     C                     ENDIF                                                              204661
      ** Store Start Date Cedel/Euroclear Destination for F12 pressed     CSW003
     C                     MOVELWWSENT    TMPSEN                          CSW003
      ** Store Start Date Clearance Type for F12 pressed                  CSW003
     C                     MOVELWWCLTY    TMPCLT                          CSW003
      *                                                                   CSW003
      ** If CSW003='Y'+ not processing types 2,4 or 7 *IN39 is *ON.    .  CSW003
      ** Format Accrued Interest Field.                                   CSW003
     C           *IN39     IFEQ *ON                                       CSW003
     C                     EXSR FMITRA                                    CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
      ** If CSW003='Y' + DPMV Type not 'WI','WO' or 'DT' *IN40 is *ON.    CSW003
      ** Format Price and Exchange Rate Fields.                           CSW003
     C           *IN40     IFEQ *ON                                       CSW003
     C                     EXSR FMPRIC                                    CSW003
     C                     EXSR FMTDER                                    CSW003
     C                     ENDIF                                          CSW003
      **                                                                  CSW003
      ** Move work fields to Start Date Screen Fields except Price,ER+AI. CSW003
     C                     EXSR WF2SD                                     CSW003
      *                                                                   CSW003
      ** If change of Clearance Type blank out non-displayed fields.      CSW003
     C           *IN28     IFEQ *ON                                       CSW003
     C                     MOVE *BLANKS   SDFCOD                          CSW003
     C                     ENDIF                                          CSW003
     C           *IN43     IFEQ *ON                                       CSW003
     C                     MOVE *BLANKS   SDFCOD                          CSW003
     C                     MOVE *BLANKS   SDINST                          CSW003
     C                     MOVE *BLANKS   SDINSS                          CSW003
     C*********************MOVE *BLANKS   SDEUCL                          CSW003              CSE034
     C                     MOVE *BLANKS   SDSAFA                          CSW003
     C                     MOVE *BLANKS   SDRPTY                          CSW003
     C                     MOVE *BLANKS   SDGDEL                          CSW003
     C                     MOVE *BLANKS   SDSROL                          CSW003
     C                     ENDIF                                          CSW003
     C           *IN53     IFEQ *ON                                                           CSE034
     C                     MOVE *BLANKS   SDEUCL                                              CSE034
     C                     ENDIF                                                              CSE034
     C           *IN40     IFEQ *OFF                                      CSW003
     C                     MOVE *BLANKS   SDPRIC                          CSW003
     C                     MOVE *BLANKS   SDTDER                          CSW003
     C                     ENDIF                                          CSW003
      **                                                                  CSW003
      ** Handle screens until F3, F5 or F12 taken or no errors & no
      ** Warning messages.
     C           *IN61     DOUEQ'0'
     C           *IN60     ANDEQ'0'
     C           *IN75     ANDEQ'0'
     C           *INKN     ANDEQ'0'
     C           WARN      ANDNE'Y'
     C           *INKC     OREQ '1'
     C           *INKE     OREQ '1'
     C           *INKL     OREQ '1'
      *
      ** If F14 (for Extended Settlements) NOT taken then display
      ** screen;
     C           *INKN     IFEQ '0'
     C                     EXSR SRSCRN
     C                     END
      *
      ** If F14 (for Extended Settlements) taken then call program to
      ** handle Extended Settlements
     C           *INKN     IFEQ '1'
     C                     EXSR SRPOSS
     C                     SETOF                     KN
      *
      * if F3 taken in SE1808 (trade amendment lost) return to menu;
     C           PCMD      IFEQ '03'
     C                     MOVE '1'       *INKC
     C                     END
      *
      * if F5 taken in SE1808 return to initial screen;
     C           PCMD      IFEQ '05'
     C                     MOVE '1'       *INKE
     C                     END
      *
      * If F12 taken in SE1808 (data lost) or if F14 taken (to Exit
      * Extended Settlements) (data kept) or if error code not 'N'
      * then redisplay screen;
     C           PCMD      IFEQ '12'
     C           PCMD      OREQ '14'
     C           PERR      ORNE 'N'
      *                                                                                       201230
      ** If F12 taken and ISO1522 is 'Y', call SE1808 again to                                201230
      ** write record in DPTMVDX2.                                                            201230
     C           PCMD      IFEQ '12'                                                          201230
     C           SD1522    ANDEQ'Y'                                                           201230
     C           DPNEW     ANDEQ'N'                                                           201230
     C           SDGMES    ANDEQ'Y'                                                           201230
     C           CSE028    ANDEQ'Y'                                                           201230
     C                     CALL 'SE1808'                                                      201230
     C                     PARM '00'      PCMD                                                201230
     C                     PARM 'N'       PERR                                                201230
     C                     PARM           PDATA                                               201230
     C                     PARM           PWHEN                                               201230
     C                     PARM 'Y'       PMODE   1                                           201230
     C                     PARM SDSAFA    PSAFA                                               201230
     C                     PARM *BLANKS   PTEMP                                               CSD015
      *                                                                                       CSD015
     C                     CAT  PTEMP:0   PMCWL                                               CSD015
     C                     ENDIF                                                              201230
      *                                                                                       201230
     C                     EXSR SRSCRN
     C/COPY WNCPYSRC,SE1807C035
     C                     CALL 'ZA0250'
     C/COPY WNCPYSRC,SE1807C036
     C                     END
      *                                                                                       201230
     C           PCMD      IFEQ '00'                                                          201230
     C           PERR      ANDEQ'N'                                                           201230
     C           SD1522    ANDEQ'Y'                                                           201230
     C           DPNEW     ANDEQ'N'                                                           201230
     C           SDGMES    ANDEQ'Y'                                                           201230
     C           CSE028    ANDEQ'Y'                                                           201230
     C                     MOVEL'Y'       WPROC                                               201230
     C                     ENDIF                                                              201230
      *
      * (else <enter> taken so validate Trade Extension Input)
      *
     C                     END
      *
      ** If F3, F5, F12 and F14 NOT taken then continue
      ** (else repeat 'do until' loop).
     C           *INKC     IFEQ '0'
     C           *INKE     ANDEQ'0'
     C           *INKL     ANDEQ'0'
     C           *INKN     ANDEQ'0'
      *
      * Clear messages for redisplay
     C/COPY WNCPYSRC,SE1807C037
     C                     CALL 'ZA0250'
     C/COPY WNCPYSRC,SE1807C038
      *                                                                   CSW003
      * Move Start Date Fields to Work Fields (except Price, AI + ER)     CSW003
     C                     EXSR SD2WF                                     CSW003
      *
      * Validate input
     C                     EXSR SRVAL
      *                                                                   CSW003
      ** If CSW003 = 'Y' and PDPMV Type not 'WI','WO' *IN41 is *ON.       CSW003
     C           *IN41     IFEQ *ON                                       CSW003
      ** And no errors on Validation.                                     CSW003
     C           *IN75     ANDEQ*OFF                                      CSW003
      * Check whether Maturity Date exists.                               CSW003
     C                     MOVE 'M'       PWHEN                           CSW003
     C           KEY001    CHAINRTVIDX               89                   CSW003
      *                                                                   CSW003
      ** If record not found then setup message, protect fields for       CSW003
      ** display, display screen and handle database error.               CSW003
      *                                                                   CSW003
     C********** *IN89     IFEQ '1'                                       CSW003              190743
     C**********           MOVEL'SEW9999' ZAMSID                          CSW003              190743
     C**********           EXSR SRSMSG                                    CSW003              190743
      *                                                                   CSW003
     C**********           SETON                     09                   CSW003              190743
     C/COPY WNCPYSRC,SE1807C039
     C**********           EXFMTSE1807MD                                  CSW003              190743
     C/COPY WNCPYSRC,SE1807C040
      *                                                                   CSW003
     C**********           MOVEL'DPTMVDX1'DBFILE           ***************CSW003              190743
     C**********           Z-ADD2         DBASE            * DB ERROR 02 *CSW003              190743
     C**********           MOVELPDPSS     DBFLD            ***************CSW003              190743
     C**********           MOVE PDPRN     DBFLD                           CSW003              190743
     C**********           MOVELDBFLD     DS002                           CSW003              190743
     C**********           MOVE PWHEN     DS002                           CSW003              190743
     C**********           MOVELDS002     DBKEY                           CSW003              190743
     C**********           EXSR *PSSR                                     CSW003              190743
      *                                                                   CSW003
     C**********           ELSE                                           CSW003              190743
      *                                                                   CSW003
      ** Move file fields to work fields.                                 CSW003
     C                     EXSR SRFTOS                                    CSW003
      *                                                                   204954
     C           SFIND     IFEQ *BLANKS                                   204954
     C           PDPMV     IFEQ 'BB'                                      204954
     C           PDPMV     OREQ 'BL'                                      204954
     C                     MOVE 'F'       SFIND                           204954
     C                     ELSE                                           204954
     C                     MOVE 'A'       SFIND                           204954
     C                     ENDIF                                          204954
     C                     ENDIF                                          204954
      *                                                                   CSW003
      ** If CSW003='Y'+ not processing types 2,4 or 7 *IN39 is *ON.    .  CSW003
      ** Format Accrued Interest Field.                                   CSW003
     C           *IN39     IFEQ *ON                                       CSW003
     C                     EXSR FMITRA                                    CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
      ** If CSW003='Y' + DPMV Type not 'WI','WO' or 'DT' *IN40 is *ON.    CSW003
      ** Format Price and Exchange Rate Fields.                           CSW003
     C           *IN40     IFEQ *ON                                       CSW003
     C                     EXSR FMPRIC                                    CSW003
     C                     EXSR FMTDER                                    CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
      ** Move work fields to Maturity Date Screen Fields.                 CSW003
     C                     EXSR WF2MD                                     CSW003
      *                                                                   CSW003
      ** If change of Clearance Type blank out non-displayed fields.      CSW003
     C           *IN29     IFEQ *ON                                       CSW003
     C                     MOVE *BLANKS   MDFCOD                          CSW003
     C                     ENDIF                                          CSW003
     C           *IN44     IFEQ *ON                                       CSW003
     C                     MOVE *BLANKS   MDFCOD                          CSW003
     C                     MOVE *BLANKS   MDINST                          CSW003
     C                     MOVE *BLANKS   MDINSS                          CSW003
     C                     MOVE *BLANKS   MDEUCL                          CSW003
     C                     MOVE *BLANKS   MDSAFA                          CSW003
     C                     MOVE *BLANKS   MDRPTY                          CSW003
     C                     MOVE *BLANKS   MDGDEL                          CSW003
     C                     MOVE *BLANKS   MDSROL                          CSW003
     C                     ENDIF                                          CSW003
     C           *IN40     IFEQ *OFF                                      CSW003
     C                     MOVE *BLANKS   MDPRIC                          CSW003
     C                     MOVE *BLANKS   MDTDER                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C           *INKC     DOUEQ*ON                                       CSW003
     C           *INKL     OREQ *ON                                       CSW003
     C           *INKN     OREQ *OFF                                      CSW003
     C           *IN75     ANDEQ*OFF                                      CSW003
     C           *INKN     IFEQ *OFF                                      CSW003
     C/COPY WNCPYSRC,SE1807C041
     C                     WRITESE1807C1                                  CSW003
     C                     EXFMTSE1807MD                                  CSW003
     C/COPY WNCPYSRC,SE1807C042
     C                     EXSR MD2WF                                     CSW003
     C/COPY WNCPYSRC,SE1807C043
     C                     CALL 'ZA0250'                                  CSW003
     C/COPY WNCPYSRC,SE1807C044
     C                     EXSR SRVAL                                     CSW003
      * Else Call Extended Settlements Pgm.                               CSW003
     C                     ELSE                                           CSW003
     C                     EXSR SRPOSS                                    CSW003
     C                     MOVE *OFF      *INKN                           CSW003
     C           PCMD      IFEQ '03'                                      CSW003
     C                     MOVE *ON       *INKC                           CSW003
     C                     ENDIF                                          CSW003
     C           PCMD      IFEQ '12'                                      CSW003
     C           PCMD      OREQ '14'                                      CSW003
     C           PERR      ORNE 'N'                                       CSW003
     C                     MOVE 'M'       PWHEN                           CSW003
     C                     EXSR SRSCRN                                    CSW003
     C/COPY WNCPYSRC,SE1807C045
     C                     CALL 'ZA0250'                                  CSW003
     C/COPY WNCPYSRC,SE1807C046
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDDO                                          CSW003
      *                                                                   CSW003
      ** If Validation successful move work fields to Maturity Date       CSW003
      ** Fields.                                                          CSW003
     C           *IN75     IFEQ *OFF                                      CSW003
     C                     EXSR WF2MD                                     CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
      ** If Cmd 3 pressed exit DO loop.                                   CSW003
     C           *INKC     IFEQ *ON                                       CSW003
     C                     LEAVE                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
      ** If Cmd 12 pressed redisplay first screen.                        CSW003
     C           *INKL     IFEQ *ON                                       CSW003
     C                     MOVE 'S'       PWHEN                           CSW003
     C                     MOVE *OFF      *INKL                           CSW003
     C                     MOVEA'00000'   *IN,21                          CSW003
     C                     MOVEA'00'      *IN,26                          CSW003
     C                     MOVEA'000'     *IN,30                          CSW003
     C                     MOVEA'00000'   *IN,34                          CSW003
     C                     MOVE *ON       *IN75                           CSW003
     C/COPY WNCPYSRC,SE1807C047
     C                     CALL 'ZA0250'                                  CSW003
     C/COPY WNCPYSRC,SE1807C048
     C                     MOVELTMPSEN    WWSENT                          CSW003
     C                     MOVELTMPCLT    WWCLTY                          CSW003
     C                     ITER                                           CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
      ** If Validation sucessful write Start Date and Maturity Date       CSW003
      ** details to file.                                                 CSW003
     C           *IN75     IFEQ *OFF                                      CSW003
     C                     MOVE 'S'       PWHEN                           CSW003
     C                     EXSR SRALOC                                    CSW003
      ** Write SD details to file fields (except Price, AI + ER)          CSW003
     C                     EXSR SRSD2F                                    CSW003
      ** Write SD Accrued Interest to file.                               CSW003
     C           *IN39     IFEQ *ON                                       CSW003
     C                     EXSR WRITRA                                    CSW003
     C                     ENDIF                                          CSW003
      ** Write SD Price and Exchange Rate to file.                        CSW003
     C                     EXSR WRPRER                                    CSW003
     C                     UPDATUPDIDX                 68                 CSW003
      *                                                                   CSW003
     C                     MOVE 'M'       PWHEN                           CSW003
     C                     EXSR SRALOC                                    CSW003
      ** Write MD details to file fields (except Price, AI + ER)          CSW003
     C                     EXSR SRMD2F                                    CSW003
      ** Write MD Accrued Interest to file.                               CSW003
     C           *IN39     IFEQ *ON                                       CSW003
     C                     EXSR WRITRA                                    CSW003
     C                     ENDIF                                          CSW003
      ** Write MD Price and Exchange Rate to file.                        CSW003
     C                     EXSR WRPRER                                    CSW003
     C                     UPDATUPDIDX                 68                 CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C**********           ENDIF                                                       CSW003 200716
      *                                                                   CSW003
      ** Else - CSW003 NE 'Y' or PDPMV is 'WI', 'WO' or 'DT'.             CSW003
     C                     ELSE                                           CSW003
      *                                                                   CSW003
      ** If amendment and ISO1522 has been changed from 'N' to 'Y'                            201230
      ** then display Ext. settlement screen.                                                 201230
     C           *IN75     IFEQ *OFF                                                          201230
     C           SD1522    ANDEQ'Y'                                                           201230
     C           DPNEW     ANDEQ'N'                                                           201230
     C           SDGMES    ANDEQ'Y'                                                           201230
     C           CSE028    ANDEQ'Y'                                                           201230
     C           WPROC     ANDNE'Y'                                                           201230
     C                     MOVE *ON       *INKN                                               201230
     C                     MOVEL'Y'       WPROC                                               201230
     C                     ENDIF                                                              201230
      *                                                                                       201429
      ** Check safekeeping account if entered on the second screen                            201429
     C           *IN75     IFEQ '0'                                                           201429
     C                     EXSR SRVAL2                                                        201429
     C                     ENDIF                                                              201429
      *                                                                                       201230
      ** If no errors on validation allocate record via update index
     C           *IN75     IFEQ '0'
     C           *INKN     ANDEQ*OFF                                                          201230
     C                     EXSR SRALOC
     C                     EXSR SRSTOF
     C                     UPDATUPDIDX                 68
     C                     END
      *                                                                                       200716
     C                     ENDIF                                                              200716
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      *
     C**********           END                                                                190743
      *
     C**********           END                                                                190743
      *
     C                     END
      *                                                                                       190754
      ** Find out what MT5xx message can be generated                                         190754
      *                                                                                       190754
     C           SFIND     IFEQ 'F'                                                           190754
     C           CSE029    IFEQ 'Y'                                                           243125
     C                     MOVEL'MT540/42'MSGTPS                                              243125
     C                     ELSE                                                               243125
     C                     MOVEL'MT520/22'MSGTPS                                              190754
     C                     ENDIF                                                              243125
     C                     MOVE '  '      MSGTPS                                              190754
     C                     ELSE                                                               190754
     C           SFIND     IFEQ 'A'                                                           190754
     C           CSE029    IFEQ 'Y'                                                           243125
     C                     MOVEL'MT541/43'MSGTPS                                              243125
     C                     ELSE                                                               243125
     C                     MOVEL'MT521/23'MSGTPS                                              190754
     C                     ENDIF                                                              243125
     C                     MOVE '  '      MSGTPS                                              190754
     C                     END                                                                190754
     C                     END
      *
      * Reset override indicators
     C                     MOVE ' '       OVER1
     C                     MOVE ' '       OVER2
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/SRENQ
      *****************************************************************
      *                                                               *
      * SRENQ - Routine to handle 'ENQUIRY' action                    *
      *                                                               *
      *****************************************************************
      *
     C           SRENQ     BEGSR
      *
      **Protect*input*fields*and*enable rolldown option on screen         CSW003
      * Protect input fields                                              CSW003
     C                     MOVE *ON       *IN09                           CSW003
     C***********          SETON                     0914                 CSW003
      *
      * Check whether record exists
     C***********CSW003    IFEQ 'Y'                                       CSW003              CAP087
     C                     MOVE 'S'       PWHEN                           CSW003
     C***********          ENDIF                                          CSW003              CAP087
      *                                                                   CSW003
     C           KEY001    CHAINRTVIDX               89
      *
      ** If record not found then setup message, display screen and
      ** handle database error.
     C********** *IN89     IFEQ '1'                                                           190743
      *
     C**********           MOVEL'SEW9994' ZAMSID                                              190743
     C**********           EXSR SRSMSG                                                        190743
      *
     C**********           EXSR SRSCRN                                                        190743
      *
     C**********           MOVEL'DPTMVDX1'DBFILE           ***************                    190743
     C**********           Z-ADD3         DBASE            * DB ERROR 03 *                    190743
     C**********           MOVELPDPSS     DBFLD  16        ***************                    190743
     C**********           MOVE PDPRN     DBFLD                                               190743
     C********** CSW003    IFEQ 'Y'                                       CSW003              190743
     C**********           MOVELDBFLD     DS002                           CSW003              190743
     C**********           MOVE PWHEN     DS002                           CSW003              190743
     C**********           MOVELDS002     DBKEY                           CSW003              190743
     C**********           ELSE                                           CSW003              190743
     C**********           MOVELDBFLD     DBKEY                                               190743
     C**********           ENDIF                                          CSW003              190743
     C**********           EXSR *PSSR                                                         190743
      *
     C**********           ELSE                                                               190743
      *
      * else (record found) set file fields to screen fields
      * NOT REALLY SCREEN FIELDS BUT WORK FIELDS                          CSW003
     C                     EXSR SRFTOS
      *                                                                   CSW003
      ** If CSW003='Y'+ not processing types 2,4 or 7 *IN39 is *ON.       CSW003
      ** Format Accrued Interest Field.                                   CSW003
     C           *IN39     IFEQ *ON                                       CSW003
     C                     EXSR FMITRA                                    CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
      ** If CSW003='Y' + PDPMV Type not 'WI','WO' or 'DT' *IN40 is *ON.   CSW003
      ** Format Price and Exchange Rate Fields.                           CSW003
     C           *IN40     IFEQ *ON                                       CSW003
     C                     EXSR FMPRIC                                    CSW003
     C                     EXSR FMTDER                                    CSW003
     C                     ENDIF                                          CSW003
      **                                                                  CSW003
      ** Move work fields to Start Date Screen Fields.                    CSW003
     C                     EXSR WF2SD                                     CSW003
      *
      ** Handle screens until F3, F12 or F14 taken.                       CSW003
      *                                                                   CSW003
      ** If F14 (for Extended Settlements) NOT taken then display         CSW003
      * Display and handle screen
     C           *INKC     DOUEQ*ON                                       CSW003
     C           *INKL     OREQ *ON                                       CSW003
     C           *INKN     OREQ *OFF                                      CSW003
     C           *IN75     ANDEQ*OFF                                      CSW003
     C                     MOVE *OFF      *IN75                           CSW003
      *                                                                   CSW003
      ** If F14 (for Extended Settlements) NOT taken then display         CSW003
      ** screen;                                                          CSW003
     C           *INKN     IFEQ '0'                                       CSW003
     C                     EXSR SRSCRN
     C/COPY WNCPYSRC,SE1807C049
     C                     CALL 'ZA0250'                                  CSW003
     C/COPY WNCPYSRC,SE1807C050
     C                     ENDIF                                          CSW003
      *
      ** If F14 (for Extended Settlements) taken then call program
      ** to handle Extended Settlements
     C************INKN     DOWEQ'1'                                       CSW003
     C           *INKN     IFEQ *ON                                       CSW003
     C                     EXSR SRPOSS
     C                     SETOF                     KN
      *
      * If no extension record exists then Display message
     C           PERR      IFEQ 'R'
     C                     MOVEL'SEW2001' ZAMSID
     C                     EXSR SRSMSG
     C                     MOVE *ON       *IN75                           CSW003
     C                     MOVE *BLANK    PERR                            CSW003
     C                     ITER                                           CSW003
     C                     END
      *
      * if F5 taken in SE1808 return to initial screen;
     C           PCMD      IFEQ '05'
     C                     MOVE '1'       *INKE
     C                     END
      *
      * if F3 taken in SE1808 return to menu;
     C           PCMD      IFEQ '03'
     C                     MOVE '1'       *INKC
     C                     END
      *
      **If*Rolldown*taken*from*SE1808*or*error*code*not*'N'*then*****     CSW003
      **redisplay*screen.********                                         CSW003
     C***********PCMD      IFEQ '12'                                      CSW003
     C***********PERR      ORNE 'N'                                       CSW003
     C***********          EXSR SRSCRN                                    CSW003
     C***********          CALL 'ZA0250'                                  CSW003
     C***********          END                                            CSW003
      *                                                                   CSW003
      * (else <enter> taken so drop back to initial screen in SE0050).
      *
     C                     END
      *                                                                   CSW003
      ** If CSW003 = 'Y' and PDPMV Type not 'WI','WO' *IN41 is *ON.       CSW003
     C           *IN41     IFEQ *ON                                       CSW003
     C           *INKC     ANDEQ*OFF                                      CSW003
     C           *INKL     ANDEQ*OFF                                      CSW003
      *                                                                   CSW003
      * Check whether Maturity Date exists.                               CSW003
     C                     MOVE 'M'       PWHEN                           CSW003
     C           KEY001    CHAINRTVIDX               89                   CSW003
      *                                                                   CSW003
      ** If record not found then setup message, protect fields for       CSW003
      ** display, display screen and handle database error.               CSW003
      *                                                                   CSW003
     C********** *IN89     IFEQ '1'                                       CSW003              190743
     C**********           MOVEL'SEW9994' ZAMSID                          CSW003              190743
     C**********           EXSR SRSMSG                                    CSW003              190743
      *                                                                   CSW003
     C**********           SETON                     09                   CSW003              190743
     C/COPY WNCPYSRC,SE1807C051
     C**********           EXFMTSE1807MD                            CSW003204920
     C/COPY WNCPYSRC,SE1807C052
      *                                                                   CSW003
     C**********           MOVEL'DPTMVDX1'DBFILE           ***************CSW003              190743
     C**********           Z-ADD4         DBASE            * DB ERROR 04 *CSW003              190743
     C**********           MOVELPDPSS     DBFLD            ***************CSW003              190743
     C**********           MOVE PDPRN     DBFLD                           CSW003              190743
     C**********           MOVELDBFLD     DS002                           CSW003              190743
     C**********           MOVE PWHEN     DS002                           CSW003              190743
     C**********           MOVELDS002     DBKEY                           CSW003              190743
     C**********           EXSR *PSSR                                     CSW003              190743
      *                                                                   CSW003
     C**********           ELSE                                           CSW003              190743
      *                                                                   CSW003
      * else (record found) set file fields to work fields                CSW003
      * NOT REALLY SCREEN FIELDS BUT WORK FIELDS                          CSW003
     C                     EXSR SRFTOS                                    CSW003
      *                                                                   CSW003
      ** If CSW003='Y'+ not processing types 2,4 or 7 *IN39 is *ON.    .  CSW003
      ** Format Accrued Interest Field.                                   CSW003
     C           *IN39     IFEQ *ON                                       CSW003
     C                     EXSR FMITRA                                    CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
      ** If CSW003='Y' + DPMV Type not 'WI','WO' or 'DT' *IN40 is *ON.    CSW003
      ** Format Price and Exchange Rate Fields.                           CSW003
     C           *IN40     IFEQ *ON                                       CSW003
     C                     EXSR FMPRIC                                    CSW003
     C                     EXSR FMTDER                                    CSW003
     C                     ENDIF                                          CSW003
      **                                                                  CSW003
      ** Move work fields to Maturity Date Screen Fields.                 CSW003
     C                     EXSR WF2MD                                     CSW003
      *                                                                   CSW003
     C           *INKC     DOUEQ*ON                                       CSW003
     C           *INKL     OREQ *ON                                       CSW003
     C           *INKN     OREQ *OFF                                      CSW003
     C           *IN75     ANDEQ*OFF                                      CSW003
     C                     MOVE *OFF      *IN75                           CSW003
     C           *INKN     IFEQ *OFF                                      CSW003
     C/COPY WNCPYSRC,SE1807C053
     C                     WRITESE1807C1                                  CSW003
     C                     EXFMTSE1807MD                                  CSW003
      ** If F12 pressed Clear Error Messages.                             CSW003
     C                     CALL 'ZA0250'                                  CSW003
     C/COPY WNCPYSRC,SE1807C054
      * Else Call Extended Settlements Pgm.                               CSW003
     C                     ELSE                                           CSW003
     C                     EXSR SRPOSS                                    CSW003
     C                     MOVE *OFF      *INKN                           CSW003
      *                                                                   CSW003
      * If no extension record exists then Display message                CSW003
     C           PERR      IFEQ 'R'                                       CSW003
     C                     MOVE *ON       *IN75                           CSW003
     C                     MOVEL'SEW2001' ZAMSID                          CSW003
     C                     EXSR SRSMSG                                    CSW003
     C                     MOVE *ON       *IN75                           CSW003
     C                     ITER                                           CSW003
     C                     END                                            CSW003
      *                                                                   CSW003
     C           PCMD      IFEQ '03'                                      CSW003
     C                     MOVE *ON       *INKC                           CSW003
     C                     ENDIF                                          CSW003
     C           PCMD      IFEQ '12'                                      CSW003
     C           PCMD      OREQ '14'                                      CSW003
     C           PERR      ORNE 'N'                                       CSW003
     C                     MOVE 'M'       PWHEN                           CSW003
     C                     EXSR SRSCRN                                    CSW003
     C/COPY WNCPYSRC,SE1807C055
     C                     CALL 'ZA0250'                                  CSW003
     C/COPY WNCPYSRC,SE1807C056
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDDO                                          CSW003
      *                                                                   CSW003
      ** If Cmd 3 pressed exit DO loop.                                   CSW003
     C           *INKC     IFEQ *ON                                       CSW003
     C                     LEAVE                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
      ** If Cmd 12 pressed redisplay first screen.                        CSW003
     C           *INKL     IFEQ *ON                                       CSW003
     C                     MOVE 'S'       PWHEN                           CSW003
     C                     MOVE *OFF      *INKL                           CSW003
     C                     MOVE *ON       *IN75                           CSW003
     C                     ITER                                           CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C**********           ENDIF                                          CSW003              190743
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C**********           ENDDO                                          CSW003              190743
      *                                                                   CSW003
     C                     END
      *                                                                   CSW003
      ** Find out what MT5xx message can be generated                                         190754
      *                                                                                       190754
     C           SFIND     IFEQ 'F'                                                           190754
     C           CSE029    IFEQ 'Y'                                                           243125
     C                     MOVEL'MT540/42'MSGTPS                                              243125
     C                     ELSE                                                               243125
     C                     MOVEL'MT520/22'MSGTPS                                              190754
     C                     ENDIF                                                              243125
     C                     MOVE '  '      MSGTPS                                              190754
     C                     ELSE                                                               190754
     C           SFIND     IFEQ 'A'                                                           190754
     C           CSE029    IFEQ 'Y'                                                           243125
     C                     MOVEL'MT541/43'MSGTPS                                              243125
     C                     ELSE                                                               243125
     C                     MOVEL'MT521/23'MSGTPS                                              190754
     C                     ENDIF                                                              243125
     C                     MOVE '  '      MSGTPS                                              190754
     C                     END                                                                190754
     C                     END                                                                190754
      *                                                                                       190754
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/DEFLT                                                     CSE006
      *****************************************************************   CSE006
      *                                                               *   CSE006
      * DEFLT - Generate default MT5xx message                        *   CSE006
      *                                                               *   CSE006
      *****************************************************************   CSE006
     C           DEFLT     BEGSR                                          CSE006
      *                                                                   CSE006
     C                     MOVEL'S'       PWHEN                           CSE006
      *                                                                   CSE006
      ** Initialise screen fields with defaults                           CSE006
     C                     EXSR SRINZ                                     CSE006
      *                                                                   CSE006
      ** Move work fields to Start Date screen fields                     CSE006
     C                     EXSR WF2SD                                     CSE006
      *                                                                   CSE006
      ** Move Start Date screen fields to work fields                     CSE006
     C                     EXSR SD2WF                                     CSE006
      *                                                                   CSE006
      ** Move Start Date fields to file fields                            CSE006
     C                     EXSR SRSD2F                                    CSE006
      *                                                                   CSE006
      ** Write Accrued Interest to file (if appropriate)                  CSE006
     C           *IN39     IFEQ *ON                                       CSE006
     C                     EXSR WRITRA                                    CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      ** Write Price and Exchange Rate to file (if appropriate)           CSE006
     C           *IN40     IFEQ *ON                                       CSE006
     C                     EXSR WRPRER                                    CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     WRITEUPDIDX                                    CSE006
      *                                                                   CSE006
     C                     CALL 'SE1808'                                  204662
     C                     PARM '00'      PCMD                            204662
     C                     PARM 'N'       PERR                            204662
     C                     PARM           PDATA                           204662
     C                     PARM           PWHEN                           204662
     C                     PARM 'Y'       PMODE   1                       204662
     C                     PARM SDSAFA    PSAFA                           204662
     C                     PARM *BLANKS   PTEMP                                               CSD015
      *                                                                                       CSD015
     C                     CAT  PTEMP:0   PMCWL                                               CSD015
      ** Set number of messages generated to zero                         CSE006
     C                     Z-ADD0         @M      10                      CSE006
      *                                                                   CSE006
      ** Find out what MT5xx message can be generated                     CSE006
     C                     EXSR FMSGTP                                    CSE006
      *                                                                   CSE006
      *                                                                   CSE006
     C           *IN41     IFEQ *ON                                       CSE006
      *                                                                   CSE006
     C                     MOVEL'M'       PWHEN                           CSE006
      *                                                                   CSE006
      ** Initialise screen fields with defaults                           CSE006
     C                     EXSR SRINZ                                     CSE006
      *                                                                   CSE006
      ** Move work fields to Maturity Date screen fields                  CSE006
     C                     EXSR WF2MD                                     CSE006
      *                                                                   CSE006
      ** Set up Maturity Date fields from Start Date                      CSE006
     C                     MOVE SDTRTT    MDTRTT                          CSE006
     C                     MOVE SDFIND    MDFIND                          CSE006
     C           PDPMV     IFNE 'DT'                                      CSE006
     C                     MOVE *BLANKS   MDROUS                          CSE006
     C                     MOVE SDROUS    MDROUS                          CSE006
     C                     MOVE *BLANKS   MDROTS                          CSE006
     C                     MOVE SDROTS    MDROTS                          CSE006
     C                     MOVE *BLANKS   MDGMES                          CSE006
     C                     MOVE SDGMES    MDGMES                          CSE006
     C           *IN43     IFEQ *OFF                                      CSE006
     C           *IN44     ANDEQ*OFF                                      CSE006
     C*********************MOVE SDEUCL    MDEUCL                          CSE006              CSE034
     C                     MOVE SDSAFA    MDSAFA                          CSE006
     C                     ENDIF                                          CSE006
     C           *IN53     IFEQ *OFF                                                          CSE034
     C           *IN54     ANDEQ*OFF                                                          CSE034
     C                     MOVE SDEUCL    MDEUCL                                              CSE034
     C                     ENDIF                                                              CSE034
     C                     ENDIF                                          CSE006
     C           *IN43     IFEQ *OFF                                      CSE006
     C           *IN44     ANDEQ*OFF                                      CSE006
     C                     MOVE SDRPTY    MDRPTY                          CSE006
     C                     MOVE SDGDEL    MDGDEL                          CSE006
     C                     MOVE SDSROL    MDSROL                          CSE006
     C                     MOVE SDFCOD    MDFCOD                          CSE006
     C                     ENDIF                                          CSE006
     C           *IN40     IFEQ *ON                                       CSE006
     C                     MOVE SDPRIC    MDPRIC                          CSE006
     C                     MOVE SDTDER    MDTDER                          CSE006
     C                     ENDIF                                          CSE006
     C           *IN20     IFEQ *OFF                                      CSE006
     C                     MOVE SDROUC    MDROUC                          CSE006
     C                     MOVE SDROTC    MDROTC                          CSE006
     C                     MOVE 'N'       MDGMEC                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C           CSW201    IFEQ 'N'                                                           CSW201
     C           SWRTN     IFEQ 'CSW098 '                                 CSE006
     C                     MOVE 'N'       MDSIOR                          CSE006
     C                     ENDIF                                          CSE006
     C                     ENDIF                                                              CSW201
      *                                                                   CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      ** Move Maturity Date screen fields to work fields                  CSE006
     C                     EXSR MD2WF                                     CSE006
      *                                                                   CSE006
      ** Move Maturity Date fields to file fields                         CSE006
     C                     EXSR SRMD2F                                    CSE006
      *                                                                   CSE006
      ** Write Accrued Interest to file (if appropriate)                  CSE006
     C           *IN39     IFEQ *ON                                       CSE006
     C                     EXSR WRITRA                                    CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      ** Write Price and Exchange Rate to file (if appropriate)           CSE006
     C           *IN40     IFEQ *ON                                       CSE006
     C                     EXSR WRPRER                                    CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     WRITEUPDIDX                                    CSE006
      *                                                                   CSE006
     C                     CALL 'SE1808'                                  204662
     C                     PARM '00'      PCMD                            204662
     C                     PARM 'N'       PERR                            204662
     C                     PARM           PDATA                           204662
     C                     PARM           PWHEN                           204662
     C                     PARM 'Y'       PMODE   1                       204662
     C                     PARM SDSAFA    PSAFA                           204662
     C                     PARM *BLANKS   PTEMP                                               CSD015
      *                                                                                       CSD015
     C                     CAT  PTEMP:0   PMCWL                                               CSD015
      *                                                                   CSE006
     C                     ENDSR                                          CSE006
      *****************************************************************   CSE006
      /TITLE SR/SRSMSG
      *****************************************************************
      *                                                               *
      * SRSMSG - Routine to send messages to message subfile.         *
      *                                                               *
      *****************************************************************
      *
     C           SRSMSG    BEGSR
     C/COPY WNCPYSRC,SE1807C057
      *
      ** Send specified message from specified message file to program
      ** message queue; then clear message id and message file
     C                     CALL 'ZA0340'
     C                     PARM 'SEUSRMSG'ZAMSGF 10
     C                     PARM           ZAMSID 10
      *
     C                     MOVEL*BLANK    ZAMSID
     C/COPY WNCPYSRC,SE1807C058
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/SRALOC
      *****************************************************************
      *                                                               *
      * SRALOC - Routine to access record via update index            *
      *                                                               *
      *****************************************************************
      *
     C           SRALOC    BEGSR
      *
     C           KEY001    CHAINUPDIDX               6061
      *
      **If*record*not*on*file,*setup*message*'Record deleted'                                 190743
     C********** *IN60     IFEQ '1'                                                           190743
     C**********           MOVEL'SEW9998' ZAMSID                                              190743
     C**********           EXSR SRSMSG                                                        190743
     C**********           END                                                                190743
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/SRRTRN
      *****************************************************************
      *                                                               *
      * SRRTRN - Routine to set up return code for calling program    *
      *                                                               *
      *****************************************************************
      *
     C           SRRTRN    BEGSR
      *
     C                     MOVE 'N'       PERR
     C                     MOVE '00'      PCMD
      *
      ** If error on updating file set Return Error Code to 'U'
     C           *IN68     IFEQ '1'
     C                     MOVE 'U'       PERR
     C                     ELSE
      *
      ** If F12 taken (for previous screen) or if rolldown and in
      ** enquiry mode then set Return Command to '12'
     C           *INKL     IFEQ '1'
     C           *IN08     OREQ '1'                                       CSW003
     C           PACTN     ANDEQ'E'
     C                     MOVE '12'      PCMD
     C                     ELSE
      *
      ** If F3 taken (for End) then set Return Command to '03'
     C           *INKC     IFEQ '1'
     C                     MOVE '03'      PCMD
     C                     ELSE
      *
      ** If F5 taken (for Refresh) then set Return Command to '05'
     C           *INKE     IFEQ '1'
     C                     MOVE '05'      PCMD
     C                     END
     C                     END
      *
     C                     END
      *
     C                     END
      *
      * Move Input field TIME to be an output parameter
     C                     MOVELSTRTT     PTRTT
      *                                                                   CSE006
      * Commit changes if program is called from MMRPDLSFL                CSE006
     C           MODE      IFNE *BLANK                                    CSE006
     C           CSC022    IFEQ 'N'                                                           CSC022
     C           CSC022    OREQ 'Y'                                                           CSC022
     C           CMTSKP    ANDEQ'N'                                                           CSC022
     C                     COMIT                                          CSE006
     C                     ENDIF                                                              CSC022
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      * Exit program
     C                     SETON                     LR
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/SRSCRN
      *****************************************************************
      *                                                               *
      * SRSCRN - Routine to handle screen                             *
      *                                                               *
      *****************************************************************
      *
     C           SRSCRN    BEGSR
      *                                                                   CSW003
     C           CSW003    IFEQ 'Y'                                       CSW003
     C           PDPMV     ANDNE'WI'                                      CSW003
     C           PDPMV     ANDNE'WO'                                      CSW003
      *                                                                   CSW003
     C           PDPMV     ANDNE'DT'                                      CSW003
      ** Display price and exchange rate fields.                          CSW003
     C                     MOVE *ON       *IN40                           CSW003
      *                                                                   CSE006
     C           *IN40     IFEQ *ON                                       CSE006
     C           @CFRM     ANDNE'CSE006'                                  CSE006
     C                     MOVE *ON       *IN49                           CSE006
     C                     ELSE                                           CSE006
     C                     MOVE *OFF      *IN49                           CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      *                                                                                       CSW202
      ** If CSE029 is installed set SD1522/MD1522 to 'Y', otherwise to 'N'                    CSW202
      *                                                                                       CSW202
     C           CSW202    IFEQ 'Y'                                                           CSW202
     C           CSE029    IFEQ 'Y'                                                           CSW202
      *                                                                                       CSW202
     C           PWHEN     IFEQ 'S'                                                           CSW202
     C                     MOVE 'Y'       SD1522                                              CSW202
     C                     ELSE                                                               CSW202
     C                     MOVE 'Y'       MD1522                                              CSW202
     C                     ENDIF                                                              CSW202
      *                                                                                       CSW202
     C                     ELSE                                                               CSW202
      *                                                                                       CSW202
     C           PWHEN     IFEQ 'S'                                                           CSW202
     C                     MOVE 'N'       SD1522                                              CSW202
     C                     ELSE                                                               CSW202
     C                     MOVE 'N'       MD1522                                              CSW202
     C                     ENDIF                                                              CSW202
      *                                                                                       CSW202
     C                     ENDIF                                                              CSW202
     C                     ENDIF                                                              CSW202
      *
      * Display messages and display screen
     C/COPY WNCPYSRC,SE1807C059
     C                     WRITESE1807C1
     C                     WRITESE1807H                                   CSW003
     C                     WRITESE1807F                                   CSW003
     C           PWHEN     IFEQ ' '                                       CSW003
     C           PWHEN     OREQ 'S'                                       CSW003
     C************         EXFMTSE1807F1                                  CSW003
     C                     EXFMTSE1807SD                                  CSW003
     C                     EXSR SD2WF                                                       AR545944
     C                     ELSE                                           CSW003
     C                     EXFMTSE1807MD                                  CSW003
     C                     EXSR MD2WF                                                       AR545944
     C                     ENDIF                                          CSW003
     C/COPY WNCPYSRC,SE1807C060
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/SRVAL
      *****************************************************************
      *                                                               *
      * SRVAL - Routine to control validation of each field.          *
      *                                                               *
      *****************************************************************
      *
     C           SRVAL     BEGSR
      *
      * Initialize error condition indicators
     C                     SETOF                     75
     C                     MOVEA'00000'   *IN,21
     C***********          MOVEA'00000'   *IN,26                          CSW003
     C***********          MOVEA'00000'   *IN,31                          CSW003
     C                     MOVEA'00'      *IN,26                          CSW003
     C                     MOVEA'000'     *IN,30                          CSW003
     C                     MOVEA'00000'   *IN,34                          CSW003
     C                     MOVE *OFF      *IN65                                               CSE028
      *
      ** Reset validations by F19
     C           *INKT     IFEQ '1'
     C                     CLEAROVER1
     C                     CLEAROVER2
     C                     END
      *
      * Validate Settlement message request
     C                     EXSR SRGMES
      *                                                                                       199797
     C           SD1522    IFNE 'Y'                                                           199797
     C           CSE028    OREQ 'N'                                                           199797
      *
      * Validate Instructions type
     C                     EXSR SRINST
      *
      * Validate Instructions sub-type
     C                     EXSR SRINSS
      *
      * Validate Euroclear/Cedel code
     C                     EXSR SREUCL
      *
      * Validate Safekeeping Account
     C                     EXSR SRSAFA
      *
      * Validate Requested priority
     C                     EXSR SRRPTY
     C                     ENDIF                                                              199797
      *
      * Validate Free or Against Payment
     C                     EXSR SRFIND
      *
      * Validate confirmation message request
     C                     EXSR SRGMEC
      *                                                                   CSW098
     C           CSW201    IFEQ 'N'                                                           CSW201
     C           SWRTN     IFEQ 'CSW098 '                                 CSW098
     C           PDPMV     IFEQ 'RR'                                      CSW098
     C           PDPMV     OREQ 'RP'                                      CSW098
     C           PDPMV     OREQ 'PD'                                      CSW098
     C           PDPMV     OREQ 'PL'                                      CSW098
      *                                                                   CSW098
      * Validate Standard Instruction Override                            CSW098
     C                     EXSR SRSIOR                                    CSW098
      *                                                                   CSW098
     C                     ENDIF                                          CSW098
     C                     ENDIF                                          CSW098
     C                     ENDIF                                                              CSW201
      *
      * Validate Time of transaction
     C                     EXSR SRTRTT
      *                                                                                       199797
     C           SD1522    IFNE 'Y'                                                           199797
     C           CSE028    OREQ 'N'                                                           199797
      *
      * Validate Guaranteed delivery
     C                     EXSR SRGDEL
     C                     ENDIF                                                              199797
      *
      * Validate Fungibility Code
     C                     EXSR SRFCOD
      *                                                                                       199797
     C           SD1522    IFNE 'Y'                                                           199797
     C           CSE028    OREQ 'N'                                                           199797
      *
      * Validate Sender's role
     C                     EXSR SRSROL
     C                     ENDIF                                                              199797
      *                                                                   CSW003
      ** If not Walk In or Out and not Depot Transfer *IN40 is on.        CSW003
     C           *IN40     IFEQ *ON                                       CSW003
     C                     MOVEA'00'      *IN,36                          CSW003
      * Validate Price.                                                   CSW003
     C                     EXSR SRPRIC                                    CSW003
      *                                                                   CSW003
      * Validate Exchange Rate.                                           CSW003
     C                     EXSR SRTDER                                    CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
      ** If Investment Type not 2, 4 or 7 *IN39 is on.                    CSW003
     C           *IN39     IFEQ *ON                                       CSW003
     C                     MOVE *OFF      *IN38                           CSW003
      * Validate Accrued Interest.                                        CSW003
     C                     EXSR SRITRA                                    CSW003
     C                     ENDIF                                          CSW003
      *                                                                                       CSE028
      ** Validate ISO15022 Message                                                            CSE028
      ** If SWIFT 2002 Standards Update (CSW202) enhancement is on, bypass                    CSW202
      ** validation of ISO15022 message                                                       CSW202
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
     C           CSE029    ANDEQ'Y'                                                           CSE028
     C           CSW202    ANDEQ'N'                                                           CSW202
     C                     EXSR SR1522                                                        CSE028
     C                     ENDIF                                                              CSE028
      *                                                                   CSW003
     C/COPY WNCPYSRC,SE1807C004
      *
      **  If any warning messages exist, set WARN to 'Y' to enable
      **  re-display of screen & validation.
     C           WRNS      IFEQ 'Y'
     C           WRNC      OREQ 'Y'
     C                     MOVEL'Y'       WARN    1
     C                     ELSE
     C                     MOVEL'N'       WARN
     C                     ENDIF
      *
     C                     ENDSR
      *                                                                                       201429
      *****************************************************************                       201429
      /TITLE SR/SRVAL2                                                                        201429
      *****************************************************************                       201429
      *                                                               *                       201429
      * SRVAL2 - Routine to control validation of each field.         *                       201429
      *                                                               *                       201429
      *****************************************************************                       201429
      *                                                                                       201429
     C           SRVAL2    BEGSR                                                              201429
      *                                                                                       201429
      ** Validate safekeeping account.                                                        201429
      *                                                                                       201429
     C           SD1522    IFEQ 'Y'                                                           201429
     C           SDGMES    ANDEQ'Y'                                                           201429
     C           CSE028    ANDEQ'Y'                                                           201429
     C           *IN43     ANDEQ*OFF                                                          201429
     C           *IN53     ANDEQ*OFF                                                          CSE034
      *                                                                                       201429
      ** Retrieve X2 file to check if safekeeping account                                     201429
      ** has been entered.                                                                    201429
      *                                                                                       201429
     C           KEY001    CHAINRTVIDX2              01                                       201429
     C           *IN01     IFEQ *OFF                                                          201429
     C                     MOVE D2SKAL    P2SKAL 35                                           201429
     C                     ELSE                                                               201429
     C                     MOVE *BLANKS   P2SKAL                                              201429
     C                     ENDIF                                                              201429
      *                                                                                       201429
     C           SDSAFA    IFEQ *BLANKS                                                       201429
     C           P2SKAL    ANDEQ*BLANKS                                                       201429
     C                     MOVE *ON       *IN75                                               201429
     C                     MOVE *ON       *IN25                                               201429
     C                     MOVEL'SEW9004' ZAMSID                                              201429
     C                     MOVEL'SEUSRMSG'ZAMSGF                                              201429
     C                     EXSR SRSMSG                                                        201429
     C                     ENDIF                                                              201429
      *                                                                                       201429
     C           SDSAFA    IFNE *BLANKS                                                       201429
     C           P2SKAL    ANDNE*BLANKS                                                       201429
     C                     MOVE *ON       *IN75                                               201429
     C                     MOVE *ON       *IN25                                               201429
     C                     MOVEL'SEW9007' ZAMSID                                              201429
     C                     MOVEL'SEUSRMSG'ZAMSGF                                              201429
     C                     EXSR SRSMSG                                                        201429
     C                     ENDIF                                                              201429
      *                                                                                       201429
     C                     ENDIF                                                              201429
      *                                                                                       201429
     C                     ENDSR                                                              201429
      *****************************************************************
      */TITLE*SR/SRVAL*****                                               096833
      /TITLE SR/SRINZ                                                     096833
      *****************************************************************
      *                                                               *
      * SRINZ - Routine to initialize screen fields with defaults     *
      *                                                               *
      *****************************************************************
      *
     C           SRINZ     BEGSR
      *
     C                     MOVE *BLANKS   SINST                           CSW003
     C                     MOVE *BLANKS   SINSS                           CSW003
     C                     MOVE *BLANKS   CPDI    2                       CSW003
      *                                                                   CSW003
     C                     CLEARSRPTY
     C**********           MOVE 'F'       SFIND                                               190892
      *                                                                                       194231
      **  Defaults are set up incorrectly, defaults should be                                 194231
      **  'F' for bond transactions and 'A' for all other.                                    194231
      *                                                                                       194231
     C           PACTN     IFEQ 'D'                                                           194231
     C           PACTN     OREQ 'I'                                                           204661
      *                                                                                       194231
     C           PDPMV     IFEQ 'BB'                                                          190892
     C           PDPMV     OREQ 'BL'                                                          190892
     C********** CSE028    IFEQ 'N'                                                    CSE028 204333
     C                     MOVE 'F'       SFIND                                               190892
     C**********           ENDIF                                                       CSE028 204333
     C           CSE029    IFEQ 'Y'                                                           243125
     C                     MOVEL'MT540/42'MSGTPS                                              243125
     C                     ELSE                                                               243125
     C                     MOVEL'MT520/22'MSGTPS                                              194231
     C                     ENDIF                                                              243125
     C                     MOVE '  '      MSGTPS                                              190754
     C                     ELSE                                                               194231
     C********** CSE028    IFEQ 'N'                                                    CSE028 204333
     C                     MOVE 'A'       SFIND                                               194231
     C**********           ENDIF                                                       CSE028 204333
     C           CSE029    IFEQ 'Y'                                                           243125
     C                     MOVEL'MT541/43'MSGTPS                                              243125
     C                     ELSE                                                               243125
     C                     MOVEL'MT521/23'MSGTPS                                              194231
     C                     ENDIF                                                              243125
     C                     MOVE '  '      MSGTPS                                              190754
     C                     ENDIF                                                              190892
     C*                                                                                       190892
     C********** PDPMV     IFEQ 'RP'                                                   190892 194231
     C********** PDPMV     OREQ 'RR'                                                   190892 194231
     C********** PDPMV     OREQ 'PL'                                                   190892 194231
     C********** PDPMV     OREQ 'PD'                                                   190892 194231
     C**********           MOVE 'A'       SFIND                                        190892 194231
     C                     ENDIF                                                              190892
     C*                                                                                       190892
     C           PDPMV     IFEQ 'WI'                                                          203796
     C           PDPMV     OREQ 'WO'                                                          203796
     C                     MOVE 'F'       SFIND                                               203796
     C                     ENDIF                                                              203796
      *                                                                                       203796
     C                     TIME           WWTIME  60
     C                     MOVELWWTIME    STRTT
     C                     CLEARSGDEL
     C                     CLEARSSROL
      *
      * Determine Network routing and addresses/settlements
     C           PDPMV     IFEQ 'RR'
     C           PDPMV     OREQ 'RP'                                      094415
     C           PDPMV     OREQ 'BB'
     C           PDPMV     OREQ 'BL'                                      094415
     C           PDPMV     OREQ 'PL'
     C           PDPMV     OREQ 'PD'                                      094415
     C           PDPMV     OREQ 'WI'
     C           PDPMV     OREQ 'DT'                                      094415
     C           PWHEN     ANDEQ'M'                                       094415
     C                     MOVE PDPID     WSNDR   6
     C                     MOVE PDPID     WDEST   6
      *                                                                   CSW003
      ** If destination of message is from In Depot, set up Counterparty  CSW003
      ** Depot Indicator (CPDI)                                           CSW003
     C           CLAOE     IFEQ 'E'                                       CSW003
     C                     MOVE 'OE'      CPDI    2                       CSW003
     C                     ENDIF                                          CSW003
     C           CLAOC     IFEQ 'C'                                       CSW003
     C                     MOVE 'OC'      CPDI                            CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     END
      *
     C***********PDPMV     IFEQ 'RP'                                      094415
     C***********PDPMV     OREQ 'BL'                                      094415
     C***********PDPMV     OREQ 'PD'                                      094415
     C***********PDPMV     OREQ 'WO'                                      094415
     C***********PDPMV     OREQ 'DT'                                      094415
     C           PDPMV     IFEQ 'WO'                                      094415
     C           PDPMV     OREQ 'DT'                                      094415
     C           PWHEN     ANDEQ'S'                                       094415
     C                     MOVE PDPOD     WSNDR
     C                     MOVE PDPOD     WDEST
      *                                                                   CSW003
      ** If destination of message is from Out Depot, set up Counterparty CSW003
      ** Depot Indicator (CPDI)                                           CSW003
     C           CLAIE     IFEQ 'E'                                       CSW003
     C                     MOVE 'IE'      CPDI                            CSW003
     C                     ENDIF                                          CSW003
     C           CLAIC     IFEQ 'C'                                       CSW003
     C                     MOVE 'IC'      CPDI                            CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     END
      *
     C                     MOVE *BLANKS   WSCSD  12
     C                     MOVE *BLANKS   WSETP   2
      *
     C                     EXSR SR1100
     C********** CSE028    IFEQ 'N'                                                    CSE028 211823
     C           CSE028    IFEQ 'N'                                                           244538
     C                     MOVE WWGME     SGMES
     C                     ENDIF                                                              244538
     C**********           ENDIF                                                       CSE028 211823
     C                     MOVE WWROU     SROUS
     C                     MOVE WWROT     SROTS
      *                                                                   104032
      * Default Settlement request to N if backvaluation                  104032
     C           PWHEN     IFEQ 'M'                                       104032
     C           PDPMV     ANDEQ'RP'                                      104032
     C           PWHEN     OREQ 'M'                                       104032
     C           PDPMV     ANDEQ'PD'                                      104032
     C           PWHEN     OREQ 'M'                                       104032
     C           PDPMV     ANDEQ'BL'                                      104032
     C           PWHEN     ORNE 'M'                                       104032
     C           PDPMV     ANDEQ'RR'                                      104032
     C           PWHEN     ORNE 'M'                                       104032
     C           PDPMV     ANDEQ'PL'                                      104032
     C           PWHEN     ORNE 'M'                                       104032
     C           PDPMV     ANDEQ'BB'                                      104032
     C           PDPMV     OREQ 'DT'                                      104032
     C           PDPMV     OREQ 'WI'                                      104032
      *                                                                   104032
     C                     MOVELPDPMD     ZDATE                           104032
     C                     EXSR ZDATE1                                    104032
     C           ZDAYNO    IFLT BJRDNB                                    104032
     C           CSE028    ANDEQ'N'                                                           CSE028
     C                     MOVE 'N'       SGMES                           104032
     C                     END                                            104032
     C                     END                                            104032
      *                                                                   104032
     C           PWHEN     IFEQ 'M'                                       104032
     C           PDPMV     ANDEQ'RR'                                      104032
     C           PWHEN     OREQ 'M'                                       104032
     C           PDPMV     ANDEQ'PL'                                      104032
     C           PWHEN     OREQ 'M'                                       104032
     C           PDPMV     ANDEQ'BB'                                      104032
     C           PDPMV     OREQ 'WO'                                      104032
      *                                                                   104032
     C                     MOVELPDPDO     ZDATE                           104032
     C                     EXSR ZDATE1                                    104032
     C           ZDAYNO    IFLT BJRDNB                                    104032
     C           CSE028    ANDEQ'N'                                                           CSE028
     C                     MOVE 'N'       SGMES                           104032
     C                     END                                            104032
     C                     END                                            104032
      *
      * Retrieve Cedel/Euroclear destination
     C                     MOVE *BLANKS   WWSENT  5
     C**********           MOVE WDEST     WWDEST  60                                          CSD027
     C                     MOVE WDEST     WWDEST  6                                           CSD027
      *                                                                   CSW003
     C***********WWDEST    IFEQ PDC01                                     CSW003
     C           WWDEST    IFEQ PDPID                                     CSW003
     C           CLAIE     IFEQ 'E'                                       CSW003
     C                     MOVE 'EOC  '   WWSENT
     C                     ELSE
     C***********WWDEST    IFEQ PDC02                                     CSW003
     C           CLAIC     IFEQ 'C'                                       CSW003
     C                     MOVE 'CEDEL'   WWSENT
     C                     END
     C                     END                                            CSW003
     C                     END                                            CSW003
      *                                                                   CSW003
     C           WWDEST    IFEQ PDPOD                                     CSW003
     C           CLAOE     IFEQ 'E'                                       CSW003
     C                     MOVE 'EOC  '   WWSENT                          CSW003
     C                     ELSE                                           CSW003
     C           CLAOC     IFEQ 'C'                                       CSW003
     C                     MOVE 'CEDEL'   WWSENT                          CSW003
     C                     END
     C                     END                                            CSW003
     C                     END                                            CSW003
      *                                                                   CSW003
      * Check if destination is not EOC or Cedel anyway
     C                     MOVE WDEST     WWCUST  6
     C                     CALL 'AOSECSR0'
     C                     PARM '*DBERR ' WRTCD   7
     C                     PARM '*KEY   ' WOPTN   7
     C                     PARM           WWCUST
     C           SDSECS    PARM SDSECS    DSSDY
      *
     C           BFCLAS    IFEQ 'E'
     C                     MOVE 'EOC  '   WWSENT
     C                     END
     C           BFCLAS    IFEQ 'C'
     C                     MOVE 'CEDEL'   WWSENT
     C                     END
      *
      * Init Network routing and addresses for confirmations
      * (only for Reverse repo and Repurchase agreements)
     C           PDPMV     IFNE 'RR'
     C           PDPMV     ANDNE'RP'
     C           PDPMV     ANDNE'PD'                                      103449
     C           PDPMV     ANDNE'PL'                                      103449
     C                     MOVE 'N'       SGMEC
     C                     CLEARSROUC
     C                     CLEARSROTC
      *                                                                   CSW098
     C           CSW201    IFEQ 'N'                                                           CSW201
     C           SWRTN     IFEQ 'CSW098 '                                 CSW098
     C                     MOVE *BLANKS   SSIOR   1                       CSW098
     C                     ENDIF                                          CSW098
     C                     ENDIF                                                              CSW201
      *                                                                   CSW098
     C                     ELSE
      *
     C                     MOVE PDPBN     WSNDR
     C                     MOVE PDPBN     WDEST
     C                     CLEARWSCSD
     C                     CLEARWSETP
      *
     C                     EXSR SR1100
     C                     MOVE 'N'       SGMEC
     C                     MOVE WWROU     SROUC
     C                     MOVE WWROT     SROTC
      *                                                                   CSW098
     C           CSW201    IFEQ 'N'                                                           CSW201
     C           SWRTN     IFEQ 'CSW098 '                                 CSW098
     C                     MOVE 'N'       SSIOR                           CSW098
     C                     ENDIF                                          CSW098
     C                     ENDIF                                                              CSW201
      *
     C                     END
      *
      ** Initialize Clearance type (1 to 4 is MT580 for Settlements)
      ** <===> Depot In or Out is Euroclear or Cedel
     C           WWDEST    IFEQ PDC01
     C           WWDEST    OREQ PDC02
     C           WWSENT    OREQ 'EOC  '
     C           WWSENT    OREQ 'CEDEL'
     C                     MOVE '14'      WWCLTY  2
     C                     ELSE                                           CSW003
     C                     MOVE *BLANKS   WWCLTY                          CSW003
     C                     END
      *
      * Init Euroclear/Cedel code
     C                     MOVE *BLANKS   SEUCL
     C                     MOVE *BLANKS   WKEUCL  7
     C                     MOVE *BLANKS   WWEUCL 10
      * Initial Euroclear/Cedel code blank regardless of destination      CSW003
      * for 'Walk In' or 'Walk Out'                                       CSW003
     C           PDPMV     IFNE 'WI'                                      CSW003
     C           PDPMV     ANDNE'WO'                                      CSW003
      *
      * Euroclear/Cedel code: destination Euroclear
     C***********WWDEST    IFEQ PDC01                                     CSW003
     C***********WWSENT    OREQ 'EOC  '                                   CSW003
      ***********                                                         CSW003
      **Internal*Euroclear                                                CSW003
     C***********          MOVEL'/'       WKEUCL                          CSW003
     C***********          MOVE PC101     WKEUCL                          CSW003
     C***********          MOVELWKEUCL    SEUCL                           CSW003
      ***********                                                         CSW003
      **Internal*overriden if extra EOC customer                          CSW003
     C***********CLAIE     IFEQ 'E'                                       CSW003
     C***********          MOVE DRAIE     WKEUCL                          CSW003
     C***********          MOVELWKEUCL    SEUCL                           CSW003
     C***********          END                                            CSW003
     C***********CLAOE     IFEQ 'E'                                       CSW003
     C***********          MOVE DRAOE     WKEUCL                          CSW003
     C***********          MOVELWKEUCL    SEUCL                           CSW003
     C***********          END                                            CSW003
      ***********                                                         CSW003
      **Bridge*Euroclear                                                  CSW003
     C***********PDPID     IFEQ PDC02                                     CSW003
     C***********PDPOD     OREQ PDC02                                     CSW003
     C***********CLAIC     OREQ 'C'                                       CSW003
     C***********CLAOC     OREQ 'C'                                       CSW003
     C***********          MOVEL'//XE'    WWEUCL                          CSW003
     C***********          MOVE PC101     WWEUCL                          CSW003
     C***********          MOVELWWEUCL    SEUCL                           CSW003
     C***********          END                                            CSW003
      ***********                                                         CSW003
      **Bridge*overriden if extra EOC customer                            CSW003
     C***********CLAIC     IFEQ 'C'                                       CSW003
     C***********          MOVE DRAIE     WWEUCL                          CSW003
     C***********          MOVELWWEUCL    SEUCL                           CSW003
     C***********          END                                            CSW003
     C***********CLAOC     IFEQ 'C'                                       CSW003
     C***********          MOVE DRAOE     WWEUCL                          CSW003
     C***********          MOVELWWEUCL    SEUCL                           CSW003
     C***********          END                                            CSW003
      ***********                                                         CSW003
      **more*Bridge Euroclear                                             CSW003
     C***********PDPMV     IFEQ 'RR'                                      CSW003
     C***********PDPMV     OREQ 'BB'                                      CSW003
     C***********PDPMV     OREQ 'PL'                                      CSW003
     C***********PDPMV     OREQ 'WI'                                      CSW003
      ***********                                                         CSW003
     C***********PDPOD     IFEQ PDC02                                     CSW003
     C***********CLAOC     OREQ 'C'                                       CSW003
     C***********          MOVEL'//XC'    WWEUCL                          CSW003
     C***********          MOVE PC102     WWEUCL                          CSW003
     C***********          MOVELWWEUCL    SEUCL                           CSW003
     C***********          END                                            CSW003
      ***********                                                         CSW003
      **more*Bridge overriden if extra EOC customer                       CSW003
     C***********CLAIC     IFEQ 'C'                                       CSW003
     C***********          MOVE DRAIC     WWEUCL                          CSW003
     C***********          MOVELWWEUCL    SEUCL                           CSW003
     C***********          END                                            CSW003
     C***********CLAOC     IFEQ 'C'                                       CSW003
     C***********          MOVE DRAOC     WWEUCL                          CSW003
     C***********          MOVELWWEUCL    SEUCL                           CSW003
     C***********          END                                            CSW003
     C***********          END                                            CSW003
      ***********                                                         CSW003
     C***********PDPMV     IFEQ 'RP'                                      CSW003
     C***********PDPMV     OREQ 'BL'                                      CSW003
     C***********PDPMV     OREQ 'PD'                                      CSW003
     C***********PDPMV     OREQ 'WO'                                      CSW003
     C***********PDPMV     OREQ 'DT'                                      CSW003
      ***********                                                         CSW003
     C***********PDPID     IFEQ PDC02                                     CSW003
     C***********CLAIC     OREQ 'C'                                       CSW003
     C***********          MOVEL'//XC'    WWEUCL                          CSW003
     C***********          MOVE PC102     WWEUCL                          CSW003
     C***********          MOVELWWEUCL    SEUCL                           CSW003
     C***********          END                                            CSW003
      ***********                                                         CSW003
      **more*Bridge overriden if extra EOC customer                       CSW003
     C***********CLAIC     IFEQ 'C'                                       CSW003
     C***********          MOVE DRAIC     WWEUCL                          CSW003
     C***********          MOVELWWEUCL    SEUCL                           CSW003
     C***********          END                                            CSW003
     C***********CLAOC     IFEQ 'C'                                       CSW003
     C***********          MOVE DRAOC     WWEUCL                          CSW003
     C***********          MOVELWWEUCL    SEUCL                           CSW003
     C***********          END                                            CSW003
     C***********          END                                            CSW003
      ***********                                                         CSW003
     C***********          END                                            CSW003
      *
      * Euroclear/Cedel code: destination Euroclear                       CSW003
     C           WWDEST    IFEQ PDC01                                     CSW003
     C           WWSENT    OREQ 'EOC  '                                   CSW003
      *                                                                   CSW003
     C           PDPMV     IFEQ 'DT'                                      CSW003
      *                                                                   CSW003
     C                     SELEC                                          CSW003
     C           CPDI      WHEQ 'OE'                                      CSW003
     C                     MOVEADRAOE     EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '/'       CAT  WKEUCL:0  SEUCL     P                     CSW003
     C           CPDI      WHEQ 'IE'                                      CSW003
     C                     MOVEADRAIE     EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '/'       CAT  WKEUCL:0  SEUCL     P                     CSW003
     C           CPDI      WHEQ 'OC'                                      CSW003
     C                     MOVEADRAOC     EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '//XC'    CAT  WKEUCL:0  SEUCL     P                     CSW003
     C           CPDI      WHEQ 'IC'                                      CSW003
     C                     MOVEADRAIC     EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '//XC'    CAT  WKEUCL:0  SEUCL     P                     CSW003
     C                     ENDSL                                          CSW003
      *                                                                   CSW003
     C                     ELSE                                           CSW003
      *                                                                   CSW003
     C           BCCLAS    IFEQ 'M'                                       CSW003
      *                                                                   CSW003
     C           CPDI      IFEQ 'OC'                                      CSW003
     C                     MOVEAPC102     EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '//XC'    CAT  WKEUCL:0  SEUCL     P                     CSW003
     C                     ELSE                                           CSW003
     C                     MOVEAPC101     EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '/'       CAT  WKEUCL:0  SEUCL     P                     CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C           BCCLAS    IFEQ 'S'                                       CSW003
     C           BCCLAS    OREQ 'D'                                       CSW003
      *                                                                   CSW003
      * Determine depot reference for counterparty depot.                 CSW003
     C                     MOVE PDPOD     WWCUST                          CSW003
     C                     CALL 'AOSECSR0'                                CSW003
     C                     PARM '*DBERR ' WRTCD                           CSW003
     C                     PARM '*KEY   ' WOPTN                           CSW003
     C                     PARM           WWCUST                          CSW003
     C           SDSECS    PARM SDSECS    DSSDY                           CSW003
      *                                                                   CSW003
     C           CPDI      IFEQ 'OE'                                      CSW003
     C                     MOVELBFNDR1    BFDRF1                          CSE022
     C                     MOVEABFDRF1    EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '/'       CAT  WKEUCL:0  SEUCL     P                     CSW003
     C                     ENDIF                                          CSW003
     C           CPDI      IFEQ 'OC'                                      CSW003
     C                     MOVELBFNDR2    BFDRF2                          CSE022
     C                     MOVEABFDRF2    EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '//XC'    CAT  WKEUCL:0  SEUCL     P                     CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
      * Euroclear/Cedel code: destination Cedel
     C***********WWDEST    IFEQ PDC02                                     CSW003
     C***********WWSENT    OREQ 'CEDEL'                                   CSW003
      ***********                                                         CSW003
      **Internal*Cedel                                                    CSW003
     C***********          MOVEL'/'       WKEUCL                          CSW003
     C***********          MOVE PC102     WKEUCL                          CSW003
     C***********          MOVELWKEUCL    SEUCL                           CSW003
      ***********                                                         CSW003
      **Internal*overriden if extra CEDEL customer                        CSW003
     C***********CLAIC     IFEQ 'C'                                       CSW003
     C***********          MOVE DRAIC     WKEUCL                          CSW003
     C***********          MOVELWKEUCL    SEUCL                           CSW003
     C***********          END                                            CSW003
     C***********CLAOC     IFEQ 'C'                                       CSW003
     C***********          MOVE DRAOC     WKEUCL                          CSW003
     C***********          MOVELWKEUCL    SEUCL                           CSW003
     C***********          END                                            CSW003
      ***********                                                         CSW003
      **Bridge*Cedel                                                      CSW003
     C***********PDPID     IFEQ PDC01                                     CSW003
     C***********PDPOD     OREQ PDC01                                     CSW003
     C***********CLAIE     OREQ 'E'                                       CSW003
     C***********CLAOE     OREQ 'E'                                       CSW003
     C***********          MOVEL'//XC'    WWEUCL                          CSW003
     C***********          MOVE PC102     WWEUCL                          CSW003
     C***********          MOVELWWEUCL    SEUCL                           CSW003
     C***********          END                                            CSW003
      ***********                                                         CSW003
      **Bridge*overriden if extra CEDEL customer                          CSW003
     C***********CLAIE     IFEQ 'E'                                       CSW003
     C***********          MOVE DRAIC     WWEUCL                          CSW003
     C***********          MOVELWWEUCL    SEUCL                           CSW003
     C***********          END                                            CSW003
     C***********CLAOE     IFEQ 'E'                                       CSW003
     C***********          MOVE DRAOC     WWEUCL                          CSW003
     C***********          MOVELWWEUCL    SEUCL                           CSW003
     C***********          END                                            CSW003
      ***********                                                         CSW003
      **more*Bridge Cedel                                                 CSW003
     C***********PDPMV     IFEQ 'RR'                                      CSW003
     C***********PDPMV     OREQ 'BB'                                      CSW003
     C***********PDPMV     OREQ 'PL'                                      CSW003
     C***********PDPMV     OREQ 'WI'                                      CSW003
      ***********                                                         CSW003
     C***********PDPOD     IFEQ PDC01                                     CSW003
     C***********CLAOE     OREQ 'E'                                       CSW003
     C***********          MOVEL'//XE'    WWEUCL                          CSW003
     C***********          MOVE PC101     WWEUCL                          CSW003
     C***********          MOVELWWEUCL    SEUCL                           CSW003
     C***********          END                                            CSW003
      ***********                                                         CSW003
      **more*Bridge overriden if extra CEDEL customer                     CSW003
     C***********CLAIE     IFEQ 'E'                                       CSW003
     C***********          MOVE DRAIE     WWEUCL                          CSW003
     C***********          MOVELWWEUCL    SEUCL                           CSW003
     C***********          END                                            CSW003
     C***********CLAOE     IFEQ 'E'                                       CSW003
     C***********          MOVE DRAOE     WWEUCL                          CSW003
     C***********          MOVELWWEUCL    SEUCL                           CSW003
     C***********          END                                            CSW003
     C***********          END                                            CSW003
      ***********                                                         CSW003
     C***********PDPMV     IFEQ 'RP'                                      CSW003
     C***********PDPMV     OREQ 'BL'                                      CSW003
     C***********PDPMV     OREQ 'PD'                                      CSW003
     C***********PDPMV     OREQ 'WO'                                      CSW003
     C***********PDPMV     OREQ 'DT'                                      CSW003
      ***********                                                         CSW003
     C***********PDPID     IFEQ PDC01                                     CSW003
     C***********CLAIE     OREQ 'E'                                       CSW003
     C***********          MOVEL'//XE'    WWEUCL                          CSW003
     C***********          MOVE PC101     WWEUCL                          CSW003
     C***********          MOVELWWEUCL    SEUCL                           CSW003
     C***********          END                                            CSW003
      ***********                                                         CSW003
      **more*Bridge overriden if extra CEDEL customer                     CSW003
     C***********CLAIE     IFEQ 'E'                                       CSW003
     C***********          MOVE DRAIE     WWEUCL                          CSW003
     C***********          MOVELWWEUCL    SEUCL                           CSW003
     C***********          END                                            CSW003
     C***********CLAOE     IFEQ 'E'                                       CSW003
     C***********          MOVE DRAOE     WWEUCL                          CSW003
     C***********          MOVELWWEUCL    SEUCL                           CSW003
     C***********          END                                            CSW003
     C***********          END                                            CSW003
      ***********                                                         CSW003
     C***********          END                                            CSW003
      *                                                                   CSW003
      * Euroclear/Cedel code: destination Cedel                           CSW003
     C           WWDEST    IFEQ PDC02                                     CSW003
     C           WWSENT    OREQ 'CEDEL'                                   CSW003
      *                                                                   CSW003
     C           PDPMV     IFEQ 'DT'                                      CSW003
      *                                                                   CSW003
     C                     SELEC                                          CSW003
     C           CPDI      WHEQ 'OC'                                      CSW003
     C                     MOVEADRAOC     EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '/'       CAT  WKEUCL:0  SEUCL     P                     CSW003
     C           CPDI      WHEQ 'IC'                                      CSW003
     C                     MOVEADRAIC     EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '/'       CAT  WKEUCL:0  SEUCL     P                     CSW003
     C           CPDI      WHEQ 'OE'                                      CSW003
     C                     MOVEADRAOE     EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '//XE'    CAT  WKEUCL:0  SEUCL     P                     CSW003
     C           CPDI      WHEQ 'IE'                                      CSW003
     C                     MOVEADRAIE     EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '//XE'    CAT  WKEUCL:0  SEUCL     P                     CSW003
     C                     ENDSL                                          CSW003
      *                                                                   CSW003
      * Else not Depot Transfer.                                          CSW003
     C                     ELSE                                           CSW003
      *                                                                   CSW003
      * Classification of Beneficiary Customer is Market Client.          CSW003
     C           BCCLAS    IFEQ 'M'                                       CSW003
      *                                                                   CSW003
     C           CPDI      IFEQ 'OE'                                      CSW003
     C                     MOVEAPC101     EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '//XE'    CAT  WKEUCL:0  SEUCL     P                     CSW003
     C                     ELSE                                           CSW003
     C                     MOVEAPC102     EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '/'       CAT  WKEUCL:0  SEUCL     P                     CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
      * Beneficiary Customer is Safe Custody or Discretionary.            CSW003
     C           BCCLAS    IFEQ 'S'                                       CSW003
     C           BCCLAS    OREQ 'D'                                       CSW003
      *                                                                   CSW003
      * Determine depot reference for counterparty depot.                 CSW003
     C                     MOVE PDPOD     WWCUST                          CSW003
      *                                                                   CSW003
     C                     CALL 'AOSECSR0'                                CSW003
     C                     PARM '*DBERR ' WRTCD                           CSW003
     C                     PARM '*KEY   ' WOPTN                           CSW003
     C                     PARM           WWCUST                          CSW003
     C           SDSECS    PARM SDSECS    DSSDY                           CSW003
      *                                                                   CSW003
     C           CPDI      IFEQ 'OC'                                      CSW003
     C                     MOVELBFNDR2    BFDRF2                          CSE022
     C                     MOVEABFDRF2    EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '/'       CAT  WKEUCL:0  SEUCL     P                     CSW003
     C                     ENDIF                                          CSW003
     C           CPDI      IFEQ 'OE'                                      CSW003
     C                     MOVELBFNDR1    BFDRF1                          CSE022
     C                     MOVEABFDRF1    EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '//XE'    CAT  WKEUCL:0  SEUCL     P                     CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      *
      * Init Safekeeping Account
      *                                                                                       CSE028
     C           CSE028    IFEQ 'N'                                                           CSE028
      *                                                                                       CSE028
     C                     CLEARSSAFA
      *
     C***********WWDEST    IFEQ PDC01                                     CSW003
     C***********WWSENT    OREQ 'EOC  '                                   CSW003
      ***********                                                         CSW003
     C***********          MOVE PDC01     WWCUST  6                       CSW003
     C***********          CALL 'AOSECSR0'                                CSW003
     C***********          PARM '*DBERR ' WRTCD   7                       CSW003
     C***********          PARM '*KEY   ' WOPTN   7                       CSW003
     C***********          PARM           WWCUST                          CSW003
     C***********SDSECS    PARM SDSECS    DSSDY                           CSW003
      ***********                                                         CSW003
     C***********BFDRF1    IFNE *BLANKS                                   CSW003
     C***********          MOVE BFDRF1    SSAFA                           CSW003
     C***********          MOVEL'/'       SSAFA                           CSW003
     C***********          END                                            CSW003
     C***********          END                                            CSW003
      ***********                                                         CSW003
     C***********WWDEST    IFEQ PDC02                                     CSW003
     C***********WWSENT    OREQ 'CEDEL'                                   CSW003
      ***********                                                         CSW003
     C***********          MOVE PDC02     WWCUST  6                       CSW003
     C***********          CALL 'AOSECSR0'                                CSW003
     C***********          PARM '*DBERR ' WRTCD   7                       CSW003
     C***********          PARM '*KEY   ' WOPTN   7                       CSW003
     C***********          PARM           WWCUST                          CSW003
     C***********SDSECS    PARM SDSECS    DSSDY                           CSW003
      ***********                                                         CSW003
     C***********BFDRF2    IFNE *BLANKS                                   CSW003
     C***********          MOVE BFDRF2    SSAFA                           CSW003
     C***********          MOVEL'/'       SSAFA                           CSW003
     C***********          END                                            CSW003
     C***********          END                                            CSW003
      *
     C           PDPMV     IFEQ 'DT'                                      CSW003
      *                                                                   CSW003
     C           PWHEN     IFEQ 'S'                                       CSW003
     C           PWHEN     OREQ *BLANKS                                   CSW003
     C           CLAOE     IFEQ 'E'                                       CSW003
     C                     MOVEADRAOE     EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '/'       CAT  WKEUCL:0  SSAFA     P                     CSW003
     C                     ENDIF                                          CSW003
     C           CLAOC     IFEQ 'C'                                       CSW003
     C                     MOVEADRAOC     EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '/'       CAT  WKEUCL:0  SSAFA     P                     CSW003
     C                     ENDIF                                          CSW003
     C                     ELSE                                           CSW003
     C           CLAIC     IFEQ 'C'                                       CSW003
     C                     MOVEADRAIC     EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '/'       CAT  WKEUCL:0  SSAFA     P                     CSW003
     C                     ENDIF                                          CSW003
     C           CLAIE     IFEQ 'E'                                       CSW003
     C                     MOVEADRAIE     EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '/'       CAT  WKEUCL:0  SSAFA     P                     CSW003
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ELSE                                           CSW003
      *                                                                   CSW003
     C           WWSENT    IFEQ 'EOC  '                                   CSW003
     C           CLAIE     IFEQ 'E'                                       CSW003
     C                     MOVEADRAIE     EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '/'       CAT  WKEUCL:0  SSAFA     P                     CSW003
     C                     ELSE                                           CSW003
     C                     MOVEADRAOE     EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '/'       CAT  WKEUCL:0  SSAFA     P                     CSW003
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C           WWSENT    IFEQ 'CEDEL'                                   CSW003
     C           CLAIC     IFEQ 'C'                                       CSW003
     C                     MOVEADRAIC     EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '/'       CAT  WKEUCL:0  SSAFA     P                     CSW003
     C                     ELSE                                           CSW003
     C                     MOVEADRAOC     EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '/'       CAT  WKEUCL:0  SSAFA     P                     CSW003
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      *                                                                                       CSE028
     C                     ENDIF                                                              CSE028
      *                                                                   CSW003
      **  If Settlement Message Request is 'N' then set Counterparty/Ce
      **  Cedel code & safekeeping Account to blanks
      **  unless Beneficiary Customer is S or D and IN Depot is different CSW003
      **  from the OUT Depot.                                             CSW003
      *
     C           SGMES     IFEQ 'N'
     C           CSE028    ANDEQ'N'                                                           CSE028
     C                     MOVE *BLANKS   SEUCL
     C                     MOVE *BLANKS   SSAFA
     C                     ELSE                                           CSW003
      *                                                                   CSW003
     C           BCCLAS    IFEQ 'S'                                       CSW003
     C           PDPID     ANDEQPDPOD                                     CSW003
     C           CSE028    ANDEQ'N'                                                           CSE028
     C           BCCLAS    OREQ 'D'                                       CSW003
     C           PDPID     ANDEQPDPOD                                     CSW003
     C           CSE028    ANDEQ'N'                                                           CSE028
     C                     MOVE 'N'       SGMES                           CSW003
     C                     ENDIF                                          CSW003
     C                     ENDIF
      *
      **  Default Price on 1st Screen with Market Price                   CSW003
     C           DOONCE    IFEQ *BLANKS                                   CSW003
     C           *IN40     ANDEQ*ON                                       CSW003
     C********** CSE028    ANDEQ'N'                                                    CSE028 246912
     C                     MOVE PMKTP     ZFIELD                          CSW003
     C                     Z-ADD8         ZADEC                           CSW003
     C                     EXSR ZEDIT                                     CSW003
     C                     MOVE ZFIELD    SDPRIC                          CSW003
     C                     MOVE 'DONE'    DOONCE  4                       CSW003
     C/COPY WNCPYSRC,SE1807C011
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C           CSW003    IFEQ 'Y'                                       CSW003
     C           CSE028    ANDEQ'N'                                                           CSE028
      *                                                                   CSW003
     C           PDPMV     IFNE 'WI'                                      CSW003
     C           PDPMV     ANDNE'WO'                                      CSW003
      *                                                                   CSW003
     C           WWSENT    IFEQ 'EOC  '                                   CSW003
      *                                                                   CSW003
     C           CPDI      IFEQ 'IE'                                      CSW003
     C           CPDI      OREQ 'OE'                                      CSW003
     C                     MOVEL'MATCH'   SINSS                           CSW003
      *                                                                   CSW003
     C           PWHEN     IFEQ 'S'                                       CSW003
     C           PDPMV     IFEQ 'BB'                                      CSW003
     C           PDPMV     OREQ 'RR'                                      CSW003
     C           PDPMV     OREQ 'PL'                                      CSW003
     C                     MOVEL'01'      SINST                           CSW003
     C                     ELSE                                           CSW003
     C                     MOVEL'02'      SINST                           CSW003
     C                     ENDIF                                          CSW003
      ** Else Maturity Date                                               CSW003
     C                     ELSE                                           CSW003
     C           PDPMV     IFEQ 'BB'                                      CSW003
     C           PDPMV     OREQ 'RR'                                      CSW003
     C           PDPMV     OREQ 'PL'                                      CSW003
     C                     MOVEL'02'      SINST                           CSW003
     C                     ELSE                                           CSW003
     C                     MOVEL'01'      SINST                           CSW003
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C           CPDI      IFEQ 'IC'                                      CSW003
     C           CPDI      OREQ 'OC'                                      CSW003
     C                     MOVEL'MATCH'   SINSS                           CSW003
      *                                                                   CSW003
     C           PWHEN     IFEQ 'S'                                       CSW003
     C           PDPMV     IFEQ 'BB'                                      CSW003
     C           PDPMV     OREQ 'RR'                                      CSW003
     C           PDPMV     OREQ 'PL'                                      CSW003
     C                     MOVEL'03C'     SINST                           CSW003
     C                     ELSE                                           CSW003
     C                     MOVEL'07C'     SINST                           CSW003
     C                     ENDIF                                          CSW003
      ** Else Maturity Date                                               CSW003
     C                     ELSE                                           CSW003
     C           PDPMV     IFEQ 'BB'                                      CSW003
     C           PDPMV     OREQ 'RR'                                      CSW003
     C           PDPMV     OREQ 'PL'                                      CSW003
     C                     MOVEL'07C'     SINST                           CSW003
     C                     ELSE                                           CSW003
     C                     MOVEL'03C'     SINST                           CSW003
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C           CPDI      IFEQ *BLANKS                                   CSW003
     C                     MOVE *BLANKS   SINSS                           CSW003
      *                                                                   CSW003
     C           PWHEN     IFEQ 'S'                                       CSW003
     C           PDPMV     IFEQ 'BB'                                      CSW003
     C           PDPMV     OREQ 'RR'                                      CSW003
     C           PDPMV     OREQ 'PL'                                      CSW003
     C********** CLAOK     IFEQ 'K'                                CSW003 CSE022
     C**********           MOVEL'03K'     SINST                    CSW003 CSE022
     C**********           ELSE                                    CSW003 CSE022
     C                     MOVEL'03'      SINST                           CSW003
     C**********           ENDIF                                   CSW003 CSE022
      ** Else Other Movement Type                                         CSW003
     C                     ELSE                                           CSW003
     C********** CLAOK     IFEQ 'K'                                CSW003 CSE022
     C********** CLAIK     OREQ 'K'                                CSW003 CSE022
     C**********           MOVEL'07K'     SINST                    CSW003 CSE022
     C**********           ELSE                                    CSW003 CSE022
     C                     MOVEL'07'      SINST                           CSW003
     C**********           ENDIF                                   CSW003 CSE022
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      ** Else Maturity Date                                               CSW003
     C                     ELSE                                           CSW003
     C           PDPMV     IFEQ 'BB'                                      CSW003
     C           PDPMV     OREQ 'RR'                                      CSW003
     C           PDPMV     OREQ 'PL'                                      CSW003
     C********** CLAOK     IFEQ 'K'                                CSW003 CSE022
     C**********           MOVEL'07K'     SINST                    CSW003 CSE022
     C**********           ELSE                                    CSW003 CSE022
     C                     MOVEL'07'      SINST                           CSW003
     C**********           ENDIF                                   CSW003 CSE022
      ** Else Other Movement Type                                         CSW003
     C                     ELSE                                           CSW003
     C********** CLAIK     IFEQ 'K'                                CSW003 CSE022
     C********** CLAOK     OREQ 'K'                                CSW003 CSE022
     C**********           MOVEL'03K'     SINST                    CSW003 CSE022
     C**********           ELSE                                    CSW003 CSE022
     C                     MOVEL'03'      SINST                           CSW003
     C**********           ENDIF                                   CSW003 CSE022
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C           WWSENT    IFEQ 'CEDEL'                                   CSW003
     C                     MOVE *BLANKS   SINSS                           CSW003
      *                                                                   CSW003
     C           PWHEN     IFEQ 'S'                                       CSW003
     C           PDPMV     IFEQ 'BB'                                      CSW003
     C           PDPMV     OREQ 'RR'                                      CSW003
     C           PDPMV     OREQ 'PL'                                      CSW003
     C                     MOVEL'4F'      SINST                           CSW003
     C                     ELSE                                           CSW003
     C                     MOVEL'5F'      SINST                           CSW003
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C           PWHEN     IFEQ 'M'                                       CSW003
     C           PDPMV     IFEQ 'BB'                                      CSW003
     C           PDPMV     OREQ 'RR'                                      CSW003
     C           PDPMV     OREQ 'PL'                                      CSW003
     C                     MOVEL'5F'      SINST                           CSW003
     C                     ELSE                                           CSW003
     C                     MOVEL'4F'      SINST                           CSW003
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C/COPY WNCPYSRC,SE1807C005
     C                     ENDIF                                          CSW003
      *                                                                                       CSE028
      ** If CSE028 is present then call SESSIR0 for the setting up of                         CSE028
      ** MT5xx information.                                                                   CSE028
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
      *                                                                                       CSE028
      ** First need to settup input parms for SESSIR0                                         CSE028
      *                                                                                       CSE028
     C                     MOVE 'D'       POPTYP  1                                           CSE028
     C                     MOVE PDPBA     PBRCH   3                                           CSE028
     C                     MOVE PDPBN     PCUST   6                                           CSE028
     C                     MOVE PBKC      PBOOK   2                                           CSE028
     C                     MOVE PNMCY     PCCY    3                                           CSE028
     C                     MOVE SITP      PINTYP  3                                           CSE028
     C                     MOVE PTFR      PPOREF  4                                           CSE028
      *                                                                                       207255
     C           CSE029    IFNE 'Y'                                                           207255
     C           PDPMV     ORNE 'WI'                                                         BUG6308
     C           PDPMV     ANDNE'WO'                                                         BUG6308
     C                     MOVE SMCC      PMRKT   2                                           CSE034
     C                     ENDIF                                                              207255
      *                                                                                       CSE028
     C                     CALL 'SESSIR0'                                                     CSE028
      *                                                                                       CSE028
      ** INPUT PARAMETERS                                                                     CSE028
      ** Operation type                                                                       CSE028
      ** Branch                                                                               CSE028
      ** Customer                                                                             CSE028
      ** Book                                                                                 CSE028
      ** Currency                                                                             CSE028
      ** Market Centre                                                                        CSE034
      ** Investment type                                                                      CSE028
      ** Portfolio reference                                                                  CSE028
      *                                                                                       CSE028
     C                     PARM           POPTYP                                              CSE028
     C                     PARM           PBRCH                                               CSE028
     C                     PARM           PCUST                                               CSE028
     C                     PARM           PBOOK                                               CSE028
     C                     PARM           PCCY                                                CSE028
     C                     PARM           PMRKT                                               CSE034
     C                     PARM           PINTYP                                              CSE028
     C                     PARM           PPOREF                                              CSE028
      *                                                                                       CSE028
      ** OUTPUT PARAMETERS                                                                    CSE028
      ** Data structure for STDSED (Book and Customer)                                        CSE028
      ** Data structure for STDADSED (Book and Customer)                                      CSE028
      ** (For trade Purchase)                                                                 CSE028
      ** (For trade Sale)                                                                     CSE028
      ** (For physical Depot IN)                                                              CSE028
      ** (For physical Depot OUT)                                                             CSE028
      ** Return code                                                                          CSE028
      *                                                                                       CSE028
     C                     PARM           DSSTD                                               CSE028
     C                     PARM           DSADD                                               CSE028
     C                     PARM           PTRCD   5                                           CSE028
      *                                                                                       CSE028
      ** Move data returned from call to SESSIR0 to screen fields                             CSE028
      ** Data structure occurence to use depends on movement type                             CSE028
      ** from SE70DT. If return code from SESSIR0 =                                           CSE028
      ** *NRF then no record found so no need to                                              CSE028
      ** set occurence indicator Z.                                                           CSE028
      *                                                                                       CSE028
     C           PTRCD     IFEQ '*NRF  '                                                      CSE028
     C                     Z-ADD0         Z                                                   CSE028
     C                     ELSE                                                               CSE028
      *                                                                                       CSE028
      ** If occurence 1 of data structure DSSTD is filled then we                             CSE028
      ** have book data so we need to look at occurencs 1-4 of data                           CSE028
      ** structure DSADD.                                                                     CSE028
      ** If occurence 2 of data structure DSSTD is filled then we                             CSE028
      ** have customer data so we need to look at occurencs 5-8 of                            CSE028
      ** structure DSADD.                                                                     CSE028
      *                                                                                       CSE028
     C                     MOVE ' '       @BOOK   1                                           CSE028
     C                     MOVE ' '       @CUST   1                                           CSE028
      *                                                                                       CSE028
      ** Check if book data                                                                   CSE028
      *                                                                                       CSE028
     C           1         OCUR DSSTD                                                         CSE028
     C           SIBK      IFNE *BLANKS                                                       CSE028
     C                     MOVE 'Y'       @BOOK                                               CSE028
     C                     MOVE 'N'       @CUST                                               CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
      ** Check if customer data                                                               CSE028
      *                                                                                       CSE028
     C           @BOOK     IFNE 'Y'                                                           CSE028
     C           2         OCUR DSSTD                                                         CSE028
     C********** CSTM      IFNE 0                                                      CSE028 CSD027
     C           CSTM      IFNE *BLANKS                                                       CSD027
     C                     MOVE 'N'       @BOOK                                               CSE028
     C                     MOVE 'Y'       @CUST                                               CSE028
     C                     ENDIF                                                              CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
      ** Now work out which occurence of data structure DSADD                                 CSE028
      *                                                                                       CSE028
     C                     Z-ADD0         Z       20                                          CSE028
      *                                                                                       CSE028
     C                     SELEC                                                              CSE028
     C           PDPMV     WHEQ 'WI'                                                          CSE028
     C           PDPMV     OREQ 'WO'                                                          CSE028
     C           PDPMV     OREQ 'RP'                                      204662
     C           PDPMV     OREQ 'RR'                                      204662
     C           PDPMV     OREQ 'BB'                                      204662
     C           PDPMV     OREQ 'BL'                                      204662
      *                                                                                       CSE028
     C           STFDM     IFEQ 'Y'                                                           CSE028
      *                                                                                       CSE028
     C                     SELEC                                                              CSE028
     C           PDPMV     WHEQ 'WI'                                                          CSE028
     C           PDPMV     OREQ 'RP'                                      204662
     C           PWHEN     ANDEQ'M'                                       204662
     C           PDPMV     OREQ 'RR'                                      204662
     C           PWHEN     ANDEQ'S'                                       204662
     C           PDPMV     OREQ 'BL'                                      204662
     C           PWHEN     ANDEQ'M'                                       204662
     C           PDPMV     OREQ 'BB'                                      204662
     C           PWHEN     ANDEQ'S'                                       204662
      *                                                                                       CSE028
      ** Trade purchase                                                                       CSE028
      *                                                                                       CSE028
     C                     Z-ADD1         Z       20                                          CSE028
     C           PDPMV     WHEQ 'WO'                                                          CSE028
     C           PDPMV     OREQ 'RP'                                      204662
     C           PWHEN     ANDEQ'S'                                       204662
     C           PDPMV     OREQ 'RR'                                      204662
     C           PWHEN     ANDEQ'M'                                       204662
     C           PDPMV     OREQ 'BL'                                      204662
     C           PWHEN     ANDEQ'S'                                       204662
     C           PDPMV     OREQ 'BB'                                      204662
     C           PWHEN     ANDEQ'M'                                       204662
      *                                                                                       CSE028
      ** Trade sale                                                                           CSE028
      *                                                                                       CSE028
     C                     Z-ADD2         Z                                                   CSE028
     C                     ENDSL                                                              CSE028
      *                                                                                       CSE028
     C                     ELSE                                                               CSE028
      *                                                                                       CSE028
     C                     SELEC                                                              CSE028
     C           PDPMV     WHEQ 'WI'                                                          CSE028
     C           PDPMV     OREQ 'RP'                                      204662
     C           PWHEN     ANDEQ'M'                                       204662
     C           PDPMV     OREQ 'RR'                                      204662
     C           PWHEN     ANDEQ'S'                                       204662
     C           PDPMV     OREQ 'BL'                                      204662
     C           PWHEN     ANDEQ'M'                                       204662
     C           PDPMV     OREQ 'BB'                                      204662
     C           PWHEN     ANDEQ'S'                                       204662
      *                                                                                       CSE028
      ** Depot in                                                                             CSE028
      *                                                                                       CSE028
     C                     Z-ADD3         Z                                                   CSE028
     C           PDPMV     WHEQ 'WO'                                                          CSE028
     C           PDPMV     OREQ 'RP'                                      204662
     C           PWHEN     ANDEQ'S'                                       204662
     C           PDPMV     OREQ 'RR'                                      204662
     C           PWHEN     ANDEQ'M'                                       204662
     C           PDPMV     OREQ 'BL'                                      204662
     C           PWHEN     ANDEQ'S'                                       204662
     C           PDPMV     OREQ 'BB'                                      204662
     C           PWHEN     ANDEQ'M'                                       204662
      *                                                                                       CSE028
      ** Depot out                                                                            CSE028
      *                                                                                       CSE028
     C                     Z-ADD4         Z                                                   CSE028
     C                     ENDSL                                                              CSE028
      *                                                                                       CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     OTHER                                                              CSE028
      *                                                                                       CSE028
      ** First need to reverse movement dates in and out for                                  CSE028
      ** comparisons.                                                                         CSE028
      *                                                                                       CSE028
     C                     MOVE PDPMD     @WKIN                                               CSE028
     C                     MOVE PDPDO     @WKOT                                               CSE028
     C                     Z-ADD@WKIN1    @MVIN3                                              CSE028
     C                     Z-ADD@WKIN2    @MVIN2                                              CSE028
     C                     Z-ADD@WKIN3    @MVIN1                                              CSE028
     C                     Z-ADD@WKOT1    @MVOT3                                              CSE028
     C                     Z-ADD@WKOT2    @MVOT2                                              CSE028
     C                     Z-ADD@WKOT3    @MVOT1                                              CSE028
      *                                                                                       CSE028
     C                     SELEC                                                              CSE028
     C           @MVIN     WHGT @MVOT                                                         CSE028
      *                                                                                       CSE028
      ** Depot out first screen                                                               CSE028
      *                                                                                       CSE028
     C                     Z-ADD4         Z                                                   CSE028
     C           @MVIN     WHLT @MVOT                                                         CSE028
      *                                                                                       CSE028
      ** Depot in  first screen                                                               CSE028
      *                                                                                       CSE028
     C                     Z-ADD3         Z                                                   CSE028
     C                     ENDSL                                                              CSE028
      *                                                                                       CSE028
     C                     ENDSL                                                              CSE028
      *                                                                                       CSE028
      ** For book data then Z set for occurence 1,2,3 or 4 is fine.                           CSE028
      ** For customer data we need Z set to 5,6,7 or 8 so add 4 to                            CSE028
      ** Z after previously setting.                                                          CSE028
      *                                                                                       CSE028
     C           @CUST     IFEQ 'Y'                                                           CSE028
     C                     ADD  4         Z                                                   CSE028
     C                     ENDIF                                                              CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
      ** IF Z not set then we have no data from SESSIR0 so                                    CSE028
      ** use normal defaulting.                                                               CSE028
      *                                                                                       CSE028
     C           Z         IFNE 0                                                             CSE028
      *                                                                                       CSE028
     C           Z         OCUR DSADD                                                         CSE028
      *                                                                                       CSE028
      ** Destination of settlement                                                            CSE028
      ** (Not done from SESSIR0)                                                              CSE028
      *                                                                                       CSE028
      ** Settlement message request                                                           CSE028
      *                                                                                       CSE028
     C           PWHEN     IFEQ 'S'                                                           CSE028
     C                     MOVE SAGMES    SDGMES                                              CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE SAGMES    MDGMES                                              CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       212289
      ** If Destination of settlement is Unroutable, set to 'N' settlement                    212289
      ** message request                                                                      212289
      *                                                                                       212289
     C           WWGME     IFEQ 'N'                                                           212289
     C           PWHEN     IFEQ 'S'                                                           212289
     C                     MOVE 'N'       SDGMES                                              212289
     C                     ELSE                                                               212289
     C                     MOVE 'N'       MDGMES                                              212289
     C                     ENDIF                                                              212289
     C                     ENDIF                                                              212289
      *                                                                                       CSE028
      ** ISO15022 Messages indicator                                                          CSE028
      *                                                                                       CSE028
     C           CSE029    IFEQ 'Y'                                                           CSE028
     C           PWHEN     IFEQ 'S'                                                           CSE028
     C                     MOVE SNEW      SD1522                                              CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE SNEW      MD1522                                              CSE028
     C                     ENDIF                                                              CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
      ** Instruction type                                                                     CSE028
      *                                                                                       CSE028
     C           PWHEN     IFEQ 'S'                                                           CSE028
     C                     MOVE SAINST    SDINST                                              CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE SAINST    MDINST                                              CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
      ** Instruction sub-type                                                                 CSE028
      *                                                                                       CSE028
     C           PWHEN     IFEQ 'S'                                                           CSE028
     C                     MOVE SAINSS    SDINSS                                              CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE SAINSS    MDINSS                                              CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
      ** Euroclear/Cedel code                                                                 CSE028
      ** (Not done from SESSIR0)                                                              CSE028
      *                                                                                       CSE028
      ** Safekeeping Account                                                                  CSE028
      *                                                                                       CSE028
     C           PWHEN     IFEQ 'S'                                                           CSE028
     C                     MOVELSKAC      SDSAFA                                              CSE028
     C                     ELSE                                                               CSE028
     C                     MOVELSKAC      MDSAFA                                              CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
      ** Free or against Payment                                                              CSE028
      *                                                                                       CSE028
     C           PWHEN     IFEQ 'S'                                                           CSE028
     C                     MOVE SAFIND    SDFIND                                              CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE SAFIND    MDFIND                                              CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
      ** Price                                                                                CSE028
      *                                                                                       CSE028
     C                     MOVE PMKTP     ZFIELD                                              CSE028
     C                     Z-ADD8         ZADEC                                               CSE028
     C                     EXSR ZEDIT                                                         CSE028
      *                                                                                       CSE028
     C           PWHEN     IFEQ 'S'                                                           CSE028
     C                     MOVE ZFIELD    SDPRIC                                              CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE ZFIELD    MDPRIC                                              CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
      ** Time of transaction                                                                  CSE028
      *                                                                                       CSE028
     C           PWHEN     IFEQ 'S'                                                           CSE028
     C                     MOVE STRTT     SDTRTT                                              CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE STRTT     MDTRTT                                              CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
      ** Exchange rate                                                                        CSE028
      ** (Not done from SESSIR0)                                                              CSE028
      *                                                                                       CSE028
      ** Requested priority                                                                   CSE028
      *                                                                                       CSE028
     C           PWHEN     IFEQ 'S'                                                           CSE028
     C                     MOVE SARPTY    SDRPTY                                              CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE SARPTY    MDRPTY                                              CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
      ** Accrued interest                                                                     CSE028
      ** (Not done from SESSIR0)                                                              CSE028
      *                                                                                       CSE028
      ** Guaranteed delivery                                                                  CSE028
      *                                                                                       CSE028
     C           PWHEN     IFEQ 'S'                                                           CSE028
     C                     MOVE SAGDEL    SDGDEL                                              CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE SAGDEL    MDGDEL                                              CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
      ** Senders role                                                                         CSE028
      *                                                                                       CSE028
     C           PWHEN     IFEQ 'S'                                                           CSE028
     C                     MOVE SASROL    SDSROL                                              CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE SASROL    MDSROL                                              CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
      ** Fungibility code                                                                     CSE028
      ** (Not done from SESSIR0)                                                              CSE028
      *                                                                                       CSE028
      ** Destination of confirmation                                                          CSE028
      ** (Not done from SESSIR0)                                                              CSE028
      *                                                                                       CSE028
      ** Confirmation message request                                                         CSE028
      *                                                                                       CSE028
     C           PWHEN     IFEQ 'S'                                                           CSE028
     C                     MOVE SACONG    SDGMEC                                              CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE SACONG    MDGMEC                                              CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
      ** Stamp status                                                                         CSE028
      *                                                                                       CSE028
     C           PWHEN     IFEQ 'S'                                                           CSE028
     C                     MOVE SASTMP    SDSTST                                              CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE SASTMP    MDSTST                                              CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
      ** Standing instructions override                                                       CSE028
      ** (Not done from SESSIR0)                                                              CSE028
      *                                                                                       CSE028
      ** Transaction report marker                                                            CSE028
      *                                                                                       CSE028
     C           PWHEN     IFEQ 'S'                                                           CSE028
     C                     MOVE SATRRM    SDTRRM                                              CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE SATRRM    MDTRRM                                              CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
      ** Charity identifier                                                                   CSE028
      *                                                                                       CSE028
     C           PWHEN     IFEQ 'S'                                                           CSE028
     C                     MOVE SACHID    SDCHID                                              CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE SACHID    MDCHID                                              CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       211823
     C           SD1522    IFEQ *BLANKS                                                       211823
     C           CSE029    ANDEQ'Y'                                                           211823
     C                     MOVE 'Y'       SD1522                                              211823
     C                     ENDIF                                                              211823
      *                                                                                       CSE028
     C                     ENDIF                                                              CSE028
      *                                                                   CSW003
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/INITRA                                                    CSW003
      *****************************************************************   CSW003
      *                                                               *   CSW003
      * INITRA - Routine to initialize Accrued Interest Rate Fields.  *   CSW003
      *                                                               *   CSW003
      *****************************************************************   CSW003
      *                                                                   CSW003
     C           INITRA    BEGSR                                          CSW003
      *                                                                   CSW003
      * Determine event control date                                      CSW003
      * ACCRUALS/PROFIT DATE FROM SDGELRPD                                CSW003
     C                     Z-ADDBKAPDT    ZZAPDT                          CSW003
      * NEXT WORKING DAY FROM SDBANKPD                                    CSW003
     C                     Z-ADDBJDNWD    ZZDNWD                          CSW003
      *                                                                   CSW003
     C                     EXSR ZEVCD                                     CSW003
      *                                                                   CSW003
      * Determine next coupon date                                        CSW003
     C                     EXSR ZNCD                                      CSW003
      *                                                                   CSW003
     C                     Z-ADDCPNR      ZCPNR                           CSW003
     C                     MOVE PPDI      ZPPDI                           CSW003
     C                     Z-ADDCPDP      ZPPCP                           CSW003
     C                     Z-ADDSFPP      ZSFPP                           CSW003
     C                     MOVE PROT      ZPROT                           CSW003
     C                     Z-ADDCFCT      ZCFCT                           CSW003
     C                     EXSR ZRATE                                     CSW003
      *                                                                   CSW003
      *  No need to calculate ac. int. for processing type 2,4,7          CSW003
     C           PROT      IFNE '2'                                       CSW003
     C           PROT      ANDNE'4'                                       CSW003
     C           PROT      ANDNE'7'                                       CSW003
     C                     Z-ADDLCPN      ZSDATE                          CSW003
     C                     MOVELPDPMD     ZDATE                           CSW003
     C                     EXSR ZDATE1                                    CSW003
     C                     Z-ADDZDAYNO    ZEDATE                          CSW003
     C                     Z-ADDPDPNA     ZAMT                            CSW003
     C                     Z-ADDWWCDP     ZCDP                            CSW003
     C/COPY WNCPYSRC,SE1807C014
     C                     EXSR ZACCR                                     CSW003
     C/COPY WNCPYSRC,SE1807C015
     C                     Z-ADDWDDAYS    WDAYSI  30                      CSW003
     C                     ELSE                                           CSW003
     C                     Z-ADD0         ZACCRD                          CSW003
     C                     END                                            CSW003
      *                                                                   CSW003
      * Move to screen fields                                             CSW003
     C                     MOVE ZACCRD    SDITRA                          CSW003
     C                     MOVE *BLANKS   ZFLD15                          CSW003
     C                     MOVE SDITRA    ZFLD15                          CSW003
     C                     Z-ADDWWCDP     ZDECS                           CSW003
     C                     MOVE 'L'       ZECODE                          CSW003
     C                     EXSR ZSEDIT                                    CSW003
     C                     MOVE ZOUT21    SDITRA                          CSW003
      *                                                                   CSW003
      * Default accrued interest out                                      CSW003
      *                                                                   CSW003
     C           PROT      IFNE '2'                                       CSW003
     C           PROT      ANDNE'4'                                       CSW003
     C           PROT      ANDNE'7'                                       CSW003
     C                     Z-ADDCPNR      ZCPNR                           CSW003
     C                     MOVE PPDI      ZPPDI                           CSW003
     C                     Z-ADDCPDP      ZPPCP                           CSW003
     C                     Z-ADDSFPP      ZSFPP                           CSW003
     C                     MOVE PROT      ZPROT                           CSW003
     C                     Z-ADDCFCT      ZCFCT                           CSW003
     C                     EXSR ZRATE                                     CSW003
      *                                                                   CSW003
     C                     Z-ADDLCPN      ZSDATE                          CSW003
     C                     MOVELPDPDO     ZDATE                           CSW003
     C                     EXSR ZDATE1                                    CSW003
     C                     Z-ADDZDAYNO    ZEDATE                          CSW003
     C                     Z-ADDPDPNA     ZAMT                            CSW003
     C/COPY WNCPYSRC,SE1807C016
     C                     EXSR ZACCR                                     CSW003
     C/COPY WNCPYSRC,SE1807C017
     C                     Z-ADDWDDAYS    WDAYSO  30                      CSW003
     C                     ELSE                                           CSW003
     C                     Z-ADD0         ZACCRD                          CSW003
     C                     END                                            CSW003
      *                                                                   CSW003
     C                     MOVE ZACCRD    MDITRA                          CSW003
     C                     MOVE *BLANKS   ZFLD15                          CSW003
     C                     MOVE MDITRA    ZFLD15                          CSW003
     C                     Z-ADDWWCDP     ZDECS                           CSW003
     C                     MOVE 'L'       ZECODE                          CSW003
     C                     EXSR ZSEDIT                                    CSW003
     C                     MOVE ZOUT21    MDITRA                          CSW003
     C/COPY WNCPYSRC,SE1807C012
      *                                                                   CSW003
      * Swap default values when Out Depot at Start Date and In Depot     CSW003
      * Maturity Date                                                     CSW003
     C           PDPMV     IFEQ 'BL'                                      CSW003
     C           PDPMV     OREQ 'PD'                                      CSW003
     C           PDPMV     OREQ 'RP'                                      CSW003
     C                     MOVE *BLANKS   WWACIO 15                       CSW003
     C                     MOVE SDITRA    WWACIO                          CSW003
     C                     MOVE MDITRA    SDITRA                          CSW003
     C                     MOVE WWACIO    MDITRA                          CSW003
     C                     Z-ADDWDAYSI    WWDAYS  30                      CSW003
     C                     Z-ADDWDAYSO    WDAYSI                          CSW003
     C                     Z-ADDWWDAYS    WDAYSO                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDSR                                          CSW003
      *                                                                   CSW003
      *****************************************************************   CSW003
      /TITLE SR/INTDER                                                    CSW003
      *****************************************************************   CSW003
      *                                                               *   CSW003
      * INTDER - Routine to initialize Exchange Rate Fields.          *   CSW003
      *                                                               *   CSW003
      *****************************************************************   CSW003
      *                                                                   CSW003
     C           INTDER    BEGSR                                          CSW003
      *                                                                   CSW003
      * Default Start Date Exchange Rate.                                 CSW003
     C                     Z-ADD1         WTDERS 138                      CSW003
     C                     MOVE *BLANKS   ZFLD15                          CSW003
     C                     MOVE WTDERS    ZFLD15                          CSW003
     C                     Z-ADD8         ZDECS                           CSW003
     C                     MOVE 'L'       ZECODE                          CSW003
     C                     EXSR ZSEDIT                                    CSW003
     C                     MOVE ZOUT21    SDTDER                          CSW003
     C/COPY WNCPYSRC,SE1807C013
      *                                                                   CSW003
     C                     ENDSR                                          CSW003
      *                                                                   CSW003
      ********************************************************************CSW003
      /TITLE SR/SRPRIC                                                    CSW003
      ********************************************************************CSW003
      *                                                                   CSW003
      * SRPRIC - VALIDATE PRICE                                           CSW003
      *                                                                   CSW003
      ********************************************************************CSW003
      *                                                                   CSW003
     C           SRPRIC    BEGSR                                          CSW003
      *                                                                   CSW003
     C           PWHEN     IFEQ 'S'                                       CSW003
     C                     MOVE SDPRIC    SPRIC  16                       CSW003
     C                     ELSE                                           CSW003
     C           PWHEN     IFEQ 'M'                                       CSW003
     C                     MOVE MDPRIC    SPRIC                           CSW003
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C           SPRIC     IFEQ *BLANKS                                   CSW003
     C           SFIND     ANDEQ'A'                                       CSW003
     C                     MOVE '1'       *IN36                           CSW003
     C                     MOVE '1'       *IN75                           CSW003
     C                     MOVEL'SEW5172' ZAMSID                          CSW003
     C                     EXSR SRSMSG                                    CSW003
     C                     ELSE                                           CSW003
      *                                                                   CSW003
     C                     MOVE *BLANKS   ZFIELD                          CSW003
     C                     Z-ADD8         ZADEC                           CSW003
     C                     Z-ADD7         ZADIG                           CSW003
     C                     MOVE SPRIC     ZFIELD                          CSW003
     C                     EXSR ZALIGN                                    CSW003
     C           *IN99     IFEQ '1'                                       CSW003
     C                     MOVE '1'       *IN36                           CSW003
     C                     MOVE '1'       *IN75                           CSW003
     C                     MOVEL'SEW5172' ZAMSID                          CSW003
     C                     EXSR SRSMSG                                    CSW003
     C                     ELSE                                           CSW003
     C                     MOVE *BLANKS   ZFLD15                          CSW003
     C                     MOVE ZFIELD    ZFLD15                          CSW003
     C/COPY WNCPYSRC,SE1807C006
     C                     Z-ADD8         ZDECS                           CSW003
     C                     MOVE 'L'       ZECODE                          CSW003
     C                     EXSR ZSEDIT                                    CSW003
     C                     MOVELZOUT21    PRTMP  20                       CSW003
     C                     MOVE *BLANKS   SPRIC                           CSW003
     C                     MOVE PRTMP     SPRIC                           CSW003
      *                                                                   CSW003
     C           PWHEN     IFEQ 'S'                                       CSW003
     C                     MOVE SPRIC     SDPRIC                          CSW003
     C                     ELSE                                           CSW003
     C           PWHEN     IFEQ 'M'                                       CSW003
     C                     MOVE SPRIC     MDPRIC                          CSW003
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDSR                                          CSW003
      *                                                                   CSW003
      ********************************************************************CSW003
      /TITLE SR/SRTDER                                                    CSW003
      ********************************************************************CSW003
      *                                                                   CSW003
      * SRTDER - VALIDATE EXCHANGE RATE.                                  CSW003
      *                                                                   CSW003
      ********************************************************************CSW003
      *                                                                   CSW003
     C           SRTDER    BEGSR                                          CSW003
      *                                                                   CSW003
     C           PWHEN     IFEQ 'S'                                       CSW003
     C                     MOVE SDTDER    STDER  15                       CSW003
     C                     ELSE                                           CSW003
     C           PWHEN     IFEQ 'M'                                       CSW003
     C                     MOVE MDTDER    STDER                           CSW003
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C           STDER     IFEQ *BLANKS                                   CSW003
     C           SFIND     ANDEQ'A'                                       CSW003
     C                     MOVE '1'       *IN37                           CSW003
     C                     MOVE '1'       *IN75                           CSW003
     C                     MOVEL'SEW5173' ZAMSID                          CSW003
     C                     EXSR SRSMSG                                    CSW003
     C                     ELSE                                           CSW003
      *                                                                   CSW003
     C                     MOVE *BLANKS   ZFLD17                          CSW003
     C                     Z-ADD8         ZSDEC                           CSW003
     C                     Z-ADD5         ZSDIG                           CSW003
     C                     MOVE STDER     ZFLD17                          CSW003
     C                     EXSR ZASIGN                                    CSW003
     C           *IN99     IFEQ '1'                                       CSW003
     C                     MOVE '1'       *IN37                           CSW003
     C                     MOVE '1'       *IN75                           CSW003
     C                     MOVEL'SEW5173' ZAMSID                          CSW003
     C                     EXSR SRSMSG                                    CSW003
     C                     ELSE                                           CSW003
     C                     MOVE ZOUT15    WTDERS                          CSW003
     C           ZFSIGN    IFNE '+'                                       CSW003
     C                     Z-SUBWTDERS    WTDERS                          CSW003
     C                     END                                            CSW003
      *                                                                   CSW003
     C                     MOVE *BLANKS   ZFLD15                          CSW003
     C                     MOVE WTDERS    ZFLD15                          CSW003
     C/COPY WNCPYSRC,SE1807C007
     C                     Z-ADD8         ZDECS                           CSW003
     C                     MOVE 'L'       ZECODE                          CSW003
     C                     EXSR ZSEDIT                                    CSW003
      *                                                                   CSW003
     C           PWHEN     IFEQ 'S'                                       CSW003
     C                     MOVE ZOUT21    SDTDER                          CSW003
     C                     ELSE                                           CSW003
     C           PWHEN     IFEQ 'M'                                       CSW003
     C                     MOVE ZOUT21    MDTDER                          CSW003
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDSR                                          CSW003
      *                                                                   CSW003
      ********************************************************************CSW003
      /TITLE SR/SRITRA                                                    CSW003
      ********************************************************************CSW003
      *                                                                   CSW003
      * SRITRA - VALIDATE ACCRUED INTEREST.                               CSW003
      *                                                                   CSW003
      ********************************************************************CSW003
      *                                                                   CSW003
     C           SRITRA    BEGSR                                          CSW003
      *                                                                   CSW003
     C           PWHEN     IFEQ 'S'                                       CSW003
     C                     MOVE SDITRA    SITRA  15                       CSW003
     C                     ELSE                                           CSW003
     C           PWHEN     IFEQ 'M'                                       CSW003
     C                     MOVE MDITRA    SITRA                           CSW003
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C           SITRA     IFEQ *BLANKS                                   CSW003
     C           SFIND     ANDEQ'A'                                       CSW003
     C                     MOVE '1'       *IN38                           CSW003
     C                     MOVE '1'       *IN75                           CSW003
     C                     MOVEL'SEW5174' ZAMSID                          CSW003
     C                     EXSR SRSMSG                                    CSW003
     C                     ELSE                                           CSW003
      *                                                                   CSW003
     C                     MOVE *BLANKS   ZFLD17                          CSW003
     C                     Z-ADDWWCDP     ZSDEC                           CSW003
     C           13        SUB  WWCDP     ZSDIG                           CSW003
     C                     MOVE SITRA     ZFLD17                          CSW003
     C                     EXSR ZASIGN                                    CSW003
     C           *IN99     IFEQ '1'                                       CSW003
     C                     MOVE '1'       *IN38                           CSW003
     C                     MOVE '1'       *IN75                           CSW003
     C                     MOVEL'SEW5174' ZAMSID                          CSW003
     C                     EXSR SRSMSG                                    CSW003
     C                     ELSE                                           CSW003
     C                     MOVE ZOUT15    WITRAS 150                      CSW003
     C/COPY WNCPYSRC,SE1807C008
     C           ZFSIGN    IFNE '+'                                       CSW003
     C                     Z-SUBWITRAS    WITRAS                          CSW003
     C                     END                                            CSW003
      *                                                                   CSW003
     C                     MOVE *BLANKS   ZFLD15                          CSW003
     C                     MOVE WITRAS    ZFLD15                          CSW003
     C                     Z-ADDWWCDP     ZDECS                           CSW003
     C                     MOVE 'L'       ZECODE                          CSW003
     C                     EXSR ZSEDIT                                    CSW003
      *                                                                   CSW003
     C           PWHEN     IFEQ 'S'                                       CSW003
     C                     MOVE ZOUT21    SDITRA                          CSW003
     C                     ELSE                                           CSW003
     C           PWHEN     IFEQ 'M'                                       CSW003
     C                     MOVE ZOUT21    MDITRA                          CSW003
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     END                                            CSW003
      *                                                                   CSW003
     C                     END                                            CSW003
      *                                                                   CSW003
     C                     ENDSR                                          CSW003
      *                                                                   CSW003
      ********************************************************************CSW003
      /TITLE SR/FMPRIC                                                    CSW003
      ********************************************************************CSW003
      *                                                                   CSW003
      * FMPRIC - FORMAT PRICE                                             CSW003
      *                                                                   CSW003
      ********************************************************************CSW003
      *                                                                   CSW003
     C           FMPRIC    BEGSR                                          CSW003
      *                                                                   CSW003
     C                     MOVE DPPRIC    ZFIELD                          CSW003
     C                     Z-ADD8         ZADEC                           CSW003
     C                     EXSR ZEDIT                                     CSW003
      *                                                                   CSW003
     C           PWHEN     IFEQ 'S'                                       CSW003
     C                     MOVE ZFIELD    SDPRIC                          CSW003
     C                     ELSE                                           CSW003
     C           PWHEN     IFEQ 'M'                                       CSW003
     C                     MOVE ZFIELD    MDPRIC                          CSW003
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDSR                                          CSW003
      *                                                                   CSW003
      ********************************************************************CSW003
      /TITLE SR/FMTDER                                                    CSW003
      ********************************************************************CSW003
      *                                                                   CSW003
      * FMTDER - FORMAT EXCHANGE RATE.                                    CSW003
      *                                                                   CSW003
      ********************************************************************CSW003
      *                                                                   CSW003
     C           FMTDER    BEGSR                                          CSW003
      *                                                                   CSW003
     C                     MOVE *BLANKS   ZFLD15                          CSW003
     C                     MOVE DPTDER    ZFLD15                          CSW003
     C                     Z-ADD8         ZDECS                           CSW003
     C                     MOVE 'L'       ZECODE                          CSW003
     C                     EXSR ZSEDIT                                    CSW003
      *                                                                   CSW003
     C           PWHEN     IFEQ 'S'                                       CSW003
     C                     MOVE ZOUT21    SDTDER                          CSW003
     C                     ELSE                                           CSW003
     C           PWHEN     IFEQ 'M'                                       CSW003
     C                     MOVE ZOUT21    MDTDER                          CSW003
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDSR                                          CSW003
      ********************************************************************CSW003
      /TITLE SR/FMITRA                                                    CSW003
      ********************************************************************CSW003
      *                                                                   CSW003
      * FMITRA - FORMAT ACCRUED INTEREST.                                 CSW003
      *                                                                   CSW003
      ********************************************************************CSW003
      *                                                                   CSW003
     C           FMITRA    BEGSR                                          CSW003
      *                                                                   CSW003
     C                     MOVE *BLANKS   ZFLD15                          CSW003
     C                     MOVE DPITRA    ZFLD15                          CSW003
     C                     Z-ADDWWCDP     ZDECS                           CSW003
     C                     MOVE 'L'       ZECODE                          CSW003
     C                     EXSR ZSEDIT                                    CSW003
      *                                                                   CSW003
     C           PWHEN     IFEQ 'S'                                       CSW003
     C                     MOVE ZOUT21    SDITRA                          CSW003
     C                     ELSE                                           CSW003
     C           PWHEN     IFEQ 'M'                                       CSW003
     C                     MOVE ZOUT21    MDITRA                          CSW003
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDSR                                          CSW003
      ********************************************************************CSW003
      /TITLE SR/SRFTOS
      *****************************************************************
      *                                                               *
      * SRFTOS - Routine to move file fields to screen fields         *
      *          (Moves file fields to work fields really!)           *   CSW003
      *                                                               *
      *****************************************************************
      *
     C           SRFTOS    BEGSR
      *
     C                     MOVE DPGMES    SGMES
     C                     MOVELSGMES     SVGMES
     C                     MOVE DPINST    SINST
     C                     MOVE DPINSS    SINSS
     C                     MOVE DPEUCL    SEUCL
     C                     MOVE DPSAFA    SSAFA
     C                     MOVE DPRPTY    SRPTY
     C                     MOVE DPFIND    SFIND
     C                     MOVE DPGMEC    SGMEC
     C                     MOVELSGMEC     SVGMEC
     C                     MOVE DPTRTT    STRTT
     C                     MOVE DPGDEL    SGDEL
     C                     MOVE DPFCOD    SFCOD
     C                     MOVE DPSROL    SSROL
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C                     MOVE DPSIOR    SSIOR                           CSW098
     C                     ENDIF                                                              CSW201
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
     C                     MOVE DPNEW     S1522   1                                           CSE028
     C                     MOVE DPSTMP    SSTMP   4                                           CSE028
     C                     MOVE DPCHID    SCHID  30                                           CSE028
     C                     MOVE DPTRRM    STRRM   4                                           CSE028
     C                     ENDIF                                                              CSE028
      *
      * Determine Network routing and addresses/settlements
     C           PDPMV     IFEQ 'RR'
     C           PDPMV     OREQ 'RP'                                      094415
     C           PDPMV     OREQ 'BB'
     C           PDPMV     OREQ 'BL'                                      094415
     C           PDPMV     OREQ 'PL'
     C           PDPMV     OREQ 'PD'                                      094415
     C           PDPMV     OREQ 'WI'
     C           PDPMV     OREQ 'DT'                                      094415
     C           DPWHEN    ANDEQ'M'                                       094415
     C                     MOVE PDPID     WSNDR
     C                     MOVE PDPID     WDEST
     C                     END
      *
     C***********PDPMV     IFEQ 'RP'                                      094415
     C***********PDPMV     OREQ 'BL'                                      094415
     C***********PDPMV     OREQ 'PD'                                      094415
     C***********PDPMV     OREQ 'WO'                                      094415
     C***********PDPMV     OREQ 'DT'                                      094415
     C           PDPMV     IFEQ 'WO'                                      094415
     C           PDPMV     OREQ 'DT'                                      094415
     C           DPWHEN    ANDEQ*BLANK                                    094415
     C           PDPMV     OREQ 'DT'                                      094415
     C           DPWHEN    ANDEQ'S'                                       094415
     C                     MOVE PDPOD     WSNDR
     C                     MOVE PDPOD     WDEST
     C                     END
      *
     C                     CLEARWSCSD
     C                     CLEARWSETP
      *
     C                     EXSR SR1100
     C                     MOVE WWROU     SROUS
     C                     MOVE WWROT     SROTS
      *
      * Retrieve Cedel/Euroclear destination
     C                     MOVE *BLANKS   WWSENT
     C                     MOVE WDEST     WWDEST
     C           WWDEST    IFEQ PDC01
     C                     MOVE 'EOC  '   WWSENT
     C                     ELSE
     C           WWDEST    IFEQ PDC02
     C                     MOVE 'CEDEL'   WWSENT
     C                     END
     C                     END
      *
      * Check if destination is not EOC or Cedel anyway
     C                     MOVE WDEST     WWCUST  6
     C                     CALL 'AOSECSR0'
     C                     PARM '*DBERR ' WRTCD   7
     C                     PARM '*KEY   ' WOPTN   7
     C                     PARM           WWCUST
     C           SDSECS    PARM SDSECS    DSSDY
      *
     C           BFCLAS    IFEQ 'E'
     C                     MOVE 'EOC  '   WWSENT
     C                     END
     C           BFCLAS    IFEQ 'C'
     C                     MOVE 'CEDEL'   WWSENT
     C                     END
      *
      * Init Network routing and addresses for confirmations
     C                     MOVE PDPBN     WSNDR
     C                     MOVE PDPBN     WDEST
     C                     CLEARWSCSD
     C                     CLEARWSETP
      *
     C                     EXSR SR1100
     C                     MOVE WWROU     SROUC
     C                     MOVE WWROT     SROTC
      *
      ** Initialize Clearance type (1 to 4 is MT580 for Settlements)
      ** <===> Depot In or Out is Euroclear or Cedel
     C           WWDEST    IFEQ PDC01
     C           WWDEST    OREQ PDC02
     C           WWSENT    OREQ 'EOC  '
     C           WWSENT    OREQ 'CEDEL'
     C                     MOVE '14'      WWCLTY  2
     C                     ELSE                                           CSW003
     C                     MOVE *BLANKS   WWCLTY                          CSW003
     C                     END
      *
     C           PACTN     IFEQ 'A'                                       CSW003
     C           DPWHEN    ANDNE'M'                                       CSW003
     C           PDPMV     IFEQ 'BB'                                      CSW003
     C           PDPMV     OREQ 'BL'                                      CSW003
     C           PDPMV     OREQ 'RP'                                      CSW003
     C           PDPMV     OREQ 'RR'                                      CSW003
     C           PDPMV     OREQ 'PD'                                      CSW003
     C           PDPMV     OREQ 'PL'                                      CSW003
     C           PORED     IFLT BJRDNB                                    CSW003
     C           CSE028    ANDEQ'N'                                                           204352
     C                     MOVE 'N'       SGMES                           CSW003
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/SRSTOF
      *****************************************************************
      *                                                               *
      * SRSTOF - Routine to move screen fields to file fields         *
      *                                                               *
      *****************************************************************
      *
     C           SRSTOF    BEGSR
      *
     C***********          TIME           DPTIME                          098856
     C                     MOVE SGMES     DPGMES
     C                     MOVE SINST     DPINST
     C                     MOVE SINSS     DPINSS
     C                     MOVE SEUCL     DPEUCL
     C                     MOVE SSAFA     DPSAFA
     C                     MOVE SRPTY     DPRPTY
     C                     MOVE SFIND     DPFIND
     C                     MOVE SGMEC     DPGMEC
     C                     MOVE STRTT     DPTRTT
     C                     MOVE SGDEL     DPGDEL
     C                     MOVE SFCOD     DPFCOD
     C                     MOVE SSROL     DPSROL
     C                     MOVE 'Y'       DPSCMG                          CSW003
      *                                                                   CSW098
     C           CSW201    IFEQ 'N'                                                           CSW201
     C           SWRTN     IFEQ 'CSW098 '                                 CSW098
     C                     MOVE SSIOR     DPSIOR                          CSW098
     C                     ENDIF                                          CSW098
     C                     ENDIF                                                              CSW201
      *                                                                   CSW003
     C***********CSW003    IFEQ 'Y'                                       CSW003              CAP087
     C                     MOVE 'S'       DPWHEN                          CSW003
     C***********          ENDIF                                          CSW003              CAP087
      *
      ** If Securities Processing Type is not 2,4 or 7 (*IN39 is on) so   CSW003
      ** load Accrued Interest Field.                                     CSW003
     C           *IN39     IFEQ *ON                                       CSW003
     C                     MOVE SITRA     DPITRA                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
      ** If not Depot Transfer load and display Price and Exchange Rate   CSW003
      ** Fields (*IN40 is on).                                            CSW003
     C           *IN40     IFEQ *ON                                       CSW003
     C           @CFRM     ANDNE'CSE006'                                  CSE006
     C                     MOVE SPRIC     DPPRIC                          CSW003
     C                     MOVE STDER     DPTDER                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C           *IN40     IFEQ *ON                                       CSE006
     C           @CFRM     ANDEQ'CSE006'                                  CSE006
     C                     MOVE PMKTP     DPPRIC                          CSE006
     C                     MOVE PDEXRT    DPTDER                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
     C                     MOVE S1522     DPNEW                                               CSE028
     C                     MOVE SSTMP     DPSTMP                                              CSE028
     C                     MOVE SCHID     DPCHID                                              CSE028
     C                     MOVE STRRM     DPTRRM                                              CSE028
     C                     ENDIF                                                              CSE028
      *                                                                   CSE006
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/SD2WF                                                     CSW003
      *****************************************************************   CSW003
      *                                                               *   CSW003
      * SD2WF - MOVE START DATE SCREEN FIELDS TO WORK FIELDS.         *   CSW003
      *                                                               *   CSW003
      *****************************************************************   CSW003
      *                                                                   CSW003
     C           SD2WF     BEGSR                                          CSW003
      *                                                                   CSW003
     C                     MOVE SDROUS    SROUS   6                       CSW003
     C                     MOVE SDROTS    SROTS  12                       CSW003
     C                     MOVE SDGMES    SGMES   1                       CSW003
     C                     MOVE SDINST    SINST   3                       CSW003
     C                     MOVE SDINSS    SINSS   5                       CSW003
     C                     MOVE SDEUCL    SEUCL  10                       CSW003
     C                     MOVE SDSAFA    SSAFA   6                       CSW003
     C                     MOVE SDRPTY    SRPTY   1                       CSW003
     C                     MOVE SDFIND    SFIND   1                       CSW003
     C                     MOVE SDROUC    SROUC   6                       CSW003
     C                     MOVE SDROTC    SROTC  12                       CSW003
     C                     MOVE SDGMEC    SGMEC   1                       CSW003
     C                     MOVE SDTRTT    STRTT   4                       CSW003
     C                     MOVE SDGDEL    SGDEL   1                       CSW003
     C                     MOVE SDFCOD    SFCOD   1                       CSW003
     C                     MOVE SDSROL    SSROL   4                       CSW003
      *                                                                   CSW098
     C           CSW201    IFEQ 'N'                                                           CSW201
     C           SWRTN     IFEQ 'CSW098'                                  CSW098
     C                     MOVE SDSIOR    SSIOR                           CSW098
     C                     ENDIF                                          CSW098
     C                     ENDIF                                                              CSW201
      *                                                                   CSW003
     C           CSW003    IFEQ 'Y'                                       CSW003
     C                     MOVE 'S'       PWHEN                           CSW003
     C                     ENDIF                                          CSW003
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
     C                     MOVE SD1522    PSNEW                                               199797
     C                     MOVE SD1522    S1522                                               CSE028
     C                     MOVE SDSTST    SSTMP                                               CSE028
     C                     MOVE SDCHID    SCHID                                               CSE028
     C                     MOVE SDTRRM    STRRM                                               CSE028
     C                     ENDIF                                                              CSE028
      *                                                                   CSW003
     C                     ENDSR                                          CSW003
      *                                                                   CSW003
      *****************************************************************   CSW003
      /TITLE SR/MD2WF                                                     CSW003
      *****************************************************************   CSW003
      *                                                               *   CSW003
      * MD2WF - MOVE MATURITY DATE SCREEN FIELDS TO WORK FIELDS.      *   CSW003
      *                                                               *   CSW003
      *****************************************************************   CSW003
      *                                                                   CSW003
     C           MD2WF     BEGSR                                          CSW003
      *                                                                   CSW003
     C                     MOVE MDROUS    SROUS                           CSW003
     C                     MOVE MDROTS    SROTS                           CSW003
     C                     MOVE MDGMES    SGMES                           CSW003
     C                     MOVE MDINST    SINST                           CSW003
     C                     MOVE MDINSS    SINSS                           CSW003
     C                     MOVE MDEUCL    SEUCL                           CSW003
     C                     MOVE MDSAFA    SSAFA                           CSW003
     C                     MOVE MDRPTY    SRPTY                           CSW003
     C                     MOVE MDFIND    SFIND                           CSW003
     C                     MOVE MDROUC    SROUC                           CSW003
     C                     MOVE MDROTC    SROTC                           CSW003
     C                     MOVE MDGMEC    SGMEC                           CSW003
     C                     MOVE MDTRTT    STRTT                           CSW003
     C                     MOVE MDGDEL    SGDEL                           CSW003
     C                     MOVE MDFCOD    SFCOD                           CSW003
     C                     MOVE MDSROL    SSROL                           CSW003
      *                                                                   CSW098
     C           CSW201    IFEQ 'N'                                                           CSW201
     C           SWRTN     IFEQ 'CSW098 '                                 CSW098
     C                     MOVE MDSIOR    SSIOR                           CSW098
     C                     ENDIF                                          CSW098
     C                     ENDIF                                                              CSW201
      *                                                                   CSW003
     C                     MOVE 'M'       PWHEN                           CSW003
      *                                                                                       CSW202
     C           CSW202    IFEQ 'Y'                                                           CSW202
     C           CSE029    IFEQ 'Y'                                                           CSW202
     C                     MOVE 'Y'       MD1522                                              CSW202
     C                     ELSE                                                               CSW202
     C                     MOVE 'N'       MD1522                                              CSW202
     C                     ENDIF                                                              CSW202
     C                     ENDIF                                                              CSW202
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
     C                     MOVE SD1522    PSNEW                                               199797
     C                     MOVE MD1522    S1522                                               CSE028
     C                     MOVE MDSTST    SSTMP                                               CSE028
     C                     MOVE MDCHID    SCHID                                               CSE028
     C                     MOVE MDTRRM    STRRM                                               CSE028
     C                     ENDIF                                                              CSE028
      *                                                                   CSW003
     C                     ENDSR                                          CSW003
      *                                                                   CSW003
      *****************************************************************   CSW003
      /TITLE SR/WF2SD                                                     CSW003
      *****************************************************************   CSW003
      *                                                               *   CSW003
      * WF2SD - MOVE WORK FIELDS TO START DATE SCREEN FIELDS.         *   CSW003
      * Only need to move fields if they haven't been defaulted       *   CSE028
      * in from SESSIR0.                                              *   CSE028
      *                                                               *   CSW003
      *****************************************************************   CSW003
      *                                                                   CSW003
     C           WF2SD     BEGSR                                          CSW003
      *                                                                   CSW003
     C           CSE028    IFEQ 'Y'                                       CSE028
     C           PACTN     ANDEQ'I'                                       CSE028
     C           CSE028    OREQ 'Y'                                                           CSE028
     C           PACTN     ANDEQ'D'                                                           CSE028
      *                                                                   CSE028
     C           SDROUS    IFEQ *BLANKS                                   CSE028
     C                     MOVE SROUS     SDROUS                          CSE028
     C                     ENDIF                                          CSE028
     C           SDROTS    IFEQ *BLANKS                                   CSE028
     C                     MOVE SROTS     SDROTS                          CSE028
     C                     ENDIF                                          CSE028
     C           SDGMES    IFEQ *BLANKS                                   CSE028
     C                     MOVE SGMES     SDGMES                          CSE028
     C                     ENDIF                                          CSE028
     C           SDINST    IFEQ *BLANKS                                   CSE028
     C                     MOVE SINST     SDINST                          CSE028
     C                     ENDIF                                          CSE028
     C           SDINSS    IFEQ *BLANKS                                   CSE028
     C                     MOVE SINSS     SDINSS                          CSE028
     C                     ENDIF                                          CSE028
     C           SDEUCL    IFEQ *BLANKS                                   CSE028
     C                     MOVE SEUCL     SDEUCL                          CSE028
     C                     ENDIF                                          CSE028
     C           SDSAFA    IFEQ *BLANKS                                   CSE028
     C                     MOVE SSAFA     SDSAFA                          CSE028
     C                     ENDIF                                          CSE028
     C           SDRPTY    IFEQ *BLANKS                                   CSE028
     C                     MOVE SRPTY     SDRPTY                          CSE028
     C                     ENDIF                                          CSE028
     C           SDFIND    IFEQ *BLANKS                                   CSE028
     C                     MOVE SFIND     SDFIND                          CSE028
     C                     ENDIF                                          CSE028
     C           SDROUC    IFEQ *BLANKS                                   CSE028
     C                     MOVE SROUC     SDROUC                          CSE028
     C                     ENDIF                                          CSE028
     C           SDROTC    IFEQ *BLANKS                                   CSE028
     C                     MOVE SROTC     SDROTC                          CSE028
     C                     ENDIF                                          CSE028
     C           SDGMEC    IFEQ *BLANKS                                   CSE028
     C                     MOVE SGMEC     SDGMEC                          CSE028
     C                     ENDIF                                          CSE028
     C           SDTRTT    IFEQ *BLANKS                                   CSE028
     C                     MOVE STRTT     SDTRTT                          CSE028
     C                     ENDIF                                          CSE028
     C           SDGDEL    IFEQ *BLANKS                                   CSE028
     C                     MOVE SGDEL     SDGDEL                          CSE028
     C                     ENDIF                                          CSE028
     C           SDFCOD    IFEQ *BLANKS                                   CSE028
     C                     MOVE SFCOD     SDFCOD                          CSE028
     C                     ENDIF                                          CSE028
     C           SDSROL    IFEQ *BLANKS                                   CSE028
     C                     MOVE SSROL     SDSROL                          CSE028
     C                     ENDIF                                          CSE028
      *                                                                   CSE028
     C           SWRTN     IFEQ 'CSW098 '                                 CSE028
     C           SDSIOR    ANDEQ*BLANKS                                   CSE028
     C                     MOVE SSIOR     SDSIOR                          CSE028
     C                     ENDIF                                          CSE028
      *                                                                   CSE028
     C                     ELSE                                           CSE028
      *                                                                   CSE028
     C                     MOVE SROUS     SDROUS                          CSW003
     C                     MOVE SROTS     SDROTS                          CSW003
     C                     MOVE SGMES     SDGMES                          CSW003
     C                     MOVE SINST     SDINST                          CSW003
     C                     MOVE SINSS     SDINSS                          CSW003
     C                     MOVE SEUCL     SDEUCL                          CSW003
     C                     MOVE SSAFA     SDSAFA                          CSW003
     C                     MOVE SRPTY     SDRPTY                          CSW003
     C                     MOVE SFIND     SDFIND                          CSW003
     C                     MOVE SROUC     SDROUC                          CSW003
     C                     MOVE SROTC     SDROTC                          CSW003
     C                     MOVE SGMEC     SDGMEC                          CSW003
      * In case of BB/BL, as action code is 'A' (even for Insert) then    204954
      * Time of Trade is never initialized.                               204954
     C           STRTT     IFEQ *BLANKS                                   204954
     C                     TIME           WWTIME                          204954
     C                     MOVELWWTIME    STRTT                           204954
     C                     END                                            204954
      *                                                                   204954
     C                     MOVE STRTT     SDTRTT                          CSW003
     C                     MOVE SGDEL     SDGDEL                          CSW003
     C                     MOVE SFCOD     SDFCOD                          CSW003
     C                     MOVE SSROL     SDSROL                          CSW003
      *                                                                   CSW098
     C           CSW201    IFEQ 'N'                                                           CSW201
     C           SWRTN     IFEQ 'CSW098 '                                 CSW098
     C                     MOVE SSIOR     SDSIOR                          CSW098
     C                     ENDIF                                          CSW098
     C                     ENDIF                                                              CSW201
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
     C                     MOVE S1522     SD1522                                              CSE028
     C                     MOVE SSTMP     SDSTST                                              CSE028
     C                     MOVE SCHID     SDCHID                                              CSE028
     C                     MOVE STRRM     SDTRRM                                              CSE028
     C                     ENDIF                                                              CSE028
      *                                                                   CSE028
     C                     ENDIF                                          CSE028
      *                                                                   CSW003
     C                     ENDSR                                          CSW003
      *                                                                   CSW003
      *****************************************************************   CSW003
      /TITLE SR/WF2MD                                                     CSW003
      *****************************************************************   CSW003
      *                                                               *   CSW003
      * WF2MD - MOVE WORK FIELDS TO MATURITY DATE SCREEN FIELDS.      *   CSW003
      * Only need to move fields if they haven't been defaulted       *   CSE028
      * in from SESSIR0.                                              *   CSE028
      *                                                               *   CSW003
      *****************************************************************   CSW003
      *                                                                   CSW003
     C           WF2MD     BEGSR                                          CSW003
      *                                                                   CSW003
     C           CSE028    IFEQ 'Y'                                       CSE028
     C           PACTN     ANDEQ'I'                                       CSE028
     C           CSE028    OREQ 'Y'                                                           CSE028
     C           PACTN     ANDEQ'D'                                                           CSE028
      *                                                                   CSE028
     C           MDROUS    IFEQ *BLANKS                                   CSE028
     C                     MOVE SROUS     MDROUS                          CSE028
     C                     ENDIF                                          CSE028
     C           MDROTS    IFEQ *BLANKS                                   CSE028
     C                     MOVE SROTS     MDROTS                          CSE028
     C                     ENDIF                                          CSE028
     C           MDGMES    IFEQ *BLANKS                                   CSE028
     C                     MOVE SGMES     MDGMES                          CSE028
     C                     ENDIF                                          CSE028
     C           MDINST    IFEQ *BLANKS                                   CSE028
     C                     MOVE SINST     MDINST                          CSE028
     C                     ENDIF                                          CSE028
     C           MDINSS    IFEQ *BLANKS                                   CSE028
     C                     MOVE SINSS     MDINSS                          CSE028
     C                     ENDIF                                          CSE028
     C           MDEUCL    IFEQ *BLANKS                                   CSE028
     C                     MOVE SEUCL     MDEUCL                          CSE028
     C                     ENDIF                                          CSE028
     C           MDSAFA    IFEQ *BLANKS                                   CSE028
     C                     MOVE SSAFA     MDSAFA                          CSE028
     C                     ENDIF                                          CSE028
     C           MDRPTY    IFEQ *BLANKS                                   CSE028
     C                     MOVE SRPTY     MDRPTY                          CSE028
     C                     ENDIF                                          CSE028
     C           MDFIND    IFEQ *BLANKS                                   CSE028
     C                     MOVE SFIND     MDFIND                          CSE028
     C                     ENDIF                                          CSE028
     C           MDROUC    IFEQ *BLANKS                                   CSE028
     C                     MOVE SROUC     MDROUC                          CSE028
     C                     ENDIF                                          CSE028
     C           MDROTC    IFEQ *BLANKS                                   CSE028
     C                     MOVE SROTC     MDROTC                          CSE028
     C                     ENDIF                                          CSE028
     C           MDGMEC    IFEQ *BLANKS                                   CSE028
     C                     MOVE SGMEC     MDGMEC                          CSE028
     C                     ENDIF                                          CSE028
     C           MDTRTT    IFEQ *BLANKS                                   CSE028
     C                     MOVE STRTT     MDTRTT                          CSE028
     C                     ENDIF                                          CSE028
     C           MDGDEL    IFEQ *BLANKS                                   CSE028
     C                     MOVE SGDEL     MDGDEL                          CSE028
     C                     ENDIF                                          CSE028
     C           MDFCOD    IFEQ *BLANKS                                   CSE028
     C                     MOVE SFCOD     MDFCOD                          CSE028
     C                     ENDIF                                          CSE028
     C           MDSROL    IFEQ *BLANKS                                   CSE028
     C                     MOVE SSROL     MDSROL                          CSE028
     C                     ENDIF                                          CSE028
      *                                                                   CSE028
     C           SWRTN     IFEQ 'CSW098 '                                 CSE028
     C           MDSIOR    ANDEQ*BLANKS                                   CSE028
     C                     MOVE SSIOR     MDSIOR                          CSE028
     C                     ENDIF                                          CSE028
      *                                                                   CSE028
     C                     ELSE                                           CSE028
      *                                                                   CSE028
     C                     MOVE SROUS     MDROUS                          CSW003
     C                     MOVE SROTS     MDROTS                          CSW003
     C                     MOVE SGMES     MDGMES                          CSW003
     C                     MOVE SINST     MDINST                          CSW003
     C                     MOVE SINSS     MDINSS                          CSW003
     C                     MOVE SEUCL     MDEUCL                          CSW003
     C                     MOVE SSAFA     MDSAFA                          CSW003
     C                     MOVE SRPTY     MDRPTY                          CSW003
     C                     MOVE SFIND     MDFIND                          CSW003
     C                     MOVE SROUC     MDROUC                          CSW003
     C                     MOVE SROTC     MDROTC                          CSW003
     C                     MOVE SGMEC     MDGMEC                          CSW003
      * In case of BB/BL, as action code is 'A' (even for Insert) then    204954
      * Time of Trade is never initialized.                               204954
     C           STRTT     IFEQ *BLANKS                                   204954
     C                     TIME           WWTIME                          204954
     C                     MOVELWWTIME    STRTT                           204954
     C                     END                                            204954
      *                                                                   204954
     C                     MOVE STRTT     MDTRTT                          CSW003
     C                     MOVE SGDEL     MDGDEL                          CSW003
     C                     MOVE SFCOD     MDFCOD                          CSW003
     C                     MOVE SSROL     MDSROL                          CSW003
      *                                                                   CSW098
     C           CSW201    IFEQ 'N'                                                           CSW201
     C           SWRTN     IFEQ 'CSW098 '                                 CSW098
     C                     MOVE SSIOR     MDSIOR                          CSW098
     C                     ENDIF                                          CSW098
     C                     ENDIF                                                              CSW201
      *                                                                   CSW003
     C           CSE028    IFEQ 'Y'                                                           CSE028
     C                     MOVE S1522     MD1522                                              CSE028
     C                     MOVE SSTMP     MDSTST                                              CSE028
     C                     MOVE SCHID     MDCHID                                              CSE028
     C                     MOVE STRRM     MDTRRM                                              CSE028
     C                     ENDIF                                                              CSE028
      *                                                                   CSE028
     C                     ENDIF                                          CSE028
      *                                                                   CSE028
     C                     ENDSR                                          CSW003
      *                                                                   CSW003
      *****************************************************************   CSW003
      /TITLE SR/SRSD2F                                                    CSW003
      *****************************************************************   CSW003
      *                                                               *   CSW003
      * SRSD2F - Routine to move Start Date fields to file fields.    *   CSW003
      *                                                               *   CSW003
      *****************************************************************   CSW003
      *                                                                   CSW003
     C           SRSD2F    BEGSR                                          CSW003
      *                                                                   CSW003
     C                     TIME           DPTIME                          CSW003
     C                     MOVE SDGMES    DPGMES                          CSW003
     C                     MOVE SDINST    DPINST                          CSW003
     C                     MOVE SDINSS    DPINSS                          CSW003
     C                     MOVE SDEUCL    DPEUCL                          CSW003
     C                     MOVE SDSAFA    DPSAFA                          CSW003
     C                     MOVE SDRPTY    DPRPTY                          CSW003
     C                     MOVE SDFIND    DPFIND                          CSW003
     C                     MOVE SDGMEC    DPGMEC                          CSW003
     C                     MOVE SDTRTT    DPTRTT                          CSW003
     C                     MOVE SDGDEL    DPGDEL                          CSW003
     C                     MOVE SDFCOD    DPFCOD                          CSW003
     C                     MOVE SDSROL    DPSROL                          CSW003
     C                     MOVE 'Y'       DPSCMG                          CSW003
     C                     MOVE 'S'       DPWHEN                          CSW003
      *                                                                   CSW098
     C           CSW201    IFEQ 'N'                                                           CSW201
     C           SWRTN     IFEQ 'CSW098 '                                 CSW098
     C                     MOVE SDSIOR    DPSIOR                          CSW098
     C                     ENDIF                                          CSW098
     C                     ENDIF                                                              CSW201
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
     C                     MOVE SD1522    DPNEW                                               CSE028
     C                     MOVE SDSTST    DPSTMP                                              CSE028
     C                     MOVE SDCHID    DPCHID                                              CSE028
     C                     MOVE SDTRRM    DPTRRM                                              CSE028
     C                     ENDIF                                                              CSE028
      *                                                                   CSW003
     C                     ENDSR                                          CSW003
      *                                                                   CSW003
      *****************************************************************   CSW003
      /TITLE SR/SRMD2F                                                    CSW003
      *****************************************************************   CSW003
      *                                                               *   CSW003
      * SRMD2F - Routine to move Maturity Date fields to file fields. *   CSW003
      *                                                               *   CSW003
      *****************************************************************   CSW003
      *                                                                   CSW003
     C           SRMD2F    BEGSR                                          CSW003
      *                                                                   CSW003
     C                     TIME           DPTIME                          CSW003
     C                     MOVE MDGMES    DPGMES                          CSW003
     C                     MOVE MDINST    DPINST                          CSW003
     C                     MOVE MDINSS    DPINSS                          CSW003
     C                     MOVE MDEUCL    DPEUCL                          CSW003
     C                     MOVE MDSAFA    DPSAFA                          CSW003
     C                     MOVE MDRPTY    DPRPTY                          CSW003
     C                     MOVE MDFIND    DPFIND                          CSW003
     C                     MOVE MDGMEC    DPGMEC                          CSW003
     C                     MOVE MDTRTT    DPTRTT                          CSW003
     C                     MOVE MDGDEL    DPGDEL                          CSW003
     C                     MOVE MDFCOD    DPFCOD                          CSW003
     C                     MOVE MDSROL    DPSROL                          CSW003
     C                     MOVE 'Y'       DPSCMG                          CSW003
     C                     MOVE 'M'       DPWHEN                          CSW003
      *                                                                   CSW098
     C           CSW201    IFEQ 'N'                                                           CSW201
     C           SWRTN     IFEQ 'CSW098 '                                 CSW098
     C                     MOVE MDSIOR    DPSIOR                          CSW098
     C                     ENDIF                                          CSW098
     C                     ENDIF                                                              CSW201
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
     C                     MOVE MD1522    DPNEW                                               CSE028
     C                     MOVE MDSTST    DPSTMP                                              CSE028
     C                     MOVE MDCHID    DPCHID                                              CSE028
     C                     MOVE MDTRRM    DPTRRM                                              CSE028
     C                     ENDIF                                                              CSE028
      *                                                                   CSW003
     C                     ENDSR                                          CSW003
      *                                                                   CSW003
      *****************************************************************   CSW003
      /TITLE SR/WRPRER                                                    CSW003
      *****************************************************************   CSW003
      *                                                               *   CSW003
      * WRPRER - Routine to write Price and Exchange Rate to File.    *   CSW003
      *                                                               *   CSW003
      *****************************************************************   CSW003
      *                                                                   CSW003
     C           WRPRER    BEGSR                                          CSW003
      *                                                                   CSE006
     C           @CFRM     IFEQ 'CSE006'                                  CSE006
     C                     MOVELPDEXRT    DPTDER                          CSE006
     C                     MOVELPMKTP     DPPRIC                          CSE006
     C                     ELSE                                           CSE006
      *                                                                   CSW003
      ** Write Price to File.                                             CSW003
     C           PWHEN     IFEQ 'S'                                       CSW003
     C                     MOVE SDPRIC    ZFIELD                          CSW003
     C                     ELSE                                           CSW003
     C                     MOVE MDPRIC    ZFIELD                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     Z-ADD8         ZADEC                           CSW003
     C                     Z-ADD7         ZADIG                           CSW003
     C                     EXSR ZALIGN                                    CSW003
     C                     MOVE ZFIELD    DPPRIC                          CSW003
      *                                                                   CSW003
      ** Write Exchange Rate to File.                                     CSW003
     C           PWHEN     IFEQ 'S'                                       CSW003
     C                     MOVE SDTDER    ZFLD17                          CSW003
     C                     ELSE                                           CSW003
     C                     MOVE MDTDER    ZFLD17                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     Z-ADD8         ZSDEC                           CSW003
     C                     Z-ADD5         ZSDIG                           CSW003
     C                     EXSR ZASIGN                                    CSW003
     C                     MOVE ZOUT15    WTDERS                          CSW003
     C           ZFSIGN    IFNE '+'                                       CSW003
     C                     Z-SUBWTDERS    WTDERS                          CSW003
     C                     ENDIF                                          CSW003
     C                     MOVE WTDERS    DPTDER                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     ENDSR                                          CSW003
      *                                                                   CSW003
      *****************************************************************   CSW003
      /TITLE SR/WRITRA                                                    CSW003
      *****************************************************************   CSW003
      *                                                               *   CSW003
      * WRITRA - Routine to write Accrued Interest to File.           *   CSW003
      *                                                               *   CSW003
      *****************************************************************   CSW003
      *                                                                   CSW003
     C           WRITRA    BEGSR                                          CSW003
      *                                                                   CSW003
     C           PWHEN     IFEQ 'S'                                       CSE006
     C           *IN48     ANDEQ*OFF                                      CSE006
     C**********           MOVELPDVIN     DPITRA                                       CSE006 243125
     C                     Z-ADDPDVIN     DPITRA                                              243125
     C                     ELSE                                           CSE006
     C           PWHEN     IFEQ 'M'                                       CSE006
     C           *IN48     ANDEQ*OFF                                      CSE006
     C**********           MOVELPDMIN     DPITRA                                       CSE006 243125
     C                     Z-ADDPDMIN     DPITRA                                              243125
     C                     ELSE                                           CSE006
      *                                                                   CSE006
     C           PWHEN     IFEQ 'S'                                       CSW003
     C                     MOVE SDITRA    ZFLD17                          CSW003
     C                     ELSE                                           CSW003
     C                     MOVE MDITRA    ZFLD17                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     Z-ADDWWCDP     ZSDEC                           CSW003
     C           13        SUB  WWCDP     ZSDIG                           CSW003
     C                     EXSR ZASIGN                                    CSW003
     C                     MOVE ZOUT15    WITRAS                          CSW003
     C           ZFSIGN    IFNE '+'                                       CSW003
     C                     Z-SUBWITRAS    WITRAS                          CSW003
     C                     ENDIF                                          CSW003
     C                     MOVE WITRAS    DPITRA                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     ENDSR                                          CSW003
      *                                                                   CSW003
      *****************************************************************   CSW003
      /TITLE SR/FMSGTP                                                    CSE006
      *****************************************************************   CSE006
      *                                                               *   CSE006
      * FMSGTP - FIND MT5xx MESSAGE TYPES                             *   CSE006
      *                                                               *   CSE006
      *****************************************************************   CSE006
      *                                                                   CSE006
     C           FMSGTP    BEGSR                                          CSE006
      *                                                                   CSE006
     C           DPGMEC    IFEQ 'Y'                                       CSE006
     C                     ADD  1         @M                              CSE006
     C                     MOVEA'18'      @MT,@M                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C           DPGMES    IFEQ 'Y'                                       CSE006
     C                     ADD  1         @M                              CSE006
      *                                                                   CSE006
     C           CLAIE     IFEQ 'E'                                       CSE006
     C           CLAIC     OREQ 'C'                                       CSE006
     C                     MOVEA'80'      @MT,@M                          CSE006
     C                     ELSE                                           CSE006
     C           CSE029    IFEQ 'Y'                                                           243125
     C                     MOVEA'40'      @MT,@M                                              243125
     C                     ELSE                                                               243125
     C                     MOVEA'20'      @MT,@M                          CSE006
     C                     ENDIF                                                              243125
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     ADD  1         @M                              CSE006
     C           CLAOE     IFEQ 'E'                                       CSE006
     C           CLAOC     OREQ 'C'                                       CSE006
     C                     MOVEA'80'      @MT,@M                          CSE006
     C                     ELSE                                           CSE006
     C           CSE029    IFEQ 'Y'                                                           243125
     C                     MOVEA'42'      @MT,@M                                              243125
     C                     ELSE                                                               243125
     C                     MOVEA'22'      @MT,@M                          CSE006
     C                     ENDIF                                                              243125
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      **  If no messages, inform the user...                              CSE006
     C           @M        IFEQ 0                                         CSE006
     C                     MOVEL'No MT5xx'MSGTPS                          CSE006
      *                                                                   CSE006
     C                     ELSE                                           CSE006
      *                                                                   CSE006
      **  ... else produce string of message types                        CSE006
     C                     Z-ADD1         @X      10                      CSE006
      *                                                                   CSE006
     C           @M        IFLE 2                                         CSE006
     C                     MOVEL'MT5'     MSGTPS                          CSE006
     C                     ELSE                                           CSE006
     C                     MOVEL'5'       MSGTPS                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C           @M        DOWGE@X                                        CSE006
     C           @X        IFNE 1                                         CSE006
     C                     CAT  '/':0     MSGTPS                          CSE006
     C                     ENDIF                                          CSE006
     C                     MOVEA@MT,@X    @XY     2                       CSE006
     C                     CAT  @XY:0     MSGTPS                          CSE006
     C                     ADD  1         @X
     C                     ENDDO                                          CSE006
      *                                                                   CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     ENDSR                                          CSE006
      *                                                                   CSE006
      *****************************************************************   CSE006
      /TITLE SR/SRPOSS
      *****************************************************************
      *                                                               *
      * SRPOSS - ROUTINE TO CALL EXTENDED SETTLEMENTS PROGRAM         *
      *                                                               *
      *****************************************************************
      *
     C           SRPOSS    BEGSR
      *
     C                     MOVE WWSENT    PSENT
     C                     MOVE SGMES     PGMES
     C                     MOVE SGMEC     PGMEC
     C                     MOVE SFIND     PFIND
     C                     MOVE SD1522    PSNEW                                               199797
     C                     MOVE SDGMES    PGMES                                               201429
      *
      ** PWHEN must not be blanked out as CSW003 changes seems to always set                  CAP087
      ** this flag to 'S' or 'M' during insert REGARDLESS of the feature being                CAP087
      ** on or off (see subr SRINS or DEFLT for example) so why condition it here?            CAP087
     C***********CSW003    IFNE 'Y'                                       CSW003              CAP087
     C***********          MOVE *BLANKS   PWHEN                           CSW003              CAP087
     C***********          ENDIF                                          CSW003              CAP087
      *
     C                     CALL 'SE1808'
     C                     PARM '00'      PCMD
     C                     PARM 'N'       PERR
     C                     PARM           PDATA
     C                     PARM           PWHEN                           CSW003
     C                     PARM 'N'       PMODE                           CSE028
     C                     PARM SDSAFA    PSAFA                                               201230
     C                     PARM *BLANKS   PTEMP                                               CSD015
      *                                                                                       CSD015
     C                     CAT  PTEMP:0   PMCWL                                               CSD015
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/SR1100
      *****************************************************************
      *                                                               *
      * SR1100    - DETERMINE NETWORK AND ADDRESSES                   *
      *                                                               *
      *****************************************************************
      *
     C           SR1100    BEGSR
      *
     C                     MOVE *BLANKS   WNWSN  20
     C                     MOVE *BLANKS   WNWDS  22
     C                     MOVE *BLANKS   WNWRK   6
     C                     MOVE *BLANKS   WERRC   1
     C                     MOVE *BLANKS   WSRNM  20
     C                     MOVE *BLANKS   WSRTN  10
     C                     MOVE *BLANKS   WDRNM  20
     C                     MOVE *BLANKS   WDRTN  10
      *
     C                     CALL 'ZM1100'               50
     C                     PARM           WSNDR
     C                     PARM           WSCSD
     C                     PARM           WDEST
     C                     PARM           WSETP
     C                     PARM           WNWSN
     C                     PARM           WNWDS
     C                     PARM           WNWRK
     C                     PARM           WERRC
     C                     PARM           WSRNM
     C                     PARM           WSRTN
     C                     PARM           WDRNM
     C                     PARM           WDRTN
      *
     C           *IN50     IFEQ '1'
     C           WERRC     OREQ 'S'
     C           WERRC     OREQ 'D'
     C           WNWRK     OREQ 'UNROUT'
     C                     MOVE 'N'       WWGME   1
     C                     MOVEL*BLANKS   WWROU   6
     C                     MOVEL'  UNRO'  WKROT   6
     C                     MOVELWKROT     WWROT  12
     C                     MOVE 'UTABLE'  WWROT
     C                     ELSE
      *
     C                     MOVE 'Y'       WWGME
     C                     MOVELWNWRK     WWROU
     C                     MOVEAWNWDS     ROU
     C                     Z-ADD1         J       20
     C           ' '       LOKUPROU,J                    85
     C           *IN85     IFEQ '0'
     C                     MOVELWNWDS     WWROT
     C                     ELSE
     C           14        SUB  J         K       20
     C                     MOVEA*ALL' '   ROU
     C                     MOVEAWNWDS     ROU,K
     C                     MOVEAROU       WWROT
     C                     END
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/SRGMES
      *****************************************************************
      *                                                               *
      * SRGMES    - VALIDATE SETTLEMENT MESSAGE REQUEST               *
      *                                                               *
      *****************************************************************
      *
     C           SRGMES    BEGSR
      *                                                                                       201233
      ** Check first 6 char. of destinatinon of settlement.                                   201233
     C                     MOVE WWROT     WAROT   6                                           201233
      *
      ** Assumed to be 'Y' when left blank
      ** unless Depot Movement is in the Grey Market.
      ** And unless Detinationation of Settlement is 'UNROUTABLE'.                            201233
      *
     C           SGMES     IFEQ *BLANK
     C           PDPMK     IFNE 'G'
     C           WKROT     ANDNE'  UNRO'                                                      201233
     C           WAROT     ANDEQ'UTABLE'                                                      201233
     C                     MOVE 'Y'       SGMES
     C                     ELSE
     C                     MOVE 'N'       SGMES
     C                     ENDIF
     C                     ENDIF
      *
      ** If SGMES is not 'Y' or 'N'
     C           SGMES     IFNE 'Y'
     C           SGMES     ANDNE'N'
     C                     SETON                     2175
     C                     MOVEL'SEW5101' ZAMSID
     C                     EXSR SRSMSG
     C                     END
      *
      ***  If Settlement Message Request is 'Y', Depot Movement may not
      ***  be in the Grey Market.
      *
     C           SGMES     IFEQ 'Y'
     C           PDPMK     ANDEQ'G'
     C                     SETON                     2175
     C                     MOVEL'SEW5292' ZAMSID
     C                     EXSR SRSMSG
     C                     ENDIF
      *                                                                                       201233
      ** If Destination of Settlement is 'UNROUTABLE', then Settlement                        201233
      ** Message Request cannot be 'Y'.                                                       201233
      *                                                                                       201233
     C                     MOVELSROTS     WROUS   6                                           201233
     C                     MOVE SROTS     WROUT   6                                           201233
     C           SGMES     IFEQ 'Y'                                                           201233
     C           WROUS     ANDEQ'  UNRO'                                                      201233
     C           WROUT     ANDEQ'UTABLE'                                                      201233
     C                     SETON                     2175                                     201233
     C                     MOVEL'SEW9001' ZAMSID                                              201233
     C                     EXSR SRSMSG                                                        201233
     C                     ENDIF                                                              201233
      *
      **  If settlement message request was previously 'Y' then issue
      **  a warning message if the user changes this value. The message
      **  will inform the user that outstanding settlements exist for
      **  this trade.
      *
     C           PACTN     IFEQ 'A'
     C           SVGMES    ANDEQ'Y'
      *
     C           SVGMES    IFNE SGMES
     C           WRNS      ANDNE'Y'
     C                     SETON                     2175
     C                     MOVEL'Y'       WRNS    1
     C                     MOVEL'SEW5853' ZAMSID
     C                     EXSR SRSMSG
     C                     ELSE
     C                     MOVEL'N'       WRNS
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/SRINST
      *****************************************************************
      *                                                               *
      * SRINST    - VALIDATE INSTRUCTIONS TYPE (SINST)                *
      *                                                               *
      *****************************************************************
      *
     C           SRINST    BEGSR
      *
      * Check the following for MT580 only
     C           WWCLTY    IFEQ '14'
      *
      * A settlement message is requested
     C           SGMES     IFEQ 'N'
     C           SINST     IFNE *BLANKS
     C                     SETON                     2275
     C                     MOVEL'SEW5170' ZAMSID
     C                     EXSR SRSMSG
     C                     END
     C                     ELSE
      *
      * Check instructions type as a alpha input field
     C           SINST     LOKUPVA1                      86
      *
      * If not found and sent to Cedel
      * ( Note MT580 have only Cedel or Euroclear destination )
     C           *IN86     IFEQ '0'
     C           WWSENT    ANDEQ'CEDEL'
      *
     C           SINST     LOKUPVA2                      86
     C           *IN86     IFEQ '0'
     C                     SETON                     2275
     C                     MOVEL'SEW5102' ZAMSID
     C                     EXSR SRSMSG
     C                     END
     C                     END
      *
      * If not found and sent to Euroclear
     C           *IN86     IFEQ '0'
     C           WWSENT    ANDEQ'EOC  '
      *
     C           SINST     LOKUPVA3                      86
     C           *IN86     IFEQ '0'
     C                     SETON                     2275
     C                     MOVEL'SEW5103' ZAMSID
     C                     EXSR SRSMSG
     C                     END
     C                     END
     C                     END
      *
     C                     ELSE
      * Must not be entered if clearance type is not 1, 2, 3 or 4
     C           SINST     IFNE *BLANKS
     C                     SETON                     2275
     C                     MOVEL'SEW5111' ZAMSID
     C                     EXSR SRSMSG
     C                     END
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/SRINSS
      *****************************************************************
      *                                                               *
      * SRINSS    - VALIDATE INSTRUCTIONS SUB-TYPE (SINSS)            *
      *                                                               *
      *****************************************************************
      *
     C           SRINSS    BEGSR
      ***********                                                         CSW003
      ***Determine Receive Free of Payment                                CSW003
     C***********SFIND     IFEQ 'F'                                       CSW003
     C***********PTNTP     IFEQ 'RR'                                      CSW003
     C***********PTNTP     OREQ 'BB'                                      CSW003
     C***********PTNTP     OREQ 'PL'                                      CSW003
     C***********PTNTP     OREQ 'WI'                                      CSW003
     C***********PTNTP     OREQ 'RP'                                      CSW003
     C***********PTNTP     OREQ 'PD'                                      CSW003
     C***********PTNTP     OREQ 'BL'                                      CSW003
     C***********          MOVE PDPMD     ZDATE   60                      CSW003
     C***********          EXSR ZDATE1                                    CSW003
     C***********          MOVE 'RECFREE' WWINST                          CSW003
     C***********          END                                            CSW003
      ***********                                                         CSW003
      ***Determine Deliver Free of Payment                                CSW003
     C***********PTNTP     IFEQ 'RP'                                      CSW003
     C***********PTNTP     OREQ 'BL'                                      CSW003
     C***********PTNTP     OREQ 'PD'                                      CSW003
     C***********PTNTP     OREQ 'WO'                                      CSW003
     C***********PTNTP     OREQ 'RR'                                      CSW003
     C***********PTNTP     OREQ 'BB'                                      CSW003
     C***********PTNTP     OREQ 'PL'                                      CSW003
     C***********PTNTP     OREQ 'DT'                                      CSW003
     C***********          MOVE PDPDO     ZDATE                           CSW003
     C***********          EXSR ZDATE1                                    CSW003
     C***********          MOVE 'DELFREE' WWINST                          CSW003
     C***********          END                                            CSW003
     C***********          END                                            CSW003
      ***********                                                         CSW003
      ***Determine Receive Against Payment                                CSW003
     C***********SFIND     IFEQ 'A'                                       CSW003
     C***********PTNTP     IFEQ 'RR'                                      CSW003
     C***********PTNTP     OREQ 'BB'                                      CSW003
     C***********PTNTP     OREQ 'PL'                                      CSW003
     C***********PTNTP     OREQ 'WI'                                      CSW003
     C***********PTNTP     OREQ 'RP'                                      CSW003
     C***********PTNTP     OREQ 'PD'                                      CSW003
     C***********PTNTP     OREQ 'BL'                                      CSW003
     C***********          MOVE PDPMD     ZDATE                           CSW003
     C***********          EXSR ZDATE1                                    CSW003
     C***********          MOVE 'RECAPMT' WWINST                          CSW003
     C***********          END                                            CSW003
      ***********                                                         CSW003
      ***Determine Deliver Against Payment                                CSW003
     C***********PTNTP     IFEQ 'RP'                                      CSW003
     C***********PTNTP     OREQ 'BL'                                      CSW003
     C***********PTNTP     OREQ 'PD'                                      CSW003
     C***********PTNTP     OREQ 'WO'                                      CSW003
     C***********PTNTP     OREQ 'RR'                                      CSW003
     C***********PTNTP     OREQ 'BB'                                      CSW003
     C***********PTNTP     OREQ 'PL'                                      CSW003
     C***********PTNTP     OREQ 'DT'                                      CSW003
     C***********          MOVE PDPDO     ZDATE                           CSW003
     C***********          EXSR ZDATE1                                    CSW003
     C***********          MOVE 'DELAPMT' WWINST                          CSW003
     C***********          END                                            CSW003
     C***********          END                                            CSW003
      ***********                                                         CSW003
      ** Determine Deliver/Receive Free/Against Payment                   CSW003
     C           PWHEN     IFEQ 'S'                                       CSW003
     C           PWHEN     OREQ *BLANKS                                   CSW003
      *                                                                   CSW003
     C           PTNTP     IFEQ 'RR'                                      CSW003
     C           PTNTP     OREQ 'BB'                                      CSW003
     C           PTNTP     OREQ 'PL'                                      CSW003
     C           PTNTP     OREQ 'WI'                                      CSW003
     C           SDFIND    IFEQ 'F'                                       CSW003
     C                     MOVE 'RECFREE' WWINST                          CSW003
     C                     ELSE                                           CSW003
     C                     MOVE 'RECAPMT' WWINST                          CSW003
     C                     ENDIF                                          CSW003
     C                     ELSE                                           CSW003
     C           PTNTP     IFEQ 'RP'                                      CSW003
     C           PTNTP     OREQ 'BL'                                      CSW003
     C           PTNTP     OREQ 'PD'                                      CSW003
     C           PTNTP     OREQ 'WO'                                      CSW003
     C           PTNTP     OREQ 'DT'                                      CSW003
     C           SDFIND    IFEQ 'F'                                       CSW003
     C                     MOVE 'DELFREE' WWINST                          CSW003
     C                     ELSE                                           CSW003
     C                     MOVE 'DELAPMT' WWINST                          CSW003
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ELSE                                           CSW003
      * Else Maturity Date                                                CSW003
     C           PTNTP     IFEQ 'RP'                                      CSW003
     C           PTNTP     OREQ 'BL'                                      CSW003
     C           PTNTP     OREQ 'PD'                                      CSW003
     C           PTNTP     OREQ 'DT'                                      CSW003
     C           MDFIND    IFEQ 'F'                                       CSW003
     C                     MOVE 'RECFREE' WWINST                          CSW003
     C                     ELSE                                           CSW003
     C                     MOVE 'RECAPMT' WWINST                          CSW003
     C                     ENDIF                                          CSW003
     C                     ELSE                                           CSW003
     C           PTNTP     IFEQ 'RR'                                      CSW003
     C           PTNTP     OREQ 'BB'                                      CSW003
     C           PTNTP     OREQ 'PL'                                      CSW003
     C           MDFIND    IFEQ 'F'                                       CSW003
     C                     MOVE 'DELFREE' WWINST                          CSW003
     C                     ELSE                                           CSW003
     C                     MOVE 'DELAPMT' WWINST                          CSW003
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
      * Instructions type and Instructions sub-type
     C                     MOVELSINST     WWINSS  8
     C                     MOVE SINSS     WWINSS
      *
      * Key: Destination, Trans. type, Pay code,
      *      Instructions type and sub-type
     C                     MOVEL*BLANKS   KMGECO 20
     C                     MOVELWWGECO    KMGECO
      *
      * Check the following for MT580 only
     C           WWCLTY    IFEQ '14'
      *
      * A settlement message is requested
     C           SGMES     IFEQ 'N'
     C           SINSS     IFNE *BLANKS
     C                     SETON                     2375
     C                     MOVEL'SEW5170' ZAMSID
     C                     EXSR SRSMSG
     C                     END
     C                     ELSE
      *
      * Check internal or bridge instructions sub-type
     C           SINST     IFEQ 'INT'
     C           SINST     OREQ 'BRI'
      *
     C           SINSS     IFNE 'SETTL'
     C           SINSS     ANDNE'MATCH'
     C           SINSS     ANDNE'TRANS'
     C                     SETON                     2375
     C                     MOVEL'SEW5104' ZAMSID
     C                     EXSR SRSMSG
     C                     END
     C                     END
      *
      * Check external sub-type
     C           SINST     IFEQ 'EXT'
      *
     C           SINSS     IFNE 'BOOK '
     C           SINSS     ANDNE' BOOK'
     C           SINSS     ANDNE'PHYSI'
     C                     SETON                     2375
     C                     MOVEL'SEW5105' ZAMSID
     C                     EXSR SRSMSG
     C                     END
     C                     END
      *
      * Check instructions sub-type depending of type of delivering
     C           KMGECO    CHAINMGECONL0             86
     C           *IN86     IFEQ '1'
      *
     C           WWINST    IFEQ 'RECFREE'
     C                     MOVEL'SEW5107' ZAMSID
     C                     ELSE
     C           WWINST    IFEQ 'RECAPMT'
     C                     MOVEL'SEW5108' ZAMSID
     C                     ELSE
     C           WWINST    IFEQ 'DELFREE'
     C                     MOVEL'SEW5109' ZAMSID
     C                     ELSE
     C           WWINST    IFEQ 'DELAPMT'
     C                     MOVEL'SEW5110' ZAMSID
     C                     END
     C                     END
     C                     END
     C                     END
      *
     C                     SETON                     2375
     C           ZAMSID    IFEQ *BLANKS
     C                     MOVEL'SEW5102' ZAMSID
     C                     END
     C                     EXSR SRSMSG
     C                     END
     C                     END
      *
     C                     ELSE
      * Must not be entered if clearance type is not 1, 2, 3 or 4
     C           SINSS     IFNE *BLANKS
     C                     SETON                     2375
     C                     MOVEL'SEW5112' ZAMSID
     C                     EXSR SRSMSG
     C                     END
      *
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/SREUCL
      *****************************************************************
      *                                                               *
      * SREUCL    - VALIDATE EUROCLEAR/CEDEL CODE (SEUCL)             *
      *                                                               *
      *****************************************************************
      *
     C           SREUCL    BEGSR
      *
      * Check the following for MT580 only
     C           WWCLTY    IFEQ '14'
      *
      * A settlement message is requested
     C           SGMES     IFEQ 'N'
     C           SEUCL     IFNE *BLANKS
     C                     SETON                     2475
     C                     MOVEL'SEW5170' ZAMSID
     C                     EXSR SRSMSG
     C                     END
     C                     ELSE
      *
      * Override by F18
     C           WWSENT    IFEQ 'EOC  '
     C           *INKS     ANDEQ'1'                                       103583
     C           OVER1     ANDEQ'1'                                       103583
     C           WWSENT    OREQ 'CEDEL'
     C           *INKS     ANDEQ'1'
     C           OVER1     ANDEQ'1'
     C                     SETOF                     KS
     C                     MOVE 'Y'       OVER1
     C                     END
      *
      * If not overridden
     C           OVER1     IFNE 'Y'
      *
      * PEUCL must start by  "//XC" or "//XE" or "/"
     C           SEU11     IFNE '/'
     C           SEU14     ANDNE'//XC'
     C           SEU14     ANDNE'//XE'
     C                     SETON                     24
     C                     END
      *
      * PEUCL must be a 5 or 6 digits number
     C           SEU33     IFEQ 'X'
     C                     MOVE SEU51     WZEUCL  6
     C                     ELSE
     C           SEU11     IFEQ '/'
     C                     MOVE SEU27     WZEUCL
     C                     ELSE
     C                     MOVELSEUCL     WZEUCL
     C                     END
     C                     END
      *
     C                     MOVEAWZEUCL    EU1
     C                     SETOF                     85
     C                     Z-ADD0         I       20
     C           I         DOWLE4
     C           *IN24     ANDEQ'0'
     C                     ADD  1         I
      *
     C           EU1,I     IFEQ ' '
     C                     SETON                     24
     C                     ELSE
     C           EU1,I     LOKUPVA0                      85
     C           *IN85     IFEQ '0'
     C                     SETON                     24
     C                     END
     C                     END
      *
     C                     END
      *
      * Euroclear/Cedel Code is not valid
     C           *IN24     IFEQ '1'
     C                     SETON                     75
     C                     MOVE '1'       OVER1
     C                     MOVEL'SEW5115' ZAMSID
     C                     EXSR SRSMSG
     C                     END
      *
      * For external instructions //XC or //XE is not allowed
     C           SINST     IFEQ '6F '
     C           SINST     OREQ '61 '
     C           SINST     OREQ '8A '
     C           SINST     OREQ '8D '
     C           SINST     OREQ '8M '
     C           SINST     OREQ '81 '
     C           SINST     OREQ 'EXT'
      *
     C           SEU14     IFEQ '//XC'
     C           SEU14     OREQ '//XE'
     C                     SETON                     75
     C                     MOVE '1'       OVER1
     C                     MOVEL'SEW5117' ZAMSID
     C                     EXSR SRSMSG
     C                     END
     C                     END
     C                     END
     C                     END
      *
     C                     ELSE
      * Must not be entered if clearance type is not 1, 2, 3 or 4
     C           SEUCL     IFNE *BLANKS
     C                     SETON                     2475
     C                     MOVEL'SEW5116' ZAMSID
     C                     EXSR SRSMSG
     C                     END
      *
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/SRSAFA
      *****************************************************************
      *                                                               *
      * SRSAFA    - VALIDATE SAFEKEEPING ACCOUNT (SSAFA)              *
      *                                                               *
      *****************************************************************
      *
     C           SRSAFA    BEGSR
      *
      * Check the following for MT580 only
     C           WWCLTY    IFEQ '14'
      *
      * A settlement message is requested
     C           SGMES     IFEQ 'N'
     C           SSAFA     IFNE *BLANKS
     C                     SETON                     2575
     C                     MOVEL'SEW5170' ZAMSID
     C                     EXSR SRSMSG
     C                     END
     C                     ELSE
      *
      * Override by F18
     C           WWSENT    IFEQ 'EOC  '
     C           *INKS     ANDEQ'1'
     C           OVER2     ANDEQ'1'
     C           WWSENT    OREQ 'CEDEL'
     C           *INKS     ANDEQ'1'
     C           OVER2     ANDEQ'1'
     C                     SETOF                     KS
     C                     MOVE 'Y'       OVER2
     C                     END
      *
      * If not overridden
     C           OVER2     IFNE 'Y'
      *
      * PSAFA must start by a slash "/"
     C                     MOVELSSAFA     WWSAFA  1
     C           WWSAFA    IFNE '/'
     C                     SETON                     25
     C                     END
      *
      * PSAFA must be a 5 digits number
     C                     MOVEASSAFA     EU1
     C                     SETOF                     85
     C                     Z-ADD1         I
     C           I         DOWLE5
     C           *IN25     ANDEQ'0'
     C                     ADD  1         I
      *
     C           EU1,I     IFEQ ' '
     C                     SETON                     25
     C                     ELSE
     C           EU1,I     LOKUPVA0                      85
     C           *IN85     IFEQ '0'
     C                     SETON                     25
     C                     END
     C                     END
      *
     C                     END
      *
      * Safekeeping A/c is not valid
     C           *IN25     IFEQ '1'
     C                     SETON                     75
     C                     MOVE '1'       OVER2
     C                     MOVEL'SEW5120' ZAMSID
     C                     EXSR SRSMSG
     C                     END
      *
      * Euroclear/Cedel must be different as Safekeeping Account
     C                     MOVEL*BLANKS   AAEUCL  6
     C           SSAFA     IFNE *BLANKS
     C                     MOVELSEUCL     AAEUCL
     C           AAEUCL    IFEQ SSAFA
     C                     SETON                     24
     C                     ELSE
      *
     C           SEU14     IFEQ '//XC'
     C           SEU59     ANDEQSSA26
     C           SEU14     OREQ '//XE'
     C           SEU59     ANDEQSSA26
     C                     SETON                     24
     C                     END
     C                     END
     C                     END
      *
     C           *IN24     IFEQ '1'
     C                     SETON                     75
     C                     MOVE '1'       OVER2
     C                     MOVEL'SEW5121' ZAMSID
     C                     EXSR SRSMSG
     C                     END
     C                     END
     C                     END
      *
     C                     ELSE
      * Must not be entered if clearance type is not 1, 2, 3 or 4
     C           SSAFA     IFNE *BLANKS
     C                     SETON                     2575
     C                     MOVEL'SEW5122' ZAMSID
     C                     EXSR SRSMSG
     C                     END
      *
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/SRRPTY
      *****************************************************************
      *                                                               *
      * SRRPTY    - VALIDATE REQUESTED PRIORITY FIELD (SRPTY)         *
      *                                                               *
      *****************************************************************
      *
     C           SRRPTY    BEGSR
      *
      * A settlement message is requested
     C           SGMES     IFEQ 'N'
     C           SRPTY     IFNE *BLANKS
     C                     SETON                     2675
     C                     MOVEL'SEW5170' ZAMSID
     C                     EXSR SRSMSG
     C                     END
     C                     ELSE
      *
      * If SRPTY is not '1', '2', '3' , '4' or blank
     C           SRPTY     IFNE '1'
     C           SRPTY     ANDNE'2'
     C           SRPTY     ANDNE'3'
     C           SRPTY     ANDNE'4'
     C           SRPTY     ANDNE*BLANKS
     C                     SETON                     2675
     C                     MOVEL'SEW5125' ZAMSID
     C                     EXSR SRSMSG
     C                     END
      *
     C           WWSENT    IFEQ 'CEDEL'
     C           SRPTY     ANDEQ'4'
     C                     SETON                     2675
     C                     MOVEL'SEW5126' ZAMSID
     C                     EXSR SRSMSG
     C                     END
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/SRFIND
      *****************************************************************
      *                                                               *
      * SRFIND - Routine to validate Free or against payment Ind.     *
      *                                                               *
      *****************************************************************
      *
     C           SRFIND    BEGSR
      *
      ** IF PFIND DOES NOT EQUAL 'F' OR 'A'
     C           SFIND     IFNE 'F'
     C           SFIND     ANDNE'A'
      *
     C                     SETON                     3575
     C                     MOVEL'SEW7009' ZAMSID
     C                     EXSR SRSMSG
     C                     END
      *
      *                                                                                       194231
      ** If the start and maturity date flags for free issue/ against                         194231
      ** Payment flags are not the same issue message and return.                             194231
      *                                                                                       194231
     C           SDFIND    IFNE MDFIND                                                        194231
     C           PWHEN     ANDEQ'M'                                                           194231
      *                                                                                       194231
     C                     SETON                     3575                                     194231
     C                     MOVEL'SEW1034' ZAMSID                                              194231
     C                     EXSR SRSMSG                                                        194231
     C                     END                                                                194231
      *                                                                                       194231
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/SRGMEC
      *****************************************************************
      *                                                               *
      * SRGMEC    - VALIDATE CONFIRMATION MESSAGE REQUEST             *
      *                                                               *
      *****************************************************************
      *
     C           SRGMEC    BEGSR
      *
      * Assumed to be 'Y' when left blank (Reverse repo,
      * Repurchase agreement)
     C           PDPMV     IFEQ 'RR'
     C           SGMEC     ANDEQ*BLANK
     C           PDPMV     OREQ 'RP'
     C           SGMEC     ANDEQ*BLANK
     C           PDPMV     OREQ 'PD'                                      103449
     C           SGMEC     ANDEQ*BLANK                                    103449
     C           PDPMV     OREQ 'PL'                                      103449
     C           SGMEC     ANDEQ*BLANK                                    103449
     C********** PDPMV     OREQ 'BB'                                CSE006204956
     C********** MODE      ANDNE*BLANK                              CSE006204956
     C********** SGMEC     ANDEQ*BLANK                              CSE006204956
     C********** PDPMV     OREQ 'BL'                                CSE006204956
     C********** MODE      ANDNE*BLANK                              CSE006204956
     C********** SGMEC     ANDEQ*BLANK                              CSE006204956
     C                     MOVEL'Y'       SGMEC
     C                     END
      *
     C           PDPMV     IFEQ 'BB'                                      204956
     C           MODE      ANDNE*BLANK                                    204956
     C           SGMEC     ANDEQ*BLANK                                    204956
     C           PDPMV     OREQ 'BL'                                      204956
     C           MODE      ANDNE*BLANK                                    204956
     C           SGMEC     ANDEQ*BLANK                                    204956
     C                     MOVEL'N'       SGMEC                           204956
     C                     END                                            204956
      *
      **If*SGMEC*is*not*'Y'*or*'N'*or*blanks                              096833
      * If SGMEC is not 'Y' or 'N'.                                       096833
     C           SGMEC     IFNE 'Y'
     C           SGMEC     ANDNE'N'
     C                     SETON                     2775
     C***********          MOVEL'SEW5125' ZAMSID                          096833
     C                     MOVEL'SEW5128' ZAMSID                          096833
     C                     EXSR SRSMSG
     C                     END
      **  If SGMEC is 'Y' then check that the counterparty has a STTX
      **  or SWIFT ADDRESS or TELEX ADDRESS.
      *
     C           SGMEC     IFEQ 'Y'
     C           *IN20     ANDEQ*OFF                                                          207255
     C***********          MOVELSDPSS     WDPSS  10                       ERR033
     C**********           Z-ADDPDPBN     WPTC1                           ERR033              CSD027
     C                     MOVE PDPBN     WPTC1                                               CSD027
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   WRTCD   7
     C                     PARM '*KEY   ' WOPTN   7
     C***********          PARM WDPSS     WKEY1  10                       ERR033
     C                     PARM WPTC2     WKEY1  10                       ERR033
     C                     PARM           WKYST   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           BBCSID    IFEQ *BLANKS
     C           BBSTAD    ANDEQ*BLANKS
     C           BBTXA1    ANDEQ*BLANKS
     C                     SETON                     2775
     C                     MOVEL'SEW5127' ZAMSID
     C                     EXSR SRSMSG
     C                     ENDIF
     C                     ENDIF
      *
      *
      * If PDPMV is not 'RR' or 'RP'
     C           SGMEC     IFEQ 'Y'
     C           *IN20     ANDEQ*OFF                                                          207255
     C           PDPMV     ANDNE'RR'
     C           PDPMV     ANDNE'RP'
     C           PDPMV     ANDNE'PD'                                      103449
     C           PDPMV     ANDNE'PL'                                      103449
     C                     SETON                     2775
     C                     MOVEL'SEW7010' ZAMSID
     C                     EXSR SRSMSG
     C                     END
      *
      **  If confirmation message request was previously 'Y' then issue
      **  a warning message if the user changes this value. The message
      **  will inform the user that outstanding settlements exist for
      **  this trade.
      *
     C           PACTN     IFEQ 'A'
     C           SVGMEC    ANDEQ'Y'
      *
     C           SVGMEC    IFNE SGMEC
     C           WRNC      ANDNE'Y'
     C                     SETON                     2775
     C                     MOVEL'Y'       WRNC    1
     C                     MOVEL'SEW5854' ZAMSID
     C                     EXSR SRSMSG
     C                     ELSE
     C                     MOVEL'N'       WRNC
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/SRTRTT
      *****************************************************************
      *                                                               *
      * SRTRTT    - VALIDATE TIME OF TRANSACTION FIELD (STRTT)        *
      *                                                               *
      *****************************************************************
      *
     C           SRTRTT    BEGSR
      *
      * TIME is mandatory for instructions sent to Cedel
     C           STRTT     IFEQ *BLANKS
     C           WWSENT    ANDEQ'CEDEL'
     C                     SETON                     3075
     C                     MOVEL'SEW5146' ZAMSID
     C                     EXSR SRSMSG
     C                     END
      *
      * Check time is valid
     C           STRTT     IFNE *BLANKS
     C                     MOVELSTRTT     WWNUM5  50
     C                     MOVELWWNUM5    WWALF4  4
     C                     MOVELSTRTT     WWHOUR  20
     C                     MOVE STRTT     WWMINS  20
     C           STRTT     IFNE WWALF4
     C           WWHOUR    ORGT 23
     C           WWHOUR    ORLT 0
     C           WWMINS    ORGT 59
     C           WWMINS    ORLT 0
     C                     SETON                     3075
     C                     MOVEL'SEW5147' ZAMSID
     C                     EXSR SRSMSG
     C                     END
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/SRTRTT
      *****************************************************************
      *                                                               *
      * SRGDEL    - VALIDATE GUARANTEED DELIVERY FIELD (SGDEL)        *
      *                                                               *
      *****************************************************************
      *
     C           SRGDEL    BEGSR
      *
      * A settlement message is requested
     C           SGMES     IFEQ 'N'
     C           SGDEL     IFNE *BLANKS
     C                     SETON                     3175
     C                     MOVEL'SEW5170' ZAMSID
     C                     EXSR SRSMSG
     C                     END
     C                     ELSE
      *
      * If SGDEL is not 'G' or blank
     C           SGDEL     IFNE 'G'
     C           SGDEL     ANDNE*BLANKS
     C                     SETON                     3175
     C                     MOVEL'SEW5150' ZAMSID
     C                     EXSR SRSMSG
     C                     END
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/SRFCOD
      *****************************************************************
      *                                                               *
      * SRFCOD    - VALIDATE FUNGIBILITY CODE FIELD (SFCOD)           *
      *                                                               *
      *****************************************************************
      *
     C           SRFCOD    BEGSR
      *
      * Check the following for MT580 only
     C           WWCLTY    IFEQ '14'
      *
      * A settlement message is requested
     C           SGMES     IFEQ 'N'
     C           SFCOD     IFNE *BLANKS
     C                     SETON                     3275
     C                     MOVEL'SEW5170' ZAMSID
     C                     EXSR SRSMSG
     C                     END
     C                     ELSE
      *
     C           SFCOD     IFNE *BLANKS
     C           WWSENT    ANDNE'CEDEL'
     C                     SETON                     3275
     C                     MOVEL'SEW5155' ZAMSID
     C                     EXSR SRSMSG
     C                     END
      *
      * If SFCOD is not '0', '1', '2' , '3', '5', '6', '7' or blank
     C           SFCOD     IFNE '0'
     C           SFCOD     ANDNE'1'
     C           SFCOD     ANDNE'2'
     C           SFCOD     ANDNE'3'
     C           SFCOD     ANDNE'5'
     C           SFCOD     ANDNE'6'
     C           SFCOD     ANDNE'7'
     C           SFCOD     ANDNE*BLANKS
     C                     SETON                     3275
     C                     MOVEL'SEW5156' ZAMSID
     C                     EXSR SRSMSG
     C                     END
      *
      * Check combinations between instructions and fungibility codes
      * (for Cedel)
     C           WWSENT    IFEQ 'CEDEL'
     C           KMGECO    CHAINMGECONL0             85
     C           *IN85     IFEQ '0'
     C                     MOVEAMGXFUN    MGFUN
     C           SFCOD     LOKUPMGFUN                    85
     C           *IN85     IFEQ '0'
     C                     SETON                     3275
     C                     MOVEL'SEW5157' ZAMSID
     C                     EXSR SRSMSG
     C                     END
     C                     END
     C                     END
     C                     END
      *
     C                     ELSE
      * Must not be entered if clearance type is not 1, 2, 3 or 4
     C           SFCOD     IFNE *BLANKS
     C                     SETON                     3275
     C                     MOVEL'SEW5159' ZAMSID
     C                     EXSR SRSMSG
     C                     END
      *
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/SRSROL
      *****************************************************************
      *                                                               *
      * SRSROL    - VALIDATE SENDER'S ROLE (SSROL)                    *
      *                                                               *
      *****************************************************************
      *
     C           SRSROL    BEGSR
      *
      * Check the following for MT580 only
     C           WWCLTY    IFEQ '14'
      *
      * A settlement message is requested
     C           SGMES     IFEQ 'N'
     C           SSROL     IFNE *BLANKS
     C                     SETON                     3475
     C                     MOVEL'SEW5170' ZAMSID
     C                     EXSR SRSMSG
     C                     END
     C                     ELSE
      *
      * If SSROL  is not AGEN, CUST, PRIN or blank
     C           SSROL     IFNE 'AGEN'
     C           SSROL     ANDNE'CUST'
     C           SSROL     ANDNE'PRIN'
     C           SSROL     ANDNE*BLANKS
     C                     SETON                     3475
     C                     MOVEL'SEW5165' ZAMSID
     C                     EXSR SRSMSG
     C                     END
     C                     END
      *
     C                     ELSE
      * Must not be entered if clearance type is not 1, 2, 3 or 4
     C           SSROL     IFNE *BLANKS
     C                     SETON                     3475
     C                     MOVEL'SEW5166' ZAMSID
     C                     EXSR SRSMSG
     C                     END
      *
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************                       CSE028
      /TITLE SR/SR1522                                                                        CSE028
      *****************************************************************                       CSE028
      *                                                               *                       CSE028
      * SR1522    - Validate ISO15022 Message                         *                       CSE028
      *                                                               *                       CSE028
      *****************************************************************                       CSE028
      *                                                                                       CSE028
     C           SR1522    BEGSR                                                              CSE028
      *                                                                                       CSE028
     C           S1522     IFEQ *BLANKS                                                       CSE028
     C           PACTN     ANDEQ'I'                                                           CSE028
     C                     MOVE 'Y'       S1522                                               CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C           S1522     IFEQ 'Y'                                                           199797
     C           S1522     OREQ 'N'                                                           199797
     C           S1522     OREQ *BLANKS                                                       199797
      *                                                                                       199797
     C           PACTN     IFEQ 'A'                                                           CSE028
      *                                                                                       CSE028
     C**********           TESTB'0'       PDPMS      01                                CSE028 201429
      *                                                                                       CSE028
     C********** DPRCDG    IFEQ 'Y'                                                    CSE028 201429
     C********** *IN01     OREQ *ON                                                    CSE028 201429
      *                                                                                       CSE028
     C           DPNEW     IFNE S1522                                                         CSE028
     C           WB1522    ANDNE'Y'                                                           201231
     C           DPGMES    ANDEQ'Y'                                                           201429
     C           DPLSWS    ANDGT1                                                             201429
     C                     MOVE *ON       *IN65                                               CSE028
     C                     MOVE *ON       *IN75                                               CSE028
     C                     MOVEL'SE10037' ZAMSID                                              CSE028
     C                     EXSR SRSMSG                                                        CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
      ** If Amend and ISO15022 is blanked out and no swift message generated yet              201429
      ** then default value to 'N'                                                            201429
      *                                                                                       201429
     C           S1522     IFEQ *BLANK                                                        201429
     C           DPLSWS    ANDLE1                                                             201429
     C                     MOVE 'N'       S1522                                               201429
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C********** S1522     IFNE 'Y'                                                    CSE028 199797
     C********** S1522     ANDNE'N'                                                    CSE028 199797
     C********** S1522     ANDNE*BLANKS                                                CSE028 199797
     C                     ELSE                                                               199797
     C                     MOVE *ON       *IN65                                               CSE028
     C                     MOVE *ON       *IN75                                               CSE028
     C                     MOVEL'SE10030' ZAMSID                                              CSE028
     C                     EXSR SRSMSG                                                        CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     ENDSR                                                              CSE028
      *                                                                                       CSE028
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      * *PSSR  - Routine to handle database errors                    *
      *                                                               *
      *****************************************************************
      *
     C           *PSSR     BEGSR
      *
     C           WRUN      IFEQ *BLANK
     C                     MOVE 'Y'       WRUN    1
     C                     MOVEL'SE1807'  DBPGM
     C           *NAMVAR   DEFN LDA       WLDA  256
     C           *LOCK     IN   WLDA
     C                     MOVE DBERR     WLDA
     C                     OUT  WLDA
     C                     SETON                     U7U8LR
     C                     DUMP
     C                     END
     C/COPY WNCPYSRC,SE1807C061
      *
      ** Call standard DB error handler
     C                     CALL 'DBERRCTL'             81
     C/COPY WNCPYSRC,SE1807C062
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/SRPROT                                                    CSW003
      *****************************************************************   CSW003
      *                                                               *   CSW003
      * SRPROT - Routine to obtain Security Processing Type           *   CSW003
      *                                                               *   CSW003
      *****************************************************************   CSW003
      *                                                                   CSW003
     C           SRPROT    BEGSR                                          CSW003
      *                                                                   CSW003
     C           PDPSS     CHAINSECTY                04                   CSW003
      *                                                                   CSW003
      ** If record not found then setup message, protect fields for       CSW003
      ** display, display screen and handle database error.               CSW003
     C           *IN04     IFEQ '1'                                       CSW003
      *                                                                   CSW003
     C                     MOVEL'SEW9999' ZAMSID                          CSW003
     C                     EXSR SRSMSG                                    CSW003
      *                                                                   CSW003
     C                     SETON                     09                   CSW003
      *                                                                   CSW003
     C                     MOVEL'SECTY'   DBFILE           ***************CSW003
     C                     MOVELPDPSS     DBKEY            * DB ERROR 05 *CSW003
     C                     MOVEL'SE1807'  DBPGM            ***************CSW003
     C                     Z-ADD5         DBASE                           CSW003
     C                     EXSR *PSSR                                     CSW003
      *                                                                   CSW003
     C                     ELSE                                           CSW003
     C           INVKA     CHAININVTP                04                   CSW003
      *                                                                   CSW003
      ** If record not found then setup message, protect fields for       CSW003
      ** display, display screen and handle database error.               CSW003
     C           *IN04     IFEQ '1'                                       CSW003
      *                                                                   CSW003
     C                     MOVEL'SEW9999' ZAMSID                          CSW003
     C                     EXSR SRSMSG                                    CSW003
      *                                                                   CSW003
     C                     SETON                     09                   CSW003
      *                                                                   CSW003
     C                     MOVEL'INVTP'   DBFILE           ***************CSW003
     C**********           MOVELNMCY      DBFLD            * DB ERROR 06 *             CSW003 190743
     C                     MOVELNMCY      DBFLD  16        * DB ERROR 06 *                    190743
     C                     MOVE SITP      DBFLD            ***************CSW003
     C                     MOVELDBFLD     DBKEY                           CSW003
     C                     MOVEL'SE1807'  DBPGM                           CSW003
     C                     Z-ADD6         DBASE                           CSW003
     C                     EXSR *PSSR                                     CSW003
      *                                                                   CSW003
     C                     ELSE                                           CSW003
      *                                                                   CSW003
      *  If CSW003 on and not 'Walk In', 'Walk Out' or 'Depot Transfer'   CSW003
      *  and not processing types 2,4,7 display 'Accrued Interest' fieldl CSW003
     C           CSW003    IFEQ 'Y'                                       CSW003
     C           PDPMV     ANDNE'WI'                                      CSW003
     C           PDPMV     ANDNE'WO'                                      CSW003
     C           PDPMV     ANDNE'DT'                                      CSW003
     C           PROT      ANDNE'2'                                       CSW003
     C           PROT      ANDNE'4'                                       CSW003
     C           PROT      ANDNE'7'                                       CSW003
     C                     MOVE *ON       *IN39                           CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C           *IN39     IFEQ *ON                                       CSE006
     C           @CFRM     ANDNE'CSE006'                                  CSE006
     C                     MOVE *ON       *IN48                           CSE006
     C                     ELSE                                           CSE006
     C                     MOVE *OFF      *IN48                           CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     ENDSR                                          CSW003
      *                                                                   CSW003
      *****************************************************************   CSW003
      *                                                               *   CSW003
      *  EUCLF  - Remove leading blanks from Euroclear/Cedel Code     *   CSW003
      *                                                               *   CSW003
      *****************************************************************   CSW003
      *                                                                   CSW003
     C           EUCLF     BEGSR                                          CSW003
      *                                                                   CSW003
      ** If the array is empty, do not try to remove leading blanks       CSW003
      ** Otherwise, following existing logic.                             CSW003
     C                     MOVEAEUCLA     W0EUCL  6                       CSW003
     C           W0EUCL    IFEQ *BLANK                                    CSW003
     C                     MOVEL*BLANK    WKEUCL                          CSW003
     C                     ELSE                                           CSW003
     C                     Z-ADD1         I                               CSW003
     C           I         DOWLE6                                         CSW003
     C           EUCLA,I   ANDEQ*BLANK                                    CSW003
     C                     ADD  1         I                               CSW003
     C                     ENDDO                                          CSW003
     C                     MOVEAEUCLA,I   EUCLB     P                     CSW003
     C                     MOVEAEUCLB     WKEUCL    P                     CSW003
     C                     END                                            CSW003
      *                                                                   CSW003
     C                     ENDSR                                          CSW003
      *                                                                   CSW003
      *****************************************************************
      *                                                                   CSW003
      *****************************************************************   CSW098
      *                                                               *   CSW098
      *  SRSIOR - Validate Standard Instruction Override              *   CSW098
      *                                                               *   CSW098
      *****************************************************************   CSW098
      *                                                                   CSW098
     C           SRSIOR    BEGSR                                          CSW098
      *                                                                   CSW098
      * Standard Override Instruction must be 'Y' or 'N'.                 CSW098
     C           SSIOR     IFNE 'Y'                                       CSW098
     C           SSIOR     ANDNE'N'                                       CSW098
     C                     SETON                     4675                 CSW098
     C                     MOVEL'SEW5175' ZAMSID                          CSW098
     C                     EXSR SRSMSG                                    CSW098
     C                     ENDIF                                          CSW098
      *                                                                   CSW098
     C                     ENDSR                                          CSW098
      *                                                                   CSW098
      *****************************************************************   CSW098
     C/COPY WNCPYSRC,SE1807C009
      /TITLE SR/ZALIGN
     C/COPY ZSRSRC,ZALIGNZ2
      /TITLE SR/ZDATE1
     C/COPY ZSRSRC,ZDATE1Z2
      /TITLE SR/ZSEDIT
     C/COPY ZSRSRC,ZSEDITZ3
      *                                                                   CSW003
      /TITLE SR/ZDATE2                                                    CSW003
     C/COPY ZSRSRC,ZDATE2Z2                                               CSW003
      *                                                                   CSW003
      /TITLE SR/ZEVCD                                                     CSW003
     C/COPY ZSRSRC,ZEVCDZ1                                                CSW003
      *                                                                   CSW003
      /TITLE SR/ZNCD                                                      CSW003
     C/COPY ZSRSRC,ZNCDZ3                                                 CSW003
      *                                                                   CSW003
      /TITLE SR/ZRATE                                                     CSW003
     C/COPY ZSRSRC,ZRATEZ1                                                CSW003
      *                                                                   CSW003
      /TITLE SR/ZACCR                                                     CSW003
     C/COPY ZSRSRC,ZACCRZ1                                                CSW003
      *                                                                   CSW003
      /TITLE SR/ZEDIT                                                     CSW003
     C/COPY ZSRSRC,ZEDITZ2                                                CSW003
      *                                                                   CSW003
      /TITLE SR/ZASIGN                                                    CSW003
     C/COPY ZSRSRC,ZASIGNZ2                                               CSW003
      *                                                                   CSW003
      /TITLE SR/ZDYYR                                                     CSW003
     C/COPY ZSRSRC,ZDYYRZ3                                                CSW003
      *                                                                   CSW003
      /TITLE SR/ZLCD                                                      CSW003
     C/COPY ZSRSRC,ZLCDZ1                                                            CSW003 MD057247
      *                                                                   CSW003
      /TITLE SR/ZDAYS                                                     CSW003
      /COPY ZSRSRC,ZDAYSZ2                                                CSW003
      *                                                                   CSW003
      /TITLE COMPILE-TIME ARRAYS
      ***
**  CPY@
(c) Finastra International Limited 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
0006001521029820444305904073650882610287117481320914670161311759219053
2051421975234362489726358278192928030741322023366335124365853804639507
40968424294389045351
**  VA0  - ALL NUMERIC CHARS
0123456789
**  VA1  - INSTRUCTIONS TYPE VALIDATIONS (ALPAHABETIC)
INTBRIEXT#####################
**  VA2  - CEDEL CODES VALIDATIONS (NUMERIC)
31  3141  414F  4F4T  4T51  51
5F  5F5T  5T61  616F  6F81  81
8A  8A8D  8D8M  8M############
**  VA3  - EUROCLEAR CODES VALIDATIONS (NUMERIC)
01 02 03 03C03K07 07C07K######
##############################
**  POWER8 - ARRAY OF POWERS FOR CURRENCY CONVERSION
00000001
00000010
00000100
00001000
00010000
00100000
01000000
10000000
