     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Depot Movements Ext Settles Audit')           *
      *****************************************************************
      *                                                               *
      *  Midas - Securities Trading Module
      *                                                               *
      *  SE1866 - DEPOT MOVEMENTS EXTENDED SETTLEMENTS AUDIT LIST     *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      *  Prev Amend No. AR580908           Date 21Jul10               *
      *                 CSW210             Date 04May10               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSW206E            Date 24Aug06               *
      *                 CSW206D            Date 24Aug06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 222727             Date 05Nov03               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CSE028             Date 06Jun01               *
      * Midas DBA 3.05 -----------------------------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CSE015             Date 06Dec99               *
      *                 CSE017             Date 20Oct99               *
      *                 CSE012             Date 16Aug99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CSW098             Date 07May98               *
      *                 CSW003             Date 23Apr96               *
      *                 S01445             DATE 04NOV93               *
      *                 S01401             DATE 16JUN93               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  MD046248 - Finastra Rebranding                               *
      *  AR580908 - Intermediary line should be 2 lines when CSW206 is*
      *             switched on. Remove tags on the report (Recompile)*
      *  CSW210 - SWIFT 2010 Changes                                  *
      *  CSW206E - Change Control for SWIFT 2006 Standard Changes     *
      *  CSW206D - Change Control for SWIFT 2006 Standard Changes     *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222727 - Release 5.0 errors  (Recompile)                     *
      *  CSE028 - Standing Settlement Instructions Enhancement.       *
      *  CSE015 - Forward Valued Depot Movements (Recompile)          *
      *  CSE017 - Cum/Ex Indicator on Depot Movements (Recompile)     *
      *  CSE012 - SE Depot Movement Narratives (Recompiled).          *
      *  CSW098 - SWIFT 98 changes. New fields added.                 *
      *  CSW003 - MT5xx Message Generation - Phase 2                  *
      *  S01445 - DEPOT MOVEMENT CHARGES ENHANCEMENT.                 *
      *           Recompiled due to changes in PF/DPTMVD.             *
      *  S01401 - MT5xx SWIFT Messages Feature: New program           *
      *                                                               *
      *****************************************************************
      *
     FDPTMVDJ4IF  E           K        DISK         KINFSR *PSSR
     FSE1866P1O   E                    PRINTER      KINFDS SPOOL1     UC
     F                                              KINFSR *PSSR
     FSE1866AUO   E                    PRINTER      KINFDS SPOOLU
     F                                              KINFSR *PSSR
     F/COPY WNCPYSRC,SE1866F001
      /TITLE FUNCTION OF INCICATORS
      *****************************************************************
      *                                                               *
      *  F U N C T I O N   O F   I N D I C A T O R S                  *
      *                                                               *
      *    11  - MULTIBRANCHING INDICATOR                             *
      *    15  - Print file, SE1866P1, has been opened at least once  *
      *    20  - Switchable feature CSW098 is on or date is greater   *   CSW098
      *          than 16 October 1998. Can also be error on call to   *   CSW098
      *          SWIFT98.                                             *   CSW098
      *    30  - Switchable feature CSW210 is ON or run date is       *                       CSW210
      *          greater than or equal to November 20, 2010           *                       CSW210
      *    31  - Switchable feature CSW210 is ON or run date is       *                       CSW210
      *          greater than or equal to November 20, 2010           *                       CSW210
      *    40  - MODE I          : AUDIT EXCEPTION                    *
      *    41  - MODE A          : AUDIT                              *
      *    42  - ALL OTHER MODES : FULL LIST                          *
      *    51  - CHANGE TYPE     : A - AMEND                          *
      *    52  - CHANGE TYPE     : I - INSERT                         *
      *    53  - CHANGE TYPE     : D - DELETE                         *
      *  60-69 - DPMV - MOVEMENT TYPE                                 *
      *    70  - Non-Display of 'Account for Charges' (if On).        *   CSW003
      *    74  - READ OF DPTMVDJ4                                     *
      *    79  - READ OF SECTY                                        *
      *                                                               *
      *    98  - Date Format: DDMMYY (off); MMDDYY (on)               *
      *  90-99 - Used by Standard Subroutines                         *
      *                                                               *
      *  U7+U8 - Database Error                                       *
      *                                                               *
      *****************************************************************
      /TITLE SUBROUTINE INDEX
      *****************************************************************
      *                                                               *
      *  S U B R O U T I N E   I N D E X                              *
      *                                                               *
      *  INIT   - Initial Processing                                  *
      *  PROCES - Perform Detail Processing                           *
      *  FORMAT - Format Output fields                                *
      *  AUDIT  - Run Control Process                                 *
      *                                                               *
      *  *PSSR  - Program error handling routine                      *
      *                                                               *
      *  ZDATE2 - Dayno to date conversion                            *
      *  ZSEDIT - Edit numeric fields                                 *
      *                                                               *
      *****************************************************************
     E/TITLE E-SPECIFICATIONS
     E                    CPY@    1   1 80
      ***  Array for Object Copyright Statement.
      *
     E/COPY ZSRSRC,ZDATE2Z1
      *
     E/COPY ZSRSRC,ZSEDITZ1
     E/COPY WNCPYSRC,SE1866E001
     I/TITLE I-SPECIFICATIONS
     IRUNDAT      DS
      ***  Data Structure to obtain Multibranching Indicator.
     I                                       13  13 WMBIN
      *
     ISPOOL1      DS
      ***  File Information Data Structure for SE1866P1.
     I                                       83  92 SFILE1
     I                                    B 123 1240SFNUM1
      *
     ISPOOLU      DS
      ***  File Information Data Structure for SE1866AU.
     I                                       83  92 SFILEU
     I                                    B 123 1240SFNUMU
      *
     IDSFDY     E DSDSFDY
      ** First Data Structure for Access Objects
      *
     IDSSDY     E DSDSSDY
      ** Second Data Structure for Access Objects
      *
     ISDBANK    E DSSDBANKPD
      ** Bank Details
      *
     ISDCUST    E DSSDCUSTPD
      ** Customer Details
      *
     ISDBRCH    E DSSDBRCHPD
     I              QQDFAC                          #DFAC1                                    CGL029
      ** Branch Details
      *
     IDBERR       DS                            256
      * Data structure for data-base error processing.
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
      *
      ** PROGRAM STATUS DATA STRUCTURE
     I           SDS
     I                                      244 253 WSID
     I                                      254 263 USID
     ISCSARD    E DSSCSARDPD                                              CSW003
      ** Switchable Features                                              CSW003
      *                                                                   CSW003
     I/COPY ZSRSRC,ZSEDITZ2
     C/TITLE Main Processing
      *================================================================
      *  P R O G R A M     S T A R T                                  *
      *================================================================
      *
      ***  Perform Initialisation.
      *
     C                     EXSR INIT
      *
      ***  Perform Detail Processing.
      *
     C                     EXSR PROCES
      *
      *================================================================
      *  P R O G R A M     E N D                                      *
      *                                                               *
     C                     SETON                     LR
     C                     RETRN
      *                                                               *
      *================================================================
      /TITLE SR/INIT
      *****************************************************************
      *                                                               *
      *  INIT   - Subroutine to do Program Initialisation.            *
      *                                                               *
      *  Called By: Main Processing                                   *
      *  Calls    : None.                                             *
      *                                                               *
      *****************************************************************
      *
     C           INIT      BEGSR
      *
      ***  Copyright Statement.
     C                     MOVEACPY@      BIS@   80
      *
      ***  Accept Parameters.
      *
     C           *ENTRY    PLIST
     C                     PARM           PMODE   1
     C                     PARM           PSEQ    5
     C                     PARM           PBRCA   3
      *
      ** SET INDICATORS FOR REPORT HEADING & OPEN INPUT FILE
      **          MODE I          : AUDIT EXCEPTION
      **          MODE A          : AUDIT
      **          ALL OTHER MODES : FULL LIST
      *
     C           PMODE     IFEQ 'I'
     C                     SETON                     40
     C                     ELSE
     C           PMODE     IFEQ 'A'
     C                     SETON                     41
     C                     ELSE
     C                     SETON                     42
     C                     END
     C                     END
      *
      ***  Access Bank Details.
      *
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' WRTCD   7
     C                     PARM '*FIRST ' WOPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
     C*
     C           WRTCD     IFNE *BLANKS
     C                     Z-ADD001       DBASE            ***************
     C                     MOVEL'SDBANKPD'DBFILE           * DB ERROR 01 *
     C                     MOVE *BLANKS   DBKEY            ***************
     C                     EXSR *PSSR
     C                     END
      *                                                                   CSW003
      ** Check if (CSW003) MT5XX - Phase 2 Message Generation is on.      CSW003
     C                     CALL 'AOSARDR0'                                CSW003
     C                     PARM '*BLANKS' WRTCD   7                       CSW003
     C                     PARM '*VERIFY' WOPTN   7                       CSW003
     C                     PARM 'CSW003'  @SARD   6                       CSW003
     C           SCSARD    PARM SCSARD    DSFDY                           CSW003
      *                                                                   CSW003
     C           WRTCD     IFEQ *BLANKS                                   CSW003
      ** CSW003 on, therefore non-display 'Account For Charges' Field.    CSW003
     C                     MOVE *ON       *IN70                           CSW003
     C                     ENDIF                                          CSW003
      *                                                                                       CSE028
      ** Check if CSE028 feature is installed                                                 CSE028
      *                                                                                       CSE028
     C                     MOVE 'N'       CSE028  1                                           CSE028
     C                     CALL 'AOSARDR0'                                                    CSE028
     C                     PARM '       ' WRTCD                                               CSE028
     C                     PARM '*VERIFY' WOPTN                                               CSE028
     C                     PARM 'CSE028'  @SARD                                               CSE028
     C           SCSARD    PARM SCSARD    DSFDY                                               CSE028
      *                                                                                       CSE028
     C           WRTCD     IFNE *BLANKS                                                       CSE028
     C           WRTCD     ANDNE'*NRF   '                                                     CSE028
     C                     Z-ADD04        DBASE                                               CSE028
     C                     MOVEL'SE1866'  DBPGM                                               CSE028
     C                     MOVEL'SCSARDPD'DBFILE                                              CSE028
     C                     MOVEL@SARD     DBKEY                                               CSE028
     C                     EXSR *PSSR                                                         CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C           WRTCD     IFEQ *BLANK                                                        CSE028
     C                     MOVE 'Y'       CSE028                                              CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
      ** Check if SWIFT Changes 2006 (CSW206) is installed                                   CSW206E
      *                                                                                      CSW206E
     C                     CALL 'SWIF2006'                                                   CSW206E
     C                     PARM *BLANKS   RTNCD   7                                          CSW206E
      *                                                                                      CSW206E
     C           RTNCD     IFEQ 'CSW2006'                                                    CSW206E
     C                     MOVE 'Y'       CSW206  1                                          CSW206E
     C                     ELSE                                                              CSW206E
     C                     MOVE 'N'       CSW206                                             CSW206E
     C                     ENDIF                                                             CSW206E
      *                                                                                      CSW206E
     C/COPY WNCPYSRC,SE1866C001
      *
      ***  Check System Date Format, DDMMYY (*IN98 off)
      ***                            MMDDYY (*IN98 on).
      *
     C           BJDFIN    IFEQ 'M'
     C                     SETON                     98
     C                     END
      *
     C                     MOVE BJMRDT    RRDATE
     C                     MOVE BJURPT    RRTITL
      *
      ***  Access RUNDAT Data Area for Multi-Branching Indicator.
      *
     C           *NAMVAR   DEFN           RUNDAT
     C                     IN   RUNDAT
     C           WMBIN     IFEQ 'Y'
     C                     SETON                     11
     C                     END
      *                                                                   CSW098
      ** Check to see if switchable feature CSW098 is on or if date is    CSW098
      ** greater than 16 October 1998.                                    CSW098
     C                     CALL 'SWIFT98'              20                 CSW098
     C                     PARM           SWRTN   7                       CSW098
      *                                                                   CSW098
     C           *IN20     IFEQ *ON                        ***************CSW098
     C                     MOVEL'03'      DBASE            * DB ERROR 03 *CSW098
     C                     MOVEL'SE1866'  DBPGM            ***************CSW098
     C                     MOVEL'ERR CALL'DBFILE                          CSW098
     C                     MOVEL'SWIFT98' DBKEY                           CSW098
     C                     EXSR *PSSR                                     CSW098
     C                     ENDIF                                          CSW098
      *                                                                   CSW098
     C                     CALL 'SWIF2010'             13                                     CSW210
     C                     PARM *BLANKS   RTNCD                                               CSW210
      *                                                                                       CSW210
     C           *IN13     IFEQ *ON                                                           CSW210
     C                     Z-ADD5         DBASE                                               CSW210
     C                     MOVEL'SE1866'  DBPGM                                               CSW210
     C                     MOVEL'SWIF2010'DBFILE                                              CSW210
     C                     MOVEL'*CALL'   DBKEY                                               CSW210
     C                     EXSR *PSSR                                                         CSW210
     C                     ELSE                                                               CSW210
     C           RTNCD     IFEQ 'CSW2010'                                                     CSW210
     C                     MOVE 'Y'       CSW210  1                                           CSW210
     C                     ELSE                                                               CSW210
     C                     MOVE 'N'       CSW210                                              CSW210
     C                     ENDIF                                                              CSW210
     C                     ENDIF                                                              CSW210
      *
      ***  DEFINE WORK FIELDS
      *
     C           *LIKE     DEFN BBCUST    WWTCNR
     C           *LIKE     DEFN A8BRCD    WWDPBA
     C           *LIKE     DEFN A8BRCD    WWLAST
      *
     C                     MOVE *BLANKS   WWLAST
      *
      ** INITIALISE 'NO. OF LIVE RECORDS' COUNTER
     C                     Z-ADD0         WWLIVE 150
      *
      ** INITIALISE 'TOTAL NO. OF TRADE TRANSACTIONS' COUNTER
     C                     Z-ADD0         WWTRAD 150
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/PROCES
      *****************************************************************
      *                                                               *
      *  PROCES - Subroutine to do the Detail Processing.             *
      *                                                               *
      *  Called By: Main Processing                                   *
      *  Calls: FORMAT, AUDIT                                         *
      *                                                               *
      *****************************************************************
      *
     C           PROCES    BEGSR
      *
      ***  If Multibranching and Branch selected, Set Start Position.
      *
     C           WMBIN     IFEQ 'Y'
     C           PBRCA     ANDNE'ALL'
     C                     MOVE PBRCA     DPBA
     C           DPBA      SETLLDPTMVDJ4
     C                     ENDIF
      *
     C                     READ DPTMVDJ4                 74
     C                     MOVE DPBA      WWDPBA
      *
      ***  If Multibranching and Branch selected, check same Branch.
      *
     C           *IN74     IFEQ '0'
     C           WMBIN     ANDEQ'Y'
     C           PBRCA     ANDNE'ALL'
     C           DPBA      ANDNEPBRCA
     C                     SETON                     74
     C                     ENDIF
      *
      ***  Process until End of valid records.
      *
     C           *IN74     DOWEQ'0'
      *
      ** FORMAT DETAIL LINE & OUTPUT
     C                     EXSR FORMAT
      *
      ** READ NEXT RECORD
     C                     READ DPTMVDJ4                 74
     C                     MOVE DPBA      WWDPBA
      *
      ***  If Multibranching and Branch selected, check same Branch.
      *
     C           *IN74     IFEQ '0'
     C           WMBIN     ANDEQ'Y'
     C           PBRCA     ANDNE'ALL'
     C           DPBA      ANDNEPBRCA
     C                     SETON                     74
     C                     ENDIF
      *
     C                     END
      *
      ** If print file open then right 'End of Report' and close file
     C           *IN15     IFEQ '1'
     C                     WRITETRAILP1
     C                     CLOSESE1866P1
     C                     END
      *
      ** OUTPUT RUN CONTROL REPORT
     C                     EXSR AUDIT
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/FORMAT
      *****************************************************************
      *                                                               *
      *  FORMAT - Subroutine to Set Up and Write fields to Report.    *
      *                                                               *
      *  Called By: PROCES                                            *
      *  Calls: ZSEDIT, ZDATE2                                        *
      *                                                               *
      *****************************************************************
      *
     C           FORMAT    BEGSR
      *
     C           SWRTN     IFEQ 'CSW098 '                                 CSW098
     C                     MOVE *ON       *IN20                           CSW098
     C                     ELSE                                           CSW098
     C                     MOVE *OFF      *IN20                           CSW098
     C                     ENDIF                                          CSW098
     C           CSW206    IFEQ 'Y'                                                          CSW206E
     C                     MOVE *ON       *IN88                                              CSW206E
     C                     ELSE                                                              CSW206E
     C                     MOVE *OFF      *IN88                                              CSW206E
     C                     ENDIF                                                             CSW206E
      ** MAINTAIN 'LIVE' COUNT ONLY IF RECORD NOT DELETED
     C           RECI      IFNE '*'
     C                     ADD  1         WWLIVE
     C                     END
      *
      ** 'A' MODE - ** AUDIT ** OR 'I' MODE - ** AUDIT EXCEPTION **
     C           PMODE     IFEQ 'A'
     C           PMODE     OREQ 'I'
     C           LCD       IFNE BJRDNB
     C                     GOTO FOREND
     C                     END
      ** 'L' MODE - ** FULL LIST **
     C                     ELSE
     C           RECI      IFEQ '*'
     C                     GOTO FOREND
     C                     END
     C                     END
      *
      ** MAINTAIN 'TOTAL NO. OF TRADE TRANSACTIONS' COUNTER
     C                     ADD  1         WWTRAD
      *
      ** LAST CHANGE DATE AND ACTION
     C                     Z-ADDLCD       ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    RRZLCD
      *
     C                     SETOF                     515253
      *
     C                     SELEC
     C           CHTP      WHEQ 'A'
     C                     SETON                     51
     C           CHTP      WHEQ 'I'
     C                     SETON                     52
     C           CHTP      WHEQ 'D'
     C                     SETON                     53
     C                     ENDSL
      *
      ** FORMAT FIELDS
      *
     C                     MOVE DPSS      RRDPSS
     C                     MOVE DPRN      RRDPRN
     C                     MOVE DPID      RRDPID
     C                     MOVE *BLANKS   RRDPIR
      *
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   WRTCD
     C                     PARM '*KEY   ' WOPTN
     C                     PARM RRDPID    WCUST  10
     C                     PARM *BLANKS   WKYST   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           WRTCD     IFEQ '0'
     C                     MOVE BBCSSN    RRDPIR
     C                     END
      *
     C                     MOVE DPOD      RRDPOD
     C                     MOVE *BLANKS   RRDPOR
      *
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   WRTCD
     C                     PARM '*KEY   ' WOPTN
     C                     PARM RRDPOD    WCUST  10
     C                     PARM *BLANKS   WKYST   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           WRTCD     IFEQ '0'
     C                     MOVE BBCSSN    RRDPOR
     C                     END
      *
     C                     MOVE DPBN      RRDPBN
     C                     MOVE *BLANKS   RRDPBR
      *
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   WRTCD
     C                     PARM '*KEY   ' WOPTN
     C                     PARM RRDPBN    WCUST  10
     C                     PARM *BLANKS   WKYST   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           WRTCD     IFEQ '0'
     C                     MOVE BBCSSN    RRDPBR
     C                     END
      *
     C                     MOVE *BLANKS   RRDPMD
     C           DPMD      IFNE 0
     C                     Z-ADDDPMD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    RRDPMD
     C                     END
      *
     C                     MOVE *BLANKS   RRDPDO
     C           DPDO      IFNE 0
     C                     Z-ADDDPDO      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    RRDPDO
     C                     END
      *
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE DPNA      ZFLD15
     C                     Z-ADD0         ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE *BLANKS   RRDPNA
     C                     MOVEAZS2,Z2    RRDPNA
      *
     C                     SETOF                     606162
     C                     SETOF                     636465
     C                     SETOF                     666869
     C           DPMV      IFEQ 'WI'
     C                     SETON                     60
     C                     ELSE
     C           DPMV      IFEQ 'WO'
     C                     SETON                     61
     C                     ELSE
     C           DPMV      IFEQ 'DT'
     C                     SETON                     62
     C                     ELSE
     C           DPMV      IFEQ 'BL'
     C                     SETON                     63
     C                     ELSE
     C           DPMV      IFEQ 'BB'
     C                     SETON                     64
     C                     ELSE
     C           DPMV      IFEQ 'RP'
     C                     SETON                     65
     C                     ELSE
     C           DPMV      IFEQ 'RR'
     C                     SETON                     66
     C                     ELSE
     C           DPMV      IFEQ 'PD'
     C                     SETON                     68
     C                     ELSE
     C           DPMV      IFEQ 'PL'
     C                     SETON                     69
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
      *
     C                     MOVE DPAD      RRDPAD
     C/COPY WNCPYSRC,SE1866C004
      *
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE MKTP      ZFLD15
     C                     Z-ADD8         ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE *BLANKS   RRMKTP
     C                     MOVEAZS2,Z2    RRMKTP
      *
      ** EXTENDED SETTLEMENT DETAILS
     C           D2AFPN    IFNE *BLANKS
     C                     MOVELD2AFPN    WKAFPN  6
      *
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   WRTCD
     C                     PARM '*KEY   ' WOPTN
     C                     PARM WKAFPN    WCUST  10
     C                     PARM *BLANKS   WKYST   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           WRTCD     IFEQ '0'
     C                     MOVE BBCSSN    RRAFPN
     C                     ELSE
     C                     MOVE D2AFPN    RRAFPN
     C                     END
     C                     END
      *
     C           D2AWIN    IFNE *BLANKS
     C                     MOVELD2AWIN    WKAWIN  6
      *
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   WRTCD
     C                     PARM '*KEY   ' WOPTN
     C                     PARM WKAWIN    WCUST  10
     C                     PARM *BLANKS   WKYST   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           WRTCD     IFEQ '0'
     C                     MOVE BBCSSN    RRAWIN
     C                     ELSE
     C                     MOVE D2AWIN    RRAWIN
     C                     END
     C                     END
      *
     C           D2BOFN    IFNE *BLANKS
     C                     MOVELD2BOFN    WKBOFN  6
      *
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   WRTCD
     C                     PARM '*KEY   ' WOPTN
     C                     PARM WKBOFN    WCUST  10
     C                     PARM *BLANKS   WKYST   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           WRTCD     IFEQ '0'
     C                     MOVE BBCSSN    RRBOFN
     C                     ELSE
     C                     MOVE D2BOFN    RRBOFN
     C                     END
     C                     END
      *
     C           D2IPYN    IFNE *BLANKS
     C                     MOVELD2IPYN    WKIPYN  6
      *
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   WRTCD
     C                     PARM '*KEY   ' WOPTN
     C                     PARM WKIPYN    WCUST  10
     C                     PARM *BLANKS   WKYST   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           WRTCD     IFEQ '0'
     C                     MOVE BBCSSN    RRIPYN
     C                     ELSE
     C                     MOVE D2IPYN    RRIPYN
     C                     END
     C                     END
      *
     C           SWRTN     IFNE 'CSW098 '                                 CSW098
     C                     MOVE *BLANKS   RRINVE                          CSW098
      *                                                                   CSW098
     C           D2CTYN    IFNE *BLANKS
     C                     MOVELD2CTYN    WKCTYN  6
      *
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   WRTCD
     C                     PARM '*KEY   ' WOPTN
     C                     PARM WKCTYN    WCUST  10
     C                     PARM *BLANKS   WKYST   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           WRTCD     IFEQ '0'
     C                     MOVE BBCSSN    RRCTYN
     C                     ELSE
     C                     MOVE D2CTYN    RRCTYN
     C                     END
     C                     END
      *
     C                     ELSE                                           CSW098
     C                     MOVE *BLANKS   RRCTYN                          CSW098
     C*                                                                   CSW098
     C           D2INVE    IFNE *BLANKS                                   CSW098
     C                     CALL 'AOCUSTR0'                                CSW098
     C                     PARM '*DBERR ' WRTCD                           CSW098
     C                     PARM '*KEY   ' WOPTN                           CSW098
     C                     PARM D2INVE    WCUST  10                       CSW098
     C                     PARM *BLANKS   WKYST   7                       CSW098
     C           SDCUST    PARM SDCUST    DSSDY                           CSW098
     C           WRTCD     IFEQ *BLANK                                    CSW098
     C                     MOVE BBCSSN    RRINVE                          CSW098
     C                     ELSE                                           CSW098
     C                     MOVE D2INVE    RRINVE                          CSW098
     C                     ENDIF                                          CSW098
     C                     ENDIF                                          CSW098
      *                                                                   CSW098
     C                     ENDIF                                          CSW098
      *                                                                   CSW098
     C           D2SKAN    IFNE *BLANKS
     C                     MOVELD2SKAN    WKSKAN  6
      *
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   WRTCD
     C                     PARM '*KEY   ' WOPTN
     C                     PARM WKSKAN    WCUST  10
     C                     PARM *BLANKS   WKYST   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           WRTCD     IFEQ '0'
     C                     MOVE BBCSSN    RRSKAN
     C                     ELSE
     C                     MOVE D2SKAN    RRSKAN
     C                     END
     C                     END
      *
     C           D2RSSN    IFNE *BLANKS
     C                     MOVELD2RSSN    WKRSSN  6
      *
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   WRTCD
     C                     PARM '*KEY   ' WOPTN
     C                     PARM WKRSSN    WCUST  10
     C                     PARM *BLANKS   WKYST   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           WRTCD     IFEQ '0'
     C                     MOVE BBCSSN    RRRSSN
     C                     ELSE
     C                     MOVE D2RSSN    RRRSSN
     C                     END
     C                     END
      *
     C           D2DSSN    IFNE *BLANKS
     C                     MOVELD2DSSN    WKDSSN  6
      *
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   WRTCD
     C                     PARM '*KEY   ' WOPTN
     C                     PARM WKDSSN    WCUST  10
     C                     PARM *BLANKS   WKYST   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           WRTCD     IFEQ '0'
     C                     MOVE BBCSSN    RRDSSN
     C                     ELSE
     C                     MOVE D2DSSN    RRDSSN
     C                     END
     C                     END
      *
     C           D2BSSN    IFNE *BLANKS
     C                     MOVELD2BSSN    WKBSSN  6
      *
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   WRTCD
     C                     PARM '*KEY   ' WOPTN
     C                     PARM WKBSSN    WCUST  10
     C                     PARM *BLANKS   WKYST   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           WRTCD     IFEQ '0'
     C                     MOVE BBCSSN    RRBSSN
     C                     ELSE
     C                     MOVE D2BSSN    RRBSSN
     C                     END
     C                     END
      *
     C                     MOVE D2AFPL    RRAFPL
     C                     MOVE D2AWIA    RRAWIA
     C                     MOVE D2AWIL    RRAWIL
     C                     MOVE D2BOFA    RRBOFA
     C                     MOVE D2BOF1    RRBOF1
     C                     MOVE D2BOF2    RRBOF2
     C                     MOVE D2ACL1    RRACL1
     C                     MOVE D2ACL2    RRACL2
     C                     MOVE D2SRL1    RRSRL1
     C                     MOVE D2SRL2    RRSRL2
     C                     MOVE D2SRL3    RRSRL3
     C                     MOVE D2FIN1    RRFIN1
     C                     MOVE D2FIN2    RRFIN2
     C                     MOVE D2RED1    RRRED1
     C                     MOVE D2RED2    RRRED2
     C                     MOVE D2NAL1    RRNAL1
     C                     MOVE D2NAL2    RRNAL2
     C                     MOVE D2IPYL    RRIPYL
      *                                                                   CSW098
     C           SWRTN     IFNE 'CSW098 '                                 CSW098
     C                     MOVE D2CTYL    RRCTYL
     C                     ELSE                                           CSW098
     C                     MOVE *BLANKS   RRCTYL                          CSW098
     C                     ENDIF                                          CSW098
      *                                                                   CSW098
     C                     MOVE D2SKAL    RRSKAL
     C                     MOVE D2CCTN    RRCCTN
     C/COPY WNCPYSRC,SE1866C002
     C                     MOVE D2DCTL    RRDCTL
     C/COPY WNCPYSRC,SE1866C003
     C                     MOVE D2RSSA    RRRSSA
     C                     MOVE D2RSS1    RRRSS1
     C                     MOVE D2RSS2    RRRSS2
     C                     MOVE D2RSS3    RRRSS3
     C                     MOVE D2RSS4    RRRSS4
     C                     MOVE D2DSSA    RRDSSA
     C                     MOVE D2DSS1    RRDSS1
     C                     MOVE D2DSS2    RRDSS2
     C                     MOVE D2DSS3    RRDSS3
     C                     MOVE D2DSS4    RRDSS4
     C                     MOVE D2BSSA    RRBSSA
     C                     MOVE D2BSS1    RRBSS1
     C                     MOVE D2BSS2    RRBSS2
      *                                                                                       CSE028
      ** Move file fields introduced by CSE028 to report fields                               CSE028
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
     C                     MOVE D2IMD1    RRIMD1                                              CSE028
     C                     MOVE D2IMD2    RRIMD2                                              CSE028
     C**********           MOVE D2IMD3    RRIMD3                                      CSE028 CSW206D
     C**********           MOVE D2IMD4    RRIMD4                                      CSE028 CSW206D
     C**********           MOVE D2IMD5    RRIMD5                                      CSE028 CSW206D
     C**********           MOVE D2IMD6    RRIMD6                                      CSE028 CSW206D
     C**********           MOVE D2IMD7    RRIMD7                                      CSE028 CSW206D
     C**********           MOVE D2IMD8    RRIMD8                                      CSE028 CSW206D
     C**********           MOVE D2IMD9    RRIMD9                                      CSE028 CSW206D
     C           CSW206    IFEQ 'N'                                                          CSW206E
     C                     MOVE D2IMD3    RRIMD3                                             CSW206E
     C                     MOVE D2IMD4    RRIMD4                                             CSW206E
     C                     MOVE D2IMD5    RRIMD5                                             CSW206E
     C                     MOVE D2IMD6    RRIMD6                                             CSW206E
     C                     MOVE D2IMD7    RRIMD7                                             CSW206E
     C                     MOVE D2IMD8    RRIMD8                                             CSW206E
     C                     MOVE D2IMD9    RRIMD9                                             CSW206E
     C                     ENDIF                                                             CSW206E
     C                     MOVE D2IMS1    RRIMS1                                              CSE028
     C                     MOVE D2IMS2    RRIMS2                                              CSE028
     C**********           MOVE D2IMS3    RRIMS3                                      CSE028 CSW206D
     C**********           MOVE D2IMS4    RRIMS4                                      CSE028 CSW206D
     C**********           MOVE D2IMS5    RRIMS5                                      CSE028 CSW206D
     C**********           MOVE D2IMS6    RRIMS6                                      CSE028 CSW206D
     C**********           MOVE D2IMS7    RRIMS7                                      CSE028 CSW206D
     C**********           MOVE D2IMS8    RRIMS8                                      CSE028 CSW206D
     C**********           MOVE D2IMS9    RRIMS9                                      CSE028 CSW206D
     C           CSW206    IFEQ 'N'                                                          CSW206E
     C                     MOVE D2IMS3    RRIMS3                                             CSW206E
     C                     MOVE D2IMS4    RRIMS4                                             CSW206E
     C                     MOVE D2IMS5    RRIMS5                                             CSW206E
     C                     MOVE D2IMS6    RRIMS6                                             CSW206E
     C                     MOVE D2IMS7    RRIMS7                                             CSW206E
     C                     MOVE D2IMS8    RRIMS8                                             CSW206E
     C                     MOVE D2IMS9    RRIMS9                                             CSW206E
     C                     ENDIF                                                             CSW206E
     C                     MOVE D2PSET    RRPSET                                              CSE028
     C                     MOVE D2NAC1    RRNAC1                                              CSE028
     C                     MOVE D2NAC2    RRNAC2                                              CSE028
     C                     ENDIF                                                              CSE028
      *
      ***  If change of Branch open new print file;
      ***  (if previous print file opened write 'End of Report' and
      ***  close print file before opening new one).
      *
     C           WWDPBA    IFNE WWLAST
      *
     C           *IN15     IFEQ '1'
     C                     WRITETRAILP1
     C                     CLOSESE1866P1
     C                     END
      *
     C                     OPEN SE1866P1
     C                     MOVE '1'       *IN15
      *
     C                     Z-ADDSFNUM1    ZSNUM   60
     C                     CALL 'ZSFILE'
     C                     PARM           PSEQ
     C                     PARM WWDPBA    WPARM   3
     C                     PARM           SFILE1
     C                     PARM           ZSNUM
     C                     PARM           ZSERR   1
      *
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
      *
      **  Store old Branch and access new Branch Details.
     C                     MOVE DPBA      WWLAST
     C                     MOVE WWDPBA    RRDPBA
      *
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' WRTCD
     C                     PARM '*KEY   ' WOPTN
     C                     PARM WWDPBA    WBRCA   3
     C********** SDBRCH    PARM SDBRCH    DSFDY                                               CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *
     C           WRTCD     IFNE *BLANKS
     C                     Z-ADD002       DBASE            ***************
     C                     MOVEL'SDBRCHPD'DBFILE           * DB ERROR 02 *
     C                     MOVE *BLANKS   DBKEY            ***************
     C                     EXSR *PSSR
     C                     END
      *
     C                     MOVE A8BRNM    RRBRNM
      *
      ***  save current branch and name to restore next time if needed
     C                     MOVE RRDPBA    WRDPBA  3
     C                     MOVE RRBRNM    WRBRNM 30
      *
      ***  else not a different branch so restore previous branch/name
     C                     ELSE
     C                     MOVE WRDPBA    RRDPBA  3
     C                     MOVE WRBRNM    RRBRNM 30
     C                     END
      *                                                                                       CSW210
      ** Swift 2010 changes                                                                   CSW210
      *                                                                                       CSW210
     C           CSW210    IFEQ 'Y'                                                           CSW210
      *                                                                                       CSW210
     C                     MOVEA'11'      *IN,30                                              CSW210
      *                                                                                       CSW210
     C                     MOVELD2DIDN    R2DIDN    P                                         CSW210
     C                     MOVELD2DLIN    R2DLIN    P                                         CSW210
     C                     MOVELD2DAD1    R2DAD1    P                                         CSW210
     C                     MOVELD2DAD2    R2DAD2    P                                         CSW210
     C                     MOVELD2DAD3    R2DAD3    P                                         CSW210
     C                     MOVELD2DAD4    R2DAD4    P                                         CSW210
     C                     MOVELD2PCLR    R2PCLR    P                                         CSW210
     C                     MOVELD2QFIN    R2QFIN    P                                         CSW210
      *                                                                                       CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSW210
      *
      ** PRINT PAGE HEADINGS
     C                     WRITEHEADP1
      *
      ** OUPUT DETAIL LINE
     C                     WRITEDETAIL
     C                     CLEARDETAIL
      *
     C           CSE028    IFEQ 'Y'                                                           CSE028
     C           SWRTN     IFEQ 'CSW098 '                                                     CSW210
     C                     MOVEL'1'       *IN20                                               CSW210
     C                     ENDIF                                                              CSW210
     C                     WRITEHEADP1                                                        CSE028
     C                     WRITEDETAIL2                                                       CSE028
     C                     CLEARDETAIL2                                                       CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C           FOREND    TAG
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/AUDIT
      *****************************************************************
      *                                                               *
      *  AUDIT  - Subroutine to Ouput Run Control Report.             *
      *                                                               *
      *  Called By: PROCES                                            *
      *  Calls: None.                                                 *
      *                                                               *
      *****************************************************************
      *
     C           AUDIT     BEGSR
      *
     C                     Z-ADDSFNUMU    ZSNUM   60
     C                     CALL 'ZSFILE'
     C                     PARM           PSEQ
     C                     PARM *BLANKS   WPARM
     C                     PARM           SFILEU
     C                     PARM           ZSNUM
     C                     PARM           ZSERR   1
      *
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
      *
      ** WRITE HEADINGS
     C                     WRITEHEADAU
      *
      ** OUTPUT NO. OF LIVE RECORDS
     C                     Z-ADDWWLIVE    RRLIVE
     C                     WRITECONTROLR
      *
      ***  If there is a DB Error, Output the DB Error Information.
     C           *INU7     IFEQ '1'
     C                     WRITEDBERROR
     C                     ELSE
      *
      ***  Or, if no valid records read, Output "No Details" message.
     C           WWLAST    IFEQ *BLANKS
     C                     WRITENONE
     C                     END
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/*PSSR
      *****************************************************************
      *                                                               *
      *  *PSSR  - Program Error Processing Subroutine.                *
      *                                                               *
      *  Called By: Various                                           *
      *  Calls: AUDIT
      *                                                               *
      *****************************************************************
      *
     C           *PSSR     BEGSR                           *** *PSSR  ***
      *
      ***  Check to see that *PSSR has not already been called.
     C           WRUN      IFEQ *BLANK
     C                     MOVE 'Y'       WRUN    1
     C                     MOVEL'SE1866'  DBPGM
      *
     C           *NAMVAR   DEFN LDA       WLDA  256
     C           *LOCK     IN   WLDA
     C                     MOVELDBERR     WLDA
     C                     OUT  WLDA
     C                     SETON                     U7U8LR
      *
     C                     EXSR AUDIT
      *
     C                     DUMP
     C                     END
      *
      ** Exit program
     C                     RETRN
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/ZDATE2
     C/COPY ZSRSRC,ZDATE2Z4
      /TITLE SR/ZSEDIT
     C/COPY ZSRSRC,ZSEDITZ3
      /TITLE COMPILE-TIME ARRAYS
      ***
**  CPY@
(c) Finastra International Limited 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
     X/COPY WNCPYSRC,SE1866X001
