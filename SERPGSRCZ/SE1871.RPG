     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Trades extract for settlements')              *
      *****************************************************************
      *                                                               *
      *  Midas - Securities Trading Module                            *
      *                                                               *
      *  SE1871 - TRADES EXTRACT FOR SETTLEMENTS MESSAGES             *
      *                                                               *
      *  Function: Extract details required for S.W.I.F.T. Trade      *
      *   (I/C)    Settlement Messages for Complete Trades that were  *
      *   (COB)    Input, Amended or Cancelled Today.                 *
      *                                                               *
      *  Called by: SEC3305 - Pay/Receive Telexes Input cycle         *
      *                       processing.                             *
      *             Frequency: On Request in Input Cycle              *
      *                                                               *
      *             SEC0603 - Pay/Receive Telexes                     *
      *             Frequency: Automatically in Close of Business     *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      *  Prev Amend No. CSW216             Date 14Mar16               *
      *                 AR864763           Date 11May16               *
      *                 CSW214             Date 25Nov14               *
      *                 261600             Date 19Aug14               *
      *                 CFT050             Date 03Jun13               *
      *                 AR571692           Date 05Sep12               *
      *                 AR589164A          Date 16Aug10               *
      *                 AR589164           Date 13Aug10               *
      *                 CSW210             Date 04May10               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 BUG24512           Date 24Jun09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 BUG20102           Date 15Aug08               *
      *                 CSW208             Date 15Apr08               *
      *                 CSW207A            Date 08Aug07               *
      *                 CSW207             Date 08Jun07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG10692           Date 27Feb06               *
      *                 CSE071             Date 19Jul05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3122            Date 17Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 CSE035             Date 22Apr02               *
      *                 210796             Date 27Jan03               *
      *                 206316             Date 19Jul02               *
      *                 215888             Date 10Jun03               *
      * Midas Release 4.01.01 ----------------------------------------*
      *                 CSW202             Date 20May02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 205141             Date 21May02               *
      *                 CSW025             Date 26Mar02               *
      *                 204220             Date 22Mar02               *
      *                 CSE033             Date 19Mar02               *
      *                 CSE031             Date 09Nov01               *
      *                 180707             Date 25Jul00               *
      *                 192221             Date 26Nov01               *
      *                 200292             Date 16Oct01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 183583             Date 25Jun01               *
      *                 CSE029             Date 24Jul01               *
      *                 CSE022             Date 29Mar01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 176345             Date 05Feb01               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 130862             Date 18Oct98               *
      *                 CEU005             Date 05Feb98               *
      *                 121633             Date 03Mar98               *
      *                 113207             DATE 03MAR98               *
      *                 117357             DATE 20FEB98               *
      *                 121645             DATE 17FEB98               *
      *                 121495             DATE 17FEB98               *
      *                 125568             DATE 17FEB98               *
      *                 CSE005             DATE 04FEB97               *
      *                 089115             DATE 21AUG96               *
      *                 104331             DATE 10JUN96               *
      *                 104032             DATE 06JUN96               *
      *                 103852             DATE 30MAY96               *
      *                 093758             DATE 10MAY96               *
      *                 073848             DATE 08MAY96               *
      *                 102916             DATE 08MAY96               *
      *                 078256             DATE 07MAY96               *
      *                 092272             DATE 02MAY96               *
      *                 089451             DATE 02MAY96               *
      *                 CSW003             DATE 08JAN96               *
      *                 094335             DATE 21NOV95               *
      *                 100017             DATE 18APR96               *
      *                 090054             DATE 05JUL95               *
      *                 089961             DATE 25OCT95               *
      *                 092961             DATE 04OCT95               *
      *                 087827             DATE 19MAY95               *
      *                 086491             DATE 15JUN95               *
      *                 085326             DATE 11APR95               *
      *                 085245             DATE 11APR95               *
      *                 066915             DATE 14FEB94               *
      *                 S01401             DATE 16JUN93               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  MD046248 - Finastra Rebranding                               *
      *  CSW216 - SWIFT Changes 2016 (Recompile)                      *
      *  AR864763 - SEC0603 failed during COB. Flag as not MiFID      *
      *             compliant when location code of the branch is     *
      *             blank. (Child: AR864764)                          *
      *           - Applied for MD-37893.                             *
      *  CSW214 - SWIFT Changes 2014 (Recompile)                      *
      *  261600 - Iniitalise WCUST before call to AOCSSWR0.           *
      *  CFT050 - SWIFTRef Directories upload (Recompile)             *
      *  AR571692 - COB: FTC0240, FTC0250, FTC0510, FTC0520, GLC0802C *
      *             Fails. DB error in SE1871AU due to a deleted      *
      *             nostro. Do not process records with RECI = '*' if *
      *             record has already been transferred to the        *
      *             historic file. (Child: AR571693)                  *
      *  AR589164A - Additional fix to cater //XX input               *
      *  AR589164 - Additional fix to cater //XX input                *
      *  CSW210 - SWIFT 2010 Changes                                  *
      *  BUG24512 - Applied 255950 changes.                           *
      *  BUG20102 - Value in field 98 of the generated MT518 and      *
      *             MT541 is different. It should be the same.        *
      *  CSW208 - SWIFT 2008 Changes                                  *
      *  CSW207A - SWIFT 2007 Changes                                 *
      *  CSW207 - SWIFT 2007 Changes                                  *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  BUG10692- For Clearance Type 1-4, there is not neede to      *
      *            check customer classification.                     *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3122 - Recompiled due to changes in SDSECSPD.             *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CSE035 - NX/NNX Coupon Payment Processing.                   *
      *  210796 - Extend Our a/c at Nostro field                      *
      *  206316 - Recompiled over changed ZLCDZ1.                     *
      *  215888 - SEC0603 DBErr 006, when system tries to access      *
      *           customer details of Depot 3 - Kassenverein.         *
      *           Fix is to call AOCUSTR0 only if Depot 3 is not      *
      *           blank.                                              *
      *  CSW202 - SWIFT 2002 Standards Update                         *
      *  205141 - Initialise WCUST before use.                        *
      *  CSW025 - Midas Message Manager                               *
      *           - Pass original change type                         *
      *  204220 - MT520is still being generated for ISO15022.         *
      *  CSE033 - ISO15022 message generation (Using ME module)       *
      *  CSE031 - Coupon Fixing for Floating Rate Notes.              *
      *           (recompilation due to change to ZNCD/ZLCD)          *
      *  180707 - No Position Settlements generated. Recompile over   *
      *           changes in /COPY ZNCDZ3.                            *
      *  192221 - Extract the other detail lines of the Deliverer &   *
      *           Receiver of Securities (detail lines 2 to 4) from   *
      *           the Trade Extended Settlement details.              *
      *  200292 - Use SWIFT currency code for output to MGISOTPD.     *
      *           Additional field added to MGISOTPD and MGISODPD     *
      *  183583 - Add extension file MGOEXTPD to store customer no.   *
      *           of field with SWIFT address.                        *
      *  CSE029 - ISO15022 message generation                         *
      *  CSE022 - Depository Definition Enhancement                   *
      *  176345 - Database error 011 file SDNOSTPD.                   *
      *  130862 - Recompiled over ZLCDZ1 & ZDAYSZ2 changes.           *
      *  CEU005 - EMU SE Settlement Ccy Conversion, insertion of      *
      *           'In' Currency processing.                           *
      *  121633 - ISIN number being omitted from non-Federal Reserve  *
      *           messages                                            *
      *  113207 - For clearance type 2 or 4 the system should format  *
      *           the clearing correspondent (field :84A:) with the   *
      *           counterparty depot reference number.                *
      *           (ie. For 'TP' use "Deliver from" and for 'TS' use   *
      *                "Deliver to".)                                 *
      *  117357 - Call AOBRCHR0 for fix 89451 should only be done     *
      *           if PYTA is not blank.                               *
      *  121645 - Nominal Places invalid for Cedel cancellations.     *
      *  121495 - CACLAS field only setup for record type T1WHEN='B'; *
      *           setup also this field for other record type;        *
      *           without this setup, tag 84 is wrongly generated.    *
      *  125568 - If days adjustement/Sign has been input for a trade *
      *           output it in the swift message else calculate it    *
      *           in the SR ZDAYSZ2.                                  *
      *  CSE005 - Effect of holidays on FRN Coupon Dates              *
      *           (recompilation due to change to ZNCD/ZLCD)          *
      *  089115 - Need to pass TDDT and MTYP to MG9500.               *
      *  104331 - Branch code is blank on MT580 Cedel cancellations   *
      *  104032 - Use value date of run date when backvaluation       *
      *  103852 - Field 88a: Beneficiary of secs fails to format      *
      *  093758 - MT580 not generated because "Field :58a: should     *
      *           be present when field :57a: is present".            *
      *           Instruction type used 61 --> correspond             *
      *           tp 1- Rec. Against Paym. Ext. Book Entry            *
      *              2- Rec. Against Paym. Ext. Phisical              *
      *           System default to Ext. Book for which field 57 &    *
      *           58 are both optional --> if problem to format one   *
      *           of these fields, initialise the other.              *
      *  073848 - Put the type in cancelatiom message                 * *
      *  102916 - Field :33T: requires the 'Price/Discount/Yield'     *
      *           data. (ref functional spec)                         *
      *  078256 - Output nominal dec places                           *
      *  092272 - If For Account of entered, the field :57A: has to be*
      *           filled in with Pay To instead of Pay From           *
      *  089451 - Beneficiary of money (:58x:) should be BICN of      *
      *           the settlement branch, instead of Pay From if corr  *
      *           field in ESSI is not filled in.                     *
      *  CSW003 - MT5xx Message Generation - Phase 2                  *
      *  094335 - MT5xx cancellation process fix                      *
      *  100017 - Position settlement unable to pick up day adj. on   *
      *           SECTYD. Change subroutine to use DADJN to stop      *
      *           interest day adjustment being used for amortisation.*
      *           Recompile over amended subroutine ZDAYS.            *
      *  090054 - Account with Institution (57A:) for MT521 should be *
      *           Counterparty Nostro.                                *
      *  089961 - Rec/Dly o  Sec(:87D:) should be Deliver To.         *
      *  092961 - Recompile over ZDAYSZ2 which was amended by 086491  *
      *           (Wrong number of days calculated for day basis 1    *
      *           when start or end day is last day of February)      *
      *  087827 - For Instruction Type = BRI (Bridge), do not         *
      *           remove the /XC or /XE From CEDEL or EUROCLEAR code  *
      *  086491 - Wrong nbr of days calculated for day basis 1        *
      *           when start or end day is last day of February       *
      *           Recompiled for ZSRSRC/ZDAYSZ2 changes.              *
      *  085326 - MT52x messages to Federal Reserve Bank of New York  *
      *           new requirement.                                    *
      *           The word 'CUSIP' is required to be used in field    *
      *           :35B for both US Treasury Bills and Treasury Notes. *
      *  085245 - MT52x messages to Federal Reserve Bank of New York  *
      *           It is required to use the CUSIP number not the ISIN/*
      *           Common code in field :35B. It also required to print*
      *           the word 'CUSIP' for US Treasury Bill but not for   *
      *           US Treasury Notes.                                  *
      *  066915 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
      *           to 10,9 by GEMS 052254.                             *
      *  S01401 - MT5xx SWIFT Messages Feature: New program. This     *
      *           change also includes S01412 (S.W.I.F.T. Sept. 1993  *
      *           Message Format Changes.)                            *
      *                                                               *
      *****************************************************************
      *
     FTRADSDJ4IF  E           K        DISK         KINFSR *PSSR
     FTRADSDY2IF  E           K        DISK         KINFSR *PSSR
     F/COPY WNCPYSRC,SE1871F002
     FTRAUT   IF  E           K        DISK
     FSECTY   IF  E           K        DISK         KINFSR *PSSR
     FSEMKC   IF  E           K        DISK         KINFSR *PSSR
     FINVTP   IF  E           K        DISK         KINFSR *PSSR
     FACNUM   IF  E           K        DISK         KINFSR *PSSR
     FSECET   IF  E           K        DISK         KINFSR *PSSR
     FTRADS   IF  E           K        DISK         KINFSR *PSSR
     FMEISOCL1IF  E           K        DISK         KINFSR *PSSR                              CSW207
     FHSTTTR  IF  E           K        DISK         KINFSR *PSSR                            AR571692
      *
     FMGF520PDO   E                    DISK         KINFSR *PSSR
     FMGF521PDO   E                    DISK         KINFSR *PSSR
     FMGF522PDO   E                    DISK         KINFSR *PSSR
     FMGF523PDO   E                    DISK         KINFSR *PSSR
     FMGF580PDO   E                    DISK         KINFSR *PSSR
     FMGISOTPDO   E                    DISK         KINFSR *PSSR          CSE029
     F/COPY WNCPYSRC,SE1871F003
      *
     FSE1871AUO   E                    PRINTER      KINFDS SPOOLU
     F                                              KINFSR *PSSR
     FSE1871P1O   E                    PRINTER      KINFDS SPOOL1     UC
     F                                              KINFSR *PSSR
     FSE1871P2O   E                    PRINTER      KINFDS SPOOL2     UC
     F                                              KINFSR *PSSR
     F/COPY WNCPYSRC,SE1871F001
      /TITLE FUNCTION OF INCICATORS
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*    15  - Print file, SE1871P1, has been opened at least once  *
     F*    16  - Print file, SE1871P2, has been opened at least once  *
     F*    20  - Control of call to MG9500                            *
     F*    50  - Control of chain to TRADSDJ4                         *
     F*    65  - Control of chain to TRAUT                            *
     F*    66  - Control of chain to SEMKC                            *
     F*    67  - Control of chain to SECTY                            *
     F*    68  - Control of chain to INVTP                            *
     F*    69  - Control of chain to TRADSDY2                         *
     F*    70  - Control of chain to TRADS                            *
     F*    75  - Control of write to MGF520D0                         *
     F*    76  - Control of write to MGF521D0                         *
     F*    77  - Control of write to MGF522D0                         *
     F*    78  - Control of write to MGF522D0                         *
     F*    79  - Control of write to MGF580D0                         *
     F*    80  - Control of chain to ACNUM                            *
     F*    81  - Control of chain to SECET                            *
      *    82  - Control of chain to HSTTRD                           *                     AR571692
     F*    85  - Look up of array, ECIN                               *
     F*                                                               *
     F*    98  - Date Format: DDMMYY (off); MMDDYY (on)               *
     F*  90-99 - Used by Standard Subroutines                         *
     F*                                                               *
     F*  U7+U8 - Database Error                                       *
     F*                                                               *
     F*****************************************************************
      /TITLE SUBROUTINE INDEX
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*  INIT   - Initial Processing                                  *
     F*  PROCES - Perform Detail Processing                           *
     F*  AMASF  - Access master files                                 *
     F*  MTYPE  - Determine message type                              *
     F*  DCUST  - Determine destination customer address              *
     F*  GCMSG  - Generate cancelation messages                       *
     F*  MSGST  - Determine message(s) to be sent                     *
     F*                                                               *
     F*  FMTALL - Format fields common to all messages                *
     F*  FMT52X - Format fields common to MT52x messages              *
     F*  FMT52Y - Format fields common to MT520 & MT521 messages      *
     F*  FMT52Z - Format fields common to MT522 & MT522 messages      *
     F*  FMT520 - Format fields specific to MT520                     *
     F*  FMT521 - Format fields specific to MT521                     *
     F*  FMT522 - Format fields specific to MT522                     *
     F*  FMT523 - Format fields specific to MT523                     *
     F*  FMT580  - Format fields specific to MT580                    *
     F*                                                               *
     F*  DAYSAC - Calculate Number of Days of Accrued Interest        *
     F*  CONVT  - Converts an amount from one currency to another     *
     F*  AUDIT  - Run Control Process                                 *
     F*  AOSARD  Call access object - Switchable features file        *   CSW003
     F*                                                               *
     F*  *PSSR  - Program error handling routine                      *
     F*                                                               *
     F*  ZLCD   - Determines Last Coupon Date                         *
     F*  ZNCD   - Determines Next Coupon Date                         *
     F*                                                               *
     F*****************************************************************
     E/TITLE E-SPECIFICATIONS
     E                    CPY@    1   1 80
      ***  Array for Object Copyright Statement.
      *
     E                    ECIN   10  40  2
      ** ARRAY FOR EUROCLEAR AND CEDEL NUMERIC CODES FOR INSTRUCTIONS
      *
     E                    ECTA   10  40  3
      ** ARRAY FOR EUROCLEAR AND CEDEL ALPHA. CODES EQUIVALENT FOR
      ** INSTRUCTION TYPE
      *
     E                    ECSA   10  40  5
      ** ARRAY FOR EUROCLEAR AND CEDEL ALPHA. CODES EQUIVALENT FOR
      ** INSTRUCTION SUBTYPE
      *
     E/COPY ZSRSRC,ZDATE2Z1
      *
     E/COPY ZSRSRC,ZDAYSZ1
      *
     E/COPY ZSRSRC,ZPOWERZ1
      *
     E/COPY ZSRSRC,ZNCDZ1
     E**********          SDPT        3  6 0                                           085245 CSD027
     E                    SDPT        3  6                                                    CSD027
     E                    SDTY        3  1                                085245
     E** ARRAY TO HOLD OTHER SETTLEMENT DEPOT                             085245
     E**                                                                  085245
     I/TITLE I-SPECIFICATIONS
      *
      ** RENAME DUPLICATE FIELDS
     IACCNTABF
     I              CNUM                            CNUMAC
      *
     ISPOOL1      DS
      ***  File Information Data Structure for SE1871P1.
     I                                       83  92 SFILE1
     I                                    B 123 1240SFNUM1
     I                                    B 188 1890WWOFL1
     I                                    B 367 3680WWPTL1
      *
     ISPOOL2      DS
      ***  File Information Data Structure for SE1871P2.
     I                                       83  92 SFILE2
     I                                    B 123 1240SFNUM2
     I                                    B 188 1890WWOFL2
     I                                    B 367 3680WWPTL2
      *
     ISPOOLU      DS
      ***  File Information Data Structure for SE1871AU.
     I                                       83  92 SFILEU
     I                                    B 123 1240SFNUMU
      *
     IDSFDY     E DSDSFDY
      ** First Data Structure for Access Objects
      *
     IDSSDY     E DSDSSDY
      ** Second Data Structure for Access Objects
      *
     IDSLDY     E DSDSLDY                                                                     CSW207
      ** Data structure for Access objects                                                    CSW207
      *                                                                                       CSW207
     ISDCSSW    E DSSDCSSWPD                                                                  CSW207
      ** Midas SD Customer Extensions SWIFT Details                                           CSW207
      *                                                                                       CSW207
     ISDCNST    E DSSDCNSTPD                                                                  CSW210
      ** Midas SD Counterparty Nostro File                                                    CSW210
      *                                                                                       CSW210
     IMEBICD    E DSMEBICDPD                                                                  CSW210
      ** Midas BIC Directory                                                                  CSW210
      *                                                                                       CSW210
     ISDBANK    E DSSDBANKPD
      ** Bank Details
      *
     ISDBRCH    E DSSDBRCHPD
      ** Branch Details
      *
     ISDCURR    E DSSDCURRPD
      ** Currency Details
      *
     ISDSTRD    E DSSDSTRDPD
      ** Securities Trading ICD Details
      *
     ISDGELR    E DSSDGELRPD
      ** General Ledger Details
      *
     ISDSECS    E DSSDSECSPD
      ** Securities Trading Clients
     I              QQACCD                          QQACCX                                    CGL029
      *
     ISECGT     E DSSECGTD                                                CSE029
     I**  EXTERNAL DS FOR CHARGE TYPE DETAILS                             CSE029
      *                                                                   CSE029
     ISDNOST    E DSSDNOSTPD
      ** Nostro Details
     I              QQACCD                          QQACCY                                    CGL029
      *
     ISDCUST    E DSSDCUSTPD
      ** Customer Details
     I              QQDFAC                          QQDFAX                                    CGL029
      *
     ISDLOCN    E DSSDLOCNPD                                                                  CSW207
      ** Location Code Details                                                                CSW207
      *                                                                                       CSW207
     ISDCCSY    E DSSDCCSYPD                                                                AR589164
      ** Currency Clearing Details                                                          AR589164
      *                                                                                     AR589164
     IDBERR       DS                            256
      * Data structure for data-base error processing.
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
      *
     I/COPY ZSRSRC,ZNCDZ2
      *
     IKEY2DS      DS
      * DATA STRUCTURE KEY 2
     I                                        1   5 WWKEY2
     I                                        1   3 SETC
     I                                        4   5 WWPYFM
      *
     IKEY3DS      DS
      * DATA STRUCTURE KEY 3
     I                                        1   6 WWKEY3
     I                                        1   3 NMCY
     I                                        4   6 SITP
      *
     IKEY4DS      DS
      * DATA STRUCTURE KEY 4
     I                                        1  17 WWKEY4
     I                                        1  10 SESN
     I                                       11  12 WWETYP
     I                                       13  170MGNCDT
      *
     I            DS
      ** DATA STRUCTURE
     I**********                              1  12 WWOURA                                    CGL029
     I                                        1  18 WWOURA                                    CGL029
     I                                        1   6 WO0106
     I**********                              7  12 WO0712                                    CGL029
     I                                        7  18 WO0712                                    CGL029
     I                                        1  100WO0110
      *
     I            DS
      ** DATA STRUCTURE
     I                                        1  10 WWOA10
     I**********                              1   60WA0106                                    CSD027
     I                                        1   6 WA0106                                    CSD027
      *
     I            DS
      ** DATA STRUCTURE
     I                                        1  10 EU10
     I                                        1   1 EU0101
     I                                        1   4 EU0104
     I                                        2   7 EU0207
      *
     IWDATP       DS                        200
      ** DATA STRUCTURE FOR PRINTING OF MT592
     I                                        1  16 DTRNO
     I                                       17  32 DRELR
     I                                       33  40 DRELD
     I                                       41  46 DNWRK
      *
     ICANDS       DS                             50
      * DATA STRUCTURE FOR CANCELLATION
     I                                        1   3 TDBA
     I                                        4   50SMTH
     I                                        6  11 DEST
     I                                       12  17 DSBICN
     I                                       18  29 DSBTID
     I                                       30  31 TDTP
     I                                    P  32  340TDVD
     I                                       35  40 TDRF
     I                                       41  43 WSETC
     I                                    P  44  460TDDT                  089115
     I                                       47  49 MTYP                  089115
      *
     I            DS
      * DATA STRUCTURE FOR EXTENDED SETTLEMENT FIELDS
     I                                        1  16 WXSFLD
     I                                        1   1 WXS53
     I                                        2   2 WXS57
     I                                        3   3 WXS58
     I                                        4   4 WXS71
     I                                        5   5 WXS72
     I                                        6   6 WXS77F
     I                                        7   7 WXS77R
     I                                        8   8 WXS79
     I                                        9   9 WXS82I
     I                                       10  10 WXS82C
     I                                       11  11 WXS83
     I                                       12  12 WXS84
     I                                       13  13 WXS85
     I                                       14  14 WXS87R
     I                                       15  15 WXS87D
     I                                       16  16 WXS88
      *
     ISDDTA       DS                                                      200292
     I                                        1 256 SDDATA                200292
     I                                        6   7 SPREFX                200292
      *                                                                                       CSW208
     I            DS                                                                          CSW208
     I                                        1   60PFRTM                                     CSW208
     I                                       11  160PMKTM                                     CSW208
     I                                       21  240PMKTOF                                    CSW208
     I                                       31  360PLCTM                                     CSW208
     I                                       41  440PLCTOF                                    CSW208
     I                                       51  560PSYTM                                     CSW208
     I                                       61  640PSYTOF                                    CSW208
      *                                                                                       CSW210
     I              'ABCDEFGHIJKLMNOPQRST-C         ALPHAN                                    CSW210
     I              'UVWXYZ0123456789'                                                        CSW210
      *                                                                                       CSW210
      ** Data Structure for extended settlement fields                                      AR589164
     I            DS                                                                        AR589164
     I                                        1  35 WDRAB                                   AR589164
     I                                        1   2 WP0102                                  AR589164
     I                                        3   4 WP0304                                  AR589164
     I                                        5  35 WP0535                                  AR589164
      *                                                                                     AR589164
     I/COPY WNCPYSRC,SE1871I001
     C/TITLE Main Processing
      *================================================================
      *  P R O G R A M     S T A R T                                  *
      *================================================================
      *
      ***  Perform Initialisation.
     C                     EXSR INIT
      *
      ***  Perform Detail Processing.
     C                     EXSR PROCES
      *
      *================================================================
      *  P R O G R A M     E N D                                      *
      *                                                               *
     C                     SETON                     LR
     C                     RETRN
      *                                                               *
      *================================================================
      /TITLE SR/INIT
      *****************************************************************
      *                                                               *
      *  INIT   - Subroutine to do Program Initialisation.            *
      *                                                               *
      *  Called By: Main Processing                                   *
      *  Calls    : None                                              *
      *                                                               *
      *****************************************************************
      *
     C           INIT      BEGSR
      *
      ***  Copyright Statement.
     C                     MOVEACPY@      BIS@   80
      *
      ***  Receive entry parameter : blank sequence number.
     C           *ENTRY    PLIST
     C                     PARM           PSEQ
      *
      ** KLIST FOR INVTP
     C           KL3       KLIST
     C                     KFLD           NMCY
     C                     KFLD           SITP
      *
      ** KLIST FOR SECET
     C           KL4       KLIST
     C                     KFLD           SESN
     C                     KFLD           WWETYP
     C                     KFLD           MGNCDT
      *                                                                   CSW003
      ** KLIST FOR TRADSDY2                                               CSW003
     C           TDRFW     KLIST                                          CSW003
     C                     KFLD           TDRF                            CSW003
     C                     KFLD           T1WHEN                          CSW003
      *
      ** Access Bank Details
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' WRTCD   7
     C                     PARM '*FIRST ' WOPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
      *
     C           WRTCD     IFNE *BLANKS
     C                     Z-ADD001       DBASE            ***************
     C                     MOVEL'SDBANKPD'DBFILE           * DB ERROR 01 *
     C                     MOVE *BLANKS   DBKEY            ***************
     C                     EXSR *PSSR
     C                     END
      *
      ***  Check System Date Format, DDMMYY (*IN98 off)
      ***                            MMDDYY (*IN98 on).
      *
     C           BJDFIN    IFEQ 'M'
     C                     SETON                     98
     C                     END
      *
      ** ACCESS PF/SDGELRPD
     C**********           CALL 'AOGELRR0'                                                    CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*MSG   ' WRTCD   7
     C                     PARM '*FIRST ' WOPTN   7
     C********** SDGELR    PARM SDGELR    DSFDY                                               CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
      *
     C           WRTCD     IFNE *BLANKS
     C                     MOVEL'002'     DBASE            **************
     C                     MOVEL'SDGELRPD'DBFILE           * DB ERROR 2 *
     C                     MOVE *BLANKS   DBKEY            **************
     C                     EXSR *PSSR
     C                     END
      *
      * Access Securities Trading ICD details
     C                     CALL 'AOSTRDR0'
     C                     PARM '*MSG   ' WRTCD   7
     C                     PARM '*FIRST ' WOPTN   7
     C           SDSTRD    PARM SDSTRD    DSSDY
      *
     C           WRTCD     IFNE *BLANKS
     C                     MOVEL'003'     DBASE            **************
     C                     MOVEL'SDSTRDPD'DBFILE           * DB ERROR 3 *
     C                     MOVE *BLANKS   DBKEY            **************
     C                     EXSR *PSSR
     C                     END
      *
      ** STORE DEPOT REFERENCE 1-EUROCLEAR AND 2-CEDEL
     C                     MOVE BVDR1     WWEOC
     C                     MOVE BVDR2     WWCEDL
     C**********           MOVE BVDR2     WWCEDN  60                                          CSD027
     C                     MOVE BVDR2     WWCEDN  6                                           CSD027
     C                     MOVE BVDR3     WWAKV
     C                     MOVE *BLANKS   WCUST                                               205141
      *
      ** RETRIEVE BIC 1-EUROCLEAR AND 2-CEDEL AND 3-KASSENVEREIN
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   WRTCD
     C                     PARM '*KEY   ' WOPTN
     C                     PARM WWEOC     WCUST  10
     C                     PARM *BLANKS   WKYST   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           WRTCD     IFNE *BLANKS
     C                     MOVEL'004'     DBASE            **************
     C                     MOVEL'SDCUSTPD'DBFILE           * DBERR  04  *
     C                     MOVE WWEOC     DBKEY            **************
     C                     EXSR *PSSR
     C                     END
      *
     C                     MOVE BBCSID    CSIDEO 12
     C                     MOVE *BLANKS   WCUST                                               205141
      *
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   WRTCD
     C                     PARM '*KEY   ' WOPTN
     C                     PARM WWCEDL    WCUST  10
     C                     PARM *BLANKS   WKYST   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           WRTCD     IFNE *BLANKS
     C                     MOVEL'005'     DBASE            **************
     C                     MOVEL'SDCUSTPD'DBFILE           * DBERR  05  *
     C                     MOVE WWCEDL    DBKEY            **************
     C                     EXSR *PSSR
     C                     END
      *
     C                     MOVE BBCSID    CSIDCE 12
     C                     MOVE *BLANKS   WCUST                                               205141
      *
     C           WWAKV     IFNE *BLANKS                                                       215888
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   WRTCD
     C                     PARM '*KEY   ' WOPTN
     C                     PARM WWAKV     WCUST  10
     C                     PARM *BLANKS   WKYST   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           WRTCD     IFNE *BLANKS
     C                     MOVEL'006'     DBASE            **************
     C                     MOVEL'SDCUSTPD'DBFILE           * DBERR  06  *
     C**********           MOVE WWCEDL    DBKEY            **************                     215888
     C                     MOVE WWAKV     DBKEY                                               215888
     C                     EXSR *PSSR
     C                     END
     C                     ENDIF                                                              215888
      *
      **  No need to move Swift ID to CSIDAK since field is no longer used.                   215888
      *                                                                                       215888
     C**********           MOVE BBCSID    CSIDAK 12                                           215888
      *                                                                   CSW003
     C**  Access SAR details file to see if CSW003 is installed           CSW003
      *                                                                   CSW003
     C                     CALL 'AOSARDR0'                                CSW003
     C                     PARM '       ' @RTCD   7                       CSW003
     C                     PARM '*VERIFY' @OPTN   7                       CSW003
     C                     PARM 'CSW003'  @SARD   6                       CSW003
      *                                                                   CSW003
     C           @RTCD     IFEQ *BLANK                                    CSW003
     C                     MOVE 'Y'       CSW003  1                       CSW003
     C                     ENDIF                                          CSW003
     C*                                                                   CEU005
      **  Access SAR details file to see if EMU SE Settlement currency    CEU005
      **  conversion is installed.                                        CEU005
      *                                                                   CEU005
     C                     CALL 'AOSARDR0'                                CEU005
     C                     PARM '       ' @RTCD                           CEU005
     C                     PARM '*VERIFY' @OPTN                           CEU005
     C                     PARM 'CEU005'  @SARD   6                       CEU005
      *                                                                   CEU005
     C           @RTCD     IFEQ *BLANK                                    CEU005
     C                     MOVE 'Y'       CEU005  1                       CEU005
     C                     ELSE                                           CEU005
     C                     MOVE 'N'       CEU005                          CEU005
     C                     ENDIF                                          CEU005
     C*                                                                   CSE029
     C** Check if ISO15022 is installed                                   CSE029
     C*                                                                   CSE029
     C                     CALL 'AOSARDR0'                                CSE029
     C                     PARM *BLANKS   PRTCO   7                       CSE029
     C                     PARM '*VERIFY' POPTN   7                       CSE029
     C                     PARM 'CSE029'  PSARD   6                       CSE029
      *                                                                   CSE029
     C           PRTCO     IFEQ *BLANKS                                   CSE029
     C                     MOVE 'Y'       CSE029  1                       CSE029
     C                     ELSE                                           CSE029
     C                     MOVE 'N'       CSE029                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                                       CSE033
      ** Check if CSE033 is installed                                                         CSE033
      *                                                                                       CSE033
     C                     CALL 'AOSARDR0'                                                    CSE033
     C                     PARM *BLANKS   PRTCO   7                                           CSE033
     C                     PARM '*VERIFY' POPTN   7                                           CSE033
     C                     PARM 'CSE033'  PSARD   6                                           CSE033
      *                                                                                       CSE033
     C           PRTCO     IFEQ *BLANKS                                                       CSE033
     C                     MOVE 'Y'       CSE033  1                                           CSE033
     C                     ELSE                                                               CSE033
     C                     MOVE 'N'       CSE033                                              CSE033
     C                     ENDIF                                                              CSE033
      *                                                                                       CSE033
      ** In this program CSE033 should function as CSE029 even if                             CSE033
      ** is not being switch on                                                               CSE033
      *                                                                                       CSE033
     C           CSE033    IFEQ 'Y'                                                           CSE033
     C           CSE029    ANDEQ'N'                                                           CSE033
     C                     MOVE 'Y'       CSE029                                              CSE033
     C                     ENDIF                                                              CSE033
      *                                                                                       CSW202
      ** Check if CSW202 is switched on                                                       CSW202
      *                                                                                       CSW202
     C                     CALL 'SWIF2002'                                                    CSW202
     C                     PARM *BLANKS   PRTCO                                               CSW202
      *                                                                                       CSW202
     C           PRTCO     IFEQ 'CSW2002'                                                     CSW202
     C                     MOVE 'Y'       CSW202  1                                           CSW202
     C                     ELSE                                                               CSW202
     C                     MOVE 'N'       CSW202                                              CSW202
     C                     ENDIF                                                              CSW202
     C*                                                                                       CSE033
      *                                                                                       CSE035
      ** Access SAR details file to see if CSE035 is installed                                CSE035
      *                                                                                       CSE035
     C                     CALL 'AOSARDR0'                                                    CSE035
     C                     PARM *BLANKS   @RTCD   7                                           CSE035
     C                     PARM '*VERIFY' @OPTN   7                                           CSE035
     C                     PARM 'CSE035'  @SARD   6                                           CSE035
      *                                                                                       CSE035
     C           @RTCD     IFEQ *BLANK                                                        CSE035
     C                     MOVE 'Y'       CSE035  1                                           CSE035
     C                     ELSE                                                               CSE035
     C                     MOVE 'N'       CSE035                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     CALL 'SWIF2007'                                                    CSW207
     C                     PARM           @RTCD                                               CSW207
      *                                                                                       CSW207
     C           @RTCD     IFEQ 'CSW2007'                                                     CSW207
     C                     MOVE 'Y'       CSW207  1                                           CSW207
     C                     ELSE                                                               CSW207
     C                     MOVE 'N'       CSW207                                              CSW207
     C                     ENDIF                                                              CSW207
     C                     CALL 'SWIF2008'                                                    CSW208
     C                     PARM           @RTCD                                               CSW208
      *                                                                                       CSW208
     C           @RTCD     IFEQ 'CSW2008'                                                     CSW208
     C                     MOVE 'Y'       CSW208  1                                           CSW208
     C                     ELSE                                                               CSW208
     C                     MOVE 'N'       CSW208                                              CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
      ** Call SWIF2010 to check if CSW210 is switched on                                      CSW210
      *                                                                                       CSW210
     C                     CALL 'SWIF2010'                                                    CSW210
     C                     PARM *BLANKS   @RTCD                                               CSW210
      *                                                                                       CSW210
     C           @RTCD     IFEQ 'CSW2010'                                                     CSW210
     C                     MOVE 'Y'       CSW210  1                                           CSW210
     C                     ELSE                                                               CSW210
     C                     MOVE 'N'       CSW210                                              CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSW210
      *                                                                                       CSW207
     C/COPY WNCPYSRC,SE1871C029
      *
      ** DEFINE WORKFIELDS
     C           *LIKE     DEFN DELT      WWBICN
     C           *LIKE     DEFN DELT      WWDEST
     C           *LIKE     DEFN A6NBDP    WWNMDP
     C           *LIKE     DEFN A6NBDP    WWSTDP
     C           *LIKE     DEFN A7CUST    WWPFNS
     C           *LIKE     DEFN A7OANN    WWPFAC
     C           *LIKE     DEFN MGSTAM    WWSTAM
     C           *LIKE     DEFN A7CUST    WWPTNS
     C           *LIKE     DEFN A7OANN    WWPTAC
     C           *LIKE     DEFN MGSTAM    WWCHGS
     C           *LIKE     DEFN BJCUST    WWEOC
     C           *LIKE     DEFN BVDR2     WWCEDL
     C           *LIKE     DEFN BVDR3     WWAKV
     C           *LIKE     DEFN MGSCAM    WWSUBT
     C           *LIKE     DEFN BFCLAS    WWDCLS
     C           *LIKE     DEFN BFDRF2    WWSKA
     C                     MOVE 'N'       WWPR01  1
     C                     MOVE 'N'       WWPR02  1
     C                     Z-ADD*ZERO     RRLIVE
     C*                                                                   200292
     C** Get system prefix from SDSTAT                                    200292
     C*                                                                   200292
     C           *NAMVAR   DEFN SDSTAT    SDDTA                           200292
     C                     IN   SDDTA                                     200292
      *
     C/COPY WNCPYSRC,SE1871C001
     C                     ENDSR
      *****************************************************************
      /TITLE SR/PROCES
      *****************************************************************
      *                                                               *
      *  PROCES - Subroutine to do the Detail Processing.             *
      *                                                               *
      *  Called By: Main Processing                                   *
      *  Calls: AMASF, MTYPE, DCUST, GCMSG, MSGST                     *
      *                                                               *
      *****************************************************************
      *
     C           PROCES    BEGSR
      *
      ***  Read the Trades/Extension Join File. Note that the Logical
      ***  is choosing the following Trades:
      ***     Complete, Authorised, Clearance Type Not= 0, Settlement
      ***     Message requested and required.
      *
     C/COPY WNCPYSRC,SE1871C002
     C                     READ TRADSDJ4                 50
     C/COPY WNCPYSRC,SE1871C003
      *
      ***  Process all Trades requiring S.W.I.F.T. Settlement Messages.
      *
     C           *IN50     DOWEQ'0'
      *
      ***  Count the record read.
      *
     C                     ADD  1         RRLIVE
      *
      ***  Save Record Id and Last Change Type from Trades File.
      *
     C                     MOVE CHTP      WTCHTP  1
     C                     MOVE RECI      WTRECI  1
     C                     MOVEL'A'       MGCHG                                               CSW025
      *
      ***  If the Last Change to the Trade is Authorisation, Access the
      ***  Trade Authorisation Audit record prior to the Authorisation
      ***  to see if the Trade has been Cancelled.
      *
     C           WTCHTP    IFEQ 'Y'
     C           TDRF      SETGTTRAUTDF
     C                     READPTRAUTDF                  65
     C                     READPTRAUTDF                  65
     C           TATYP     IFEQ 'DL'
     C           WTRECI    ANDEQ'C'
     C                     MOVE 'D'       WTCHTP
     C                     END
     C                     END
      *                                                                   CSW003
      ** If Portfolio Client (S or D) process second record.              CSW003
     C           T1WHEN    IFEQ 'B'                                       CSW003
      *                                                                   CSW003
     C           TDTP      IFEQ 'TP'                                      CSW003
     C                     MOVE 'TS'      TDTP                            CSW003
     C                     ELSE                                           CSW003
     C                     MOVE 'TP'      TDTP                            CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C           CLTY      IFEQ '2'                                       CSW003
     C           CLTY      OREQ '4'                                       CSW003
     C           CLTY      OREQ '5'                                       CSW003
      *                                                                   CSW003
      ** Determine classification of Counterparty`s agent                 CSW003
      *                                                                   CSW003
     C           TDTP      IFEQ 'TP'                                      CSW003
     C                     MOVELDELT      WWCUST                          CSW003
     C                     ELSE                                           CSW003
     C                     MOVELDELF      WWCUST                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     CALL 'AOSECSR0'                                CSW003
     C                     PARM *BLANKS   WRTCD                           CSW003
     C                     PARM '*KEY   ' WOPTN                           CSW003
     C                     PARM           WWCUST                          CSW003
     C           SDSECS    PARM SDSECS    DSSDY                           CSW003
      *                                                                   CSW003
     C           WRTCD     IFNE *BLANKS                                   CSW003
     C                     MOVE *BLANKS   CACLAS  1                       CSW003
     C                     ELSE                                           CSW003
     C                     MOVE BFCLAS    CACLAS                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     SELEC                                          CSW003
     C           CACLAS    WHEQ 'E'                                       CSW003
     C                     MOVE '2'       CLTY                            CSW003
     C           CACLAS    WHEQ 'C'                                       CSW003
     C                     MOVE '4'       CLTY                            CSW003
     C                     OTHER                                          CSW003
     C                     MOVE '5'       CLTY                            CSW003
     C                     ENDSL                                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      *                                                                   121495
      ***  Setup CACLAS for other record type than 'B'                    121495
     C           T1WHEN    IFNE 'B'                                       121495
      *                                                                   121495
     C           CLTY      IFEQ '2'                                       121495
     C           CLTY      OREQ '4'                                       121495
     C           CLTY      OREQ '5'                                       121495
      *                                                                   121495
      ***  Determine classification of Counterparty's agent               121495
      *                                                                   121495
     C                     MOVELDELF      WWCUST                          121495
      *                                                                   121495
     C                     CALL 'AOSECSR0'                                121495
     C                     PARM *BLANKS   WRTCD                           121495
     C                     PARM '*KEY   ' WOPTN                           121495
     C                     PARM           WWCUST                          121495
     C           SDSECS    PARM SDSECS    DSSDY                           121495
      *                                                                   121495
     C           WRTCD     IFNE *BLANKS                                   121495
     C                     MOVE *BLANKS   CACLAF  1                       121495
     C                     ELSE                                           121495
     C                     MOVE BFCLAS    CACLAF                          121495
     C                     ENDIF                                          121495
      *                                                                   121495
      ***  Determine classification of Counterparty's agent               121495
      *                                                                   121495
     C                     MOVELDELT      WWCUST                          121495
      *                                                                   121495
     C                     CALL 'AOSECSR0'                                121495
     C                     PARM *BLANKS   WRTCD                           121495
     C                     PARM '*KEY   ' WOPTN                           121495
     C                     PARM           WWCUST                          121495
     C           SDSECS    PARM SDSECS    DSSDY                           121495
      *                                                                   121495
     C           WRTCD     IFNE *BLANKS                                   121495
     C                     MOVE *BLANKS   CACLAT  1                       121495
     C                     ELSE                                           121495
     C                     MOVE BFCLAS    CACLAT                          121495
     C                     ENDIF                                          121495
      *                                                                   121495
     C                     ENDIF                                          121495
      *                                                                   121495
     C                     ENDIF                                          121495
      *                                                                                     AR571692
      ** Checking for trades with RECI = '*' if a record already                            AR571692
      ** exists in HSTTRD.                                                                  AR571692
      *                                                                                     AR571692
     C                     MOVEL'N'       HSTRC   1                                         AR571692
      *                                                                                     AR571692
     C           WTRECI    IFEQ '*'                                                         AR571692
     C           WTCHTP    ANDNE'D'                                                         AR571692
     C           TDRF      CHAINHSTTRDF              82                                     AR571692
     C           *IN82     IFEQ '0'                                                         AR571692
     C                     MOVEL'Y'       HSTRC                                             AR571692
     C                     ENDIF                                                            AR571692
     C                     ENDIF                                                            AR571692
      *
      ***  If Receive/Deliver Generated indicates Message already
      ***  generated, then a Cancellation Message is required. (This is
      ***  required for Amends, Changes or Deletes.)
      *
     C           T1RCDG    IFEQ 'Y'
      *                                                                   CSE029
      ** Only if it is for non-ISO15022 Messages.                         CSE029
      *                                                                   CSE029
     C           T1NEW     IFNE 'Y'                                       CSE029
      *                                                                                       CSW202
      ** Bypass processing if CSW2002 is installed                                            CSW202
     C           CSW202    ANDNE'Y'                                                           CSW202
      *                                                                                     AR571692
      ** Process only if historic record does not yet exist.                                AR571692
      *                                                                                     AR571692
     C           HSTRC     ANDEQ'N'                                                         AR571692
      *                                                                                       CSW202
     C                     EXSR MTYPE                                     089115
     C                     EXSR GCMSG
     C                     ENDIF                                          CSE029
     C                     END
      *
      ***  If the Last Change was not a Deletion, then continue to
      ***  process further messages.
      *
     C           WTCHTP    IFNE 'D'
     C           HSTRC     ANDEQ'N'                                                         AR571692
     C           T1NEW     OREQ 'Y'                                       CSE029
     C           HSTRC     ANDEQ'N'                                                         AR571692
      *
      ** ACCESS MASTER FILES
     C                     EXSR AMASF
     C/COPY WNCPYSRC,SE1871C004
      *
      * SET UP GENERATION DRIVER FILES
     C                     CLEARMGF520D0
     C                     CLEARMGF521D0
     C                     CLEARMGF522D0
     C                     CLEARMGF523D0
     C                     CLEARMGF580D0
     C                     CLEARMGISOTD0                                  CSE029
     C/COPY WNCPYSRC,SE1871C030
      *
      ** DETERMINE MESSAGE TYPE
     C                     EXSR MTYPE
      *
      ** DETERMINE DESTINATION CUSTOMER ADDRESS
     C                     EXSR DCUST
      *
      ** DETERMINE MESSAGE(S) TO BE SENT
     C                     EXSR MSGST
     C/COPY WNCPYSRC,SE1871C005
     C                     END
      *
      ***  Read the next record from the Trade/Extension Join File.
      *
     C/COPY WNCPYSRC,SE1871C006
     C                     READ TRADSDJ4                 50
     C/COPY WNCPYSRC,SE1871C007
      *
      ***  End of Do While Not End of File.
     C                     ENDDO
      *
      ** If P1 print file open then write 'End of Report'; close file
     C           *IN15     IFEQ '1'
     C                     WRITETRAILP1
     C                     CLOSESE1871P1
     C                     END
      *
      ** If P2 print file open then write 'End of Report'; close file
     C           *IN16     IFEQ '1'
     C                     WRITETRAILP2
     C                     CLOSESE1871P2
     C                     END
      *
      ** OUTPUT RUN CONTROL REPORT
     C                     EXSR AUDIT
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/AMASF
      *****************************************************************
      *                                                               *
      *    AMASF     - ACCESS MASTER FILES                            *
      *                                                               *
      *    CALLED BY - PROCES                                         *
      *    CALLS     -                                                *
      *                                                               *
      *****************************************************************
      *
     C           AMASF     BEGSR
      *                                                                   089451
     C           TDTP      IFEQ 'TS'                                      089451
     C           PYTA      ANDNE'   '                                     117357
      *                                                                   089451
      ** Access LF/SDBRCHL1 for BICN of Settlement (Pay To) Branch        089451
     C**********           CALL 'AOBRCHR0'                                             089451 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' WRTCD                           089451
     C                     PARM '*KEY   ' WOPTN                           089451
     C                     PARM PYTA      PTBRCH  3                       089451
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        089451 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *                                                                   089451
     C           WRTCD     IFNE *BLANKS                                   089451
     C                     MOVEL'030'     DBASE            ************** 089451
     C                     MOVEL'SDBRCHPD'DBFILE           * DBERR  030 * 089451
     C                     MOVELPTBRCH    DBKEY            ************** 089451
     C                     EXSR *PSSR                                     089451
     C                     END                                            089451
      *                                                                   089451
      ** Save BICN of Settlement Branch (Pay to Branch)                   089451
     C                     MOVE A8BICN    PTBICN  6                       089451
     C                     END                                            089451
      *
      ** ACCESS LF/SDBRCHL1 FOR BRANCH CODE
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' WRTCD
     C                     PARM '*KEY   ' WOPTN
     C                     PARM TDBA      WWBRCH  3
     C********** SDBRCH    PARM SDBRCH    DSFDY                                               CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *
     C           WRTCD     IFNE *BLANKS
     C                     MOVEL'007'     DBASE            **************
     C                     MOVEL'SDBRCHPD'DBFILE           * DB ERROR 7 *
     C                     MOVELWWBRCH    DBKEY            **************
     C                     EXSR *PSSR
     C                     END
      *
      ** SAVE BRANCH INTERNAL CUSTOMER
     C                     MOVE A8BICN    WWBICN
      *
      ** SAVE WORKFIELD WWDEST AS DELIVER TO OR DELIVER FROM
     C           TDTP      IFEQ 'TP'
     C**********           Z-ADDDELT      WWDEST                                              CSD027
     C                     MOVE DELT      WWDEST                                              CSD027
     C                     END
      *
     C           TDTP      IFEQ 'TS'
     C**********           Z-ADDDELF      WWDEST                                              CSD027
     C                     MOVE DELF      WWDEST                                              CSD027
     C                     END
      *
      ** ACCESS LF/SDSECSJ3 USING KEY COUNTERPARTY
     C                     MOVE TCNR      WWTCNR  6
     C                     CALL 'AOSECSR0'
     C                     PARM *BLANKS   WRTCD   7
     C                     PARM '*KEY   ' WOPTN   7
     C                     PARM WWDST6    WWCUST  6
     C           SDSECS    PARM SDSECS    DSSDY
      *
      ** DATABASE ERROR
     C           WRTCD     IFNE *BLANKS
     C                     MOVE *BLANKS   WWTCNE  6
     C                     MOVE *BLANKS   WWTCNC  6
      *                                                                                       CSE022
      ** BFDRF1 needs to be updated by the 1st 6 characters of BFNDR1.                        CSE022
      ** BFDRF2 needs to be updated by the 1st 6 characters of BFNDR2.                        CSE022
      *                                                                                       CSE022
     C                     MOVELBFNDR1    BFDRF1                                              CSE022
     C                     MOVELBFNDR2    BFDRF2                                              CSE022
      *                                                                                       CSE022
     C                     ELSE
     C                     MOVE BFCLAS    WCLAS   1                       103852
     C                     MOVE BFDRF1    WWTCNE
     C                     MOVEL'/'       WWTCNE
     C                     MOVE BFDRF2    WWTCNC
     C                     MOVEL'/'       WWTCNC
     C                     END
      *
      ** ACCESS LF/SDSECSJ3 USING KEY WORKFIELD WWDEST
     C                     MOVE WWDEST    WWDST6  6
     C                     CALL 'AOSECSR0'
     C                     PARM *BLANKS   WRTCD   7
     C                     PARM '*KEY   ' WOPTN   7
     C                     PARM WWDST6    WWCUST  6
     C           SDSECS    PARM SDSECS    DSSDY
      *
      ** NO DATABASE ERROR IS REQUIRED.  THIS CAN HAPPEN IF CLEARANCE TYPE
      ** ON THE TRADE IS 0  (DELIVER FROM/TO DOES NOT HAVE TO BE ENTERED)
     C           WRTCD     IFNE *BLANKS
     C                     MOVE *BLANKS   WWDCLS
     C                     ELSE
     C                     MOVE BFCLAS    WWDCLS
     C                     END
     C/COPY WNCPYSRC,SE1871C008
      *
      ** ACCESS JLF/SECTY    USING KEY SECURITY REFERENCE
     C           TDSS      CHAINSECTY                67
     C           *IN67     IFEQ '1'
     C                     MOVEL'008'     DBASE            **************
     C                     MOVEL'SECTY   'DBFILE           * DB ERROR 8 *
     C                     MOVELTDSS      DBKEY            **************
     C                     EXSR *PSSR
     C                     END
     C/COPY WNCPYSRC,SE1871C009
     C*                                                                   085245
     C*** Get other settlement depot information and set up array         085245
     C*                                                                   085245
     C           KL3       CHAININVTP                68                   085245
     C           *IN68     IFEQ '1'                                       085245
     C                     MOVEL'027'     DBASE            ***************085245
     C                     MOVEL'INVTPD  'DBFILE           * DB ERROR 27 *085245
     C                     MOVELWWKEY3    DBKEY            ***************085245
     C                     EXSR *PSSR                                     085245
     C                     END                                            085245
     C*                                                                   085245
     C*** Set up settlement depot in array                                085245
     C*                                                                   085245
     C                     MOVE SDC1      SDPT,1                          085245
     C                     MOVE SDC2      SDPT,2                          085245
     C                     MOVE SDC3      SDPT,3                          085245
     C                     MOVE STC1      SDTY,1                          085245
     C                     MOVE STC2      SDTY,2                          085245
     C                     MOVE STC3      SDTY,3                          085245
      *
      ** ACCESS PF/TRADSDY2 USING KEY OF TRADE REF AND SET ON FLAG
      **  IF RECORD EXISTS
      ** Key now Trade Ref and First/Second Record Indicator.             CSW003
     C***********TDRF      CHAINTRADSDY2             69                   CSW003
     C           TDRFW     CHAINTRADSDY2             69                   CSW003
     C           *IN69     IFEQ '0'
     C                     MOVE 'Y'       WWEXSS  1
     C                     ELSE
     C                     MOVE 'N'       WWEXSS
     C                     END
     C/COPY WNCPYSRC,SE1871C031
      *
      ** RESET EXTENDED FIELDS DATA STRUCTURE
     C                     MOVE *BLANKS   WXSFLD
      *
      ** ACCESS LF/SDCURRL1 USING KEY NOMINAL CURRENCY
     C                     CALL 'AOCURRR0'
     C                     PARM '*MSG   ' WRTCD
     C                     PARM '*KEY   ' WOPTN
     C                     PARM TNMC      WCUCY   3
     C           SDCURR    PARM SDCURR    DSSDY
      *
     C           WRTCD     IFNE *BLANKS
     C                     MOVEL'009'     DBASE            **************
     C                     MOVEL'SDCURRPD'DBFILE           * DB ERROR 9 *
     C                     MOVELTNMC      DBKEY            **************
     C                     EXSR *PSSR
     C                     END
      *
      ** SAVE NO. OF DEC. PLACES
     C                     MOVE A6NBDP    WWNMDP
      *                                                                   200292
      ** Save SWIFT currency Code for nominal currency.                   200292
     C                     MOVE A6SWCY    WWNCID  4                       200292
      *
      ** ACCESS LF/SDCURRL1 USING KEY SETTLEMENT CURRENCY
     C                     CALL 'AOCURRR0'
     C                     PARM '*MSG   ' WRTCD
     C                     PARM '*KEY   ' WOPTN
     C                     PARM SETC      WCUCY   3
     C           SDCURR    PARM SDCURR    DSSDY
      *
     C           WRTCD     IFNE *BLANKS
     C                     MOVEL'010'     DBASE            **************
     C                     MOVEL'SDCURRPD'DBFILE           * DB ERROR 10*
     C                     MOVELSETC      DBKEY            **************
     C                     EXSR *PSSR
     C                     END
      *
      ** SAVE NO. OF DEC. PLACES
     C                     MOVE A6NBDP    WWSTDP
      *                                                                   200292
      ** Save SWIFT currency Code for settlement currency.                200292
     C                     MOVE A6SWCY    WWSCID  4                       200292
      *
     C           CSW003    IFEQ 'Y'                                       176345
     C           T1WHEN    ANDEQ'B'                                       176345
     C           TDTP      IFEQ 'TP'                                      176345
     C                     MOVELPAYT      WWOURA                          176345
     C                     ELSE                                           176345
     C                     MOVELPYFM      WWOURA                          176345
     C                     END                                            176345
     C                     ELSE                                           176345
      ** IF TDTP IS 'TP'
     C           TDTP      IFEQ 'TP'
     C                     MOVELPYFM      WWOURA
     C                     ELSE
      *
     C                     MOVELPAYT      WWOURA
     C                     END
     C                     ENDIF                                          176345
      *
      ** IF SMTH IS '01', '02', '07', '08' OR '12'
     C           SMTH      IFEQ 01
     C           SMTH      OREQ 02
     C           SMTH      OREQ 07
     C           SMTH      OREQ 08
     C           SMTH      OREQ 12
      *
      ** SET UP KLIST FOR CHAINING TO FILE
     C                     MOVELWWOURA    WWPYFM
      *
      ** ACCESS LF/SDNOSTL0 USING KEY SETTLEMNT CCY AND WWOURA
     C                     CALL 'AONOSTR0'
     C                     PARM           WRTCD   7
     C                     PARM '*KEY   ' WOPTN   7
     C                     PARM *BLANKS   PWCUST  6          Customer No
     C                     PARM SETC      PWCYCD  3          Currency
     C**********           PARM *BLANKS   PWACCD  4          A/c Code                         CGL029
     C                     PARM *BLANKS   PWACCD 10                                           CGL029
     C                     PARM *BLANKS   PWACSN  2          A/c Seq
     C                     PARM WWPYFM    PWNONB  2          Nostro No
     C                     PARM *BLANKS   PWBRCD  3          Branch Code
     C                     PARM *BLANKS   PWCSSN 10          Cust ShortN
     C                     PARM *BLANKS   PWPNOI  1          Prime Nost In
     C           SDNOST    PARM SDNOST    DSFDY
      *
      ** DATABASE ERROR
     C           WRTCD     IFNE *BLANKS
     C                     MOVEL'011'     DBASE            **************
     C                     MOVEL'SDNOSTPD'DBFILE           * DBERR  011 *
     C                     MOVELSETC      DBKEY5  5        **************
     C                     MOVE WWPYFM    DBKEY5
     C                     MOVE DBKEY5    DBKEY
     C                     EXSR *PSSR
     C                     END
      *
      ** SAVE NOSTRO CUSTOMER NUMBER
     C                     MOVELA7CUST    WWOA10
      *
      ** IF A7OANN IS NOT BLANK
     C           A7OANN    IFNE *BLANKS
     C                     MOVELA7OANN    WW34   34
     C                     ELSE
     C                     MOVELA7NOSN    WW34
     C                     END
      *
     C                     MOVEL'/'       WWOA35 35
     C                     MOVE WW34      WWOA35
     C                     END
      *
      ** IF SMTH IS '04'
     C           SMTH      IFEQ 04
      *
      ** SAVE COUNTERPARTY CUSTOMER NUMBER
     C                     MOVELTCNR      WWOA10
     C                     END
      *
      ** IF SMTH IS '00', '03' OR '06'
     C           SMTH      IFEQ 00
     C           SMTH      OREQ 03
     C           SMTH      OREQ 06
      *
      ** SAVE BRANCH INTERNAL CUSTOMER NUMBER
     C                     MOVELWWBICN    WWOA10
     C                     END
      *
      ** IF SMTH IS '05' OR '15'
     C           SMTH      IFEQ 05
     C           SMTH      OREQ 15
      *
      ** SET UP WORK FIELDS WWOA10 AND WWOA35
     C                     MOVELWO0106    WWOA10
     C                     MOVELWO0712    WW34
     C                     MOVEL'/'       WWOA35
     C                     MOVE WW34      WWOA35
     C                     END
      *
      ** IF SMTH IS '14'
     C           SMTH      IFEQ 14
      *
      ** ACCESS LF/ACNUM USING KEY OF LEFT 10 CHARS OF WWOURA
     C           WO0110    CHAINACNUM                80
     C           *IN80     IFEQ '1'
     C                     MOVEL'012'     DBASE            **************
     C                     MOVEL'ACNUM'   DBFILE           * DBERR  012 *
     C                     MOVELWO0110    DBKEY            **************
     C                     EXSR *PSSR
     C                     ELSE
      *
      ** SET UP WORK FIELDS WWOA10 AND WWO35
     C                     MOVELCNUMAC    WWOA10
     C                     MOVELWWOURA    WW34
     C                     MOVEL'/'       WWOA35
     C                     MOVE WW34      WWOA35
     C                     END
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/MTYPE
      *****************************************************************
      *                                                               *
      *    MTYPE     - DETERMINE MESSAGE TYPE                         *
      *                                                               *
      *    CALLED BY - PROCES                                         *
      *    CALLS     - NONE                                           *
      *                                                               *
      *****************************************************************
      *
     C           MTYPE     BEGSR
      *
      ** INITIALISE WTYP
     C                     MOVE *BLANKS   WTYP    3
      *
      ** DETERMINE VALUE OF CLEARANCE TYPE
     C           CLTY      IFEQ '1'
     C           CLTY      OREQ '2'
     C           CLTY      OREQ '3'
     C           CLTY      OREQ '4'
     C                     MOVEL'580'     WTYP
     C                     ELSE
      *
      ** DETERMINE VALUE OF TRADE PURCHASE
     C           TDTP      IFEQ 'TP'
      *
     C           PCOD      IFEQ '1'
     C           PCOD      OREQ '5'
     C                     MOVEL'521'     WTYP
     C                     ELSE
     C                     MOVE '520'     WTYP
     C                     END
     C                     END
      *
     C           TDTP      IFEQ 'TS'
      *
     C           PCOD      IFEQ '1'
     C           PCOD      OREQ '5'
     C                     MOVE '523'     WTYP
     C                     ELSE
     C                     MOVE '522'     WTYP
     C                     END
      *
     C                     END
     C/COPY WNCPYSRC,SE1871C010
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/DCUST
      *****************************************************************
      *                                                               *
      *    DCUST     - DETERMINE DESTINATION CUSTOMER ADDRESS         *
      *                                                               *
      *    CALLED BY - PROCES                                         *
      *    CALLS     -                                                *
      *                                                               *
      *****************************************************************
      *
     C           DCUST     BEGSR
      *
      ** IF WTYP IS BLANK - EXIT
     C           WTYP      IFNE *BLANKS
     C                     MOVE WWDEST    MGDEST
     C/COPY WNCPYSRC,SE1871C011
      *
      ***WTYP*IS*580*AND*MGDEST*IS*NOT*WWEOC*OR*WWCEDL*DATABASE*ERROR******                 BUG10692
     C**********           MOVELWWEOC     WWEOC6  60                                          CSD027
     C**********           MOVELWWCEDL    WWCDL6  60                                          CSD027
     C                     MOVELWWEOC     WWEOC6  6                                           CSD027
     C                     MOVELWWCEDL    WWCDL6  6                                           CSD027
      *
     C***********WTYP      IFEQ '580'                                                       BUG10692
     C***********MGDEST    ANDNEWWEOC6                                    CSW003
     C***********MGDEST    ANDNEWWCDL6                                    CSW003
     C***********WWDCLS    ANDNE'E'                                       CSW003            BUG10692
     C***********WWDCLS    ANDNE'C'                                       CSW003            BUG10692
     C***********          MOVEL'013'     DBASE            **************                   BUG10692
     C***********          MOVE *BLANKS   DBFILE           * DB ERROR 13*                   BUG10692
     C***********          MOVE *BLANKS   DBKEY            **************                   BUG10692
     C***********          EXSR *PSSR                                                       BUG10692
     C***********          END                                                              BUG10692
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/GCMSG
      *****************************************************************
      *                                                               *
      *    GCMSG     - GENERATE CANCELLATION MESSAGES                 *
      *                                                               *
      *    CALLED BY - PROCES                                         *
      *    CALLS     - MG9500                                         *
      *                                                               *
      *****************************************************************
      *
     C           GCMSG     BEGSR
      *
      ** ACCESS LF/SDBRCHL1 FOR BRANCH CODE
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' WRTCD
     C                     PARM '*KEY   ' WOPTN
     C                     PARM TDBA      WWBRCH  3
     C********** SDBRCH    PARM SDBRCH    DSFDY                                               CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *
      ** DATABASE ERROR
     C           WRTCD     IFNE *BLANKS
     C                     MOVEL'014'     DBASE            **************
     C                     MOVEL'SDBRCHPD'DBFILE           * DB ERROR 14*
     C                     MOVELWWBRCH    DBKEY            **************
     C                     EXSR *PSSR
     C                     END
      *
      ** SAVE WORKFIELD WWDEST AS DELIVER TO OR DELIVER FROM
     C           TDTP      IFEQ 'TP'
     C                     MOVE DELT      DEST
     C                     END
      *
     C           TDTP      IFEQ 'TS'
     C                     MOVE DELF      DEST
     C                     END
      *
     C                     MOVELSETC      WSETC
      *
     C                     MOVELTDRF      TRNUM  10
     C                     MOVEL*BLANKS   DTRNO
      *
      ** IF 580 TO BE SENT TO CEDEL, SEQUENCE NO MUST BE FILLED
      ** OTHERWISE SEQUENCE NO MUST BE BLANK
     C                     MOVEL*BLANKS   TSEQ
     C                     MOVEL*BLANKS   CEDPRO  1
      *
     C           CLTY      IFEQ '1'
     C           CLTY      OREQ '2'
     C           CLTY      OREQ '3'
     C           CLTY      OREQ '4'
      *
     C***********TDTP      IFEQ 'TS'                                      094335
     C***********DELF      ANDEQWWCEDN                                    094335
     C***********TDTP      OREQ 'TP'                                      094335
     C***********DELT      ANDEQWWCEDN                                    094335
     C***********          MOVELT1LSSC    TSEQ                            094335
     C***********          MOVE 'Y'       CEDPRO  1                       094335
      *
     C***********          END                                            094335
     C                     END
      *
     C                     MOVELA8BICN    DSBICN  6
     C                     MOVELA8BTID    DSBTID 12
     C                     MOVELWTYP      MTYP                            089115
      *
     C           T1WHEN    IFEQ 'B'                                       CSW003
     C                     MOVEL'TS'      TTYPE   2                       CSW003
     C                     ELSE                                           CSW003
     C                     MOVEL'TR'      TTYPE                           CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     CALL 'MG9500'               20
     C                     PARM           TRNUM
     C                     PARM 'PR'      CALLP   2
     C                     PARM 'SE'      MODID   2
     C***********          PARM 'TR'      TTYPE   2                       CSW003
     C                     PARM           TTYPE                           CSW003
     C                     PARM *BLANKS   WRTNC   1
     C                     PARM           TSEQ    7
     C                     PARM           WDATP  46        DATA TO PRINT
     C                     PARM           CANDS  50
     C                     PARM           CEDPRO                          094335
     C                     PARM           CSW003                          CSW003
      *
     C           *IN20     IFEQ '1'
     C                     MOVE '015'     DBASE            ***************
     C                     MOVE *BLANKS   DBKEY            * DBERROR 015 *
     C                     MOVEL'MG9500'  DBPGM            ***************
     C                     EXSR *PSSR
     C                     END
      *
      ** IF ERROR DURING PROGRAM
     C           WRTNC     IFEQ 'E'
     C                     MOVE '016'     DBASE            ***************
     C                     MOVE *BLANKS   DBKEY            * DBERROR 016 *
     C                     MOVELTRNUM     DBKEY            ***************
     C                     MOVEL'MG9500'  DBPGM
     C                     EXSR *PSSR
     C                     END
      *
     C***********CEDPRO    IFEQ 'Y'                        1              094335
      *
     C           WRTNC     IFEQ 'D'
     C           CEDPRO    IFEQ 'Y'                                       094335
      ** IF RECORD NOT FOUND ON MGOREFPD
      **   AND CEDEL CANCELLATION PROCESSING, PRINT ON REPORT
     C                     MOVELTDRF      R2TDRF
     C                     MOVEL'000'     WRK9    9
     C                     MOVE TDRF      WRK9
     C                     MOVELWRK9      R2TRN
     C                     MOVE T1LSSC    R2TRN
     C                     MOVE 'Y'       WWPR02  1
      *
      ***  If print file not yet open then open it and write headings
     C           *IN16     IFEQ '0'
      *
     C                     OPEN SE1871P2
     C                     MOVE '1'       *IN16
      *
     C                     Z-ADDSFNUM2    ZSNUM   60
     C                     CALL 'ZSFILE'
     C                     PARM           PSEQ    5
     C                     PARM *BLANKS   WPARM   3
     C                     PARM           SFILE2
     C                     PARM           ZSNUM
     C                     PARM           ZSERR   1
      *
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
      *
      ** PRINT PAGE HEADINGS
     C                     WRITEHEADP2
      *
     C                     END
      *
      ** WRITE A DETAIL LINE TO THE REPORT CHECKING FOR OVERFLOW
     C           WWOFL2    SUB  WWPTL2    WWLIN2  20
     C           WWLIN2    IFLT 3
     C                     WRITEHEADP2
     C                     END
      *
     C                     WRITEDETAIL2
     C                     CLEARDETAIL2
      *
     C                     END
     C                     END                                            094335
      *
      **   IF CANCEL MESSAGE TO BE PRODUCED
     C           WRTNC     IFEQ 'C'
     C                     CLEARMGF580D0
     C                     MOVELWWCEDN    MGDEST
     C                     MOVELTDRF      MGTNUM
     C                     MOVEL'SE'      MGMODI
     C***********          MOVEL'TR'      MGTTYP                          CSW003
     C                     MOVELTTYPE     MGTTYP                          CSW003
     C                     MOVELTDBA      MGSNBR
      *
     C           TDTP      IFEQ 'TP'                                      104331
     C                     MOVELPYFA      MGBRCA                          104331
     C                     ELSE                                           104331
     C                     MOVELPYTA      MGBRCA                          104331
     C                     END                                            104331
     C           MGBRCA    IFEQ *BLANKS                                   104331
     C                     MOVE TDBA      MGBRCA                          104331
     C                     END                                            104331
     C                     MOVELTDTP      MGTSTP                          073848
     C                     MOVEL'/CANCEL/'MGFIN1
     C                     Z-ADDTNMD      MGNMDP                          121645
     C                     WRITEMGF580D0               79
      *
      ** CHECK RECORD SUCCESSFULLY WRITTEN TO FILE
     C           *IN79     IFEQ '1'
     C                     MOVEL'017'     DBASE            **************
     C                     MOVEL'MGF580PD'DBFILE           * DB ERROR 17*
     C                     MOVE *BLANKS   DBKEY            **************
     C                     EXSR *PSSR
     C                     END
      *
     C                     CLEARMGF580D0
      *
     C                     END
      *
     C***********          ELSE                                           094335
      *
      ** PRINT MT592 GENERATED
     C           WRTNC     IFEQ 'F'                                       094335
     C                     EXSR WPR01
     C                     END                                            094335
      *
     C**********           END                                            094335
     C                     MOVEL'D'       MGCHG                                               CSW025
      *
     C                     ENDSR
      *****************************************************************
      /TITLE SR/MSGST
      *****************************************************************
      *                                                               *
      *    MSGST     - DETERMINE MESSAGE(S) TO BE SENT                *
      *                                                               *
      *    CALLED BY - PROCES                                         *
      *    CALLS     - FMTALL,FMT52X,FMT52Y,FMT52Z,FMT520,FMT521,     *
      *                FMT522,FMT523,FMT580                           *
      *                                                               *
      *****************************************************************
      *
     C           MSGST     BEGSR
      *
     C           WTYP      IFNE *BLANKS
      *
      ** FORMAT FIELDS COMMON TO ALL MESSAGES
     C                     EXSR FMTALL
      *
      ** FORMAT FIELDS COMMON TO MT52xx MESSAGES
     C           WTYP      IFEQ '520'
     C           WTYP      OREQ '521'
     C           WTYP      OREQ '522'
     C           WTYP      OREQ '523'
     C                     EXSR FMT52X
     C                     END
      *
      ** FORMAT FIELDS COMMON TO MT520 & MT521
     C           WTYP      IFEQ '520'
     C           WTYP      OREQ '521'
     C                     EXSR FMT52Y
     C                     END
      *
      ** FORMAT FIELDS COMMON TO MT522 & MT523
     C           WTYP      IFEQ '522'
     C           WTYP      OREQ '523'
     C                     EXSR FMT52Z
     C                     END
      *
      ** FORMAT FIELDS SPECIFIC TO MT520
     C           WTYP      IFEQ '520'
     C                     EXSR FMT520
     C                     END
      *
      ** FORMAT FIELDS SPECIFIC TO MT521
     C           WTYP      IFEQ '521'
     C                     EXSR FMT521
     C                     END
      *
      ** FORMAT FIELDS SPECIFIC TO MT522
     C           WTYP      IFEQ '522'
     C                     EXSR FMT522
     C                     END
      *
      ** FORMAT FIELDS SPECIFIC TO MT523
     C           WTYP      IFEQ '523'
     C                     EXSR FMT523
     C                     END
      *
      ** FORMAT FIELDS SPECIFIC TO MT580
     C           WTYP      IFEQ '580'
     C                     EXSR FMT580
     C                     END
     C*                                                                   CSE029
     C** If ISO15022 is needed, then format ISO fields                    CSE029
     C*                                                                   CSE029
     C           CSE029    IFEQ 'Y'                                       CSE029
     C           T1NEW     ANDEQ'Y'                                       CSE029
     C                     EXSR FMTISO                                    CSE029
     C                     ENDIF                                          CSE029
      *
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/FMTALL
      *****************************************************************
      *                                                               *
      *    FMTALL    - FORMAT COMMON FIELDS                           *
      *                                                               *
      *    CALLED BY - MSGST                                          *
      *    CALLS     -                                                *
      *                                                               *
      *****************************************************************
      *
     C           FMTALL    BEGSR
      *
      ** SET UP DELIVERY FROM/TO AND COUNT/CUST NUMB. WORKFIELD
     C                     MOVELDELF      WWDELF  6
     C                     MOVELDELT      WWDELT  6
     C                     MOVELTCNR      WWTNR6  6
      *
      ** TRANSACTION NUMBER
     C                     MOVELTDRF      MGTNUM
      *
      ** MODULE ID
     C                     MOVEL'SE'      MGMODI
      *
      ** TRANSACTION TYPE
     C           T1WHEN    IFEQ 'B'                                       CSW003
     C                     MOVEL'TS'      MGTTYP                          CSW003
     C                     ELSE                                           CSW003
     C                     MOVEL'TR'      MGTTYP
     C                     ENDIF                                          CSW003
      *
      ** TRANSACTION SUB-TYPE
     C                     MOVELTDTP      MGTSTP
      *
      ** BRANCH CODE OF SENDER
     C                     MOVELTDBA      MGSNBR
      *
      ** SETTLEMENT  OF SENDER
      ** SETTLEMENT BRANCH SET UP TO PAY FROM BRANCH IF TRADE TYPE IS
      ** PURCHASE, & SET TO PAY TO BRANCH IF SELL.
     C           TDTP      IFEQ 'TP'
     C                     MOVELPYFA      MGBRCA
     C                     END
      *
     C           TDTP      IFEQ 'TS'
     C                     MOVELPYTA      MGBRCA
     C                     END
      *                                                                   104331
     C           MGBRCA    IFEQ *BLANKS                                   104331
     C                     MOVE TDBA      MGBRCA                          104331
     C                     END                                            104331
      *
      ** SETTLEMENT TYPE
     C                     MOVELSMTH      MGSETP
      *
      ** VALUE DATE
     C           TDVD      IFLT BJRDNB                                    104032
     C                     Z-ADDBJRDNB    MGSDAT                          104032
     C                     ELSE                                           104032
     C                     Z-ADDTDVD      MGSDAT
     C                     END                                            104032
      *
      ** TRADE DATE
     C                     MOVELTDDT      MGTDAT
      *
      ** QUANTITY OF SECURITIES
     C                     Z-ADDNOML      MGQANT
     C/COPY WNCPYSRC,SE1871C026
      *
      ** Nominal decimal places                                           078256
     C                     Z-ADDTNMD      MGNMDP                          078256
      *                                                                   078256
      ** NOMINAL CURRENCY
     C                     MOVELNMCY      MGNMCY
      *
      ** SWIFT SECURITY TYPE
     C           WTYP      IFEQ '580'
      *
     C           SWTP      IFEQ 'RTS'
     C           SWTP      OREQ 'UNT'
     C           SWTP      OREQ 'WTS'
     C                     MOVELSWTP      MGSWTP
     C                     ELSE
      *
      ** ACCESS LF/INVTP USING KEY NOMINAL CURR. & SECURITY INV. TYPE
     C           KL3       CHAININVTP                68
     C           *IN68     IFEQ '1'
     C                     MOVEL'018'     DBASE            **************
     C                     MOVEL'INVTP'   DBFILE           * DB ERROR 18*
     C                     MOVELWWKEY3    DBKEY            **************
     C                     EXSR *PSSR
     C                     END
      *
     C           PROT      IFEQ '4'
     C           PROT      OREQ '7'
     C                     MOVEL'SHS'     MGSWTP
     C                     ELSE
     C                     MOVEL'FMT'     MGSWTP
     C                     END
     C                     END
      *
     C                     ELSE
      *
     C                     MOVELSWTP      MGSWTP
     C                     END
     C/COPY WNCPYSRC,SE1871C012
     C*                                                                   085245
     C*** Output Security Ref. Number depending on settlement depots.     085245
     C*** For MT580 Messages use ISIN/Common Code.                        085245
     C******************************************************************* 085326
     C****If*CUSIP*number*is*being*used*then*for*US*Treasury*Bill**085245 085326
     C*******move*'%'*to*the*last*field*in*the*MGISIN*to*represent*085245 085326
     C*******the*word*'CUSIP'*is*needed*to*be*printed**************085245 085326
     C****Else*****************************************************085245 085326
     C*******for*US*Treasury*Note*move*'\'*to*the*last*field*to****085245 085326
     C*******represent*the*word*'CUSIP'*not*needed.****************085245 085326
     C*** If CUSIP number is being used then move '%' to last field       085326
     C***    in MGISIN so that the word 'CUSIP' will be printed for       085326
     C***    both US Teasury Bill and Notes.                              085326
     C******************************************************************* 085326
     C*** For messages other then MT580                                   085245
     C*** If no refer is indicated then it will use ISIN/Common Code      085245
     C*** field if it is not *BLANKS                                      085245
      *
      ** ISIN OF SECURITY FOR SWIFT
     C*                                                                   085245
     C           WTYP      IFEQ '580'                                     085245
     C*                                                                   085245
     C                     MOVELISIN      MGISIN
     C/COPY WNCPYSRC,SE1871C013
     C*                                                                   085245
     C                     ELSE                                           085245
     C*                                                                   085245
     C                     Z-ADD1         I       10                      085245
     C                     MOVE '0'       *IN01                           085245
     C           *IN01     DOWEQ'0'                                       085245
     C*                                                                   085245
     C           MGDEST    IFEQ SDPT,I                                    085245
     C                     MOVE '1'       *IN01                           085245
     C                     ELSE                                           085245
     C                     ADD  1         I                               085245
     C           I         IFEQ 4                                         085245
     C                     MOVE '1'       *IN01                           085245
     C                     END                                            085245
     C                     END                                            085245
     C*                                                                   085245
     C                     END                                            085245
     C*                                                                   085245
     C           I         IFEQ 4                                         085245
     C                     MOVELISIN      MGISIN                          085245
     C/COPY WNCPYSRC,SE1871C014
     C                     ELSE                                           085245
     C*                                                                   085245
     C           SDTY,I    IFEQ 'C'                                       085245
     C                     MOVELCSPN      MGISIN                          085245
     C***********CPNR      IFEQ 0                                  085245 085326
     C                     MOVE '%'       MGISIN                          085245
     C                     ELSE                                           121633
     C                     MOVELISIN      MGISIN                          121633
     C***********          ELSE                                    085245 085326
     C***********          MOVE '\'       MGISIN                   085245 085326
     C***********          END                                     085245 085326
     C                     END                                            085245
     C*                                                                   085245
     C                     END                                            085245
     C*                                                                   085245
     C                     END                                            085245
      *
      ** SECURITY FULL NAME-1 & 2
     C           SFN1      IFNE *BLANKS
     C                     MOVELSFN1      MGSFN1
     C                     MOVELSFN2      MGSFN2
     C                     ELSE
      *
     C                     MOVELSESN      MGSFN1
     C                     MOVELSRPN      MGSFN2
     C                     END
      *
      ** SENDER TO RECEIVER INFO 1 & 2
     C           WWEXSS    IFEQ 'Y'
     C                     MOVE 'Y'       WXS72
     C                     MOVELT2SRL1    MGSRL1
     C                     MOVELT2SRL2    MGSRL2
     C                     MOVELT2SRL3    MGSRL3
     C                     END
      *
      ** IF MGSRL1 IS BLANK
     C           MGSRL1    IFEQ *BLANKS
     C                     MOVELTDSI      MGSRL1
     C                     END
      *
      ** SAFEKEEPING ACCOUNT AND SAFEKEEPING ACCOUNT A/C LINE
     C           TDTP      IFEQ 'TS'
     C           DELT      ANDEQWWBICN
     C           TDTP      OREQ 'TP'
     C           DELF      ANDEQWWBICN
      *
     C           WTYP      IFNE '580'
      *
     C           WWEXSS    IFEQ 'N'
     C           T2SKAN    OREQ *BLANKS
     C           T2SKAL    ANDEQ*BLANKS
     C                     MOVELTCNR      MGSKAN
     C                     END
     C                     END
     C                     END
      *
      ** IF RECORD EXISTS ON PF/TRADSDY2 FOR THIS TRADE
     C           WWEXSS    IFEQ 'Y'
     C                     MOVE 'Y'       WXS83
     C                     MOVELT2SKAN    MGSKAN
     C                     MOVELT2SKAL    MGSKAL
     C                     END
      *
     C/COPY WNCPYSRC,SE1871C015
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/FMT52X
      *****************************************************************
      *                                                               *
      *    FMT52X    - FORMAT FIELDS COMMON TO MT52xx MESSAGES        *
      *                                                               *
      *    CALLED BY - FMTALL                                         *
      *    CALLS     - ZNCD                                           *
      *                                                               *
      *****************************************************************
      *
     C           FMT52X    BEGSR
      *
     C           TMKC      IFNE *BLANKS
      *
      ** MARKET NAME
      **    ACCESS LF/SEMKC USING KEY TRADE MARKET CENTRE
     C           TMKC      CHAINSEMKC                66
     C           *IN66     IFEQ '1'
     C                     MOVEL'019'     DBASE            **************
     C                     MOVEL'SEMKC'   DBFILE           * DB ERROR 19*
     C                     MOVELTMKC      DBKEY            **************
     C                     EXSR *PSSR
     C                     END
      *
     C                     MOVELMKTN      MGMKTN
     C                     END
      *
      ***  Next Coupon Date. If Security is not Interest-Bearing,
      ***  (implied by Initial Date = 0 or Coupon Rate = 0), then set
      ***  the Next Coupon Date to zero.
      *
     C           ITLD      IFEQ 0
     C           CPNR      OREQ 0
     C                     Z-ADD0         MGNCDT
     C                     ELSE
      *
      ***  Want Next Coupon AFTER Value Date, so add 1.
     C           TDVD      ADD  1         ECD     50
     C                     EXSR ZNCD
     C                     Z-ADDNCD       MGNCDT
     C                     ENDIF
      *
      ** INSTRUCTING PARTY & INSTRUCTING PARTY A/C LINE
     C           WWEXSS    IFEQ 'Y'
     C                     MOVE 'Y'       WXS82I
     C                     MOVELT2IPYN    MGIPYN
     C                     MOVELT2IPYL    MGIPYL
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/FMT52Y
      *****************************************************************
      *                                                               *
      *    FMT52Y    - FORMAT FIELDS COMMON TO MT520 & MT521          *
      *                                                               *
      *    CALLED BY - MSGST                                          *
      *    CALLS     - NONE                                           *
      *                                                               *
      *****************************************************************
      *
     C           FMT52Y    BEGSR
      *
      ** DELIVERER OF SECURITIES AND DEL. OF SECURITIES A/C LINE
     C           WWEXSS    IFEQ 'Y'
     C           T2DSSN    ANDNE*BLANKS
     C           WWEXSS    OREQ 'Y'
     C           T2DSS1    ANDNE*BLANKS
     C                     MOVE 'Y'       WXS87D
     C                     MOVELT2DSSN    MGDSSN
     C                     MOVELT2DSS1    MGDSS1
      ** Extract other detail lines of Deliverer of Security              192221
     C                     MOVELT2DSS2    MGDSS2                          192221
     C                     MOVELT2DSS3    MGDSS3                          192221
     C                     MOVELT2DSS4    MGDSS4                          192221
     C                     ELSE
      *
     C********** WWDELF    IFNE *ZEROS                                                        CSD027
     C           WWDELF    IFNE *BLANKS                                                       CSD027
     C                     MOVELDELF      MGDSSN
     C                     ELSE
     C                     MOVELTCNR      MGDSSN
     C                     END
     C                     END
      *
      ** BENEFICIARY OF SECURITIES AND BENE. OF SECURITIES A/C LINE
     C           WWEXSS    IFEQ 'Y'
     C           T2BSSN    ANDNE*BLANKS
     C           WWEXSS    OREQ 'Y'
     C           T2BSS1    ANDNE*BLANKS
     C                     MOVE 'Y'       WXS88
     C                     MOVELT2BSSN    MGBSSN
     C                     MOVELT2BSS1    MGBSS1
     C                     ELSE
      *
      ** IF DTFA IS NOT BLANK
     C           DTFA      IFNE *BLANKS
     C                     MOVELDTFA      MGBSSN
     C                     ELSE
     C                     MOVELWWBICN    MGBSSN
     C                     END
     C                     END
      *
      ** IF MGSKAN EQUALS MGBSSN AND MGSKAL EQUALS MGBSSL
     C           MGSKAN    IFEQ MGBSSN
     C           MGSKAL    ANDEQMGBSS1
     C                     MOVE *BLANKS   MGBSSN
     C                     MOVE *BLANKS   MGBSS1
     C                     END
      *
      **  SETUP DELIVERER'S INSTRUCTING PARTY
      *
     C/COPY WNCPYSRC,SE1871C016
     C           TDRF      CHAINTRADS                70
     C           *IN70     IFEQ *ON
     C                     MOVEL'026'     DBASE            **************
     C                     MOVEL'TRADS   'DBFILE           * DB ERR 026 *
     C                     MOVELTDRF      DBKEY            **************
     C                     EXSR *PSSR
     C                     ELSE
     C                     MOVELDFFA      MGDIPN
     C                     ENDIF
     C/COPY WNCPYSRC,SE1871C017
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/FMT52Z
      *****************************************************************
      *                                                               *
      *    FMT52Z    - FORMAT FIELDS COMMON TO MT522 & MT523          *
      *                                                               *
      *    CALLED BY - MSGST                                          *
      *    CALLS     - NONE                                           *
      *                                                               *
      *****************************************************************
      *
     C           FMT52Z    BEGSR
      *
      ** CERTIFICATE NOS. REQUIRED - will always be No for these
      ** messages since they may never be Deliver From Cedel.
     C                     MOVEL'N'       MGCRTN
      *
      ** RECEIVER OF SECURITIES
     C           WWEXSS    IFEQ 'Y'
     C           T2RSSN    ANDNE*BLANKS
     C           WWEXSS    OREQ 'Y'
     C           T2RSS1    ANDNE*BLANKS
     C                     MOVE 'Y'       WXS87R
     C                     MOVELT2RSSN    MGRSSN
     C                     MOVELT2RSS1    MGRSS1
      ** Extract other detail lines of Receiver of Security               192221
     C                     MOVELT2RSS2    MGRSS2                          192221
     C                     MOVELT2RSS3    MGRSS3                          192221
     C                     MOVELT2RSS4    MGRSS4                          192221
     C                     ELSE
      *
     C********** DELT      IFNE *ZEROS                                                        CSD027
     C           DELT      IFNE *BLANKS                                                       CSD027
     C                     MOVELDELT      MGRSSN
     C                     ELSE
     C                     MOVELTCNR      MGRSSN
     C                     END
     C                     END
      *
      ** BENEFICIARY OF SECURITIES AND BENE. OF SECURITIES A/C LINE
     C           WWEXSS    IFEQ 'Y'
     C           T2BSSN    ANDNE*BLANKS
     C           WWEXSS    OREQ 'Y'
     C           T2BSS1    ANDNE*BLANKS
     C                     MOVE 'Y'       WXS88
     C                     MOVELT2BSSN    MGBSSN
     C                     MOVELT2BSS1    MGBSS1
     C                     ELSE
      *
      ** IF DTFA IS NOT BLANK
     C           DTFA      IFNE *BLANKS
     C                     MOVELDTFA      MGBSSN
     C                     ELSE
      *
     C           WCLAS     IFEQ 'S'                                       103852
     C           WCLAS     OREQ 'D'                                       103852
     C                     MOVELTCNR      MGBSSN                          103852
     C                     END                                            103852
     C***********DELT      IFEQ WWEOC6                                    CSW003
     C***********WWDCLS    IFEQ 'E'                                CSW003 103852
     C***********          MOVELWWTCNE    MGBSSN                          103852
     C***********          ELSE                                           103852
     C***********DELT      IFEQ WWCDL6                                    CSW003
     C***********WWDCLS    IFEQ 'C'                                CSW003 103852
     C***********          MOVELWWTCNC    MGBSSN                          103852
     C***********          END                                            103852
     C***********          END                                            103852
      *
     C                     END
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/FMT520
      *****************************************************************
      *                                                               *
      *    FMT520    - FORMAT FIELDS SPECIFIC TO MT520                *
      *                                                               *
      *    CALLED BY - MSGST                                          *
      *    CALLS     -                                                *
      *                                                               *
      *****************************************************************
      *
     C           FMT520    BEGSR
      *                                                                                       CSW202
      ** Bypass processing if SWIFT 2002 is installed                                         CSW202
      *                                                                                       CSW202
     C           CSW202    IFNE 'Y'                                                           CSW202
      *
      ** EXTENDED SETTLEMENT FIELDS
     C                     MOVE WXSFLD    MGXSFL
     C/COPY WNCPYSRC,SE1871C018
      *                                                                                       204220
      ** If New ISO15022 is needed then do not output MT520                                   204220
      *                                                                                       204220
     C           T1NEW     IFNE 'Y'                                                           204220
      *
      ** WRITE A RECORD TO PF/MGF520PD
     C                     WRITEMGF520D0               75
      *
      ** CHECK RECORD SUCCESSFULLY WRITTEN TO FILE
     C**********                                                                       CSE029 204220
     C***If*New*ISO15022*is*needed*then*do*not*output*MT520***********                 CSE029 204220
     C**********                                                                       CSE029 204220
     C********** T1NEW     IFNE 'Y'                                                    CSE029 204220
     C           *IN75     IFEQ '1'
     C                     MOVEL'020'     DBASE            **************
     C                     MOVEL'MGF520PD'DBFILE           * DB ERROR 20*
     C                     MOVE *BLANKS   DBKEY            **************
     C                     EXSR *PSSR
     C                     END
     C                     ENDIF                                          CSE029
      *                                                                                       CSW202
     C                     ENDIF                                                              CSW202
      *                                                                                       CSW202
     C/COPY WNCPYSRC,SE1871C032
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/FMT521
      *****************************************************************
      *                                                               *
      *    FMT521    - FORMAT FIELDS SPECIFIC TO MT521                *
      *                                                               *
      *    CALLED BY - MSGST                                          *
      *    CALLS     - CONVT, DAYSAC                                  *
      *                                                               *
      *****************************************************************
      *
     C           FMT521    BEGSR
      *
      ** IF RECORD EXISTS ON PF/TRADSDY2 FOR THIS TRADE AND
      ** T2AFPN OR T2AFPL ARE NOT BLANK
     C           WWEXSS    IFEQ 'Y'
     C           T2AFPN    ANDNE*BLANKS
     C           WWEXSS    OREQ 'Y'
     C           T2AFPL    ANDNE*BLANKS
     C                     MOVE 'Y'       WXS53
     C                     MOVELT2AFPN    MGAFPN
     C                     MOVELT2AFPL    MGAFPL
     C                     ELSE
      *
      ** IF LEFTMOST SIX CHARS OF WWOA10 EQUALS TCNR
     C           WA0106    IFEQ TCNR
      *
     C           SMTH      IFEQ 01
     C           SMTH      OREQ 02
     C           SMTH      OREQ 07
     C           SMTH      OREQ 08
     C           SMTH      OREQ 12
     C                     MOVELWWOA10    MGAFPN
     C                     MOVELWWOA35    MGAFPL
     C                     END
      *
     C                     END
     C                     END
      *
      ** IF MGAFPN AND MGAFPL ARE BOTH BLANK
     C           MGAFPN    IFEQ *BLANKS
     C           MGAFPL    ANDEQ*BLANKS
      *
      ** IF RECORD EXISTS ON PF/TRADSDY2 FOR THIS TRADE AND
      ** T2AWIN OR T2AWIL ARE NOT BLANK
     C           WWEXSS    IFEQ 'Y'
     C           T2AWIN    ANDNE*BLANKS
     C           WWEXSS    OREQ 'Y'
     C           T2AWIL    ANDNE*BLANKS
     C                     MOVE 'Y'       WXS57
     C                     MOVELT2AWIN    MGAWIN
     C                     MOVELT2AWIL    MGAWIL
     C                     ELSE
      *
      ***IF*WWOA10*IS*NOT*BLANK                                           090054
      ***OR*LEFTMOST*SIX*CHARS*OF*WWOA10*DO NOT EQUAL TCNR                090054
     C***********WWOA10    IFNE *BLANKS                                   090054
     C***********WA0106    ANDNETCNR                                      090054
      ** IF COUNTERPARTY NOSTRO NE COUNTERPARTY AND NOT BLANK             090054
     C**********           MOVELPAYT      PAYT6   60                                   090054 CSD027
     C                     MOVELPAYT      PAYT6   6                                           CSD027
     C           PAYT      IFNE *BLANKS                                   090054
     C           PAYT6     ANDNETCNR                                      090054
      *
     C           SMTH      IFEQ 01
     C           SMTH      OREQ 02
     C           SMTH      OREQ 07
     C           SMTH      OREQ 08
     C           SMTH      OREQ 12
     C***********          MOVELWWOA10    MGAWIN                          090054
     C***********          MOVELWWOA35    MGAWIL                          090054
     C                     MOVELPAYT      MGAWIN                          090054
     C                     MOVEL*BLANK    MGAWIL                          090054
     C                     END
      *
     C                     END
     C                     END
     C                     END
      *
      ** IF MGAWIN OR MGAWIL ARE NOT BLANK
     C           MGAWIN    IFNE *BLANKS
     C           MGAWIL    ORNE *BLANKS
      *
      ** IF RECORD EXISTS ON PF/TRADSDY2 FOR THIS TRADE AND
      ** T2BOFN OR T2BOF1 ARE NOT BLANK
     C           WWEXSS    IFEQ 'Y'
     C           T2BOFN    ANDNE*BLANKS
     C           WWEXSS    OREQ 'Y'
     C           T2BOF1    ANDNE*BLANKS
     C                     MOVE 'Y'       WXS58
     C                     MOVELT2BOFN    MGBOFN
     C                     MOVELT2BOF1    MGBOF1
     C                     ELSE
      *
      ** IF FOR ACCOUNT OF/PAY TO IS NOT BLANK
     C           TDFA      IFNE *BLANKS
     C                     MOVELTDFA      MGBOFN
     C                     ELSE
     C                     MOVELPAYT      MGBOFN
     C                     END
     C                     END
     C                     END
      *
      ** TRADE BASIS
     C                     MOVELSTBS      MGSTBS
      *
      ** PRICE BASIS
     C                     MOVELSPBS      MGSPBS
      *
      *** Field :33T: requires the 'Price/Discount/Yield' data.           102916
      *** (ref Functional spec.)                                          102916
     C***MARKET*PRICE******                                               102916
     C***********          Z-ADDPRIC      MGPRIC                          102916
     C                     Z-ADDTPDY      MGPRIC                          102916
     C/COPY WNCPYSRC,SE1871C028
      *
      ** SETTLEMENT CURRENCY
     C                     MOVELSETC      MGSTCY
      *
      ** SET UP WORKFIELD FOR SETTLEMENT AMOUNT
     C                     Z-ADDTCTR      WWSTAM
      *
      ** CONVERT SETTLEMENT AMOUNT FROM NOMINAL TO SETTLEMENT CCY
     C                     Z-ADDWWSTAM    WKAMTI
     C                     Z-ADDWWNMDP    WKDPI
     C                     Z-ADDWWSTDP    WKDPO
     C                     Z-ADDTDER      WKEXCH
     C                     MOVE TMDI      WKZMD
     C/COPY WNCPYSRC,SE1871C019
     C                     EXSR CONVT
     C                     Z-ADDWKAMTO    MGSTAM
      *
      ** ACCOUNT FOR CHARGES 1 & ACCOUNT FOR CHARGES 2
     C           WWEXSS    IFEQ 'Y'
     C           T2ACL1    ANDNE*BLANKS
     C           WWEXSS    OREQ 'Y'
     C           T2ACL2    ANDNE*BLANKS
     C                     MOVE 'Y'       WXS71
     C                     MOVELT2ACL1    MGACL1
     C                     MOVELT2ACL2    MGACL2
     C                     END
      *
      ** EXTENDED SETTLEMENT FIELDS
     C                     MOVE WXSFLD    MGXSFL
      *
      ** SETUP DEAL AMOUNT
     C                     Z-ADDTCSR      MGDLAM
      *
      ** SETUP ACCRUED INTEREST
     C                     Z-ADDITRA      MGITRA
      *
      ** SETUP INTEREST ACCRUED NUMBER OF DAYS
     C           ITRA      IFNE 0
     C           ACIN      IFEQ 'C'
     C           ACIN      OREQ 'X'
     C                     EXSR DAYSAC
      *                                                                   125568
     C           DADJ      IFNE 0                                         125568
     C                     Z-ADDDADJ      MGACND                          125568
     C                     ELSE                                           125568
     C                     Z-ADDZDDAYS    MGACND
     C                     END                                            125568
      *                                                                   125568
     C                     END
     C                     END
      *
      ** SETUP ACCRUED INDICATOR
     C                     MOVELACIN      MGACIN
      *
      ** SETUP TAXES ADDED, THIS IS THE SUM OF PF/TRADS FIELDS TCA1
      ** THROUGH TCA7
     C                     Z-ADDTCA1      MGTXAD
     C                     ADD  TCA2      MGTXAD
     C                     ADD  TCA3      MGTXAD
     C                     ADD  TCA4      MGTXAD
     C                     ADD  TCA5      MGTXAD
     C                     ADD  TCA6      MGTXAD
     C                     ADD  TCA7      MGTXAD
      *
      *
      ** SETUP BROKER'S COMMISSION
     C                     Z-ADDTBCA      MGBCOM
      *
      ** SETUP OTHER CHARGES OR FEES
     C                     Z-ADDTCCA      MGOCGF
      *                                                                   CEU005
     C           CEU005    IFEQ 'Y'                                       CEU005
     C           ICCY      IFNE *BLANKS                                   CEU005
     C           ICCY      IFEQ TNMC                                      CEU005
      * Set up the original transaction amount as the countervalue in     CEU005
      * nominal currency                                                  CEU005
     C                     Z-ADDTCTR      MGOTRA                          CEU005
      * Set up the original transaction currency as the nominal currency  CEU005
     C                     MOVE TNMC      MGOTRC                          CEU005
     C                     ELSE                                           CEU005
      * Set up the original transaction amount as the countervalue in     CEU005
      * nominal currency converted to the 'In' currency in field 72       CEU005
     C                     CALL 'EU0200'                                  CEU005
     C                     PARM *BLANK    P@RTCD  7        Return Code    CEU005
     C                     PARM TCTR      P@FRAM 183       FROM Ccy AmountCEU005
     C                     PARM TNMC      P@FRCY  3        FROM Currency  CEU005
     C                     PARM ICCY      P@TOCY  3        TO Currency    CEU005
     C                     PARM           P@OUTA 150       Outright AmountCEU005
     C                     PARM           P@INTA 183       Interim Amount CEU005
     C                     PARM           P@EXRT 159       Exchange Rate  CEU005
     C                     PARM           P@MDIN  1        Mult/Div Ind.  CEU005
     C                     MOVE P@OUTA    MGOTRA    P                     CEU005
      * Set up the original transaction currency as the 'In' currency     CEU005
     C                     MOVE ICCY      MGOTRC                          CEU005
     C                     ENDIF                                          CEU005
     C                     ENDIF                                          CEU005
     C                     ENDIF                                          CEU005
     C/COPY WNCPYSRC,SE1871C020
      *
      ** WRITE A RECORD TO PF/MGF521PD
      *                                                                   CSE029
     C** If New ISO15022 is needed then donot output MT521                CSE029
     C*                                                                   CSE029
     C           T1NEW     IFNE 'Y'                                       CSE029
      *                                                                                       CSW202
      ** Bypass writing of record if SWIFT 2002 is installed                                  CSW202
      *                                                                                       CSW202
     C           CSW202    ANDNE'Y'                                                           CSW202
      *                                                                                       CSW202
     C                     WRITEMGF521D0               76
      *
      ** CHECK RECORD SUCCESSFULLY WRITTEN TO FILE
     C           *IN76     IFEQ '1'
     C                     MOVEL'021'     DBASE            **************
     C                     MOVEL'MGF521PD'DBFILE           * DB ERROR 21*
     C                     MOVE *BLANKS   DBKEY            **************
     C                     EXSR *PSSR
     C                     END
     C                     ENDIF                                          CSE029
     C/COPY WNCPYSRC,SE1871C021
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/FMT522
      *****************************************************************
      *                                                               *
      *    FMT522    - FORMAT FIELDS SPECIFIC TO MT522                *
      *                                                               *
      *    CALLED BY - MSGST                                          *
      *    CALLS     -                                                *
      *                                                               *
      *****************************************************************
      *
     C           FMT522    BEGSR
      *
      ** EXTENDED SETTLEMENT FIELDS
     C                     MOVE WXSFLD    MGXSFL
     C/COPY WNCPYSRC,SE1871C022
      *
      ** WRITE A RECORD TO PF/MGF522PD
     C*                                                                   CSE029
     C** If New ISO15022 is needed then donot output MT521                CSE029
     C*                                                                   CSE029
     C           T1NEW     IFNE 'Y'                                       CSE029
      *                                                                                       CSW202
      ** Bypass writing of record if SWIFT 2002 is installed                                  CSW202
      *                                                                                       CSW202
     C           CSW202    ANDNE'Y'                                                           CSW202
      *                                                                                       CSW202
     C                     WRITEMGF522D0               77
      *
      ** CHECK RECORD SUCCESSFULLY WRITTEN TO FILE
     C           *IN77     IFEQ '1'
     C                     MOVEL'022'     DBASE            **************
     C                     MOVEL'MGF522PD'DBFILE           * DB ERROR 22*
     C                     MOVE *BLANKS   DBKEY            **************
     C                     EXSR *PSSR
     C                     END
     C                     ENDIF                                          CSE029
     C/COPY WNCPYSRC,SE1871C033
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/FMT523
      *****************************************************************
      *                                                               *
      *    FMT523    - FORMAT FIELDS SPECIFIC TO MT523                *
      *                                                               *
      *    CALLED BY - MSGST                                          *
      *    CALLS     - DAYSAC                                         *
      *                                                               *
      *****************************************************************
      *
     C           FMT523    BEGSR
      *
      ** IF RECORD EXISTS ON PF/TRADSDY2 FOR THIS TRADE AND
      ** T2AFPN OR T2AFPL ARE NOT BLANK
     C           WWEXSS    IFEQ 'Y'
     C           T2AFPN    ANDNE*BLANKS
     C           WWEXSS    OREQ 'Y'
     C           T2AFPL    ANDNE*BLANKS
     C                     MOVE 'Y'       WXS53
     C                     MOVELT2AFPN    MGAFPN
     C                     MOVELT2AFPL    MGAFPL
     C                     ELSE
      *
      ** IF LEFTMOST SIX CHARS OF WWOA10 EQUALS TCNR
     C           WA0106    IFEQ TCNR
     C                     MOVELWWOA10    MGAFPN
     C                     MOVELWWOA35    MGAFPL
     C                     END
     C                     END
      *
      ** IF MGAFPN AND MGAFPL ARE BOTH BLANK
     C           MGAFPN    IFEQ *BLANKS
     C           MGAFPL    ANDEQ*BLANKS
      *
      ** IF RECORD EXISTS ON PF/TRADSDY2 FOR THIS TRADE AND
      ** T2AWIN OR T2AWIL ARE NOT BLANK
     C           WWEXSS    IFEQ 'Y'
     C           T2AWIN    ANDNE*BLANKS
     C           WWEXSS    OREQ 'Y'
     C           T2AWIL    ANDNE*BLANKS
     C                     MOVE 'Y'       WXS57
     C                     MOVELT2AWIN    MGAWIN
     C                     MOVELT2AWIL    MGAWIL
     C                     ELSE
      *
      ** IF WWOA10 IS NOT BLANK
      ** AND LEFTMOST SIX CHARS OF WWOA10 DO NOT EQUAL TCNR
     C           WWOA10    IFNE *BLANKS
     C           WA0106    ANDNETCNR
     C                     MOVELWWOA10    MGAWIN
     C                     MOVELWWOA35    MGAWIL
     C                     END
     C                     END
     C                     END
      *
      ** IF MGAWIN OR MGAWIL ARE NOT BLANK
     C           MGAWIN    IFNE *BLANKS
     C           MGAWIL    ORNE *BLANKS
      *
      ** IF RECORD EXISTS ON PF/TRADSDY2 FOR THIS TRADE AND
      ** T2BOFN OR T2BOF1 ARE NOT BLANK
     C           WWEXSS    IFEQ 'Y'
     C           T2BOFN    ANDNE*BLANKS
     C           WWEXSS    OREQ 'Y'
     C           T2BOF1    ANDNE*BLANKS
     C                     MOVE 'Y'       WXS58
     C                     MOVELT2BOFN    MGBOFN
     C                     MOVELT2BOF1    MGBOF1
     C                     ELSE
      *
     C** Should use Pay to Branch's BICN instead of Pay From              089451
     C***********          MOVELPYFM      MGBOFN                          089451
     C                     MOVELPTBICN    MGBOFN                          089451
     C                     END
     C                     END
      *
      ** TRADE BASIS
     C                     MOVELSTBS      MGSTBS
      *
      ** PRICE BASIS
     C                     MOVELSPBS      MGSPBS
      *
      ** MARKET PRICE
     C                     Z-ADDTPDY      MGPRIC
     C/COPY WNCPYSRC,SE1871C027
      *
      ** SETTLEMENT CURRENCY
     C                     MOVELSETC      MGSTCY
      *
      ** SET UP WORKFIELD FOR SETTLEMENT AMOUNT
     C                     Z-ADDTCTR      WWSTAM
      *
      ** CONVERT SETTLEMENT AMOUNT FROM NOMINAL TO SETTLEMENT CCY
     C                     Z-ADDWWSTAM    WKAMTI
     C                     Z-ADDWWNMDP    WKDPI
     C                     Z-ADDWWSTDP    WKDPO
     C                     Z-ADDTDER      WKEXCH
     C                     MOVE TMDI      WKZMD
     C/COPY WNCPYSRC,SE1871C023
     C                     EXSR CONVT
     C                     Z-ADDWKAMTO    MGSTAM
      *
      ** ACCOUNT FOR CHARGES 1 & ACCOUNT FOR CHARGES 2
     C           WWEXSS    IFEQ 'Y'
     C           T2ACL1    ANDNE*BLANKS
     C           WWEXSS    OREQ 'Y'
     C           T2ACL2    ANDNE*BLANKS
     C                     MOVE 'Y'       WXS71
     C                     MOVELT2ACL1    MGACL1
     C                     MOVELT2ACL2    MGACL2
     C                     END
      *
      ** EXTENDED SETTLEMENT FIELDS
     C                     MOVE WXSFLD    MGXSFL
      *
      ** SETUP DEAL AMOUNT
     C                     Z-ADDTCSR      MGDLAM
      *
      ** SETUP ACCRUED INTEREST
     C                     Z-ADDITRA      MGITRA
      *
      ** SETUP INTEREST ACCRUED NUMBER OF DAYS
     C           ITRA      IFNE 0
     C           ACIN      IFEQ 'C'
     C           ACIN      OREQ 'X'
     C                     EXSR DAYSAC
      *                                                                   125568
     C           DADJ      IFNE 0                                         125568
     C                     Z-ADDDADJ      MGACND                          125568
     C                     ELSE                                           125568
     C                     Z-ADDZDDAYS    MGACND
     C                     END                                            125568
      *                                                                   125568
     C                     END
     C                     END
      *
      ** SETUP ACCRUED INDICATOR
     C                     MOVELACIN      MGACIN
      *
      ** SETUP TAXES ADDED, THIS IS THE SUM OF PF/TRADS FIELDS TCA1
      ** THROUGH TCA7
     C                     Z-ADDTCA1      MGTXAD
     C                     ADD  TCA2      MGTXAD
     C                     ADD  TCA3      MGTXAD
     C                     ADD  TCA4      MGTXAD
     C                     ADD  TCA5      MGTXAD
     C                     ADD  TCA6      MGTXAD
     C                     ADD  TCA7      MGTXAD
      *
      *
      ** SETUP BROKER'S COMMISSION
     C                     Z-ADDTBCA      MGBCOM
      *
      ** SETUP OTHER CHARGES OR FEES
     C                     Z-ADDTCCA      MGOCGF
      *                                                                   CEU005
     C           CEU005    IFEQ 'Y'                                       CEU005
     C           ICCY      IFNE *BLANKS                                   CEU005
     C           ICCY      IFEQ TNMC                                      CEU005
      * Set up the original transaction amount as the countervalue in     CEU005
      * nominal currency                                                  CEU005
     C                     Z-ADDTCTR      MGOTRA                          CEU005
      * Set up the original transaction currency as the nominal currency  CEU005
     C                     MOVE TNMC      MGOTRC                          CEU005
     C                     ELSE                                           CEU005
      * Set up the original transaction amount as the countervalue in     CEU005
      * nominal currency converted to the 'In' currency in field 72       CEU005
     C                     CALL 'EU0200'                                  CEU005
     C                     PARM *BLANK    P@RTCD  7        Return Code    CEU005
     C                     PARM TCTR      P@FRAM 183       FROM Ccy AmountCEU005
     C                     PARM TNMC      P@FRCY  3        FROM Currency  CEU005
     C                     PARM ICCY      P@TOCY  3        TO Currency    CEU005
     C                     PARM           P@OUTA 150       Outright AmountCEU005
     C                     PARM           P@INTA 183       Interim Amount CEU005
     C                     PARM           P@EXRT 159       Exchange Rate  CEU005
     C                     PARM           P@MDIN  1        Mult/Div Ind.  CEU005
     C                     MOVE P@OUTA    MGOTRA    P                     CEU005
      * Set up the original transaction currency as the 'In' currency     CEU005
     C                     MOVE ICCY      MGOTRC                          CEU005
     C                     ENDIF                                          CEU005
     C                     ENDIF                                          CEU005
     C                     ENDIF                                          CEU005
     C/COPY WNCPYSRC,SE1871C024
      *
      ** WRITE A RECORD TO PF/MGF523PD
      *                                                                   CEU003
     C** If New ISO15022 is needed then donot output MT523                CSE029
     C*                                                                   CSE029
     C           T1NEW     IFNE 'Y'                                       CSE029
      *                                                                                       CSW202
      ** Bypass writing of record if SWIFT 2002 is installed                                  CSW202
      *                                                                                       CSW202
     C           CSW202    ANDNE'Y'                                                           CSW202
      *                                                                                       CSW202
     C                     WRITEMGF523D0               78
      *
      ** CHECK RECORD SUCCESSFULLY WRITTEN TO FILE
     C           *IN78     IFEQ '1'
     C                     MOVEL'023'     DBASE            **************
     C                     MOVEL'MGF523PD'DBFILE           * DB ERROR 23*
     C                     MOVE *BLANKS   DBKEY            **************
     C                     EXSR *PSSR
     C                     END
     C                     ENDIF                                          CSE029
     C/COPY WNCPYSRC,SE1871C025
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/FMT580
      *****************************************************************
      *                                                               *
      *    FMT580    - FORMAT FIELDS SPECIFIC TO MT580                *
      *                                                               *
      *    CALLED BY - MSGST                                          *
      *    CALLS     - CONVT, DAYSAC                                  *
      *                                                               *
      *****************************************************************
      *
     C           FMT580    BEGSR
      *
      ** MARKET INDICATOR
     C                     MOVELMKTI      MGMKTI
      *
      ** Format Certificate Numbers Required Indicator - only Yes if
      ** Trade sale, non-Fungible, Fungible Trade Code 1 or 2
      ** (ie. 'from' non-fungible with Certificate Numbers given)
      ** and Deliver is from Cedel.
      *
     C           TDTP      IFEQ 'TS'
     C           T1FTID    ANDEQ'N'
     C           T1FCOD    ANDEQ'1'
     C***********WWDELF    ANDEQWWCEDL                                    CSW003
     C           WWDCLS    ANDEQ'C'                                       CSW003
      *
     C           TDTP      OREQ 'TS'
     C           T1FTID    ANDEQ'N'
     C           T1FCOD    ANDEQ'2'
     C***********WWDELF    ANDEQWWCEDL                                    CSW003
     C           WWDCLS    ANDEQ'C'                                       CSW003
      *
     C                     MOVEL'Y'       MGCRTN
     C                     ELSE
     C                     MOVEL'N'       MGCRTN
      *
     C                     END
      *
      ** FIELD 23 SUB-FIELD 1
     C           TDTP      IFEQ 'TP'
      *
     C           PCOD      IFEQ '1'
     C           PCOD      OREQ '5'
     C                     MOVE 'RECAPMT' MGF231
     C                     ELSE
      *
     C                     MOVE 'RECFREE' MGF231
     C                     END
     C                     ELSE
      *
     C           PCOD      IFEQ '1'
     C           PCOD      OREQ '5'
     C                     MOVE 'DELAPMT' MGF231
     C                     ELSE
      *
     C                     MOVE 'DELFREE' MGF231
     C                     END
     C                     END
      *
      ** SETTLEMENT CURRENCY
     C                     MOVELSETC      MGSTCY
      *
      ** MARKET PRICE
     C                     Z-ADDTPDY      MGPRIC
      *
      ** DEAL AMOUNT
     C                     Z-ADDTCSR      MGDLAM
      *
      ** SET UP WORKFIELD FOR SETTLEMENT AMOUNT
     C                     Z-ADDTCTR      WWSTAM
      *
      ** CONVERT SETTLEMENT AMOUNT FROM NOMINAL TO SETTLEMENT CCY
     C                     Z-ADDWWSTAM    WKAMTI
     C                     Z-ADDWWNMDP    WKDPI
     C                     Z-ADDWWSTDP    WKDPO
     C                     Z-ADDTDER      WKEXCH
     C                     MOVE TMDI      WKZMD
     C                     EXSR CONVT
     C                     Z-ADDWKAMTO    MGSTAM
      *
      ** TRADE BASIS
     C                     MOVELSTBS      MGSTBS
      *
      ** PRICE BASIS
     C                     MOVELSPBS      MGSPBS
      *
      ** EXCHANGE RATE (NMCY/STCY)
     C           MGNMCY    IFNE MGSTCY
      *
     C           TMDI      IFEQ 'M'
     C                     Z-ADDTDER      MGDAXR
     C                     ELSE
      *
     C           TDER      IFEQ 0
     C                     Z-ADD0         MGDAXR
     C                     ELSE
      *
     C           1         DIV  TDER      MGDAXR
     C                     END
     C                     END
     C                     END
      *
      ** EXCHANGE RATE (SCCY/STCY)
     C                     Z-ADDMGDAXR    MGSCXR
      *
      ** ACCRUED INDICATOR
     C                     MOVELACIN      MGACIN
      *
      ** INTEREST ACCRUED NO. OF DAYS
     C           ITRA      IFNE *ZEROS
      *
     C           ACIN      IFEQ 'C'
     C           ACIN      OREQ 'X'
     C                     EXSR DAYSAC
      *                                                                   125568
     C           DADJ      IFNE 0                                         125568
     C                     Z-ADDDADJ      MGACND                          125568
     C                     ELSE                                           125568
     C                     Z-ADDZDDAYS    MGACND
     C                     END                                            125568
      *                                                                   125568
     C                     END
     C                     END
      *
      ** INTEREST AMOUNT
     C                     Z-ADDITRA      MGITRA
      *
      ** INTEREST CURRENCY
     C                     MOVELNMCY      MGITCY
      *
      ** EXCHANGE RATE (ITCY/STCY)
     C                     Z-ADDMGDAXR    MGITXR
      *
      ** ACCESS LF/INVTP USING KEY NOMINAL CURR. & SECURITY INV. TYPE
     C           KL3       CHAININVTP                68
     C           *IN68     IFEQ '1'
     C                     MOVEL'024'     DBASE            **************
     C                     MOVEL'INVTP'   DBFILE           * DBERR 024  *
     C                     MOVELWWKEY3    DBKEY            **************
     C                     EXSR *PSSR
     C                     END
      *
      ** IF PROT IS NOT '2', '4' OR '7'
     C           PROT      IFNE '2'
     C           PROT      ANDNE'4'
     C           PROT      ANDNE'7'
      *
      ** IF PROT IS '3', '5' OR '8'
     C           PROT      IFEQ '3'
     C           PROT      OREQ '5'
     C           PROT      OREQ '8'
      *
      ** ACCESS LF/SECET USING KEY SESN, 'IR' AND MGNCDT
     C           KL4       CHAINSECET                81
     C           *IN81     IFEQ '0'
     C                     MOVELSDNC      MGITRT
     C                     ELSE
     C                     Z-ADD0         MGITRT
     C                     END
     C                     ELSE
      *
     C                     MOVELSDNC      MGITRT
     C                     END
     C                     END
      *
      ** IF DVBS EQUALS '1'
     C           DVBS      IFEQ '1'
     C                     MOVEL'360'     MGITCB
     C                     ELSE
      *
      ** IF DVBS EQUALS '2' OR '3'
     C           DVBS      IFEQ '2'
     C           DVBS      OREQ '3'
     C                     MOVEL'365'     MGITCB
     C                     ELSE
      *
      ** IF DVBS EQUALS '5'
     C           DVBS      IFEQ '5'
     C                     MOVELMGACND    MGITCB
     C                     END
     C                     END
     C                     END
      *
      ** CHECK IF CURRENT YEAR IS A LEAP YEAR
     C                     MOVE BJMRDT    ZYEAR   20
     C           ZYEAR     DIV  4         ZLYR    20
     C                     MVR            ZLY     10
      *
      ** IF DVBS EQUALS '3' AND CURRENT YEAR IS A LEAP YEAR
     C           DVBS      IFEQ '3'
     C           ZLY       ANDNE0
     C                     MOVEL'366'     MGITCB
     C                     END
      *
      ** SPECIAL CONCESSIONS AMOUNT
     C           TCTR      SUB  TCSR      WWSUBT
     C           WWSUBT    SUB  ITRA      MGSCAM
      *
      ** SPECIAL CONCESSIONS CURRENCY
     C                     MOVELNMCY      MGSCCY
      *
      ** ASSUME DEFAULT VALUE FOR BOOK ENTRY
     C           T1INSS    IFEQ *BLANKS
      *
     C           T1INST    IFEQ '6F '
     C           T1INST    OREQ '61 '
     C           T1INST    OREQ '03 '
     C           T1INST    OREQ '03K'
     C           T1INST    OREQ '07 '
     C           T1INST    OREQ '07K'
     C                     MOVEL'BOOK '   T1INSS
     C                     END
      *
      ** ASSUME DEFAULT VALUE FOR MATCHING & SETTLEMENT
     C           T1INST    IFEQ '01 '
     C           T1INST    OREQ '02 '
     C           T1INST    OREQ '03C'
     C           T1INST    OREQ '07C'
     C                     MOVEL'SETTL'   T1INSS
     C                     END
      *
     C                     END
      *
      ** ASSUME DEFAULT VALUE FOR FREE OR AGAINST PAYMENT (EUROCLEAR)
     C           T1INST    IFEQ '01 '
     C           T1INST    OREQ '02 '
     C           T1INST    OREQ '03 '
      *
     C           PCOD      IFEQ '1'
     C           PCOD      OREQ '5'
     C                     MOVE 'P'       T1INST
     C                     ELSE
     C                     MOVE 'F'       T1INST
     C                     END
      *
     C                     END
      *
      ** INSTRUCTIONS TYPE AND SUB-TYPE
     C                     Z-ADD1         J       20
     C                     MOVELT1INST    WKINST  2
     C           WKINST    LOKUPECIN,J                   85
     C           *IN85     IFEQ '1'                        Found numeric.
     C                     MOVELECTA,J    MGINST
     C           T1INSS    IFNE *BLANKS
     C                     MOVELT1INSS    MGINSS
     C                     ELSE
     C                     MOVELECSA,J    MGINSS
     C                     END
     C                     ELSE                            Numeric not f.
      *
     C                     Z-ADD1         J       20
     C                     MOVE T1INST    WKINST
     C           WKINST    LOKUPECIN,J                   85
     C           *IN85     IFEQ '1'                        Found alpha
     C                     MOVELECTA,J    MGINST
     C                     MOVELECSA,J    MGINSS
     C                     ELSE                            Alpha not f.
      *
     C                     MOVELT1INST    MGINST
     C                     MOVELT1INSS    MGINSS
     C                     END
     C                     END
      *
     C           MGINSS    IFEQ ' BOOK'
     C                     MOVEL'BOOK '   MGINSS
     C                     END
      *
      ** SAFEKEEPING ACCOUNT
     C                     MOVELT1SAFA    MGSAFA
      *
      ** REQUESTED PRIORITY
     C                     MOVELT1RPTY    MGRPTY
      *
      ** TIME OF TRADE
     C                     MOVELT1TRTT    MGTRTT
      *
      ** GUARANTEED DELIVERY INDICATOR
     C                     MOVELT1GDEL    MGGDEL
      *
      ** FUNGIBILITY CODE
     C                     MOVELT1FCOD    MGFCOD
      *
      ** SENDERS ROLE
     C                     MOVELT1SROL    MGSROL
      *
      ** ACCOUNT WITH INSTITUTION & ACCOUNT WITH INSTITUTION A/C LINE
     C           TDTP      IFEQ 'TP'
     C           CLTY      ANDEQ'4'
     C***********WWDELF    ANDNEWWEOC                                     CSW003
     C***********CACLAS    ANDNE'E'                                 CSW003121495
     C           CACLAF    ANDNE'E'                                       121495
      *                                                                   121495
     C           TDTP      OREQ 'TP'                                      121495
     C           CLTY      ANDEQ'4'                                       121495
     C           CACLAS    ANDNE'E'                                       121495
     C           T1WHEN    ANDEQ'B'                                       121495
      *
     C           WWEXSS    IFEQ 'Y'
     C           T2AWIN    ANDNE*BLANKS
     C           WWEXSS    OREQ 'Y'
     C           T2AWIL    ANDNE*BLANKS
     C                     MOVELT2AWIA    MGAWIA
     C                     MOVELT2AWIN    MGAWIN
     C                     MOVELT2AWIL    MGAWIL
     C                     ELSE
      ** IF FOR ACCOUNT OF/PAY TO IS NOT BLANK                            092272
     C           TDFA      IFNE *BLANKS                                   092272
     C                     MOVELPAYT      MGAWIN                          092272
     C                     MOVEL*BLANKS   MGAWIL                          092272
     C                     ELSE                                           092272
      *
     C                     MOVELWWOA10    MGAWIN
     C                     MOVELWWOA35    MGAWIL
     C                     ENDIF                                          092272
     C                     END
      *
      ** IF MGAWIN OR MGAWIL ARE NOT BLANK
     C           MGAWIN    IFNE *BLANKS
     C           MGAWIL    ORNE *BLANKS
     C           T2AWIN    ORNE *BLANKS
     C           T2AWIL    ORNE *BLANKS
      *
      ** BENEFICIARY OF MONEY & BENEFICIARY OF MONEY A/C LINE
     C           WWEXSS    IFEQ 'Y'
     C           T2BOFN    ANDNE*BLANKS
     C           WWEXSS    OREQ 'Y'
     C           T2BOF1    ANDNE*BLANKS
     C                     MOVELT2BOFA    MGBOFA
     C                     MOVELT2BOFN    MGBOFN
     C                     MOVELT2BOF1    MGBOF1
     C                     MOVELT2BOF2    MGBOF2
     C                     ELSE
      *
      ** IF FOR ACCOUNT OF/PAY TO IS NOT BLANK
     C           TDFA      IFNE *BLANKS
     C                     MOVELTDFA      MGBOFN
     C                     ELSE
      *                                                                   093758
      ** If PAYT is not blank                                             093758
     C           PAYT      IFNE *BLANKS                                   093758
     C                     MOVELPAYT      MGBOFN
      *                                                                   093758
      ** If not able to format MGBOFN --> do not format MGAWIL            093758
     C                     ELSE                                           093758
     C                     MOVE *BLANKS   MGAWIA                          093758
     C                     MOVE *BLANKS   MGAWIN                          093758
     C                     MOVE *BLANKS   MGAWIL                          093758
     C                     END                                            093758
     C                     END
     C                     END
     C                     END
     C                     END
      *
      ** FURTHER INFORMATION
      ** REGISTRATIONS DETAILS
      ** NARRATIVE
     C           WWEXSS    IFEQ 'Y'
     C                     MOVELT2FIN1    MGFIN1
     C                     MOVELT2FIN2    MGFIN2
     C                     MOVELT2RED1    MGRED1
     C                     MOVELT2RED2    MGRED2
     C                     MOVELT2NAL1    MGNAL1
     C                     MOVELT2NAL2    MGNAL2
     C                     END
      *
      ** CLEARING CORRESPONDENT
     C           WWEXSS    IFEQ 'Y'
     C           T2CCTN    ANDNE*BLANKS
     C                     MOVELT2CCTN    MGCCTN
     C                     ELSE
      *
     C           CLTY      IFEQ '1'                        Internal EOC
     C***********CLTY      OREQ '2'                                       113207
     C***********          MOVELCSIDEO    MGCCTN                          183583
     C                     MOVELWWEOC     MGCCTN                          183583
     C                     END
     C           CLTY      IFEQ '3'                        Internal EOC
     C***********CLTY      OREQ '4'                                       113207
     C***********          MOVELCSIDCE    MGCCTN                          183583
     C                     MOVELWWCEDL    MGCCTN                          183583
     C                     END
     C/COPY WNCPYSRC,SE1871C034
      *
     C           CLTY      IFEQ '2'                        Bridge EOC
     C           TDTP      IFEQ 'TP'
     C***********WWDELF    ANDEQWWCEDL                                    CSW003
     C***********CACLAS    ANDEQ'C'                                 CSW003121495
     C           CACLAF    ANDEQ'C'                                       121495
     C           TDTP      OREQ 'TS'
     C***********WWDELT    ANDEQWWCEDL                                    CSW003
     C***********CACLAS    ANDEQ'C'                                 CSW003121495
     C           CACLAT    ANDEQ'C'                                       121495
      *                                                                   121495
     C           TDTP      OREQ 'TP'                                      121495
     C           CACLAS    ANDEQ'C'                                       121495
     C           T1WHEN    ANDEQ'B'                                       121495
     C           TDTP      OREQ 'TS'                                      121495
     C           CACLAS    ANDEQ'C'                                       121495
     C           T1WHEN    ANDEQ'B'                                       121495
      *                                                                   121495
     C***********          MOVELCSIDCE    MGCCTN                          183583
     C                     MOVELWWCEDL    MGCCTN                          183583
     C/COPY WNCPYSRC,SE1871C035
     C                     ELSE                                           113207
     C           TDTP      IFEQ 'TP'                                      113207
     C                     MOVELWWDELF    MGCCTN                          113207
     C                     ELSE                                           113207
     C                     MOVELWWDELT    MGCCTN                          113207
     C                     END                                            113207
     C/COPY WNCPYSRC,SE1871C036
     C                     END
     C                     END
      *
     C           CLTY      IFEQ '4'                        Bridge Cedel
     C           TDTP      IFEQ 'TP'
     C***********WWDELF    ANDEQWWEOC                                     CSW003
     C***********CACLAS    ANDEQ'E'                                 CSW003121495
     C           CACLAF    ANDEQ'E'                                       121495
     C           TDTP      OREQ 'TS'
     C***********WWDELT    ANDEQWWEOC                                     CSW003
     C***********CACLAS    ANDEQ'E'                                 CSW003121495
     C           CACLAT    ANDEQ'E'                                       121495
      *                                                                   121495
     C           TDTP      OREQ 'TP'                                      121495
     C           CACLAS    ANDEQ'E'                                       121495
     C           T1WHEN    ANDEQ'B'                                       121495
     C           TDTP      OREQ 'TS'                                      121495
     C           CACLAS    ANDEQ'E'                                       121495
     C           T1WHEN    ANDEQ'B'                                       121495
      *                                                                   121495
     C***********          MOVELCSIDEO    MGCCTN                          183583
     C                     MOVELWWEOC     MGCCTN                          183583
     C/COPY WNCPYSRC,SE1871C037
     C                     ELSE                                           113207
     C           TDTP      IFEQ 'TP'                                      113207
     C                     MOVELWWDELF    MGCCTN                          113207
     C                     ELSE                                           113207
     C                     MOVELWWDELT    MGCCTN                          113207
     C                     END                                            113207
     C/COPY WNCPYSRC,SE1871C038
     C                     END
     C                     END
      *
     C           T1INST    IFEQ '03K'                      AKV
     C           T1INST    OREQ '07K'
     C***********          MOVELCSIDAK    MGCCTN                          183583
     C                     MOVELWWAKV     MGCCTN                          183583
     C                     END
      *
     C                     END
      *
      ** DELIVERERS INSTRUCTING PARTY A/C LINE
     C           WWEXSS    IFEQ 'Y'
     C           T2DCTL    ANDNE*BLANKS
     C           TDTP      ANDEQ'TP'
     C                     MOVELT2DCTL    MGDIPL
     C                     END
      *
      ** RECEIVER OF SECURITIES & RECEIVER OF SECURITIES A/C LINE
     C           TDTP      IFEQ 'TS'
      *
     C           WWEXSS    IFEQ 'Y'
     C           T2RSSN    ANDNE*BLANKS
     C           WWEXSS    OREQ 'Y'
     C           T2RSS1    ANDNE*BLANKS
     C                     MOVELT2RSSA    MGRSSA
     C                     MOVELT2RSSN    MGRSSN
     C                     MOVELT2RSS1    MGRSS1
     C                     MOVELT2RSS2    MGRSS2
     C                     MOVELT2RSS3    MGRSS3
     C                     MOVELT2RSS4    MGRSS4
     C                     ELSE
      *
     C           T1EUCL    IFEQ *BLANKS
     C***********          MOVELTCNR      MGRSSN                          089961
     C                     MOVELDELT      MGRSSN                          089961
     C                     ELSE
      *
     C                     MOVELT1EUCL    MGRSS1
      *
     C***********MGDEST    IFEQ WWEOC6                     Euroclear      CSW003
     C           WWDCLS    IFEQ 'E'                        Euroclear      CSW003
     C           T1INST    IFNE '03C'
     C           T1INST    ANDNE'07C'
     C           T1INST    ANDNE'BRI'                                     087827
     C                     MOVELT1EUCL    EU10
     C           EU0104    IFEQ '//XE'
     C           EU0104    OREQ '//XC'
     C                     MOVE EU10      WKEU06  6
     C                     MOVE *BLANKS   EU10
     C                     MOVE '/'       EU0101
     C                     MOVELWKEU06    EU0207
     C                     MOVELEU10      MGRSS1
     C                     END
     C                     END
     C                     END
      *
     C           MGINSS    IFEQ 'PHYSI'
     C***********          MOVELTCNR      MGRSSN                          089961
     C                     MOVELDELT      MGRSSN                          089961
     C                     END
      *
     C                     END
      *
     C                     END
     C                     END
      *
      ** DELIVERER OF SECURITIES & DELIVERER OF SECURITIES A/C LINE
     C           TDTP      IFEQ 'TP'
      *
     C           WWEXSS    IFEQ 'Y'
     C           T2DSSN    ANDNE*BLANKS
     C           WWEXSS    OREQ 'Y'
     C           T2DSS1    ANDNE*BLANKS
     C                     MOVELT2DSSA    MGDSSA
     C                     MOVELT2DSSN    MGDSSN
     C                     MOVELT2DSS1    MGDSS1
     C                     MOVELT2DSS2    MGDSS2
     C                     MOVELT2DSS3    MGDSS3
     C                     MOVELT2DSS4    MGDSS4
     C                     ELSE
      *
     C           T1EUCL    IFEQ *BLANKS
     C***********          MOVELTCNR      MGDSSN                          089961
     C                     MOVELDELF      MGRSSN                          089961
     C                     ELSE
      *
     C                     MOVELT1EUCL    MGDSS1
      *
     C***********MGDEST    IFEQ WWEOC6                     Euroclear      CSW003
     C           WWDCLS    IFEQ 'E'                         Euroclear     CSW003
     C           T1INST    IFNE '03C'
     C           T1INST    ANDNE'07C'
     C           T1INST    ANDNE'BRI'                                     087827
     C                     MOVELT1EUCL    EU10
     C           EU0104    IFEQ '//XE'
     C           EU0104    OREQ '//XC'
     C                     MOVE EU10      WKEU06  6
     C                     MOVE *BLANKS   EU10
     C                     MOVE '/'       EU0101
     C                     MOVELWKEU06    EU0207
     C                     MOVELEU10      MGDSS1
     C                     END
     C                     END
     C                     END
      *
     C           MGINSS    IFEQ 'PHYSI'
     C***********          MOVELTCNR      MGDSSN                          089961
     C                     MOVELDELF      MGRSSN                          089961
     C                     END
      *
     C                     END
      *
     C                     END
     C                     END
      *
      ** BENEFICIARY OF SECURITIES & BENEFICIARY OF SECURITIES A/C LINE
     C           WWEXSS    IFEQ 'Y'
     C           T2BSSN    ANDNE*BLANKS
     C           WWEXSS    OREQ 'Y'
     C           T2BSS1    ANDNE*BLANKS
     C                     MOVELT2BSSA    MGBSSA
     C                     MOVELT2BSSN    MGBSSN
     C                     MOVELT2BSS1    MGBSS1
     C                     MOVELT2BSS2    MGBSS2
     C                     ELSE
      *
     C           TDTP      IFEQ 'TS'
     C           CLTY      ANDEQ'2'
     C           TDTP      OREQ 'TS'
     C           CLTY      ANDEQ'4'
      *
     C           DTFA      IFNE *BLANKS
     C                     MOVELDTFA      MGBSSN
     C                     ELSE
      *
     C           WCLAS     IFEQ 'S'                                       103853
     C           WCLAS     OREQ 'D'                                       103952
     C                     MOVELTCNR      MGBSSN                          103852
     C                     END                                            103852
     C***********DELT      IFEQ WWEOC6                                    CSW003
     C***********CACLAS    IFEQ 'E'                                CSW003 103852
     C***********          MOVELWWTCNE    MGBSSN                          103852
     C***********          ELSE                                           103852
     C***********DELT      IFEQ WWCDL6                                    CSW003
     C***********CACLAS    IFEQ 'C'                                CSW003 103852
     C***********          MOVELWWTCNC    MGBSSN                          103852
     C***********          END                                            103852
     C***********          END                                            103852
     C                     END
      *
     C                     END
     C                     END
      *                                                                   CEU005
     C           CEU005    IFEQ 'Y'                                       CEU005
     C           ICCY      IFNE *BLANKS                                   CEU005
     C           ICCY      IFEQ TNMC                                      CEU005
      * Set up the original transaction amount as the countervalue in     CEU005
      * nominal currency                                                  CEU005
     C                     Z-ADDTCTR      MGOTRA                          CEU005
      * Set up the original transaction currency as the nominal currency  CEU005
     C                     MOVE TNMC      MGOTRC                          CEU005
     C                     ELSE                                           CEU005
      * Set up the original transaction amount as the countervalue in     CEU005
      * nominal currency converted to the 'In' currency in field 72       CEU005
     C                     CALL 'EU0200'                                  CEU005
     C                     PARM *BLANK    P@RTCD  7        Return Code    CEU005
     C                     PARM TCTR      P@FRAM 183       FROM Ccy AmountCEU005
     C                     PARM TNMC      P@FRCY  3        FROM Currency  CEU005
     C                     PARM ICCY      P@TOCY  3        TO Currency    CEU005
     C                     PARM           P@OUTA 150       Outright AmountCEU005
     C                     PARM           P@INTA 183       Interim Amount CEU005
     C                     PARM           P@EXRT 159       Exchange Rate  CEU005
     C                     PARM           P@MDIN  1        Mult/Div Ind.  CEU005
     C                     MOVE P@OUTA    MGOTRA    P                     CEU005
      * Set up the original transaction currency as the 'In' currency     CEU005
     C                     MOVE ICCY      MGOTRC                          CEU005
     C                     ENDIF                                          CEU005
     C                     ENDIF                                          CEU005
     C                     ENDIF                                          CEU005
      *
      ** WRITE A RECORD TO PF/MGF580PD
     C*                                                                   CSE029
     C** If New ISO15022 is needed then donot output MT580                CSE029
     C*                                                                   CSE029
     C           T1NEW     IFNE 'Y'                                       CSE029
      *                                                                                       CSW202
      ** Bypass writing of record if SWIFT 2002 is installed                                  CSW202
      *                                                                                       CSW202
     C           CSW202    ANDNE'Y'                                                           CSW202
      *                                                                                       CSW202
     C                     WRITEMGF580D0               79
      *
      ** CHECK RECORD SUCCESSFULLY WRITTEN TO FILE
     C           *IN79     IFEQ '1'
     C                     MOVEL'025'     DBASE            **************
     C                     MOVEL'MGF580PD'DBFILE           * DB ERROR 25*
     C                     MOVE *BLANKS   DBKEY            **************
     C                     EXSR *PSSR
     C                     END
     C                     ENDIF                                          CSE029
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/FMTISO                                                    CSE029
      *****************************************************************   CSE029
      *                                                               *   CSE029
      *    FMTISO    - FORMAT FIELDS SPECIFIC TO ISO15022             *   CSE029
      *                                                               *   CSE029
      *    CALLED BY - MSGST                                          *   CSE029
      *    CALLS     -                                                *   CSE029
      *                                                               *   CSE029
      *****************************************************************   CSE029
      *                                                                   CSE029
     C           FMTISO    BEGSR                                          CSE029
      *                                                                   CSE029
      ** Set up transaction reference.                                    CSE029
      *                                                                   CSE029
     C                     MOVE TDRF      MGTREF                          CSE029
      *                                                                   CSE029
      ** Set up SWIFT Sequence number                                     CSE029
      *                                                                   CSE029
     C           T1LSWS    ADD  1         MGTSEQ                          CSE029
      *                                                                   CSE029
      ** Setting up ISO15022 message Type                                 CSE029
      *                                                                   CSE029
     C           WTYP      IFEQ '580'                                     CSE029
     C                     MOVE MGF231    MGTYPE                          CSE029
     C                     ENDIF                                          CSE029
     C           WTYP      IFEQ '520'                                     CSE029
     C                     MOVE 'RECFREE' MGTYPE                          CSE029
     C                     ENDIF                                          CSE029
     C           WTYP      IFEQ '521'                                     CSE029
     C                     MOVE 'RECAPMT' MGTYPE                          CSE029
     C                     ENDIF                                          CSE029
     C           WTYP      IFEQ '522'                                     CSE029
     C                     MOVE 'DELFREE' MGTYPE                          CSE029
     C                     ENDIF                                          CSE029
     C           WTYP      IFEQ '522'                                     CSE029
     C                     MOVE 'DELAPMT' MGTYPE                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
      ** Determine classification of Counterparty                         CSE029
      *                                                                   CSE029
     C                     MOVELTCNR      WWCUST                          CSE029
      *                                                                   CSE029
     C                     CALL 'AOSECSR0'                                CSE029
     C                     PARM *BLANKS   WRTCD                           CSE029
     C                     PARM '*KEY   ' WOPTN                           CSE029
     C                     PARM           WWCUST                          CSE029
     C           SDSECS    PARM SDSECS    DSSDY                           CSE029
      *                                                                   CSE029
     C           WRTCD     IFEQ *BLANKS                                   CSE029
     C                     MOVE BFCLAS    MGCCLS                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
      ** Determine classification of From Depot                           CSE029
      *                                                                   CSE029
     C                     MOVELDELF      WWCUST                          CSE029
      *                                                                   CSE029
     C                     CALL 'AOSECSR0'                                CSE029
     C                     PARM *BLANKS   WRTCD                           CSE029
     C                     PARM '*KEY   ' WOPTN                           CSE029
     C                     PARM           WWCUST                          CSE029
     C           SDSECS    PARM SDSECS    DSSDY                           CSE029
      *                                                                   CSE029
     C           WRTCD     IFEQ *BLANKS                                   CSE029
     C                     MOVE BFCLAS    MGFCLS                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
      ** Determine classification of To Depot                             CSE029
      *                                                                   CSE029
     C                     MOVELDELT      WWCUST                          CSE029
      *                                                                   CSE029
     C                     CALL 'AOSECSR0'                                CSE029
     C                     PARM *BLANKS   WRTCD                           CSE029
     C                     PARM '*KEY   ' WOPTN                           CSE029
     C                     PARM           WWCUST                          CSE029
     C           SDSECS    PARM SDSECS    DSSDY                           CSE029
      *                                                                   CSE029
     C           WRTCD     IFEQ *BLANKS                                   CSE029
     C                     MOVE BFCLAS    MGTCLS                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
      ***Set*up*message*reference*prefix*********************      CSE029 200292
      ** Set up system prefix                                             200292
      *                                                                   CSE029
     C***********          MOVE 'SET'     MGPFIX                   CSE029 200292
     C                     MOVELSPREFX    MGPFIX                          200292
      *                                                                   CSE029
      ** Set up Security processing Type                                  CSE029
      *                                                                   CSE029
     C                     MOVE PROT      MGPROT                          CSE029
      *                                                                   CSE029
      ** Set up Market Centre                                             CSE029
      *                                                                   CSE029
     C                     MOVE SWMKTC    MGSMKC                          CSE029
     C                     MOVE MCTY      MGMCTY                          CSE029
     C                     MOVE TKSECD    MGTMCD                          CSE029
      *                                                                   CSE029
      ** If last change type for the depot movement is not equal to 'D'   CSE029
      ** then treat all transaction as amend.                             CSE029
      *                                                                   CSE029
     C           WTCHTP    IFNE 'D'                                       CSE029
     C                     MOVE 'A'       MGTSTS                          CSE029
     C                     ELSE                                           CSE029
     C                     MOVE 'D'       MGTSTS                          CSE029
     C                     END                                            CSE029
      *                                                                   CSE029
      ** Set up Intermediary for download if short name/customer          CSE029
      ** number is being used.                                            CSE029
      *                                                                   CSE029
     C                     MOVE *BLANKS   WCUST                                               205141
     C           T2IMD1    IFNE *BLANKS                                   CSE029
     C                     MOVELT2IMD1    WCUST                           CSE029
     C                     CALL 'AOCUSTR0'                                CSE029
     C                     PARM *BLANKS   WRTCD                           CSE029
     C                     PARM '*KEY   ' WOPTN                           CSE029
     C                     PARM           WCUST  10                       CSE029
     C                     PARM *BLANKS   WKYST   7                       CSE029
     C           SDCUST    PARM SDCUST    DSSDY                           CSE029
      *                                                                   CSE029
     C           WRTCD     IFEQ *BLANKS                                   CSE029
     C                     MOVE BBCUST    MGIMD1                          CSE029
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
     C                     MOVE *BLANKS   WCUST                                               205141
     C           T2IMD2    IFNE *BLANKS                                   CSE029
     C                     MOVELT2IMD2    WCUST                           CSE029
     C                     CALL 'AOCUSTR0'                                CSE029
     C                     PARM *BLANKS   WRTCD                           CSE029
     C                     PARM '*KEY   ' WOPTN                           CSE029
     C                     PARM           WCUST  10                       CSE029
     C                     PARM *BLANKS   WKYST   7                       CSE029
     C           SDCUST    PARM SDCUST    DSSDY                           CSE029
      *                                                                   CSE029
     C           WRTCD     IFEQ *BLANKS                                   CSE029
     C                     MOVE BBCUST    MGIMD2                          CSE029
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
     C                     MOVE *BLANKS   WCUST                                               205141
     C           T2IMD3    IFNE *BLANKS                                   CSE029
     C                     MOVELT2IMD3    WCUST                           CSE029
     C                     CALL 'AOCUSTR0'                                CSE029
     C                     PARM *BLANKS   WRTCD                           CSE029
     C                     PARM '*KEY   ' WOPTN                           CSE029
     C                     PARM           WCUST  10                       CSE029
     C                     PARM *BLANKS   WKYST   7                       CSE029
     C           SDCUST    PARM SDCUST    DSSDY                           CSE029
      *                                                                   CSE029
     C           WRTCD     IFEQ *BLANKS                                   CSE029
     C                     MOVE BBCUST    MGIMD3                          CSE029
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
     C                     MOVE *BLANKS   WCUST                                               205141
     C           T2IMD4    IFNE *BLANKS                                   CSE029
     C                     MOVELT2IMD4    WCUST                           CSE029
     C                     CALL 'AOCUSTR0'                                CSE029
     C                     PARM *BLANKS   WRTCD                           CSE029
     C                     PARM '*KEY   ' WOPTN                           CSE029
     C                     PARM           WCUST  10                       CSE029
     C                     PARM *BLANKS   WKYST   7                       CSE029
     C           SDCUST    PARM SDCUST    DSSDY                           CSE029
      *                                                                   CSE029
     C           WRTCD     IFEQ *BLANKS                                   CSE029
     C                     MOVE BBCUST    MGIMD4                          CSE029
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
     C                     MOVE *BLANKS   WCUST                                               205141
     C           T2IMD5    IFNE *BLANKS                                   CSE029
     C                     MOVELT2IMD5    WCUST                           CSE029
     C                     CALL 'AOCUSTR0'                                CSE029
     C                     PARM *BLANKS   WRTCD                           CSE029
     C                     PARM '*KEY   ' WOPTN                           CSE029
     C                     PARM           WCUST  10                       CSE029
     C                     PARM *BLANKS   WKYST   7                       CSE029
     C           SDCUST    PARM SDCUST    DSSDY                           CSE029
      *                                                                   CSE029
     C           WRTCD     IFEQ *BLANKS                                   CSE029
     C                     MOVE BBCUST    MGIMD5                          CSE029
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
     C                     MOVE *BLANKS   WCUST                                               205141
     C           T2IMD6    IFNE *BLANKS                                   CSE029
     C                     MOVELT2IMD6    WCUST                           CSE029
     C                     CALL 'AOCUSTR0'                                CSE029
     C                     PARM *BLANKS   WRTCD                           CSE029
     C                     PARM '*KEY   ' WOPTN                           CSE029
     C                     PARM           WCUST  10                       CSE029
     C                     PARM *BLANKS   WKYST   7                       CSE029
     C           SDCUST    PARM SDCUST    DSSDY                           CSE029
      *                                                                   CSE029
     C           WRTCD     IFEQ *BLANKS                                   CSE029
     C                     MOVE BBCUST    MGIMD6                          CSE029
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
     C                     MOVE *BLANKS   WCUST                                               205141
     C           T2IMD7    IFNE *BLANKS                                   CSE029
     C                     MOVELT2IMD7    WCUST                           CSE029
     C                     CALL 'AOCUSTR0'                                CSE029
     C                     PARM *BLANKS   WRTCD                           CSE029
     C                     PARM '*KEY   ' WOPTN                           CSE029
     C                     PARM           WCUST  10                       CSE029
     C                     PARM *BLANKS   WKYST   7                       CSE029
     C           SDCUST    PARM SDCUST    DSSDY                           CSE029
      *                                                                   CSE029
     C           WRTCD     IFEQ *BLANKS                                   CSE029
     C                     MOVE BBCUST    MGIMD7                          CSE029
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
     C                     MOVE *BLANKS   WCUST                                               205141
     C           T2IMD8    IFNE *BLANKS                                   CSE029
     C                     MOVELT2IMD8    WCUST                           CSE029
     C                     CALL 'AOCUSTR0'                                CSE029
     C                     PARM *BLANKS   WRTCD                           CSE029
     C                     PARM '*KEY   ' WOPTN                           CSE029
     C                     PARM           WCUST  10                       CSE029
     C                     PARM *BLANKS   WKYST   7                       CSE029
     C           SDCUST    PARM SDCUST    DSSDY                           CSE029
      *                                                                   CSE029
     C           WRTCD     IFEQ *BLANKS                                   CSE029
     C                     MOVE BBCUST    MGIMD8                          CSE029
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
     C                     MOVE *BLANKS   WCUST                                               205141
     C           T2IMD9    IFNE *BLANKS                                   CSE029
     C                     MOVELT2IMD9    WCUST                           CSE029
     C                     CALL 'AOCUSTR0'                                CSE029
     C                     PARM *BLANKS   WRTCD                           CSE029
     C                     PARM '*KEY   ' WOPTN                           CSE029
     C                     PARM           WCUST  10                       CSE029
     C                     PARM *BLANKS   WKYST   7                       CSE029
     C           SDCUST    PARM SDCUST    DSSDY                           CSE029
      *                                                                   CSE029
     C           WRTCD     IFEQ *BLANKS                                   CSE029
     C                     MOVE BBCUST    MGIMD9                          CSE029
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
     C                     MOVE *BLANKS   WCUST                                               205141
     C           T2PSET    IFNE *BLANKS                                   CSE029
     C                     MOVELT2PSET    WCUST                           CSE029
     C                     CALL 'AOCUSTR0'                                CSE029
     C                     PARM *BLANKS   WRTCD                           CSE029
     C                     PARM '*KEY   ' WOPTN                           CSE029
     C                     PARM           WCUST  10                       CSE029
     C                     PARM *BLANKS   WKYST   7                       CSE029
     C           SDCUST    PARM SDCUST    DSSDY                           CSE029
      *                                                                   CSE029
     C           WRTCD     IFEQ *BLANKS                                   CSE029
     C                     MOVE BBCUST    MGPSET                          CSE029
     C                     MOVE BBCSID    MGPSBI                          200292
     C                     MOVE BBCNA1    MGPSL1                          200292
     C                     MOVE BBCNA2    MGPSL2                          200292
     C                     MOVE BBCNA3    MGPSL3                          200292
     C                     MOVE BBCNA4    MGPSL4                          200292
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
      ** Set Up charges SWIFT Code                                        CSE029
      *                                                                   CSE029
     C                     MOVE TNMC      @CCY    3                       CSE029
      *                                                                   CSE029
     C           TBCC      IFNE *BLANKS                                   CSE029
     C                     MOVE TBCC      @CCOM   2                       CSE029
      *                                                                   CSE029
     C                     CALL 'AOCHGTR0'                                CSE029
     C                     PARM *BLANKS   @RTCD                           CSE029
     C                     PARM '*KEY'    @OPTN                           CSE029
     C                     PARM           @CCY                            CSE029
     C                     PARM           @CCOM                           CSE029
     C***********SECGT     PARM SECGT     DSFDY                    CSE029 200292
     C           SECGT     PARM SECGT     DSSDY                           200292
      *                                                                   CSE029
     C***********@RTCD     IFNE *BLANK                             CSE029 200292
     C           @RTCD     IFEQ *BLANK                                    200292
     C                     MOVE SWID      MGBCCD                          CSE029
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
     C           TCCC      IFNE *BLANKS                                   CSE029
     C                     MOVE TCCC      @CCOM                           CSE029
      *                                                                   CSE029
     C                     CALL 'AOCHGTR0'                                CSE029
     C                     PARM *BLANKS   @RTCD                           CSE029
     C                     PARM '*KEY'    @OPTN                           CSE029
     C                     PARM           @CCY                            CSE029
     C                     PARM           @CCOM                           CSE029
     C***********SECGT     PARM SECGT     DSFDY                    CSE029 200292
     C           SECGT     PARM SECGT     DSSDY                           200292
      *                                                                   CSE029
     C***********@RTCD     IFNE *BLANK                             CSE029 200292
     C           @RTCD     IFEQ *BLANK                                    200292
     C                     MOVE SWID      MGCCCD                          CSE029
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
     C           TCC1      IFNE *BLANKS                                   CSE029
     C                     MOVE TCC1      @CCOM                           CSE029
      *                                                                   CSE029
     C                     CALL 'AOCHGTR0'                                CSE029
     C                     PARM *BLANKS   @RTCD                           CSE029
     C                     PARM '*KEY'    @OPTN                           CSE029
     C                     PARM           @CCY                            CSE029
     C                     PARM           @CCOM                           CSE029
     C***********SECGT     PARM SECGT     DSFDY                    CSE029 200292
     C           SECGT     PARM SECGT     DSSDY                           200292
      *                                                                   CSE029
     C***********@RTCD     IFNE *BLANK                             CSE029 200292
     C           @RTCD     IFEQ *BLANK                                    200292
     C                     MOVE SWID      MGCHG1                          CSE029
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
     C           TCC2      IFNE *BLANKS                                   CSE029
     C                     MOVE TCC2      @CCOM                           CSE029
      *                                                                   CSE029
     C                     CALL 'AOCHGTR0'                                CSE029
     C                     PARM *BLANKS   @RTCD                           CSE029
     C                     PARM '*KEY'    @OPTN                           CSE029
     C                     PARM           @CCY                            CSE029
     C                     PARM           @CCOM                           CSE029
     C***********SECGT     PARM SECGT     DSFDY                    CSE029 200292
     C           SECGT     PARM SECGT     DSSDY                           200292
      *                                                                   CSE029
     C***********@RTCD     IFNE *BLANK                             CSE029 200292
     C           @RTCD     IFEQ *BLANK                                    200292
     C                     MOVE SWID      MGCHG2                          CSE029
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
     C           TCC3      IFNE *BLANKS                                   CSE029
     C                     MOVE TCC3      @CCOM                           CSE029
      *                                                                   CSE029
     C                     CALL 'AOCHGTR0'                                CSE029
     C                     PARM *BLANKS   @RTCD                           CSE029
     C                     PARM '*KEY'    @OPTN                           CSE029
     C                     PARM           @CCY                            CSE029
     C                     PARM           @CCOM                           CSE029
     C***********SECGT     PARM SECGT     DSFDY                    CSE029 200292
     C           SECGT     PARM SECGT     DSSDY                           200292
      *                                                                   CSE029
     C***********@RTCD     IFNE *BLANK                             CSE029 200292
     C           @RTCD     IFEQ *BLANK                                    200292
     C                     MOVE SWID      MGCHG3                          CSE029
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
     C           TCC4      IFNE *BLANKS                                   CSE029
     C                     MOVE TCC4      @CCOM                           CSE029
      *                                                                   CSE029
     C                     CALL 'AOCHGTR0'                                CSE029
     C                     PARM *BLANKS   @RTCD                           CSE029
     C                     PARM '*KEY'    @OPTN                           CSE029
     C                     PARM           @CCY                            CSE029
     C                     PARM           @CCOM                           CSE029
     C***********SECGT     PARM SECGT     DSFDY                    CSE029 200292
     C           SECGT     PARM SECGT     DSSDY                           200292
      *                                                                   CSE029
     C***********@RTCD     IFNE *BLANK                             CSE029 200292
     C           @RTCD     IFEQ *BLANK                                    200292
     C                     MOVE SWID      MGCHG4                          CSE029
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
     C           TCC5      IFNE *BLANKS                                   CSE029
     C                     MOVE TCC5      @CCOM                           CSE029
      *                                                                   CSE029
     C                     CALL 'AOCHGTR0'                                CSE029
     C                     PARM *BLANKS   @RTCD                           CSE029
     C                     PARM '*KEY'    @OPTN                           CSE029
     C                     PARM           @CCY                            CSE029
     C                     PARM           @CCOM                           CSE029
     C***********SECGT     PARM SECGT     DSFDY                    CSE029 200292
     C           SECGT     PARM SECGT     DSSDY                           200292
      *                                                                   CSE029
     C***********@RTCD     IFNE *BLANK                             CSE029 200292
     C           @RTCD     IFEQ *BLANK                                    200292
     C                     MOVE SWID      MGCHG5                          CSE029
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
     C           TCC6      IFNE *BLANKS                                   CSE029
     C                     MOVE TCC6      @CCOM                           CSE029
      *                                                                   CSE029
     C                     CALL 'AOCHGTR0'                                CSE029
     C                     PARM *BLANKS   @RTCD                           CSE029
     C                     PARM '*KEY'    @OPTN                           CSE029
     C                     PARM           @CCY                            CSE029
     C                     PARM           @CCOM                           CSE029
     C***********SECGT     PARM SECGT     DSFDY                    CSE029 200292
     C           SECGT     PARM SECGT     DSSDY                           200292
      *                                                                   CSE029
     C***********@RTCD     IFNE *BLANK                             CSE029 200292
     C           @RTCD     IFEQ *BLANK                                    200292
     C                     MOVE SWID      MGCHG6                          CSE029
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
     C           TCC7      IFNE *BLANKS                                   CSE029
     C                     MOVE TCC7      @CCOM                           CSE029
      *                                                                   CSE029
     C                     CALL 'AOCHGTR0'                                CSE029
     C                     PARM *BLANKS   @RTCD                           CSE029
     C                     PARM '*KEY'    @OPTN                           CSE029
     C                     PARM           @CCY                            CSE029
     C                     PARM           @CCOM                           CSE029
     C***********SECGT     PARM SECGT     DSFDY                    CSE029 200292
     C           SECGT     PARM SECGT     DSSDY                           200292
      *                                                                   CSE029
     C***********@RTCD     IFNE *BLANK                             CSE029 200292
     C           @RTCD     IFEQ *BLANK                                    200292
     C                     MOVE SWID      MGCHG7                          CSE029
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
      ** Set up currency dec. point                                       CSE029
      *                                                                   CSE029
     C                     Z-ADDWWSTDP    MGSTDP                          CSE029
     C                     Z-ADDWWNMDP    MGITDP                          CSE029
     C           ICCY      IFNE *BLANK                                    CSE029
     C           ICCY      ANDNETNMC                                      CSE029
     C                     CALL 'AOCURRR0'                                CSE029
     C                     PARM '*MSG   ' WRTCD                           CSE029
     C                     PARM '*KEY   ' WOPTN                           CSE029
     C                     PARM ICCY      WCUCY   3                       CSE029
     C           SDCURR    PARM SDCURR    DSSDY                           CSE029
      *                                                                   CSE029
     C           WRTCD     IFNE *BLANKS                                   CSE029
     C                     Z-ADDA6NBDP    MGOTDP                          CSE029
     C                     ENDIF                                          CSE029
     C                     ELSE                                           CSE029
     C                     Z-ADDWWNMDP    MGOTDP                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   200292
      ** Setup Sender SWIFT ID for ISO15022 message                       200292
     C                     MOVE *BLANKS   WCUST                                               205141
     C                     MOVELWWBICN    WCUST                           200292
     C                     CALL 'AOCUSTR0'                                200292
     C                     PARM *BLANKS   WRTCD                           200292
     C                     PARM '*KEY   ' WOPTN                           200292
     C                     PARM           WCUST  10                       200292
     C                     PARM *BLANKS   WKYST   7                       200292
     C           SDCUST    PARM SDCUST    DSSDY                           200292
      *                                                                   200292
     C           WRTCD     IFEQ *BLANKS                                   200292
     C                     MOVE BBCSID    MGSNDI                          200292
     C                     ENDIF                                          200292
      *                                                                   200292
      ** Setup SWIFT currency code for settlement and nominal ccy         200292
      ** to be output to file.                                            200292
     C                     MOVE WWNCID    MGOTRC                          200292
     C                     MOVE WWSCID    MGSTCY                          200292
      *                                                                   200292
      ** A/C with Institution Detail                                      200292
     C                     MOVE *BLANKS   WCUST                                               205141
     C           T2AWIN    IFNE *BLANKS                                   200292
     C                     MOVELT2AWIN    WCUST                           200292
     C                     CALL 'AOCUSTR0'                                200292
     C                     PARM *BLANKS   WRTCD                           200292
     C                     PARM '*KEY   ' WOPTN                           200292
     C                     PARM           WCUST  10                       200292
     C                     PARM *BLANKS   WKYST   7                       200292
     C           SDCUST    PARM SDCUST    DSSDY                           200292
      *                                                                   200292
     C           WRTCD     IFEQ *BLANKS                                   200292
     C                     MOVE BBCSID    MGAWBI                          200292
     C                     MOVE BBCNA1    MGAWL1                          200292
     C                     MOVE BBCNA2    MGAWL2                          200292
     C                     MOVE BBCNA3    MGAWL3                          200292
     C                     MOVE BBCNA4    MGAWL4                          200292
     C                     ENDIF                                          200292
     C                     ENDIF                                          200292
      *                                                                                     AR589164
      ** A/C with Institution account line                                                  AR589164
     C           T2AWIL    IFNE *BLANKS                                                     AR589164
     C                     MOVELT2AWIL    WDRAB                                             AR589164
     C           WP0102    IFEQ '//'                                                        AR589164
     C                     CALL 'AOCCSYR0'                                                  AR589164
     C                     PARM *BLANKS   WRTCD                                             AR589164
     C                     PARM '*KEY   ' WOPTN                                             AR589164
     C                     PARM NMCY      CYCD    3                                         AR589164
     C                     PARM WP0304    CLSY    2                                         AR589164
     C           SDCCSY    PARM SDCCSY    DSFDY                                             AR589164
      *                                                                                     AR589164
     C           WRTCD     IFNE *BLANKS                                                     AR589164
     C                     Z-ADD028       DBASE                                             AR589164
     C                     MOVEL'SDCCSYPD'DBFILE                                            AR589164
     C                     MOVELWP0304    DBKEY                                             AR589164
     C                     EXSR *PSSR                                                       AR589164
     C                     ENDIF                                                            AR589164
      *                                                                                     AR589164
     C           DPISCD    IFNE *BLANKS                                                     AR589164
      *                                                                                     AR589164
      ** Format Account with Institution account line                                       AR589164
      *                                                                                     AR589164
     C                     MOVE *BLANKS   LGDSS  10                                         AR589164
      *                                                                                     AR589164
     C           NMCY      IFEQ 'EUR'                                                       AR589164
     C           DPISCD    IFEQ 'LATI'                                                      AR589164
     C                     MOVEL'IBRCLATI'LGDSS                                             AR589164
     C                     ENDIF                                                            AR589164
     C                     ENDIF                                                            AR589164
      *                                                                                     AR589164
     C           NMCY      IFEQ 'USD'                                                       AR589164
     C                     SELEC                                                            AR589164
     C           DPISCD    WHEQ 'USCH'                                                      AR589164
     C                     MOVEL'NYCHUSCH'LGDSS                                             AR589164
     C           DPISCD    WHEQ 'USCP'                                                      AR589164
     C                     MOVEL'NYCHUSCP'LGDSS                                             AR589164
     C           DPISCD    WHEQ 'FINS'                                                      AR589164
     C                     MOVEL'DTCYFINS'LGDSS                                             AR589164
     C           DPISCD    WHEQ 'PART'                                                      AR589164
     C                     MOVEL'DTCYPART'LGDSS                                             AR589164
     C           DPISCD    WHEQ 'USER'                                                      AR589164
     C                     MOVEL'DTCYUSER'LGDSS                                             AR589164
     C           DPISCD    WHEQ 'ID  '                                                      AR589164
     C                     MOVEL'DTCYID'  LGDSS                                             AR589164
     C                     ENDSL                                                            AR589164
     C                     ENDIF                                                            AR589164
     C                     MOVE *BLANKS   MGAWL1                                            AR589164
     C                     MOVE *BLANKS   MGAWL2                                            AR589164
     C                     MOVE *BLANKS   MGAWL3                                            AR589164
     C                     MOVE *BLANKS   MGAWL4                                            AR589164
     C********** '/'       CAT  DPISCD:0  MGAWL1                                  AR589164 AR589164A
     C********** MGAWL1    CAT  '/':0     MGAWL1                                  AR589164 AR589164A
     C********** LGDSS     IFEQ *BLANKS                                           AR589164 AR589164A
     C********** MGAWL1    CAT  WP0535:0  MGAWL1                                  AR589164 AR589164A
     C**********           ELSE                                                   AR589164 AR589164A
     C********** MGAWL1    CAT  LGDSS:0   MGAWL1                                  AR589164 AR589164A
     C**********           ENDIF                                                  AR589164 AR589164A
     C           LGDSS     IFEQ *BLANKS                                                    AR589164A
     C           '/'       CAT  DPISCD:0  MGAWL1                                           AR589164A
     C                     ELSE                                                            AR589164A
     C           '/'       CAT  LGDSS:0   MGAWL1                                           AR589164A
     C                     ENDIF                                                           AR589164A
     C           MGAWL1    CAT  '/':0     MGAWL1                                           AR589164A
     C           MGAWL1    CAT  WP0535:0  MGAWL1                                           AR589164A
      *                                                                                     AR589164
     C                     ENDIF                                                            AR589164
     C                     ENDIF                                                            AR589164
     C                     ENDIF                                                            AR589164
      *                                                                   200292
      ** Custodian Detail                                                 200292
     C                     MOVE *BLANKS   WCUST                                               205141
     C           T2SKAN    IFNE *BLANKS                                   200292
     C                     MOVELT2SKAN    WCUST                           200292
     C                     CALL 'AOCUSTR0'                                200292
     C                     PARM *BLANKS   WRTCD                           200292
     C                     PARM '*KEY   ' WOPTN                           200292
     C                     PARM           WCUST  10                       200292
     C                     PARM *BLANKS   WKYST   7                       200292
     C           SDCUST    PARM SDCUST    DSSDY                           200292
      *                                                                   200292
     C           WRTCD     IFEQ *BLANKS                                   200292
     C                     MOVE BBCSID    MGCDBI                          200292
     C                     MOVE BBCNA1    MGCDL1                          200292
     C                     MOVE BBCNA2    MGCDL2                          200292
     C                     MOVE BBCNA3    MGCDL3                          200292
     C                     MOVE BBCNA4    MGCDL4                          200292
     C                     ENDIF                                          200292
     C                     ENDIF                                          200292
      *                                                                   200292
      ** Deliverer Detail                                                 200292
     C                     MOVE *BLANKS   WCUST                                               205141
     C           T2DSSN    IFNE *BLANKS                                   200292
     C                     MOVELT2DSSN    WCUST                           200292
     C                     CALL 'AOCUSTR0'                                200292
     C                     PARM *BLANKS   WRTCD                           200292
     C                     PARM '*KEY   ' WOPTN                           200292
     C                     PARM           WCUST  10                       200292
     C                     PARM *BLANKS   WKYST   7                       200292
     C           SDCUST    PARM SDCUST    DSSDY                           200292
      *                                                                   200292
     C           WRTCD     IFEQ *BLANKS                                   200292
     C                     MOVE BBCSID    MGDLBI                          200292
     C                     MOVE BBCNA1    MGDLL1                          200292
     C                     MOVE BBCNA2    MGDLL2                          200292
     C                     MOVE BBCNA3    MGDLL3                          200292
     C                     MOVE BBCNA4    MGDLL4                          200292
     C                     ENDIF                                          200292
     C                     ENDIF                                          200292
      *                                                                   200292
      ** Receiver Detail                                                  200292
     C                     MOVE *BLANKS   WCUST                                               205141
     C           T2RSSN    IFNE *BLANKS                                   200292
     C                     MOVELT2RSSN    WCUST                           200292
     C                     CALL 'AOCUSTR0'                                200292
     C                     PARM *BLANKS   WRTCD                           200292
     C                     PARM '*KEY   ' WOPTN                           200292
     C                     PARM           WCUST  10                       200292
     C                     PARM *BLANKS   WKYST   7                       200292
     C           SDCUST    PARM SDCUST    DSSDY                           200292
      *                                                                   200292
     C           WRTCD     IFEQ *BLANKS                                   200292
     C                     MOVE BBCSID    MGRRBI                          200292
     C                     MOVE BBCNA1    MGRRL1                          200292
     C                     MOVE BBCNA2    MGRRL2                          200292
     C                     MOVE BBCNA3    MGRRL3                          200292
     C                     MOVE BBCNA4    MGRRL4                          200292
     C                     ENDIF                                          200292
     C                     ENDIF                                          200292
      *                                                                   200292
      ** Beneficiary of security detail                                   200292
     C                     MOVE *BLANKS   WCUST                                               205141
     C           T2BSSN    IFNE *BLANKS                                   200292
     C                     MOVELT2BSSN    WCUST                           200292
     C                     CALL 'AOCUSTR0'                                200292
     C                     PARM *BLANKS   WRTCD                           200292
     C                     PARM '*KEY   ' WOPTN                           200292
     C                     PARM           WCUST  10                       200292
     C                     PARM *BLANKS   WKYST   7                       200292
     C           SDCUST    PARM SDCUST    DSSDY                           200292
      *                                                                   200292
     C           WRTCD     IFEQ *BLANKS                                   200292
     C                     MOVE BBCSID    MGBSBI                          200292
     C                     MOVE BBCNA1    MGBSL1                          200292
     C                     MOVE BBCNA2    MGBSL2                          200292
     C                     MOVE BBCNA3    MGBSL3                          200292
     C                     MOVE BBCNA4    MGBSL4                          200292
     C                     ENDIF                                          200292
     C                     ENDIF                                          200292
      *                                                                   200292
      ** Beneficiary of money detail                                      200292
     C                     MOVE *BLANKS   WCUST                                               205141
     C           T2BOFN    IFNE *BLANKS                                   200292
     C                     MOVELT2BOFN    WCUST                           200292
     C                     CALL 'AOCUSTR0'                                200292
     C                     PARM *BLANKS   WRTCD                           200292
     C                     PARM '*KEY   ' WOPTN                           200292
     C                     PARM           WCUST  10                       200292
     C                     PARM *BLANKS   WKYST   7                       200292
     C           SDCUST    PARM SDCUST    DSSDY                           200292
      *                                                                   200292
     C           WRTCD     IFEQ *BLANKS                                   200292
     C                     MOVE BBCSID    MGBMBI                          200292
     C                     MOVE BBCNA1    MGBML1                          200292
     C                     MOVE BBCNA2    MGBML2                          200292
     C                     MOVE BBCNA3    MGBML3                          200292
     C                     MOVE BBCNA4    MGBML4                          200292
     C                     ENDIF                                          200292
     C                     ENDIF                                          200292
      *                                                                                     AR589164
      ** Beneficiary of money account line                                                  AR589164
     C           T2BOF1    IFNE *BLANKS                                                     AR589164
     C                     MOVELT2BOF1    WDRAB                                             AR589164
     C           WP0102    IFEQ '//'                                                        AR589164
     C                     CALL 'AOCCSYR0'                                                  AR589164
     C                     PARM *BLANKS   WRTCD                                             AR589164
     C                     PARM '*KEY   ' WOPTN                                             AR589164
     C                     PARM NMCY      CYCD    3                                         AR589164
     C                     PARM WP0304    CLSY    2                                         AR589164
     C           SDCCSY    PARM SDCCSY    DSFDY                                             AR589164
      *                                                                                     AR589164
     C           WRTCD     IFNE *BLANKS                                                     AR589164
     C                     Z-ADD029       DBASE                                             AR589164
     C                     MOVEL'SDCCSYPD'DBFILE                                            AR589164
     C                     MOVELWP0304    DBKEY                                             AR589164
     C                     EXSR *PSSR                                                       AR589164
     C                     ENDIF                                                            AR589164
      *                                                                                     AR589164
     C           DPISCD    IFNE *BLANKS                                                     AR589164
      *                                                                                     AR589164
      ** Format Account with Institution account line                                       AR589164
      *                                                                                     AR589164
     C                     MOVE *BLANKS   LGDSS  10                                         AR589164
      *                                                                                     AR589164
     C           NMCY      IFEQ 'EUR'                                                       AR589164
     C           DPISCD    IFEQ 'LATI'                                                      AR589164
     C                     MOVEL'IBRCLATI'LGDSS                                             AR589164
     C                     ENDIF                                                            AR589164
     C                     ENDIF                                                            AR589164
      *                                                                                     AR589164
     C           NMCY      IFEQ 'USD'                                                       AR589164
     C                     SELEC                                                            AR589164
     C           DPISCD    WHEQ 'USCH'                                                      AR589164
     C                     MOVEL'NYCHUSCH'LGDSS                                             AR589164
     C           DPISCD    WHEQ 'USCP'                                                      AR589164
     C                     MOVEL'NYCHUSCP'LGDSS                                             AR589164
     C           DPISCD    WHEQ 'FINS'                                                      AR589164
     C                     MOVEL'DTCYFINS'LGDSS                                             AR589164
     C           DPISCD    WHEQ 'PART'                                                      AR589164
     C                     MOVEL'DTCYPART'LGDSS                                             AR589164
     C           DPISCD    WHEQ 'USER'                                                      AR589164
     C                     MOVEL'DTCYUSER'LGDSS                                             AR589164
     C           DPISCD    WHEQ 'ID  '                                                      AR589164
     C                     MOVEL'DTCYID'  LGDSS                                             AR589164
     C                     ENDSL                                                            AR589164
     C                     ENDIF                                                            AR589164
     C                     MOVE *BLANKS   MGBML1                                            AR589164
     C                     MOVE *BLANKS   MGBML2                                            AR589164
     C                     MOVE *BLANKS   MGBML3                                            AR589164
     C                     MOVE *BLANKS   MGBML4                                            AR589164
     C********** '/'       CAT  DPISCD:0  MGBML1                                  AR589164 AR589164A
     C********** MGBML1    CAT  '/':0     MGBML1                                  AR589164 AR589164A
     C********** LGDSS     IFEQ *BLANKS                                           AR589164 AR589164A
     C********** MGBML1    CAT  WP0535:0  MGBML1                                  AR589164 AR589164A
     C**********           ELSE                                                   AR589164 AR589164A
     C********** MGBML1    CAT  LGDSS:0   MGBML1                                  AR589164 AR589164A
     C**********           ENDIF                                                  AR589164 AR589164A
     C           LGDSS     IFEQ *BLANKS                                                    AR589164A
     C           '/'       CAT  DPISCD:0  MGBML1                                           AR589164A
     C                     ELSE                                                            AR589164A
     C           '/'       CAT  LGDSS:0   MGBML1                                           AR589164A
     C                     ENDIF                                                           AR589164A
     C           MGBML1    CAT  '/':0     MGBML1                                           AR589164A
     C           MGBML1    CAT  WP0535:0  MGBML1                                           AR589164A
      *                                                                                     AR589164
     C                     ENDIF                                                            AR589164
     C                     ENDIF                                                            AR589164
     C                     ENDIF                                                            AR589164
      *                                                                   200292
      ** Instructing Party detail                                         200292
     C                     MOVE *BLANKS   WCUST                                               205141
     C           T2IPYN    IFNE *BLANKS                                   200292
     C                     MOVELT2IPYN    WCUST                           200292
     C                     CALL 'AOCUSTR0'                                200292
     C                     PARM *BLANKS   WRTCD                           200292
     C                     PARM '*KEY   ' WOPTN                           200292
     C                     PARM           WCUST  10                       200292
     C                     PARM *BLANKS   WKYST   7                       200292
     C           SDCUST    PARM SDCUST    DSSDY                           200292
      *                                                                   200292
     C           WRTCD     IFEQ *BLANKS                                   200292
     C                     MOVE BBCSID    MGIPBI                          200292
     C                     MOVE BBCNA1    MGIPL1                          200292
     C                     MOVE BBCNA2    MGIPL2                          200292
     C                     MOVE BBCNA3    MGIPL3                          200292
     C                     MOVE BBCNA4    MGIPL4                          200292
     C                     ENDIF                                          200292
     C                     ENDIF                                          200292
      *                                                                   200292
      ** Set up link field for extension file                             200292
      *                                                                   200292
     C                     MOVE T1WHEN    MGWHEN                          200292
     C                     MOVE TDSS      MGDPSS                          200292
      *                                                                   200292
      ** Deliverer Instructing Party detail                               200292
     C                     MOVE *BLANKS   WCUST                                               205141
     C           T2DCTL    IFNE *BLANKS                                   200292
     C                     MOVELT2DCTL    WCUST                           200292
     C                     CALL 'AOCUSTR0'                                200292
     C                     PARM *BLANKS   WRTCD                           200292
     C                     PARM '*KEY   ' WOPTN                           200292
     C                     PARM           WCUST  10                       200292
     C                     PARM *BLANKS   WKYST   7                       200292
     C           SDCUST    PARM SDCUST    DSSDY                           200292
      *                                                                   200292
     C           WRTCD     IFEQ *BLANKS                                   200292
     C                     MOVE BBCSID    MGDIPI                          200292
     C                     MOVE BBCNA1    MGDIP1                          200292
     C                     MOVE BBCNA2    MGDIP2                          200292
     C                     MOVE BBCNA3    MGDIP3                          200292
     C                     MOVE BBCNA4    MGDIP4                          200292
     C                     ENDIF                                          200292
     C                     ENDIF                                          200292
      *                                                                                       CSW207
      ** check if valid UTC is valid for output                                               CSW207
      *                                                                                       CSW207
     C           CSW207    IFEQ 'Y'                                                           CSW207
     C           CSW208    OREQ 'Y'                                                           CSW208
     C           CSE029    ANDEQ'Y'                                                           CSW208
     C                     EXSR MFID                                                          CSW207
     C           WMFID     IFEQ 'Y'                                                           CSW207
      *                                                                                       CSW207
      ** format UTC                                                                           CSW207
      *                                                                                       CSW207
     C           A8TMOF    IFNE *ZEROS                                                        CSW207
     C                     MOVE A8TMOF    WTMOF   4                                           CSW207
     C           A8SIGN    IFEQ '-'                                                           CSW207
     C           'N'       CAT  WTMOF     WUTC    5                                           CSW207
     C                     ENDIF                                                              CSW207
     C           A8SIGN    IFEQ '+'                                                           CSW207
     C                     MOVELWTMOF     WUTC                                                CSW207
     C                     ENDIF                                                              CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
     C                     MOVE WUTC      MGMFID                                              CSW207
      *                                                                                       CSW207
      ** format for TRCA and INCA                                                             CSW207
      *                                                                                       CSW207
     C           BFCLAS    IFEQ 'M'                                                           CSW207
     C                     MOVE CSCPCI    MGTRCA                                              CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
     C           BFCLAS    IFEQ 'S'                                                           CSW207
     C           BFCLAS    OREQ 'D'                                                           CSW207
     C                     MOVE CSCICI    MGINCA                                              CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
      ** If SWIFT 2008 is installed                                                           CSW208
      *                                                                                       CSW208
     C           CSW208    IFEQ 'Y'                                                           CSW208
     C           CSE029    ANDEQ'Y'                                                           CSW208
     C                     Z-ADD*ZERO     PFRTM                                               CSW208
      *                                                                                       CSW208
     C           T1TRTT    IFEQ *BLANKS                                                       CSW208
     C                     Z-ADDTDDT      MGMKDT                                              CSW208
     C                     MOVE *ZEROS    MGMKTM                                              CSW208
     C                     MOVE *BLANKS   MGMKTO                                              CSW208
     C                     Z-ADDTDDT      MGLCDT                                              CSW208
     C                     MOVE *ZEROS    MGLCTM                                              CSW208
     C                     MOVE *BLANKS   MGLCTO                                              CSW208
     C                     ELSE                                                               CSW208
     C                     MOVELT1TRTT    PFRTM                                               CSW208
     C                     CALL 'ZADTMCVT'                                                    CSW208
     C                     PARM *BLANKS   PRTCD   7                                           CSW208
     C                     PARM 'S'       PFRTZ   1                                           CSW208
     C                     PARM           PFRTM                                               CSW208
     C                     PARM TDDT      FRDT    50                                          CSW208
     C**********           PARM *BLANKS   PMODL   2                                  CSW208 BUG20102
     C                     PARM 'SE'      PMODL   2                                         BUG20102
     C                     PARM TDBA      PBRCA   3                                           CSW208
     C**********           PARM *BLANKS   PMRKT   2                                  CSW208 BUG20102
     C                     PARM TMKC      PMRKT   2                                         BUG20102
     C                     PARM *BLANKS   PSESN  10                                           CSW208
     C**********           PARM MGSMKC    PMICC   4                                  CSW208 BUG20102
     C                     PARM *BLANKS   PMICC   4                                         BUG20102
     C                     PARM *ZEROS    PMKTM                                               CSW208
     C                     PARM *ZEROS    PMKDT   50                                          CSW208
     C                     PARM *ZEROS    PMKTOF                                              CSW208
     C                     PARM *BLANKS   PMKTOS  1                                           CSW208
     C                     PARM *ZEROS    PLCTM                                               CSW208
     C                     PARM *ZEROS    PLCDT   50                                          CSW208
     C                     PARM *ZEROS    PLCTOF                                              CSW208
     C                     PARM *BLANKS   PLCTOS  1                                           CSW208
     C                     PARM *ZEROS    PSYTM                                               CSW208
     C                     PARM *ZEROS    PSYDT   50                                          CSW208
     C                     PARM *ZEROS    PSYTOF                                              CSW208
     C                     PARM *BLANKS   PSYTOS  1                                           CSW208
      *                                                                                       CSW208
     C           PRTCD     IFEQ *BLANKS                                                       CSW208
     C                     Z-ADDPMKDT     MGMKDT                                              CSW208
     C                     Z-ADDPMKTM     MGMKTM                                              CSW208
     C                     Z-ADDPLCDT     MGLCDT                                              CSW208
     C                     MOVE PLCTM     MGLCTM                                              CSW208
     C                     MOVE *BLANKS   MGMKTO                                              CSW208
     C                     MOVE *BLANKS   MGLCTO                                              CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
      ** If Branch and Receiving Customer are MFID-compliant                                  CSW208
      *                                                                                       CSW208
     C           WMFID     IFEQ 'Y'                                                           CSW208
      *                                                                                       CSW208
      ** Set Offset at Market                                                                 CSW208
      *                                                                                       CSW208
     C                     MOVE PMKTOF    #WKTOF  4                                           CSW208
     C           PMKTOS    IFEQ '-'                                                           CSW208
     C           'N'       CAT  #WKTOF    MGMKTO                                              CSW208
     C                     ELSE                                                               CSW208
     C                     MOVEL#WKTOF    MGMKTO                                              CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C                     MOVE PLCTOF    #WCTOF  4                                           CSW208
     C           PLCTOS    IFEQ '-'                                                           CSW208
     C           'N'       CAT  #WCTOF    MGLCTO                                              CSW208
     C                     ELSE                                                               CSW208
     C                     MOVEL#WCTOF    MGLCTO                                              CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C                     ELSE                                                             BUG20102
      * Non Mifid Compliant.                                                                BUG20102
     C                     Z-ADD*ZEROS    MGMKDT                                            BUG20102
     C                     MOVE *ZEROS    MGMKTM                                            BUG20102
     C                     MOVE *BLANKS   MGMKTO                                            BUG20102
     C                     Z-ADD*ZEROS    MGLCDT                                            BUG20102
     C                     MOVE *ZEROS    MGLCTM                                            BUG20102
     C                     MOVE *BLANKS   MGLCTO                                            BUG20102
      *                                                                                     BUG20102
     C                     ENDIF                                                              CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW210
     C           CSW210    IFEQ 'Y'                                                           CSW210
      *                                                                                       CSW210
      ** Debtor ID entered                                                                    CSW210
      *                                                                                       CSW210
     C           T2DIDN    IFNE *BLANKS                                                       CSW210
     C                     CALL 'AOCUSTR1'                                                    CSW210
     C                     PARM *BLANKS   WRTCD                                               CSW210
     C                     PARM '*KEY   ' WOPTN                                               CSW210
     C                     PARM T2DIDN    WCUST                                               CSW210
     C                     PARM *BLANKS   WKYST                                               CSW210
     C           SDCUST    PARM SDCUST    DSLDY                                               CSW210
      *                                                                                       CSW210
      ** Debtor ID is Customer                                                                CSW210
      *                                                                                       CSW210
     C           WRTCD     IFEQ *BLANKS                                                       CSW210
     C                     MOVELBBCSID    MGDIBI                                              CSW210
     C                     MOVELBBCNA1    MGDAL1                                              CSW210
     C                     MOVELBBCNA2    MGDAL2                                              CSW210
     C                     MOVELBBCNA3    MGDAL3                                              CSW210
     C                     MOVELBBCNA4    MGDAL4                                              CSW210
     C                     ELSE                                                               CSW210
      *                                                                                       CSW210
     C                     CALL 'AOCNSTR0'                                                    CSW210
     C                     PARM *BLANKS   WRTCD                                               CSW210
     C                     PARM '*KEY   ' WOPTN                                               CSW210
     C                     PARM T2DIDN    WCNST   8                                           CSW210
     C           SDCNST    PARM SDCNST    DSFDY                                               CSW210
      *                                                                                       CSW210
      ** Debtor ID is Counterparty Nostro                                                     CSW210
      *                                                                                       CSW210
     C           WRTCD     IFEQ *BLANKS                                                       CSW210
     C                     MOVELAWSWID    MGDIBI                                              CSW210
     C                     MOVELAWCPNM    MGDAL1                                              CSW210
     C                     MOVELAWCNTN    MGDAL2                                              CSW210
     C                     MOVEL*BLANKS   MGDAL3                                              CSW210
     C                     MOVEL*BLANKS   MGDAL4                                              CSW210
     C                     ENDIF                                                              CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSW210
      ** Debtor Address entered                                                               CSW210
      *                                                                                       CSW210
     C                     ELSE                                                               CSW210
     C           T2DAD1    IFNE *BLANKS                                                       CSW210
     C           T2DAD2    ANDEQ*BLANKS                                                       CSW210
     C           T2DAD3    ANDEQ*BLANKS                                                       CSW210
     C           T2DAD4    ANDEQ*BLANKS                                                       CSW210
     C                     EXSR SRSWFT                                                        CSW210
      *                                                                                       CSW210
      ** SWIFT Address                                                                        CSW210
      *                                                                                       CSW210
     C           ##CSID    IFEQ 'Y'                                                           CSW210
     C                     MOVELT2DAD1    MGDIBI                                              CSW210
     C                     MOVEL*BLANKS   MGDAL1                                              CSW210
     C                     MOVEL*BLANKS   MGDAL2                                              CSW210
     C                     MOVEL*BLANKS   MGDAL3                                              CSW210
     C                     MOVEL*BLANKS   MGDAL4                                              CSW210
     C                     ELSE                                                               CSW210
      *                                                                                       CSW210
      ** Standard Address                                                                     CSW210
      *                                                                                       CSW210
     C                     MOVEL*BLANKS   MGDIBI                                              CSW210
     C                     MOVELT2DAD1    MGDAL1                                              CSW210
     C                     MOVEL*BLANKS   MGDAL2                                              CSW210
     C                     MOVEL*BLANKS   MGDAL3                                              CSW210
     C                     MOVEL*BLANKS   MGDAL4                                              CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSW210
     C                     ELSE                                                               CSW210
      *                                                                                       CSW210
      ** Standard Address                                                                     CSW210
      *                                                                                       CSW210
     C                     MOVEL*BLANKS   MGDIBI                                              CSW210
     C                     MOVELT2DAD1    MGDAL1                                              CSW210
     C                     MOVELT2DAD2    MGDAL2                                              CSW210
     C                     MOVELT2DAD3    MGDAL3                                              CSW210
     C                     MOVELT2DAD4    MGDAL4                                              CSW210
     C                     ENDIF                                                              CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSW210
      ** QFIN entered                                                                         CSW210
      *                                                                                       CSW210
     C           T2QFIN    IFNE *BLANKS                                                       CSW210
     C                     CALL 'AOCUSTR1'                                                    CSW210
     C                     PARM *BLANKS   WRTCD                                               CSW210
     C                     PARM '*KEY   ' WOPTN                                               CSW210
     C                     PARM T2QFIN    WCUST                                               CSW210
     C                     PARM *BLANKS   WKYST                                               CSW210
     C           SDCUST    PARM SDCUST    DSLDY                                               CSW210
      *                                                                                       CSW210
      ** QFIN is Customer                                                                     CSW210
      *                                                                                       CSW210
     C           WRTCD     IFEQ *BLANKS                                                       CSW210
     C                     MOVELBBCSID    MGQFBI                                              CSW210
     C                     MOVELBBCNA1    MGQAL1                                              CSW210
     C                     MOVELBBCNA2    MGQAL2                                              CSW210
     C                     MOVELBBCNA3    MGQAL3                                              CSW210
     C                     MOVELBBCNA4    MGQAL4                                              CSW210
     C                     ELSE                                                               CSW210
      *                                                                                       CSW210
     C                     CALL 'AOCNSTR0'                                                    CSW210
     C                     PARM *BLANKS   WRTCD                                               CSW210
     C                     PARM '*KEY   ' WOPTN                                               CSW210
     C                     PARM T2QFIN    WCNST                                               CSW210
     C           SDCNST    PARM SDCNST    DSFDY                                               CSW210
      *                                                                                       CSW210
      ** QFIN is Counterparty Nostro                                                          CSW210
      *                                                                                       CSW210
     C           WRTCD     IFEQ *BLANKS                                                       CSW210
     C                     MOVELAWSWID    MGQFBI                                              CSW210
     C                     MOVELAWCPNM    MGQAL1                                              CSW210
     C                     MOVELAWCNTN    MGQAL2                                              CSW210
     C                     MOVEL*BLANKS   MGQAL3                                              CSW210
     C                     MOVEL*BLANKS   MGQAL4                                              CSW210
     C                     ENDIF                                                              CSW210
     C                     ENDIF                                                              CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSW210
      ** Place of Clearing entered                                                            CSW210
      *                                                                                       CSW210
     C           T2PCLR    IFNE *BLANKS                                                       CSW210
     C                     CALL 'AOCUSTR1'                                                    CSW210
     C                     PARM *BLANKS   WRTCD                                               CSW210
     C                     PARM '*KEY   ' WOPTN                                               CSW210
     C                     PARM T2PCLR    WCUST                                               CSW210
     C                     PARM *BLANKS   WKYST                                               CSW210
     C           SDCUST    PARM SDCUST    DSLDY                                               CSW210
      *                                                                                       CSW210
      ** Place of Clearing is Customer                                                        CSW210
      *                                                                                       CSW210
     C           WRTCD     IFEQ *BLANKS                                                       CSW210
     C                     MOVELBBCSID    MGPCBI                                              CSW210
     C                     ELSE                                                               CSW210
      *                                                                                       CSW210
     C                     CALL 'AOCNSTR0'                                                    CSW210
     C                     PARM *BLANKS   WRTCD                                               CSW210
     C                     PARM '*KEY   ' WOPTN                                               CSW210
     C                     PARM T2PCLR    WCNST                                               CSW210
     C           SDCNST    PARM SDCNST    DSFDY                                               CSW210
      *                                                                                       CSW210
      ** Place of Clearing is Counterparty Nostro                                             CSW210
      *                                                                                       CSW210
     C           WRTCD     IFEQ *BLANKS                                                       CSW210
     C                     MOVELAWSWID    MGPCBI                                              CSW210
     C                     ENDIF                                                              CSW210
     C                     ENDIF                                                              CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSW210
     C                     ENDIF                                                              CSW210
      *                                                                   CSE029
      ** Output to extract file                                           CSE029
      *                                                                   CSE029
     C                     WRITEMGISOTD0               74                 CSE029
     C           *IN74     IFEQ '1'                                       CSE029
     C                     MOVEL'039'     DBASE            ************** CSE029
     C                     MOVEL'MGISOTPD'DBFILE           * DB ERROR 39* CSE029
     C                     MOVE *BLANKS   DBKEY            ************** CSE029
     C                     EXSR *PSSR                                     CSE029
     C                     END                                            CSE029
      *                                                                   CSE029
     C                     ENDSR                                          CSE029
      *                                                                   CSE029
      *****************************************************************   CSE029
      *****************************************************************                       CSW207
      /TITLE SR/MFID                                                                          CSW207
      *****************************************************************                       CSW207
      *                                                               *                       CSW207
      *    MFID      - Check if Sending branch and Destination        *                       CSW207
      *                Customer are MiFID compliant.                  *                       CSW207
      *                                                               *                       CSW207
      *    CALLED BY - FMTISO                                         *                       CSW207
      *    CALLS     -                                                *                       CSW207
      *                                                               *                       CSW207
      *****************************************************************                       CSW207
      *                                                                                       CSW207
     C           MFID      BEGSR                                                              CSW207
      *                                                                                       CSW207
      ** initialise work fields                                                               CSW207
      *                                                                                       CSW207
     C                     MOVE 'N'       WBRCH   1                                           CSW207
     C                     MOVE 'N'       WDEST   1                                           CSW207
     C                     MOVE 'N'       WMFID   1                                           CSW207
      *                                                                                       CSW207
      ** check if Sending Branch is MiFID complaint                                           CSW207
      *                                                                                       CSW207
     C           MGSNBR    IFNE *BLANKS                                                       CSW207
      *                                                                                       CSW207
     C                     CALL 'AOBRCHR1'                                                    CSW207
     C                     PARM '*MSG'    P@RTCD                                              CSW207
     C                     PARM '*KEY'    P@OPTN  7                                           CSW207
     C                     PARM MGSNBR    P@BRCD  3                                           CSW207
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CSW207
      *                                                                                       CSW207
      ** DATABASE ERROR                                                                       CSW207
      *                                                                                       CSW207
     C           P@RTCD    IFNE *BLANKS                                                       CSW207
     C                     MOVEL'040'     DBASE                                               CSW207
     C                     MOVEL'SDBRCHPD'DBFILE                                              CSW207
     C                     MOVELP@BRCD    DBKEY                                               CSW207
     C                     EXSR *PSSR                                                         CSW207
     C                     END                                                                CSW207
      *                                                                                     AR864763
      ** If location code is not blank, check location code.                                AR864763
      ** Otherwise, flag as not MiFID compliant.                                            AR864763
      *                                                                                     AR864763
     C           A8LCCD    IFNE *BLANKS                                                     AR864763
      *                                                                                       CSW207
     C                     CALL 'AOLOCNR0'                                                    CSW207
     C                     PARM *BLANKS   P@RTCD                                              CSW207
     C                     PARM '*KEY   ' P@OPTN                                              CSW207
     C                     PARM A8LCCD    P@LOCN  3                                           CSW207
     C           SDLOCN    PARM SDLOCN    DSFDY                                               CSW207
      *                                                                                       CSW207
      ** Database error proceesing                                                            CSW207
      *                                                                                       CSW207
     C           P@RTCD    IFNE *BLANKS                                                       CSW207
     C                     Z-ADD045       DBASE                                               CSW207
     C                     MOVEL'SDLOCNPD'DBFILE                                              CSW207
     C                     MOVE A8LCCD    DBKEY                                               CSW207
     C                     EXSR *PSSR                                                         CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
     C           DVCNCD    CHAINMEISOCL1             90                                       CSW207
      *                                                                                       CSW207
      ** DATABASE ERROR                                                                       CSW207
      *                                                                                       CSW207
     C           *IN90     IFEQ *ON                                                           CSW207
     C**********           MOVEL'041'     DBASE                                      CSW207 BUG24512
     C**********           MOVEL'MEISOCPD'DBFILE                                     CSW207 BUG24512
     C**********           MOVELDVCNCD    DBKEY                                      CSW207 BUG24512
     C**********           EXSR *PSSR                                                CSW207 BUG24512
     C                     MOVE 'N'       M3MFID                                            BUG24512
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
     C           M3MFID    IFEQ 'Y'                                                           CSW207
     C                     MOVE 'Y'       WBRCH                                               CSW207
     C                     ENDIF                                                              CSW207
     C                     ELSE                                                             AR864763
     C                     MOVE 'N'       M3MFID                                            AR864763
     C                     ENDIF                                                            AR864763
      *                                                                                       CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
      ** check if Destination Customer is MiFID complaint                                     CSW207
      *                                                                                       CSW207
     C********** MGDEST    IFNE *ZEROS                                                CSW207 CSW207A
     C           TCNR      IFNE *ZEROS                                                       CSW207A
      *                                                                                       CSW207
     C                     MOVE *BLANKS   WCUST                                               261600
     C**********           MOVE MGDEST    WCUST                                       CSW207 CSW207A
     C                     MOVE TCNR      WCUST                                              CSW207A
     C                     CALL 'AOCSSWR0'                                                    CSW207
     C                     PARM *BLANKS   WRTCD                                               CSW207
     C                     PARM '*KEY   ' WOPTN                                               CSW207
     C                     PARM           WCUST                                               CSW207
     C                     PARM *BLANKS   WKYST                                               CSW207
     C                     PARM           DSLDY                                               CSW207
      *                                                                                       CSW207
      ** DATABASE ERROR                                                                       CSW207
      *                                                                                       CSW207
     C           WRTCD     IFNE *BLANKS                                                       CSW207
     C                     MOVEL'042'     DBASE                                               CSW207
     C                     MOVEL'SDCSSWPD'DBFILE                                              CSW207
     C                     MOVELWCUST     DBKEY                                               CSW207
     C                     EXSR *PSSR                                                         CSW207
     C                     END                                                                CSW207
      *                                                                                       CSW207
      ** extract SDCUSTPD and SDCSSWPD                                                        CSW207
      *                                                                                       CSW207
     C                     MOVEL'SDCUSTPD'P#FILN                                              CSW207
     C                     EXSR GETRCL                                                        CSW207
     C           P#RCDL    SUBSTDSLDY     SDCUST                                              CSW207
     C           P#RCDL    ADD  1         S       50                                          CSW207
      *                                                                                       CSW207
     C                     MOVEL'SDCSSWPD'P#FILN                                              CSW207
     C                     EXSR GETRCL                                                        CSW207
     C           P#RCDL    SUBSTDSLDY:S   SDCSSW                                              CSW207
      *                                                                                       CSW207
     C           BBCOLC    CHAINMEISOCL1             90                                       CSW207
      *                                                                                       CSW207
      ** DATABASE ERROR                                                                       CSW207
      *                                                                                       CSW207
     C           *IN90     IFEQ *ON                                                           CSW207
     C**********           MOVEL'043'     DBASE                                      CSW207 BUG24512
     C**********           MOVEL'MEISOCPD'DBFILE                                     CSW207 BUG24512
     C**********           MOVELBBCOLC    DBKEY                                      CSW207 BUG24512
     C**********           EXSR *PSSR                                                CSW207 BUG24512
     C                     MOVE 'N'       M3MFID                                            BUG24512
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
     C           M3MFID    IFEQ 'Y'                                                           CSW207
     C                     MOVE 'Y'       WDEST                                               CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
      ** check if both are MiFID compliant                                                    CSW207
      *                                                                                       CSW207
     C           WBRCH     IFEQ 'Y'                                                           CSW207
     C           WDEST     ANDEQ'Y'                                                           CSW207
     C                     MOVE 'Y'       WMFID                                               CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
      ** retrieve the classification of the counterparty                                      CSW207
      *                                                                                       CSW207
     C**********           MOVELMGDEST    WWCUST                                      CSW207 CSW207A
     C                     MOVELTCNR      WWCUST                                             CSW207A
      *                                                                                       CSW207
     C                     CALL 'AOSECSR0'                                                    CSW207
     C                     PARM *BLANKS   WRTCD                                               CSW207
     C                     PARM '*KEY   ' WOPTN                                               CSW207
     C                     PARM           WWCUST                                              CSW207
     C           SDSECS    PARM SDSECS    DSSDY                                               CSW207
      *                                                                                       CSW207
      ** DATABASE ERROR                                                                       CSW207
      *                                                                                       CSW207
     C           WRTCD     IFNE *BLANKS                                                       CSW207
     C                     MOVEL'044'     DBASE                                               CSW207
     C                     MOVEL'SDSECSPD'DBFILE                                              CSW207
     C                     MOVELWWCUST    DBKEY                                               CSW207
     C                     EXSR *PSSR                                                         CSW207
     C                     END                                                                CSW207
      *                                                                                       CSW207
     C                     ENDSR                                                              CSW207
      /TITLE SR/DAYSAC
      *****************************************************************
      *                                                               *
      *  DAYSAC - Subroutine to calculate the Number of Days of       *
      *           Accrued Interest.                                   *
      *                                                               *
      *  Called By: FMT521, FMT523, FMT580                            *
      *  Calls: ZLCD                                                  *
      *                                                               *
      *****************************************************************
      *
     C           DAYSAC    BEGSR                           *** DAYSAC ***
      *
      ***  Determine the Start and End Dates for Calculating the number
      ***  of Days in the Period.
      *
      ***  Cum Coupon Trades:
      *
     C           ACIN      IFEQ 'C'
      *
      ***  The Start Date is the Last Coupon Date before (or on) the
      ***  Value Date of the Trade.
      *
     C                     Z-ADDTDVD      ZECD
     C                     EXSR ZLCD
     C                     Z-ADDZZLCD     ZSDATE
      *
      ***  The End Date is the Value Date of the Trade.
      *
     C                     Z-ADDTDVD      ZEDATE
     C                     ENDIF
      *
      ***  Ex-Coupon Trades:
      *
     C           ACIN      IFEQ 'X'
      *
      ***  The Start Date is the Value Date of the Trade.
      *
     C                     Z-ADDTDVD      ZSDATE
      *
      ***  The End Date is the Next Coupon Date after (or on) the Value
      ***  Date of the Trade.
      *
     C                     Z-ADDTDVD      ECD     50
     C                     EXSR ZNCD
     C                     Z-ADDNCD       ZEDATE
     C                     ENDIF
      *
      ***  Calculate Number of Days from Start Date to End Date.
      *
     C                     EXSR ZDAYS
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/CONVT
      *****************************************************************
      *                                                               *
      *   CONVT - Converts an amount from one currency to another.    *
      *                                                               *
      *    INPUT  - WKAMTI (15,0) AMOUNT INPUT                        *
      *             WKEXCH (13,8) EXCHANGE RATE                       *
      *             WKZMD  (1)    MULTIPLY/DIVIDE INDICATOR           *
      *             WKDPI  (1,0)  CURRENCY INPUT                      *
      *             WKDPO  (1,0)  CURRENCY TO BE CONVERTED TO         *
      *                                                               *
      *   Arrays       - POWER  powers of 10                          *
      *                                                               *
      *   OUTPUT -  WKAMTO (15,0) AMOUNT OUTPUT                       *
      *                                                               *
      *   CALLS    - NONE                                             *
      *                                                               *
      *****************************************************************
      *
     C           CONVT     BEGSR
      *
      ** DEFINE ALL FIELDS
     C                     Z-ADDWKAMTI    WKAMTI 150
     C                     Z-ADD0         WKAMTO 150
     C                     Z-ADDWKDPI     WKDPI   10
     C                     Z-ADDWKDPO     WKDPO   10
     C                     Z-ADDWKEXCH    WKEXCH 138
     C                     MOVE WKZMD     WKZMD   1
      *
      *** IF DECIMAL PLACES DIFFER -
      ***      CALCULATE DIFFERENCE IN DECIMAL PLACES TO USE AS POWER INDEX
      *
     C           WKDPO     SUB  WKDPI     ZPX     10
     C                     ADD  4         ZPX
      *
      ** CALCULATE CURRENCY AMOUNT OUTPUT BY MULTIPLYING INPUT AMOUNT BY
      **  POWER ARRAY ENTRY AND THEN MULTIPLYING RESULT BY EXCHANGE RATE
      **  DEPENDING ON INDICATOR
      *
     C           WKAMTI    MULT POWER,ZPX Z21#3  213
      *
     C           WKZMD     IFEQ 'D'
     C           Z21#3     DIV  WKEXCH    WKAMTO    H
     C                     ELSE
     C           Z21#3     MULT WKEXCH    WKAMTO    H
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/WPR01
      *****************************************************************
      *                                                               *
      *   WPR01     - PRINT MT592 GENERATED                           *
      *                                                               *
      *   CALLED BY - Main Processing                                 *
      *   CALLS     - NONE                                            *
      *                                                               *
      *****************************************************************
      *
     C           WPR01     BEGSR
      *
     C           DTRNO     IFNE *BLANKS
     C                     MOVE 'Y'       WWPR01  1
      *
      ** INITIALISE FIELDS USED IN REPORT
     C                     CLEARDETAIL1
      *
      ** FORMAT TRADE REFERENCE
     C                     MOVELDTRNO     R1TRNO
     C                     MOVELDRELR     R1RELR
     C                     MOVELDRELD     R1ORIG
     C                     MOVELDNWRK     R1NWRK
      *
      ***  If print file not yet open then open it and write headings
     C           *IN15     IFEQ '0'
      *
     C                     OPEN SE1871P1
     C                     MOVE '1'       *IN15
      *
     C                     Z-ADDSFNUM1    ZSNUM   60
     C                     CALL 'ZSFILE'
     C                     PARM           PSEQ
     C                     PARM *BLANKS   WPARM   3
     C                     PARM           SFILE1
     C                     PARM           ZSNUM
     C                     PARM           ZSERR   1
      *
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
      *
      ** PRINT PAGE HEADINGS
     C                     WRITEHEADP1
      *
     C                     END
      *
      ** WRITE A DETAIL LINE TO THE REPORT CHECKING FOR OVERFLOW
     C           WWOFL1    SUB  WWPTL1    WWLINE  20
     C           WWLINE    IFLT 3
     C                     WRITEHEADP1
     C                     END
      *
     C                     WRITEDETAIL1
     C                     CLEARDETAIL1
      *
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/AUDIT
      *****************************************************************
      *                                                               *
      *    AUDIT     - RUN CONTROL PROCESS                            *
      *                                                               *
      *    CALLED BY - PROCES                                         *
      *    CALLS     - NONE                                           *
      *                                                               *
      *****************************************************************
      *
     C           AUDIT     BEGSR
      *
     C                     Z-ADDSFNUMU    ZSNUM   60
     C                     CALL 'ZSFILE'
     C                     PARM           PSEQ
     C                     PARM *BLANKS   WPARM
     C                     PARM           SFILEU
     C                     PARM           ZSNUM
     C                     PARM           ZSERR   1
      *
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
      *
      ***  Write Heading and control information
     C                     WRITEHEADAU
     C                     WRITECONTROL
      *
      ***  If there is a DB Error, Output the DB Error Information.
     C           *INU7     IFEQ '1'
     C                     WRITEDBERROR
     C                     ELSE
      *
      ***  Or, if no valid records read, Output "No Details" message.
     C           WWPR01    IFNE 'Y'
     C           WWPR02    ANDNE'Y'
     C                     WRITENONE
     C                     END
     C                     END
      *
     C                     ENDSR
      *****************************************************************                       CSW207
      /TITLE SR/GETRCL                                                                        CSW207
      *****************************************************************                       CSW207
      *                                                               *                       CSW207
      *  GETRCL- Get record length                                    *                       CSW207
      *                                                               *                       CSW207
      *****************************************************************                       CSW207
      *                                                                                       CSW207
     C           GETRCL    BEGSR                                                              CSW207
      *                                                                                       CSW207
     C           'UTGETRCD'CAT  'LN'      P#PGM  10                                           CSW207
      *                                                                                       CSW207
     C                     CALL P#PGM                                                         CSW207
     C                     PARM           P#RTCD 10                                           CSW207
     C                     PARM           P#RCDL  50                                          CSW207
     C                     PARM           P#FILN 10                                           CSW207
     C                     PARM '*LIBL'   P#LIBN 10                                           CSW207
      *                                                                                       CSW207
     C           P#RTCD    IFNE *BLANK                                                        CSW207
     C                     EXSR *PSSR                                                         CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
     C                     ENDSR                                                              CSW207
      *
      *****************************************************************                       CSW210
      **                                                              *                       CSW210
      **  SRSWFT    - SWIFT Address validation                        *                       CSW210
      **                                                              *                       CSW210
      **  Calls     - ME1400                                          *                       CSW210
      **  Called By - SRDADD                                          *                       CSW210
      **                                                              *                       CSW210
      *****************************************************************                       CSW210
      *                                                                                       CSW210
     C           SRSWFT    BEGSR                                                              CSW210
     C                     SETOF                     909192                                   CSW210
      *                                                                                       CSW210
      ** Test positions 1-8 for valid SWIFT Characters                                        CSW210
      ** Check how many characters are alphanumeric                                           CSW210
     C                     MOVEL*BLANKS   FLD    35                                           CSW210
     C                     MOVELT2DAD1    FLD                                                 CSW210
     C           ALPHAN    CHECKFLD       X#      30     90                                   CSW210
      *                                                                                       CSW210
      ** If the first 8 or 11 are ok proceed                                                  CSW210
     C           *IN90     IFEQ *ON                                                           CSW210
     C           X#        ANDEQ9                                                             CSW210
     C           *IN90     OREQ *ON                                                           CSW210
     C           X#        ANDEQ12                                                            CSW210
     C           ' '       CHECKFLD:X#    ##001   10     90                                   CSW210
      *                                                                                       CSW210
      ** Check for blanks if before 8 or 11 then assume address                               CSW210
     C           *IN90     IFEQ *ON                                                           CSW210
     C           X#        ANDEQ11                                                            CSW210
     C                     SETON                     91                                       CSW210
     C                     MOVE 'Y'       ##CSID  1                                           CSW210
     C                     GOTO ENDSWT                                                        CSW210
     C                     ENDIF                                                              CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSW210
      ** Invalid format - Not a S.W.I.F.T.                                                    CSW210
     C           *IN90     IFEQ *ON                                                           CSW210
     C                     MOVE 'N'       ##CSID                                              CSW210
     C                     GOTO ENDSWT                                                        CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSW210
      ** Call Access object to validate identifier                                            CSW210
     C                     MOVELFLD       W9BICC                                              CSW210
     C           3         SUBSTFLD:9     W9BICB                                              CSW210
      *                                                                                       CSW210
     C                     CALL 'ME1400'                                                      CSW210
     C                     PARM *BLANKS   W9RTN   7                                           CSW210
     C                     PARM           W9BICC  8                                           CSW210
     C                     PARM           W9BICB  3                                           CSW210
     C                     PARM           SDCUST                                              CSW210
     C                     PARM           SDCNST                                              CSW210
     C                     PARM           MEBICD                                              CSW210
     C                     PARM *BLANKS   W9CUST  1                                           CSW210
     C                     PARM *BLANKS   W9CNST  1                                           CSW210
     C                     PARM *BLANKS   W9BICD  1                                           CSW210
      *                                                                                       CSW210
      ** Record found - BIC exists                                                            CSW210
     C           W9RTN     IFEQ *BLANKS                                                       CSW210
     C                     MOVE 'Y'       ##CSID                                              CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSW210
     C           ENDSWT    TAG                                                                CSW210
     C                     ENDSR                                                              CSW210
      *                                                                                       CSW210
      *****************************************************************
      /TITLE SR/*PSSR
      *****************************************************************
      *                                                               *
      *  *PSSR  - Program Error Processing Subroutine.                *
      *                                                               *
      *  Called By: Various                                           *
      *  AUDIT  - Produce Audit Report and End Program                *
      *                                                               *
      *****************************************************************
      *
     C           *PSSR     BEGSR                           *** *PSSR  ***
      *
      ***  Check to see that *PSSR has not already been called.
     C           WRUN      IFEQ *BLANK
     C                     MOVE 'Y'       WRUN    1
     C                     MOVEL'SE1871'  DBPGM
      *
     C           *NAMVAR   DEFN LDA       WLDA  256
     C           *LOCK     IN   WLDA
     C                     MOVELDBERR     WLDA
     C                     OUT  WLDA
     C                     SETON                     U7U8LR
      *
     C                     EXSR AUDIT
      *
     C                     DUMP
     C                     END
      *
      ** Exit program
     C                     RETRN
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/ZDATE1
     C/COPY ZSRSRC,ZDATE1Z2
      /TITLE SR/ZDATE2
     C/COPY ZSRSRC,ZDATE2Z2
      /TITLE SR/ZDAYS
     C/COPY ZSRSRC,ZDAYSZ2
      /TITLE SR/ZLCD
     C/COPY ZSRSRC,ZLCDZ1
      /TITLE SR/ZNCD
     C/COPY ZSRSRC,ZNCDZ3
      /TITLE COMPILE-TIME ARRAYS
      ***
**  CPY@
(c) Finastra International Limited 2001
**  ECIN - EUROCLEAR AND CEDEL NUMERIC CODES FOR INSTRUCTIONS
####################
####################
4F4T6F##41##61######
315F5T8D8151##8M8A##
**  ECTA - EUROCLEAR AND CEDEL ALPHABETIC CODES EQUIVALENT FOR INST. TYPE
##############################
##############################
INTINTEXT###INT###EXT#########
INTINTINTEXTEXTINT###EXTEXT###
**  ECSA - EUROCLEAR AND CEDEL ALPHABETIC CODES EQUIVALENT FOR INST. SUB-TYPE
##################################################
##################################################
SETTLMATCHBOOK #####SETTL#####BOOK ###############
TRANSSETTLMATCHBOOK PHYSISETTL#####BOOK PHYSI#####
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
0006001521029820444305904073650882610287117481320914670161311759219053
2051421975234362489726358278192928030741322023366335124365853804639507
40968424294389045351
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
