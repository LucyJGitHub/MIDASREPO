     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Depot movements extract for settles')         *
      *****************************************************************
      *                                                               *
      *  Midas - Securities Trading Module
      *                                                               *
      *  SE1873 - DEPOT MOVEMENTS EXTRACT FOR SETTLEMENTS             *
      *                                                               *
      *  Function: Extract details required for S.W.I.F.T. Depot      *
      *   (I/C)    Movement Settlement Messages for Depot Movements   *
      *   (COB)    that were Input, Amended or Cancelled Today and    *
      *            Maturities that are due.                           *
      *                                                               *
      *  Called by: SEC3305 - Pay/Receive Telexes Input cycle         *
      *                       processing.                             *
      *             Frequency: On Request in Input Cycle              *
      *                                                               *
      *             SEC0603 - Pay/Receive Telexes                     *
      *             Frequency: Automatically in Close of Business     *
      *                                                               *
      *  (c) Finastra International Limited 2001                     *
      *                                                               *
      *  Last Amend No. 248698             Date 01Jun20               *
      *  Prev Amend No. MD050604           Date 21Feb20               *
      *                 MD046248           Date 05Feb18               *
      *                 CDL099             Date 06Oct17               *
      *                 CSW216             Date 14Mar16               *
      *                 CGL165             Date 15Feb17               *
      *                 CSW214             Date 25Nov14               *
      *                 CDL096             Date 22Sep14               *
      *                 CDL094             Date 11Jun14               *
      *                 CFT050             Date 03Jun13               *
      *                 264020             Date 02Apr12               *
      *                 AR589164A          Date 16Aug10               *
      *                 AR589164           Date 13Aug10               *
      *                 CSW210             Date 04May10               *
      *                 CER059             Date 19Jul10               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 CSW208             Date 15Apr08               *
      *                 CSW207A            Date 09Aug07               *
      *                 CSW207             Date 08Jun07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CDL049             Date 11May06               *
      *                 CSD027             Date 09Dec05               *
      *                 CDL038             Date 10May05               *
      *                 237063             Date 20Nov05               *
      *                 BUG7411            Date 01Jun05               *
      *                 CSE071             Date 19Jul05               *
      *                 229544             Date 15Sep04               *
      *                 221612             Date 23Oct03               *
      *                 CSW037A            Date 02May05               *
      *                 CDL028             Date 07Feb05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3122            Date 17Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 CGP001             Date 14Oct03               *
      *                 222727             Date 05Nov03               *
      *                 212599             Date 20Mar03               *
      *                 215888             Date 10Jun03               *
      * Midas Release 4.01.01 ----------------------------------------*
      *                 CSW202             Date 20May02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 205141             Date 22May02               *
      *                 205193             Date 26Mar02               *
      *                 CSW025             Date 26Mar02               *
      *                 CSE031             Date 09Nov01               *
      *                 180707             Date 25Jul00               *
      *                 192221             Date 26Nov01               *
      *                 200292             Date 06Nov01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CSE029             Date 19Jul01               *
      *                 CSE022             Date 29Mar01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 130085             Date 12Mar01               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 167826             Date 22Jun00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CSE015             Date 06Dec99               *
      *                 CSE017             Date 20Oct99               *
      *                 CSE012             Date 16Aug99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CEU003             Date 03Mar98               *
      *                 121633             Date 03Mar98               *
      *                 125251             Date 31Oct97               *
      *                 CSE005             DATE 04FEB97               *
      *                 089115             DATE 21AUG96               *
      *                 104331             DATE 10JUN96               *
      *                 104032             DATE 06JUN96               *
      *                 103746             DATE 29MAY96               *
      *                 103449             DATE 23MAY96               *
      *                 089773             DATE 21MAY96               *
      *                 069758             DATE 10MAY96               *
      *                 093758             DATE 10MAY96               *
      *                 073848             DATE 08MAY96               *
      *                 078256             DATE 07MAY96               *
      *                 CSW007             DATE 22APR96               *
      *                 CSW003             DATE 13NOV95               *
      *                 094415             DATE 09NOV95               *
      *                 094335             DATE 09NOV95               *
      *                 085326             DATE 11APR95               *
      *                 085245             DATE 11APR95               *
      *                 079669             DATE 01DEC94               *
      *                 S01445             DATE 04NOV93               *
      *                 066915             DATE 14FEB94               *
      *                 S01401             DATE 16JUN93               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  248698 - Rounding discrepancies on some SE reports. Applied  *
      *           fix 228682.                                         *
      *  228682 - Recompiled due to ZCNSDZ1 changes. Applied 176594.  *
      *  MD050604 - Average price of position changed incorrectly.    *
      *           - Recompiled due to changes in copy source ZCNSDZ1. *
      *  MD046248 - Finastra Rebranding                               *
      *  CDL099 - Split Value Date (Recompile)                        *
      *  CSW216 - SWIFT Changes 2016 (Recompile)                      *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CSW214 - SWIFT Changes 2014 (Recompile)                      *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *           (Recompiled)                                        *
      *  CFT050 - SWIFTRef Directories upload (Recompile)             *
      *  264020 - Not MIFID compliant when BBCOLC or DVCNCD is        *
      *           not in MEISOCPD.                                    *
      *         - Applied for AR943237 (Child:AR943238)               *
      *  AR589164A - Additional fix to cater //XX input               *
      *  AR589164 - Additional fix to cater //XX input                *
      *  CSW210 - SWIFT 2010 Changes                                  *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *            (Recompile)                                        *
      *  CSW208 - SWIFT 2008 Changes                                  *
      *  CSW207A - Use of Counterparty instead of Destination         *
      *  CSW207 - SWIFT 2007 Changes                                  *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  237063 - EU Tax fixes upgrade to MP build 103 (Recompile).   *
      *  BUG7411- CDL028 fields missing from DLGHISPD (Recompile)     *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  229544 - Recompiled due to inserted fields in DLCHISPD.      *
      *  221612 - Reverse part of 200292.  Telex notice days should   *
      *           not be considered in the generation of MT54x.       *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3122 - Recompiled due to changes in SDSECSPD.             *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits (Recompile)      *
      *  CGP001 - Global Processing.                                  *
      *  222727 - Release 5.0 errors  (Recompile)                     *
      *  212599 - Swift Market Centre not appearing in ISO15022 msg   *
      *  215888 - SEC0603 DBErr 006, when system tries to access      *
      *           customer details of Depot 3 - Kassenverein.         *
      *           Fix is to access AOCUSTR0 only if Depot 3 is not    *
      *           blanks.                                             *
      *  CSW202 - SWIFT 2002 Standards Update                         *
      *  205141 - Initialise WCUST before use.                        *
      *  205193 - Only process repo if related deal is authorisd.     *
      *  CSW025 - Midas Message Manager                               *
      *           - Pass original change type                         *
      *  CSE031 - Coupon Fixing for Floating Rate Notes.              *
      *           (recompilation due to change to ZNCD/ZLCD)          *
      *  180707 - No Position Settlements generated. Recompile over   *
      *           changes in /COPY ZNCDZ3.                            *
      *  192221 - Extract the other detail lines of the Deliverer &   *
      *           Receiver of Securities (detail lines 2 to 4) from   *
      *           the Depot Movement Extended Settlement details.     *
      *  200292 - If CSE015 is on, need to use Telex notice date for  *
      *           message generation.                                 *
      *           Use SWIFT currency code for output to MGISOTPD.     *
      *           Additional field added to MGISOTPD and MGISODPD     *
      *  CSE029 - ISO15022 message generation                         *
      *  CSE022 - Depository Definition Enhancement                   *
      *  130085 - Chain to deals history file if live deal not found  *
      *  167826 - Database error in ZM1340 at 061. Apply 153374.      *
      *  CSE015 - Forward Valued Depot Movements (Recompile)          *
      *  CSE017 - Cum/Ex Indicator on Depot Movements (Recompile)     *
      *  CSE012 - SE Depot Movement Narratives (Recompiled).          *
      *  CEU003 - EMU Dealing Settlement Currency Conversion          *
      *  121633 - ISIN number being omitted from non-Federal Reserve  *
      *           messages                                            *
      *  125251 - Review calculation process for settlement amount.   *
      *  CSE005 - Effect of holidays on FRN Coupon Dates              *
      *           (recompilation due to change to ZNCD/ZLCD)          *
      *  089115 - Need to pass ORED and MTYP to MG9500.               *
      *  104331 - Branch code is blank on MT580 Cedel cancellations   *
      *  104032 - Use value date of run date when backvaluation       *
      *  103746 - MT580 Field ':87C:' incorrectly formatted.          *
      *  103449 - Allow confirmation message for 'PD' and 'PL'        *
      *  089773 - DBASE error 24 + 25 when trying to access SDNOSTPD  *
      *           using field TMAN. This field may be blanks and      *
      *           does not seem to be a Nostro code anyway. It is a   *
      *           customer number. It comes from the Intermediary     *
      *           Bank field or the Account with Bank field on the    *
      *           settlement screen.                                  *
      *  069758 - Extended Field 87a (Receiver Securities) was invalid*  *
      *  093758 - MT580 not generated because "Field :58a: should     *
      *           be present when field :57a: is present".            *
      *           Instruction type used 61 --> correspond             *
      *           tp 1- Rec. Against Paym. Ext. Book Entry            *
      *              2- Rec. Against Paym. Ext. Phisical              *
      *           System default to Ext. Book for which field 57 &    *
      *           58 are both optional --> if problem to format one   *
      *           of these fields, initialise the other.              *
      *  073848 - Put the type in cancelatiom message                 *
      *  078256 - Output nominal dec places                           *
      *  CSW007 - Produce Maturity Messages on date of input          *
      *  CSW003 - MT5xx Message Generation - Phase 2                  *
      *  094415 - Wrong destination and receive/deliver on messages   *
      *  094335 - MT5xx cancellation process fix                      *
      *  085326 - MT52x messages to Federal Reserve Bank of New York  *
      *           new requirement.                                    *
      *           The word 'CUSIP' is required to be used in field    *
      *           :35B for both US Treasury Bills and Treasury Notes. *
      *  085245 - MT52x messages to Federal Reserve Bank of New York  *
      *           It is required to use the CUSIP number not the ISIN/*
      *           Common code in field :35B. It also required to print*
      *           the word 'CUSIP' for US Treasury Bill but not for   *
      *           US Treasury Notes.                                  *
      *  079669 - Validate correct CEDEL customer number from         *
      *           SDSTRDPD, instead of H/O Customer Number            *
      *  S01445 - DEPOT MOVEMENT CHARGES ENHANCEMENT.                 *
      *           Recompiled due to changes in PF/DPTMVD.             *
      *  066915 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
      *           to 10,9 by GEMS 052254.                             *
      *  S01401 - MT5xx SWIFT Messages Feature: New program. THIS     *
      *           CHANGE ALSO INCLUDES S01412 (I.E. S.W.I.F.T. SEPT 93*
      *           MESSAGE FORMAT CHANGES)                             *
      *                                                               *
      *****************************************************************
      *
     FDPTMVDJ5IF  E           K        DISK         KINFSR *PSSR
     FDPTMVDJ2IF  E           K        DISK         KINFSR *PSSR      UC
     F            DPTMVDD1                          KRENAMEDPTMVDD2
     FDPTMVDJ3IF  E           K        DISK         KINFSR *PSSR      UC
     F            DPTMVDD1                          KRENAMEDPTMVDD3
     FSECTY   IF  E           K        DISK         KINFSR *PSSR
     FSEMKC   IF  E           K        DISK         KINFSR *PSSR                              212599
     FDPTMVDY2IF  E           K        DISK         KINFSR *PSSR
     F            DPTMVDD2                          KRENAMEDPTMVDX
     F/COPY WNCPYSRC,SE1873F002
     FINVTP   IF  E           K        DISK         KINFSR *PSSR
     FDEALS   IF  E           K        DISK         KINFSR *PSSR
     F            DEALSDAF                          KIGNORE
     F            DEALSDBF                          KIGNORE
     F            DEALSDDF                          KIGNORE
     F            DEALSDEF                          KIGNORE
     F            DEALSDGF                          KIGNORE
     F            DEALSDFF                          KIGNORE
     FDEALSH  IF  E           K        DISK         KINFSR *PSSR          130085
     F            DEALSDBF                          KIGNORE               130085
     F            DEALSDCF                          KIGNORE               130085
     F            DEALSDDF                          KIGNORE               130085
     F            DEALSDEF                          KIGNORE               130085
     F            DEALSDGF                          KIGNORE               130085
     F            DLBHISD0                          KIGNORE               130085
     F            DLDHISD0                          KIGNORE               130085
     F            DLEHISD0                          KIGNORE               130085
     F            DLGHISD0                          KIGNORE               130085
     FMGF520PDO   E                    DISK         KINFSR *PSSR
     FMGF521PDO   E                    DISK         KINFSR *PSSR
     FMGF522PDO   E                    DISK         KINFSR *PSSR
     FMGF523PDO   E                    DISK         KINFSR *PSSR
     FMGF580PDO   E                    DISK         KINFSR *PSSR
     FMGISODPDO   E                    DISK         KINFSR *PSSR          CSE029
     FMEISOCL1IF  E           K        DISK         KINFSR *PSSR                              CSW207
     F/COPY WNCPYSRC,SE1873F003
     FSE1873AUO   E                    PRINTER      KINFDS SPOOLU
     F                                              KINFSR *PSSR
     FSE1873P1O   E                    PRINTER      KINFDS SPOOL1     UC
     F                                              KINFSR *PSSR
     FSE1873P2O   E                    PRINTER      KINFDS SPOOL2     UC
     F                                              KINFSR *PSSR
     FSDCURRL0IF  E           K        DISK                               CEU003
     F/COPY WNCPYSRC,SE1873F001
      /TITLE FUNCTION OF INCICATORS
      *****************************************************************
      *                                                               *
      *  F U N C T I O N   O F   I N D I C A T O R S                  *
      *                                                               *
      *    15  - Print file, SE1873P1, has been opened at least once  *
      *    16  - Print file, SE1873P2, has been opened at least once  *
      *    20  - Control of call to MG9500                            *
      *    30  - LOKUP on array, DEP                                  *
      *    40  - ON  : I/C processing (PICFG = N)                     *
      *          OFF : COB processing (PICFG = Y)                     *
      *    50  - Control of chain to DPTMVDJ5                         *
      *    53  - Control of chain to DPTMVDJ2                         *
      *    54  - Control of chain to DPTMVDJ3                         *
      *    62  - Control of chain to DEALS                            *
      *    66  - Control of chain to SEMKC                            *                       212599
      *    67  - Control of chain to SECTY                            *
      *    68  - Control of chain to INVTP                            *
      *    69  - Control of chain to DPTMVDY2                         *
      *    70  - Control of write to MGF520D0                         *
      *    71  - Control of write to MGF521D0                         *
      *    72  - Control of write to MGF522D0                         *
      *    73  - Control of write to MGF523D0                         *
      *    74  - Control of write to MGF580D0                         *
      *    79  - Control of write to MGF580D0                         *
      *    85  - Look up of array, ECIN                               *
      *                                                               *
      *    98  - Date Format: DDMMYY (off); MMDDYY (on)               *
      *  90-99 - Used by Standard Subroutines                         *
      *                                                               *
      *  U7+U8 - Database Error                                       *
      *                                                               *
      *****************************************************************
      /TITLE SUBROUTINE INDEX
      *****************************************************************
      *                                                               *
      *  S U B R O U T I N E   I N D E X                              *
      *                                                               *
      *  INIT   - Initial Processing                                  *
      *  PROCES - Perform Detail Processing                           *
      *  AMASF  - Access master files                                 *
      *  MTYPE  - Determine message type                              *
      *  GCMSG  - Generate cancelation messages                       *
      *  MSGST  - Determine message(s) to be sent                     *
      *  ICPSD  - Input Cycle Processing (Start Date)                 *
      *  ICPMD  - Input Cycle Processing (Maturity Date)              *
      *  ICP    - Input Cycle Processing                              *
      *                                                               *
      *  FMTALL - Format fields common to all messages                *
      *  FMT52X - Format fields common to MT52x messages              *
      *  FMT52Y - Format fields common to MT520 & MT521 messages      *
      *  FMT52Z - Format fields common to MT522 & MT522 messages      *
      *  FMT520 - Format fields specific to MT520                     *
      *  FMT521 - Format fields specific to MT521                     *
      *  FMT522 - Format fields specific to MT522                     *
      *  AUDIT  - Run Control Process                                 *
      *                                                               *
      *  *PSSR  - Program error handling routine                      *
      *                                                               *
      *  ZNCD   - Determines next coupon date                         *
      *                                                               *
      *****************************************************************
     E/TITLE E-SPECIFICATIONS
     E                    CPY@    1   1 80
      ***  Array for Object Copyright Statement.
      *
     E/COPY ZSRSRC,ZDATE2Z1
      *
     E/COPY ZSRSRC,ZNCDZ1
      *
     E**********          DEP        10  6 0                                                  CSD027
     E                    DEP        10  6                                                    CSD027
      ** ARRAY FOR DEPOT REFERENCES
      *
     E                    ECIN   10  40  2
      ** ARRAY FOR EUROCLEAR AND CEDEL NUMERIC CODES FOR INSTRUCTIONS
      *
     E                    ECTA   10  40  3
      ** ARRAY FOR EUROCLEAR AND CEDEL ALPHA. CODES EQUIVALENT FOR INST. TYPE
      *
     E                    ECSA   10  40  5
      ** ARRAY FOR EUROCLEAR AND CEDEL ALPHA. CODES EQUIVALENT FOR INST. SUBTYPE
      *
     E**********          SDPT        3  6 0                                           085245 CSD027
     E                    SDPT        3  6                                                    CSD027
     E                    SDTY        3  1                                085245
     E** ARRAY TO HOLD OTHER SETTLEMENT DEPOT                             085245
     E**                                                                  085245
     E/COPY ZSRSRC,ZPOWER8Z1                                              CSW003
     E                    POWER9  1   8  8 0                              125251
     E                    ILEPGM  1   1 10                                200292
     E                    CUR       150  3                                CEU003
     E                    INCY      150  1                                CEU003
     I/TITLE I-SPECIFICATIONS
      *
     ISECTYDF
      ** RENAME DUPLICATE FIELDS ON FILE SECTY
     I              CHTP                            SYCHTP
      *
     IINVTPDF
      ** RENAME DUPLICATE FIELDS ON FILE INVTP
     I              CHTP                            INCHTP
      *
     IDEALSDCF
      ** RENAME DUPLICATE FIELDS ON FILE INVTP
     I              CHTP                            DLCHTP
      *
     ISPOOL1      DS
      ***  File Information Data Structure for SE1873P1.
     I                                       83  92 SFILE1
     I                                    B 123 1240SFNUM1
     I                                    B 188 1890WWOFL1
     I                                    B 367 3680WWPTL1
      *
     ISPOOL2      DS
      ***  File Information Data Structure for SE1873P2.
     I                                       83  92 SFILE2
     I                                    B 123 1240SFNUM2
     I                                    B 188 1890WWOFL2
     I                                    B 367 3680WWPTL2
      *
     ISPOOLU      DS
      ***  File Information Data Structure for SE1873AU.
     I                                       83  92 SFILEU
     I                                    B 123 1240SFNUMU
      *
     IDSFDY     E DSDSFDY
      ** First Data Structure for Access Objects
      *
     IDSSDY     E DSDSSDY
      ** Second Data Structure for Access Objects
      *
     IDSLDY     E DSDSLDY                                                                     CSW207
      ** Data structure for Access objects                                                    CSW207
      *                                                                                       CSW207
     ISDCSSW    E DSSDCSSWPD                                                                  CSW207
      ** Midas SD Customer Extensions SWIFT Details                                           CSW207
      *                                                                                       CSW207
     ISDBANK    E DSSDBANKPD
      ** Bank Details
      *
     ISDBRCH    E DSSDBRCHPD
      ** Branch Details
      *
     ISDSTRD    E DSSDSTRDPD
      ** Securities Trading ICD Details
      *
     ISDGELR    E DSSDGELRPD
      ** General Ledger Details
      *
     ISDSECS    E DSSDSECSPD
     I              QQACCD                          QQACD1                                    CGL029
      ** Securities Trading Clients
      *
     ISECGT     E DSSECGTD                                                CSE029
     I**  EXTERNAL DS FOR CHARGE TYPE DETAILS                             CSE029
     I              RECI                            RECI1                 CSE029
     I              CCY                             CCY1                  CSE029
     I              LCD                             LCD1                  CSE029
     I              CHTP                            CHTP1                 CSE029
     I              TNLU                            TNLU1                 CSE029
      *                                                                   CSE029
     ISDNOST    E DSSDNOSTPD
     I              QQACCD                          QQACD2                                    CGL029
      ** Nostro Details
      *
     ISDCUST    E DSSDCUSTPD
     I              QQDFAC                          #DFAC1                                    CGL029
      ** Customer Details
     ISDCURR    E DSSDCURRPD                                              CSW003
      ** Currency Details                                                 CSW003
      *
     ISCSARD    E DSSCSARDPD                                              CEU003
     I              ZONE                            ZONED                                     CGP001
      ** SAR File Details Accessed via access program AOSARDR0            CEU003
      *                                                                   CEU003
     ISDLOCN    E DSSDLOCNPD                                                                  CSW207
      ** Location Code Details                                                                CSW207
      *                                                                                       CSW207
     ISDCNST    E DSSDCNSTPD                                                                  CSW210
      ** Midas SD Counterparty Nostro File                                                    CSW210
      *                                                                                       CSW210
     IMEBICD    E DSMEBICDPD                                                                  CSW210
      ** Midas BIC Directory                                                                  CSW210
      *                                                                                     AR589164
     ISDCCSY    E DSSDCCSYPD                                                                AR589164
      ** Currency Clearing Details                                                          AR589164
      *                                                                                     AR589164
     IDBERR       DS                            256
      * Data structure for data-base error processing.
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
      *
     IPSDS       SDS
      ** PROGRAM STATUS DATA STRUCTURE
     I                                      244 253 WSID
     I                                      254 263 USID
      *
     I            DS
      ** DATA STRUCTURE
     I                                        1  10 EU10
     I                                        1   1 EU0101
     I                                        1   4 EU0104
     I                                        2   7 EU0207
      *
     I/COPY ZSRSRC,ZNCDZ2
      *
     IKEY3DS      DS
      * DATA STRUCTURE KEY 3
     I                                        1   6 WWKEY3
     I                                        1   3 NMCY
     I                                        4   6 SITP
      *
     IWDATP       DS                        200
      ** DATA STRUCTURE FOR PRINTING OF MT592
     I                                        1  16 DTRNO
     I                                       17  32 DRELR
     I                                       33  40 DRELD
     I                                       41  46 DNWRK
      *
     ICANDS       DS                             50
      * DATA STRUCTURE FOR CANCELLATION
     I                                        1   3 DPBA
     I                                        4   50SMTH
     I                                        6  11 CCDEST
     I                                       12  17 DSBICN
     I                                       18  29 DSBTID
     I                                       30  31 DPMV
     I                                    P  32  340CCMVDT
     I                                       35  40 DPRN
     I                                       41  43 WCUR
     I                                    P  44  460WORED                 089115
     I                                       47  49 MTYP                  089115
      *
     I            DS
      * DATA STRUCTURE FOR EXTENDED SETTLEMENT FIELDS
     I                                        1  16 WXSFLD
     I                                        1   1 WXS53
     I                                        2   2 WXS57
     I                                        3   3 WXS58
     I                                        4   4 WXS71
     I                                        5   5 WXS72
     I                                        6   6 WXS77F
     I                                        7   7 WXS77R
     I                                        8   8 WXS79
     I                                        9   9 WXS82I
     I                                       10  10 WXS82C
     I                                       11  11 WXS83
     I                                       12  12 WXS84
     I                                       13  13 WXS85
     I                                       14  14 WXS87R
     I                                       15  15 WXS87D
     I                                       16  16 WXS88
      *
     ISDDTA       DS                                                      200292
     I                                        1 256 SDDATA                200292
     I                                        6   7 SPREFX                200292
      *                                                                                       CSW208
     I            DS                                                                          CSW208
     I                                        1   60PFRTM                                     CSW208
     I                                       11  160PMKTM                                     CSW208
     I                                       21  240PMKTOF                                    CSW208
     I                                       31  360PLCTM                                     CSW208
     I                                       41  440PLCTOF                                    CSW208
     I                                       51  560PSYTM                                     CSW208
     I                                       61  640PSYTOF                                    CSW208
      *                                                                                       CSW210
     I              'ABCDEFGHIJKLMNOPQRST-C         ALPHAN                                    CSW210
     I              'UVWXYZ0123456789'                                                        CSW210
      *                                                                                       CSW210
      ** Data Structure for extended settlement fields                                      AR589164
     I            DS                                                                        AR589164
     I                                        1  35 WDRAB                                   AR589164
     I                                        1   2 WP0102                                  AR589164
     I                                        3   4 WP0304                                  AR589164
     I                                        5  35 WP0535                                  AR589164
      *                                                                                     AR589164
      /TITLE Main Processing
      *================================================================
      *  P R O G R A M     S T A R T                                  *
      *================================================================
      *
      ***  Perform Initialisation.
     C                     EXSR INIT
      *
      ***  Perform Detail Processing.
     C                     EXSR PROCES
      *
      *================================================================
      *  P R O G R A M     E N D                                      *
      *                                                               *
     C                     SETON                     LR
     C                     RETRN
      *
      *****************************************************************
      /TITLE SR/INIT
      *****************************************************************
      *                                                               *
      *  INIT   - Subroutine to do Program Initialisation.            *
      *                                                               *
      *  Called By: Main Processing                                   *
      *  Calls    : None                                              *
      *                                                               *
      *****************************************************************
      *
     C           INIT      BEGSR
      *
      **  Copyright Statement
     C                     MOVEACPY@      BIS@   80
      *
      ** KLIST FOR DPTMVDY2
     C           KL2       KLIST
     C                     KFLD           WYDPSS
     C                     KFLD           WYDPRN
     C                     KFLD           DPWHEN                          CSW003
      *
      ** KLIST FOR INVTP
     C           KL3       KLIST
     C                     KFLD           NMCY
     C                     KFLD           SITP
      *
      ** KLIST FOR DPTMVDJ2
     C           KL4       KLIST
     C                     KFLD           WBRDNB
     C                     KFLD           WBDPSS
     C                     KFLD           WBDPRN
      *
      ** KLIST FOR DPTMVDJ3
     C           KL5       KLIST
     C                     KFLD           WCRDNB
     C                     KFLD           WCDPSS
     C                     KFLD           WCDPRN
      *
      ** GET PARAMETERS FROM CALLING PROGRAM
      ** PICFG - 'N' = I/C; 'Y' = COB
     C           *ENTRY    PLIST
     C                     PARM           PICFG   1
     C                     PARM           PSEQ
      *
      ** Access Bank Details
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' WRTCD   7
     C                     PARM '*FIRST ' WOPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
      *
     C           WRTCD     IFNE *BLANKS
     C                     Z-ADD001       DBASE            ***************
     C                     MOVEL'SDBANKPD'DBFILE           * DB ERROR 01 *
     C                     MOVE *BLANKS   DBKEY            ***************
     C                     EXSR *PSSR
     C                     END
      *
      ***  Check System Date Format, DDMMYY (*IN98 off)
      ***                            MMDDYY (*IN98 on).
      *
     C           BJDFIN    IFEQ 'M'
     C                     SETON                     98
     C                     END
      *
      ** ACCESS PF/SDGELRPD
     C**********           CALL 'AOGELRR0'                                                    CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*MSG   ' WRTCD   7
     C                     PARM '*FIRST ' WOPTN   7
     C********** SDGELR    PARM SDGELR    DSFDY                                               CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
      *
     C           WRTCD     IFNE *BLANKS
     C                     MOVEL'002'     DBASE            **************
     C                     MOVEL'SDGELRPD'DBFILE           * DB ERROR 2 *
     C                     MOVE *BLANKS   DBKEY            **************
     C                     EXSR *PSSR
     C                     END
      *                                                                   CEU003
      ** Check if Position/Risk Enquiries & Reports switchable            CEU003
      ** feature is on.                                                   CEU003
      *                                                                   CEU003
     C                     CALL 'AOSARDR0'                                CEU003
     C                     PARM '       ' WLRTCD  7                       CEU003
     C                     PARM '*VERIFY' WLOPTN  7                       CEU003
     C                     PARM 'CEU003'  @SARD   6                       CEU003
     C           SCSARD    PARM SCSARD    DSFDY                           CEU003
      *                                                                   CEU003
     C           WLRTCD    IFEQ *BLANKS                                   CEU003
     C                     MOVE 'Y'       CEU003  1                       CEU003
     C                     Z-ADD1         B       30                      CEU003
     C                     ELSE                                           CEU003
     C                     MOVE 'N'       CEU003                          CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C           WLRTCD    IFNE *BLANKS                                   CEU003
     C           WLRTCD    ANDNE'*NRF   '                                 CEU003
      *                                                                   CEU003
      ** Call to program ended in error                                   CEU003
      *                                                                   CEU003
     C                     MOVEL'CEU003'  DBKEY            ************** CEU003
     C                     MOVE 'SCSARDPD'DBFILE           * DB ERROR 33* CEU003
     C                     Z-ADD33        DBASE            ************** CEU003
     C                     MOVEL'SE1873'  DBPGM                           CEU003
     C                     SETON                     U7U8LR               CEU003
     C                     EXSR *PSSR                                     CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           *IN21     DOWEQ'0'                                       CEU003
     C                     READ SDCURRL0                 21               CEU003
     C                     MOVE A6CYCD    CUR,B                           CEU003
     C                     MOVE A6INCY    INCY,B                          CEU003
     C                     ADD  1         B                               CEU003
     C                     ENDDO                                          CEU003
     C                     ENDIF                                          CEU003
      *
      * Access Securities Trading ICD details
     C                     CALL 'AOSTRDR0'
     C                     PARM '*MSG   ' WRTCD   7
     C                     PARM '*FIRST ' WOPTN   7
     C           SDSTRD    PARM SDSTRD    DSSDY
      *
     C           WRTCD     IFNE *BLANKS
     C                     MOVEL'003'     DBASE            **************
     C                     MOVEL'SDSTRDPD'DBFILE           * DB ERROR 3 *
     C                     MOVE *BLANKS   DBKEY            **************
     C                     EXSR *PSSR
     C                     END
      *
      ** STORE DEPOT REFERENCE 1-EUROCLEAR AND 2-CEDEL
     C***********          MOVE BJCUST    WWEOC                           079669
     C***********          MOVE BJCUST    WWEOCN  60                      079669
     C                     MOVE BVDR1     WWEOC                           079669
     C**********           MOVE BVDR1     WWEOCN  60                                   079669 CSD027
     C                     MOVE BVDR1     WWEOCN  6                                           CSD027
     C                     MOVE BVDR2     WWCEDL
     C**********           MOVE BVDR2     WWCEDN  60                                          CSD027
     C                     MOVE BVDR2     WWCEDN  6                                           CSD027
     C                     MOVE BVDR3     WWAKV
      *
      ** RETRIEVE BIC 1-EUROCLEAR AND 2-CEDEL AND 3-KASSENVEREIN
     C                     MOVE *BLANKS   WCUST                                               205141
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   WRTCD
     C                     PARM '*KEY   ' WOPTN
     C                     PARM WWEOC     WCUST  10
     C                     PARM *BLANKS   WKYST   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           WRTCD     IFEQ *BLANKS
     C                     MOVE BBCSID    CSIDEO 12
     C                     ELSE
     C                     MOVEL'004'     DBASE            **************
     C                     MOVEL'SDCUSTPD'DBFILE           * DBERR  004 *
     C                     MOVE WWEOCN    DBKEY            **************
     C                     EXSR *PSSR
     C                     END
      *
     C                     MOVE *BLANKS   WCUST                                               205141
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   WRTCD
     C                     PARM '*KEY   ' WOPTN
     C                     PARM WWCEDL    WCUST  10
     C                     PARM *BLANKS   WKYST   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           WRTCD     IFEQ *BLANKS
     C                     MOVE BBCSID    CSIDCE 12
     C                     ELSE
     C                     MOVEL'005'     DBASE            **************
     C                     MOVEL'SDCUSTPD'DBFILE           * DBERR  005 *
     C                     MOVE WWCEDN    DBKEY            **************
     C                     EXSR *PSSR
     C                     END
      *
     C           WWAKV     IFNE *BLANKS                                                       215888
     C                     MOVE *BLANKS   WCUST                                               205141
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   WRTCD
     C                     PARM '*KEY   ' WOPTN
     C                     PARM WWAKV     WCUST  10
     C                     PARM *BLANKS   WKYST   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           WRTCD     IFEQ *BLANKS
     C                     MOVE BBCSID    CSIDAK 12
     C                     ELSE
     C                     MOVEL'006'     DBASE            **************
     C                     MOVEL'SDCUSTPD'DBFILE           * DBERR  006 *
     C**********           MOVE WWCEDL    DBKEY            **************                     215888
     C                     MOVE WWAKV     DBKEY                                               215888
     C                     EXSR *PSSR
     C                     END
     C                     ENDIF                                                              215888
      *
      ** RETRIEVE DEPOT IN  SECURITIES TRADING INFO
     C                     MOVE *BLANKS   CLAIE   1
     C                     MOVE *BLANKS   CLAIC   1
      *
     C********** DPID      IFNE 0                                                             CSD027
     C           DPID      IFNE *BLANKS                                                       CSD027
     C                     MOVE DPID      WWCUST
     C                     CALL 'AOSECSR0'
     C                     PARM *BLANKS   WRTCD   7
     C                     PARM '*KEY   ' WOPTN   7
     C                     PARM           WWCUST  6
     C           SDSECS    PARM SDSECS    DSSDY
      *
     C           WRTCD     IFNE *BLANKS
     C                     MOVEL'007'     DBASE            **************
     C                     MOVEL'SDSECSPD'DBFILE           * DB ERROR 07*
     C                     MOVELWWCUST    DBKEY            **************
     C                     EXSR *PSSR
     C                     END
      *
     C           BFCLAS    IFEQ 'E'
     C                     MOVE 'E'       CLAIE
     C                     END
     C           BFCLAS    IFEQ 'C'
     C                     MOVE 'C'       CLAIC
     C                     END
     C                     END
      *
      ** RETRIEVE DEPOT OUT SECURITIES TRADING INFO
     C                     MOVE *BLANKS   CLAOE   1
     C                     MOVE *BLANKS   CLAOC   1
      *
     C********** DPOD      IFNE 0                                                             CSD027
     C           DPOD      IFNE *BLANKS                                                       CSD027
     C                     MOVE DPOD      WWCUST
     C                     CALL 'AOSECSR0'
     C                     PARM *BLANKS   WRTCD   7
     C                     PARM '*KEY   ' WOPTN   7
     C                     PARM           WWCUST  6
     C           SDSECS    PARM SDSECS    DSSDY
      *
     C           WRTCD     IFNE *BLANKS
     C                     MOVEL'008'     DBASE            **************
     C                     MOVEL'SDSECSPD'DBFILE           * DB ERROR 08*
     C                     MOVELWWCUST    DBKEY            **************
     C                     EXSR *PSSR
     C                     END
      *
     C           BFCLAS    IFEQ 'E'
     C                     MOVE 'E'       CLAOE
     C                     END
     C           BFCLAS    IFEQ 'C'
     C                     MOVE 'C'       CLAOC
     C                     END
     C                     END
      *                                                                   CSW003
     C                     CALL 'AOSARDR0'                                CSW003
     C                     PARM *BLANKS   WRTCD                           CSW003
     C                     PARM '*VERIFY' WOPTN                           CSW003
     C                     PARM 'CSW003'  WSARD   6                       CSW003
     C*                                                                   CSW003
     C           WRTCD     IFEQ *BLANK                                    CSW003
     C                     MOVE 'Y'       CSW003  1                       CSW003
     C                     END                                            CSW003
      *                                                                   CSW007
      *  Check whether feature to produce maturity messages on input      CSW007
      *  is installed                                                     CSW007
     C                     CALL 'AOSARDR0'                                CSW007
     C                     PARM *BLANKS   WRTCD                           CSW007
     C                     PARM '*VERIFY' WOPTN                           CSW007
     C                     PARM 'CSW007'  WSARD   6                       CSW007
     C*                                                                   CSW007
     C           WRTCD     IFEQ *BLANK                                    CSW007
     C                     MOVE 'Y'       CSW007  1                       CSW007
     C                     END                                            CSW007
      *                                                                   CSE022
     C                     CALL 'AOSARDR0'                                CSE022
     C                     PARM *BLANKS   PRTCO   7                       CSE022
     C                     PARM '*VERIFY' POPTN   7                       CSE022
     C                     PARM 'CSE022'  PSARD   6                       CSE022
      *                                                                   CSE022
     C           PRTCO     IFEQ *BLANKS                                   CSE022
      *                                                                   CSE022
     C                     MOVE 'Y'       CSE022  1                       CSE022
      *                                                                   CSE022
     C                     ELSE                                           CSE022
      *                                                                   CSE022
     C                     MOVE 'N'       CSE022                          CSE022
      *                                                                   CSE022
     C                     ENDIF                                          CSE022
     C*                                                                   CSE029
     C** Check if ISO15022 is installed                                   CSE029
     C*                                                                   CSE029
     C                     CALL 'AOSARDR0'                                CSE029
     C                     PARM *BLANKS   PRTCO   7                       CSE029
     C                     PARM '*VERIFY' POPTN   7                       CSE029
     C                     PARM 'CSE029'  PSARD   6                       CSE029
      *                                                                   CSE029
     C           PRTCO     IFEQ *BLANKS                                   CSE029
     C                     MOVE 'Y'       CSE029  1                       CSE029
     C                     ELSE                                           CSE029
     C                     MOVE 'N'       CSE029                          CSE029
     C                     ENDIF                                          CSE029
     C*                                                                   200292
     C** Check if CSE015 is installed                                     200292
     C*                                                                   200292
     C                     CALL 'AOSARDR0'                                200292
     C                     PARM *BLANKS   PRTCO   7                       200292
     C                     PARM '*VERIFY' POPTN   7                       200292
     C                     PARM 'CSE015'  PSARD   6                       200292
      *                                                                   200292
     C           PRTCO     IFEQ *BLANKS                                   200292
     C                     MOVE 'Y'       CSE015  1                       200292
     C                     ELSE                                           200292
     C                     MOVE 'N'       CSE015                          200292
     C                     ENDIF                                          200292
      *                                                                                       CSW202
      ** Check if CSW202 is switched on                                                       CSW202
      *                                                                                       CSW202
     C                     CALL 'SWIF2002'                                                    CSW202
     C                     PARM *BLANKS   PRTCO                                               CSW202
      *                                                                                       CSW202
     C           PRTCO     IFEQ 'CSW2002'                                                     CSW202
     C                     MOVE 'Y'       CSW202  1                                           CSW202
     C                     ELSE                                                               CSW202
     C                     MOVE 'N'       CSW202                                              CSW202
     C                     ENDIF                                                              CSW202
      *                                                                                       CSW207
      ** Check if CSW2007 is switched on                                                      CSW207
      *                                                                                       CSW207
     C                     CALL 'SWIF2007'                                                    CSW207
     C                     PARM           PRTCD                                               CSW207
      *                                                                                       CSW207
     C           PRTCD     IFEQ 'CSW2007'                                                     CSW207
     C                     MOVE 'Y'       CSW207  1                                           CSW207
     C                     ELSE                                                               CSW207
     C                     MOVE 'N'       CSW207                                              CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW208
      ** Check if CSW2008 is switched on                                                      CSW208
      *                                                                                       CSW208
     C                     CALL 'SWIF2008'                                                    CSW208
     C                     PARM           PRTCD                                               CSW208
      *                                                                                       CSW208
     C           PRTCD     IFEQ 'CSW2008'                                                     CSW208
     C                     MOVE 'Y'       CSW208  1                                           CSW208
     C                     ELSE                                                               CSW208
     C                     MOVE 'N'       CSW208                                              CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW210
      ** Call SWIF2010 to check if CSW210 is switched on                                      CSW210
      *                                                                                       CSW210
     C                     CALL 'SWIF2010'                                                    CSW210
     C                     PARM *BLANKS   @RTCD                                               CSW210
      *                                                                                       CSW210
     C           @RTCD     IFEQ 'CSW2010'                                                     CSW210
     C                     MOVE 'Y'       CSW210  1                                           CSW210
     C                     ELSE                                                               CSW210
     C                     MOVE 'N'       CSW210                                              CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSW210
      *                                                                   200292
     C/COPY WNCPYSRC,SE1873C001
      *
      ** DEFINE WORKFIELDS
     C           *LIKE     DEFN MGSKAN    WWSKAN
     C           *LIKE     DEFN DPID      WWBICN
     C           *LIKE     DEFN DPID      WWDEST
     C           *LIKE     DEFN MGSTAM    WWSTAM
     C************LIKE     DEFN BJCUST    WWEOC                           079669
     C           *LIKE     DEFN BVDR1     WWEOC                           079669
     C           *LIKE     DEFN BVDR2     WWCEDL
     C           *LIKE     DEFN BVDR3     WWAKV
     C           *LIKE     DEFN DPDPRN    WWDPMV
     C           *LIKE     DEFN DPMD      WWMVDT
     C           *LIKE     DEFN DPDPRN    WBDPRN
     C           *LIKE     DEFN DPDPRN    WCDPRN
     C           *LIKE     DEFN BJRDNB    WBRDNB
     C           *LIKE     DEFN BJRDNB    WCRDNB
     C           *LIKE     DEFN DPSS      WWDPSS
     C           *LIKE     DEFN DPSS      WBDPSS
     C           *LIKE     DEFN DPSS      WCDPSS
     C           *LIKE     DEFN DPSS      WYDPSS
     C           *LIKE     DEFN DPRN      WYDPRN
     C                     MOVE 'N'       WWPR01  1
     C                     MOVE 'N'       WWPR02  1
     C                     Z-ADD*ZERO     RRLIV1
     C                     Z-ADD*ZERO     RRLIV2
     C                     Z-ADD*ZERO     RRLIV3
     C*                                                                   200292
     C** Get system prefix from SDSTAT                                    200292
     C*                                                                   200292
     C           *NAMVAR   DEFN SDSTAT    SDDTA                           200292
     C                     IN   SDDTA                                     200292
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/PROCES
      *****************************************************************
      *                                                               *
      *  PROCES - Subroutine to do the Detail Processing.             *
      *                                                               *
      *  Called By: Main Processing                                   *
      *  Calls: AMASF, MTYPE, GCMSG                                   *
      *                                                               *
      *****************************************************************
      *
     C           PROCES    BEGSR
      *
      ***  Read the Depot Movements/Extension Join File. Note that the
      ***  Logical is choosing the Depot Movements where the S.W.I.F.T.
      ***  Depot Movement Settlement Message has been requested and is
      ***  required.
      *
     C                     READ DPTMVDJ5                 50
     C                     MOVE CHTP      @CHG    1                                           CSW025
      *
      ***  Process all Depot Movements requiring Settlement Messages.
      *
     C           *IN50     DOWEQ'0'
      *                                                                                       205193
      ** If DPMV = RR, RP, PL or PD                                                           205193
      *                                                                                       205193
     C           DPMV      IFEQ 'RR'                                                          205193
     C           DPMV      OREQ 'RP'                                                          205193
     C           DPMV      OREQ 'PL'                                                          205193
     C           DPMV      OREQ 'PD'                                                          205193
     C/COPY WNCPYSRC,SE1873C026
      *                                                                                       205193
      ** Access DEALS file LF/DEALS using key Deal Number                                     205193
      *                                                                                       205193
     C           DPAD      CHAINDEALS                62                                       205193
     C           *IN62     IFEQ '1'                                                           205193
     C                     GOTO NEXT                                                          205193
     C                     ENDIF                                                              205193
     C                     ENDIF                                                              205193
      *
      ** SET ON INDICATOR TO AVOID 'COB PROCESSING' IN AUDIT REPORT
     C                     SETON                     40
      *
      ***  Count the record read.
      *
     C                     ADD  1         RRLIV1
     C                     Z-ADDORED      WORED                           089115
     C                     MOVEL'A'       MGCHG                                               CSW025
      *                                                                   200292
      ** If CSE015 is present, then calculate the telex notice date.      200292
      *                                                                   200292
     C           CSE015    IFEQ 'Y'                                       200292
     C                     EXSR CALTND                                    200292
     C                     END                                            200292
      *
      ** DETERMINE IF START DATE MESSAGE DUE
     C                     EXSR ICPSD
      *
      ** IF START/MATURITY WORKFIELD WWSTMT = 'S', EXECUTE INPUT CYCLE
      **  PROCESSING
     C           WWSTMT    IFEQ 'S'
     C                     EXSR ICP
     C                     END
      *
      ** DETERMINE IF MATURITY DATE MESSAGE DUE
     C                     EXSR ICPMD
      *
      ** IF START/MATURITY WORKFIELD WWSTMT = 'M', EXECUTE INPUT CYCLE
      **  PROCESSING
     C           WWSTMT    IFEQ 'M'
     C                     EXSR ICP
     C                     END
      *
      ***  Read the next record from the Depot Movements/Extension File
      *
     C           NEXT      TAG                                                                205193
     C                     READ DPTMVDJ5                 50
     C                     MOVE CHTP      @CHG    1                                           CSW025
     C                     END
      *
      *---------------------------------------------------------------*
      ** IF INPUT PARAMETER = Y (COB)
     C           PICFG     IFEQ 'Y'
     C           CSW007    ANDNE'Y'                                       CSW007
      *
      ** SET OFF INDICATOR TO IDENTIFY 'COB PROCESSING' TO AUDIT REPORT
     C                     MOVE '0'       *IN40
      *
      ***  Open File and Set Pointer to read Depot Movements with Date
      ***  In Equal To Tomorrow (up to Date of Next Working Day).
      *
     C                     OPEN DPTMVDJ2
     C                     MOVE *LOVAL    WBDPSS
     C                     MOVE *LOVAL    WBDPRN
     C           BJRDNB    ADD  1         WBRDNB
     C           KL4       SETLLDPTMVDJ2
     C                     READ DPTMVDJ2                 53
      *
      ** DO WHILE RECORDS EXIST FOR THIS DATE AND DPMD < OR = BJDNWD
     C           *IN53     DOWEQ'0'
     C           DPMD      ANDLEBJDNWD
      *
      ***  Count the record read.
     C                     ADD  1         RRLIV2
      *
      ***  Check if a Settlement Message has been requested.
      *
     C           DPGMES    IFEQ 'Y'
      *
      ** SET WORKFIELDS TO BLANKS
     C                     MOVE *BLANK    WWRCDL
     C                     Z-ADD0         WWMVDT
     C**********           Z-ADD0         WWDEST                                              CSD027
     C                     MOVE *BLANKS   WWDEST                                              CSD027
     C                     MOVE *BLANK    WWSTMT
      *                                                                   CSW003
     C           CSW003    IFNE 'Y'                                       CSW003
     C           CSW003    OREQ 'Y'                                       CSW003
     C           DPWHEN    ANDEQ'S'                                       CSW003
      *
      ** SET WORKFIELDS WWRCDL, WWMVDT, WWDEST, WWSTMT
     C           DPMV      IFEQ 'RR'
     C           DPMV      OREQ 'BB'
     C           DPMV      OREQ 'PL'
     C           DPMV      OREQ 'WI'
     C           DPMV      OREQ 'DT'                                      CSW003
     C           CSW003    ANDEQ'Y'                                       CSW003
      *
     C                     MOVE 'R'       WWRCDL  1
     C                     Z-ADDDPMD      WWMVDT
     C**********           Z-ADDDPID      WWDEST                                              CSD027
     C                     MOVE DPID      WWDEST                                              CSD027
     C                     MOVE 'S'       WWSTMT  1
      *                                                                   CSW003
     C           DPMV      IFEQ 'DT'                                      CSW003
     C                     EXSR ICP                                       CSW003
     C                     MOVE *BLANK    WWRCDL                          CSW003
     C                     Z-ADD0         WWMVDT                          CSW003
     C**********           Z-ADD0         WWDEST                                       CSW003 CSD027
     C                     MOVE *BLANKS   WWDEST                                              CSD027
     C                     MOVE *BLANK    WWSTMT                          CSW003
     C                     END                                            CSW003
      *                                                                   CSW003
     C                     END
      *                                                                   CSW003
     C                     END                                            CSW003
      *                                                                   CSW003
     C           CSW003    IFNE 'Y'                                       CSW003
     C           CSW003    OREQ 'Y'                                       CSW003
     C           DPWHEN    ANDEQ'M'                                       CSW003
      *
     C***********DPMV      IFEQ 'RP'                                      094415
     C***********DPMV      OREQ 'BL'                                      094415
     C***********DPMV      OREQ 'PD'                                      094415
     C***********DPMV      OREQ 'DT'                                      094415
     C           DPMV      IFEQ 'DT'                                      094415
     C                     MOVE 'D'       WWRCDL
     C                     Z-ADDDPMD      WWMVDT
     C**********           Z-ADDDPOD      WWDEST                                              CSD027
     C                     MOVE DPOD      WWDEST                                              CSD027
     C                     MOVE 'M'       WWSTMT
     C                     END
     C           DPMV      IFEQ 'RP'                                      094415
     C           DPMV      OREQ 'BL'                                      094415
     C           DPMV      OREQ 'PD'                                      094415
     C                     MOVE 'R'       WWRCDL                          094415
     C                     Z-ADDDPMD      WWMVDT                          094415
     C**********           Z-ADDDPID      WWDEST                                       094415 CSD027
     C                     MOVE DPID      WWDEST                                              CSD027
     C                     MOVE 'M'       WWSTMT                          094415
     C                     END                                            094415
      *                                                                   CSW003
     C                     END                                            CSW003
      *
      ** IF WWSTMT IS NON-BLANK EXECUTE INPUT CYCLE PROCESSING
     C           WWSTMT    IFNE *BLANKS
     C                     EXSR ICP
     C                     END
      *
     C                     ENDIF
      *
      ***  Read the next record from the Depot Movements/Extension Join
      ***  File by Date In.
      *
     C                     READ DPTMVDJ2                 53
     C                     END
      *
      ***  Open File and Set Pointer to read Depot Movements with Date
      ***  Out Equal To Tomorrow (up to Date of Next Working Day).
      *
     C                     OPEN DPTMVDJ3
     C                     MOVE *LOVAL    WCDPSS
     C                     MOVE *LOVAL    WCDPRN
     C           BJRDNB    ADD  1         WCRDNB
     C           KL5       SETLLDPTMVDJ3
     C                     READ DPTMVDJ3                 54
      *
      ** DO WHILE RECORDS EXIST FOR THIS DATE AND DPDO < OR = BJDNWD
     C           *IN54     DOWEQ'0'
     C           DPDO      ANDLEBJDNWD
      *
      ***  Count the record read.
      *
     C                     ADD  1         RRLIV3
      *
      ***  Check if a Settlement Message has been requested.
      *
     C           DPGMES    IFEQ 'Y'
      *
      ** SET WORKFIELDS TO BLANKS
     C                     MOVE *BLANK    WWRCDL
     C                     Z-ADD0         WWMVDT
     C**********           Z-ADD0         WWDEST                                              CSD027
     C                     MOVE *BLANKS   WWDEST                                              CSD027
     C                     MOVE *BLANK    WWSTMT
      *                                                                   CSW003
     C           CSW003    IFNE 'Y'                                       CSW003
     C           CSW003    OREQ 'Y'                                       CSW003
     C           DPWHEN    ANDEQ'S'                                       CSW003
      *
      ** SET WORKFIELDS WWRCDL, WWMVDT, WWDEST, WWSTMT
     C           DPMV      IFEQ 'RP'
     C           DPMV      OREQ 'BL'
     C           DPMV      OREQ 'PD'
     C***********          MOVE 'R'       WWRCDL                          094415
     C                     MOVE 'D'       WWRCDL                          094415
     C                     Z-ADDDPDO      WWMVDT
     C***********          Z-ADDDPOD      WWDEST                          094415
     C**********           Z-ADDDPID      WWDEST                                       094415 CSD027
     C                     MOVE DPID      WWDEST                                              CSD027
     C                     MOVE 'S'       WWSTMT
     C                     END
      *
     C           DPMV      IFEQ 'WO'
     C                     MOVE 'D'       WWRCDL
     C                     Z-ADDDPDO      WWMVDT
     C**********           Z-ADDDPOD      WWDEST                                              CSD027
     C                     MOVE DPOD      WWDEST                                              CSD027
     C                     MOVE 'S'       WWSTMT
     C                     END
      *                                                                   CSW003
     C                     END                                            CSW003
      *                                                                   CSW003
     C           CSW003    IFNE 'Y'                                       CSW003
     C           CSW003    OREQ 'Y'                                       CSW003
     C           DPWHEN    ANDEQ'M'                                       CSW003
      *
     C           DPMV      IFEQ 'RR'
     C           DPMV      OREQ 'BB'
     C           DPMV      OREQ 'PL'
     C                     MOVE 'D'       WWRCDL
     C                     Z-ADDDPDO      WWMVDT
     C**********           Z-ADDDPID      WWDEST                                              CSD027
     C                     MOVE DPID      WWDEST                                              CSD027
     C                     MOVE 'M'       WWSTMT
     C                     END
      *                                                                   CSW003
     C                     END                                            CSW003
      *
      ** IF WWSTMT IS NON-BLANK EXECUTE INPUT CYCLE PROCESSING
     C           WWSTMT    IFNE *BLANKS
     C                     EXSR ICP
     C                     END
      *
     C                     ENDIF
      *
      ***  Read the next record from the Depot Movements/Extension Join
      ***  File by Date Out.
      *
     C                     READ DPTMVDJ3                 54
     C                     END
      *
      ***  End of If Close of Business Run.
     C                     END
      *---------------------------------------------------------------*
      *
      ** If P1 print file open then write 'End of Report'; close file
     C           *IN15     IFEQ '1'
     C                     WRITETRAILP1
     C                     CLOSESE1873P1
     C                     END
      *
      ** If P2 print file open then write 'End of Report'; close file
     C           *IN16     IFEQ '1'
     C                     WRITETRAILP2
     C                     CLOSESE1873P2
     C                     END
      *
      ** OUTPUT RUN CONTROL REPORT
     C                     EXSR AUDIT
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/AMASF
      *****************************************************************
      *                                                               *
      *    AMASF     - ACCESS MASTER FILES                            *
      *                                                               *
      *    CALLED BY - PROCES                                         *
      *    CALLS     -                                                *
      *                                                               *
      *****************************************************************
      *
     C           AMASF     BEGSR
      *
      ** ACCESS PF/SDBRCHPD FOR BRANCH CODE
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' WRTCD
     C                     PARM '*KEY   ' WOPTN
     C                     PARM DPBA      WWBRCH  3
     C********** SDBRCH    PARM SDBRCH    DSFDY                                               CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *
     C           WRTCD     IFNE *BLANKS
     C                     MOVEL'009'     DBASE            **************
     C                     MOVEL'SDBRCHPD'DBFILE           * DB ERROR 9 *
     C                     MOVELWWBRCH    DBKEY            **************
     C                     EXSR *PSSR
     C                     END
      *
      ** SAVE BRANCH INTERNAL CUSTOMER IN WORKFIELD WWBICN
     C                     MOVE A8BICN    WWBICN
      *
      ** ACCESS JLF/SECTY    USING KEY SECURITY REFERENCE
     C           DPSS      CHAINSECTY                67
     C           *IN67     IFEQ '1'
     C***********CHTP      OREQ 'D'                                       094335
     C           RECI      OREQ '*'                                       094335
     C                     MOVEL'010'     DBASE            **************
     C                     MOVEL'SECTY   'DBFILE           * DB ERROR 10*
     C                     MOVELDPSS      DBKEY            **************
     C                     EXSR *PSSR
     C                     END
     C*                                                                   085245
     C*** Get other settlement depot information and set up array         085245
     C*                                                                   085245
     C           KL3       CHAININVTP                68                   085245
     C           *IN68     IFEQ '1'                                       085245
     C***********          MOVEL'027'     DBASE            ********085245 CSW003
     C                     MOVEL'029'     DBASE            ***************CSW003
     C                     MOVEL'INVTPD  'DBFILE           * DB ERROR 27 *085245
     C                     MOVELWWKEY3    DBKEY            ***************085245
     C                     EXSR *PSSR                                     085245
     C                     END                                            085245
     C*                                                                   085245
     C*** Set up settlement depot in array                                085245
     C*                                                                   085245
     C                     MOVE SDC1      SDPT,1                          085245
     C                     MOVE SDC2      SDPT,2                          085245
     C                     MOVE SDC3      SDPT,3                          085245
     C                     MOVE STC1      SDTY,1                          085245
     C                     MOVE STC2      SDTY,2                          085245
     C                     MOVE STC3      SDTY,3                          085245
      *
      ** ACCESS DEPOTS EXTENDED SETTLEMENTS - PF/DPTMVDY2
      ** USING KEY OF DEPOT REF AND SET ON FLAG IF RECORD EXISTS
     C                     MOVELDPSS      WYDPSS
     C                     MOVELDPRN      WYDPRN
     C           KL2       CHAINDPTMVDY2             69
     C           *IN69     IFEQ '0'
     C                     MOVE 'Y'       WWEXSS  1
     C                     ELSE
     C                     MOVE 'N'       WWEXSS
     C                     END
     C/COPY WNCPYSRC,SE1873C004
      *
      ** RESET EXTENDED FIELDS DATA STRUCTURE
     C                     MOVE *BLANKS   WXSFLD
      *
      ** IF DPMV = RR, RP, PL OR PD
     C           DPMV      IFEQ 'RR'
     C           DPMV      OREQ 'RP'
     C           DPMV      OREQ 'PL'
     C           DPMV      OREQ 'PD'
      *
      ** ACCESS DEALS FILE LF/DEALS USING KEY DEAL NUMBER
     C           DPAD      CHAINDEALS                62
      * If not found on live file, check histroic file                    130085
     C           *IN62     IFEQ '1'                                       130085
     C           DPAD      CHAINDLCHISD0             62                   130085
     C                     ENDIF                                          130085
      *                                                                   130085
     C           *IN62     IFEQ '1'
     C                     MOVEL'011'     DBASE            **************
     C                     MOVEL'DEALS   'DBFILE           * DB ERROR 11*
     C                     MOVELDPAD      DBKEY            **************
     C                     EXSR *PSSR
     C                     END
     C                     END
     C/COPY WNCPYSRC,SE1873C002
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/MTYPE
      *****************************************************************
      *                                                               *
      *    MTYPE     - DETERMINE MESSAGE TYPE                         *
      *                                                               *
      *    CALLED BY - PROCES                                         *
      *    CALLS     - NONE                                           *
      *                                                               *
      *****************************************************************
      *
     C           MTYPE     BEGSR
      *
      ** INITIALISE WTYP
     C                     MOVE *BLANKS   WTYP    3
      *
      ** CHECK IF DESTINATION IS NOT EOC OR CEDEL ANYWAY
     C                     MOVE *BLANKS   CLADE   1
     C                     MOVE *BLANKS   CLADC   1
     C                     MOVE WWDEST    WWCUST
     C                     CALL 'AOSECSR0'
     C                     PARM *BLANKS   WRTCD   7
     C                     PARM '*KEY   ' WOPTN   7
     C                     PARM           WWCUST  6
     C           SDSECS    PARM SDSECS    DSSDY
      *
     C           WRTCD     IFNE *BLANK
     C                     MOVEL'012'     DBASE            **************
     C                     MOVEL'SDSECSPD'DBFILE           * DB ERROR 12*
     C                     MOVELWWDEST    DBKEY            **************
     C                     EXSR *PSSR
     C                     END
      *
     C           BFCLAS    IFEQ 'E'
     C                     MOVE 'E'       CLADE
     C                     END
     C           BFCLAS    IFEQ 'C'
     C                     MOVE 'C'       CLADC
     C                     END
      *
      ** IF WWDEST IS EOC OR CEDEL
     C           WWDEST    IFEQ WWEOCN
     C           WWDEST    OREQ WWCEDN
     C           CLADE     OREQ 'E'
     C           CLADC     OREQ 'C'
     C                     MOVE '580'     WTYP
     C                     ELSE
      *
      ** IF WWRCDL IS 'R'
     C           WWRCDL    IFEQ 'R'
      *
      ** IF DPFIND IS 'F'
     C           DPFIND    IFEQ 'F'
     C                     MOVE '520'     WTYP
     C                     ELSE
     C                     MOVE '521'     WTYP
     C                     END
     C                     ELSE
      *
      ** IF DPFIND IS 'F'
     C           DPFIND    IFEQ 'F'
     C                     MOVE '522'     WTYP
     C                     ELSE
     C                     MOVE '523'     WTYP
     C                     END
     C                     END
     C                     END
      *
      ** ACCESS CUSTOMER DETAILS  - JLF/SDSECSJ3 WITH KEY OF WWDEST
     C                     MOVE WWDEST    WWCUST  6
     C                     CALL 'AOSECSR0'
     C                     PARM *BLANKS   WRTCD   7
     C                     PARM '*KEY   ' WOPTN   7
     C                     PARM           WWCUST  6
     C           SDSECS    PARM SDSECS    DSSDY
      *
     C           WRTCD     IFNE *BLANK
     C                     MOVEL'013'     DBASE            **************
     C                     MOVEL'SDSECSPD'DBFILE           * DB ERROR 13*
     C                     MOVELWWDEST    DBKEY            **************
     C                     EXSR *PSSR
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/GCMSG
      *****************************************************************
      *                                                               *
      *    GCMSG     - GENERATE CANCELLATION MESSAGES                 *
      *                                                               *
      *    CALLED BY - PROCES                                         *
      *    CALLS     - MG9500                                         *
      *                                                               *
      *****************************************************************
      *
     C           GCMSG     BEGSR
      *
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' WRTCD
     C                     PARM '*KEY   ' WOPTN
     C                     PARM DPBA      WWBRCH  3
     C********** SDBRCH    PARM SDBRCH    DSFDY                                               CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *
     C           WRTCD     IFNE *BLANKS
     C                     MOVEL'014'     DBASE            **************
     C                     MOVEL'SDBRCHPD'DBFILE           * DB ERROR 14*
     C                     MOVELWWBRCH    DBKEY            **************
     C                     EXSR *PSSR
     C                     END
      *
      ** ACCESS JLF/SECTY    USING KEY SECURITY REFERENCE
     C           DPSS      CHAINSECTY                67
     C           *IN67     IFEQ '1'
     C***********CHTP      OREQ 'D'                                       094335
     C           RECI      OREQ '*'                                       094335
     C                     MOVEL'015'     DBASE            **************
     C                     MOVEL'SECTY   'DBFILE           * DB ERROR 15*
     C                     MOVELDPSS      DBKEY            **************
     C                     EXSR *PSSR
     C                     END
      *
     C                     MOVELWWDEST    CCDEST
     C                     Z-ADDWWMVDT    CCMVDT
     C                     MOVELNMCY      WCUR
     C                     MOVELNMCY      @@NMCY  3                       167826
      *
      ** IF 580 TO BE SENT TO CEDEL, SEQUENCE NO MUST BE FILLED
      ** OTHERWISE SEQUENCE NO MUST BE BLANK
     C                     MOVEL*BLANKS   TSEQ
     C                     MOVEL*BLANKS   CEDPRO
      *
     C***********WWDEST    IFEQ WWCEDN                                    094335
     C***********          MOVELDPLSSC    TSEQ                            094335
     C***********          MOVE 'Y'       CEDPRO  1                       094335
     C***********          END                                            094335
      *
     C                     MOVE *BLANKS   TRNUM  10
     C                     MOVELDPRN      TRNUM
     C***********DPMV      IFEQ 'RR'                                      CSW003
     C***********DPMV      OREQ 'RP'                                      CSW003
     C***********DPMV      OREQ 'BB'                                      CSW003
     C***********DPMV      OREQ 'BL'                                      CSW003
     C***********DPMV      OREQ 'PL'                                      CSW003
     C***********DPMV      OREQ 'PD'                                      CSW003
     C***********          MOVE 'A'       TRNUM                           CSW003
     C***********          END                                            CSW003
     C           DPWHEN    IFEQ 'S'                                       CSW003
     C           CSW003    ANDEQ'Y'                                       CSW003
     C           CSW003    ORNE 'Y'                                       CSW003
     C                     MOVE 'DM'      TTYPE                           CSW003
     C                     ELSE                                           CSW003
     C                     MOVE 'DN'      TTYPE                           CSW003
     C                     END                                            CSW003
     C                     MOVEL*BLANKS   DTRNO
      *
     C                     MOVE A8BICN    DSBICN
     C                     MOVE A8BTID    DSBTID
     C                     MOVELWTYP      MTYP                            089115
      *
     C                     CALL 'MG9500'               20
     C                     PARM           TRNUM
     C                     PARM 'PR'      CALLP   2
     C                     PARM 'SE'      MODID   2
     C************         PARM 'DM'      TTYPE   2                       CSW003
     C                     PARM           TTYPE   2                       CSW003
     C                     PARM *BLANKS   WRTNC   1
     C                     PARM           TSEQ    7
     C                     PARM           WDATP  46        DATA TO PRINT
     C                     PARM           CANDS  50
     C                     PARM           CEDPRO  1                       094335
     C                     PARM           CSW003                          CSW003
      *
      ** IF PROGRAM NOT FOUND
     C           *IN20     IFEQ '1'
     C                     MOVE '016'     DBASE            **************
     C                     MOVE *BLANKS   DBKEY            * DB ERROR 16*
     C                     MOVEL'MG9500'  DBPGM            **************
     C                     EXSR *PSSR
     C                     END
      *
      ** IF ERROR DURING PROGRAM
     C           WRTNC     IFEQ 'E'
     C                     MOVE '017'     DBASE            ***************
     C                     MOVE *BLANKS   DBKEY            * DBERROR 017 *
     C                     MOVELTRNUM     DBKEY            ***************
     C                     MOVEL'MG9500'  DBPGM
     C                     EXSR *PSSR
     C                     END
      *
     C***********CEDPRO    IFEQ 'Y'                                       094335
      *
     C           WRTNC     IFEQ 'D'
     C           CEDPRO    IFEQ 'Y'                                       094335
      ** IF RECORD NOT FOUND ON MGOREFPD
      ** AND CEDEL CANCELLATION PROCESSING, PRINT ON REPORT
     C                     MOVELDPRN      R2TDRF
     C                     MOVEL'001'     WRK9    9
     C                     MOVE DPRN      WRK9
     C                     MOVELWRK9      R2TRN
     C                     MOVE DPLSSC    R2TRN
     C                     MOVE 'Y'       WWPR02  1
      *
      ***  If print file not yet open then open it and write headings
     C           *IN16     IFEQ '0'
      *
     C                     OPEN SE1873P2
     C                     MOVE '1'       *IN16
      *
     C                     Z-ADDSFNUM2    ZSNUM   60
     C                     CALL 'ZSFILE'
     C                     PARM           PSEQ    5
     C                     PARM *BLANKS   WPARM   3
     C                     PARM           SFILE2
     C                     PARM           ZSNUM
     C                     PARM           ZSERR   1
      *
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
      *
      ** PRINT PAGE HEADINGS
     C                     WRITEHEADP2
      *
     C                     END
      *
      ** WRITE A DETAIL LINE TO THE REPORT CHECKING FOR OVERFLOW
     C           WWOFL2    SUB  WWPTL2    WWLIN2  20
     C           WWLIN2    IFLT 3
     C                     WRITEHEADP2
     C                     END
      *
     C                     WRITEDETAIL2
     C                     CLEARDETAIL2
      *
     C                     END
     C                     END                                            094335
      *
      ** IF CANCEL MESSAGE TO BE PRODUCED
     C           WRTNC     IFEQ 'C'
     C                     CLEARMGF580D0
     C                     MOVEL@@NMCY    MGNMCY                          167826
     C                     MOVELWWCEDN    MGDEST
     C                     MOVELDPRN      MGTNUM
     C                     MOVEL'SE'      MGMODI
     C***********          MOVEL'DM'      MGTTYP                          CSW003
     C                     MOVELTTYPE     MGTTYP                          CSW003
     C                     MOVELDPBA      MGSNBR
     C                     MOVELDPBA      MGBRCA                          104331
     C                     MOVELDPINST    MGTSTP                          073848
     C                     MOVEL'/CANCEL/'MGFIN1
      *
      ** WRITE A RECORD TO MGF580PD
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           STCY      ANDNE*BLANKS                                   CEU003
     C                     Z-ADD34        DBASE                           CEU003
     C                     EXSR SREURO                                    CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C                     WRITEMGF580D0               79
     C           *IN79     IFEQ '1'
     C                     MOVEL'018'     DBASE            **************
     C                     MOVEL'MGF580PD'DBFILE           * DB ERROR 18*
     C                     MOVE *BLANKS   DBKEY            **************
     C                     EXSR *PSSR
     C                     END
      *
     C                     CLEARMGF580D0
      *
     C                     END
     C**********           ELSE                                           094335
      *
      ** PRINT MT592 GENERATED
     C           WRTNC     IFEQ 'F'                                       094335
     C                     EXSR WPR01
     C                     END
      *
     C                     MOVEL'D'       MGCHG                                               CSW025
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/MSGST
      *****************************************************************
      *                                                               *
      *    MSGST     - PRODUCE VALID MESSAGE                          *
      *                                                               *
      *    CALLED BY - PROCES                                         *
      *    CALLS     - FMTALL, FMT52X, FMT52Y, FMT52Z, FMT520, FMT521,*
      *                FMT522,                                        *
      *                                                               *
      *****************************************************************
      *
     C           MSGST     BEGSR
      *
      ** FORMAT FIELDS COMMON TO ALL MESSAGES
     C           WTYP      IFNE *BLANKS
     C                     EXSR FMTALL
     C                     END
      *
      ** FORMAT FIELDS COMMON TO MT52xx MESSAGES
     C           WTYP      IFEQ '520'
     C           WTYP      OREQ '521'
     C           WTYP      OREQ '522'
     C           WTYP      OREQ '523'
     C                     EXSR FMT52X
     C                     END
      *
      ** FORMAT FIELDS COMMON TO MT520 & MT521
     C           WTYP      IFEQ '520'
     C           WTYP      OREQ '521'
     C                     EXSR FMT52Y
     C                     END
      *
      ** FORMAT FIELDS COMMON TO MT521 & MT523
     C           WTYP      IFEQ '521'
     C           WTYP      OREQ '523'
     C                     EXSR FMT52Z
     C                     END
      *
      ** FORMAT FIELDS COMMON TO MT522 & MT523
     C           WTYP      IFEQ '522'
     C           WTYP      OREQ '523'
     C                     EXSR FMT520
     C                     END
      *
      ** FORMAT FIELDS COMMON TO MT521, MT523 & MT580
     C           WTYP      IFEQ '521'
     C           WTYP      OREQ '523'
     C           WTYP      OREQ '580'
     C                     EXSR FMT521
     C                     END
      *
      ** EXTENDED SETTLEMENT FIELDS
     C                     MOVE WXSFLD    MGXSFL
     C/COPY WNCPYSRC,SE1873C003
      *
      ** WRITE A RECORD TO MGF520PD
     C           WTYP      IFEQ '520'
     C*                                                                   CSE029
     C** If New ISO15022 is needed then donot output MT520                CSE029
     C*                                                                   CSE029
     C           DPNEW     IFNE 'Y'                                       CSE029
      *                                                                                       CSW202
      ** Bypass writing of record if SWIFT 2002 is installed                                  CSW202
      *                                                                                       CSW202
     C           CSW202    ANDNE'Y'                                                           CSW202
      *                                                                                       CSW202
     C                     MOVE @CHG      MGCHG                                               CSW025
     C                     MOVE @CHG      MGCHG                                               CSW025
     C                     WRITEMGF520D0               70
     C           *IN70     IFEQ '1'
     C                     MOVEL'019'     DBASE            **************
     C                     MOVEL'MGF520PD'DBFILE           * DB ERROR 19*
     C                     MOVE *BLANKS   DBKEY            **************
     C                     EXSR *PSSR
     C                     END
     C*                                                                   CSE029
     C                     ENDIF                                          CSE029
     C/COPY WNCPYSRC,SE1873C005
     C                     END
      *
      ** WRITE A RECORD TO MGF521PD
     C           WTYP      IFEQ '521'
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           STCY      ANDNE*BLANKS                                   CEU003
     C                     Z-ADD35        DBASE                           CEU003
     C                     EXSR SREURO                                    CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C** If New ISO15022 is needed then donot output MT521                CSE029
     C*                                                                   CSE029
     C           DPNEW     IFNE 'Y'                                       CSE029
      *                                                                                       CSW202
      ** Bypass writing of record if SWIFT 2002 is installed                                  CSW202
      *                                                                                       CSW202
     C           CSW202    ANDNE'Y'                                                           CSW202
      *                                                                                       CSW202
     C                     MOVE @CHG      MGCHG                                               CSW025
     C                     MOVE @CHG      MGCHG                                               CSW025
     C                     WRITEMGF521D0               71
     C           *IN71     IFEQ '1'
     C                     MOVEL'020'     DBASE            **************
     C                     MOVEL'MGF521PD'DBFILE           * DB ERROR 20*
     C                     MOVE *BLANKS   DBKEY            **************
     C                     EXSR *PSSR
     C                     END
     C*                                                                   CSE029
     C                     ENDIF                                          CSE029
     C/COPY WNCPYSRC,SE1873C006
     C                     END
      *
      ** WRITE A RECORD TO MGF522PD
     C           WTYP      IFEQ '522'
     C*                                                                   CSE029
     C** If New ISO15022 is needed then donot output MT521                CSE029
     C*                                                                   CSE029
     C           DPNEW     IFNE 'Y'                                       CSE029
      *                                                                                       CSW202
      ** Bypass writing of record if SWIFT 2002 is installed                                  CSW202
      *                                                                                       CSW202
     C           CSW202    ANDNE'Y'                                                           CSW202
      *                                                                                       CSW202
     C                     MOVE @CHG      MGCHG                                               CSW025
     C                     MOVE @CHG      MGCHG                                               CSW025
     C                     WRITEMGF522D0               72
     C           *IN72     IFEQ '1'
     C                     MOVEL'021'     DBASE            **************
     C                     MOVEL'MGF522PD'DBFILE           * DB ERROR 21*
     C                     MOVE *BLANKS   DBKEY            **************
     C                     EXSR *PSSR
     C                     END
     C*                                                                   CSE029
     C                     ENDIF                                          CSE029
     C/COPY WNCPYSRC,SE1873C007
     C                     END
      *
      ** WRITE A RECORD TO MGF523PD
     C           WTYP      IFEQ '523'
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           STCY      ANDNE*BLANKS                                   CEU003
     C                     Z-ADD36        DBASE                           CEU003
     C                     EXSR SREURO                                    CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C** If New ISO15022 is needed then donot output MT523                CSE029
     C*                                                                   CSE029
     C           DPNEW     IFNE 'Y'                                       CSE029
      *                                                                                       CSW202
      ** Bypass writing of record if SWIFT 2002 is installed                                  CSW202
      *                                                                                       CSW202
     C           CSW202    ANDNE'Y'                                                           CSW202
      *                                                                                       CSW202
     C                     MOVE @CHG      MGCHG                                               CSW025
     C                     MOVE @CHG      MGCHG                                               CSW025
     C                     WRITEMGF523D0               73
     C           *IN73     IFEQ '1'
     C                     MOVEL'022'     DBASE            **************
     C                     MOVEL'MGF523PD'DBFILE           * DB ERROR 22*
     C                     MOVE *BLANKS   DBKEY            **************
     C                     EXSR *PSSR
     C                     END
     C*                                                                   CSE029
     C                     ENDIF                                          CSE029
     C/COPY WNCPYSRC,SE1873C008
     C                     END
      *
      ** FORMAT FIELDS SPECIFIC TO MT580
     C           WTYP      IFEQ '580'
     C                     EXSR FMT522
     C                     END
     C*                                                                   CSE029
     C** If ISO15022 is needed, then format ISO fields                    CSE029
     C*                                                                   CSE029
     C           CSE029    IFEQ 'Y'                                       CSE029
     C           DPNEW     ANDEQ'Y'                                       CSE029
     C                     EXSR FMTISO                                    CSE029
     C                     ENDIF                                          CSE029
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/FMTALL
      *****************************************************************
      *                                                               *
      *    FMTALL    - FORMAT COMMON FIELDS                           *
      *                                                               *
      *    CALLED BY - MSGST                                          *
      *    CALLS     -                                                *
      *                                                               *
      *****************************************************************
      *
     C           FMTALL    BEGSR
      *
      ** SET UP TRANSACTION NUMBER
     C                     MOVELDPRN      MGTNUM
      *
      ** MODULE ID
     C                     MOVE 'SE'      MGMODI
      *
      ** TRANSACTION TYPE
     C           DPWHEN    IFEQ 'S'                                       CSW003
     C           CSW003    ANDEQ'Y'                                       CSW003
     C           CSW003    ORNE 'Y'                                       CSW003
     C                     MOVE 'DM'      MGTTYP
     C                     ELSE                                           CSW003
     C                     MOVE 'DN'      MGTTYP                          CSW003
     C                     END                                            CSW003
      *
      ** TRANSACTION SUB-TYPE
     C                     MOVE DPMV      MGTSTP
      *
      ** BRANCH CODE OF SENDER
     C                     MOVE DPBA      MGSNBR
      *
      ** SETTLEMENT BRANCH
     C                     MOVE DPBA      MGBRCA
      *
      ** QUANTITY OF SECURITIES
     C                     Z-ADDDPNA      MGQANT
      *
      ** Nominal decimal places                                           078256
     C                     Z-ADDNMDP      MGNMDP                          078256
      *                                                                   078256
      ** NOMINAL CURRENCY
     C***********DPMV      IFEQ 'PL'                                      CSW003
     C***********DPMV      OREQ 'PD'                                      CSW003
     C***********DPMV      OREQ 'RR'                                      CSW003
     C***********DPMV      OREQ 'RP'                                      CSW003
     C***********          MOVE CCY       MGNMCY                          CSW003
     C***********          ELSE                                           CSW003
     C                     MOVE NMCY      MGNMCY
     C***********          END                                            CSW003
     C*                                                                   085245
     C*** Output Security Ref. Number depending on settlement depot       085245
     C*** For MT580 Messages use ISIN/Common Code.                        085245
     C******************************************************************* 085326
     C****IF*CUSIP*number*is*being*used*then*for*US*Treasury*Bill**085245 085326
     C*******move*'%'*to*the*last*field*in*the*MGISIN*to*represent*085245 085326
     C*******the*word*'CUSIP'*is*needed*to*be*printed**************085245 085326
     C****Else*****************************************************085245 085326
     C*******for*US*Treasury*Note*move*'\'*to*the*last*field*to****085245 085326
     C*******represent*the*word*'CUSIP'*not*needed.****************085245 085326
     C*** If CUSIP number is being used then move '%' to last field       085326
     C***    in MGISIN so that the word 'CUSIP' will be printed for       085326
     C***    both US Teasury Bill and Notes.                              085326
     C******************************************************************* 085326
     C*** For messages other then MT580                                   085245
     C*** If no refer is indicated then it will use ISIN/Common Code      085245
     C*** field if it is not *BLANKS                                      085245
      *
      ** ISIN OF SECURITY
     C*                                                                   085245
     C           WTYP      IFEQ '580'                                     085245
     C*                                                                   085245
     C                     MOVE ISIN      MGISIN
     C*                                                                   085245
     C                     ELSE                                           085245
     C*                                                                   085245
     C                     Z-ADD1         I       10                      085245
     C                     MOVE '0'       *IN01                           085245
     C           *IN01     DOWEQ'0'                                       085245
     C*                                                                   085245
     C           MGDEST    IFEQ SDPT,I                                    085245
     C                     MOVE '1'       *IN01                           085245
     C                     ELSE                                           085245
     C                     ADD  1         I                               085245
     C           I         IFEQ 4                                         085245
     C                     MOVE '1'       *IN01                           085245
     C                     END                                            085245
     C                     END                                            085245
     C*                                                                   085245
     C                     END                                            085245
     C*                                                                   085245
     C           I         IFEQ 4                                         085245
     C                     MOVELISIN      MGISIN                          085245
     C                     ELSE                                           085245
     C*                                                                   085245
     C           SDTY,I    IFEQ 'C'                                       085245
     C                     MOVELCSPN      MGISIN                          085245
     C***********CPNR      IFEQ 0                                  085245 085326
     C                     MOVE '%'       MGISIN                          085245
     C                     ELSE                                           121633
     C                     MOVELISIN      MGISIN                          121633
     C***********          ELSE                                    085245 085326
     C***********          MOVE '\'       MGISIN                   085245 085326
     C***********          END                                     085245 085326
     C                     END                                            085245
     C           SDTY,I    IFEQ 'T'                                       CSW003
     C                     MOVELT2RF      MGISIN                          CSW003
     C                     END                                            CSW003
     C           SDTY,I    IFEQ 'C'                                       CSW003
     C                     MOVELSREF      MGISIN                          CSW003
     C                     END                                            CSW003
     C           SDTY,I    IFEQ ' '                                       CSW003
     C           I         IFEQ 1                                         CSW003
     C                     MOVELDASR      MGISIN                          CSW003
     C                     ELSE                                           CSW003
     C           I         IFEQ 2                                         CSW003
     C                     MOVELDCSR      MGISIN                          CSW003
     C                     ELSE                                           CSW003
     C           I         IFEQ 3                                         CSW003
     C                     MOVELDDSR      MGISIN                          CSW003
     C                     END                                            CSW003
     C                     END                                            CSW003
     C                     END                                            CSW003
     C           MGISIN    IFEQ *BLANKS                                   CSW003
     C                     MOVELISIN      MGISIN                          CSW003
     C                     END                                            CSW003
     C                     END                                            CSW003
     C*                                                                   085245
     C                     END                                            085245
     C*                                                                   085245
     C                     END                                            085245
      *
      ** SECURITY FULL NAME-1 & 2
     C           SFN1      IFNE *BLANKS
     C                     MOVE SFN1      MGSFN1
     C                     MOVE SFN2      MGSFN2
     C                     ELSE
     C                     MOVELSESN      MGSFN1
     C                     MOVELSRPN      MGSFN2
     C                     END
     C*                                                                   CSW003
     C           DPWHEN    IFEQ 'S'                                       CSW003
     C           DPITRA    ANDNE*ZEROS                                    CSW003
     C                     MOVE DPITRA    MGITRA                          CSW003
     C                     ELSE                                           CSW003
     C           DPWHEN    IFEQ 'M'                                       CSW003
     C           DPITRA    ANDNE*ZEROS                                    CSW003
     C                     MOVE DPITRA    MGITRA                          CSW003
     C                     ELSE                                           CSW003
     C                     MOVE *BLANKS   MGITRA                          CSW003
     C                     END                                            CSW003
     C                     END                                            CSW003
     C*                                                                   CSW003
     C                     MOVE NMCY      MGITCY                          CSW003
     C*                                                                   CSW003
     C           DPTDER    IFNE *ZEROS                                    CSW003
     C                     MOVE DPTDER    MGDAXR                          CSW003
     C                     MOVE DPTDER    MGITXR                          CSW003
     C                     ELSE                                           CSW003
     C                     MOVE *BLANKS   MGDAXR                          CSW003
     C                     MOVE *BLANKS   MGITXR                          CSW003
     C                     END                                            CSW003
     C*                                                                   CSW003
     C                     MOVE 'C'       MGACIN                          CSW003
      *
      ** SENDER TO RECEIVER INFO.
      ** IF RECORD EXISTS ON PF/DPTMVDY2 FOR THIS TRADE
     C           WWEXSS    IFEQ 'Y'
     C                     MOVE 'Y'       WXS72
     C                     MOVE D2SRL1    MGSRL1
     C                     MOVE D2SRL2    MGSRL2
     C                     MOVE D2SRL3    MGSRL3
     C                     END
     C*                                                                   CSW003
     C*   Set up date of trade and deal amount.                           CSW003
     C*                                                                   CSW003
B1   C           CSW003    IFEQ 'Y'                                       CSW003
B1   C           DPMV      IFEQ 'RR'                                      CSW003
     C           DPMV      OREQ 'RP'                                      CSW003
     C           DPMV      OREQ 'PL'                                      CSW003
     C           DPMV      OREQ 'PD'                                      CSW003
     C*                                                                   CSW003
     C                     MOVE DDAT      MGTDAT                          CSW003
     C                     CALL 'AOCURRR0'                                CSW003
     C                     PARM '*MSG   ' WRTCD                           CSW003
     C                     PARM '*KEY   ' WOPTN                           CSW003
     C                     PARM NMCY      @AJCD   3                       CSW003
     C           SDCURR    PARM SDCURR    DSSDY                           CSW003
     C           WRTCD     IFNE *BLANKS                                   CSW003
     C                     MOVEL'032'     DBASE            ************** CSW003
     C                     MOVEL'SDCURRPD'DBFILE           * DB ERROR 32* CSW003
     C                     MOVELNMCY      DBKEY            ************** CSW003
     C                     EXSR *PSSR                                     CSW003
E2   C                     END                                            CSW003
      *                                                                   CSW003
     C                     Z-ADDDPNA      ZNOML                           CSW003
     C                     Z-ADDDPPRIC    ZPRC                            CSW003
     C                     Z-ADDA6NBDP    ZCDP                            CSW003
     C                     EXSR ZCNSD                                     CSW003
     C                     Z-ADDZCONS     MGDLAM                          CSW003
E1   C                     END                                            CSW003
      *                                                                   CSW003
E1   C                     END                                            CSW003
     C/COPY WNCPYSRC,SE1873C010
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/FMT52X
      *****************************************************************
      *                                                               *
      *    FMT52X    - FORMAT FIELDS COMMON TO MT52xx MESSAGES        *
      *                                                               *
      *    CALLED BY - MSGST                                          *
      *    CALLS     - ZNCD                                           *
      *                                                               *
      *****************************************************************
      *
     C           FMT52X    BEGSR
      *
      ***  Next Coupon Date. If Security is not Interest-Bearing,
      ***  (implied by Initial Date = 0 or Coupon Rate = 0), then set
      ***  the Next Coupon Date to zero.
      *
     C           ITLD      IFEQ 0
     C           CPNR      OREQ 0
     C                     Z-ADD0         MGNCDT
     C                     ELSE
     C           WWMVDT    ADD  1         ECD     50
     C                     EXSR ZNCD
     C                     Z-ADDNCD       MGNCDT
     C                     ENDIF
      *
      ** INSTRUCTING PARTY & INSTRUCTING PARTY A/C LINE
      *
      ** DATE OF TRADE
     C           DPMV      IFEQ 'PL'
     C           DPMV      OREQ 'PD'
     C           DPMV      OREQ 'RR'
     C           DPMV      OREQ 'RP'
     C                     MOVE DDAT      MGTDAT
     C                     ELSE
     C                     MOVE *ZEROS    MGTDAT
     C/COPY WNCPYSRC,SE1873C011
     C                     END
      *
      ** SAFEKEEPING ACCOUNT A/C LINE
     C           WWEXSS    IFEQ 'Y'
     C           D2SKAN    ANDNE*BLANKS
     C           WWEXSS    OREQ 'Y'
     C           D2SKAL    ANDNE*BLANKS
     C                     MOVE 'Y'       WXS83
     C                     MOVE D2SKAN    MGSKAN
     C                     MOVE D2SKAL    MGSKAL
     C                     ELSE
      *                                                                   CSE022
     C           CSE022    IFEQ 'N'                                       CSE022
      *
      ** MOVE ALL DEPOT REF. FROM SECURITIES TRADING FILE - SDSTRDPD
      ** INTO AN ARRAY SO THAT THE EQUIVALENT DEPOT REF. FROM CUSTOMER
      ** DETAILS FILE - SDSECSJ3 CAN BE FOUND
     C************         MOVE BJCUST    DEP,1                           079669
     C                     MOVE BVDR1     DEP,1                           079669
     C                     MOVE BVDR2     DEP,2
     C                     MOVE BVDR3     DEP,3
     C                     MOVE BVDR4     DEP,4
     C                     MOVE BVDR5     DEP,5
     C                     MOVE BVDR6     DEP,6
     C                     MOVE BVDR7     DEP,7
     C                     MOVE BVDR8     DEP,8
     C                     MOVE BVDR9     DEP,9
     C                     MOVE BVDR10    DEP,10
      *
      ** IF WORKFIELD WWDEST EQUALS ANY OF DEPOT REF. ON SDSTRDPD
     C           WWDEST    LOKUPDEP                      30
     C           *IN30     IFEQ '1'
      *
      ** ACCESS CUSTOMER DETAILS - JLF/SDSECSJ3
     C                     MOVE WWBICN    WWKBCN  6
     C                     CALL 'AOSECSR0'
     C                     PARM *BLANKS   WRTCD   7
     C                     PARM '*KEY   ' WOPTN   7
     C                     PARM           WWKBCN  6
     C           SDSECS    PARM SDSECS    DSSDY
      *
     C           WRTCD     IFNE *BLANKS
     C                     MOVEL'023'     DBASE            **************
     C                     MOVEL'SDSECSPD'DBFILE           * DB ERROR 23*
     C                     MOVELWWBICN    DBKEY            **************
     C                     EXSR *PSSR
     C                     END
      *
      ** FIND EQUIVALENT DEPOT REFERENCE
     C           WWDEST    IFEQ DEP,1
     C                     MOVELBFNDR1    BFDRF1                          CSE022
     C                     MOVE BFDRF1    WWSKAN
     C                     END
     C           WWDEST    IFEQ DEP,2
     C                     MOVELBFNDR2    BFDRF2                          CSE022
     C                     MOVE BFDRF2    WWSKAN
     C                     END
     C           WWDEST    IFEQ DEP,3
     C                     MOVELBFNDR3    BFDRF3                          CSE022
     C                     MOVE BFDRF3    WWSKAN
     C                     END
     C           WWDEST    IFEQ DEP,4
     C                     MOVELBFNDR4    BFDRF4                          CSE022
     C                     MOVE BFDRF4    WWSKAN
     C                     END
     C           WWDEST    IFEQ DEP,5
     C                     MOVELBFNDR5    BFDRF5                          CSE022
     C                     MOVE BFDRF5    WWSKAN
     C                     END
     C           WWDEST    IFEQ DEP,6
     C                     MOVELBFNDR6    BFDRF6                          CSE022
     C                     MOVE BFDRF6    WWSKAN
     C                     END
     C           WWDEST    IFEQ DEP,7
     C                     MOVELBFNDR7    BFDRF7                          CSE022
     C                     MOVE BFDRF7    WWSKAN
     C                     END
     C           WWDEST    IFEQ DEP,8
     C                     MOVELBFNDR8    BFDRF8                          CSE022
     C                     MOVE BFDRF8    WWSKAN
     C                     END
     C           WWDEST    IFEQ DEP,9
     C                     MOVELBFNDR9    BFDRF9                          CSE022
     C                     MOVE BFDRF9    WWSKAN
     C                     END
     C           WWDEST    IFEQ DEP,10
     C                     MOVELBFNDR0    BFDRF0                          CSE022
     C                     MOVE BFDRF0    WWSKAN
     C                     END
      *
      ** SET UP SAFEKEEPING ACCOUNT
     C           WWSKAN    IFNE *BLANKS
     C                     MOVE WWSKAN    MGSKAN
     C                     ELSE
     C                     MOVE WWBICN    MGSKAN
     C                     END
      *
     C                     END
      *                                                                   CSE022
     C                     ELSE                                           CSE022
      *                                                                   CSE022
     C                     MOVEL'SEDOR'   WPGM    9                       CSE022
     C                     MOVE 'FRTV'    WPGM                            CSE022
     C                     MOVELWWDEST    PDEPOT                          CSE022
     C                     MOVELWWBICN    PCNUM                           CSE022
      *                                                                   CSE022
     C                     CALL WPGM                                      CSE022
     C                     PARM *BLANKS   PRTRN  10                       CSE022
     C                     PARM           PDEPOT  6                       CSE022
     C                     PARM           PCNUM   6                       CSE022
     C                     PARM *BLANKS   PSKALR 20                       CSE022
      *                                                                   CSE022
     C           PSKALR    IFNE *BLANKS                                   CSE022
     C                     MOVELPSKALR    MGSKAN                          CSE022
     C                     MOVELPSKALR    MGSKAL                          CSE022
     C                     ELSE                                           CSE022
     C                     MOVE WWBICN    MGSKAN                          CSE022
     C                     ENDIF                                          CSE022
      *                                                                   CSE022
     C                     ENDIF                                          CSE022
     C                     END
      *
      ** SET UP SWIFT SECURITY TYPE
     C                     MOVE SWTP      MGSWTP
      *
      ** INSTRUCTING PARTY & INSTRUCTING PARTY A/C LINE
     C           WWEXSS    IFEQ 'Y'
     C                     MOVE 'Y'       WXS82I
     C                     MOVELD2IPYN    MGIPYN
     C                     MOVELD2IPYL    MGIPYL
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/FMT52Y
      *****************************************************************
      *                                                               *
      *    FMT52Y    - FORMAT FIELDS COMMON TO MT520 & MT521          *
      *                                                               *
      *    CALLED BY - MSGST                                          *
      *    CALLS     - NONE                                           *
      *                                                               *
      *****************************************************************
      *
     C           FMT52Y    BEGSR
      *
      ** DELIVERER OF SECURITIES AND DEL. OF SECURITIES A/C LINE
     C           WWEXSS    IFEQ 'Y'
     C           D2DSSN    ANDNE*BLANKS
     C           WWEXSS    OREQ 'Y'
     C           D2DSS1    ANDNE*BLANKS
     C                     MOVE 'Y'       WXS87D
     C                     MOVE D2DSSN    MGDSSN
     C                     MOVE D2DSS1    MGDSS1
      ** Include other detail lines of Deliverer of Security              192221
     C                     MOVE D2DSS2    MGDSS2                          192221
     C                     MOVE D2DSS3    MGDSS3                          192221
     C                     MOVE D2DSS4    MGDSS4                          192221
     C                     ELSE
      *
     C           DPMV      IFEQ 'WI'
     C                     MOVELWWBICN    MGDSSN
     C                     END
      *
     C           DPMV      IFEQ 'RR'
     C           DPMV      OREQ 'BB'
     C           DPMV      OREQ 'PL'
     C                     MOVELDPOD      MGDSSN
     C                     END
      *
     C           DPMV      IFEQ 'RP'
     C           DPMV      OREQ 'PD'
     C           DPMV      OREQ 'BL'
     C           DPMV      OREQ 'DT'
     C***********          MOVELDPID      MGDSSN                          094415
     C                     MOVELDPOD      MGDSSN                          094415
     C                     END
     C                     END
      *
      ** BENEFICIARY OF SECURITIES AND BENE. OF SECURITIES A/C LINE
     C           WWEXSS    IFEQ 'Y'
     C           D2BSSN    ANDNE*BLANKS
     C           WWEXSS    OREQ 'Y'
     C           D2BSS1    ANDNE*BLANKS
     C                     MOVE 'Y'       WXS88
     C                     MOVE D2BSSN    MGBSSN
     C                     MOVE D2BSS1    MGBSS1
     C                     ELSE
      *
     C           DPMV      IFEQ 'WI'
     C                     MOVELDPBN      MGBSSN
     C/COPY WNCPYSRC,SE1873C020
     C                     END
     C                     END
      *
      ** FORCE SETTLEMENT DATE FOR A DEPOT TRANSFER
     C           DPMV      IFEQ 'DT'
     C                     Z-ADDDPMD      WWMVDT
     C                     END
      *
      ** SETTLEMENT DATE
     C           WWMVDT    IFLT BJRDNB                                    104032
     C                     Z-ADDBJRDNB    MGSDAT                          104032
     C                     ELSE                                           104032
     C                     MOVE WWMVDT    MGSDAT
     C                     END                                            104032
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/FMT52Z
      *****************************************************************
      *                                                               *
      *    FMT52Z    - FORMAT FIELDS COMMON TO MT521 & MT523          *
      *                                                               *
      *    CALLED BY - MSGST                                          *
      *    CALLS     - NONE                                           *
      *                                                               *
      *****************************************************************
      *
     C           FMT52Z    BEGSR
      *
      ** IF RECORD FOUND ON DPTMVDY2 FOR THIS DEPOT
     C           WWEXSS    IFEQ 'Y'
      *
      ** SET UP ACCOUNT FOR PAYMENT, ACCOUNT FOR PAYMENT A/C LINE
     C           D2AFPN    IFNE *BLANKS
     C           D2AFPL    ORNE *BLANKS
     C                     MOVE 'Y'       WXS53
     C                     MOVE D2AFPN    MGAFPN
     C                     MOVE D2AFPL    MGAFPL
     C                     END
      *
      ** ACCOUNT WITH INSTITUTION, ACCOUNT WITH INST. A/C LINE
     C           D2AWIN    IFNE *BLANKS
     C           D2AFPL    ORNE *BLANKS
     C                     MOVE 'Y'       WXS57
     C                     MOVE D2AWIN    MGAWIN
     C                     MOVE D2AWIL    MGAWIL
     C                     END
      *
      ** BENEFICIARY OF MONEY, BENEFICIARY OF MONEY A/C LINE
     C           D2BOFN    IFNE *BLANKS
     C           D2BOF1    ORNE *BLANKS
     C                     MOVE 'Y'       WXS58
     C                     MOVE D2BOFN    MGBOFN
     C                     MOVE D2BOF1    MGBOF1
     C                     END
      *
      ** ACCOUNT FOR CHARGES 1 AND 2
     C           D2ACL1    IFNE *BLANKS
     C           D2ACL2    ORNE *BLANKS
     C                     MOVE 'Y'       WXS71
     C                     MOVE D2ACL1    MGACL1
     C                     MOVE D2ACL2    MGACL2
     C                     END
     C                     END
      *
      **  IF DEPOT MOVEMENT TYPE 'RR' OR 'RP', SETUP DEAL AMOUNT.
      *
     C           DPMV      IFEQ 'RR'
     C           DPMV      OREQ 'RP'
     C           DPMV      OREQ 'PD'                                      103449
     C           DPMV      OREQ 'PL'                                      103449
     C           CSW003    IFNE 'Y'                                       125251
     C                     Z-ADDPCPL      MGDLAM
     C                     END                                            125251
     C                     ENDIF
      *
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/FMT520
      *****************************************************************
      *                                                               *
      *    FMT520    - FORMAT FIELDS COMMON TO MT522 & MT523          *
      *                                                               *
      *    CALLED BY - MSGST                                          *
      *    CALLS     - NONE                                           *
      *                                                               *
      *****************************************************************
      *
     C           FMT520    BEGSR
      *
      ** RECEIVER OF SECURITIES
     C           WWEXSS    IFEQ 'Y'
     C           D2RSSN    ANDNE*BLANKS
     C           WWEXSS    OREQ 'Y'
     C           D2RSS1    ANDNE*BLANKS
     C                     MOVE 'Y'       WXS87R
     C                     MOVE D2RSSN    MGRSSN
     C                     MOVE D2RSS1    MGRSS1
      ** Include other detail lines of Receiver of Security               192221
     C                     MOVE D2RSS2    MGRSS2                          192221
     C                     MOVE D2RSS3    MGRSS3                          192221
     C                     MOVE D2RSS4    MGRSS4                          192221
     C                     ELSE
      *
     C           DPMV      IFEQ 'WO'
     C                     MOVELWWBICN    MGRSSN
     C                     END
      *
     C           DPMV      IFEQ 'RR'
     C           DPMV      OREQ 'BB'
     C           DPMV      OREQ 'PL'
     C           DPMV      OREQ 'RP'                                      094415
     C           DPMV      OREQ 'PD'                                      094415
     C           DPMV      OREQ 'BL'                                      094415
     C                     MOVELDPOD      MGRSSN
     C                     END
      *
     C***********DPMV      IFEQ 'RP'                                      094415
     C***********DPMV      OREQ 'PD'                                      094415
     C***********DPMV      OREQ 'BL'                                      094415
     C***********DPMV      OREQ 'DT'                                      094415
     C           DPMV      IFEQ 'DT'                                      094415
     C                     MOVELDPID      MGRSSN
     C                     END
     C                     END
      *
      ** BENEFICIARY OF SECURITIES AND BENE. OF SECURITIES A/C LINE
     C           WWEXSS    IFEQ 'Y'
     C           D2BSSN    ANDNE*BLANKS
     C           WWEXSS    OREQ 'Y'
     C           D2BSS1    ANDNE*BLANKS
     C                     MOVE 'Y'       WXS88
     C                     MOVE D2BSSN    MGBSSN
     C                     MOVE D2BSS1    MGBSS1
     C                     ELSE
      *
     C           DPMV      IFEQ 'WO'
     C                     MOVELDPBN      MGBSSN
     C/COPY WNCPYSRC,SE1873C021
     C                     END
     C                     END
      *
      ** FORCE SETTLEMENT DATE FOR A DEPOT TRANSFER
     C           DPMV      IFEQ 'DT'
     C                     Z-ADDDPMD      WWMVDT
     C                     END
      *
      ** SETTLEMENT DATE
     C           WWMVDT    IFLT BJRDNB                                    104032
     C                     Z-ADDBJRDNB    MGSDAT                          104032
     C                     ELSE                                           104032
     C                     MOVE WWMVDT    MGSDAT
     C                     END                                            104032
     C/COPY WNCPYSRC,SE1873C012
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/FMT521
      *****************************************************************
      *                                                               *
      *    FMT521    - FORMAT FIELDS :32 AND :33                      *
      *                                                               *
      *    CALLED BY - MSGST                                          *
      *    CALLS     - NONE                                           *
      *                                                               *
      *****************************************************************
      *
     C           FMT521    BEGSR
      *
      ** SET UP SECURITY TRADE BASIS
     C                     MOVE STBS      MGSTBS
      *
      ** SECURITY PRICE BASIS
     C                     MOVE SPBS      MGSPBS
      *
      ** SETTLEMENT CURRENCY AND SETTLEMENT AMOUNT
     C           DPMV      IFEQ 'RR'
     C           DPMV      OREQ 'RP'
     C           DPMV      OREQ 'PD'                                      CSW003
     C           DPMV      OREQ 'PL'                                      CSW003
     C/COPY WNCPYSRC,SE1873C013
     C                     MOVE CCY       MGSTCY
     C/COPY WNCPYSRC,SE1873C014
     C***********          MOVE PCPL      MGSTAM                          125251
     C*                                                                   125251
     C**    RETRIEVE NBR OF DECIMALS FOR DEAL AND NOMINAL CCY             125251
     C                     CALL 'AOCURRR0'                                125251
     C                     PARM '*MSG   ' WRTCD                           125251
     C                     PARM '*KEY   ' WOPTN                           125251
     C                     PARM NMCY      @AJCD   3                       125251
     C           SDCURR    PARM SDCURR    DSSDY                           125251
     C           WRTCD     IFNE *BLANKS                                   125251
     C                     MOVEL'034'     DBASE            ************** 125251
     C                     MOVEL'SDCURRPD'DBFILE           * DB ERROR 32* 125251
     C                     MOVELNMCY      DBKEY            ************** 125251
     C                     EXSR *PSSR                                     125251
E2   C                     END                                            125251
     C                     Z-ADDA6NBDP    DPNMCY  10                      125251
B2   C           PRBS      IFEQ 'P'                                       125251
     C                     SETON                       73                 125251
E2   C                     END                                            125251
B2   C           A6NBDP    IFEQ 0                                         125251
     C           DPNA      MULT DPPRIC    WKDLAM 308                      125251
     C   73      WKDLAM    DIV  100       MGDLAM    H                     125251
X2   C                     ELSE                                           125251
B3   C           A6NBDP    IFEQ 1                                         125251
     C           DPNA      MULT DPPRIC    WKDLAM 308                      125251
     C   73      WKDLAM    DIV  100       MGDLA1 151H                     125251
     C  N73                Z-ADDWKDLAM    MGDLA1    H                     125251
     C           MGDLA1    MULT 10        MGDLAM                          125251
X3   C                     ELSE                                           125251
B4   C           A6NBDP    IFEQ 2                                         125251
     C           DPNA      MULT DPPRIC    WKDLAM                          125251
     C   73      WKDLAM    DIV  100       MGDLA2 152H                     125251
     C  N73                Z-ADDWKDLAM    MGDLA2    H                     125251
     C           MGDLA2    MULT 100       MGDLAM                          125251
X4   C                     ELSE                                           125251
B5   C           A6NBDP    IFEQ 3                                         125251
     C           DPNA      MULT DPPRIC    WKDLAM                          125251
     C   73      WKDLAM    DIV  100       MGDLA3 153H                     125251
     C  N73                Z-ADDWKDLAM    MGDLA3    H                     125251
     C           MGDLA3    MULT 1000      MGDLAM                          125251
E5   C                     END                                            125251
E4   C                     END                                            125251
E3   C                     END                                            125251
E2   C                     END                                            125251
     C/COPY WNCPYSRC,SE1873C015
     C                     CALL 'AOCURRR0'                                125251
     C                     PARM '*MSG   ' WRTCD                           125251
     C                     PARM '*KEY   ' WOPTN                           125251
     C                     PARM CCY       @AJCD   3                       125251
     C           SDCURR    PARM SDCURR    DSSDY                           125251
     C           WRTCD     IFNE *BLANKS                                   125251
     C                     MOVEL'034'     DBASE            ************** 125251
     C                     MOVEL'SDCURRPD'DBFILE           * DB ERROR 32* 125251
     C                     MOVELCCY       DBKEY            ************** 125251
     C                     EXSR *PSSR                                     125251
E2   C                     END                                            125251
     C/COPY WNCPYSRC,SE1873C016
     C           MGDLAM    ADD  DPITRA    MGSTAM                          125251
     C           MGSTAM    MULT DPTDER    WKSTAM 308H                     125251
     C*                                                                   125251
     C**    ADJUST AMOUNT WITH DIFFERENCE OF DECIMALS                     125251
     C           DPNMCY    IFGT A6NBDP                                    125251
     C           DPNMCY    SUB  A6NBDP    DP      10                      125251
     C                     ADD  1         DP                              125251
     C           WKSTAM    DIV  POWER9,DP MGSTAM    H                     125251
     C                     ELSE                                           125251
     C           A6NBDP    SUB  DPNMCY    DP                              125251
     C                     ADD  1         DP                              125251
     C           WKSTAM    MULT POWER9,DP MGSTAM    H                     125251
     C                     END                                            125251
     C/COPY WNCPYSRC,SE1873C017
     C                     ELSE
      *
     C                     MOVE NMCY      MGSTCY
     C           MKTP      IFNE 0
     C           DPNA      MULT MKTP      MGSTAM
     C                     ELSE
     C           DPNA      MULT MKPR      MGSTAM
     C                     END
     C                     END
      *
      ** MARKET PRICE
     C           DPPRIC    IFNE *ZEROS                                    CSW003
     C                     MOVE DPPRIC    MGPRIC                          CSW003
     C                     ELSE                                           CSW003
     C           MKTP      IFNE 0
     C                     MOVE MKTP      MGPRIC
     C                     ELSE
     C                     MOVE MKPR      MGPRIC
     C                     END
     C                     END                                            CSW003
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/FMT522
      *****************************************************************
      *                                                               *
      *    FMT522    - FORMAT FIELDS SPECIFIC TO MT580                *
      *                                                               *
      *    CALLED BY - MSGST                                          *
      *    CALLS     -                                                *
      *                                                               *
      *****************************************************************
      *
     C           FMT522    BEGSR
      *
      ** FORCE SETTLEMENT DATE FOR A DEPOT TRANSFER
     C           DPMV      IFEQ 'DT'
     C                     Z-ADDDPMD      WWMVDT
     C                     END
      *
      ** SETTLEMENT DATE
     C           WWMVDT    IFLT BJRDNB                                    104032
     C                     Z-ADDBJRDNB    MGSDAT                          104032
     C                     ELSE                                           104032
     C                     MOVE WWMVDT    MGSDAT
     C                     END                                            104032
     C/COPY WNCPYSRC,SE1873C018
      *
      ** IF WWRCDL IS 'R'
     C           WWRCDL    IFEQ 'R'
      *
      ** FIELD 23 SUB-FIELD 1
     C           DPFIND    IFEQ 'F'
     C                     MOVE 'RECFREE' MGF231
     C                     ELSE
     C                     MOVE 'RECAPMT' MGF231
     C                     END
     C                     ELSE
      *
     C           DPFIND    IFEQ 'F'
     C                     MOVE 'DELFREE' MGF231
     C                     ELSE
     C                     MOVE 'DELAPMT' MGF231
     C                     END
     C                     END
      *
      ** ASSUME DEFAULT VALUE FOR BOOK ENTRY WHEN 6F OR 61
     C           DPINSS    IFEQ *BLANKS                                   CSW003
     C*                                                                   CSW003
     C           DPINST    IFEQ '6F'
     C           DPINST    OREQ '61'
     C           DPINST    OREQ '03 '                                     CSW003
     C           DPINST    OREQ '03K'                                     CSW003
     C           DPINST    OREQ '07 '                                     CSW003
     C           DPINST    OREQ '07K'                                     CSW003
     C                     MOVEL'BOOK'    DPINSS
     C                     END
      *
      ** ASSUME DEFAULT VALUE FOR MATCHING & SETTLEMENT
     C           DPINST    IFEQ '01 '
     C           DPINST    OREQ '02 '
     C           DPINST    OREQ '03C'
     C           DPINST    OREQ '07C'
     C                     MOVEL'SETTL'   DPINSS
     C                     END
     C                     END                                            CSW003
      *
      ** ASSUME DEFAULT VALUE FOR FREE OR AGAINST PAYMENT (EUROCLEAR)
     C           DPINST    IFEQ '01 '
     C           DPINST    OREQ '02 '
     C           DPINST    OREQ '03 '
      *
     C           MGF231    IFEQ 'RECAPMT'
     C           MGF231    OREQ 'DELAPMT'
     C                     MOVE 'P'       DPINST
     C                     ELSE
     C                     MOVE 'F'       DPINST
     C                     END
      *
     C                     END
      *
      ** INSTRUCTIONS TYPE AND SUB-TYPE
     C                     Z-ADD1         J       20
     C                     MOVELDPINST    WKINST  2
     C           WKINST    LOKUPECIN,J                   85
     C           *IN85     IFEQ '1'                        Found numeric.
     C                     MOVELECTA,J    MGINST
     C           DPINSS    IFNE *BLANKS
     C                     MOVELDPINSS    MGINSS
     C                     ELSE
     C                     MOVELECSA,J    MGINSS
     C                     END
     C                     ELSE                            Numeric not f.
      *
     C                     Z-ADD1         J       20
     C                     MOVE DPINST    WKINST
     C           WKINST    LOKUPECIN,J                   85
     C           *IN85     IFEQ '1'                        Found alpha
     C                     MOVELECTA,J    MGINST
     C                     MOVELECSA,J    MGINSS
     C                     ELSE                            Alpha not f.
      *
     C                     MOVELDPINST    MGINST
     C                     MOVELDPINSS    MGINSS
     C                     END
     C                     END
      *
     C           MGINSS    IFEQ ' BOOK'
     C                     MOVEL'BOOK '   MGINSS
     C                     END
      *
      ** SAFEKEEPING ACCOUNT
     C                     MOVELDPSAFA    MGSAFA
      *
      ** REQUESTED PRIORITY
     C                     MOVELDPRPTY    MGRPTY
      *
      ** SENDERS ROLE
     C                     MOVELDPSROL    MGSROL
      *
      ** GUARANTEED DELIVERY INDICATOR
     C                     MOVE DPGDEL    MGGDEL
      *
      ** MARKET INDICATOR
     C                     MOVE MKTI      MGMKTI
      *
      ** TIME OF TRADE
     C                     MOVE DPTRTT    MGTRTT
      *
     C           WWEXSS    IFEQ 'Y'
     C           D2AWIN    ANDNE*BLANKS
     C           WWEXSS    OREQ 'Y'
     C           D2AWIL    ANDNE*BLANKS
     C                     MOVE D2AWIN    MGAWIN
     C                     MOVE D2AWIL    MGAWIL
     C                     ELSE
      *
     C           DPMV      IFEQ 'RR'
     C           DPMV      OREQ 'RP'
     C           DPMV      OREQ 'PD'                                      103449
     C           DPMV      OREQ 'PL'                                      103449
      *
     C           WWSTMT    IFEQ 'S'
     C           SDST      ANDEQ01
     C           WWSTMT    OREQ 'S'
     C           SDST      ANDEQ07
     C           WWSTMT    OREQ 'S'
     C           SDST      ANDEQ08
      *
      ** ACCESS LF/SDNOSTL0 USING KEY CCY AND FIRST 2 CHARS OF TSTN
     C***********          MOVELTSTN      WWTMAN  2                       089773
     C***********          CALL 'AONOSTR0'                                089773
     C***********          PARM *BLANKS   WRTCD   7                       089773
     C***********          PARM '*KEY   ' WOPTN   7                       089773
     C***********          PARM *BLANKS   PWCUST  6          Customer No  089773
     C***********          PARM CCY       PWCYCD  3          Currency     089773
     C***********          PARM *BLANKS   PWACCD  4          A/c Code     089773
     C***********          PARM *BLANKS   PWACSN  2          A/c Seq      089773
     C***********          PARM WWTMAN    PWNONB  2          Nostro No    089773
     C***********          PARM *BLANKS   PWBRCD  3          Branch Code  089773
     C***********          PARM *BLANKS   PWCSSN 10          Cust ShortN  089773
     C***********          PARM *BLANKS   PWPNOI  1          Prime Nost In089773
     C***********SDNOST    PARM SDNOST    DSFDY                           089773
      ***********                                                         089773
     C***********WRTCD     IFNE *BLANKS                                   089773
     C***********          MOVEL'024'     DBASE            ************** 089773
     C***********          MOVEL'SDNOSTPD'DBFILE           * DB ERROR 24* 089773
     C***********          MOVELCCY       DBKEY5  5        ************** 089773
     C***********          MOVE WWTMAN    DBKEY5                          089773
     C***********          MOVE DBKEY5    DBKEY                           089773
     C***********          EXSR *PSSR                                     089773
     C***********          END                                            089773
      ***********                                                         089773
      ** ACCOUNT WITH INSTITUTION
     C***********          MOVELA7CUST    MGAWIN                          089773
     C                     MOVELTSTN      MGAWIN                          089773
     C                     END
      *
     C           WWSTMT    IFEQ 'M'
     C           SDST      ANDEQ01
     C           WWSTMT    OREQ 'M'
     C           SDST      ANDEQ07
     C           WWSTMT    OREQ 'M'
     C           SDST      ANDEQ08
      *
      ** ACCESS LF/SDNOSTL0 USING KEY CCY AND FIRST 2 CHARS OF TSTN
     C***********          MOVELTMAN      WWTMAN  2                       089773
     C***********          CALL 'AONOSTR0'                                089773
     C***********          PARM *BLANKS   WRTCD   7                       089773
     C***********          PARM '*KEY   ' WOPTN   7                       089773
     C***********          PARM *BLANKS   PWCUST  6          Customer No  089773
     C***********          PARM CCY       PWCYCD  3          Currency     089773
     C***********          PARM *BLANKS   PWACCD  4          A/c Code     089773
     C***********          PARM *BLANKS   PWACSN  2          A/c Seq      089773
     C***********          PARM WWTMAN    PWNONB  2          Nostro No    089773
     C***********          PARM *BLANKS   PWBRCD  3          Branch Code  089773
     C***********          PARM *BLANKS   PWCSSN 10          Cust ShortN  089773
     C***********          PARM *BLANKS   PWPNOI  1          Prime Nost In089773
     C***********SDNOST    PARM SDNOST    DSFDY                           089773
      ***********                                                         089773
     C***********WRTCD     IFNE *BLANKS                                   089773
     C***********          MOVEL'025'     DBASE            ************** 089773
     C***********          MOVEL'SDNOSTPD'DBFILE           * DB ERROR 25* 089773
     C***********          MOVELCCY       DBKEY5  5        ************** 089773
     C***********          MOVE WWTMAN    DBKEY5                          089773
     C***********          MOVE DBKEY5    DBKEY                           089773
     C***********          EXSR *PSSR                                     089773
     C***********          END                                            089773
      ***********                                                         089773
      ** ACCOUNT WITH INSTITUTION
     C***********          MOVELA7CUST    MGAWIN                          089773
      * NOTE TMAN (Their Maturity Nostro) contains a customer number      089773
      * it comes from Intermediary bank or 'Account with bank' on         089773
      * the settlements sceen.                                            089773
      * (PS I think that the chain using TSTN above may be dodgy as       089773
      * well)                                                             089773
     C                     MOVELTMAN      MGAWIN                          089773
     C                     END
     C                     END
     C                     END
      *
      ** RECEIVER OF SECURITIES, RECEIVER OF SECURITIES A/C LINE
     C           WWEXSS    IFEQ 'Y'
     C           D2RSSN    ANDNE*BLANKS
     C           WWEXSS    OREQ 'Y'
     C           D2RSS1    ANDNE*BLANKS
     C                     MOVE D2RSSN    MGRSSN
     C                     MOVE D2RSS1    MGRSS1
     C                     MOVE D2RSS2    MGRSS2
     C                     MOVE D2RSS3    MGRSS3
     C                     MOVE D2RSS4    MGRSS4
     C                     ELSE
      *
      ** IF EUROCLEAR/CEDEL CODE IS NOT BLANK
     C           DPEUCL    IFEQ *BLANKS
     C                     MOVELDPBN      MGRSSN
     C/COPY WNCPYSRC,SE1873C022
     C                     ELSE
     C                     MOVELDPEUCL    MGRSS1
     C                     END
      *
     C***********MGDEST    IFEQ WWEOCN                     Euroclear      CSW003
     C           CLADE     IFEQ 'E'                        Euroclear      CSW003
     C           DPINST    IFNE '03C'
     C           DPINST    ANDNE'07C'
     C           DPINST    ANDNE'BRI'                                     103746
     C                     MOVELDPEUCL    EU10
     C           EU0104    IFEQ '//XE'
     C           EU0104    OREQ '//XC'
     C                     MOVE EU10      WKEU06  6
     C                     MOVE *BLANKS   EU10
     C                     MOVE '/'       EU0101
     C                     MOVELWKEU06    EU0207
     C***********          MOVELEU10      MGRSS1                          069757
     C                     MOVELEU10      MGDSS1                          069757
     C                     END
     C                     END
     C                     END
      *
     C           MGINSS    IFEQ 'PHYSI'
     C                     MOVELDPBN      MGRSSN
     C/COPY WNCPYSRC,SE1873C023
     C                     END
      *
     C                     END
      *
      ** DELIVERER OF SECURITIES, DELIVERER OF SEC. A/C LINE
     C           WWEXSS    IFEQ 'Y'
     C           D2DSSN    ANDNE*BLANKS
     C           WWEXSS    OREQ 'Y'
     C           D2DSS1    ANDNE*BLANKS
     C                     MOVELD2DSSA    MGDSSA
     C                     MOVELD2DSSN    MGDSSN
     C                     MOVELD2DSS1    MGDSS1
     C                     MOVELD2DSS2    MGDSS2
     C                     MOVELD2DSS3    MGDSS3
     C                     MOVELD2DSS4    MGDSS4
     C                     ELSE
      *
     C           DPEUCL    IFEQ *BLANKS
     C                     MOVELDPBN      MGDSSN
     C/COPY WNCPYSRC,SE1873C024
     C                     ELSE
     C                     MOVELDPEUCL    MGDSS1
     C                     END
      *
     C***********MGDEST    IFEQ WWEOCN                     Euroclear      CSW003
     C           CLADE     IFEQ 'E'                        Euroclear      CSW003
     C           DPINST    IFNE '03C'
     C           DPINST    ANDNE'07C'
     C           DPINST    ANDNE'BRI'                                     103746
     C                     MOVELDPEUCL    EU10
     C           EU0104    IFEQ '//XE'
     C           EU0104    OREQ '//XC'
     C                     MOVE EU10      WKEU06  6
     C                     MOVE *BLANKS   EU10
     C                     MOVE '/'       EU0101
     C                     MOVELWKEU06    EU0207
     C                     MOVELEU10      MGRSS1
     C                     END
     C                     END
     C                     END
      *
     C           MGINSS    IFEQ 'PHYSI'
     C                     MOVELDPBN      MGDSSN
     C/COPY WNCPYSRC,SE1873C025
     C                     END
      *
     C                     END
      *
      ** BENEFICIARY OF SECURITIES, BENEFICIARY OF SEC. A/C LINE
     C           WWEXSS    IFEQ 'Y'
     C           D2BSSN    ANDNE*BLANKS
     C           WWEXSS    OREQ 'Y'
     C           D2BSS1    ANDNE*BLANKS
     C                     MOVE D2BSSN    MGBSSN
     C                     MOVE D2BSS1    MGBSS1
     C                     MOVE D2BSS2    MGBSS2
     C                     END
      *
      ** BENEFICIARY OF MONEY, BENEFICIARY OF MONEY A/C LINE
     C           WWEXSS    IFEQ 'Y'
     C           D2BOFN    ANDNE*BLANKS
     C           WWEXSS    OREQ 'Y'
     C           D2BOF1    ANDNE*BLANKS
     C                     MOVE D2BOFN    MGBOFN
     C                     MOVE D2BOF1    MGBOF1
     C                     MOVE D2BOF2    MGBOF2
     C                     END
      *                                                                   093758
      ** If MGAWIL or MGAWIN formated and MGBOFN is blank                 093758
      ** --> initialise MGAWIx.                                           093758
     C           MGAWIL    IFNE *BLANKS                                   093758
     C           MGAWIN    ORNE *BLANKS                                   093758
     C           MGBOFN    IFEQ *BLANKS                                   093758
     C           MGBOF1    ANDEQ*BLANKS                                   093758
     C           MGBOF2    ANDEQ*BLANKS                                   093758
     C                     MOVE *BLANKS   MGAWIL                          093758
     C                     MOVE *BLANKS   MGAWIN                          093758
     C                     END                                            093758
     C                     END                                            093758
      *                                                                   093758
      ** If MGBOFx is formated and MGAWIx is blank                        093758
      ** --> initialise MGBOFx.                                           093758
     C           MGBOFN    IFNE *BLANKS                                   093758
     C           MGBOF1    ORNE *BLANKS                                   093758
     C           MGBOF2    ORNE *BLANKS                                   093758
     C           MGAWIL    IFEQ *BLANKS                                   093758
     C           MGAWIN    ANDEQ*BLANKS                                   093758
     C                     MOVE *BLANKS   MGBOFN                          093758
     C                     MOVE *BLANKS   MGBOF1                          093758
     C                     END                                            093758
     C                     END                                            093758
      *
      ** SET UP DATE OF TRADE AND DEAL AMOUNT
     C           DPMV      IFEQ 'RR'
     C           DPMV      OREQ 'RP'
     C           DPMV      OREQ 'PD'                                      103449
     C           DPMV      OREQ 'PL'                                      103449
     C                     MOVE DDAT      MGTDAT
     C           CSW003    IFNE 'Y'                                       125251
     C                     MOVE PCPL      MGDLAM
     C                     END                                            125251
     C                     END
     C/COPY WNCPYSRC,SE1873C019
      *
      ** SAFEKEEPING ACCOUNT A/C LINE
     C           WWEXSS    IFEQ 'Y'
     C           D2SKAL    ANDNE*BLANKS
     C                     MOVELD2SKAL    MGSKAL
     C                     ELSE
      *
      ** ACCESS LF/SDSECSJ3 USING KEY WORKFIELD WWBICN
     C                     MOVE WWBICN    WWBIC6  6
     C                     CALL 'AOSECSR0'
     C                     PARM *BLANKS   WRTCD   7
     C                     PARM '*KEY   ' WOPTN   7
     C                     PARM           WWBIC6  6
     C           SDSECS    PARM SDSECS    DSSDY
      *
     C           WRTCD     IFNE *BLANKS
     C                     MOVEL'026'     DBASE            **************
     C                     MOVEL'SDSECSPD'DBFILE           * DB ERROR 26*
     C                     MOVELWWBIC6    DBKEY            **************
     C                     EXSR *PSSR
     C                     END
      *
      ** WWDEST IS CEDEL
     C           WWDEST    IFEQ WWCEDN
     C********** CLADC     OREQL'C'RF2    MGSKAL                                        CSW003CSE022
     C                     MOVELBFNDR2    MGSKAL                                              CSE022
     C                     MOVELBFDRF2    MGSKAL
     C                     ELSE
      *
      ** WWDEST IS EUROCLEAR
     C**********           MOVELBFDRF1    MGSKAL                                              CSE022
     C                     MOVELBFNDR1    MGSKAL                                              CSE022
     C                     END
      *
     C           MGSKAL    IFEQ *BLANKS
     C                     MOVELWWBICN    MGSKAL
     C                     END
     C                     END
      *
      ** FURTHER INFORMATION
      ** REGISTRATIONS DETAILS
      ** NARRATIVE
     C           WWEXSS    IFEQ 'Y'
     C                     MOVE D2FIN1    MGFIN1
     C                     MOVE D2FIN2    MGFIN2
     C                     MOVE D2RED1    MGRED1
     C                     MOVE D2RED2    MGRED2
     C                     MOVE D2NAL1    MGNAL1
     C                     MOVE D2NAL2    MGNAL2
     C                     END
      *
      ** CLEARING CORRESPONDENT
     C           WWEXSS    IFEQ 'Y'
     C           D2CCTN    ANDNE*BLANKS
     C                     MOVELD2CCTN    MGCCTN
     C                     ELSE
      *
     C           WWDEST    IFEQ WWEOCN                     Internal EOC
     C           CLADE     OREQ 'E'
     C                     MOVELCSIDEO    MGCCTN
     C           DPID      IFEQ WWCEDN                     Bridge EOC
     C           DPOD      OREQ WWCEDN
     C           CLAIC     OREQ 'C'
     C           CLAOC     OREQ 'C'
     C                     MOVELCSIDCE    MGCCTN
     C                     END
     C                     END
      *
     C           WWDEST    IFEQ WWCEDN                     Internal Cedel
     C           CLADC     OREQ 'C'
     C                     MOVELCSIDCE    MGCCTN
     C           DPID      IFEQ WWEOCN                     Bridge Cedel
     C           DPOD      OREQ WWEOCN
     C           CLAIE     OREQ 'E'
     C           CLAOE     OREQ 'E'
     C                     MOVELCSIDEO    MGCCTN
     C                     END
     C                     END
      *
     C           DPINST    IFEQ '03K'                      AKV
     C           DPINST    OREQ '07K'
     C                     MOVELCSIDAK    MGCCTN
     C                     END
      *
     C                     END
      *
      ** DELIVERERS INSTRUCTING PARTY A/C LINE
     C           WWEXSS    IFEQ 'Y'
     C           D2DCTL    ANDNE*BLANKS
     C                     MOVELD2DCTL    MGDIPL
     C                     END
      *
      ** SWIFT SECURITY TYPE
     C           SWTP      IFEQ 'WTS'
     C                     MOVE SWTP      MGSWTP
     C                     ELSE
      *
      ** ACCESS INVESTMENT TYPE DETAILS - LF/INVTP WITH KEY NMCY, SITP
     C           KL3       CHAININVTP                68
     C           *IN68     IFEQ '1'
     C                     MOVEL'027'     DBASE            **************
     C                     MOVEL'INVTP'   DBFILE           * DB ERROR 27*
     C                     MOVELWWKEY3    DBKEY            **************
     C                     EXSR *PSSR
     C                     END
      *
     C           PROT      IFEQ '4'
     C           PROT      OREQ '7'
     C                     MOVE 'SHS'     MGSWTP
     C                     ELSE
     C                     MOVE 'FMT'     MGSWTP
     C                     END
      *
     C                     END
      *
      ** WRITE A RECORD TO PF/MGF580PD
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           STCY      ANDNE*BLANKS                                   CEU003
     C                     Z-ADD37        DBASE                           CEU003
     C                     EXSR SREURO                                    CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C*                                                                   CSE029
     C** If New ISO15022 is needed then donot output MT580                CSE029
     C*                                                                   CSE029
     C           DPNEW     IFNE 'Y'                                       CSE029
      *                                                                                       CSW202
      ** Bypass writing of record if SWIFT 2002 is installed                                  CSW202
      *                                                                                       CSW202
     C           CSW202    ANDNE'Y'                                                           CSW202
      *                                                                                       CSW202
     C                     MOVE @CHG      MGCHG                                               CSW025
     C                     MOVE @CHG      MGCHG                                               CSW025
     C                     WRITEMGF580D0               74
     C           *IN74     IFEQ '1'
     C                     MOVEL'028'     DBASE            **************
     C                     MOVEL'MGF580PD'DBFILE           * DB ERROR 28*
     C                     MOVE *BLANKS   DBKEY            **************
     C                     EXSR *PSSR
     C                     END
     C*                                                                   CSE029
     C                     ENDIF                                          CSE029
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/FMTISO                                                    CSE029
      *****************************************************************   CSE029
      *                                                               *   CSE029
      *    FMTISO    - FORMAT FIELDS SPECIFIC TO ISO15022             *   CSE029
      *                                                               *   CSE029
      *    CALLED BY - MSGST                                          *   CSE029
      *    CALLS     -                                                *   CSE029
      *                                                               *   CSE029
      *****************************************************************   CSE029
      *                                                                   CSE029
     C           FMTISO    BEGSR                                          CSE029
      *                                                                   CSE029
      ** Set up system prefix                                             200292
      ** Set up transaction reference.                                    CSE029
      *                                                                   CSE029
     C***********          MOVE 'SED'     MGPFIX                   CSE029 200292
     C                     MOVELSPREFX    MGPFIX                          200292
     C                     MOVE DPRN      MGTREF                          CSE029
      *                                                                   CSE029
      ** Set up SWIFT Sequence number                                     CSE029
      *                                                                   CSE029
     C           DPLSWS    ADD  1         MGTSEQ                          CSE029
      *                                                                   CSE029
      ** Set up Security processing Type                                  CSE029
      *                                                                   CSE029
     C                     MOVE PROT      MGPROT                          CSE029
      *                                                                   CSE029
      ** Setting up ISO15022 message Type                                 CSE029
      *                                                                   CSE029
     C           WTYP      IFEQ '580'                                     CSE029
     C                     MOVE MGF231    MGTYPE                          CSE029
     C                     ENDIF                                          CSE029
     C           WTYP      IFEQ '520'                                     CSE029
     C                     MOVE 'RECFREE' MGTYPE                          CSE029
     C                     ENDIF                                          CSE029
     C           WTYP      IFEQ '521'                                     CSE029
     C                     MOVE 'RECAPMT' MGTYPE                          CSE029
     C                     ENDIF                                          CSE029
     C           WTYP      IFEQ '522'                                     CSE029
     C                     MOVE 'DELFREE' MGTYPE                          CSE029
     C                     ENDIF                                          CSE029
     C           WTYP      IFEQ '522'                                     CSE029
     C                     MOVE 'DELAPMT' MGTYPE                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
      ** If last change type for the depot movement is not equal to 'D'   CSE029
      ** then treat all transaction as amend.                             CSE029
      *                                                                   CSE029
     C           CHTP      IFNE 'D'                                       CSE029
     C                     MOVE 'A'       MGTSTS                          CSE029
     C                     ELSE                                           CSE029
     C                     MOVE 'D'       MGTSTS                          CSE029
     C                     END                                            CSE029
      *                                                                   CSE029
      ** Determine classification of Counterparty                         CSE029
      *                                                                   CSE029
     C                     MOVELDPBN      WWCUST                          CSE029
      *                                                                   CSE029
     C                     CALL 'AOSECSR0'                                CSE029
     C                     PARM *BLANKS   WRTCD                           CSE029
     C                     PARM '*KEY   ' WOPTN                           CSE029
     C                     PARM           WWCUST                          CSE029
     C           SDSECS    PARM SDSECS    DSSDY                           CSE029
      *                                                                   CSE029
     C           WRTCD     IFEQ *BLANKS                                   CSE029
     C                     MOVE BFCLAS    MGCCLS                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
      ** Determine classification of From Depot                           CSE029
      *                                                                   CSE029
     C                     MOVELDPID      WWCUST                          CSE029
      *                                                                   CSE029
     C                     CALL 'AOSECSR0'                                CSE029
     C                     PARM *BLANKS   WRTCD                           CSE029
     C                     PARM '*KEY   ' WOPTN                           CSE029
     C                     PARM           WWCUST                          CSE029
     C           SDSECS    PARM SDSECS    DSSDY                           CSE029
      *                                                                   CSE029
     C           WRTCD     IFEQ *BLANKS                                   CSE029
     C                     MOVE BFCLAS    MGFCLS                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
      ** Determine classification of To Depot                             CSE029
      *                                                                   CSE029
     C*********            MOVELDPDO      WWCUST                   CSE029 200292
     C                     MOVELDPOD      WWCUST                          200292
      *                                                                   CSE029
     C                     CALL 'AOSECSR0'                                CSE029
     C                     PARM *BLANKS   WRTCD                           CSE029
     C                     PARM '*KEY   ' WOPTN                           CSE029
     C                     PARM           WWCUST                          CSE029
     C           SDSECS    PARM SDSECS    DSSDY                           CSE029
      *                                                                   CSE029
     C           WRTCD     IFEQ *BLANKS                                   CSE029
     C                     MOVE BFCLAS    MGTCLS                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
      ** Set up Intermediary for download if short name/customer          CSE029
      ** number is being used.                                            CSE029
      *                                                                   CSE029
     C                     MOVE *BLANKS   WCUST                                               205141
     C           D2IMD1    IFNE *BLANKS                                   CSE029
     C                     MOVELD2IMD1    WCUST                           CSE029
     C                     CALL 'AOCUSTR0'                                CSE029
     C                     PARM *BLANKS   WRTCD                           CSE029
     C                     PARM '*KEY   ' WOPTN                           CSE029
     C                     PARM           WCUST  10                       CSE029
     C                     PARM *BLANKS   WKYST   7                       CSE029
     C           SDCUST    PARM SDCUST    DSSDY                           CSE029
      *                                                                   CSE029
     C           WRTCD     IFEQ *BLANKS                                   CSE029
     C                     MOVE BBCUST    MGIMD1                          CSE029
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
     C                     MOVE *BLANKS   WCUST                                               205141
     C           D2IMD2    IFNE *BLANKS                                   CSE029
     C                     MOVELD2IMD2    WCUST                           CSE029
     C                     CALL 'AOCUSTR0'                                CSE029
     C                     PARM *BLANKS   WRTCD                           CSE029
     C                     PARM '*KEY   ' WOPTN                           CSE029
     C                     PARM           WCUST  10                       CSE029
     C                     PARM *BLANKS   WKYST   7                       CSE029
     C           SDCUST    PARM SDCUST    DSSDY                           CSE029
      *                                                                   CSE029
     C           WRTCD     IFEQ *BLANKS                                   CSE029
     C                     MOVE BBCUST    MGIMD2                          CSE029
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
     C                     MOVE *BLANKS   WCUST                                               205141
     C           D2IMD3    IFNE *BLANKS                                   CSE029
     C                     MOVELD2IMD3    WCUST                           CSE029
     C                     CALL 'AOCUSTR0'                                CSE029
     C                     PARM *BLANKS   WRTCD                           CSE029
     C                     PARM '*KEY   ' WOPTN                           CSE029
     C                     PARM           WCUST  10                       CSE029
     C                     PARM *BLANKS   WKYST   7                       CSE029
     C           SDCUST    PARM SDCUST    DSSDY                           CSE029
      *                                                                   CSE029
     C           WRTCD     IFEQ *BLANKS                                   CSE029
     C                     MOVE BBCUST    MGIMD3                          CSE029
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
     C                     MOVE *BLANKS   WCUST                                               205141
     C           D2IMD4    IFNE *BLANKS                                   CSE029
     C                     MOVELD2IMD4    WCUST                           CSE029
     C                     CALL 'AOCUSTR0'                                CSE029
     C                     PARM *BLANKS   WRTCD                           CSE029
     C                     PARM '*KEY   ' WOPTN                           CSE029
     C                     PARM           WCUST  10                       CSE029
     C                     PARM *BLANKS   WKYST   7                       CSE029
     C           SDCUST    PARM SDCUST    DSSDY                           CSE029
      *                                                                   CSE029
     C           WRTCD     IFEQ *BLANKS                                   CSE029
     C                     MOVE BBCUST    MGIMD4                          CSE029
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
     C                     MOVE *BLANKS   WCUST                                               205141
     C           D2IMD5    IFNE *BLANKS                                   CSE029
     C                     MOVELD2IMD5    WCUST                           CSE029
     C                     CALL 'AOCUSTR0'                                CSE029
     C                     PARM *BLANKS   WRTCD                           CSE029
     C                     PARM '*KEY   ' WOPTN                           CSE029
     C                     PARM           WCUST  10                       CSE029
     C                     PARM *BLANKS   WKYST   7                       CSE029
     C           SDCUST    PARM SDCUST    DSSDY                           CSE029
      *                                                                   CSE029
     C           WRTCD     IFEQ *BLANKS                                   CSE029
     C                     MOVE BBCUST    MGIMD5                          CSE029
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
     C                     MOVE *BLANKS   WCUST                                               205141
     C           D2IMD6    IFNE *BLANKS                                   CSE029
     C                     MOVELD2IMD6    WCUST                           CSE029
     C                     CALL 'AOCUSTR0'                                CSE029
     C                     PARM *BLANKS   WRTCD                           CSE029
     C                     PARM '*KEY   ' WOPTN                           CSE029
     C                     PARM           WCUST  10                       CSE029
     C                     PARM *BLANKS   WKYST   7                       CSE029
     C           SDCUST    PARM SDCUST    DSSDY                           CSE029
      *                                                                   CSE029
     C           WRTCD     IFEQ *BLANKS                                   CSE029
     C                     MOVE BBCUST    MGIMD6                          CSE029
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
     C                     MOVE *BLANKS   WCUST                                               205141
     C           D2IMD7    IFNE *BLANKS                                   CSE029
     C                     MOVELD2IMD7    WCUST                           CSE029
     C                     CALL 'AOCUSTR0'                                CSE029
     C                     PARM *BLANKS   WRTCD                           CSE029
     C                     PARM '*KEY   ' WOPTN                           CSE029
     C                     PARM           WCUST  10                       CSE029
     C                     PARM *BLANKS   WKYST   7                       CSE029
     C           SDCUST    PARM SDCUST    DSSDY                           CSE029
      *                                                                   CSE029
     C           WRTCD     IFEQ *BLANKS                                   CSE029
     C                     MOVE BBCUST    MGIMD7                          CSE029
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
     C                     MOVE *BLANKS   WCUST                                               205141
     C           D2IMD8    IFNE *BLANKS                                   CSE029
     C                     MOVELD2IMD8    WCUST                           CSE029
     C                     CALL 'AOCUSTR0'                                CSE029
     C                     PARM *BLANKS   WRTCD                           CSE029
     C                     PARM '*KEY   ' WOPTN                           CSE029
     C                     PARM           WCUST  10                       CSE029
     C                     PARM *BLANKS   WKYST   7                       CSE029
     C           SDCUST    PARM SDCUST    DSSDY                           CSE029
      *                                                                   CSE029
     C           WRTCD     IFEQ *BLANKS                                   CSE029
     C                     MOVE BBCUST    MGIMD8                          CSE029
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
     C                     MOVE *BLANKS   WCUST                                               205141
     C           D2IMD9    IFNE *BLANKS                                   CSE029
     C                     MOVELD2IMD9    WCUST                           CSE029
     C                     CALL 'AOCUSTR0'                                CSE029
     C                     PARM *BLANKS   WRTCD                           CSE029
     C                     PARM '*KEY   ' WOPTN                           CSE029
     C                     PARM           WCUST  10                       CSE029
     C                     PARM *BLANKS   WKYST   7                       CSE029
     C           SDCUST    PARM SDCUST    DSSDY                           CSE029
      *                                                                   CSE029
     C           WRTCD     IFEQ *BLANKS                                   CSE029
     C                     MOVE BBCUST    MGIMD9                          CSE029
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
     C                     MOVE *BLANKS   WCUST                                               205141
     C           D2PSET    IFNE *BLANKS                                   CSE029
     C                     MOVELD2PSET    WCUST                           CSE029
     C                     CALL 'AOCUSTR0'                                CSE029
     C                     PARM *BLANKS   WRTCD                           CSE029
     C                     PARM '*KEY   ' WOPTN                           CSE029
     C                     PARM           WCUST  10                       CSE029
     C                     PARM *BLANKS   WKYST   7                       CSE029
     C           SDCUST    PARM SDCUST    DSSDY                           CSE029
      *                                                                   CSE029
     C           WRTCD     IFEQ *BLANKS                                   CSE029
     C                     MOVE BBCUST    MGPSET                          CSE029
     C                     MOVE BBCSID    MGPSBI                          200292
     C                     MOVE BBCNA1    MGPSL1                          200292
     C                     MOVE BBCNA2    MGPSL2                          200292
     C                     MOVE BBCNA3    MGPSL3                          200292
     C                     MOVE BBCNA4    MGPSL4                          200292
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      **************************************************************CSE029200292
      ***Set*interest*ccy*to*nominal*ccy*if*not*being*set*up*alreadyCSE029200292
      **************************************************************CSE029200292
     C***********MGITCY    IFEQ *BLANKS                             CSE029200292
     C***********          MOVE NMCY      MGITCY                    CSE029200292
     C***********          ENDIF                                    CSE029200292
      *                                                                   200292
      ** Save SWIFT currency Code for nominal currency.                   200292
     C                     CALL 'AOCURRR0'                                200292
     C                     PARM '*MSG   ' WRTCD                           200292
     C                     PARM '*KEY   ' WOPTN                           200292
     C                     PARM NMCY      @AJCD   3                       200292
     C           SDCURR    PARM SDCURR    DSSDY                           200292
     C           WRTCD     IFNE *BLANKS                                   200292
     C                     MOVEL'043'     DBASE            ************** 200292
     C                     MOVEL'SDCURRPD'DBFILE           * DB ERROR 43* 200292
     C                     MOVELNMCY      DBKEY            ************** 200292
     C                     EXSR *PSSR                                     200292
E2   C                     END                                            200292
     C                     MOVE A6SWCY    MGOTRC                          200292
     C                     Z-ADDA6NBDP    MGOTDP                          200292
      *                                                                   200292
      ** Set interest ccy to nominal ccy if not being set up already      200292
      *                                                                   200292
     C           MGITCY    IFEQ *BLANKS                                   200292
     C                     MOVE MGOTRC    MGITCY                          200292
     C                     Z-ADDMGOTDP    MGITDP                          200292
     C                     ELSE                                           200292
      *                                                                   200292
      ** Save SWIFT currency Code for nominal currency.                   200292
     C                     CALL 'AOCURRR0'                                200292
     C                     PARM '*MSG   ' WRTCD                           200292
     C                     PARM '*KEY   ' WOPTN                           200292
     C                     PARM MGITCY    @AJCD   3                       200292
     C           SDCURR    PARM SDCURR    DSSDY                           200292
     C           WRTCD     IFNE *BLANKS                                   200292
     C                     MOVEL'044'     DBASE            ************** 200292
     C                     MOVEL'SDCURRPD'DBFILE           * DB ERROR 44* 200292
     C                     MOVELNMCY      DBKEY            ************** 200292
     C                     EXSR *PSSR                                     200292
E2   C                     END                                            200292
     C                     MOVE A6SWCY    MGITCY                          200292
     C                     Z-ADDA6NBDP    MGITDP                          200292
     C                     ENDIF                                          200292
      *                                                                   200292
      ** Save SWIFT currency Code for settlement currency                 200292
     C           MGSTCY    IFNE *BLANK                                    200292
     C                     CALL 'AOCURRR0'                                200292
     C                     PARM '*MSG   ' WRTCD                           200292
     C                     PARM '*KEY   ' WOPTN                           200292
     C                     PARM MGSTCY    @AJCD   3                       200292
     C           SDCURR    PARM SDCURR    DSSDY                           200292
     C           WRTCD     IFNE *BLANKS                                   200292
     C                     MOVEL'045'     DBASE            ************** 200292
     C                     MOVEL'SDCURRPD'DBFILE           * DB ERROR 45* 200292
     C                     MOVELMGSTCY    DBKEY            ************** 200292
     C                     EXSR *PSSR                                     200292
     C                     END                                            200292
     C                     MOVE A6SWCY    MGSTCY                          200292
     C                     Z-ADDA6NBDP    MGSTDP                          200292
     C                     END                                            200292
      *                                                                   CSE029
      ** Set Up charges SWIFT Code                                        CSE029
      *                                                                   CSE029
     C                     MOVE NMCY      @CCY                            CSE029
      *                                                                   CSE029
     C           DCHC      IFNE *BLANKS                                   CSE029
     C                     MOVE DCHC      @CCOM                           CSE029
      *                                                                   CSE029
     C                     CALL 'AOCHGTR0'                                CSE029
     C                     PARM *BLANKS   @RTCD   7                       CSE029
     C                     PARM '*KEY'    @OPTN   7                       CSE029
     C                     PARM           @CCY    3                       CSE029
     C                     PARM           @CCOM   2                       CSE029
     C***********SECGT     PARM SECGT     DSFDY                    CSE029 200292
     C           SECGT     PARM SECGT     DSSDY                           200292
      *                                                                   CSE029
     C***********@RTCD     IFNE *BLANK                             CSE029 200292
     C           @RTCD     IFEQ *BLANK                                    200292
     C                     MOVE SWID      MGCHG1                          CSE029
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   CSE029
      ** Set up currency dec. point                                       CSE029
      *                                                                   CSE029
     C                     Z-ADDDPNMCY    MGITDP                          CSE029
     C           MGSTCY    IFEQ *BLANK                                    CSE029
     C                     MOVE MGOTRC    MGSTCY                          CSE029
     C                     ELSE                                           CSE029
     C           MGSTCY    IFNE NMCY                                      CSE029
     C                     CALL 'AOCURRR0'                                CSE029
     C                     PARM '*MSG   ' WRTCD                           CSE029
     C                     PARM '*KEY   ' WOPTN                           CSE029
     C                     PARM MGSTCY    @AJCD   3                       CSE029
     C           SDCURR    PARM SDCURR    DSSDY                           CSE029
     C           WRTCD     IFEQ *BLANKS                                   CSE029
     C                     Z-ADDA6NBDP    MGSTDP                          CSE029
      *                                                                   200292
      ** Save SWIFT currency Code for settlement currency.                200292
     C                     MOVE A6SWCY    MGSTCY                          200292
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   200292
      ** Setup Sender SWIFT ID for ISO15022 message                       200292
     C                     MOVE *BLANKS   WCUST                                               205141
     C                     MOVELWWBICN    WCUST                           200292
     C                     CALL 'AOCUSTR0'                                200292
     C                     PARM *BLANKS   WRTCD                           200292
     C                     PARM '*KEY   ' WOPTN                           200292
     C                     PARM           WCUST  10                       200292
     C                     PARM *BLANKS   WKYST   7                       200292
     C           SDCUST    PARM SDCUST    DSSDY                           200292
      *                                                                   200292
     C           WRTCD     IFEQ *BLANKS                                   200292
     C                     MOVE BBCSID    MGSNDI                          200292
     C                     ENDIF                                          200292
      *                                                                   200292
      ** A/C with Institution Detail                                      200292
     C                     MOVE *BLANKS   WCUST                                               205141
     C           D2AWIN    IFNE *BLANKS                                   200292
     C                     MOVELD2AWIN    WCUST                           200292
     C                     CALL 'AOCUSTR0'                                200292
     C                     PARM *BLANKS   WRTCD                           200292
     C                     PARM '*KEY   ' WOPTN                           200292
     C                     PARM           WCUST  10                       200292
     C                     PARM *BLANKS   WKYST   7                       200292
     C           SDCUST    PARM SDCUST    DSSDY                           200292
      *                                                                   200292
     C           WRTCD     IFEQ *BLANKS                                   200292
     C                     MOVE BBCSID    MGAWBI                          200292
     C                     MOVE BBCNA1    MGAWL1                          200292
     C                     MOVE BBCNA2    MGAWL2                          200292
     C                     MOVE BBCNA3    MGAWL3                          200292
     C                     MOVE BBCNA4    MGAWL4                          200292
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                                     AR589164
      ** A/C with Institution account line                                                  AR589164
     C           D2AWIL    IFNE *BLANKS                                                     AR589164
     C                     MOVELD2AWIL    WDRAB                                             AR589164
     C           WP0102    IFEQ '//'                                                        AR589164
     C                     CALL 'AOCCSYR0'                                                  AR589164
     C                     PARM *BLANKS   WRTCD                                             AR589164
     C                     PARM '*KEY   ' WOPTN                                             AR589164
     C                     PARM NMCY      CYCD    3                                         AR589164
     C                     PARM WP0304    CLSY    2                                         AR589164
     C           SDCCSY    PARM SDCCSY    DSFDY                                             AR589164
      *                                                                                     AR589164
     C           WRTCD     IFNE *BLANKS                                                     AR589164
     C                     Z-ADD030       DBASE                                             AR589164
     C                     MOVEL'SDCCSYPD'DBFILE                                            AR589164
     C                     MOVELWP0304    DBKEY                                             AR589164
     C                     EXSR *PSSR                                                       AR589164
     C                     ENDIF                                                            AR589164
      *                                                                                     AR589164
     C           DPISCD    IFNE *BLANKS                                                     AR589164
      *                                                                                     AR589164
      ** Format Account with Institution account line                                       AR589164
      *                                                                                     AR589164
     C                     MOVE *BLANKS   LGDSS  10                                         AR589164
      *                                                                                     AR589164
     C           NMCY      IFEQ 'EUR'                                                       AR589164
     C           DPISCD    IFEQ 'LATI'                                                      AR589164
     C                     MOVEL'IBRCLATI'LGDSS                                             AR589164
     C                     ENDIF                                                            AR589164
     C                     ENDIF                                                            AR589164
      *                                                                                     AR589164
     C           NMCY      IFEQ 'USD'                                                       AR589164
     C                     SELEC                                                            AR589164
     C           DPISCD    WHEQ 'USCH'                                                      AR589164
     C                     MOVEL'NYCHUSCH'LGDSS                                             AR589164
     C           DPISCD    WHEQ 'USCP'                                                      AR589164
     C                     MOVEL'NYCHUSCP'LGDSS                                             AR589164
     C           DPISCD    WHEQ 'FINS'                                                      AR589164
     C                     MOVEL'DTCYFINS'LGDSS                                             AR589164
     C           DPISCD    WHEQ 'PART'                                                      AR589164
     C                     MOVEL'DTCYPART'LGDSS                                             AR589164
     C           DPISCD    WHEQ 'USER'                                                      AR589164
     C                     MOVEL'DTCYUSER'LGDSS                                             AR589164
     C           DPISCD    WHEQ 'ID  '                                                      AR589164
     C                     MOVEL'DTCYID'  LGDSS                                             AR589164
     C                     ENDSL                                                            AR589164
     C                     ENDIF                                                            AR589164
     C                     MOVE *BLANKS   MGAWL1                                            AR589164
     C                     MOVE *BLANKS   MGAWL2                                            AR589164
     C                     MOVE *BLANKS   MGAWL3                                            AR589164
     C                     MOVE *BLANKS   MGAWL4                                            AR589164
     C********** '/'       CAT  DPISCD:0  MGAWL1                                  AR589164 AR589164A
     C********** MGAWL1    CAT  '/':0     MGAWL1                                  AR589164 AR589164A
     C********** LGDSS     IFEQ *BLANKS                                           AR589164 AR589164A
     C********** MGAWL1    CAT  WP0535:0  MGAWL1                                  AR589164 AR589164A
     C**********           ELSE                                                   AR589164 AR589164A
     C********** MGAWL1    CAT  LGDSS:0   MGAWL1                                  AR589164 AR589164A
     C**********           ENDIF                                                  AR589164 AR589164A
     C           LGDSS     IFEQ *BLANKS                                                    AR589164A
     C           '/'       CAT  DPISCD:0  MGAWL1                                           AR589164A
     C                     ELSE                                                            AR589164A
     C           '/'       CAT  LGDSS:0   MGAWL1                                           AR589164A
     C                     ENDIF                                                           AR589164A
     C           MGAWL1    CAT  '/':0     MGAWL1                                           AR589164A
     C           MGAWL1    CAT  WP0535:0  MGAWL1                                           AR589164A
      *                                                                                     AR589164
     C                     ENDIF                                                            AR589164
     C                     ENDIF                                                            AR589164
     C                     ENDIF                                                            AR589164
      *                                                                   200292
      ** Custodian Detail                                                 200292
     C                     MOVE *BLANKS   WCUST                                               205141
     C           D2SKAN    IFNE *BLANKS                                   200292
     C                     MOVELD2SKAN    WCUST                           200292
     C                     CALL 'AOCUSTR0'                                200292
     C                     PARM *BLANKS   WRTCD                           200292
     C                     PARM '*KEY   ' WOPTN                           200292
     C                     PARM           WCUST  10                       200292
     C                     PARM *BLANKS   WKYST   7                       200292
     C           SDCUST    PARM SDCUST    DSSDY                           200292
      *                                                                   200292
     C           WRTCD     IFEQ *BLANKS                                   200292
     C                     MOVE BBCSID    MGCDBI                          200292
     C                     MOVE BBCNA1    MGCDL1                          200292
     C                     MOVE BBCNA2    MGCDL2                          200292
     C                     MOVE BBCNA3    MGCDL3                          200292
     C                     MOVE BBCNA4    MGCDL4                          200292
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   200292
      ** Deliverer Detail                                                 200292
     C                     MOVE *BLANKS   WCUST                                               205141
     C           D2DSSN    IFNE *BLANKS                                   200292
     C                     MOVELD2DSSN    WCUST                           200292
     C                     CALL 'AOCUSTR0'                                200292
     C                     PARM *BLANKS   WRTCD                           200292
     C                     PARM '*KEY   ' WOPTN                           200292
     C                     PARM           WCUST  10                       200292
     C                     PARM *BLANKS   WKYST   7                       200292
     C           SDCUST    PARM SDCUST    DSSDY                           200292
      *                                                                   200292
     C           WRTCD     IFEQ *BLANKS                                   200292
     C                     MOVE BBCSID    MGDLBI                          200292
     C                     MOVE BBCNA1    MGDLL1                          200292
     C                     MOVE BBCNA2    MGDLL2                          200292
     C                     MOVE BBCNA3    MGDLL3                          200292
     C                     MOVE BBCNA4    MGDLL4                          200292
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   200292
      ** Receiver Detail                                                  200292
     C                     MOVE *BLANKS   WCUST                                               205141
     C           D2RSSN    IFNE *BLANKS                                   200292
     C                     MOVELD2RSSN    WCUST                           200292
     C                     CALL 'AOCUSTR0'                                200292
     C                     PARM *BLANKS   WRTCD                           200292
     C                     PARM '*KEY   ' WOPTN                           200292
     C                     PARM           WCUST  10                       200292
     C                     PARM *BLANKS   WKYST   7                       200292
     C           SDCUST    PARM SDCUST    DSSDY                           200292
      *                                                                   200292
     C           WRTCD     IFEQ *BLANKS                                   200292
     C                     MOVE BBCSID    MGRRBI                          200292
     C                     MOVE BBCNA1    MGRRL1                          200292
     C                     MOVE BBCNA2    MGRRL2                          200292
     C                     MOVE BBCNA3    MGRRL3                          200292
     C                     MOVE BBCNA4    MGRRL4                          200292
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   200292
      ** Beneficiary of security detail                                   200292
     C                     MOVE *BLANKS   WCUST                                               205141
     C           D2BSSN    IFNE *BLANKS                                   200292
     C                     MOVELD2BSSN    WCUST                           200292
     C                     CALL 'AOCUSTR0'                                200292
     C                     PARM *BLANKS   WRTCD                           200292
     C                     PARM '*KEY   ' WOPTN                           200292
     C                     PARM           WCUST  10                       200292
     C                     PARM *BLANKS   WKYST   7                       200292
     C           SDCUST    PARM SDCUST    DSSDY                           200292
      *                                                                   200292
     C           WRTCD     IFEQ *BLANKS                                   200292
     C                     MOVE BBCSID    MGBSBI                          200292
     C                     MOVE BBCNA1    MGBSL1                          200292
     C                     MOVE BBCNA2    MGBSL2                          200292
     C                     MOVE BBCNA3    MGBSL3                          200292
     C                     MOVE BBCNA4    MGBSL4                          200292
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   200292
      ** Beneficiary of money detail                                      200292
     C                     MOVE *BLANKS   WCUST                                               205141
     C           D2BOFN    IFNE *BLANKS                                   200292
     C                     MOVELD2BOFN    WCUST                           200292
     C                     CALL 'AOCUSTR0'                                200292
     C                     PARM *BLANKS   WRTCD                           200292
     C                     PARM '*KEY   ' WOPTN                           200292
     C                     PARM           WCUST  10                       200292
     C                     PARM *BLANKS   WKYST   7                       200292
     C           SDCUST    PARM SDCUST    DSSDY                           200292
      *                                                                   200292
     C           WRTCD     IFEQ *BLANKS                                   200292
     C                     MOVE BBCSID    MGBMBI                          200292
     C                     MOVE BBCNA1    MGBML1                          200292
     C                     MOVE BBCNA2    MGBML2                          200292
     C                     MOVE BBCNA3    MGBML3                          200292
     C                     MOVE BBCNA4    MGBML4                          200292
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                                     AR589164
      ** Beneficiary of money account line                                                  AR589164
     C           D2BOF1    IFNE *BLANKS                                                     AR589164
     C                     MOVELD2BOF1    WDRAB                                             AR589164
     C           WP0102    IFEQ '//'                                                        AR589164
     C                     CALL 'AOCCSYR0'                                                  AR589164
     C                     PARM *BLANKS   WRTCD                                             AR589164
     C                     PARM '*KEY   ' WOPTN                                             AR589164
     C                     PARM NMCY      CYCD    3                                         AR589164
     C                     PARM WP0304    CLSY    2                                         AR589164
     C           SDCCSY    PARM SDCCSY    DSFDY                                             AR589164
      *                                                                                     AR589164
     C           WRTCD     IFNE *BLANKS                                                     AR589164
     C                     Z-ADD031       DBASE                                             AR589164
     C                     MOVEL'SDCCSYPD'DBFILE                                            AR589164
     C                     MOVELWP0304    DBKEY                                             AR589164
     C                     EXSR *PSSR                                                       AR589164
     C                     ENDIF                                                            AR589164
      *                                                                                     AR589164
     C           DPISCD    IFNE *BLANKS                                                     AR589164
      *                                                                                     AR589164
      ** Format Account with Institution account line                                       AR589164
      *                                                                                     AR589164
     C                     MOVE *BLANKS   LGDSS  10                                         AR589164
      *                                                                                     AR589164
     C           NMCY      IFEQ 'EUR'                                                       AR589164
     C           DPISCD    IFEQ 'LATI'                                                      AR589164
     C                     MOVEL'IBRCLATI'LGDSS                                             AR589164
     C                     ENDIF                                                            AR589164
     C                     ENDIF                                                            AR589164
      *                                                                                     AR589164
     C           NMCY      IFEQ 'USD'                                                       AR589164
     C                     SELEC                                                            AR589164
     C           DPISCD    WHEQ 'USCH'                                                      AR589164
     C                     MOVEL'NYCHUSCH'LGDSS                                             AR589164
     C           DPISCD    WHEQ 'USCP'                                                      AR589164
     C                     MOVEL'NYCHUSCP'LGDSS                                             AR589164
     C           DPISCD    WHEQ 'FINS'                                                      AR589164
     C                     MOVEL'DTCYFINS'LGDSS                                             AR589164
     C           DPISCD    WHEQ 'PART'                                                      AR589164
     C                     MOVEL'DTCYPART'LGDSS                                             AR589164
     C           DPISCD    WHEQ 'USER'                                                      AR589164
     C                     MOVEL'DTCYUSER'LGDSS                                             AR589164
     C           DPISCD    WHEQ 'ID  '                                                      AR589164
     C                     MOVEL'DTCYID'  LGDSS                                             AR589164
     C                     ENDSL                                                            AR589164
     C                     ENDIF                                                            AR589164
     C                     MOVE *BLANKS   MGBML1                                            AR589164
     C                     MOVE *BLANKS   MGBML2                                            AR589164
     C                     MOVE *BLANKS   MGBML3                                            AR589164
     C                     MOVE *BLANKS   MGBML4                                            AR589164
     C********** '/'       CAT  DPISCD:0  MGBML1                                  AR589164 AR589164A
     C********** MGBML1    CAT  '/':0     MGBML1                                  AR589164 AR589164A
     C********** LGDSS     IFEQ *BLANKS                                           AR589164 AR589164A
     C********** MGBML1    CAT  WP0535:0  MGBML1                                  AR589164 AR589164A
     C**********           ELSE                                                   AR589164 AR589164A
     C********** MGBML1    CAT  LGDSS:0   MGBML1                                  AR589164 AR589164A
     C**********           ENDIF                                                  AR589164 AR589164A
     C           LGDSS     IFEQ *BLANKS                                                    AR589164A
     C           '/'       CAT  DPISCD:0  MGBML1                                           AR589164A
     C                     ELSE                                                            AR589164A
     C           '/'       CAT  LGDSS:0   MGBML1                                           AR589164A
     C                     ENDIF                                                           AR589164A
     C           MGBML1    CAT  '/':0     MGBML1                                           AR589164A
     C           MGBML1    CAT  WP0535:0  MGBML1                                           AR589164A
      *                                                                                     AR589164
     C                     ENDIF                                                            AR589164
     C                     ENDIF                                                            AR589164
     C                     ENDIF                                                            AR589164
      *                                                                   200292
      ** Instructing Party detail                                         200292
     C                     MOVE *BLANKS   WCUST                                               205141
     C           D2IPYN    IFNE *BLANKS                                   200292
     C                     MOVELD2IPYN    WCUST                           200292
     C                     CALL 'AOCUSTR0'                                200292
     C                     PARM *BLANKS   WRTCD                           200292
     C                     PARM '*KEY   ' WOPTN                           200292
     C                     PARM           WCUST  10                       200292
     C                     PARM *BLANKS   WKYST   7                       200292
     C           SDCUST    PARM SDCUST    DSSDY                           200292
      *                                                                   200292
     C           WRTCD     IFEQ *BLANKS                                   200292
     C                     MOVE BBCSID    MGIPBI                          200292
     C                     MOVE BBCNA1    MGIPL1                          200292
     C                     MOVE BBCNA2    MGIPL2                          200292
     C                     MOVE BBCNA3    MGIPL3                          200292
     C                     MOVE BBCNA4    MGIPL4                          200292
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      *                                                                   200292
      ** Set up link field for extension file                             200292
      *                                                                   200292
     C                     MOVE DPWHEN    MGWHEN                          200292
     C                     MOVE DPSS      MGDPSS                          200292
      *                                                                   200292
      ** Deliverer Instructing Party detail                               200292
     C                     MOVE *BLANKS   WCUST                                               205141
     C           D2DCTL    IFNE *BLANKS                                   200292
     C                     MOVELD2DCTL    WCUST                           200292
     C                     CALL 'AOCUSTR0'                                200292
     C                     PARM *BLANKS   WRTCD                           200292
     C                     PARM '*KEY   ' WOPTN                           200292
     C                     PARM           WCUST  10                       200292
     C                     PARM *BLANKS   WKYST   7                       200292
     C           SDCUST    PARM SDCUST    DSSDY                           200292
      *                                                                   200292
     C           WRTCD     IFEQ *BLANKS                                   200292
     C                     MOVE BBCSID    MGDIPI                          200292
     C                     MOVE BBCNA1    MGDIP1                          200292
     C                     MOVE BBCNA2    MGDIP2                          200292
     C                     MOVE BBCNA3    MGDIP3                          200292
     C                     MOVE BBCNA4    MGDIP4                          200292
     C                     ENDIF                                          CSE029
     C                     ENDIF                                          CSE029
      ** Set up Market Centre                                                                 212599
      *                                                                                       212599
     C           MRKT      IFNE *BLANKS                                                       212599
     C           MRKT      CHAINSEMKC                66                                       212599
     C           *IN66     IFEQ '1'                                                           212599
     C                     MOVEL'019'     DBASE            **************                     212599
     C                     MOVEL'SEMKC'   DBFILE           * DB ERROR 46*                     212599
     C                     MOVELMRKT      DBKEY            **************                     212599
     C                     EXSR *PSSR                                                         212599
     C                     END                                                                212599
     C                     MOVE SWMKTC    MGSMKC                                              212599
     C                     END                                                                212599
      *                                                                                       212599
      ** check if valid UTC is valid for output                                               CSW207
      *                                                                                       CSW207
     C           CSW207    IFEQ 'Y'                                                           CSW207
     C           CSW208    OREQ 'Y'                                                           CSW208
     C           CSE029    ANDEQ'Y'                                                           CSW208
     C                     EXSR MFID                                                          CSW207
     C           WMFID     IFEQ 'Y'                                                           CSW207
      *                                                                                       CSW207
      ** format UTC                                                                           CSW207
      *                                                                                       CSW207
     C           A8TMOF    IFNE *ZERO                                                         CSW207
     C                     MOVE A8TMOF    WTMOF   4                                           CSW207
     C           A8SIGN    IFEQ '-'                                                           CSW207
     C           'N'       CAT  WTMOF     WUTC    5                                           CSW207
     C                     ENDIF                                                              CSW207
     C           A8SIGN    IFEQ '+'                                                           CSW207
     C                     MOVELWTMOF     WUTC                                                CSW207
     C                     ENDIF                                                              CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
     C                     MOVE WUTC      MGMFID                                              CSW207
      *                                                                                       CSW207
      ** format for TRCA and INCA                                                             CSW207
      *                                                                                       CSW207
     C           BFCLAS    IFEQ 'M'                                                           CSW207
     C                     MOVE CSCPCI    MGTRCA                                              CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
     C           BFCLAS    IFEQ 'S'                                                           CSW207
     C           BFCLAS    OREQ 'D'                                                           CSW207
     C                     MOVE CSCICI    MGINCA                                              CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
      ** If SWIFT 2008 is installed                                                           CSW208
      *                                                                                       CSW208
     C           CSW208    IFEQ 'Y'                                                           CSW208
     C           CSE029    ANDEQ'Y'                                                           CSW208
     C                     Z-ADD*ZERO     PFRTM                                               CSW208
      *                                                                                       CSW208
     C           DPTRTT    IFEQ *BLANKS                                                       CSW208
     C                     Z-ADDDDAT      MGMKDT                                              CSW208
     C                     MOVE *ZEROS    MGMKTM                                              CSW208
     C                     MOVE *BLANKS   MGMKTO                                              CSW208
     C                     Z-ADDDDAT      MGLCDT                                              CSW208
     C                     MOVE *ZEROS    MGLCTM                                              CSW208
     C                     MOVE *BLANKS   MGLCTO                                              CSW208
     C                     ELSE                                                               CSW208
     C                     MOVELDPTRTT    PFRTM                                               CSW208
     C                     CALL 'ZADTMCVT'                                                    CSW208
     C                     PARM *BLANKS   PRTCD   7                                           CSW208
     C                     PARM 'S'       PFRTZ   1                                           CSW208
     C                     PARM           PFRTM                                               CSW208
     C                     PARM DDAT      FRDT    50                                          CSW208
     C                     PARM 'SE'      PMODL   2                                           CSW208
     C                     PARM DPBA      PBRCA   3                                           CSW208
     C                     PARM MRKT      PMRKT   2                                           CSW208
     C                     PARM *BLANKS   PSESN  10                                           CSW208
     C                     PARM *BLANKS   PMICC   4                                           CSW208
     C                     PARM *ZEROS    PMKTM                                               CSW208
     C                     PARM *ZEROS    PMKDT   50                                          CSW208
     C                     PARM *ZEROS    PMKTOF                                              CSW208
     C                     PARM *BLANKS   PMKTOS  1                                           CSW208
     C                     PARM *ZEROS    PLCTM                                               CSW208
     C                     PARM *ZEROS    PLCDT   50                                          CSW208
     C                     PARM *ZEROS    PLCTOF                                              CSW208
     C                     PARM *BLANKS   PLCTOS  1                                           CSW208
     C                     PARM *ZEROS    PSYTM                                               CSW208
     C                     PARM *ZEROS    PSYDT   50                                          CSW208
     C                     PARM *ZEROS    PSYTOF                                              CSW208
     C                     PARM *BLANKS   PSYTOS  1                                           CSW208
      *                                                                                       CSW208
     C           PRTCD     IFEQ *BLANKS                                                       CSW208
     C                     Z-ADDPMKDT     MGMKDT                                              CSW208
     C                     Z-ADDPMKTM     MGMKTM                                              CSW208
     C                     Z-ADDPLCDT     MGLCDT                                              CSW208
     C                     MOVE PLCTM     MGLCTM                                              CSW208
     C                     MOVE *BLANKS   MGMKTO                                              CSW208
     C                     MOVE *BLANKS   MGLCTO                                              CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
      ** If Branch and Receiving Customer are MFID-compliant                                  CSW208
      *                                                                                       CSW208
     C           WMFID     IFEQ 'Y'                                                           CSW208
      *                                                                                       CSW208
      ** Set Offset at Market                                                                 CSW208
      *                                                                                       CSW208
     C                     MOVE PMKTOF    #WKTOF  4                                           CSW208
     C           PMKTOS    IFEQ '-'                                                           CSW208
     C           'N'       CAT  #WKTOF    MGMKTO                                              CSW208
     C                     ELSE                                                               CSW208
     C                     MOVEL#WKTOF    MGMKTO                                              CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
      ** Set Offset at Local                                                                  CSW208
      *                                                                                       CSW208
     C                     MOVE PLCTOF    #WCTOF  4                                           CSW208
     C           PLCTOS    IFEQ '-'                                                           CSW208
     C           'N'       CAT  #WCTOF    MGLCTO                                              CSW208
     C                     ELSE                                                               CSW208
     C                     MOVEL#WCTOF    MGLCTO                                              CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C                     ENDIF                                                              CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW210
     C           CSW210    IFEQ 'Y'                                                           CSW210
      *                                                                                       CSW210
      ** Debtor ID entered                                                                    CSW210
      *                                                                                       CSW210
     C           D2DIDN    IFNE *BLANKS                                                       CSW210
     C                     CALL 'AOCUSTR1'                                                    CSW210
     C                     PARM *BLANKS   WRTCD                                               CSW210
     C                     PARM '*KEY   ' WOPTN                                               CSW210
     C                     PARM D2DIDN    WCUST                                               CSW210
     C                     PARM *BLANKS   WKYST                                               CSW210
     C           SDCUST    PARM SDCUST    DSLDY                                               CSW210
      *                                                                                       CSW210
      ** Debtor ID is Customer                                                                CSW210
      *                                                                                       CSW210
     C           WRTCD     IFEQ *BLANKS                                                       CSW210
     C                     MOVELBBCSID    MGDIBI                                              CSW210
     C                     MOVELBBCNA1    MGDAL1                                              CSW210
     C                     MOVELBBCNA2    MGDAL2                                              CSW210
     C                     MOVELBBCNA3    MGDAL3                                              CSW210
     C                     MOVELBBCNA4    MGDAL4                                              CSW210
     C                     ELSE                                                               CSW210
      *                                                                                       CSW210
     C                     CALL 'AOCNSTR0'                                                    CSW210
     C                     PARM *BLANKS   WRTCD                                               CSW210
     C                     PARM '*KEY   ' WOPTN                                               CSW210
     C                     PARM D2DIDN    WCNST   8                                           CSW210
     C           SDCNST    PARM SDCNST    DSFDY                                               CSW210
      *                                                                                       CSW210
      ** Debtor ID is Counterparty Nostro                                                     CSW210
      *                                                                                       CSW210
     C           WRTCD     IFEQ *BLANKS                                                       CSW210
     C                     MOVELAWSWID    MGDIBI                                              CSW210
     C                     MOVELAWCPNM    MGDAL1                                              CSW210
     C                     MOVELAWCNTN    MGDAL2                                              CSW210
     C                     MOVEL*BLANKS   MGDAL3                                              CSW210
     C                     MOVEL*BLANKS   MGDAL4                                              CSW210
     C                     ENDIF                                                              CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSW210
      ** Debtor Address entered                                                               CSW210
      *                                                                                       CSW210
     C                     ELSE                                                               CSW210
     C           D2DAD1    IFNE *BLANKS                                                       CSW210
     C           D2DAD2    ANDEQ*BLANKS                                                       CSW210
     C           D2DAD3    ANDEQ*BLANKS                                                       CSW210
     C           D2DAD4    ANDEQ*BLANKS                                                       CSW210
     C                     EXSR SRSWFT                                                        CSW210
      *                                                                                       CSW210
      ** SWIFT Address                                                                        CSW210
      *                                                                                       CSW210
     C           ##CSID    IFEQ 'Y'                                                           CSW210
     C                     MOVELD2DAD1    MGDIBI                                              CSW210
     C                     MOVEL*BLANKS   MGDAL1                                              CSW210
     C                     MOVEL*BLANKS   MGDAL2                                              CSW210
     C                     MOVEL*BLANKS   MGDAL3                                              CSW210
     C                     MOVEL*BLANKS   MGDAL4                                              CSW210
     C                     ELSE                                                               CSW210
      *                                                                                       CSW210
      ** Standard Address                                                                     CSW210
      *                                                                                       CSW210
     C                     MOVEL*BLANKS   MGDIBI                                              CSW210
     C                     MOVELD2DAD1    MGDAL1                                              CSW210
     C                     MOVEL*BLANKS   MGDAL2                                              CSW210
     C                     MOVEL*BLANKS   MGDAL3                                              CSW210
     C                     MOVEL*BLANKS   MGDAL4                                              CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSW210
     C                     ELSE                                                               CSW210
      *                                                                                       CSW210
      ** Standard Address                                                                     CSW210
      *                                                                                       CSW210
     C                     MOVEL*BLANKS   MGDIBI                                              CSW210
     C                     MOVELD2DAD1    MGDAL1                                              CSW210
     C                     MOVELD2DAD2    MGDAL2                                              CSW210
     C                     MOVELD2DAD3    MGDAL3                                              CSW210
     C                     MOVELD2DAD4    MGDAL4                                              CSW210
     C                     ENDIF                                                              CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSW210
      ** QFIN entered                                                                         CSW210
      *                                                                                       CSW210
     C           D2QFIN    IFNE *BLANKS                                                       CSW210
     C                     CALL 'AOCUSTR1'                                                    CSW210
     C                     PARM *BLANKS   WRTCD                                               CSW210
     C                     PARM '*KEY   ' WOPTN                                               CSW210
     C                     PARM D2QFIN    WCUST                                               CSW210
     C                     PARM *BLANKS   WKYST                                               CSW210
     C           SDCUST    PARM SDCUST    DSLDY                                               CSW210
      *                                                                                       CSW210
      ** QFIN is Customer                                                                     CSW210
      *                                                                                       CSW210
     C           WRTCD     IFEQ *BLANKS                                                       CSW210
     C                     MOVELBBCSID    MGQFBI                                              CSW210
     C                     MOVELBBCNA1    MGQAL1                                              CSW210
     C                     MOVELBBCNA2    MGQAL2                                              CSW210
     C                     MOVELBBCNA3    MGQAL3                                              CSW210
     C                     MOVELBBCNA4    MGQAL4                                              CSW210
     C                     ELSE                                                               CSW210
      *                                                                                       CSW210
     C                     CALL 'AOCNSTR0'                                                    CSW210
     C                     PARM *BLANKS   WRTCD                                               CSW210
     C                     PARM '*KEY   ' WOPTN                                               CSW210
     C                     PARM D2QFIN    WCNST                                               CSW210
     C           SDCNST    PARM SDCNST    DSFDY                                               CSW210
      *                                                                                       CSW210
      ** QFIN is Counterparty Nostro                                                          CSW210
      *                                                                                       CSW210
     C           WRTCD     IFEQ *BLANKS                                                       CSW210
     C                     MOVELAWSWID    MGQFBI                                              CSW210
     C                     MOVELAWCPNM    MGQAL1                                              CSW210
     C                     MOVELAWCNTN    MGQAL2                                              CSW210
     C                     MOVEL*BLANKS   MGQAL3                                              CSW210
     C                     MOVEL*BLANKS   MGQAL4                                              CSW210
     C                     ENDIF                                                              CSW210
     C                     ENDIF                                                              CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSW210
      ** Place of Clearing entered                                                            CSW210
      *                                                                                       CSW210
     C           D2PCLR    IFNE *BLANKS                                                       CSW210
     C                     CALL 'AOCUSTR1'                                                    CSW210
     C                     PARM *BLANKS   WRTCD                                               CSW210
     C                     PARM '*KEY   ' WOPTN                                               CSW210
     C                     PARM D2PCLR    WCUST                                               CSW210
     C                     PARM *BLANKS   WKYST                                               CSW210
     C           SDCUST    PARM SDCUST    DSLDY                                               CSW210
      *                                                                                       CSW210
      ** Place of Clearing is Customer                                                        CSW210
      *                                                                                       CSW210
     C           WRTCD     IFEQ *BLANKS                                                       CSW210
     C                     MOVELBBCSID    MGPCBI                                              CSW210
     C                     ELSE                                                               CSW210
      *                                                                                       CSW210
     C                     CALL 'AOCNSTR0'                                                    CSW210
     C                     PARM *BLANKS   WRTCD                                               CSW210
     C                     PARM '*KEY   ' WOPTN                                               CSW210
     C                     PARM D2PCLR    WCNST                                               CSW210
     C           SDCNST    PARM SDCNST    DSFDY                                               CSW210
      *                                                                                       CSW210
      ** Place of Clearing is Counterparty Nostro                                             CSW210
      *                                                                                       CSW210
     C           WRTCD     IFEQ *BLANKS                                                       CSW210
     C                     MOVELAWSWID    MGPCBI                                              CSW210
     C                     ENDIF                                                              CSW210
     C                     ENDIF                                                              CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSW210
     C                     ENDIF                                                              CSW210
      *                                                                   CSE029
      ** Write record to driver file.                                     CSE029
      *                                                                   CSE029
     C                     WRITEMGISODD0               74                 CSE029
     C           *IN74     IFEQ '1'                                       CSE029
     C                     MOVEL'039'     DBASE            ************** CSE029
     C                     MOVEL'MGISODPD'DBFILE           * DB ERROR 39* CSE029
     C                     MOVE *BLANKS   DBKEY            ************** CSE029
     C                     EXSR *PSSR                                     CSE029
     C                     END                                            CSE029
      *                                                                   CSE029
     C                     ENDSR                                          CSE029
      *                                                                   CSE029
      *****************************************************************   CSE029
      /TITLE SR/MFID                                                                          CSW207
      *****************************************************************                       CSW207
      *                                                               *                       CSW207
      *    MFID      - Check if Sending branch and Destination        *                       CSW207
      *                Customer are MiFID compliant.                  *                       CSW207
      *                                                               *                       CSW207
      *    CALLED BY - FMTISO                                         *                       CSW207
      *    CALLS     -                                                *                       CSW207
      *                                                               *                       CSW207
      *****************************************************************                       CSW207
      *                                                                                       CSW207
     C           MFID      BEGSR                                                              CSW207
      *                                                                                       CSW207
      ** initialise work fields                                                               CSW207
      *                                                                                       CSW207
     C                     MOVE 'N'       WBRCH   1                                           CSW207
     C                     MOVE 'N'       WDEST   1                                           CSW207
     C                     MOVE 'N'       WMFID   1                                           CSW207
      *                                                                                       CSW207
      ** check if Sending Branch is MiFID complaint                                           CSW207
      *                                                                                       CSW207
     C           MGSNBR    IFNE *BLANKS                                                       CSW207
      *                                                                                       CSW207
     C                     CALL 'AOBRCHR1'                                                    CSW207
     C                     PARM '*MSG'    P@RTCD  7                                           CSW207
     C                     PARM '*KEY'    P@OPTN  7                                           CSW207
     C                     PARM MGSNBR    P@BRCD  3                                           CSW207
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CSW207
      *                                                                                       CSW207
      ** DATABASE ERROR                                                                       CSW207
      *                                                                                       CSW207
     C           P@RTCD    IFNE *BLANKS                                                       CSW207
     C                     MOVEL'041'     DBASE                                               CSW207
     C                     MOVEL'SDBRCHPD'DBFILE                                              CSW207
     C                     MOVELP@BRCD    DBKEY                                               CSW207
     C                     EXSR *PSSR                                                         CSW207
     C                     END                                                                CSW207
      *                                                                                       CSW207
     C                     CALL 'AOLOCNR0'                                                    CSW207
     C                     PARM *BLANKS   P@RTCD                                              CSW207
     C                     PARM '*KEY   ' P@OPTN                                              CSW207
     C                     PARM A8LCCD    P@LOCN  3                                           CSW207
     C           SDLOCN    PARM SDLOCN    DSFDY                                               CSW207
      *                                                                                       CSW207
      ** Database error proceesing                                                            CSW207
      *                                                                                       CSW207
     C           P@RTCD    IFNE *BLANKS                                                       CSW207
     C                     Z-ADD049       DBASE                                               CSW207
     C                     MOVEL'SDLOCNPD'DBFILE                                              CSW207
     C                     MOVE A8LCCD    DBKEY                                               CSW207
     C                     EXSR *PSSR                                                         CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
     C           DVCNCD    CHAINMEISOCL1             90                                       CSW207
      *                                                                                       CSW207
      ** DATABASE ERROR                                                                       CSW207
      *                                                                                       CSW207
     C           *IN90     IFEQ *ON                                                           CSW207
     C**********           MOVEL'042'     DBASE                                        CSW207 264020
     C**********           MOVEL'MEISOCPD'DBFILE                                       CSW207 264020
     C**********           MOVELA8LCCD    DBKEY                                        CSW207 264020
     C**********           EXSR *PSSR                                                  CSW207 264020
     C                     MOVE 'N'       M3MFID                                              264020
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
     C           M3MFID    IFEQ 'Y'                                                           CSW207
     C                     MOVE 'Y'       WBRCH                                               CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
      ** check if Destination Customer is MiFID complaint                                     CSW207
      *                                                                                       CSW207
     C********** MGDEST    IFNE *ZEROS                                                CSW207 CSW207A
     C           DPBN      IFNE *ZEROS                                                       CSW207A
      *                                                                                       CSW207
     C**********           MOVELMGDEST    WCUST     P                                 CSW207 CSW207A
     C                     MOVELDPBN      WCUST     P                                        CSW207A
      *                                                                                       CSW207
     C                     CALL 'AOCSSWR0'                                                    CSW207
     C                     PARM *BLANKS   WRTCD                                               CSW207
     C                     PARM '*KEY   ' WOPTN                                               CSW207
     C                     PARM           WCUST                                               CSW207
     C                     PARM *BLANKS   WKYST                                               CSW207
     C                     PARM           DSLDY                                               CSW207
      *                                                                                       CSW207
      ** DATABASE ERROR                                                                       CSW207
      *                                                                                       CSW207
     C           WRTCD     IFNE *BLANKS                                                       CSW207
     C                     MOVEL'046'     DBASE                                               CSW207
     C                     MOVEL'SDCSSWPD'DBFILE                                              CSW207
     C                     MOVELWCUST     DBKEY                                               CSW207
     C                     EXSR *PSSR                                                         CSW207
     C                     END                                                                CSW207
      *                                                                                       CSW207
      ** extract SDCUSTPD and SDCSSWPD                                                        CSW207
      *                                                                                       CSW207
     C                     MOVEL'SDCUSTPD'P#FILN                                              CSW207
     C                     EXSR GETRCL                                                        CSW207
     C           P#RCDL    SUBSTDSLDY     SDCUST                                              CSW207
     C           P#RCDL    ADD  1         S       50                                          CSW207
      *                                                                                       CSW207
     C                     MOVEL'SDCSSWPD'P#FILN                                              CSW207
     C                     EXSR GETRCL                                                        CSW207
     C           P#RCDL    SUBSTDSLDY:S   SDCSSW                                              CSW207
      *                                                                                       CSW207
     C           BBCOLC    CHAINMEISOCL1             90                                       CSW207
      *                                                                                       CSW207
      ** DATABASE ERROR                                                                       CSW207
      *                                                                                       CSW207
     C           *IN90     IFEQ *ON                                                           CSW207
     C**********           MOVEL'047'     DBASE                                        CSW207 264020
     C**********           MOVEL'MEISOCPD'DBFILE                                       CSW207 264020
     C**********           MOVELBBCOLC    DBKEY                                        CSW207 264020
     C**********           EXSR *PSSR                                                  CSW207 264020
     C                     MOVE 'N'       M3MFID                                              264020
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
     C           M3MFID    IFEQ 'Y'                                                           CSW207
     C                     MOVE 'Y'       WDEST                                               CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
      ** check if both are MiFID compliant                                                    CSW207
      *                                                                                       CSW207
     C           WBRCH     IFEQ 'Y'                                                           CSW207
     C           WDEST     ANDEQ'Y'                                                           CSW207
     C                     MOVE 'Y'       WMFID                                               CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
      ** retrieve the classification of the counterparty                                      CSW207
      *                                                                                       CSW207
     C**********           MOVELMGDEST    WWCUST                                      CSW207 CSW207A
     C                     MOVELDPBN      WWCUST                                             CSW207A
      *                                                                                       CSW207
     C                     CALL 'AOSECSR0'                                                    CSW207
     C                     PARM *BLANKS   WRTCD                                               CSW207
     C                     PARM '*KEY   ' WOPTN                                               CSW207
     C                     PARM           WWCUST                                              CSW207
     C           SDSECS    PARM SDSECS    DSSDY                                               CSW207
      *                                                                                       CSW207
      ** DATABASE ERROR                                                                       CSW207
      *                                                                                       CSW207
     C           WRTCD     IFNE *BLANKS                                                       CSW207
     C                     MOVEL'048'     DBASE                                               CSW207
     C                     MOVEL'SDSECSPD'DBFILE                                              CSW207
     C                     MOVELWWCUST    DBKEY                                               CSW207
     C                     EXSR *PSSR                                                         CSW207
     C                     END                                                                CSW207
      *                                                                                       CSW207
     C                     ENDSR                                                              CSW207
      /TITLE SR/CALTND                                                    200292
      *****************************************************************   200292
      *                                                               *   200292
      *    CALTND    - DETERMINE THE TELEX NOTICE DATE                *   200292
      *                                                               *   200292
      *    CALLED BY - PROCES                                         *   200292
      *    CALLS     -                                                *   200292
      *                                                               *   200292
      *****************************************************************   200292
      *                                                                   200292
     C           CALTND    BEGSR                                          200292
      *                                                                   200292
      ** Get nominal Ccy from security detail file                        200292
     C           DPSS      CHAINSECTY                67                   200292
     C           *IN67     IFEQ '1'                                       200292
     C           RECI      OREQ '*'                                       200292
     C                     MOVEL'040'     DBASE            ************** 200292
     C                     MOVEL'SECTY   'DBFILE           * DB ERROR 40* 200292
     C                     MOVELDPSS      DBKEY            ************** 200292
     C                     EXSR *PSSR                                     200292
     C                     END                                            200292
      *                                                                   200292
      ** Calcalute Telex notice date at start.                            200292
      *                                                                   200292
     C                     MOVELILEPGM,1  PGMID  10                       200292
     C                     CALL PGMID                                     200292
      *                                                                   200292
      ** Deal or local Currency                                           200292
     C                     PARM 'D'       @DLOLC  1                       200292
      *                                                                   200292
      ** Currency                                                         200292
     C                     PARM NMCY      @CCY    3                       200292
      *                                                                   200292
      ** Nostro                                                           200292
     C                     PARM '  '      @NOSTR  2                       200292
      *                                                                   200292
      ** Date of Next Working Day                                         200292
     C                     PARM BJDNWD    @STDAT  50                      200292
      *                                                                   200292
      ** Local Currency                                                   200292
     C                     PARM BJLCCY    @LCCY   3                       200292
      *                                                                   200292
      ** System Location                                                  200292
     C                     PARM BJSLCD    @SYLCD  3                       200292
      *                                                                   200292
      ** OUTPUT - Telex Due Date                                          200292
      *                                                                   200292
     C                     PARM           @TLXDU  50                      200292
      *                                                                   200292
     C                     ENDSR                                          200292
      *                                                                   200292
      *****************************************************************   200292
      /TITLE SR/ICPSD
      *****************************************************************
      *                                                               *
      *    ICPSD     - DETERMINE IF START DATE MESSAGE DUE            *
      *                                                               *
      *    CALLED BY - PROCES                                         *
      *    CALLS     -                                                *
      *                                                               *
      *****************************************************************
      *
     C           ICPSD     BEGSR
      *
      ** SET WORKFIELD WWSTMT TO BLANKS
     C                     MOVE *BLANK    WWSTMT
      *
     C           CSW003    IFNE 'Y'                                       CSW003
     C           CSW003    OREQ 'Y'                                       CSW003
     C           DPWHEN    ANDEQ'S'                                       CSW003
      *                                                                   CSW003
      ** SET WORKFIELDS WWRCDL, WWMVDT, WWDEST, WWSTMT
     C           DPMV      IFEQ 'RR'
     C           DPMV      OREQ 'BB'
     C           DPMV      OREQ 'PL'
     C           DPMV      OREQ 'WI'
      *
     C           DPMD      IFLE BJRDNB
     C           CSW007    OREQ 'Y'                                       CSW007
     C********** CSE015    OREQ 'Y'                                                    200292 221612
     C********** DPMD      ANDLE@TLXDU                                                 200292 221612
     C                     MOVE 'R'       WWRCDL
     C                     Z-ADDDPMD      WWMVDT
     C**********           Z-ADDDPID      WWDEST                                              CSD027
     C                     MOVE DPID      WWDEST                                              CSD027
     C                     MOVE 'S'       WWSTMT
     C                     END
     C                     END
      *
     C           DPMV      IFEQ 'RP'
     C           DPMV      OREQ 'BL'
     C           DPMV      OREQ 'PD'
     C***********DPMV      OREQ 'DT'                                      094415
      *
     C           DPDO      IFLE BJRDNB
     C           CSW007    OREQ 'Y'                                       CSW007
     C********** CSE015    OREQ 'Y'                                                    200292 221612
     C********** DPDO      ANDLE@TLXDU                                                 200292 221612
     C                     MOVE 'D'       WWRCDL
     C                     Z-ADDDPDO      WWMVDT
     C***********          Z-ADDDPOD      WWDEST                          094415
     C**********           Z-ADDDPID      WWDEST                                       094415 CSD027
     C                     MOVE DPID      WWDEST                                              CSD027
     C                     MOVE 'S'       WWSTMT
     C                     END
     C                     END
      *                                                                   094415
     C           DPMV      IFEQ 'DT'                                      094415
      *                                                                   094415
     C           DPMD      IFLE BJRDNB                                    094415
     C********** CSE015    OREQ 'Y'                                                    200292 221612
     C********** DPMD      ANDLE@TLXDU                                                 200292 221612
     C                     MOVE 'D'       WWRCDL                          094415
     C                     Z-ADDDPMD      WWMVDT                          094415
     C**********           Z-ADDDPOD      WWDEST                                       094415 CSD027
     C                     MOVE DPOD      WWDEST                                              CSD027
     C                     MOVE 'S'       WWSTMT                          094415
     C                     END                                            094415
     C                     END                                            094415
      *
     C           DPMV      IFEQ 'WO'
     C           DPDO      ANDLEBJRDNB
     C           DPMV      OREQ 'WO'                                      200292
     C********** CSE015    ANDEQ'Y'                                                    200292 221612
     C********** DPDO      ANDLE@TLXDU                                                 200292 221612
      *
     C                     MOVE 'D'       WWRCDL
     C                     Z-ADDDPDO      WWMVDT
     C**********           Z-ADDDPOD      WWDEST                                              CSD027
     C                     MOVE DPOD      WWDEST                                              CSD027
     C                     MOVE 'S'       WWSTMT
     C                     END
      *                                                                   CSW003
     C                     END                                            CSW003
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/ICPMD
      *****************************************************************
      *                                                               *
      *    ICPMD     - DETERMINE IF MATURITY DATE MESSAGE DUE         *
      *                                                               *
      *    CALLED BY - PROCES                                         *
      *    CALLS     -                                                *
      *                                                               *
      *****************************************************************
      *
     C           ICPMD     BEGSR
      *
      ** SET WORKFIELD WWSTMT TO BLANKS
     C                     MOVE *BLANK    WWSTMT
      *
     C           CSW003    IFNE 'Y'                                       CSW003
     C           CSW003    OREQ 'Y'                                       CSW003
     C           DPWHEN    ANDEQ'M'                                       CSW003
      *                                                                   CSW003
      ** SET WORKFIELDS WWRCDL, WWMVDT, WWDEST, WWSTMT
     C           DPMV      IFEQ 'RR'
     C           DPMV      OREQ 'BB'
     C           DPMV      OREQ 'PL'
      *
     C           DPDO      IFLE BJRDNB
     C           CSW007    OREQ 'Y'                                       CSW007
     C********** CSE015    OREQ 'Y'                                                    200292 221612
     C********** DPDO      ANDLE@TLXDU                                                 200292 221612
     C                     MOVE 'D'       WWRCDL
     C                     Z-ADDDPDO      WWMVDT
     C**********           Z-ADDDPID      WWDEST                                              CSD027
     C                     MOVE DPID      WWDEST                                              CSD027
     C                     MOVE 'M'       WWSTMT
     C                     END
     C                     END
      *
     C           DPMV      IFEQ 'RP'
     C           DPMV      OREQ 'BL'
     C           DPMV      OREQ 'PD'
     C           DPMV      OREQ 'DT'                                      CSW003
     C           CSW003    ANDEQ'Y'                                       CSW003
      *
     C           DPMD      IFLE BJRDNB
     C           CSW007    OREQ 'Y'                                       CSW007
     C********** CSE015    OREQ 'Y'                                                    200292 221612
     C********** DPMD      ANDLE@TLXDU                                                 200292 221612
     C***********          MOVE 'D'       WWRCDL                          094415
     C                     MOVE 'R'       WWRCDL                          094415
     C                     Z-ADDDPMD      WWMVDT
     C***********          Z-ADDDPOD      WWDEST                          094415
     C**********           Z-ADDDPID      WWDEST                                       094415 CSD027
     C                     MOVE DPID      WWDEST                                              CSD027
     C                     MOVE 'M'       WWSTMT
     C                     END
     C                     END
      *                                                                   CSW003
     C                     END                                            CSW003
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/ICP
      *****************************************************************
      *                                                               *
      *    ICP       - INPUT CYCLE PROCESSING                         *
      *                                                               *
      *    CALLED BY - PROCES                                         *
      *    CALLS     -                                                *
      *                                                               *
      *****************************************************************
      *
     C           ICP       BEGSR
      *
     C           WWSTMT    IFEQ 'S'
     C           DPRCDG    ANDEQ'Y'
     C           WWSTMT    OREQ 'S'
     C           DPRCDG    ANDEQ'A'
     C           WWSTMT    OREQ 'M'
     C           DPRCDG    ANDEQ'Y'
      *
      ** GENERATE CANCELLATION MESSAGES
      ** (Only if it is for non-ISO15022 messages)                        CSE029
      *                                                                   CSE029
     C           DPNEW     IFNE 'Y'                                       CSE029
      *                                                                                       CSW202
      ** Bypass processing if SWIFT 2002 is installed                                         CSW202
      *                                                                                       CSW202
     C           CSW202    ANDNE'Y'                                                           CSW202
      *                                                                                       CSW202
     C                     EXSR MTYPE                                     089115
     C                     EXSR GCMSG
     C                     ENDIF                                          CSE029
     C                     END
      *
      ** Generate new message if the depot movement is not being          CSE029
      ** deleted or ISO15022 messages is needed.                          CSE029
     C           CHTP      IFNE 'D'
     C           DPNEW     OREQ 'Y'                                       CSE029
      *
      ** ACCESS MASTER FILES
     C                     EXSR AMASF
      *
      * SET UP GENERATION DRIVER FILES FIELDS
     C                     CLEARMGF520D0
     C                     CLEARMGF521D0
     C                     CLEARMGF522D0
     C                     CLEARMGF523D0
     C                     CLEARMGF580D0
     C                     CLEARMGISODD0                                  CSE029
     C/COPY WNCPYSRC,SE1873C009
      *
      * DETERMINE MESSAGE TYPE
     C                     EXSR MTYPE
      *
      ** DETERMINE DESTINATION CUSTOMER ADDRESS
      ** MESSAGE BRANCH ZERO - SET DEST CUST EQUAL TO WORKFIELD WWDEST
     C                     MOVE WWDEST    MGDEST
      *
      ** PRODUCE MESSAGE TO BE SENT
     C                     EXSR MSGST
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/WPR01
      *****************************************************************
      *                                                               *
      *   WPR01     - PRINT MT592 GENERATED                           *
      *                                                               *
      *   CALLED BY - Main Processing                                 *
      *   CALLS     - NONE                                            *
      *                                                               *
      *****************************************************************
      *
     C           WPR01     BEGSR
      *
     C           DTRNO     IFNE *BLANKS
     C                     MOVE 'Y'       WWPR01  1
      *
      ** FORMAT TRADE REFERENCE
     C                     MOVELDTRNO     R1TRNO
     C                     MOVELDRELR     R1RELR
     C                     MOVELDRELD     R1ORIG
     C                     MOVELDNWRK     R1NWRK
      *
      ***  If print file not yet open then open it and write headings
     C           *IN15     IFEQ '0'
      *
     C                     OPEN SE1873P1
     C                     MOVE '1'       *IN15
      *
     C                     Z-ADDSFNUM1    ZSNUM   60
     C                     CALL 'ZSFILE'
     C                     PARM           PSEQ    5
     C                     PARM *BLANKS   WPARM   3
     C                     PARM           SFILE1
     C                     PARM           ZSNUM
     C                     PARM           ZSERR   1
      *
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
      *
      ** PRINT PAGE HEADINGS
     C                     WRITEHEADP1
      *
     C                     END
      *
      ** WRITE A DETAIL LINE TO THE REPORT CHECKING FOR OVERFLOW
     C           WWOFL1    SUB  WWPTL1    WWLINE  20
     C           WWLINE    IFLT 3
     C                     WRITEHEADP1
     C                     END
      *
     C                     WRITEDETAIL1
     C                     CLEARDETAIL1
      *
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/AUDIT
      *****************************************************************
      *                                                               *
      *    AUDIT     - RUN CONTROL PROCESS                            *
      *                                                               *
      *    CALLED BY - PROCES                                         *
      *    CALLS     - NONE                                           *
      *                                                               *
      *****************************************************************
      *
     C           AUDIT     BEGSR
      *
     C                     Z-ADDSFNUMU    ZSNUM   60
     C                     CALL 'ZSFILE'
     C                     PARM           PSEQ
     C                     PARM *BLANKS   WPARM
     C                     PARM           SFILEU
     C                     PARM           ZSNUM
     C                     PARM           ZSERR   1
      *
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
      *
      ***  Write Heading and control information
     C                     WRITEHEADAU
     C                     WRITECONTROL
      *
      ***  If there is a DB Error, Output the DB Error Information.
     C           *INU7     IFEQ '1'
     C                     WRITEDBERROR
     C                     ELSE
      *
      ***  Or, if no valid records read, Output "No Details" message.
     C           WWPR01    IFNE 'Y'
     C           WWPR02    ANDNE'Y'
     C                     WRITENONE
     C                     END
     C                     END
      *
     C                     ENDSR
      *****************************************************************                       CSW207
      /TITLE SR/GETRCL                                                                        CSW207
      *****************************************************************                       CSW207
      *                                                               *                       CSW207
      *  GETRCL- Get record length                                    *                       CSW207
      *                                                               *                       CSW207
      *****************************************************************                       CSW207
      *                                                                                       CSW207
     C           GETRCL    BEGSR                                                              CSW207
      *                                                                                       CSW207
     C           'UTGETRCD'CAT  'LN'      P#PGM  10                                           CSW207
      *                                                                                       CSW207
     C                     CALL P#PGM                                                         CSW207
     C                     PARM           P#RTCD 10                                           CSW207
     C                     PARM           P#RCDL  50                                          CSW207
     C                     PARM           P#FILN 10                                           CSW207
     C                     PARM '*LIBL'   P#LIBN 10                                           CSW207
      *                                                                                       CSW207
     C           P#RTCD    IFNE *BLANK                                                        CSW207
     C                     EXSR *PSSR                                                         CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
     C                     ENDSR                                                              CSW207
      *
      *****************************************************************                       CSW210
      **                                                              *                       CSW210
      **  SRSWFT    - SWIFT Address validation                        *                       CSW210
      **                                                              *                       CSW210
      **  Calls     - ME1400                                          *                       CSW210
      **  Called By - FMTISO                                          *                       CSW210
      **                                                              *                       CSW210
      *****************************************************************                       CSW210
      *                                                                                       CSW210
     C           SRSWFT    BEGSR                                                              CSW210
     C                     SETOF                     90                                       CSW210
      *                                                                                       CSW210
      ** Test positions 1-8 for valid SWIFT Characters                                        CSW210
      ** Check how many characters are alphanumeric                                           CSW210
     C                     MOVEL*BLANKS   FLD    35                                           CSW210
     C                     MOVELD2DAD1    FLD                                                 CSW210
     C           ALPHAN    CHECKFLD       X#      30     90                                   CSW210
      *                                                                                       CSW210
      ** If the first 8 or 11 are ok proceed                                                  CSW210
     C           *IN90     IFEQ *ON                                                           CSW210
     C           X#        ANDEQ9                                                             CSW210
     C           *IN90     OREQ *ON                                                           CSW210
     C           X#        ANDEQ12                                                            CSW210
     C           ' '       CHECKFLD:X#    ##001   10     90                                   CSW210
      *                                                                                       CSW210
      ** Check for blanks if before 8 or 11 then assume address                               CSW210
     C           *IN90     IFEQ *ON                                                           CSW210
     C           X#        ANDEQ11                                                            CSW210
     C                     MOVE 'Y'       ##CSID  1                                           CSW210
     C                     GOTO ENDSWT                                                        CSW210
     C                     ENDIF                                                              CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSW210
      ** Invalid format - Not a S.W.I.F.T.                                                    CSW210
     C           *IN90     IFEQ *ON                                                           CSW210
     C                     MOVE 'N'       ##CSID                                              CSW210
     C                     GOTO ENDSWT                                                        CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSW210
      ** Call Access object to validate identifier                                            CSW210
     C                     MOVELFLD       W9BICC                                              CSW210
     C           3         SUBSTFLD:9     W9BICB                                              CSW210
      *                                                                                       CSW210
     C                     CALL 'ME1400'                                                      CSW210
     C                     PARM *BLANKS   W9RTN   7                                           CSW210
     C                     PARM           W9BICC  8                                           CSW210
     C                     PARM           W9BICB  3                                           CSW210
     C                     PARM           SDCUST                                              CSW210
     C                     PARM           SDCNST                                              CSW210
     C                     PARM           MEBICD                                              CSW210
     C                     PARM *BLANKS   W9CUST  1                                           CSW210
     C                     PARM *BLANKS   W9CNST  1                                           CSW210
     C                     PARM *BLANKS   W9BICD  1                                           CSW210
      *                                                                                       CSW210
      ** Record found - BIC exists                                                            CSW210
     C           W9RTN     IFEQ *BLANKS                                                       CSW210
     C                     MOVE 'Y'       ##CSID                                              CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSW210
     C           ENDSWT    TAG                                                                CSW210
     C                     ENDSR                                                              CSW210
      *                                                                                       CSW210
      *****************************************************************
      /TITLE SR/*PSSR
      *****************************************************************
      *                                                               *
      *  *PSSR  - Program Error Processing Subroutine.                *
      *                                                               *
      *  Called By: Various                                           *
      *  AUDIT  - Produce Audit Report and End Program                *
      *                                                               *
      *****************************************************************
      *
     C           *PSSR     BEGSR                           *** *PSSR  ***
      *
      ***  Check to see that *PSSR has not already been called.
     C           WRUN      IFEQ *BLANK
     C                     MOVE 'Y'       WRUN    1
     C                     MOVEL'SE1873'  DBPGM
      *
     C           *NAMVAR   DEFN LDA       WLDA  256
     C           *LOCK     IN   WLDA
     C                     MOVELDBERR     WLDA
     C                     OUT  WLDA
     C                     SETON                     U7U8LR
      *
     C                     EXSR AUDIT
      *
     C                     DUMP
     C                     END
      *
      ** Exit program
     C                     RETRN
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT                                                              CEU003
      *****************************************************************   CEU003
      *                                                               *   CEU003
      *  SREURO - Subroutine that converts settlement amount to       *   CEU003
      *           Euro equivalent.                                    *   CEU003
      *                                                               *   CEU003
      *  Called By: Various                                           *   CEU003
      *                                                               *   CEU003
      *****************************************************************   CEU003
      *                                                                   CEU003
     C           SREURO    BEGSR                                          CEU003
      *                                                                   CEU003
     C                     Z-ADD1         B                               CEU003
     C           CCY       LOKUPCUR,B                    21               CEU003
      *                                                                   CEU003
     C           INCY,B    IFEQ 'Y'                                       CEU003
     C           CCY       ANDNESTCY                                      CEU003
     C                     MOVE *BLANKS   PRTCD   7                       CEU003
     C                     Z-ADDMGSTAM    PFRAM  183                      CEU003
     C                     MOVE CCY       PFRCY   3                       CEU003
     C                     MOVE STCY      PTOCY   3                       CEU003
      *                                                                   CEU003
     C                     CALL 'EU0200'                                  CEU003
     C                     PARM           PRTCD                           CEU003
     C                     PARM           PFRAM                           CEU003
     C                     PARM           PFRCY                           CEU003
     C                     PARM           PTOCY                           CEU003
     C                     PARM           POUTA  150                      CEU003
     C                     PARM           PINTA  183                      CEU003
     C                     PARM           PEXRT  159                      CEU003
     C                     PARM           PMDIN   1                       CEU003
      *                                                                   CEU003
     C                     Z-ADDPOUTA     MGSTAM                          CEU003
     C                     MOVE STCY      MGSTCY                          CEU003
      *                                                                   CEU003
     C           PRTCD     IFNE *BLANKS                                   CEU003
     C                     MOVEL'*CALL   'DBFILE                          CEU003
     C                     MOVEL'EU0200  'DBKEY             ************  CEU003
     C                     Z-ADDDBASE     DBASE             * DBERR NN *  CEU003
     C                     EXSR *PSSR                       ************  CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
     C                     ENDSR                                          CEU003
      *****************************************************************   CEU003
      /TITLE SR/ZDATE1
     C/COPY ZSRSRC,ZDATE1Z2
      /TITLE SR/ZDATE2
     C/COPY ZSRSRC,ZDATE2Z2
      /TITLE SR/ZNCD
     C/COPY ZSRSRC,ZNCDZ3
      /TITLE SR/ZCNSD                                                     CSW003
     C/COPY ZSRSRC,ZCNSDZ1                                                CSW003
      /TITLE COMPILE-TIME ARRAYS
      ***
**  CPY@
(c) Finastra International Limited 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  ECIN - EUROCLEAR AND CEDEL NUMERIC CODES FOR INSTRUCTIONS
####################
####################
4F4T6F##41##61######
315F5T8D8151##8M8A##
**  ECTA - EUROCLEAR AND CEDEL ALPHABETIC CODES EQUIVALENT FOR INST. TYPE
##############################
##############################
INTINTEXT###INT###EXT#########
INTINTINTEXTEXTINT###EXTEXT###
**  ECSA - EUROCLEAR AND CEDEL ALPHABETIC CODES EQUIVALENT FOR INST. SUB-TYPE
##################################################
##################################################
SETTLMATCHBOOK #####SETTL#####BOOK ###############
TRANSSETTLMATCHBOOK PHYSISETTL#####BOOK PHYSI#####
**  POWER8 - ARRAY OF POWERS FOR CURRENCY CONVERSION
00000001                                                                  CSW003
00000010                                                                  CSW003
00000100                                                                  CSW003
00001000                                                                  CSW003
00010000                                                                  CSW003
00100000                                                                  CSW003
01000000                                                                  CSW003
10000000                                                                  CSW003
**  POWER9 - ARRAY OF POWERS FOR CURRENCY CONVERSION
00000001                                                                  125251
00000010                                                                  125251
00000100                                                                  125251
00001000                                                                  125251
00010000                                                                  125251
00100000                                                                  125251
01000000                                                                  125251
10000000                                                                  125251
** ILEPGM - ILE program Name
ZATLXDUEDT
