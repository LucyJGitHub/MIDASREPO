000100200529     H        1
000200200529      *****************************************************************
000300200529/*STD *  RPGBASE                                                      *
000400200529/*EXI *  TEXT('Midas Security Withholding Tax Details Mnt')
000500200529     F*****************************************************************
000600200529     F*                                                               *
000700200529     F*  Midas  Securities Trading Module                         *
000800200529     F*                                                               *
000900200529     F*  SE1960 - Security Withholding Tax Details Maintenance        *
001000200529     F*                                                               *
001100200529     F*  Function: This program allows input of Withholding Tax       *
001200200529     F*            details for coupon and dividend bearing            *
001300200529     F*            securities which attract such a tax.               *
001400200529     F*            Created as part of SAR S01447, Withholding Tax     *
001500200529     F*                                                               *
001600200529     F*  Called By: SEC02 - Input Cycle Processing                    *
001700200529     F*                                                               *
001800200529     F*  Calls: AOBANKR0 - Access object for Bank I.C.D. details      *
001900200529     F*         AOCTRYR0 - Access object for Country Codes            *
002000200529     F*                                                               *
002100200529      *  (c) Finastra International Limited 2001                      *
002200200529     F*                                                               *
002300200604      *  Last Amend No. AR397187A          Date 22May20               *
002400200604      *  PREV Amend No. AR397187           Date 22May20               *
002500200604      *                 MD027346           Date 22May20               *
002600200604      *                 MD046248           Date 27Oct17               *
002700200529      * Bank Fusion Midas 1.4 Base -----------------------------------*
002800200529      * Midas Plus 1.4 Base 04 ---------------------------------------*
002900200529      *                 CRE026             Date 24May06               *
003000200529      * Midas Plus 1.3 ----------- Base ------------------------------*
003100200529      *                 CSD031             Date 10Apr06               *
003200200529      *                 CSD027             Date 09Dec05               *
003300200529      *                 CSE071             Date 19Jul05               *
003400200529      *                 BUG3644            Date 12Jul04               *
003500200529      * Midas Release 4 --------------- Base -------------------------*
003600200529      * Midas DBA 3.00 ---------------- Base -------------------------*
003700200529      *                 S01408             Date 22Aug96               *
003800200529      *                 084256             Date 06Sep95               *
003900200529     F*                 S01496             DATE 10OCT94               *
004000200529     F*                 S01447             DATE 26JAN94               *
004100200529     F*                                                               *
004200200529     F*---------------------------------------------------------------*
004300200529     F*                                                               *
004400200529      *  AR397187A - Modify previous fix on the validation of user    *
004500200529      *              and action code on input screen and add valida-  *
004600200529      *              tion on the subfile screen.                      *
004700200529      *  MD027346 - Midas database error due to record cannot be      *
004800200529      *             allocated. Monitor for error during CHAIN and     *
004900200529      *             issue proper error message if cannot be allocated.*
005000200529      *  AR397187 - Security withholding tax details maintenance      *
005100200529      *             issue.  Add validation for user and action code.  *
005200200529      *  MD046248 - Finastra Rebranding                               *
005300200529      *  CRE026 - Consumer Banking (Recompile)                        *
005400200529      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
005500200529      *  CSD027 - Conversion Of Customer Number to Alpha              *
005600200529      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
005700200529      *  BUG3644 - Serious Error in Collateralised Lending (Recompile)*
005800200529     F*  S01408 - Core Hook SE1960CCP1 Added                          *
005900200529     F*  084256 - Tax rate change should be switchable                *
006000200529     F*  S01496 - Incorporation of JYSKE Enhancements (S10982)        *
006100200529     F*  S01447 - Created for SE Withholding Tax enhancement.         *
006200200529     F*                                                               *
006300200529     F*****************************************************************
006400200529     F*                                                               *
006500200529     F*  C R E A T I O N     P A R A M E T E R S                      *
006600200529     F*                                                               *
006700200529     F*                                                               *
006800200529     F*****************************************************************
006900200529     F/EJECT
007000200529     F*****************************************************************
007100200529     F*
007200200529     FSECTY   IF  E           K        DISK         KINFSR *PSSR
007300200529     F*
007400200529     F***SESWHTL0UF  E           K        DISK         KINFSR *PSSR A                       MD027346
007500200529     FSESWHTL0UF  E           K        DISK                      A    UC                    MD027346
007600200529     F                                              KINFDS FILEDS
007700200529     F            SESWHTD0                          KRENAMESESWHTDX                         MD02734
007800200529     F                                              KCOMIT
007900200529     F*
008000200529     F**   SCREEN FORMAT
008100200529     FSE1960DFCF  E                    WORKSTN      KINFSR *PSSR
008200200529     F                                        DDRRN KSFILE SE1960S5
008300200529     F*
008400200529     F********************************************************************
008500200529     F/EJECT
008600200529     F********************************************************************
008700200529     F**                                                                 *
008800200529     F** ID F  C  H  L    FUNCTION OF INDICATORS                         *
008900200529     F**                 ------------------------                        *
009000200529     F** 26 - END OF MESSAGE SUBFILE                                     *
009100200529     F** 27 - ROLLUP                                                     *
009200200529     F** 28 - SFLDSP                                                     *
009300200529     F** 29 - SFLDSPCTL                                                  *
009400200529     F** 30 - SFLCLR                                                     *
009500200529     F** 31 - SFLEND                                                     *
009600200529     F** 32 - ROLLDOWN                                                   *
009700200529     F**       41 - ERROR ON TAX BAND FOR TAX DEDUCTED AT SOURCE         *
009800200529     F**       42 - ERROR ON TAX BAND FOR TAX DEDUCTED BY USER           *
009900200529     F**       43 - ERROR ON RATE OF TAX DEDUCTED AT SOURCE              *
010000200529     F**    51 - FILE INDICATOR ON SESWHTL0                              *
010100200529     F**    52 - FILE INDICATOR ON SECTY                                 *
010200200529     F**    54 - WRITE INDICATOR ON SESWHTL0                             *
010300200529     F**    59 - FILE INDICATOR ON SE1960DF                              *
010400200529     F**       60 - SECOND SCREEN DISPLAYED                              *
010500200529     F**       61 - ERROR ON ACTION CODE                                 *
010600200529     F**       62 - ERROR ON SECURITY                                    *
010700200529     F**       63 - ERROR ON RATE OF TAX DEDUCTED AT SOURCE              *
010800200529     F**       66 - ERROR ON REVIEW FROM                                 *
010900200529     F**       69 - ERROR ON SUBFILE SELECT                              *
011000200529     F**          70 - ERROR INDICATOR                                   *
011100200529     F**          71 - 'INVALID' INDICATOR                               *
011200200529     F**             99 - FILE ERROR INDICATOR                           *
011300200529     F**                                                                 *
011400200529     F**       90-98 - USED IN STANDARD SUBROUTINE SR/ZALIGN             *
011500200529     F********************************************************************
011600200529     F/EJECT
011700200529     E********************************************************************
011800200529     E*
011900200529     E** ARRAY FOR COPYRIGHT
012000200529     E                    CPY@    1   1 80
012100200529     E*
012200200529     E** ARRAYS USED IN ZALIGN
012300200529     E                    ZA1        16  1
012400200529     E                    ZA2        16  1
012500200529     E*
012600200529     E** ARRAYS USED IN CONVERSION OF DECIMAL AMOUNTS TO CHARACTER
012700200529     E                    ZS1        15  1 0
012800200529     E                    ZS2        21  1
012900200529     E********************************************************************
013000200529     E/EJECT
013100200529     I********************************************************************
013200200529     I*
013300200529     I** DATA STRUCTURE FOR COMPILATION - COPYRIGHT INSERTION
013400200529     ICPYR@$      DS
013500200529     I                                        1  80 CPY@
013600200529     I                                        1  20 CPY@$$
013700200529     I*
013800200529     I** PROGRAM STATUS DATA STRUCTURE
013900200529     IPSDS       SDS
014000200529     I                                      244 246 WSID
014100200529     I                                      254 263 USID
014200200529     I*
014300200529     I** FILE INFORMATION DATA STRUCTURE
014400200529     IFILEDS      DS
014500200529     I                                     *STATUS  STATUS
014600200529     I*
014700200529     I**  LOCAL DATA AREA FOR DATA BASE ERRORS
014800200529     ILDA        UDS                            256
014900200529     I                                      134 141 DBFILE
015000200529     I                                      142 170 DBKEY
015100200529     I                                      171 180 DBPGM
015200200529     I                                      181 1830DBASE
015300200529     IRUNDT       DS
015400200529     I*
015500200529     I** DATA AREA RUNDAT
015600200529     I*
015700200529     I                                        1   7 RUNA
015800200529     I                                    P   8  100RUND
015900200529     I                                       11  11 SSF
016000200529     I                                       12  12 DATF
016100200529     I                                       13  13 MBIN
016200200529     I*
016300200529     I**  DATA AREA FOR UPDATE PROCESSING
016400200529     IDNATN       DS                              5
016500200529     I                                        1   50FNATN
016600200529     I*
016700200529     I** DATA AREA OF MENU USER
016800200529     I*
016900200529     IZMUSER      DS                             17
017000200529     I                                       11  13 USRBCH
017100200529     I** DATA STRUCTURE TO PROVIDE TEXT ON COMIT ENTRY IN JOURNAL
017200200529     ICMTTXT      DS                             52
017300200529     I                                        1   52NATN
017400200529     I                                        6   7 MDID
017500200529     I                                        8  15 PGMN
017600200529     I                                       16  18 WSIDX
017700200529     I                                       19  240MTIME
017800200529     I                                       25  25 ACTNX
017900200529     I                                       26  35 USIDX
018000200529     I                                       43  52 DD1SSN
018100200529     I*
018200200529     I** ARRAY FOR ZSEDIT
018300200529     I            DS
018400200529     I                                        1  150WORK15
018500200529     I                                        1  150ZS1
018600200529     I*
018700200529     I** FORMAT ZSEDIT OUTPUT
018800200529     IWW21FM      DS
018900200529     I                                        1  21 WWFL21
019000200529     I                                        1  20 WW20CH
019100200529     I                                        1  18 WW18CH                084256
019200200529     I                                       21  21 WWSIGN
019300200529     ISDCTRY    E DSSDCTRYPD
019400200529     ISECNTR    E DSSECNTRPD
019500200529     ISCSARD    E DSSCSARDPD                                              084256
019600200529     IDSFDY     E DSDSFDY
019700200529     I********************************************************************
019800200529     C/EJECT
019900200529     C********************************************************************
020000200529     C*
020100200529     C**              START MAINLINE
020200200529     C**             ----------------
020300200529     C*
020400200529     C**   INITIALISATION
020500200529     C                     EXSR #A
020600200529     C*
020700200529     C**   MAIN PROCESSING
020800200529     C           *INKC     DOWEQ'0'
020900200529     C*
021000200529     C                     MOVEL*BLANKS   DD1ACT
021100200529     C                     MOVEL*BLANKS   DD1SSN
021200200529     C                     MOVEL*BLANKS   DD1RVF
021300200529     C                     EXSR #B
021400200529     C                     MOVE '1'       *IN71
021500200529     C*
021600200529     C                     END
021700200529     C*
021800200529     C**   END PROGRAM
021900200529     C                     MOVE '1'       *INLR
022000200529     C*
022100200529     C********************************************************************
022200200529     C/EJECT
022300200529     C********************************************************************
022400200529     C**                                                                 *
022500200529     C**          INDEX TO SUBROUTINES                                   *
022600200529     C**         ----------------------                                  *
022700200529     C**                                                                 *
022800200529     C**       #B     - MAINLINE                                         *
022900200529     C**       #BA    - VALIDATION OF SCREEN 1                           *
023000200529     C**       #BB    - SUBFILE PROCESSING                               *
023100200529     C**       #BBA   - PROCESSES ENTRY FROM SUBFILE                     *
023200200529     C**       #ZA    - FILE MAINTENANCE SCREENS                         *
023300200529     C**       #ZC    - CMD12 PROCESSING                                 *
023400200529     C**       #ZABA  - VALIDATE & FORMAT RATES ON MAINTENANCE SCREEN    *
023500200529     C**       #ZAB   - VALIDATION OF FILE MAINTENANCE SCREENS           *
023600200529     C**       #A     - INITIALISATION                                   *
023700200529     C**       #ZB    - LOADS ONE PAGE OF SUBFILE RECORDS                *
023800200529     C**       #BBAA  - VALIDATES SELECTION ON SUBFILE                   *
023900200529     C**       #ZAA   - UPDATE PROCESSING                                *
024000200529     C**       ZTNLU1 - TRANSACTION NUMBER PROCESSING                    *
024100200529     C**       ZASNMS - WRITES A MESSAGE TO MESSAGE SUBFILE              *
024200200529     C**       #PSSR  - ERROR HANDLING SUBROUTINE                        *
024300200529     C**       ZALIGN - VALIDATE NUMERIC INPUT                           *
024400200529     C**       ZSEDIT - FORMAT NUMERIC FOR OUTPUT                        *
024500200529     C**                                                                 *
024600200529     C********************************************************************
024700200529     C/EJECT
024800200529     C********************************************************************
024900200529     C**                                                                 *
025000200529     C** #B        - MAIN PROCESSING                                     *
025100200529     C**                                                                 *
025200200529     C** CALLS     - #BA, #BB, #ZA                                       *
025300200529     C**                                                                 *
025400200529     C** CALLED BY - MAINLINE                                            *
025500200529     C**                                                                 *
025600200529     C********************************************************************
025700200529     C           #B        BEGSR
025800200529     C*
025900200529     C** WHILE NOT END REQUESTED AND INVALID DATA
026000200529     C           *INKC     DOWEQ'0'
026100200529     C           *IN71     ANDEQ'1'
026200200529     C*
026300200529     C**  DISPLAY SELECTION SCREEN
026400200529     C                     WRITESE1960F1
026500200529     C*
026600200529     C**  IF ERROR AND NOT HELP, WRITE MESSAGE SUBFILE
026700200529     C           *IN70     IFEQ '1'
026800200529     C                     WRITESE1960C7
026900200529     C                     END
027000200529     C*
027100200529     C**  READ SELECTION SCREEN
027200200529     C                     READ SE1960F1                 59
027300200529     C*
027400200529     C** IF NOT END REQUESTED
027500200529     C** PROCESS HELP OR ENTER AS NECESSARY
027600200529     C           *INKC     IFEQ '0'
027700200529     C*
027800200529     C                     EXSR #BA
027900200529     C*
028000200529     C                     END
028100200529     C*
028200200529     C**   IF VALID DATA GET DETAILS AS NECESSARY
028300200529     C           *IN71     IFEQ '0'
028400200529     C                     MOVE '1'       *IN71
028500200529     C*
028600200529     C**   DISPLAY NEXT SCREEN AS NECESSARY
028700200529     C                     MOVE '1'       *IN60
028800200529     C*
028900200529     C           WWSFL     IFEQ 'Y'
029000200529     C*
029100200529     C                     EXSR #BB
029200200529     C*
029300200529     C                     ELSE
029400200529     C*
029500200529     C                     EXSR #ZA
029600200529     C*
029700200529     C                     END
029800200529     C*
029900200529     C                     END
030000200529     C*
030100200529     C                     END
030200200529     C*
030300200529     C                     ENDSR
030400200529     C********************************************************************
030500200529     C/EJECT
030600200529     C********************************************************************
030700200529     C**                                                                 *
030800200529     C** #BA       - THIS SUBROUTINE PERFORMS VALIDATION OF SCREEN 1     *
030900200529     C**                                                                 *
031000200529     C** CALLS     - ZASNMS                                              *
031100200529     C**                                                                 *
031200200529     C** CALLED BY - #B                                                  *
031300200529     C**                                                                 *
031400200529     C********************************************************************
031500200529     C           #BA       BEGSR
031600200529     C*
031700200529     C** CLEAR SCREEN MESSAGE QUEUE
031800200529     C                     CALL 'Y2CLMSC'
031900200529     C                     PARM           WWTPGQ 10
032000200529     C                     PARM           WWPGQR  5
032100200529     C*
032200200529     C** CLEAR SCREEN ERROR INDICATORS
032300200529     C                     MOVEA'000'     *IN,41
032400200529     C                     MOVEA'0000000' *IN,61
032500200529     C                     MOVEA'00'      *IN,70
032600200529     C                     MOVE 'N'       WWIOVR
032700200529     C*
032800200529     C** VALIDATE ENTRIES AS FOLLOWS:
032900200529     C*
033000200529     C**   IF ACTION AND SECURITY ARE BLANK
033100200529     C**   SET SUBFILE NEEDED FLAG TO 'Y' & STORE REVIEW FROM VALUE
033200200529     C           DD1ACT    IFEQ *BLANKS                    B001
033300200529     C           DD1SSN    ANDEQ*BLANKS
033400200529     C*
033500200529     C                     MOVE 'Y'       WWSFL   1
033600200529     C*
033700200529     C                     ELSE                            X001
033800200529     C*
033900200529     C                     MOVE 'N'       WWSFL
034000200529     C*
034100200529     C**   IF REVIEW FROM IS ENTERED THEN ACTION AND SECURITY
034200200529     C**   MUST BE BLANK
034300200529     C           DD1RVF    IFNE *BLANKS                    B002
034400200529     C*
034500200529     C           DD1ACT    IFNE *BLANKS                    B003
034600200529     C           DD1SSN    ORNE *BLANKS
034700200529     C*
034800200529     C                     MOVE '1'       *IN66
034900200529     C                     MOVEA'11'      *IN,70
035000200529     C                     MOVEL'SEM1030' ZAMSID
035100200529     C                     EXSR ZASNMS
035200200529     C                     END                             E003
035300200529     C*
035400200529     C                     ELSE                            X002
035500200529     C*
035600200529     C**   ACTION IS ENTERED
035700200529     C**   ACTION MUST BE 'I', 'A', OR 'E'
035800200529     C           DD1ACT    IFNE *BLANKS                    B003
035900200529     C*
036000200529     C           DD1ACT    IFNE 'I'                        B004
036100200529     C           DD1ACT    ANDNE'A'
036200200529     C           DD1ACT    ANDNE'E'
036300200529     C*
036400200529     C                     MOVE '1'       *IN61
036500200529     C                     MOVEA'11'      *IN,70
036600200529     C                     MOVEL'SEM1031' ZAMSID
036700200529     C                     EXSR ZASNMS
036800200529      *                                                                                     AR397187
036900200529      **  Check if User is authorised to the Action Code entered.                           AR397187
037000200529      *                                                                                     AR397187
037100200529     C                     ELSE                                                             AR397187
037200200529     C**********           CALL 'ZVACTU'                                          AR397187 AR397187A
037300200529     C**********           PARM DD1ACT    @ZACTN  1                               AR397187 AR397187A
037400200529     C**********           PARM           @ERR    10                              AR397187 AR397187A
037500200529      *                                                                                     AR397187
037600200529     C********** @ERR      IFNE *ZERO                                             AR397187 AR397187A
037700200529     C**********           MOVE '1'       *IN61                                   AR397187 AR397187A
037800200529     C**********           MOVEA'11'      *IN,70                                  AR397187 AR397187A
037900200529     C**********           MOVEL'SEM1019' ZAMSID                                  AR397187 AR397187A
038000200529     C**********           EXSR ZASNMS                                            AR397187 AR397187A
038100200529     C**********           ENDIF                                                  AR397187 AR397187A
038200200529      *                                                                                    AR397187A
038300200529     C                     MOVE DD1ACT    ACTCDE  1                                        AR397187A
038400200529     C                     EXSR SRVACT                                                     AR397187A
038500200529     C                     END                             E004
038600200529     C*
038700200529     C                     END                             E003
038800200529     C*
038900200529     C**   ACTION IS BLANK
039000200529     C**   SECURITY MUST ALSO BE BLANK
039100200529     C           DD1ACT    IFEQ *BLANKS                    B003
039200200529     C*
039300200529     C           DD1SSN    IFNE *BLANKS                    B004
039400200529     C                     MOVE '1'       *IN61
039500200529     C                     MOVEA'11'      *IN,70
039600200529     C                     MOVEL'SEM1025' ZAMSID
039700200529     C                     EXSR ZASNMS
039800200529     C                     END                             E004
039900200529     C*
040000200529     C                     ELSE                            X003
040100200529     C*
040200200529     C**   ACTION IS NOT BLANK
040300200529     C**   SECURITY MUST BE ENTERED
040400200529     C*
040500200529     C           DD1ACT    IFEQ 'I'                        B004
040600200529     C           DD1ACT    OREQ 'A'
040700200529     C           DD1ACT    OREQ 'E'
040800200529     C*
040900200529     C           DD1SSN    IFEQ *BLANKS                    B005
041000200529     C                     MOVE '1'       *IN62
041100200529     C                     MOVEA'11'      *IN,70
041200200529     C                     MOVEL'SEM1024' ZAMSID
041300200529     C                     EXSR ZASNMS
041400200529     C                     END                             E005
041500200529     C*
041600200529     C                     END                             E004
041700200529     C*
041800200529     C                     END                             E003
041900200529     C*
042000200529     C                     END                             E002
042100200529     C*
042200200529     C                     END                             E001
042300200529     C*
042400200529     C**   ACTION AND SECURITY ARE NOT BLANK
042500200529     C*
042600200529     C           DD1ACT    IFNE *BLANKS                    B001
042700200529     C           DD1SSN    ANDNE*BLANKS
042800200529     C           *IN71     ANDEQ'0'
042900200529     C*
043000200529     C**   VALID ACTION CODE ENTERED
043100200529     C*
043200200529     C           DD1ACT    IFEQ 'I'                        B002
043300200529     C*
043400200529     C** ACCESS SECURITIES FILE
043500200529     C*
043600200529     C           DD1SSN    CHAINSECTY                52
043700200529     C           *IN52     IFEQ '1'
043800200529     C           RECI      ORNE 'D'
043900200529     C                     MOVE '1'       *IN62
044000200529     C                     MOVEA'11'      *IN,70
044100200529     C                     MOVEL'SEM1023' ZAMSID
044200200529     C                     EXSR ZASNMS
044300200529     C                     ELSE
044400200529     C                     MOVE SESN      DD1SSN
044500200529     C                     END
044600200529     C*
044700200529     C*
044800200529     C                     MOVE DD1SSN    WWKSSN 10
044900200529     C********** WWKSSN    CHAINSESWHTL0             51                                     MD027346
045000200529     C           WWKSSN    CHAINSESWHTDX             5153                                   MD027346
045100200529      *                                                                                     MD027346
045200200529      ** If chain not done due to record being updated by another                           MD027346
045300200529      ** workstation send message to screen.                                                MD027346
045400200529      *                                                                                     MD027346
045500200529     C           *IN53     IFEQ '1'                                                         MD027346
045600200529     C                     MOVE '1'       *IN99                                             MD027346
045700200529     C                     MOVEA'11'      *IN,70                                            MD027346
045800200529     C                     MOVEL'MMM1067' ZAMSID                                            MD027346
045900200529     C                     MOVEL'DRSMM   'ZAMSGF                                            MD027346
046000200529     C                     EXSR ZASNMS                                                      MD027346
046100200529     C                     ENDIF                                                            MD027346
046200200529     C*
046300200529     C           *IN51     IFEQ '0'                        B003
046400200529     C**   ACTION CODE = 'I', RECORD EXISTS  IE. RE-INSERTION ATTEMPTED
046500200529     C*
046600200529     C**   LIVE RECORD AND THEREFORE CANNOT BE RE-INSERTED
046700200529     C                     MOVE '1'       *IN61
046800200529     C                     MOVEA'11'      *IN,70
046900200529     C                     MOVEL'SEM1029' ZAMSID
047000200529     C                     EXSR ZASNMS
047100200529     C*
047200200529     C                     ELSE                            X003
047300200529     C*
047400200529     C           *IN71     IFEQ '0'                        B004
047500200529     C                     MOVEL*BLANKS   DD2CTA
047600200529     C                     MOVEL*BLANKS   DD2TAD
047700200529     C                     MOVEL*BLANKS   DD2TAU
047800200529     C                     MOVE *BLANKS   DD2RAS
047900200529     C***********          MOVE '0.00'    DD2RAS                          S01496
048000200529     C***********          MOVE '0.0000'  DD2RAS                    S01496084256
048100200529     C                     MOVE 'IA'      WWFMT
048200200529     C                     END                             E004
048300200529     C*
048400200529     C                     END                             E003
048500200529     C*
048600200529     C                     ELSE                            X002
048700200529     C*    ACTION CODE = 'A' OR 'E'
048800200529     C*
048900200529     C*
049000200529     C           DD1SSN    CHAINSECTY                52
049100200529     C           *IN52     IFEQ '1'
049200200529     C           RECI      ORNE 'D'
049300200529     C                     MOVE '1'       *IN62
049400200529     C                     MOVEA'11'      *IN,70
049500200529     C                     MOVEL'SEM1023' ZAMSID
049600200529     C                     EXSR ZASNMS
049700200529     C                     ELSE
049800200529     C                     MOVE SESN      DD1SSN
049900200529     C                     END
050000200529     C*
050100200529     C*
050200200529     C                     MOVE DD1SSN    WWKSSN
050300200529     C*
050400200529     C********** WWKSSN    CHAINSESWHTL0             51                                     MD027346
050500200529     C           WWKSSN    CHAINSESWHTDX             5153                                   MD027346
050600200529      *                                                                                     MD027346
050700200529      ** If chain not done due to record being updated by another                           MD027346
050800200529      ** workstation send message to screen.                                                MD027346
050900200529      *                                                                                     MD027346
051000200529     C           *IN53     IFEQ '1'                                                         MD027346
051100200529     C                     MOVE '1'       *IN99                                             MD027346
051200200529     C                     MOVEA'11'      *IN,70                                            MD027346
051300200529     C                     MOVEL'MMM1067' ZAMSID                                            MD027346
051400200529     C                     MOVEL'DRSMM   'ZAMSGF                                            MD027346
051500200529     C                     EXSR ZASNMS                                                      MD027346
051600200529     C                     ENDIF                                                            MD027346
051700200529     C*
051800200529     C           *IN51     IFEQ '1'                        B003
051900200529     C**     ACTION CODE 'A' OR 'E' - RECORD NOT ON FILE
052000200529     C                     MOVE '1'       *IN41
052100200529     C                     MOVE '1'       *IN62
052200200529     C                     MOVEA'11'      *IN,70
052300200529     C                     MOVEL'SEM1008' ZAMSID
052400200529     C                     EXSR ZASNMS
052500200529     C*
052600200529     C                     ELSE                            X003
052700200529     C**     ACTION CODE 'A' OR 'E' - RECORD EXISTS ON FILE
052800200529     C*
052900200529     C           S1RASO    IFNE *ZEROS
053000200529     C                     MOVE *BLANKS   ZFLD15
053100200529     C                     MOVE S1RASO    ZFLD15
053200200529     C                     EXSR ZSEDIT
053300200529     C                     MOVE ZOUT21    WWFL21
053400200529     C           S01496    IFEQ 'Y'                                       084256
053500200529     C                     MOVE WW20CH    DD2RAS
053600200529     C                     ELSE                                           084256
053700200529     C                     MOVE WW18CH    DD2RAS                          084256
053800200529     C                     END                                            084256
053900200529     C                     ELSE
054000200529     C                     MOVE *BLANKS   DD2RAS
054100200529     C***********          MOVE '0.00'    DD2RAS                          S01496
054200200529     C***********          MOVE '0.0000'  DD2RAS                    S01496084256
054300200529     C                     END
054400200529     C                     MOVELS1TABD    DD2TAD
054500200529     C                     MOVELS1TABU    DD2TAU
054600200529     C                     MOVELS1CTTA    DD2CTA
054700200529     C*
054800200529     C**   IF ACTION EQUALS 'A', SET FORMAT FLAG TO 'IA'
054900200529     C**   IF ACTION EQUALS 'E', SET FORMAT FLAG TO 'EN'
055000200529     C           DD1ACT    IFEQ 'A'                        B004
055100200529     C                     MOVEL'IA'      WWFMT
055200200529     C                     ELSE                            X004
055300200529     C*
055400200529     C           DD1ACT    IFEQ 'E'                        B005
055500200529     C                     MOVEL'EN'      WWFMT
055600200529     C*
055700200529     C                     END                             E005
055800200529     C*
055900200529     C                     END                             E004
056000200529     C*
056100200529     C                     END                             E003
056200200529     C*
056300200529     C                     END                             E002
056400200529     C*
056500200529     C                     END                             E001
056600200529     C*
056700200529     C                     ENDSR
056800200529     C********************************************************************
056900200529     C/EJECT
057000200529     C********************************************************************
057100200529     C**                                                                 *
057200200529     C** #BB       - THIS SUBROUTINE DOES SUBFILE PROCESSING             *
057300200529     C**                                                                 *
057400200529     C** CALLS     - #BBA, #ZB, #ZC                                      *
057500200529     C**                                                                 *
057600200529     C** CALLED BY - #B                                                  *
057700200529     C**                                                                 *
057800200529     C********************************************************************
057900200529     C           #BB       BEGSR
058000200529     C*
058100200529     C** CLEAR SCREEN MESSAGE QUEUE
058200200529     C                     CALL 'Y2CLMSC'
058300200529     C                     PARM           WWTPGQ 10
058400200529     C                     PARM           WWPGQR  5
058500200529     C*
058600200529     C                     EXSR #ZB
058700200529     C*
058800200529     C           *INKC     DOWEQ'0'
058900200529     C           *INKL     ANDEQ'0'
059000200529     C*
059100200529     C                     WRITESE1960C5
059200200529     C                     WRITESE1960F6
059300200529     C*
059400200529     C           *IN70     IFEQ '1'
059500200529     C                     WRITESE1960C7
059600200529     C                     END
059700200529     C*
059800200529     C                     READ SE1960C5                 59
059900200529     C*
060000200529     C           *INKC     IFEQ '0'
060100200529     C*
060200200529     C           *IN27     CASEQ'1'       #ZB
060300200529     C           *IN32     CASEQ'1'       #ZB
060400200529     C           *INKL     CASEQ'1'       #ZC
060500200529     C                     CAS            #BBA
060600200529     C                     END
060700200529     C*
060800200529     C                     END
060900200529     C*
061000200529     C                     END
061100200529     C*
061200200529     C                     ENDSR
061300200529     C********************************************************************
061400200529     C/EJECT
061500200529     C********************************************************************
061600200529     C**                                                                 *
061700200529     C** #BBA      - THIS SUBROUTINE PPROCESSES ANY ENTRY FROM SUBFILE   *
061800200529     C**                                                                 *
061900200529     C** CALLS     - #BBAA, #ZB, #ZC, ZASNMS                             *
062000200529     C**                                                                 *
062100200529     C** CALLED BY - #BB                                                 *
062200200529     C**                                                                 *
062300200529     C********************************************************************
062400200529     C           #BBA      BEGSR
062500200529     C*
062600200529     C**   CLEAR SCREEN MESSAGE QUEUE
062700200529     C                     CALL 'Y2CLMSC'
062800200529     C                     PARM           WWTPGQ
062900200529     C                     PARM           WWPGQR
063000200529     C*
063100200529     C**   SET OF INDICATORS
063200200529     C                     MOVEA'00'      *IN,70
063300200529     C*
063400200529     C**   IF BLANK SUBFILE DISPLAYED - ASSUME REVIEW FROM REQUIRED
063500200529     C           *IN28     IFEQ '0'
063600200529     C*
063700200529     C                     MOVE '1'       *IN59
063800200529     C*
063900200529     C                     ELSE
064000200529     C*
064100200529     C**   ELSE IDENTIFY WHETHER 'REVIEW FROM' OR SELECTION REQUIRED
064200200529     C                     READCSE1960S5                 59
064300200529     C*
064400200529     C                     END
064500200529     C*
064600200529     C**   NO RECORDS CHANGED => 'REVIEW FROM' REQUIRED
064700200529     C           *IN59     IFEQ '1'
064800200529     C*
064900200529     C                     EXSR #ZB
065000200529     C*
065100200529     C                     ELSE
065200200529     C*
065300200529     C**   VALIDATE SELECTION
065400200529     C                     EXSR #BBAA
065500200529     C*
065600200529     C**   IF VALID
065700200529     C           *IN71     IFEQ '0'
065800200529     C*
065900200529     C**   LOAD NECESSARY SCREEN
066000200529     C                     MOVE '1'       *IN71
066100200529     C                     EXSR #ZA
066200200529     C*
066300200529     C**   CHAIN TO SUBFILE TO GET FIRST CUSTOMER NUMBER/START DATE
066400200529     C           1         CHAINSE1960S5             59
066500200529     C                     MOVELDD2SSN    DD1RVF
066600200529     C*
066700200529     C**   REBUILD SUBFILE
066800200529     C                     EXSR #ZB
066900200529     C*
067000200529     C                     ELSE
067100200529     C*
067200200529     C**   SAVE RRN OF CHANGED SUBFILE RECORD
067300200529     C*
067400200529     C                     Z-ADDDDRRN     WWSRRN  40
067500200529     C                     MOVE DD2SEL    WWSSEL  1
067600200529     C*
067700200529     C**   REMOVE REVERSE IMAGE FROM SUBFILE
067800200529     C                     Z-ADD0         WWCNTR  40
067900200529     C*
068000200529     C           WWCNTR    DOWLTWWLRRN
068100200529     C*
068200200529     C                     ADD  1         WWCNTR
068300200529     C*
068400200529     C           WWCNTR    CHAINSE1960S5             59
068500200529     C                     MOVE *BLANKS   DD2SEL
068600200529     C                     MOVE '0'       *IN69
068700200529     C*
068800200529     C                     UPDATSE1960S5
068900200529     C*
069000200529     C                     END
069100200529     C*
069200200529     C                     MOVE '1'       *IN69
069300200529     C                     MOVEA'11'      *IN,70
069400200529     C                     MOVELWWMSGD    ZAMSID
069500200529     C                     EXSR ZASNMS
069600200529     C           WWSRRN    CHAINSE1960S5             59
069700200529     C                     MOVE WWSSEL    DD2SEL
069800200529     C                     UPDATSE1960S5
069900200529     C*
070000200529     C                     END
070100200529     C*
070200200529     C                     END
070300200529     C*
070400200529     C                     ENDSR
070500200529     C********************************************************************
070600200529     C/EJECT
070700200529     C********************************************************************
070800200529     C**                                                                 *
070900200529     C** #ZA       - THIS SUBROUTINE PROCESSES FILE MAINTENANCE SCREENS  *
071000200529     C**                                                                 *
071100200529     C** CALLS     - #BCA, #BCB, #ZC                                     *
071200200529     C**                                                                 *
071300200529     C** CALLED BY - #B, #BBA                                            *
071400200529     C**                                                                 *
071500200529     C********************************************************************
071600200529     C           #ZA       BEGSR
071700200529     C*
071800200529     C           *INKC     DOWEQ'0'                        B1
071900200529     C           *INKL     ANDEQ'0'
072000200529     C           *IN71     ANDEQ'1'
072100200529     C*
072200200529     C           WWFMT     IFEQ 'IA'                       B*2
072300200529     C*
072400200529     C                     WRITESE1960F2
072500200529     C           DD1ACT    IFEQ 'A'                        B**3
072600200529     C                     WRITESE1960F8
072700200529     C           DD1ACT    IFEQ 'I'                        B***4
072800200529     C                     WRITESE1960F7
072900200529     C                     END                             E***4
073000200529     C                     END                             E**3
073100200529     C                     ELSE                            X*2
073200200529     C*
073300200529     C           WWFMT     IFEQ 'EN'                       B**3
073400200529     C                     WRITESE1960F3
073500200529     C                     END                             E**3
073600200529     C*
073700200529     C                     END                             E*2
073800200529     C*
073900200529     C**  IF ERROR AND NOT HELP, WRITE MESSAGE SUBFILE
074000200529     C           *IN70     IFEQ '1'                        B*2
074100200529     C                     WRITESE1960C7
074200200529     C                     END                             E*2
074300200529     C*
074400200529     C**  READ SCREEN
074500200529     C           WWFMT     IFEQ 'IA'                       B*2
074600200529     C                     READ SE1960F2                 59
074700200529     C                     ELSE                            X*2
074800200529     C*
074900200529     C           WWFMT     IFEQ 'EN'                       B**3
075000200529     C                     READ SE1960F3                 59
075100200529     C                     END                             E**3
075200200529     C*
075300200529     C                     END                             E*2
075400200529     C*
075500200529     C** IF NOT END REQUESTED
075600200529     C           *INKC     IFEQ '0'                        B*2
075700200529     C*
075800200529     C           *INKJ     CASEQ'1'       #ZAA             B**3
075900200529     C           *INKL     CASEQ'1'       #ZC
076000200529     C                     CAS            #ZAB
076100200529     C                     END                             E**3
076200200529     C*
076300200529     C                     END                             E*2
076400200529     C*
076500200529     C           *INKC     IFEQ '0'                        B*2
076600200529     C           *INKL     ANDEQ'0'
076700200529     C           *IN71     ANDEQ'0'
076800200529     C*
076900200529     C           DD1ACT    IFEQ 'I'                        B**3
077000200529     C           DD1ACT    OREQ 'A'
077100200529     C*
077200200529     C                     EXSR #ZAA
077300200529     C*
077400200529     C                     END                             E**3
077500200529     C*
077600200529     C                     END                             E*2
077700200529     C*
077800200529     C                     END                             E1
077900200529     C*
078000200529     C                     ENDSR
078100200529     C********************************************************************
078200200529     C/EJECT
078300200529     C********************************************************************
078400200529     C**                                                                 *
078500200529     C** #ZC       - THIS SUBROUTINE PERFORMS CMD12 PROCESSING           *
078600200529     C**                                                                 *
078700200529     C** CALLS     - NONE                                                *
078800200529     C**                                                                 *
078900200529     C** CALLED BY - #BB, #ZA                                            *
079000200529     C**                                                                 *
079100200529     C********************************************************************
079200200529     C           #ZC       BEGSR
079300200529     C*
079400200529     C** CLEAR S$REEN MESSAGE QUEUE
079500200529     C                     CALL 'Y2CLMSC'
079600200529     C                     PARM           WWTPGQ 10
079700200529     C                     PARM           WWPGQR  5
079800200529     C*
079900200529     C** CLEAR SCREEN ERROR INDICATORS
080000200529     C                     MOVEA'000'     *IN,41
080100200529     C                     MOVEA'00000000'*IN,60
080200200529     C                     MOVEA'000'     *IN,69
080300200529     C*
080400200529     C                     MOVEL*BLANKS   DD1ACT
080500200529     C                     MOVEL*BLANKS   DD1SSN
080600200529     C                     MOVEL*BLANKS   DD1RVF
080700200529     C                     MOVEL*BLANKS   DD2CTA
080800200529     C                     MOVEL*BLANKS   DD2TAD
080900200529     C                     MOVEL*BLANKS   DD2TAU
081000200529     C                     MOVEL*BLANKS   DD2RAS
081100200529     C***********          MOVE '0.00'    DD2RAS                          S01496
081200200529     C***********          MOVE '0.0000'  DD2RAS                    S01496084256
081300200529     C*
081400200529     C                     ENDSR
081500200529     C********************************************************************
081600200529     C/EJECT
081700200529     C********************************************************************
081800200529     C**                                                                 *
081900200529     C** #ZABA     - THIS SUBROUTINE VALIDATES & FORMATS THE RATES ON    *
082000200529     C**             MAINTENANCE SCREENS                                 *
082100200529     C**                                                                 *
082200200529     C** CALLS     - ZALIGN, ZSEDIT                                      *
082300200529     C**                                                                 *
082400200529     C** CALLED BY - #ZAB                                                *
082500200529     C**                                                                 *
082600200529     C********************************************************************
082700200529     C           #ZABA     BEGSR
082800200529     C*
082900200529     C                     MOVE 'Y'       WWVALD  1
083000200529     C                     MOVE *BLANKS   ZFIELD
083100200529     C                     MOVE WWFLIN    ZFIELD
083200200529     C                     EXSR ZALIGN
083300200529     C           *IN99     IFEQ '1'
083400200529     C                     MOVE 'N'       WWVALD
083500200529     C                     ELSE
083600200529     C                     MOVE ZFIELD    WW1500 150
083700200529     C           WW1500    IFNE 0
083800200529     C***********WW1500    DIV  100       WW1502 152                      S01496
083900200529     C           S01496    IFEQ 'Y'                                       084256
084000200529     C           WW1500    DIV  10000     WW1504 154                      S01496
084100200529     C                     ELSE                                           084256
084200200529     C           WW1500    DIV  100       WW1502 152                      084256
084300200529     C                     END                                            084256
084400200529     C                     ELSE
084500200529     C***********          Z-ADD0         WW1502                          S01496
084600200529     C                     Z-ADD0         WW1504                          S01496
084700200529     C                     Z-ADD0         WW1502                          084256
084800200529     C                     END
084900200529     C***********WW1502    IFLT 0                                         S01496
085000200529     C***********WW1502    ORGT 100                                       S01496
085100200529     C           S01496    IFEQ 'Y'                                       084256
085200200529     C           WW1504    IFLT 0                                         S01496
085300200529     C           WW1504    ORGT 100                                       S01496
085400200529     C                     MOVE 'N'       WWVALD
085500200529     C                     END
085600200529     C                     ELSE                                           084256
085700200529     C           WW1502    IFLT 0                                         084256
085800200529     C           WW1502    ORGT 100                                       084256
085900200529     C                     MOVE 'N'       WWVALD                          084256
086000200529     C                     END                                            084256
086100200529     C                     END                                            084256
086200200529     C                     END
086300200529     C*
086400200529     C           WWVALD    IFEQ 'N'
086500200529     C                     MOVEA'1'       *IN,XX
086600200529     C                     MOVEA'11'      *IN,70
086700200529     C                     EXSR ZASNMS
086800200529     C                     ELSE
086900200529     C                     MOVE *BLANKS   ZFLD15
087000200529     C                     MOVE ZFIELD    ZFLD15
087100200529     C           S01496    IFNE 'Y'                                       084256
087200200529     C                     Z-ADD2         ZDECS                           084256
087300200529     C                     END                                            084256
087400200529     C                     EXSR ZSEDIT
087500200529     C           S01496    IFNE 'Y'                                       084256
087600200529     C                     Z-ADD4         ZDECS                           084256
087700200529     C                     END                                            084256
087800200529     C                     MOVE ZOUT21    WWFL21
087900200529     C                     END
088000200529     C*
088100200529     C                     ENDSR
088200200529     C********************************************************************
088300200529     C/EJECT
088400200529     C********************************************************************
088500200529     C**                                                                 *
088600200529     C** #ZAB      - THIS SUBROUTINE PERFORMS VALIDATION OF FILE         *
088700200529     C**             MAINTENANCE SCREENS                                 *
088800200529     C**                                                                 *
088900200529     C** CALLS     - ZASNMS                                              *
089000200529     C**                                                                 *
089100200529     C** CALLED BY - #ZA                                                 *
089200200529     C**                                                                 *
089300200529     C********************************************************************
089400200529     C           #ZAB      BEGSR
089500200529     C*
089600200529     C**   CLEAR SCREEN MESSAGE QUEUE
089700200529     C                     CALL 'Y2CLMSC'
089800200529     C                     PARM           WWTPGQ
089900200529     C                     PARM           WWPGQR
090000200529     C*
090100200529     C**   SET OF INDICATORS
090200200529     C                     MOVE '0'       *IN,59
090300200529     C                     MOVEA'000'     *IN,63
090400200529     C                     MOVEA'00'      *IN,70
090500200529     C                     MOVEA'000'     *IN,41
090600200529     C*
090700200529     C**   COUNTRY OF TAX IS THE ONLY MANDATORY FIELD. THE OTHER FIELDS
090800200529     C**   MUST BE VALID RATES IF ENTERED.
090900200529     C*
091000200529     C           DD1ACT    IFEQ 'I'                        B1
091100200529     C           DD1ACT    OREQ 'A'
091200200529     C*
091300200529     C*
091400200529     C** COUNTRY OF TAX MUST BE A VALID COUNTRY CODE FOUND ON THE
091500200529     C** COUNTRY CODES TABLE
091600200529     C*
091700200529     C           DD2CTA    IFEQ *BLANKS                    B*2
091800200529     C                     MOVE '1'       *IN63
091900200529     C                     MOVEA'11'      *IN,70
092000200529     C                     MOVEL'SEM1016' ZAMSID
092100200529     C                     EXSR ZASNMS
092200200529     C                     ELSE                            X*2
092300200529     C*
092400200529     C** CHECK COUNTRY CODE IS VALID
092500200529     C*
092600200529     C                     CALL 'AOCTRYR0'
092700200529     C                     PARM *BLANKS   @RTCD   7
092800200529     C                     PARM '*KEY   ' @OPTN   7
092900200529     C                     PARM DD2CTA    @CNCD   2
093000200529     C           SDCTRY    PARM SDCTRY    DSFDY
093100200529     C*
093200200529     C           @RTCD     IFNE *BLANKS                    B**3
093300200529     C                     MOVE '1'       *IN63
093400200529     C                     MOVEA'11'      *IN,70
093500200529     C                     MOVEL'SEM1007' ZAMSID
093600200529     C                     EXSR ZASNMS
093700200529     C                     ELSE
093800200529     C                     MOVE A4CNCD    DD2CTA
093900200529     C                     END                             E**3
094000200529     C                     END                             E*2
094100200529     C*
094200200529     C** TAX BAND FOR TAX DEDUCTED AT SOURCE MUST BE BETWEEN 0 AND 5
094300200529     C*
094400200529     C                     MOVEL*BLANKS   NUMTAD  10
094500200529     C*
094600200529     C           DD2TAD    IFNE *BLANKS                    B*2
094700200529     C                     MOVELDD2TAD    NUMTAD
094800200529     C           NUMTAD    IFGT 5                          B**3
094900200529     C           NUMTAD    ORLT 0
095000200529     C                     MOVE '1'       *IN41
095100200529     C                     MOVEA'11'      *IN,70
095200200529     C                     MOVEL'SEM1028' ZAMSID
095300200529     C                     EXSR ZASNMS
095400200529     C*
095500200529     C** IF TAX BAND IS BETWEEN 1 AND 5 THEN A VALID RECORD MUST
095600200529     C** EXIST ON THE COUNTRY TAX RATES FILE
095700200529     C*
095800200529     C                     ELSE                            X**3
095900200529     C*
096000200529     C           NUMTAD    IFGT 0                          B***4
096100200529     C                     CALL 'AOSCTXR0'
096200200529     C                     PARM *BLANKS   @RTCD
096300200529     C                     PARM '*KEY   ' @OPTN
096400200529     C                     PARM DD2CTA    @CTTA   2
096500200529     C                     PARM NUMTAD    @TABD   10
096600200529     C           SECNTR    PARM SECNTR    DSFDY
096700200529     C*
096800200529     C           @RTCD     IFNE *BLANKS                    B**3
096900200529     C                     MOVE '1'       *IN63
097000200529     C                     MOVEA'11'      *IN,70
097100200529     C                     MOVEL'SEM1026' ZAMSID
097200200529     C                     EXSR ZASNMS
097300200529     C                     END                             E**3
097400200529     C*
097500200529     C                     END                             E***4
097600200529     C                     END                             E**3
097700200529     C                     END                             E*2
097800200529     C*
097900200529     C** TAX BAND FOR TAX DEDUCTED BY USER MUST BE BETWEEN 0 AND 5
098000200529     C*
098100200529     C                     MOVEL*BLANKS   NUMTAU  10
098200200529     C           DD2TAU    IFNE *BLANKS                    B*2
098300200529     C                     MOVELDD2TAU    NUMTAU
098400200529     C           NUMTAU    IFGT 5                          B**3
098500200529     C           NUMTAU    ORLT 0
098600200529     C                     MOVE '1'       *IN42
098700200529     C                     MOVEA'11'      *IN,70
098800200529     C                     MOVEL'SEM1028' ZAMSID
098900200529     C                     EXSR ZASNMS
099000200529     C                     END                             E**3
099100200529     C                     END                             E*2
099200200529     C*
099300200529     C** RATE OF TAX DEDUCTED AT SOURCE MUST BE IN 5,2 FORMAT
099400200529     C*
099500200529     C***********DD2RAS    IFEQ '0.00'                     B*2            S01496
099600200529     C           DD2RAS    IFEQ '0.0000'                   B*2            S01496
099700200529     C***********          MOVE *BLANK    WWRASO  52                      S01496
099800200529     C                     MOVE *BLANK    WWRASO  74                      S01496
099900200529     C                     ELSE                            X*2
100000200529     C***********          MOVE DD2RAS    WWFLIN  6                       S01496
100100200529     C                     MOVE DD2RAS    WWFLIN  8                       S01496
100200200529     C                     Z-ADD43        XX      20
100300200529     C           S01496    IFEQ 'Y'                                       084256
100400200529     C                     MOVE 'SEM1057' ZAMSID                          084256
100500200529     C                     ELSE                                           084256
100600200529     C                     MOVE 'SEM1012' ZAMSID
100700200529     C                     END                                            084256
100800200529     C                     EXSR #ZABA
100900200529     C           WWVALD    IFEQ 'Y'                        B**3
101000200529     C***********          Z-ADDWW1502    WWRASO                          S01496
101100200529     C           S01496    IFEQ 'Y'                                       084256
101200200529     C                     Z-ADDWW1504    WWRASO                          S01496
101300200529     C                     ELSE                                           084256
101400200529     C                     Z-ADDWW1502    WWRASO                          084256
101500200529     C                     END                                            084256
101600200529     C                     MOVE WW20CH    DD2RAS
101700200529     C                     END                             E**3
101800200529     C                     END                             E*2
101900200529     C*
102000200529     C** IF TAX BAND FOR TAX DEDUCTED AT SOURCE IS NOT BLANK
102100200529     C** THEN RATE OF TAX DEDUCTED AT SOURCE MUST NOT BE ENTERED
102200200529     C*
102300200529     C           NUMTAD    IFGE 1                          B*2
102400200529     C           NUMTAD    ANDLE5
102500200529     C*
102600200529     C           WWRASO    IFNE 0                          B**3
102700200529     C                     MOVE '1'       *IN43
102800200529     C                     MOVEA'11'      *IN,70
102900200529     C                     MOVEL'SEM1027' ZAMSID
103000200529     C                     EXSR ZASNMS
103100200529     C                     ELSE                            X**3
103200200529     C                     MOVE *BLANK    WWRASO
103300200529     C                     END                             E**3
103400200529     C                     END                             E*2
103500200529     C*
103600200529     C                     END                             E1
103700200529     C*
103800200529     C                     ENDSR
103900200529     C********************************************************************
104000200529     C/EJECT
104100200529     C********************************************************************
104200200529     C**                                                                 *
104300200529     C** #A         - THIS SUBROUTINE PERFORMS INITIALISATION            *
104400200529     C**                                                                 *
104500200529     C**  CALLS     - NONE                                               *
104600200529     C**                                                                 *
104700200529     C**  CALLED BY - MAINLINE                                           *
104800200529     C**                                                                 *
104900200529     C********************************************************************
105000200529     C           #A        BEGSR
105100200529     C*
105200200529     C*
105300200529     C**   INITIALISE DB ERROR FIELDS ETC, AND STORE PROGRAM NAME FOR
105400200529     C**   DB ERROR FIELD.
105500200529     C           *NAMVAR   DEFN           LDA
105600200529     C           *LOCK     IN   LDA
105700200529     C                     MOVE *BLANKS   DBFILE
105800200529     C                     MOVE *BLANKS   DBKEY
105900200529     C                     MOVE *BLANKS   DBASE
106000200529     C                     MOVEL'SE1960'  DBPGM
106100200529     C                     OUT  LDA
106200200529     C*
106300200529     C                     Z-ADD*ZERO     WWDSTN  50
106400200529     C                     MOVE '1'       *IN26
106500200529     C                     MOVE *BLANKS   ZAMSGF
106600200529     C                     MOVEL'SEUSRMSG'ZAMSGF
106700200529     C*
106800200529     C** IN THE DATAAREA RUNDAT
106900200529     C*
107000200529     C           *NAMVAR   DEFN RUNDAT    RUNDT
107100200529     C           *NAMVAR   DEFN           ZMUSER
107200200529     C                     IN   RUNDT
107300200529     C                     IN   ZMUSER
107400200529     C*
107500200529     C**   CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.
107600200529     C*
107700200529     C           DATF      COMP 'M'                      98
107800200529     C*                                                                   084256
107900200529     C**  Access SAR details file to see if Private Banking Securities    084256
108000200529     C**  Trading Enhancements switchable feature is installed.           084256
108100200529     C*                                                                   084256
108200200529     C                     CALL 'AOSARDR0'                                084256
108300200529     C                     PARM *BLANKS   @RTCD                           084256
108400200529     C                     PARM '*VERIFY' @OPTN                           084256
108500200529     C                     PARM 'S01496'  @SARD   6                       084256
108600200529     C           SCSARD    PARM SCSARD    DSFDY                           084256
108700200529     C*                                                                   084256
108800200529     C           @RTCD     IFEQ *BLANK                                    084256
108900200529     C                     MOVE 'Y'       S01496  1                       084256
109000200529     C                     END                                            084256
109100200529     C*
109200200529     C***********          Z-ADD2         ZADEC                           S01496
109300200529     C***********          Z-ADD2         ZDECS                           S01496
109400200529     C*                                                                   S01408
109500200529     C/COPY WNCPYSRC,SE1960CCP1                                           S01408
109600200529     C*                                                                   S01408
109700200529     C           S01496    IFEQ 'Y'                                       084256
109800200529     C                     Z-ADD4         ZADEC                           S01496
109900200529     C                     ELSE                                           084256
110000200529     C                     Z-ADD2         ZADEC                           084256
110100200529     C                     END                                            084256
110200200529     C                     Z-ADD4         ZDECS                           S01496
110300200529     C                     Z-ADD3         ZADIG
110400200529     C                     MOVE 'J'       ZECODE
110500200529     C*
110600200529     C                     MOVE *BLANKS   WWTPGQ
110700200529     C                     MOVEL'*'       WWTPGQ
110800200529     C                     MOVE *BLANKS   WWPGQR
110900200529     C                     MOVEL'*PRV'    WWPGQR
111000200529     C*
111100200529     C                     MOVE '1'       *IN71
111200200529     C*
111300200529     C** INITIALISE SUBFILE
111400200529     C                     MOVE '1'       *IN30
111500200529     C                     WRITESE1960C5
111600200529     C                     MOVE '0'       *IN30
111700200529     C*
111800200529     C** INITIALISE SCREEN MESSAGE QUEUE
111900200529     C                     MOVEL'*'       DDPGMQ
112000200529     C*
112100200529     C                     OPEN SESWHTL0                                                    MD027346
112200200529     C                     ENDSR
112300200529     C********************************************************************
112400200529     C/EJECT
112500200529     C********************************************************************
112600200529     C**                                                                 *
112700200529     C** #ZB       - THIS SUBROUTINE LOADS A PAGE OF RECORDS TO SUBFILE  *
112800200529     C**                                                                 *
112900200529     C** CALLS     - NONE                                                *
113000200529     C**                                                                 *
113100200529     C** CALLED BY - #BB, #BBA                                           *
113200200529     C**                                                                 *
113300200529     C********************************************************************
113400200529     C           #ZB       BEGSR
113500200529     C*
113600200529     C                     Z-ADD*ZERO     WWLRRN  40
113700200529     C                     Z-ADD*ZERO     DDRRN
113800200529     C                     Z-ADD*ZERO     WWCNTR
113900200529     C                     MOVEL*BLANKS   DD2SEL
114000200529     C                     MOVEA'00'      *IN,28
114100200529     C                     MOVE '0'       *IN31
114200200529     C                     MOVE '0'       *IN61
114300200529     C                     MOVE '0'       *IN69
114400200529     C*
114500200529     C                     MOVE '1'       *IN30
114600200529     C                     WRITESE1960C5
114700200529     C                     MOVE '0'       *IN30
114800200529     C*
114900200529     C           *IN32     IFEQ '1'
115000200529     C           *LOVAL    SETLLSESWHTL0
115100200529     C                     ELSE
115200200529     C                     MOVE DD1RVF    WWKRVF 10
115300200529     C           WWKRVF    SETLLSESWHTL0
115400200529     C                     END
115500200529     C*
115600200529     C                     READ SESWHTL0                 51
115700200529     C*
115800200529     C**  LOOP LOADING SUB-FILE RECORDS TILL FULL OR THERE ARE NO MORE
115900200529     C**  TO LOAD
116000200529     C*
116100200529     C           *IN51     DOWEQ'0'
116200200529     C           WWCNTR    ANDLT13
116300200529     C*
116400200529     C**    CHECK FOR A LIVE SECURITY
116500200529     C*
116600200529     C           S1SESN    CHAINSECTY                52
116700200529     C*
116800200529     C**      IF NO SECURITY FOUND THEN THIS IS A DATABASE ERROR
116900200529     C*
117000200529     C           *IN52     IFEQ '1'
117100200529     C                     SETON                     U7U8LR
117200200529     C           *LOCK     IN   LDA
117300200529     C                     MOVEL'SECTY   'DBFILE           ************
117400200529     C                     MOVEL'001'     DBASE            * DBERR 01 *
117500200529     C                     MOVELS1SESN    DBKEY            ************
117600200529     C                     OUT  LDA
117700200529     C                     EXSR *PSSR
117800200529     C                     END
117900200529     C*
118000200529     C**    ONLY LOAD RECORDS FOR LIVE SECURITIES
118100200529     C*
118200200529     C           RECI      IFEQ 'D'
118300200529     C*
118400200529     C                     MOVELS1SESN    DD2SSN
118500200529     C                     MOVELS1CTTA    DD2CTA
118600200529     C*
118700200529     C           S1RASO    IFNE *ZEROS
118800200529     C                     MOVE *BLANKS   ZFLD15
118900200529     C                     MOVE S1RASO    ZFLD15
119000200529     C                     EXSR ZSEDIT
119100200529     C                     MOVE ZOUT21    WWFL21
119200200529     C           S01496    IFEQ 'Y'                                       084256
119300200529     C                     MOVE WW20CH    DD2RAS
119400200529     C                     ELSE                                           084256
119500200529     C                     MOVE WW18CH    DD2RAS                          084256
119600200529     C                     END                                            084256
119700200529     C*
119800200529     C                     ELSE
119900200529     C                     MOVE *BLANKS   DD2RAS
120000200529     C***********          MOVE '0.00'    DD2RAS                          S01496
120100200529     C***********          MOVE '0.0000'  DD2RAS                    S01496084256
120200200529     C                     END
120300200529     C*
120400200529     C                     MOVELS1TABD    DD2TAD
120500200529     C                     MOVELS1TABU    DD2TAU
120600200529     C*
120700200529     C                     ADD  1         WWCNTR  40
120800200529     C                     ADD  1         DDRRN
120900200529     C*
121000200529     C                     WRITESE1960S5
121100200529     C*
121200200529     C                     END
121300200529     C*
121400200529     C                     READ SESWHTL0                 51
121500200529     C*
121600200529     C                     END
121700200529     C*
121800200529     C**  IF NO RECORD WAS WRITTEN TO SUBFILE THEN INDICATE
121900200529     C*
122000200529     C           WWCNTR    IFLE *ZERO
122100200529     C           *IN51     ANDEQ'1'
122200200529     C                     MOVE '1'       *IN29
122300200529     C                     ELSE
122400200529     C                     MOVEA'11'      *IN,28
122500200529     C                     END
122600200529     C*
122700200529     C           *IN51     IFEQ '0'
122800200529     C                     MOVELS1SESN    DD1RVF
122900200529     C                     EXCPTSESWHT
123000200529     C                     ELSE
123100200529     C                     MOVE '1'       *IN31
123200200529     C                     MOVEL*BLANKS   DD1RVF
123300200529     C                     END
123400200529     C*
123500200529     C                     Z-ADDDDRRN     WWLRRN
123600200529     C*
123700200529     C                     ENDSR
123800200529     C********************************************************************
123900200529     C/EJECT
124000200529     C********************************************************************
124100200529     C**                                                                 *
124200200529     C** #ZAAA     - THIS SETS UP COMMITMENT TEXT                        *
124300200529     C**                                                                 *
124400200529     C** CALLS     - NONE                                                *
124500200529     C**                                                                 *
124600200529     C** CALLED BY - #ZAA                                                *
124700200529     C**                                                                 *
124800200529     C********************************************************************
124900200529     C           #ZAAA     BEGSR
125000200529     C*
125100200529     C**   SET UP COMMITMENT TEXT
125200200529     C                     MOVEL'SE'      MDID
125300200529     C                     MOVEL'SE1960'  PGMN
125400200529     C                     MOVELWSID      WSIDX
125500200529     C                     MOVELUSID      USIDX
125600200529     C                     MOVE *BLANKS   ACTNX
125700200529     C                     TIME           MTIME
125800200529     C*
125900200529     C           CMTTXT    COMIT
126000200529     C*
126100200529     C                     ENDSR
126200200529     C********************************************************************
126300200529     C/EJECT
126400200529     C********************************************************************
126500200529     C**                                                                 *
126600200529     C** #BBAA     - THIS SUBROUTINE VALIDATES SELECTION ON SUBFILE      *
126700200529     C**                                                                 *
126800200529     C** CALLS     - NONE                                                *
126900200529     C**                                                                 *
127000200529     C** CALLED BY - #BBA                                                *
127100200529     C**                                                                 *
127200200529     C********************************************************************
127300200529     C           #BBAA     BEGSR
127400200529     C*
127500200529     C                     MOVE 'N'       WWIOVR  1
127600200529     C*
127700200529     C           DD2SEL    IFNE 'I'
127800200529     C           DD2SEL    ANDNE'A'
127900200529     C           DD2SEL    ANDNE'E'
128000200529     C*
128100200529     C                     MOVEL'SEM1031' WWMSGD  7
128200200529     C                     MOVE '1'       *IN71
128300200529     C*
128400200529     C                     ELSE
128500200529     C*
128600200529     C           DD2SEL    IFEQ 'I'
128700200529     C*
128800200529     C                     MOVEL'SEM1029' WWMSGD
128900200529     C                     MOVE '1'       *IN71
129000200529     C*
129100200529     C                     ELSE                                                            AR397187A
129200200529      *                                                                                    AR397187A
129300200529      ** Check if user is authorise on the action code.                                    AR397187A
129400200529      *                                                                                    AR397187A
129500200529     C                     MOVE DD2SEL    ACTCDE                                           AR397187A
129600200529     C                     EXSR SRVACT                                                     AR397187A
129700200529     C                     END
129800200529     C*
129900200529     C                     END
130000200529     C*
130100200529     C**   IF VALID ENTRY
130200200529     C           *IN71     IFEQ '0'
130300200529     C*
130400200529     C                     MOVELDD2SEL    DD1ACT
130500200529     C                     MOVELDD2SSN    DD1SSN
130600200529     C*
130700200529     C**   IF SELECT EQUALS 'I' OR 'A', SET FORMAT FLAG TO 'IA'
130800200529     C**   IF SELECT EQUALS 'E', SET FORMAT FLAG TO 'EN'
130900200529     C           DD2SEL    IFEQ 'I'
131000200529     C                     MOVEL'IA'      WWFMT   2
131100200529     C                     MOVE *BLANKS   DD2RAS
131200200529     C***********          MOVE '0.00'    DD2RAS                          S01496
131300200529     C***********          MOVE '0.0000'  DD2RAS                    S01496084256
131400200529     C                     MOVE *BLANKS   DD2TAD
131500200529     C                     MOVE *BLANKS   DD2TAU
131600200529     C                     MOVE *BLANKS   DD2CTA
131700200529     C*
131800200529     C                     ELSE
131900200529     C*
132000200529     C           DD2SEL    IFEQ 'A'
132100200529     C                     MOVEL'IA'      WWFMT
132200200529     C                     ELSE
132300200529     C*
132400200529     C           DD2SEL    IFEQ 'E'
132500200529     C                     MOVEL'EN'      WWFMT
132600200529     C*
132700200529     C                     END
132800200529     C*
132900200529     C                     END
133000200529     C*
133100200529     C                     END
133200200529     C*
133300200529     C                     END
133400200529     C*
133500200529     C                     ENDSR
133600200529     C********************************************************************
133700200529     C/EJECT                                                                               AR397187A
133800200529      *****************************************************************                    AR397187A
133900200529      *                                                               *                    AR397187A
134000200529      *  SRVACT  - Validates user profile if authorise on the action  *                    AR397187A
134100200529      *            code entered.                                      *                    AR397187A
134200200529      *                                                               *                    AR397187A
134300200529      *  Called by: #BA                                               *                    AR397187A
134400200529      *             #BBAA                                             *                    AR397187A
134500200529      *                                                               *                    AR397187A
134600200529      *  Calls: ZVACTU - Validate Action Code using user/pgm          *                    AR397187A
134700200529      *         ZVACTBU - Validate Action Code using user/pgm/brch    *                    AR397187A
134800200529      *                                                               *                    AR397187A
134900200529      *****************************************************************                    AR397187A
135000200529      *                                                                                    AR397187A
135100200529     C           SRVACT    BEGSR                                                           AR397187A
135200200529      *                                                                                    AR397187A
135300200529      ** If single branch environment                                                      AR397187A
135400200529      *                                                                                    AR397187A
135500200529     C           MBIN      IFNE 'Y'                                                        AR397187A
135600200529     C                     CALL 'ZVACTU'                                                   AR397187A
135700200529     C                     PARM ACTCDE    @ZACTN  1                                        AR397187A
135800200529     C                     PARM           @ERR    10                                       AR397187A
135900200529      *                                                                                    AR397187A
136000200529     C           @ERR      IFNE *ZERO                                                      AR397187A
136100200529     C           WWSFL     IFEQ 'N'                                                        AR397187A
136200200529     C                     MOVE '1'       *IN61                                            AR397187A
136300200529     C                     MOVEA'11'      *IN,70                                           AR397187A
136400200529     C                     MOVEL'SEM1019' ZAMSID                                           AR397187A
136500200529     C                     EXSR ZASNMS                                                     AR397187A
136600200529     C                     ELSE                                                            AR397187A
136700200529     C                     MOVEL'SEM1019' WWMSGD                                           AR397187A
136800200529     C                     MOVE '1'       *IN71                                            AR397187A
136900200529     C                     ENDIF                                                           AR397187A
137000200529     C                     ENDIF                                                           AR397187A
137100200529      *                                                                                    AR397187A
137200200529     C                     ELSE                                                            AR397187A
137300200529      *                                                                                    AR397187A
137400200529      ** If multibranching environment                                                     AR397187A
137500200529      *                                                                                    AR397187A
137600200529     C                     CALL 'ZVACTBU'                                                  AR397187A
137700200529     C                     PARM ACTCDE    @ZACTN  1                                        AR397187A
137800200529     C                     PARM USRBCH    @ZBR    3                                        AR397187A
137900200529     C                     PARM           @ERR    10                                       AR397187A
138000200529      *                                                                                    AR397187A
138100200529     C           @ERR      IFEQ 2                                                          AR397187A
138200200529     C           WWSFL     IFEQ 'N'                                                        AR397187A
138300200529     C                     MOVE '1'       *IN61                                            AR397187A
138400200529     C                     MOVEA'11'      *IN,70                                           AR397187A
138500200529     C                     MOVEL'SEM1021' ZAMSID                                           AR397187A
138600200529     C                     EXSR ZASNMS                                                     AR397187A
138700200529     C                     ELSE                                                            AR397187A
138800200529     C                     MOVEL'SEM1021' WWMSGD                                           AR397187A
138900200529     C                     MOVE '1'       *IN71                                            AR397187A
139000200529     C                     ENDIF                                                           AR397187A
139100200529     C                     ENDIF                                                           AR397187A
139200200529      *                                                                                    AR397187A
139300200529     C           @ERR      IFEQ 1                                                          AR397187A
139400200529     C           WWSFL     IFEQ 'N'                                                        AR397187A
139500200529     C                     MOVE '1'       *IN61                                            AR397187A
139600200529     C                     MOVEA'11'      *IN,70                                           AR397187A
139700200529     C                     MOVEL'SEM1020' ZAMSID                                           AR397187A
139800200529     C                     EXSR ZASNMS                                                     AR397187A
139900200529     C                     ELSE                                                            AR397187A
140000200529     C                     MOVEL'SEM1020' WWMSGD                                           AR397187A
140100200529     C                     MOVE '1'       *IN71                                            AR397187A
140200200529     C                     ENDIF                                                           AR397187A
140300200529     C                     ENDIF                                                           AR397187A
140400200529      *                                                                                    AR397187A
140500200529     C                     ENDIF                                                           AR397187A
140600200529      *                                                                                    AR397187A
140700200529     C                     ENDSR                                                           AR397187A
140800200529      *****************************************************************                    AR397187A
140900200529     C/EJECT
141000200529     C********************************************************************
141100200529     C**                                                                 *
141200200529     C** #ZAA      - THIS SUBROUTINE DOES UPDATE PROCESSING              *
141300200529     C**                                                                 *
141400200529     C** CALLS     - #BCAA, ZASNMS, ZTNLU1, *PSSR                        *
141500200529     C**                                                                 *
141600200529     C** CALLED BY - #ZA                                                 *
141700200529     C**                                                                 *
141800200529     C********************************************************************
141900200529     C           #ZAA      BEGSR
142000200529     C*
142100200529     C                     MOVEA'00'      *IN,70
142200200529     C                     MOVE 'Y'       WWUPDT  1
142300200529     C                     MOVE 'N'       WWINST  1
142400200529     C                     MOVE 'N'       WWAMDT  1
142500200529     C                     MOVE 'N'       WWDELT  1
142600200529     C*
142700200529     C                     EXSR ZTNLU1
142800200529     C*
142900200529     C                     MOVE DD1SSN    WWKSSN
143000200529     C********** WWKSSN    CHAINSESWHTL0             51                                     MD027346
143100200529     C           WWKSSN    CHAINSESWHTDX             5153                                   MD027346
143200200529      *                                                                                     MD027346
143300200529      ** If chain not done due to record being updated by another                           MD027346
143400200529      ** workstation send message to screen.                                                MD027346
143500200529      *                                                                                     MD027346
143600200529     C           *IN53     IFEQ '1'                                                         MD027346
143700200529     C                     MOVE '1'       *IN99                                             MD027346
143800200529     C                     MOVEA'11'      *IN,70                                            MD027346
143900200529     C                     MOVEL'MMM1067' ZAMSID                                            MD027346
144000200529     C                     MOVEL'DRSMM   'ZAMSGF                                            MD027346
144100200529     C                     EXSR ZASNMS                                                      MD027346
144200200529     C                     ENDIF                                                            MD027346
144300200529     C*
144400200529     C           DD1ACT    IFEQ 'I'
144500200529     C           DD1ACT    OREQ 'A'
144600200529     C** RECORD NOT ON FILE
144700200529     C           *IN51     IFEQ '1'
144800200529     C*
144900200529     C           DD1ACT    IFEQ 'I'
145000200529     C*
145100200529     C                     MOVELDD1SSN    S1SESN
145200200529     C                     Z-ADDWWRASO    S1RASO
145300200529     C                     MOVELDD2CTA    S1CTTA
145400200529     C                     MOVELDD2TAD    S1TABD
145500200529     C                     MOVELDD2TAU    S1TABU
145600200529     C*
145700200529     C**********           WRITESESWHTD0               54                                   MD027346
145800200529     C                     WRITESESWHTDX               54                                   MD027346
145900200529     C*
146000200529     C**   IF DUPLICATE KEY ERROR
146100200529     C           *IN54     IFEQ '1'
146200200529     C*
146300200529     C           STATUS    IFEQ 01021
146400200529     C*
146500200529     C                     ROLBK
146600200529     C*
146700200529     C**   CLEAR MESSAGES CAUSED BY STATUS ERROR
146800200529     C                     CALL 'Y2CLMSC'
146900200529     C                     PARM           WWTPGQ
147000200529     C                     PARM           WWPGQR
147100200529     C                     GOTO #ZA0
147200200529     C                     ELSE
147300200529     C*
147400200529     C                     EXSR *PSSR
147500200529     C*
147600200529     C                     END
147700200529     C*
147800200529     C                     ELSE
147900200529     C*
148000200529     C                     EXSR #ZAAA
148100200529     C*
148200200529     C                     END
148300200529     C*
148400200529     C                     ELSE
148500200529     C*
148600200529     C                     GOTO #ZA0
148700200529     C                     END
148800200529     C** RECORD EXISTS ON FILE
148900200529     C                     ELSE
149000200529     C*
149100200529     C*
149200200529     C**   MOVE SCREEN FIELDS ETC TO FILE FIELDS AS NECESSARY
149300200529     C           DD1ACT    IFEQ 'A'
149400200529     C*
149500200529     C                     MOVELDD1SSN    S1SESN
149600200529     C                     Z-ADDWWRASO    S1RASO
149700200529     C                     MOVELDD2CTA    S1CTTA
149800200529     C                     MOVELDD2TAD    S1TABD
149900200529     C                     MOVELDD2TAU    S1TABU
150000200529     C*
150100200529     C**********           UPDATSESWHTD0                                                    MD027346
150200200529     C                     UPDATSESWHTDX                                                    MD027346
150300200529     C                     ELSE
150400200529     C*
150500200529     C                     END
150600200529     C*
150700200529     C                     EXSR #ZAAA
150800200529     C*
150900200529     C                     END
151000200529     C*
151100200529     C                     END
151200200529     C*
151300200529     C                     GOTO #ZA1
151400200529     C*
151500200529     C           #ZA0      TAG
151600200529     C                     MOVEA'11'      *IN,70
151700200529     C                     MOVEL'SEM1022' ZAMSID
151800200529     C                     EXSR ZASNMS
151900200529     C*
152000200529     C           #ZA1      ENDSR
152100200529     C********************************************************************
152200200529     C/EJECT
152300200529     C********************************************************************
152400200529     C**                                                                 *
152500200529     C** ZTNLU1    - RETRIEVE/UPDATE TRANS NO. OF LAST UPDATE            *
152600200529     C**                                                                 *
152700200529     C** CALLS     - NONE                                                *
152800200529     C**                                                                 *
152900200529     C** CALLED BY - #ZAA                                                *
153000200529     C**                                                                 *
153100200529     C********************************************************************
153200200529     C           ZTNLU1    BEGSR                                        **
153300200529     C*
153400200529     C           *NAMVAR   DEFN MNATN     DNATN
153500200529     C           *LOCK     IN   DNATN
153600200529     C                     Z-ADDFNATN     WWDSTN
153700200529     C                     Z-ADDFNATN     NATN
153800200529     C                     ADD  1         FNATN
153900200529     C                     OUT  DNATN
154000200529     C*
154100200529     C                     ENDSR
154200200529     C********************************************************************
154300200529     C/EJECT
154400200529     C********************************************************************
154500200529     C**                                                                 *
154600200529     C** ZASNMS    - Send message to program's message queue             *
154700200529     C**                                                                 *
154800200529     C** CALLS     - Y2SNMGC                                             *
154900200529     C**                                                                 *
155000200529     C** CALLED BY - #BA, #BBA, #ZAA                                     *
155100200529     C**                                                                 *
155200200529     C********************************************************************
155300200529     C           ZASNMS    BEGSR                           ** ZASNMS    **
155400200529     C*
155500200529     C                     CALL 'Y2SNMGC'
155600200529     C                     PARM           ZAPGM  10
155700200529     C                     PARM           ZAPGRL  5
155800200529     C                     PARM           ZAMSID  7
155900200529     C                     PARM           ZAMSGF 10
156000200529     C                     PARM           ZAMSDA132
156100200529     C                     PARM           ZAMSTP  7
156200200529     C*
156300200529     C                     ENDSR
156400200529     C********************************************************************
156500200529     C/EJECT
156600200529     C********************************************************************
156700200529     C**                                                                 *
156800200529     C** *PSSR     - PROGRAM ERROR HANDLING ROUTINE                      *
156900200529     C**                                                                 *
157000200529     C** CALLS     - NONE                                                *
157100200529     C**                                                                 *
157200200529     C** CALLED BY - #ZAA                                                *
157300200529     C**                                                                 *
157400200529     C********************************************************************
157500200529     C           *PSSR     BEGSR
157600200529     C*
157700200529     C           @RUN      IFEQ *BLANKS
157800200529     C                     MOVE 'Y'       @RUN    1
157900200529     C                     DUMP
158000200529     C                     END
158100200529     C*
158200200529     C                     ROLBK
158300200529     C*
158400200529     C                     CALL 'DBERRCTL'
158500200529     C*
158600200529     C                     ENDSR
158700200529     C********************************************************************
158800200529     C/EJECT
158900200529     C********************************************************************
159000200529     C**
159100200529     C**   ZALIGN SR. TO VALIDATE AND RIGHT-ALIGN NUMERIC FIELDS.
159200200529     C**
159300200529     C           ZALIGN    BEGSR                           *** ZALIGN ***
159400200529     C**
159500200529     C                     SETOF                     929399
159600200529     C**
159700200529     C**   SAVE INPUT FIELD IN ARRAY, ZA1.
159800200529     C                     MOVEAZFIELD    ZA1
159900200529     C**
160000200529     C**   CALCULATION TO DEFINE NUMBER STRUCTURE CONTROL FIELDS.
160100200529     C                     Z-ADDZADIG     ZADIG   20
160200200529     C                     Z-ADDZADEC     ZADEC   10
160300200529     C**
160400200529     C**   CALCULATIONS TO DEFINE/CLEAR FIELDS.
160500200529     C                     MOVE ' '       ZA2
160600200529     C                     MOVEAZA2       ZFIELD 16
160700200529     C                     Z-ADD0         ZX      20
160800200529     C                     Z-ADD0         ZY      20
160900200529     C**
161000200529     C**   ENSURE REQUIRED STRUCTURE OF FIELD IS VALID.
161100200529     C           ZADIG     ADD  ZADEC     ZZ      20
161200200529     C           ZZ        COMP 15                   99
161300200529     C   99                GOTO ZAEND
161400200529     C**
161500200529     C**   LOOP TO FIND DECIMAL POINT, BLANKS AND CHARACTERS.
161600200529     C           ZATAG1    TAG                             ** ZATAG1 TAG *
161700200529     C           ZX        ADD  1         ZX
161800200529     C**
161900200529     C**   CHECK FOR DECIMAL POINT. ERROR IF SECOND DECIMAL POINT.
162000200529     C           ZA1,ZX    COMP '.'                      90
162100200529     C   90 93             SETON                     99
162200200529     C   99                GOTO ZAEND
162300200529     C**
162400200529     C**
162500200529     C**   CHECK FOR 'M' CONSTANT. ERROR IF NOT LAST CHARACTER ENTERED
162600200529     C           ZA1,ZX    COMP 'M'                      96
162700200529     C   96                DO
162800200529     C           ZX        COMP 15                   99  99
162900200529     C   99                GOTO ZAEND
163000200529     C           ZX        ADD  1         ZX
163100200529     C           ZA1,ZX    COMP ' '                  9999
163200200529     C   99                GOTO ZAEND
163300200529     C           ZX        SUB  1         ZX
163400200529     C           ZX        COMP 9                    99
163500200529     C   99                GOTO ZAEND
163600200529     C                     END
163700200529     C**
163800200529     C**   CHECK FOR 'T' CONSTANT. ERROR IF NOT LAST CHARACTER ENTERED
163900200529     C           ZA1,ZX    COMP 'T'                      97
164000200529     C   97                DO
164100200529     C           ZX        COMP 15                   99  99
164200200529     C   99                GOTO ZAEND
164300200529     C           ZX        ADD  1         ZX
164400200529     C           ZA1,ZX    COMP ' '                  9999
164500200529     C   99                GOTO ZAEND
164600200529     C           ZX        SUB  1         ZX
164700200529     C           ZX        COMP 12                   99
164800200529     C   99                GOTO ZAEND
164900200529     C                     END
165000200529     C**
165100200529     C**   CLEAR ALPHAMERIC CONSTANT FROM ZA1
165200200529     C   96
165300200529     COR 97                MOVE ' '       ZA1,ZX
165400200529     C**
165500200529     C**   CHECK FOR BLANKS. BYPASS FOR FIRST BLANK AFTER A DIGIT.
165600200529     C           ZA1,ZX    COMP ' '                      91
165700200529     C   91 92             GOTO ZATAG2
165800200529     C**
165900200529     C**   CHECK FOR NUMERIC, IF NOT '.' OR ' '.
166000200529     C  N90N91   ZA1,ZX    COMP '0'                    99
166100200529     C  N90N91N99ZA1,ZX    COMP '9'                  99
166200200529     C   99                GOTO ZAEND                      NOT NUMERIC
166300200529     C**
166400200529     C**   STORE DIGITS IN ARRAY AND HOW MANY.
166500200529     C**   ZY, TOTAL OF DIGITS IN THE INPUT FIELD.
166600200529     C**   ZZ, TOTAL OF DIGITS TO THE LEFT OF DECIMAL POINT.
166700200529     C  N90N91   ZY        ADD  1         ZY         92
166800200529     C  N90N91             MOVE ZA1,ZX    ZA2,ZY
166900200529     C   90                Z-ADDZY        ZZ         93  93
167000200529     C**
167100200529     C           ZX        COMP 16                     94  CHECK IF ALL
167200200529     C   94                GOTO ZATAG1
167300200529     C**
167400200529     C           ZATAG2    TAG                             ** ZATAG2 TAG *
167500200529     C**
167600200529     C**   IF 'M' SPECIFIED, MULTIPLY ZA1 BY 1 MILLION
167700200529     C   96      ZZ        ADD  6         ZZ
167800200529     C**
167900200529     C**   IF 'T' SPECIFIED, MULTIPLY ZA1 BY 1 THOUSAND
168000200529     C   97      ZZ        ADD  3         ZZ
168100200529     C**
168200200529     C**   FILL IN ZEROS IN ANY BLANKS LEFT OF DECIMAL POINT
168300200529     C   96 93
168400200529     COR 97 93   ZZ        DOWGTZY
168500200529     C           ZY        ADD  1         ZY
168600200529     C                     MOVE '0'       ZA2,ZY
168700200529     C                     END
168800200529     C**
168900200529     C**   IF CONSTANT SPECIFIED WITH NO DECIMAL POINT ZEROISE BLANKS
169000200529     C   96N93             DO   6
169100200529     C           ZY        ADD  1         ZY
169200200529     C                     MOVE '0'       ZA2,ZY
169300200529     C                     END
169400200529     C**
169500200529     C   97N93             DO   3
169600200529     C           ZY        ADD  1         ZY
169700200529     C                     MOVE '0'       ZA2,ZY
169800200529     C                     END
169900200529     C**
170000200529     C**   IF NO DECIMAL POINT FOUND, SET TOTAL FIELD ZZ.
170100200529     C  N93                Z-ADDZY        ZZ
170200200529     C**
170300200529     C**   CHECK FOR EMBEDDED BLANKS.
170400200529     C   91 92             MOVEAZA1,ZX    ZFIELD
170500200529     C   91 92   ZFIELD    COMP ' '                  9999
170600200529     C   99                GOTO ZAEND                      EMBEDDED BLANK
170700200529     C**
170800200529     C**   ENSURE THAT NUMBER OF DIGITS ENTERED EITHER SIDE
170900200529     C**   OF DECIMAL POINT ARE NOT MORE THAN ALLOWED.
171000200529     C           ZZ        COMP ZADIG                99
171100200529     C           ZY        SUB  ZZ        ZX
171200200529     C  N99      ZADEC     SUB  ZX        ZX           9995
171300200529     C   99                GOTO ZAEND
171400200529     C   95                GOTO ZATAG4                     NO TRAILING
171500200529     C**                                                   BLANKS.
171600200529     C**   FILL THE TRAILING BLANKS WITH ZEROS.
171700200529     C           ZY        ADD  ZX        ZZ
171800200529     C           ZATAG3    TAG                             ** ZATAG3 TAG *
171900200529     C           ZY        ADD  1         ZY
172000200529     C                     MOVE '0'       ZA2,ZY
172100200529     C           ZY        COMP ZZ                     94
172200200529     C   94                GOTO ZATAG3
172300200529     C**
172400200529     C**   RIGHT-ALIGN THE VALUE BY MOVING BACK TO ARRAY, ZA1.
172500200529     C           ZATAG4    TAG                             ** ZATAG4 TAG *
172600200529     C                     MOVE '0'       ZA1
172700200529     C                     Z-ADD16        ZX
172800200529     C           ZATAG5    TAG                             ** ZATAG5 TAG *
172900200529     C           ZY        COMP 0                        94
173000200529     C   94                GOTO ZATAG6
173100200529     C                     MOVE ZA2,ZY    ZA1,ZX
173200200529     C           ZY        SUB  1         ZY
173300200529     C           ZX        SUB  1         ZX
173400200529     C                     GOTO ZATAG5
173500200529     C           ZATAG6    TAG                             ** ZATAG6 TAG *
173600200529     C**
173700200529     C**   MOVE VALIDATED AND RIGHT-ALIGNED NUMBER BACK INTO ZFIELD.
173800200529     C                     MOVEAZA1       ZFIELD
173900200529     C**
174000200529     C                     SETOF                     9697
174100200529     C**
174200200529     C           ZAEND     ENDSR                           * ZAEND ENDSR *
174300200529     C**
174400200529     C**
174500200529     C********************************************************************
174600200529     C/EJECT
174700200529     C********************************************************************
174800200529     C**                                                                 *
174900200529     C** ZSEDIT subroutine to insert a decimal point and sign into a     *
175000200529     C** numeric field and to blank out leading zeros (optionaly         *
175100200529     C** inserting commas).                                              *
175200200529     C**     Input fields:   ZFLD15 15/0                                 *
175300200529     C**                     ZDECS  1/0                                  *
175400200529     C**                     ZECODE 1/  ('J', 'L' or blank)              *
175500200529     C**                                                                 *
175600200529     C**     Arrays:         ZS1    15/1/0                               *
175700200529     C**                     ZS2    21/1/                                *
175800200529     C**                                                                 *
175900200529     C**     Output fields:  ZOUT21 21                                   *
176000200529     C**                                                                 *
176100200529     CSR         ZSEDIT    BEGSR                           **  ZSEDIT   *
176200200529     C*
176300200529     C* Define/Clear fields
176400200529     C*
176500200529     C                     Z-ADDZFLD15    ZFLD15 150
176600200529     C                     Z-ADDZDECS     ZDECS   10
176700200529     C                     MOVE ZECODE    ZECODE  1
176800200529     C                     MOVE *BLANKS   ZOUT21 21
176900200529     C*
177000200529     C*       SET UP WORK FIELDS
177100200529     C*
177200200529     C                     Z-ADD0         ZS1
177300200529     C                     MOVE ' '       ZS2
177400200529     C*
177500200529     C                     Z-ADD15        Z1      20
177600200529     C                     Z-ADD20        Z2      20
177700200529     C*
177800200529     C           15        SUB  ZDECS     ZINTS   20
177900200529     C*
178000200529     C* Check if numeric field is negative
178100200529     C*
178200200529     C           ZFLD15    IFLT *ZEROS
178300200529     C                     MOVE '-'       ZS2,21
178400200529     C                     Z-SUBZFLD15    ZFLD15
178500200529     C                     END
178600200529     C*
178700200529     C                     Z-ADDZFLD15    WORK15
178800200529     C*
178900200529     C*       CHECK TO SEE IF THERE ARE ANY DECIMAL PLACES
179000200529     C*
179100200529     C           ZDECS     CABEQ0         ZS10
179200200529     C*
179300200529     C*       SET UP DECIMALS
179400200529     C*
179500200529     C                     Z-ADD*ZEROS    ZCNT    10
179600200529     C           ZCNT      DOUEQZDECS
179700200529     C                     MOVE ZS1,Z1    ZS2,Z2
179800200529     C                     SUB  1         Z2
179900200529     C                     ADD  1         ZCNT
180000200529     C                     SUB  1         Z1
180100200529     C                     END
180200200529     C*
180300200529     C*       PUT IN DECIMAL PLACE
180400200529     C*
180500200529     C                     MOVE '.'       ZS2,Z2
180600200529     C                     SUB  1         Z2
180700200529     C*
180800200529     C           ZS10      TAG                             ** ZS10 TAG **
180900200529     C*
181000200529     C*       SET UP INTEGERS
181100200529     C*
181200200529     C                     Z-ADD*ZEROS    CNT3    10
181300200529     C           Z1        DOUEQ*ZEROS
181400200529     C                     MOVE ZS1,Z1    ZS2,Z2
181500200529     C                     SUB  1         Z1
181600200529     C                     SUB  1         Z2
181700200529     C*
181800200529     C* If edit code is 'J', insert a ',' before each group of three
181900200529     C* digits - not if beginning of array reached.
182000200529     C*
182100200529     C           Z2        IFGT *ZEROS
182200200529     C           ZECODE    ANDEQ'J'
182300200529     C                     ADD  1         CNT3
182400200529     C           CNT3      IFEQ 3
182500200529     C                     MOVE ','       ZS2,Z2
182600200529     C                     SUB  1         Z2
182700200529     C                     Z-ADD*ZEROS    CNT3
182800200529     C                     END
182900200529     C                     END
183000200529     C*
183100200529     C                     END
183200200529     C*
183300200529     C*       PUT IN LEADING BLANKS
183400200529     C*
183500200529     C                     Z-ADD1         Z2
183600200529     C           ZS2,Z2    DOWEQ'0'
183700200529     C           ZS2,Z2    OREQ ' '
183800200529     C           ZS2,Z2    OREQ ','
183900200529     C                     MOVE ' '       ZS2,Z2
184000200529     C                     ADD  1         Z2
184100200529     C           Z2        CABEQ22        ZS20
184200200529     C                     END
184300200529     C*
184400200529     C*       IF NO INTEGERS PUT IN LEADING ZERO
184500200529     C*
184600200529     C           ZS20      TAG                             ** ZS20 TAG **
184700200529     C*
184800200529     C           Z2        IFEQ 22
184900200529     C                     SUB  2         Z2
185000200529     C                     MOVE '0'       ZS2,Z2
185100200529     C                     ELSE
185200200529     C*
185300200529     C           ZS2,Z2    IFEQ '.'
185400200529     C                     SUB  1         Z2
185500200529     C                     MOVE '0'       ZS2,Z2
185600200529     C                     END
185700200529     C                     END
185800200529     C*
185900200529     C*       SET UP OUTPUT FIELD
186000200529     C*
186100200529     C                     MOVEAZS2       ZOUT21
186200200529     C*
186300200529     CSR                   ENDSR
186400200529     C*****************************************************************
186500200529     C********************************************************************
186600200529     C/EJECT
186700200529     O* RELEASE RECORD
186800200529     O*
186900200529     O***SESWHTD0E                SESWHT                                                    MD027346
187000200529     OSESWHTDXE                SESWHT                                                       MD027346
187100200529     O********************************************************************
187200200529     O********************************************************************
187300200529     O/EJECT
187400200529** CPY@
187500200529(c) Finastra International Limited 2001
