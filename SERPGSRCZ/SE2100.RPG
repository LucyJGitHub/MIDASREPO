     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Extract security actions')                    *
/*OVRF*: OVRDBF FILE(SECTYX) TOFILE(SECTY) SHARE(*NO)               : *
/*OVRF*: OVRDBF FILE(SEDELX) TOFILE(SEDEL) SHARE(*NO)               : *
/*OVRF*: OVRDBF FILE(SECEU)  TOFILE(SECET) SHARE(*NO)               : *180385
     F*****************************************************************
     F*                                                               *
     F*  Midas - Securities Trading Module
     F*                                                               *
     F*  SE2100 - EXTRACT SECURITY ACTIONS                            *
     F*                                                               *
     F*  Function: The Security and Security Diary Files are read.    *
     F*   (COB)    For each Security, Events are extracted from each  *
     F*            File, which require action on Positions (Book,     *
     F*            Customer or Depot). The PFs Security Diary Events  *
     F*            and Security Non-Diary Events are updated.         *
     F*            The Security is also updated with information from *
     F*            the Security Diary, and the Record ID of maturing  *
     F*            securities is changed to 'M'.                      *
     F*                                                               *
     F*            Events requiring action are:                       *
     F*            1. Security record: Coupon or Maturity Date due.   *
     F*            2. Security Diary: all other Events:               *
     F*                  DV - Dividend                                *
     F*                  PP - PP Call                                 *
     F*                  MP - Mortgage Payment                        *
     F*                  IR - Interest Rate Change                    *
     F*                  RC - Redemption Call                         *
     F*                  RP - Redemption Put                          *
     F*                                                               *
     F*            Events are extracted for generation of Position    *
     F*            Settlements and flagged: 'Posn Settls reqd' = Y    *
     F*                                     'A/c Key reqd' = N        *
     F*                                                               *
     F*  Called by: SEC0602A - Extract Security Action                *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. CSD103             Date 10Aug20               *
      *  Prev Amend No. MD057247           Date 01Feb21               *
      *                 247420             Date 08Sep20               *
      *                 MD049798           Date 09May19               *
      *                 MD046248           Date 27Oct17               *
      *                 CRE073             Date 06Dec10               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD027             Date 09Dec05               *
      *                 CSE075             Date 06Mar06               *
      *                 CSE075             Date 17Nov05               *
      *                 CSE065             Date 08Nov04               *
      *                 CSE071             Date 19Jul05               *
      *                 CAS008             Date 11May04               *
      *                 206595             Date 18Jul02               *
      *                 CAS006             Date 21Jan03               *
      *                 CSE037             Date 29Apr02               *
      *                 CSE035             Date 22Apr02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 211228             Date 11Nov02               *
      *                 206316             Date 19Jul02               *
      *                 180385             Date 13Jul00               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CSE031             Date 09Nov01               *
      *                 182505             Date 12Dec01               *
      *                 180707             Date 12Dec01               *
      *                 197357             Date 24Nov01               *
      *                 175977             Date 30May01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CSD006             Date 16May01               *
      *                 183206             Date 23Mar01               *
      *                 CAP140             Date 17Oct00               *
      *                 187825             Date 18Dec00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 185803             Date 02Nov00               *
      *                 CSE023             Date 14Aug00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 170949             Date 09Jun00               *
      *                 143174             Date 03May00               *
      * Midas DBA 3.02 -----------------------------------------------*
     F*                 CPB001             Date 01Jun99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 CPL002             Date 08Mar99               *
     F*                 130862             Date 16Oct98               *
     F*                 137563             Date 13Jul98               *
     F*                 CSE005             Date 04Feb97               *
     F*                 S01408             DATE 27SEP96               *
     F*                 094576             DATE 04JUL96               *
     F*                 100228             DATE 31MAY96               *
     F*                 102885             DATE 07MAY96               *
     F*                 077649             DATE 24OCT95               *
     F*                 091254             DATE 20OCT95               *
     F*                 S01510             DATE 10AUG94               *
     F*                 S01502             DATE 08JUL94               *
     F*                 066262             DATE 04AUG94               *
     F*                 048059             DATE 09FEB94               *
     F*                 054498             DATE 26NOV93               *
     F*                 054257             DATE 26NOV93               *
     F*                 052254             DATE 26NOV93               *
     F*                 S01401             DATE 16JUN93               *
     F*                 041031             DATE 01FEB93               *
     F*                 S01397             DATE 10SEP92               *
     F*                 E37295             DATE 24MAR92               *
     F*                 E31622             DATE 25FEB92               *
     F*                 E29170             DATE 05NOV91               *
     F*                 E27092             DATE 04SEP91               *
     F*                 S01117             DATE 06JUN91               *
     F*                 E23802             DATE 04OCT90               *
     F*                 E23049             DATE 26JUL90               *
     F*                 E21588             DATE 10APR90               *
     F*                 E21616             DATE 03APR90               *
     F*                 E21305             DATE 06MAR90               *
     F*                 E21307             DATE 06MAR90               *
     F*                 E20554             DATE 07DEC89               *
     F*                 E20142             DATE 07NOV89               *
     F*                 E20125             DATE 07NOV89               *
     F*                 E20086             DATE 07NOV89               *
     F*                 E20085             DATE 07NOV89               *
     F*                 E15930             DATE 24OCT89               *
     F*                 E18013             DATE 27/06/89              *
     F*                 E16772             DATE 31/05/89              *
     F*                 E18009             DATE 21/04/89              *
     F*                 E17876             DATE 11/04/89              *
     F*                 E17704             DATE 31/03/89              *
     F*                 E14674             DATE 07/12/88              *
     F*                 S01176             DATE 09/11/88              *
     F*                 E15549             DATE 04/10/88              *
     F*                 E14235             DATE 23/09/88              *
     F*                 E13979             DATE 27/06/88              *
     F*                 E13524             DATE 14/05/88              *
     F*                 S01158             DATE 06/05/88              *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data     *
      *             (Recompile)                                       *
      *  MD057247 - Multiple calls of UTCHOBJEX for several COB com-  *
      *             ponents - Securities module.                      *
      *           - Moved the call of AOSARDR0 from /copy ZLCDZ1.     *
      *  247420 - Rename and increase length of field NORE in file    *
      *           SNDEVA from NORE(5,0) to SNNORE(7,0).               *
      *  MD049798 - Last Coupon Date not being updated for zero rate  *
      *             Securities. Fix is to remove the condition on     *
      *             coupon rate before generation of coupon event.    *
      *  MD046248 - Finastra Rebranding                               *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSE075 - CSE075 Change Control. Display Coupon Delay period  *
      *           for all interest-bearing securities.                *
      *  CSE075 - US Enhanced Treasury Upgrade to MidasPlus           *
      *  CSE065 - Const. Yield Amort. on Mortgage backed assets       *
      *  CSE071 - Multiple Holidays Re Securities                     *
      *  CAS008 - Delayed Hedge Assessment (Recompile)                *
      *  206595 - Apply 194841. To send also 'IR' event to Meridian.  *
      *  CAS006 - Hedge Accounting Phase B                            *
      *  CSE037 - Bond Pricing - 3 Decimal Places in Trades Input     *
      *  CSE035 - NX/NNX Coupon Payment Processing.                   *
      *  211228 - Some A/C keys are not being produced by the system, *
      *           due to incorrect Last Coupon Date/Next Coupon Date. *
      *           Reversed part of fix 197357.                        *
      *  206316 - If CSE031 is ON, update Event Date on Non-Diary     *
      *           Events file to be the Next Coupon Date on SECTYD.   *
      *         - If CSE031 is ON, in SR/IRCHCK only need to check    *
      *           if XSDED equals NCD.                                *
      *         - Recompiled over changed ZLCDZ1.                     *
      *  180385 - CPF5032 I/O error detected in file SEDEL, pgm       *
      *           SE2100 statement 137100.  Fix patterned after       *
      *           144477 which used a different update file to        *
      *           prevent locking problem.                            *
      *  CSE031 - Coupon Fixing for Floating Rate Notes.              *
      *  182505 - Interest rate change that falls on holiday was not  *
      *           adjusted in accordance with CSE005 (Business Day    *
      *           Convention).                                        *
      *  180707 - No Position Settlements generated due to wrong Last *
      *           Coupon Date written to PF/SECACD. Fix is to retain  *
      *           Previous Next Coupon Date before adjusting to new   *
      *           Next Coupon Date by SE0045 before executing SR ZLCD.*
      *  197357 - Next coupon date amended but action was still       *
      *           generated for the old coupon date eventhough the    *
      *           said date is not existing in the array. Fix is to   *
      *           only generate coupon action based on the array.     *
      *         - Incorrect AI was generated after amendment of the   *
      *           coupon array due to incorrect Last Coupon date used.*
      *         - Incorrect last coupon date updated on PF/SNDEVD for *
      *           event type 'CG'.  Fix is to initialise last coupon  *
      *           date before writing to SNDEVD.                      *
      *  175977 - Coupon Rate not updated in SECS option during daily *
      *           IR event. Changed if-then condition to check diary  *
      *           events only with dates that are less than the next  *
      *           working date to make sure update to SECTYD is done. *
      *  CSD006 - Market Data Feed (Recompile)                        *
      *  183206 - File out of balance in SE0320, file SEDEVD.  Use    *
      *           field AKDAT instead of ECD.                         *
      *  CAP140 - Conversion of SE Security Diary Event inputs into   *
      *           modular structure to use as APIs.                   *
      *  187825 - Maturity event not generated for security not cover *
      *           by treaty tax.                                      *
      *  185803 - Events for some security not generate in advance.   *
      *  CSE023 - Treaty Withholding Tax                              *
     F*  170949 - When a diary event type 'IR' is made the day of the *
     F*           coupon, the coupon was using the new rate.          *
     F*           Generate coupon event before diary event.Used 165308*
     F*  143174 - Fix 094576 causes LCPN to be to be updated too      *
     F*           early resulting in discrepancies in accrual amounts *
     F*           Apply fix 134337 (or 145770) which removes 094576   *
     F*  CPB001 - Meridian DBA Middleware Replication Customization.  *
     F*           Midas/TOF Interface.                                *
     F*  CPL002 - Midas-Plato Interface (Recomipled)                  *
     F*  130862 - Recompiled over changed ZLCDZ1.                     *
     F*  137563 - IR event that does not match IR change date in      *
     F*           Security resulted to a wrong Coupon Rate. Fix is to *
     F*           drop IR events with invalid event date.             *
     F*  CSE005 - Effect of holidays on FRN Coupon Dates              *
     F*           (recompilation due to change to ZNCD/ZLCD)          *
     F*  S01408 - Addition of core hook SE2100OOP1                    *
     F*           Addition of core hook SE2100IIP1                    *
     F*           Addition of core hook SE2100FFP1                    *
     F*           Addition of core hook SE2100FFP2                    *
     F*           Addition of core hook SE2100FFP3                    *
     F*           Addition of core hook SE2100EEP1                    *
     F*           Addition of core hook SE2100CCP1                    *
     F*           Addition of core hook SE2100CCP2                    *
     F*           Addition of core hook SE2100CCP3                    *
     F*           Addition of core hook SE2100CCP4                    *
     F*           Addition of core hook SE2100CCP5                    *
     F*           Addition of core hook SE2100CCP6                    *
     F*           Addition of core hook SE2100CCP7                    *
     F*           Addition of core hook SE2100CCP8                    *
     F*           Addition of core hook SE2100CCP9                    *
     F*           Addition of core hook SE2100CP10                    *
     F*           Addition of core hook SE2100CP11                    *
     F*  094576 - Last coupon date not being correctly updated when   *
     F*           a coupon date is reached. Fix is to update Last     *
     F*           Coupon Date if Next Coupon Date is less than Date   *
     F*           of Next Working Day.                                *
     F*  100228 - RECOMPILE OVER CHANGED SR ZLCDZ1 & ZNCDZ3.          *
     F*  102885 - If Long Term Maturity is 'Y', pgm added 100 years   *
     F*           to maturity date which has been already calculated  *
     F*           correctly during input of the security.             *
     F*  077649 - REDEMPTION CALL AND REDEMPTION PUT DIARY EVENTS     *
     F*           UPDATED TO RECI 'M' BEFORE THE VALUE DATE           *
     F*  091254 - RECOMPILE OVER CHANGED ZLCDZ1 & ZNCDZ3              *
     F*  S01510 - Dividend payments based on ex-date                  *
     F*  S01502 - BLI Telekurs Processing.  Recompiled due to change  *
     F*           in length of SESTAT, 133 long.                      *
     F*  066262 - Dulpicate 'CP' action being generated on Coupon     *
     F*           date. Check first if coupon already processed.      *
     F*  048059 - 'OC' diary events are not being processed.          *
     F*  054498 - SECURITY EVENTS BEING PROCESSED IN ADVANCE WHEN     *
     F*           ACCRUE INDICATOR REQUIRES PROCESSING IN ARREARS.    *
     F*           PROCESSING CONDITIONED ON ECD AND ACCRUAL RUN       *
     F*           INDICATOR HAS BEEN CHANGED TO REFER TO NEW DATES.   *
     F*           CALCULATION OF NEXT COUPON DATE HAS BEEN CHANGED    *
     F*  054257 - RECOMPILED as PREV CURRENT FACTOR amended from 9,8  *
     F*           to 10,9                                             *
     F*  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
     F*           to 10,9                                             *
     F*  S01401 - MT5xx SWIFT Messages Feature:                       *
     F*          - Recompiled due to changes to files.                *
     F*  041031 - Some live diary events were not updated to be       *
     F*           matured causing database errors on SE1440 for       *
     F*           securities maturing today. Also amended to show the *
     F*           correct key for database error on file SEDEL.       *
     F*           (PM FIX FROM VDF)                                   *
     F*  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
     F*          - Recompiled due to changes to files.                *
     F*  E37295 - Last Coupon Date on SECTYD is updated to Next       *
     F*           Coupon Date.                                        *
     F*  E31622 - Diary Event record not being updated with ECD when  *
     F*           action is written for PP DV MP IR. This causes      *
     F*           duplicate generated position settlements.           *
     F*  E29170 - Report Control Facility changes                     *
     F*  E27092 - Recompiled over changed SR/ZLCD                     *
     F*  S01117 - Multibranching                                      *
     F*  E23802 - Diary Events updating Security too early            *
     F*           Last Dividend date was not updated correctly        *
     F*  E23049 - Diary Events do not updating Security Properly      *
     F*         - Xrate currency and Mult/Div ind on an XR change     *
     F*         - Redemptions were not updating Securiry before ECD   *
     F*         - Cancelled events were not being removed from the    *
     F*           Security                                            *
     F*  E21588 - DB Errors caused by processing Maturity Actions for *   E21588
     F*           Securities cancelled today. In fact, there is no    *   E21588
     F*           circumstance where this program should process any  *   E21588
     F*           cancelled Security.                                 *   E21588
     F*  NOTE:  - A small amount of deleted code for the following    *
     F*           errors has been removed in an exercise to clarify   *
     F*           the processing; S01158 E13542 E13979 E15549.        *
     F*  E21616 - Recompiled over changed SR/ZLCD.                    *   E21616
     F*  E21305 - No Account Keys produced for Dividend Event on Type *   E21305
     F*           '3' Accrual Run.                                    *   E21305
     F*  E21307 - Position Settlement is required for Maturity Coupon.*   E21307
     F*  E20554 - Trying to read past end of file on SECET .          *   E20554
     F*  E20142 - With EOM on Saturday, account keys for coupons due  *   E20142
     F*           Friday were generated twice, and account keys for   *   E20142
     F*           coupons and maturities due Saturday were generated  *   E20142
     F*           in the wrong phase (ANWD1 rather than EGEN1).       *   E20142
     F*  E20125 - Prevent same security actions being produced on both*   E20125
     F*           runs at end of week                                 *   E20125
     F*  E20086 - Mortgage-Backs and Current Factor Processing Rewrite*   E20086
     F*          - Previous Current Factor on MP Actions is updated   *   E20086
     F*            incorrectly with the prior Previous Current Factor.*   E20086
     F*  E20085 - Interest and Coupon Calculations Rewrite:           *   E20085
     F*          - LF/SECEO member SEDEVD changed to omit RECI = 'C'. *   E20085
     F*          - E15549 change to call SR/ZNCD was incorrect:       *   E20085
     F*            Firstly, instead of starting at the Last Coupon and*   E20085
     F*            looping until GT RUND, we can just start at the Run*   E20085
     F*            Date and get the NCD after that.                   *   E20085
     F*            Secondly, SR/ZNCD returns NCD = ECD if ECD is a    *   E20085
     F*            Coupon Date, so to get the Next Coupon AFTER a date*   E20085
     F*            it is important to start at the right place.       *   E20085
     F*            This change was done to stop the program looping.  *   E20085
     F*            (Also removes E18013 which was the same problem).  *   E20085
     F*          - LCPN from SECTY is unreliable - use SR/ZLCD.       *   E20085
     F*  E15930 - Partly Paid Processing Corrections:                 *   E15930
     F*          - Initialise the totals on the Diary with CPDP.      *   E15930
     F*          - Running Totals, (SDTA and SDTP), from the Security *   E15930
     F*            Diary should be used to update CPDP on Event Date. *   E15930
     F*          - Use Call Amount from Diary for Security Action.    *   E15930
     F*  E18013 - Program loops when the Next Coupon Date is the same *   E18013
     F*           as the Maturity Date.                               *   E18013
     F*  E16772 - The Dividend Payment Amount fields have been        *   E16772
     F*           increased in size from 9,4 to 13,8. Hence the field *   E16772
     F*           SDDV has been replaced by SDVA and SDAU by SDUN.    *   E16772
     F*  E18009 - RECOMPILE OVER LATEST URSLIB/ZSRSRC.                *   E18009
     F*  E17876 - REMOVE E17704, CAUSES SE2100 LOOP IN ALL TEST SYS'S.*   E17876
     F*  E17704 - RECOMPILE PROGRAM OVER CHANGED ZNCDZ3 SR            *   E17704
     F*  E14674 - INCORRECT RATE OUTPUT TO INITIAL DIARY RECORDS      *   E14674
     F*  S01176 - SECURITIES TRADING 3.1                              *   S01176
     F*  E15549 - REDELIVERY OF SE2100 INVOLVING VARIOUS FIXES FOR    *   E15549
     F*                POSITION SETTLEMENTS                           *   E15549
     F*      1.NEXT COUPON DATE PROCESSING NEVER PERFORMED            *   E15549
     F*      2.NO POSITION EVENTS PROCESSED IF SYSTEM ON DAILY        *   E15549
     F*        ACCRUALS                                               *   E15549
     F*      3.POSITION ACTION EVENTS ACTIONED PRIOR TO EVENT DATE    *   E15549
     F*      4.DUPLICATE INITIAL RECORDS IF ACCRUAL DATE FOLLOWED BY  *   E15549
     F*        NON WORKING DAY                                        *   E15549
     F*      5.INITIAL RECORDS NOT UPDATED ON SECURITY COMPLETION DATE*   E15549
     F*      6.EVENTS FALLING ON HOLIDAYS NOT PROCESSED PROPERLY      *   E15549
     F*      7.RE-ACTIONING OF DIARY EVENTS NOT DONE CORRECTLY        *   E15549
     F*      8.'LAST COUPON DATE OF CURRENT COUPON PERIOD' ADDED TO   *   E15549
     F*        SECURITY ACTIONS FILE FOR SE2210/SE2220/SE2270         *   E15549
     F*      9.DOUBLING OF POSITION SETTLEMENTS ON ACCRUAL DATE       *   E15549
     F*        FOLLOWED BY A NON-WORKING DAY                          *   E15549
     F*     10.SECURITY ACTIONS GENERATED FOR COUPON DATE COINCIDING  *   E15549
     F*        WITH MATURITY DATE GENERATED POSITION SETTLEMENTS      *   E15549
     F*   E14235 - ERROR IN SR/ZNCD TO FETCH NEXT COUPON DATE. PROGRAM*   E14235
     F*            RE-COMPILED TO ALLOW FOR NEW SUB-ROUTINE.          *   E14235
     F*   E13979 - POST INCORPORATION DEVELOPMENT FIX - OUTPUT COUPON *   E13979
     F*            ACTION WITH EVENT TYPE CO INSTEAD OF CP.           *   E13979
     F*   E13524 - SET UP NOMINAL CURRENCY IN SECURITY DIARY EVENTS   *   E13524
     F*            FILE (SEDEVD)                                      *   E13524
     F*   S01158 - POST INCORPORATION DEVELOPMENT FIXES               *   S01158
     F*                                                               *
     F*****************************************************************
      *
     FSECTY   UF  E           K        DISK
     F                                              KINFDS SECDS
     F                                              KINFSR SECSR
     FSECTYX  IF  E           K        DISK
     F            SECTYDF                           KRENAMESECTYDX
     FSECTYA  IF  E                    DISK
     F*SECET***IF**E           K        DISK                              E15549
     F*SECET**UF **E           K        DISK                       E15549 180385
     FSECEU   UF  E           K        DISK                               180385
     F            SEDEVDF                           KRENAMESEDEVDU        180385
     FSECET   IF  E           K        DISK                               180385
     F            SEDEVDF                           KRENAMESEDEVDC
     FINVTP   IF  E           K        DISK
     FSDWHTTL5IF  E           K        DISK                               CSE023
     FSEDEL   UF  E           K        DISK                      A
     F                                              KINFDS DELDS
     F                                              KINFSR DELSR
     FSEDELX  IF  E           K        DISK
     F            SEDEVDF                           KRENAMESEDEVDX
     FSEDEVA  UF  E                    DISK
     FSECEO   UF  E           K        DISK                               E15549
     F            SEDEVDF                           KIGNORE               E15549
     F*********** SNDEVDF                           KRENAMESNDEVDX E15549 E20085
     F            SNDEVDF                           KRENAMESNDEVDO        E20085
     FSNDEVD  O   E           K        DISK                      A
     F                                              KINFDS SNDDS
     F                                              KINFSR SNDSR
     FSNDEVA  UF  E                    DISK
     F                                              KINFDS SNADS
     F                                              KINFSR SNASR
     FSECACD  O   E                    DISK
     F                                              KINFDS CCDDS
     F                                              KINFSR CCDSR
     FSECACA  O   E                    DISK
     F                                              KINFDS CCADS
     F                                              KINFSR CCASR
     FSE2100AUO   E                    PRINTER
     F*                                                                   S96032
     F/COPY WNCPYSRC,SE2100FFP1                                           S96032
     F*                                                                   S96032
     FTABSE   IF  E           K        DISK
     F* ICD 1     TABTB10F                          KIGNORE
     F* ICD 2     TABTB11F                          KIGNORE
     F            TABTB36F                          KIGNORE
     F            TABTB40F                          KIGNORE
     F            TABTG10F                          KIGNORE
     F            TABTG20F                          KIGNORE
     F            TABLETHF                          KIGNORE
     F*********** TABLETJF                          KIGNORE               S01117
     F            TABLETLF                          KIGNORE
     F            TABLETRF                          KIGNORE
     F            TABLET2F                          KIGNORE
     F            TABTE10F                          KIGNORE
     F            TABTE20F                          KIGNORE
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*   20  - END OF INPUT - SECURITIES (SECTY)                     *
     F*   25  - END OF INPUT - SECURITY DIARY (SEDEL)                 *
     F*   30  - SEDEL NOT FOUND ON UPDATE                             *
     F*   35  - SECTY NOT FOUND ON UPDATE                             *
     F*   36  - INVTP NOT FOUND FOR SECTY RECORD                      *
     F*   37  - SECET NOT FOUND / EOF                                 *
     F*   40  - SECURITY HAS MATURED                                  *
     F*   41  - NEW COUPON DATE CALCULATED                            *
     F*   42  - IR PROCESSED FOR THIS SECURITY                        *
     F*   43  - MP PROCESSED FOR THIS SECURITY                        *
     F*   44  - PP PROCESSED FOR THIS SECURITY                        *
     F*   45  - XR PROCESSED FOR THIS SECURITY                        *
     F*   46  - RC,RP PROCESSED FOR THIS SECURITY                     *
      *   47  - Deleted diary event w/c was not yet actioned.         *   183206
     F*   50  - IR event has a valid event date.                      *   137563
      *   60  - End of file on SNDEVDO                                *   197357
     F*   80  - CONTROL TOTALS DISAGREE - SECTYA                      *
     F*   88  - SHOW STATUS ON DB ERROR REPORT                        *
     F*                                                               *
     F* 90-99 - Used in Standard Subroutines                          *
     F*                                                               *
     F*   U7  - Database Error                                        *
     F*   U8  - Database / Control Error                              *
     F*                                                                   S01408
     F/COPY WNCPYSRC,SE2100FFP3                                           S01408
     F*                                                                   S01408
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*  FIRST  - INITIALISATION                                      *
     F*  NEWSEC - INITIALISATION FOR A NEW SECURITY                   *
     F*  PROCES - PROCESSES EACH DIARY RECORD ON SEDEL                *
     F*  UPDDEL - UPDATES SECURITY DIARY - SEDEL                      *
     F*  ENDSEC - COMPLETES PROCESSING FOR SECURITY                   *
     F*  AUDIT  - CHECKS & UPDATES AUDIT FILES                        *
     F*  PRINT  - PRINTS CONTROL TOTALS OR DB ERROR REPORT            *
     F*  GETSEC - READS NEXT SECURITY FROM SECTYX                     *
     F*  GETDEL - READS NEXT SECURITY DIARY EVENT FROM SEDELX         *
     F*  IRCHCK - Check if IR correspond w/ the IR change of Security *   137563
     F*                                                               *
     F*  OUTW01 - OUTPUTS SECURITY ACTION (COUPON)    TO SECACD       *
     F*  OUTW02 - OUTPUTS SECURITY ACTION (MATURITY)  TO SECACD       *
     F*  OUTW03 - OUTPUTS SECURITY ACTION (SEC DIARY) TO SECACD       *
     F*  OUTW04 - OUTPUTS INITIAL VALUE RECORD TO SEDEVD              *
     F*  OUTSND - OUTPUTS NON-DIARY EVENT TO SNDEVD                   *
     F*                                                               *
     F*  SECSR  - ERROR SUBROUTINE FOR LF/SECTY                       *
     F*  DELSR  - ERROR SUBROUTINE FOR LF/SEDEL                       *
     F*  SNDSR  - ERROR SUBROUTINE FOR PF/SNDEVD                      *
     F*  SNASR  - ERROR SUBROUTINE FOR PF/SNDEVA                      *
     F*  CCDSR  - ERROR SUBROUTINE FOR PF/SECACD                      *
     F*  CCASR  - ERROR SUBROUTINE FOR PF/SECACA                      *
     F*  *PSSR  - Error handling                                      *   S01117
     F*                                                               *
     F*  ZICD2  - ACCESSES ICD 2(TABTB11)                             *
     F*  ZNCD   - CALCULATES NEXT COUPON DATE                         *
     F*  ZSYSTM - ACCESSES ICD 1(TABTB10)                             *
     F*                                                               *
     F*                                                                   S01408
     F/COPY WNCPYSRC,SE2100FFP2                                           S01408
     F*                                                                   S01408
     F*****************************************************************
      /EJECT
     E*                                                                   S96032
     E/COPY WNCPYSRC,SE2100EEP1                                           S96032
     E*                                                                   S96032
     E                    CPY@    1   1 80
     E/COPY ZSRSRC,ZHOLE                                                  CSE023
     E/COPY ZSRSRC,ZNCDZ1
     E/COPY ZSRSRC,ZDATE2Z1
     E                    NAR     1   3 35
     E**********          ETP     4   4  2                                             E15549 CSE065
     E                    ETP     5   5  2                                                    CSE065
     E                    DAT        12  6 0                              137563
     E/COPY WNCPYSRC,SE2100E001
      /EJECT
     ISEDEVDC
     I*
     I*  RENAME FIELDS ON SECET TO ACCESS SEPARATELY
     I*
     I              RECI                            CRECI
     I              SDSN                            CDSN
     I              SDED                            CDED
     I              SDET                            CDET
     I              SDNV                            CDNV
     I**************SDDV                            CDDV                  E16772
     I              SDVA                            CDVA                  E16772
     I              SDCP                            CDCP
     I              SRPT                            CRPT
     I              SDTR                            CDTR
     I              SRMI                            CRMI
     I              SDPD                            CDPD
     I              SDNC                            CDNC
     I              SDPP                            CDPP
     I              SDPC                            CDPC
     I              SDTA                            CDTA
     I              SDTP                            CDTP
     I              SDRP                            CDRP
     I              SDCV                            CDCV
     I              SDCX                            CDCX                  E23049
     I              SDCE                            CDCE
     I              SDMD                            CDMD
     I              NMCY                            CMCY
     I              SDAD                            CDAD
     I              SDDT                            CDDT
     I              LCD                             CLCD
     I              CHTP                            CCHTP
     I              TNLU                            CTNLU
     I              SCRS                            CCRS                                      CAS006
     I              SLQP                            CLQP                                      CAS006
     I              SDNN                            CDNN                                      CAS006
     I/COPY WNCPYSRC,SE2100I002
     ISEDEVDX
     I*
     I*  RENAME FIELDS ON SEDELX TO ACCESS SEPERATELY
     I*
     I              RECI                            XRECI
     I              SDSN                            XSDSN
     I              SDED                            XSDED
     I              SDET                            XSDET
     I              SDNV                            XSDNV
     I**************SDDV                            XSDDV                 E16772
     I              SDVA                            XSDVA                 E16772
     I              SDCP                            XSDCP
     I              SRPT                            XSRPT
     I              SDTR                            XSDTR
     I              SRMI                            XSRMI
     I              SDPD                            XSDPD
     I              SDNC                            XSDNC
     I              SDPP                            XSDPP
     I              SDPC                            XSDPC
     I              SDTA                            XSDTA
     I              SDTP                            XSDTP
     I              SDRP                            XSDRP
     I              SDCV                            XSDCV
     I              SDCX                            XSDCX                 E23049
     I              SDCE                            XSDCE
     I              SDMD                            XSDMD
     I              NMCY                            XSMCY
     I              SDAD                            XSDAD
     I              SDDT                            XSDDT
     I              LCD                             XLCD
     I              CHTP                            XCHTP
     I              TNLU                            XTNLU
     I              SDXD                            XSDXD                 S01510
     I              FRNT                            XFRNT                 CAP140
     I              REPA                            XREPA                 CAP140
     I              SCRS                            XSCRS                                     CAS006
     I              SLQP                            XSLQP                                     CAS006
     I              SDNN                            XSDNN                                     CAS006
     I              SDAL                            XSDAL                                     CSE065
     ISEDEVDU                                                             180385
     I*                                                                   180385
     I*  Rename fields on SECEU to access separately.                     180385
     I*                                                                   180385
     I              RECI                            RECIU                 180385
     I              SDSN                            UDSN                  180385
     I              SDED                            UDED                  180385
     I              SDET                            UDET                  180385
     I              SDNV                            UDNV                  180385
     I              SDVA                            UDVA                  180385
     I              SDCP                            UDCP                  180385
     I              SRPT                            URPT                  180385
     I              SDTR                            UDTR                  180385
     I              SRMI                            URMI                  180385
     I              SDPD                            UDPD                  180385
     I              SDNC                            UDNC                  180385
     I              SDPP                            UDPP                  180385
     I              SDPC                            UDPC                  180385
     I              SDTA                            UDTA                  180385
     I              SDTP                            UDTP                  180385
     I              SDRP                            UDRP                  180385
     I              SDCV                            UDCV                  180385
     I              SDCX                            UDCX                  180385
     I              SDCE                            UDCE                  180385
     I              SDMD                            UDMD                  180385
     I              NMCY                            UMCY                  180385
     I              SDAD                            UDAD                  180385
     I              SDDT                            UDDT                  180385
     I              LCD                             ULCD                  180385
     I              CHTP                            UCHTP                 180385
     I              TNLU                            UTNLU                 180385
     I*
      *                                                                                       CSE037
     IINVTPDF                                                                                 CSE037
     I              SFLG                            ISFLG                                     CSE037
     I*                                                                   S96032
     I/COPY WNCPYSRC,SE2100IIP1                                           S96032
     I*                                                                   S96032
     ITABKEY      DS
     I*
     I* DATA STRUCTURE FOR TABLE FILE KEY
     I*
     I                                        1  12 TKEY
     I                                        1   20RECT
     I                                        3  10 ZZ008
     I                                       11  120RCDE
     I*
     IINVTPK      DS
     I*
     I* DATA STRUCTURE FOR INVTP FILE KEY
     I*
     I                                        1   3 NMCY
     I                                        4   6 SITP
     I*
     I* DATA STRUCTURES FOR RPG 01021 ERROR HANDLING
     I*
     ISECDS       DS
     I                                     *STATUS  STSSEC
     IDELDS       DS
     I                                     *STATUS  STSDEL
     ISNDDS       DS
     I                                     *STATUS  STSSND
     ISNADS       DS
     I                                     *STATUS  STSSNA
     ICCDDS       DS
     I                                     *STATUS  STSCCD
     ICCADS       DS
     I                                     *STATUS  STSCCA
     I*
     I/COPY ZSRSRC,ZHOLI                                                  CSE023
     I/COPY ZSRSRC,ZNCDZ2
      *
     ILDA         DS                            256                       S01117
      *
      ***  Local Data Area for DB Error Information
      *
     I                                      134 183 DBLOT                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     I*LDA******* UDS                            256                      S01117
     I***********                           134 177 DBLOT                 S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 1770DBASE                 S01117
     I*                                                                   E20142
     I** SESTAT DATA STRUCTURE - FOR END OF MONTH DATE                    E20142
     IDTAARA    E DSSESTAT                                                E20142
     I*                                                                   E20142
     ICPYR@#      DS                                                      E20142
     I*
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I*
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
      *                                                                   CPB001
      **  External Data Structure for Midas Modules Details.              CPB001
     ISDMMOD    E DSSDMMODPD                                              CPB001
      *                                                                   CPB001
      **  First Data Structure for Access Programs, short Data Structure. CPB001
     IDSFDY     E DSDSFDY                                                 CPB001
      *                                                                   CPB001
      **  Second Data Structure for Access Programs, long Data Structure. CPB001
     IDSSDY     E DSDSSDY                                                 CPB001
      *                                                                   CPB001
     I/COPY WNCPYSRC,SE2100I001
      *                                                                                       CSE065
     I              'END OF AVERAGE LIFE' C         #CONS1                                    CSE065
      *                                                                                       CSE065
     C/EJECT
      *================================================================
      *  P R O G R A M   S T A R T                                    *
      *================================================================
     C*
     C* DEFINE FIELDS AND KEY LISTS
     C*
     C*    UPDATE AREA FOR SECURITY
     C*
     C           *LIKE     DEFN RECI      URECI
     C           *LIKE     DEFN LCPN      ULCPN
     C*                                                                   S96032
     C/COPY WNCPYSRC,SE2100CCP1                                           S96032
     C*                                                                   S96032
     C           *LIKE     DEFN CPNR      UCPNR
     C*                                                                   S96032
     C/COPY WNCPYSRC,SE2100CCP2                                           S96032
     C*                                                                   S96032
     C           *LIKE     DEFN CFCT      UCFCT
     C           *LIKE     DEFN CPDP      UCPDP
     C           *LIKE     DEFN SLCA      USLCA
     C           *LIKE     DEFN SEXR      USEXR
     C           *LIKE     DEFN SPYC      USPYC                           E23049
     C           *LIKE     DEFN SMDI      USMDI                           E23049
     C           *LIKE     DEFN SCPD      USCPD
     C           *LIKE     DEFN SCPP      USCPP
     C           *LIKE     DEFN SCPI      USCPI
     C********** *LIKE     DEFN LCCP      WLCCP                                        197357 211228
     C           *LIKE     DEFN ALDT      UALDT                                               CSE065
     C*
     C*    STORE FOR PREVIOUS COUPON RATE
     C*
     C           *LIKE     DEFN CFCT      PCFCT
     C*
     C*    STORE FOR SECURITY DIARY RECORD ID
     C*
     C           *LIKE     DEFN RECI      SRECI
     C           *LIKE     DEFN CPNN      UCPNN                                               CAS006
     C           *LIKE     DEFN CCRK      UCCRK                                               CAS006
     C           *LIKE     DEFN CLQP      UCLQP                                               CAS006
     C           *LIKE     DEFN CPNN      WCPNN                                               CAS006
     C*
     C*  KEY FIELD TO CHAIN TO SEDEL FOR UPDATE
     C*
     C           KSEDEL    KLIST
     C                     KFLD           XSDSN
     C                     KFLD           KEYDT
     C                     KFLD           XSDET
     C*                                                                   E15549
     C*  PARTIAL KEY TO ACCESS SEDEL FOR INITIAL RECORDS                  E15549
     C*                                                                   E15549
     C           PSEDEL    KLIST                                          E15549
     C                     KFLD           SESN                            E15549
     C                     KFLD           SDET                            E15549
     C                     KFLD           KEYDT                           E15549
     C*                                                                   E15549
     C*  KEY TO ACCESS SECEO TO CHECK FOR POSN SETTLEMENTS GENERATED      E15549
     C*                                                                   E15549
     C           SETGKY    KLIST                                          E15549
     C                     KFLD           SNSN                            E15549
     C                     KFLD           SNET                            E15549
     C                     KFLD           SNDT                            E15549
     C*                                                                   054498
     C*  KEY TO ACCESS SECEO TO CHECK FOR COUPON EVENTS                   054498
     C*                                                                   054498
     C           SNDVPK    KLIST                                          054498
     C                     KFLD           SNSN                            054498
     C                     KFLD           SNET                            054498
     C*
     C*  KEY FIELD TO CHAIN TO SECTY FOR UPDATE
     C*
     C           KSECTY    KLIST
     C                     KFLD           SESN
     C*
     C*  KEY FIELD TO READE ON SECET
     C*
     C           KSECET    KLIST
     C                     KFLD           XSDSN
     C                     KFLD           XSDET
     C*
     C*  KEY FIELD TO CHAIN TO SECET
     C*
     C           KSEC2     KLIST
     C                     KFLD           XSDSN
     C                     KFLD           XSDET
     C                     KFLD           XSDED
     C*
     C*  KEY FIELD TO CHAIN TO INVTP
     C*
     C           KINVTP    KLIST
     C                     KFLD           NMCY
     C                     KFLD           SITP
      **********                                                                       197357 211228
      ***Define*the*keylist*for*SNDEVDO*in*SECEO.**********************                197357 211228
      **********                                                                       197357 211228
     C********** KESNCP    KLIST                                                       197357 211228
     C**********           KFLD           SESN                                         197357 211228
     C**********           KFLD           SNET                                         197357 211228
     C**********           KFLD           SNDT                                         197357 211228
      *                                                                   CSE023
      ** Key list for Withholding Tax Treaty detail                       CSE023
      *                                                                   CSE023
     C           WHTKEY    KLIST                                          CSE023
     C                     KFLD           CRTT                            CSE023
     C                     KFLD           @INVT   3                       CSE023
      *
      *================================================================
      /EJECT
      *================================================================
      *  M A I N   P R O C E S S I N G                                *
      *================================================================
     C*                                                                   E15549
     C           *ENTRY    PLIST                                          E15549
     C                     PARM           ACRLRN  1                       E15549
     C*
     C* INITIALISATION
     C*
     C                     EXSR FIRST
     C*
     C* READ FIRST RECORD FROM SEDEL UNLESS ERROR
     C*
     C           *INU7     IFEQ '0'
     C                     EXSR GETDEL
     C                     END
     C*
     C* READ FIRST NON-DELETED NON-MATURED REC FROM SECTY UNLESS ERROR
     C*
     C           *INU7     IFEQ '0'
     C                     EXSR GETSEC
     C                     END
     C*
     C* PROCESS EACH SECURITY UNTIL EOF(SECTY) OR DATABASE ERROR
     C*
     C           *IN20     DOWEQ'0'
     C           *INU7     ANDEQ'0'
     C*
     C*  NEW SECURITY
     C*
     C*************        MOVE '  '      SAAT                     094576 143174
     C                     EXSR NEWSEC
     C*
     C*  PROCESS EACH DIARY RECORD FOR THIS SECURITY UNLESS EOF OR ERROR
     C*
     C           XSDSN     DOWEQSESN
     C           *IN25     ANDEQ'0'
     C           *INU7     ANDEQ'0'
     C*
     C                     EXSR PROCES
     C*
     C*  READ NEXT RECORD FROM SEDEL
     C*
     C                     EXSR GETDEL
     C                     END
     C*
     C*  END OF RECORDS FOR THIS SECURITY
     C*
     C                     EXSR ENDSEC
     C*
     C*  READ NEXT SECURITY FROM SECTY
     C*
     C                     EXSR GETSEC
     C                     END
     C*
     C* IF NO DATABASE ERRORS .....
     C*
     C           *INU7     IFEQ '0'
     C*
     C*    CHECK & UPDATE AUDIT FILES (SEDELA,SECTYA,SECACA,SNDEVA)
     C*
     C                     EXSR AUDIT
     C                     END
     C*
     C* PRINT CONTROL TOTALS REPORT OR ERROR MESSAGE
     C*
     C                     EXSR PRINT
      *
      *================================================================
      *  P R O G R A M   E N D                                        *
      *                                                               *
     C                     SETON                     LR
      *                                                               *
      *================================================================
      /EJECT
      *****************************************************************
      *                                                               *
      *  FIRST  - Initialisation Subroutine.                          *
      *                                                               *
      *  Called By: Main Processing.                                  *
      *  Calls: ZSYSTM, ZICD2                                         *   E15549
      *                                                               *
      *****************************************************************
      *
     C           FIRST     BEGSR                           *** FIRST  ***
     C*
     C*  PREPARE LDA
     C*
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL*BLANK    DBLOT
     C                     MOVEL'SE2100'  DBPGM
     C                     OUT  LDA                                       S01117
     C*
     C*  ZEROISE ACCUMULATORS
     C*
     C                     Z-ADD0         STOTI   50
     C                     Z-ADD0         STOTU   50
     C                     Z-ADD0         DTOTI   50
     C                     Z-ADD0         DTOTU   50
     C                     Z-ADD0         DTOTD   50
AW   C                     Z-ADD0         DTOTA   50
     C                     Z-ADD0         OTOT1   50
     C                     Z-ADD0         OTOT2   50
     C                     Z-ADD0         OTOT3   50
     C                     Z-ADD0         OTOT4   50                      E15549
     C                     Z-ADD0         OTOT5   50                      E15549
     C*
     C*  ACCESS ICD 1 (TABTB10)
     C*
     C                     EXSR ZSYSTM
     C*
     C*  ERROR IN ZSYSTM
     C*
     C           *IN,99    IFEQ '1'
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8            ***************
     C***********          MOVEL'01'      DBASE            * DB ERROR 01 *S01117
     C                     Z-ADD1         DBASE            * DB ERROR 01 *S01117
     C                     MOVEL'TABSE'   DBFILE           ***************
     C                     MOVELZTABKY    DBKEY
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C*
     C                     END
     C*
     C*  ACCESS ICD 2 (TABTB11)
     C*
     C           *INU7     IFNE '1'
     C*
     C                     EXSR ZICD2
     C*
     C*  ERROR IN ZICD2
     C*
     C           *INU8     IFEQ '1'                        ***************
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVEL'02'      DBASE            * DB ERROR 02 *S01117
     C                     Z-ADD2         DBASE            * DB ERROR 02 *S01117
     C                     MOVEL'TABSE'   DBFILE           ***************
     C                     MOVELTKEY      DBKEY
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C*
     C                     ELSE
     C*
     C** SET EVENT CONTROL DATE
     C*
     C***********APDA      IFLT DNWD                                      E15549
     C***********                                                         E15549
     C***********          EXSR ZEVCD                                     E15549
     C***********                                                         E15549
     C***********          ELSE                                           E15549
     C***********                                                         E15549
     C***********          Z-ADDDNWD      ECD                             E15549
     C***********                                                         E15549
     C***********          END                                            E15549
     C*                                                                   E15549
     C** ON ACCRUAL DATE FOLLOWED BY A NON WORKING DAY-                   E15549
     C**     SE2100 IS RUN TWICE:                                         E15549
     C**         - 1ST TIME PROCESSES EVENTS UP TO APDA                   E15549
     C**           (ACRLRN SET ACCORDING TO RUN,IE 3)                     E15549
     C**         - 2ND TIME PROCESSES EVENTS UP TO DNWD                   E15549
     C**           (ACRLRN SET TO 4)                                      E15549
     C** OTHERWISE -                                                      E15549
     C**     SE2100 IS RUN ONCE.PROCESSES EVENTS UP TO DNWD               E15549
     C**               (ACRLRN SET ACCORDING TO RUN,IE 1 OR 2)            E15549
     C*                                                                   054498
     C* DO THE ACCOUNTING OF SECURITIES FOR EVENTS UP TO                  054498
     C* A DATE 'AKDAT' DEFINED BY THE EVENT CONTROL DATE                  054498
     C*                                                                   054498
     C                     Z-ADDAPDA      ZZAPDT                          054498
     C                     Z-ADDDNWD      ZZDNWD                          054498
     C                     EXSR ZEVCD                                     054498
     C                     Z-ADDECD       AKDAT   50                      054498
     C*                                                                   054498
     C* DO POSITION SETTLEMENT PROCESSING OF SECURITIES FOR EVENTS        054498
     C* UP TO A DATE 'PSDAT'. SET THIS DATE TO THE NEXT WORKING DAY       054498
     C*                                                                   054498
     C                     Z-ADDDNWD      PSDAT   50                      054498
     C*                                                                   E15549
     C***********ACRLRN    IFNE '3'                                E15549 054498
     C***********          Z-ADDDNWD      ECD     50               E15549 054498
     C***********          ELSE                                    E15549 054498
     C***********          Z-ADDAPDA      ECD                      E15549 054498
     C***********          END                                     E15549 054498
     C***********                                                  E20142 054498
     C***Get*Data Area SESTAT and set up end of current month.     E20142 054498
     C***********                                                  E20142 054498
     C************NAMVAR   DEFN SESTAT    DTAARA                   E20142 054498
     C***********          IN   DTAARA                             E20142 054498
     C***********          MOVELEOPT      EOMDAT  50               E20142 054498
     C*
     C*                                                                   S96032
     C/COPY WNCPYSRC,SE2100CCP3                                           S96032
     C*                                                                   S96032
     C                     END
     C                     END
      *                                                                   CSE023
      ** Check if CSE023 - Treaty Withholding Tax present                 CSE023
      *                                                                   CSE023
     C                     MOVE 'N'       CSE023  1                       CSE023
     C                     CALL 'AOSARDR0'                                CSE023
     C                     PARM *BLANKS   @RTCD   7                       CSE023
     C                     PARM '*VERIFY' @OPTN   7                       CSE023
     C                     PARM 'CSE023'  @SARD   6                       CSE023
      *                                                                   CSE023
     C           @RTCD     IFEQ *BLANK                                    CSE023
     C                     MOVE 'Y'       CSE023                          CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CPB001
      **  Call Access Program for Midas Modules Details.                  CPB001
     C                     CALL 'AOMMODR0'                                CPB001
     C                     PARM *BLANKS   P@RTCD  7                       CPB001
     C                     PARM '*FIRST  'P@OPTN  7                       CPB001
     C           SDMMOD    PARM SDMMOD    DSFDY                           CPB001
      *                                                                   CPB001
      **  If Modules Details do not exist, handle Database Error.         CPB001
     C           P@RTCD    IFNE *BLANK                      Begin P@RTCD  CPB001
     C           *LOCK     IN   LDA                                       CPB001
     C                     MOVEL'SDMMODPD'DBFILE           ***************CPB001
     C                     Z-ADD14        DBASE            * DB ERROR 91 *CPB001
     C                     MOVELP@OPTN    DBKEY            ***************CPB001
     C                     OUT  LDA                                       CPB001
     C                     SETON                     U7U8LR               CPB001
     C                     EXSR *PSSR                                     CPB001
      *                                                                   CPB001
      ** If no error occurred.                                            CPB001
     C                     ELSE                             Else P@RTCD   CPB001
      *                                                                   CPB001
      ** If Private Banking Module is installed.                          CPB001
      *                                                                   CPB001
     C           BGN4ST    IFEQ 'Y'                         Begin BGN4ST  CPB001
      *                                                                   CPB001
      ** Set up Replication Processing Indicator.                         CPB001
     C                     MOVE 'Y'       WUREPL  1                       CPB001
      *                                                                   CPB001
     C                     ENDIF                            End BGN4ST    CPB001
      *                                                                   CPB001
     C                     ENDIF                            End P@RTCD    CPB001
      *                                                                   CSE031
      ** Check if CSE031 is switched on.                                  CSE031
      *                                                                   CSE031
     C                     CALL 'AOSARDR0'                                CSE031
     C                     PARM           PRTCD   7                       CSE031
     C                     PARM '*VERIFY' POPTN   7                       CSE031
     C                     PARM 'CSE031'  PSARD   6                       CSE031
      *                                                                   CSE031
     C           PRTCD     IFEQ *BLANKS                                   CSE031
     C                     MOVE 'Y'       CSE031  1                       CSE031
     C                     ELSE                                           CSE031
     C                     MOVE 'N'       CSE031                          CSE031
     C                     ENDIF                                          CSE031
      *                                                                   CSE071
      ** Check if CSE071 is switched on.                                  CSE071
      *                                                                   CSE071
     C                     CALL 'AOSARDR0'                                CSE071
     C                     PARM           PRTCD                           CSE071
     C                     PARM '*VERIFY' POPTN                           CSE071
     C                     PARM 'CSE071'  PSARD                           CSE071
      *                                                                   CSE071
     C           PRTCD     IFEQ *BLANKS                                   CSE071
     C                     MOVE 'Y'       CSE071  1                       CSE071
     C                     ELSE                                           CSE071
     C                     MOVE 'N'       CSE071                          CSE071
     C                     ENDIF                                          CSE071
      *                                                                                       CSE035
      ** Access SAR details file to see if CSE035 is installed                                CSE035
      *                                                                                       CSE035
     C                     CALL 'AOSARDR0'                                                    CSE035
     C                     PARM *BLANKS   @RTCD   7                                           CSE035
     C                     PARM '*VERIFY' @OPTN   7                                           CSE035
     C                     PARM 'CSE035'  @SARD   6                                           CSE035
      *                                                                                       CSE035
     C           @RTCD     IFEQ *BLANK                                                        CSE035
     C                     MOVE 'Y'       CSE035  1                                           CSE035
     C                     ELSE                                                               CSE035
     C                     MOVE 'N'       CSE035                                              CSE035
     C                     ENDIF                                                              CSE035
     C*                                                                   S96032
      ** Determine if CAS006 is installed                                                     CAS006
      *                                                                                       CAS006
     C                     CALL 'AOSARDR0'                                                    CAS006
     C                     PARM *BLANKS   PRTCD                                               CAS006
     C                     PARM '*VERIFY' POPTN                                               CAS006
     C                     PARM 'CAS006'  PSARD                                               CAS006
      *                                                                                       CAS006
      ** Process database error                                                               CAS006
      *                                                                                       CAS006
     C           PRTCD     IFNE *BLANKS                                                       CAS006
     C           PRTCD     ANDNE'*NRF   '                                                     CAS006
     C           *LOCK     IN   LDA                                                           CAS006
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS006
     C                     MOVEL'CAS006 ' DBKEY                                               CAS006
     C                     Z-ADD15        DBASE                                               CAS006
     C                     OUT  LDA                                                           CAS006
     C                     MOVE *ON       *INU7                                               CAS006
     C                     MOVE *ON       *INU8                                               CAS006
     C                     MOVE *ON       *INLR                                               CAS006
     C                     EXSR *PSSR                                                         CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C           PRTCD     IFEQ *BLANK                                                        CAS006
     C                     MOVE 'Y'       CAS006  1                                           CAS006
     C                     ELSE                                                               CAS006
     C                     MOVE 'N'       CAS006                                              CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
      ** Check if CSE065 is switched on.                                                      CSE065
      *                                                                                       CSE065
     C                     CALL 'AOSARDR0'                                                    CSE065
     C                     PARM           PRTCD                                               CSE065
     C                     PARM '*VERIFY' POPTN                                               CSE065
     C                     PARM 'CSE065'  PSARD                                               CSE065
      *                                                                                       CSE065
      ** Process database error                                                               CSE065
      *                                                                                       CSE065
     C           PRTCD     IFNE *BLANKS                                                       CSE065
     C           PRTCD     ANDNE'*NRF   '                                                     CSE065
     C           *LOCK     IN   LDA                                                           CSE065
     C                     MOVEL'SCSARDPD'DBFILE                                              CSE065
     C                     MOVEL'CSE065 ' DBKEY                                               CSE065
     C                     Z-ADD16        DBASE                                               CSE065
     C                     OUT  LDA                                                           CSE065
     C                     MOVE *ON       *INU7                                               CSE065
     C                     MOVE *ON       *INU8                                               CSE065
     C                     MOVE *ON       *INLR                                               CSE065
     C                     EXSR *PSSR                                                         CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
      *                                                                                       CSE065
     C           PRTCD     IFEQ *BLANKS                                                       CSE065
     C                     MOVE 'Y'       CSE065  1                                           CSE065
     C                     ELSE                                                               CSE065
     C                     MOVE 'N'       CSE065                                              CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C/COPY WNCPYSRC,SE2100CP11                                           S96032
     C*                                                                   S96032
      *                                                                                       CSE075
      ** Check if CSE075 is switched on.                                                      CSE075
      *                                                                                       CSE075
     C                     CALL 'AOSARDR0'                                                    CSE075
     C                     PARM           PRTCD                                               CSE075
     C                     PARM '*VERIFY' POPTN                                               CSE075
     C                     PARM 'CSE075'  PSARD                                               CSE075
      *                                                                                       CSE075
      ** Process database error                                                               CSE075
      *                                                                                       CSE075
     C           PRTCD     IFNE *BLANKS                                                       CSE075
     C           PRTCD     ANDNE'*NRF   '                                                     CSE075
     C           *LOCK     IN   LDA                                                           CSE075
     C                     MOVEL'SCSARDPD'DBFILE                                              CSE075
     C                     MOVEL'CSE075 ' DBKEY                                               CSE075
     C                     Z-ADD17        DBASE                                               CSE075
     C                     OUT  LDA                                                           CSE075
     C                     MOVE *ON       *INU7                                               CSE075
     C                     MOVE *ON       *INU8                                               CSE075
     C                     MOVE *ON       *INLR                                               CSE075
     C                     EXSR *PSSR                                                         CSE075
     C                     ENDIF                                                              CSE075
      *                                                                                       CSE075
     C           PRTCD     IFEQ *BLANKS                                                       CSE075
     C                     MOVE 'Y'       CSE075  1                                           CSE075
     C                     ELSE                                                               CSE075
     C                     MOVE 'N'       CSE075                                              CSE075
     C                     ENDIF                                                              CSE075
      *                                                                                       CSE075
      ** Access Switchable Features file to determine if CSE031 is                          MD057247
      ** installed in the system.                                                           MD057247
      *                                                                                     MD057247
     C                     CALL 'AOSARDR0'                                                  MD057247
     C                     PARM           URTNCD  7                                         MD057247
     C                     PARM '*VERIFY' UOPTN   7                                         MD057247
     C                     PARM 'CSE031'  UUKEY   6                                         MD057247
     C                     PARM           UDSFDY 76                                         MD057247
      *                                                                                     MD057247
     C                     MOVE 'N'       CSE031  1                                         MD057247
     C           URTNCD    IFEQ *BLANKS                                                     MD057247
     C                     MOVE 'Y'       CSE031                                            MD057247
     C                     ENDIF                                                            MD057247
      *                                                                                     MD057247
      ** Access Switchable Features file to determine if CSE071 is                          MD057247
      ** installed in the system.                                                           MD057247
      *                                                                                     MD057247
     C                     CALL 'AOSARDR0'                                                  MD057247
     C                     PARM           URTNCD                                            MD057247
     C                     PARM '*VERIFY' UOPTN                                             MD057247
     C                     PARM 'CSE071'  UUKEY                                             MD057247
     C                     PARM           UDSFDY                                            MD057247
      *                                                                                     MD057247
     C                     MOVE 'N'       CSE071  1                                         MD057247
     C           URTNCD    IFEQ *BLANKS                                                     MD057247
     C                     MOVE 'Y'       CSE071                                            MD057247
     C                     ENDIF                                                            MD057247
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  NEWSEC - Subroutine to process change of Security.           *
      *                                                               *
      *  Called By: Main Processing.                                  *
      *  Calls: ZNCD, OUTW01                                          *
      *                                                               *
      *****************************************************************
      *
     C           NEWSEC    BEGSR                           *** NEWSEC ***
     C*
     C* INITIALISE UPDATE INDICATORS
     C*
     C                     MOVEA'0000000' *IN,40
      *                                                                                       CSE065
     C                     MOVE '0'       *IN48                                               CSE065
     C*
     C                     Z-ADDNCD       WNCD    50                      206316
     C                     Z-ADD*ZERO     NCD
     C*
     C* STORE ORIGINAL VALUES IN UPDATE FIELDS
     C*
     C                     MOVELRECI      URECI
     C                     Z-ADDLCPN      ULCPN
     C                     Z-ADDCPNR      UCPNR
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     Z-ADDCPNN      UCPNN                                               CAS006
     C                     Z-ADDCCRK      UCCRK                                               CAS006
     C                     Z-ADDCLQP      UCLQP                                               CAS006
     C                     ENDIF                                                              CAS006
     C*                                                                   S96032
     C/COPY WNCPYSRC,SE2100CCP4                                           S96032
     C*                                                                   S96032
     C                     Z-ADDCFCT      UCFCT
     C                     Z-ADDCPDP      UCPDP
     C                     Z-ADDSLCA      USLCA
     C                     Z-ADDSEXR      USEXR
     C                     MOVE SPYC      USPYC                           E23049
     C                     MOVE SMDI      USMDI                           E23049
     C                     Z-ADDSCPD      USCPD
     C                     Z-ADDSCPP      USCPP
     C                     MOVELSCPI      USCPI
     C*
     C* STORE PREVIOUS COUPON RATE
     C*
     C                     Z-ADDCFCT      PCFCT
     C*                                                                   E15549
     C*  DETERMINE TRUE MATURITY DATE                                     E15549
     C*                                                                   E15549
     C***        LTMI      IFEQ 'Y'                                 E15549102885
     C***        MATY      ADD  36525     XMATY   50                E15549102885
     C***                  ELSE                                     E15549102885
     C***                  Z-ADDMATY      XMATY                     E15549102885
     C***                  END                                      E15549102885
     C                     Z-ADDMATY      XMATY   50                      102885
     C*
     C*  ORIGINAL ENTRY DATE = RUN DATE - OUTPUT INITIAL VALUE RECORD
     C*  (AND IF THIS IS NOT THE 2ND RUN OF SE2100 TODAY)                 E15549
     C*
     C           ORED      IFEQ RUND
     C           ACRLRN    ANDNE'4'                                       E15549
     C                     EXSR OUTW04
     C                     END
     C*
     C* SEE WHETHER SECURITY IS COMPLETE
     C*
     C           INCS      IFEQ 'C'
      *
      **  NO COUPON RECORDS FOR PROCESSING TYPE 2,4,OR 7
      **                     OR DISCOUNTED RECORDS
      *
     C           PROT      IFNE '2'
     C           PROT      ANDNE'4'
     C           PROT      ANDNE'7'
     C           STBS      ANDNE'D'
     C********** CPNR      ANDNE*ZERO                                                054498 MD049798
     C           CD01      ANDNE*ZERO                                     054498
      *                                                                   206316
      ** If CSE031 is ON, and Coupon Due Event on Security Non-Diary      206316
      ** Events file is present, Set the Event Date on the Non-Diary      206316
      ** Events file to be the Next Coupon Date on the Securities file.   206316
      *                                                                   206316
 B1  C           CSE031    IFEQ 'Y'                                       206316
     C           BCNV      ANDNE' '                                       206316
     C           BCNV      ANDNE'N'                                       206316
     C           CSE071    OREQ 'Y'                                       CSE071
     C           BCNV      ANDNE' '                                       CSE071
     C           BCNV      ANDNE'N'                                       CSE071
     C                     Z-ADDWNCD      NCD                             206316
      *                                                                   206316
     C                     MOVELSESN      SNSN                            206316
     C                     MOVEL'CG'      SNET                            206316
     C                     Z-ADD*HIVAL    SNDT                            206316
     C           SETGKY    SETGTSNDEVDO                                   206316
     C           SNDVPK    READESNDEVDO                  99               206316
 B2  C           *IN,99    IFEQ '0'                                       206316
     C           RECI      ANDEQ'D'                                       206316
      *                                                                   206316
 B3  C           SNDT      IFGT LCPN                                      206316
     C           NCD       ANDGTSNDT                                      206316
     C                     Z-ADDNCD       SNDT                            206316
     C                     UPDATSNDEVDO                                   206316
 E3  C                     ENDIF                                          206316
 E2  C                     ENDIF                                          206316
      *                                                                   206316
 E1  C                     ENDIF                                          206316
     C*
     C* IF APPLICABLE, CALCULATE NEXT COUPON DATE
     C*
     C*                                                                   054498
     C* IF COUPON DUE EVENT ON SECURITY NON-DIARY EVENTS FILE IS PRESENT  054498
     C* USE THE DATE ON IT AS THE NEXT COUPON DATE                        054498
     C*                                                                   054498
     C                     MOVELSESN      SNSN                            054498
     C                     MOVEL'CG'      SNET                            054498
     C                     Z-ADD*HIVAL    SNDT                            054498
     C           SETGKY    SETGTSNDEVDO                                   054498
     C           SNDVPK    READESNDEVDO                  99               054498
     C           *IN,99    IFEQ '0'                                       054498
     C           RECI      ANDEQ'D'                                       054498
     C**********           Z-ADDSNDT      NCD                      054498 197357
     C                     Z-ADDSNDT      NCD                                                 211228
     C                     Z-ADDSNDT      XNCD    50                      197357
     C                     Z-ADDXNCD      ZZNCD                           180707
     C**********           MOVELSESN      SNSN                                         197357 211228
     C**********           MOVEL'CP'      SNET                                         197357 211228
     C**********           Z-ADD*HIVAL    SNDT                                         197357 211228
     C********** SETGKY    SETGTSNDEVDO                                                197357 211228
     C********** SNDVPK    READESNDEVDO                  99                            197357 211228
     C********** *IN,99    IFEQ '0'                                                    197357 211228
     C********** SNDT      ADD  1         ECD                                          197357 211228
     C**********           ELSE                                                        197357 211228
     C**********           Z-ADDRUND      ECD                                          197357 211228
     C**********           ENDIF                                                       197357 211228
     C**********           EXSR ZNCD                                                   197357 211228
     C**********           ENDIF                                                       197357 211228
      **********                                                                       197357 211228
     C********** XNCD      IFEQ NCD                                                    197357 211228
     C**********           MOVE XNCD      NCD                                          197357 211228
     C**********           ELSE                                                        197357 211228
      **********                                                                       197357 211228
     C**********           MOVEL*BLANKS   AKRI                                         197357 211228
     C**********           MOVELSESN      SNSN                                         197357 211228
     C**********           MOVEL'CG'      SNET                                         197357 211228
     C**********           Z-ADDXNCD      SNDT                                         197357 211228
     C********** SETGKY    CHAINSNDEVDO              99                                197357 211228
     C********** *IN,99    IFEQ '0'                                                    197357 211228
     C**********           MOVEL*BLANK    PSRI                                         197357 211228
     C**********           MOVEL'*'       RECI                                         197357 211228
     C**********           UPDATSNDEVDO                                                197357 211228
     C**********           SUB  1         OTOT4                                        197357 211228
     C**********           ENDIF                                                       197357 211228
     C**********           ENDIF                                                       197357 211228
      **********                                                                       197357 211228
     C**********           ELSE                                    054498 197357
     C                     ELSE                                                               211228
      **********                                                                       197357 211228
     C********** *IN,99    IFEQ '1'                                                    197357 211228
     C********** *IN,99    OREQ '0'                                                    197357 211228
     C********** RECI      ORNE 'D'                                                    197357 211228
     C*                                                                   054498
     C* IF LAST COUPON EVENT ON SECURITY NON-DIARY EVENTS FILE IS PRESENT 054498
     C* USE THE DATE ON IT TO DETERMINE THE NEXT COUPON DATE              054498
     C* ELSE USE THE RUN DATE TO DETERMINE THE NEXT COUPON DATE           054498
     C*                                                                   054498
     C                     MOVEL'CP'      SNET                            054498
     C                     Z-ADD*HIVAL    SNDT                            054498
     C           SETGKY    SETGTSNDEVDO                                   054498
     C           SNDVPK    READESNDEVDO                  99               054498
     C           *IN,99    IFEQ '0'                                       054498
     C*                                                                   182505
     C           BCNV      IFNE ' '                                       182505
     C           BCNV      ANDNE'N'                                       CSE031
     C                     Z-ADDSNDT      ZDAYNO                          182505
     C                     MOVE NMCY      ZCCY                            182505
     C                     MOVE *BLANKS   ZLOC                            182505
     C                     Z-ADD1         ZNRDYS                          182505
     C                     EXSR ZFWDT                                     182505
     C                     Z-ADDZDYNBR    ECD                             182505
     C                     ELSE                                           182505
     C           SNDT      ADD  1         ECD                             054498
     C                     ENDIF                                          182505
     C*                                                                   182505
     C                     ELSE                                           054498
     C                     Z-ADDRUND      ECD                             054498
     C                     END                                            054498
     C                     EXSR ZNCD                                      054498
     C                     END                                            054498
      *****Correct*method for getting Next Coupon Date.            E20085 054498
      ***********                                                  E20085 054498
     C***********          Z-ADDECD       SECD    50               E15549 054498
     C***********          Z-ADDULCPN     ECD                      E15549 E20085
     C***********NCD       DOWLTRUND                               E15549 E20085
     C***********CPNR      ANDNE*ZERO                              E15549 E20085
      ***********                                                  E20085 054498
      *****To*prevent duplication of entries, type '4' run must useE20142 054498
      *****tomorrow as Start Date for ZNCD, except when DNWD is in E20142 054498
      *****next*month, in which case Start Date should be first dayE20142 054498
      *****next*month since EGEN1 will have handled coupons throughE20142 054498
      ***********                                                  E20142 054498
     C***********ACRLRN    IFNE '4'                                E20142 054498
     C***********          Z-ADDRUND      ECD                      E20085 054498
     C***********          ELSE                                    E20142 054498
     C***********DNWD      IFLE EOMDAT                             E20142 054498
     C***********RUND      ADD  1         ECD                      E20142 054498
     C***********          ELSE                                    E20142 054498
     C***********EOMDAT    ADD  1         ECD                      E20142 054498
     C***********          END                                     E20142 054498
     C***********          END                                     E20142 054498
      ***********                                                  E20142 054498
     C***********CPNR      IFNE *ZERO                              E20085 054498
     C***********CD01      ANDNE*ZERO                              E15549 054498
     C***********NCD       ANDLTXMATY                              E18013 E20085
     C***********          EXSR ZNCD                                      054498
     C***********          Z-ADDNCD       ECD                      E15549 E20085
     C***********          END                                     E15549 054498
     C***********          Z-ADDSECD      ECD                      E15549 054498
     C                     END
      *                                                                   CSE023
      ** If CSE023 is present and Country of Treaty on the Securities     CSE023
      ** Detail is not equal to Blank, then calculate the Allocation      CSE023
      ** Date for the Maturity/Coupon Event.                              CSE023
      *                                                                   CSE023
     C           CSE023    IFEQ 'Y'                                       CSE023
     C           CRTT      ANDNE*BLANKS                                   CSE023
      *                                                                   CSE023
     C                     MOVE SITP      @INVT                           CSE023
     C           WHTKEY    CHAINSDWHTTL5             50                   CSE023
     C           *IN50     IFEQ '1'                                       CSE023
     C**********           MOVE '  '      @INVT                    CSE023 185803
     C                     MOVE *BLANKS   @INVT                           185803
     C           WHTKEY    CHAINSDWHTTL5             50                   CSE023
     C           *IN50     IFEQ '1'                                       CSE023
     C                     Z-ADD1         WTALDY                          CSE023
     C                     ENDIF                                          CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
      ** If maturity date is not equal to zero then calculate             CSE023
      ** allocation date.                                                 CSE023
      *                                                                   CSE023
     C                     Z-ADD0         MALOCD                          CSE023
     C           MATY      IFNE 0                                         CSE023
     C                     Z-ADDMATY      ZDAYNO                          CSE023
     C                     Z-ADD2         ZNRDYS                          CSE023
     C                     Z-ADDWTALDY    ZNRDYS                          CSE023
     C                     MOVE NMCY      ZCCY                            CSE023
     C                     MOVE *BLANKS   ZLOC                            CSE023
     C                     EXSR ZBKDT                                     CSE023
     C                     Z-ADDZDYNBR    MALOCD  50                      CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
      ** If the Security is interest bearing, then calculate              CSE023
      ** allocation date for Coupon.                                      CSE023
      *                                                                   CSE023
     C                     Z-ADD0         CALOCD                          CSE023
     C           PROT      IFNE '2'                                       CSE023
     C           PROT      ANDNE'4'                                       CSE023
     C           PROT      ANDNE'7'                                       CSE023
     C           STBS      ANDNE'D'                                       CSE023
     C           CPNR      ANDNE*ZERO                                     CSE023
     C           CD01      ANDNE*ZERO                                     CSE023
     C                     Z-ADDNCD       ZDAYNO                          CSE023
     C                     Z-ADD2         ZNRDYS                          CSE023
     C                     Z-ADDWTALDY    ZNRDYS                          CSE023
     C                     MOVE NMCY      ZCCY                            CSE023
     C                     MOVE *BLANKS   ZLOC                            CSE023
     C                     EXSR ZBKDT                                     CSE023
     C                     Z-ADDZDYNBR    CALOCD  50                      CSE023
     C                     ENDIF                                          CSE023
     C                     ENDIF                                          CSE023
     C*                                                                   CSE023
     C/COPY WNCPYSRC,SE2100C006
     C*
     C*  SECURITY HAS BEEN COMPLETED TODAY
     C*  (AND IF THIS IS NOT THE 2ND RUN OF SE2100 TODAY)                 E15549
     C*
     C           RUND      IFEQ DCOM
     C           DCOM      ANDNEORED
     C           ACRLRN    ANDNE'4'                                       E15549
     C*                                                                   E15549
     C* UPDATE THE INITIAL RECORDS WITH THE CURRENT DETAILS               E15549
     C*                                 OFF LF/SECTY                      E15549
     C*                                                                   E15549
     C                     Z-ADD*ZERO     KEYDT   50                      E15549
     C                     Z-ADD1         CNT     20                      E15549
     C*                                                                   E15549
     C********** CNT       DOUGT4                                                      E15549 CSE065
     C           CNT       DOUGT5                                                             CSE065
     C*                                                                   E15549
     C                     MOVELETP,CNT   SDET                            E15549
     C***********PSEDEL    CHAINSECET                30            E15549 180385
     C           PSEDEL    CHAINSECEU                30                   180385
     C*                                                                   E15549
     C           *IN30     IFEQ '0'                                       E15549
     C*                                                                   E15549
     C***********CDET      IFEQ 'XR'                               E15549 180385
     C***********          Z-ADDSEXR      CDCE                     E15549 180385
     C***********          MOVE SPYC      CDCX                     E23049 180385
     C***********          MOVE SMDI      CDMD                     E23049 180385
     C***********          END                                     E15549 180385
     C***********CDET      IFEQ 'IR'                               E15549 180385
     C***********          Z-ADDCPNR      CDNC                     E15549 180385
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     Z-ADDCPNN      CDNN                                                CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C/COPY WNCPYSRC,SE2100C021
     C***********          END                                     E15549 180385
     C***********CDET      IFEQ 'MP'                               E15549 180385
     C***********          Z-ADDCFCT      CDCP                     E15549 180385
     C***********          END                                     E15549 180385
     C***********CDET      IFEQ 'PP'                               E15549 180385
     C***********CDPC      IFEQ *ZERO                              E15549 E23049
     C***********PROT      IFEQ '4'                                E23049 180385
     C***********          MOVE CPDP      CDPP                     E15549 180385
     C***********          MOVE CPDP      CDTA                     E23049 180385
     C***********          ELSE                                    E15549 180385
     C***********          MOVE CPDP      CDPC                     E15549 180385
     C***********          MOVE CPDP      CDTP                     E23049 180385
     C***********          END                                     E15549 180385
     C***********          END                                     E15549 180385
      *                                                                                       CSE065
     C           CDET      IFEQ 'AL'                                                          CSE065
     C           CSE065    ANDEQ'Y'                                                           CSE065
     C                     Z-ADDALDT      SDAL                                                CSE065
     C                     END                                                                CSE065
      *                                                                   180385
      ** Renamed fields                                                   180385
      *                                                                   180385
     C           UDET      IFEQ 'XR'                                      180385
     C                     Z-ADDSEXR      UDCE                            180385
     C                     MOVE SPYC      UDCX                            180385
     C                     MOVE SMDI      UDMD                            180385
     C                     END                                            180385
     C           UDET      IFEQ 'IR'                                      180385
     C                     Z-ADDCPNR      UDNC                            180385
     C                     END                                            180385
     C           UDET      IFEQ 'MP'                                      180385
     C                     Z-ADDCFCT      UDCP                            180385
     C                     END                                            180385
     C           UDET      IFEQ 'PP'                                      180385
     C           PROT      IFEQ '4'                                       180385
     C                     MOVE CPDP      UDPP                            180385
     C                     MOVE CPDP      UDTA                            180385
     C                     ELSE                                           180385
     C                     MOVE CPDP      UDPC                            180385
     C                     MOVE CPDP      UDTP                            180385
     C                     END                                            180385
     C                     END                                            180385
     C*                                                                   E15549
     C***********          UPDATSEDEVDC                            E15549 180385
     C                     UPDATSEDEVDU                                   180385
     C                     END                                            E15549
     C                     ADD  1         CNT                             E15549
     C                     END                                            E15549
     C*
     C                     END
     C*                                                                   S96032
     C/COPY WNCPYSRC,SE2100CCP5                                           S96032
     C*                                                                   S96032
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  PROCES - Subroutine to process each Input Diary Event (SEDEL)*
      *                                                               *
      *  Called By: Main Processing.                                  *
      *  Calls: ZNCD, OUTW01, OUTW03, UPDDEL                          *
      *                                                               *
      *****************************************************************
      *
     C           PROCES    BEGSR                           *** PROCES ***
     C***********                                                   E15549E23049
     C**SEC.*DIARY*EVENTS*NOT*DUE*AND*FLAGGED*FOR*DELETION*-*DELETE*THEM49E23049
     C***********                                                   E15549E23049
     C*** SEC. DIARY EVENTS NOT POSTED AND FLAGGED FOR DETETE - DELETE IT E23049
     C*                                                                   E15549
     C***********XSDED     IFGT ECD                                E15549 E23049
     C***********XRECI     ANDEQ'C'                                E15549 E23049
     C           XRECI     IFEQ 'C'                                       E23049
     C           XSDAD     ANDEQ*ZERO                                     E23049
     C           XSDDT     ANDEQ*ZERO                                     E23049
     C                     MOVE '1'       *IN47                           183206
     C                     EXSR UPDDEL                                    E15549
     C                     MOVE '0'       *IN47                           183206
     C                     GOTO EPROCS                                    E15549
     C                     END                                            E15549
     C*
     C*  CHECK FOR NO POSITION ACTION
     C*  AND EVENT DATE DUE                                               E15549
     C*
     C           XSDET     IFEQ 'XR'                                      054498
     C           XSDED     ANDLEAKDAT                                     054498
     C           XSDET     OREQ 'RC'                                      054498
     C           USCPD     ANDLEAKDAT                                     054498
     C           XSDET     OREQ 'RP'                                      054498
     C           USCPD     ANDLEAKDAT                                     054498
     C           XSDET     OREQ 'RP'                                      054498
     C           USCPD     ANDGEXSDED                                     054498
     C           XSDET     OREQ 'RC'                                      054498
     C           USCPD     ANDGEXSDED                                     054498
     C           XSDET     OREQ 'OC'                                      048059
     C           XSDED     ANDLTAKDAT                                     048059
     C***********XSDET     IFNE 'DV'                                      E23049
     C***********XSDET     ANDNE'PP'                                      E23049
     C***********XSDET     ANDNE'MP'                                      E23049
     C***********XSDET     ANDNE'IR'                                      E23049
     C***********XSDED     ANDLTECD                                E15549 E23049
     C***********XSDET     IFEQ 'XR'                               E23049 054498
     C***********XSDED     ANDLEECD                                E23049 E23802
     C***********XSDED     ANDLTECD                                E23802 054498
     C***********XSDET     OREQ 'XR'                               E23802 054498
     C***********XSDED     ANDLEECD                                E23802 054498
     C***********ACRLRN    ANDEQ'3'                                E23802 054498
     C***********                                                  E23049 054498
     C****Update*Next Redemption Price if Previous price Expired, oE23049 054498
     C****the*new Redemption price is On or Before the current PricE23049 054498
     C***********                                                  E23049 054498
     C***********XSDET     OREQ 'RC'                               E23049 054498
     C***********USCPD     ANDLTECD                                E23049 054498
     C***********XSDET     OREQ 'RP'                               E23049 054498
     C***********USCPD     ANDLTECD                                E23049 054498
     C***********XSDET     OREQ 'RP'                               E23049 054498
     C***********USCPD     ANDGEXSDED                              E23049 054498
     C***********XSDET     OREQ 'RC'                               E23049 054498
     C***********USCPD     ANDGEXSDED                              E23049 054498
     C*****************************************************************   E23049
     C**LIVE*SEC.DIARY*EVENTS**************************************E15549 E23049
     C*************************************************************E15549 E23049
     C***********XRECI     IFEQ 'D'                                       E23049
     C*
     C*  UPDATE SECURITY FIELDS ACCORDING TO WHETHER SECURITY SHOULD
     C*  BE UPDATED AND IF SO BY EVENT TYPE
     C*
     C           UPDSEC    IFEQ 'Y'
     C*
     C           XSDET     IFEQ 'XR'
     C                     Z-ADDXSDCE     USEXR
     C                     MOVE XSDCX     USPYC                           E23049
     C                     MOVE XSDMD     USMDI                           E23049
     C                     MOVEA'1'       *IN,45
     C                     END
     C*
     C           XSDET     IFEQ 'RC'
     C***********USCPI     ANDEQ*BLANK                                    E23049
     C********** XSDED     ANDLEECD                                077649 183206
     C           XSDED     ANDLEAKDAT                                     183206
     C                     Z-ADDXSDED     USCPD
     C                     Z-ADDXSDRP     USCPP
     C                     MOVEL'C'       USCPI
     C                     MOVEA'1'       *IN,46
     C                     END
     C*
     C           XSDET     IFEQ 'RP'
     C***********USCPI     ANDEQ*BLANK                                    E23049
     C********** XSDED     ANDLEECD                                077649 183206
     C           XSDED     ANDLEAKDAT                                     183206
     C                     Z-ADDXSDED     USCPD
     C                     Z-ADDXSDRP     USCPP
     C                     MOVEL'P'       USCPI
     C                     MOVEA'1'       *IN,46
     C                     END
     C*
     C                     ELSE
     C           UPDSEC    IFEQ 'C'
     C*
     C           XSDET     IFEQ 'XR'
     C                     Z-ADDCDCE      USEXR
     C                     MOVE CDCX      USPYC                           E23049
     C                     MOVE CDMD      USMDI                           E23049
     C                     MOVEA'1'       *IN,45
     C                     END
     C*
     C           XSDET     IFEQ 'RC'
     C***********USCPI     ANDEQ*BLANK                                    E23049
     C           XSDED     ANDLEECD                                       077649
     C                     Z-ADDCDED      USCPD
     C                     Z-ADDCDRP      USCPP
     C                     MOVEL'C'       USCPI
     C                     MOVEA'1'       *IN,46
     C                     END
     C*
     C           XSDET     IFEQ 'RP'
     C***********USCPI     ANDEQ*BLANK                                    E23049
     C           XSDED     ANDLEECD                                       077649
     C                     Z-ADDCDED      USCPD
     C                     Z-ADDCDRP      USCPP
     C                     MOVEL'P'       USCPI
     C                     MOVEA'1'       *IN,46
     C                     END
     C*
     C                     ELSE
     C           UPDSEC    IFEQ 'Z'
     C*
     C           XSDET     IFEQ 'XR'
     C                     Z-ADD*ZERO     USEXR
     C                     MOVE *BLANK    USPYC                           E23049
     C                     MOVE *BLANK    USMDI                           E23049
     C                     MOVEA'1'       *IN,45
     C                     END
     C*
     C           XSDET     IFEQ 'RC'
     C***********USCPI     ANDEQ*BLANK                                    E23049
     C                     Z-ADD*ZERO     USCPD
     C                     Z-ADD*ZERO     USCPP
     C***********          MOVEL'C'       USCPI                           E23049
     C                     MOVE *BLANK    USCPI                           E23049
     C                     MOVEA'1'       *IN,46
     C                     END
     C*
     C           XSDET     IFEQ 'RP'
     C***********USCPI     ANDEQ*BLANK                                    E23049
     C                     Z-ADD*ZERO     USCPD
     C                     Z-ADD*ZERO     USCPP
     C***********          MOVEL'P'       USCPI                           E23049
     C                     MOVE *BLANK    USCPI                           E23049
     C                     MOVEA'1'       *IN,46
     C                     END
     C*
     C                     END
     C                     END
     C                     END
     C*
     C*  UPDATE SECURITY DIARY RECORD
     C*
     C                     EXSR UPDDEL
     C*
     C***********                                                         E23049
     C***********          END                                      E15549E23049
     C***********                                                   E15549E23049
     C**PROCESS*SEC.DIARY*EVENTS*FLAGGED*FOR*DELETION-DELETE*THEM** E15549E23049
     C***********                                                   E15549E23049
     C***********XRECI     IFEQ 'C'                                 S01158E23049
     C***********                                                         E23049
     C***UPDATE*SECURITY DIARY RECORD                                     E23049
     C***********                                                         E23049
     C***********          EXSR UPDDEL                                    E23049
     C***********          END                                            E23049
     C*
     C                     END
     C*                                                                   E15549
     C*  CHECK FOR POSITION ACTION                                        E15549
     C*                                                                   E15549
     C           XSDET     IFEQ 'DV'                                      E15549
     C           XSDET     OREQ 'PP'                                      E15549
     C           XSDET     OREQ 'MP'                                      E15549
     C           XSDET     OREQ 'IR'                                      E15549
     C/COPY WNCPYSRC,SE2100C008
      *                                                                   CSE023
      ** If CSE023 is present and Country of Treaty on the Securities     CSE023
      ** Detail is not equal to Blank, then calculate the Allocation      CSE023
      ** Date for the Dividend Event                                      CSE023
      *                                                                   CSE023
     C           CSE023    IFEQ 'Y'                                       CSE023
     C           CRTT      ANDNE*BLANKS                                   CSE023
      *                                                                   CSE023
     C                     Z-ADDXSDED     ZDAYNO                          CSE023
     C                     Z-ADD2         ZNRDYS                          CSE023
     C                     Z-ADDWTALDY    ZNRDYS                          CSE023
     C                     MOVE NMCY      ZCCY                            CSE023
     C                     MOVE *BLANKS   ZLOC                            CSE023
     C                     EXSR ZBKDT                                     CSE023
     C                     Z-ADDZDYNBR    DALOCD  50                      CSE023
     C                     ENDIF                                          CSE023
     C*                                                                   E15549
     C*  AND EVENT DATE DUE                                               E15549
     C*                                                                   E15549
     C***********XSDED     CABGTECD       EPROCS                   E15549 054498
     C           CSE023    IFEQ 'Y'                                       CSE023
     C           CRTT      ANDNE*BLANKS                                   CSE023
     C           DALOCD    CABGTPSDAT     EPROCS                          CSE023
     C                     ELSE                                           CSE023
     C           XSDED     CABGTPSDAT     EPROCS                          054498
     C                     ENDIF                                          CSE023
     C*
     C           XRECI     IFEQ 'D'
      *                                                                   E15549
      * IF COUPON DUE PRIOR TO THIS SEC.DIARY EVENT PROCESS IT NOW        E15549
      * Generate coupon event before if its the same date.                170949
      *                                                                   E15549
     C           NCD       IFNE *ZERO                                     E15549
     C***********NCD       ANDLTXSDED                              E15549 170949
     C           NCD       ANDLEXSDED                                     170949
     C           CSE023    ANDNE'Y'                                       CSE023
     C*                                                                   CSE023
     C           CSE023    OREQ 'Y'                                       CSE023
     C           CRTT      ANDEQ*BLANKS                                   CSE023
     C           NCD       ANDNE*ZERO                                     CSE023
     C           NCD       ANDLEXSDED                                     CSE023
     C*                                                                   CSE023
     C           CSE023    OREQ 'Y'                                       CSE023
     C           XSDET     ANDNE'DV'                                      CSE023
     C           NCD       ANDNE*ZERO                                     CSE023
     C           NCD       ANDLEXSDED                                     CSE023
     C*                                                                   CSE023
     C           CSE023    OREQ 'Y'                                       CSE023
     C           XSDET     ANDEQ'DV'                                      CSE023
     C           CRTT      ANDNE*BLANKS                                   CSE023
     C           CALOCD    ANDNE0                                         CSE023
     C           CALOCD    ANDLEXSDED                                     CSE023
     C*                                                                   E15549
     C*   .... WRITE SECURITY ACTION - COUPON (W01)                       E15549
     C*                                                                   E15549
     C/COPY WNCPYSRC,SE2100C009
     C                     EXSR OUTW01                                    E15549
     C/COPY WNCPYSRC,SE2100C010
     C*                                                                   E15549
      **AND*UPDATE*THE*COUPON*DATE*TO*THE*NEXT*COUPON*DATE******   E15549 E37295
      ***********                                                  E15549 E37295
      *****ZNCD*will*return*ECD*if*ECD*is*a*Coupon*Date,*so*it*is**E20085 E37295
      *****necessary*to*add*1*to*NCD*to*ensure*the*correct*result**E20085 E37295
      ***********                                                  E20085 E37295
     C***********          Z-ADDECD       SECD                     E15549 E37295
     C***********          Z-ADDNCD       ECD                      E15549 E20085
     C***********NCD       ADD  1         ECD                      E20085 E37295
     C***********          EXSR ZNCD                               E15549 E37295
     C***********          Z-ADDSECD      ECD                      E15549 E37295
     C                     END                                            E15549
     C                     END                                            E23049
     C*
      * WRITE SECURITY ACTION FOR SEC.DIARY EVENT                         E15549
      *                                                                   E15549
     C*                                                                   137563
     C           XRECI     IFEQ 'D'                                       137563
     C           XSDET     ANDEQ'IR'                                      137563
     C           RCFQ      ANDEQ' '                                       137563
     C                     EXSR IRCHCK                                    137563
     C                     ENDIF                                          137563
     C*                                                                   137563
     C           XRECI     IFEQ 'D'                                       137563
     C           XSDET     ANDEQ'IR'                                      137563
     C           *IN50     ANDEQ'0'                                       137563
     C           RCFQ      ANDEQ' '                                       137563
     C* IR event is invalid, don't generate SE actions                    137563
     C                     ELSE                                           137563
     C/COPY WNCPYSRC,SE2100C011
     C                     EXSR OUTW03
     C                     ENDIF                                          137563
     C*                                                                   137563
     C/COPY WNCPYSRC,SE2100C012
     C*
     C*  UPDATE SECURITY FIELDS ACCORDING TO WHETHER SECURITY SHOULD
     C*  BE UPDATED AND IF SO BY EVENT TYPE
     C*
     C** Update Security and Diary only when postings are required        E23802
     C*                                                                   E23802
     C***********XSDED     IFLT ECD                                E23802 054498
     C***********XSDED     ORLE ECD                                E23802 054498
     C***********ACRLRN    ANDEQ'3'                                E23802 054498
     C           XSDED     IFLE AKDAT                                     054498
     C*                                                                   E23802
     C           UPDSEC    IFEQ 'Y'
     C*
     C           XSDET     IFEQ 'DV'                                      E23802
     C                     Z-ADDXSDED     ULCPN                           E23802
     C                     MOVEA'1'       *IN,41                          E23802
     C                     END                                            E23802
     C*                                                                   E23802
     C           XSDET     IFEQ 'IR'
     C           RCFQ      IFEQ ' '                                       137563
     C           *IN50     ANDEQ'0'                                       137563
     C           XRECI     ANDEQ'D'                                       137563
     C                     Z-ADDXSDED     KEYDT                           137563
     C           KSEDEL    CHAINSEDEVDF              30                   137563
     C           *IN30     IFEQ '0'                                       137563
     C                     MOVEL'C'       RECI                            137563
     C                     UPDATSEDEVDF                                   137563
     C                     ENDIF                                          137563
     C                     ELSE                                           137563
     C                     Z-ADDXSDNC     UCPNR
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     Z-ADDXSDNN     UCPNN                                               CAS006
     C                     Z-ADDXSCRS     UCCRK                                               CAS006
     C                     Z-ADDXSLQP     UCLQP                                               CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C/COPY WNCPYSRC,SE2100C022
     C                     MOVEA'1'       *IN,42
     C                     ENDIF                                          137563
     C                     END
     C*
     C           XSDET     IFEQ 'MP'
     C                     Z-ADDUCFCT     PCFCT
     C                     Z-ADDXSDCP     UCFCT
     C                     MOVEA'1'       *IN,43
     C                     END
     C/COPY WNCPYSRC,SE2100C013
     C*
     C* UPDATE UCPDP WITH THE RUNNING TOTAL RATHER THAN THE CALL AMT      E15930
     C* FROM DIARY FOR THE PARTLY PAIDS.                                  E15930
     C*
     C           XSDET     IFEQ 'PP'
     C***********XSDPC     IFEQ *ZERO                                     E15930
     C***********          MOVE XSDPP     UCPDP                           E15930
     C           XSDTP     IFEQ *ZERO                                     E15930
     C                     MOVE XSDTA     UCPDP                           E15930
     C                     ELSE
     C***********          MOVE XSDPC     UCPDP                           E15930
     C                     MOVE XSDTP     UCPDP                           E15930
     C                     END
     C                     Z-ADDXSDED     USLCA
     C                     MOVEA'1'       *IN,44
     C                     END
     C*
     C                     ELSE
     C           UPDSEC    IFEQ 'C'
     C*
     C           XSDET     IFEQ 'DV'                                      E23802
     C                     Z-ADDCDED      ULCPN                           E23802
     C                     MOVEA'1'       *IN,41                          E23802
     C                     END                                            E23802
     C*                                                                   E23802
     C           XSDET     IFEQ 'IR'
     C                     Z-ADDCDNC      UCPNR
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     Z-ADDCDNN      UCPNN                                               CAS006
     C                     Z-ADDCCRK      UCCRK                                               CAS006
     C                     Z-ADDCLQP      UCLQP                                               CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C/COPY WNCPYSRC,SE2100C023
     C                     MOVEA'1'       *IN,42
     C                     END
     C*
     C           XSDET     IFEQ 'MP'
     C                     Z-ADDUCFCT     PCFCT
     C                     Z-ADDCDCP      UCFCT
     C                     MOVEA'1'       *IN,43
     C                     END
     C*
     C           XSDET     IFEQ 'PP'
     C***********XSDPC     IFEQ *ZERO                                     E15930
     C***********          MOVE CDPP      UCPDP                           E15930
     C           XSDTP     IFEQ *ZERO                                     E15930
     C                     MOVE CDTA      UCPDP                           E15930
     C                     ELSE
     C***********          MOVE CDPC      UCPDP                           E15930
     C                     MOVE CDTP      UCPDP                           E15930
     C                     END
     C                     Z-ADDCDED      USLCA
     C                     MOVEA'1'       *IN,44
     C                     END
     C*
     C                     ELSE
     C           UPDSEC    IFEQ 'Z'
     C*
     C           XSDET     IFEQ 'DV'                                      E23802
     C                     Z-ADD*ZERO     ULCPN                           E23802
     C                     MOVEA'1'       *IN,41                          E23802
     C                     END                                            E23802
     C*                                                                   E23802
     C           XSDET     IFEQ 'IR'
     C                     Z-ADD*ZERO     UCPNR
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     Z-ADD*ZERO     UCPNN                                               CAS006
     C                     Z-ADD*ZERO     UCCRK                                               CAS006
     C                     Z-ADD*ZERO     UCLQP                                               CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     MOVEA'1'       *IN,42
     C                     END
     C*
     C           XSDET     IFEQ 'MP'
     C                     Z-ADDUCFCT     PCFCT
     C                     Z-ADD*ZERO     UCFCT
     C                     MOVEA'1'       *IN,43
     C                     END
     C*
     C           XSDET     IFEQ 'PP'
     C***********CDPC      IFEQ *ZERO                                     E23049
     C***********          MOVE *ZERO     UCPDP                           E23049
     C***********          ELSE                                           E23049
     C                     MOVE *ZERO     UCPDP
     C***********          END                                            E23049
     C                     Z-ADD*ZERO     USLCA
     C                     MOVEA'1'       *IN,44
     C                     END
     C*
     C                     END
     C                     END
     C                     END
     C*
     C*  UPDATE SECURITY DIARY RECORD
     C*
     C                     EXSR UPDDEL
     C*
     C***********          END                                            E23049
     C***********                                                         E23049
     C***********XRECI     IFEQ 'C'                                 S01158E23049
     C***********                                                         E23049
     C**IF*ALREADY*ACTIONED,*WRITE*SECURITY*ACTION*********************   E23049
     C***********                                                         E23049
     C***********XSDAD     IFNE *ZERO                                     E23049
     C***********XSDDT     ORNE *ZERO                                     E23049
     C***********          EXSR OUTW03                                    E23049
     C***********          END                                            E23049
     C***********                                                         E23049
     C***UPDATE*SECURITY*DIARY*RECORD**********************************   E23049
     C***********                                                         E23049
     C***********          EXSR UPDDEL                                    E23049
     C***********                                                         E23049
     C***********          END                                            E23049
     C*
     C                     ELSE                                           E31622
     C                     EXSR UPDDEL                                    E31622
     C                     END                                            E23802
     C                     END
      *
     C* UPDATE OTHER DIARY EVENTS WITH EVENT DATES LESS THAN EVENT        041031
     C* CONTROL DATE.                                                     041031
     C           XSDET     IFNE 'XR'                                      041031
     C           XSDET     ANDNE'RC'                                      041031
     C           XSDET     ANDNE'RP'                                      041031
     C           XSDET     ANDNE'DV'                                      041031
     C           XSDET     ANDNE'PP'                                      041031
     C           XSDET     ANDNE'MP'                                      041031
     C/COPY WNCPYSRC,SE2100C014
     C           XSDET     ANDNE'IR'                                      041031
     C***********XSDED     ANDLTECD                                041031 054498
     C           XSDED     ANDLEAKDAT                                     054498
     C                     EXSR UPDDEL                                    041031
     C                     END                                            041031
     C*                                                                   041031
     C           EPROCS    ENDSR                            *PROCES ENDSR*E15549
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  UPDDEL - Subroutine to Update the Security Diary.            *
      *                                                               *
      *  Called By: PROCES                                            *
      *  Calls: None.                                                 *
      *                                                               *
      *****************************************************************
      *
     C           UPDDEL    BEGSR                           **UPDDEL BEGSR**
     C*
     C*  CHAIN TO UPDATE FILE
     C*
     C           XSDET     IFNE 'RC'                                      077649
     C           XSDET     ANDNE'RP'                                      077649
     C           XSDET     OREQ 'RC'                                      077649
     C********** XSDED     ANDLEECD                                077649 183206
     C           XSDED     ANDLEAKDAT                                     183206
     C           XSDET     OREQ 'RP'                                      077649
     C********** XSDED     ANDLEECD                                077649 183206
     C           XSDED     ANDLEAKDAT                                     183206
     C           *IN47     OREQ '1'                                       183206
     C                     Z-ADDXSDED     KEYDT
     C           KSEDEL    CHAINSEDEVDF              30
     C*
     C           RECI      IFEQ 'C'                                       S01158
     C*
     C                     MOVEL'*'       RECI
     C                     ADD  1         DTOTD
     C*
     C                     ELSE
     C*
     C           SDET      IFEQ 'DV'
     C           SDET      OREQ 'PP'
     C           SDET      OREQ 'MP'
     C           SDET      OREQ 'IR'
     C           SDET      OREQ 'AL'                                                          CSE065
     C           CSE065    ANDEQ'Y'                                                           CSE065
     C/COPY WNCPYSRC,SE2100C015
     C*
     C*  POSITION ACTION
     C*  ACTIONED DATES SET TO EVENT CONTROL DATE FOR SE2370/80/90/2400   E15549
     C*
     C***********SDDT      IFEQ *ZERO                              E15549 054498
     C***********          Z-ADDECD       SDDT                     E15549 054498
     C***********          END                                     E15549 054498
     C***********                                                         054498
     C***********SDED      IFLT ECD                                E15549 054498
     C***********SDED      OREQ ECD                                E20125 054498
     C***********ACRLRN    ANDEQ'3'                                E20125 054498
     C***********          Z-ADDECD       SDAD                     E15549 054498
     C***********          MOVEL'M'       RECI                            054498
     C***********          ADD  1         DTOTU                           054498
     C***********          END                                            054498
     C*                                                                   054498
     C           SDDT      IFEQ *ZERO                                     054498
     C                     Z-ADDRUND      SDDT                            054498
     C                     END                                            054498
     C*                                                                   054498
     C           SDED      IFLE AKDAT                                     054498
     C                     Z-ADDRUND      SDAD                            054498
     C                     MOVEL'M'       RECI                            054498
     C                     ADD  1         DTOTU                           054498
     C                     END                                            054498
      *                                                                                       CSE065
     C           XSDET     IFEQ 'AL'                                                          CSE065
     C           CSE065    ANDEQ'Y'                                                           CSE065
     C           XSDAL     IFNE 0                                                             CSE065
     C           UALDT     ANDLTXSDAL                                                         CSE065
     C                     Z-ADDXSDAL     UALDT                                               CSE065
     C                     MOVE *ON       *IN48                                               CSE065
     C                     ENDIF                                                              CSE065
     C                     ENDIF                                                              CSE065
     C*
     C                     ELSE
     C*
     C*  NOT POSITION ACTION
     C*
     C                     MOVEL'M'       RECI
     C                     Z-ADDRUND      SDAD
     C                     ADD  1         DTOTU
     C*
     C                     END
     C                     END
     C*
     C  N30                UPDATSEDEVDF
     C                     END                                            077649
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  ENDSEC - Subroutine for End of Security Processing.          *
      *                                                               *
      *  Called By: Main Processing.                                  *
      *  Calls: None.                                                 *
      *                                                               *
      *****************************************************************
      *
     C           ENDSEC    BEGSR                           **ENDSEC BEGSR**
      *                                                                   E15549
      * IF COUPON DUE (AND NOT YET DONE IN THE SEC.DIARY EVENT SECTION)   E15549
     C*                                                                   E15549
     C***********NCD       IFNE *ZERO                              E15549 054498
     C***********NCD       ANDLEECD                                E15549 054498
     C           NCD       IFLE PSDAT                                     054498
     C           NCD       ANDNE*ZERO                                     054498
     C           CSE023    ANDNE'Y'                                       CSE023
     C*                                                                   CSE023
     C           CSE023    OREQ 'Y'                                       CSE023
     C           CRTT      ANDEQ*BLANKS                                   CSE023
     C           NCD       ANDLEPSDAT                                     CSE023
     C           NCD       ANDNE*ZERO                                     CSE023
     C*                                                                   CSE023
     C           CSE023    OREQ 'Y'                                       CSE023
     C           CRTT      ANDNE*BLANKS                                   CSE023
     C           CALOCD    ANDLEPSDAT                                     CSE023
     C           CALOCD    ANDNE*ZERO                                     CSE023
     C*                                                                   E15549
     C*   .... WRITE SECURITY ACTION - COUPON (W01)                       E15549
     C*                                                                   E15549
     C/COPY WNCPYSRC,SE2100C016
     C                     EXSR OUTW01                                    E15549
     C/COPY WNCPYSRC,SE2100C017
      *                                                                   E15549
     C                     END                                            E15549
     C*                                                                   E15549
     C***IF*MATURITY DATE NOT AFTER ECD AND MATURITY DATE INDICATORS01176 054498
     C***NOT*EQUAL TO 'A', OUTPUT SECURITY ACTION - MATURITY       S01176 054498
     C***********                                                  S01176 054498
     C***********XMATY     IFLE ECD                                       054498
     C***********MDTI      ANDNE'A'                                S01176 054498
     C***********XMATY     ANDNE0                                         054498
     C*
     C*  IF MATURITY DATE BEFORE ECD, UPDATE SECURITY                     E15549
     C*     ONLY IF MATURITY DATE NOT ZEROES
     C*
     C*          MATY      IFLT DNWD
     C*          MATY      ANDNE0
     C***********XMATY     IFLT DNWD                                      E15549
     C*          XMATY     ANDNE0
     C***********XMATY     IFLT ECD                                E15549 054498
      ***********                                                  E20142 054498
      *****For*accrual run type '3', process Maturities up to AND  E20142 054498
      *****INCLUDING ECD (APDA), so that if Month-End is a Non-WorkE20142 054498
      *****day,*EOM balances can reflect all Maturities this month.E20142 054498
      ***********                                                  E20142 054498
     C***********XMATY     OREQ ECD                                E20142 054498
     C***********ACRLRN    ANDEQ'3'                                E20142 054498
     C*                                                                   054498
     C*  PROCESS MATURITIES                                               =54498
     C*                                                                   054498
     C           XMATY     IFLE PSDAT                                     054498
     C           XMATY     ANDNE*ZERO                                     054498
     C           MDTI      ANDNE'A'                                       054498
     C           CSE023    ANDNE'Y'                                       CSE023
     C*                                                                   CSE023
     C           CSE023    OREQ 'Y'                                       CSE023
     C           CRTT      ANDEQ*BLANKS                                   CSE023
     C***********XMATY     ANDEQPSDAT                              CSE023 187825
     C           XMATY     ANDLEPSDAT                                     187825
     C           XMATY     ANDNE*ZERO                                     CSE023
     C           MDTI      ANDNE'A'                                       CSE023
     C*                                                                   CSE023
     C           CSE023    OREQ 'Y'                                       CSE023
     C           CRTT      ANDNE*BLANKS                                   CSE023
     C           MALOCD    ANDLEPSDAT                                     CSE023
     C           MALOCD    ANDNE*ZERO                                     CSE023
     C           MDTI      ANDNE'A'                                       CSE023
     C*                                                                   054498
     C*  IF MATURITY DATE DUE, UPDATE RECORD ID ON SECURITY               054498
     C*                                                                   054498
     C           XMATY     IFLE AKDAT                                     054498
     C*                                                                   E20142
     C                     MOVEL'M'       URECI
     C                     MOVEA'1'       *IN,40
     C                     END
     C*
     C*  OUTPUT SECURITY ACTION - MATURITY                                054498
     C*                                                                   054498
     C/COPY WNCPYSRC,SE2100C018
     C                     EXSR OUTW02
     C/COPY WNCPYSRC,SE2100C019
     C*
     C                     END
      *                                                                                       CSE065
     C           CSE065    IFEQ 'Y'                                                           CSE065
     C           ALDT      ANDLEAKDAT                                                         CSE065
     C           ALDT      ANDGERUND                                                          CSE065
     C           ALDT      ANDNE*ZEROS                                                        CSE065
     C                     EXSR OUTW05                                                        CSE065
     C                     ENDIF                                                              CSE065
     C*
     C*  UPDATE SECURITY IF EVENTS PROCESSED FOR IT
     C*
     C***UPDATE*LAST*COUPON*DATE*(*IN41=1)*IF*COUPON*PROCESSED*****094576 143174
     C***AND*NEXT*COUPON*DATE*ID*LESS*THAN*DATE*OF*NEXT*WORKIND DAY094576 143174
     C***********SAAT      IFEQ 'CP'                               094576 143174
     C***********NCD       ANDLTDNWD                               094576 143174
     C***********          MOVE '1'       *IN41                    094576 143174
     C***********          END                                     094576 143174
     C***********                                                  094576 143174
     C           *IN,40    IFNE *ZERO
     C           *IN,41    ORNE *ZERO
     C           *IN,42    ORNE *ZERO
     C           *IN,43    ORNE *ZERO
     C           *IN,44    ORNE *ZERO
     C           *IN,45    ORNE *ZERO
     C           *IN,46    ORNE *ZERO
     C           *IN,48    ORNE *ZERO                                                         CSE065
     C           CSE065    ANDEQ'Y'                                                           CSE065
     C/COPY WNCPYSRC,SE2100C020
     C*                                                                   E15549
     C* UPDATE LAST COUPON/DIVIDEND PAYMENT DATE                          E15549
     C*                                                                   E15549
     C           *IN41     IFEQ '1'                                       E15549
     C           PROT      IFEQ '4'                                       E15549
     C***********          Z-ADDDIVNDT    ULCPN                    E15549 E23802
     C                     ELSE                                           E15549
     C                     Z-ADDNCD       ULCPN                           E15549
     C                     END                                            E15549
     C                     END                                            E15549
     C*
     C*  CHAIN TO UPDATE FILE
     C*
     C           KSECTY    CHAINSECTYDF              35
     C*
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C           *IN42     ANDEQ*ON                                                           CAS006
     C                     Z-ADDUCPNN     CPNN                                                CAS006
     C                     Z-ADDUCCRK     CCRK                                                CAS006
     C                     Z-ADDUCLQP     CLQP                                                CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C   40                MOVELURECI     RECI
     C   41                Z-ADDULCPN     LCPN
     C   42                Z-ADDUCPNR     CPNR
     C*                                                                   S96032
     C/COPY WNCPYSRC,SE2100CCP6                                           S96032
     C*                                                                   S96032
     C   43                Z-ADDUCFCT     CFCT
     C   44                Z-ADDUCPDP     CPDP
     C   44                Z-ADDUSLCA     SLCA
     C   45                Z-ADDUSEXR     SEXR
     C   46                Z-ADDUSCPD     SCPD
     C   46                Z-ADDUSCPP     SCPP
     C   46                MOVELUSCPI     SCPI
      *                                                                                       CSE065
     C           *IN48     IFEQ '1'                                                           CSE065
     C           CSE065    ANDEQ'Y'                                                           CSE065
     C                     MOVELUALDT     ALDT                                                CSE065
     C                     ENDIF                                                              CSE065
      *                                                                   CPB001
      **  If Replication Processing required.                             CPB001
     C           WUREPL    IFEQ 'Y'                        Begin WUREPL   CPB001
     C                     MOVE *BLANK    REPI                            CPB001
      *                                                                   CPB001
      **  If Security exists and Coupon generated (CP) or Maturity        CPB001
      **  reached (MA), set up Replication Indicator.                     CPB001
     C           SAAT      IFEQ 'CP'                       Begin SAAT     CPB001
     C           SAAT      OREQ 'MA'                                      CPB001
     C           SAAT      OREQ 'IR'                                                          206595
     C                     MOVE 'Y'       REPI                            CPB001
      *                                                                   CPB001
     C                     ENDIF                           End SAAT       CPB001
      *                                                                   CPB001
     C                     ENDIF                           End WUREPL     CPB001
     C*
     C  N35                UPDATSECTYDF
     C*
     C*  ADD TO CONTROL TOTAL
     C*
     C                     ADD  1         STOTU
     C/COPY WNCPYSRC,SE2100C003
     C*
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  AUDIT  - Subroutine to check the Audit Files.                *
      *                                                               *
      *  Called By: Main Processing.                                  *
      *  Calls: None.                                                 *
      *                                                               *
      *****************************************************************
      *
     C           AUDIT     BEGSR                           **AUDIT BEGSR**
     C*
     C* CHECK SECTYA AUDIT RECORD
     C*
     C           1         CHAINSECTYAF              99
     C*
     C           *IN99     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8            ***************
     C***********          MOVEL'04'      DBASE            **DB ERROR 04**S01117
     C                     Z-ADD4         DBASE            **DB ERROR 04**S01117
     C                     MOVEL'SECTYA'  DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     ELSE
     C*
     C                     Z-ADDNORE      SNORE
     C*
     C* CHECK CONTROL TOTALS AGREE
     C*
     C           STOTI     IFNE NORE
     C                     MOVEA'1'       *IN,80
     C                     MOVE '1'       *INU8
     C*
     C                     END
     C*
     C                     END
     C*
     C* CHECK SEDEVA AUDIT RECORD
     C*
     C           1         CHAINSEDEVAF              99
     C*
     C           *IN99     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8            ***************
     C***********          MOVEL'05'      DBASE            **DB ERROR 05**S01117
     C                     Z-ADD5         DBASE            **DB ERROR 05**S01117
     C                     MOVEL'SEDEVA'  DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     ELSE
     C*
     C                     Z-ADDNORE      DNORE
     C           NORE      SUB  DTOTD     DTOTO   50
     C           DTOTO     ADD  DTOTA     DTOTO
     C*
     C           *INU8     IFNE '1'
     C                     Z-ADDDTOTO     NORE
     C                     Z-ADDDTOTO     NLRB
     C                     UPDATSEDEVAF
     C                     END
     C*
     C                     END
     C*
     C* UPDATE SNDEVA AUDIT RECORD
     C*
     C           OTOT1     ADD  OTOT2     NTOTA   50
     C                     ADD  OTOT4     NTOTA                           E15549
     C*
     C           1         CHAINSNDEVAF              99
     C*
     C           *IN99     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8            ***************
     C***********          MOVEL'06'      DBASE            **DB ERROR 06**S01117
     C                     Z-ADD6         DBASE            **DB ERROR 06**S01117
     C                     MOVEL'SNDEVA'  DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     ELSE
     C*
     C**********           Z-ADDNORE      NNORE                                               247420
     C********** NORE      ADD  NTOTA     NTOTO   50                                          247420
     C                     Z-ADDSNNORE    NNORE                                               247420
     C           SNNORE    ADD  NTOTA     NTOTO   70                                          247420
     C*
     C           *INU8     IFNE '1'
     C**********           Z-ADDNTOTO     NORE                                                247420
     C                     Z-ADDNTOTO     SNNORE                                              247420
     C                     UPDATSNDEVAF
     C                     END
     C*
     C                     END
     C*
     C* OUTPUT SECACA AUDIT RECORD
     C*
     C                     Z-ADDOTOT5     NORE                            E15549
     C*
     C           *INU8     IFNE '1'
     C                     WRITESECACAF
     C                     END
     C*
     C*                                                                   S96032
     C/COPY WNCPYSRC,SE2100CCP7                                           S96032
     C*                                                                   S96032
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  PRINT  - Subroutine to Output the Control Totals Report.     *
      *                                                               *
      *  Called By: Main Processing.                                  *
      *  Calls: None.                                                 *
      *                                                               *
      *****************************************************************
      *
     C           PRINT     BEGSR                           **PRINT BEGSR**
     C*
     C                     WRITEHEADAU
     C*
     C           *INU7     IFEQ '0'
     C                     WRITETOTALS
     C                     ELSE
     C                     WRITEERROR
     C                     END
     C***********                                                         E29170
     C***********          WRITETRAILAU                                   E29170
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  GETSEC - Subroutine to get next Security Record.             *
      *                                                               *
      *  Called By: Main Processing.                                  *
      *  Calls: None.                                                 *
      *                                                               *
      *****************************************************************
      *
     C           GETSEC    BEGSR                           **GETSEC  BEGSR**
     C*
      **  ALWAYS READ 1, KEEP READING AND ADDING TO COUNTS IF NOT
      **  ACTIVE.
      *
     C           RECI      DOUEQ'D'
      *                                                                   E21588
      ***  Cancelled Securities should not be processed.                  E21588
      *                                                                   E21588
     C***********RECI      OREQ 'C'                                S01158 E21588
     C           *IN20     OREQ '1'
      *
     C                     READ SECTYX                   20
     C*                                                                   S96032
     C/COPY WNCPYSRC,SE2100CCP8                                           S96032
     C*                                                                   S96032
     C*
     C* IF NOT END OF FILE, ADD TO COUNT OF SECURITIES INPUT
     C*
     C           *IN,20    IFEQ '0'
     C           RECI      ANDNE'*'
     C*
     C           RECI      IFNE 'C'                                       S01158
     C                     ADD  1         STOTI
     C                     END                                            S01158
     C*
     C           RECI      IFEQ 'D'
     C                     ADD  1         STOTL
     C                     END
     C*
     C           RECI      IFEQ 'C'
     C                     ADD  1         STOTC
     C                     END
     C*
     C           RECI      IFEQ 'M'
     C                     ADD  1         STOTM
     C                     END
     C                     END
     C*
     C                     END
     C*
     C*  IF EOF, ENSURE UNMATCHED DIARY EVENTS DETECTED
     C*
     C           *IN,20    IFEQ '1'
     C                     MOVEL*HIVAL    SESN
     C                     END
     C*
     C* DB ERROR IF DIARY SHORTNAME BEFORE SECURITY SHORTNAME (IE NO MATCH)
     C*
     C           XSDSN     IFLT SESN
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8            ***************
     C***********          MOVEL'03'      DBASE            **DB ERROR 03**S01117
     C                     Z-ADD3         DBASE            **DB ERROR 03**S01117
     C                     MOVEL'SEDEL'   DBFILE           ***************
     C***********          MOVELSDSN      DBKEY                           041031
     C                     MOVELXSDSN     DBKEY                           041031
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C*
     C                     END
     C*
     C*  READ INVTP RECORD FOR THIS SECURITY
     C*
     C           *IN20     IFNE '1'
     C           *INU7     ANDNE'1'
     C           *INU8     ANDNE'1'
     C*
     C           KINVTP    CHAININVTP                36
     C*
     C           *IN36     IFEQ '1'
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8            ***************
     C***********          MOVEL'13'      DBASE            **DB ERROR 13**S01117
     C                     Z-ADD13        DBASE            **DB ERROR 13**S01117
     C                     MOVEL'INVTP'   DBFILE           ***************
     C                     MOVELINVTPK    DBKEY
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C*
     C                     END
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  GETDEL - Subroutine to get next Security Diary record.       *
      *                                                               *
      *  Called By: Main Processing.                                  *
      *  Calls: None.                                                 *
      *                                                               *
      *****************************************************************
      *
     C           GETDEL    BEGSR                           **GETDEL BEGSR**
     C/COPY WNCPYSRC,SE2100C001
     C*
     C                     READ SEDELX                   25
     C*
     C* IF NOT END OF FILE,
     C* ADD TO COUNT OF DIARY EVENTS INPUT & STORE RECI
     C*
     C           *IN,25    IFEQ '0'
     C*
     C           DTOTI     ADD  1         DTOTI
     C/COPY WNCPYSRC,SE2100C002
     C                     MOVELXRECI     SRECI                           S01158
     C*
     C*  DETERMINE WHETHER SECURITY IS TO BE UPDATED
     C*
     C           KSEC2     CHAINSECET                37
     C*                                                                   E15549
     C***  Future cancellations can be ignored but not Actioned Events    E23049
     C*                                                                   E23049
     C***********CRECI     DOUEQ'C'                                E15549 E23049
     C           CRECI     DOUEQ'M'                                       E23049
     C           CRECI     OREQ 'D'                                       E15549
      *                                                                   E20554
      ***  Check of *IN37 is on, to prevent program loop                  E20554
      *                                                                   E20554
     C           *IN37     OREQ '1'                                       E20554
     C           KSECET    READESECET                    37
     C                     END                                            E15549
     C*                                                                   E15549
     C* NOT THE MOST RECENT - SO DONT UPDATE                              E15549
     C*** And Not a future Event                                          E23049
     C*
     C           *IN37     IFEQ '0'
     C***********CDED      ANDLEECD                                E23049 054498
     C***********CDED      ANDLEPSDAT                              054498 175977
     C           CDED      ANDLTPSDAT                                     175977
     C                     MOVE 'N'       UPDSEC  1
     C                     ELSE
     C*                                                                   E15549
     C* THE MOST RECENT AND LIVE , SO UPDATE (WITH DETAILS FROM SEDEVDX)  E15549
     C*                                                                   E15549
     C***********CRECI     IFEQ 'D'                                       E23049
     C           XRECI     IFEQ 'D'                                       E23049
     C                     MOVE 'Y'       UPDSEC
     C                     ELSE
     C*                                                                   E15549
     C* MOST RECENT BUT NOT LIVE,SO GET THE NEXT MOST RECENT              E15549
     C* (TO UPDATE WITH DETAILS FROM SEDEVDC IF FOUND,                    E15549
     C*                                  ELSE ZEROIZE/BLANK)              E15549
     C*
     C*** If Cancellation followed by a Matured Record                    E23049
     C*** Use the Next Matured record in preference to the previous       E23049
     C*                                                                   E23049
     C           *IN37     IFEQ '0'                                       E23049
     C           CRECI     ANDEQ'M'                                       E23049
     C                     MOVE 'C'       UPDSEC                          E23049
     C                     ELSE                                           E23049
     C                     MOVE 'Z'       UPDSEC                          E15549
     C           KSEC2     CHAINSECET                37
     C                     READPSECET                    37
     C*
     C           *IN37     DOWNE'1'
     C           CDSN      ANDEQXSDSN
     C           CDET      ANDEQXSDET
     C*
     C           CRECI     IFEQ '*'
     C           CRECI     OREQ 'C'                                       S01158
     C*** Restore from previosly Actioned record if it exists             E23049
     C***********CRECI     OREQ 'M'                                E15549 E23049
     C                     READPSECET                    37
     C                     ELSE
     C                     MOVE 'C'       UPDSEC
     C                     MOVE '1'       *IN37
     C                     END
     C*
     C                     END
     C*                                                                   E23049
     C                     END                                            E23049
     C*
     C                     END
     C                     END
     C*
     C                     ELSE
     C                     MOVEL*HIVAL    XSDSN
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  OUTW01 - Subroutine to Output Coupon Action to PF/SECACD.    *
      *                                                               *
      *  Called By: PROCES                                            *
      *  Calls: OUTSND                                                *
      *                                                               *
      *****************************************************************
      *
     C           OUTW01    BEGSR                           **OUTW01 BEGSR**
     C*                                                                   066262
     C** Check to ensure 'CP' action has not already been generated.      066262
     C*                                                                   066262
     C                     MOVEL'CP'      SNET                            066262
     C                     MOVELSESN      SNSN                            066262
     C                     Z-ADDNCD       SNDT                            066262
     C           SETGKY    CHAINSNDEVDO              99                   066262
     C           *IN99     IFEQ '1'                                       066262
     C*
     C* NB - USES UPDATED SECURITY FIELDS -THESE CONTAIN ORIGINAL VALUES
     C*          UNTIL CHANGES PROCESSED
     C*
     C                     MOVEL'D'       RECI
     C                     MOVELSESN      SASN
     C                     MOVEL'CP'      SAAT                            E15549
     C                     MOVEL'30'      SAAS
     C                     Z-ADDNCD       SAED
     C                     Z-ADD*ZERO     SAOD
     C*                                                                   S96032
     C/COPY WNCPYSRC,SE2100CCP9                                           S96032
     C*                                                                   S96032
      *                                                                                       CSE075
      ** If Enhanced Treasury is switched on:                                                 CSE075
      *                                                                                       CSE075
     C           CSE075    IFEQ 'Y'                                                           CSE075
      *                                                                                       CSE075
      ** If a delay period has been specified, calculate the payment date.                    CSE075
      *                                                                                       CSE075
     C********** PROT      IFEQ '8'                                                    CSE075 CSE075
     C           STBS      IFEQ 'P'                                                           CSE075
     C           PROT      ANDNE'2'                                                           CSE075
     C           PROT      ANDNE'4'                                                           CSE075
     C           PROT      ANDNE'7'                                                           CSE075
     C           PPDI      ANDNE'Y'                                                           CSE075
     C           CPDY      ANDNE0                                                             CSE075
     C           STBS      OREQ 'Y'                                                           CSE075
     C           PROT      ANDNE'2'                                                           CSE075
     C           PROT      ANDNE'4'                                                           CSE075
     C           PROT      ANDNE'7'                                                           CSE075
     C           PROT      ANDNE'9'                                                           CSE075
     C           PPDI      ANDNE'Y'                                                           CSE075
     C           CPDY      ANDNE0                                                             CSE075
     C           SAED      ADD  CPDY      SAOD                                                CSE075
     C                     ENDIF                                                              CSE075
      *                                                                                       CSE075
     C                     ENDIF                                                              CSE075
      *                                                                                       CSE075
     C***********          Z-ADD*ZERO     SDAU                            E16772
     C                     Z-ADD*ZERO     SDUN                            E16772
     C                     Z-ADD*ZERO     SDCA
     C***********          Z-ADD0         STCA                            E23049
     C                     Z-ADDUCPDP     STCA                            E23049
     C*
     C                     Z-ADDUCFCT     SACF
     C                     Z-ADDUCPNR     SDCR
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     Z-ADDUCPNN     WCPNN                                               CAS006
     C                     ENDIF                                                              CAS006
     C*
     C                     MOVELNAR,1     SDNR
     C                     Z-ADDRUND      SAAC
     C*                                                                   E15549
     C* SET A/C KEYS REQ'D/POSN SETTLE REQ'D IND                          E15549
     C*                                                                   E15549
     C***********NCD       IFLT ECD                                E15549 054498
     C***********                                                  E20142 054498
     C***For*accrual run type '3', generate entries up to AND INCLUE20142 054498
     C***ECD*(APDA), so that if month end is a non-working day, EOME20142 054498
     C***balances can reflect all coupons due this month.          E20142 054498
     C***********                                                  E20142 054498
     C***********NCD       OREQ ECD                                E20142 054498
     C***********ACRLRN    ANDEQ'3'                                E20142 054498
     C*                                                                   054498
     C* IF COUPON DATE DUE                                                054498
     C*                                                                   054498
     C           NCD       IFLE AKDAT                                     054498
     C*                                                                   E20142
     C                     MOVEA'1'       *IN,41                          E15549
     C                     MOVEL'Y'       AKRI                            E15549
     C*                                                                   E15549
     C* CHECK WHETHER POSITION SETTLEMENTS PREVIOUSLY GENERATED           E15549
     C*                                                                   E15549
     C                     MOVELSESN      SNSN                            E15549
     C                     MOVEL'CG'      SNET                            E15549
     C                     Z-ADDNCD       SNDT                            E15549
     C***********SETGKY    CHAINSNDEVDX              99            E15549 E20085
     C           SETGKY    CHAINSNDEVDO              99                   E20085
     C           *IN,99    IFEQ '0'                                       E15549
     C                     MOVEL*BLANK    PSRI                            E15549
     C                     MOVEL'*'       RECI                            E15549
     C***********          UPDATSNDEVDX                            E15549 E20085
     C                     UPDATSNDEVDO                                   E20085
     C                     SUB  1         OTOT4                           E15549
     C                     ELSE                                           E15549
     C                     MOVEL'Y'       PSRI                            E15549
     C                     END                                            E15549
     C*                                                                   E15549
     C                     ELSE                                           E15549
     C                     MOVEL*BLANK    AKRI                            E15549
     C                     MOVEL*BLANK    PSRI                            E15549
     C*                                                                   E15549
     C* WRITE POSITION SETTLEMENT GENERATED RECORD TO PF/SNDEVD           E15549
     C*                                                                   E15549
     C                     MOVELSESN      SNSN                            E15549
     C                     MOVEL'CG'      SNET                            E15549
     C                     Z-ADDNCD       SNDT                            E15549
     C***********SETGKY    CHAINSNDEVDX              99            E15549 E20085
     C           SETGKY    CHAINSNDEVDO              99                   E20085
     C           *IN,99    IFEQ '1'                                       E15549
     C                     MOVEL'CG'      SAAT                            E15549
     C**********           Z-ADDLCPN      LCCP                                         197357 211228
     C                     EXSR OUTSND                                    E15549
     C                     ADD  1         OTOT4                           E15549
     C                     MOVEL'Y'       PSRI                            E15549
     C                     END                                            E15549
     C                     END                                            E15549
     C***********                                                  E15549 E21307
     C***NO*POSITION*SETTLEMENT*ON*COUPON*IF*MATURITY*ALSO*DUE**** E15549 E21307
      ***  The Coupon is now separate from the Maturity, so it does       E21307
      ***  require a Position Settlement.                                 E21307
     C***********                                                  E15549 E21307
     C***********NCD       IFEQ XMATY                              E15549 E21307
     C***********          MOVEL*BLANK    PSRI                     E15549 E21307
     C***********          END                                     E15549 E21307
     C*                                                                   E15549
     C**********           MOVEL'D'       RECI                     E15549 197357
     C                     MOVEL'D'       RECI                                                211228
     C                     MOVEL'CP'      SAAT                            E15549
     C*
     C           PPDI      IFEQ 'P'
     C           UCPDP     ANDEQSFPP
     C*
     C*** If Partly Paid, Check PP Amount with Fully Paid Price           E23049
     C**IF*PRICE*BASIS*P,*CHECK*AMOUNT*WITH*FULLY*PAID*PRICE******        E23049
     C************************************************************        E23049
     C*
     C                     Z-ADD100       STCA
     C                     ELSE
     C                     MOVE UCPDP     STCA
     C                     END
     C*
     C                     Z-ADD*ZERO     PCFA
     C                     MOVEL*BLANK    RTMI
     C                     Z-ADD*ZERO     RTAI
     C*                                                                   E15549
     C* SET LAST COUPON DATE OF CURRENT COUPON PERIOD                     E15549
     C* (WRITTEN TO BOTH SECACD AND SNDEVD)                               E15549
     C*                                                                   E15549
     C* For processing types other than 4 (shares),                       W20085
     C* Use SR/ZLCD to calculate LCCP, else use ULCPN from SECTYD         E20085
     C*                                                                   E20085
     C           PROT      IFNE '4'                                       E20085
     C***********SAED      SUB  1         ZECD                     E20085 180707
     C           BCNV      IFNE ' '                                       182505
     C           BCNV      ANDNE'N'                                       CSE031
     C                     Z-ADDZZNCD     ZDAYNO                          182505
     C                     MOVE NMCY      ZCCY                            182505
     C                     MOVE *BLANKS   ZLOC                            182505
     C                     Z-ADD1         ZNRDYS                          182505
     C                     EXSR ZBKDT                                     182505
     C                     Z-ADDZDYNBR    ZECD                            182505
     C                     ELSE                                           182505
     C           ZZNCD     SUB  1         ZECD                            180707
     C                     ENDIF                                          182505
     C                     EXSR ZLCD                                      E20085
     C                     Z-ADDZZLCD     LCCP                            E20085
     C                     ELSE                                           E20085
     C                     Z-ADDULCPN     LCCP                            E15549
     C                     END                                            E20085
     C                     Z-ADD*ZERO     SAEXD                           S01510
     C**********           Z-ADDLCCP      WLCCP                                        197357 211228
      **********                                                                       197357 211228
      ***Check*if*previous*settlement*generated*to*ensure*that*********                197357 211228
      ***the*correct*LCCP*is*passed*in*case*coupon*date*was************                197357 211228
      ***amended*after*settlements*had*already*been*generated**********                197357 211228
      ***for*original*date.********************************************                197357 211228
      **********                                                                       197357 211228
     C**********           MOVE 'CP'      SNET                                         197357 211228
     C**********           MOVE *HIVAL    SNDT                                         197357 211228
     C********** KESNCP    SETLLSNDEVDO                                                197357 211228
     C**********           READ SNDEVDO                  60                            197357 211228
     C********** *IN60     IFEQ '0'                                                    197357 211228
     C********** SNSN      ANDEQSESN                                                   197357 211228
     C********** SNET      ANDEQ'CP'                                                   197357 211228
     C**********           Z-ADDSNDT      LCCP                                         197357 211228
     C**********           ELSE                                                        197357 211228
     C**********           Z-ADDWLCCP     LCCP                                         197357 211228
     C**********           ENDIF                                                       197357 211228
      **********                                                                       197357 211228
     C**********           MOVEL'D'       RECI                                         197357 211228
     C*
     C                     WRITESECACDF
     C                     ADD  1         OTOT5                           E15549
     C*
     C*  OUTPUT NON-DIARY EVENT RECORD TO SNDEVD
     C*
     C           *IN41     IFEQ '1'                                       E15549
     C                     EXSR OUTSND
     C*
     C                     ADD  1         OTOT1
     C                     END                                            E15549
     C*
     C                     END                                            066262
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  OUTW02 - Subroutine to Output Maturity Action to PF/SECACD   *
      *                                                               *
      *  Called By: PROCES                                            *
      *  Calls: OUTSND                                                *
      *                                                               *
      *****************************************************************
      *
     C           OUTW02    BEGSR                           **OUTW02 BEGSR**
     C*
     C                     MOVEL'D'       RECI
     C                     MOVELSESN      SASN
     C                     MOVEL'MA'      SAAT
     C                     MOVEL'70'      SAAS
     C                     Z-ADDXMATY     SAED                            E15549
     C                     Z-ADD*ZERO     SAOD
     C***********          Z-ADD*ZERO     SDAU                            E16772
     C                     Z-ADD*ZERO     SDUN                            E16772
     C                     Z-ADD*ZERO     SDCA
     C***********          Z-ADD0         STCA                            E23049
     C                     Z-ADDUCPDP     STCA                            E23049
     C*
     C                     Z-ADDUCFCT     SACF
     C                     Z-ADDUCPNR     SDCR
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     Z-ADDUCPNN     WCPNN                                               CAS006
     C                     ENDIF                                                              CAS006
     C*
     C                     MOVELNAR,2     SDNR
     C                     Z-ADDRUND      SAAC
     C*                                                                   E15549
     C* SET A/C KEYS REQ'D/POSN SETTLE REQ'D IND                          E15549
     C*                                                                   E15549
     C***********XMATY     IFLT ECD                                E15549 054498
      ***********                                                  E20142 054498
      *****For*accrual run type '3', generate entries up to AND    E20142 054498
      *****INCLUDING ECD (APDA), so that if Month-End is a Non-WorkE20142 054498
      *****day,*EOM balances can reflect all Maturities this month.E20142 054498
      ***********                                                  E20142 054498
     C***********XMATY     OREQ ECD                                E20142 054498
     C***********ACRLRN    ANDEQ'3'                                E20142 054498
     C*                                                                   054498
     C* IF MATURITY DATE DUE                                              054498
     C*                                                                   054498
     C           XMATY     IFLE AKDAT                                     054498
     C*                                                                   E20142
     C                     MOVEL'Y'       AKRI                            E15549
     C*                                                                   E15549
     C* CHECK WHETHER POSITION SETTLEMENTS PREVIOUSLY GENERATED           E15549
     C*                                                                   E15549
     C                     MOVELSESN      SNSN                            E15549
     C                     MOVEL'MG'      SNET                            E15549
     C                     Z-ADDXMATY     SNDT                            E15549
     C***********SETGKY    CHAINSNDEVDX              99            E15549 E20085
     C           SETGKY    CHAINSNDEVDO              99                   E20085
     C           *IN,99    IFEQ '0'                                       E15549
     C                     MOVEL*BLANK    PSRI                            E15549
     C                     MOVEL'*'       RECI                            E15549
     C***********          UPDATSNDEVDX                            E15549 E20085
     C                     UPDATSNDEVDO                                   E20085
     C                     SUB  1         OTOT4                           E15549
     C                     ELSE                                           E15549
     C                     MOVEL'Y'       PSRI                            E15549
     C                     END                                            E15549
     C*                                                                   E15549
     C                     ELSE                                           E15549
     C                     MOVEL*BLANK    AKRI                            E15549
     C                     MOVEL*BLANK    PSRI                            E15549
     C*                                                                   E15549
     C* WRITE POSITION SETTLEMENT GENERATED RECORD TO PF/SNDEVD           E15549
     C*                                                                   E15549
     C                     MOVELSESN      SNSN                            E15549
     C                     MOVEL'MG'      SNET                            E15549
     C                     Z-ADDXMATY     SNDT                            E15549
     C***********SETGKY    CHAINSNDEVDX              99            E15549 E20085
     C           SETGKY    CHAINSNDEVDO              99                   E20085
     C           *IN,99    IFEQ '1'                                       E15549
     C                     MOVEL'MG'      SAAT                            E15549
     C                     EXSR OUTSND                                    E15549
     C                     ADD  1         OTOT4                           E15549
     C                     MOVEL'Y'       PSRI                            E15549
     C                     END                                            E15549
     C                     END                                            E15549
     C*                                                                   E15549
     C                     MOVEL'D'       RECI                            E15549
     C                     MOVEL'MA'      SAAT                            E15549
     C*
     C                     MOVE UCPDP     STCA
     C*
     C                     Z-ADD*ZERO     PCFA
     C                     MOVEL*BLANK    RTMI
     C                     Z-ADD*ZERO     RTAI
     C*                                                                   E15549
     C* SET LAST COUPON DATE OF CURRENT COUPON PERIOD                     E15549
     C* (WRITTEN TO BOTH SECACD AND SNDEVD)                               E15549
     C*                                                                   E15549
     C                     Z-ADDULCPN     LCCP                            E15549
     C                     Z-ADD*ZERO     SAEXD                           S01510
     C*
     C                     WRITESECACDF
     C                     ADD  1         OTOT5                           E15549
     C*
     C*  OUTPUT NON-DIARY EVENT RECORD TO SNDEVD
     C*
     C***********XMATY     IFLT ECD                                E15549 054498
     C***********                                                  E20142 054498
     C***********XMATY     OREQ ECD                                E20142 054498
     C***********ACRLRN    ANDEQ'3'                                E20142 054498
     C*                                                                   E20142
     C           XMATY     IFLE AKDAT                                     054498
     C                     EXSR OUTSND
     C*
     C                     ADD  1         OTOT2
     C                     END                                            E15549
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  OUTW03 - Subroutine to Output Diary Action to PF/SECACD      *
      *                                                               *
      *  Called By: PROCES                                            *
      *  Calls: None.                                                 *
      *                                                               *
      *****************************************************************
      *
     C           OUTW03    BEGSR                           **OUTW03 BEGSR**
      *
     C                     Z-ADD0         SDCA
     C                     Z-ADD0         STCA
     C*
     C           XRECI     IFEQ 'C'                                       S01158
     C           XRECI     OREQ 'R'                                       S01158
     C                     MOVEL'R'       RECI
     C                     ELSE
     C                     MOVEL'D'       RECI
     C                     END
     C*
     C                     MOVELXSDSN     SASN
     C                     MOVELXSDET     SAAT
     C*
     C           XSDET     IFEQ 'MP'
     C                     MOVEL'20'      SAAS
     C                     END
     C*
     C           XSDET     IFEQ 'DV'
     C                     MOVEL'35'      SAAS
     C                     END
     C*
     C           XSDET     IFEQ 'PP'
     C                     MOVEL'05'      SAAS
     C                     END
     C*
     C           XSDET     IFEQ 'IR'
     C                     MOVEL'50'      SAAS
     C                     END
     C*
     C                     Z-ADDXSDED     SAED
     C*
     C* COMPLETE OTHER DATE - MP,DV ONLY
     C*
     C           XSDET     IFEQ 'MP'
     C           XSDET     OREQ 'DV'
     C                     Z-ADDXSDPD     SAOD
     C                     ELSE
     C                     Z-ADD*ZERO     SAOD
     C                     END
     C*
     C* COMPLETE AMOUNT PER UNIT - DV ONLY
     C*
     C           XSDET     IFEQ 'DV'
     C***********          Z-ADDXSDDV     SDAU                            E16772
     C                     Z-ADDXSDVA     SDUN                            E16772
     C                     ELSE
     C***********          Z-ADD*ZERO     SDAU                            E16772
     C                     Z-ADD*ZERO     SDUN                            E16772
     C                     END
     C*
     C* COMPLETE CALL AMOUNT/% - PP ONLY
     C*
     C           XSDET     IFEQ 'PP'
     C*
     C* SDCA AND STCA IN THE SECURITY ACTION FILE SHOULD BE UPDATED       E15930
     C* WITH THE CALL AMTS FROM THE DIARY RATHER THAN THE TOTAL AMTS      E15930
     C* FROM IN THE DIARY.                                                E15930
     C***********XSDTA     IFEQ *ZERO                                     E15930
     C***********          MOVE XSDTP     SDCA                            E15930
     C           XSDPP     IFEQ *ZERO                                     E15930
     C                     MOVE XSDPC     SDCA                            E15930
     C                     ELSE
     C***********          MOVE XSDTA     SDCA                            E15930
     C                     MOVE XSDPP     SDCA                            E15930
     C                     END
     C*
     C                     ELSE
     C                     Z-ADD*ZERO     SDCA
     C                     END
     C*
     C* COMPLETE TOTAL CALLED AMOUNT/%
     C*
     C           PPDI      IFEQ 'Y'
     C*
     C           XSDET     IFEQ 'PP'
     C*
     C***********XSDTA     IFEQ *ZERO                                     E15930
     C***********          MOVE XSDTP     STCA                            E15930
     C           XSDPP     IFEQ *ZERO                                     E15930
     C                     MOVE XSDPC     STCA                            E15930
     C                     MOVE XSDTP     STCA                            E23049
     C                     ELSE
     C***********          MOVE XSDTA     STCA                            E15930
     C***********          MOVE XSDPP     STCA                     E15930 E23049
     C                     MOVE XSDTA     STCA                            E23049
     C                     END
     C*
     C                     ELSE
     C*
     C           XSDET     IFEQ 'IR'
     C           XSDET     OREQ 'MP'
     C*
     C                     MOVE UCPDP     STCA
     C*
     C                     ELSE
     C                     Z-ADD*ZERO     STCA
     C                     END
     C                     END
     C*
     C                     ELSE
     C                     Z-ADD*ZERO     STCA
     C*
     C                     END
     C*
     C* COMPLETE CURRENT FACTOR (NEW/CURRENT) - MP,IR,PP ONLY
     C*
     C           XSDET     IFEQ 'MP'
     C                     Z-ADDXSDCP     SACF
     C                     ELSE
     C           XSDET     IFEQ 'IR'
     C           XSDET     OREQ 'PP'
     C                     Z-ADDUCFCT     SACF
     C                     ELSE
     C                     Z-ADD*ZERO     SACF
     C                     END
     C                     END
     C*
     C* COMPLETE PREVIOUS CURRENT FACTOR
     C*
      ***  If not already actioned, PCFCT has not yet been updated - it   E20086
      ***  still contains the prior value - must use UCFCT instead.       E20086
      *                                                                   E20086
     C           XSDAD     IFNE *ZERO                                     E20086
     C           XSDDT     ORNE *ZERO                                     E20086
     C                     Z-ADDPCFCT     PCFA
     C                     ELSE                                           E20086
     C                     Z-ADDUCFCT     PCFA                            E20086
     C                     END                                            E20086
     C*
     C* COMPLETE COUPON RATE - IR, MP, PP ONLY
     C*
     C           XSDET     IFEQ 'IR'
     C                     Z-ADDXSDNC     SDCR
     C                     ELSE
     C           XSDET     IFEQ 'MP'
     C           XSDET     OREQ 'PP'
     C                     Z-ADDUCPNR     SDCR
     C                     ELSE
     C                     Z-ADD*ZERO     SDCR
     C                     END
     C                     END
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C           XSDET     IFEQ 'IR'                                                          CAS006
     C                     Z-ADDXSDNN     WCPNN                                               CAS006
     C                     ELSE                                                               CAS006
     C           XSDET     IFEQ 'MP'                                                          CAS006
     C           XSDET     OREQ 'PP'                                                          CAS006
     C                     Z-ADDUCPNN     WCPNN                                               CAS006
     C                     ELSE                                                               CAS006
     C                     Z-ADD*ZERO     WCPNN                                               CAS006
     C                     ENDIF                                                              CAS006
     C                     ENDIF                                                              CAS006
     C                     ENDIF                                                              CAS006
     C*
     C* COMPLETE REPAYMENT METHOD IND/AMOUNT - MP ONLY
     C*
     C           XSDET     IFEQ 'MP'
     C                     MOVELXSRMI     RTMI
     C                     Z-ADDXSRPT     RTAI
     C                     ELSE
     C                     MOVEL*BLANK    RTMI
     C                     Z-ADD*ZERO     RTAI
     C                     END
     C*
     C* COMPLETE POSITION SETTLEMENT REQUIRED INDICATOR
     C*
     C           XRECI     IFEQ 'C'                                       S01158
     C*
     C           XSDDT     IFNE *ZERO
     C                     MOVEL'Y'       PSRI
     C                     ELSE
     C                     MOVEL*BLANK    PSRI
     C                     END
     C*
     C                     ELSE
     C*
     C           XSDDT     IFEQ *ZERO
     C                     MOVEL'Y'       PSRI
     C                     ELSE
     C                     MOVEL*BLANK    PSRI
     C                     END
     C*
     C                     END
     C*
     C* COMPLETE ACCOUNT KEYS REQUIRED INDICATOR
     C*
     C           XRECI     IFEQ 'C'                                       S01158
     C*
     C           XSDAD     IFNE *ZERO
     C                     MOVEL'Y'       AKRI
     C                     ELSE
     C                     MOVEL*BLANK    AKRI
     C                     END
     C*
     C                     ELSE
     C*
     C***********XSDED     IFEQ ECD                                E15549 054498
     C***********ACRLRN    ANDNE'3'                                E21305 054498
     C***********          MOVEL*BLANK    AKRI                            054498
     C***********          ELSE                                           054498
     C***********          MOVEL'Y'       AKRI                            054498
     C***********                                                  E15549 E23802
     C***UPDATE*LAST*COUPON/DIVIDEND*DATE*ON*LF/SECTY**************E15549 E23802
     C***********                                                  E15549 E23802
     C***********XSDET     IFEQ 'DV'                               E15549 E23802
     C***********          MOVE '1'       *IN,41                   E15549 E23802
     C***********          Z-ADDXSDED     DIVNDT  50               E15549 E23802
     C***********          END                                     E15549 E23802
     C***********          END                                            054498
     C*
     C           XSDED     IFLE AKDAT                                     054498
     C                     MOVEL'Y'       AKRI                            054498
     C                     ELSE                                           054498
     C                     MOVEL*BLANK    AKRI                            054498
     C                     END                                            054498
     C                     END
     C*
     C* COMPLETE NARRATIVE
     C*
     C                     MOVELXSDNV     SDNR
     C*
     C* INITIALISE OTHER FIELDS TO BLANK/ZERO
     C*
     C                     Z-ADDRUND      SAAC
     C                     Z-ADDXSDXD     SAEXD                           S01510
     C*
     C                     WRITESECACDF
     C                     ADD  1         OTOT5                           E15549
     C*
     C                     ADD  1         OTOT3
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  OUTW04 - SR to Output an Initial Diary Event to SEDEVD       *
      *                                                               *
      *  Called By: NEWSEC                                            *
      *  Calls: None.                                                 *
      *                                                               *
      *****************************************************************
      *
     C           OUTW04    BEGSR                           **OUTW04 BEGSR**
     C                     MOVE 'M'       RECI
     C                     MOVE SESN      SDSN
     C                     Z-ADD*ZERO     SDED
     C                     MOVE NAR,3     SDNV
     C***********          Z-ADD*ZERO     SDDV                            E16772
     C                     Z-ADD*ZERO     SDVA                            E16772
     C                     Z-ADD*ZERO     SDPD
     C                     MOVE *BLANKS   SDCV
     C                     Z-ADD*ZERO     SDAD
     C                     Z-ADD*ZERO     SDDT
     C                     Z-ADD*ZERO     LCD
     C                     MOVE *BLANK    CHTP
     C                     Z-ADD*ZERO     TNLU
     C*
     C*  PAYMENT CURRENCY (SPYC) NE BLANK - OUTPUT TYPE 'XR'
     C*
     C           SPYC      IFNE *BLANKS                                   E13524
     C                     MOVE 'XR'      SDET
     C                     Z-ADD*ZERO     SDCP
     C                     Z-ADD*ZERO     SRPT
     C                     Z-ADD*ZERO     SDTR
     C                     MOVE *BLANK    SRMI
     C                     Z-ADD*ZERO     SDPD
     C                     Z-ADD*ZERO     SDNC
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     Z-ADD*ZERO     SDNN                                                CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     Z-ADD*ZERO     SDPP
     C                     Z-ADD*ZERO     SDPC
     C                     Z-ADD*ZERO     SDTA
     C                     Z-ADD*ZERO     SDTP
     C                     Z-ADD*ZERO     SDRP
     C                     MOVE SPYC      SDCX
     C                     Z-ADDSEXR      SDCE
     C                     MOVE SMDI      SDMD
     C                     Z-ADD*ZERO     SDAL                                                CSE065
     C*
     C*  WRITE THE RECORD TO LF/SEDEL
     C*
     C                     WRITESEDEVDF
     C                     ADD  1         DTOTA
     C                     END
     C*
     C*  COUPON RATE NE ZERO - OUTPUT TYPE 'IR'
     C*
     C           CPNR      IFNE *ZERO
     C                     MOVE 'IR'      SDET
     C                     Z-ADD*ZERO     SDCP
     C                     Z-ADD*ZERO     SRPT
     C                     Z-ADD*ZERO     SDTR
     C                     MOVE *BLANK    SRMI
     C                     Z-ADD*ZERO     SDPD
     C                     Z-ADDCPNR      SDNC
     C                     Z-ADD*ZERO     SDPP
     C                     Z-ADD*ZERO     SDPC
     C                     Z-ADD*ZERO     SDTA
     C                     Z-ADD*ZERO     SDTP
     C                     Z-ADD*ZERO     SDRP
     C                     MOVE *BLANK    SDCX
     C                     Z-ADD*ZERO     SDCE
     C                     MOVE *BLANK    SDMD
     C                     Z-ADD*ZERO     SDAL                                                CSE065
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C           CPNN      IFNE *ZERO                                                         CAS006
     C                     Z-ADDCPNN      SDNN                                                CAS006
     C                     ENDIF                                                              CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C/COPY WNCPYSRC,SE2100C024
     C*
     C*  WRITE THE RECORD TO LF/SEDEL
     C*
     C                     WRITESEDEVDF
     C                     ADD  1         DTOTA
     C                     END
     C*
     C*  PP CALL INDICATOR EQ 'Y' - OUTPUT TYPE 'PP'
     C*
     C           PPDI      IFEQ 'Y'
     C                     MOVE 'PP'      SDET
     C                     Z-ADD*ZERO     SDCP
     C                     Z-ADD*ZERO     SRPT
     C                     Z-ADD*ZERO     SDTR
     C                     MOVE *BLANK    SRMI
     C                     Z-ADD*ZERO     SDPD
     C***********          Z-ADD*ZERO     SDNC                            E14674
     C                     Z-ADDCPNR      SDNC                            E14674
     C           PROT      IFEQ '4'
     C                     Z-ADDCPDP      SDPP
     C                     Z-ADDCPDP      SDTA                            E15930
     C                     Z-ADD*ZERO     SDPC
     C                     Z-ADD*ZERO     SDTP                            E15930
     C                     ELSE
     C                     Z-ADD*ZERO     SDPP
     C***********          Z-ADD*ZERO     SDPC                     E15930 E23049
     C***********          Z-ADDCPDP      SDPC                            E15930
     C                     Z-ADD*ZERO     SDPC                            E15930
     C                     MOVE CPDP      SDPC                            E15930
     C                     END
     C*
     C** UPDATE SDTA AND SDTP WITH CPDP FOR THE INITIAL RECORD            E15930
     C*
     C***********          Z-ADD*ZERO     SDTA                            E15930
     C***********          Z-ADD*ZERO     SDTP                            E15930
     C                     Z-ADDSDPP      SDTA                            E15930
     C                     Z-ADDSDPC      SDTP                            E15930
     C*                                                                   E15930
     C                     Z-ADD*ZERO     SDRP
     C                     MOVE *BLANK    SDCX
     C                     Z-ADD*ZERO     SDCE
     C                     MOVE *BLANK    SDMD
     C                     Z-ADD*ZERO     SDAL                                                CSE065
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     Z-ADDCPNN      SDNN                                                CAS006
     C                     ENDIF                                                              CAS006
     C*
     C*  WRITE THE RECORD TO LF/SEDEL
     C*
     C                     WRITESEDEVDF
     C                     ADD  1         DTOTA
     C                     END
     C*
     C*  CURRENT FACTOR NE ZERO - OUTPUT TYPE 'MP'
     C*
     C           CFCT      IFNE *ZERO
     C                     MOVE 'MP'      SDET
     C                     Z-ADDCFCT      SDCP
     C                     Z-ADD*ZERO     SRPT
     C                     Z-ADD*ZERO     SDTR
     C                     MOVE *BLANK    SRMI
     C                     Z-ADD*ZERO     SDPD
     C***********          Z-ADD*ZERO     SDNC                            E14674
     C                     Z-ADDCPNR      SDNC                            E14674
     C                     Z-ADD*ZERO     SDPP
     C                     Z-ADD*ZERO     SDPC
     C                     Z-ADD*ZERO     SDTA
     C                     Z-ADD*ZERO     SDTP
     C                     Z-ADD*ZERO     SDRP
     C                     MOVE *BLANK    SDCX
     C                     Z-ADD*ZERO     SDCE
     C                     MOVE *BLANK    SDMD
     C                     Z-ADD*ZERO     SDAL                                                CSE065
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     Z-ADDCPNN      SDNN                                                CAS006
     C                     ENDIF                                                              CAS006
     C*
     C*  WRITE THE RECORD TO LF/SEDEL
     C*
     C                     WRITESEDEVDF
     C                     ADD  1         DTOTA
     C                     END
      *                                                                                       CSE065
     C           CSE065    IFEQ 'Y'                                                           CSE065
     C           PROT      ANDNE'2'                                                           CSE065
     C           PROT      ANDNE'4'                                                           CSE065
     C           PROT      ANDNE'7'                                                           CSE065
     C                     MOVE 'AL'      SDET                                                CSE065
     C                     MOVE *BLANKS   ZZ005                                               CSE065
     C                     Z-ADD*ZEROS    SRPT                                                CSE065
     C                     Z-ADD*ZEROS    SDTR                                                CSE065
     C                     MOVE *BLANKS   SRMI                                                CSE065
     C                     Z-ADD*ZEROS    SDNC                                                CSE065
     C                     Z-ADD*ZEROS    SDPP                                                CSE065
     C                     Z-ADD*ZEROS    SDPC                                                CSE065
     C                     Z-ADD*ZEROS    SDTA                                                CSE065
     C                     Z-ADD*ZEROS    SDTP                                                CSE065
     C                     Z-ADD*ZEROS    SDRP                                                CSE065
     C                     MOVE *BLANKS   SDCX                                                CSE065
     C                     Z-ADD*ZEROS    SDCE                                                CSE065
     C                     MOVE *BLANK    SDMD                                                CSE065
     C                     Z-ADD*ZEROS    SDNN                                                CSE065
     C                     Z-ADDALDT      SDAL                                                CSE065
      *                                                                                       CSE065
     C                     WRITESEDEVDF                                                       CSE065
      *                                                                                       CSE065
     C                     ADD  1         DTOTA                                               CSE065
      *                                                                                       CSE065
     C                     ENDIF                                                              CSE065
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  OUTSND - Subroutine to Output Non-Diary Event to PF/SNDEVD   *
      *                                                               *
      *  Called By: OUTW01, OUTW02                                    *
      *  Calls: None.                                                 *
      *                                                               *
      *****************************************************************
      *
     C           OUTSND    BEGSR                           **OUTSND BEGSR**
     C*
     C*  SET UP FIELDS FROM SECACD RECORD
     C*
     C                     MOVEL'D'       RECI
     C                     MOVELSASN      SNSN
     C                     Z-ADDSAED      SNDT
     C                     MOVELSAAT      SNET
     C                     Z-ADDSDCR      SNCR
     C                     Z-ADDSACF      SNCF
     C                     Z-ADD*ZERO     SNCA
     C                     Z-ADDSTCA      SNCP
     C                     Z-ADD*ZERO     SNPR
     C                     MOVELSDNR      SNNA
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     Z-ADDWCPNN     SNCN                                                CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C/COPY WNCPYSRC,SE2100C007
     C*
     C                     WRITESNDEVDF
     C*
     C                     ENDSR
      *
      *****************************************************************
     C/EJECT                                                              137563
     C*****************************************************************   137563
     C*                                                               *   137563
     C*  IRCHCK - Subroutine to check whether the IR event correspond *   137563
     C*           w/ the Interest Rate change of the Security.        *   137563
     C*                                                               *   137563
     C*  Called By: PROCES                                            *   137563
     C*  Calls: None.                                                 *   137563
     C*                                                               *   137563
     C*****************************************************************   137563
     C*                                                                   137563
     C           IRCHCK    BEGSR                                          137563
     C*                                                                   137563
     C                     Z-ADD*ZEROS    DAT                             137563
     C                     Z-ADD1         X       20                      137563
     C                     DO   12        X                               137563
     C           CD,X      IFNE *ZEROS                                    137563
     C           *IN98     IFEQ '1'                                       137563
     C                     MOVE CD,X      DAT,X                           137563
     C                     ELSE                                           137563
     C                     MOVELCD,X      WK2N    20                      137563
     C                     MOVE WK2N      WK4N    40                      137563
     C                     MOVE CD,X      WK2N                            137563
     C                     MOVELWK2N      WK4N                            137563
     C                     MOVE WK4N      DAT,X                           137563
     C                     ENDIF                                          137563
     C                     ENDIF                                          137563
     C                     ENDDO                                          137563
     C*                                                                   137563
     C** Find the year for the event                                      137563
     C*                                                                   137563
     C                     Z-ADDXSDED     ZDAYNO                          137563
     C                     EXSR ZDATE2                                    137563
     C                     MOVE ZDATE     IYR     20                      137563
     C                     MOVE ZDATE     WSDED   6                       137563
      *                                                                   206316
      ** If CSE031 is on, Next Coupon Date is amendable . This means      206316
      ** the NCD may not be found from the coupon array or SE0045.        206316
      ** If XSDED equals NCD and the correspoing coupon is 'R' or 'C'     206316
      ** then set on *IN50.                                               206316
      *                                                                   206316
     C           CSE031    IFEQ 'Y'                                       206316
     C           CSE071    OREQ 'Y'                                       CSE071
     C           BCNV      IFNE ' '                                       206316
     C           BCNV      ANDNE'N'                                       206316
      *                                                                   206316
     C           XSDED     IFEQ NCD                                       206316
      *                                                                   206316
      ** Find corresponding coupon.                                       206316
     C           CHK1      TAG                                            206316
     C                     MOVE 'N'       WCRI    1                       206316
     C                     Z-ADD12        X       20                      206316
      *                                                                   206316
     C           X         DOWGT0                                         206316
     C           CD,X      IFNE *ZERO                                     206316
      *                                                                   206316
      ** Convert Date to Day number                                       206316
     C                     MOVELIYR       DAT,X                           206316
     C                     MOVELDAT,X     WRK2                            206316
     C                     MOVE WRK2      ZDATE                           206316
     C                     MOVELDAT,X     WRK4                            206316
     C                     MOVE DAT,X     WRK2                            206316
     C                     MOVELWRK2      WRK4                            206316
     C                     MOVELWRK4      ZDATE                           206316
     C                     EXSR ZDATE1                                    206316
      *                                                                   206316
     C           NCD       IFGE ZDAYNO                                    206316
     C                     MOVE 'Y'       WCRI                            206316
     C                     LEAVE                                          206316
     C                     ENDIF                                          206316
      *                                                                   206316
     C                     ENDIF                                          206316
     C                     SUB  1         X                               206316
     C                     ENDDO                                          206316
      *                                                                   206316
      ** If coupon rate indicator not found check previous year           206316
     C           WCRI      IFEQ 'N'                                       206316
     C                     SUB  1         IYR                             206316
     C                     GOTO CHK1                                      206316
     C                     ENDIF                                          206316
      *                                                                   206316
      ** Check coupon rate indicator                                      206316
     C           WCRI      IFEQ 'Y'                                       206316
     C           CR,X      IFEQ 'R'                                       206316
     C           CR,X      OREQ 'C'                                       206316
     C                     MOVE '1'       *IN50                           206316
     C                     GOTO EIRCHK                                    206316
     C                     ENDIF                                          206316
     C                     ENDIF                                          206316
      *                                                                   206316
     C                     ENDIF                                          206316
     C                     ENDIF                                          206316
     C                     ENDIF                                          206316
     C*                                                                   137563
     C** Fetch Maturity date year                                         137563
     C*                                                                   137563
     C                     Z-ADDMATY      ZDAYNO                          137563
     C                     EXSR ZDATE2                                    137563
     C                     MOVE ZDATE     MYR     20                      137563
     C*                                                                   137563
     C** Assemble Event date into compatible format                       137563
     C** (And take date format M into consideration)                      137563
     C*                                                                   137563
     C                     MOVE WSDED     WK2N                            137563
     C                     MOVELWK2N      EVTDAT  60                      137563
     C           *IN98     IFEQ '1'                                       137563
     C                     MOVELWSDED     WK4N                            137563
     C                     ELSE                                           137563
     C                     MOVE WSDED     WK4N                            137563
     C                     MOVELWSDED     WK2N                            137563
     C                     MOVE WK2N      WK4N                            137563
     C                     ENDIF                                          137563
     C                     MOVE WK4N      EVTDAT                          137563
     C*                                                                   137563
     C           MYR       IFLT 72                                        137563
     C           MYR       ADD  100       MYRC    30                      137563
     C                     ELSE                                           137563
     C                     Z-ADDMYR       MYRC                            137563
     C                     ENDIF                                          137563
     C           IYR       IFLT 72                                        137563
     C           IYR       ADD  100       IYRC    30                      137563
     C                     ELSE                                           137563
     C                     Z-ADDIYR       IYRC                            137563
     C                     ENDIF                                          137563
     C*                                                                   137563
     C           IYRC      DOWLEMYRC                                      137563
     C                     Z-ADD1         X                               137563
     C                     MOVE '0'       *IN50                           137563
     C                     DO   12        X                               137563
     C           DAT,X     IFNE *ZEROS                                    137563
     C                     MOVELIYR       DAT,X                           137563
     C***********EVTDAT    CABEQDAT,X     EIRCHK         50        137563 182505
     C           BCNV      IFNE ' '                                       182505
     C           BCNV      ANDNE'N'                                       CSE031
     C*                                                                   182505
     C                     MOVELDAT,X     WRK2    2                       182505
     C                     MOVE WRK2      ZDATE                           182505
     C                     MOVELDAT,X     WRK4    4                       182505
     C                     MOVE DAT,X     WRK2    2                       182505
     C                     MOVELWRK2      WRK4                            182505
     C                     MOVELWRK4      ZDATE                           182505
     C                     EXSR ZDATE1                                    182505
     C*                                                                   182505
     C           BCNV      IFEQ 'C'                                       182505
     C********** CSE031    OREQ 'Y'                                CSE031 206316
     C                     MOVE 'N'       NCI     1                       182505
     C                     ELSE                                           182505
     C                     MOVE 'L'       NCI                             182505
     C                     ENDIF                                          182505
     C                     Z-ADDZDAYNO    WRCHG   50                      182505
     C                     CALL 'SE0045'                                  182505
     C                     PARM           SITP                            182505
     C                     PARM           WRCHG                           182505
     C                     PARM           ITLD                            182505
     C                     PARM           FCPN                            182505
     C                     PARM           CD                              182505
     C                     PARM           CR                              182505
     C                     PARM           NMCY                            182505
     C                     PARM           WRCHG                           182505
     C                     PARM           NCI                             182505
     C                     PARM           BCNV                            182505
     C                     PARM           MATY                            182505
     C                     PARM           LCPN                            CSE031
     C                     PARM           HCY1                            CSE071
     C                     PARM           HCY2                            CSE071
     C                     PARM           HCY3                            CSE071
     C                     PARM           HCY4                            CSE071
     C                     PARM           HCY5                            CSE071
     C                     PARM           HCY6                            CSE071
     C                     PARM           HCY7                            CSE071
     C                     PARM           HCY8                            CSE071
     C                     PARM           HCY9                            CSE071
     C*                                                                   182505
     C           XSDED     IFEQ WRCHG                                     182505
     C           CR,X      IFEQ 'R'                                       182505
     C           CR,X      OREQ 'C'                                       182505
     C                     MOVE '1'       *IN50                           182505
     C                     GOTO EIRCHK                                    182505
     C                     ENDIF                                          182505
     C                     ENDIF                                          182505
     C*                                                                   182505
     C                     ENDIF                                          182505
     C*                                                                   182505
     C           EVTDAT    IFEQ DAT,X                                     137563
     C           CR,X      IFEQ 'R'                                       137563
     C           CR,X      OREQ 'C'                                       137563
     C                     MOVE '1'       *IN50                           137563
     C                     ENDIF                                          137563
     C                     GOTO EIRCHK                                    137563
     C                     ENDIF                                          137563
     C                     ENDIF                                          137563
     C                     ENDDO                                          137563
     C*                                                                   137563
     C           IYR       IFEQ 99                                        137563
     C                     Z-ADD0         IYR                             137563
     C                     ADD  1         IYRC                            137563
     C                     ELSE                                           137563
     C                     ADD  1         IYR                             137563
     C                     ADD  1         IYRC                            137563
     C                     ENDIF                                          137563
     C*                                                                   137563
     C                     ENDDO                                          137563
     C*                                                                   137563
     C           EIRCHK    ENDSR                                          137563
     C*                                                                   137563
     C*****************************************************************   137563
      /EJECT
     C*                                                                   S96032
     C/COPY WNCPYSRC,SE2100CP10                                           S96032
     C*                                                                   S96032
      *****************************************************************
      *                                                               *
      *  SECSR  - Subroutine for SECTY File Exception/Error handling. *
      *                                                               *
      *****************************************************************
      *
     C           SECSR     BEGSR                           **SECSR BEGSR**
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'SECTY'   DBFILE           ***************
     C                     MOVELSESN      DBKEY            * DB ERROR 07 *
     C                     Z-ADD7         DBASE            ***************
     C                     OUT  LDA                                       S01117
     C                     MOVELSTSSEC    DBSTAT
     C                     MOVEA'1'       *IN,88
     C                     MOVEL'1'       *INU7
     C                     MOVEL'1'       *INU8
     C                     EXSR *PSSR                                     S01117
     C*
     C                     ENDSR
      *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  DELSR  - Subroutine for SEDEL File Exception/Error handling. *
      *                                                               *
      *****************************************************************
      *
     C           DELSR     BEGSR                           **DELSR BEGSR**
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'SEDEL'   DBFILE           ***************
     C                     MOVELSDSN      DBKEY            * DB ERROR 08 *
     C                     Z-ADD8         DBASE            ***************
     C                     OUT  LDA                                       S01117
     C                     MOVELSTSDEL    DBSTAT
     C                     EXSR *PSSR                                     S01117
     C                     MOVEA'1'       *IN,88
     C                     MOVEL'1'       *INU7
     C                     MOVEL'1'       *INU8
     C*
     C                     ENDSR
      *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  SNDSR  - Subroutine for SNDEVD File Exception/Error handling.*
      *                                                               *
      *****************************************************************
      *
     C           SNDSR     BEGSR                           **SNDSR BEGSR**
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'SNDEVD'  DBFILE           ***************
     C                     MOVELSNSN      DBKEY            * DB ERROR 09 *
     C                     Z-ADD9         DBASE            ***************
     C                     MOVELSTSSND    DBSTAT
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     MOVEA'1'       *IN,88
     C                     MOVEL'1'       *INU7
     C                     MOVEL'1'       *INU8
     C*
     C                     ENDSR
      *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  SNASR  - Subroutine for SNDEVA FILE Exception/Error handling.*
      *                                                               *
      *****************************************************************
      *
     C           SNASR     BEGSR                           **SNASR BEGSR**
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'SNDEVA'  DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 10 *
     C                     Z-ADD10        DBASE            ***************
     C                     MOVELSTSSNA    DBSTAT
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     MOVEA'1'       *IN,88
     C                     MOVEL'1'       *INU7
     C                     MOVEL'1'       *INU8
     C*
     C                     ENDSR
      *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  CCDSR  - Subroutine for SECACD File Exception/Error handling.*
      *                                                               *
      *****************************************************************
      *
     C           CCDSR     BEGSR                           **CCDSR BEGSR**
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'SECACD'  DBFILE           ***************
     C                     MOVELSASN      DBKEY            * DB ERROR 11 *
     C                     Z-ADD11        DBASE            ***************
     C                     MOVELSTSCCD    DBSTAT
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     MOVEA'1'       *IN,88
     C                     MOVEL'1'       *INU7
     C                     MOVEL'1'       *INU8
     C*
     C                     ENDSR
      *
      *****************************************************************
     C/COPY WNCPYSRC,SE2100C004
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  CCASR  - Subroutine for SECACA File Exception/Error handling.*
      *                                                               *
      *****************************************************************
      *
     C           CCASR     BEGSR                           **CCASR BEGSR**
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'SECACA'  DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 12 *
     C                     Z-ADD12        DBASE            ***************
     C                     MOVELSTSCCA    DBSTAT
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     MOVEA'1'       *IN,88
     C                     MOVEL'1'       *INU7
     C                     MOVEL'1'       *INU8
     C*
     C                     ENDSR
      *
      *****************************************************************                       CSE065
      /SPACE 3                                                                                CSE065
      *****************************************************************                       CSE065
      *                                                               *                       CSE065
      *  OUTW05 - Subroutine for End of Security Average Life         *                       CSE065
      *           Date Processing                                     *                       CSE065
      *                                                               *                       CSE065
      *****************************************************************                       CSE065
      *                                                                                       CSE065
     C           OUTW05    BEGSR                                                              CSE065
      *                                                                                       CSE065
     C                     CLEARSECACDF                                                       CSE065
      *                                                                                       CSE065
     C                     MOVE 'D'       RECI                                                CSE065
     C                     MOVELSESN      SASN                                                CSE065
     C                     MOVE 'ML'      SAAT                                                CSE065
     C                     MOVE '80'      SAAS                                                CSE065
     C                     Z-ADDALDT      SAED                                                CSE065
     C                     MOVEL#CONS1    SDNR                                                CSE065
     C                     Z-ADDRUND      SAAC                                                CSE065
     C                     MOVE 'Y'       AKRI                                                CSE065
     C                     Z-ADDULCPN     LCCP                                                CSE065
      *                                                                                       CSE065
     C                     WRITESECACDF                                                       CSE065
      *                                                                                       CSE065
     C                     ADD  1         OTOT3                                               CSE065
     C                     ADD  1         OTOT5                                               CSE065
      *                                                                                       CSE065
     C                     ENDSR                                                              CSE065
      *                                                                                       CSE065
      *****************************************************************   S01117
      /EJECT                                                              S01117
      *****************************************************************   S01117
      *                                                               *   S01117
      *  *PSSR  - Error control subroutine                            *   S01117
      *                                                               *   S01117
      *****************************************************************   S01117
      *                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR **    S01117
     C**                                                                  S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     ENDSR                                          S01117
      *                                                                   S01117
      *****************************************************************
      /EJECT                                                              054498
     C/COPY ZSRSRC,ZEVCDZ1                                                054498
      /EJECT
     C/COPY ZSRSRC,ZDATE1Z2
      /EJECT
     C/COPY ZSRSRC,ZDATE2Z4
      /EJECT
     C/COPY ZSRSRC,ZICD2Z1
      /EJECT                                                              E20085
     C/COPY ZSRSRC,ZLCDZ1                                                            E20085 MD057247
      /EJECT
     C/COPY ZSRSRC,ZNCDZ3
      /EJECT
     C/COPY ZSRSRC,ZSYSTMZ1
     C/COPY ZSRSRC,ZACCH                                                  CSE023
     C/COPY ZSRSRC,ZBKDT                                                  CSE023
     C/COPY ZSRSRC,ZFWDT                                                  182505
     C/COPY WNCPYSRC,SE2100C005
      /EJECT
      ***
     O/COPY WNCPYSRC,SE2100OOP1                                           S96032
**  CPY@
(c) Finastra International Limited 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** NAR
COUPON DATE
MATURITY DATE
INITIAL VALUE
** ETP                                                                    E15549
XRIRMPPPAL                                                                             E15549 CSE065
     X/COPY WNCPYSRC,SE2100X001
